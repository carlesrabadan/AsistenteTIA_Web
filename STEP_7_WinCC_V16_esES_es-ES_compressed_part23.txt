tud del resto del telegrama. A continuaci√≥n, se efect√∫a una
segunda llamada de AG_(L)RECV con la longitud restante. La evaluaci√≥n de los datos de
usuario recibidos se efect√∫a despu√©s de la recepci√≥n completa.

Par√°metros
Los par√°metros de la instrucci√≥n MODBUSCP se dividen en dos grupos:
‚óè Par√°metros de inicializaci√≥n
Los par√°metros de inicializaci√≥n se eval√∫an solo durante la llamada en el OB100 y se
aplican en el DB de instancia. Los par√°metros de inicializaci√≥n est√°n marcados con "s√≠" en
la tabla, en la columna "INIT".
La modificaci√≥n de un par√°metro de inicializaci√≥n durante el funcionamiento no tiene
ning√∫n efecto. Despu√©s de modificar este par√°metro, p. ej., en el modo Test, debe
inicializarse de nuevo el DB de instancia mediante "STOP > RUN" de la CPU.
‚óè Par√°metros del tiempo de ejecuci√≥n
Los par√°metros del tiempo de ejecuci√≥n pueden modificarse en el funcionamiento c√≠clico.
En el modo de operaci√≥n "S7 es cliente", sin embargo, no es conveniente modificar los
par√°metros de entrada mientras haya una petici√≥n en curso. Con las preparativos para la
siguiente petici√≥n y las modificaciones de par√°metros asociadas, debe esperarse hasta
que la petici√≥n anterior haya finalizado con DONE_NDR o ERROR.
En el modo de operaci√≥n "S7 es servidor" solo pueden evaluarse los par√°metros de salida
con DONE_NDR activado.
Los par√°metros de salida son indicadores din√°micos y, por tanto, solo est√°n disponibles
durante 1 ciclo de la CPU. Para poderlos procesar posteriormente o verlos en la tabla de
variables, se deben copiar en otras √°reas de memoria.
En las √°reas de valores para los distintos par√°metros tambi√©n deben tenerse en cuenta, las
limitaciones espec√≠ficas de la CPU, si las hay.
Par√°metros

Decl.

Tipo

Descripci√≥n

Rango de valo‚Äê
res

Init

id (P√°gina 7302)

IN

WORD

ID de conexi√≥n del editor "Dispositivos y redes"

De 1 a 64

S√≠

db_param (P√°gi‚Äê
na 7302)

IN

BLOCK_DB

N√∫mero del DB de par√°metros

Depende de la
CPU

S√≠

MONITOR (P√°gi‚Äê IN
na 7308)

TIME

Tiempo de vigilancia para la recepci√≥n de datos del in‚Äê
terlocutor
El tiempo m√≠nimo ajustable es 20 ms

T#20ms hasta
T#+24d20h31
m23s647ms

No

REG_KEY (P√°gi‚Äê IN
na 7297)

STRING[17]

Clave del registro para la concesi√≥n de licencia

Character

No

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7295

Instrucciones
4.2 Instrucciones
Par√°metros

Decl.

Tipo

Descripci√≥n

Rango de valo‚Äê
res

Init

ENQ_ENR (P√°gi‚Äê IN
na 7308)

BOOL

S7 es cliente: Lanzamiento de petici√≥n con flanco posi‚Äê
tivo
S7 es servidor: Listo para recepci√≥n con nivel positivo

TRUE/FALSE

No

LICENSED

OUT

BOOL

Estado de licencia del bloque
El bloque tiene licencia
El bloque no tiene licencia

BUSY

OUT

BOOL

Estado de ejecuci√≥n de las funciones AG_(L)SEND o
AG_(L)RECV
En ejecuci√≥n
No en ejecuci√≥n

TRUE
FALSE

No

No
TRUE
FALSE

DONE_NDR

OUT

BOOL

S7 es cliente: TRUE: la petici√≥n activada ha terminado
sin error
S7 es servidor: TRUE: se ha ejecutado y ha respondido
a la solicitud del cliente

TRUE/FALSE

No

ERROR (P√°gi‚Äê
na 7302)

OUT

BOOL

Se ha producido un fallo
No se ha producido ning√∫n fallo

TRUE
FALSE

No

STATUS (P√°gi‚Äê
na 7302)

OUT

WORD

N√∫mero de error

De 0 a FFFF

No

STATUS_FUNC
(P√°gina 7302)

OUT

STRING[8]

Nombre de la funci√≥n que ha causado el error en STA‚Äê
TUS

Character

No

IDENT_CODE
(P√°gina 7297)

OUT

STRING[18]

Identificaci√≥n para la licencia
Solicite la licencia con esta cadena de identificaci√≥n.

Character

No

UNIT (P√°gi‚Äê
na 7307)

IN/O
UT

BYTE

Unit Identifier (INPUT en la funci√≥n CLIENT, OUTPUT
en la funci√≥n SERVER)

De 0 a 255

No

DATA_TYPE
(P√°gina 7307)

IN/O
UT

BYTE

Tipo de datos por procesar (INPUT en la funci√≥n
CLIENT, OUTPUT en la funci√≥n SERVER)

No

Coils

1

Inputs

2

Holding Register

3

Input Register

4

START_AD‚Äê
DRESS (P√°gi‚Äê
na 7307)

IN/O
UT

WORD

Direcci√≥n inicial MODBUS (INPUT en la funci√≥n
CLIENT, OUTPUT en la funci√≥n SERVER)

De 0 a 65535

LENGTH (P√°gi‚Äê
na 7307)

IN/O
UT

WORD

N√∫mero de valores por procesar (INPUT en la funci√≥n
CLIENT, OUTPUT en la funci√≥n SERVER)

WRITE_READ
(P√°gina 7307)

7296

IN/O
UT

BOOL

No

No

Coils: Funci√≥n de lectura

De 1 a 2000

Coils: Funci√≥n de escritura

De 1 a 1968

Inputs: Funci√≥n de lectura

De 1 a 2000

Holding Register: Funci√≥n de lectura

De 1 a 125

Holding Register: Funci√≥n de escritura

De 1 a 123

Input Register: Funci√≥n de lectura

De 1 a 125

INPUT en la funci√≥n CLIENT, OUTPUT en la funci√≥n
SERVER
Acceso de escritura o lectura

TRUE/FALSE

No

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Llamada de la instrucci√≥n MODBUSCP (P√°gina 7284)

Concesi√≥n de licencia con los par√°metros IDENT_CODE y REG_KEY
Descripci√≥n
Se debe obtener una licencia para la instrucci√≥n MODBUSCP en cada CPU por separado. La
licencia se concede en 2 pasos:
‚óè lectura del IDENT_CODE y
‚óè introducci√≥n del c√≥digo de validaci√≥n REG_KEY (clave del Registro).
Para ello, el OB121 debe estar presente en la CPU.
Para la lectura del IDENT_CODE proceda de la manera siguiente:
1. Parametrice la instrucci√≥n MODBUSCP de acuerdo con sus requisitos en un OB c√≠clico y
en el OB100. Cargue el programa en la CPU y p√≥ngala en RUN.
2. Abra el DB de instancia de la instrucci√≥n Modbus y haga clic en el bot√≥n "Observar todos".
3. En la salida IDENT_CODE se visualiza una cadena de caracteres de 18 d√≠gitos.

Figura 4-68

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Modbus/TCP CP: IDENT_CODE en el DB

7297

Instrucciones
4.2 Instrucciones
4. Copie este string mediante copiar/pegar desde el bloque de datos al formulario
SOFTWARE REGISTRATION FORM. Este formulario se encuentra en el CD de
instalaci√≥n.
Introduzca el n.¬∫ de licencia del embalaje del producto en el formulario.

Figura 4-69

Modbus/TCP CP: IDENT_CODE y formulario de licencia

5. Env√≠e el formulario mediante una Service Request (solicitud de servicio) al Customer
Support (https://support.industry.siemens.com/my/ww/en/requests/#createRequest).
Luego recibir√° el c√≥digo de validaci√≥n para la CPU.
El c√≥digo de validaci√≥n REG_KEY se debe indicar en cada instrucci√≥n MODBUSCP. La clave
REG_KEY debe guardarse en un bloque de datos global a trav√©s del cual todas las
instrucciones MODBUSCP recibir√°n el c√≥digo de validaci√≥n necesario.

7298

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para la introducci√≥n del c√≥digo de validaci√≥n REG_KEY proceda del modo siguiente:
‚óè Mediante "Agregar nuevo bloque‚Ä¶" inserte un bloque de datos global nuevo con un
nombre simb√≥lico un√≠voco, p. ej. "DB_Licencia".
‚óè Defina un par√°metro REG_KEY con el tipo de datos STRING[17] en este bloque.

Figura 4-70

REG_KEY en DB

‚óè Copie el c√≥digo de validaci√≥n de 17 d√≠gitos determinado mediante Copiar/Pegar en la
columna 'Valor de arranque'.
‚óè En el OB c√≠clico, en el par√°metro REG_KEY de la instrucci√≥n MODBUSCP, introduzca el
valor "DB_Licencia.REG_KEY".
‚óè Cargue los bloques modificados en la CPU. La introducci√≥n del c√≥digo de validaci√≥n se
puede realizar durante el tiempo de ejecuci√≥n, no es necesario pasar de STOP -> RUN.
La comunicaci√≥n Modbus/TCP a trav√©s de la instrucci√≥n MODBUSCP ahora tiene licencia
para esta CPU; el bit de salida LICENSED es TRUE.
Falta la concesi√≥n de licencia o esta es err√≥nea
Si no se introdujo ning√∫n c√≥digo de validaci√≥n o si este es incorrecto, el SF-LED (en S7-300)
o INTF-LED (en S7-400) de la CPU parpadea y se realiza c√≠clicamente una entrada en el b√∫fer
de diagn√≥stico relativa a la falta de licencia. El n√∫mero de error por falta de licencia es
W#16#A090.

Figura 4-71

B√∫fer de diagn√≥stico con A090

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7299

Instrucciones
4.2 Instrucciones

ADVERTENCIA
En caso de que el OB121 falte en el controlador, la CPU pasa al estado STOP.

En caso de que falte el c√≥digo de validaci√≥n o este sea incorrecto, se procesa la comunicaci√≥n
Modbus/TCP; sin embargo, en la salida STATUS se muestra constantemente W#16#A090
"No existe ninguna licencia v√°lida". El bit de salida LICENSED es FALSE.

Mapeo de direcciones
Interpretaci√≥n de las direcciones MODBUS/TCP
El modelo de datos MODBUS contiene las siguientes √°reas:
‚óè Coils
‚óè Inputs
‚óè Holding Register
‚óè Input Register
En algunos sistemas, como los PLC MODICON, la distinci√≥n de estas √°reas de memoria se
realiza mediante la direcci√≥n de registro o la direcci√≥n de bit. As√≠, por ejemplo, el Holding
Register con Offset 0 se denomina Register 40001 (tipo de memoria 4xxxx, Reference 0001).
Siempre da lugar a confusi√≥n porque, en algunos manuales, se describe y se hace referencia
a la direcci√≥n de registro del Application Layer y, en otros, a la direcci√≥n de registro/direcci√≥n
de bit transmitida realmente en el protocolo.
La instrucci√≥n MODBUSCP utiliza, en sus par√°metros start_x, end_x y START_ADDRESS, la
direcci√≥n Modbus/TCP realmente transmitida. Por tanto, con cada c√≥digo de funci√≥n se
pueden transferir direcciones de registro/direcciones de bits de 0000H a FFFFH.

Ejemplo
Las direcciones Modbus se pueden indicar en formato decimal o hexadecimal en el DB de
par√°metros.

7300

Par√°metros

Notaci√≥n decimal

Notaci√≥n hexadeci‚Äê
mal

Significado

data_type_1

1

B#16#1

Coils

db_1

10

W#16#A

DB 10

start_1

640

W#16#280

Direcci√≥n inicial: 640

end_1

1250

W#16#4E2

Direcci√≥n final:

data_type_2

3

B#16#3

Holding Register

db_2

11

W#16#B

DB 11

start_2

0

W#16#0

Direcci√≥n inicial: 0

end_2

499

W#16#1F3

Direcci√≥n final:

1250

499

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
data_type_3

3

B#16#3

Holding Register

db_3

12

W#16#C

DB 12

start_3

720

W#16#2D0

Direcci√≥n inicial: 720

end_3

900

W#16#384

Direcci√≥n final:

900

En la siguiente figura se muestra una comparativa de las √°reas de memoria SIMATIC con la
partici√≥n de memoria orientada a registro y a bit de los dispositivos Modbus/TCP. Se hace
referencia a la parametrizaci√≥n mencionada anteriormente.
En el dispositivo Modbus
Las direcciones Modbus resaltadas en negro afectan al Data Link Layer, mientras que las
grises afectan al Application Layer.
En SIMATIC
Las direcciones SIMATIC representadas en la columna "Offset" son el Offset en el DB. Los
n√∫meros de registro Modbus se indican entre corchetes.

Figura 4-72

Modbus/TCP: Mapeo de direcciones

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7301

Instrucciones
4.2 Instrucciones

Par√°metros ID y DB_PARAM
Descripci√≥n
ID
Para cada conexi√≥n configurada en STEP 7 (editor "Dispositivos y redes"), se asigna una ID
de conexi√≥n. La ID de conexi√≥n describe de forma un√≠voca la conexi√≥n entre la CPU y el
interlocutor a trav√©s del CP. Esta ID de conexi√≥n se configura en el bloque de par√°metros de
conexi√≥n que contiene el bloque de datos de par√°metros. Esta ID debe introducirse aqu√≠.
El rango de valores de este par√°metro es de 1 a 64.
DB_PARAM
El par√°metro db_param indica el n√∫mero del bloque de datos de par√°metros, en el cual se
encuentra el tipo de datos PLC MB_CP_PARAM. En este bloque de datos de par√°metros se
guardan los par√°metros espec√≠ficos de conexi√≥n y de Modbus que son necesarios para la
comunicaci√≥n entre la CPU y el interlocutor.
El rango de valores de este par√°metro depende de la CPU. El n√∫mero de DB 0 no se admite
ya que se reserva para el sistema. El n√∫mero de DB se introduce en texto expl√≠cito con el
formato "DBxy".
Si se deben realizar varias conexiones, el bloque de datos de par√°metros puede contener los
par√°metros necesarios de todas las conexiones de forma secuencial. Tambi√©n es posible
crear un bloque de datos de par√°metros aparte para cada conexi√≥n.

Consulte tambi√©n
Descripci√≥n MODBUSCP (P√°gina 7292)
Bloque de datos de par√°metros (P√°gina 7287)

Par√°metros DONE_NDR, ERROR, STATUS y STATUS_FUNC
Descripci√≥n
DONE_NDR
En el modo de operaci√≥n "S7 es cliente" la petici√≥n activada ha terminado sin errores. En una
funci√≥n de lectura, los datos de respuesta ya se han introducido en el DB desde el servidor; en
una funci√≥n de escritura, la respuesta se ha recibido en el telegrama de solicitud desde el
servidor.
En el modo de operaci√≥n "S7 es servidor" la salida muestra un intercambio de telegramas con
el cliente finalizado sin errores. En los par√°metros DATA_TYPE, START_ADDRESS,
LENGTH, WRITE_READ y UNIT se muestran los par√°metros de petici√≥n del cliente. Estas
salidas solo son v√°lidas siempre que est√© activado DONE_NDR.
ERROR
Si se activa esta salida, significa que se ha detectado un error.
En el modo de operaci√≥n "S7 es cliente" la petici√≥n activada ha finalizado con errores. El
n√∫mero de error correspondiente se muestra en la salida STATUS.

7302

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En el modo de operaci√≥n "S7 es servidor" se ha detectado un error en un telegrama de solicitud
del cliente o al enviar el telegrama de respuesta. El n√∫mero de error correspondiente se
muestra en la salida STATUS.
STATUS
La salida STATUS muestra el n√∫mero de error si ERROR est√° activado.
Se sigue mostrando informaci√≥n de estado en esta salida.
Las instrucciones MODBUSCP, MB_CPCLI y MB_CPSRV se utilizan en los bloques est√°ndar
SFC6, SFC20, SFC24, SFC51 y SFC52, as√≠ como AG_SEND/AG_LSEND y AG_RECV/
AG_LRECV. Los mensajes de error de estas instrucciones se transmiten sin modificar a
STATUS.
STATUS_FUNC
En este par√°metro se muestra como string de caracteres el nombre de la funci√≥n que ha
causado el error.
Status (Hex) Texto del evento

Soluci√≥n

A001

El bloque de datos de par√°metros es demasiado corto.

Corrija la longitud del DB de par√°metros.

A002

El par√°metro end_x es menor que el start_x.

Corrija los datos en start_x y end_x.

A003

Un DB en el que se deben mapear direcciones MODBUS es dema‚Äê
siado corto.
Longitud m√≠nima:
en registros:
(end_x - start_x + 1 ) * 2 + 2
- en valores de bit:
(end_x - start_x ) / 8 + 3
otras causas posibles:
‚Ä¢ S7 es cliente: par√°metros de llamada incorrectos
‚Ä¢ S7 es servidor: rango de direcciones incorrecto en el telegrama
de solicitud del cliente. El CP responde con un telegrama de ex‚Äê
cepci√≥n.

Ampl√≠e el DB.
S7 es cliente:
Corrija los par√°metros de petici√≥n
START_ ADDRESS o LENGTH.
S7 es servidor:
Cambie la solicitud del cliente.

A004

Solo S7 es cliente:
Se ha indicado una combinaci√≥n inadmisible de DATA_TYPE y
WRITE_READ.

Corrija los par√°metros de llamada. Solo
se pueden escribir los tipos de datos 1 y
3.

A005

S7 es cliente:
Se ha indicado un valor inadmisible en el par√°metro LENGTH.
S7 es servidor:
El n√∫mero de registros/bits en el telegrama de solicitud es inadmi‚Äê
sible. El CP responde con un telegrama de excepci√≥n.

S7 es cliente:
Corrija el par√°metro LENGTH.
S7 es servidor:
Modifique el n√∫mero en el telegrama de
solicitud.

Rangos de valores:

A006

Lectura de coils/inputs

De 1 a 2000

Escritura de coils

De 1 a 1968

Lectura del registro

De 1 a 125

Escritura de Holding Register

De 1 a 123

El √°rea indicada mediante DATA_TYPE, START_ADDRESS y
LENGTH no existe en data_type_1 hasta data_type_8.
S7 es servidor:
El CP responde con un telegrama de excepci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

S7 es cliente: Corrija la combinaci√≥n de
la parametrizaci√≥n DATA_TYPE,
START_ ADDRESS y LENGTH.
S7 es servidor: Modifique la solicitud del
cliente o corrija la parametrizaci√≥n en
data_type_x.

7303

Instrucciones
4.2 Instrucciones
Status (Hex) Texto del evento

Soluci√≥n

A007

S7 es cliente: Se ha parametrizado un tiempo de vigilancia no v√°lido
en MONITOR. Se debe introducir un valor >= 20 ms.

Corrija la parametrizaci√≥n.

A008

Dentro del tiempo de vigilancia parametrizado MONITOR el
AG_RECV activado no notifica ninguna recepci√≥n, p. ej., interlocu‚Äê
tor no listo.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

Verifique los ajustes y, dado el caso, los
mensajes de error del interlocutor. Veri‚Äê
fique si el interlocutor puede necesitar
un identificador UNIT determinado.

A009

S7 es cliente: El Transaction Identifier TI recibido es diferente del
enviado.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.

A00A

S7 es cliente: La UNIT recibida es diferente de la enviada.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

A00B

S7 es cliente: El c√≥digo de funci√≥n que se ha recibido es distinto del
enviado.
S7 es servidor: Se ha recibido un c√≥digo de funci√≥n no v√°lido. El CP
responde con un telegrama de excepci√≥n.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

S7 es cliente:
Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.
S7 es servidor:
Modifique la solicitud del cliente. La ins‚Äê
trucci√≥n MODBUSCP procesa los c√≥di‚Äê
gos de funci√≥n 1, 2, 3, 4, 5, 6, 15 y 16.

A00C

El n√∫mero de bytes recibido no se corresponde con el n√∫mero de
bits/de registros.
S7 es servidor: El CP env√≠a un telegrama de excepci√≥n.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.

A00D

Solo con S7 es cliente: La direcci√≥n de registro/bit o el n√∫mero de
registros/bits del telegrama de respuesta es diferente al del tele‚Äê
grama de solicitud.

A00E

La indicaci√≥n de longitud del encabezado de telegrama espec√≠fico Compruebe los datos del interlocutor
de Modbus no coincide con el n√∫mero de registros/bits o el n√∫mero con ayuda de un registro de telegramas.
de bytes indicados del telegrama. La instrucci√≥n rechaza los datos.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

A00F

Se ha recibido un Protocol Identifier distinto de 0.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

A010

En los par√°metros de db_1 a db_8 se ha asignado un n√∫mero de DB Corrija la parametrizaci√≥n en db_x.
por duplicado.

A011

En el par√°metro de entrada DATA_TYPE se ha indicado un valor
inadmisible (los valores admitidos son 1, 2, 3 y 4).

Corrija los par√°metros de llamada.

A012

Las √°reas parametrizadas data_type_1 y data_type_2 se solapan.

A013

Las √°reas parametrizadas data_type_1 y data_type_3 se solapan.

A014

Las √°reas parametrizadas data_type_1 y data_type_4 se solapan.

A015

Las √°reas parametrizadas data_type_1 y data_type_5 se solapan.

Corrija la parametrizaci√≥n.
Las √°reas de datos no deben disponer
de ning√∫n √°rea com√∫n de direcciones
de registro.

A016

Las √°reas parametrizadas data_type_1 y data_type_6 se solapan.

A017

Las √°reas parametrizadas data_type_1 y data_type_7 se solapan.

A018

Las √°reas parametrizadas data_type_1 y data_type_8 se solapan.

7304

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Status (Hex) Texto del evento

Soluci√≥n

A019

Uno de los par√°metros db_x se ha ajustado a 0, aunque el da‚Äê
ta_type_x pertinente est√° parametrizado con > 0. El n√∫mero de DB0
no se puede utilizar, ya que se reserva para el sistema.

Corrija la parametrizaci√≥n en db_x a > 0.
Si utiliza FB recopilador de datos, com‚Äê
pruebe la parametrizaci√≥n en CFC.

A01A

Longitud incorrecta en el encabezado: Est√°n permitidos de 3 a 253
bytes.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.

A01B

S7 es servidor y c√≥digo de funci√≥n 5:
Se ha recibido un estado no v√°lido para Coil.
Se env√≠a un telegrama de excepci√≥n.

A01E

Se han recibido datos no v√°lidos que no pueden ser asignados.
Todas las conexiones a trav√©s del puerto 502 se interrumpen y se
establecen de nuevo.

A01F

La instrucci√≥n MODBUSCP est√° en un estado operativo no permi‚Äê P√≥ngase en contacto con el Product
tido.
Support.

A023

Las √°reas parametrizadas data_type_2 y data_type_3 se solapan.

A024

Las √°reas parametrizadas data_type_2 y data_type_4 se solapan.

A025

Las √°reas parametrizadas data_type_2 y data_type_5 se solapan.

A026

Las √°reas parametrizadas data_type_2 y data_type_6 se solapan.

A027

Las √°reas parametrizadas data_type_2 y data_type_7 se solapan.

A028

Las √°reas parametrizadas data_type_2 y data_type_8 se solapan.

A034

Las √°reas parametrizadas data_type_3 y data_type_4 se solapan.

A035

Las √°reas parametrizadas data_type_3 y data_type_5 se solapan.

A036

Las √°reas parametrizadas data_type_3 y data_type_6 se solapan.

A037

Las √°reas parametrizadas data_type_3 y data_type_7 se solapan.

A038

Las √°reas parametrizadas data_type_3 y data_type_8 se solapan.

A045

Las √°reas parametrizadas data_type_4 y data_type_5 se solapan.

A046

Las √°reas parametrizadas data_type_4 y data_type_6 se solapan.

A047

Las √°reas parametrizadas data_type_4 y data_type_7 se solapan.

A048

Las √°reas parametrizadas data_type_4 y data_type_8 se solapan.

A056

Las √°reas parametrizadas data_type_5 y data_type_6 se solapan.

A057

Las √°reas parametrizadas data_type_5 y data_type_7 se solapan.

A058

Las √°reas parametrizadas data_type_5 y data_type_8 se solapan.

A067

Las √°reas parametrizadas data_type_6 y data_type_7 se solapan.

A068

Las √°reas parametrizadas data_type_6 y data_type_8 se solapan.

A078

Las √°reas parametrizadas data_type_7 y data_type_8 se solapan.

A079

La ID de conexi√≥n indicada en el par√°metro id no se encuentra en
el DB de par√°metros.

A07A

Se ha indicado un valor inadmisible en el par√°metro id (rango de
valores de 1 a 64).

A07B

La ID indicada est√° duplicada en el DB de par√°metros.

A07C

En el par√°metro data_type_x se ha indicado un valor inadmisible
(los valores admitidos van de 0 a 4).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Controle el mensaje de error del interlo‚Äê
cutor. Dado el caso, compruebe los da‚Äê
tos con un registro de telegramas.

Corrija la parametrizaci√≥n.
Las √°reas de datos no deben disponer
de ning√∫n √°rea com√∫n de direcciones
de registro.

Corrija la parametrizaci√≥n en la entrada
id.

Corrija la parametrizaci√≥n en el DB de
par√°metros.

7305

Instrucciones
4.2 Instrucciones
Status (Hex) Texto del evento

Soluci√≥n

A07D

El par√°metro data_type_1 no contiene ninguna entrada. El √°rea de
par√°metros "_1" es el √°rea inicial y se debe parametrizar.

Corrija la parametrizaci√≥n en el DB de
par√°metros.

A07E

En db_x se ha indicado el n√∫mero del DB de instancia de la ins‚Äê
trucci√≥n MODBUSCP.

A080

En el OB100 y en el OB c√≠clico, para la instrucci√≥n MODBUS se han
empleado varios DB de instancia.

A081

Compruebe los datos del interlocutor
Solo con S7 es cliente y c√≥digo de funci√≥n 5:
Los datos del telegrama de respuesta no son el eco de la solicitud. con ayuda de un registro de telegramas.

A082

Solo con S7 es cliente y c√≥digo de funci√≥n 6:
El valor de registro recibido es distinto del enviado.

A083

S7 es cliente: se ha lanzado una petici√≥n mientras la petici√≥n ante‚Äê No lance una nueva petici√≥n hasta que
rior a√∫n estaba en curso. No se ejecuta la petici√≥n.
la petici√≥n anterior haya finalizado con
DONE_ NDR = TRUE o ERROR =
TRUE.

A085

Debido a un acceso de escritura no permitido ha aparecido un error
interno durante la comprobaci√≥n de la licencia.

Compruebe si en el programa S7 hay
alg√∫n acceso de escritura no permitido
al DB de licencia. No est√° permitido mo‚Äê
dificar la estructura de REG_KEY. Dir√≠‚Äê
jase al Product Support si es necesario.

A086

Se ha intentado escribir en un bloque de datos protegido contra
escritura.

Quite la protecci√≥n contra escritura o
utilice otro DB.

A090

La instrucci√≥n MODBUSCP a√∫n no tiene licencia para esta CPU.
Esta es una informaci√≥n de estado. El bit ERROR no est√° activado.
La comunicaci√≥n MODBUS tambi√©n funciona sin licencia.

Consulte el c√≥digo de identificaci√≥n pa‚Äê
ra esta CPU en la salida IDENT_CODE
y solicite con √©l el c√≥digo de validaci√≥n.
Consulte el cap√≠tulo "Concesi√≥n de li‚Äê
cencia (P√°gina 7297)".

A091

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‚Äê El interlocutor no soporta la funci√≥n so‚Äê
ma de excepci√≥n con c√≥digo de excepci√≥n 1.
licitada.

A092

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‚Äê Corrija LENGTH o START_ADDRESS
en la llamada de FB.
ma de excepci√≥n con c√≥digo de excepci√≥n 2.
Se ha producido un acceso a una direcci√≥n inexistente/no admitida
en el interlocutor.

A093

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‚Äê El interlocutor no puede procesar el te‚Äê
ma de excepci√≥n con c√≥digo de excepci√≥n 3.
legrama recibido (p. ej., no soporta la
longitud solicitada).

A094

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‚Äê El interlocutor se encuentra en un esta‚Äê
ma de excepci√≥n con c√≥digo de excepci√≥n 4.
do en que no es capaz de procesar el
telegrama recibido.

A095

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‚Äê Compruebe los mensajes de error del
ma de excepci√≥n con c√≥digo de excepci√≥n desconocido.
interlocutor y, dado el caso, verifique los
datos con un registro de telegramas.

El bloque MODBUS debe llamarse en el
OB de arranque y en OB c√≠clico con el
mismo DB de instancia.

Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.

Consulte tambi√©n
Descripci√≥n MODBUSCP (P√°gina 7292)

7306

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros DATA_TYPE, START_ADDRESS, LENGTH, WRITE_READ y UNIT
Descripci√≥n
En el modo de operaci√≥n "S7 es cliente" se trata de par√°metros de entrada, mientras que en
el modo de operaci√≥n "S7 es servidor" son par√°metros de salida.
DATA_TYPE
El par√°metro DATA_TYPE indica qu√© tipo de datos Modbus/TCP se procesa con el telegrama
actual. Se admiten los valores siguientes:
Coils
Inputs
Holding Register
Input Register

B#16#1
B#16#2
B#16#3
B#16#4

Los distintos tipos de datos mantienen una relaci√≥n directa con los c√≥digos de funci√≥n
utilizados.
Tipo de datos

DATA_TYPE

Funci√≥n

Longitud

single_write

C√≥digo de fun‚Äê
ci√≥n

Coils

1

leer

cualquiera

irrelevante

1

Coils

1

escribir

1

TRUE

5

Coils

1

escribir

1

FALSE

15

Coils

1

escribir

>1

irrelevante

15

Inputs

2

leer

cualquiera

irrelevante

2

Holding Register

3

leer

cualquiera

irrelevante

3

Holding Register

3

escribir

1

TRUE

6

Holding Register

3

escribir

1

FALSE

16

Holding Register

3

escribir

>1

irrelevante

16

Input Register

4

leer

cualquiera

irrelevante

4

START_ADDRESS
El par√°metro START_ADDRESS determina la primera direcci√≥n Modbus/TCP que se lee o se
escribe.
LENGTH
El par√°metro LENGTH determina el n√∫mero de valores Modbus/TCP que se leen o se escriben.
En las funciones de lectura, para Holding e Input Register es posible un m√°ximo de 125
registros por telegrama. Para Coils e Inputs es posible un m√°ximo de 2000 bits. En las
funciones de escritura, para Holding Register el n√∫mero m√°ximo es de 123 registros y para
Coils, de 1968 bits. Los registros o valores de bit procesados con un telegrama de solicitud
deben encontrarse dentro de un DB.
WRITE_READ
Este par√°metro define si se debe ejecutar una funci√≥n de lectura o escritura. Si la entrada/
salida tiene el valor FALSE, se trata de una funci√≥n de lectura. El valor TRUE define una
funci√≥n de escritura.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7307

Instrucciones
4.2 Instrucciones
Solo se pueden escribir Holding Register y Coils. Input Register e Inputs √∫nicamente se
pueden leer.
UNIT
En la funci√≥n "S7 es cliente" el par√°metro UNIT es un par√°metro de entrada. Esta entrada se
debe ajustar de acuerdo con los requisitos. La instrucci√≥n aplica este valor al telegrama de
solicitud y lo verifica al recibir la respuesta.
El par√°metro UNIT se utiliza t√≠picamente en convertidores de protocolo para direccionar
esclavos serie que se esconden detr√°s de una direcci√≥n IP com√∫n.
La mayor√≠a de dispositivos pueden responder a UNIT = 1.
En la funci√≥n "S7 es servidor" el par√°metro UNIT es un par√°metro de salida. La instrucci√≥n
aplica este valor deel telegrama de solicitud a la respuesta. La salida se activa cuando la
petici√≥n finaliza con un valor recibido.

Consulte tambi√©n
Descripci√≥n MODBUSCP (P√°gina 7292)

Par√°metros ENQ_ENR y MONITOR
Descripci√≥n
ENQ_ENR
Modo de operaci√≥n "S7 es cliente":
Con un flanco positivo se inicia la transferencia de datos. Con los valores de los par√°metros de
entrada DATA_TYPE,START_ADDRESS, LENGTH, WRITE_READ y UNIT se genera el
telegrama de solicitud. Puede enviarse una nueva petici√≥n si la anterior ha finalizado con
DONE_NDR o ERROR.
Modo de operaci√≥n "S7 es servidor":
Con un nivel positivo en la entrada se activa la instrucci√≥n. Pueden recibirse telegramas del
cliente.
En caso de una entrada ENQ_ENR no activada y una conexi√≥n establecida, se rechazar√°n los
datos recibidos.
MONITOR
El tiempo de vigilancia MONITOR vigila la entrada de datos del interlocutor. El tiempo de
vigilancia se indica en el formato de hora T#... Se recomienda un tiempo de vigilancia de aprox.
1,5 s.
En el modo de operaci√≥n "S7 es cliente", con el tiempo MONITOR el servidor vigila la entrada
de la totalidad del telegrama de respuesta. En caso de sobrepasar el tiempo de vigilancia, la
petici√≥n activada finalizar√° con error. El tiempo comienza despu√©s de finalizar la transmisi√≥n
del telegrama de solicitud y termina despu√©s de recibir los datos completamente.
En el modo de operaci√≥n "S7 es servidor", con el tiempo MONITOR se vigila la entrada de la
segunda parte del telegrama. Si se rebasa el tiempo de vigilancia, se notifica un error. El tiempo
comienza despu√©s de recibir el encabezado del telegrama Modbus/TCP espec√≠fico y termina
despu√©s de finalizar la recepci√≥n del telegrama de solicitud.

7308

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Descripci√≥n MODBUSCP (P√°gina 7292)

CPs SIMATIC NET
Industrial Ethernet
Introducci√≥n de Ethernet
Indicaciones generales
Instrucciones disponibles
La lista siguiente muestra los n√∫meros de los bloques de programa (instrucciones) tal y como
se suministran. Los n√∫meros pueden ser modificados por el usuario.
Tenga en cuenta que se tienen que utilizar instrucciones diferentes para S7-300 y S7-400
(bibliotecas separadas).
Servicio de comunicaci√≥n / √°rea de fun‚Äê
ciones

Tipo de instrucciones

Biblioteca
CP 300

CP 400
x

SEND / RECEIVE

AG_SEND

x

(Servicios de comunicaci√≥n abiertos)

AG_RECV

x

AG_LSEND

x

x

2)

x

AG_LRECV

x

2)

x

AG_LOCK

x

x

AG_UNLOCK

x

x

AG_CNTEX

x

x 3)

AG_CNTRL

x

x 3)

Conexiones de comunicaci√≥n programa‚Äê
das

IP_CONFIG

x

x

Comunicaci√≥n S7

BSEND

x

BRCV

x

PUT

x

GET

x

USEND

x

URCV

x

C_CNTRL

x

FTP_CMD

x

FTP

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

x

7309

Instrucciones
4.2 Instrucciones
Servicio de comunicaci√≥n / √°rea de fun‚Äê
ciones

Tipo de instrucciones

Biblioteca
CP 300

PROFINET IO

PNIO_SEND

x

PNIO_RECV

x

PNIO_RW_REC

x

PNIO_ALARM

x

CP 400

1) El PN_InOut / PN_InOut_Fast se entrega conjuntamente con la herramienta de ingenier√≠a SIMATIC iMap.
2) No debe utilizarse para CPs actuales y ya no forma parte de la entrega de la biblioteca actual SIMATIC_NET_CP
3) Depende del tipo de CP

¬øQu√© versi√≥n de instrucciones se debe utilizar?
Las descripciones siguientes contienen tambi√©n referencias a comportamientos discrepantes
en caso de versiones de instrucciones diferentes. Preste tambi√©n atenci√≥n a la identificaci√≥n
de versi√≥n de las instrucciones utilizadas por usted.
Encontrar√° una edici√≥n actual del historial de la versi√≥n para las instrucciones SIMATIC NET
bajo la siguiente ID de art√≠culo:
9836605 (http://support.automation.siemens.com/WW/view/de/9836605)
Las bibliotecas globales instaladas con el Automation Workbench contienen las versiones de
instrucciones actuales del momento de la habilitaci√≥n del Workbench.
Nota
Se recomienda utilizar siempre las versiones de instrucciones actuales para todos los tipos de
m√≥dulos.
Encontrar√° informaciones sobre las versiones de instrucciones actuales as√≠ como las
instrucciones actuales en nuestro Customer Support en Internet, desde donde las podr√°
descargar:
http://support.automation.siemens.com/WW/view/de/8797900
En el caso de tipos de m√≥dulos menos recientes, esta recomendaci√≥n presupone que usted
utilice la versi√≥n de firmware actual para este tipo de m√≥dulo.

7310

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Instrucciones en caso de repuesto
Se entiende por caso de sustituci√≥n en este contexto la sustituci√≥n de un m√≥dulo por otro
m√≥dulo de versi√≥n eventualmente m√°s moderna.
Nota
Tenga en cuenta que, en el caso de utilizar recambios, en el programa de usuario se deben
utilizar solo las instrucciones autorizadas para el tipo de CP configurado.
Se recomienda utilizar siempre las versiones de instrucciones actuales para todos los tipos de
m√≥dulos. En el caso de tipos de m√≥dulos menos recientes, esta recomendaci√≥n presupone
que usted utilice la versi√≥n de firmware actual para este tipo de m√≥dulo.
M√°s informaci√≥n acerca de casos de sustituci√≥n, encontrar√° en nuestro Customer Support en
Internet.
Los manuales de producto espec√≠ficos de los CPs S7 informan sobre la compatibilidad de los
CPs S7 y las instrucciones correspondientes.

Consulte tambi√©n
Manual de programaci√≥n "Funciones (FC) y bloques de funci√≥n (FB) para CPs SIMATIC NET
S7" (http://support.automation.siemens.com/ww/view/de/30564821)

Parametrizaci√≥n de la llamada de las instrucciones
Antes de pasar a describir en detalle las instrucciones, se ofrecen aqu√≠ algunas informaciones
de √≠ndole general sobre la llamada y la parametrizaci√≥n de las instrucciones.
Aqu√≠ se pueden dar informaciones generales sobre los siguientes grupos de par√°metros,
existentes en todas las instrucciones:
‚óè Par√°metros para coordinaci√≥n de CP y enlaces (par√°metros de entrada)
‚óè Par√°metros para definir una determinada √°rea de datos de la CPU (par√°metros de entrada)
‚óè Informaciones sobre estado/status (par√°metros de salida)

Llamar instrucciones de comunicaci√≥n para S7-300
ATENCI√ìN
No se permite llamar las instrucciones de comunicaci√≥n para S7-300 en varios niveles de
proceso. Si, por ejemplo, llama una instrucci√≥n de comunicaci√≥n en OB1 y en OB35, el
procesamiento de la instrucci√≥n podr√≠a ser interrumpido por el OB de prioridad
respectivamente superior.
Si llama instrucciones en varios OBs, tiene que procurar, a trav√©s de la programaci√≥n, que
una instrucci√≥n de comunicaci√≥n en procesamiento no sea interrumpida por otra instrucci√≥n
de comunicaci√≥n (por ejemplo, por medio de las instrucciones del sistema Bloquear/Liberar
alarmas).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7311

Instrucciones
4.2 Instrucciones

Par√°metros para definir una determinada √°rea de datos de la CPU (par√°metros de entrada)
Indicar el √°rea de datos en la CPU
Al llamar una instrucci√≥n transmite usted la direcci√≥n y la longitud del √°rea de datos de la CPU
en la que se deben disponer o almacenar datos √∫tiles o bien que puede contener otras
informaciones relativas a la parametrizaci√≥n.
Para el direccionamiento de esta √°rea se utiliza el tipo de datos del puntero ANY.

Informaciones sobre estado/status (par√°metros de salida)
Evaluar indicaciones de estados
Para la evaluaci√≥n del estado se tienen que evaluar estos par√°metros en el programa de
usuario:
‚óè DONE o NDR
Estos par√°metros (DONE en el caso de peticiones de env√≠o o NDR para peticiones de
recepci√≥n) notifica la conclusi√≥n (con resultado positivo) de una ejecuci√≥n de la petici√≥n.
‚óè ERROR
Notifica que la petici√≥n no se ha podido ejecutar sin errores.
‚óè STATUS
El par√°metro proporciona informaci√≥n detallada sobre la ejecuci√≥n de la petici√≥n. Se
pueden proporcionar indicaciones de estado ya durante la ejecuci√≥n de la petici√≥n
(DONE=0 y ERROR=0).
Nota
Tenga en cuenta que las indicaciones de estado DONE, NDR, ERROR y STATUS se
actualizan con cada llamada de una instrucci√≥n.

Indicaciones de estado al arrancar el CP
Al rearrancar el CP Ethernet, los par√°metros de salida de la instrucci√≥n se resetean como
sigue:
‚óè DONE = 0
‚óè NDR = 0
‚óè ERROR = 0
‚óè STATUS =
‚Äì 8180H en el caso de AG_RECV / AG_LRECV
‚Äì 8181H en el caso de AG_SEND / AG_LSEND / AG_SSEND

7312

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Instrucciones para los Servicios de comunicaci√≥n abiertos (interfaz SEND/RECEIVE)
Instrucciones para la interfaz SEND/RECEIVE
Panor√°mica
En la interfaz SEND/RECEIVE est√°n disponibles las siguientes instrucciones para la
transmisi√≥n de datos:
Instrucci√≥n

utilizable para 1)

S7-300

S7-400

AG_SEND

x

AG_RECV

x

x

Significado
para enviar datos

x

para recibir datos

AG_LSEND

x

para enviar datos

AG_LRECV

x

para recibir datos

AG_SSEND

x

para enviar datos

AG_SRECV

x

para recibir datos

1) Observaciones sobre las instrucciones para S7-300 y S7-400
‚óè para S7-300 rige:
‚Äì En las versiones actuales de los CPs Ethernet se utilizan exclusivamente AG_SEND y
AG_RECV; la longitud de datos puede ser aqu√≠ de hasta 8192 bytes.
‚Äì En CP S7‚Äì300 (hasta 6GK7 343‚Äì1EX10‚Äì0XE0 con firmware V2.2), se deber√° utilizar
AG_LRECV para conexiones TCP en lugar de AG_RECV.
‚óè para S7-400 rige:
‚Äì En el caso de AG_SEND / AG_RECV, la longitud de datos por petici√≥n est√° limitada a
<=240 bytes.
Los registros m√°s largos (hasta 8192 bytes) se pueden transmitir con la ayuda de las
instrucciones AG_LSEND o AG_LRECV.
‚Äì AG_SSEND y AG_SRECV sirven para la transmisi√≥n acelerada de datos, utilizando una
comunicaci√≥n optimizada entre la CPU y el CP en la estaci√≥n S7. La comunicaci√≥n
r√°pida no tiene repercusiones en la comunicaci√≥n LAN. Las dos instrucciones son
soportadas a partir de STEP 7 V5.4 SP3.
‚Äì En S7‚Äì400 no se puede utilizar AG_RECV para conexiones TCP, sino solo las
instrucciones AG_LRECV o AG_SRECV.

Informaciones adicionales
Inf√≥rmese sobre al √°rea de datos a la que se da soporte para el CP S7 utilizado por usted en
el manual espec√≠fico. Encontrar√° una tabla general de las versiones de instrucciones en el
historial de bloques SIMATIC NET.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7313

Instrucciones
4.2 Instrucciones

Uso
El esquema siguiente explica la aplicaci√≥n de las instrucciones aqu√≠ descritos para la
transferencia de datos bidireccional a trav√©s de una conexi√≥n configurada.
&38

(WKHUQHW&3

(WKHUQHW&3

&38

3URJUDPDGH
XVXDULR
67(3

3URJUDPDGH
XVXDULR
67(3

&DPSRVGHGDWRV
GHXVXDULR

&DPSRVGHGDWRV
GHXVXDULR

$*B6(1'

HQYLDU

UHFLELU

$*B5(&9

HQYLDU

$*B6(1'

(QODFH
$*B5(&9

UHFLELU

Indicar el √°rea de datos en la CPU
Al llamar una instrucci√≥n se transfiere la direcci√≥n y la longitud del √°rea de datos a la CPU.
Tenga en cuenta que la longitud m√°xima del √°rea de datos depende del tipo y de la versi√≥n de
instrucci√≥n utilizados.
‚óè AG_SEND y AG_RECV
Con estas instrucciones se pueden enviar o recibir, hasta la versi√≥n V3.0, 240 bytes como
m√°ximo. Las versiones actuales permiten para S7-300 un √°rea de datos de hasta 8192
bytes. En el caso de S7-400 se tienen que seguir utilizando AG_LSEND / AG_LRECV para
la transmisi√≥n de √°reas de datos mayores.
‚óè AG_LSEND / AG_LRECV
En el caso de los CPs de S7-400, as√≠ como en el de versiones anteriores de S7-300 solo
es posible transmitir √°reas de datos mayores por medio de AG_LSEND o AG_LRECV.
Consulte en la informaci√≥n de producto correspondiente al CP el √°rea de datos a que se da
soporte.
‚óè AG_SSEND / AG_SRECV
Con CPs de S7‚àí400, que soportan la comunicaci√≥n PROFINET junto con CPUs a partir de
la versi√≥n 5.1, los datos se pueden transmitir por medio de AG_SSEND o AG_SRECV con
una velocidad de transmisi√≥n superior (esto no es v√°lido para el CP 443‚àí1 Advanced
6GK7 443‚Äì1EX41‚Äì0XE0).
Los tipos de CPs compatibles con CPUs a partir de la versi√≥n 5.1 se pueden consultar en
el manual de producto del CP (cap√≠tulo "Condiciones para el uso").
La tabla siguiente indica los l√≠mites v√°lidos para los diferentes tipos de conexi√≥n.

7314

INSTRUCCI√ìN

ISO-Transport

ISO-on-TCP

TCP

UDP

AG_LSEND (S7-400)
AG_SEND (S7-300)

8192 bytes

8192 bytes

8192 bytes

2048 bytes

AG_SEND (S7-400)

240 bytes

240 bytes

240 bytes

240 bytes

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
INSTRUCCI√ìN

ISO-Transport

ISO-on-TCP

TCP

UDP

AG_LRECV (S7-400)
AG_RECV (S7-300)

8192 bytes

8192 bytes

8192 bytes

2048 bytes

AG_RECV (S7-400)

240 bytes

240 bytes

240 bytes

240 bytes

AG_SSEND (S7-400)
AG_SRECV (S7-400)

1452 bytes

1452 bytes

1452 bytes

1452 bytes

Nota
En cuanto a la longitud del √°rea de datos transmitible en el caso de versiones menos recientes
de los CPs Ethernet, tenga en cuenta lo dicho en la informaci√≥n de producto / el manual de
producto del CP Ethernet utilizado.

Aplicaci√≥n sin encabezado de petici√≥n
En el caso de una conexi√≥n especificada, los par√°metros de direcci√≥n y petici√≥n son definidos
por la configuraci√≥n de la conexi√≥n. Por lo tanto, el programa de usuario solo proporciona los
datos de usuario en el √°rea de datos UDP al enviar con AG_SEND / AG_LSEND / AG_SSEND,
o los recibe con AG_RECV / AG_LRECV / AG_SRECV.

Aplicaci√≥n con encabezado de petici√≥n
Las conexiones UDP libres exigen un encabezado de petici√≥n en el √°rea de datos de usuario.
Vea en la ilustraci√≥n siguiente la estructura del b√∫fer de peticiones y el significado y el
emplazamiento (high byte / low byte) de los par√°metros en el encabezado de la petici√≥n.
&DPSRGHGDWRVGHXVXDULR
3RUW
%¬ºIHUGHSHWLFLRQHV

'LUHFFL¬µQ,3

&DEHFHUDGH
SHWLFL¬µQ

 + +LJK%\WH 

(% + /RZ%\WH 

%\WH

(+

% +

%\WH

 +

 +

%\WH

%\WHGDWRV

%\WHGDWRV

%\WH

%\WHGDWRV

%\WHGDWRV

'DWRV¬ºWLOHV

Figura 4-73

%\WH

Enviar y recibir a trav√©s de una conexi√≥n UDP libre por programa

‚óè En la figura (entradas hexadecimal) se parte, a modo de ejemplo, de la siguiente direcci√≥n
IP: 142.11.40.35;
‚óè Para la direcci√≥n de puerto 1003 se tiene que introducir, por ejemplo: para byte High: 03H;
para byte Low: EBH.
‚óè El √°rea de datos de usuario puede tener hasta 2048 bytes. Pueden transmitirse hasta 2042
bytes de datos de usuario. 6 bytes est√°n reservados para el encabezado de la petici√≥n.
Tenga en cuenta que la longitud de datos indicada al llamar la instrucci√≥n (par√°metro LEN)
ha de contener el encabezado y los datos de usuario.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7315

Instrucciones
4.2 Instrucciones

No modificar los par√°metros de llamada hasta despu√©s de la confirmaci√≥n de la petici√≥n
Nota
Los par√°metros de llamada en la interfaz de llamada de las instrucciones AG_SEND o
AG_RECV no se pueden modificar, tras la activaci√≥n de la llamada, hasta despu√©s de que la
instrucci√≥n haya confirmado la ejecuci√≥n de la petici√≥n con DONE=1 o con ERROR=1.
Si no se tiene en cuenta esto, puede suceder que se cancele con error la ejecuci√≥n de la
petici√≥n.

Indicador de estado en la interfaz de llamada de la instrucci√≥n; particularidades de AG_SEND /
AG_RECV (S7-300)
El comportamiento siguiente solo es aplicable a S7-300 con bloques de programa a partir de
la versi√≥n V4.0.
En el caso de AG_SEND y AG_RECV obtendr√° las indicaciones citadas a continuaci√≥n en los
siguientes casos operativos:
‚óè El CP se encuentra en STOP.
‚óè La conexi√≥n no est√° configurada.
‚óè La conexi√≥n no est√° establecida.
‚óè La conexi√≥n est√° cancelada.
Indicaciones:
‚óè AG_SEND:
DONE=0; ERROR=1; Status=8183H
‚óè AG_RECV:
DONE=0; ERROR=0; Status=8180H
o
DONE=0; ERROR=1; Status=8183H

Consulte tambi√©n
Indicaciones generales (P√°gina 7309)

AG_SEND / AG_LSEND / AG_SSEND
AG_SEND / AG_LSEND / AG_SSEND (Ind.Ethernet)
Descripci√≥n
AG_SEND / AG_LSEND / AG_SSEND transfieren datos al CP Ethernet para su transmisi√≥n a
trav√©s de una conexi√≥n configurada.
El √°rea de datos indicada puede ser un √°rea de marcas o un √°rea de bloques de datos.

7316

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Si ha sido posible enviar a trav√©s de Ethernet todo el √°rea de datos de usuario, esto se se√±aliza
para notificar la ejecuci√≥n correcta.
Observaci√≥n:
Todos los datos siguientes son igualmente v√°lidos para AG_SEND, AG_LSEND y
AG_SSEND, a no ser que se indique lo contrario.

Llamada
Interfaz de llamada en representaci√≥n FUP
$*B6(1'$*B/6(1'$*B66(1'
%22/

$&7

,17

'21(

%22/

,'

(5525

%22/

:25'

/$''5

67$786

:25'

$1<

6(1'

,17

/(1

Nota
Si desea utilizar la instrucci√≥n AG_SSEND, al configurar las conexiones tendr√° que
seleccionar en las propiedades de la conexi√≥n el modo "SPEED SEND/RECV".

Consulte tambi√©n
Par√°metros en el caso de AG_SEND / AG_LSEND / AG_SSEND (IE) (P√°gina 7318)
Par√°metros DONE, ERROR, STATUS (P√°gina 7319)
AG_SEND / AG_LSEND (PROFIBUS) (P√°gina 7462)
Manual de programaci√≥n "Funciones (FC) y bloques de funci√≥n (FB) para CPs SIMATIC NET
S7" (http://support.automation.siemens.com/ww/view/de/30564821)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7317

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de AG_SEND / AG_LSEND / AG_SSEND (IE)
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica los par√°metros formales para las instrucciones
AG_SEND / AG_LSEND / AG_SSEND:
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ACT

INPUT

BOOL

0,1

En el caso de una llamada de la instrucci√≥n con ACT = 1
se env√≠an LEN Bytes del √°rea de datos indicada con el
par√°metro SEND.
En el caso de una llamada de la instrucci√≥n con ACT = 0
se actualizan las indicaciones de estado DONE, ERROR
y STATUS.

ID

INPUT

INT

1,2...64
(S7-400)

En el par√°metro ID se indica el n√∫mero de la conexi√≥n.

1,2...16
(S7-300)
LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7 aparece la direcci√≥n ini‚Äê
cial del m√≥dulo en la tabla de configuraci√≥n. Indique aqu√≠
esta direcci√≥n.

SEND

INPUT

ANY

Indicar la direcci√≥n y la longitud
La direcci√≥n del √°rea de datos remite como alternativa a:
‚óè √Årea de marcas
‚óè √Årea de bloques de datos

LEN

INPUT

INT

en caso de ISO-Trans‚Äê Cantidad de bytes que se deben enviar junto con la pe‚Äê
tici√≥n desde el √°rea de datos. Este n√∫mero puede estar
port e ISO-on-TCP /
comprendido entre 1 y "dato de longitud en par√°metro
TCP:
SEND".
1,2,...8192 (o hasta

"dato de longitud en pa‚Äê ‚óè Considerar el tipo de instrucciones:
r√°metro SEND")
‚Äì para S7-300
Con las versiones actuales de AG_SEND se
en UDP:
pueden transmitir hasta 8192 bytes (2048 bytes
con UDP).
1,2,...2048 (o hasta
"dato de longitud en pa‚Äê
‚Äì para S7-400
r√°metro SEND")
Con AG_SEND, el √°rea de datos generalmente
est√° limitada a 240 bytes, como m√°ximo.

En S7-400 considerar:
‚óè Rendimiento incrementado en caso de registros
cortos:
la transmisi√≥n de registros de hasta 240 bytes tiene
lugar con un rendimiento incrementado. Esto es
v√°lido con independencia del tipo utilizado
(AG_SEND / AG_LSEND).
‚óè Con AG_SSEND, el √°rea de datos est√° limitado a
como m√°ximo 1452 bytes.

7318

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

DONE

OUTPUT

BOOL

0: Petici√≥n en curso
1: Petici√≥n ejecutada

El par√°metro de estado indica si la petici√≥n se ha ejecu‚Äê
tado sin errores.
Mientras DONE = 0, no se puede impulsar ninguna otra
petici√≥n. En caso de aceptarse la petici√≥n, el CP pone
DONE a 0.

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicador de error

STATUS

OUTPUT

WORD

Consulte el significado en relaci√≥n con los par√°metros
DONE y STATUS en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7319)
Indicador de estado
Consulte el significado en relaci√≥n con los par√°metros
DONE y ERROR en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7319)

Consulte tambi√©n
AG_SEND / AG_LSEND / AG_SSEND (Ind.Ethernet) (P√°gina 7316)

Par√°metros DONE, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

Tabla 4-414 C√≥digos de condici√≥n AG_SEND / AG_LSEND / AG_SSEND
DONE

ERROR

STATUS

Significado

1

0

0000H

Petici√≥n terminada sin errores.

0

0

0000H

Ninguna petici√≥n en proceso.

0

0

8181H

Petici√≥n en curso.

0

1

7000H

Este c√≥digo es solo posible en S7-400: La instrucci√≥n se ha llamado con ACT=0; pero la
petici√≥n no se procesa.

0

1

8183H

Falta la configuraci√≥n o el servicio ISO/TCP en el CP Ethernet no ha sido a√∫n arrancado.

0

1

8184H

‚óè Se ha indicado un tipo de datos no permitido para el par√°metro SEND.
‚óè Error del sistema (el √°rea de datos fuente tiene errores).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7319

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8185H

Par√°metro LEN mayor que el √°rea fuente SEND.

0

1

8186H

Par√°metro ID no v√°lido.
‚óè ID != 1,2....16 (S7-300)
‚óè ID != 1,2....64.(S7-400)

0

1

8302H

No hay recursos de recepci√≥n en la estaci√≥n de destino. La estaci√≥n receptora no puede
procesar con suficiente rapidez los datos recibidos o no ofrece recursos de recepci√≥n.

0

1

8304H

La conexi√≥n no est√° establecida. La petici√≥n de emisi√≥n solo se deber√≠a emitir de nuevo
tras un tiempo de espera > 100 ms.

0

1

8311H

Estaci√≥n de destino no accesible bajo la direcci√≥n Ethernet indicada.

0

1

8312H

Error Ethernet en el CP.

0

1

8F22H

√Årea de origen no valida, p. ej.:
√Årea no existente en DB
Par√°metro LEN < 0

0

1

8F24H

Error de √°rea al leer un par√°metro.

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

N√∫mero de DB err√≥neo

0

1

8F3AH

√Årea de destino no cargada (DB).

0

1

8F42H

Retardo en acuse al leer un par√°metro del
√°rea de periferia.

0

1

8F44H

Est√° bloqueado el acceso a un par√°metro a leer en el procesamiento de la instrucci√≥n.

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible

0

1

8090H

p. ej., par√°metro LEN = 0 .
‚óè No existe m√≥dulo con esta direcci√≥n inicial de m√≥dulo;
‚óè La instrucci√≥n utilizada no es acorde con la familia de sistemas utilizada (se tienen
que utilizar instrucciones diferentes para S7-300 y S7-400).
0

1

8091H

La direcci√≥n base l√≥gica no est√° en formato de palabra doble.

0

1

8092H

En la referencia ANY se ha indicado un tipo distinto de BYTE.
(solo para S7-400)

0

1

80A4H

La conexi√≥n de bus K entre CPU y CP no est√° establecida.
(en CPUs con versiones m√°s actuales)

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

Longitud (en par√°metro LEN) err√≥nea.

0

1

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida.

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Recursos ocupados (memoria) temporalmente en la CPU.

0

1

80C4H

Error de comunicaci√≥n
se presenta temporalmente; por ello es conveniente una repetici√≥n en el programa de
usuario

0

7320

1

80D2H

Direcci√≥n inicial del m√≥dulo err√≥nea.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
AG_SEND / AG_LSEND / AG_SSEND (Ind.Ethernet) (P√°gina 7316)

AG_RECV / AG_LRECV / AG_SRECV
AG_RECV / AG_LRECV / AG_SRECV (Ind.Ethernet)
Descripci√≥n
La instrucci√≥n AG_RECV / AG_LRECV / AG_SRECV importa del CP Ethernet los datos
transmitidos a trav√©s de una conexi√≥n configurada.
El √°rea de datos indicada para la toma de datos puede ser un √°rea de marcas o un √°rea de
bloques de datos.
Se se√±ala que la funci√≥n ha sido ejecutada sin errores cuando se hayan podido recibir los
datos del CP Ethernet.
Observaci√≥n:
Todos los datos siguientes son igualmente v√°lidos para AG_RECV y AG_LRECV /
AG_SRECV, a no ser que se indique lo contrario.

Llamada
Interfaz de llamada en representaci√≥n FUP
$*B5(&9$*B/5(&9$*B65(&9
1'5

%22/

,17

,'

(5525

%22/

:25'

/$''5

67$786

:25'

$1<

5(&9

/(1

,17

Nota
Si desea utilizar la instrucci√≥n AG_SRECV, al configurar las conexiones tendr√° que
seleccionar en las propiedades de la conexi√≥n el modo "SPEED SEND/RECV".

Consulte tambi√©n
AG_RECV / AG_LRECV (PROFIBUS) (P√°gina 7469)
Par√°metros en el caso de AG_RECV / AG_LRECV / AG_SRECV (IE) (P√°gina 7322)
Par√°metros DONE, ERROR, STATUS (IE) (P√°gina 7323)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7321

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de AG_RECV / AG_LRECV / AG_SRECV (IE)
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica los par√°metros formales para las instrucciones
AG_RECV / AG_LRECV / AG_SRECV:
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ID

INPUT

INT

1,2...64 (S7-400)
1,2...16 (S7-300)

En el par√°metro ID se indica el n√∫mero de la conexi√≥n
ISO-Transport.

LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7 aparece la direcci√≥n
inicial del m√≥dulo en la tabla de configuraci√≥n. Indique
aqu√≠ esta direcci√≥n.

RECV

INPUT

ANY

Indicar la direcci√≥n y la longitud
La direcci√≥n del √°rea de datos remite como alternativa a:
‚óè √Årea de marcas
‚óè √Årea de bloques de datos
Para la longitud, considerar lo siguiente:
La transmisi√≥n de registros de hasta 212 bytes se efec‚Äê
t√∫a con mayor rendimiento si en el par√°metro RECV se
limita tambi√©n a 212 bytes la longitud.
Observe para AG_SRECV:
En el caso de AG_SRECV, tiene que ajustar RECV
siempre a la longitud m√°xima del b√∫fer de recepci√≥n de
1452 bytes. En otro caso se pueden producir, en ciertas
situaciones, los siguientes errores:
NDR=0; ERROR=1; STATUS=8185H

NDR

OUTPUT

BOOL

0: 1: nuevos datos

El par√°metro indica si se han adoptado nuevos datos.
Consulte el significado en relaci√≥n con los par√°metros
ERROR y STATUS en AG_RECV / AG_LRECV /
AG_SRECV (Ind.Ethernet) (P√°gina 7321)

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicador de error
Consulte el significado en relaci√≥n con los par√°metros
NDR y STATUS en AG_RECV / AG_LRECV /
AG_SRECV (Ind.Ethernet) (P√°gina 7321)

7322

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

STATUS

OUTPUT

WORD

LEN

OUTPUT

INT

Rango de valores

Descripci√≥n
Indicador de estado
Consulte el significado en relaci√≥n con los par√°metros
NDR y ERROR en AG_RECV / AG_LRECV /
AG_SRECV (Ind.Ethernet) (P√°gina 7321)

en ISO-Transport e
ISO-on-TCP:

Indica el n√∫mero de bytes que se han tomado del CP
Ethernet en el √°rea de datos.

1,2,...8192

Considerar el tipo de instrucciones:

en UDP:

‚óè para S7-300
Con las versiones actuales de AG_RECV se pueden
transmitir hasta 8192 bytes (2048 bytes con UDP).

1,2,...2048

‚óè para S7-400
Con el AG_RECV, el √°rea de datos generalmente
est√° limitada a 240 bytes, como m√°ximo.
Con el AG_SRECV, el √°rea de datos est√° limitada a
1452 bytes, como m√°ximo.

Par√°metros DONE, ERROR, STATUS (IE)
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por los par√°metros
NDR, ERROR y STATUS, que tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

Tabla 4-415 C√≥digos de condici√≥n - AG_RECV / AG_LRECV / AG_SRECV
NDR

ERROR

STATUS

Significado

1

0

0000H

Nuevos datos aceptados.

0

0

8180H

Todav√≠a no hay datos (no para AG_SRECV).

0

0

8181H

Petici√≥n en curso.

0

1

8183H

‚óè Falta la configuraci√≥n;
‚óè El servicio ISO-Transport no se ha iniciado a√∫n en el CP Ethernet;
‚óè La conexi√≥n no est√° establecida.

0

1

8184H

‚óè Se ha indicado un tipo de datos no permitido para el par√°metro RECV.
‚óè Error del sistema.

0

1

8185H

B√∫fer de destino (RECV) demasiado peque√±o.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7323

Instrucciones
4.2 Instrucciones
NDR

ERROR

STATUS

Significado

0

1

8186H

Par√°metro ID no v√°lido.
ID != 1,2....16 (S7-300).
ID != 1,2....64.(S7-400)

0

1

8304H

La conexi√≥n no est√° establecida. La petici√≥n de recepci√≥n solo se deber√≠a emitir de nuevo
tras un tiempo de espera >100 ms.

0

1

8F23H

√Årea fuente no valida, p. ej.:

0

1

8F25H

Error de √°rea al escribir un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos actual protegido de escritura.

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos actual protegido de escritura.

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

Error de n√∫mero de DB

0

1

8F3AH

√Årea de destino no cargada (DB).

√Årea no presente en DB.

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia.

0

1

8F45H

La direcci√≥n del par√°metro que debe escribirse est√° bloqueada en la pista de acceso.

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

0

1

8090H

‚óè No existe ning√∫n m√≥dulo con esta direcci√≥n inicial del m√≥dulo o CPU en STOP
‚óè La instrucci√≥n utilizada no es acorde con la familia de sistemas utilizada (se tienen
que utilizar instrucciones diferentes para S7-300 y S7-400).

0

1

8091H

La direcci√≥n base l√≥gica no est√° en formato de palabra doble.

0

1

8092H

En la referencia ANY se ha indicado un tipo distinto de BYTE.
(solo para S7-400)

0

1

80A0H

Acuse negativo al leer del m√≥dulo.

0

1

80A4H

La conexi√≥n de bus K entre CPU y CP no est√° establecida.

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

Posibles causas:
‚óè El √°rea de destino no es v√°lida.
‚óè El √°rea de destino es demasiado peque√±a.
‚óè El √°rea de destino para los datos de recepci√≥n no se ha calculado bien.
Soluci√≥n: realice otra llamada de recepci√≥n con el tama√±o m√°ximo del b√∫fer de recep‚Äê
ci√≥n. Esto sirve independientemente del tipo de conexi√≥n (Unicast/Multicast/Broadcast)
y de la familia de dispositivos (S7-300 / S7-400).

0

1

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida.

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Recursos ocupados (memoria) temporalmente en la CPU.

0

1

80C4H

Error de comunicaci√≥n
se presenta temporalmente; por ello es conveniente una repetici√≥n en el programa de
usuario

0

7324

1

80D2H

Direcci√≥n inicial del m√≥dulo err√≥nea.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
AG_RECV / AG_LRECV / AG_SRECV (Ind.Ethernet) (P√°gina 7321)

Instrucciones para coordinaci√≥n de accesos en caso de FETCH/WRITE
Instrucciones para coordinaci√≥n de accesos en caso de FETCH/WRITE
Panor√°mica
Para la funci√≥n FETCH/WRITE est√°n disponibles las siguientes instrucciones para la
coordinaci√≥n de accesos:
Instrucci√≥n

utilizable para

Significado

S7-300

S7-400

AG_LOCK

x

x

Bloqueo del acceso externo a datos
mediante FETCH/WRITE.

AG_UNLOCK

x

x

Liberaci√≥n del acceso externo a da‚Äê
tos mediante FETCH/WRITE.

Tener en cuenta la configuraci√≥n
Si utiliza AG_LOCK y AG_UNLOCK, para CPs en estaciones S7-400 debe introducir las
siguientes indicaciones en la configuraci√≥n:
‚óè en "Propiedades > Direcciones"
Se tiene que seleccionar la opci√≥n "Ajuste de direcciones para LOCK/UNLOCK", si existe
tal posibilidad de selecci√≥n.

Forma de trabajar
Con estas instrucciones tiene la posibilidad de coordinar el acceso a √°reas de memoria del
sistema de manera que no se generen y transmitan datos incoherentes. El control tiene lugar
en este caso desde el programa de usuario instalado en la CPU S7, que puede bloquear, si
procede, por medio de la llamada de AG_LOCK un acceso externo de FETCH/WRITE.
Despu√©s de un cierto tiempo o una vez concluido el acceso de escritura/lectura propio, se
puede liberar de nuevo el acceso externo por medio de una petici√≥n de AG_UNLOCK.
Adem√°s se puede aprovechar el hecho de que el bloqueo de acceso s√≥lo es v√°lido en el enlace
FETCH/WRITE indicado en la llamada. Si se configuran varios enlaces FETCH/WRITE, √©stos
se pueden utilizar, por ejemplo, concretamente para determinadas √°reas de memoria del
sistema y se puede realizar as√≠ una coordinaci√≥n de accesos correspondientemente selectiva.
La siguiente representaci√≥n muestra el desarrollo cronol√≥gico usual de una coordinaci√≥n de
accesos a la memoria en el programa de usuario, controlada por AG_LOCK y AG_UNLOCK.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7325

Instrucciones
4.2 Instrucciones

&LFORQ

&LFORQ

&LFORQ

^
^

^
^



&LFORQP

&3(WKHUQHW

3URJUDPDGHXVXDULR
FLFOR&38

,QWHUORFXWRU

$*B/2&.
/2&.(' 
$*B/2&.

$FFHVR)(7&+:5,7(
HQ'%[HQFXUVR

/2&.(' 

$*B/2&.
/2&.(' 

)(7&+:5,7(

)(7&+:5,7(UHFKD]DGR

3URFHVDPLHQWRGHGDWRV
HQ'%[

$*B81/2&.

67$786 [
$FFHVR)(7&+:5,7(
HQ'%[HQFXUVR

7LHPSR

7LHPSR

7LHPSR

La petici√≥n de bloqueo tiene que ser supervisada primero en el programa de usuario a trav√©s
de lo indicado en el par√°metro de retorno LOCKED. Mientras se indique LOCKED=0, se tiene
que partir de que todav√≠a est√° en marcha un acceso externo FETCH/WRITE.
Con LOCKED=1 se indica que el bloqueo est√° activado; ahora se pueden modificar datos
desde el programa de usuario.
La indicaci√≥n de estado se actualiza con cada llamada de la instrucci√≥n.

7326

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

AG_LOCK
AG_LOCK
Descripci√≥n
Con ayuda de la instrucci√≥n AG_LOCK se bloquea el intercambio de datos mediante FETCH
o WRITE a trav√©s de la conexi√≥n seleccionada por el par√°metro ID. La salida LOCKED indica
si el bloqueo ha dado resultado o no. Si el bloqueo ha sido infructuoso, la petici√≥n se tiene que
impulsar de nuevo en un siguiente ciclo de CPU.
La salida STATUS indica el estado del CP para esta conexi√≥n.

Llamada
Interfaz de llamada en representaci√≥n FUP
$*B/2&.

,'

/2&.('

/$''5

67$786

Consulte tambi√©n
Par√°metros en el caso de AG_LOCK (P√°gina 7327)
Par√°metro STATUS (P√°gina 7328)

Par√°metros en el caso de AG_LOCK
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para AG_LOCK:
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ID

INPUT

INT

1,2...16 para S7-300

En el par√°metro ID se indica el n√∫mero de la conexi√≥n.

LADDR

INPUT

WORD

1,2...64 para S7-400
Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7 aparece la direcci√≥n
inicial del m√≥dulo en la tabla de configuraci√≥n. Indique
aqu√≠ esta direcci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7327

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

LOCKED

OUTPUT

BOOL

0: (a√∫n) no bloqueado
1: bloqueado

Indicaci√≥n del estado del bloqueo de acceso solicitado
en la conexi√≥n FETCH/WRITE indicada.

STATUS

OUTPUT

WORD

Indicador de estado
Consulte el significado en Par√°metro STATUS (P√°gi‚Äê
na 7328)

Consulte tambi√©n
AG_LOCK (P√°gina 7327)

Par√°metro STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de las informaciones que tienen que ser evaluadas
por el programa de usuario.
Tabla 4-416 C√≥digos de condici√≥n de AG_LOCK
STATUS

Significado

7000H

El CP no procesa ninguna petici√≥n

7001H

FETCH en curso

7002H

WRITE en curso

8183H

FETCH/WRITE no configurado para esta conexi√≥n (solo para S7-400)

8186H

El n√∫mero de ID no est√° en el rango permitido (p. ej. 1...64 para CPs S7-400 Industrial Ethernet)

80A4H

La conexi√≥n de bus K entre CPU y CP no est√° establecida (en caso de versiones de CPU m√°s recientes).

80B0H

El m√≥dulo no conoce el registro.

80B1H

Longitud (en par√°metro LEN) err√≥nea.

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida.

80C0H

No se puede leer el registro.

80C1H

El registro indicado est√° siendo procesado.

80C2H

Hay demasiadas peticiones pendientes.

80C3H

Recursos ocupados (memoria) temporalmente en la CPU.

80C4H

Error de comunicaci√≥n
se presenta temporalmente; por ello es conveniente una repetici√≥n en el programa de usuario.

80D2H

Direcci√≥n inicial del m√≥dulo err√≥nea.

Consulte tambi√©n
AG_LOCK (P√°gina 7327)

7328

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

AG_UNLOCK
AG_UNLOCK
Descripci√≥n
La instrucci√≥n AG_UNLOCK permite habilitar el acceso externo a las √°reas de memoria de
usuario de la CPU S7. A continuaci√≥n es posible acceder con FETCH o WRITE a trav√©s de la
conexi√≥n seleccionada por el par√°metro ID.
Esto ha estado precedido de un bloqueo de acceso por AG_LOCK.

Llamada
Interfaz de llamada en representaci√≥n FUP
$*B81/2&.

,'

67$786

/$''5

Forma de trabajar
Para volver a habilitar la conexi√≥n, la instrucci√≥n debe volver a desactivar el bit de petici√≥n
LOCK. La instrucci√≥n indica adem√°s el estado actual con mensajes de error.

Consulte tambi√©n
Par√°metro STATUS (P√°gina 7330)
Par√°metros en el caso de AG_UNLOCK (P√°gina 7330)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7329

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de AG_UNLOCK
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para
AG_UNLOCK:
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ID

INPUT

INT

1,2...16 para S7-300

En el par√°metro ID se indica el n√∫mero de la conexi√≥n.
(v. Configuraci√≥n)

1,2...64 para S7-400
LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7 aparece la direcci√≥n
inicial del m√≥dulo. Indique aqu√≠ esta direcci√≥n.

STATUS

OUTPUT

WORD

Indicador de estado:
Consulte el significado en Par√°metro STATUS (P√°gi‚Äê
na 7330)

Consulte tambi√©n
AG_UNLOCK (P√°gina 7329)

Par√°metro STATUS
C√≥digos de condici√≥n
La tabla siguiente informa sobre la indicaci√≥n de STATUS (c√≥digo de condici√≥n) que tiene que
ser evaluada por el programa de usuario.
Tabla 4-417 C√≥digos de condici√≥n de AG_UNLOCK
STATUS

Significado

7000H

El CP no procesa ninguna petici√≥n

7001H

FETCH en curso

7002H

WRITE en curso

8183H

FETCH/WRITE no configurado para esta conexi√≥n (solo para S7-400)

8186H

El n√∫mero de ID no est√° en el rango permitido (p. ej. 1...64 para CPs S7-400 Industrial Ethernet)

80A4H

La conexi√≥n de bus K entre CPU y CP no est√° establecida (en caso de versiones de CPU m√°s recientes).

80B0H

El m√≥dulo no conoce el registro.

80B1H

Longitud (en par√°metro LEN) err√≥nea.

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida.

80C0H

No se puede leer el registro.

80C1H

El registro indicado est√° siendo procesado.

80C2H

Hay demasiadas peticiones pendientes.

80C3H

Recursos ocupados (memoria) temporalmente en la CPU.

7330

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
STATUS

Significado

80C4H

Error de comunicaci√≥n
se presenta temporalmente; por ello es conveniente una repetici√≥n en el programa de usuario.

80D2H

Direcci√≥n inicial del m√≥dulo err√≥nea.

Consulte tambi√©n
AG_UNLOCK (P√°gina 7329)

Instrucciones para el diagn√≥stico del enlace
AG_CNTEX
AG_CNTEX
Significado y funcionamiento
Con la instrucci√≥n AG_CNTEX existe la posibilidad de diagnosticar conexiones y activar
dispositivos en la red mediante el comando ping. Si es necesario se puede inicializar un nuevo
establecimiento de conexi√≥n a trav√©s de AG_CNTEX.
Nota
AG_CNTRL y AG_CNTEX
El bloque de programa AG_CNTEX ofrece ampliaciones con respecto al bloque de programa
AG_CNTRL.
Algunas funciones del AG_CNTRL se incluyen en el AG_CNTEX y pueden utilizarse de la
misma forma en la interfaz del programa de usuario.
Las acciones siguientes se pueden ejecutar a trav√©s de comandos parametrizables:
‚óè Lectura de informaciones sobre la conexi√≥n
Sobre la base de informaciones de estado para todas las conexiones del CP o solo para
algunas de ellas puede decidir si es conveniente resetear las conexiones.
‚óè Reset de conexiones configuradas
Es posible resetear conexiones concretas o todas las conexiones de un CP.
‚óè Cancelar la conexi√≥n activa y establecerla de nuevo
‚óè Leer tipos de conexi√≥n configurados en el CP (ampliaci√≥n respecto a AG_CNTRL)
‚óè Enviar comando PING (ampliaci√≥n respecto a AG_CNTRL)
Existe la posibilidad de comprobar si un dispositivo concreto est√° accesible en la red.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7331

Instrucciones
4.2 Instrucciones
Los comandos del bloque de programa AG_CNTEX solo se permiten para conexiones SEND/
RECV, que se basan en los protocolos ISO / RFC / TCP / UDP.
Nota
Disponibilidad en la librer√≠a del bloque
Si el bloque de programa AG_CNTEX a√∫n no est√° disponible en la librer√≠a de bloques
SIMATIC_NET_CP, instale la librer√≠a de bloques SIMATIC NET actual, que se encuentra en
Internet bajo la siguiente ID de art√≠culo:
Enlace: (https://support.industry.siemens.com/cs/ww/es/view/109481127)

Interfaz de llamada
Interfaz de llamada en representaci√≥n FUP
$*B&17(;
%22/

$&7

'21(

%22/

,17

,'

(5525

%22/

:25'

/$''5

67$786

:25'

,17

&0'

5(68/7

':25'

$1<

3,1*

5(68/7

':25'

Consulte tambi√©n
Funcionamiento de la funci√≥n PING (P√°gina 7332)
Par√°metros con AG_CNTEX (P√°gina 7334)
Par√°metros DONE, ERROR, STATUS (P√°gina 7335)
Comandos y resultados de las peticiones - AG_CNTEX (P√°gina 7337)

Funcionamiento de la funci√≥n PING
Funcionamiento / secuencia de llamada
Con el comando PING CMD=8 se consigue que el CP deposite 4 peticiones PING
consecutivas de la red en la direcci√≥n IP indicada en la petici√≥n. El eco PING es esperado por
el CP dentro del intervalo especificado en el bloque de peticiones PING.
El CP registra los tiempos de respuesta y los deposita en los par√°metros RESULT 1/2.
Los dos par√°metros RESULT 1/2 se consultan mediante el comando PING CMD=9. En cuanto
se han respondido las 4 peticiones PING o bien se ha excedido su tiempo de vigilancia
especificado, la ejecuci√≥n se confirma en el par√°metro DONE=1. El resultado PING puede

7332

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
consultarse en un tiempo m√°ximo de 30 segundos; despu√©s, las entradas de RESULT ya no
son v√°lidas.
Nota
PING requiere una conexi√≥n configurada
El comando PING requiere que como m√≠nimo est√© configurada una conexi√≥n para la interfaz
SEND/RECEIVE (TCP, ISO-on-TCP, ISO-Transport, UDP)

Varias peticiones PING al mismo tiempo
Es posible depositar un m√°ximo de 4 peticiones PING simult√°neas en diferentes direcciones
IP. Para ello se debe utilizar el mismo DB instancia en cada caso para las peticiones PING. No
es posible depositar m√°s peticiones PING hasta que se haya procesado al menos una de las
que est√°n en curso.
Si se depositan demasiadas peticiones PING al mismo tiempo, se muestra un mensaje de error
(par√°metro STATUS = 828AH).

¬øCu√°ndo se han procesado las peticiones PING?
Las peticiones PING se consideran procesadas cuando se cumple una de las condiciones
siguientes:
‚óè El resultado PING se ha le√≠do;
‚óè El resultado PING no se ha le√≠do pero han transcurrido 30 segundos desde que el resultado
PING est√° disponible.

Consulte tambi√©n
AG_CNTEX (P√°gina 7331)
Comandos y resultados de las peticiones - AG_CNTEX (P√°gina 7337)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7333

Instrucciones
4.2 Instrucciones

Par√°metros con AG_CNTEX
Explicaci√≥n de los par√°metros formales
La tabla siguiente explica todos los par√°metros formales de la funci√≥n AG_CNTEX:
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ACT

INPUT

BOOL

0, 1

El FB se tiene que llamar con ACT=1.
Al llamar con ACT=0 no se produce llamada de la fun‚Äê
ci√≥n y el bloque se abandona de inmediato.

ID

INPUT

INT

‚óè 1, 2, .., n,
o bien
‚óè 0

En el par√°metro ID se indica el n√∫mero de la conexi√≥n.
El n√∫mero de conexi√≥n se tiene que tomar de la confi‚Äê
guraci√≥n. n es el n√∫mero m√°ximo de conexiones y de‚Äê
pende del producto (S7-300 o S7-400).
En una llamada que redirecciona todas las conexiones
se debe indicar la ID 0. Esto se refiere a lo siguiente:
‚óè las funciones CN_STATUS_ALL (CMD 3) y
CN_RESET_ALL (CMD 4)
‚óè comando PING con CMD 8 o CMD 9

LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7 aparece la direcci√≥n
inicial del m√≥dulo. Indique aqu√≠ esta direcci√≥n.

CMD

INPUT

INT

Comando a FB AG_CNTEX

PING

INPUT

ANY

Hace referencia al bloque de datos (p. ej. DB) que con‚Äê
tiene la estructura de datos para el comando PING.
El bloque de datos contiene la direcci√≥n IP as√≠ como,
opcionalmente, los datos sobre la vigilancia de tiempo y
sobre el n√∫mero de bytes que deben transferirse en la
petici√≥n PING.
Para la estructura de datos v√©ase m√°s abajo

DONE

OUTPUT

BOOL

0:
la petici√≥n est√° en pro‚Äê
cesamiento o a√∫n no se
ha lanzado
1:
petici√≥n ejecutada

El par√°metro de estado indica si la petici√≥n se ha desa‚Äê
rrollado correctamente.
Consulte el significado en relaci√≥n con los par√°metros
ERROR y STATUS en Par√°metros DONE, ERROR,
STATUS (P√°gina 7335)
Nota:
con DONE=1 se puede evaluar RESULT

ERROR

STATUS

OUTPUT

OUTPUT

BOOL

WORD

0: ning√∫n error

Indicador de error

1: caso de error

Consulte el significado en relaci√≥n con los par√°metros
DONE y STATUS en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7335)
Indicador de estado
Consulte el significado en relaci√≥n con los par√°metros
DONE y ERROR en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7335)

RESULT1

OUTPUT

DWORD

Respuesta a AG_CNTEX seg√∫n comando.

RESULT2

OUTPUT

DWORD

Respuesta de la parte 2 a AG_CNTEX seg√∫n comando.

7334

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloque de datos PING
El par√°metro PING hace referencia a un bloque de datos con la siguiente estructura:
Par√°metro

Tipo de datos

Rango de valores

Nota

Direcci√≥n IP

ARRAY [1..4] of Byte

TIMEOUT

INT

1 - 60000 ms

Indicaci√≥n opcional; valor
predeterminado = 1000 ms

Size

INT

1 - 1000 bytes

Indicaci√≥n opcional; valor
predeterminado = 32 bytes

Consulte tambi√©n
AG_CNTEX (P√°gina 7331)

Par√°metros DONE, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
Adicionalmente se tienen que evaluar los resultados de comandos en los par√°metros
RESULT1/2 seg√∫n Comandos y resultados de las peticiones - AG_CNTEX (P√°gina 7337).
Tabla 4-418 C√≥digos de condici√≥n AG_CNTEX
DONE

ERROR

STATUS

Significado

1

0

0000H

Se ha transmitido con √©xito una petici√≥n (CMD) al CP (p. ej. RESET) o se ha le√≠do con
√©xito un estado del CP.
Se han podido evaluar los par√°metros RESULT1/2.

0

0

0000H

No se ha producido a√∫n ninguna llamada de bloque o el bloque de programa se llama con
ACT=0.

0

0

8181H

Petici√≥n en curso
La llamada del bloque se tiene que repetir con los mismos par√°metros, hasta que se
notifique DONE o ERROR.

0

1

8183H

Falta la configuraci√≥n o no se ha iniciado a√∫n el servicio en el CP Ethernet.

0

1

8184H

Error de sistema o tipo de par√°metro err√≥neo. La causa puede ser:
‚óè El tipo de datos del puntero ANY para el par√°metro PING no es correcto.
‚óè El puntero ANY hace referencia a una direcci√≥n de bit impar.

0

1

8186H

El par√°metro ID no es v√°lido. La ID admisible depende del comando seleccionado.

0

1

8187H

El par√°metro CMD no es v√°lido.

0

1

8090H

Significados posibles:
‚óè No existe un m√≥dulo con esta direcci√≥n inicial de m√≥dulo;
‚óè El bloque de programa utilizado no es acorde con la familia de sistemas utilizada (se
tienen que utilizar bloques de programa diferentes para S7-300 y S7-400);
‚óè Este m√≥dulo no da soporte a esta funci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7335

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8091H

La direcci√≥n inicial del m√≥dulo no est√° en la trama de doble palabra.

0

1

8092H

La direcci√≥n inicial del m√≥dulo es incorrecta.

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida. En el sistema H, la CPU
correspondiente se encuentra en el estado operativo STOP.

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Recursos ocupados (memoria) temporalmente en la CPU.

0

1

80C4H

Error de comunicaci√≥n
El error se presenta temporalmente; por ello es conveniente una repetici√≥n en el progra‚Äê
ma de usuario.

0

1

8286H

El valor de la indicaci√≥n "Timeout" en el bloque de datos PING est√° fuera del rango de
valores v√°lido.

0

1

8287H

La direcci√≥n IP indicada en el DB PING est√° reservada y, por tanto, no es admisible.

0

1

8288H

La indicaci√≥n solo aparece con el comando de petici√≥n de resultado PING.
Significados posibles:
‚óè La direcci√≥n IP no ha sido alcanzada por el comando PING (por ejemplo porque el CP
se ha puesto en modo STOP despu√©s de que se haya depositado el comando de
petici√≥n PING);
‚óè El resultado PING ya se ha le√≠do;
‚óè El resultado PING no se ha le√≠do dentro del intervalo m√°ximo de 30 segundos.

0

1

8289H

El volumen de datos de la petici√≥n PING ha excedido el rango admisible (m√°ximo 1000
bytes; consulte la estructura de datos del comando PING)

0

1

828AH

Ya se est√°n procesando 4 peticiones PING. No se admiten peticiones nuevas hasta que
se hayan procesado las existentes.

0

1

828BH

Ya se est√° procesando una petici√≥n PING para la direcci√≥n IP indicada. Utilice el co‚Äê
mando de petici√≥n de resultado PING para concluir el procesamiento en curso.

Consulte tambi√©n
AG_CNTEX (P√°gina 7331)

7336

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Comandos y resultados de las peticiones - AG_CNTEX
Comandos y evaluaci√≥n de los resultados de la petici√≥n
Vea en las tablas siguientes los comandos posibles y los resultados evaluables en los
par√°metros RESULT1/2.
Nota
Evaluaci√≥n de comandos para tipos de CP o versiones de firmware menos recientes
Los comandos descritos a continuaci√≥n son compatibles con tipos de CP o versiones de
firmware actuales. Observe las indicaciones adicionales que aparecen bajo la siguiente
referencia en Internet:
http://support.automation.siemens.com/WW/view/de/33414377 (http://
support.automation.siemens.com/ww/view/es/33414377)

Tabla 4-419 Comandos a FC AG_CNTRL.
CMD

Significado

0

NOP ‚Äì no operation
Se pasa por el bloque sin petici√≥n al CP.
RESULT (para CMD = 0)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

Secuencia sin error

RESULT2

0000 0000H

Valor predeterminado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7337

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 000*H

Bits 0-3: c√≥digos de condici√≥n para el sentido de emisi√≥n
(valores excluidos: 0x2)
Bit 0

Tipo de conexi√≥n
‚óè 0: no hay conexi√≥n de transmisi√≥n ni recepci√≥n
‚óè 1: la conexi√≥n est√° reservada para peticiones de
transmisi√≥n y recepci√≥n

Bit 1

Estado de la petici√≥n actual
‚óè 0: Ninguna petici√≥n de emisi√≥n en proceso
‚óè 1: Petici√≥n de emisi√≥n en proceso

Bits 2+3

Petici√≥n precedente:
‚óè 00: Ninguna informaci√≥n disponible sobre la petici√≥n
de emisi√≥n precedente
‚óè 01: Petici√≥n de emisi√≥n precedente concluida
positivamente
‚óè 10: Petici√≥n de emisi√≥n precedente concluida
negativamente

7338

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status (continuaci√≥n para CMD=1)
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 00*0H

Bits 4‚àí7: c√≥digos de condici√≥n para el sentido de recepci√≥n
(valores excluidos: 0x2)
Bit 4

Tipo de conexi√≥n
‚óè 0: no hay conexi√≥n de transmisi√≥n ni recepci√≥n
‚óè 1: la conexi√≥n est√° reservada para peticiones de
transmisi√≥n y recepci√≥n

Bit 5

Estado de la petici√≥n actual
‚óè 0: Ninguna petici√≥n de recepci√≥n en proceso
‚óè 1: Petici√≥n de recepci√≥n en proceso

Bits 6+7

Petici√≥n precedente:
‚óè 00: Ninguna informaci√≥n disponible sobre la petici√≥n
de recepci√≥n precedente
‚óè 01: Petici√≥n de recepci√≥n precedente concluida
positivamente
‚óè 10: Petici√≥n de recepci√≥n precedente concluida
negativamente

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7339

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status (continuaci√≥n para CMD=1)
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 0*00H

Bits 8-11: C√≥digos de condici√≥n para FETCH/WRITE
(valores excluidos:0x3,0x7,0x8,0xB,0xF)
Bit 8

Tipo de conexi√≥n:
‚óè 0: ninguna conexi√≥n FETCH
‚óè 1: conexi√≥n reservada para peticiones FETCH

Bit 9

Tipo de conexi√≥n:
‚óè 0: ninguna conexi√≥n WRITE
‚óè 1: conexi√≥n reservada para peticiones WRITE

Bit 10

Estado de la petici√≥n (FETCH/WRITE):
‚óè 0: Estado de la petici√≥n OK
‚óè 1: Estado de la petici√≥n NOT OK
este identificador se pone en los siguientes casos:

Bit 11

‚Äì

La petici√≥n ha sido acusada negativamente por la
CPU

‚Äì

La petici√≥n no se ha podido transmitir a la CPU por
estar la conexi√≥n en el estado "LOCKED".

‚Äì

La petici√≥n ha sido rechazada porque el
encabezado FETCH/WRITE no ten√≠a la estructura
correcta.

Estado de petici√≥n FETCH/WRITE
‚óè 0: ninguna petici√≥n en curso
‚óè 1: en curso una petici√≥n de LAN

7340

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status (continuaci√≥n para CMD=1)
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 *000H

Bits 12-15: Informaciones generales del CP
(valores excluidos: 0x3,0xB)
Bit 12 + 13

Informaci√≥n sobre el estado de la conexi√≥n:
(disponible solo para conexiones SEND/RECV que utili‚Äê
cen los protocolos ISO/RFC/TCP; en caso de UDP se
emiten las informaciones internas correspondientes)
‚óè 00: conexi√≥n deshecha
‚óè 01: estableci√©ndose la conexi√≥n
‚óè 10: deshaci√©ndose la conexi√≥n
‚óè 11: conexi√≥n establecida

Bit 14

Informaci√≥n del CP:
‚óè 0: CP en STOP
‚óè 1: CP en RUN

Bit 15

Identificador de reset
‚óè 0: no se ha ejecutado a√∫n ning√∫n reset de la conexi√≥n
a trav√©s de AG_CNTEX o se ha retirado la
identificaci√≥n de reset.
‚óè 1: se ha realizado un reset de la conexi√≥n a trav√©s de
AG_CNTEX.

RESULT1

**** 0000H

Bits 16-31: Reservado
0 ‚Äì reservado para futuras ampliaciones

RESULT2

0000 0000H

‚Äì reservado para futuras extensiones

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7341

Instrucciones
4.2 Instrucciones

CMD

Significado

2

CN_RESET ‚Äì connection reset
Este comando resetea la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
El reset de la conexi√≥n provoca una cancelaci√≥n de la misma y un nuevo establecimiento (activo o pasivo, seg√∫n
la configuraci√≥n). Se borran los datos recibidos en el momento de la cancelaci√≥n de la conexi√≥n, pero todav√≠a no
adoptados en el programa de usuario.
Se genera adicionalmente una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 2)
Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

Significado
La petici√≥n de Reset se ha transmitido con √©xito al CP.
Se han impulsado la cancelaci√≥n de la conexi√≥n y su sub‚Äê
siguiente establecimiento.

RESULT2

CMD
3

0000 0002H

La petici√≥n de Reset no se ha podido transmitir al CP por
no estar iniciado el servicio en el CP (p. ej. CP en STOP).

0000 0000H

Valor predeterminado

Significado
CN_STATUS_ALL ‚Äì all connections status
Este comando proporciona en los par√°metros RESULT1/2 (en total 8 bytes de informaci√≥n colectiva) el estado
de conexi√≥n de todas las conexiones (establecidas/deshechas).
El par√°metro ID tiene que estar puesto a "0" (se verifica en cuanto a 0).
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si se necesitan, se pueden obtener informaciones detalladas sobre una conexi√≥n deshecha o no configurada a
trav√©s de una nueva llamada de estado, dirigida a la conexi√≥n, con CMD=1.
RESULT (para CMD = 3)

Significado

Par√°metro

Valor Hex/rango

RESULT1

**** ****H

Para cada conexi√≥n:

32 bits con la siguiente validez:

‚óè 0 ‚Äì conexi√≥n deshecha / no configurada

‚óè Para S7-400: Bits 0-31 para
conexiones 1 - 32

‚óè 1 ‚Äì conexi√≥n establecida

‚óè Para S7-300: Bits 0-15 para
conexiones 1 - 16
RESULT2

7342

**** ****H

Para cada conexi√≥n:

32 bits con la siguiente validez:

‚óè 0 ‚Äì conexi√≥n deshecha / no configurada

‚óè Para S7-400: Bits 0-31 para
conexiones 33 - 64

‚óè 1 ‚Äì conexi√≥n establecida

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

4

CN_RESET_ALL ‚Äì all connections reset
Este comando resetea todas las conexiones.
El par√°metro ID tiene que estar puesto a "0" (se verifica en cuanto a 0).
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
El reset de las conexiones provoca una cancelaci√≥n de las mismas y un nuevo establecimiento (activo o pasivo,
seg√∫n la configuraci√≥n). Se borran los datos recibidos en el momento de la cancelaci√≥n de la conexi√≥n, pero
todav√≠a no adoptados en el programa de usuario.
Se genera adicionalmente una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 4)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n de Reset se ha transmitido con √©xito al CP. Se
han impulsado la cancelaci√≥n y el subsiguiente estableci‚Äê
miento de todas las conexiones.

RESULT1

0000 0002H

La petici√≥n de Reset no se ha podido transmitir al CP por
no estar iniciado el servicio en el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

CMD

Significado

5

CN_CLEAR_RESET ‚Äì inicializaci√≥n de la identificaci√≥n de Reset
Este comando resetea el identificador de reset (bit 15 en RESULT1) para la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Esta petici√≥n se ejecuta tambi√©n autom√°ticamente al leer el estado de la conexi√≥n (CMD=1); la petici√≥n enviable
por separado aqu√≠ descrita solo se necesita por lo tanto en casos especiales.
RESULT (para CMD = 5)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n de Clear se ha transmitido con √©xito al CP.

RESULT1

0000 0002H

La petici√≥n de Clear no se ha podido transmitir al CP por no
estar iniciado el servicio en el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7343

Instrucciones
4.2 Instrucciones

CMD

Significado

6

CN_DISCON ‚àí connection disconnect
Este comando resetea la conexi√≥n que se hab√≠a seleccionado con ID y LADDR.
El reset de la conexi√≥n se realiza con una cancelaci√≥n de la misma.
Los datos guardados eventualmente en la pila se pierden sin advertencia. Despu√©s de esto no se produce ning√∫n
establecimiento autom√°tico de la conexi√≥n. La conexi√≥n se puede restablecer con la petici√≥n de Control
CN_STARTCON. Se crea una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 6)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n se ha transmitido con √©xito al CP. Se ha inicia‚Äê
do la cancelaci√≥n de la conexi√≥n.

RESULT1

0000 0002H

La petici√≥n no se ha podido transmitir al CP por no estar
iniciado el servicio en el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

CMD

Significado

7

CN_STARTCON ‚àí start connection
Este comando establece una conexi√≥n seleccionada con ID y LADDR y que se cancel√≥ antes con la petici√≥n de
Control CN_DISCON. Se crea una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 7)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n de establecimiento de la conexi√≥n se ha trans‚Äê
mitido con √©xito al CP. Se ha iniciado el establecimiento de
la conexi√≥n.

RESULT1

0000 0002H

La petici√≥n de establecimiento de la conexi√≥n no se ha
podido transmitir al CP por no estar iniciado el servicio en
el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

CMD

Significado

8

PING_REQUEST - Enviar petici√≥n PING
Este comando env√≠a una petici√≥n PING al CP. Seguidamente, el CP ordena 4 peticiones eco PING para la
direcci√≥n IP indicada.
RESULT (para CMD = 8)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n PING se ha enviado correctamente al CP.

RESULT2

0000 0002H

No ha sido posible enviar correctamente la petici√≥n PING
al CP porque el servicio correspondiente no estaba acce‚Äê
sible en el CP.
La causa posible es, por ejemplo: CP en modo STOP.

7344

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

9

PING_RESULT - Consultar resultado PING
Este comando env√≠a una consulta de resultado PING al CP. El CP transfiere los resultados de las 4 peticiones eco
PING realizadas en el par√°metro RESULT.
La llamada no se considera correcta hasta que el CP ha concluido las 4 peticiones eco PING.
RESULT (para CMD = 9)
Par√°metro

Valor Hex/rango

RESULT1

**** ****H

Significado
1. palabra:
tiempo de respuesta en ms a la 1.¬™ petici√≥n eco PING.
2. palabra:
tiempo de respuesta en ms a la 2.¬™ petici√≥n eco PING.
Ejemplo:
0005 FFFFH
eco 1 -> recibida tras 5 ms
eco 2 -> sin eco en el tiempo de vigilancia indicado,

RESULT2

**** ****H

1. palabra:
tiempo de respuesta en ms a la 3.¬™ petici√≥n eco PING.
2. palabra:
tiempo de respuesta en ms a la 4.¬™ petici√≥n eco PING.
Ejemplo:
0002 3456H
eco 3 -> recibida tras 2 ms
eco 4 -> recibida tras 13398 ms

Rango de valores para palabras de datos en RESULT1 / RESULT 2:
0000H

no utilizado

0001H ... EA60H

Tiempo de respuesta en ms
0001H = 1 ms
EA60H = 60000 ms

EA61H ... FFFEH

no utilizado

FFFFH

Timeout: sin eco dentro del tiempo de vigilancia especifi‚Äê
cado.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7345

Instrucciones
4.2 Instrucciones

CMD

Significado

10

CONN_TYPE - Tipo de conexi√≥n
Este comando induce al CP a indicar el tipo de conexi√≥n actual para la ID de conexi√≥n indicada.
RESULT (para CMD = 10)
Par√°metro

Valor Hex/rango

RESULT1

0000 000*H

Significado
La petici√≥n proporciona los valores siguientes para los po‚Äê
sibles tipos de conexi√≥n:
0: no se ha creado ninguna conexi√≥n
1: conexi√≥n UDP
2: conexi√≥n SMTP
3: conexi√≥n TCP
4: conexi√≥n UDP libre
5: conexi√≥n FTP
6: conexi√≥n ISO-Transport
7: conexi√≥n ISO-on-TCP

RESULT2

0000 0000H

Valor predeterminado

Consulte tambi√©n
Observe las indicaciones adicionales que aparecen bajo la siguiente ID de art√≠culo en las
preguntas frecuentes (FAQ): http://support.automation.siemens.com/WW/view/de/33414377
(http://support.automation.siemens.com/ww/view/es/33414377)

Consulte tambi√©n
AG_CNTEX (P√°gina 7331)
Funcionamiento de la funci√≥n PING (P√°gina 7332)

7346

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

AG_CNTRL para el diagn√≥stico del enlace
AG_CNTRL
Descripci√≥n
Con la instrucci√≥n AG_CNTRL se tiene la posibilidad de diagnosticar conexiones. Si fuera
necesario se puede inicializar un nuevo establecimiento de la conexi√≥n a trav√©s de la
instrucci√≥n.
Nota
AG_CNTRL y AG_CNTEX
La instrucci√≥n AG_CNTEX ofrece ampliaciones con respecto a la instrucci√≥n AG_CNTRL.
Todas las funciones del AG_CNTRL se incluyen en el AG_CNTEX y pueden utilizarse de la
misma forma en la interfaz del programa de usuario.
Las acciones siguientes se pueden ejecutar a trav√©s de comandos parametrizables:
‚óè Lectura de informaciones sobre la conexi√≥n
Sobre la base de informaciones de estado para todas las conexiones del CP o solo para
algunas de ellas puede decidir si es conveniente resetear las conexiones.
‚óè Reset de conexiones configuradas
Es posible resetear conexiones concretas o todas las conexiones de un CP.
‚óè Cancelar la conexi√≥n activa y establecerla de nuevo
Los comandos de la instrucci√≥n AG_CNTRL solo se permiten para conexiones SEND/RECV,
que se basan en los protocolos ISO / RFC / TCP / UDP.

Interfaz de llamada
Interfaz de llamada en representaci√≥n FUP
$*B&175/
%22/

$&7

'21(

%22/

,17

,'

(5525

%22/

:25'

/$''5

67$786

:25'

,17

&0'

5(68/7

':25'

5(68/7

':25'

Informaciones adicionales
FAQ con ID de art√≠culo 33414377 (http://support.automation.siemens.com/WW/view/de/
33414377)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7347

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Par√°metros en el caso de AG_CNTRL (P√°gina 7348)
Par√°metros DONE, ERROR, STATUS (P√°gina 7349)
Comandos y resultados de las peticiones AG_CNTRL (P√°gina 7350)

Par√°metros en el caso de AG_CNTRL
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para AG_CNTRL:
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ACT

INPUT

BOOL

0, 1

AG_UNLOCK se tiene que llamar con ACT=1.
Al llamar con ACT=0 no se produce la llamada de la
funci√≥n y la instrucci√≥n se abandona de inmediato.

ID

INPUT

INT

‚óè 1, 2, .., n,
o bien
‚óè 0

En el par√°metro ID se indica el n√∫mero de la conexi√≥n.
El n√∫mero de conexi√≥n se tiene que tomar de la confi‚Äê
guraci√≥n. n es el n√∫mero m√°ximo de conexiones y de‚Äê
pende del producto (S7-300 o S7-400).
En caso de una llamada dirigida a todas las conexiones,
(funci√≥n _ALL con CMD 3 o 4) se tiene que indicar ID 0.

LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7 aparece la direcci√≥n
inicial del m√≥dulo en la tabla de configuraci√≥n. Indique
aqu√≠ esta direcci√≥n.

CMD

INPUT

INT

DONE

OUTPUT

BOOL

Comando a AG_CNTRL.
0:
la petici√≥n est√° en pro‚Äê
cesamiento o a√∫n no se
ha lanzado
1:
petici√≥n ejecutada

El par√°metro de estado indica si la petici√≥n se ha desa‚Äê
rrollado correctamente.
Consulte el significado en relaci√≥n con los par√°metros
ERROR y STATUS en Par√°metros DONE, ERROR,
STATUS (P√°gina 7349)
Nota:
con DONE=1 se puede evaluar RESULT

ERROR

STATUS

OUTPUT

OUTPUT

BOOL

WORD

0: ning√∫n error

Indicador de error

1: caso de error

Consulte el significado en relaci√≥n con los par√°metros
DONE y STATUS en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7349)
Indicador de estado
Consulte el significado en relaci√≥n con los par√°metros
DONE y ERROR en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7349)

RESULT1

OUTPUT

DWORD

Respuesta seg√∫n comando a AG_CNTRL.

RESULT2

OUTPUT

DWORD

evaluar solo para S7-400:
Respuesta de la parte 2 seg√∫n comando a AG_CNTRL.

7348

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
AG_CNTRL (P√°gina 7347)

Par√°metros DONE, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
Adicionalmente se tienen que evaluar los resultados de comandos en los par√°metros
RESULT1/2 seg√∫n "Comandos y resultados de las peticiones AG_CNTRL (P√°gina 7350)".
Tabla 4-420 C√≥digos de condici√≥n de AG_CNTRL
DONE

ERROR

STATUS

Significado

1

0

0000H

Se ha transmitido con √©xito una petici√≥n (CMD) al CP (p. ej. RESET) o se ha le√≠do con
√©xito un estado del CP.
Se han podido evaluar los par√°metros RESULT1/2.

0

0

0000H

No se ha producido a√∫n ninguna llamada de la instrucci√≥n o esta se ha llamado con
ACT=0.

0

0

8181H

Petici√≥n en curso
La llamada de la instrucci√≥n se tiene que repetir con los mismos par√°metros, hasta que
se notifique DONE o ERROR.

0

1

8183H

Falta la configuraci√≥n o no se ha iniciado a√∫n el servicio en el CP Ethernet.

0

1

8186H

El par√°metro ID no es v√°lido. La ID admisible depende del comando seleccionado; v√©ase
Par√°metro CMD en Comandos y resultados de las peticiones AG_CNTRL (P√°gina 7350).

0

1

8187H

El par√°metro CMD no es v√°lido.

0

1

8188H

Error de secuencia en el control de ACT (observaci√≥n: esta indicaci√≥n no se presenta en
la versi√≥n de producto del CP / del firmware).

0

1

8189H

La versi√≥n de CP / firmware utilizada no da soporte a AG_CNTRL.
El c√≥digo de condici√≥n se pone en caso de llamada en un CP3431-EX20 con firmware a
partir de V1.3.9; en otros tipos de CP, en lugar de esto se env√≠a el c√≥digo de condici√≥n
80B0H.
Nota: el AG_CNTRL en la versi√≥n V1.0 es soportado por CPs a partir de CP 343-1 EX21/
GX21; en estos no aparece este c√≥digo de condici√≥n.

0

1

8090H

‚óè No existe un m√≥dulo con esta direcci√≥n inicial de m√≥dulo.
o bien
‚óè La instrucci√≥n utilizada no es acorde con la familia de sistemas utilizada (se tienen
que utilizar instrucciones diferentes para S7-300 y S7-400).
o bien
‚óè Este m√≥dulo no da soporte a esta funci√≥n.

0

1

8091H

La direcci√≥n inicial del m√≥dulo no est√° en la trama de doble palabra.

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida. En el sistema H, la CPU
correspondiente se encuentra en el estado operativo STOP.

0

1

80C0H

No se puede leer el registro.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7349

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Recursos ocupados (memoria) temporalmente en la CPU.

0

1

80C4H

Error de comunicaci√≥n
El error se presenta temporalmente; por ello es conveniente una repetici√≥n en el progra‚Äê
ma de usuario.

0

1

80D2H

La direcci√≥n inicial del m√≥dulo es incorrecta.

Consulte tambi√©n
AG_CNTRL (P√°gina 7347)

Comandos y resultados de las peticiones AG_CNTRL
Comandos y evaluaci√≥n de los resultados de la petici√≥n
Vea en las tablas siguientes los comandos posibles y los resultados evaluables en los
par√°metros RESULT1/2.
Tabla 4-421 Comandos a AG_CNTRL
CMD

Significado

0

NOP ‚Äì no operation
Se pasa por AG_CNTRL sin petici√≥n al CP.
RESULT (para CMD = 0)

7350

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

Secuencia sin error

RESULT2

0000 0000H

Valor predeterminado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 000*H

Bits 0-3: c√≥digos de condici√≥n para el sentido de emisi√≥n
(valores excluidos: 0x2)
Bit 0

Tipo de conexi√≥n
‚óè 0: no hay conexi√≥n de transmisi√≥n ni recepci√≥n
‚óè 1: la conexi√≥n est√° reservada para peticiones de
transmisi√≥n y recepci√≥n

Bit 1

Estado de la petici√≥n actual
‚óè 0: Ninguna petici√≥n de emisi√≥n en proceso
‚óè 1: Petici√≥n de emisi√≥n en proceso

Bits 2+3

Petici√≥n precedente:
‚óè 00: Ninguna informaci√≥n disponible sobre la petici√≥n
de emisi√≥n precedente
‚óè 01: Petici√≥n de emisi√≥n precedente concluida
positivamente
‚óè 10: Petici√≥n de emisi√≥n precedente concluida
negativamente

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7351

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status (continuaci√≥n para CMD=1)
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 00*0H

Bits 4‚àí7: c√≥digos de condici√≥n para el sentido de recepci√≥n
(valores excluidos: 0x2)
Bit 4

Tipo de conexi√≥n
‚óè 0: no hay conexi√≥n de transmisi√≥n ni recepci√≥n
‚óè 1: la conexi√≥n est√° reservada para peticiones de
transmisi√≥n y recepci√≥n

Bit 5

Estado de la petici√≥n actual
‚óè 0: Ninguna petici√≥n de recepci√≥n en proceso
‚óè 1: Petici√≥n de recepci√≥n en proceso

Bits 6+7

Petici√≥n precedente:
‚óè 00: Ninguna informaci√≥n disponible sobre la petici√≥n
de recepci√≥n precedente
‚óè 01: Petici√≥n de recepci√≥n precedente concluida
positivamente
‚óè 10: Petici√≥n de recepci√≥n precedente concluida
negativamente

7352

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status (continuaci√≥n para CMD=1)
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 0*00H

Bits 8-11: C√≥digos de condici√≥n para FETCH/WRITE
(valores excluidos:0x3,0x7,0x8,0xB,0xF)
Bit 8

Tipo de conexi√≥n:
‚óè 0: ninguna conexi√≥n FETCH
‚óè 1: conexi√≥n reservada para peticiones FETCH

Bit 9

Tipo de conexi√≥n:
‚óè 0: ninguna conexi√≥n WRITE
‚óè 1: conexi√≥n reservada para peticiones WRITE

Bit 10

Estado de la petici√≥n (FETCH/WRITE):
‚óè 0: Estado de la petici√≥n OK
‚óè 1: Estado de la petici√≥n NOT OK
este identificador se pone en los siguientes casos:

Bit 11

‚Äì

La petici√≥n ha sido acusada negativamente por la
CPU

‚Äì

La petici√≥n no se ha podido transmitir a la CPU por
estar la conexi√≥n en el estado "LOCKED".

‚Äì

La petici√≥n ha sido rechazada porque el
encabezado FETCH/WRITE no ten√≠a la estructura
correcta.

Estado de petici√≥n FETCH/WRITE
‚óè 0: ninguna petici√≥n en curso
‚óè 1: en curso una petici√≥n de LAN

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7353

Instrucciones
4.2 Instrucciones

CMD

Significado

1

CN_STATUS ‚Äì connection status (continuaci√≥n para CMD=1)
Este comando proporciona el estado de la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si estuviera activado el bit 15 (identificador de reset), se desactiva autom√°ticamente (este comportamiento
concuerda con la petici√≥n CN_CLEAR_RESET - v√©ase CMD = 5).
RESULT (para CMD = 1)

Valor / Significado

Par√°metro

Valor Hex/rango

Bit

RESULT1

0000 *000H

Bits 12-15: Informaciones generales del CP
(valores excluidos: 0x3,0xB)
Bit 12 + 13

Informaci√≥n sobre el estado de la conexi√≥n:
(disponible solo para conexiones SEND/RECV que utili‚Äê
cen los protocolos ISO/RFC/TCP; en caso de UDP se
emiten las informaciones internas correspondientes)
‚óè 00: conexi√≥n deshecha
‚óè 01: estableci√©ndose la conexi√≥n
‚óè 10: deshaci√©ndose la conexi√≥n
‚óè 11: conexi√≥n establecida

Bit 14

Informaci√≥n del CP:
‚óè 0: CP en STOP
‚óè 1: CP en RUN

Bit 15

Identificador de reset
‚óè 0: No se ha ejecutado a√∫n ning√∫n reset de la conexi√≥n
a trav√©s de AG_CNTRL o se ha retirado la
identificaci√≥n de reset.
‚óè 1: Se ha realizado un reset de la conexi√≥n mediante la
instrucci√≥n de control.

7354

RESULT1

**** 0000H

Bits 16-31: Reservado
0 ‚Äì reservado para futuras ampliaciones

RESULT2

0000 0000H

‚Äì reservado para futuras extensiones

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

2

CN_RESET ‚Äì connection reset
Este comando resetea la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
El reset de la conexi√≥n provoca una cancelaci√≥n de la misma y un nuevo establecimiento (activo o pasivo, seg√∫n
la configuraci√≥n). Se borran los datos recibidos en el momento de la cancelaci√≥n de la conexi√≥n, pero todav√≠a no
adoptados en el programa de usuario.
Se genera adicionalmente una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 2)
Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

Significado
La petici√≥n de Reset se ha transmitido con √©xito al CP.
Se han impulsado la cancelaci√≥n de la conexi√≥n y su sub‚Äê
siguiente establecimiento.

RESULT2

CMD
3

0000 0002H

La petici√≥n de Reset no se ha podido transmitir al CP por
no estar iniciado el servicio en el CP (p. ej. CP en STOP).

0000 0000H

Valor predeterminado

Significado
CN_STATUS_ALL ‚Äì all connections status
Este comando proporciona en los par√°metros RESULT1/2 (en total 8 bytes de informaci√≥n colectiva) el estado
de conexi√≥n de todas las conexiones (establecidas/deshechas).
El par√°metro ID tiene que estar puesto a "0" (se verifica en cuanto a 0).
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Si se necesitan, se pueden obtener informaciones detalladas sobre una conexi√≥n deshecha o no configurada a
trav√©s de una nueva llamada de estado, dirigida a la conexi√≥n, con CMD=1.
RESULT (para CMD = 3)
Par√°metro

Valor Hex/rango

RESULT1

**** ****H

Significado
32 Bit: conexi√≥n 1 - 32
‚óè 0 ‚Äì conexi√≥n deshecha / no configurada
‚óè 1 ‚Äì conexi√≥n establecida

RESULT2

**** ****H

32 Bit: conexi√≥n 33 - 64
‚óè 0 ‚Äì conexi√≥n deshecha / no configurada
‚óè 1 ‚Äì conexi√≥n establecida

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7355

Instrucciones
4.2 Instrucciones

CMD

Significado

4

CN_RESET_ALL ‚Äì all connections reset:
Este comando resetea todas las conexiones.
El par√°metro ID tiene que estar puesto a "0" (se verifica en cuanto a 0).
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
El reset de las conexiones provoca una cancelaci√≥n de las mismas y un nuevo establecimiento (activo o pasivo,
seg√∫n la configuraci√≥n). Se borran los datos recibidos en el momento de la cancelaci√≥n de la conexi√≥n, pero
todav√≠a no adoptados en el programa de usuario.
Se genera adicionalmente una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 4)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n de Reset se ha transmitido con √©xito al CP. Se
han impulsado la cancelaci√≥n y el subsiguiente estableci‚Äê
miento de todas las conexiones.

RESULT1

0000 0002H

La petici√≥n de Reset no se ha podido transmitir al CP por
no estar iniciado el servicio en el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

CMD

Significado

5

CN_CLEAR_RESET ‚Äì inicializaci√≥n de la identificaci√≥n de Reset
Este comando resetea el identificador de reset (bit 15 en RESULT1) para la conexi√≥n seleccionada con la ID.
El CP se ha seleccionado a trav√©s del par√°metro LADDR.
Esta petici√≥n se ejecuta tambi√©n autom√°ticamente al leer el estado de la conexi√≥n (CMD=1); la petici√≥n enviable
por separado aqu√≠ descrita solo se necesita por lo tanto en casos especiales.
RESULT (para CMD = 5)

7356

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n de Clear se ha transmitido con √©xito al CP.

RESULT1

0000 0002H

La petici√≥n de Clear no se ha podido transmitir al CP por no
estar iniciado el servicio en el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CMD

Significado

6

CN_DISCON ‚àí connection disconnect
Este comando resetea la conexi√≥n que se hab√≠a seleccionado con ID y LADDR.
El reset de la conexi√≥n se realiza con una cancelaci√≥n de la misma.
Los datos guardados eventualmente en la pila se pierden sin advertencia. Despu√©s de esto no se produce ning√∫n
establecimiento autom√°tico de la conexi√≥n. La conexi√≥n se puede restablecer con la petici√≥n de control
CN_STARTCON. Se crea una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 6)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n se ha transmitido con √©xito al CP. Se ha inicia‚Äê
do la cancelaci√≥n de la conexi√≥n.

RESULT1

0000 0002H

La petici√≥n no se ha podido transmitir al CP por no estar
iniciado el servicio en el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

CMD

Significado

7

CN_STARTCON ‚àí start connection
Este comando establece una conexi√≥n seleccionada con ID y LADDR y que se cancel√≥ antes con la petici√≥n de
control CN_DISCON. Se crea una entrada en el b√∫fer de diagn√≥stico, en la que se puede ver el resultado de la
petici√≥n.
RESULT (para CMD = 6)

Significado

Par√°metro

Valor Hex/rango

RESULT1

0000 0001H

La petici√≥n de establecimiento de la conexi√≥n se ha trans‚Äê
mitido con √©xito al CP. Se ha iniciado el establecimiento de
la conexi√≥n.

RESULT1

0000 0002H

La petici√≥n de establecimiento de la conexi√≥n no se ha
podido transmitir al CP por no estar iniciado el servicio en
el CP (p. ej. CP en STOP).

RESULT2

0000 0000H

Valor predeterminado

Informaciones adicionales
Observe las indicaciones adicionales que aparecen bajo la siguiente ID de art√≠culo en las
preguntas frecuentes (FAQ): 33414377 (http://support.automation.siemens.com/WW/view/es/
33414377)

Consulte tambi√©n
AG_CNTRL (P√°gina 7347)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7357

Instrucciones
4.2 Instrucciones

Instrucciones para PROFINET IO
Instrucciones para PROFINET IO
Panor√°mica
Para la transmisi√≥n c√≠clica de datos en la interfaz PROFINET IO est√°n disponibles las
instrucciones citadas a continuaci√≥n. El significado de las instrucciones difiere dependiendo de
que el CP se utilice como PROFINET IO-Controller o como PROFINET IO-Device en un equipo
S7.
Instrucci√≥n

utilizable para

S7-300

S7-400

PNIO_SEND

x

Significado

-

Dependiendo del modo de funcionamien‚Äê
to del CP:
‚óè En el PROFINET IO-Controller
Recibir datos de salida de procesos
de los PROFINET IO-Devices.
‚óè En el PROFINET IO-Device
Transmitir datos de entrada de
procesos al PROFINET IO-Controller.

PNIO_RECV

x

-

Dependiendo del modo de funcionamien‚Äê
to del CP:
‚óè En el PROFINET IO-Controller
Recibir datos de entrada de procesos
de los PROFINET IO-Devices.
‚óè En el PROFINET IO-Device
Recibir datos de salida de procesos
del PROFINET IO-Controller.

Para CPs en funcionamiento paralelo de PROFINET IO‚àíController e IO-Device est√°n
disponibles las instrucciones a partir de la versi√≥n 2.0.
Para la transmisi√≥n de datos ac√≠clica (registros de datos, informaciones de alarma) en la
interfaz PROFINET IO est√°n disponibles las instrucciones citadas a continuaci√≥n. Ambas
instrucciones se pueden utilizar s√≥lo en el modo de PROFINET IO-Controller.
Instrucci√≥n

utilizable para

S7-300

S7-400

PNIO_RW_REC

x

Significado
-

‚óè Leer registro de datos
(de un PROFINET IO-Device)
‚óè Escribir registro de datos
(en un PROFINET IO-Device)

PNIO_ALARM

7358

x

-

Recibir informaciones de alarma de
los PROFINET IO-Devices

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Instrucciones para la transmisi√≥n c√≠clica de datos √∫tiles
PNIO_SEND
PNIO_SEND
Descripci√≥n
La instrucci√≥n PNIO_SEND se utiliza para la transferencia de datos en los modos de
funcionamiento del CP como controlador PROFINET IO o dispositivo PROFINET IO.
‚óè Funcionamiento como controlador PROFINET IO
La instrucci√≥n transfiere los datos de proceso (salidas) de un √°rea de salida indicada al CP,
para su transmisi√≥n a los dispositivos PROFINET IO y proporciona como indicador de
estado el IO Consumer Status (IOCS) de las salidas de los dispositivos PROFINET IO.
‚óè Funcionamiento como dispositivo PROFINET IO
La instrucci√≥n lee las entradas de procesos pretratadas de la CPU en el dispositivo
PROFINET IO y las transfiere al controlador PROFINET IO (direcciones de entrada
configuradas). Adicionalmente, la instrucci√≥n proporciona como indicador de estado el IO
Consumer Status (IOCS) del controlador PROFINET IO.
Los datos de proceso pretratados se ponen a disposici√≥n en un DB o en el √°rea de marcas.
Para CPs en funcionamiento paralelo de controlador y dispositivo PROFINET IO est√°
disponible la instrucci√≥n a partir de la versi√≥n 2.0. Con el par√°metro adicional MODE se ajusta
el modo de operaci√≥n para el que se debe llamar la instrucci√≥n.

Interfaz de llamada (versi√≥n 2.0)
Interfaz de llamada en representaci√≥n FUP
31,2B6(1'
:25'

&3/$''5

%<7(
,17
$1<

'21(

%22/

02'(

(5525

%22/

/(1

67$786

:25'

6(1'

,2&6
&+(&.B,2&6

$1<
%22/

Consulte tambi√©n
Comportamiento general de las instrucciones para PROFINET IO (P√°gina 7372)
Coherencia de los datos (P√°gina 7373)
Par√°metros en el caso de PNIO_SEND (P√°gina 7360)
Par√°metros DONE, ERROR, STATUS (IE) (P√°gina 7364)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7359

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de PNIO_SEND
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la instrucci√≥n
PNIO_SEND:
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

Rango de valores

Descripci√≥n

CPLADDR

INPUT

WORD

-

Direcci√≥n inicial del m√≥dulo

MODE

INPUT

BYTE

Valores para X:

Indicaci√≥n en forma XY (hexadecimal):

‚óè 0YH: los bits de estado se
transfieren a IOCS.

‚óè X ajusta la transferencia de
informaci√≥n de estado.

(par√°metros a
partir de la ver‚Äê
si√≥n 2.0)

‚óè Y indica el modo de operaci√≥n del CP
‚óè 8YH: limitaci√≥n a aviso de
grupo en CHECK_IOCS;
como controlador IO o dispositivo IO.
ning√∫n bit de estado en IOCS. Observaciones sobre la compatibilidad:
Valores para Y:
‚óè La instrucci√≥n de la versi√≥n 1.0 se
‚óè X0H:
‚Äì

Modo de controlador IO

‚Äì

Modo de dispositivo IO
(cuando no hay
funcionamiento paralelo)

Hay compatibilidad con la
instrucci√≥n en la versi√≥n 1.0

puede seguir utilizando si el CP no
opera en paralelo como controlador
IO y como dispositivo IO.

‚óè La instrucci√≥n de la versi√≥n a partir de
2.0 se comporta con MODE=0 como
la instrucci√≥n de la versi√≥n 1.0.

‚óè X1H: modo de dispositivo IO
(con funcionamiento paralelo)

7360

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

SEND

IN_OUT

Rango de valores

ANY (como La direcci√≥n del √°rea de datos re‚Äê
VARTYPE mite como alternativa a:
solo se per‚Äê ‚óè √Årea de marcas
mite BYTE)
‚óè √Årea de bloques de datos

Descripci√≥n
Indicar la direcci√≥n y la longitud
Modo de controlador IO:
La longitud deber√≠a ser acorde con la lon‚Äê
gitud total configurada de la periferia des‚Äê
centralizada; los huecos en las direccio‚Äê
nes se transmiten conjuntamente.
La longitud puede ser tambi√©n menor que
la longitud total de la periferia descentra‚Äê
lizada, por ejemplo si la instrucci√≥n se lla‚Äê
ma varas veces en 1 OB. Sin embargo
debe tener la longitud total en al menos
una llamada.
Modo de dispositivo IO:
La estructura de datos resulta del orden
de los slots de los m√≥dulos de entrada
configurados en la l√≠nea del controlador
PROFINET IO para este dispositivo PRO‚Äê
FINET IO y de su longitud sin huecos en
direcciones.
(Observe al respecto las explicaciones
complementarias o los ejemplos relativos
a su CP en la Parte B de este manual,
espec√≠fica del equipo)
Notas:
‚óè La instrucci√≥n comienza con la
transmisi√≥n de datos con la direcci√≥n
0, independientemente de c√≥mo haya
configurado las direcciones (con
independencia de la m√≠nima direcci√≥n
configurada).
‚óè No se permite indicar un √°rea de
periferia, ya que primero tiene que
comprobar el IOCS en cuanto a
GOOD, antes de que se puedan
adoptar los datos en la periferia.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7361

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

Rango de valores

Descripci√≥n

LEN

INPUT

Valor > 0

Longitud del sector de datos a transmitir
en bytes.

INT

Consulte la m√°xima longitud total
de las √°reas de datos a transmitir
en la Parte B de este manual, es‚Äê
pec√≠fica del equipo, en el capitulo
‚ÄúDatos de rendimiento‚Äú. Puede
ser diferente para el modo de
controlador y el modo de disposi‚Äê
tivo.

La transmisi√≥n de los datos comienza for‚Äê
zosamente con la direcci√≥n 0, con inde‚Äê
pendencia de la configuraci√≥n. Observe
que se tiene en cuenta la direcci√≥n IO "0"
con la longitud=1.
Modo de controlador IO:
‚óè Aqu√≠ se tiene que indicar la direcci√≥n
configurada de valor m√°s alto de los
dispositivos. Las distintas √°reas no se
agrupan.
En el caso de una llamada repetida de
la instrucci√≥n, LEN puede ser tambi√©n
menor que la mayor direcci√≥n. Al
menos en una llamada se deber√≠a
indicar la mayor direcci√≥n (v√©ase el
par√°metro "SEND").
‚óè Los datos se transmiten en el orden
de las direcciones l√≥gicas (como en
PROFIBUS DP).
Modo de dispositivo IO:
‚óè Los datos se transmiten en el orden
de los slots, tal como se han
configurado los m√≥dulos de entrada
en la l√≠nea del controlador PROFINET
IO para este dispositivo PROFINET
IO.
Nota:
Tiene que asegurarse de que haya
coherencia entre la longitud aqu√≠
programada y la configuraci√≥n del
controlador PROFINET IO. En el caso
del dispositivo se transmite la longitud
total del √°rea de datos, incluidas
eventuales lagunas.

DONE

OUTPUT

BOOL

0: 1: nuevos datos aceptados

El par√°metro de estado indica si la peti‚Äê
ci√≥n se ha desarrollado correctamente.

ERROR

OUTPUT

BOOL

0: -1: Error

Indicador de error

STATUS

OUTPUT

WORD

-

Indicador de estado

7362

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

Rango de valores

Descripci√≥n

CHECK_IOCS

OUTPUT

BOOL

0: todos los IOCS en GOOD

Bit auxiliar que se√±aliza si es necesario
evaluar el √°rea de estado IOCS

IOCS

OUTPUT

ANY (como La direcci√≥n del √°rea de datos re‚Äê
VARTYPE mite como alternativa a:
solo se per‚Äê ‚óè √Årea de marcas
mite BYTE)
‚óè √Årea de bloques de datos

1: al menos un IOCS en BAD

Longitud:
Vea el valor m√°ximo en la Parte B
de este manual, espec√≠fica del
equipo, cap√≠tulo ‚ÄúDatos de rendi‚Äê
miento‚Äú. Puede ser diferente para
el modo de controlador y el modo
de dispositivo.

Por cada byte de datos √∫tiles se transmite
un bit de estado.
El dato de longitud depende de la longitud
en el par√°metro LEN (un bit por cada byte)
= (longitud LEN + 7/ 8)
Modo de controlador:
conforme al par√°metro SEND se transmi‚Äê
ten tambi√©n huecos en direcciones.
Huecos en direcciones se transmiten con
el estado GOOD.
Modo de dispositivo:
los huecos en direcciones no se transmi‚Äê
ten.
La instrucci√≥n comienza con la transmi‚Äê
si√≥n del estado para la direcci√≥n 0.
Nota:
la longitud m√≠nima del puntero ANY es
(longitud LEN + 7/ 8)

Nota
Tenga en cuenta que todos los par√°metros de salida solo se deben evaluar cuando la
instrucci√≥n se√±alice DONE = 1 o ERROR = 1.
Nota
Tiene que partir de que el estado de IOCS suministrado no llega sincronizado en cuanto al
tiempo con los datos (par√°metro SEND), sino con una demora equivalente al ciclo del
programa de usuario. Esto significa: Los datos de usuario y IOCS no son coherentes.

Consulte tambi√©n
PNIO_SEND (P√°gina 7359)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7363

Instrucciones
4.2 Instrucciones

Par√°metros DONE, ERROR, STATUS (IE)
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga tambi√©n en cuenta lo indicado
en el manual de referencia STEP 7 Standard y funciones del sistema. All√≠ encontrar√°
informaciones en el cap√≠tulo "Evaluaci√≥n de fallos con el par√°metro de salida RET_VAL".
A trav√©s del di√°logo de propiedades de las instrucciones aqu√≠ descritas se puede visualizar en
la ficha ‚ÄúLlamadas" qu√© instrucciones del sistema que son relevantes para la evaluaci√≥n de
errores se utilizan.

Tabla 4-422 C√≥digos de condici√≥n PNIO_SEND
DONE

ERROR

STATUS

Significado

0

0

8180H

‚óè Transfiriendo datos;
o bien
‚óè El CP est√° en el estado operativo STOP.

0

0

8181H

1

0

0000H

Nuevos datos transferidos sin error.

0

1

8183H

‚óè Falta configuraci√≥n PROFINET IO;

El m√≥dulo no es compatible con la versi√≥n 2.0 de la instrucci√≥n.
Soluci√≥n: utilizar la versi√≥n 1.0.

o bien
‚óè CPLADDR incorrecta;
o bien
‚óè El CP est√° en el estado operativo STOP.
o bien
‚óè El conexionado de MODE no armoniza con la configuraci√≥n del m√≥dulo o se tiene un
conexionado incorrecto con MODE > 1
Para el modo Device, adicionalmente:
‚óè La conexi√≥n entre PROFINET IO-Controller y PROFINET IO-Device est√°
interrumpida,
o bien
‚óè PROFINET IO-Controller no accesible
o bien
‚óè Longitudes totales (configuraci√≥n y par√°metro LEN) no coherentes.
0

1

8184H

Error del sistema o tipo de par√°metro no permitido.

0

1

8185H

El par√°metro LEN es mayor que el √°rea de origen SEND o el b√∫fer de destino (IOCS) no
es suficientemente grande.

0

1

8F22H

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

7364

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

1

8F24H

Error de √°rea al leer un par√°metro.

0

1

8F25H

Error de √°rea al escribir un par√°metro.

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro.

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos act. protegido de escritura.

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos act. protegido de escritura.

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F3AH

√Årea de destino no cargada (DB).

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia.

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia.

0

1

8F44H

Est√° bloqueado el acceso a un par√°metro a leer para el procesamiento de la instrucci√≥n.

0

1

8F45H

Est√° bloqueado el acceso a un par√°metro a escribir para el procesamiento de la instruc‚Äê
ci√≥n.

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

0

1

8090H

No existe ning√∫n m√≥dulo con esta direcci√≥n.

0

1

80A0H

Acuse negativo al leer del m√≥dulo.

0

1

80A1H

Acuse negativo al escribir en el m√≥dulo.

0

1

80B0H

El m√≥dulo desconoce el registro.

0

1

80B1H

‚óè La longitud de registro indicada es incorrecta.
o bien
‚óè El CP pasa al estado STOP.

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Recursos (memoria) ocupados.

0

1

80C4H

Error de comunicaci√≥n (aparece temporalmente; por ello es conveniente una repetici√≥n
en el programa de usuario.)

Consulte tambi√©n
PNIO_SEND (P√°gina 7359)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7365

Instrucciones
4.2 Instrucciones

PNIO_RECV
PNIO_RECV
Descripci√≥n
La instrucci√≥n PNIO_RECV se utiliza para la transmisi√≥n de datos en los modos de
funcionamiento del CP como controlador PROFINET IO o dispositivo PROFINET IO.
‚óè Funcionamiento como controlador PROFINET IO
La instrucci√≥n transfiere los datos de proceso de los dispositivos PROFINET IO (entradas
del controlador), as√≠ como el IO Provider Status (IOPS) de los dispositivos PROFINET IO
a las √°reas de entrada indicadas.
‚óè Funcionamiento como dispositivo PROFINET IO
La instrucci√≥n transfiere los datos de proceso transmitidos por el controlador PROFINET IO
(direcciones de salida configuradas), as√≠ como el IO Provider Status (IOPS) del controlador
PROFINET IO y los escribe en las √°reas de datos reservadas para las salidas de procesos
en la CPU del dispositivo PROFINET IO.
Para CPs en funcionamiento paralelo de controlador y dispositivo PROFINET IO est√°
disponible la instrucci√≥n a partir de la versi√≥n 2.0. Con el par√°metro adicional MODE se ajusta
el modo de operaci√≥n para el que se debe llamar la instrucci√≥n.

Interfaz de llamada (versi√≥n 2.0)
Interfaz de llamada en representaci√≥n FUP
31,2B5(&9
:25'

&3/$''5

%<7(

02'(

,17

/(1

5(&9

$1<

1'5

%22/

(5525

%22/

67$786

:25'

,236
&+(&.B,236
$''B,1)2

$1<
%22/
:25'

Consulte tambi√©n
Comportamiento general de las instrucciones para PROFINET IO (P√°gina 7372)
Coherencia de los datos (P√°gina 7373)
Par√°metros en el caso de PNIO_RECV (P√°gina 7367)
Par√°metros NDR, ERROR, STATUS (IE) (P√°gina 7371)

7366

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de PNIO_RECV
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la instrucci√≥n
PNIO_RECV:
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

CPLADDR

INPUT

WORD

-

Direcci√≥n inicial del m√≥dulo

MODE

INPUT

BYTE

Valores para X:

Indicaci√≥n en forma XY (hexadecimal):

‚óè 0YH: los bits de estado se
transfieren a IOCS.

‚óè X ajusta la transferencia de informaci√≥n de
estado.

(par√°metros
a partir de la
versi√≥n 2.0)

‚óè 8YH: limitaci√≥n a aviso de
‚óè Y indica el modo de operaci√≥n del CP
grupo en CHECK_IOCS;
como controlador IO o dispositivo IO.
ning√∫n bit de estado en IOCS. Observaciones sobre la compatibilidad:
Valores para Y:
‚óè La instrucci√≥n de la versi√≥n 1.0 se puede
‚óè X0H:
‚Äì

Modo de controlador IO

‚Äì

Modo de dispositivo IO
(cuando no hay
funcionamiento paralelo)

Hay compatibilidad con la
instrucci√≥n en la versi√≥n 1.0

seguir utilizando si el CP no opera en
paralelo como controlador IO y como
dispositivo IO.

‚óè La instrucci√≥n de la versi√≥n a partir de 2.0
se comporta con MODE=0 como la
instrucci√≥n de la versi√≥n 1.0.

‚óè X1H: modo de dispositivo IO
(con funcionamiento paralelo)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7367

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

RECV

IN_OUT

ANY (co‚Äê
mo
VARTY‚Äê
PE solo se
permite
BYTE)

La direcci√≥n del √°rea de datos re‚Äê Indicar la direcci√≥n y la longitud
mite como alternativa a:
Modo de controlador IO:
‚óè √Årea de marcas
La longitud deber√≠a ser acorde con la longitud
total configurada de la periferia descentraliza‚Äê
‚óè √Årea de bloques de datos
da; los huecos en las direcciones se transmi‚Äê
ten conjuntamente.
La longitud puede ser tambi√©n menor que la
longitud total de la periferia descentralizada,
por ejemplo si la instrucci√≥n se llama varas ve‚Äê
ces en 1 OB. Sin embargo debe tener la lon‚Äê
gitud total en al menos una llamada.
Modo de dispositivo IO:
La estructura de datos resulta del orden de las
ranuras (slots) de los m√≥dulos de salida confi‚Äê
gurados en el ramal del PROFINET IO-Con‚Äê
troller para este PROFINET IO-Device y de su
longitud sin huecos en direcciones.
Notas:
‚óè La instrucci√≥n comienza con la transmisi√≥n
de datos con la direcci√≥n 0,
independientemente de c√≥mo haya
configurado las direcciones (con
independencia de la m√≠nima direcci√≥n
configurada).
‚óè No se permite indicar un √°rea de periferia,
ya que primero tiene que comprobar el
IOPS en cuanto a GOOD, antes de que se
puedan adoptar los datos en la periferia.

7368

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

LEN

INPUT

INT

Valor > 0

Longitud del sector de datos a transmitir en
bytes.

Consulte la m√°xima longitud total
de los datos a transmitir en la
Parte B de este manual en el ca‚Äê
pitulo ‚ÄúDatos de rendimiento‚Äú.
Puede ser diferente para el modo
de controlador y el modo de dis‚Äê
positivo.

La transmisi√≥n de los datos comienza forzosa‚Äê
mente con la direcci√≥n 0, con independencia
de la configuraci√≥n. Observe que se tiene en
cuenta la direcci√≥n IO "0" con la longitud=1.
Modo de controlador IO:
‚óè Aqu√≠ se tiene que indicar la direcci√≥n
configurada de valor m√°s alto de los
dispositivos. Las distintas √°reas no se
agrupan.
En el caso de una llamada repetida de la
instrucci√≥n, LEN puede ser tambi√©n menor
que la mayor direcci√≥n. Al menos en una
llamada se deber√≠a indicar la mayor
direcci√≥n (v√©ase el par√°metro "RECV").
‚óè Los datos se transmiten en el orden de las
direcciones l√≥gicas (como en PROFIBUS
DP).
Modo de dispositivo IO:
‚óè Los datos se transmiten en el orden de los
slots, tal como se han configurado los
m√≥dulos de entrada en la l√≠nea del
controlador PROFINET IO para este
dispositivo PROFINET IO.
‚óè Nota:
Tiene que asegurarse de que haya
coherencia entre la longitud aqu√≠
programada y la configuraci√≥n del
controlador PROFINET IO. En el caso del
dispositivo se transmite la longitud total del
√°rea de datos, incluidas eventuales
lagunas.

NDR

OUTPUT

BOOL

0: 1: datos aceptados

El par√°metro de estado indica si la petici√≥n se
ha desarrollado correctamente.

ERROR

OUTPUT

BOOL

0: 1: error

Indicador de error

STATUS

OUTPUT

WORD

-

Indicador de estado

CHECK_
IOPS

OUTPUT

BOOL

0: todos los IOPS en GOOD

Bit auxiliar que se√±aliza si es necesario eva‚Äê
luar el √°rea de estado IOPS

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

1: al menos un IOPS en BAD

7369

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

IOPS

OUTPUT

ANY (co‚Äê
mo
VARTY‚Äê
PE solo se
permite
BYTE)

La direcci√≥n del √°rea de datos re‚Äê Por cada byte de datos √∫tiles se transmite un
mite como alternativa a:
bit de estado.
‚óè √Årea de marcas
‚óè √Årea de bloques de datos
Longitud:
Consulte el valor m√°ximo en la
Parte B de este manual en el ca‚Äê
p√≠tulo ‚ÄúDatos de rendimiento‚Äú.
Puede ser diferente para el modo
de controlador y el modo de dis‚Äê
positivo.

Descripci√≥n

El dato de longitud depende de la longitud en
el par√°metro RECV (un bit por cada byte)
= (longitud LEN + 7/ 8)
Modo Controller:
Conforme al par√°metro RECV se transmiten
tambi√©n huecos en direcciones.
Huecos en direcciones se transmiten con el
estado GOOD.
Modo Device:
Huecos en direcciones no se transmiten.
La instrucci√≥n comienza con la transmisi√≥n del
estado para la direcci√≥n 0.
Nota:
‚óè La longitud m√≠nima del puntero ANY es
(longitud LEN + 7/ 8)

ADD_INFO

OUTPUT

WORD

Informaci√≥n de diagn√≥stico adi‚Äê
cional
En el modo Controller:
‚óè 0: ninguna alarma
‚óè >0: cantidad de alarmas
existentes
En el modo Device el par√°metro
es siempre = 0.

Extensi√≥n de par√°metro
Nota:
el par√°metro ADD_INFO se actualiza tambi√©n
aunque en el controlador PROFINET IO no
est√© configurada ninguna direcci√≥n INPUT. En
este caso se llama la instrucci√≥n PNIO_RECV
con una longitud LEN > 0 (p. ej. LEN = 1 byte).
Transmite entonces una laguna de direccio‚Äê
nes de 1 Byte.
La extensi√≥n de par√°metros se puede utilizar
para CPs a partir de la siguiente versi√≥n de
firmware (FW):
‚óè CP 343‚àí1 (EX30) a partir de FW V2.0
‚óè CP 343‚àí1 Lean (CX10) a partir de FW V2.0
‚óè CP 343‚àí1 Advanced (GX30) a partir de
FW V1.0
En versiones de firmware m√°s antiguas, el pa‚Äê
r√°metro est√° reservado.

Nota
Tenga en cuenta que todos los par√°metros de salida solo se deben evaluar cuando la
instrucci√≥n se√±alice NDR = 1 o ERROR = 1.

Consulte tambi√©n
PNIO_RECV (P√°gina 7366)

7370

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros NDR, ERROR, STATUS (IE)
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por los par√°metros
NDR, ERROR y STATUS, que tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga tambi√©n en cuenta lo indicado
en el manual de referencia STEP 7 Standard y funciones del sistema. All√≠ encontrar√°
informaciones en el cap√≠tulo "Evaluaci√≥n de fallos con el par√°metro de salida RET_VAL".
A trav√©s del di√°logo de propiedades de las instrucciones aqu√≠ descritas se puede visualizar en
la ficha ‚ÄúLlamadas" qu√© instrucciones del sistema que son relevantes para la evaluaci√≥n de
errores se utilizan.

Tabla 4-423 C√≥digos de condici√≥n de PNIO_RECV
NDR

ERROR

STATUS

Significado

0

0

8180H

‚óè Adoptando datos;
o bien
‚óè El CP est√° en el estado operativo STOP.

0

0

8181H

1

0

0000H

Nuevos datos aceptados sin error.

0

1

8183H

‚óè Falta configuraci√≥n PROFINET IO;

El m√≥dulo no es compatible con la versi√≥n 2.0 de la instrucci√≥n.
Soluci√≥n: utilizar la versi√≥n 1.0.

o bien
‚óè CPLADDR incorrecta;
o bien
‚óè El CP est√° en el estado operativo STOP.
o bien
‚óè El conexionado de MODE no armoniza con la configuraci√≥n del m√≥dulo o se tiene un
conexionado incorrecto con MODE > 1.
Para el modo Device, adicionalmente:
‚óè La conexi√≥n entre PROFINET IO-Controller y PROFINET IO-Device est√°
interrumpida
o bien
‚óè PROFINET IO-Controller no accesible
o bien
‚óè Longitudes totales (configuraci√≥n y par√°metro LEN) no coherentes.
0

1

8184H

Error del sistema o tipo de par√°metro no permitido.

0

1

8185H

B√∫fer de destino (RECV o IOCS) demasiado peque√±o.

0

1

8F22H

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7371

Instrucciones
4.2 Instrucciones
NDR

ERROR

STATUS

Significado

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

1

8F24H

Error de √°rea al leer un par√°metro.

0

1

8F25H

Error de √°rea al escribir un par√°metro.

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro.

0

1

8F30H

El par√°metro se encuentra en el 1er. bloque de datos act. protegido contra escritura.

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos act. protegido contra escritura.

0

1

8F32H

El par√°metro contiene un n√∫mero de DB demasiado alto.

0

1

8F3AH

√Årea de destino no cargada (DB).

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia.

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia.

0

1

8F44H

Est√° bloqueado el acceso a un par√°metro a leer para el procesamiento de la instrucci√≥n.

0

1

8F45H

Est√° bloqueado el acceso a un par√°metro a escribir para el procesamiento de la instruc‚Äê
ci√≥n.

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

0

1

8090H

No existe ning√∫n m√≥dulo con esta direcci√≥n.

0

1

80A0H

Acuse negativo al leer del m√≥dulo.

0

1

80A1H

Acuse negativo al escribir en el m√≥dulo.

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

‚óè La longitud de registro indicada es incorrecta.
o bien
‚óè El CP pasa al estado operativo STOP.

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Medio de servicio (memoria) ocupado.

0

1

80C4H

Error de comunicaci√≥n (se produce temporalmente; por ello es conveniente una repeti‚Äê
ci√≥n en el programa de usuario.)

Consulte tambi√©n
PNIO_RECV (P√°gina 7366)

Comportamiento general de las instrucciones para PROFINET IO
IO Consumer Status (IOCS) y IO Provider Status (IOPS)
En los dos interlocutores de comunicaci√≥n, CPU/CP por un lado e IO-Device por otro, hay
disponible respectivamente una informaci√≥n de estado GOOD o BAD para los datos. Esta
informaci√≥n de estado se transmite paralela a los datos. El estado del interlocutor que env√≠a los
datos se denomina IOPS (IO Provider Status) y el estado del interlocutor que los recibe IOCS
(IO Consumer Status).

7372

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El estado IOPS y el estado IOCS no son forzosamente id√©nticos. Puede ocurrir, por ejemplo,
que la CPU S7-300 se encuentre en el estado Stop (Output Disable o no se ejecutan
instrucciones PROFINET IO). En tal caso, el CP transmite, como PROFINET IO-Controller, el
estado BAD a los IO-Devices.

Relaci√≥n entre llamada de la instrucci√≥n y datos IO
‚óè Funcionamiento como PROFINET IO-Controller
Como PROFINET IO-Controller, el CP no supervisa la llamada c√≠clica de las instrucciones
PNIO_SEND/RECV. Si no se llaman las instrucciones, se considerar√°n v√°lidos los √∫ltimos
datos IO y IOCS/IOPS transmitidos.
‚óè Funcionamiento como PROFINET IO-Device
PNIO_SEND y PNIO_RECV tienen respectivamente un Watchdog propio. Dependiendo
del tiempo de ciclo de la CPU se deshace la conexi√≥n con el PROFINET IO-Controller si tras
la fase de inicializaci√≥n no se llama ya m√°s una de las dos instrucciones.

Optimizaci√≥n de la transmisi√≥n de datos (s√≥lo en el modo de PROFINET IO-Controller)
Es posible llamar las instrucciones con una longitud (par√°metro LEN) menor que la longitud
total configurada de los datos de E/S en el ramal PNIO.
Esto se puede aprovechar en el sentido de que datos cr√≠ticos en cuanto al tiempo se transmitan
en cada ciclo de CPU, no transmiti√©ndose por el contrario en cada ciclo datos no cr√≠ticos.
Ejemplo:
Transmita, por ejemplo, en cada ciclo s√≥lo el primer sector de datos (datos cr√≠ticos en cuanto
al tiempo) y en cada segundo ciclo la longitud total de los datos de E/S configurados. Para ello,
al configurar tiene que poner los datos cr√≠ticos en cuanto al tiempo en el sector inferior (a partir
de la direcci√≥n de E/S 0).

Coherencia de los datos
Se transmite siempre todo el √°rea de datos de entradas y salidas del controlador PROFINET
IO de forma completa y, por lo tanto, coherente.
‚óè Funcionamiento como PROFINET IO-Controller
Independientemente de ello, indicando la longitud en la llamada de la instrucci√≥n tiene la
posibilidad de leer o emitir de forma coherente un √°rea de datos de entrada o salida menor
que la configurada.
Observaci√≥n: Tenga en cuenta, sin embargo, que en lo que se refiere a los "datos √∫tiles IO",
dentro de un sistema PROFINET IO s√≥lo se puede garantizar la coherencia de los datos dentro
de los distintos slots IO. Esto es independiente de que para las instrucciones aqu√≠ descritas se
garantice una transferencia de datos coherente entre la CPU y el IO-Controller.

Llamada de la instrucci√≥n
Sin embargo, para asegurar la coherencia de los datos s√≥lo se debe acceder a los datos IO si
la instrucci√≥n se ha finalizado sin errores (par√°metro Output NDR = TRUE). Adem√°s se tiene
que comprobar si el estado IOCS o IOPS para los datos es = GOOD.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7373

Instrucciones
4.2 Instrucciones

Ejemplo
Normalmente (dependiendo de la longitud total de los datos IO), la instrucci√≥n se ejecuta a lo
largo de varios ciclos del programa de usuario, hasta que se notifica el indicador DONE/NDR
= 1.
/ODPDUHOEORTXH31,2B5(&9KDVWDTXH1'5 

&RPSUREDUHOHVWDGR,236GHORVGDWRVUHFLELGRV GH
31,2'HYLFHV 
VLHVQHFHVDULRSURFHGHUDOWUDWDPLHQWRGHHUURUHV

3UHSDUDU\WUDWDUGDWRVSUHSDUDUQXHYRVGDWRVGHVDOLGD


/ODPDUHOEORTXH31,2B6(1'KDVWDTXH'21( 

&RPSUREDUORVYDORUHVGHHVWDGR,2&6UHFLELGRVGHORV
31,2'HYLFHV
VLHVQHFHVDULRSURFHGHUDOWUDWDPLHQWRGHHUURUHV

Observaci√≥n: El ciclo del programa de usuario y el ciclo del intercambio de datos IO entre el
controlador PROFINET IO y los dispositivos PROFINET IO son independientes el uno del otro.

Valores de sustituci√≥n
Casos de operaci√≥n
La conexi√≥n de valores de sustituci√≥n se soporta para los dos casos de operaci√≥n siguientes:
‚óè Valores de sustituci√≥n en el arranque (cambio de estado operativo de la CPU de STOP a
RUN)
‚óè Valores sustitutivos en caso de anomal√≠as (desenchufado/enchufado o fallo/restauraci√≥n
de la estaci√≥n)

Valores de sustituci√≥n en el arranque
Las salidas se pueden inicializar con valores de sustituci√≥n poniendo en el OB de arranque un
marcador ("Arranque"). En r√©gimen c√≠clico (OB1), eval√∫e entonces este marcador de
"arranque" para llamar, si procede, la instrucci√≥n PNIO_SEND con los valores de inicializaci√≥n.

7374

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Valores sustitutivos en caso de anomal√≠as (s√≥lo en el modo de PROFINET IO-Controller)
En caso de aver√≠a (ha fallado el device/m√≥dulo) puede determinar qu√© m√≥dulos han fallado
consultando las informaciones de estado IOCS / IOPS. Entonces tiene la posibilidad de aplicar
valores sustitutivos.

PNIO_RW_REC
PNIO_RW_REC
Descripci√≥n
RW_REC sirve, en el modo de controlador PROFINET IO, tanto para la funci√≥n "Leer registro"
como para la funci√≥n "Escribir registro". RW_REC solo puede ejecutar una de las dos
funciones al mismo tiempo. La funci√≥n ‚ÄúLeer registro" o ‚ÄúEscribir registro" se controla a trav√©s
del par√°metro WRITE_REC.
Ejemplo: El indicativo del sistema y el indicativo de localizaci√≥n se le pueden comunicar al CP
a trav√©s de la funci√≥n "Escribir registro" (en tanto estos par√°metros no se hayan ajustado ya en
STEP 7 en el di√°logo de propiedades del CP). Para ello se usa el registro de mantenimiento
‚ÄúIM1" con el √≠ndice AFF1H.
Si desea detalles sobre los registros a los que se da soporte as√≠ como sobre su estructura,
puede consultarlos a trav√©s de la siguiente direcci√≥n de Internet:
http://support.automation.siemens.com/WW/view/de/19289930

Interfaz de llamada
Interfaz de llamada en representaci√≥n FUP:
PNIO_RW_REC
WORD

CPLADDR

BOOL

WRITE_REC

WORD

ID

WORD

INDEX

INT

LEN

ANY

RECORD

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

DONE

BOOL

ERROR

BOOL

STATUS

WORD

7375

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Par√°metros DONE, ERROR, STATUS (IE) (P√°gina 7377)
Par√°metros en el caso de PNIO_RW_REC (P√°gina 7376)

Par√°metros en el caso de PNIO_RW_REC
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la instrucci√≥n
PNIO_RW_REC:
Par√°metro

Declara‚Äê
ci√≥n

Tipo de da‚Äê
tos

Valores posibles

Descripci√≥n

CPLADDR

INPUT

WORD

-

Direcci√≥n inicial del m√≥dulo

WRITE_REC

INPUT

BOOL

0: Leer registro de da‚Äê
tos
1: Escribir registro

Tipo de petici√≥n;
El par√°metro no se debe modificar durante el tiempo de
ejecuci√≥n de la instrucci√≥n.

ID

INPUT

WORD

Direcci√≥n l√≥gica del componente PROFINET IO (grupo
o m√≥dulo). En caso de un m√≥dulo de salida se tiene que
poner Bit 15
(ejemplo para la direcci√≥n de salida 5:
ID:=DW#16#8005).
En caso de un m√≥dulo mixto se tiene que indicar la
menor de ambas direcciones.

INDEX

INPUT

WORD

N√∫meros de los registros de datos que el usuario desea
V√©ase en la informa‚Äê
ci√≥n del fabricante qu√© leer o escribir.
n√∫meros de registro de
datos son soportados
por el grupo o el m√≥du‚Äê
lo.

DONE

OUTPUT

BOOL

0: 1: Registro de datos
transmitido correcta‚Äê
mente

El par√°metro de estado indica si se han aceptado nue‚Äê
vos datos.

ERROR

OUTPUT

BOOL

0: 1: error

Indicaci√≥n de fallo

STATUS

OUTPUT

WORD

0: ning√∫n error
otro valor: error
(ver "Par√°metros DO‚Äê
NE, ERROR, STATUS
(IE) (P√°gina 7377)")

Indicaci√≥n de estado

7376

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declara‚Äê
ci√≥n

Tipo de da‚Äê
tos

Valores posibles

Descripci√≥n

LEN

IN_OUT

INT

La longitud m√°xima es
480 Byte.

‚óè Leer registro de datos:
Par√°metro OUTPUT puro; tras una lectura correcta
se indica aqu√≠ la longitud del registro de datos le√≠do;
en otro caso 0.
‚óè Escribir registro de datos:
Par√°metro INPUT puro; el usuario tiene que indicar
aqu√≠ la longitud del registro de datos a escribir. La
longitud tiene que ser conforme a la definici√≥n del
registro de datos.

RECORD

IN_OUT

ANY (como
VARTYPE
se permi‚Äê
ten BYTE,
WORD y
DWORD)

La direcci√≥n del sector
de datos remite como
alternativa a:
‚óè √Årea de marcas
‚óè √Årea de bloques de
datos
La longitud del puntero
Any tiene que ser ma‚Äê
yor o igual a la defini‚Äê
ci√≥n del registro de da‚Äê
tos.

‚óè Leer registro de datos:
Par√°metro OUTPUT puro; tras una lectura correcta
se almacenan aqu√≠ los datos del registro de datos.
Si la longitud del puntero ANY es insuficiente, se
transmiten tantos datos como sea posible.
‚óè Escribir registro de datos:
Par√°metro INPUT puro; el usuario almacena aqu√≠
los datos a escribir del registro de datos. La longitud
del puntero ANY tiene que ser al menos tal como
predetermina el par√°metro LEN.

Consulte tambi√©n
PNIO_RW_REC (P√°gina 7375)

Par√°metros DONE, ERROR, STATUS (IE)
Indicadores
La tabla siguiente informa sobre la indicaci√≥n a evaluar por el programa de usuario, formada
por DONE, ERROR y STATUS.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, observe tambi√©n lo indicado en el
manual de referencia "STEP 7 - Funciones del sistema y est√°ndar para S7-300 y S7-400". All√≠
encontrar√° informaciones en el cap√≠tulo "Evaluaci√≥n de fallos con el par√°metro de salida
RET_VAL".

Tabla 4-424 Indicadores PNIO_RW_REC
DONE

ERROR

STATUS

Significado

0

0

8180H

Transfiriendo datos

1

0

0000H

Registro de datos transmitido correctamente

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7377

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8183H

‚óè Falta la configuraci√≥n del controlador PROFINET IO,
‚óè CPLADDR incorrecta
o bien
‚óè CP en estado operativo STOP

0

1

8184H

Error del sistema o tipo de par√°metro no permitido

0

1

8185H

B√∫fer de destino (RECORD) demasiado peque√±o.

0

1

8F22H

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

1

8F24H

Error de campo al leer un par√°metro

0

1

8F25H

Error de campo al escribir un par√°metro

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos activo protegido de escritura

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos activo protegido de escritura

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado grande

0

1

8F3AH

√Årea de destino no cargada (DB)

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia

0

1

8F44H

Est√° bloqueado el acceso a un par√°metro a leer para el procesamiento de la instrucci√≥n

0

1

8F45H

Est√° bloqueado el acceso a un par√°metro a escribir para el procesamiento de la instruc‚Äê
ci√≥n

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

0

1

8090H

No existe m√≥dulo con esta direcci√≥n

0

1

80A0H

Acuse negativo al leer del m√≥dulo

0

1

80A1H

Acuse negativo al escribir en el m√≥dulo

0

1

80A3H

Error general del PROFINET IO-Context-Management

0

1

80A9H

PROFINET IO-Device o m√≥dulo se√±aliza un tipo no permitido

0

1

80B0H

El m√≥dulo no conoce el registro

0

1

80B1H

‚óè La longitud de registro de datos indicada es incorrecta
o bien
‚óè El CP pasa al estado STOP

0

1

80B2H

La direcci√≥n l√≥gica o la ranura configurada no est√° ocupada

0

1

80B4H

PROFINET IO-Device o m√≥dulo se√±aliza un acceso a un sector no permitido

0

1

80B6H

PROFINET IO-Device o m√≥dulo deniega el acceso

0

1

80B8H

El m√≥dulo se√±aliza un par√°metro no permitido

0

1

80C0H

No se puede leer el registro de datos

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Medios de operaci√≥n (memoria) ocupados

0

1

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conveniente una repeti‚Äê
ci√≥n en el programa de usuario.)

7378

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
PNIO_RW_REC (P√°gina 7375)

PNIO_Alarm
PNIO_ALARM
Descripci√≥n
La instrucci√≥n PNIO_ALARM sirve para la evaluaci√≥n de alarmas por un CP 343-1 empleado
como controlador PROFINET IO y se deber√≠a llamar en el programa de usuario del mismo si
en PNIO_RECV el par√°metro ADD_INFO es distinto de 0. Tras una transmisi√≥n completa y sin
errores de todos los par√°metros OUTPUT del PNIO_ALARM se confirman autom√°ticamente
las alarmas recibidas.
Las alarmas se transmiten en el orden cronol√≥gico de su se√±alizaci√≥n al programa de usuario.
Alarmas m√°s antiguas, a√∫n no se√±alizadas al programa de usuario, que se tornen obsoletas
debido a otras alarmas m√°s recientes, no son borradas por nuevas alarmas.
Nota
Mientras no se haya llamado a√∫n PNIO_ALARM, las alarmas se acusan autom√°ticamente a
nivel interno del CP.
Si PNIO_ALARM se ha llamado (al menos) una vez en el programa de usuario, tambi√©n se
tiene que seguir llamando para acusar recibo de alarmas pendientes. Tal es el caso si la
instrucci√≥n PNIO_RECV presenta en el par√°metro ADD_INFO un valor distinto de "0".
Si PNIO_ALARM no se vuelve a llamar despu√©s de haberlo llamado una o m√°s veces en el
programa de usuario, no se acusa recibo de las alarmas y no est√° garantizado que la
representaci√≥n de IO se actualice correctamente. Tal puede ser, por ejemplo, el caso tras una
alarma de retorno de estaci√≥n. La necesidad de la llamada de la instrucci√≥n PNIO_ALARM solo
se puede anular con un rearranque del CP (desconexi√≥n y reconexi√≥n de la tensi√≥n).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7379

Instrucciones
4.2 Instrucciones

Interfaz de llamada
Interfaz de llamada en representaci√≥n FUP
PNIO_ALARM
WORD

CPLADDR

DONE

BOOL

ERROR

BOOL

NEW

BOOL

DWORD

MODE

STATUS

WORD

ANY

TINFO

ID

WORD

ANY

AINFO

LEN

INT

Consulte tambi√©n
Par√°metros DONE, NEW, ERROR, STATUS (IE) (P√°gina 7382)
Par√°metros en el caso de PNIO_ALARM (P√°gina 7380)

Par√°metros en el caso de PNIO_ALARM
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la instrucci√≥n
PNIO_ALARM:
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

Valores posibles

Descripci√≥n

CPLADDR

INPUT

WORD

-

Direcci√≥n inicial del m√≥dulo causante de error

DONE

OUTPUT

BOOL

0: 1: informaci√≥n de alar‚Äê
ma transmitida correc‚Äê
tamente

El par√°metro de estado indica si la petici√≥n se ha desa‚Äê
rrollado correctamente.
Con DONE = 1 se tiene que comprobar adicionalmente
el par√°metro NEW.

ERROR

OUTPUT

BOOL

0: 1: error

Indicador de error

NEW

OUTPUT

BOOL

0: transmitiendo datos Con DONE = 1 y NEW = 1 se se√±aliza aqu√≠ una nueva
o no hay ninguna nue‚Äê alarma recibida.
va alarma
1: nueva alarma recibi‚Äê
da y acusada

STATUS

7380

OUTPUT

WORD

0: ning√∫n error
otro valor: error
(ver tabla 1‚Äì14)

Indicador de estado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

ID

OUTPUT

Valores posibles

WORD

Descripci√≥n
Direcci√≥n inicial l√≥gica del componente PNIO causante
de la alarma (grupo o m√≥dulo).
En caso de un m√≥dulo de salida se pone Bit 15 (ejemplo
para la direcci√≥n de salida 5: ID:=DW#16#8005).
En caso de un m√≥dulo mixto se indica la menor de am‚Äê
bas direcciones.

LEN

OUTPUT

INT

MODE

IN_OUT

DWORD

0

Reservado

TINFO

IN_OUT

ANY (como
VARTYPE
se permiten
BYTE,
WORD y
DWORD)

La direcci√≥n del sector
de datos remite como
alternativa a:

(task information)

AINFO

IN_OUT

ANY (como
VARTYPE
se permiten
BYTE,
WORD y
DWORD)

Longitud de la informaci√≥n de alarma recibida (AINFO)

‚óè √Årea de marcas
‚óè √Årea de bloques
de datos

√Årea de destino para informaci√≥n de administraci√≥n de
alarmas.
La informaci√≥n de inicio de OB de error (OB-Header =
Byte 0...19 de TINFO) es reproducida por el firmware
del CP, en la medida de lo posible.

La longitud del punte‚Äê
ro Any tiene que ser
>= 32 bytes.

V√©ase tambi√©n 1)

La direcci√≥n del sector
de datos remite como
alternativa a:

(alarm information)

‚óè √Årea de marcas
‚óè √Årea de bloques
de datos

√Årea de destino para informaci√≥n de cabecera e infor‚Äê
maci√≥n adicional de alarma. Si ANY-Pointer AINFO es
demasiado peque√±o, se recorta la informaci√≥n.
V√©ase tambi√©n 1)

La longitud del punte‚Äê
ro ANY tiene que ser
mayor o igual que la
m√°xima informaci√≥n
adicional de alarma
que se pueda recibir,
pero como m√°ximo
1432 bytes (ver el pa‚Äê
r√°metro LEN)

1) Manual de referencia "STEP 7 - Funciones del sistema y est√°ndar para S7-300 y S7-400",
Recibir alarma con la instrucci√≥n "RALRM"

Consulte tambi√©n
PNIO_ALARM (P√°gina 7379)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7381

Instrucciones
4.2 Instrucciones

Par√°metros DONE, NEW, ERROR, STATUS (IE)
Indicadores
La tabla siguiente informa sobre la indicaci√≥n a evaluar por el programa de usuario, formada
por DONE, NEW, ERROR y STATUS.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, observe tambi√©n lo indicado en el
manual de referencia "STEP 7 - Funciones del sistema y est√°ndar para S7-300 y S7-400". All√≠
encontrar√° informaciones en el cap√≠tulo "Evaluaci√≥n de fallos con el par√°metro de salida
RET_VAL".

Tabla 4-425 Indicadores PNIO_ALARM
DONE

NEW

ERROR

STATUS

Significado

0

0

0

8180H

Transfiriendo datos

1

1

0

0000H

Datos de alarma transmitidos correctamente y alarma acusada

1

0

0

0000H

No hay datos de alarma

0

0

1

8183H

‚óè Falta la configuraci√≥n del controlador PROFINET IO,
‚óè CPLADDR incorrecta
o bien
‚óè CP en estado operativo STOP

0

0

1

8184H

Error del sistema o tipo de par√°metro no permitido

0

0

1

8185H

B√∫fer de destino (TINFO o AINFO) demasiado peque√±o

0

0

1

8F22H

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

0

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

0

1

8F24H

Error de campo al leer un par√°metro

0

0

1

8F25H

Error de campo al escribir un par√°metro

0

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro

0

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos activo protegido de escritura

0

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos activo protegido de escritura

0

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado grande

0

0

1

8F3AH

√Årea de destino no cargada (DB)

0

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia

0

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia

0

0

1

8F44H

Est√° bloqueado el acceso a un par√°metro a leer para el procesamiento de la
instrucci√≥n.

0

0

1

8F45H

Est√° bloqueado el acceso a un par√°metro a escribir para el procesamiento de la
instrucci√≥n.

0

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

0

0

1

8090H

No existe m√≥dulo con esta direcci√≥n

0

0

1

80A0H

Acuse negativo al leer del m√≥dulo

7382

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

NEW

ERROR

STATUS

Significado

0

0

1

80A1H

Acuse negativo al escribir en el m√≥dulo

0

0

1

80B0H

El m√≥dulo no conoce el registro

0

0

1

80B1H

‚óè La longitud de registro de datos indicada es incorrecta
o bien
‚óè El CP pasa al estado STOP

0

0

1

80C0H

No se puede leer el registro de datos

0

0

1

80C1H

El registro indicado est√° siendo procesado.

0

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

0

1

80C3H

Medios de operaci√≥n (memoria) ocupados

0

0

1

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conveniente una
repetici√≥n en el programa de usuario.)

Consulte tambi√©n
PNIO_ALARM (P√°gina 7379)

PROFIenergy
PROFIenergy
Las funciones de PROFIenergy en PROFINET sirven para gestionar la energ√≠a de las
instalaciones. Aqu√≠ se incluye la desconexi√≥n planificada o espont√°nea de diferentes aparatos
de campo, grupos o unidades de proceso con el fin de ahorrar energ√≠a. La desconexi√≥n se lleva
a cabo en tiempos no productivos o en pausas de producci√≥n. Los datos energ√©ticos y de
diagn√≥stico se pueden leer en aparatos integrados en el concepto de energ√≠a que, adem√°s,
soporten estas funciones.

Controlador PROFIenergy
Los comandos de desconexi√≥n los da el controlador de nivel superior; en PROFINET IO, el
controlador IO.
En SIMATIC S7-300, el controlador PROFIenergy puede ser el CP o una CPU S7-300 con
funci√≥n PROFIenergy.

Dispositivos PROFIenergy
Los comandos del controlador PROFIenergy son procesados por el dispositivo IO con funci√≥n
PROFIenergy, para desconectar aparatos conectados en el campo.
En el contexto de los bloques de programa PROFIenergy, se designa un dispositivo IO con
funci√≥n PROFIenergy como dispositivo PROFIenergy. En SIMATIC S7-300, el dispositivo
PROFIenergy puede ser el CP o una CPU S7-300 con funci√≥n PROFIenergy.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7383

Instrucciones
4.2 Instrucciones

Dispositivos I
En SIMATIC S7, un dispositivo inteligente (dispositivo I) puede tener dispositivos
PROFIenergy subordinados. En este caso, el dispositivo I tambi√©n puede funcionar como un
controlador PROFIenergy.

Modos de ahorro de energ√≠a y PE_MODE_ID
Muchos aparatos soportan s√≥lo los estados operativos "operativo" (tensi√≥n conectada) y
"pausa" (tensi√≥n desconectada). En el controlador del dispositivo PROFIenergy es posible
configurar estados de ahorro de energ√≠a escalonados con diferentes modos de ahorro para
aquellos aparatos que lo soporten o para grupos. Con PROFIenergy, a los aparatos de campo
se les pueden asignar diferentes estados de consumo de energ√≠a.
Los distintos estados de consumo de energ√≠a se denominan "modos de ahorro de energ√≠a".
Para cada modo de ahorro de energ√≠a se especifica una "PE_MODE_ID" concreta.

Programaci√≥n de las propiedades de los modos de ahorro de energ√≠a
Los detalles acerca de los modos de ahorro de energ√≠a (aparato de campo activado, duraci√≥n
de la pausa, etc.) se programan en el programa de usuario de la CPU del dispositivo
PROFIenergy.

Bloques de programa PROFIenergy para el CP 300
Realizaci√≥n de las funciones de PROFIenergy en un S7-300
En el SIMATIC S7-300 se preparan las funciones PROFIenergy para el controlador IO y el
dispositivo IO mediante bloques de programa.
Tenga en cuenta que la CPU S7-300 y el CP 300 utilizan diferentes bloques de programa
PROFIenergy.

Especificaci√≥n PROFIenergy
Las funciones de los bloques de programa PROFIenergy para el CP 300 se basan en la
siguiente especificaci√≥n de la Organizaci√≥n de Usuarios PROFIBUS e.V. (PNO):
Common Application Profile PROFIenergy, Technical Specification for PROFINET,
Version 1.0, January 2010, Order No. 3.802

7384

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloques de programa PROFIenergy para el CP 300
Los bloques de programa PROFIenergy se llaman desde el programa de usuario de la CPU.
Para las funciones PROFIenergy del CP 300 est√°n disponibles los siguientes bloques de
programa PROFIenergy:
‚óè CP 300 como controlador IO:
‚Äì PE_START_END_CP
Bloque de programa para iniciar y finalizar pausas en la alimentaci√≥n de energ√≠a as√≠
como para predefinir determinados modos de ahorro de energ√≠a para el dispositivo
PROFIenergy.
‚Äì PE_CMD_CP
Bloque de programa para iniciar y finalizar pausas en la alimentaci√≥n de energ√≠a,
predefinir determinados modos de ahorro de energ√≠a y consultar valores energ√©ticos
medidos del dispositivo PROFIenergy.
Los dos bloques de programa pueden utilizarse alternativamente. En comparaci√≥n con
PE_START_END_CP, PE_CMD_CP tiene una funcionalidad avanzada para integrar
valores energ√©ticos medidos.
El bloque de programa debe llamarse por separado para cada dispositivo PROFIenergy.
‚Äì PE_DS3_WRITE_ET200_CP
No forma parte de los bloques de funci√≥n PROFIenergy, pero complementa las
funciones de PROFIenergy de un ET 200S.
Con PE_DS3_WRITE_ET200_CP se definen los ajustes para el comportamiento de
conmutaci√≥n de 8 slots como m√°ximo (en este caso: m√≥dulos de potencia) del ET 200S.
‚óè CP 300 como dispositivo IO:
‚Äì PE_I_DEV_CP
Recibe todos los comandos PROFIenergy y permite al programa de usuario ejecutar las
funciones de PROFIenergy.
Prepara los telegramas de respuesta del dispositivo IO para el controlador IO.
PE_I_DEV_CP se llama c√≠clicamente desde el programa de usuario del dispositivo IO.
‚Äì Bloques de programa complementarios (FC 0 - FC 8) para PE_I_DEV_CP:
Estos FCs preparan los datos de respuesta para PE_I_DEV_CP. Los FCs deben
llamarse en el programa de usuario y vincularse con PE_I_DEV_CP.
Si el dispositivo PROFIenergy es un I-Device que tiene dispositivos PROFIenergy
subordinados, en la CPU del I-Device se llama PE_START_END_CP o PE_CMD_CP para
los dispositivos PROFIenergy subordinados.

Bloques de sistema y programa para transferir registros
Los comandos PROFIenergy y la informaci√≥n de estado se intercambian entre el controlador
IO y el dispositivo IO mediante la lectura y escritura de registros. Esto se consigue por medio
de los bloques de programa RDREC y RWREC.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7385

Instrucciones
4.2 Instrucciones
Los registros PROFIenergy se describen a continuaci√≥n en los datos de respuesta de los
diferentes bloques de programa.
Nota
Llamadas de bloques
PE_START_END_CP, PE_CMD_CP, PE_I_DEV_CP y PE_DS3_WRITE_ET200_CP no
deben llamarse al mismo tiempo. No se puede llamar el siguiente bloque de programa hasta
que un bloque haya notificado "ning√∫n error" (VALID = 1) o "error" (ERROR = 1).
El bloque de programa PNIO_RW_REC tampoco debe llamarse al mismo tiempo que
PE_START_END_CP, PE_CMD_CP, PE_I_DEV_CP o PE_DS3_WRITE_ET200_CP.

PE_START_END_CP
Significado y llamada - PE_START_END_CP
Significado y funcionamiento
PE_START_END_CP puede utilizarse como alternativa a PE_CMD_CP.
PE_START_END_CP se utiliza en el controlador IO. Provoca una pausa de ahorro de energ√≠a
o la finaliza en el dispositivo PROFIenergy asignado.
Este bloque de programa se utiliza preferentemente en controladores IO cuyos dispositivos IO
asignados tengan conectados √∫nicamente aparatos de campo en los que no pueden o deben
leerse datos energ√©ticos.
Los modos de ahorro de energ√≠a se configuran en el programa de usuario de la CPU del
dispositivo IO. El modo de ahorro de energ√≠a que se adopta realmente es notificado por el
dispositivo IO despu√©s de ejecutar PE_START_END_CP y devuelto en el par√°metro
PE_MODE_ID.
El par√°metro Pause_Time especifica la duraci√≥n de la pasa de ahorro de energ√≠a para el
dispositivo IO. Mediante el bloque de programa PE_I_DEV_CP, en el dispositivo IO se
comprueba si la duraci√≥n predefinida para la pausa es suficiente y si puede aplicarse.

7386

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Secuencia
3(B67$57B(1'B&3
3(B&0'B&3
&RQWURODGRU352),HQHUJ\

3(B,B'(9B&3
'LVSRVLWLYR352),HQHUJ\

3HWLFL¬µQGHHVFULWXUD
1(: 
5HVSXHVWDGHHVFULWXUD SRVLWLYD

3HWLFL¬µQGHOHFWXUD


PV

5HVSXHVWDGHOHFWXUD QHJDWLYD
5HFXUVRRFXSDGRDFWLYR

V

3HWLFL¬µQGHOHFWXUD

5HVSXHVWDGHOHFWXUD SRVLWLYD

V

7LHPSR

Figura 4-74

7LHPSR

Diagrama secuencial de las peticiones de escritura/lectura de PE_START_END_CP y
PE_CMD_CP

PE_START_END_CP utiliza WRREC para enviar un comando PROFIenergy al dispositivo IO
como petici√≥n de escritura. Seguidamente, PE_START_END_CP espera el acuse del
dispositivo IO. Para ello, cada 100 milisegundos se lee el registro de acuse con el bloque de
programa RDREC.
Mientras no llega el acuse del dispositivo IO, la petici√≥n de lectura se repite durante 10
segundos en intervalos de 100 milisegundos.
Los datos de respuesta del dispositivo IO se leen con el RDREC.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7387

Instrucciones
4.2 Instrucciones

Interfaz de llamada en representaci√≥n FUP
3(B67$57B(1'B&3
:25'

&3/$''5

3(B02'(B,'

%<7(

%22/

67$57

9$/,'

%22/

%22/

(1'

%86<

%22/

:25'

,'

(5525

%22/

7,0(

3$86(B7,0(

67$786

:25'

Explicaci√≥n de los par√°metros formales de PE_START_END_CP
Explicaci√≥n de los par√°metros formales de PE_START_END_CP
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

CPLADDR

INPUT

WORD

START

INPUT

BOOL

I, Q, M, D, L, const.

Direcci√≥n inicial del m√≥dulo del CP

‚óè 1 = comando activo

Un flanco ascendente activa el comando
"Start_Pause" (iniciar pausa de ahorro de
energ√≠a)

‚óè 0 = comando no activo
END

INPUT

BOOL

Descripci√≥n

‚óè 1 = comando activo
‚óè 0 = comando no activo

Un flanco ascendente activa el comando
"End_Pause" (finalizar pausa de ahorro de
energ√≠a)

ID

INPUT

WORD

Direcci√≥n l√≥gica del dispositivo PROFIe‚Äê
nergy de destino

PAUSE_
TIME

INPUT

TIME

T#-24D_20H_31M_23S_648MS
a
T#24D_20H_31M_23S_647MS

Temporizador IEC en incrementos de 1 ms,
entero con signo

PE_MODE_
ID

OUTPUT

BYTE

‚óè 00h: tensi√≥n OFF (pausa)

ID del modo de ahorro de energ√≠a adoptado
por el dispositivo IO tras la ejecuci√≥n del
comando.

VALID

OUTPUT

‚óè 01h...FEh: configurable
‚óè FFh: operativo
BOOL

0: 1: procesamiento finalizado co‚Äê
rrectamente

BUSY

OUTPUT

BOOL

0: procesamiento finalizado, can‚Äê
celado o todav√≠a no iniciado

El par√°metro de estado indica si la petici√≥n
se ha desarrollado correctamente.
Indicador del estado de procesamiento del
bloque de programa

1: procesamiento en curso

7388

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

ERROR

OUTPUT

BOOL

0: -

Indicador de error

1: error

Ver el significado en relaci√≥n con el par√°‚Äê
metro STATUS en Indicadores de
PE_START_END_CP (P√°gina 7389).

STATUS

OUTPUT

WORD

Indicador de estado
Ver el significado en relaci√≥n con el par√°‚Äê
metro ERROR en Indicadores de
PE_START_END_CP (P√°gina 7389).

Consulte tambi√©n
Datos de respuesta (P√°gina 7395)

Indicadores de PE_START_END_CP
Indicadores de PE_START_END_CP
PE_START_END_CP se basa en el bloque de programa PNIO_RW_REC y proporciona todos
los indicadores de PNIO_RW_REC, consulte los indicadores del bloque PNIO_RW_REC.
Adem√°s, se muestran los siguientes indicadores espec√≠ficos de PROFIenergy. Los
indicadores de error de STATUS solo son v√°lidos en relaci√≥n con ERROR = 1.
Tabla 4-426 Indicadores espec√≠ficos de PE_START_END_CP
STATUS

Significado

Errores espec√≠ficos del bloque
8080h

Flanco ascendente simult√°neamente a START y END

8081h

Conflicto de longitud con CMD_PARAM y CMD_PARAM_LEN

Errores espec√≠ficos de PROFIenergy
FE01h

Service_Request_ID no v√°lida

FE02h

Request_Reference no v√°lida

FE03h

CMD_MODIFIER no v√°lido

FE04h

Indicaci√≥n no v√°lida sobre la estructura de datos de un comando (Data_Structure_Identifier_RQ) en el tele‚Äê
grama para el registro PROFIenergy de escritura

FE05h

Indicaci√≥n no v√°lida sobre la estructura de datos de un comando (Data_Structure_Identifier_RS) en el telegra‚Äê
ma para el registro PROFIenergy de lectura

FE06h

Modo de ahorro de energ√≠a (PE_Mode_ID) no soportado

FE07h

La respuesta es m√°s larga que la longitud de transferencia m√°x.

FE08h

N√∫mero de comandos no v√°lido

FE09h

Block Type no v√°lido (consulte el encabezado del telegrama)

FE0Ah

Block Length no v√°lida (consulte el encabezado del telegrama)

FE0Bh

Block Version no v√°lida (consulte el encabezado del telegrama)

FE50h

No hay ning√∫n modo de ahorro de energ√≠a adecuado (PE_Mode_ID)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7389

Instrucciones
4.2 Instrucciones
STATUS

Significado

FE51h

No se soporta el valor de PAUSE_TIME

FE52h

No se soporta PE_Mode_ID

Consulte los detalles relacionados con los par√°metros de los errores espec√≠ficos de
PROFIenergy en el cap√≠tulo AUTOHOTSPOT.

PE_CMD_CP
Significado y llamada - PE_CMD_CP
Significado y funcionamiento
PE_CMD_CP puede utilizarse como alternativa a PE_START_END_CP.
PE_CMD_CP se utiliza en el controlador IO y lanza una pausa de ahorro de energ√≠a o la finaliza
en el dispositivo PROFIenergy asignado. Adicionalmente, PE_CMD_CP puede leer otras
informaciones y valores energ√©ticos medidos de un dispositivo IO.
Este bloque de programa se utiliza preferentemente en controladores IO cuyos dispositivos IO
asignados tengan conectados aparatos de campo de los que deben leerse datos energ√©ticos
medidos.
Encontrar√° un diagrama de secuencia de las peticiones de escritura/lectura de PE_CMD_CP
en el cap√≠tulo AUTOHOTSPOT.
Los diferentes comandos que se transfieren al dispositivo IO con el bloque de programa tienen
asignadas "Service_Request_IDs" concretas. Las Service_Request_IDs 01...05 y 16 se
asignan en el par√°metro CMD.
Con el par√°metro CMD_MODIFIER se especifican con m√°s detalle los comandos 04
(Query_Modes) y 16 (Query_Measurement).
El par√°metro CMD_PARA asigna los valores de determinados par√°metros a algunos
comandos mediante un puntero Any. El par√°metro CMD_PARA_LEN define la longitud de
dichos par√°metros.
El par√°metro RESPONSE_DATA apunta al √°rea de datos de respuesta del dispositivo IO.

7390

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Interfaz de llamada en representaci√≥n FUP
3(B&0'B&3
:25'

&3/$''5

9$/,'

%22/

%22/

5(4

%86<

%22/

:25'

,'

(5525

%22/

%<7(

&0'

67$786

:25'

%<7(

&0'B02',),(5

$1<

&0'B3$5$

,17

&0'B3$5$B/(1

$1<

5(63216(B'$7$

$1<

Consulte tambi√©n
Explicaci√≥n de los par√°metros formales de PE_CMD_CP (P√°gina 7391)

Explicaci√≥n de los par√°metros formales de PE_CMD_CP
Explicaci√≥n de los par√°metros formales de PE_CMD_CP
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

CPLADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo del CP

REQ

INPUT

BOOL

Con un flanco ascendente comienza la trans‚Äê
ferencia de los comandos PROFIenergy.

ID

INPUT

WORD

Direcci√≥n l√≥gica del dispositivo PROFIenergy
de destino

CMD

INPUT

BYTE

I, Q, M, D, L, const.

‚óè 01: Start_Pause
‚óè 02: End_Pause
‚óè 03: Query_Modes
‚óè 04: PEM_Status

Service_Request_ID del comando PROFIe‚Äê
nergy.
Debajo de la tabla encontrar√° el significado
de los comandos.

‚óè 05: PE_Identity
‚óè 16: Query_Measurement

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7391

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

CMD_
MODIFIER

INPUT

BYTE

Modificador del comando PROFIenergy, sig‚Äê
nificado:

Para "Start_Pause": 00
Para "End_Pause": 00
Para "Query_Modes":
‚óè 01: List_Energy_Saving
_Modes
‚óè 02: Get_Mode
Para "PEM_Status": 00
Para "PE_Identity": 00
Para "Query_Measurement":
‚óè 01:
Get_Measurement_List
‚óè 02:
Get_Measurement_Values

‚óè Comando "Query_Modes"
‚Äì

Modificador 01: lee todos los modos
de ahorro de energ√≠a soportados
(PE_Mode_ID).

‚Äì

Modificador 02: lee los par√°metros de
la PE_Mode_ID seleccionada.

‚óè Comando "Query_Measurement"
‚Äì

Modificador 01: lee las
Measurement_IDs configuradas.

‚Äì

Modificador 02: lee los valores
medidos de las Measurement_IDs
seleccionadas.

Encontrar√° informaci√≥n sobre los par√°metros
en el apartado del comando correspondiente
del cap√≠tulo AUTOHOTSPOT.
El modificador 00 significa "sin opciones".
CMD_PARA

INPUT

ANY

Puntero Any hacia par√°metros para coman‚Äê
dos
‚óè Para comando 01 Start_Pause:
"Pause_Time"
‚óè Para comando 02 End_Pause: irrelevante
‚óè Para comando 03 Query_Modes:
‚Äì

Para modificador 01: irrelevante

‚Äì

Para modificador 02 Get_Mode:
"PE_Mode_ID"

‚óè Para comando 04 PEM_Status:
irrelevante
‚óè Para comando 05 PE_Identity: irrelevante
‚óè Para comando 16 Query_Measurement:
‚Äì

Para modificador 01: irrelevante

‚Äì

Para modificador 02
Get_Measurement_Values:
Puntero ANY hacia la estructura de
datos con par√°metros "Count" y
"Measurement_IDs"

Encontrar√° informaci√≥n sobre los par√°metros
en el apartado del comando correspondiente
del cap√≠tulo AUTOHOTSPOT.
Se registra el √°rea de datos completa del re‚Äê
gistro que debe escribirse (Service_Data_Re‚Äê
quest). Longitud m√°x.: 234 bytes
CMD_PA‚Äê
RA_LEN

7392

INPUT

INT

Longitud real de los par√°metros en CMD_PA‚Äê
RA. Longitud m√°x.: 234 bytes

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

RESPONSE
_DATA

INOUT

ANY

Puntero hacia la direcci√≥n de los datos de
respuesta del dispositivo IO (telegrama com‚Äê
pleto incl. Block Header)
Nota:
Si se ha seleccionado un rango demasiado
peque√±o solo se guardar√° el n√∫mero de
bytes configurado.

VALID

OUTPUT

BOOL

0: 1: procesamiento finalizado co‚Äê
rrectamente

BUSY

OUTPUT

BOOL

El par√°metro de estado del bloque de progra‚Äê
ma indica si la petici√≥n se ha desarrollado
correctamente.

0: procesamiento todav√≠a no ini‚Äê Indicador del estado de procesamiento del
ciado, finalizado o cancelado
bloque de programa
1: procesamiento en curso

ERROR

STATUS

OUTPUT

OUTPUT

BOOL

WORD

0: -

Indicador de error

1: error

Ver el significado en relaci√≥n con el par√°me‚Äê
tro STATUS en AUTOHOTSPOT.
Indicador de estado
Ver el significado en relaci√≥n con el par√°me‚Äê
tro ERROR en AUTOHOTSPOT.

Service_Request_IDs y significado de los comandos PROFIenergy
Los comandos PROFIenergy con Service_Request_ID 01...05 y 16 tienen el significado
siguiente:
‚óè 01 = Start_Pause
Comando para iniciar una pausa de ahorro de energ√≠a.
El dispositivo IO selecciona el modo de ahorro de energ√≠a configurado. El modo de ahorro
de energ√≠a se notifica al controlador en los datos de respuesta.
‚óè 02 = End_Pause
Comando para finalizar una pausa de ahorro de energ√≠a
‚óè 03 = Query_Modes
Consulta los modos de ahorro de energ√≠a configurados en el dispositivo IO con toda la
informaci√≥n correspondiente de tiempo y energ√≠a.
Mediante el par√°metro CMD_MODIFIER se detalla la informaci√≥n consultada:
‚Äì List_Energy_Saving_Modes
Lee todos los modos PROFIenergy soportados por el dispositivo IO.
‚Äì Get_Mode
Lee los datos del modo PROFIenergy seleccionado.
‚óè 04 = PEM_Status
Consulta del modo de ahorro de energ√≠a adoptado realmente por el aparato de campo o por
el grupo.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7393

Instrucciones
4.2 Instrucciones
‚óè 05 = PE_Identity
Consulta los servicios PROFIenergy soportados por el dispositivo IO.
‚óè 16 = Query_Measurement
Consulta datos energ√©ticos del dispositivo IO.
Mediante el par√°metro CMD_MODIFIER se detalla la informaci√≥n consultada:
‚Äì Get_Measurement_List
Lee todas las Measurement_IDs configuradas en el dispositivo IO.
‚Äì Get_Measurement_Values
Lee los valores energ√©ticos medidos de las Measurement_IDs seleccionadas.

Comandos para distintas clases de aparatos
Los aparatos que pueden integrarse en conceptos PROFIenergy pueden dividirse en tres
clases, que son activadas por el controlador IO utilizando distintos comandos:
‚óè M√≥dulos E/S, actuadores, arrancadores de motor
Comandos soportados:
‚Äì Start_Pause, End_Pause
‚Äì Query_Modes, PEM_Status, PE_Identify
‚óè Instrumentos de medida para magnitudes el√©ctricas
Comandos soportados:
‚Äì Query_Measurement
‚óè Convertidores de frecuencia
Comandos soportados:
‚Äì Start_Pause, End_Pause
‚Äì Query_Modes, PEM_Status, PE_Identify
‚Äì Query_Measurement
Tambi√©n es posible consultar datos de magnitudes el√©ctricas que registran los
convertidores de frecuencia.

Indicadores de PE_CMD_CP
Indicadores de PE_CMD_CP
PE_CMD_CP se basa en el bloque de programa PNIO_RW_REC y proporciona todos los
indicadores de PNIO_RW_REC; consulte los indicadores del bloque PNIO_RW_REC.
Adem√°s, se muestran los siguientes indicadores espec√≠ficos de PROFIenergy. Los
indicadores de error de STATUS solo son v√°lidos en relaci√≥n con ERROR = 1.
Tabla 4-427 Indicadores espec√≠ficos de PE_CMD_CP
STATUS

Significado

Errores espec√≠ficos del bloque
8081h

7394

Conflicto de longitud con CMD_PARAM y CMD_PARAM_LEN

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
STATUS

Significado

Errores espec√≠ficos de PROFIenergy
FE01h

Service_Request_ID no v√°lida

FE02h

Request_Reference no v√°lida

FE03h

CMD_MODIFIER no v√°lido

FE04h

Indicaci√≥n no v√°lida sobre la estructura de datos de un comando (Data_Structure_Identifier_RQ) en el tele‚Äê
grama para el registro PROFIenergy de escritura

FE05h

Indicaci√≥n no v√°lida sobre la estructura de datos de un comando (Data_Structure_Identifier_RS) en el telegra‚Äê
ma para el registro PROFIenergy de lectura

FE06h

No se soporta el modo de ahorro de energ√≠a (PE_Mode_ID)

FE07h

La respuesta es m√°s larga que la longitud de transferencia m√°x.

FE08h

N√∫mero de comandos no v√°lido

FE09h

Block Type no v√°lido (consulte el encabezado del telegrama)

FE0Ah

Block Length no v√°lida (consulte el encabezado del telegrama)

FE0Bh

Block Version no v√°lida (consulte el encabezado del telegrama)

FE50h

No hay ning√∫n modo de ahorro de energ√≠a adecuado (PE_Mode_ID)

FE51h

No se soporta el valor de PAUSE_TIME

FE52h

No se soporta PE_Mode_ID

Consulte los detalles relacionados con los par√°metros de los errores espec√≠ficos de
PROFIenergy en el cap√≠tulo AUTOHOTSPOT.

Datos de respuesta
Estructura de los datos de respuesta
Las tablas siguientes muestran la estructura del registro (80A0h) de los datos de respuesta de
PE_START_END_CP y PE_CMD_CP.
La tabla siguiente muestra una sinopsis de la estructura del registro de los datos de respuesta
devueltos de acuerdo con la especificaci√≥n PROFIenergy. La composici√≥n del √°rea "Service
Data Response" se describe a continuaci√≥n para los diferentes comandos PROFIenergy.
Tabla 4-428 Estructura de los datos de respuesta
Definiciones de bloque Atributos

Valor

Block Header

0801h

BlockType
BlockLength

Tipo de datos
Unsigned16
Unsigned16

BlockVersionHigh

01h

Unsigned8

BlockVersionLow

00h

Unsigned8

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Descripci√≥n
Longitud de telegrama (sin los
campos "BlockType" y "Block‚Äê
Length")

7395

Instrucciones
4.2 Instrucciones
Definiciones de bloque Atributos

Valor

Tipo de datos

Descripci√≥n

Response Header

01h...FFh

Unsigned8

01h: Start_Pause

Service_Request_ID

02h: End_Pause
03h: Query_Modes
04h: PEM_Status
05h: PE_Identify
06h...09h: - reservado 10h: Query_Measurement
11h...CF: - reservado D0h...FFh: espec√≠fico del fabri‚Äê
cante

Service Header Res‚Äê
ponse

Request_Reference

01h...FFh

Unsigned8

Estado

01h...FFh

Unsigned8

N√∫mero de identificaci√≥n de la
consulta (reflejado en la res‚Äê
puesta del dispositivo IO)
00h: - reservado 01h: listo
02h: listo con error
03h: datos incompletos
04h...CFh: - reservado D0h...FFh: en funci√≥n de la Ser‚Äê
vice_Request_ID

Data_Structure_Identifier_RS

01h...FFh

Unsigned8

00h: - reservado 01h...FFh: estructura de datos
en funci√≥n de la Service_Re‚Äê
quest_ID
FFh: error

Service Data Respon‚Äê
se

Datos de respuesta del disposi‚Äê
tivo IO
En funci√≥n del comando PRO‚Äê
FIenergy correspondiente (des‚Äê
crito a continuaci√≥n)

Significado de "Service Data Request" y "Service Data Response"
Los apartados siguientes explican los valores de par√°metros para los diferentes comandos
PROFIenergy en las consultas del controlador IO al dispositivo IO (Service Data Request) y la
estructura de los datos de respuesta del dispositivo IO (Service Data Response).
‚óè Service Data Request
Valores de par√°metros en la consulta del controlador IO
‚óè Service Data Response
Estructura de los datos de respuesta del dispositivo IO

7396

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Comando PROFIenergy "Start_Pause"
‚óè Service Data Request
‚Äì CMD = 01
‚Äì CMD_MODIFIER = 00
‚Äì CMD_PARA_LEN = 04
‚Äì CMD_PARA = puntero Any hacia el valor de "Pause_Time" (tipo de datos "TIME")
Temporizador IEC en incrementos de 1 ms, entero con signo
Valor: T#-24D_20H_31M_23S_648MS a T#24D_20H_31M_23S_647MS
‚óè Service Data Response
Par√°metro

Valor

Tipo de datos

PE_Mode_ID *

01h...FFh

Unsigned8

- reservado -

00h

Unsigned8

* N√∫mero de identificaci√≥n del modo de ahorro de energ√≠a

Comando PROFIenergy "End_Pause"
‚óè Service Data Request
‚Äì CMD = 02
‚Äì CMD_MODIFIER = 00
‚Äì CMD_PARA_LEN = 00
‚Äì CMD_PARA = irrelevante
‚óè Service Data Response
Par√°metro

Valor

Time_to_operate *

Tipo de datos
Unsigned32

* Tiempo previsto para conmutar el dispositivo PROFIenergy a "operativo" (ready_to_operate)

Comando PROFIenergy "Query_Modes" ‚Äì List_Energy_Saving_Modes
‚óè Service Data Request
‚Äì CMD = 03
‚Äì CMD_MODIFIER = 01
‚Äì CMD_PARA_LEN = 00
‚Äì CMD_PARA = irrelevante
‚óè Service Data Response

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7397

Instrucciones
4.2 Instrucciones

Par√°metro

Valor

Tipo de datos

Number_of_PE_Mode_IDs *

01h

Unsigned8

PE_Mode_IDs

Unsigned8-Array of Number_of_PE_Mo‚Äê
de_IDs (Unique ID for mode)

* N√∫mero de modos de ahorro de energ√≠a

Comando PROFIenergy "Query_Modes" ‚Äì Get_Mode
‚óè Service Data Request
‚Äì CMD = 03
‚Äì CMD_MODIFIER = 02
‚Äì CMD_PARA_LEN = 01
‚Äì CMD_PARA = puntero Any hacia el valor de PE_MODE_ID (unsigned8)
‚óè Service Data Response
Par√°metro

Valor

Tipo de datos

PE_Mode_ID

01h...FFh

Unsigned8

PE_Mode_Attributes *

00h...01h

Unsigned8

Time_min_Pause

Unsigned32

Time_to_Pause

Unsigned32

Time_to_operate

Unsigned32

Time_min_length_of_stay

Unsigned32

Time_max_length_of_stay

Unsigned32

Mode_Power_Consumption

Float32

Energy_Consumption_to_pause

Float32

Energy_Consumption_to_operate

Float32

* Codificaci√≥n del bit 0:
0 = solo est√°n disponibles valores medidos de tiempo y energ√≠a est√°ticos.
1 = est√°n disponibles valores medidos de tiempo y energ√≠a din√°micos.
Bits 1...7: reservados

Comando PROFIenergy "PEM_Status"
‚óè Service Data Request
‚Äì CMD = 04
‚Äì CMD_MODIFIER = 00
‚Äì CMD_PARA_LEN = 00
‚Äì CMD_PARA = irrelevante
‚óè Service Data Response

7398

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro

Valor

Tipo de datos

PE_Mode_ID_Source *

00h
01h...FEh
FFh

Unsigned8

PE_Mode_ID_Destination *

00h
01h...FEh
FFh

Unsigned8

Time_to_operate

Unsigned32

Remaining_time_to_destination

Unsigned32

Mode_Power_Consumption

Float32

Energy_Consumption_to_Destination

Float32

Energy_Consumption_to_operate

Float32

* Valores posibles de "PE_Mode_ID_Source" y "PE_Mode_ID_Destination":
00h: PE_Power_off (fuente de alimentaci√≥n desconectada)
01h...FEh: libremente configurable
FFh: PE_Ready_to_operate (operativo)

Comando PROFIenergy "PE_Identify"
‚óè Service Data Request
‚Äì CMD = 05
‚Äì CMD_MODIFIER = 00
‚Äì CMD_PARA_LEN = 00
‚Äì CMD_PARA = irrelevante
‚óè Service Data Response
Par√°metro

Valor

Tipo de datos

Count *

6

Unsigned8

Start_Pause **

01h

Unsigned8

End_Pause

02h

Unsigned8

Query_Modes

03h

Unsigned8

PEM_Status

04h

Unsigned8

PE_Identify

05h

Unsigned8

Query_Measurement ***

10h

Unsigned8

* N√∫mero de comandos PROFIenergy soportados
** Service_Request_ID del primer comando PROFIenergy soportado
*** Service_Request_ID del √∫ltimo comando PROFIenergy soportado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7399

Instrucciones
4.2 Instrucciones

Comando PROFIenergy "Query_Measurement" ‚Äì Get_Measurement_List
‚óè Service Data Request
‚Äì CMD = 16
‚Äì CMD_MODIFIER = 01
‚Äì CMD_PARA_LEN = 00
‚Äì CMD_PARA = irrelevante
‚óè Service Data Response
Par√°metro

Valor

Tipo de datos

Count *

Unsigned8

- reservado -

Unsigned8

Measurement_ID **

Unsigned16

Accuracy_Domain 1

Unsigned8

Accuracy_Class

Unsigned8

Range

2

Float32

3

‚Ä¶
Measurement_ID ***

Unsigned16

Accuracy_Domain 1

Unsigned8

Accuracy_Class

Unsigned8

Range

2

3

Float32

* N√∫mero de Measurement_IDs
** Primera Measurement_ID soportada
*** √öltima Measurement_ID soportada
1

Dominio de precisi√≥n (rango 1...4):
0 = reservado
1 = porcentaje del rango de medici√≥n
2 = porcentaje del valor medido actual
3 = precisi√≥n conforme a IEC 61557‚Äë12
4 = precisi√≥n conforme a EN 50470‚Äë3 cap√≠tulo 8

2

Clase de precisi√≥n (rango 1...15):
0 = reservado
1 (0,01%) ... 15 (>20%)

3

Rango de medici√≥n si Accuracy_Domain = 1; de lo contrario, indefinido

Comando PROFIenergy "Query_Measurement" ‚Äì Get_Measurement_Values
‚óè Service Data Request
‚Äì CMD = 16
‚Äì CMD_MODIFIER = 02
‚Äì CMD_PARA_LEN = longitud de la estructura de datos en bytes
‚Äì CMD_PARA = puntero Any hacia una estructura de datos con la forma siguiente:

7400

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro

Valor

Tipo de datos

Count *

Unsigned8

- reservado -

Unsigned8

Measurement_ID **

Unsigned16

‚Ä¶
Measurement_ID ***

Unsigned16

* N√∫mero de Measurement_IDs
** Primer valor medido consultado
*** √öltimo valor medido consultado

‚óè Service Data Response
Par√°metro

Valor

Count *

Unsigned8

- reservado Length_of_Structure

Tipo de datos
Unsigned8

0002h...FFFFh

Unsigned16

Measurement_Data_Structure_ID

1 = valor simple

Unsigned8

Measurement_ID **

00h...FFh

Unsigned16

1 = v√°lido

Unsigned8

Status_of_Measurement_Value

2 = no disponible
3 = no disponible
temporalmente
Transmission_Data_Type

Float32

End_of_demand

Unsigned32 o Unsigned16

Length_of_Structure

Unsigned16

Measurement_Data_Structure_ID

Unsigned8

Measurement_ID ***

Unsigned16

Status_of_Measurement_Value

Unsigned8

Transmission_Data_Type

Float32

End_of_demand

Unsigned32 o Unsigned16

* N√∫mero de Measurement_IDs
** Primer valor medido consultado
*** √öltimo valor medido consultado

Consulte tambi√©n
Explicaci√≥n de los par√°metros formales de PE_START_END_CP (P√°gina 7388)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7401

Instrucciones
4.2 Instrucciones

PE_I_DEV_CP
Significado y llamada - PE_I_DEV_CP
Significado y funcionamiento
El bloque de programa PE_I_DEV_CP se utiliza en el dispositivo PROFIenergy, donde ejecuta
los comandos PROFIenergy del controlador IO. Los registros enviados por el controlador IO
(80A0h) son transmitidos a PE_I_DEV_CP por el firmware del CP. Los datos PROFIenergy del
dispositivo IO, a su vez, son puestos a disposici√≥n del controlador IO en forma de respuesta
por parte de PE_I_DEV_CP mediante el registro PROFIenergy (80A0h).
Los datos de respuesta de PE_I_DEV_CP se generan mediante las funciones
complementarias FC 0 a FC 8, consulte el cap√≠tulo AUTOHOTSPOT.

Interfaz de llamada en representaci√≥n FUP
3(B,B'(9B&3
:25'

&3/$''5

&0'

,17

%22/

5(6(7

&0'B02',),(5

,17

%22/

9$/,'

&0'B3$5$
,1'(;

$1<

$1<
,17

1(:

%22/

(5525

%22/

67$786

:25'

5(63216(B'$7$

$1<

Explicaci√≥n de los par√°metros formales de PE_I_DEV_CP
Explicaci√≥n de los par√°metros formales de PE_I_DEV_CP
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

CPLADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo del CP

RESET

INPUT

BOOL

I, Q, M, D, L, const.

Resetea el procesamiento del bloque de pro‚Äê
grama.
NEW se pone a 0.

7402

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

VALID

INPUT

BOOL

Cuando se han escrito los datos de respues‚Äê
ta en el √°rea de memoria correspondiente del
dispositivo IO, el programa de usuario debe
poner VALID = 1. Seguidamente, el bloque
de programa pone los datos a disposici√≥n del
controlador IO.
NEW se pone a 0.

CMD

OUTPUT

INT

‚óè 01: Start_Pause

ID de servicio del comando PROFIenergy

‚óè 02: End_Pause
‚óè 03: Query_Modes
‚óè 04: PEM_Status
‚óè 05: PE_Identity
‚óè 16: Query_Measurement
CMD_
MODIFIER

OUTPUT

INT

‚óè Modificador para
Start_Pause: 00
‚óè Modificador para
End_Pause: 00
‚óè Query_Modes,
modificador:
‚Äì

01 (List_Energy_
Saving_Modes)

‚Äì

02 (Get_Mode)

‚óè Modificador para
PEM_Status: 00
‚óè Modificador para
PE_Identity: 00
‚óè Query_Measurement,
modificador:

CMD_PARA

OUTPUT

ANY

‚Äì

01 (Get_Measurement
_List)

‚Äì

02 (Get_Measurement
_Values)

Modificador de los comandos PROFIenergy
Significado de los modificadores para coman‚Äê
dos:
‚óè Comando "Query_Modes",
modificador:
‚Äì

01 (List_Energy_Saving_Modes):
lee todos los modos PROFIenergy
soportados

‚Äì

02 (Get_Mode):
lee los datos del modo PROFIenergy
seleccionado

‚óè Comando "Query_Measurement",
modificador:
‚Äì

01 (Get_Measurement_List):
lee todas las Measurement_IDs
configuradas.

‚Äì

02 (Get_Measurement_Values):
lee los valores medidos de las
Measurement_IDs seleccionadas.

Puntero Any hacia los par√°metros para los
siguientes modificadores de comandos (con‚Äê
sulte el par√°metro CMD_MODIFIER):
‚óè Para "Get_Mode":
PE_Mode_ID (ID del modo de ahorro de
energ√≠a)longitud = 1
‚óè Para
"Get_Measurement_Values":valores
medidos de las Measurement_IDs
longitud = m√°x. 236 bytes (telegrama
completo del comando del controlador sin
encabezado)

INDEX

OUTPUT

INT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

N√∫mero del registro PROFIenergy (80A0h)

7403

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

NEW

OUTPUT

BOOL

Descripci√≥n

0: procesamiento todav√≠a no ini‚Äê Indicadores del estado de procesamiento del
ciado, finalizado o cancelado
bloque de programa
1: procesamiento en curso

ERROR

STATUS

OUTPUT

OUTPUT

BOOL

0: -

Indicador de error

1: error

Ver el significado en relaci√≥n con el par√°me‚Äê
tro STATUS en Indicadores de
PE_I_DEV_CP (P√°gina 7404).

WORD

Indicador de estado
Ver el significado en relaci√≥n con el par√°me‚Äê
tro ERROR en Indicadores de
PE_I_DEV_CP (P√°gina 7404).

RESPONSE
_DATA

INOUT

ANY

Consulte los "datos de respues‚Äê Puntero hacia el √°rea de datos de respuesta
ta" del bloque de programa
del dispositivo IO (telegrama de respuesta
completo incluido encabezado).
El √°rea de datos debe coincidir con la de los
bloques de programa complementarios FC 0
- FC 8 (par√°metro"DATA_ERRORRSP").
Tama√±o recomendado: m√≠n. 244 bytes. Si el
√°rea de datos es demasiado peque√±a solo se
transferir√°n los datos de los bytes configura‚Äê
dos.

Indicadores de PE_I_DEV_CP
Indicadores de PE_I_DEV_CP
PE_I_DEV_CP se basa en el bloque de programa PNIO_RW_REC y proporciona todos los
indicadores de PNIO_RW_REC; consulte los indicadores del bloque PNIO_RW_REC.

Bloques de programa complementarios para PE_I_DEV_CP
Vista general de los FCs
Funci√≥n
Los bloques de programa complementarios de FC 0 a FC 8 soportan la preparaci√≥n de datos
de respuesta que PE_I_DEV_CP pone a disposici√≥n del controlador:
‚óè Hay una funci√≥n separada para los datos de respuesta de cada bloque de programa
PROFIenergy (FC 1 - FC 8).
‚óè FC 0 genera una respuesta negativa com√∫n para todos los comandos PROFIenergy.
Los FCs se llaman en el programa de usuario. En STEP 7 V5.5 se proporcionar√°n en la librer√≠a
est√°ndar, en la carpeta "PROFIenergy".

7404

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Los FCs tienen algunos par√°metros comunes y otros individuales para cada una. Algunos de
los par√°metros comunes de los FCs se interconectan con par√°metros de PE_I_DEV_CP. En
algunos de los par√°metros de entrada individuales de los FCs, el usuario introduce los datos
de respuesta en forma de texto claro o los almacena en el √°rea de memoria del dispositivo IO.

Vista general de los FCs
Se proporcionar√°n los siguientes bloques de programa complementarios:
Tabla 4-429 Vista general de los FCs complementarios
N√∫mero

Nombre

FC 0

PE_ERROR_RSP

FC 1

PE_START_RSP

FC 2

PE_END_RSP

FC 3

PE_LIST_MODES_RSP

FC 4

PE_GET_MODE_RSP

FC 5

PE_PEM_STATUS_RSP

FC 6

PE_IDENTIFY_RSP

FC 7

PE_MEASUREMENT_LIST_RSP

FC 8

PE_MEASUREMENT_VALUE_RSP

Interconexi√≥n de los FCs con PE_I_DEV_CP
Interconexi√≥n de los FCs con el bloque de programa PE_I_DEV_CP
3(B,B'(9B&3

%ORTXHVGHSURJUDPD
)&)&

&3/$''5 ,1
3DU¬£PHWURVHVSHF¬ØILFRV
GH ,1 &0'

5(6(7 ,1
8VXDULR

&0'B3$5$ 287
,1'(; 287

287 (5525

(5525 287

287 67$786

67$786 287

,1 $&7,9$7(
,1 9$/,'

,1287 5(63216(B'$7$
287 &0'
8VXDULR

287 &0'B02',),(5

8VXDULR

287 1(:

(YDOXDFL¬µQ\UHVSXHVWDSRUSDUWHGHOXVXDULR

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

8VXDULR

8VXDULR

9$/,' 287
'$7$B(5525563 ,1287
&0' ,1
&0'B02',),(5 ,1
1(: ,1

,QWURGXFFL¬µQSRUSDUWHGHOXVXDULR

7405

Instrucciones
4.2 Instrucciones
Figura 4-75

Interconexi√≥n de los FCs con PE_I_DEV_CP

Nota
La interconexi√≥n de los bloques de programa es obligatoria
PE_I_DEV_CP debe interconectarse con FC 0...FC 8 en los par√°metros con fondo azul claro
que est√°n asignados a los par√°metros correspondientes de los FCs mediante flechas rojas.

Par√°metros comunes de los FCs
Par√°metros comunes de los bloques de programa complementarios FC 0 - FC 8
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

INPUT

BOOL

Hace que el bloque copie los par√°metros de
entrada en el √°rea de datos "DA‚Äê
TA_ERRORRSP" cuando hay un flanco as‚Äê
cendente. Seguidamente, el bloque lo rese‚Äê
tea.

Par√°metros de entrada
ACTIVATE

El usuario debe activarlo en un plazo de 10
segundos despu√©s de haberse detectado un
flanco ascendente en PE_I_DEV_NEW.
PE_I_DEV_NEW

INPUT

BOOL

Debe interconectarse con el par√°metro de
salida NEW de PE_I_DEV_CP.

CMD

INPUT

INT

Debe interconectarse con el par√°metro de
salida CMD de PE_I_DEV_CP.

CMD_MODIFIER

INPUT

INT

Debe interconectarse con el par√°metro de
salida CMD_MODIFIER de PE_I_DEV_CP.

OUTPUT

ANY

Puntero hacia el √°rea de datos en la que se
almacenan los datos de respuesta (telegra‚Äê
ma de respuesta completo incluido encabe‚Äê
zado).

El bloque solo se procesa cuando hay un 1.

Par√°metros de salida
DATA_ERRORRSP

Debe interconectarse con el par√°metro de
salida RESPONSE_DATA de
PE_I_DEV_CP.
Tama√±o recomendado: m√≠n. 244 bytes.
VALID

ERROR

OUTPUT

OUTPUT

BOOL

BOOL

0: -

Es activado por el bloque.

1: ning√∫n error

Debe interconectarse con el par√°metro de
entrada VALID de PE_I_DEV_CP.

0: ning√∫n error

Indicador de error

1: error
STATUS

OUTPUT

WORD

0: ning√∫n error

Indicador de estado
80B1h: error en la indicaci√≥n de ANY (p. ej.
√°rea err√≥nea)

7406

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros individuales de los FCs
Par√°metros individuales de FC 0 a FC 8
A continuaci√≥n se describen los par√°metros individuales de los FCs.

PE_ERROR_RSP
Genera una respuesta negativa si el comando PROFIenergy solicitante no se soporta en
general o temporalmente. La respuesta negativa es independiente del comando solicitante.
Tabla 4-430 Par√°metros individuales de FC 0 PE_ERROR_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

ERROR_CODE

INPUT

BYTE

N√∫mero de error

PE_START_RSP
Inicia una pausa de ahorro de energ√≠a. Genera la respuesta al comando "Start_Pause".
Devuelve el modo de ahorro de energ√≠a que adopta el dispositivo.
Tabla 4-431 Par√°metros individuales de FC 1 PE_START_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

PE_Mode_ID

INPUT

BYTE

ID del modo de ahorro de energ√≠a que adopta
el dispositivo o grupo.

Notificaci√≥n de la PE_Mode_ID del modo de ahorro de energ√≠a que ha adoptado el aparato de
campo o el grupo.

PE_END_RSP
Genera la respuesta al comando "End_Pause".
Tabla 4-432 Par√°metros individuales de FC 2 PE_END_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

Time_to_Operate

INPUT

DWORD

Tiempo necesario para cambiar del modo de
ahorro de energ√≠a actual a "operativo"
(Ready_to_Operate).

PE_LIST_MODES_RSP
Genera la respuesta al comando Query_Modes" > modificador "List_Modes" (lista de los
modos de ahorro de energ√≠a soportados).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7407

Instrucciones
4.2 Instrucciones
Las IDs de los modos de ahorro de energ√≠a deben especificarse en el programa de usuario.
Tabla 4-433 Par√°metros individuales de FC 3 PE_LIST_MODES_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

Number_of_PE_Mode_IDs

INPUT

BYTE

N√∫mero de modos de ahorro de energ√≠a sopor‚Äê
tados

PE_Mode_ID

INPUT

ANY

‚óè 00h
‚óè 01h...FEh
‚óè FFh

Puntero hacia el √°rea en el que est√°n almace‚Äê
nados los modos de ahorro de energ√≠a.
El usuario debe almacenar aqu√≠ las IDs de los
modos de ahorro de energ√≠a. La ID de un modo
de ahorro de energ√≠a se configura en formato
Unsigned8. Rango admisible: de 1 a 254 bytes.

Si los aparatos de un grupo reaccionan de forma distinta en pausas de diferente longitud, es
posible establecer diferentes modos de ahorro de energ√≠a (PE_Mode). Los diferentes modos
de ahorro de energ√≠a reciben una PE_Mode_ID distinta.
Valore posibles para "PE_Mode_ID":
‚óè 00h: PE_Power_off (fuente de alimentaci√≥n desconectada)
‚óè 01h...FEh: libremente configurable o espec√≠fico del fabricante
‚óè FFh: PE_Ready_to_operate (operativo)

PE_GET_MODE_RSP
Genera la respuesta al comando "Query_Modes" > Modifier "Get_Mode".
Tabla 4-434 Par√°metros individuales de FC 4 PE_GET_MODE_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

PE_Mode_ID

INPUT

BYTE

ID de modo de ahorro de energ√≠a que se utiliza
actualmente

Time_Min_Pause *

INPUT

Unsigned32

Duraci√≥n m√≠n. de pausa para este modo de
ahorro de energ√≠a PE. Es la suma de los tres
par√°metros:
‚óè Time_to_Pause
‚óè Time_to_operate
‚óè Time_min_length_of_stay

Time_to_Pause *

INPUT

Unsigned32

Duraci√≥n desde el flanco START hasta alcan‚Äê
zar el modo de ahorro de energ√≠a solicitado

Time_to_operate *

INPUT

Unsigned32

Tiempo de conexi√≥n m√°x. hasta
PE_ready_to_operate
Time_to_operate puede utilizarse directamente
para los c√°lculos correspondientes. El valor
puede ser bien un valor MAX est√°tico bien ser
calculado por el dispositivo PE.

Time_min_length_of_stay *

7408

INPUT

Unsigned32

Duraci√≥n m√≠nima de permanencia del dispositi‚Äê
vo PE en este PE_Mode.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

Time_max_length_of_stay *

INPUT

Unsigned32

Duraci√≥n m√°xima de permanencia del disposi‚Äê
tivo PE en este PE_Mode.

Mode_Power
_Consumption **

INPUT

Float32

Consumo de energ√≠a en el PE_Mode actual
[kW]

Energy_Consumption
_to_pause **

INPUT

Float32

Consumo de energ√≠a de PE_ready_to_operate
hasta el PE_Mode actual [kWh]

Energy_Consumption
_to_operate **

INPUT

Float32

Consumo de energ√≠a del PE_Mode actual hasta
PE_ready_to_operate [kWh]

* El perfil PROFIenergy no especifica ning√∫n formato de tiempo no v√°lido.
Si la duraci√≥n es ilimitada es posible indicar el valor m√°x. FFFFFFFFh.
Si la duraci√≥n es cero es posible utilizar 00h.
** Si no se ha definido ning√∫n valor de consumo de energ√≠a es posible indicar 0,0 (Float32).

PE_PEM_STATUS_RSP
Genera la respuesta al comando "PEM_STATUS".
Tabla 4-435 Par√°metros individuales de FC 5 PE_PEM_STATUS_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

PE_Mode_ID_Source

INPUT

BYTE

ID del modo de ahorro de energ√≠a que se ha
adoptado realmente

‚óè 00h
‚óè 01h...FEh
‚óè FFh

PE_Mode_ID_Destination

INPUT

BYTE

‚óè 00h
‚óè 01h...FEh

ID del modo de ahorro de energ√≠a especificado
por el controlador

‚óè FFh
Time_to_operate *

INPUT

Unsigned32

Tiempo de conexi√≥n m√°x. hasta
PE_ready_to_operate
Time_to_operate puede utilizarse directamente
para los c√°lculos correspondientes. El valor
puede ser bien un valor MAX est√°tico bien ser
calculado por el dispositivo PE.

Remaining_time_to
_destination *

INPUT

Unsigned32

Opcional: tiempo restante hasta el PE_Mode
solicitado. Valor din√°mico o valor MAX est√°tico

Mode_Power
_Consumption **

INPUT

Float32

Consumo de energ√≠a en el PE_Mode actual
[kW]

Energy_Consumption
_to_Destination **

INPUT

Float32

Consumo de energ√≠a hasta el PE_Mode solici‚Äê
tado [kWh]

Energy_Consumption
_to_operate **

INPUT

Float32

Consumo de energ√≠a del PE_Mode actual hasta
PE_ready_to_operate [kWh]

* El perfil PROFIenergy no especifica ning√∫n formato de tiempo no v√°lido.
Si la duraci√≥n es ilimitada es posible indicar el valor m√°x. FFFFFFFFh.
Si la duraci√≥n es cero es posible utilizar 00h.
** Si no se ha definido ning√∫n valor de consumo de energ√≠a es posible indicar 0,0 (Float32).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7409

Instrucciones
4.2 Instrucciones
Valore posibles para "PE_Mode_ID_Source" y "PE_Mode_ID_Destination":
‚óè 00h: PE_Power_off (fuente de alimentaci√≥n desconectada)
‚óè 01h...FEh: libremente configurable o espec√≠fico del fabricante
‚óè FFh: PE_Ready_to_operate (operativo)

PE_IDENTIFY_RSP
Genera la respuesta al comando "PE_Identify".
El usuario debe indicar los comandos PROFIenergy que se soportan.
Tabla 4-436 Par√°metros individuales de FC 6 PE_IDENTIFY_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

Count

INPUT

BYTE

0...6

N√∫mero de comandos PROFIenergy soporta‚Äê
dos

Start_Pause

INPUT

BOOL

0...1

‚óè 1: el comando se soporta

End_Pause

INPUT

BOOL

0...1

‚óè 1: el comando se soporta

‚óè 0: el comando no se soporta
‚óè 0: el comando no se soporta
Query_Modes

INPUT

BOOL

0...1

‚óè 1: el comando se soporta
‚óè 0: el comando no se soporta

PEM_Status

INPUT

BOOL

0...1

‚óè 1: el comando se soporta
‚óè 0: el comando no se soporta

PEM_Identify

INPUT

BOOL

0...1

‚óè 1: el comando se soporta
‚óè 0: el comando no se soporta

Query_Measurement

INPUT

BOOL

0...1

‚óè 1: el comando se soporta
‚óè 0: el comando no se soporta

7410

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

PE_MEASUREMENT_LIST_RSP
Genera la respuesta al comando "Query_Measurement" > Modifier "Get_Measurement_List".
Tabla 4-437 Par√°metros individuales de FC 7 PE_MEASUREMENT_LIST_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

Count

INPUT

BYTE

N√∫mero de IDs de valor medido soportadas
(Measurement_ID)

Measurement_List

INPUT

ANY

Puntero hacia el √°rea de datos con las IDs de
valor medido soportadas.
El usuario debe almacenar las IDs de valor me‚Äê
dido en esta √°rea de datos.
Es posible transferir un m√°ximo de 29 IDs de
valor medido por telegrama.
Consulte la estructura de la matriz en el cap√≠tulo
AUTOHOTSPOT > "Query_Measurement" ‚Äì
Get_Measurement_List.

PE_MEASUREMENT_VALUE_RSP
Genera la respuesta al comando "Query_Measurement" > Modifier
"Get_Measurement_Values".
Tabla 4-438 Par√°metros individuales de FC 8 PE_MEASUREMENT_VALUE_RSP
Par√°metro

Declaraci√≥n

Tipo de datos Valores posi‚Äê
bles

Descripci√≥n

Count

INPUT

BYTE

N√∫mero de Measurement_Values soportados

Measurement_Values

INPUT

ANY

Puntero hacia el √°rea de datos de los valores
medidos (Measurement_Values).
El usuario debe almacenar los valores medidos
en esta √°rea de datos.
Es posible transferir un m√°ximo de 116 valores
medidos por telegrama.
Consulte la estructura de la matriz en el cap√≠tulo
AUTOHOTSPOT > "Query_Measurement" ‚Äì
Get_Measurement_List.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7411

Instrucciones
4.2 Instrucciones

PE_DS3_WRITE_ET200S_CP
Significado y llamada - PE_DS3_WRITE_ET200_CP
Significado y funcionamiento
En la CPU del CP 300 funcionando como controlador PROFIenergy se utiliza
PE_DS3_WRITE_ET200_CP para transferir ajustes del comportamiento de conmutaci√≥n de
los m√≥dulos de potencia a un ET 200S. Es posible transferir el comportamiento de
conmutaci√≥n para un m√°ximo de 8 slots (en este caso: m√≥dulos de potencia).
PE_DS3_WRITE_ET200_CP no es un bloque de programa PROFIenergy.

Interfaz de llamada en representaci√≥n FUP
3(B'6B:5,7(B(76B&3
:25'

&3/$''5

%86<

%22/

%22/

(1$%/(

'21(

%22/

:25'

,'

(5525

%22/

,17

6/27B12B

67$786

:25'

,17

)81&B


,17

6/27B12B

,17

)81&B

Explicaci√≥n de los par√°metros formales de PE_DS3_WRITE_ET200S_CP
Explicaci√≥n de los par√°metros formales de PE_DS3_WRITE_ET200_CP
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

CPLADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo del CP

ENABLE

INPUT

BOOL

Con flanco ascendente comienza el procesa‚Äê
miento del bloque de programa.

ID

INPUT

WORD

Direcci√≥n l√≥gica del slot de encabezado del
dispositivo IO

SLOT_NO_1

INPUT

INT

N√∫mero de slot del primer m√≥dulo de poten‚Äê
cia

7412

I, Q, M, D, L, const.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Valores posibles
tos

Descripci√≥n

FUNC_1

INPUT

INT

Definici√≥n del comportamiento de conmuta‚Äê
ci√≥n para el m√≥dulo de potencia en relaci√≥n al
inicio y fin de las pausas de ahorro de energ√≠a
‚óè 0 (FALSE)
‚Äì

PAUSE_START:
no influye (el m√≥dulo de potencia
permanece conectado)

‚Äì

PAUSE_STOP:
vuelve a conectar el m√≥dulo de
potencia.

‚óè 1 (TRUE)
‚Äì

PAUSE_START:
desconecta el m√≥dulo de potencia.

‚Äì

PAUSE_STOP:
vuelve a conectar el m√≥dulo de
potencia.

...

INPUT

INT

...

INPUT

INT

SLOT_NO_8

INPUT

INT

N√∫mero de slot del octavo m√≥dulo de poten‚Äê
cia

FUNC_8

INPUT

INT

Consulte "FUNC_1"

BUSY

OUTPUT

BOOL

0: procesamiento todav√≠a no ini‚Äê Indicador del estado de procesamiento del
ciado, finalizado o cancelado
bloque de programa
1: procesamiento en curso

DONE

OUTPUT

BOOL

0: 1: registro transferido correcta‚Äê
mente

ERROR

OUTPUT

BOOL

0: -

El par√°metro de estado indica si la petici√≥n se
ha desarrollado correctamente.
Indicador de error

1: error
STATUS

OUTPUT

WORD

Indicador de estado

Encontrar√° el significado de DONE, ERROR y STATUS en Indicadores de
PE_DS3_WRITE_ET200S_CP (P√°gina 7413).

Indicadores de PE_DS3_WRITE_ET200S_CP
Indicadores de PE_DS3_WRITE_ET200_CP
PE_DS3_WRITE_ET200_CP se basa en el bloque de programa PNIO_RW_REC y
proporciona todos los indicadores de PNIO_RW_REC, consulte los indicadores del bloque
PNIO_RW_REC.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7413

Instrucciones
4.2 Instrucciones

Instrucciones para enlaces programados
Sinopsis
Relaci√≥n entre programaci√≥n y configuraci√≥n
Los enlaces en la interfaz SEND/RECEIVE, as√≠ como la configuraci√≥n IP de un CP se
configuran con STEP 7 o bien mediante el programa de usuario durante el funcionamiento del
equipo S7. ¬°En un CP no puede utilizarse una combinaci√≥n de ambas variantes!

Principio de la configuraci√≥n programada
Con una instrucci√≥n llamada en el programa de usuario se pueden transferir al CP datos de
configuraci√≥n para enlaces de comunicaci√≥n y la configuraci√≥n IP (datos de sistema para CP).
%ORTXHGHGDWRVGHFRQILJXUDFL¬µQ
)%,3B&21),*

'DWRVGHVLVWHPD
SDUD&3
(QODFH
(QODFH

'DWRVGHFRQILJXUDFL¬µQ
WUDQVIHULGRVDO&3

(QODFHQ
QP¬£[ 

El DB de configuraci√≥n puede cargarse en el CP en cualquier momento. Se sobrescriben los
enlaces y los datos de configuraci√≥n (direcci√≥n IP, m√°scara de subred, router predeterminado,
servidor de reloj NTP y otros par√°metros) que antes eran actuales.
A partir de los datos de configuraci√≥n, el CP Ethernet reconoce que los enlaces de
comunicaci√≥n deben configurarse a trav√©s del programa de usuario.
Nota
Las funciones s√≥lo pueden ejecutarse si el nivel de protecci√≥n de los m√≥dulos ha sido
configurado como "No bloqueado": V√©ase el cuadro de di√°logo de propiedades del CP, ficha
"Opciones" (no con todos los CPs)
Adem√°s debe estar activada la opci√≥n "Crear direcci√≥n IP en el programa de usuario" (v√©ase
el cuadro de propiedades del CP o de la interfaz Ethernet del CP, ficha "Configuraci√≥n IP")

7414

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
A partir de los datos de configuraci√≥n, el CP Ethernet reconoce que los enlaces de
comunicaci√≥n deben configurarse a trav√©s del programa de usuario.
Nota
En cuanto el programa de usuario transfiere los datos de enlace a trav√©s de la instrucci√≥n
IP_CONFIG, la CPU pone el CP brevemente en modo STOP. El CP adopta los datos de
sistema (incluida la direcci√≥n IP) y los nuevos datos de enlace y los procesa en el arranque
(RUN).

Datos cuantitativos
En la instrucci√≥n IP_CONFIG pueden indicarse como m√°ximo 64 enlaces. Sin embargo, el
factor determinante es el n√∫mero m√°ximo de enlaces soportados por el tipo de CP utilizado.

Particularidades/limitaciones
‚óè Comprobaci√≥n de coherencia solo en la configuraci√≥n
La configuraci√≥n de enlaces est√° vinculada a comprobaciones de coherencia, que para la
configuraci√≥n programada no son posibles, o lo son de forma limitada.
‚óè Configuraci√≥n de enlace necesaria en el interlocutor
En la configuraci√≥n de enlaces especificados se crea impl√≠citamente el enlace para el
interlocutor, pero en la configuraci√≥n programada esto no es posible. En este caso deben
configurarse los enlaces correspondientes para los interlocutores.
‚óè Configuraci√≥n del de protecci√≥n IP
A trav√©s del nivel de protecci√≥n IP existe la posibilidad de limitar la comunicaci√≥n a trav√©s
del CP del equipo S7 local a interlocutores con direcciones IP espec√≠ficas. Esta
parametrizaci√≥n tambi√©n es aplicable para enlaces de comunicaci√≥n programadas. Debe
desactivar por completo (ajuste predeterminado) la protecci√≥n de acceso IP en la
configuraci√≥n o autorizar los interlocutores.
‚óè DHCP/DNS soportado
El direccionamiento IP es posible en la configuraci√≥n programada tambi√©n a trav√©s de
DHCP (y DNS para el servicio de correo electr√≥nico)
En este caso, el uso de un servidor DHCP se define en la instrucci√≥n IP_CONFIG (no en la
configuraci√≥n).
‚óè Ninguna informaci√≥n de enlace durante la carga
Al cargar los datos de equipo S7 en la configuraci√≥n no est√°n contenidos los datos de la
configuraci√≥n programada.
‚óè Configuraci√≥n de enlaces en CPs con varias interfaces
En CPs con varias interfaces (p. ej. con interfaz Gigabit), aseg√∫rese, consultando el manual
de producto del CP, de que √©ste soporta la configuraci√≥n de enlaces para ambas interfaces.
‚óè PROFINET IO no es posible simult√°neamente
Para dispositivos que deban funcionar como controlador PROFINET IO o dispositivo IO no
es posible la configuraci√≥n de enlaces a trav√©s del FB55 aqu√≠ descrito.
‚óè No utilizar la instrucci√≥n IP_CONFIG para uso del CP con enlaces S7 altamente disponibles
Si configura enlaces S7 altamente disponibles a trav√©s del CP, no debe utilizar la
instrucci√≥n IP_CONFIG para la configuraci√≥n IP del CP.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7415

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
IP_CONFIG para enlaces de comunicaci√≥n programados (P√°gina 7416)
Bloque de datos de configuraci√≥n (P√°gina 7421)

IP_CONFIG
IP_CONFIG para enlaces de comunicaci√≥n programados
Descripci√≥n
La instrucci√≥n IP_CONFIG transmite al CP los datos de conexi√≥n especificados en un bloque
de datos (DB de configuraci√≥n). El DB de configuraci√≥n contiene todos los datos para
configurar las conexiones para la interfaz SEND/RECEIVE de un CP Ethernet.
Esta variante de las conexiones de comunicaci√≥n programadas se puede utilizar como
alternativa a la configuraci√≥n de conexiones con STEP 7.
Dependiendo del tama√±o del DB de configuraci√≥n, la transmisi√≥n al CP puede tener lugar en
varios segmentos. Por esta raz√≥n se tiene que llamar de nuevo una y otra vez la instrucci√≥n
hasta que esta se√±alice que se ha completado la transmisi√≥n con el bit DONE=1.

Llamada
Interfaz de llamada en representaci√≥n FUP
,3B&21),*
%22/

$&7

'21(

%22/

:25'

/$''5

(5525

%22/

$1<

&21)B'%

67$786

:25'

,17

/(1

(;7B67$786

:25'

Nota
No utilizar la instrucci√≥n IP_CONFIG en caso de emplear un CP con conexiones S7 de alta
disponibilidad
Si configura conexiones S7 de alta disponibilidad a trav√©s del CP, no debe utilizar la instrucci√≥n
IP_CONFIG para la configuraci√≥n IP del CP.

7416

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nota
Atender a un posible direccionamiento doble
Si desea utilizar la instrucci√≥n IP_CONFIG, deber√° prestar una especial atenci√≥n a la
asignaci√≥n un√≠voca de las direcciones IP. Si se detecta una direcci√≥n duplicada, puede
suceder que el CP no se active en la red.

Consulte tambi√©n
Sinopsis (P√°gina 7414)
Bloque de datos de configuraci√≥n (P√°gina 7421)
Par√°metros en el caso de IP_CONFIG (P√°gina 7417)
N√∫meros de puerto reservados - IP_CONFIG (P√°gina 7418)
Par√°metros DONE, ERROR, STATUS (P√°gina 7419)

Par√°metros en el caso de IP_CONFIG
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la interfaz de
llamada de la instrucci√≥n "IP_CONFIG":
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ACT

INPUT

BOOL,
TIMER,
COUN‚Äê
TER

0,1

En el caso de una llamada de la instrucci√≥n con ACT =
1 se env√≠a el DBxx al CP.

LADDR

INPUT

En el caso de una llamada de la instrucci√≥n con ACT =
0 solo se actualizan las indicaciones de estado DONE,
ERROR y STATUS.

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7 aparece la direcci√≥n
inicial del m√≥dulo en la tabla de configuraci√≥n. Indique
aqu√≠ esta direcci√≥n.

CONF_DB

INPUT

ANY

El par√°metro hace referencia a la direcci√≥n inicial del
√°rea de datos de configuraci√≥n en un bloque de datos
(tipo de datos: Byte).

LEN

INPUT

INT

Indicaci√≥n de longitud en byte para el √°rea de datos de
configuraci√≥n.

DONE

OUTPUT

BOOL

0: 1: petici√≥n concluida
con transmisi√≥n de da‚Äê
tos.

El par√°metro indica si el √°rea de datos de configuraci√≥n
se ha transmitido completa.
Tenga en cuenta que, dependiendo del tama√±o del √°rea
de datos de configuraci√≥n, la instrucci√≥n se tiene que
impulsar varias veces (en varios ciclos), hasta que la
indicaci√≥n DONE=1 se√±aliza la finalizaci√≥n.
La tabla siguiente informa sobre el significado en rela‚Äê
ci√≥n con los par√°metros ERROR y STATUS.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7417

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores

Descripci√≥n

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicador de error

STATUS

OUTPUT

WORD

La tabla siguiente informa sobre el significado en rela‚Äê
ci√≥n con los par√°metros DONE y STATUS.

V√©ase la tabla siguiente Indicador de estado
La tabla siguiente informa sobre el significado en rela‚Äê
ci√≥n con los par√°metros DONE y ERROR.

EXT_Status OUTPUT

WORD

En caso de una ejecuci√≥n incorrecta de la petici√≥n, el
par√°metro indica cual de los par√°metros del DB de con‚Äê
figuraci√≥n se ha reconocido como causante del fallo.
Byte High: √çndice del bloque de par√°metros
Byte Low: √çndice del subbloque dentro del bloque de
par√°metros

Consulte tambi√©n
IP_CONFIG para enlaces de comunicaci√≥n programados (P√°gina 7416)

N√∫meros de puerto reservados - IP_CONFIG
N√∫meros de puerto reservados
Los siguientes n√∫meros de puertos locales est√°n reservados; no los utilice para la
configuraci√≥n de enlaces.
Tabla 4-439 N√∫meros de puerto reservados
Protocolo

N√∫mero de puerto

Servicio

TCP

20, 21

FTP

TCP

25

SMTP

TCP

80

HTTP

TCP

102

RFC1006

TCP

135

RPC-DCOM

TCP

502

ASA Application Protocol

UDP

161

SNMP_REQUEST

UDP

34964

PN IO

UDP

65532

NTP

UDP

65533

NTP

UDP

65534

NTP

UDP

65535

NTP

Consulte tambi√©n
IP_CONFIG para enlaces de comunicaci√≥n programados (P√°gina 7416)

7418

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros DONE, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
Tabla 4-440 C√≥digos de condici√≥n IP_CONFIG
DONE

ERROR

STATUS

Significado

Indicaciones generales sobre la ejecuci√≥n de la petici√≥n
1

0

0000H

Petici√≥n terminada sin errores.

0

0

8181H

Petici√≥n en curso

Errores que se han detectado en la interfaz entre la CPU y el CP.
0

1

80A4H

‚óè Error de comunicaci√≥n en el bus de comunicaciones
o bien
‚óè Error de datos: No esta ajustado que la configuraci√≥n se efect√∫e a trav√©s del
programa de usuario.

0

1

80B1H

La cantidad de datos a enviar supera el l√≠mite superior admisible para este servicio.
(Limite superior = 16 KB)

0

1

80C4H

Error de comunicaci√≥n
El error se puede presentar temporalmente; por ello, es conveniente una repetici√≥n en el
programa de usuario.

0

1

80D2H

Error de configuraci√≥n
El m√≥dulo utilizado no da soporte a este servicio.

Errores que se han detectado durante la evaluaci√≥n de IP_CONFIG en la CPU o en la interfaz entre la CPU y el CP.
0

1

8183H

El CP no admite el n√∫mero de registro de datos solicitado.

0

1

8184H

Error del sistema o tipo de par√°metro no permitido. (tipo de datos del puntero ANY
CONF_DB no es correcto)
(actualmente s√≥lo se acepta el tipo de datos bytes)

0

1

8185H

El valor del par√°metro LEN es mayor que el CONF_DB menos la cabecera reservada (4
bytes) o la longitud indicada no es correcta.

0

1

8186H

Se ha detectado par√°metro no permitido

0

1

8187H

Estado no v√°lido de IP_CONFIG

El puntero ANY CONF_DB no hace referencia a ning√∫n bloque de datos.
Es posible que se hayan sobrescrito datos en la cabecera del CONF_DB.
Errores adicionales que se han detectado en la interfaz entre la CPU y el CP.
0

1

8A01H

La indicaci√≥n de estado en el registro de datos le√≠do no es v√°lida (valor >= 3).

0

1

8A02H

No existe ninguna petici√≥n en curso en el CP. Sin embargo, el IP_CONFIG estaba es‚Äê
perando a un acuse para la petici√≥n en curso.

0

1

8A03H

No existe ninguna petici√≥n en curso en el CP y el CP no est√° listo. El IP_CONFIG ha
iniciado una primera petici√≥n para leer el registro de datos.

0

1

8A04H

No existe ninguna petici√≥n en curso en el CP y el CP no est√° listo. Sin embargo, el
IP_CONFIG estaba esperando a un acuse para la petici√≥n en curso.

0

1

8A05H

Existe una petici√≥n en curso, sin embargo, no se ha producido el acuse. Sin embargo, el
IP_CONFIG ha iniciado una primera petici√≥n para leer el registro de datos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7419

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8A06H

Una petici√≥n ha terminado. Sin embargo, el IP_CONFIG ha iniciado una primera petici√≥n
para leer el registro de datos.

Errores que se han detectado durante las evaluaciones del IP_CONFIG en el CP.
0

1

8B01H

0

1

8B02H

Error de comunicaci√≥n
No se ha podido transmitir el DB.
Error de par√°metro
Bloque de par√°metros doble

0

1

8B03H

Error de par√°metro
El subbloque en el bloque de par√°metros no est√° permitido.

0

1

8B04H

Error de par√°metro
La longitud indicada en la instrucci√≥n no coincide con la longitud de los bloques de
par√°metros/subbloques.

0

1

8B05H

Error de par√°metro
La longitud del bloque de par√°metros no es v√°lida.

0

1

8B06H

Error de par√°metro
La longitud del subbloque no es v√°lida.

0

1

8B07H

Error de par√°metro
La ID del bloque de par√°metros no es v√°lida.

0

1

8B08H

Error de par√°metro
La ID del subbloque no es v√°lida.

0

1

8B09H

Error del sistema
El enlace no existe

0

1

8B0AH

Error de datos
El contenido del subbloque no es correcto.

0

1

8B0BH

Error de estructura
Un subbloque aparece por duplicado.

0

1

8B0CH

Error de datos

0

1

8B0DH

Error de datos

0

1

8B0EH

Error de datos / error de estructura

0

1

8B0FH

Error del sistema

El bloque de par√°metros no contiene todos los par√°metros necesarios.
El CONF_DB contiene ning√∫n bloque de par√°metros para los datos de sistema.
El tipo de CONF_DB no es v√°lido.
El CP no dispone de suficientes recursos para poder procesar el CONF_DB completa‚Äê
mente.
0

1

8B10H

Error de datos

0

1

8B11H

Error de datos

0

1

8B12H

No esta ajustado que la configuraci√≥n se efect√∫e a trav√©s del programa de usuario.
El tipo indicado del bloque de par√°metros no es v√°lido.
Error de datos
Se ha indicado una cantidad excesiva de enlaces (o bien en total o demasiados de un tipo
determinado; por ejemplo, s√≥lo se permite una conexi√≥n de correo electr√≥nico).
0

1

8B13H

Error interno del CP

0

1

8B14H

El nivel de protecci√≥n activo no permite la realizaci√≥n del cambio.

7420

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

Errores adicionales que se han detectado en las interfaces del programa a nivel interno de la CPU (errores de instrucci√≥n del
sistema).
0

1

8F22H

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

1

8F24H

Error de √°rea al leer un par√°metro.

0

1

8F25H

Error de √°rea al escribir un par√°metro.

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro.

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos actual protegido de escritura.

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos actual protegido de escritura.

0

1

8F32H

El par√°metro contiene un n√∫mero de DB demasiado alto.

0

1

8F33H

Error de n√∫mero de DB

0

1

8F3AH

El √°rea de destino no se ha cargado (DB).

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia.

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia.

0

1

8F44H

Est√° bloqueado el acceso a un par√°metro a leer para el procesamiento de la instrucci√≥n.

0

1

8F45H

Est√° bloqueado el acceso a un par√°metro a escribir para el procesamiento de la instruc‚Äê
ci√≥n.

0

1

8F7FH

Error interno
Se ha detectado p. ej. referencia ANY no admisible.

Consulte tambi√©n
IP_CONFIG para enlaces de comunicaci√≥n programados (P√°gina 7416)

Bloque de datos de configuraci√≥n
Bloque de datos de configuraci√≥n (CONF_DB)
Significado
El bloque de datos de configuraci√≥n (CONF_DB) contiene todos los datos de enlace y
configuraci√≥n (direcci√≥n IP, m√°scara de subred, router predeterminado, servidor de reloj NTP
y otros par√°metros) para un CP Ethernet. El bloque de datos de configuraci√≥n se transfiere al
CP con la instrucci√≥n IP_CONFIG.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7421

Instrucciones
4.2 Instrucciones

Composici√≥n/estructura de datos
En la siguiente representaci√≥n puede observar:
‚óè La estructuraci√≥n en bloques de par√°metros y subbloques
‚Äì Cada enlace y, en especial, los datos de sistema se describen mediante un bloque de
par√°metros de id√©ntica estructura.
‚Äì Los distintos par√°metros se tipifican mediante subbloques.
‚óè √Årea offset
El CONF_DB puede comenzar en cualquier punto dentro de un bloque de datos a trav√©s de
un √°rea offset. La √∫nica condici√≥n es que la direcci√≥n (o bien el offset) sea par.
%ORTXHGHGDWRV
GHFRQILJXUDFL¬µQ
¬ÉUHDRIIVHWQ
&21)B'%
,GHQWLILFDGRUGH'%
'DWRVGHVLVWHPDSDUD&3

%ORTXHGHSDU¬£PHWURVSDUDGDWRVGHVLVWHPD
FRQH[L¬µQGH&3DODUHG \HQODFHV
7LSR
,' FRQGDWRVGHVLVWHPD 

(QODFH
(QODFH

1¬ºPHURBGHBVXEEORTXHV

6XEEORTXH

6XEEORTXH

3DU¬£PHWURV
LQGLYLGXDOHV

6XEEORTXH
(QODFHQ

6XEEORTXHQ




‚ë†
‚ë°

Los bloques de par√°metros se describen a continuaci√≥n en Bloque de par√°metros para datos de sistema (configu‚Äê
raci√≥n IP) (P√°gina 7422)
Los tipos de subbloque se describen a continuaci√≥n en Bloques de par√°metros para tipos de enlaces (P√°gina 7426)

Bloque de par√°metros para datos de sistema (configuraci√≥n IP)
Significado
A continuaci√≥n encontrar√° el bloque de par√°metros relevante para la configuraci√≥n IP del CP
para datos de sistema y los subbloques que deben indicarse en √©l.
Dependiendo de cada caso, no son necesarios todos los tipos de subbloque (v√©ase la tabla
para m√°s informaci√≥n).

7422

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Estructura
Para los CPs con varias interfaces, la estructura de bloque de par√°metros descrita a
continuaci√≥n s√≥lo es aplicable para la interfaz PROFINET.
‚óè Tipo = 0
‚óè ID = 0
‚óè N√∫mero_subbloques = n
‚óè Subbloque 1
‚óè Subbloque 2
‚óè Subbloque n
...

Subbloques utilizables
Subbloque

Par√°metro

ID

Tipo

Particularidades/indicaciones

1

SUB_IP_V4

Direcci√≥n IP local

++

2

SUB_NETMASK

-

++

8

SUB_DEF_ROUTER

-

+

4

SUB_DNS_SERV_ADDR *)

Este subbloque puede aparece hasta 0-4 veces. La prime‚Äê +
ra entrada es el Primary DNS Server

14

SUB_DHCP_ENABLE

0: sin DHCP

Aplicaci√≥n ***)

+

1: DHCP
15

SUB_CLIENT_ID

-

+

Observaci√≥n: S√≥lo √∫til si SUB_DHCP_ENABLE = 1
30**)

SUB_DEVICE_NAME

Nombre de dispositivo seg√∫n la convenci√≥n PROFINET IO +
Indique un nombre de dispositivo para permitir la identifi‚Äê
caci√≥n un√≠voca del dispositivo para fines de an√°lisis y diag‚Äê
n√≥stico en la red.

*) El tipo de subbloque s√≥lo se utiliza para enlaces de correo electr√≥nico.
**) El ID s√≥lo es soportado por determinados tipos de CP.
***) ++ = obligatorio; + = opcional

Consulte tambi√©n
Tipos de subbloque (P√°gina 7423)

Tipos de subbloque
Dependiendo del bloque de par√°metros, se requieren diferentes par√°metros. Cada par√°metro
es descrito por un subbloque. Los subbloques necesarios pueden consultarse en las
descripciones de los datos de sistema y de los tipos de enlace de los cap√≠tulos anteriores.
Cada subbloque se compone de la secci√≥n de par√°metro espec√≠fica y de un encabezado (4
bytes).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7423

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente extracto de un CONF_DB muestra la estructura de un subbloque a partir del
ejemplo del tipo de subbloque SUB_NETMASK.
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+14.0

Sub_bloque_2

STRUCT

+0.0

ID_de_sub_bloque

INT

2

// ID de subbloque

+2.0

Sub_bloque_Len

INT

8

// Longitud total del subbloque en
bytes

+4.0

Par√°metro

STRUCT

+0.0

Valor_1

BYTE

B#16#FF

+1.0

Valor_2

BYTE

B#16#FF

+2.0

Valor_3

BYTE

B#16#FF

+3.0

Valor_4

BYTE

B#16#0

=4.0

END_

STRUCT

=8.0

END_

STRUCT

// Subbloque 2 tipo SUB_NET‚Äê
MASK

√Årea de par√°metros SUB_NET‚Äê
MASK

En total est√°n disponibles los siguientes tipos de subbloque:
ID de
subbloque 1)

Tipo de subbloque

Longitud de subbloque
(en bytes)

Significado del par√°metro

1

SUB_IP_V4

4+4

Direcci√≥n IP seg√∫n IPv4

2

SUB_NETMASK

4+4

M√°scara de subred

3

SUB_DNS_NAME

Longitud nombre DNS
+4

Nombre DNS

4

SUB_DNS_SERV_ADDR

4+4

Direcci√≥n servidor DNS

8

SUB_DEF_ROUTER

4+4

Direcci√≥n IP del router predeterminado

9

SUB_LOC_PORT

2+4

Puerto local

10

SUB_REM_PORT

2+4

Puerto remoto, tambi√©n para enlaces de co‚Äê
rreo electr√≥nico

11

SUB_LOC_TSAP

Longitud TSAP + 4

TSAP local

12

SUB_REM_TSAP

Longitud TSAP + 4

TSAP remoto

13

SUB_EMAIL_SENDER

Longitud de la direcci√≥n
del remitente del men‚Äê
saje + 4

Direcci√≥n de correo electr√≥nico del remitente

14

SUB_DHCP_ENABLE

2+4

Obtener la direcci√≥n IP de un servidor DHCP.
‚óè Rango de valores:
0 = sin DHCP
1 = DHCP
(opcional)

15

SUB_CLIENT_ID

Longitud del ID de clien‚Äê
te + 4

18

SUB_CONNECT_NAME

Longitud del nombre + 4 Nombre del enlace. Los caracteres posibles
son: a...z, A...Z, 0...9, -, _

7424

(opcional)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ID de
subbloque 1)

Tipo de subbloque

Longitud de subbloque
(en bytes)

Significado del par√°metro

19

SUB_LOC_MODE

1+4

Modo de operaci√≥n local del enlace
‚óè Rango de valores:
0x00 = SEND/RECV
0x01 = protocolo FTP (s√≥lo enlace TCP)
0x10 = modo de direccionamiento S5 con
FETCH/WRITE *)
0x20 = SPEED SEND/RECV (s√≥lo
permitido con CP 443-1 Advanced)
0x80 = FETCH *)
0x40 = WRITE *)
El ajuste predeterminado renunciando al pa‚Äê
r√°metro es SEND/RECV.
Observaci√≥n:
FETCH / WRITE requieren el ajuste de una
estructura de enlace pasiva (v√©ase
SUB_CON_ESTABL).

20

SUB_REM_MODE

1+4

Ajuste del modo de operaci√≥n en el interlocu‚Äê
tor.

21

SUB_KBUS_ADR

5

Direcci√≥n KBUS de la CPU (s√≥lo relevante
para S7‚Äì400)

22

SUB_CON_ESTABL

1+4

Tipo de establecimiento del enlace.

(actualmente no soportado)

Con esta opci√≥n se determina si el enlace de‚Äê
be ser establecido por este equipo S7 de for‚Äê
ma activa o pasiva.
‚óè Rango de valores:
0 = pasivo
1 = activo
23

SUB_ADDR_IN_DATA-BLOCK

1+4

Seleccionar un enlace UDP libre.
Con la llamada de AG_SEND, el programa de
usuario registra la estaci√≥n remota en el en‚Äê
cabezado de petici√≥n del b√∫fer de peticiones.
De ese modo es posible acceder a cualquier
estaci√≥n de Ethernet/LAN/WAN.
‚óè Rango de valores:
1 = enlace UDP libre.
0 = otros
El par√°metro s√≥lo es √∫til para el enlace UDP.

24

SUB_NTP_SERVER

4+4

El subbloque define un servidor NTP del cual
el CP puede obtener la hora a trav√©s del pro‚Äê
tocolo NTP.
Si se definen uno o m√°s servidores NTP, pue‚Äê
den definirse hasta 4 subbloques del ID 24.
Los subbloques del ID 24 s√≥lo pueden inte‚Äê
grarse en el bloque de par√°metros de sistema
del tipo 0 / ID 0.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7425

Instrucciones
4.2 Instrucciones
ID de
subbloque 1)

Tipo de subbloque

Longitud de subbloque
(en bytes)

Significado del par√°metro

30

SUB_DEVICE_NAME

Longitud del nombre + 4 Nombre de dispositivo seg√∫n la convenci√≥n
PROFINET IO
El nombre del dispositivo debe cumplir las
convenciones DNS, es decir,
‚óè estar limitado a 127 caracteres en total
(letras, cifras, guiones o puntos)
‚óè Cada componente del nombre del
dispositivo, es decir, una cadena de
caracteres entre dos puntos, no puede
tener una longitud superior a 63
caracteres.
‚óè No se admiten caracteres especiales,
como di√©resis, par√©ntesis, guiones bajos,
barras oblicuas, espacios en blanco, etc.
El gui√≥n es el √∫nico car√°cter especial
permitido.
‚óè El nombre del dispositivo no puede
comenzar ni terminar con los caracteres
"-" o ".".
‚óè El nombre del dispositivo no puede
comenzar con una cifra.
‚óè El nombre de dispositivo no puede tener
el formato n.n.n.n (n = 0...999).
‚óè El nombre de dispositivo no puede
comenzar con la secuencia de caracteres
"port-xyz-" (x,y,z = 0...9).

1) Nota: Actualmente no se utilizan n√∫meros de ID no indicados.

Bloques de par√°metros para tipos de enlaces
Informaci√≥n general
A continuaci√≥n se indica qu√© valores deben introducirse en los bloques de par√°metros y qu√©
subbloques deben utilizarse para los correspondientes tipos de enlace.
Dependiendo de cada caso, no son necesarios todos los tipos de subbloque (v√©ase la tabla
para m√°s informaci√≥n).

ID de enlace
El par√°metro ID que precede a cada bloque de par√°metros de enlace junto al identificador de
tipo es de especial relevancia.
En los enlaces programados, este ID puede asignarse libremente dentro del rango de valores
admisible. A continuaci√≥n se debe utilizar ese ID en la interfaz de llamada de las FCs para la
interfaz SEND/RECV para identificar el enlace.

7426

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Rangos de valores para el ID de enlace:
‚óè S7-400: 1,2...64
‚óè S7-300: 1,2...16

Consulte tambi√©n
Tipos de subbloque (P√°gina 7423)

Bloque de par√°metros para enlaces TCP
Estructura
Guarde los par√°metros en el bloque de par√°metros para enlaces TCP del siguiente modo:
‚óè Tipo = 1 -> ‚ë†

‚óè ID = ID de enlace -> ‚ë°
‚óè N√∫mero_subbloques = n
‚óè Subbloque 1
‚óè Subbloque 2
‚óè Subbloque n
...

Leyenda:

‚ë† Identificador del tipo de enlace
‚ë° Referencia de enlace de libre elecci√≥n; debe indicarse en AG_SEND / AG_RECV.
Rango de valores para el ID de enlace:
para S7-400: 1, 2...64
para S7-300: 1,2...16

Subbloques utilizables
Subbloque

Par√°metro

ID

Tipo

Particularidades/indicaciones

Aplicaci√≥n ***)

1

SUB_IP_V4

Direcci√≥n IP del interlocutor

++ *)

9

SUB_LOC_PORT

-

++

10

SUB_REM_PORT

-

++ **)

18

SUB_CONNECT_NAME

-

+

19

SUB_LOC_MODE

-

+

21

SUB_KBUS_ADR

En CPs para S7-300, este valor tiene
asignado el valor predeterminado fijo 2,
por lo que no es necesario indicarlo.

++ (para S7-400)

22

SUB_CON_ESTABL

-

++

*) Opcional para enlace pasivo.
***) ++ = obligatorio; + = opcional

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7427

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Tipos de subbloque (P√°gina 7423)

Bloque de par√°metros para enlaces UDP
Estructura
Guarde los par√°metros en el bloque de par√°metros para enlaces UDP del siguiente modo:
‚óè Tipo = 2 -> ‚ë†

‚óè ID = ID de enlace -> ‚ë°
‚óè N√∫mero_subbloques = n
‚óè Subbloque 1
‚óè Subbloque 2
‚óè Subbloque n
...

Leyenda:

‚ë† Identificador del tipo de enlace
‚ë° Referencia de enlace de libre elecci√≥n; debe indicarse en AG_SEND / AG_RECV.
Rango de valores para el ID de enlace:
para S7-400: 1, 2...64
para S7-300: 1,2...16

Subbloques utilizables
Subbloque

Par√°metro

ID

Tipo

Particularidades/indicaciones

Aplicaci√≥n ***)

1

SUB_IP_V4

Direcci√≥n IP del interlocutor

++

9

SUB_LOC_PORT

-

++

10

SUB_REM_PORT

-

++

18

SUB_CONNECT_NAME

-

+

19

SUB_LOC_MODE

-

+

21

SUB_KBUS_ADR

En CPs para S7-300, este valor tie‚Äê ++ (para S7-400)
ne asignado el valor predetermina‚Äê
do fijo 2, por lo que no es necesario
indicarlo.

23

SUB_ADDR_IN_DATABLOCK

Si se selecciona la opci√≥n "Enlace +
UDP libre" a trav√©s de este par√°‚Äê
metro, se prescinde de los par√°me‚Äê
tros SUB_IP_V4 y
SUB_REM_PORT.

***) ++ = obligatorio; + = opcional

7428

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Tipos de subbloque (P√°gina 7423)

Bloque de par√°metros para enlaces ISO-on-TCP
Estructura
Guarde los par√°metros en el bloque de par√°metros para enlaces ISO-on-TCP del siguiente
modo:
‚óè Tipo = 3 -> ‚ë†

‚óè ID = ID de enlace -> ‚ë°

‚óè N√∫mero_subbloques = n
‚óè Subbloque 1
‚óè Subbloque 2
‚óè Subbloque n
...
Leyenda:

‚ë† Identificador del tipo de enlace
‚ë° Referencia de enlace de libre elecci√≥n; debe indicarse en AG_SEND / AG_RECV.
Rango de valores para el ID de enlace:
para S7-400: 1, 2...64
para S7-300: 1,2...16

Subbloques utilizables
Subbloque

Par√°metro

ID

Tipo

Particularidades/indicaciones

Aplicaci√≥n ***)

1

SUB_IP_V4

Direcci√≥n IP del interlocutor

++ *)

11

SUB_LOC_TSAP

-

++

12

SUB_REM_TSAP

-

++ *)

18

SUB_CONNECT_NAME

-

+

19

SUB_LOC_MODE

-

+

21

SUB_KBUS_ADR

En CPs para S7-300, este valor tiene ++ (para S7-400)
asignado el valor predeterminado fijo
2, por lo que no es necesario indicarlo.

22

SUB_CON_ESTABL

-

++

*) Opcional para enlace pasivo.
***) ++ = obligatorio; + = opcional

Consulte tambi√©n
Tipos de subbloque (P√°gina 7423)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7429

Instrucciones
4.2 Instrucciones

Bloque de par√°metros para enlaces de correo electr√≥nico
Significado
Para enviar mensajes de correo electr√≥nico debe configurarse b√°sicamente un enlace de
correo electr√≥nico por cada CP Advanced. Con el enlace de correo electr√≥nico se define el
servidor de correo a trav√©s del cual se pondr√°n a disposici√≥n todos los mensajes de correo
electr√≥nico enviados por el CP Advanced.

Estructura
Guarde los par√°metros en el bloque de par√°metros para enlaces de correo electr√≥nico del
siguiente modo:
‚óè Tipo = 4 -> ‚ë†

‚óè ID = ID de enlace -> ‚ë°
‚óè N√∫mero_subbloques = n
‚óè Subbloque 1
‚óè Subbloque 2
‚óè Subbloque n
...

Leyenda:

‚ë† Identificador del tipo de enlace
‚ë° Referencia de enlace de libre elecci√≥n; debe indicarse en AG_SEND / AG_RECV.
Rango de valores para el ID de enlace:
para S7-400: 1, 2...64
para S7-300: 1,2...16

Subbloques utilizables
Subbloque
ID
1

Tipo
SUB_IP_V4

Par√°metro
Particularidades/indicaciones

Aplicaci√≥n ***)

Direcci√≥n IP del servidor de correo elec‚Äê ++ / + *)
tr√≥nico a trav√©s del cual se env√≠an los
mensajes.
La direcci√≥n IP puede indicarse en for‚Äê
mato absoluto o simb√≥lico.
El formato simb√≥lico presupone que el
CP Advanced conoce la direcci√≥n del
Domain Name Server (DNS). La entrada
correspondiente debe realizarse en la
configuraci√≥n del CP Advanced en HW
Config (all√≠ encontrar√° informaci√≥n adi‚Äê
cional en la Ayuda en pantalla).

7430

3

SUB_DNS_NAME

Nombre DNS del servidor de correo elec‚Äê ++ / + *)
tr√≥nico

13

SUB_EMAIL_SENDER

Direcci√≥n remitente del mensaje de co‚Äê
rreo electr√≥nico

++

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Subbloque
ID

Par√°metro

Tipo

Particularidades/indicaciones

Aplicaci√≥n ***)

18

SUB_CONNECT_NAME

-

+

21

SUB_KBUS_ADR

En CPs para S7-300, este valor tiene
asignado el valor predeterminado fijo 0,
por lo que no es necesario indicarlo.

++ (para S7-400)

22

SUB_CON_ESTABL

-

++

*) En este caso, los par√°metros SUB_IP_V4 y SUB_DNS_NAME se excluyen mutuamente; s√≥lo puede
indicarse uno de los par√°metros.
***) ++ = obligatorio; + = opcional

Nota
Los Mail-Server-Ports son "well known ports" y no es necesario indicarlos.

Consulte tambi√©n
Tipos de subbloque (P√°gina 7423)

Bloque de par√°metros para enlaces FTP
Significado
Para el desarrollo de una secuencia de petici√≥n FTP entre el equipo S7 como cliente FTP y un
servidor FTP es necesario que el CP Advanced establezca un enlace con la CPU S7. Aqu√≠,
dicho enlace se denomina "enlace FTP".
Los enlaces FTP son enlaces TCP que se ajustan al modo "FTP" con el par√°metro
SUB_LOC_MODE.

Estructura
Guarde los par√°metros en el bloque de par√°metros para enlaces FTP del siguiente modo:
‚óè Tipo = 1 -> ‚ë†

‚óè ID = ID de enlace -> ‚ë°

‚óè N√∫mero_subbloques = n
‚óè Subbloque 1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7431

Instrucciones
4.2 Instrucciones
‚óè Subbloque 2
‚óè Subbloque n
...
Leyenda:

‚ë† Identificador del tipo de enlace
‚ë° Referencia de enlace de libre elecci√≥n; debe indicarse en AG_SEND / AG_RECV.
Rango de valores para el ID de enlace:
para S7-400: 1, 2...64
para S7-300: 1,2...16

Subbloques utilizables
Subbloque

Par√°metro

ID

Tipo

Particularidades/indicaciones

Aplicaci√≥n ***)

18

SUB_CONNECT_NAME

-

+

19

SUB_LOC_MODE

Aqu√≠: 0x01 = protocolo FTP

++

21

SUB_KBUS_ADR

En CPs para S7-300, este valor tiene
asignado el valor predeterminado fijo 0,
por lo que no es necesario indicarlo.

++ (para S7-400)

***) ++ = obligatorio; + = opcional

Consulte tambi√©n
Tipos de subbloque (P√°gina 7423)

Instrucciones para servicios FTP
FTP_CMD para servicios FTP
Migraci√≥n de FC 40-44 a FB 40
Comparaci√≥n del bloque de programa FTP_CMD con las anteriores funciones FC40...44
Todos los CPs con funcionalidad FTP son compatibles con las funciones FC40...44. Por lo
tanto, los programas de usuario disponibles se pueden seguir utilizando sin modificaci√≥n.
Si desea cambiar de las funciones FTP FC40...44 a FTP_CMD, tendr√° que modificar su
programa de usuario.
La tabla siguiente muestra con qu√© comandos del FTP_CMD puede implementar las funciones
FC40...44.
‚óè Las coincidencias est√°n marcadas con "X".
‚óè La falta de correspondencias est√° marcada con "-".

7432

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Comandos del par√°metro "CMD" del FTP_CMD
Antiguas fun‚Äê
ciones FTP
FC40...44

CMD = 1

FC40

X 1)

FC41

CMD = 2

CMD = 3

CMD = 4

CMD = 5

CMD = 6
CMD = 7
CMD = 17

X 2)

FC42

X 3)

FC43

X 4)

FC44

X
-

... Los par√°metros de FC 40...43 y CMD 1...4 (FTP_CMD) no son id√©nticos.
(v√©ase la tabla siguiente)
1)

4)

Los par√°metros correspondientes que especifican la respectiva funci√≥n en las funciones
FC40...FC43 o en los comandos del FTP_CMD se listan en la tabla siguiente.
Par√°metros de FC

Par√°metros del FTP_CMD (con CMD 1...4)

FC40:

LOGIN

‚Üí

CMD = 1:

NAME_STR

FC41:

FILE_NAME

‚Üí

CMD = 2:

NAME_STR

FC42:

FILE_NAME

‚Üí

CMD = 3:

NAME_STR

FC43:

FILE_NAME

‚Üí

CMD = 4:

NAME_STR

BUFFER_DB_NR

‚Üí

suprimido (sustituido por DB de instancia)

FC40...43:

Consulte tambi√©n
Panor√°mica de FTP_CMD (P√°gina 7433)

Panor√°mica de FTP_CMD
Significado
Con la instrucci√≥n FTP_CMD se pueden establecer conexiones FTP y transmitir archivos
desde y a un servidor FTP.
La instrucci√≥n FTP_CMD aporta las siguientes ventajas:
‚óè Simplificaci√≥n en el programa de usuario por desarrollo a trav√©s de variables de comandos
en lugar de diferentes llamadas de funciones.
‚óè Funci√≥n adicional "APPEND"
"APPEND" permite a√±adir datos a un archivo ya existente.
‚óè Funci√≥n adicional "RETR_PART"
"RETR_PART" permite leer selectivamente √°reas de datos de un archivo.
‚óè Funci√≥n adicional "CONNECT_TLS_PRIVATE"
"CONNECT_TLS_PRIVATE" permite establecer conexiones SSL seguras
‚óè La funci√≥n AG_SEND (FC5) no se necesita para la ejecuci√≥n.
Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7433

Instrucciones
4.2 Instrucciones

Validez
El FB40 se puede utilizar a partir de los siguientes tipos de m√≥dulos:
‚óè A partir de CP 343-1 Advanced (GX30* / GX31)
‚óè A partir de CP 443-1 Advanced (GX20* / GX30)
*) Funci√≥n "CONNECT-TLS-PRIVATE" no utilizable.

Interfaz de llamada
Interfaz de llamada en representaci√≥n FUP
)73B&0'
,17

,'

:25'

'21(

%22/

/$''5

(5525

%22/

%<7(

&0'

67$786

:25'

$1<

1$0(B675

,17

),/(B'%B15

':25'

2))6(7

':25'

/(1

Funciones del sistema llamadas
El bloque de programa FTP_CMD llama las siguientes funciones de sistema:
SFC 1, SFC 20, SFC 24, SFC 58, SFC 59
Nota
Tenga en cuenta que los servicios de cliente FTP de CPUs SIMATIC S7-300 menos recientes,
por ejemplo CPU 312 o CPU 315-1AF01, no se pueden ejecutar, ya que no soportan la funci√≥n
especial SFC 24.

Consulte tambi√©n
Estructura y aplicaci√≥n del DB File (P√°gina 7443)
Par√°metros de salida e informaciones de estado FTP_CMD (P√°gina 7439)
Par√°metros de entrada FTP_CMD (P√°gina 7435)
Migraci√≥n de FC 40-44 a FB 40 (P√°gina 7432)

7434

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros de entrada FTP_CMD
Explicaci√≥n de los par√°metros de entrada
Cada llamada de bloque FTP se tiene que dotar de los siguientes par√°metros de entrada:
Tabla 4-441 Par√°metros formales del FB40 (FTP_CMD) - par√°metros de entrada
Par√°metro
ID

Declaraci√≥n
INPUT

Tipo
INT

Rango de valo‚Äê
res
Para S7-300:
1, 2...16
Para S7-400:
1, 2...64

LADDR

INPUT

WORD

Significado / Observaci√≥n
Las peticiones de FTP se desarrollan a trav√©s de
conexiones FTP. El par√°metro identifica la cone‚Äê
xi√≥n utilizada.
Direcci√≥n inicial del m√≥dulo
Al llamar un bloque FC transfiere en el par√°metro
LADDR la direcci√≥n del inicio de m√≥dulo del AD‚Äê
VANCED CP.
La direcci√≥n inicial de m√≥dulo del ADVANCED-CP
se puede consultar en la configuraci√≥n del ADVAN‚Äê
CED-CP bajo "Propiedades>Direcciones>Entra‚Äê
das".

CMD

INPUT

BYTE

Consulte la ta‚Äê
bla inferior
Comandos FTP
en el par√°metro
"CMD"

Comandos FTP que se ejecutan con la llamada del
FTP_CMD. Encontrar√° m√°s informaci√≥n a conti‚Äê
nuaci√≥n de la tabla.
Si un comando no es compatible con el firmware
del CP, se emite un mensaje de error con STATUS
= 8F6BH.
Ejemplos de comandos FTP:
‚óè RETRIEVE: B#16#3
‚óè CONNECT_TLS_PRIVATE: B#16#11

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7435

Instrucciones
4.2 Instrucciones
Par√°metro
NAME_STR

Declaraci√≥n
INPUT

Tipo
ANY

Rango de valo‚Äê
res

Significado / Observaci√≥n

La direcci√≥n indicada hace referencia a un √°rea del
como VARTY‚Äê
PE solo se admi‚Äê bloque de datos. Aqu√≠ se tiene que indicar la direc‚Äê
te "BYTE".
ci√≥n y la longitud del √°rea de datos en la que est√°n
registrados las informaciones de destino.
‚óè Con CMD = 1, 17:
En este comando, el par√°metro "NAME_STR"
especifica el servidor FTP al que se debe
acceder con la conexi√≥n FTP con los siguientes
atributos:
- direcci√≥n IP del servidor FTP
- nombre del usuario
- contrase√±a para el inicio de sesi√≥n
Estos valores se tienen que indicar como tres
strings consecutivos en el √°rea de destino del
puntero ANY.
‚óè Con CMD = 2, 3, 4, 6, 7:
En este comando, el par√°metro "NAME_STR"
especifica el nombre del archivo en el servidor
FTP, es decir, la fuente de los datos o el destino
de los datos. El nombre del archivo se tiene que
indicar como string en el √°rea de destino del
puntero ANY.
‚óè Con CMD = 5: par√°metro no relevante
Encontrar√° ejemplos de contenidos m√°s adelante.

FILE_DB_NR

INPUT

INT

El bloque de datos aqu√≠ indicado contiene el FileDB que se debe leer / escribir.
El par√°metro solo es relevante con CMD = 2, 3, 6 y
7.

7436

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro
OFFSET

Declaraci√≥n
INPUT

Tipo
DWORD

Rango de valo‚Äê
res

Significado / Observaci√≥n
Solo con CMD = 7:
Offset en bytes, a partir del cual se debe leer el
archivo.

LEN

INPUT

DWORD

Solo con CMD = 7:
Longitud parcial en bytes que se debe leer a partir
del valor indicado en "OFFSET".
Peculiaridades:
‚óè Si se indica "DW#16#FFFFFFFF" se lee el
resto disponible del archivo.
Resultado OK (DONE = 1, STATUS = 0), si no
se presenta ning√∫n otro error.
‚óè Si OFFSET > longitud del archivo original:
En este caso, la longitud del archivo de destino
se muestra del siguiente modo en el par√°metro
ACT_LENGTH del File-DB: 0 bytes en la CPU.
Resultado OK (DONE = 1, STATUS = 0), si no
se presenta ning√∫n otro error.
‚óè Si OFFSET + LEN > longitud del archivo
original (y LEN ‚â† 0xFFFFFFFF):
En este caso, la longitud del archivo de destino
se muestra del siguiente modo en el par√°metro
ACT_LENGTH del File-DB: Bytes disponibles a
partir de "OFFSET".
Resultado OK (DONE = 1, STATUS = 0), si no
se presenta ning√∫n otro error.

Comandos FTP en el par√°metro "CMD"
Vea en la tabla siguiente qu√© significado tienen los comandos del par√°metro "CMD" y qu√©
par√°metros de entrada (Input) se tienen que abastecer en cada caso. Los par√°metros ID y
LADDR se tienen que activar siempre para identificar la conexi√≥n.
CMD

Par√°metro de entrada re‚Äê Significado / Manejo
levante (adem√°s de ID y
LADDR)

0 (NOOP)

-

1 (CONNECT)

NAME_STR

La instrucci√≥n llamada no ejecuta ninguna acci√≥n. Las indicaciones de
estado se ponen como sigue para este abastecimiento de par√°metros:
‚óè DONE=1; ERROR=0; STATUS=0
El cliente FTP establece con este comando una conexi√≥n FTP con un
servidor FTP (puerto 21).
La conexi√≥n est√° disponible, con la ID de conexi√≥n aqu√≠ asignada, para
todos los dem√°s comandos FTP. Los datos se intercambian entonces
con el servidor FTP indicado para este usuario.

2 (STORE)

NAME_STR
FILE_DB_NR

Con esta llamada de funci√≥n se transmite un bloque de datos (File-DB)
del cliente FTP (CPU S7) al servidor FTP.
Atenci√≥n: Si el archivo (File-DB) ya existe en el servidor FTP, se so‚Äê
brescribe.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7437

Instrucciones
4.2 Instrucciones
CMD

Par√°metro de entrada re‚Äê Significado / Manejo
levante (adem√°s de ID y
LADDR)

3 (RETRIEVE)

NAME_STR
FILE_DB_NR

Con esta llamada de funci√≥n se transmite un archivo del servidor FTP
al cliente FTP (CPU S7).
Atenci√≥n: Si el bloque de datos (File-DB) del cliente FTP ya contiene
un archivo, este se sobrescribe.

4 (DELETE)

NAME_STR

Con esta llamada de funci√≥n se borra un archivo en el servidor FTP.

5 (QUIT)

Ninguno m√°s

Con esta llamada de funci√≥n se deshace la conexi√≥n FTP identificada
con la ID.

6 (APPEND)

NAME_STR
FILE_DB_NR

De forma similar a "STORE", el comando "APPEND" (a√±adir) guarda
un archivo en el servidor FTP. Pero con "APPEND" no se sobrescribe
el archivo en el servidor FTP, sino que el nuevo contenido a guardar se
a√±ade al archivo.
Si el archivo no existe en el servidor FTP, se crea.

7 (RETR_PART)

NAME_STR
FILE_DB_NR
OFFSET
LEN

Con el comando "RETR_PART" (leer longitud parcial) se puede pedir
del servidor FTP una parte de un archivo.
En caso de archivos muy grandes se puede limitar as√≠ la lectura a la
parte necesaria.
Para esto se tiene que conocer la estructura del archivo.
Indique la parte deseada del archivo con ayuda de los dos par√°metros
"OFFSET" y "LEN" en el FB 40.

17 (CON‚Äê
NECT_TLS_PRIVATE)

NAME_STR

Con el comando "CONNECT_TLS_PRIVATE", el cliente FTP estable‚Äê
ce una conexi√≥n FTP segura v√≠a SSL (FTPS) con el servidor FTP
(puerto 21). Los datos de la conexi√≥n de control y los de la conexi√≥n de
datos son seguros.
La conexi√≥n est√° disponible, con la ID de conexi√≥n aqu√≠ asignada, para
todos los dem√°s comandos FTP. Los datos se intercambian entonces
con el servidor FTP indicado para este usuario.
Requisitos:
‚óè La opci√≥n "Seguridad" debe estar activada en el CP.
‚óè Para la conexi√≥n FTP asegurada con SSL se deben suministrar los
certificados en la configuraci√≥n del CP.

Ejemplos de contenidos del par√°metro "NAME_STR"
El registro de par√°metros tiene los siguientes contenidos:
Tabla 4-442 Contenido del registro de par√°metros para CMD = 1, 17
Direcci√≥n rela‚Äê
tiva 2)

Nombre

Tipo 1)

Ejemplo

Significado

0.0

ip_address

STRING[100]

‚Äô142.11.25.135‚Äô

Direcci√≥n IP del servidor FTP

102.0

username

STRING[32]

‚Äôusuario‚Äô

Nombre del usuario para iniciar se‚Äê
si√≥n en el servidor FTP

136.0

password

STRING[32]

‚Äôcontrase√±a‚Äô

Contrase√±a para iniciar sesi√≥n en el
servidor FTP

1) Se indica la longitud m√°xima posible del string en cada caso
2) Los valores indicados se refieren a las longitudes de string indicadas en "Tipo".

7438

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tabla 4-443 Contenido del registro de par√°metros para CMD = 2, 3, 4, 6, 7
Direcci√≥n rela‚Äê
tiva 2)
170.0

Nombre
filename

Tipo 1)

Ejemplo

STRING[ 220]
o
STRING[212]

‚Äôinstalaci√≥n1/caldera2/
presi√≥n.dat‚Äô

Significado
Nombre del fichero de destino o
fuente
Nota: con CMD=7 (RETR_PART) la
longitud m√°xima del nombre del ar‚Äê
chivo est√° limitada a 212 caracteres.

1) Se indica la longitud m√°xima posible del string en cada caso
2) Los valores indicados se refieren a las longitudes de string indicadas en "Tipo".

Consulte tambi√©n
Panor√°mica de FTP_CMD (P√°gina 7433)

Par√°metros de salida e informaciones de estado FTP_CMD
Introducci√≥n
Para la evaluaci√≥n del estado se tienen que evaluar estos par√°metros en el programa de
usuario:
Tabla 4-444 Par√°metros formales del FB40 (FTP_CMD) - par√°metros de salida
Par√°metro

Declaraci√≥n

Tipo

Rango de valores

Significado / Observaci√≥n

DONE

OUTPUT

BOOL

0: 1: petici√≥n ejecutada

El par√°metro de estado indica si la
petici√≥n se ha desarrollado correc‚Äê
tamente.

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicador de error

V√©ase la tabla siguiente

Indicador de estado

STATUS

OUTPUT

WORD

El par√°metro notifica que la peti‚Äê
ci√≥n no se ha podido ejecutar sin
errores.
El par√°metro proporciona informa‚Äê
ciones detalladas sobre la ejecu‚Äê
ci√≥n de la petici√≥n.

Los par√°metros DONE, ERROR y STATUS se actualizan a cada llamada del bloque.

Ejemplo
Durante una ejecuci√≥n de petici√≥n, el FTP_CMD proporciona los c√≥digos de condici√≥n:
‚óè DONE=0
‚óè ERROR=0
‚óè STATUS=8181H
Significado: La petici√≥n a√∫n est√° en curso.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7439

Instrucciones
4.2 Instrucciones

Evaluar indicaciones de estados
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho en
el manual de referencia STEP 7 Standard y funciones del sistema. All√≠ encontrar√°
informaciones en el cap√≠tulo "Evaluaci√≥n de fallos con el par√°metro de salida RET_VAL".

Tabla 4-445 FB 40: Significado del par√°metro STATUS en relaci√≥n con DONE y ERROR
DONE

ERROR

STATUS

Significado

0

0

0000H

Ninguna petici√≥n en proceso.

1

0

0000H

Petici√≥n terminada sin errores.

0

0

8181H

Petici√≥n en curso.
En caso de indicaci√≥n continua de 8181H:
el CP no est√° habilitado para el FTP_CMD (se ha llamado un comando
CMD 6, CMD 7 o CMD 17 no permitido para la versi√≥n de firmware.)

0

1

8090H

‚óè No existe un m√≥dulo con esta direcci√≥n inicial de m√≥dulo.
‚óè El bloque utilizado no es acorde con la familia de sistemas utilizada
(se tienen que utilizar FCs diferentes para S7-300 y S7-400).

0

1

8091H

La direcci√≥n inicial del m√≥dulo no est√° en formato de palabra doble.

0

1

8092H

El tipo indicado en el puntero ANY no es Byte

0

1

80A4H

La conexi√≥n de bus K entre CPU y CP no est√° establecida (en caso de
versiones de CPU m√°s recientes).
Esto se puede deber, por ejemplo, a lo siguiente:
‚óè falta configuraci√≥n de conexiones
‚óè se supera la cantidad m√°xima de CPs que pueden trabajar en
paralelo

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

√Årea de destino no v√°lida;
por ejemplo, √°rea de destino > 240 bytes.

0

1

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida (en caso de
versiones de CPU menos recientes).
(en caso de versiones de CPU m√°s recientes, v√©ase 80A4H)

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Medio de servicio (memoria) ocupado.

0

1

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conve‚Äê
niente una repetici√≥n en el programa de usuario.)

0

1

80D2H

Direcci√≥n inicial del m√≥dulo err√≥nea.

0

1

8183H

La configuraci√≥n no es acorde con los par√°metros de la petici√≥n.

0

1

8184H

Se ha indicado un tipo de datos no permitido para el par√°metro NA‚Äê
ME_STR.

0

1

8186H

Par√°metro ID no v√°lido. ID = 1, 2....64

0

1

8302H

7440

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE
0

ERROR
1

STATUS
8F22H

Significado
√Årea fuente no valida, por ejemplo:
√Årea no existente en DB

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado
corto).

0

1

8F24H

Error de √°rea al leer un par√°metro

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

Error de n√∫mero de DB

0

1

8F3AH

√Årea de destino no cargada (DB)

0

1

8F50H

File-DB DB 0 o DB no existe

0

1

8F51H

El √°rea de datos de File-DB se ha indicado mayor que la existente

0

1

8F52H

File-DB en memoria protegida de grabaci√≥n

0

1

8F53H

File-DB con longitud m√°x. < longitud actual

0

1

8F54H

File-DB no contiene datos v√°lidos.

0

1

8F55H

Bit de estado del encabezado: Locked

0

1

8F56H

El bit NEW en el encabezado del File-DB no se ha desactivado

0

1

8F57H

El cliente FTP no tiene derecho de escritura en el File-DB, sino el servi‚Äê
dor FTP (bit de estado del encabezado: WriteAccess).

0

1

8F60H

Datos de usuario no v√°lidos, por ejemplo, direcci√≥n IP del servidor FTP
no v√°lida

0

1

8F61H

Servidor FTP no accesible

0

1

8F62H

Significados posibles:
‚óè El servidor FTP no da soporte a la petici√≥n o la rechaza
‚óè El servidor FTP no soporta conexiones seguras v√≠a SSL.

0

1

8F63H

Transferencia de datos cancelada por el servidor FTP

0

1

8F64H

Error en la conexi√≥n de control FTP; no se han podido transmitir o recibir
datos; la conexi√≥n de control FTP se tiene que establecer de nuevo
despu√©s de tal error.

0

1

8F65H

Error en la conexi√≥n de datos FTP; no se han podido transmitir o recibir
datos. La petici√≥n se tiene que llamar de nuevo.
El error se puede deber, por ejemplo en la funci√≥n RETRIEVE (CMD=3),
a que el archivo a que se quiere acceder en el servidor FTP ya est√°
abierto.

0

1

8F66H

Error al leer/escribir datos de/en la CPU (por ejemplo, DB inexistente o
demasiado peque√±o)

0

1

8F67H

Error en el cliente FTP del CP; por ejemplo, al intentar abrir m√°s cone‚Äê
xiones FTP del n√∫mero m√°ximo posible.

0

1

8F68H

La petici√≥n ha sido rechazada por el cliente FTP.
El error se puede deber, por ejemplo en la funci√≥n RETRIEVE (CMD=3),
a que el valor del par√°metro MAX_LENGTH se ha elegido demasiado
peque√±o en el encabezado del File-DB.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7441

Instrucciones
4.2 Instrucciones
DONE
0

ERROR
1

STATUS
8F69H

Significado
La conexi√≥n FTP se encuentra en un estado incorrecto, p. ej.:
‚óè Se produce una llamada de la conexi√≥n sin deshacerla previamente
(con igual ID de conexi√≥n);
‚óè Se deshace una conexi√≥n ya deshecha;
‚óè Se ha enviado un comando STORE para una conexi√≥n no
establecida.

0

1

8F6AH

La conexi√≥n no se ha podido establecer debido a un d√©ficit transitorio de
recursos.

0

1

8F6BH

Posibles causas:

Soluci√≥n: repetir la llamada del bloque.
‚óè Valor err√≥neo para el par√°metro CMD
‚óè No se soporta un comando del FTP_CMD.
Posible causa: Firmware incorrecto del CP
Soluci√≥n: actualizar el firmware
0

1

8F6CH

En el par√°metro OFFSET se ha indicado un valor > 7FFF FFFH.

0

1

8F6DH

El cliente FTP no soporta conexiones seguras v√≠a SSL.

0

1

8F6FH

Posibles causas:
‚óè La indicaci√≥n de tiempo "notBefore" del certificado contiene un valor
no v√°lido.
‚óè El certificado no es v√°lido: la entrada "notBefore" contiene una
indicaci√≥n de tiempo posterior al tiempo actual.

0

1

8F70H

Posibles causas:
‚óè La indicaci√≥n de tiempo "notAfter" del certificado contiene un valor no
v√°lido.
‚óè El certificado ha caducado: la entrada "notAfter" contiene una
indicaci√≥n de tiempo anterior al tiempo actual.

0

1

8F71H

No se ha encontrado el certificado del emisor de un certificado no fiable.

0

1

8F72H

El certificado CA original no es v√°lido. Es posible que no se trate de un
certificado CA o que sus ampliaciones no sean coherentes con la finali‚Äê
dad prevista.

0

1

8F73H

El certificado CA original est√° marcado como no fiable para la finalidad
indicada.

0

1

8F74H

Se han producido otros errores al verificar un certificado.

0

1

8F7FH

Error interno p. ej., referencia ANY no permitida.

Consulte tambi√©n
Panor√°mica de FTP_CMD (P√°gina 7433)

7442

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Estructura y aplicaci√≥n del DB File
Estructura de los bloques de datos (File-DB) para servicios FTP - modo FTP-Server
Funcionamiento
Para la transmisi√≥n de datos mediante FTP tiene que crear bloques (File-DBs) en la CPU de
su estaci√≥n S7. Estos bloques de datos han de tener una determinada estructura para que los
servicios FTP puedan tratarlos como datos transmisibles. Constan de los siguientes sectores
‚óè Sector 1: File-DB Header (tiene una longitud fija de 20 byte y una estructura fija)
‚óè Sector 2: datos √∫tiles (longitud y estructura variables)

File-DB Header para modo FTP-Server
Observaci√≥n: El File-DB Header aqu√≠ descrito es pr√°cticamente id√©ntico al File-DB Header
descrito para el modo Client. Las diferencias residen en los par√°metros
‚óè WRITE_ACCESS
‚óè FTP_REPLY_CODE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7443

Instrucciones
4.2 Instrucciones

Par√°metro
EXIST

Tipo

Valor / Significado

BOOL

El bit EXIST indica si hay
datos v√°lidos en el √°rea de
datos √∫tiles.

Alimentaci√≥n
El comando FTP dele pone EXIST=0;
El comando FTP store pone EXIST=1;

El comando FTP retrieve
s√≥lo procesa la petici√≥n si
EXIST=1.
‚óè 0:
El File-DB no contiene
datos √∫tiles v√°lidos
("Archivo no existe").
‚óè 1:
El File-DB contiene
datos √∫tiles v√°lidos
("Archivo existe").
LOCKED

BOOL

El bit LOCKED sirve para la
protecci√≥n de acceso al Fi‚Äê
le-DB.
‚óè 0:
Se puede acceder al
File-DB.
‚óè 1:
El File-DB est√°
bloqueado.

Los comandos FTP store y retr ponen LO‚Äê
CKED=1 durante la edici√≥n.
Para una operaci√≥n de escritura desde el
programa de usuario rige:
El programa de usuario almacenado en la
CPU S7 puede poner o reponer LOCKED
para asegurar la coherencia durante un ac‚Äê
ceso de escritura.
Procedimientom recomendado para el pro‚Äê
grama de usuario:
1. Comprobar el bit LOCKED;
si =0
2. poner WRITEACCESS-Bit=0
3. Comprobar el bit LOCKED;
si =0
4. poner LOCKED-Bit=1
5. Escribir datos
6. poner LOCKED-Bit=0

7444

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro
NEW

Tipo

Valor / Significado

Alimentaci√≥n

BOOL

El bit NEW-Bit informa so‚Äê
bre si los datos se han mo‚Äê
dificado desde la √∫ltima
operaci√≥n de lectura.

El comando FTP store pone NEW=1 tras la
edici√≥n

‚óè 0:
El contenido del File-DB
no ha cambiado desde
la √∫ltima operaci√≥n de
escritura. El programa
de usuario de la CPU S7
ha registrado el √∫ltimo
cambio.

El programa de usuario de la CPU S7 tiene
que poner NEW=0 tras la lectura de los da‚Äê
tos, para hacer posible un nuevo store o para
poder borrar el archivo con el comando FTP
dele.

‚óè 1:
El programa de usuario
de la CPU S7 no ha
registrado la √∫ltima
operaci√≥n de escritura.
WRITE_ACCESS

BOOL

0:
El FTP-Client del PG/PC no
tiene derecho de escritura
para los File-DBs de la CPU
S7.
1:
El FTP-Client del PG/PC tie‚Äê
ne derecho de escritura pa‚Äê
ra los File-DBs de la CPU
S7.

El bit se pone a un valor de inicializaci√≥n al
configurar el DB.
Recomendaci√≥n:
A ser posible, el bit deber√≠a dejarse inaltera‚Äê
do. En caso especiales es posible una adap‚Äê
taci√≥n durante el funcionamiento.

ACT_LENGTH

DINT

Longitud actual del √°rea de La longitud actual se actualiza despu√©s de
una operaci√≥n de escritura.
datos √∫tiles.
El contenido de este campo
s√≥lo es v√°lido si EXIST = 1.

MAX_LENGTH

DINT

Longitud m√°xima del √°rea
de datos √∫tiles (longitud to‚Äê
tal del DB menos 20 bytes
del Header).

FTP_REPLY_CODE

DATE_TIME

INT

DATE_AND_TIME

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

La longitud m√°xima se deber√≠a definir al con‚Äê
figurar el DB.
El valor puede ser modificado por el progra‚Äê
ma de usuario tambi√©n durante el funciona‚Äê
miento.

Este par√°metro no tiene re‚Äê El FTP-Server lo pone a "0".
levancia en el modo FTPServer.
Fecha y hora de la √∫ltima
modificaci√≥n del archivo.
El contenido de este campo
s√≥lo es v√°lido si EXIST = 1.

La fecha actual se actualiza despu√©s de una
operaci√≥n de escritura.
Si se utiliza la funci√≥n "Transmisi√≥n de la ho‚Äê
ra", la entrada se corresponde con la hora
transmitida.
Si no se utiliza la funci√≥n "Transmisi√≥n de la
hora", se introduce una hora relativa. La re‚Äê
ferencia es el momento de arranque del CP
IT (el valor de inicializaci√≥n es 1.1.1994 0.0
horas).

7445

Instrucciones
4.2 Instrucciones

Estructura de los bloques de datos (File-DB) para servicios FTP - modo FTP-Client
Funcionamiento
Para la transmisi√≥n de datos mediante FTP tiene que crear bloques (File-DBs) en la CPU de
su estaci√≥n S7. Estos bloques de datos han de tener una determinada estructura para que los
servicios FTP puedan tratarlos como datos transmisibles. Constan de los siguientes sectores:
‚óè Sector 1: File-DB Header (tiene una estructura fija con una longitud de 20 byte)
‚óè Sector 2: datos √∫tiles (longitud y estructura variables)

File-DB Header para modo FTP-Client
Observaci√≥n: El File-DB Header aqu√≠ descrito es pr√°cticamente id√©ntico al File-DB Header
descrito para el modo Server. Las diferencias residen en los par√°metros:
‚óè WRITE_ACCESS
‚óè FTP_REPLY_CODE

7446

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
EXIST

Tipo
BOOL

Valor / Significado

Alimentaci√≥n

El bit EXIST indica si hay datos v√°‚Äê El comando FTP dele pone EXIST=0;
lidos en el √°rea de datos √∫tiles.
El comando FTP store pone EXIST=1;
El comando FTP retrieve s√≥lo pro‚Äê
cesa la petici√≥n si EXIST=1.
‚óè 0:
El File-DB no contiene datos
√∫tiles v√°lidos ("Archivo no
existe").
‚óè 1:
El File-DB contiene datos √∫tiles
v√°lidos ("Archivo existe").

LOCKED

BOOL

El bit LOCKED sirve para la pro‚Äê
tecci√≥n de acceso al File-DB.

Los comandos FTP store y retr ponen
LOCKED=1 durante la edici√≥n.

‚óè 0:
Se puede acceder al File-DB.

Para una operaci√≥n de escritura desde
el programa de usuario rige:

‚óè 1:
El File-DB est√° bloqueado.

El programa de usuario almacenado en
la CPU S7 puede poner o reponer LO‚Äê
CKED para asegurar la coherencia du‚Äê
rante un acceso de escritura.
Procedimientom recomendado para el
programa de usuario:
1. Comprobar el bit LOCKED;
si =0
2. poner WRITEACCESS-Bit=0
3. Comprobar el bit LOCKED;
si =0
4. poner LOCKED-Bit=1
5. Escribir datos
6. poner LOCKED-Bit=0

NEW

BOOL

El bit NEW-Bit informa sobre si los
datos se han modificado desde la
√∫ltima operaci√≥n de lectura.
‚óè 0:
El contenido del File-DB no ha
cambiado desde la √∫ltima
operaci√≥n de escritura. El
programa de usuario de la
CPU S7 ha registrado el √∫ltimo
cambio.

El comando FTP store pone NEW=1
tras la edici√≥n
El programa de usuario de la CPU S7
debe activar NEW=0 tras la lectura de
los datos para permitir un nuevo coman‚Äê
do retr.

‚óè 1:
El programa de usuario de la
CPU S7 no ha registrado la
√∫ltima operaci√≥n de escritura.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7447

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo

WRITE_ACCESS

BOOL

Valor / Significado

Alimentaci√≥n

0:
El programa de usuario (bloques
FTP-Client) tiene derecho de escri‚Äê
tura para los File-DBs de la CPU
S7.

El bit se pone a un valor de inicializaci√≥n
al configurar el DB.

1:
El programa de usuario (bloques
FTP-Client) no tiene derecho de
escritura para los File-DBs de la
CPU S7.

Recomendaci√≥n:
A ser posible, el bit deber√≠a dejarse inal‚Äê
terado. En caso especiales es posible
una adaptaci√≥n durante el funciona‚Äê
miento.

ACT_LENGTH

DINT

Longitud actual del √°rea de datos
√∫tiles.
El contenido de este campo s√≥lo
es v√°lido si EXIST = 1.

La longitud actual se actualiza despu√©s
de una operaci√≥n de escritura.

MAX_LENGTH

DINT

Longitud m√°xima del √°rea de datos La longitud m√°xima se deber√≠a definir al
√∫tiles (longitud total del DB menos configurar el DB.
20 bytes del Header).
El valor puede ser modificado por el pro‚Äê
grama de usuario tambi√©n durante el
funcionamiento.

FTP_REPLY_CODE

INT

Cifra sin signo (16 bit) que contiene Es actualizado por el FTP-Client al edi‚Äê
el √∫ltimo c√≥digo Reply de FTP co‚Äê tar comandos FTP.
mo valor binario.
El contenido de este campo s√≥lo
es v√°lido si EXIST = 1.

DATE_TIME

DATE_AND_TIME

Fecha y hora de la √∫ltima modifica‚Äê
ci√≥n del archivo.
El contenido de este campo s√≥lo
es v√°lido si EXIST = 1.

La fecha actual se actualiza despu√©s de
una operaci√≥n de escritura.
Si se utiliza la funci√≥n "Transmisi√≥n de
la hora", la entrada se corresponde con
la hora transmitida.
Si no se utiliza la funci√≥n "Transmisi√≥n
de la hora", se introduce una hora rela‚Äê
tiva. La referencia es el momento de
arranque del CP IT (el valor de iniciali‚Äê
zaci√≥n es 1.1.1994 0.0 horas).

Bloque de datos FILE_DB_HEADER como plantilla
Significado
Para la creaci√≥n de un encabezado del File-DB est√° predeterminado el tipo de datos
FILE_DB_HEADER.

7448

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Funcionamiento
Para la transmisi√≥n de datos mediante FTP hay que crear bloques de datos (File-DBs) en la
CPU de la estaci√≥n S7. Estos bloques de datos han de tener una determinada estructura para
que los servicios FTP puedan tratarlos como datos transmisibles. Constan de los siguientes
sectores:
‚óè Sector 1: encabezado del File-DB (tiene una estructura fija con una longitud de 20 byte)
‚óè Sector 2: datos de usuario (longitud y estructura variables)

Proceda del siguiente modo:
1. Cree un bloque de datos del tipo "DB global" en la CPU de PLC en la que se crea el
programa de usuario con las instrucciones FTP.
2. Seleccione la fila que va a utilizar como l√≠nea de inicio para el File-DB.
3. En la lista desplegable de la columna "Tipo de datos", seleccione un elemento de estructura
del tipo FILE_DB_HEADER.
Resultado: Se crea una estructura de datos con la estructura de encabezado necesaria para
el File-DB.
Nota
Funci√≥n "Agregar nuevo bloque" - Selecci√≥n de tipo
Al crear nuevos bloques de datos, en la entada "Tipo" de la lista desplegable tambi√©n se ofrece
el tipo de bloque "FILE_DB_HEADER". ¬°No utilice esta opci√≥n! El bloque de datos creado de
esa manera solo obtiene la estructura de encabezado y no puede ampliarse con el √°rea
necesaria para depositar datos de usuario.

Bloque de datos FILE_DB_HEADER - Ejemplo y plantilla para el encabezado del File-DB
En la vista de declaraci√≥n se reconoce la siguiente estructura:
Direcci√≥n

Nombre

0.0

Tipo

Valor inicial

Comentario

STRUCT

+0.0

bit08

BOOL

FALSE

reservado

+0.1

bit09

BOOL

FALSE

reservado

+0.2

bit10

BOOL

FALSE

reservado

+0.3

bit11

BOOL

FALSE

reservado

+0.4

bit12

BOOL

FALSE

reservado

+0.5

bit13

BOOL

FALSE

reservado

+0.6

bit14

BOOL

FALSE

reservado

+0.7

bit15

BOOL

FALSE

reservado

+1.0

EXIST

BOOL

FALSE

if TRUE: FileDB content is valid
data

+1.1

LOCKED

BOOL

FALSE

it TRUE: FileDB is locked cau‚Äê
sed by changes of the content

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7449

Instrucciones
4.2 Instrucciones
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+1.2

NEW

BOOL

FALSE

if TRUE: FileDB content is new
and may not be overwritten

+1.3

WRITE_ACCESS

BOOL

FALSE

if TRUE: Ftp-Server of the ITCP has write access, else FtpServer

+1.4

bit04

BOOL

FALSE

reservado

+1.5

bit05

BOOL

FALSE

reservado

+1.6

bit06

BOOL

FALSE

reservado

+1.7

bit07

BOOL

FALSE

reservado

+2.0

ACT_LENGTH

DINT

L#0

actual size of the content in
bytes (not including the header
of 20 bytes)

+6.0

MAX_LENGTH

DINT

L#0

max. size of the content in bytes
(not including the header of 20
bytes)

+10.0

FTP_REPLY_CODE

INT

0

last reply code from the remote
FTP-Server

+12.0

DATE_TIME

DATE_AND_TIME

DT#00-1-1-0:0:0.000

date and time of last change of
the content of the FileDB

=20.0

END_STRUCT

Diferencias en los modos de funcionamiento
Encabezado del File-DB para modo cliente FTP
El encabezado del File-DB aqu√≠ descrito es pr√°cticamente id√©ntico para los modos de cliente
y servidor FTP. Las diferencias residen en los par√°metros
‚óè WRITE_ACCESS
‚óè FTP_REPLY_CODE
Observe al respecto las diferentes descripciones de los par√°metros:
‚óè Estructura de los bloques de datos (File-DB) para servicios FTP - modo FTP-Server
(P√°gina 7443)
‚óè Estructura de los bloques de datos (File-DB) para servicios FTP - modo FTP-Client
(P√°gina 7446)

Instrucciones para CP ERPC
LOGICAL_TRIGGER para el trigger l√≥gico
Significado de la instrucci√≥n
Para el uso de un trigger l√≥gico para la comunicaci√≥n ERPC se dispone de la instrucci√≥n
LOGICAL_TRIGGER .

7450

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para iniciar un trigger l√≥gico, llame la instrucci√≥n LOGICAL_TRIGGER en el OB1 del programa
de usuario de la CPU.
Para llamar la instrucci√≥n LOGICAL_TRIGGER se requieren otros bloques adicionales:
‚óè Un DB de instancia generado autom√°ticamente
‚óè Un bloque de datos "CONF_DB"
Este DB de configuraci√≥n contiene los datos de configuraci√≥n del trigger l√≥gico. El DB de
configuraci√≥n debe crearse y configurarse en el proyecto STEP 7.
Para llamar varios triggers l√≥gicos es necesario disponer varios DBs de configuraci√≥n.
Los n√∫meros de la instrucci√≥n LOGICAL_TRIGGER y del DB de instancia se pueden modificar.

Validez
La instrucci√≥n LOGICAL_TRIGGER se puede utilizar en combinaci√≥n con los siguientes tipos
de m√≥dulos:
‚óè CP 343‚Äë1 ERPC

Llamada
Interfaz de llamada en representaci√≥n FUP
/2*,&$/B75,**(5
%22/

$&7

'21(

%22/

,17

,'

(5525

%22/

:25'

/$''5

67$786

:25'

,17

&21)B'%

,17

&QI/HYHO

Consulte tambi√©n
Bloque de datos de configuraci√≥n (P√°gina 7456)
Forma de trabajar LOGICAL_TRIGGER (P√°gina 7452)
Explicaci√≥n de los par√°metros formales - LOGICAL_TRIGGER (P√°gina 7452)
Indicadores de la instrucci√≥n LOGICAL_TRIGGER (P√°gina 7454)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7451

Instrucciones
4.2 Instrucciones

Forma de trabajar LOGICAL_TRIGGER
Forma de trabajar
La siguiente tabla muestra los pasos que se realizan en una llamada de trigger por parte del
programa de usuario de la CPU.
Paso

Significado
1

La instrucci√≥n LOGICAL_TRIGGER se llama en el punto previsto del programa de usua‚Äê
rio de la CPU con el correspondiente DB de instancia y el bloque de datos de configura‚Äê
ci√≥n CONF_DB configurado.
‚óè Si la instrucci√≥n LOGICAL_TRIGGER se llama con ACT = 1, se leen los datos de
trigger actuales y se env√≠an al firmware del CP.
‚óè Si la instrucci√≥n LOGICAL_TRIGGER se llama con ACT = 0, se actualizan s√≥lo los
indicadores de estado DONE, ERROR y STATUS.

2

La instrucci√≥n LOGICAL_TRIGGER lee los datos de trigger actuales.

3

La instrucci√≥n LOGICAL_TRIGGER genera la PDU, que se env√≠a al firmware del CP con
los datos de trigger actuales.

4

El firmware del CP genera el telegrama de datos y lo transfiere a la aplicaci√≥n ERPC.

5

La aplicaci√≥n ERPC env√≠a el telegrama de datos a la estaci√≥n ERP (sistema ERP o MES).

Consulte tambi√©n
LOGICAL_TRIGGER para el trigger l√≥gico (P√°gina 7450)

Explicaci√≥n de los par√°metros formales - LOGICAL_TRIGGER
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la interfaz de
llamada de la instrucci√≥n LOGICAL_TRIGGER:
Par√°metro

Declaraci√≥n

Tipo de
datos

Valores posibles

Descripci√≥n

ACT

INPUT

BOOL

0

En el caso de una llamada de la instrucci√≥n LOGI‚Äê
CAL_TRIGGER con ACT = 0 se actualizan los indica‚Äê
dores de estado DONE, ERROR y STATUS.

1

Si se llama la instrucci√≥n LOGICAL_TRIGGER con
ACT = 1, los datos de trigger actuales se leen y se en‚Äê
v√≠an al CP.

ID

INPUT

INT

ID del trigger
Este valor identifica el trigger l√≥gico configurado en el
Workbench ILS.

LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP con STEP 7, aparece la direcci√≥n
inicial de m√≥dulo en la tabla de configuraci√≥n de HW
Config. Indique aqu√≠ esta direcci√≥n.

7452

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

CONF_DB

INPUT

INT

CnfLevel

INPUT

INT

Valores posibles

Descripci√≥n
En este bloque de datos se encuentran los datos de
configuraci√≥n de los trigger l√≥gicos configurados.

0: Acuse de transporte

Modo de acuse

1: Acuse fin a fin

El acuse correspondiente se indica en el valor STATUS
de los indicadores de la instrucci√≥n LOGICAL_TRIG‚Äê
GER.
‚óè 0 = acuse de transporte (STATUS = 0000H)
Se notifica el √©xito de la ejecuci√≥n de la petici√≥n en
cuanto los datos se han transferido a la aplicaci√≥n
ERPC.
Sin embargo, ello no significa necesariamente que
el telegrama de datos se haya enviado a la estaci√≥n
ERP (sistema ERP o MES) o que la aplicaci√≥n
ERPC no pueda determinar posteriormente un error.
‚óè 1 = acuse fin a fin (STATUS = 0001H)
La petici√≥n no se acusa hasta que la aplicaci√≥n
ERPC no ha comprobado los datos.
Con la variable "TriggerResponse" del DB de
configuraci√≥n (DB_CONF) se notifica si la estaci√≥n
ERP estaba accesible o si la aplicaci√≥n ERPC se
encuentra en modo Store-and-Forward.
El acuse fin a fin supone un tiempo mayor de
ejecuci√≥n de la petici√≥n que el acuse de transporte.

DONE

OUTPUT

BOOL

0: petici√≥n en curso
1: petici√≥n concluida

El par√°metro indica si la petici√≥n para la transmisi√≥n del
√°rea de datos de configuraci√≥n se ha desarrollado sin
errores.
En caso de aceptarse la petici√≥n, el CP pone DONE a 0.
Mientras sea DONE = 0, no se puede activar ninguna
otra petici√≥n.
La tabla "Indicadores de la instrucci√≥n LOGICAL_TRIG‚Äê
GER" informa sobre el significado en relaci√≥n con los
par√°metros ERROR y STATUS.

ERROR

STATUS

OUTPUT

OUTPUT

BOOL

WORD

0: -

Indicador de error

1: Caso de error

La tabla "Indicadores de la instrucci√≥n LOGICAL_TRIG‚Äê
GER" informa sobre el significado en relaci√≥n con los
par√°metros DONE y STATUS.

Consulte la tabla "Indi‚Äê
cadores de la instruc‚Äê
ci√≥n LOGICAL_TRIG‚Äê
GER"

Indicador de estado
La tabla "Indicadores de la instrucci√≥n LOGICAL_TRIG‚Äê
GER" informa sobre el significado en relaci√≥n con los
par√°metros DONE y ERROR.

Consulte tambi√©n
LOGICAL_TRIGGER para el trigger l√≥gico (P√°gina 7450)
Indicadores de la instrucci√≥n LOGICAL_TRIGGER (P√°gina 7454)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7453

Instrucciones
4.2 Instrucciones

Indicadores de la instrucci√≥n LOGICAL_TRIGGER
Indicadores
La tabla siguiente informa sobre la indicaci√≥n a evaluar por el programa de usuario, formada
por DONE, ERROR y STATUS.
Tabla 4-446 Indicadores de la instrucci√≥n LOGICAL_TRIGGER
DONE

ERROR

STATUS

Significado

Indicadores sobre la ejecuci√≥n de la petici√≥n
1

0

0000H

Petici√≥n terminada sin errores. El trigger l√≥gico se ha concluido con √©xito.

1

0

0001H

Petici√≥n terminada sin errores. La base de datos no est√° disponible (modo Store-andforward).

0

0

8181H

Petici√≥n en curso.

0

1

7000H

La instrucci√≥n LOGICAL_TRIGGER se ha llamado con ACT = 0. Sin embargo, la petici√≥n
no se procesa.
Llame la instrucci√≥n LOGICAL_TRIGGER como m√≠nimo una vez con ACT = 1.

Indicadores sobre la configuraci√≥n y el desarrollo del trigger l√≥gico
0

1

80D2H

El CP utilizado no soporta la comunicaci√≥n ERPC (tipo de CP err√≥neo).

0

1

8183H

El CP utilizado no soporta la comunicaci√≥n ERPC (tipo de CP err√≥neo).

0

1

8187H

Estado no v√°lido de la instrucci√≥n LOGICAL_TRIGGER (LOGICAL_TRIGGER_STATE
desconocido).

0

1

8A01H

La cantidad de trigger l√≥gicos configurados es igual a 0.

0

1

8A02H

Para este trigger l√≥gico no hay ninguna configuraci√≥n en el bloque de datos de configu‚Äê
raci√≥n.

Vuelva a llamar la instrucci√≥n LOGICAL_TRIGGER .

Compruebe la configuraci√≥n del Workbench ILS.
0

1

8A03H

La estructura del bloque de datos de configuraci√≥n no es correcta. El "header identifier"
no tiene el valor correcto.
Corrija el valor de la variable "ident" (v√©ase el manual de producto ERPC-CP) en el DB
de configuraci√≥n.

0

1

8A04H

La estructura del bloque de datos de configuraci√≥n no es correcta.
Vuelva a cargar la configuraci√≥n del Workbench ILS de nuevo en el CP, vuelva a crear el
o los DB de configuraci√≥n y config√∫relo(s) (v√©ase el manual de producto ERPC-CP).

0

1

8A05H

El bloque de datos de configuraci√≥n configurado no existe en la CPU.

0

1

8A06H

En una llamada sucesiva se ha llamado un trigger a√∫n en ejecuci√≥n con otro ID.
Compruebe la "ID" en la instrucci√≥n LOGICAL_TRIGGER llamada.

0

1

8A08H

Los datos de configuraci√≥n del bloque de datos de configuraci√≥n no existen, o no est√°n
completos.
Si el error s√≥lo se produce al arrancar la estaci√≥n S7, la causa puede ser que los datos
de configuraci√≥n del trigger l√≥gico no se han transferido todav√≠a por completo al bloque
de datos de configuraci√≥n.
Si el error persiste, compruebe la configuraci√≥n de los s√≠mbolos ERPC.

0

1

8A09H

En el bloque de datos de configuraci√≥n se ha notificado un error desconocido.

0

1

8A0AH

El trigger l√≥gico no se puede iniciar porque se est√° cargando una nueva configuraci√≥n de
trigger.

7454

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8A0BH

Error al determinar el sello de tiempo del registro de datos actual (datos de la CPU)

0

1

8A0CH

El DB de configuraci√≥n se ha generado con la propiedad "Unlinked".

0

1

8A0DH

Error en el par√°metro de entrada CONF_DB de la instrucci√≥n LOGICAL_TRIGGER. El
par√°metro tiene el valor "0" o es mayor que el n√∫mero de DB m√°ximo permitido para la
CPU.

0

1

8A0EH

El ID de trigger transferido no est√° dentro del rango admisible de 1...16.

Corrija las propiedades de objeto de la instrucci√≥n LOGICAL_TRIGGER.

Corrija el valor en la llamada de la instrucci√≥n LOGICAL_TRIGGER en el programa de
usuario.
0

1

8A0FH

El modo de acuse predeterminado (CnfLevel) no es v√°lido.
Corrija el valor en la llamada de la instrucci√≥n LOGICAL_TRIGGER en el programa de
usuario.

0

1

8BxxH

Error al copiar valores de variables actuales en la PDU del trigger l√≥gico. Los √∫ltimos dos
d√≠gitos (xx) proporcionan el n√∫mero de la variable.
Compruebe la configuraci√≥n del s√≠mbolo afectado en la tabla de s√≠mbolos de la CPU y en
la lista de s√≠mbolos ERPC en el di√°logo de propiedades del CP.

0

1

8C01H

El indicador de estado interno de la instrucci√≥n LOGICAL_TRIGGER no es v√°lido.
Vuelva a cargar la configuraci√≥n del Workbench ILS de nuevo en el CP, vuelva a crear el
o los DB de configuraci√≥n y config√∫relo(s) (v√©ase el manual de producto ERPC-CP).

0

1

8C02H

El valor de respuesta del acuse fin a fin no es v√°lido.
Vuelva a cargar la configuraci√≥n del Workbench ILS de nuevo en el CP, vuelva a crear el
o los DB de configuraci√≥n y config√∫relo(s) (v√©ase el manual de producto ERPC-CP).

0

1

8C03H

El disparador l√≥gico contiene m√°s de 255 variables.

0

1

8C06H

Leer error en registro.

0

1

8D03H

En una acci√≥n de base de datos, el firmware notifica un timeout.

0

1

8D04H

La aplicaci√≥n de base de datos notifica un error general en el acuse de la acci√≥n actual.

0

1

8E01H

El bloque de datos de configuraci√≥n configurado en la CPU no tiene el tama√±o suficiente.
Modifique el tama√±o del bloque de datos de configuraci√≥n.

0

1

8E06H

Todav√≠a no se ha establecido una conexi√≥n con el disparador l√≥gico.

0

1

8EXXH

Este c√≥digo de estado con valores para XXH en el rango entre 02H y FFH corresponde a
representaciones de una respuesta interna de trigger.
Si aparecen este tipo de valores, son relevantes para el servicio t√©cnico.

Consulte tambi√©n
LOGICAL_TRIGGER para el trigger l√≥gico (P√°gina 7450)
Explicaci√≥n de los par√°metros formales - LOGICAL_TRIGGER (P√°gina 7452)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7455

Instrucciones
4.2 Instrucciones

Bloque de datos de configuraci√≥n
Puesta a disposici√≥n del bloque de datos de configuraci√≥n "CONF_DB"
Si se utiliza la funci√≥n ERPC "Trigger l√≥gico", es necesario crear en STEP 7 un bloque de datos
(DB) para los datos de configuraci√≥n del trigger l√≥gico e indicarlo en los par√°metros de llamada
de la instrucci√≥n LOGICAL_TRIGGER . La instrucci√≥n LOGICAL_TRIGGER accede al
CONF_DB. Para el programa de usuario, el CONF_DB no tiene mayor relevancia.

Programaci√≥n del bloque de datos de configuraci√≥n
Para identificar el nuevo DB creado es necesario abrir el DB y definir el "header identifier" y el
tama√±o de DB en las dos primeras l√≠neas libres.
Abra el DB en STEP 7 y configure las dos primeras l√≠neas libres con las variables "ident" y
"data" del siguiente modo:
Direcci√≥n

Nombre

*)

Tipo

Valor inicial

Comentario (opcional)

DW#16#45525043

header identifier

STRUCT *)

*)

ident

DWORD

*)

data

array[1..2048]

*)

Byte

*)

END_STRUCT *)

Tama√±o de DB (v√©anse las
advertencias indicadas a con‚Äê
tinuaci√≥n)

*) Los valores son definidos por el programa

Nota
Tama√±o de DB
Para el tama√±o de DB se recomienda el valor 2 048 bytes. Si durante la puesta en marcha
constata que el valor no es suficiente, aum√©ntelo. La instrucci√≥n LOGICAL_TRIGGER notifica
un valor demasiado bajo con un error y con STATUS "8A05H".

Consulte tambi√©n
LOGICAL_TRIGGER para el trigger l√≥gico (P√°gina 7450)

7456

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

PROFIBUS
Introducci√≥n de PROFIBUS
Indicaciones generales sobre las instrucciones para CPs PROFIBUS
Instrucciones disponibles
La siguiente lista muestra los nombres simb√≥licos de los bloques de programa (instrucciones)
que se utilizan en el estado de suministro. Los nombres simb√≥licos pueden ser modificados por
el usuario.
Servicio de comunicaci√≥n / √°rea de funciones

PROFIBUS DP

SEND / RECEIVE
(Servicios de comunicaci√≥n abiertos)

Comunicaci√≥n S7

Instrucci√≥n (nombre
simb√≥lico) 1)

Biblioteca
CP 300

CP 400

DP_SEND

x

x

DP_RECV

x

x

DP_DIAG

x

x

DP_CTRL

x

x

AG_SEND

x

AG_RECV

x

AG_LSEND

x

AG_LRECV

x

BSEND

x

BRCV

x

PUT

x

GET

x

USEND

x

URCV

x

C_CNTRL

x

1) Observaci√≥n:
Las descripciones siguientes contienen tambi√©n referencias a comportamientos discrepantes en caso de versiones de
instrucciones diferentes. Preste tambi√©n atenci√≥n a la identificaci√≥n de versi√≥n de las instrucciones utilizadas por usted.
Las bibliotecas globales del SIMATIC Manager instaladas con el Automation Workbench contienen las versiones de
instrucciones actuales del momento de la habilitaci√≥n de STEP 7.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7457

Instrucciones
4.2 Instrucciones

¬øQu√© versi√≥n de bloque se debe utilizar?
Las descripciones siguientes contienen tambi√©n referencias a comportamientos discrepantes
en caso de versiones de instrucciones diferentes. Preste tambi√©n atenci√≥n a la identificaci√≥n
de versi√≥n de las instrucciones utilizadas por usted.
Nota
Se recomienda utilizar siempre las versiones de instrucciones actuales para todos los tipos de
m√≥dulos.
Encontrar√° informaciones sobre las versiones de instrucciones actuales, as√≠ como las
instrucciones actuales en nuestro Customer Support en Internet, desde donde las podr√°
descargar:
http://support.automation.siemens.com/WW/view/de/8797900
En el caso de tipos de m√≥dulos menos recientes, esta recomendaci√≥n presupone que usted
utilice la versi√≥n de firmware actual para este tipo de m√≥dulo.

Instrucciones en caso de repuesto
Se entiende por caso de sustituci√≥n en este contexto la sustituci√≥n de un m√≥dulo por otro
m√≥dulo de versi√≥n eventualmente m√°s moderna.
Nota
Tenga en cuenta que, en el caso de utilizar recambios, en el programa de usuario se deben
utilizar s√≥lo las instrucciones autorizadas para el tipo de CP configurado.
Se recomienda utilizar siempre las versiones de instrucciones actuales para todos los tipos de
m√≥dulos. En el caso de tipos de m√≥dulos menos recientes, esta recomendaci√≥n presupone
que usted utilice la versi√≥n de firmware actual para este tipo de m√≥dulo.
M√°s informaci√≥n acerca de casos de sustituci√≥n, encontrar√° en nuestro Customer Support en
Internet.
http://support.automation.siemens.com/WW/view/de/7806643
Los manuales del equipo informan sobre la compatibilidad de los CPs S7 y las instrucciones
correspondientes.

Parametrizaci√≥n de llamadas de las instrucciones
Antes de pasar a describir en detalle las instrucciones, se ofrecen aqu√≠ algunas informaciones
de √≠ndole general sobre la llamada y la parametrizaci√≥n de las instrucciones.
Aqu√≠ se pueden dar informaciones generales sobre los siguientes grupos de par√°metros,
existentes en todas las instrucciones:
‚óè Par√°metros para coordinaci√≥n de CP y enlaces (par√°metros de entrada)
‚óè Par√°metros para definir una determinada √°rea de datos de la CPU (par√°metros de entrada)
‚óè Informaciones sobre estado/status (par√°metros de salida)

7458

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Llamar instrucciones de comunicaci√≥n para S7-300
ATENCI√ìN
No se permite llamar las instrucciones de comunicaci√≥n para S7-300 en varios niveles de
proceso. Si, por ejemplo, llama una instrucci√≥n de comunicaci√≥n en OB1 y en OB35, el
procesamiento de la instrucci√≥n podr√≠a ser interrumpido por el OB de prioridad
respectivamente superior.
Si llama instrucciones en varios OBs, tiene que procurar, a trav√©s de la programaci√≥n, que
una instrucci√≥n de comunicaci√≥n en procesamiento no sea interrumpida por otras
instrucciones de comunicaci√≥n (por ejemplo, por medio de las instrucciones del sistema
Bloquear/Liberar alarmas).

Par√°metros para definir una determinada √°rea de datos de la CPU (par√°metros de entrada)
Indicar el √°rea de datos en la CPU
Al llamar una instrucci√≥n transmite usted la direcci√≥n y la longitud del √°rea de datos de la CPU
en la que se deben disponer o almacenar datos √∫tiles o bien que puede contener otras
informaciones relativas a la parametrizaci√≥n.
Para el direccionamiento de esta √°rea se utiliza el tipo de datos del puntero ANY.

Informaciones sobre estado/status (par√°metros de salida)
Evaluar indicaciones de estados
Para la evaluaci√≥n del estado se tienen que evaluar estos par√°metros en el programa de
usuario:
‚óè DONE o NDR
Estos par√°metros (DONE en el caso de peticiones de env√≠o o NDR para peticiones de
recepci√≥n) notifica la conclusi√≥n (con resultado positivo) de una ejecuci√≥n de la petici√≥n.
‚óè ERROR
Notifica que la petici√≥n no se ha podido ejecutar sin errores.
‚óè STATUS
El par√°metro proporciona informaci√≥n detallada sobre la ejecuci√≥n de la petici√≥n. Se
pueden proporcionar indicaciones de estado ya durante la ejecuci√≥n de la petici√≥n
(DONE=0 y ERROR=0).
Nota
Tenga en cuenta que las indicaciones de estado DONE, NDR, ERROR y STATUS se
actualizan con cada llamada de la instrucci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7459

Instrucciones
4.2 Instrucciones

Indicaciones de estado al arrancar el CP
Al rearrancar el CP Ethernet, los par√°metros de salida de la instrucci√≥n se resetean como
sigue:
‚óè DONE = 0
‚óè NDR = 0
‚óè ERROR = 0
‚óè STATUS = 8180H √≥ 8181H

Instrucciones para los Servicios de comunicaci√≥n abiertos (interfaz SEND/RECEIVE)
Instrucciones para enlaces FDL (interfaz SEND/RECEIVE)
Panor√°mica
En la interfaz SEND/RECEIVE est√°n disponibles las siguientes instrucciones para la
transmisi√≥n de datos a trav√©s de enlaces FDL configurados:
Instrucci√≥n

utilizable para 1)

S7-300

S7-400

Significado

AG_SEND

x

x

para enviar datos

AG_RECV

x

x

para recibir datos

AG_LSEND

x

para enviar datos

AG_LRECV

x

para recibir datos

1) Observaciones sobre las instrucciones para S7-300 y S7-400
Para garantizar la compatibilidad de PROFIBUS y Industrial Ethernet en la interfaz del
programa de usuario se pueden utilizar las instrucciones AG_LSEND y AG_LRECV para
PROFIBUS como alternativa a AG_SEND o AG_RECV. No hay diferencias en la interfaz ni en
el comportamiento. Pero en PROFIBUS, con estas instrucciones, destinadas para la
transmisi√≥n de registros de datos largos en Industrial Ethernet, s√≥lo se pueden transmitir
cantidades de datos de 240 bytes, como m√°ximo.
Condici√≥n para ello es que el tipo y la versi√≥n de las instrucciones est√©n autorizados para el tipo
de CP utilizado.
En el caso de los CPs S7 para S7-300 se utilizan exclusivamente las instrucciones AG_SEND
y AG_RECV; en Industrial Ethernet, tambi√©n para la transmisi√≥n de registros de datos largos.
Los manuales del equipo informan sobre la compatibilidad de los CPs S7 y las instrucciones
correspondientes. Encontrar√° una tabla general de las versiones de instrucciones en el
historial de la documentaci√≥n y los bloques.

7460

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Uso
El esquema siguiente explica la aplicaci√≥n de las instrucciones AG_SEND / AG_LSEND y
AG_RECV / AG_LRECV para la transferencia de datos bidireccional a trav√©s de un enlace FDL
configurado.
Para determinados tipos de enlaces se tiene que prever una cabecera (header) de petici√≥n en
el √°rea de datos del usuario.
CPU
Programa de
usuario
STEP 7

CPU
Programa de
usuario
STEP 7

Enlace FDL
v√≠a
PROFIBUS

Campos de datos
DP

Figura 4-76

PROFIBUS-CP

PROFIBUS-CP

Campos de datos
DP

AG_SEND

enviar

recibir

AG_RECV

AG_RECV

recibir

enviar

AG_SEND

Utilizar AG_SEND y AG_RECV en ambos interlocutores de comunicaci√≥n

Aplicaci√≥n sin cabecera de petici√≥n
En el caso de un enlace FDL especificado, los par√°metros de direcci√≥n y petici√≥n son definidos
por la configuraci√≥n del enlace. Por lo tanto, el programa de usuario s√≥lo proporciona los datos
√∫tiles en el campo de datos FDL al enviar con AG_SEND / AG_LSEND, o los recibe con
AG_RECV / AG_LRECV.
Pueden transmitirse hasta 240 Byte de datos √∫tiles. Esto es v√°lido en PROFIBUS para
AG_SEND y AG_LSEND.

Aplicaci√≥n con cabecera de petici√≥n
Los siguientes tipos de enlaces exigen una cabecera de petici√≥n en el √°rea de datos (de
usuario) FDL:
‚óè Enlace FDL no especificado con acceso libre a Layer 2
‚óè Enlace FDL con Broadcast
‚óè Enlace FDL con Multicast
Vea en la ilustraci√≥n siguiente la estructura del b√∫fer de peticiones y el significado y el
emplazamiento de los par√°metros en la cabecera de la petici√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7461

Instrucciones
4.2 Instrucciones
Campo de datos de usuario
B√∫fer de peticiones
Cabecera de
petici√≥n

PB‚àíAdresse

LSAP

Byte 0, 1

Service

unbenutzt

Byte 2, 3

Datenbyte 0

Datenbyte 1

Byte 4, 5

Byte datos 234

Byte datos 235

Datos √∫tiles

Figura 4-77

Byte 238, 239

Enviar y recibir a trav√©s de un enlace FDL con direccionamiento Broadcast por programa

El campo de datos de usuario puede tener hasta 240 Byte. Pueden transmitirse hasta 236 Byte
de datos √∫tiles. 4 Byte est√°n reservados para la cabecera de la petici√≥n.
Tenga en cuenta que la longitud de datos indicada al llamar la instrucci√≥n (par√°metro LEN) ha
de contener la cabecera (Header) y los datos √∫tiles.

AG_SEND / AG_LSEND
AG_SEND / AG_LSEND (PROFIBUS)
Descripci√≥n
La instrucci√≥n AG_SEND / AG_LSEND entrega datos al CP PROFIBUS para su transmisi√≥n a
trav√©s de una conexi√≥n FDL configurada.
El √°rea de datos indicada puede ser un √°rea PA, un √°rea de marcas o un √°rea de bloques de
datos.
Si ha sido posible enviar a trav√©s de PROFIBUS toda el √°rea de datos de usuario, esto se
se√±aliza para notificar la ejecuci√≥n correcta.
Observaci√≥n:
Todos los datos siguientes son igualmente v√°lidos para AG_SEND y AG_LSEND, a no ser que
se indique lo contrario.

7462

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Llamada
Interfaz de llamada en representaci√≥n FUP
$*B6(1'$*B/6(1'$*B66(1'
%22/

$&7

,17

'21(

%22/

,'

(5525

%22/

:25'

/$''5

67$786

:25'

$1<

6(1'

,17

/(1

Llamadas con encabezado de petici√≥n
Vea en la tabla siguiente para qu√© tipos de conexiones y qu√© tipos de peticiones se tienen que
abastecer par√°metros en el encabezado de la petici√≥n.
El encabezado de petici√≥n est√° en el √°rea de datos (de usuario) FDL. All√≠ ocupa los primeros
4 bytes y se tiene que sumar al indicar la longitud en el par√°metro LEN. La longitud m√°xima de
datos de usuario se reduce as√≠ a 236 bytes en el caso de peticiones con encabezado.
Tabla 4-447 Abastecimiento del encabezado de petici√≥n en el √°rea de datos de usuario
Par√°metro

Tipo de conexi√≥n FDL

no especifica‚Äê Broadcast
do: Layer 2 li‚Äê
bre 2)

Multicast

Direcci√≥n PB

para AG_SEND sin re‚Äê
levancia; pero el √°rea
se tiene que reservar.

Direcci√≥n de la estaci√≥n de desti‚Äê
no
Rango de valores:
0..126 seg√∫n dispositivo /
127 para Broadcast/Multicast

LSAP

LSAP de la estaci√≥n de destino
Rango de valores:
0..62 seg√∫n dispositivos /
63 para Broadcast

Service 1)

para AG_SEND sin re‚Äê
levancia; pero el √°rea
se tiene que reservar.

sin relevancia; pero el
sin relevancia; pero el
√°rea se tiene que reser‚Äê √°rea se tiene que reser‚Äê
var.
var.

sin relevancia; pero el
SDA ( Send Data with Acknowled‚Äê sin relevancia; pero el
√°rea se tiene que reser‚Äê √°rea se tiene que reser‚Äê
ge):
var.
var.
valor: 00H
SDN ( Send Data with No Acknow‚Äê
ledge):
valor: 01H

1)

para Broadcast y Multicast solo es posible Service SDN.

Los datos relativos a Broadcast y Multicast de esta columna solo son relevantes en el caso
de que se utilice una conexi√≥n FDL no especificada para Broadcast o Multicast. En el caso de
una conexi√≥n FDL configurada (aplicaci√≥n recomendada) con Broadcast o Multicast como
interlocutor de conexi√≥n, los par√°metros de direcci√≥n se asignan autom√°ticamente de acuerdo
con la configuraci√≥n.
2)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7463

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Par√°metros en el caso de AG_SEND / AG_LSEND (PB) (P√°gina 7464)
Par√°metros DONE, ERROR, STATUS (PB) (P√°gina 7465)
Ejemplo para AG_SEND (PB) (P√°gina 7467)
AG_SEND / AG_LSEND / AG_SSEND (Ind.Ethernet) (P√°gina 7316)

Par√°metros en el caso de AG_SEND / AG_LSEND (PB)
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica los par√°metros formales de la instrucci√≥n
AG_SEND / AG_LSEND:
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

Valores posibles

Descripci√≥n

ACT

INPUT

BOOL

0,1

En el caso de una llamada de la instrucci√≥n con ACT = 1
se env√≠an LEN Bytes del √°rea de datos indicada con el
par√°metro SEND.
En el caso de una llamada de la instrucci√≥n con ACT = 0
se actualizan las indicaciones de estado DONE, ERROR
y STATUS.

ID

INPUT

INT

1,2...64
(S7-400)

En el par√°metro ID se indica el n√∫mero del enlace FDL.

1,2...16
(S7-300)
LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP aparece la direcci√≥n inicial de m√≥dulo
en la tabla de configuraci√≥n. Indique aqu√≠ esta direcci√≥n.

SEND

INPUT

ANY

Indicar la direcci√≥n y la longitud

(como
VARTYPE
s√≥lo se admi‚Äê
te:

La direcci√≥n del √°rea de datos remite como alternativa a:
‚óè √Årea PA
‚óè √Årea de marcas
‚óè √Årea de bloques de datos

BYTE,
WORD y
DWORD
LEN

INPUT

INT

En caso de llamada con cabecera de petici√≥n, el √°rea de
datos FDL contiene la cabecera de petici√≥n y los datos
√∫tiles.
1,2,...240 (o hasta
"dato de longitud en
par√°metro SEND")

Cantidad de bytes que se deben enviar junto con la pe‚Äê
tici√≥n desde el √°rea de datos FDL. Este n√∫mero puede
estar comprendido entre 1 y "dato de longitud en par√°‚Äê
metro SEND".
En caso de llamada con cabecera de petici√≥n, la longitud
de compone de la cabecera de petici√≥n (4 bytes) + datos
√∫tiles (1..236 bytes). Por lo tanto es LEN >= 4.

DONE

7464

OUTPUT

BOOL

0: 1: nuevos datos

El par√°metro de estado indica si la petici√≥n se ha ejecu‚Äê
tado sin errores.
La tabla siguiente informa sobre el significado en rela‚Äê
ci√≥n con los par√°metros ERROR y STATUS

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

Valores posibles

Descripci√≥n

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicaci√≥n de fallo

V√©ase la tabla si‚Äê
guiente

Indicaci√≥n de estado

STATUS

OUTPUT

WORD

La tabla siguiente informa sobre el significado en rela‚Äê
ci√≥n con los par√°metros DONE y STATUS.
La tabla siguiente informa sobre el significado en rela‚Äê
ci√≥n con los par√°metros DONE y ERROR.

Consulte tambi√©n
AG_SEND / AG_LSEND (PROFIBUS) (P√°gina 7462)

Par√°metros DONE, ERROR, STATUS (PB)
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

Tabla 4-448 C√≥digos de condici√≥n de AG_SEND
DONE

ERROR

STATUS

Significado

1

0

0000H

Petici√≥n terminada sin errores.

0

0

0000H

Ninguna petici√≥n en proceso.

0

0

8181H

Petici√≥n en curso.

0

1

7000H

Este c√≥digo es solo posible en S7-400: La instrucci√≥n se ha llamado con ACT=0; pero la
petici√≥n no se procesa.

0

1

8183H

Falta la configuraci√≥n o no se ha iniciado a√∫n el servicio FDL en el CP PROFIBUS.

0

1

8184H

Posibles causas:
‚óè Se ha indicado un tipo de datos no permitido para el par√°metro SEND.
‚óè Conexi√≥n FDL sin b√∫fer de peticiones Error del sistema.
‚óè Conexi√≥n FDL con b√∫fer de peticiones Par√°metro LEN<4 o par√°metro no permitido en
el encabezado de petici√≥n (con acceso libre a Layer 2).

0

1

8185H

Par√°metro LEN mayor que el √°rea fuente SEND.

0

1

8186H

Par√°metro ID no v√°lido. ID != 1,2....15,16.

0

1

8301H

SAP no activado en la estaci√≥n de destino.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7465

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8302H

No hay recursos de recepci√≥n en la estaci√≥n de destino, la estaci√≥n emisora no puede
procesar con suficiente rapidez los datos recibidos o no ofrece recursos de recepci√≥n
suficientes.

0

1

8303H

El servicio PROFIBUS ( SDA-Send Data with Acknowledge) no es soportado en este SAP
por la estaci√≥n de destino.
El c√≥digo de condici√≥n puede aparecer tambi√©n temporalmente al cargar conexiones o
transiciones de red "en RUN".

0

1

8304H

La conexi√≥n FDL no est√° establecida.

0

1

8311H

No se puede acceder a la estaci√≥n de destino con la direcci√≥n PROFIBUS indicada o bien
el servicio utilizado no es posible para la direcci√≥n PROFIBUS indicada.

0

1

8312H

Error PROFIBUS en el CP: p. ej. cortocircuito, la estaci√≥n propia no est√° en el anillo.

0

1

8315H

Posibles causas:
‚óè Error de par√°metro interno en una conexi√≥n FDL con encabezado de petici√≥n:
Par√°metro LEN<4 o par√°metro no permitido en el encabezado de petici√≥n (con
acceso libre a Layer 2).
‚óè Fallo del bus
Posible significado adicional:
‚óè El indicador de error se puede presentar tambi√©n en caso de perturbaciones en el bus
(por ejemplo, si se producen fallos f√≠sicos debido a terminaciones de l√≠nea
defectuosas o a diferencias en los ajustes de la velocidad de transmisi√≥n en los
dispositivos).

0

1

8F22H

√Årea fuente no valida, p. ej.:
√Årea no existente en DB
Par√°metro LEN < 0

0

1

8F24H

Error de √°rea al leer un par√°metro.

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

Error del n√∫mero DB.

0

1

8F3AH

√Årea de destino no cargada (DB).

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia.

0

1

8F44H

La direcci√≥n del par√°metro a leer est√° inhibida en la pista de acceso.

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.
p. ej., par√°metro LEN = 0 .

0

1

8090H

‚óè No existe un m√≥dulo con esta direcci√≥n inicial de m√≥dulo.
‚óè La instrucci√≥n utilizada no es acorde con la familia de sistemas utilizada (se tienen
que utilizar instrucciones diferentes para S7-300 y S7-400).

0

1

8091H

La direcci√≥n base l√≥gica no est√° en formato de palabra doble.

0

1

8092H

En la referencia ANY se ha indicado un tipo distinto de BYTE.
(solo para S7-400)

0

1

80A4H

La conexi√≥n de bus K entre CPU y CP no est√° establecida. (en CPUs con versiones m√°s
actuales).
Esto se puede deber, por ejemplo, a lo siguiente:
‚óè falta configuraci√≥n de conexiones;
‚óè se supera la cantidad m√°xima de CPs que pueden trabajar en paralelo (ver
informaci√≥n al respecto en el manual del CP).

7466

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

√Årea de destino no v√°lida.
El n√∫mero de datos que deben enviarse sobrepasa el l√≠mite superior admisible para este
servicio (p. ej. √°rea de destino > 240 bytes).

0

1

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida (en caso de versiones de CPU
menos recientes; en otro caso 80A4H; consulte all√≠ m√°s informaci√≥n)

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Medio de servicio (memoria) ocupado.

0

1

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conveniente una repeti‚Äê
ci√≥n en el programa de usuario.

0

1

80D2H

Direcci√≥n inicial del m√≥dulo err√≥nea.

Consulte tambi√©n
AG_SEND / AG_LSEND (PROFIBUS) (P√°gina 7462)

Ejemplo para AG_SEND (PB)
Ejemplo de llamada y an√°lisis de los par√°metros
A continuaci√≥n encontrar√° un ejemplo ejecutable para la llamada y el an√°lisis de los
par√°metros de una instrucci√≥n AG_SEND.
La instrucci√≥n "AE_460_1" aqu√≠ elegida, en la que tiene lugar la llamada de emisi√≥n, incluye el
OB100 mostrado m√°s abajo; el OB100 ajusta correctamente el bit ACT al arrancar la CPU.
Para lograr un funcionamiento correcto ha de estar cargado un DB100 con un tama√±o m√≠nimo
de 240 bytes.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7467

Instrucciones
4.2 Instrucciones
El programa exige un CP en la direcci√≥n 256 as√≠ como la existencia de un enlace configurado
del tipo ISO‚ÄëTransport / ISO-on-TCP / TCP- o FDL con el ID=1 (hacer las adaptaciones
necesarias).
//-------------------------------------------------------------------FUNCTION FC 100: VOID
TITLE = SENDE_DEMO
AUTHOR : Tester
FAMILY : S7300
NAME : FC5_Demo
VERSION : 1.0
//-------------------------------------------------------------------BEGIN
CALL FC 5 (
ACT
:= M100.0,
ID
:= 1,
LADDR
:= W#16#100,
SEND
:= P#DB100.dbx0.0 BYTE 240,
LEN
:= 240,
DONE
:= M100.1,
ERROR
:= M100.2,
STATUS
:= MW102 );
//-------------------------------------------------------------------R M100.0;
//
Resetear par√°metro ACT para todas las
SET;
//
futuras llamadas de AG_SEND
U M100.1;
//
SPB done;
//
Comprobar si DONE = TRUE
SET;
//
U M100.2;
//
SPB err;
//
Comprobar si ERROR = TRUE
//-------------------------------------------------------------------BEA;
//
No est√° puesto DONE ni ERROR; la
//
petici√≥n a√∫n est√° en ejecuci√≥n.
//-------------------------------------------------------------------done:
S M100.0;
//
Petici√≥n terminada sin errores. Poner
BEA;
//
ACT = TRUE para que la llamada siguiente
pueda impulsar la nueva petici√≥n.
//--------------------------------------------------------------------

7468

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
err:

NOP 1;
NOP 1;
S M100.0;
BEA;

//
//
//
//

Se ha presentado un error Aqu√≠ se puede
analizar la palabra de estado. Poner en
cualquier caso ACT en TRUE, para que se
pueda impulsar una nueva petici√≥n de
emisi√≥n si desaparece el error.
//-------------------------------------------------------------------END_FUNCTION
ORGANIZATION_BLOCK OB100
TITLE
= Init_for_FC100
FAMILY:
S7300
NAME:
SENDE_DEMO_INIT
VERSION:
1.0
VAR_TEMP
OB1_System: array [1..20] of byte;
END_VAR
//-------------------------------------------------------------------BEGIN
//
SET
//
S M100.0
//
Inicializaci√≥n del par√°metro ACT
END_ORGANIZATION_BLOCK

AG_RECV / AG_LRECV
AG_RECV / AG_LRECV (PROFIBUS)
Descripci√≥n
La instrucci√≥n AG_RECV / AG_LRECV toma del CP PROFIBUS los datos transmitidos a
trav√©s de una conexi√≥n FDL configurada.
El √°rea de datos indicada para la toma de datos puede ser un √°rea PA, un √°rea de marcas o
un √°rea de bloques de datos.
Se se√±ala que la funci√≥n ha sido ejecutada sin errores cuando se hayan podido recibir los
datos del CP PROFIBUS.
Observaci√≥n:
Todos los datos siguientes son igualmente v√°lidos para AG_RECV y AG_LRECV, a no ser que
se indique lo contrario.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7469

Instrucciones
4.2 Instrucciones

Interfaz de llamada
Interfaz de llamada en representaci√≥n FUP
$*B5(&9$*B/5(&9
1'5

%22/

,17

,'

(5525

%22/

:25'

/$''5

67$786

:25'

$1<

5(&9

/(1

,17

Llamadas con encabezado de petici√≥n
Tabla 4-449 Par√°metros de retorno en el encabezado de petici√≥n en el √°rea de datos (de usuario) FDL.
Par√°metro

Tipo de conexi√≥n FDL

no especifica‚Äê Broadcast
do: Layer libre
2)

Multicast

Direcci√≥n PB

Direcci√≥n del emisor
Rango de valores: 0..126 seg√∫n dispositivo

LSAP

LSAP del emisor
Rango de valores: 0..63 seg√∫n dispositivo

Service

Indicador SDN

Indicador SDN

(Send Data with No Acknowledge
- Indication):
valor: 01H

(Send Data with No Ack‚Äê (Send Data with No Ack‚Äê
nowledge - Indication): nowledge - Indication):
valor: 7FH
valor: 7FH

Indicador SDN

o bien
Indicador SDA ( Send Data with
Acknowledge - Indication):
valor: 00H

Consulte tambi√©n
Par√°metros en el caso de AG_RECV / AG_LRECV (PB) (P√°gina 7471)
Par√°metros DONE, ERROR, STATUS (PB) (P√°gina 7472)
AG_RECV / AG_LRECV / AG_SRECV (Ind.Ethernet) (P√°gina 7321)

7470

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de AG_RECV / AG_LRECV (PB)
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales de la instrucci√≥n
AG_RECV / AG_LRECV:
Par√°metro

Declaraci√≥n Tipo de datos

Valores posibles

Descripci√≥n

ID

INPUT

INT

1,2...16 (S7-300)
1,2...32 (S7-400)

En el par√°metro ID se indica el n√∫mero del enlace FDL.

LADDR

INPUT

WORD

Direcci√≥n inicial del m√≥dulo
Al configurar el CP aparece la direcci√≥n inicial de m√≥du‚Äê
lo en la tabla de configuraci√≥n. Indique aqu√≠ esta direc‚Äê
ci√≥n.

RECV

INPUT

ANY

Indicar la direcci√≥n y la longitud

(como VARTY‚Äê
PE s√≥lo se admi‚Äê
te:

La direcci√≥n del √°rea de datos FDL remite como alter‚Äê
nativa a:
‚óè √Årea PA

BYTE, WORD y
DWORD

‚óè √Årea de marcas
‚óè √Årea de bloques de datos
En caso de llamada con cabecera de petici√≥n, el √°rea de
datos FDL contiene la cabecera de petici√≥n y los datos
√∫tiles.

LEN

OUTPUT

INT

1,2,...240

Indica el n√∫mero de bytes que se han tomado del CP
PROFIBUS en el √°rea de datos.
En caso de llamada con cabecera de petici√≥n, la longi‚Äê
tud de compone de la cabecera de petici√≥n (4 bytes) +
datos √∫tiles (1..236 bytes). Por lo tanto es LEN >= 4.

NDR

OUTPUT

BOOL

0: 1: nuevos datos

Este par√°metro se√±aliza si se han aceptado nuevos da‚Äê
tos.
La tabla siguiente informa sobre el significado en rela‚Äê
ci√≥n con los par√°metros ERROR y STATUS.

ERROR

STATUS

OUTPUT

OUTPUT

BOOL

WORD

0: 1: caso de error

Indicaci√≥n de fallo

V√©ase la tabla si‚Äê
guiente

Indicaci√≥n de estado

Para saber su significado en relaci√≥n con los par√°me‚Äê
tros NDR y STATUS, v√©ase la tabla siguiente.
Para saber su significado en relaci√≥n con los par√°me‚Äê
tros NDR y ERROR, v√©ase la tabla siguiente.

Consulte tambi√©n
AG_RECV / AG_LRECV (PROFIBUS) (P√°gina 7469)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7471

Instrucciones
4.2 Instrucciones

Par√°metros DONE, ERROR, STATUS (PB)
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por los par√°metros
NDR, ERROR y STATUS, que tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

Tabla 4-450 C√≥digos de condici√≥n de AG_RECV / AG_LRECV
NDR

ERROR

STATUS

Significado

1

0

0000H

Nuevos datos aceptados.

0

0

8180H

‚óè A√∫n no hay datos.
Falta la configuraci√≥n o a√∫n no se ha iniciado el servicio FDL en el CP PROFIBUS
(aparece en lugar del c√≥digo de condici√≥n 0,1,8183H).

0

0

8181H

Petici√≥n en curso.

0

1

8183H

Falta la configuraci√≥n o no se ha iniciado a√∫n el servicio FDL en el CP PROFIBUS.

0

1

8184H

‚óè Se ha indicado un tipo de datos no permitido para el par√°metro RECV.

0

1

8185H

B√∫fer de destino (RECV) demasiado peque√±o.

‚óè Error del sistema.
0

1

8186H

Par√°metro ID no v√°lido. ID != 1,2....15,16.

0

1

8303H

El servicio PROFIBUS (SDA-SendDatawithAcknowledge) no se soporta en este SAP.
El c√≥digo de condici√≥n puede aparecer tambi√©n temporalmente al cargar conexiones o
transiciones de red "en RUN".

0

1

8304H

La conexi√≥n FDL no est√° establecida.

0

1

8F23H

√Årea fuente no valida, p. ej.:
√Årea no presente en DB.

0

1

8F25H

Error de √°rea al escribir un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos act. protegido de escritura.

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos act. protegido de escritura.

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

Error del n√∫mero DB.

0

1

8F3AH

√Årea de destino no cargada (DB).

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el
√°rea de periferia.

0

1

8F45H

La direcci√≥n del par√°metro que debe escribirse est√° bloqueada en la pista de acceso.

7472

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
NDR

ERROR

STATUS

Significado

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

0

1

8090H

‚óè No existe un m√≥dulo con esta direcci√≥n inicial de m√≥dulo.
‚óè La instrucci√≥n utilizada no es acorde con la familia de sistemas utilizada (se tienen
que utilizar instrucciones diferentes para S7-300 y S7-400).

0

1

8091H

La direcci√≥n base l√≥gica no est√° en formato de palabra doble.

0

1

8092H

En la referencia ANY se ha indicado un tipo distinto de BYTE.
(solo para S7-400)

0

1

80A0H

Acuse negativo al leer del m√≥dulo.

0

1

80A4H

La conexi√≥n de bus K entre CPU y CP no est√° establecida. (en CPUs con versiones m√°s
actuales).
Esto se puede deber, por ejemplo, a lo siguiente:
‚óè falta configuraci√≥n de conexiones;
‚óè se supera la cantidad m√°xima de CPs que pueden trabajar en paralelo (ver
informaci√≥n al respecto en el manual del CP).

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

Posibles causas:
‚óè El √°rea de destino no es v√°lida.
‚óè El √°rea de destino es demasiado peque√±a.
‚óè El √°rea de destino para los datos de recepci√≥n no se ha calculado bien.
Soluci√≥n: realice otra llamada de recepci√≥n con el tama√±o m√°ximo del b√∫fer de recep‚Äê
ci√≥n. Esto sirve independientemente del tipo de conexi√≥n (Unicast/Multicast/Broadcast)
y de la familia de dispositivos (S7-300 / S7-400).

0

1

80B2H

La conexi√≥n de bus K entre CPU y CP no est√° establecida.

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Medio de servicio (memoria) ocupado.

0

1

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conveniente una repeti‚Äê
ci√≥n en el programa de usuario).

0

1

80D2H

Direcci√≥n inicial del m√≥dulo err√≥nea.

Consulte tambi√©n
AG_RECV / AG_LRECV (PROFIBUS) (P√°gina 7469)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7473

Instrucciones
4.2 Instrucciones

Instrucciones para la DP (periferia descentralizada) para S7-300
Instrucciones para el modo DP en S7-300
Panor√°mica
Para los modos maestro DP y esclavo DP se dispone de las siguientes instrucciones para
S7-300:
Instrucci√≥n

DP_SEND

utilizable para

Significado

Maestro DP

Esclavo
DP

X

X

para enviar datos

DP_RECV

X

X

para recibir datos

DP_DIAG

X

-

para funciones de diagn√≥stico desde
el maestro DP

DP_CTRL

X

-

para funciones de control

Uso
La representaci√≥n siguiente aclara la aplicaci√≥n de las instrucciones DP_SEND y DP_RECV
en el maestro DP y el esclavo DP.
'30DVWHU
&38

'36ODYH
352),%86&3

352),%86&3

&38

3URJUDPDGH
XVXDULR
67(3

3URJUDPDGH
XVXDULR
67(3

&DPSRVGHGDWRV
'3

&DPSRVGHGDWRV
'3

'3B6(1'

HQYLDU

'3B5(&9

UHFLELU

UHFLELU

'3B5(&9

HQYLDU

'3B6(1'

352),%86

Figura 4-78

7474

Uso de las instrucciones DP_SEND y DP_RECV en el maestro DP y el esclavo DP

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

DP_SEND
DP_SEND
Descripci√≥n
La instrucci√≥n DP_SEND transmite datos al CP PROFIBUS. Dependiendo del modo operatiivo
del CP PROFIBUS, DP_SEND tiene el siguiente significado:
‚óè Para uso en el maestro DP
La instrucci√≥n transfiere los datos de un √°rea de salida DP indicada al CP PROFIBUS, para su
emisi√≥n a la periferia descentralizada.
‚óè Para uso en el esclavo DP
La instrucci√≥n transfiere los datos de entrada del esclavo DP al CP PROFIBUS, para su
transmisi√≥n al maestro DP
El √°rea de datos indicada puede ser un √°rea PA, un √°rea de marcas o un √°rea de bloques de
datos.
Se se√±ala que la funci√≥n ha sido ejecutada sin errores cuando se haya podido recibir toda el
√°rea de datos DP del CP PROFIBUS.
Para iniciar el maestro DP hay que anteponer una llamada de DP_SEND o DP_RECV en la
secuencia de llamada. Para esta primera llamada rige lo siguiente:
Si se utiliza DP_SEND para la inicializaci√≥n, el √°rea de datos transferida no se aplicar√° y se
enviar√° "0" a los esclavos. Los datos de usuario transferidos no se enviar√°n hasta la segunda
llamada del bloque.

Interfaz de llamada
DP_SEND
WORD

CPLADDR

ANY

SEND

DONE

BOOL

ERROR

BOOL

STATUS

WORD

Consulte tambi√©n
Par√°metros en el caso de DP_SEND (P√°gina 7476)
Par√°metros DONE, ERROR, STATUS (P√°gina 7477)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7475

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de DP_SEND
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales de la instrucci√≥n
DP_SEND:
Par√°metro

Declaraci√≥n Tipo de datos

CPLADDR

INPUT

Rango de valo‚Äê
res

WORD

Descripci√≥n
Direcci√≥n inicial del m√≥dulo
Al configurar el CP aparece la direcci√≥n inicial de m√≥dulo
en la tabla de configuraci√≥n. Indique aqu√≠ esta direcci√≥n.

SEND

INPUT

ANY

Indicar la direcci√≥n y la longitud

(como VARTY‚Äê
PE solo se admi‚Äê
te:

La direcci√≥n del √°rea de datos DP remite como alterna‚Äê
tiva a:

para DP_SEND
a partir de V3:
BYTE

‚óè √Årea de marcas

‚óè √Årea PA
‚óè √Årea de bloques de datos
Se tiene que ajustar la longitud para

para DP_SEND
hasta V2.x:
BYTE, WORD y
DWORD)

‚óè Maestro DP: 1...21600
‚óè Esclavo DP: 1...240

DONE

OUTPUT

BOOL

0: 1: nuevos datos

El par√°metro de estado indica si la petici√≥n
se ha ejecutado sin errores.
Consulte el significado en relaci√≥n con los par√°metros
ERROR y STATUS en Par√°metros DONE, ERROR,
STATUS (P√°gina 7477).

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicador de error
Consulte el significado en relaci√≥n con los par√°metros
DONE y STATUS en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7477)

STATUS

OUTPUT

WORD

Indicador de estado
Consulte el significado en relaci√≥n con los par√°metros
DONE y ERROR en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7477)

Consulte tambi√©n
DP_SEND (P√°gina 7475)

7476

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros DONE, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

Tabla 4-451 Indicadores de DP_SEND
DONE

ERROR

STATUS

Significado

0

0

8180H

‚óè Arranque:
El servicio DP se ha iniciado, pero todav√≠a no es posible aplicar los datos.
‚óè Funcionamiento normal
Se transfieren datos.
‚óè El DP no se ha iniciado debido a la situaci√≥n siguiente:

1

0

0000H

‚Äì

CP STOP o

‚Äì

"no hay parametrizaci√≥n" (aparece aqu√≠ en lugar del indicador 0,1,8183H).

Nuevos datos transferidos sin error.

0

1

8183H

Falta la configuraci√≥n o no se ha iniciado a√∫n el servicio DP en el CP PROFIBUS.

0

1

8184H

Error del sistema o tipo de par√°metro no permitido.

0

1

8F22H

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

1

8F24H

Error de √°rea al leer un par√°metro.

0

1

8F25H

Error de √°rea al escribir un par√°metro.

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro.

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos act. protegido de escritura.

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos act. protegido de escritura.

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

Error de n√∫mero de DB.

0

1

8F3AH

√Årea de destino no cargada (DB).

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia.

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia.

0

1

8F44H

La direcci√≥n del par√°metro a leer est√° inhibida en la pista de acceso.

0

1

8F45H

La direcci√≥n del par√°metro que debe escribirse est√° bloqueada en la pista de acceso.

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7477

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8090H

No existe m√≥dulo con esta direcci√≥n.

0

1

8091H

La direcci√≥n base l√≥gica no est√° en formato de palabra doble.

0

1

80A1H

Acuse negativo al escribir en el m√≥dulo.

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

La cantidad de datos a enviar supera el l√≠mite superior admisible para este servicio (v√°lido
para los modos maestro DP y esclavo DP).

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Medio de servicio (memoria) ocupado.

0

1

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conveniente una repeti‚Äê
ci√≥n en el programa de usuario.)

0

1

80D2H

Direcci√≥n base l√≥gica incorrecta.

Consulte tambi√©n
DP_SEND (P√°gina 7475)

DP_RECV
DP_RECV
Descripci√≥n
La instrucci√≥n DP_RECV recibe datos a trav√©s de PROFIBUS. Dependiendo del modo
operatiivo del CP PROFIBUS, DP_RECV tiene el siguiente significado:
‚óè Para uso en el maestro DP
DP_RECV acepta los datos de proceso de la periferia descentralizada as√≠ como una
informaci√≥n de estado en un √°rea de entrada DP indicada.
‚óè Para uso en esclavo DP
DP_RECV acepta los datos de salida transmitidos por el maestro DP en el √°rea de datos DP
indicada en la instrucci√≥n.
El √°rea de datos indicada para la toma de datos puede ser un √°rea PA, un √°rea de marcas o
un √°rea de bloques de datos.
Se se√±ala que la funci√≥n ha sido ejecutada sin errores cuando se haya podido transferir toda
el √°rea de entrada de datos DP del CP PROFIBUS.
Tenga en cuenta que la instrucci√≥n DP_RECV para el esclavo DP se tiene que llamar al menos
una vez correctamente en el programa de usuario si se han configurado datos de salida para
este esclavo DP. Observe lo dicho en el manual de producto.

7478

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para iniciar el maestro DP hay que anteponer una llamada de DP_SEND o DP_RECV en la
secuencia de llamada. Para esta primera llamada rige lo siguiente:
‚óè Si se utiliza DP_RECV para la inicializaci√≥n, los datos recibidos no se aplicar√°n. Los datos
de usuario recibidos no se obtienen hasta la segunda llamada del bloque.

Tarea adicional: Entrar byte de estado
La instrucci√≥n DP_RECV tiene la siguiente tarea adicional:
‚óè Actualizar el byte de estado DPSTATUS. DP_RECV asume con esto tareas para el
diagn√≥stico DP.
Si no se han configurado datos de recepci√≥n, para la actualizaci√≥n del byte de estado
DPSTATUS se tiene que llamar DP_RECV con la longitud 1 (esto es v√°lido solo para el
maestro DP).
Observe tambi√©n lo dicho en el manual de producto.
‚óè Habilitaci√≥n de la lista de estaciones (v√©ase DP_DIAG (P√°gina 7484)).

Interfaz de llamada
DP_RECV
WORD

CPLADDR

ANY

RECV

NDR

BOOL

ERROR

BOOL

STATUS

WORD

DPSTATUS

BYTE

Consulte tambi√©n
Par√°metros en el caso de DP_RECV (P√°gina 7480)
Par√°metros NDR, ERROR, STATUS (P√°gina 7481)
Par√°metro DPSTATUS - DP_RECV (P√°gina 7482)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7479

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de DP_RECV
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la instrucci√≥n
DP_RECV:
Par√°metro

Declaraci√≥n Tipo de datos

CPLADDR

INPUT

Rango de valo‚Äê
res

WORD

Descripci√≥n
Direcci√≥n inicial del m√≥dulo
Al configurar el CP aparece la direcci√≥n inicial de m√≥dulo
en la tabla de configuraci√≥n. Indique aqu√≠ esta direcci√≥n.

RECV

INPUT

ANY

Indicar la direcci√≥n y la longitud

(como VARTY‚Äê
PE solo se admi‚Äê
te:

La direcci√≥n del √°rea de datos DP remite como alterna‚Äê
tiva a:

para DP_RECV
a partir de V3:
BYTE

‚óè √Årea de marcas

‚óè √Årea PA
‚óè √Årea de bloques de datos
Se tiene que ajustar la longitud para:

para DP_RECV
hasta V2.x:
BYTE, WORD y
DWORD)

‚óè Maestro DP: 1...2160
‚óè Esclavo DP: 1...240
‚óè Maestro DP; solo leer byte de estado: 1
(v√©ase tambi√©n el manual de producto del CP)

NDR

OUTPUT

BOOL

0: 1: nuevos datos
aceptados

El par√°metro de estado indica si se han adoptado
nuevos datos.
Consulte el significado en relaci√≥n con los par√°metros
ERROR y STATUS en Par√°metros NDR, ERROR, STA‚Äê
TUS (P√°gina 7481).

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicador de error
Consulte el significado en relaci√≥n con los par√°metros
NDR y STATUS en Par√°metros NDR, ERROR, STATUS
(P√°gina 7481)

STATUS

OUTPUT

WORD

Indicador de estado
Consulte el significado en relaci√≥n con los par√°metros
NDR y ERROR en Par√°metros NDR, ERROR, STATUS
(P√°gina 7481)

DPSTATUS

OUTPUT

Byte

Ve√°se la codifi‚Äê
caci√≥n a conti‚Äê
nuaci√≥n, en
DPSTATUS

Indicador de estado DP

Consulte tambi√©n
DP_RECV (P√°gina 7478)

7480

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros NDR, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por los par√°metros
NDR, ERROR y STATUS, que tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

NDR

ERROR

STATUS

Significado

0

0

8180H

‚óè Arranque:
El servicio DP se ha iniciado, pero todav√≠a no es posible aplicar los datos.
‚óè Funcionamiento normal
Se transfieren datos.
‚óè El DP no se ha iniciado debido a la situaci√≥n siguiente:

1

0

0000H

‚Äì

CP STOP o

‚Äì

"no hay parametrizaci√≥n" (aparece aqu√≠ en lugar del indicador 0,1,8183H).

Nuevos datos aceptados sin error.

0

1

8183H

Falta la configuraci√≥n o no se ha iniciado a√∫n el servicio DP en el CP PROFIBUS.

0

1

8184H

Error del sistema o tipo de par√°metro no permitido.

0

1

8F22H

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

0

1

8F23H

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

1

8F24H

Error de √°rea al leer un par√°metro.

0

1

8F25H

Error de √°rea al escribir un par√°metro.

0

1

8F28H

Error de alineaci√≥n al leer un par√°metro.

0

1

8F29H

Error de alineaci√≥n al escribir un par√°metro.

0

1

8F30H

El par√°metro est√° en el 1er. bloque de datos act. protegido de escritura.

0

1

8F31H

El par√°metro est√° en el segundo bloque de datos act. protegido de escritura.

0

1

8F32H

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

Error de n√∫mero de DB.

0

1

8F3AH

√Årea de destino no cargada (DB).

0

1

8F42H

Retardo en acuse al leer un par√°metro del √°rea de periferia.

0

1

8F43H

Retardo en acuse al escribir un par√°metro en el √°rea de periferia.

0

1

8F44H

La direcci√≥n del par√°metro a leer est√° inhibida en la pista de acceso.

0

1

8F45H

La direcci√≥n del par√°metro que debe escribirse est√° bloqueada en la pista de acceso.

0

1

8F7FH

Error interno, p. ej. referencia ANY no admisible.

0

1

8090H

No existe m√≥dulo con esta direcci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7481

Instrucciones
4.2 Instrucciones
NDR

ERROR

STATUS

Significado

0

1

8091H

La direcci√≥n base l√≥gica no est√° en formato de palabra doble.

0

1

80A0H

Acuse negativo al leer del m√≥dulo.

0

1

80B0H

El m√≥dulo no conoce el registro.

0

1

80B1H

La cantidad de datos a enviar supera el l√≠mite superior admisible para este servicio (v√°lido
para los modos maestro DP y esclavo DP).

0

1

80C0H

No se puede leer el registro.

0

1

80C1H

El registro indicado est√° siendo procesado.

0

1

80C2H

Hay demasiadas peticiones pendientes.

0

1

80C3H

Medio de servicio (memoria) ocupado.

0

1

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conveniente una repeti‚Äê
ci√≥n en el programa de usuario).

0

1

80D2H

Direcci√≥n base l√≥gica incorrecta.

Consulte tambi√©n
DP_RECV (P√°gina 7478)

Par√°metro DPSTATUS - DP_RECV
DPSTATUS
La codificaci√≥n del par√°metro de salida DP-STATUS es diferente para los modos maestro DP
y esclavo DP.

Modo maestro DP
7 6 5 4 3 2 1 0
0

Tabla 4-452 Significado de los bits en el DPSTATUS en el modo de maestro DP
Bit

Significado

7

libre

6

Este bit no se pone.
Observe tambi√©n lo dicho en el manual del equipo.

5,4

Valores para DPSTATUS del maestro DP:
00 RUN
01 CLEAR
10 STOP (se representa en el estado operativo OFFLINE)
11 OFFLINE
Observe tambi√©n lo dicho en el manual del equipo.

3

Valor 1: la sincronizaci√≥n horaria est√° conectada

2

Valor 0: no hay nuevos datos de diagn√≥stico
Valor 1: es conveniente evaluar la lista de diagn√≥stico; al menos una estaci√≥n tiene datos de diagn√≥stico nuevos

7482

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Bit

Significado

1

Valor 0: todos los esclavos DP est√°n en la fase de transferencia de datos
Valor 1: es conveniente evaluar la lista de estaciones

0

Modo DP
Valor 0: Modo de maestro DP
Los dem√°s bits s√≥lo son v√°lidos con el significado indicado si no est√° puesto este bit.

Modo esclavo DP
7 6 5 4 3 2 1 0
1

Tabla 4-453 Significado de los bits en el DPSTATUS en el modo de esclavo DP
Bit

Significado

7-5

libre

4

Este bit no se pone.
Observe tambi√©n lo dicho en el manual del equipo.

3

Este bit no se pone.
Observe tambi√©n lo dicho en el manual del equipo.

2

Valor 1: El maestro DP 1 se encuentra en el estado CLEAR. El esclavo DP recibe en los datos DP destinados a las
salidas para todos los datos el valor 0. No hay ninguna influencia sobre los datos de emisi√≥n.

1

Valor 1: la configuraci√≥n / parametrizaci√≥n a√∫n no ha terminado con √©xito.

0

Valor 1: modo de esclavo DP.
Los dem√°s bits s√≥lo son v√°lidos con el significado indicado si est√° puesto este bit.

Nota
Tenga en cuenta que s√≥lo se debe evaluar DPSTATUS una vez est√© puesto el par√°metro de
retorno NDR=1.

Consulte tambi√©n
DP_RECV (P√°gina 7478)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7483

Instrucciones
4.2 Instrucciones

DP_DIAG
DP_DIAG
Descripci√≥n
La instrucci√≥n DP_DIAG se utiliza para solicitar informaciones de diagn√≥stico. Se distinguen
los siguientes tipos de peticiones:
‚óè Solicitar lista de estaciones DP;
‚óè Solicitar lista de diagn√≥stico DP;
‚óè Solicitar estado individual DP;
‚óè Leer ac√≠clicamente datos de entrada / salida de un esclavo DP;
‚óè Leer diagn√≥stico individual DP menos reciente;
‚óè Leer el estado operativo de DP.
‚óè Leer el estado operativo de DP para AG-/CP-STOP;
‚óè Leer el estado actual del esclavo DP.
Se pueden solicitar datos de diagn√≥stico indicando una direcci√≥n de estaci√≥n espec√≠fica del
esclavo.
Para la transferencia de los datos de diagn√≥stico a la CPU se tiene que prever en la CPU un
√°rea de memoria que se indicar√° al hacer la llamada. Esta √°rea de memoria puede ser un √°rea
de bloques de datos o un √°rea de marcas. En la petici√≥n se tiene que indicar la longitud m√°xima
del √°rea de memoria disponible.
Nota
La instrucci√≥n DP_DIAG solo es √∫til para el modo operativo de DP con maestro DP.

Exclusi√≥n
Mientras est√© en marcha la instrucci√≥n, no se debe abastecer la misma con nuevos datos de
petici√≥n.
Excepci√≥n: solicitar lista de estaciones DP o lista de diagn√≥stico DP.

7484

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Interfaz de llamada
DP_DIAG
WORD

CPLADDR

BYTE

NDR

BOOL

DTYPE

ERROR

BOOL

BYTE

STATION

STATUS

WORD

ANY

DIAG

DIAGLNG

BYTE

Consulte tambi√©n
Par√°metros en el caso de DP_DIAG (P√°gina 7486)
Tipos de petici√≥n de DP_DIAG (P√°gina 7487)
B√∫fer de anillo para datos de diagn√≥stico - DP_DIAG (P√°gina 7489)
Par√°metros NDR, ERROR, STATUS (P√°gina 7490)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7485

Instrucciones
4.2 Instrucciones

Par√°metros en el caso de DP_DIAG
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la instrucci√≥n
DP_DIAG:
Par√°metro

Declaraci√≥n Tipo de datos

CPLADDR

INPUT

Rango de valores

WORD

Descripci√≥n
Direcci√≥n inicial del m√≥dulo
Al configurar el CP aparece la direcci√≥n inicial de
m√≥dulo en la tabla de configuraci√≥n. Indique aqu√≠
esta direcci√≥n.

DTYPE

INPUT

BYTE

Tipo de diagn√≥stico
0: Lista de estaciones
1: Lista de diagn√≥stico
2: Diagn√≥stico actual
3: Diagn√≥stico antiguo
4: Leer estado operativo
5: Leer estado operati‚Äê
vo para
CPU-STOP
6: Leer estado operati‚Äê
vo para
CP-STOP
7: Leer datos de entrada
(ac√≠clicamente)
8: Leer datos de salida
(ac√≠clicamente)
10: Leer el estado ac‚Äê
tual
del esclavo DP

STATION

INPUT

BYTE

Direcci√≥n de estaci√≥n del esclavo DP

DIAG

INPUT

Se tiene que ajustar la
ANY
longitud 1...240
(como
VARTYPE so‚Äê
lo se admite:

Indicar la direcci√≥n y la longitud

BYTE, WORD
y DWORD)

NDR

OUTPUT

BOOL

Direcci√≥n del √°rea de datos. Remite como alterna‚Äê
tiva a:
‚óè √Årea PA
‚óè √Årea de marcas
‚óè √Årea de bloques de datos

0: 1: nuevos datos

Este par√°metro de estado se√±aliza si se han acep‚Äê
tado nuevos datos.
Consulte el significado en relaci√≥n con los par√°me‚Äê
tros ERROR y STATUS en Par√°metros NDR,
ERROR, STATUS (P√°gina 7490)

ERROR

7486

OUTPUT

BOOL

0: 1: caso de error

Indicador de error
Consulte el significado en relaci√≥n con los par√°me‚Äê
tros NDR y STATUS en Par√°metros NDR, ERROR,
STATUS (P√°gina 7490)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n Tipo de datos

Rango de valores

Descripci√≥n

STATUS

OUTPUT

v√©ase la lista

Indicador de estado

WORD

Consulte el significado en relaci√≥n con los par√°me‚Äê
tros NDR y ERROR en Par√°metros NDR, ERROR,
STATUS (P√°gina 7490)
DIAGLNG

OUTPUT

BYTE

v√©ase la lista

Contiene la longitud real (en byte) de los datos pro‚Äê
porcionados por el CP PROFIBUS, con indepen‚Äê
dencia del tama√±o de b√∫fer indicado en el par√°me‚Äê
tro DIAG.
Para los tipos de petici√≥n con DTYPE 4, 5 y 6 rige:
A DIAGLNG aqu√≠ siempre se le asigna el valor "1".
En estos casos el valor depositado en el par√°metro
DIAG no es relevante para la valoraci√≥n. El valor
relevante est√° contenido en el par√°metro STATUS.

Consulte tambi√©n
DP_DIAG (P√°gina 7484)

Tipos de petici√≥n de DP_DIAG
Tipos de petici√≥n
Las formas de petici√≥n admisibles y convenientes resultan, seg√∫n la relaci√≥n siguiente, de lo
indicado para DTYPE, STATION y DIAGLNG.
Tabla 4-454 Tipos de petici√≥n para DP_DIAG
DTYPE

Equivale a
Petici√≥n

Par√°metro

DIAGLNG

0

Leer lista de es‚Äê
taciones DP.

---

- no se tiene en
cuenta -

Con la lista de estaciones DP se obtiene informaci√≥n en el
programa de usuario sobre el estado y la disponibilidad de
esclavos DP. La informaci√≥n contenida en la lista de esta‚Äê
ciones DP se refiere a todos los esclavos DP asignados al
maestro DP por configuraci√≥n.

1

Leer lista de
diagn√≥stico DP

---

- no se tiene en
cuenta -

Con la lista de diagn√≥stico DP se obtiene en el programa de
la CPU la informaci√≥n sobre en qu√© esclavos DP hay nuevos
datos de diagn√≥stico.

2

Leer diagn√≥stico 1...126
individual DP ac‚Äê
tual

>=6

Con el diagn√≥stico individual DP actual se obtienen en el
programa de la CPU los datos de diagn√≥stico actuales de un
esclavo DP.

STATION

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

C√≥digo de confirmaci√≥n
(contenido en el par√°metro STATUS; indicado en la tabla
"C√≥digos de condici√≥n DP_DIAG")

7487

Instrucciones
4.2 Instrucciones
DTYPE

3

Equivale a
Petici√≥n

Par√°metro

DIAGLNG

STATION

Leer diagn√≥stico 1...126
individual DP
menos reciente

C√≥digo de confirmaci√≥n
(contenido en el par√°metro STATUS; indicado en la tabla
"C√≥digos de condici√≥n DP_DIAG")

>=6

Con el diagn√≥stico individual DP menos reciente se obtienen
en el programa de la CPU los datos de diagn√≥stico menos
recientes de un esclavo DP. Estos datos est√°n almacenados
en el CP PROFIBUS y se leen en el b√∫fer de anillo seg√∫n el
principio "Last in first out".
V√©ase m√°s abajo la explicaci√≥n relativa al b√∫fer de anillo.
En caso de cambios r√°pidos en los datos de diagn√≥stico de
esclavos DP se pueden registrar as√≠ estos esclavos DP para
ser evaluados en el programa de la CPU del maestro DP.

4

Leer el estado
operativo solici‚Äê
tado con la peti‚Äê
ci√≥n DP-CTRL
(CTYPE=4)

=1

Con esta petici√≥n se puede leer el estado operativo del DP,
ajustado previamente con la petici√≥n DP-CTRL (CTYPE=4).
Observaci√≥n: El estado operativo le√≠do no tiene que coincidir
necesariamente con el estado operativo actual del CP.
Los siguientes estados operativos son posibles:
‚óè RUN
‚óè CLEAR
‚óè STOP (se representa en el estado operativo OFFLINE) *)
‚óè OFFLINE

5

Leer el estado
operativo de DP
para CPU-STOP

=1

Con esta petici√≥n se determina a qu√© estado operativo DP
pasa el CP PROFIBUS en caso de CPU-STOP:
‚óè RUN
‚óè CLEAR
‚óè STOP (se representa en el estado operativo OFFLINE) *)
‚óè OFFLINE
Como valor predeterminado (DEFAULT) con CPU-STOP, el
CP PROFIBUS pasa al estado operativo de DP CLEAR.

6

Leer el estado
operativo de DP
para CP-STOP

=1

Con esta petici√≥n se determina a qu√© estado operativo DP
pasa el CP PROFIBUS en caso de CP-STOP:
‚óè STOP (se representa en el estado operativo OFFLINE) *)
‚óè OFFLINE
Como valor predeterminado (DEFAULT) con CP-STOP, el
CP PROFIBUS pasa al estado operativo de DP OFFLINE.

7

7488

Leer datos de
entrada

1...126

>=1

Con esta petici√≥n se leen, como maestro DP (clase 2), los
datos de entrada de un esclavo DP. Este proceso recibe
tambi√©n el nombre de "Shared Input".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DTYPE

Equivale a
Petici√≥n

Par√°metro

DIAGLNG

8

Leer datos de
salida

1...126

>=1

Con esta petici√≥n se leen, como maestro DP (clase 2), los
datos de salida de un esclavo DP. Este proceso recibe tam‚Äê
bi√©n el nombre de "Shared Output".

10

Leer el estado
actual del escla‚Äê
vo DP

1...126

>=0

Con esta petici√≥n se lee el estado operativo actual del escla‚Äê
vo DP. Son posibles los siguientes estados:

STATION

C√≥digo de confirmaci√≥n
(contenido en el par√°metro STATUS; indicado en la tabla
"C√≥digos de condici√≥n DP_DIAG")

‚óè El maestro DP intercambia c√≠clicamente datos con el
esclavo DP.
‚óè El maestro DP lee c√≠clicamente los datos de entrada del
esclavo DP.
‚óè El maestro DP lee c√≠clicamente los datos de salida del
esclavo DP.
‚óè El maestro DP no procesa c√≠clicamente este esclavo DP
de momento.

*)

El estado operativo STOP ya no es soportado en los m√≥dulos actuales (a partir del tipo de m√≥dulo DA02).

Consulte tambi√©n
DP_DIAG (P√°gina 7484)

B√∫fer de anillo para datos de diagn√≥stico - DP_DIAG
B√∫fer de anillo para datos de diagn√≥stico
La representaci√≥n siguiente muestra el principio de lectura para el tipo de petici√≥n "Leer
diagn√≥stico individual DP menos reciente". Con el primer acceso de lectura se lee
el diagn√≥stico antiguo m√°s reciente.

Diagn√≥stico actual
1er .diagn√≥stico antiguo

9¬∫ acceso lectura;
1er. acceso lectura; 10¬∫ acceso lectura

8¬∫ diagn√≥stico antiguo

8¬∫ acceso lectura;

Figura 4-79

B√∫fer de anillo para datos de diagn√≥stico

Al leer un diagn√≥stico actual, el puntero de lectura se repone al primer diagn√≥stico antiguo.

Consulte tambi√©n
DP_DIAG (P√°gina 7484)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7489

Instrucciones
4.2 Instrucciones

Par√°metros NDR, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por los par√°metros
NDR, ERROR y STATUS, que tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

Tabla 4-455 C√≥digos de condici√≥n DP_DIAG
NDR

ERROR

STATUS

Posible
para
DTYPE

Significado

0

0

8181H

2-10

Petici√≥n en curso.
El maestro DP no se ha iniciado por:
‚óè CP STOP o
‚óè no hay parametrizaci√≥n
(aparece aqu√≠ en lugar del c√≥digo de condici√≥n 0,1,8183H).

0

0

8182H

0

Activaci√≥n no conveniente.
El maestro DP no se ha iniciado por:
‚óè CP STOP o
‚óè no hay parametrizaci√≥n
(aparece aqu√≠ en lugar del c√≥digo de condici√≥n 0,1,8183H).

0

0

8182H

1

No hay ning√∫n diagn√≥stico nuevo.
El maestro DP no se ha iniciado por:
‚óè CP STOP o
‚óè no hay parametrizaci√≥n
(aparece aqu√≠ en lugar del c√≥digo de condici√≥n 0,1,8183H).

1

0

0000H

0, 1

Petici√≥n concluida sin errores.

y 4-9

Nota:
En el caso de DTYPE 2,3 y 10, la ejecuci√≥n sin errores se se√±aliza con un c√≥digo
de estado distinto de "0". En correspondencia, a continuaci√≥n encontrar√° c√≥di‚Äê
gos de estado detallados (para una ejecuci√≥n sin errores) para el √°rea:
82XXH
En caso de ejecuci√≥n con errores, obtendr√° c√≥digos de estado en las siguientes
√°reas:
80XXH, 83XXH, 8FXXH

7490

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
NDR

ERROR

STATUS

Posible
para
DTYPE

Significado

1

0

8222H

7,8

Petici√≥n terminada sin errores.
La longitud de datos de esclavo DP le√≠dos es distinta de la longitud de datos que
el maestro DP espera sobre la base de la lista de m√≥dulos del esclavo DP en la
base de datos del CP.

1

0

8227H

7,8

Petici√≥n terminada sin errores.
Advertencia: no hay datos.

1

0

8231H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "RUN"

1

0

8232H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "CLEAR"

1

0

8233H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "STOP"
El estado STOP se representa en el estado OFFLINE (aqu√≠, c√≥digo de condici√≥n
8234H).
Observe tambi√©n lo dicho en el manual de producto.

1

0

8234H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es
"OFFLINE"

1

0

823AH

2,3,7,8

Petici√≥n terminada sin errores.
Advertencia: se han le√≠do 241 o 242 bytes de datos. Se proporcionan 240 bytes.

1

0

8241H

2,3,10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP indicado no se ha configurado.

1

0

8243H

2,3,10

Petici√≥n terminada sin errores.
Advertencia: la lista de m√≥dulos del esclavo CP en la base de datos del CP solo
contiene m√≥dulos vac√≠os.

1

0

8245H

2,3,10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP se encuentra en el estado "Leer c√≠clicamente datos
de entrada".

1

0

8246H

2,3,10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP se encuentra en el estado
"Leer c√≠clicamente datos de salida".

1

0

8248H

2,3,10

Petici√≥n concluida sin errores.
Observaci√≥n: esta es la indicaci√≥n predeterminada para los tipos de diagn√≥stico
mencionados, si no existe ninguna peculiaridad a se√±alizar.

1

0

8249H

2,3,10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP est√° desactivado debido a un cambio del estado
operativo de DP (p. ej. interruptor del CP en STOP).

1

0

824AH

2,3,10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP est√° desactivado debido a una petici√≥n de DP_CTRL
en el programa de la CPU.

0

1

8090H

0-10

La direcci√≥n base l√≥gica del m√≥dulo no es v√°lida

0

1

80B0H

0-10

El m√≥dulo no conoce el registro o se encuentra en la transici√≥n RUN --> STOP.

0

1

80B1H

0-10

La longitud de registro indicada es incorrecta

0

1

80C0H

0-10

No se puede leer el registro

0

1

80C1H

0-10

El registro indicado est√° siendo procesado.

0

1

80C2H

0-10

Hay demasiadas peticiones pendientes.

0

1

80C3H

0-8

Medios de operaci√≥n (memoria) ocupados

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7491

Instrucciones
4.2 Instrucciones
NDR

ERROR

STATUS

Posible
para
DTYPE

Significado

0

1

80C4H

0-10

Error de comunicaci√≥n

0

1

80D2H

0-10

Direcci√≥n base l√≥gica incorrecta

0

1

8183H

0-10

Maestro DP no configurado.

0

1

8184H

0-8

Error del sistema o tipo de par√°metro no permitido.

0

1

8311H

>=2

Par√°metro DTYPE fuera del rango de valores.

0

1

8313H

2,3,7,8,10

Par√°metro STATION fuera del rango de valores.

0

1

8321H

>=2

El esclavo DP no proporciona datos v√°lidos.

0

1

8326H

7,8

El esclavo DP proporciona m√°s de 242 bytes de datos. El CP PROFIBUS solo
da soporte a 242 bytes como m√°ximo.

0

1

8335H

7,8

El CP PROFIBUS se encuentra en el estado PROFIBUS: "Estaci√≥n no en el
anillo".

0

1

8341H

2,3,7,8,10

El esclavo indicado no se ha configurado.

0

1

8342H

7,8

No se puede acceder al esclavo DP con la direcci√≥n PROFIBUS indicada en el
par√°metro STATION.

0

1

8349H

7,8

El maestro DP se encuentra en el estado OFFLINE.

0

1

8F22H

0-10

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

0

1

8F23H

0-10

Error de longitud de √°rea al escribir un par√°metro (p. ej. DB demasiado corto).

0

1

8F24H

0-10

Error de √°rea al leer un par√°metro

0

1

8F25H

0-10

Error de √°rea al escribir un par√°metro

0

1

8F28H

0-10

Error de alineaci√≥n al leer un par√°metro

0

1

8F29H

0-10

Error de alineaci√≥n al escribir un par√°metro

0

1

8F30H

0-10

El par√°metro est√° en el 1er. bloque de datos act. protegido de escritura.

0

1

8F31H

0-10

El par√°metro est√° en el segundo bloque de datos act. protegido de escritura.

0

1

8F32H

0-10

El par√°metro contiene n√∫mero de DB demasiado grande

0

1

8F33H

0-10

Error de n√∫mero de DB

0

1

8F3AH

0-10

√Årea de destino no cargada (DB)

0

1

8F42H

0-10

Retardo de acuse al leer un par√°metro del √°rea de periferia

0

1

8F43H

0-10

Retardo de acuse al escribir un par√°metro en el √°rea de periferia

0

1

8F44H

0-10

La direcci√≥n del par√°metro a leer est√° inhibida en la pista de acceso.

0

1

8F45H

0-10

La direcci√≥n del par√°metro a escribir est√° inhibida en la pista de acceso.

0

1

8F7FH

0-10

Error interno, p. ej. referencia ANY no admisible.

Consulte tambi√©n
DP_DIAG (P√°gina 7484)

7492

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

DP_CTRL
DP_CTRL
Descripci√≥n
La instrucci√≥n DP_CTRL transfiere peticiones de control al CP PROFIBUS. Con la indicaci√≥n
de un bloque de petici√≥n (par√°metro CONTROL) se especifica con mayor detalle la petici√≥n de
control.
Se distinguen los siguientes tipos de peticiones:
‚óè Global Control ac√≠clico / c√≠clico;
‚óè Borrar diagn√≥sticos antiguos;
‚óè Poner el estado operativo actual de DP;
‚óè Poner el estado operativo de DP para AG-/CP-STOP;
‚óè Leer c√≠clicamente datos de entrada/salida;
‚óè Poner el modo de procesamiento del esclavo DP
Existen restricciones en cuanto a los tipos de peticiones aqu√≠ citados (tenga en cuenta al
respecto lo dicho en el manual de producto).
Nota
La instrucci√≥n DP_CTRL solo es √∫til para el modo operativo de DP con maestro DP.

Conexi√≥n
Mientras est√© en marcha la instrucci√≥n, no se debe abastecer la misma con nuevos datos de
petici√≥n.

Interfaz de llamada
DP_CTRL
WORD

CPLADDR

DONE

BOOL

ANY

CONTROL

ERROR

BOOL

STATUS

WORD

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7493

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Par√°metros en el caso de DP_CTRL (P√°gina 7494)
Tipos de petici√≥n de DP_CTRL (P√°gina 7496)
Command Mode y Group Select - DP_CTRL (P√°gina 7499)
Par√°metros DONE, ERROR, STATUS (P√°gina 7500)

Par√°metros en el caso de DP_CTRL
Explicaci√≥n de los par√°metros formales
La tabla representada a continuaci√≥n explica todos los par√°metros formales para la instrucci√≥n
DP_CTRL:
Par√°metro

Declaraci√≥n

Tipo de datos

CPLADDR

INPUT

WORD

Rango de valores

Descripci√≥n
Direcci√≥n inicial del m√≥dulo
Al configurar el CP aparece la direcci√≥n inicial de m√≥dulo
en la tabla de configuraci√≥n. Indique aqu√≠ esta direcci√≥n.

CONTROL

INPUT

ANY
Se tiene que ajus‚Äê
(como VARTY‚Äê tar la longitud
PE solo se ad‚Äê 1...240
mite:

Indicar la direcci√≥n y la longitud del bloque de petici√≥n
CONTROL

BYTE, WORD
y DWORD)

‚óè √Årea de marcas

Direcci√≥n del √°rea de datos. Remite como alternativa a:
‚óè √Årea PA
‚óè √Årea de bloques de datos
La longitud tiene que ser al menos tan grande como la
cantidad de par√°metros.

DONE

OUTPUT

BOOL

0: 1: Petici√≥n ejecu‚Äê
tada sin error

Indica si la petici√≥n se ha enviado y se ha concluido sin
errores.
Consulte el significado en relaci√≥n con los par√°metros
ERROR y STATUS en Par√°metros DONE, ERROR,
STATUS (P√°gina 7500)

ERROR

OUTPUT

BOOL

0: 1: caso de error

Indicador de error
Consulte el significado en relaci√≥n con los par√°metros
DONE y STATUS en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7500)

STATUS

OUTPUT

WORD

V√©ase la tabla si‚Äê
guiente 'Indicado‚Äê
res'

Indicador de estado
Consulte el significado en relaci√≥n con los par√°metros
DONE y ERROR en Par√°metros DONE, ERROR, STA‚Äê
TUS (P√°gina 7500)

7494

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Estructura del bloque de petici√≥n CONTROL
La petici√≥n de control tiene la siguiente estructura:

Direcci√≥n de
CONTROL

CTYPE
Par√°metro 1er. Byte

ver ‚ÄôPar√°metros‚Äô
(cantidad y nombre)

Par√°metro segundo Byte

Par√°metro en√©simo Byte

Ejemplo del bloque de petici√≥n
Con un bloque de petici√≥n conforme al modelo abajo mostrado se emite una petici√≥n c√≠clica de
Global Control SYNC y UNFREEZE para los grupos 4 y 5 sin la opci√≥n Autoclear.

DB 14
Byte 0

01H

CTYPE

Byte 1

24H

Command Mode

Byte 2

18H

Group Select

Byte 3

00H

Autoclear

La longitud indicada en el puntero ANY ha de ser al menos 4 (para el ejemplo de petici√≥n se
han seleccionado 30).

Consulte tambi√©n
DP_CTRL (P√°gina 7493)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7495

Instrucciones
4.2 Instrucciones

Tipos de petici√≥n de DP_CTRL
Tipos de petici√≥n
Las formas de petici√≥n admisibles y convenientes resultan, seg√∫n la relaci√≥n siguiente, de lo
indicado para CTYPE as√≠ como de lo indicado en el bloque de petici√≥n.
CTYPE

Equivale a Petici√≥n Par√°metros en el bloque de peti‚Äê Descripci√≥n
ci√≥n

Nombre

N√∫mero

0

Impulsar Global
Control

1. byte:
Command Mode
2¬∫ byte:
Group Select
(ver a continuaci√≥n
de esta tabla)

2

Se env√≠a una √∫nica petici√≥n de Global Control a los es‚Äê
clavos DP seleccionados con Group Select. En el par√°‚Äê
metro Command Mode se determinan las siguientes pe‚Äê
ticiones de Global Control:
‚óè SYNC
‚óè UNSYNC
‚óè FREEZE
‚óè UNFREEZE
‚óè CLEAR no es compatible (observe tambi√©n lo dicho
en el manual de producto).
Es posible indicar m√°s de una petici√≥n en el par√°metro
Command Mode.

7496

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
CTYPE

Equivale a Petici√≥n Par√°metros en el bloque de peti‚Äê Descripci√≥n
ci√≥n

1*)

Impulsar c√≠clica‚Äê
1. byte:
mente Global Con‚Äê Command Mode
trol
2¬∫ byte:
Group Select
3er. byte:
Autoclear

3

El impulso se da al CP PROFIBUS que env√≠a estas pe‚Äê
ticiones c√≠clicas de Global Control a los esclavos DP
seleccionados con Group Select.
El par√°metro Autoclear solo se eval√∫a en el caso de la
petici√≥n de Global Control SYNC. Si al menos un escla‚Äê
vo DP del grupo seleccionado no est√° en la fase de
transferencia de datos, en caso de Autoclear = 1 se co‚Äê
necta adicionalmente el modo CLEAR, lo que significa
que los datos de salida de los esclavos DP se ponen a
"0".

(ver a
continuaci√≥n de esta
tabla)

En el par√°metro Command Mode se pueden conectar
las siguientes peticiones de Global Control:
‚óè SYNC
‚óè FREEZE
‚óè CLEAR (CLEAR-Bit = 1) no es compatible (observe
tambi√©n lo dicho en el manual de producto).
o se puede desconectar:
‚óè UNSYNC
‚óè UNFREEZE
‚óè UNCLEAR (CLEAR-Bit = 0)
Es posible indicar m√°s de una petici√≥n en el par√°metro
Command Mode.
Para terminar una petici√≥n c√≠clica en curso de Global
Control, se tiene que ejecutar una nueva petici√≥n de
Global Control (c√≠clica o ac√≠clica).
Para terminar la petici√≥n ajustada en el Command Mo‚Äê
de, se tiene que desconectar la petici√≥n
correspondiente. Por ejemplo, la petici√≥n SYNC se des‚Äê
conecta con una petici√≥n UNSYNC.
3

Borrar diagn√≥stico
individual DP me‚Äê
nos reciente

1. byte:
Direcci√≥n escl.
1..126
127 = todos los escla‚Äê
vos

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

1

Se borran para uno o todos los esclavos los diagn√≥sticos
individuales DP m√°s antiguos almacenados en el CP
PROFIBUS.

7497

Instrucciones
4.2 Instrucciones
CTYPE

Equivale a Petici√≥n Par√°metros en el bloque de peti‚Äê Descripci√≥n
ci√≥n

4

Poner el estado
operativo actual de
DP

1. byte:

1

RUN = 00H
CLEAR = 01H
OFFLINE = 03H
RUN con AUTO‚Äê
CLEAR = 04H
RUN sin AUTO‚Äê
CLEAR = 04H

Con esta petici√≥n se puede poner el estado operativo de
DP del siguiente modo:
‚óè RUN
‚óè CLEAR
‚óè OFFLINE
El par√°metro AUTOCLEAR significa que el maestro DP
clase 1 pasa autom√°ticamente al estado operativo
CLEAR si se cumple la siguiente condici√≥n: al menos
uno de los esclavos DP con los que intercambia datos el
maestro DP clase 1 no est√° en el estado de transferen‚Äê
cia de datos.
Con el par√°metro RUN sin AUTOCLEAR se suprime
AUTOCLEAR.
Notas:
El estado operativo STOP = 02H ya no es soportado en
los m√≥dulos actuales (a partir del tipo de m√≥dulo DA02).
Una indicaci√≥n STOP = 02H se refleja en el estado ope‚Äê
rativo OFFLINE.

5

Ajustar el estado
operativo DP para
STOP de la CPU

1. byte:

1

RUN = 00H
CLEAR = 01H
OFFLINE = 03H

Con esta petici√≥n se establece a qu√© estado operativo
DP pasa el CP PROFIBUS en caso de CPU-STOP:
‚óè RUN
‚óè CLEAR
‚óè OFFLINE
Como valor predeterminado (DEFAULT) con CPUSTOP, el CP PROFIBUS pasa al estado operativo de
DP CLEAR.
El estado operativo puesto se conserva en caso de un
cambio de estado del CP de RUN --> STOP --> RUN.
Notas:
El estado operativo STOP = 02H ya no es soportado en
los m√≥dulos actuales (a partir del tipo de m√≥dulo DA02).
Una indicaci√≥n STOP = 02H se refleja en el estado ope‚Äê
rativo OFFLINE.

6

Ajustar el estado
operativo DP para
STOP del CP

1. byte:
OFFLINE=03H

1

Con esta petici√≥n se establece a qu√© estado operativo
DP pasa el CP PROFIBUS en caso de CP-STOP:
‚óè OFFLINE
Como valor predeterminado (DEFAULT) con CP-STOP,
el CP PROFIBUS pasa al estado operativo de DP OF‚Äê
FLINE.
El estado operativo puesto se conserva en caso de un
cambio de estado del CP de RUN --> STOP --> RUN.
Notas:
El estado operativo STOP = 02H ya no es soportado en
los m√≥dulos actuales (a partir del tipo de m√≥dulo DA02).
Una indicaci√≥n STOP = 02H se refleja en el estado ope‚Äê
rativo OFFLINE.

7498

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
CTYPE

Equivale a Petici√≥n Par√°metros en el bloque de peti‚Äê Descripci√≥n
ci√≥n

7 *)

Lectura c√≠clica de 1. byte:
los datos de entra‚Äê direcci√≥n de esclavo
da (maestro DP
1..125
clase 2)

1

1. byte:
direcci√≥n de esclavo
1..125

1

Terminar el proce‚Äê 1. byte:
direcci√≥n de esclavo
samiento c√≠clico
del esclavo DP por 1..125
el maestro DP (cla‚Äê
se 1 /clase 2)

1

Iniciar el procesa‚Äê
miento c√≠clico co‚Äê
mo maestro DP
(clase 1)

1

8 *)

9

Lectura c√≠clica de
los datos de salida
(maestro DP clase
2)

Esta petici√≥n no es compatible.
Observe tambi√©n las indicaciones del manual de pro‚Äê
ducto.
Esta petici√≥n no es compatible.
Observe tambi√©n las indicaciones del manual de pro‚Äê
ducto.
Con esta petici√≥n se termina la lectura c√≠clica de los da‚Äê
tos de entrada o los datos de salida del esclavo DP di‚Äê
reccionado o la transferencia de datos (maestro DP cla‚Äê
se 1).
Despu√©s de esto, el esclavo DP ya no es procesado por
el CP PROFIBUS como maestro DP (clase 2).
Esta operaci√≥n desactiva el esclavo DP.

10

*)

1. byte:
direcci√≥n de esclavo
1..125

El CP PROFIBUS que act√∫a como maestro DP (clase 1)
parametriza el esclavo DP seleccionado e inicia la trans‚Äê
ferencia de datos c√≠clica (escribir salidas / leer entradas).
Esta operaci√≥n activa el esclavo DP.

Este CTYPE ya no es soportado en los m√≥dulos actuales (a partir del tipo de m√≥dulo DA02).

Consulte tambi√©n
DP_CTRL (P√°gina 7493)

Command Mode y Group Select - DP_CTRL
Estructura de Command Mode
Para las peticiones de Global Control c√≠clicas y ac√≠clicas, indique en el par√°metro Command
Mode los modos de operaci√≥n para los datos de entrada y salida.
Al respecto significa:
1 = activado
0 = no activado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7499

Instrucciones
4.2 Instrucciones
N√∫mero de bit: 7 6 5 4 3 2 1 0

no utilizado
CLEAR
UNFREEZE
FREEZE
UNSYNC
SYNC
no utilizado

Estructura de Group Select
Con el par√°metro Group Select se define en qu√© grupo se debe aplicar la petici√≥n de control
indicada en Command Mode. Group Select ocupa el segundo byte de la petici√≥n de control.
Cada bit define un grupo de esclavos DP posible.
Al respecto significa:
1 = asignado
0 = no asignado

N√∫mero de bit:
Grupo:

7 6 5 4 3 2 1 0
8 7 6 5 4 3 2 1

Consulte tambi√©n
DP_CTRL (P√°gina 7493)

Par√°metros DONE, ERROR, STATUS
C√≥digos de condici√≥n
La tabla siguiente muestra el significado de la informaci√≥n suministrada por los par√°metros
DONE, ERROR y STATUS, la cual tiene que ser evaluada por el programa de usuario.
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho
sobre el par√°metro de salida RET_VAL en las descripciones de los bloques de programa del
sistema referenciados.
Puede consultar mediante STEP 7 los bloques de programa del sistema que se utilizan y los
que son relevantes para la evaluaci√≥n de errores.

7500

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tabla 4-456 Indicadores DP_CTRL
DONE

ERROR

STATUS

Posible para
CTYPE

Significado

0

0

8181H

0..10

Petici√≥n en curso.
El maestro DP no se ha iniciado por:
‚óè CP STOP o
‚óè "no hay parametrizaci√≥n"
Observaci√≥n:
La indicaci√≥n descrita aparece en lugar de una de las siguientes indicacio‚Äê
nes descritas a continuaci√≥n:
0,1,8183H
0,1, 8333 H
0,1, 8334H

1

0

0000H

0..10

Petici√≥n terminada sin errores.

1

0

8214H

0,1

Petici√≥n terminada sin errores.
Advertencia: la petici√≥n c√≠clica de Global Control se env√≠a como petici√≥n
ac√≠clica de Global Control

1

0

8215H

0,1

Petici√≥n terminada sin errores.
Todos los esclavos DP aludidos en el grupo seleccionado est√°n desacti‚Äê
vados.

1

0

8219H

0,1

Petici√≥n terminada sin errores.
Se ha intentado enviar de nuevo una petici√≥n c√≠clica de Global Control ya
en curso. Global Control sigue en marcha sin cambios.

1

0

8228H

0,1

Petici√≥n terminada sin errores.
Advertencia: los esclavos DP aludidos en los grupos seleccionados no po‚Äê
seen m√≥dulos de entrada.

1

0

8229H

0,1

Petici√≥n terminada sin errores.
Advertencia: los esclavos DP aludidos en los grupos seleccionados no po‚Äê
seen m√≥dulos de salida.

1

0

8231H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "RUN"

1

0

8232H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "CLEAR"

1

0

8233H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "STOP"

1

0

8234H

4,5,6

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "OFFLINE"

1

0

8235H

4

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "RUN" con AUTOCLEAR
conectado

1

0

8236H

4

Petici√≥n terminada sin errores.
Advertencia: el estado operativo de DP ya es "RUN" con AUTOCLEAR
desconectado

1

0

8241H

7-10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP indicado no se ha configurado.

1

0

8243H

7-10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP ya est√° desactivado, porque la lista de m√≥dulos
del esclavo DP en la base de datos del CP solo contiene m√≥dulos vac√≠os.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7501

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Posible para
CTYPE

Significado

1

0

8245H

7-10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP se encuentra ya en el estado "Leer c√≠clicamente
datos de entrada".

1

0

8246H

7-10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP se encuentra ya en el estado "Leer c√≠clicamente
datos de salida".

1

0

8248H

7-10

Petici√≥n terminada sin errores.
Advertencia: la lista de m√≥dulos del esclavo CP en la base de datos del CP
contiene m√≥dulos de entrada, de salida o de entrada/salida.

1

0

8249H

7-10

Petici√≥n terminada sin errores.
Advertencia: el esclavo est√° desactivado debido a un cambio del estado
operativo de DP.

1

0

824AH

7-10

Petici√≥n terminada sin errores.
Advertencia: el esclavo DP est√° ya desactivado debido a una petici√≥n de
DP_CTRL en el programa de la CPU.

0

1

8090H

0..10

No existe m√≥dulo con esta direcci√≥n.

0

1

8091H

0..10

La direcci√≥n l√≥gica no est√° en formato de palabra doble.

0

1

80B0H

0..10

El m√≥dulo no conoce el registro.

0

1

80B1H

0..10

La longitud de registro indicada es incorrecta.

0

1

80C0H

0..10

No se puede leer el registro.

0

1

80C1H

0..10

El registro indicado est√° siendo procesado.

0

1

80C2H

0..10

Hay demasiadas peticiones pendientes.

0

1

80C3H

0

1

8183H

Medio de servicio (memoria) ocupado.
0..10

Maestro DP no configurado...
Observaci√≥n:
Si el maestro DP se encuentra en el estado operativo "STOP", se puede
emitir tambi√©n el estado 8181 H.

0

1

8184H

0

1

8311H

Error del sistema o tipo de par√°metro no permitido...
0..10

Par√°metro CTYPE fuera del rango de valores.

0

1

8312H

0..10

La longitud del √°rea en el par√°metro CONTROL es demasiado peque√±a.

0

1

8313H

3,7,8,9, 10

Par√°metro Direcci√≥n de esclavo fuera del rango de valores.

0

1

8315H

0,1

Todos los esclavos DP del grupo indicado en Global Control est√°n desac‚Äê
tivados (se presenta siempre en caso de grupos vac√≠os).

0

1

8317H

8

La longitud de los datos de salda configurados es mayor que el √°rea de
recepci√≥n configurada del esclavo DP.

0

1

8318H

0,1,4,5,6

El par√°metro 1er. byte del bloque de datos de petici√≥n est√° fuera del rango
de valores. Para GLOBAL CONTROL se ha utilizado CLEAR con SYNC o
se ha enviado al grupo 0 un GLOBAL CONTROL con CLEAR puesto.

0

1

831AH

0,1

Al menos un esclavo DP no domina FREEZE.

0

1

831BH

0,1

Al menos un esclavo DP no domina SYNC.

0

1

8333H

0,1

La petici√≥n no est√° permitida en el estado operativo de DP "STOP".

No es posible una activaci√≥n del modo de esclavo "Leer datos de salida".

Observaci√≥n:
Si no hay configurado ning√∫n maestro DP, se puede emitir tambi√©n el es‚Äê
tado 8181H.

7502

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Posible para
CTYPE

Significado

0

1

8334H

0, 1

La petici√≥n no est√° permitida en el estado operativo de DP "OFFLINE".
Observaci√≥n:
Si no hay configurado ning√∫n maestro DP, se puede emitir tambi√©n el es‚Äê
tado 8181H.

0

1

8335H

0, 1

El CP PROFIBUS se encuentra en el estado PROFIBUS: "Estaci√≥n no en
el anillo".

0

1

8339H

0, 1

Al menos un esclavo DP del grupo seleccionado no se encuentra en la fase
de transferencia de datos.

0

1

833CH

1

El Global Control c√≠clico no se debe utilizar en el modo
"Plc <-> CP libre". Este error no se presenta en el CP 3425, ya que dicho
modo no es posible en el mismo (la transmisi√≥n de datos tiene lugar siem‚Äê
pre a trav√©s de registros PBUS).

0

1

8341H

7-10

El esclavo DP indicado no se ha configurado.

0

1

8183H

0..10

Maestro DP no configurado.

0

1

8184H

-

Error del sistema o tipo de par√°metro no permitido.

0

1

8F22H

0..10

Error de longitud de √°rea al leer un par√°metro (p. ej. DB demasiado corto).

0

1

8F23H

0..10

Error de longitud de √°rea al escribir un par√°metro.

0

1

8F24H

0..10

Error de √°rea al leer un par√°metro.

0

1

8F25H

0..10

Error de √°rea al escribir un par√°metro.

0

1

8F28H

0..10

Error de alineaci√≥n al leer un par√°metro.

0

1

8F29H

0..10

Error de alineaci√≥n al escribir un par√°metro.

0

1

8F30H

0..10

El par√°metro est√° en el 1er. bloque de datos actual protegido de escritura.

0

1

8F31H

0..10

El par√°metro est√° en el segundo bloque de datos actual protegido de es‚Äê
critura.

0

1

8F32H

0..10

El par√°metro contiene n√∫mero de DB demasiado alto.

0

1

8F33H

0..10

Error de n√∫mero de DB.

0

1

8F3AH

0..10

√Årea de destino no cargada (DB).

0

1

8F42H

0..10

Retardo en acuse al leer un par√°metro del √°rea de periferia.

0

1

8F43H

0..10

Retardo en acuse al escribir el par√°metro en el √°rea de periferia.

0

1

8F44H

0..10

Est√° bloqueado el acceso a un par√°metro a leer para el procesamiento de
la instrucci√≥n.

0

1

8F45H

0..10

Est√° bloqueado el acceso a un par√°metro a escribir para el procesamiento
de la instrucci√≥n.

0

1

8F7FH

0..10

Error interno, p. ej. referencia ANY no admisible.

0

1

80C4H

0..10

Error de comunicaci√≥n (se presenta temporalmente; por ello es convenien‚Äê
te una repetici√≥n en el programa de usuario).

0

1

80D2H

0..10

Direcci√≥n base l√≥gica incorrecta.

Consulte tambi√©n
DP_CTRL (P√°gina 7493)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7503

Instrucciones
4.2 Instrucciones

CM/CP SIMATIC NET
CM/CP S7-1500
Industrial Ethernet
Instrucciones para servicios FTP
FTP_CMD para servicios FTP
Panor√°mica de FTP_CMD
Significado
Con la instrucci√≥n FTP_CMD se pueden establecer conexiones FTP y transmitir archivos
desde y a un servidor FTP.
Nota
Versiones de los bloques
En una estaci√≥n la versi√≥n V2.x del FTP_CMD solo puede utilizarse en combinaci√≥n con una
CPU V2.x y un CP V2.x.
En cuanto la estaci√≥n contiene una CPU V1.x o un CP V1.x, hay que utilizar el FTP_CMD en
la versi√≥n anterior V1.x (por ejemplo V1.4). Cambie para ello la versi√≥n de la librer√≠a
"SIMATIC NET CP" a V3.4. Entonces podr√° seleccionar una versi√≥n anterior del bloque.
La transferencia de datos se puede realizar v√≠a FTP o FTPS (conexiones SSL seguras).
Nota
FTPS: sincronizar certificados
FTPS requiere la sincronizaci√≥n de los certificados entre el servidor FTP y el cliente FTP. Si el
servidor FTP se configura fuera del proyecto STEP 7 del cliente FTP, habr√° que importar el
certificado del servidor FTP. En el administrador de certificados importe el certificado del
servidor FTP como certificado de confianza.

Funcionamiento
La instrucci√≥n FTP_CMD hace referencia a un bloque de petici√≥n (ARG) en el que se
especifica el comando FTP. Seg√∫n sea el tipo de comando FTP (CMD), este bloque de petici√≥n
utiliza diferentes estructuras de datos para la parametrizaci√≥n. Para dichas estructuras est√°n
disponibles en cada caso los tipos de datos adecuados (UDT).
La figura siguiente ilustra la estructura de llamada:

7504

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
)73B&0'
%ORTXHGHSHWLFL¬µQ
&0'
$5*

)LOH'%

)73B),/(1$0(B

(QFDEH]DGR

)73B&211(&7B
'DWRV

Bloques de petici√≥n
Para los bloques de petici√≥n se utilizan las siguientes estructuras de datos:
‚óè Establecimiento de la conexi√≥n
Para establecer la conexi√≥n est√°n disponibles diferentes estructuras de datos para los
siguientes tipos de acceso:
‚Äì FTP_CONNECT_IPV4: Establecimiento de la conexi√≥n con direcciones IP seg√∫n IPv4
‚Äì FTP_CONNECT_IPV6: Establecimiento de la conexi√≥n con direcciones IP seg√∫n IPv6
‚Äì FTP_CONNECT_NAME: Establecimiento de la conexi√≥n con nombres de servidor
(DNS)
‚óè Transferencia de datos
Para la transferencia de datos est√°n disponibles dos estructuras de datos distintas:
‚Äì FTP_FILENAME: Estructura de datos para el acceso a un archivo completo
‚Äì FTP_FILENAME_PART: Estructura de datos para el acceso de lectura a un √°rea de
datos

Transferencia de datos en el File-DB
Los datos se transfieren mediante bloques que contienen un encabezado para datos de
petici√≥n y el √°rea de datos de usuario. El bloque de datos se indica en el b√∫fer de peticiones.

Requisitos en la configuraci√≥n de la CPU
Utilice los ajustes siguientes para permitir el acceso FTP:
‚óè En todos los bloques de datos utilizados como File-DB desactive el atributo "Acceso
optimizado al bloque".
‚óè Solo en caso de utilizar una CPU V1.x y un CP V1.1.x:
en los datos de configuraci√≥n de la CPU, en "Propiedades > General > Propiedades"
desactive la opci√≥n "Desactivar comunicaci√≥n PUT/GET" (PUT/GET debe estar habilitado).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7505

Instrucciones
4.2 Instrucciones

Validez
La instrucci√≥n FTP_CMD se puede utilizar en combinaci√≥n con los siguientes tipos de m√≥dulos:
‚óè CP 1543-1

Interfaz de llamada
Interfaz de llamada en representaci√≥n FUP
)73B&0'
%22/

5(4

'21(

%22/

:25'

,'

%86<

%22/

%<7(

&0'

(5525

%22/

67$786

:25'
9$5,$17

$5*

9$5,$17

Consulte tambi√©n
Par√°metros de salida e informaciones de estado FTP_CMD (P√°gina 7514)
Par√°metros de entrada FTP_CMD (P√°gina 7506)
Estructura de los bloques de datos (File-DB) para servicios FTP - modo FTP-Client
(P√°gina 7517)

Par√°metros de entrada FTP_CMD
Explicaci√≥n de los par√°metros de entrada
Deben suministrarse los siguientes par√°metros de entrada a la instrucci√≥n FTP_CMD:
Tabla 4-457 Par√°metros formales de la instrucci√≥n FTP_CMD - par√°metros de entrada
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Significado / Observaci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Inicia la petici√≥n de emisi√≥n con un flanco as‚Äê
cendente.

ID *

INPUT

INT

1, 2 ... 64

Las peticiones de FTP se desarrollan a trav√©s
de conexiones FTP. El par√°metro identifica la
conexi√≥n utilizada.

7506

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro
CMD *

Declaraci√≥n
INPUT

Tipo de datos
BYTE

√Årea de memoria

Significado / Observaci√≥n

Consulte la tabla si‚Äê Comando FTP que debe ejecutarse al llamar
guiente "Comandos". la instrucci√≥n. Encontrar√° los rangos de valo‚Äê
res para los tipos de comandos FTP a conti‚Äê
nuaci√≥n de la tabla.
Nota:
El comando FTP indicado aqu√≠ debe indicarse
de forma id√©ntica en el bloque de petici√≥n (pa‚Äê
r√°metro ARG).
Si un comando no es compatible con el firm‚Äê
ware del CP, se emite un mensaje de error con
STATUS = 8F6BH.

ARG *

INPUT

VARIANT

Consulte la tabla si‚Äê Bloque de petici√≥n
guiente "Comandos". Hace referencia al √°rea de datos con los par√°‚Äê
metros de ejecuci√≥n adecuados para el co‚Äê
mando FTP.
En funci√≥n del comando FTP se utilizan tipos
de datos espec√≠ficos (UDT). Los UDT se indi‚Äê
can del siguiente modo.
El tipo de datos ANY no est√° permitido para el
puntero que debe especificarse aqu√≠.

* Los valores de los par√°metros de entrada "ID" y "CMD" sobrescriben el valor del par√°metro de entrada "ARG".

Comandos FTP en el par√°metro "CMD"
Consulte en la tabla siguiente qu√© significado tienen los comandos del par√°metro "CMD" y qu√©
UDTs se utilizan para abastecer a los bloques de petici√≥n.
Tabla 4-458 Tipos de comando
CMD (tipo de comando) Bloques de petici√≥n rele‚Äê
vantes / UDT

Significado / Manejo

0 (NOOP)

El FC llamado no ejecuta ninguna acci√≥n. Las indicaciones de estado
se ponen como sigue para este abastecimiento de par√°metros:

*

DONE=1; ERROR=0; STATUS=0
1 (CONNECT)

FTP_CONNECT_IPV4

Establecimiento de la conexi√≥n FTP

FTP_CONNECT_IPV6

El cliente FTP establece con este comando una conexi√≥n FTP con un
servidor FTP (puerto 21).

FTP_CONNECT_NAME

2 (STORE)

FTP_FILENAME

La conexi√≥n est√° disponible, con la ID de conexi√≥n aqu√≠ asignada, para
todos los dem√°s comandos FTP. Los datos se intercambian entonces
con el servidor FTP indicado para este usuario.
Con esta llamada de funci√≥n se transmite un bloque de datos (File-DB)
del cliente FTP (CPU S7) al servidor FTP.
Atenci√≥n: Si el archivo (File-DB) ya existe en el servidor FTP, se so‚Äê
brescribe.

3 (RETRIEVE)

FTP_FILENAME

Con esta llamada de funci√≥n se transmite un archivo del servidor FTP
al cliente FTP (CPU S7).
Atenci√≥n: Si el bloque de datos (File-DB) del cliente FTP ya contiene
un archivo, este se sobrescribe.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7507

Instrucciones
4.2 Instrucciones
CMD (tipo de comando) Bloques de petici√≥n rele‚Äê
vantes / UDT

Significado / Manejo

4 (DELETE)

FTP_FILENAME

Con esta llamada de funci√≥n se borra un archivo en el servidor FTP.

5 (QUIT)

*

Con esta llamada de funci√≥n se deshace la conexi√≥n FTP identificada
con la ID.

6 (APPEND)

FTP_FILENAME

De forma similar a "STORE", el comando "APPEND" (a√±adir) guarda
un archivo en el servidor FTP. Pero con "APPEND" no se sobrescribe
el archivo en el servidor FTP, sino que el nuevo contenido a guardar se
a√±ade al archivo.

7 (RETR_PART)

FTP_FILENAME_PART

Con el comando "RETR_PART" (leer longitud parcial) se puede pedir
del servidor FTP una parte de un archivo.

Si el archivo no existe en el servidor FTP, se crea.

En caso de archivos muy grandes se puede limitar as√≠ la lectura a la
parte necesaria.
Para esto se tiene que conocer la estructura del archivo.
Indique la parte deseada del archivo con ayuda de los dos par√°metros
"OFFSET" y "LEN" en el FB 40.
* En los tipos de comando 0 (NOOP) y 5 (QUIT) debe indicarse un bloque de petici√≥n cualquiera (UDT). Dicho bloque no se
evaluar√°.

Consulte tambi√©n
Panor√°mica de FTP_CMD (P√°gina 7504)

Bloques de petici√≥n para FTP_CMD
Significado
La instrucci√≥n FTP_CMD se abastece con un bloque de petici√≥n a trav√©s del par√°metro ARG.
La estructura depende del tipo de comando FTP. Al utilizar los tipos de datos especificados
(UDT), la instrucci√≥n reconoce el tipo del bloque de petici√≥n. A continuaci√≥n se indican los tipos
de datos (UDT) correspondientes a los siguientes bloques de petici√≥n:
‚óè Establecimiento de la conexi√≥n FTP con direcci√≥n IP seg√∫n IPv4
‚óè Establecimiento de la conexi√≥n FTP con direcci√≥n IP seg√∫n IPv6
‚óè Establecimiento de la conexi√≥n FTP con nombre de servidor
‚óè Acceso de escritura y lectura as√≠ como otros comandos FTP
‚óè Comando FTP RETR_PART

7508

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloque de petici√≥n para establecimiento de la conexi√≥n FTP con direcci√≥n IP seg√∫n IPv4
Para el establecimiento de la conexi√≥n FTP con direcci√≥n IP seg√∫n IPv4 se utiliza la siguiente
estructura de datos.
Tabla 4-459 FTP_CONNECT_IPV4
Par√°metro
InterfaceID

Tipo

Rango de valores

HW_ANY

Significado / Observaci√≥n
Direcci√≥n inicial del m√≥dulo
Al llamar una instrucci√≥n se transfiere en el par√°metro
LADDR la direcci√≥n inicial de m√≥dulo del CP.
La direcci√≥n inicial de m√≥dulo del CP puede consultarse en
la configuraci√≥n del CP en: "Propiedades>Direcciones>En‚Äê
tradas"

ID

CONN_OUC

1, 2...64

Las peticiones de FTP se desarrollan a trav√©s de conexio‚Äê
nes FTP. El par√°metro identifica la conexi√≥n utilizada.

ConnectionType

BYTE

0

Tipo de conexi√≥n "FTP"

ActiveEstablishment BOOL

TRUE

FTPCmd

1

BYTE

Comando FTP "CONNECT"
Comando FTP que se ejecutar√° al llamar la instrucci√≥n. En‚Äê
contrar√° los rangos de valores para los tipos de comandos
en el cap√≠tulo Par√°metros de entrada FTP_CMD (P√°gi‚Äê
na 7506).
Nota:
El comando FTP indicado aqu√≠ debe indicarse de forma
id√©ntica en el par√°metro de entrada CMD.

CertIndex

BYTE

0 = FTP

Elija o bien el tipo de protocolo FTP, o bien FTPS.

1 = FTPS

Nota para FTPS:
Si el servidor FTP se configura fuera del proyecto STEP 7
del cliente FTP, habr√° que importar el certificado del servidor
FTP.

UserName

STRING[32]

‚Äôbenutzer‚Äô

Nombre del usuario para iniciar sesi√≥n en el servidor FTP

Password
FTPserverIPaddr

STRING[32]

‚Äôpasswort‚Äô

Contrase√±a para iniciar sesi√≥n en el servidor FTP

IP_V4

ADDR(1) ...
ADDR(4)

Direcci√≥n IP del servidor FTP como Array[1..4] of Byte, en la
que cada byte especifica 1 bloque de la direcci√≥n.
Ejemplo: ADDR(1) especifica el primer bloque de direcci√≥n
(el primer byte de la direcci√≥n).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7509

Instrucciones
4.2 Instrucciones

Bloque de petici√≥n para establecimiento de la conexi√≥n FTP con direcci√≥n IP seg√∫n IPv6
Para el establecimiento de la conexi√≥n FTP con direcci√≥n IP seg√∫n IPv6 se utiliza la siguiente
estructura de datos.
Tabla 4-460 FTP_CONNECT_IPV6
Par√°metro
InterfaceID

Tipo

Rango de valores

HW_ANY

Significado / Observaci√≥n
Direcci√≥n inicial del m√≥dulo
Al llamar una instrucci√≥n se transfiere en el par√°metro
LADDR la direcci√≥n inicial de m√≥dulo del CP.
La direcci√≥n inicial de m√≥dulo del CP puede consultarse en
la configuraci√≥n del CP en: "Propiedades>Direcciones>En‚Äê
tradas"

ID

CONN_OUC

1, 2...64

Las peticiones de FTP se desarrollan a trav√©s de conexio‚Äê
nes FTP. El par√°metro identifica la conexi√≥n utilizada.

ConnectionType

BYTE

0

Tipo de conexi√≥n "FTP"

ActiveEstablishment BOOL

TRUE

FTPCmd

1

BYTE

Comando FTP "CONNECT"
Comando FTP que se ejecutar√° al llamar la instrucci√≥n. En‚Äê
contrar√° los rangos de valores para los tipos de comandos
en el cap√≠tulo Par√°metros de entrada FTP_CMD (P√°gi‚Äê
na 7506).
Nota:
El comando FTP indicado aqu√≠ debe indicarse de forma
id√©ntica en el par√°metro de entrada CMD.

CertIndex

BYTE

0 = FTP

Elija o bien el tipo de protocolo FTP, o bien FTPS.

1 = FTPS

Nota para FTPS:
Si el servidor FTP se configura fuera del proyecto STEP 7
del cliente FTP, habr√° que importar el certificado del servidor
FTP.

UserName

STRING[32]

‚Äôusuario‚Äô

Nombre del usuario para iniciar sesi√≥n en el servidor FTP

Password

STRING[32]

‚Äôcontrase√±a‚Äô

Contrase√±a para iniciar sesi√≥n en el servidor FTP

FTPserverIPaddr

IP_V6

ADDR(1) ...
ADDR(16)

Direcci√≥n IP del servidor FTP como Array[1..16] of Byte, en
la que cada 2 bytes especifican un bloque de la direcci√≥n.
Ejemplo: ADDR(1) + ADDR(2) especifican el primer bloque
de direcci√≥n.

7510

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloque de petici√≥n para establecimiento de la conexi√≥n FTP con nombre de servidor
Para el establecimiento de la conexi√≥n FTP indicando un nombre de servidor se utiliza la
siguiente estructura de datos. El nombre de servidor se asigna a una direcci√≥n IP mediante
DNS.
Tabla 4-461 FTP_CONNECT_NAME
Par√°metro
InterfaceID

Tipo

Rango de valores

HW_ANY

Significado / Observaci√≥n
Direcci√≥n inicial del m√≥dulo
Al llamar una instrucci√≥n se transfiere en el par√°metro
LADDR la direcci√≥n inicial de m√≥dulo del CP.
La direcci√≥n inicial de m√≥dulo del CP puede consultarse en
la configuraci√≥n del CP en: "Propiedades>Direcciones>En‚Äê
tradas"

ID

CONN_OUC

1, 2...64

Las peticiones de FTP se desarrollan a trav√©s de conexio‚Äê
nes FTP. El par√°metro identifica la conexi√≥n utilizada.

ConnectionType

BYTE

0

Tipo de conexi√≥n "FTP"

ActiveEstablishment BOOL

TRUE

FTPcmd

1

BYTE

Comando FTP "CONNECT"
Comando FTP que se ejecutar√° al llamar la instrucci√≥n. En‚Äê
contrar√° los rangos de valores para los tipos de comandos
en el cap√≠tulo Par√°metros de entrada FTP_CMD (P√°gi‚Äê
na 7506).
Nota:
El comando FTP indicado aqu√≠ debe indicarse de forma
id√©ntica en el par√°metro de entrada CMD.

CertIndex

BYTE

0 = FTP

Elija o bien el tipo de protocolo FTP, o bien FTPS.

1 = FTPS

Nota para FTPS:
Si el servidor FTP se configura fuera del proyecto STEP 7
del cliente FTP, habr√° que importar el certificado del servidor
FTP.

UserName

STRING[32]

‚Äôbenutzer‚Äô

Nombre del usuario para iniciar sesi√≥n en el servidor FTP

Password

STRING[32]

‚Äôpasswort‚Äô

Contrase√±a para iniciar sesi√≥n en el servidor FTP

FTPserverName

STRING[254]

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Direcci√≥n IP del servidor FTP

7511

Instrucciones
4.2 Instrucciones

Bloque de petici√≥n para acceso de escritura y lectura as√≠ como otros comandos FTP
Para los comandos FTP store, retrieve, delete y append se utiliza la siguiente estructura de
datos.
Tabla 4-462 FTP_FILENAME
Par√°metro
InterfaceID

Tipo

Rango de valores

HW_ANY

Significado / Observaci√≥n
Direcci√≥n inicial del m√≥dulo
Al llamar una instrucci√≥n se transfiere en el par√°metro
LADDR la direcci√≥n inicial de m√≥dulo del CP.
La direcci√≥n inicial de m√≥dulo del CP puede consultarse en
la configuraci√≥n del CP en: "Propiedades>Direcciones>En‚Äê
tradas"

ID

CONN_OUC

1, 2...64

Las peticiones de FTP se desarrollan a trav√©s de conexio‚Äê
nes FTP. El par√°metro identifica la conexi√≥n utilizada.

ConnectionType

BYTE

0

Tipo de conexi√≥n "FTP"

ActiveEstablishment BOOL

TRUE

FTPcmd

2, 3, 4, 6

BYTE

Comando FTP "STORE / RETRIEVE / DELETE / APPEND"
Comando FTP que se ejecutar√° al llamar la instrucci√≥n. En‚Äê
contrar√° los rangos de valores para los tipos de comandos
en el cap√≠tulo Par√°metros de entrada FTP_CMD (P√°gi‚Äê
na 7506).
Nota:
El comando FTP indicado aqu√≠ debe indicarse de forma
id√©ntica en el par√°metro de entrada CMD.

CertIndex

BYTE

0 = FTP

Elija o bien el tipo de protocolo FTP, o bien FTPS.

1 = FTPS

Nota para FTPS:
Si el servidor FTP se configura fuera del proyecto STEP 7
del cliente FTP, habr√° que importar el certificado del servidor
FTP.

DataBlockNumber

UINT

LenFilename

UINT

El bloque de datos aqu√≠ indicado contiene el File-DB que se
debe leer / escribir.
0...1000

El par√°metro "LenFilename" que indica la longitud total del
nombre de archivo no se eval√∫a.
En su lugar se eval√∫a la longitud indicada en el string del
par√°metro "Filename".

Filename

7512

ARRAY[0..3] OF
STRING[220]

Nombre del archivo de origen o destino.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloque de petici√≥n para el comando FTP RETR_PART
Para el comando FTP RETR_PART se utiliza la siguiente estructura de datos.
Tabla 4-463 FTP_FILENAME_PART
Par√°metro
InterfaceID

Tipo

Rango de valores

HW_ANY

Significado / Observaci√≥n
Direcci√≥n inicial del m√≥dulo
Al llamar una instrucci√≥n se transfiere en el par√°metro
LADDR la direcci√≥n inicial de m√≥dulo del CP.
La direcci√≥n inicial de m√≥dulo del CP puede consultarse en
la configuraci√≥n del CP en: "Propiedades>Direcciones>En‚Äê
tradas"

ID

CONN_OUC

1, 2...64

Las peticiones de FTP se desarrollan a trav√©s de conexio‚Äê
nes FTP. El par√°metro identifica la conexi√≥n utilizada.

ConnectionType

BYTE

0

Tipo de conexi√≥n "FTP"

ActiveEstablishment BOOL

TRUE

FTPcmd

7

BYTE

Comando FTP "RETR_PART"
Comando FTP que se ejecuta al llamar la instrucci√≥n. En‚Äê
contrar√° los rangos de valores para los tipos de comandos
en el cap√≠tulo Par√°metros de entrada FTP_CMD (P√°gi‚Äê
na 7506).
Nota:
El comando FTP indicado aqu√≠ debe indicarse de forma
id√©ntica en el par√°metro de entrada CMD.

CertIndex

BYTE

0 = FTP

Elija o bien el tipo de protocolo FTP, o bien FTPS.

1 = FTPS

Nota para FTPS:
Si el servidor FTP se configura fuera del proyecto STEP 7
del cliente FTP, habr√° que importar el certificado del servidor
FTP.

Offset

DWORD

Offset en bytes, a partir del cual se debe leer el archivo.

Length

DWORD

Longitud parcial en bytes que se debe leer a partir del valor
indicado en "OFFSET".
Peculiaridades:
‚óè Si se indica "DW#16#FFFFFFFF" se lee el resto
disponible del archivo.
Resultado OK (DONE = 1, STATUS = 0), si no se
presenta ning√∫n otro error.
‚óè Si OFFSET > longitud del archivo original:
Longitud del archivo de destino (ACT_LENGTH en el
File-DB): 0 bytes en la CPU.
Resultado OK (DONE = 1, STATUS = 0), si no se
presenta ning√∫n otro error.
‚óè Si OFFSET + LEN > longitud del archivo original (y LEN
‚â† 0xFFFFFFFF):
Longitud del archivo de destino (ACT_LENGTH en el
File-DB): Bytes disponibles a partir de "OFFSET".
Resultado OK (DONE = 1, STATUS = 0), si no se presenta
ning√∫n otro error.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7513

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo

DataBlockNumber

UINT

LenFilename

UINT

Rango de valores

Significado / Observaci√≥n
El bloque de datos aqu√≠ indicado contiene el File-DB que se
debe leer / escribir.

0...1000

El par√°metro "LenFilename" que indica la longitud total del
nombre de archivo no se eval√∫a.
En su lugar se eval√∫a la longitud indicada en el string del
par√°metro "Filename".

Filename

ARRAY[0..3] OF
STRING[220]

Nombre del archivo de origen o destino.

Consulte tambi√©n
Panor√°mica de FTP_CMD (P√°gina 7504)

Par√°metros de salida e informaciones de estado FTP_CMD
Par√°metros BUSY, DONE y ERROR
El estado de ejecuci√≥n se controla con los par√°metros BUSY, DONE, ERROR y STATUS. El
par√°metro BUSY muestra el estado de procesamiento. Con el par√°metro DONE se controla si
una petici√≥n se ha ejecutado correctamente. El par√°metro ERROR se activa cuando se
producen errores durante la ejecuci√≥n de "FTP_CMD". La informaci√≥n se error se visualiza en
el par√°metro STATUS.
La tabla siguiente muestra la relaci√≥n entre los par√°metros BUSY, DONE y ERROR:
BUSY

DONE

ERROR

Descripci√≥n

1

-

-

La petici√≥n se procesa.

0

1

0

La petici√≥n se ha llevado a cabo correctamente.

0

0

1

La petici√≥n ha finalizado con un error. La causa del error se indica en el par√°metro STA‚Äê
TUS.

0

0

0

No se ha asignado ninguna petici√≥n nueva.

Evaluar indicaciones de estados
Nota
Para las entradas con la codificaci√≥n 8FxxH en STATUS, tenga en cuenta tambi√©n lo dicho en
el manual de referencia STEP 7 Standard y funciones del sistema. All√≠ encontrar√°
informaciones en el cap√≠tulo "Evaluaci√≥n de fallos con el par√°metro de salida RET_VAL".

7514

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tabla 4-464 FTP_CMD: Significado del par√°metro STATUS en relaci√≥n con DONE y ERROR
DONE

ERROR

STATUS

Significado

0

0

0000H

No hay ninguna petici√≥n en proceso.

1

0

0000H

La petici√≥n ha terminado sin errores.

0

0

7001H

La petici√≥n ha sido lanzada por primera vez (BUSY=1)

0

0

7002H

La petici√≥n a√∫n est√° proces√°ndose (BUSY=1)

0

0

80C4H

Error de comunicaci√≥n (se presenta temporalmente; por ello es conve‚Äê
niente una repetici√≥n en el programa de usuario.)

0

0

8183H

La configuraci√≥n no concuerda con los par√°metros de la petici√≥n.

0

1

8401H

Error desconocido
Posibles causas:
‚óè En la conexi√≥n se detect√≥ un timeout.
‚óè El servidor FTP cancel√≥ la conexi√≥n.
Soluci√≥n:
‚óè Enviar los comandos QUIT y CONNECT para volver a crear la
conexi√≥n.

0

1

8402H

Estado de la conexi√≥n incorrecto.
Es posible que se haya excedido el timeout de la conexi√≥n o el servidor
FTP puede haber deshecho la conexi√≥n.
Soluci√≥n:
Enviar nuevamente los comandos QUIT y CONNECT para volver a es‚Äê
tablecer la conexi√≥n.

0

1

8403H

Error al iniciar sesi√≥n.

0

1

8404H

Servidor FTP no accesible.

0

1

8405H

Error en la transferencia.

0

1

8406H

Timeout en la operaci√≥n actual

0

1

8407H

No se ha encontrado el archivo en el servidor FTP.

0

1

8408H

No es posible transferir.

0

1

8409H

No se ha podido recuperar el archivo.

0

1

8410H

Error el activar el puerto TCP para la conexi√≥n de datos.

0

1

8411H

La indicaci√≥n de offset no concuerda.

0

1

8412H

Error al cambiar la indicaci√≥n de directorio

0

1

8413H

Error al recibir datos

0

1

8414H

Error al enviar datos.

0

1

8415H

El cliente ha rechazado la indicaci√≥n CMD (tipo de comando).

0

1

8416H

El servidor FTP ha cerrado la conexi√≥n.

0

1

8418H

Error en los datos de usuario.
Posibles causas:
‚óè El nombre del archivo est√° vac√≠o.
‚óè La longitud de datos es "0"
‚óè etc.

0

1

8419H

No hay recursos de socket para abrir una conexi√≥n de datos.

0

1

8420H

No hay recursos de socket para abrir una conexi√≥n de control.

0

1

8421H

Error al abrir el File-DB que debe leerse.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7515

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8422H

Error al abrir el File-DB que debe escribirse.

0

1

8423H

Error al establecer la conexi√≥n con el servidor FTP.

0

1

8424H

Error interno

0

1

8425H

Error de formato en el nombre del dominio

0

1

8426H

Hay demasiadas peticione DNS.

0

1

8427H

El servidor DNS indicado no ha podido asignar el nombre de dominio
especificado.

0

1

8428H

No hay ning√∫n recurso de conexi√≥n disponible.

0

1

8429H

ID de canal desconocida

0

1

8430H

El File-DB es demasiado corto.

0

1

8431H

Error al escribir en el File-DB.

0

1

8432H

Error al leer del File-DB.

0

1

8433H

Error al acceder al File-DB.

0

1

8434H

Acci√≥n cancelada.

0

1

8435H

Se resetear√° el canal.

0

1

8436H

Respuesta inesperada del servidor

0

1

8437H

No se ha podido verificar el certificado.

0

1

8438H

Se ha producido un error desconocido

0

1

8439H

El comando FTP causa un error. La causa debe buscarse en el servidor
FTP (comando REST).

0

1

8440H

El servidor FTP no soporta el protocolo SSL exigido.

0

1

8446H

Despu√©s de enviar la contrase√±a FTP al servidor FTP, √©ste devolvi√≥ un
c√≥digo inesperado.

0

1

8451H

Al intentar cambiar el modo de transmisi√≥n de binario a ASCII, se notific√≥
un error.

0

1

8455H

Error en una petici√≥n de memorizaci√≥n en el CM/CP.

0

1

8460H

Ha surgido un problema en la gesti√≥n de SSL/TLS.

0

1

8469H

Error de interfaz
No se ha podido utilizar la interfaz de salida especificada.
Soluci√≥n:
Indique qu√© interfaz debe utilizarse para las conexiones salientes.

0

1

8475H

El certificapdo SSL o el SSH md5 fingerprint no se consideran de con‚Äê
fianza.

0

1

8476H

El servidor FTP no ha recibido nada. En el estado actual debe contarse
con un comportamiento err√≥neo.

0

1

8477H

No se encontr√≥ el "Crypto engine" (m√≥dulo criptogr√°fico) indicado.

0

1

8478H

Se produjo un error al configurar como est√°ndar el "Crypto engine" SSL
(m√≥dulo criptogr√°fico) seleccionado.

0

1

8480H

Ha surgido un problema con el certificado del cliente FTP.

0

1

8481H

No se pudo utilizar la cifra indicada.

0

1

8482H

El servidor FTP utiliza una codificaci√≥n que no est√° soportada.

0

1

8484H

Se ha excedido el tama√±o m√°ximo del archivo.

0

1

8485H

El File-DB ha sido modificado durante el env√≠o o su estructura no es
correcta.

7516

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE
0

ERROR
1

STATUS

Significado

8489H

No se han podido enviar los datos. No hay suficiente memoria disponible
para la operaci√≥n en el servidor FTP.

0

1

8492H

El archivo ya existe. El archivo no se sobrescribe.

0

1

8496H

Ha surgido un problema al leer el certificado CA SSL.

0

1

8497H

Se ha producido un error inesperado en la sesi√≥n SSH.

0

1

8498H

No se pudo deshacer la conexi√≥n SSL.

0

1

8499H

El socket no est√° listo para enviar/recibir. Espere hasta que haya se√±al
de disponibilidad y vu√©lvalo a intentar.

0

1

8501H

Error en la comprobaci√≥n del certificado SSL por el servidor FTP.

0

1

8507H

Durante la sesi√≥n FTP activa se ha producido un timeout al establecer la
conexi√≥n y esperar al servidor FTP.

0

1

8F55H

Bit de estado del encabezado: Locked

0

1

8F56H

El bit NEW en el encabezado del File-DB no se ha desactivado

0

1

8F6BH

Posibles causas:
‚óè Valor incorrecto para el par√°metro CMD
Se permiten valores entre 0 y 15.
‚óè Un comando del FB 40 no es compatible.
Posible causa: Firmware incorrecto del CP
Soluci√≥n: Actualizaci√≥n del firmware (en el caso de CPs menos
recientes, utilizar en lugar del FB 40 las funciones FC 40...FC 44.)

0

1

8F7FH

Error interno p. ej., referencia ANY no permitida.

Consulte tambi√©n
Panor√°mica de FTP_CMD (P√°gina 7504)

Estructura y uso del File-DB - Modo cliente FTP
Estructura de los bloques de datos (File-DB) para servicios FTP - modo FTP-Client
Funcionamiento
Para la transmisi√≥n de datos mediante FTP hay que crear bloques de datos (File-DBs) en la
CPU de la estaci√≥n S7. Dichos bloques de datos han de tener una determinada estructura para
que los servicios FTP puedan tratarlos como archivos transmisibles. Constan de los siguientes
sectores:
‚óè Sector 1: encabezado del File-DB (tiene una estructura fija con una longitud de 20 byte)
‚óè Sector 2: Datos de usuario como "Array [..] of Byte" o "Array [..] of Char" (de longitud y
estructura variable)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7517

Instrucciones
4.2 Instrucciones

Requisitos en la configuraci√≥n de la CPU
Utilice los ajustes siguientes para permitir el acceso FTP:
‚óè En los datos de configuraci√≥n de la CPU, en "Propiedades > General > Protecci√≥n":
desactive la opci√≥n "Desactivar comunicaci√≥n PUT/GET".
‚óè En todos los bloques de datos utilizados como File-DB desactive el atributo "Acceso
optimizado al bloque".

Encabezado del File-DB para modo cliente FTP
El encabezado del File-DB aqu√≠ descrito es id√©ntico al encabezado del File-DB descrito para
el modo de servidor.
Par√°metro
EXIST

Tipo
BOOL

Valor / Significado

Alimentaci√≥n

El bit EXIST indica si hay datos v√°‚Äê El comando FTP "DELETE" pone
lidos en el √°rea de datos de usua‚Äê EXIST=0.
rio.
El comando FTP "STORE" pone EXIST=1.
El comando FTP retrieve solo pro‚Äê
cesa la petici√≥n si EXIST=1.
‚óè 0: el File-DB no contiene datos
de usuario v√°lidos (el archivo
no existe).
‚óè 1: el File-DB contiene datos de
usuario v√°lidos (el archivo
existe).

LOCKED

BOOL

Los comandos FTP "STORE" y "RETRIE‚Äê
VE" ponen LOCKED=1 durante la edici√≥n
‚óè 0: se puede acceder al File-DB. si el bit estaba antes en 0.
El programa de usuario almacenado en la
‚óè 1: el File-DB est√° bloqueado.
CPU S7 tambi√©n puede activar o desacti‚Äê
var LOCKED para asegurar la coherencia
durante un acceso de escritura.
El bit LOCKED sirve para la pro‚Äê
tecci√≥n de acceso al File-DB.

Con ello se consigue garantizar un blo‚Äê
queo mutuo entre el programa de usuario
y el proceso FTP para asegurar la cohe‚Äê
rencia.
Procedimiento recomendado para el pro‚Äê
grama de usuario:
1. Comprobar el bit LOCKED (si = 0)
2. Poner el bit WRITEACCESS=0
3. Comprobar el bit LOCKED (si = 0)
4. Poner el bit LOCKED=1
5. Escribir datos
6. Poner el bit LOCKED=0

7518

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo

NEW

BOOL

Valor / Significado

Alimentaci√≥n

El bit NEW informa sobre si los da‚Äê El comando FTP store pone NEW=1 tras
tos se han modificado desde la √∫l‚Äê la edici√≥n
tima operaci√≥n de lectura.
El programa de usuario de la CPU S7 de‚Äê
‚óè 0: el contenido del File-DB no be poner NEW=0 tras la lectura de los da‚Äê
tos para permitir un nuevo comando "RE‚Äê
ha cambiado desde la √∫ltima
TRIEVE".
operaci√≥n de escritura. El
programa de usuario de la
CPU S7 ha registrado el √∫ltimo
cambio.
‚óè 1: el programa de usuario de la
CPU S7 no ha registrado la
√∫ltima operaci√≥n de escritura.

WRITE_ACCESS

BOOL

‚óè 0: El programa de usuario
tiene derecho de escritura
para los File-DBs de la CPU
S7.
‚óè 1: El programa de usuario no
tiene derecho de escritura
para los File-DBs de la CPU
S7.

El bit se pone a un valor de inicializaci√≥n al
configurar el DB.
Recomendaci√≥n:
A ser posible, el bit deber√≠a dejarse inalte‚Äê
rado. En caso especiales es posible una
adaptaci√≥n durante el funcionamiento.

ACT_LENGTH

DINT

Longitud actual del √°rea de datos
de usuario.
El contenido de este campo solo
es v√°lido si EXIST = 1.

La longitud actual se actualiza despu√©s de
una operaci√≥n de escritura.

MAX_LENGTH

DINT

Longitud m√°xima del √°rea de da‚Äê
tos de usuario (longitud total del
DB menos 20 bytes del encabeza‚Äê
do).

La longitud m√°xima se deber√≠a definir al
configurar el DB.
El valor puede ser modificado por el pro‚Äê
grama de usuario tambi√©n durante el fun‚Äê
cionamiento.

FTP_REPLY_CODE INT

Cifra sin signo (16 bit) que contie‚Äê
ne el √∫ltimo c√≥digo Reply de FTP
como valor binario.
El contenido de este campo solo
es v√°lido si EXIST = 1.

Es actualizado por el tramitador de proto‚Äê
colo FTP al procesar comandos FTP del
servidor.

DATE_TIME

Fecha y hora de la √∫ltima modifi‚Äê
caci√≥n del archivo.
El contenido de este campo solo
es v√°lido si EXIST = 1.

La fecha actual se actualiza tras un pro‚Äê
ceso de escritura.

DATE_AND_TIME

Si se utiliza la funci√≥n "Transmisi√≥n de ho‚Äê
ra", la entrada equivale a la hora transmi‚Äê
tida.
Si la funci√≥n "Transmisi√≥n de hora" no se
utiliza, se introduce una hora relativa. La
referencia es el momento de arranque del
CP (valor de inicializaci√≥n: 01.01.1994
00:00h).

Consulte tambi√©n
Bloque de datos FILE_DB_HEADER como plantilla - modo cliente FTP (P√°gina 7520)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7519

Instrucciones
4.2 Instrucciones

Bloque de datos FILE_DB_HEADER como plantilla - modo cliente FTP
Significado
El encabezado del File-DB aqu√≠ descrito es id√©ntico para los modos de cliente y servidor FTP.
Para la creaci√≥n de un encabezado del File-DB est√° predeterminado el tipo de datos
FILE_DB_HEADER.

Funcionamiento
Para la transmisi√≥n de datos mediante FTP hay que crear bloques de datos (File-DBs) en la
CPU de la estaci√≥n S7. Dichos bloques de datos han de tener una determinada estructura para
que los servicios FTP puedan tratarlos como archivos transmisibles. Constan de los siguientes
sectores:
‚óè Sector 1: encabezado del File-DB (tiene una estructura fija con una longitud de 20 byte)
‚óè Sector 2: datos de usuario (longitud y estructura variables)

Proceda del siguiente modo:
1. Cree un bloque de datos del tipo "DB global" en la CPU en la que se crea el programa de
usuario con las instrucciones FTP.
2. Abra el cuadro de di√°logo de propiedades del bloque de datos reci√©n creado (men√∫
contextual), desactive el atributo "Acceso optimizado al bloque" y vuelva a cerrar el cuadro
de di√°logo de propiedades.
3. En el editor de bloques del DB, seleccione la fila que va a utilizar como l√≠nea de inicio para
el File-DB.
4. En la columna "Tipo de datos" seleccione un elemento de estructura del tipo
"FILE_DB_HEADER" o bien introduzca el tipo "FILE_DB_HEADER" a trav√©s del teclado.
Resultado: Se crea una estructura de datos con la estructura de encabezado necesaria
para el File-DB.
5. Ponga el par√°metro "WRITE_ACCESS" a "true" para permitir el acceso.
6. Indique un valor para la longitud de los datos de usuario en el par√°metro "MAX_LENGTH",
consulte el siguiente punto.
7. Cree un campo de datos del tipo "Array [..] of Byte" o "Array [..] of Char" para los datos de
usuario a transmitir.
El tama√±o del campo debe coincidir con la indicaci√≥n de MAX_LENGTH en el encabezado.
Nota
Funci√≥n "Agregar nuevo bloque" - Selecci√≥n de tipo
Al crear nuevos bloques de datos, en la entada "Tipo" de la lista desplegable tambi√©n se ofrece
el tipo de bloque "FILE_DB_HEADER". ¬°No utilice esta opci√≥n! El bloque de datos creado de
esa manera solo obtiene la estructura de encabezado y no puede ampliarse con el √°rea
necesaria para depositar datos de usuario.

7520

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloque de datos FILE_DB_HEADER - Ejemplo y plantilla para el encabezado del File-DB
En la vista de declaraci√≥n se reconoce la siguiente estructura:
Direcci√≥n

Nombre

0.0

Tipo

Valor inicial

Comentario

STRUCT

+0.0

bit08

BOOL

FALSE

reservado

+0.1

bit09

BOOL

FALSE

reservado

+0.2

bit10

BOOL

FALSE

reservado

+0.3

bit11

BOOL

FALSE

reservado

+0.4

bit12

BOOL

FALSE

reservado

+0.5

bit13

BOOL

FALSE

reservado

+0.6

bit14

BOOL

FALSE

reservado

+0.7

bit15

BOOL

FALSE

reservado

+1.0

EXIST

BOOL

FALSE

si TRUE:
el File-DB contiene datos v√°li‚Äê
dos

+1.1

LOCKED

BOOL

FALSE

si TRUE:
el File-DB est√° bloqueado debi‚Äê
do a un cambio de contenido.

+1.2

NEW

BOOL

FALSE

si TRUE:
el contenido del File-DB es nue‚Äê
vo y no puede sobrescribirse.

+1.3

WRITE_ACCESS

BOOL

FALSE

si TRUE:
el servidor FTP tiene acceso de
escritura.

+1.4

bit04

BOOL

FALSE

reservado

+1.5

bit05

BOOL

FALSE

reservado

+1.6

bit06

BOOL

FALSE

reservado

+1.7

bit07

BOOL

FALSE

reservado

+2.0

ACT_LENGTH

DINT

L#0

Longitud actual del contenido
en bytes (sin incluir los 20 bytes
del encabezado)

+6.0

MAX_LENGTH

DINT

L#0

Longitud m√°xima del contenido
en bytes (sin incluir los 20 bytes
del encabezado)

+10.0

FTP_REPLY_CODE

INT

0

Es actualizado por el tramitador
de protocolo FTP al procesar
comandos FTP, √∫ltima informa‚Äê
ci√≥n de respuesta del servidor
FTP.

+12.0

DATE_TIME

DATE_AND_TIME

DT#00-1-1-0:0:0.000

Fecha y hora del √∫ltimo cambio
en el contenido del File-DB.

=20.0

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

END_STRUCT

7521

Instrucciones
4.2 Instrucciones

CM/CP S7-1200
Telecontrol
Instrucciones de Telecontrol
TC_CON: establecer un enlace a trav√©s de la red GSM
Significado
La instrucci√≥n TC_CON permite al S7-1200 establecer conexiones de los tipos siguientes a
trav√©s del CP 1242-7:
‚óè ISO‚ÄëON‚ÄëTCP
El interlocutor es un CP 1242-7.
Las conexiones ISO‚ÄëON‚ÄëTCP solo se utilizan en el modo de operaci√≥n "GPRS directo".
‚óè UDP
El interlocutor es uno cualquiera.
‚óè SMS
El interlocutor es un cliente SMS.
‚óè Conexi√≥n Telecontrol
El interlocutor es un servidor Telecontrol o bien otra estaci√≥n a la que se accede a trav√©s
del servidor Telecontrol.
Un TC_CON establece una conexi√≥n. Dependiendo del modo de operaci√≥n del CP 1242-7 y
del protocolo utilizado, por cada CP se soportan un m√°ximo de 3 a 5 conexiones paralelas con
IDs √∫nicas (v√©ase m√°s abajo). El n√∫mero m√°ximo posible de conexiones paralelas puede
consultarse en los datos de rendimiento del CP.
Para describir la conexi√≥n, el par√°metro CONNECT utiliza un bloque de datos (DB) con una
estructura definida por el tipo de datos del sistema (SDT).
El tipo de conexi√≥n deseado se define mediante un SDT "TCON_..." espec√≠fico de la conexi√≥n
(v√©ase m√°s abajo). Para cada uno de los tipos de conexi√≥n mencionados anteriormente debe
parametrizarse uno de los siguientes SDTs:
‚óè TCON_IP_RFC para conexiones ISO‚ÄëON‚ÄëTCP
‚óè TCON_IP_V4 para conexiones UDP
‚óè TCON_PHONE para conexiones SMS
‚óè TCON_WDC para conexiones Telecontrol
En el par√°metro "ActiveEstablished" de estos SDTs se define, entre otros, si se trata de un
establecimiento de conexi√≥n activo o pasivo.
Para parametrizar estos SDTs consulte TCON_...: SDTs para el establecimiento de un enlace
Telecontrol (P√°gina 7538).
El par√°metro ID referencia la conexi√≥n GPRS. La ID se asigna y debe ser un√≠voca dentro de
la CPU.

7522

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El par√°metro INTERFACE referencia la interfaz GPRS del CP local deseado. Esta debe ser
adoptada desde STEP 7.

Interfaz de llamada en representaci√≥n FUP
7&B&21
%22/

5(4

%86<

%22/

&211B28&

,'

'21(

%22/

+:B,17(5)$&(

,17(5)$&(

(5525

%22/

7&21B3DUDP

&211(&7

67$786

:25'

Explicaci√≥n de los par√°metros formales
La tabla siguiente explica los par√°metros formales de la instrucci√≥n TC_CON.
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

REQ

INPUT

BOOL

0, 1

Con un flanco ascendente se inicia el pro‚Äê
cesamiento de la instrucci√≥n y se iniciali‚Äê
zan los indicadores de estado.
Actualizaci√≥n de los indicadores de esta‚Äê
do DONE, ERROR y STATUS cuando no
hay ning√∫n flanco ascendente.

ID

INPUT

CONN_OUC

1...07FFh

Referencia a la conexi√≥n correspondien‚Äê
te. La ID se asigna.
El valor de ID tambi√©n es requerido por el
tipo de datos de sistema (SDT) corres‚Äê
pondiente al par√°metro CONNECT.

INTERFACE

INPUT

HW_INTERFA‚Äê
CE

CONNECT

INOUT

TCON_Param

Referencia a la interfaz del CP 1242‚Äë7 lo‚Äê
cal (v√©ase STEP 7 > Configuraci√≥n CP >
Interfaz Telecontrol > "Identificador HW")
V√©ase tambi√©n "TCON_...:
SDTs para establecer la cone‚Äê
xi√≥n de Telecontrol"

Referencia a un bloque de datos para el
establecimiento de la conexi√≥n.
Los SDT del tipo TCON_IP_RFC,
TCON_IP_V4, TCON_PHONE o
TCON_WDC predeterminan la estructura
del bloque de datos apto para la conexi√≥n
correspondiente.
Tenga en cuenta el par√°metro "ActiveEs‚Äê
tablished" (establecimiento activo / pasi‚Äê
vo de la conexi√≥n) en los SDTs.

ENO

OUTPUT

BOOL

0: error
1: correcto

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Salida de habilitaci√≥n
Si la instrucci√≥n presenta un error en el
tiempo de ejecuci√≥n, se pondr√° ENO = 0.

7523

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

BUSY

OUTPUT

BOOL

0: procesamiento de la instruc‚Äê
ci√≥n todav√≠a no iniciado, finali‚Äê
zado o cancelado

Indicador del estado de procesamiento
de la instrucci√≥n

1: procesamiento de la instruc‚Äê
ci√≥n en curso
DONE

OUTPUT

BOOL

0: 1: procesamiento de la instruc‚Äê
ci√≥n finalizado correctamente

ERROR

OUTPUT

STATUS

OUTPUT

BOOL

El par√°metro de estado indica si la peti‚Äê
ci√≥n se ha desarrollado correctamente.
Consulte el significado en relaci√≥n con los
par√°metros ERROR y STATUS en Indi‚Äê
cadores de la instrucci√≥n.

0: -

Indicador de error

1: error

Consulte el significado en relaci√≥n con los
par√°metros DONE y STATUS en Indica‚Äê
dores de la instrucci√≥n.

WORD

Indicador de estado
Consulte el significado en relaci√≥n con los
par√°metros DONE y ERROR en Indica‚Äê
dores de la instrucci√≥n.

Indicadores BUSY, DONE y ERROR
Los indicadores DONE y ERROR solo son relevantes si BUSY = 0.
BUSY

DONE

ERROR

Significado

0

0

0

Ninguna petici√≥n en proceso

Encontrar√° todas las dem√°s combinaciones de los indicadores DONE y ERROR en la tabla
siguiente.
En caso de llamada, la instrucci√≥n permanecer√° en el estado BUSY = 1 por algunos segundos.
En los siguientes casos puede durar m√°s tiempo el estado BUSY = 1:
‚óè En el caso de conexiones ISO‚ÄëON‚ÄëTCP activas, cuando no se puede acceder al interlocutor.
‚óè En el caso de conexiones pasivas, cuando no se recibe ning√∫n telegrama.

Indicadores DONE, ERROR y STATUS
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
DONE

ERROR

STATUS

Significado

1

0

0000H

Petici√≥n ejecutada correctamente

0

0

7000H

No hay ning√∫n procesamiento de petici√≥n activo (primera llamada de la instrucci√≥n)

0

0

7001H

Procesamiento de petici√≥n iniciado (primera llamada de la instrucci√≥n)

0

0

7002H

Procesamiento de petici√≥n en curso (nueva llamada de la instrucci√≥n si BUSY = 1)

0

1

8086H

Valor no permitido para ID

0

1

8087H

N√∫mero m√°ximo de conexiones alcanzado, no es posible ninguna otra conexi√≥n

7524

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

80E3H

La ID ya se est√° utilizando en otra conexi√≥n. Esto significa que con TC_SEND, TC_RECV
o TC_DISCON actualmente BUSY es TRUE.
Tambi√©n se emitir√° el indicador de estado si EN_R con TC_RECV es TRUE de forma
permanente. Esto hace que se acceda principalmente a TC_RECV. Soluci√≥n para este
caso: desactive EN_R antes de que se llame TC_CON o TC_DISCON. EN_R solo se
debe volver a activar si se ha ejecutado TC_CON correctamente.

0

1

80E6H

Ninguna solicitud en proceso (la activaci√≥n de la instrucci√≥n no se inicia)

0

1

80E8H

Interlocutor remoto no accesible. Compruebe los par√°metros de conexi√≥n.
En el modo de operaci√≥n "GPRS directo", el aviso se emite cuando el interlocutor est√°
accesible pero no acepta las peticiones de conexi√≥n.

0

1

80EBH

Solicitud rechazada por el momento (TC_CON ya se ha llamado con la misma direcci√≥n
de destino.)

0

1

80ECH

No se ha podido abrir el Listener Port:

0

1

80F2H

El CP est√° en el modo de operaci√≥n equivocado:

Compruebe los par√°metros de conexi√≥n.
‚óè Las conexiones Telecontrol solo se permiten en el modo de operaci√≥n "Telecontrol".
‚óè Las conexiones ISO‚ÄëON‚ÄëTCP solo se utilizan en el modo de operaci√≥n "GPRS
directo".
0

1

80F3H

No hay ning√∫n punto final libre en la conexi√≥n para enviar datos:
‚óè Utilice menos conexiones o
‚óè Utilice menos conexiones pasivas o
‚óè Desactive la opci√≥n NTP.
Tenga en cuenta el n√∫mero m√°ximo de conexiones paralelas del CP 1242-7.

0

1

80F4H

No se puede generar el punto final de la conexi√≥n:
Repita la llamada. En dado caso, compruebe los par√°metros de conexi√≥n.

0

1

80F5H

Punto final de la conexi√≥n no v√°lido: fallo en el establecimiento de la conexi√≥n a trav√©s de
TC_CON.
Repita la llamada del bloque.

0

1

80F6H

Error de formato de un par√°metro en el bloque de datos llamado (tama√±o err√≥neo, for‚Äê
mato incorrecto, valor no v√°lido o n√∫mero de llamada en TCON_Phone con m√°s de 20
caracteres)
Compruebe la configuraci√≥n del SDT "TC_CON...".

TC_DISCON: desconectar un enlace a trav√©s de la red GSM
Significado
En un S7-1200 con CP 1242-7, la instrucci√≥n TC_DISCON provoca la desconexi√≥n de una
conexi√≥n ISO-ON-TCP, UDP, SMS o de Telecontrol establecida con la instrucci√≥n TC_CON.
Encontrar√° informaci√≥n detallada sobre los tipos de conexi√≥n en la descripci√≥n de la
instrucci√≥n TC_CON.
TC_DISCON desconecta solo de forma l√≥gica la conexi√≥n con el servidor de Telecontrol. En
el nivel TCP/IP, la conexi√≥n permanece.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7525

Instrucciones
4.2 Instrucciones
Si la conexi√≥n con el servidor de Telecontrol va a desconectarse f√≠sicamente, debe
configurarse como "Conexi√≥n temporal" en STEP 7 en el grupo de par√°metros "Servidor de
Telecontrol". Las estaciones temporales deshacen la conexi√≥n autom√°ticamente despu√©s de
enviar los datos.
Nota
Procesamiento de otros bloques de programa cancelado por TC_DISCON
Una llamada de TC_DISCON finaliza la ejecuci√≥n de los bloques TC_CON, TC_SEND y
TC_RECV que se llamaron con la misma ID de conexi√≥n (par√°metro "ID") e interfaz (par√°metro
"INTERFACE"). A continuaci√≥n, dichos bloques notifican ERROR.
No llamar TC_DISCON si TC_CON muestra "Error = 1".
Si TC_CON muestra "ERROR" significa que la conexi√≥n no se ha establecido. En este caso no
debe llamarse TC_DISCON.
Si se llama TC_DISCON en esta situaci√≥n, la ID de conexi√≥n ("ID") queda reservada por un
tiempo breve, con lo que si se llamara seguidamente TC_CON se mostrar√≠a ERROR y
STATUS 80E3.
El par√°metro ID referencia la conexi√≥n GPRS. La ID debe ser un√≠voca dentro de la CPU e
id√©ntica a la ID utilizada en TC_CON.
El par√°metro INTERFACE referencia la interfaz GPRS del CP local deseado. El valor debe ser
id√©ntico al utilizado para INTERFACE en TC_CON.

Interfaz de llamada en representaci√≥n FUP
7&B',6&21

7526

%22/

5(4

%86<

%22/

&211B28&

,'

'21(

%22/

+:B,17(5)$&(

,17(5)$&(

(5525

%22/

67$786

:25'

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Explicaci√≥n de los par√°metros formales
La tabla siguiente muestra los par√°metros formales de la instrucci√≥n TC_DISCON.
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

REQ

INPUT

BOOL

0, 1

Con un flanco ascendente se inicia el pro‚Äê
cesamiento de la instrucci√≥n y se iniciali‚Äê
zan los indicadores de estado.
Actualizaci√≥n de los indicadores de esta‚Äê
do DONE, ERROR y STATUS cuando no
hay ning√∫n flanco ascendente.

ID

INPUT

CONN_OUC

INTERFACE

INPUT

HW_INTERFA‚Äê
CE

ENO

OUTPUT

BOOL

1...07FFh

Referencia a la interfaz del CP 1242‚Äë7 lo‚Äê
cal (v√©ase STEP 7 > Configuraci√≥n CP >
Interfaz Telecontrol > "Identificador HW")
0: error
1: correcto

BUSY

OUTPUT

BOOL

Referencia a la conexi√≥n correspondiente

0: procesamiento de la instruc‚Äê
ci√≥n todav√≠a no iniciado, finali‚Äê
zado o cancelado

Salida de habilitaci√≥n
Si la instrucci√≥n presenta un error en el
tiempo de ejecuci√≥n, se pondr√° ENO = 0.
Indicador del estado de procesamiento
de la instrucci√≥n

1: procesamiento de la instruc‚Äê
ci√≥n en curso
DONE

OUTPUT

BOOL

0: 1: procesamiento de la instruc‚Äê
ci√≥n finalizado correctamente

ERROR

OUTPUT

STATUS

OUTPUT

BOOL

El par√°metro de estado indica si la peti‚Äê
ci√≥n se ha desarrollado correctamente.
Consulte el significado en relaci√≥n con los
par√°metros ERROR y STATUS en Indi‚Äê
cadores de la instrucci√≥n.

0: -

Indicador de error

1: error

Consulte el significado en relaci√≥n con los
par√°metros DONE y STATUS en Indica‚Äê
dores de la instrucci√≥n.

WORD

Indicador de estado
Consulte el significado en relaci√≥n con los
par√°metros DONE y ERROR en Indica‚Äê
dores de la instrucci√≥n.

Indicadores BUSY, DONE y ERROR
Los indicadores DONE y ERROR solo son relevantes si BUSY = 0.
BUSY

DONE

ERROR

Significado

0

0

0

La instrucci√≥n todav√≠a no se ha llamado.

Encontrar√° todas las dem√°s combinaciones de los indicadores DONE y ERROR en la tabla
siguiente.
Nota
En caso de llamada, la instrucci√≥n permanecer√° en el estado BUSY = 1 por algunos segundos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7527

Instrucciones
4.2 Instrucciones

Indicadores DONE, ERROR y STATUS
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
DONE

ERROR

STATUS

Significado

1

0

0000H

Petici√≥n ejecutada correctamente

0

0

7000H

No hay ning√∫n procesamiento de petici√≥n activo (primera llamada de la instrucci√≥n)

0

0

7001H

Procesamiento de petici√≥n iniciado (primera llamada de la instrucci√≥n)

0

0

7002H

Procesamiento de petici√≥n en curso (nueva llamada de la instrucci√≥n si BUSY = 1)

0

1

8086H

Valor no permitido para ID

0

1

80E4H

ID desconocida: No existe ninguna conexi√≥n e a trav√©s de TC_CON con esta ID.

0

1

80E6H

Ninguna solicitud en proceso (la activaci√≥n de la instrucci√≥n no se inicia)

0

1

80F5H

Punto final de la conexi√≥n no v√°lido:
‚óè Fallo en el establecimiento de la conexi√≥n a trav√©s de TC_CON o
‚óè Desconexi√≥n por parte del interlocutor remoto.

0

1

80F6H

Error de formato de un par√°metro en el bloque de datos llamado (tama√±o err√≥neo, for‚Äê
mato incorrecto o valor no v√°lido)
Compruebe la configuraci√≥n del SDT "TC_CON...".

TC_SEND: enviar datos a trav√©s de la red GSM
Significado
La instrucci√≥n TC_SEND permite enviar datos a trav√©s de las conexiones programadas de los
tipos siguientes:
‚óè Conexiones ISO‚ÄëON‚ÄëTCP
‚óè Conexiones UDP
‚óè Conexiones SMS
El env√≠o de SMS solo es soportado si este se estableci√≥ en la configuraci√≥n STEP 7 del CP.
‚óè Conexiones Telecontrol
Nota
Enviar SMS a varios destinatarios
Si desea enviar un SMS id√©ntico a varios destinatarios, deber√° establecer una conexi√≥n
para cada destinatario.
Encontrar√° m√°s informaci√≥n detallada sobre los tipos de conexi√≥n en la descripci√≥n de la
instrucci√≥n TC_CON.
El par√°metro ID referencia la conexi√≥n GPRS. El valor de la ID debe ser equivalente al valor
de ID utilizado en TC_CON.
El par√°metro INTERFACE referencia la interfaz GPRS del CP local deseado. El valor debe ser
id√©ntico al utilizado para INTERFACE en TC_CON.
El n√∫mero de datos que deben enviarse se indica en el par√°metro LEN.

7528

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El tama√±o del rango de datos indicado en DATA debe ser como m√≠nimo tan grande como el
n√∫mero de bytes configurado en LEN. Los tipos de datos permitidos en el rango de datos
indicado en DATA son todos excepto BOOL y ARRAY of BOOL.
La direcci√≥n de destino (interlocutor) para los datos que deben enviarse se configura en la
instrucci√≥n TC_CON.

Interfaz de llamada en representaci√≥n FUP
7&B6(1'
%22/

5(4

%86<

%22/

&211B28&

,'

'21(

%22/

+:B,17(5)$&(

,17(5)$&(

(5525

%22/

8,17

/(1

67$786

:25'

9$5,$17

'$7$

Explicaci√≥n de los par√°metros formales
La tabla siguiente muestra los par√°metros formales de la instrucci√≥n TC_SEND.
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

REQ

INPUT

BOOL

0, 1

Con un flanco ascendente se inicia el pro‚Äê
cesamiento de la instrucci√≥n y se iniciali‚Äê
zan los indicadores de estado.
Actualizaci√≥n de los indicadores de esta‚Äê
do DONE, ERROR y STATUS cuando no
hay ning√∫n flanco ascendente.

ID

INPUT

CONN_OUC

INTERFACE

INPUT

HW_INTERFA‚Äê
CE

LEN

INPUT

UINT

1...07FFh

Referencia a la conexi√≥n correspondiente
Referencia a la interfaz del CP 1242‚Äë7 lo‚Äê
cal (v√©ase STEP 7 > Configuraci√≥n CP >
Interfaz Telecontrol > "Identificador HW")

1...2048

N√∫mero de bytes de los datos que deben
enviarse.
El valor debe ser ‚â• 1 y ‚â§ 2048.
El valor deber√≠a corresponderse con el ta‚Äê
ma√±o del rango de DATA.

DATA

INOUT

VARIANT

ENO

OUTPUT

BOOL

Referencia de direcci√≥n al rango de datos
de la CPU que debe transferirse*
0: Error
1: correcto

BUSY

OUTPUT

BOOL

0: procesamiento de la instruc‚Äê
ci√≥n todav√≠a no iniciado, finali‚Äê
zado o cancelado

Salida de habilitaci√≥n
Si la instrucci√≥n presenta un error en el
tiempo de ejecuci√≥n, se pondr√° ENO = 0.
Indicador del estado de procesamiento
de la instrucci√≥n

1: procesamiento de la instruc‚Äê
ci√≥n en curso

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7529

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

DONE

OUTPUT

BOOL

0: -

El par√°metro de estado indica si la peti‚Äê
ci√≥n se ha desarrollado correctamente. **

1: procesamiento de la instruc‚Äê
ci√≥n finalizado correctamente

ERROR

OUTPUT

STATUS

OUTPUT

BOOL

Consulte el significado en relaci√≥n con los
par√°metros ERROR y STATUS en Indi‚Äê
cadores de la instrucci√≥n.

0: -

Indicador de error

1: Error

Consulte el significado en relaci√≥n con los
par√°metros DONE y STATUS en Indica‚Äê
dores de la instrucci√≥n.

WORD

Indicador de estado
Consulte el significado en relaci√≥n con los
par√°metros DONE y ERROR en Indica‚Äê
dores de la instrucci√≥n.

* Consulte el apartado siguiente para las particularidades del par√°metro DATA para textos SMS.
** Tras enviar un telegrama, TC_SEND pone DONE = 1. Observe el comportamiento siguiente:
el fallo de una conexi√≥n ISO-on-TCP no es detectada por el emisor hasta pasados 1 o 2 minutos. Los datos transferidos pueden
haberse perdido aunque TC_SEND haya puesto DONE = 1 en el emisor.
Si se cancela una conexi√≥n ISO-on-TCP tras recibir un telegrama y antes de iniciar TC_RECV, es posible que los datos
transferidos se pierdan incluso si TC_SEND ha puesto DONE = 1 en el emisor.

Configuraci√≥n de textos SMS con el par√°metro DATA
La instrucci√≥n env√≠a como texto SMS aquellos datos a los que hace referencia el indicador del
tipo VARIANT del par√°metro DATA.
Si desde DATA se hace referencia a un operando del tipo de datos STRING para textos SMS,
entonces tambi√©n se transfieren los dos primeros bytes con indicaciones de longitud del string.
Una posibilidad para la representaci√≥n correcta de textos SMS para enviar es la conversi√≥n del
string de texto en un Array of BYTE o Array of CHAR con ayuda de la funci√≥n de conversi√≥n
Strg_TO_Chars. Strg_TO_Chars se vincula al par√°metro EN con el par√°metro de salida ENO
de TC_SEND.
Para textos SMS, el CP no soporta todos los caracteres especiales, como por ejemplo la
di√©resis. Se aplica la especificaci√≥n GSM 03.38. Pueden aparecer limitaciones adicionales
debido al proveedor de red GSM.

Indicadores BUSY, DONE y ERROR
Los indicadores DONE y ERROR solo son relevantes si BUSY = 0.
BUSY

DONE

ERROR

Significado

0

0

0

Ninguna petici√≥n en proceso

Encontrar√° todas las dem√°s combinaciones de los indicadores DONE y ERROR en la tabla
siguiente.

7530

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Indicadores DONE, ERROR y STATUS
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
DONE

ERROR

STATUS *

Significado

1

0

0000H

Petici√≥n ejecutada correctamente

0

0

7000H

No hay ning√∫n procesamiento de petici√≥n activo (primera llamada de la instrucci√≥n)

0

0

7001H

Procesamiento de petici√≥n iniciado (primera llamada de la instrucci√≥n)

0

0

7002H

Procesamiento de petici√≥n en curso (nueva llamada de la instrucci√≥n si BUSY = 1)

0

1

8086H

Valor no permitido para ID

0

1

80E0H

Error interno
Si se env√≠an telegramas directamente al servidor de Telecontrol (modo de operaci√≥n
"Telecontrol"), aseg√∫rese de que el tiempo de ciclo de emisi√≥n ‚â• 1 segundo.

0

1

80E1H

Rebase de tiempo:
‚óè Aumente el valor del "tiempo de vigilancia de conexi√≥n" en la configuraci√≥n del
CP 1242-7 o
‚óè Compruebe el interlocutor.

0

1

80E4H

ID desconocida:
Llame en primer lugar la instrucci√≥n TC_CON.

0

1

80E6H

Ninguna solicitud en proceso (la activaci√≥n de la instrucci√≥n no se inicia)

0

1

80E7H

Los datos que deb√≠an enviarse no se han transferido √≠ntegramente:

0

1

80E8H

Repita la petici√≥n.
Interlocutor remoto no accesible. Compruebe los par√°metros de conexi√≥n.
En el modo de operaci√≥n "GPRS directo", el aviso se emite cuando el interlocutor est√°
accesible pero no acepta las peticiones de conexi√≥n.
0

1

80E9H

Desconexi√≥n por parte del interlocutor remoto:
Compruebe el interlocutor. En dado caso, deshaga la conexi√≥n con TC_DISCON y es‚Äê
tabl√©zcala nuevamente con TC_CON.

0

1

80EAH

Mensaje de error del interlocutor remoto:
‚óè Compruebe el interlocutor. Active la instrucci√≥n "TC_RECV" en el interlocutor.
‚óè En dado caso, deshaga la conexi√≥n con TC_DISCON y establ√©zcala nuevamente con
TC_CON.

0

1

80EFH

No se ha podido enviar el SMS:
‚óè Compruebe si existe la direcci√≥n de destino (n√∫mero de llamada del participante
destinatario).
‚óè Compruebe si la tarjeta SIM insertada soporta el env√≠o de SMS.
‚óè Compruebe la longitud del texto SMS enviado. Los textos SMS > 160 caracteres no
se env√≠an.
‚óè Aseg√∫rese de que la opci√≥n "Est√°ndar" se haya seleccionado para el acceso al
bloque en el momento de crear el bloque de datos TCON_PHONE.

0

1

80F1H

En env√≠o de SMS no est√° activado en la configuraci√≥n STEP 7 del CP:
Active la opci√≥n "Permitir SMS" en la configuraci√≥n del CP.

0

1

80F4H

No se puede generar el punto final de la conexi√≥n:
Compruebe el interlocutor.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7531

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS *

Significado

0

1

80F5H

Punto final de la conexi√≥n no v√°lido:
‚óè Fallo en el establecimiento de la conexi√≥n a trav√©s de TC_CON.
o bien
‚óè Desconexi√≥n por parte del interlocutor remoto: Llame la instrucci√≥n TC_DISCON.

0

1

80F6H

Error de formato de un par√°metro en el bloque de datos llamado (tama√±o err√≥neo, for‚Äê
mato incorrecto o valor no v√°lido):
Compruebe la configuraci√≥n del SDT "TC_CON...".

* Encontrar√° otros estados que no aparecen aqu√≠ en los indicadores de estado de las instrucciones "RDREC" y "WRREC", bajo
los dos bytes de estado centrales (STATUS[2], STATUS[3]).

TC_RECV: recibir datos a trav√©s de la red GSM
Significado
La instrucci√≥n TC_RECV permite recibir datos a trav√©s de las conexiones programadas de los
tipos siguientes:
‚óè conexiones ISO‚ÄëON‚ÄëTCP
‚óè conexiones SMS
Para recibir SMS debe estar configurado el n√∫mero de llamada del remitente en la
configuraci√≥n STEP 7 del CP que debe recibirse (n√∫meros de llamada autorizados). El
remitente debe soportar la funci√≥n CLIP.
El n√∫mero de llamada del interlocutor debe introducirse en el SDT "TCON_PHONE".
Los SMS de alarma se excluyen mediante un filtro.
‚óè Conexiones Telecontrol
Nota
Recibir SMS de varios remitentes
Si desea recibir SMS de varios remitentes, puede escoger para ello entre dos alternativas:
‚óè Debe configurar varias conexiones (TC_CON, TC_RECV, TC_DISCON).
o bien
‚óè En una √∫nica conexi√≥n configurada en el bloque de datos necesario "TCON_PHONE"
en el par√°metro "PhoneNumber" no puede introducir ning√∫n n√∫mero de llamada. Esto
se interpretar√° durante la recepci√≥n de mensajes como comod√≠n para todos los
interlocutores autorizados.
Encontrar√° m√°s informaci√≥n detallada sobre los tipos de conexi√≥n en la descripci√≥n de la
instrucci√≥n TC_CON.
El par√°metro ID referencia la conexi√≥n GPRS. El valor de la ID debe ser equivalente al valor
de ID utilizado en TC_CON.
El par√°metro INTERFACE referencia la interfaz GPRS del CP local deseado. El valor debe ser
id√©ntico al utilizado para INTERFACE en TC_CON.
El n√∫mero m√°ximo de los datos de recepci√≥n se indica en el par√°metro LEN.
El tama√±o del rango de datos indicado en DATA debe ser como m√≠nimo tan grande como el
n√∫mero de bytes configurado en LEN. Los tipos de datos permitidos en el rango de datos

7532

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
indicado en DATA son todos excepto BOOL y ARRAY of BOOL. Los datos recibidos se
interpretan como si el interlocutor remitente hubiera utilizado los mismos tipos de datos.
El DB (tipo de datos de sistema) utilizado para la descripci√≥n de la conexi√≥n de TC_RECV se
debe distinguir de un DB utilizado para TC_SEND.

Almacenamiento de SMS
Los SMS recibidos se almacenan de forma remanente en el CP 1242-7 (25 espacios de
memoria) y en la tarjeta SIM (n√∫mero variable de espacios de memoria).
‚óè Una vez TC_RECV ha le√≠do el SMS, este se borra de la memoria.
‚óè Si todos los espacios de memoria est√°n ocupados y se recibe un nuevo SMS, se borra el
m√°s antiguo.

Interfaz de llamada en representaci√≥n FUP
7&B5(&9
%22/

(1B5

&211B28&

,'

+:B,17(5)$&(

,17(5)$&(

8,17
9$5,$17

5&9'B/(1

8,17

%86<

%22/

1'5

%22/

/(1

(5525

%22/

'$7$

67$786

:25'

Explicaci√≥n de los par√°metros formales
La tabla siguiente muestra los par√°metros formales de la instrucci√≥n TC_RECV.
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

EN_R

INPUT

BOOL

0: recepci√≥n de datos bloquea‚Äê
da

Permitir/bloquear la recepci√≥n de datos.

1: recepci√≥n de datos permitida

‚óè Versi√≥n 1.1 del bloque: tras pasar de 1
a 0 el bloque queda inactivo.
‚óè Versi√≥n 1.0 del bloque: tras pasar de 1
a 0, el bloque de programa recibe
datos una vez m√°s (hasta que DONE
= 0 y ERROR = 0).
Tenga en cuenta las indicaciones sobre el
indicador de estado 80E3 en TC_CON.

ID

INPUT

CONN_OUC

INTERFACE

INPUT

HW_INTERFA‚Äê
CE

LEN

INPUT

UINT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

1...07FFh

Referencia a la conexi√≥n correspondiente
Referencia a la interfaz del CP 1242‚Äë7 lo‚Äê
cal (v√©ase STEP 7 > Configuraci√≥n CP >
Interfaz Telecontrol > "Identificador HW")

1...2048

N√∫mero (m√≠nimo) de bytes de los datos
que deben recibirse, m√°ximo 2048

7533

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

DATA

INOUT

VARIANT

ENO

OUTPUT

BOOL

Rango de valores

Referencia de direcci√≥n al rango de datos
de recepci√≥n de la CPU*
0: error
1: correcto

RCVD_LEN

OUTPUT

UINT

BUSY

OUTPUT

BOOL

Descripci√≥n

Salida de habilitaci√≥n
Si la instrucci√≥n presenta un error en el
tiempo de ejecuci√≥n, se pondr√° ENO = 0.
N√∫mero de bytes de los datos recibidos

0: procesamiento de la instruc‚Äê
ci√≥n todav√≠a no iniciado, finali‚Äê
zado o cancelado

Indicador del estado de procesamiento
de la instrucci√≥n

1: procesamiento de la instruc‚Äê
ci√≥n en curso
DONE

OUTPUT

BOOL

0: 1: procesamiento de la instruc‚Äê
ci√≥n finalizado correctamente

ERROR

OUTPUT

STATUS

OUTPUT

BOOL

El par√°metro de estado indica si la peti‚Äê
ci√≥n se ha desarrollado correctamente.
Consulte el significado en relaci√≥n con los
par√°metros ERROR y STATUS en Indi‚Äê
cadores de la instrucci√≥n.

0: -

Indicador de error

1: error

Consulte el significado en relaci√≥n con los
par√°metros DONE y STATUS en Indica‚Äê
dores de la instrucci√≥n.

WORD

Indicador de estado
Consulte el significado en relaci√≥n con los
par√°metros DONE y ERROR en Indica‚Äê
dores de la instrucci√≥n.

* Consulte el apartado siguiente para las particularidades del par√°metro DATA para textos SMS.

Configuraci√≥n de textos SMS con el par√°metro DATA
La instrucci√≥n hace referencia al texto SMS recibido con el indicador del tipo VARIANT del
par√°metro DATA en el rango de datos de la CPU.
Si desde DATA se hace referencia a un operando del tipo de datos STRING para el texto SMS,
entonces se interpretan los dos primeros bytes del texto SMS como indicaciones de longitud
del tipo de datos STRING y no como texto SMS.
Una posibilidad para la representaci√≥n correcta de textos SMS para recibir es la conversi√≥n de
un Array of BYTE o Array of CHAR en un string de texto con ayuda de la funci√≥n de conversi√≥n
Chars_TO_Strg. Chars_TO_Strg se vincula al par√°metro EN con el par√°metro de salida ENO
de TC_RECV.
Para textos SMS, el CP no soporta todos los caracteres especiales, como por ejemplo la
di√©resis. Se aplica la especificaci√≥n GSM 03.38. Pueden aparecer limitaciones adicionales
debido al proveedor de red GSM.

Indicadores BUSY, DONE y ERROR
Los indicadores DONE y ERROR solo son relevantes si BUSY = 0.
BUSY

DONE

ERROR

Significado

0

0

0

Ninguna petici√≥n en proceso

7534

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Encontrar√° todas las dem√°s combinaciones de los indicadores DONE y ERROR en la tabla
siguiente.

Indicadores DONE, ERROR y STATUS
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
DONE

ERROR

STATUS *

Significado

1

0

0000H

Petici√≥n ejecutada correctamente

0

0

7000H

No hay ning√∫n procesamiento de petici√≥n activo (primera llamada de la instrucci√≥n)

0

0

7001H

Procesamiento de petici√≥n iniciado (primera llamada de la instrucci√≥n)

0

0

7002H

Procesamiento de petici√≥n en curso (nueva llamada de la instrucci√≥n si BUSY = 1)

0

1

80A3H

‚óè Se est√° intentando volver a establecer una conexi√≥n existente.
‚óè Se est√° intentando finalizar una conexi√≥n no existente.

0

1

80E0H

Error interno

0

1

8086H

Valor no permitido para ID

0

1

80E4H

ID desconocida:
llame en primer lugar la instrucci√≥n TC_CON.

0

1

80E6H

Ninguna solicitud en proceso (la activaci√≥n de la instrucci√≥n no se inicia)

0

1

80F5H

Punto final de la conexi√≥n no v√°lido:
‚óè Fallo en el establecimiento de la conexi√≥n a trav√©s de TC_CON.
o bien
‚óè Desconexi√≥n por parte del interlocutor remoto: llame la instrucci√≥n TC_DISCON.

0

1

80F6H

Error de formato de un par√°metro en el bloque de datos llamado (tama√±o err√≥neo, for‚Äê
mato incorrecto o valor no v√°lido)
Compruebe la configuraci√≥n del SDT "TC_CON...".

* Encontrar√° otros estados que no aparecen aqu√≠ en los indicadores de estado de las instrucciones "RDREC" y "WRREC", bajo
los dos bytes de estado centrales (STATUS[2], STATUS[3]).

TC_CONFIG: transferir datos de configuraci√≥n al CP
Significado
La instrucci√≥n TC_CONFIG permite modificar los par√°metros de un CP de telefon√≠a m√≥vil
S7-1200 que se han configurado en STEP 7. Los valores configurados no se sobrescriben de
forma remanente. Los valores sobrescritos siguen siendo v√°lidos hasta una nueva llamada de
TC_CONFIG o hasta el siguiente arranque de la estaci√≥n (arranque en fr√≠o mediante la tensi√≥n
OFF ‚Üí ON).
Para poder utilizar esta funci√≥n, en la configuraci√≥n b√°sica del CP en STEP 7 debe haber
valores configurados.
Si los datos de configuraci√≥n STEP 7 del CP deben modificarse permanentemente, entonces
la instrucci√≥n debe llamarse de nuevo despu√©s de cada arranque de la estaci√≥n (arranque en
fr√≠o) o se debe cargar un proyecto modificado en la estaci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7535

Instrucciones
4.2 Instrucciones
El par√°metro CONFIG hace referencia al √°rea de memoria con los datos de configuraci√≥n. Los
datos de configuraci√≥n se guardan en un bloque de datos (DB). La estructura del DB est√°
predeterminada por el tipo de datos de sistema (SDT) IF_CONF.
Los datos de configuraci√≥n que deben modificarse en el CP se compilan en el IF_CONF como
bloques "IF_CONF_..." para los diferentes par√°metros, seg√∫n sea necesario.
Los par√°metros que no deben modificarse con la instrucci√≥n no se introducen en el IF_CONF.
Estos conservan el valor configurado en STEP 7.
Encontrar√° informaci√≥n detallada sobre la parametrizaci√≥n de IF_CONF en el apartado
IF_CONF: SDT para datos de configuraci√≥n Telecontrol (P√°gina 7542).
El par√°metro INTERFACE referencia la interfaz GPRS del CP local deseado.

Interfaz de llamada en representaci√≥n FUP
7&B&21),*
%22/

5(4

%86<

%22/

+:B,17(5)$&(

,17(5)$&(

'21(

%22/

(5525

%22/

67$786

:25'

9$5,$17

&21),*

Explicaci√≥n de los par√°metros formales
La tabla siguiente muestra los par√°metros formales de la instrucci√≥n TC_CONFIG.
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

REQ

INPUT

BOOL

0, 1

Con un flanco ascendente se inicia el pro‚Äê
cesamiento de la instrucci√≥n y se iniciali‚Äê
zan los indicadores de estado.
Actualizaci√≥n de los indicadores de esta‚Äê
do DONE, ERROR y STATUS cuando no
hay ning√∫n flanco ascendente.

INTERFACE

INPUT

HW_INTERFA‚Äê
CE (WORD)

Referencia a la interfaz del CP 1242‚Äë7 lo‚Äê
cal

CONFIG

INOUT

VARIANT

V√©ase tambi√©n "IF_CONF:
SDT para datos de configura‚Äê
ci√≥n de Telecontrol"

Referencia al √°rea de memoria con la
compilaci√≥n de los datos de configuraci√≥n
que deben modificarse

ENO

OUTPUT

BOOL

0: error

Salida de habilitaci√≥n
Si la instrucci√≥n presenta un error en el
tiempo de ejecuci√≥n, se pondr√° ENO = 0.

1: correcto
BUSY

OUTPUT

BOOL

0: procesamiento de la instruc‚Äê
ci√≥n todav√≠a no iniciado, finali‚Äê
zado o cancelado

Indicador del estado de procesamiento
de la instrucci√≥n

1: procesamiento de la instruc‚Äê
ci√≥n en curso

7536

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

Rango de valores

Descripci√≥n

DONE

OUTPUT

BOOL

0: -

El par√°metro de estado indica si la peti‚Äê
ci√≥n se ha desarrollado correctamente.

1: procesamiento de la instruc‚Äê
ci√≥n finalizado correctamente

ERROR

OUTPUT

STATUS

OUTPUT

BOOL

Consulte el significado en relaci√≥n con los
par√°metros ERROR y STATUS en Indi‚Äê
cadores de la instrucci√≥n.

0: -

Indicador de error

1: error

Consulte el significado en relaci√≥n con los
par√°metros DONE y STATUS en Indica‚Äê
dores de la instrucci√≥n.

WORD

Indicador de estado
Consulte el significado en relaci√≥n con los
par√°metros DONE y ERROR en Indica‚Äê
dores de la instrucci√≥n.

Indicadores BUSY, DONE y ERROR
Los indicadores DONE y ERROR solo son relevantes si BUSY = 0.
BUSY

DONE

ERROR

Significado

0

0

0

Ninguna petici√≥n en proceso

Encontrar√° todas las dem√°s combinaciones de los indicadores DONE y ERROR en la tabla
siguiente.

Indicadores DONE, ERROR y STATUS
La tabla siguiente muestra el significado de la informaci√≥n suministrada por DONE, ERROR y
STATUS, la cual tiene que ser evaluada por el programa de usuario.
DONE

ERROR

STATUS

Significado

1

0

0000H

Petici√≥n ejecutada correctamente

0

0

7000H

No hay ning√∫n procesamiento de petici√≥n activo (primera llamada de la instrucci√≥n)

0

0

7001H

Procesamiento de petici√≥n iniciado (primera llamada de la instrucci√≥n)

0

0

7002H

Procesamiento de petici√≥n en curso (nueva llamada de la instrucci√≥n si BUSY = 1)

0

1

80E0H

Error interno (p. ej. no hay valores en la configuraci√≥n b√°sica de un par√°metro)

0

1

80E6H

Ninguna solicitud en proceso (la activaci√≥n de la instrucci√≥n no se inicia)

0

1

80EBH

Solicitud rechazada temporalmente (el CP es configurado moment√°neamente por STEP
7).

0

1

80F6H

Error de formato de un par√°metro en el bloque de datos llamado (tama√±o err√≥neo, for‚Äê
mato incorrecto o valor no v√°lido)
Compruebe el SDT "IF_CONF".

0

1

80F7H

ID incorrecta en los bloques de par√°metros de los datos de configuraci√≥n:
Compruebe el SDT "IF_CONF".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7537

Instrucciones
4.2 Instrucciones

TCON_...: SDTs para el establecimiento de un enlace Telecontrol
Tipos de datos de sistema TCON_... para conexiones de Telecontrol
Los cuatro tipos de datos de sistema TCON_... que se describen a continuaci√≥n se utilizan,
entre otros, para la descripci√≥n de conexiones de Telecontrol del CP 1242-7.
TCON_PHONE se utiliza tambi√©n en CP de telefon√≠a m√≥vil del S7-1200 para describir una
conexi√≥n de Open User Communication con el fin de transferir SMS (TCON / TDISCON /
TSEND o TSEND_C).
Para configurar el establecimiento de una conexi√≥n de Telecontrol en el CP 1242-7 mediante
la instrucci√≥n TC_CON se utiliza el par√°metro CONNECT de la instrucci√≥n para describir la
conexi√≥n.
La descripci√≥n del enlace est√° especificada por la estructura de un tipo de datos del sistema
(SDT). La estructura del SDT correspondiente contiene los par√°metros necesarios para
establecer el enlace con un interlocutor remoto.
Para diferentes tipos de enlace que dependen del interlocutor remoto correspondiente se
utilizan los siguientes SDTs:
‚óè TCON_IP_RFC para enlaces ISO‚Äëon‚ÄëTCP con estaciones IPv4 con CP 1242‚Äë7
‚óè TCON_IP_V4 para enlaces UDP con estaciones IPv4 (solo enviar)
‚óè TCON_PHONE para enlaces con clientes SMS
‚óè TCON_WDC para enlaces con servidores Telecontrol o estaciones a las que se accede a
trav√©s del servidor Telecontrol.
La parametrizaci√≥n de la descripci√≥n del enlace se realiza en un bloque de datos del mismo
tipo que el SDT.

Creaci√≥n de un DB del tipo TCON_...
Los tipos de datos de cada DB deben introducirse con el teclado. No se muestran en la lista de
selecci√≥n. No se tienen en cuenta las may√∫sculas/min√∫sculas al introducir los tipos de datos.
Para crear un DB TCON_... proceda del siguiente modo:
1. Cree un bloque de datos del tipo "DB global" con acceso al bloque "est√°ndar".
2. Cree un SDT en la tabla de configuraci√≥n de par√°metros del DB asign√°ndole un nombre e
introduciendo el tipo deseado en la celda del tipo de datos (por ejemplo, "TCON_IP_RFC").
Se crea el SDT con sus par√°metros (ver abajo).
3. Configure los par√°metros que se describen a continuaci√≥n para cada tipo SDT.
Los bits reservados no se muestran.

7538

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Tipo de datos de sistema TCON_IP_RFC para enlaces con estaciones IPv4
Este tipo de enlace solo es soportado en enlaces ISO‚Äëon‚ÄëTCP con interlocutores con direcci√≥n
IP fija. El CP debe estar configurado para el modo de operaci√≥n "GPRS directo".
Tabla 4-465 Par√°metros de TCON_IP_RFC
Byte

Par√°metro

Tipo de datos

0 ... 1

InterfaceID

HW_ANY

2 ... 3

ID

CONN_OUC

Valor inicial

Descripci√≥n
Referencia a la interfaz del CP 1242‚Äë7 local (v√©ase
STEP 7 > Configuraci√≥n CP > Interfaz Telecontrol >
"Identificador HW")

1...07FFh

Referencia al enlace GPRS local. La ID se asigna y
debe ser un√≠voca dentro de la CPU.
Aqu√≠ debe utilizarse el mismo valor que el del par√°‚Äê
metro ID de la instrucci√≥n TC_CON.

4

ConnectionType

BYTE

5

ActiveEstablished

BOOL

W#16#0C

Variante de protocolo 12 (Ch): Enlace ISO‚Äëon‚ÄëTCP
Identificaci√≥n del tipo de establecimiento del enlace:
‚óè 0: establecimiento pasivo del enlace
‚óè 1: establecimiento activo del enlace

6 ... 7

-

-

RemoteAddress
8 ... 11

ADDR
RemoteTSelector

12 ...
13

TSelLen

14 ...
45

TSel

-

- reservado -

IP_V4

Direcci√≥n IP de los interlocutores

Array [1...4] of
Byte

Direcci√≥n IP del interlocutor respectivo

TSelector

Selector T remoto

UINT

Tama√±o del selector T remoto "RemoteTSelector"

Array [1...32]
of Byte

Cualquiera

Selector de transporte remoto del enlace
‚óè Si "ActiveEstablished" = 1:
El selector T del interlocutor local debe ser id√©ntico
al selector T del interlocutor en el establecimiento
de enlace activo (establecimiento de enlace
pasivo en el interlocutor remoto).
‚óè Si "ActiveEstablished" = 0 correspondiente
(establecimiento de conexi√≥n local pasivo,
establecimiento de conexi√≥n remota activo)

LocalTSelector
46 ...
47

TSelLen

48 ...
79

TSel

TSelector

Selector T local

UINT

Longitud del selector T local "LOCAL_TSel"

Array [1...32]
of Byte

Cualquiera

Selector de transporte local del enlace
‚óè Si "ActiveEstablished" = 1:
El selector T del interlocutor local debe ser id√©ntico
al selector T del interlocutor en el establecimiento
de enlace activo (establecimiento de enlace
pasivo en el interlocutor remoto).
‚óè Si "ActiveEstablished" = 0 correspondiente
(establecimiento de conexi√≥n local pasivo,
establecimiento de conexi√≥n remota activo)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7539

Instrucciones
4.2 Instrucciones

Tipo de datos de sistema TCON_IP_V4 para enlaces con estaciones IPv4
Este tipo de enlace solo es soportado para el env√≠o a trav√©s de enlaces UDP a interlocutores
con direcci√≥n IP fija.
Si se debe recibir, entonces ActiveEstablished = 0 debe activarse.
Tabla 4-466 Par√°metros de TCON_IP_V4
Byte

Par√°metro

Tipo de datos

0 ... 1

InterfaceID

HW_ANY

2 ... 3

ID

CONN_OUC

Valor inicial

Descripci√≥n
Referencia a la interfaz del CP 1242‚Äë7 local (v√©ase
STEP 7 > Configuraci√≥n CP > Interfaz Telecontrol >
"Identificador HW")

1...07FFh

Referencia al enlace GPRS local. La ID se asigna y
debe ser un√≠voca dentro de la CPU.
Aqu√≠ debe utilizarse el mismo valor que el del par√°‚Äê
metro ID de la instrucci√≥n TC_CON.

4

ConnectionType

BYTE

5

ActiveEstablished

BOOL

W#16#0B

Variante de protocolo 11 (Bh): Enlace UDP
Identificaci√≥n del tipo de establecimiento del enlace:
‚óè 0: establecimiento pasivo del enlace
Ajuste para el env√≠o y la recepci√≥n de datos.
‚óè 1: establecimiento activo del enlace
Ajuste solo para el env√≠o de datos.

6 ... 9

RemoteAddress
ADDR

10 ...
11

RemotePort

12 ...
13

LocalPort

IP_V4

Direcci√≥n IP del interlocutor

Array [1...4] of
Byte

Los cuatro bytes (ADDR[1] ... ADDR[4]) especifican
los cuatro bloques de la direcci√≥n IP.

UINT

1...65535

Puerto IP del interlocutor
Sin relevancia si ActiveEstablished = 0.

UINT

1...65535

Puerto IP local ("0" no est√° permitido.)
Sin relevancia si ActiveEstablished = 1.

Tipo de datos de sistema TCON_PHONE para enlaces SMS
Nota
N√∫meros de llamada autorizados
El requisito para que el CP acepte un SMS es la autorizaci√≥n del interlocutor emisor mediante
su n√∫mero de llamada. Estos n√∫meros de llamada se configuran en STEP 7 con el CP en la
lista "N√∫meros de llamada autorizados".
Texto SMS
‚óè Se accede a los textos SMS programados para SMS que deben ser enviados a trav√©s del
par√°metro DATA de la instrucci√≥n TC_SEND.
‚óè El texto de un SMS recibido se asigna al rango de direcciones de la CPU a trav√©s del
par√°metro DATA de la instrucci√≥n TC_RECV.

7540

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tabla 4-467 Par√°metros de TCON_PHONE
Byte

Par√°metro

Tipo de datos

0 ... 1

InterfaceID

HW_ANY

2 ... 3

ID

CONN_OUC

Valor inicial

Descripci√≥n
Referencia a la interfaz local (interfaz de Telecontrol o
interfaz Ethernet del CP > "Identificador HW")

1...07FFh

Referencia a la conexi√≥n local de telefon√≠a m√≥vil. La
ID se asigna y debe ser un√≠voca dentro de la CPU.
Aqu√≠ debe utilizarse el mismo valor que el del par√°‚Äê
metro ID de la instrucci√≥n TC_CON.

4

ConnectionType

BYTE

5

ActiveEstablished

BOOL

W#16#0E

Variante de protocolo 14 (Eh): enlace SMS
Identificaci√≥n del tipo de establecimiento del enlace
(no relevante para el CP 1242‚Äë7):
‚óè 0: establecimiento pasivo del enlace (irrelevante
en este caso)
‚óè 1: establecimiento activo del enlace

6...7

-

-

8 ... 31 PhoneNumber

-

STRING[22]

- reserviert N√∫mero de abonado del interlocutor
Valores permitidos: signo m√°s (+) y cifras
Tenga en cuenta los caracteres concretos del prefijo
de pa√≠s de los n√∫meros de llamada en cuesti√≥n asig‚Äê
nado por el proveedor de red (signos "+" o ceros).
Sin la entrada del par√°metro PhoneNumber no se es‚Äê
pecificar√° ning√∫n interlocutor y se podr√°n recibir SMS
de todos los interlocutores autorizados.
Al arrancar, tenga en cuenta lo siguiente: Si no se
realiza ninguna entrada, el TC_RECV suministra pri‚Äê
mero el SMS recibido con m√°s anterioridad.

Tipos de datos del sistema TCON_WDC para conexiones con servidores de Telecontrol o estaciones
remotas
El enlace con el servidor Telecontrol que est√° asignado al S7-1200 o con una estaci√≥n remota
a la que se accede a trav√©s del servidor Telecontrol se puede configurar con TCON_WDC. Los
datos de direcci√≥n del servidor Telecontrol asignado al CP se encuentran en STEP 7, en la
ficha "Interfaz de Telecontrol > Modo de operaci√≥n" del CP. El servidor Telecontrol o la
estaci√≥n remota se direcciona mediante el nombre de host o mediante la direcci√≥n IP.
En el par√°metro "RemoteWdcAddress" de TCON_WDC se indica la ID de acceso del
interlocutor.
Tabla 4-468 Par√°metros de TCON_WDC
Byte

Par√°metro

Tipo de datos

0 ... 1

InterfaceID

HW_ANY

2 ... 3

ID

CONN_OUC

Valor inicial

Descripci√≥n
Referencia a la interfaz del CP 1242‚Äë7 local (v√©ase
STEP 7 > Configuraci√≥n CP > Interfaz Telecontrol >
"Identificador HW")

1...07FFh

Referencia al enlace GPRS local. La ID se asigna y
debe ser un√≠voca dentro de la CPU.
Aqu√≠ debe utilizarse el mismo valor que el del par√°‚Äê
metro ID de la instrucci√≥n TC_CON.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7541

Instrucciones
4.2 Instrucciones
Byte

Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

4

ConnectionType

BYTE

W#16#0F

Variante de protocolo 15 (Fh): enlace Telecontrol me‚Äê
diante direcci√≥n IP

5

ActiveEstablished

BOOL

Identificaci√≥n del tipo de establecimiento del enlace:
‚óè 0: establecimiento pasivo del enlace
‚óè 1: establecimiento activo del enlace

6 ... 7

-

-

8 ... 11 RemoteWdcAddress

-

DWORD

- reservado Indicaci√≥n de la ID de acceso (hex). La ID de acceso
depende del interlocutor.
‚óè Enlace con un CP remoto:
La ID de acceso est√° compuesta por:
‚Äì

n√∫mero de proyecto de STEP 7

‚Äì

n√∫mero de estaci√≥n

‚Äì

slot
Si la estaci√≥n remota tiene varios CP GPRS y
no va a definirse la ruta, deber√° ponerse 0 en
el √∫ltimo byte para el slot.

La ID de acceso se encuentra en el proyecto de
STEP 7, en el grupo de par√°metros "Autenticaci√≥n
CP" del CP.
‚óè No hay conexi√≥n con el servidor de Telecontrol:
ID de acceso = 0
‚óè Solo para escribir en la imagen de proceso del CP:
ID de acceso = DW#16#FEEDDADA

IF_CONF: SDT para datos de configuraci√≥n Telecontrol
Establecimiento del tipo de datos del sistema IF_CONF para la instrucci√≥n TC_CONFIG
El par√°metro CONFIG de la instrucci√≥n TC_CONFIG referencia el √°rea de memoria con los
datos de configuraci√≥n del CP que deben modificarse. Los datos de configuraci√≥n
almacenados en un bloque de datos se describen como estructura del tipo de datos del
sistema (SDT) IF_CONF.
Para poder utilizar esta funci√≥n, en la configuraci√≥n b√°sica del CP en STEP 7 debe haber
valores configurados.
IF_CONF est√° formado por un encabezado y los bloques siguientes, correspondientes a los
par√°metros o √°reas de par√°metros del CP en las propiedades de dispositivos del proyecto de
STEP 7.
Los datos de configuraci√≥n del CP que deben modificarse se compilan a modo de bloques
IF_CONF. Los par√°metros que no deben modificarse no se tienen en cuenta en la estructura
de IF_CONF y se quedan tal como se han configurado en el proyecto de STEP 7.

Creaci√≥n de un DB y de las estructuras IF_CONF
Los par√°metros del CP los puede crear dentro del DB IF_CONF en una o m√°s estructuras y
cada una con uno o m√°s bloques.

7542

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Los tipos de datos de cada bloque deben introducirse con el teclado. No se muestran en la lista
de selecci√≥n. No se tienen en cuenta las may√∫sculas/min√∫sculas al introducir los tipos de
datos.
Proceda del siguiente modo para crear IF_CONF:
1. Cree un bloque de datos del tipo "DB global" con acceso al bloque "est√°ndar".
2. Cree una estructura en la tabla de la configuraci√≥n del par√°metro del DB (tipo de datos
"Struct").
Puede determinar el nombre libremente.
3. Inserte un encabezado en esta estructura asignando el nombre del encabezado e
introduci√©ndolo en la celda del tipo de datos "IF_CONF_Header".
Se crea el encabezado de la estructura con sus tres par√°metros (ver abajo).
4. Cree un bloque para el primer par√°metro que debe modificarse introduciendo el tipo de
datos deseado (por ejemplo, "IF_CONF_APN") en la celda del tipo de datos.
5. Repita el √∫ltimo paso para todos aquellos par√°metros que desee modificar con ayuda de la
instrucci√≥n TC_CONFIG en el CP.
6. A continuaci√≥n actualice en el encabezado el n√∫mero de bloques en el par√°metro
"subfieldCnt".

Encabezado de IF_CONF
Tabla 4-469 IF_CONF_Header
Byte

Par√°metro

Tipo de datos Valor inicial

Descripci√≥n

0 ... 1

fieldType

UINT

Tipo de bloque: tiene que ser siempre 0.

2 ... 3

fieldId

UINT

ID de bloque: tiene que ser siempre 0.

4 ... 5

subfieldCnt

UINT

N√∫mero total de bloques incluidos en la estructura

Par√°metros generales de los bloques de par√°metros
Cada bloque contiene los siguientes par√°metros generales:
‚óè Id
Este par√°metro identifica el bloque correspondiente y no puede modificarse.
‚óè Length
Este par√°metro indica el tama√±o del bloque. El valor solo sirve para fines informativos.
Los bloques que contienen strings y/o arrays tienen una longitud variable. Debido a los
bytes ocultos, la longitud real de los bloques puede ser mayor que la suma de los
par√°metros mostrados.
‚óè Mode
Para este par√°metro se admiten los valores siguientes:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7543

Instrucciones
4.2 Instrucciones
Tabla 4-470 Valores de "Mode"
Valor

Significado

1

Validez permanente de los datos de configuraci√≥n
Irrelevante en el CP

2

Validez temporal de los datos de configuraci√≥n, inclusive el borrado de los datos de
configuraci√≥n permanentes existentes
Los datos de configuraci√≥n permanentes se reemplazan por los bloques de par√°metros
de IF_CONF.

Bloque para el √°rea de par√°metros "Acceso GPRS"
Tabla 4-471 IF_CONF_APN
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

4

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 174

Mode

UINT

Validez (1: permanente, 2: temporal)

AccesspointGPRS

STRING [98]

APN: Nombre del punto de acceso del operador de red
GSM a Internet

AccesspointUser

STRING [42]

Nombre de usuario APN

AccesspointPassword

STRING [22]

Contrase√±a APN

Bloque para el √°rea de par√°metros "Identificaci√≥n CP"
Tabla 4-472 IF_CONF_Login
Par√°metro

Tipo de datos

Valor inicial
5

Descripci√≥n

Id

UINT

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 54

Identificaci√≥n del bloque de par√°metros

Mode

UINT

Validez (1: permanente, 2: temporal)

ModemName

STRING [22]

ID de acceso
El valor no es parametrizable.

ModemPassword

STRING [22]

Contrase√±a de Telecontrol (m√°x. 20 caracteres)
La contrase√±a del CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) no
puede cambiarse con el SDT.

Bloque para el √°rea de par√°metros "Acceso al servidor Telecontrol"
Este bloque solo debe utilizarse si el servidor Telecontrol se direcciona con un nombre que
puede resolverse mediante DNS. Si el servidor Telecontrol se direcciona con su direcci√≥n IP,
se utilizar√° el bloque "IF_CONF_TCS_IP_V4".
En STEP 7, los datos correspondientes se encuentran en el √°rea de par√°metros "Modo de
operaci√≥n".

7544

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Si hay varios servidores Telecontrol, utilice el bloque una vez por servidor.
Tabla 4-473 IF_CONF_TCS_Name
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

6

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 266

Mode

UINT

Validez (1: permanente, 2: temporal)

TcsName

-

-

STRING [254]

- reservado Nombre del servidor Telecontrol que puede resolverse me‚Äê
diante DNS

RemotePort

UINT

Puerto del servidor Telecontrol

Rank

UINT

Prioridad del servidor [1, 2]
1 = primer servidor Telecontrol,
2 = segundo servidor Telecontrol

Bloque para el √°rea de par√°metros "Acceso al servidor Telecontrol"
El SDT solo puede utilizarse en el CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) en tiempo de ejecuci√≥n
con fines de configuraci√≥n.
Este bloque solo debe utilizarse si el servidor Telecontrol se direcciona con su direcci√≥n IP. Si
el servidor Telecontrol se direcciona con su nombre DNS, se utiliza el bloque
"IF_CONF_TCS_Name".
En STEP 7, los datos correspondientes se encuentran en el √°rea de par√°metros "Modo de
operaci√≥n".
Si hay varios servidores Telecontrol, utilice el bloque una vez por servidor.
Tabla 4-474 IF_CONF_TCS_IP_v4
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

7

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 14

Mode

UINT

Validez (1: permanente, 2: temporal)

RemoteAddress

IP_V4

Direcci√≥n IP del servidor Telecontrol

RemotePort

UINT

Puerto del servidor Telecontrol

Rank

UINT

Prioridad del servidor [1, 2]
1 = primer servidor Telecontrol,
2 = segundo servidor Telecontrol

Bloque para el √°rea de par√°metros "Modo de operaci√≥n"
El SDT solo puede utilizarse en el CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) en tiempo de ejecuci√≥n
con fines de configuraci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7545

Instrucciones
4.2 Instrucciones
En STEP 7, los datos correspondientes se encuentran en las secciones de par√°metros "Modo
de operaci√≥n" y "Configuraci√≥n del m√≥dem".
Tabla 4-475 IF_CONF_GPRS_Mode
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

8

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 10

Mode

UINT

Validez (1: permanente, 2: temporal)

GPRSmode

UINT

Modo de operaci√≥n del CP:
‚óè 0 = Telecontrol
‚óè 1 = GPRS directo

TemporaryStation

BOOL

Bit 0: Conexi√≥n temporal
Si la opci√≥n est√° activada, el CP establece un enlace de
forma temporal para enviar datos. Una vez finalizada co‚Äê
rrectamente la transferencia de los telegramas, el CP des‚Äê
hace la conexi√≥n.
‚óè 1: activado (conexi√≥n temporal)
‚óè 0: desactivado (enlace permanente)

SMS_Enabled

BOOL

Bit 1: Permitir SMS
La activaci√≥n de esta opci√≥n permite a la estaci√≥n S7 en‚Äê
viar SMS.
‚óè 1: activado (se permite SMS)
‚óè 0: desactivado (sin SMS)

Bloque para el par√°metro "SMSC"
En STEP 7, los datos correspondientes se encuentran en el √°rea de par√°metros
"Configuraci√≥n del m√≥dem".
Tabla 4-476 IF_CONF_SMS_Provider
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

10

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 28

Mode

UINT

Validez (1: permanente, 2: temporal)

SMSProvider

STRING [20]

N√∫mero de dispositivo de la central SMS (SMSC) del ope‚Äê
rador de red GSM con el que se ha cerrado el contrato de
telefon√≠a m√≥vil para esta estaci√≥n.

7546

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloque para el par√°metro "PIN"
En STEP 7, los datos correspondientes se encuentran en el √°rea de par√°metros
"Configuraci√≥n del m√≥dem".
Tabla 4-477 IF_CONF_PIN
Tipo de datos

Valor inicial

Id

UINT

11

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 16

Mode

UINT

Validez (1: permanente, 2: temporal)

Pin

STRING [8]

PIN de la tarjeta SIM insertada en el CP

Par√°metro

Descripci√≥n
Identificaci√≥n del bloque de par√°metros

Este par√°metro no es relevante si se ha configurado el PIN
correctamente. En caso de haber configurado el PIN err√≥‚Äê
neamente, el PIN correcto puede introducirse aqu√≠.

Bloque para tiempos de vigilancia
El SDT solo puede utilizarse en el CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) en tiempo de ejecuci√≥n
con fines de configuraci√≥n.
En STEP 7, los datos correspondientes se encuentran en las √°reas de par√°metros "Tiempo de
espera Keep Alive" y "Modo de operaci√≥n" del CP.
Tabla 4-478 IF_CONF_TC_Timeouts
Par√°metro

Tipo de datos

Valor inicial
12

Id

UINT

Length

UINT

Mode

UINT

KeepAliveTimeout

‚Äë

SendTimeout

UINT

Descripci√≥n
Identificaci√≥n del bloque de par√°metros
Tama√±o del bloque de par√°metros en bytes: 12
Validez (1: permanente, 2: temporal)

‚Äë

- Reservado - (no parametrizable)
Tiempo de vigilancia de conexi√≥n: Tiempo de vigilancia de
la conexi√≥n con el interlocutor (segundos)
Relevante en los modos de operaci√≥n "Telecontrol" y
"GPRS directo"

RedialTimeout

UINT

Retardo al establecer la conexi√≥n: valor b√°sico del tiempo
de espera hasta el pr√≥ximo intento de establecer un enlace
despu√©s de fallar el presente. Cada 3 intentos se duplica el
valor b√°sico, hasta 900 s como m√°ximo. Rango de valores:
10...600 s.
Ejemplo: un valor b√°sico de 20 da los siguientes intervalos
de llamada: tres veces 20 s, tres veces 40 s, tres veces 80
s, etc. hasta un m√°ximo de 900 s.
Si se ha configurado un segundo servidor de Telecontrol /
router, en el cuarto intento el CP tratar√° de conectarse con
el segundo interlocutor. Si tampoco puede conectarse al
segundo interlocutor, el CP intenta en el 7.¬∫ intento volver
a conectarse con el primer interlocutor.
Sin relevancia para conexiones SMS

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7547

Instrucciones
4.2 Instrucciones

Bloque para el √°rea de par√°metros "Autorizaci√≥n de alarma"
Tabla 4-479 IF_CONF_WakeupList
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

13

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 246

Mode

UINT

Validez (1: permanente, 2: temporal)

WakeupPhone [1...10]

ARRAY
[1...10] of
STRING [22]

N√∫mero de llamada del dispositivo autorizado como des‚Äê
pertador
El asterisco (*) al final de un n√∫mero de abonado sirve de
comod√≠n para n√∫meros con extensiones.

Bloque para el √°rea de par√°metros "Redes GSM preferentes"
Tabla 4-480 IF_CONF_PrefProvider
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

14

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 46

Mode

UINT

Validez (1: permanente, 2: temporal)

Provider [1...5]

ARRAY [1...5]
of STRING [6]

Redes GSM alternativas con prioridad 1 a 5, a las que se
conecta el CP de forma preferente. Es posible configurar 5
redes como m√°ximo. La n.¬∫ 1 tiene la m√°xima prioridad y la
n.¬∫ 5 la m√≠nima.
Entrada del Public Land Mobile Network (PLMN) del ope‚Äê
rador de red, consistente en Mobile Country Code (MCC) y
Mobile Network Code (MNC).
Ejemplo (red de pruebas de Siemens AG): 26276

Bloque para el √°rea de par√°metros "Configuraci√≥n DNS"
El SDT solo puede utilizarse en el CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) en tiempo de ejecuci√≥n
con fines de configuraci√≥n.
Tabla 4-481 IF_CONF_DNS
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

16

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 14

Mode

UINT

Validez (1: permanente, 2: temporal)

DNS_IP [1]

IP_V4

Direcci√≥n IP del 1.er servidor Domain Name System

DNS_IP [2]

IP_V4

Direcci√≥n IP del 2.¬∫ servidor Domain Name System

7548

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Bloque para el √°rea de par√°metros "Sincronizaci√≥n horaria"
El SDT solo puede utilizarse en el CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) en tiempo de ejecuci√≥n
con fines de configuraci√≥n.
Tabla 4-482 IF_CONF_NTP
Par√°metro

Tipo de datos

Valor inicial

Id

UINT

17

Length

UINT

Descripci√≥n
Identificaci√≥n del bloque de par√°metros
Tama√±o del bloque de par√°metros en bytes: 24

Mode

UINT

Validez (1: permanente, 2: temporal)

NTP_IP [1]

ARRAY [1...4]
of IP_V4

Direcci√≥n IP del servidor NTP 1

...

...

(direcci√≥n IP del servidor NTP 2...3)

NTP_IP [4]

ARRAY [1...4]
of IP_V4

Direcci√≥n IP del servidor NTP 4

Bloque para activar / desactivar usuarios de TeleService
El SDT solo puede utilizarse en el CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) en tiempo de ejecuci√≥n
con fines de configuraci√≥n.
SDT para activar o desactivar usuarios de TeleService que ya se han configurado en el
proyecto STEP 7 del CP. En STEP 7, los datos correspondientes se encuentran en el √°rea de
par√°metros "Configuraci√≥n TeleService" > "Administraci√≥n de usuarios de TeleService".
Tabla 4-483 IF_CONF_GPRS_UserList
Par√°metro

Tipo de datos

Valor inicial

Descripci√≥n

Id

UINT

19

Identificaci√≥n del bloque de par√°metros

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 506

Mode

UINT

Validez (1: permanente, 2: temporal)

GPRS_User [1...10]

ARRAY
[1...10] of
GPRS_User

Usuarios de TeleService de n.¬∫ 1 a n.¬∫ 10 como m√°ximo

La matriz se forma a partir de los juegos de par√°metros para los usuarios de TeleService
("GPRS_User" [1...n]).
Tabla 4-484 GPRS_User [n] (par√°metro para usuarios de TeleService)
Valor inicial

Descripci√≥n

Par√°metro

Tipo de datos

UserName [n]

STRING [22]

Nombre de usuario de TeleService

Password [n]

STRING [22]

- El string tiene que estar vac√≠o -

Diag_Allowed [n]

BOOL

- Reservado - (no parametrizable)

Teleserv_Allowed [n]

BOOL

Activaci√≥n del usuario de TeleService
‚óè 0 = usuario desactivado
‚óè 1 = usuario activado

FW_Load_Allowed [n]

BOOL

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

- Reservado - (no parametrizable)

7549

Instrucciones
4.2 Instrucciones

Bloque para la parametrizaci√≥n del acceso TeleService (Nombre DNS del servidor)
Datos de acceso del servidor de TeleService (centralita).
En STEP 7, los datos correspondientes se encuentran en el √°rea de par√°metros
"Configuraci√≥n TeleService".
Si hay dos servidores de TeleService, utilice el bloque una vez por servidor.
Tabla 4-485 IF_CONF_TS_Name
Tipo de datos

Valor inicial

Id

UINT

20

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 266

Mode

UINT

Validez (1: permanente, 2: temporal)

ts_name

String [254]

Nombre del servidor de TeleService que puede resolverse
mediante DNS

Par√°metro

Descripci√≥n
Identificaci√≥n del bloque de par√°metros

RemotePort

UINT

Puerto de la estaci√≥n de ingenier√≠a

Rank

UINT

Prioridad del servidor [1] o [2]
1 = servidor 1, 2 = servidor 2

Bloque para la parametrizaci√≥n del acceso TeleService (direcci√≥n IP del servidor)
Datos de acceso del servidor de TeleService (centralita).
En STEP 7, los datos correspondientes se encuentran en el √°rea de par√°metros
"Configuraci√≥n TeleService".
Si hay dos servidores de TeleService, utilice el bloque una vez por servidor.
Tabla 4-486 IF_CONF_TS_IF_V4
Par√°metro

Tipo de datos

Valor inicial
21

Descripci√≥n

Id

UINT

Length

UINT

Tama√±o del bloque de par√°metros en bytes: 14

Identificaci√≥n del bloque de par√°metros

Mode

UINT

Validez (1: permanente, 2: temporal)

RemoteAddress

IP_V4

Direcci√≥n IP del servidor de TeleService

RemotePort

UINT

Puerto del servidor de TeleService

Rank

UINT

Prioridad del servidor [1] o [2]
1 = servidor 1, 2 = servidor 2

7550

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

S7-300/400-CP
CP 443-1 OPC UA
Bloques de programa para el cliente UA OPC
Sinopsis de los bloques de programa para la funci√≥n de cliente OPC UA
Para la funci√≥n de cliente OPC UA del CP, en la librer√≠a "SIMATIC NET CP" existen los bloques
de funci√≥n indicados a continuaci√≥n. Utilice los bloques en la CPU.
Algunos bloques requieren tipos de datos PLC personalizados especiales (UDT), que
encontrar√° a continuaci√≥n debajo del bloque de programa correspondiente. Los UDT est√°n
disponibles como tipos de datos preconfeccionados. Para ello, cree un tipo de datos nuevo en
la entrada "Tipos de datos PLC" de la estaci√≥n y escriba en el campo "Tipo de datos" el nombre
del UDT, p. ej. "UA_SessionConnectInfo". Seguidamente, los par√°metros necesarios en cada
caso se crear√°n de forma autom√°tica en la tabla de declaraci√≥n del UDT.
‚óè UA_Connect
Establece una conexi√≥n para una sesi√≥n con un servidor OPC UA.
‚Äì UA_SessionConnectInfo
Contiene la informaci√≥n de conexi√≥n para el par√°metro de bloque "SessionConnectInfo".
‚Äì UA_UserIdentityToken
Contiene los datos de la autenticaci√≥n de usuario para el par√°metro de bloque
"UserIdentityToken".
‚óè UA_NamespaceGetIndex
Recoge el √≠ndice de espacio de nombre de una URI de espacio de nombre.
‚óè UA_NodeGetHandleList
Registra ID de nodo en el servidor conectado y recoge los handles de nodo en forma de lista.
‚Äì UA_NodeID
Contiene los par√°metros para la identificaci√≥n del nodo de destino para el par√°metro de
bloque "NodeID".
‚óè UA_NodeReleaseHandleList
Libera los handles de nodo de la lista utilizada en el servidor.
‚óè UA_Disconnect
Establece la conexi√≥n de una sesi√≥n actual con un servidor OPC UA.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7551

Instrucciones
4.2 Instrucciones
‚óè UA_ReadList
Lee los datos de nodos del servidor conectado con ayuda de la lista.
‚Äì UA_NodeAdditionalInfo
Especifica el atributo Item y el rango de √≠ndices para el par√°metro de bloque
"NodeAddInfos".
‚Äì UA_IndexRange
Determina los √≠ndices de inicio y fin para el par√°metro de bloque "IndexRange".
‚Äì UA_AnyPointer
Refiere al √°rea de memoria de la CPU en la que se depositan los datos de proceso para
el par√°metro de bloque "Variables".
‚Äì UA_TimeStamps
Contiene el sello de tiempo de los elementos del √°rea de datos del par√°metro de bloque
"Variables".
‚óè UA_WriteList
Escribe datos en nodos del servidor conectado con ayuda de la lista de los handles de nodo.
‚Äì UA_NodeAdditionalInfo
Especifica el atributo Item y el rango de √≠ndices para el par√°metro de bloque
"NodeAddInfos".
‚Äì UA_IndexRange
Determina los √≠ndices de inicio y fin para el par√°metro de bloque "IndexRange".
‚Äì UA_AnyPointer
Refiere al √°rea de memoria de la CPU en la que est√°n depositados los datos de proceso
para el par√°metro de bloque "Variables".

Funciones de sistema (SFC) necesarias adicionalmente
Para que los bloques de programa para el cliente UA OPC funcionen por completo se
necesitan las funciones de sistema siguientes:
‚óè BLKMOV (SFC20)
‚óè TIME_TCK (SFC64)
UA_Connect necesita adicionalmente para su funcionamiento:
‚óè LGC_GADR (SFC49)
‚óè RDSYSST (SFC51)
Creaci√≥n de las SFCs
Cree las funciones de sistema abriendo un bloque de organizaci√≥n (p. ej. OB1) en el directorio
de bloques de la CPU.
En el cat√°logo de bloques que se muestra al abrir el OB1, despliegue el grupo de bloques
correspondiente.
Encontrar√° las SFCs en las siguientes carpetas de bloque:
‚óè BLKMOV (SFC20): Grupo "Instrucciones b√°sicas" > carpeta "Mover"
‚óè TIME_TCK (SFC64): Grupo "Instrucciones avanzadas" > carpeta "Fecha y hora"

7552

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
‚óè LGC_GADR (SFC 49): Grupo "Instrucciones avanzadas" > carpeta "Direccionamiento"
‚óè RDSYSST (SFC 51): Grupo "Instrucciones avanzadas" > carpeta "Diagn√≥stico"
Arrastre las SFCs al segmento del bloque de organizaci√≥n y suministre los par√°metros de las
SFCs.

Llamada e interacci√≥n de los bloques de programa
Nota
Indicaciones generales sobre los bloques de programa y los DBs de instancia
Cree los bloques de funci√≥n con "acceso est√°ndar". Deje la opci√≥n "Remanencia" desactivada
en los bloques de datos de instancia que se asignan en cada caso.
Cada bloque de programa debe llamarse c√≠clicamente hasta que el par√°metro de estado
"Done" o "Error" cambie a 1.
Dentro de la sesi√≥n solo se puede llamar un √∫nico bloque simult√°neamente. Dentro de una
sesi√≥n los bloques diferentes solo pueden editarse uno despu√©s de otro.
Con UA_Connect se establece una conexi√≥n entre el CP como cliente OPC UA y un servidor
UA abriendo as√≠ una sesi√≥n. El bloque debe llamarse para cada conexi√≥n con un servidor UA.
En caso necesario, para m√°s de una conexi√≥n con un servidor UA el bloque puede llamarse
varias veces con bloques de datos de instancia (IDB) diferentes. Esto puede utilizarse, por
ejemplo, para leer una conexi√≥n y escribir a trav√©s de una segunda conexi√≥n o para leer o
escribir diferentes datos a trav√©s de varias conexiones.
Para conexiones con varios servidores UA es necesario llamar el bloque UA_Connect varias
veces con par√°metros de entrada distintos. Como cliente UA el CP puede establecer
conexiones con hasta cinco servidores UA.
Para consultar el √≠ndice de espacio de nombre de una URI de espacio de nombre del servidor
UA, llame un UA_NamespaceGetIndex dentro de la sesi√≥n. Para consultar varios URIs de
espacio de nombre el bloque se puede llamar varias veces con par√°metros de entrada
distintos.
Para crear una lista de handles como preparaci√≥n de los servicios de lectura y escritura llame
la UA_NodeGetHandleList. El bloque se llama por separado para cada nodo de destino con la
informaci√≥n correspondiente en el par√°metro de entrada "NodeIDs".
A continuaci√≥n se pueden leer y escribir los datos del item a trav√©s de los bloques UA_ReadList
y UA_WriteList. Ambos bloques pueden llamarse tantas veces como se desee dentro de una
misma sesi√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7553

Instrucciones
4.2 Instrucciones
(VWDEOHFLPLHQWRGHXQDVHVL¬µQ
3UHSDUDFL¬µQSDUDOHHUHVFULELU
8$B&RQQHFW
8$B1DPH6SDFH*HW,QGH[
8$B1RGH*HW+DQGOH/LVW

8$B5HDG/LVW

7HUPLQDFL¬µQGHXQDVHVL¬µQ

RELHQ

8$B1RGH5HOHDVH+DQGOH/LVW

8$B:ULWH/LVW

8$B'LVFRQQHFW

Figura 4-80

Llamada e interacci√≥n de los bloques de programa cliente

Cuando la conexi√≥n ya no sea necesaria, vuelva a liberar handles en el servidor mediante el
bloque UA_NodeReleaseHandleList. De ese modo los handles se vuelven a borrar en el
servidor.
La conexi√≥n se deshace con UA_Disconnect, con lo que tambi√©n se cierra la sesi√≥n.

Consulte tambi√©n
Vigilancia temporal de los bloques (P√°gina 7554)

Vigilancia temporal de los bloques
Par√°metros del comportamiento temporal de los bloques
Para el control y la vigilancia del comportamiento temporal de los bloques de programa est√°n
disponibles los tres par√°metros siguientes:
‚óè Timeout
Par√°metro de entrada en todos los bloques para el cliente OPC UA
‚óè SessionTimeout
Par√°metro de entrada en el bloque UA_Connect
‚óè MonitorConnection
Par√°metro de entrada en el bloque UA_Connect
Puesto que los par√°metros influyen en conjunto en la ejecuci√≥n de la comunicaci√≥n OPC UA,
a continuaci√≥n se incluyen indicaciones relativas a estos par√°metros antes de la descripci√≥n
de los bloques propiamente dicha.

Timeout
Este par√°metro de entrada vigila todas las llamadas de un bloque. Si una llamada de bloque
no puede finalizarse dentro del tiempo m√°ximo admisible que se ha configurado en cada caso,
el par√°metro de estado "Error" se pone a 1 y se cancela la ejecuci√≥n.

7554

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

SessionTimeout
Este par√°metro de entrada vigila la duraci√≥n de una sesi√≥n sin tr√°fico de datos sin que el
bloque "UA_Disconnect" se llame para deshacer una conexi√≥n.
El valor m√≠nimo de "SessionTimeout" suele ser de 30 segundos. Si se rebasa este valor se
deshace la conexi√≥n.
Este par√°metro permite a un servidor liberar recursos vinculados cuando el cliente no utiliza la
sesi√≥n durante un tiempo prolongado.
Un tiempo suficientemente largo, en cambio, garantiza que una sesi√≥n no se cierre
inmediatamente cuando no es posible transferir datos en seguida a causa de fallos en la red,
por ejemplo.
Por norma general, el valor de "SessionTimeout" deber√≠a ser mayor que los valores de
"Timeout" en los bloques "UA_Connect" utilizados.

MonitorConnection
Este par√°metro de entrada comprueba el estado de una conexi√≥n sin tr√°fico de datos. Una vez
transcurrido este tiempo de vigilancia de conexi√≥n se env√≠a un telegrama para comprobar el
estado de la conexi√≥n con el servidor.
Para que la sesi√≥n no se cancele en seguida mediante el par√°metro "SessionTimeout" en caso
de ausencia de tr√°fico de datos y de activaci√≥n del tiempo de vigilancia de conexi√≥n, se
recomienda elegir para "MonitorConnection" un valor inferior a la mitad de "SessionTimeout".

Consulte tambi√©n
Bloques de programa para el cliente UA OPC (P√°gina 7551)

UA_Connect
Funci√≥n
Funci√≥n del bloque
Con el bloque UA_Connect se establece una conexi√≥n entre el CP como cliente OPC UA y un
servidor UA, abriendo as√≠ una sesi√≥n.
Como direcci√≥n de destino indique la URL del servidor UA en el par√°metro
"ServerEndpointUrl".
Los datos correspondientes a la informaci√≥n de la conexi√≥n del par√°metro
"SessionConnectInfo" se guardan en un bloque de datos.
UA_Connect requiere adem√°s las funciones de sistema LGC_GADR (SFC 49) y RDSYSST
(SFC 51).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7555

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Par√°metros (P√°gina 7556)
Bloques de programa para el cliente UA OPC (P√°gina 7551)

Par√°metros
Par√°metros de bloque
En la tabla siguiente se explican los par√°metros formales del bloque de programa.
Tabla 4-487 Par√°metros del bloque UA_Connect
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Execute

IN

BOOL

0, 1

Un flanco ascendente 0 ‚Üí 1 en el par√°metro ini‚Äê
cia el procesamiento del bloque.

ServerEndpointUrl

IN

STRING

M√°x. 254 caracte‚Äê
res

Direcci√≥n (URL) del interlocutor (servidor). Solo
se admiten direcciones IPv4.

SessionConnectInfo

IN

UDT

V√©ase "Significa‚Äê
do"

Informaci√≥n de la conexi√≥n, v√©ase UASession‚Äê
ConnectInfo (P√°gina 7570).

Timeout

IN

TIME

5000 .. 120000

Intervalo m√°ximo para el establecimiento de la
conexi√≥n en milisegundos. Si se rebasa este va‚Äê
lor, el procesamiento del bloque se cancela con
el n√∫mero de error B0007001.
Si se realizan entradas fuera del rango permiti‚Äê
do, se aplica el valor predeterminado de 60000
(60 segundos).

ConnectionHdl

OUT

DWORD

1 .. 5

Identificador un√≠voco de una conexi√≥n estableci‚Äê
da
Este es requerido por otros bloques como par√°‚Äê
metro de entrada.

Done

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: procesamiento de bloque cancelado, a√∫n
no finalizado o a√∫n no iniciado
‚óè 1: el bloque se ha procesado sin errores

Busy

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: el bloque no se est√° procesando
‚óè 1: el bloque se est√° procesando

7556

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Error

OUT

BOOL

0, 1

Indicaci√≥n de error
‚óè 0: sin error
‚óè 1: se ha producido un error. Consulte el
par√°metro "ErrorID".

ErrorID

OUT

DWORD

V√©ase "Significa‚Äê
do"

Indicaci√≥n del n√∫mero de error si "Error" = 1.
Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).
Nota: Si se emite el c√≥digo de error B000F002, la
sesi√≥n OPC UA todav√≠a no est√° establecida.
Vuelva a llamar el bloque.

UA_NamespaceGetIndex
Funci√≥n
Funci√≥n del bloque
Con el bloque UA_NamespaceGetIndex se recoge el √≠ndice de espacio de nombre de la URI
de espacio de nombre del servidor UA conectado.

Consulte tambi√©n
Par√°metros (P√°gina 7557)
Bloques de programa para el cliente UA OPC (P√°gina 7551)

Par√°metros
Par√°metros de bloque
En la tabla siguiente se explican los par√°metros formales del bloque de programa.
Tabla 4-488 Par√°metros del bloque UA_NamespaceGetIndex
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Execute

IN

BOOL

0, 1

Un flanco ascendente 0 ‚Üí 1 en el par√°metro ini‚Äê
cia el procesamiento del bloque. Mientras Exe‚Äê
cute sea 1, los par√°metros de entrada restantes
no pueden modificarse.

ConnectionHdl

IN

DWORD

1 .. 5

Identificaci√≥n de conexi√≥n suministrado por
UA_Connect

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7557

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

NamespaceUri

IN

STRING

M√°x. 254 caracte‚Äê
res

Indicaci√≥n de la direcci√≥n (URI de espacio de
nombre) del servidor de destino
Ejemplo del espacio de nombre de los s√≠mbolos
de CPU en el S7‚Äë400 con CP 443‚Äë1 OPC UA:
http://www.siemens.com/simatic-classic-s7-op‚Äê
cua

Timeout

IN

TIME

5000 .. 120000

Intervalo m√°ximo para el establecimiento de la
conexi√≥n en milisegundos. Si se rebasa este va‚Äê
lor, el procesamiento del bloque se cancela con
el n√∫mero de error B0007001.
Si se realizan entradas fuera del rango permiti‚Äê
do, se aplica el valor predeterminado de 60000
(60 segundos).

NamespaceIndex

OUT

WORD

0 .. 65535

Se deposita el √≠ndice de espacio de nombre del
espacio de nombre indicado en el par√°metro
"NamespaceUri".
Los √≠ndices de espacio de nombre 0 y 1 est√°n
reservados y especificados por la OPC Founda‚Äê
tion.

Done

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: procesamiento de bloque cancelado, a√∫n
no finalizado o a√∫n no iniciado
‚óè 1: el bloque se ha procesado sin errores

Busy

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: el bloque no se est√° procesando
‚óè 1: el bloque se est√° procesando

Error

OUT

BOOL

0, 1

Indicaci√≥n de error
‚óè 0: sin error
‚óè 1: se ha producido un error. Consulte el
par√°metro "ErrorID".

ErrorID

OUT

DWORD

V√©ase "Significa‚Äê
do"

Indicaci√≥n del n√∫mero de error si "Error" = 1.
Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

UA_NodeGetHandleList
Funci√≥n
Funci√≥n del bloque
Con el bloque UA_NodeGetHandleList se registran ID de nodo en el servidor UA conectado.

7558

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El servidor UA devuelve los handles. El bloque deposita dichos handles en el par√°metro
"NodeHdls" A los items de los handles de nodo se accede con los bloques "UA_ReadList" y
"UA_WriteList" en el par√°metro de entrada "NodeHdls".
Los IDs de nodo del servidor de destino especificados en el par√°metro de entrada "NodeIDs"
deben conocerse. Se depositan en un UDT "UANodeIDs".
El n√∫mero de nodos de destino en el par√°metro de entrada "NodeIDCount" siempre es 1, por
lo que hay que llamar el bloque por separado para cada ID de nodo.

Consulte tambi√©n
Par√°metros (P√°gina 7559)
Bloques de programa para el cliente UA OPC (P√°gina 7551)

Par√°metros
Par√°metros de bloque
En la tabla siguiente se explican los par√°metros formales del bloque de programa.
Tabla 4-489 Par√°metros del bloque UA_NodeGetHandleList
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Execute

IN

BOOL

0, 1

Un flanco ascendente 0 ‚Üí 1 en el par√°metro ini‚Äê
cia el procesamiento del bloque.

ConnectionHdl

IN

DWORD

1 .. 5

Identificaci√≥n de conexi√≥n suministrado por
UA_Connect

NodeIDCount

IN

WORD

1

N√∫mero de elementos en el √°rea de datos de
"NodeIDs". El n√∫mero debe ser 1.

NodeIDs

IN

ARRAY of
UDT

V√©ase "Significa‚Äê
do"

Estructura de los par√°metros del nodo de desti‚Äê
no del servidor OPC UA.
El n√∫mero de IDs de nodo (1) debe ser id√©ntico
al n√∫mero depositado en el par√°metro de salida
"NodeHdls".
Respecto a la estructura de UDT consulte UA‚Äê
NodeID (P√°gina 7572).

Timeout

IN

TIME

5000 .. 120000

Intervalo m√°ximo para el establecimiento de la
conexi√≥n en milisegundos. Si se rebasa este va‚Äê
lor, el procesamiento del bloque se cancela con
el n√∫mero de error B0007001.
Si se realizan entradas fuera del rango permiti‚Äê
do, se aplica el valor predeterminado de 60000
(60 segundos).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7559

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

NodeHdls

OUT

ARRAY of
DWORD

0 .. 4 294 967 295

Matriz de los handles que el servidor OPC UA
devuelve como respuesta a la solicitud del clien‚Äê
te. Los handles permiten identificar un√≠vocamen‚Äê
te el item en el servidor.
Los handles son v√°lidos hasta que son reempla‚Äê
zados o pierden la validez debido a la llamada
del bloque UA_NodeReleaseHandleList.
Cuando se cierra la sesi√≥n, el CP deshace todos
los handles de nodos registrados de dicha se‚Äê
si√≥n.
El par√°metro se utiliza para el par√°metro de en‚Äê
trada "NodeHdls" de los bloques "UA_ReadList"
y "UA_WriteList".

Done

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: procesamiento de bloque cancelado, a√∫n
no finalizado o a√∫n no iniciado
‚óè 1: el bloque se ha procesado sin errores

Busy

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: el bloque no se est√° procesando
‚óè 1: el bloque se est√° procesando

Error

OUT

BOOL

0, 1

Indicaci√≥n de error
‚óè 0: sin error
‚óè 1: se ha producido un error. Consulte el
par√°metro "ErrorID".

ErrorID

OUT

NodeErrorIDs

OUT

DWORD

ARRAY of
DWORD

V√©ase "Significa‚Äê
do"

Indicaci√≥n del n√∫mero de error si "Error" = 1.

V√©ase "Significa‚Äê
do"

Contiene los n√∫meros de error para todos los
elementos del √°rea de datos de "NodeIDs".

Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

UA_NodeReleaseHandleList
Funci√≥n
Funci√≥n del bloque
Con el bloque UA_NodeReleaseHandleList se liberan los handles de nodo de la sesi√≥n actual
en el servidor UA conectado. Con ello se borra la lista.
El par√°metro de entrada "NodeHdls" referencia el bloque de datos en el que se escribieron los
handles del par√°metro de salida "NodeHdls" del bloque "UA_NodeGetHandleList".

7560

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El n√∫mero de handles en el par√°metro de entrada "NodeHdICount" siempre es 1, por lo que
hay que llamar el bloque por separado para cada handle.

Consulte tambi√©n
Par√°metros (P√°gina 7561)
Bloques de programa para el cliente UA OPC (P√°gina 7551)

Par√°metros
Par√°metros de bloque
En la tabla siguiente se explican los par√°metros formales del bloque de programa.
Tabla 4-490 Par√°metros del bloque UA_NodeReleaseHandleList
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado / Observaci√≥n

Execute

IN

BOOL

0, 1

Un flanco ascendente 0 ‚Üí 1 en el par√°metro ini‚Äê
cia el procesamiento del bloque.

ConnectionHdl

IN

DWORD

1 .. 5

Identificaci√≥n de conexi√≥n suministrado por
UA_Connect

NodeHdlCount

IN

WORD

1

N√∫mero de elementos en el √°rea de datos de
"NodeHdls". El n√∫mero debe ser 1.

NodeHdls

IN

ARRAY of
DWORD

0 .. 4 294 967 295

Matriz de los IDs de los handles reemplazados.

TIME

5000 .. 120000

Timeout

IN

Si el bloque se procesa correctamente, los han‚Äê
dles se reemplazar√°n en el servidor, por lo que
perder√°n su validez.
Intervalo m√°ximo para el establecimiento de la
conexi√≥n en milisegundos. Si se rebasa este va‚Äê
lor, el procesamiento del bloque se cancela con
el n√∫mero de error B0007001.
Si se realizan entradas fuera del rango permiti‚Äê
do, se aplica el valor predeterminado de 60000
(60 segundos).

Done

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: procesamiento de bloque cancelado, a√∫n
no finalizado o a√∫n no iniciado
‚óè 1: el bloque se ha procesado sin errores

Busy

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: el bloque no se est√° procesando
‚óè 1: el bloque se est√° procesando

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7561

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado / Observaci√≥n

Error

OUT

BOOL

0, 1

Indicaci√≥n de error
‚óè 0: sin error
‚óè 1: se ha producido un error. Consulte el
par√°metro "ErrorID".

ErrorID

OUT

NodeErrorIDs

OUT

DWORD

ARRAY of
DWORD

V√©ase "Significa‚Äê
do"

Indicaci√≥n del n√∫mero de error si "Error" = 1.

V√©ase "Significa‚Äê
do"

Contiene c√≥digos de error para todos los ele‚Äê
mentos del √°rea de datos de "NodeHdls".

Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

UA_Disconnect
Funci√≥n
Funci√≥n del bloque
Con el bloque UA_Disconnect se deshace una conexi√≥n existente entre el CP como cliente
OPC UA y un servidor UA. De ese modo finaliza la sesi√≥n existente.

Consulte tambi√©n
Bloques de programa para el cliente UA OPC (P√°gina 7551)

Par√°metros
Par√°metros de bloque
En la tabla siguiente se explican los par√°metros formales del bloque de programa.
Tabla 4-491 Par√°metros del bloque UA_Disconnect
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Execute

IN

BOOL

0, 1

Un flanco ascendente 0 ‚Üí 1 en el par√°metro ini‚Äê
cia el procesamiento del bloque.

ConnectionHdl

IN

DWORD

1 .. 5

Identificaci√≥n de conexi√≥n suministrado por
UA_Connect

Timeout

IN

TIME

5000 .. 120000

Intervalo m√°ximo para el establecimiento de la
conexi√≥n en milisegundos. Si se rebasa este va‚Äê
lor, el procesamiento del bloque se cancela con
el n√∫mero de error B0007001.
Si se realizan entradas fuera del rango permiti‚Äê
do, se aplica el valor predeterminado de 60000
(60 segundos).

7562

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Done

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: procesamiento de bloque cancelado, a√∫n
no finalizado o a√∫n no iniciado
‚óè 1: el bloque se ha procesado sin errores

Busy

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: el bloque no se est√° procesando
‚óè 1: el bloque se est√° procesando

Error

OUT

BOOL

0, 1

Indicaci√≥n de error
‚óè 0: sin error
‚óè 1: se ha producido un error. Consulte el
par√°metro "ErrorID".

ErrorID

OUT

DWORD

V√©ase "Significa‚Äê
do"

Indicaci√≥n del n√∫mero de error si "Error" = 1.
Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

UA_ReadList
Funci√≥n
Funci√≥n del bloque
Con el bloque UA_ReadList se leen los datos del servidor UA conectado.
Los atributos le√≠dos se programan en un UDT "UANodeAdditionalInfo" referenciado por el
par√°metro de entrada "NodeAddInfos".
Los handles requeridos en el par√°metro de entrada "NodeHdls" se leen desde la matriz del
par√°metro de salida "NodeHdls" del bloque "UA_NodeGetHandleList".
El n√∫mero de IDs de nodo en el par√°metro de entrada "NodeIDCount" es 1, por lo que hay que
llamar el bloque por separado para cada nodo de destino.

Consulte tambi√©n
Par√°metros (P√°gina 7564)
Bloques de programa para el cliente UA OPC (P√°gina 7551)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7563

Instrucciones
4.2 Instrucciones

Par√°metros
Par√°metros de bloque
En la tabla siguiente se explican los par√°metros formales del bloque de programa.
Tabla 4-492 Par√°metros del bloque UA_ReadList
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Execute

IN

BOOL

0, 1

Un flanco ascendente 0 ‚Üí 1 en el par√°metro ini‚Äê
cia el procesamiento del bloque.

ConnectionHdl

IN

DWORD

1 .. 5

Identificaci√≥n de conexi√≥n suministrado por
UA_Connect

NodeHdlCount

IN

WORD

1

N√∫mero de elementos en el √°rea de destino le√≠‚Äê
da. El n√∫mero debe ser 1.

NodeHdls

IN

ARRAY of
DWORD

1

Matriz de los handles de los nodos de destino
(items) del servidor OPC UA. Los handles se
leen de la matriz del par√°metro de salida "No‚Äê
deHdls" del bloque "UA_NodeGetHandleList".

NodeAddInfos

IN

ARRAY of
UDT

V√©ase "Significa‚Äê
do"

Especifica el atributo le√≠do de los items y el rango
de √≠ndices. Respecto a la estructura de UDT
consulte UANodeAdditionalInfo (P√°gina 7573).

Timeout

IN

TIME

5000 .. 120000

Intervalo m√°ximo para el establecimiento de la
conexi√≥n en milisegundos. Si se rebasa este va‚Äê
lor, el procesamiento del bloque se cancela con
el n√∫mero de error B0007001.
Si se realizan entradas fuera del rango permiti‚Äê
do, se aplica el valor predeterminado de 60000
(60 segundos).

Variables

IN_OUT

UDT

V√©ase "Significa‚Äê
do"

Referencia a los datos le√≠dos. Respecto a la es‚Äê
tructura de UDT consulte UAAnyPointer (P√°gi‚Äê
na 7574).
Para m√°s informaci√≥n sobre los tipos de datos
soportados, consulte el cap√≠tulo Tipos de datos
(P√°gina 7567).

Done

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: procesamiento de bloque cancelado, a√∫n
no finalizado o a√∫n no iniciado
‚óè 1: el bloque se ha procesado sin errores

Busy

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: el bloque no se est√° procesando
‚óè 1: el bloque se est√° procesando

Error

OUT

BOOL

0, 1

Indicaci√≥n de error
‚óè 0: sin error
‚óè 1: se ha producido un error. Consulte el
par√°metro "ErrorID".

7564

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

ErrorID

OUT

DWORD

V√©ase "Significa‚Äê
do"

Indicaci√≥n del n√∫mero de error si "Error" = 1.

V√©ase "Significa‚Äê
do"

Contiene los n√∫meros de error para todos los
elementos del √°rea de datos de "Variables".

NodeErrorIDs

OUT

ARRAY of
DWORD

Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).
TimeStamps

OUT

UDT

V√©ase "Significa‚Äê
do"

Contiene sellos de tiempo para todos los ele‚Äê
mentos del √°rea de datos de "Variables". Res‚Äê
pecto a la estructura de UDT consulte UATimeS‚Äê
tamp (P√°gina 7574).

UA_WriteList
Funci√≥n
Funci√≥n del bloque
Con el bloque UA_WriteList se escriben los datos en el servidor UA conectado.
Los atributos que deben escribirse se programan en un UDT "UANodeAdditionalInfo"
referenciado por el par√°metro de entrada "NodeAddInfos".
Los handles requeridos en el par√°metro de entrada "NodeHdls" se leen desde la matriz del
par√°metro de salida "NodeHdls" del bloque "UA_NodeGetHandleList".
El n√∫mero de IDs de nodo en el par√°metro de entrada "NodeIDCount" es 1, por lo que hay que
llamar el bloque por separado para cada nodo de destino.

Consulte tambi√©n
Par√°metros (P√°gina 7566)
Bloques de programa para el cliente UA OPC (P√°gina 7551)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7565

Instrucciones
4.2 Instrucciones

Par√°metros
Par√°metros de bloque
En la tabla siguiente se explican los par√°metros formales del bloque de programa.
Tabla 4-493 Par√°metros del bloque UA_WriteList
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

Execute

IN

BOOL

0, 1

Un flanco ascendente 0 ‚Üí 1 en el par√°metro ini‚Äê
cia el procesamiento del bloque.

ConnectionHdl

IN

DWORD

1 .. 5

Identificaci√≥n de conexi√≥n suministrado por
UA_Connect

NodeHdlCount

IN

WORD

1

N√∫mero de elementos en el √°rea de destino es‚Äê
crita. El n√∫mero debe ser 1.

NodeHdls

IN

ARRAY of
DWORD

1

Matriz de los handles de los nodos de destino
(items) del servidor OPC UA. Los handles se
leen de la matriz del par√°metro de salida "No‚Äê
deHdls" del bloque "UA_NodeGetHandleList".

NodeAddInfos

IN

ARRAY of
UDT

V√©ase "Significa‚Äê
do"

Especifica el atributo escrito de los items y el
rango de √≠ndices. Respecto a la estructura de
UDT consulte UANodeAdditionalInfo (P√°gi‚Äê
na 7573).

Timeout

IN

TIME

5000 .. 120000

Intervalo m√°ximo para el establecimiento de la
conexi√≥n en milisegundos. Si se rebasa este va‚Äê
lor, el procesamiento del bloque se cancela con
el n√∫mero de error B0007001.
Si se realizan entradas fuera del rango permiti‚Äê
do, se aplica el valor predeterminado de 60000
(60 segundos).

Variables

IN_OUT

UDT

V√©ase "Significa‚Äê
do"

Referencia a los datos escritos. Respecto a la
estructura de UDT consulte UAAnyPointer (P√°‚Äê
gina 7574).
Para m√°s informaci√≥n sobre los tipos de datos
soportados, consulte el cap√≠tulo Tipos de datos
(P√°gina 7567).

Done

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: procesamiento de bloque cancelado, a√∫n
no finalizado o a√∫n no iniciado
‚óè 1: el bloque se ha procesado sin errores

Busy

OUT

BOOL

0, 1

Par√°metros de estado para el procesamiento del
bloque
‚óè 0: el bloque no se est√° procesando
‚óè 1: el bloque se est√° procesando

Error

OUT

BOOL

0, 1

Indicador de error
‚óè 0: sin error
‚óè 1: se ha producido un error. Consulte el
par√°metro "ErrorID".

7566

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos S7

Valores posibles

Significado

ErrorID

OUT

DWORD

V√©ase "Significa‚Äê
do"

Indicaci√≥n del n√∫mero de error si "Error" = 1.

V√©ase "Significa‚Äê
do"

Contiene los n√∫meros de error para todos los
elementos del √°rea de datos de "Variables".

NodeErrorIDs

OUT

ARRAY of
DWORD

Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

Respecto al significado de los n√∫meros, consul‚Äê
te el cap√≠tulo N√∫meros de error (P√°gina 7576).

Tipos de datos
Tipos de datos y √°reas de memoria
El CP 443‚Äë1 OPC UA soporta los tipos de datos indicados a continuaci√≥n para datos de
proceso.
Los s√≠mbolos correspondientes de la CPU se permiten para las √°reas de operandos indicadas
en cada caso. Las √°reas de memoria tienen las abreviaturas siguientes. Las siglas entre
par√©ntesis son las abreviaturas relacionadas con la nem√≥nica ajustada (alem√°n/ingl√©s).
‚óè E = memoria imagen de proceso de las entradas (E/I)
‚óè A= memoria imagen de proceso de las salidas (A/Q)
‚óè PE = √°rea de periferia de las entradas (PE/PI)
‚óè PA = √°rea de periferia de las salidas (PA/PQ)
‚óè M = marcas
‚óè DB = bloque de datos / bloque de datos de sistema / bloque de datos de instancia
Solo el servidor OPC UA soporta las √°reas de periferia.
Tabla 4-494 Tipos de datos
Tama√±o
[bit], tipo

√Årea

1

0 .. 255

Tipo de datos
SIMATIC S7

IEC 61131‚Äë3

OPC UA

BOOL

BOOL

Boolean

Observaci√≥n

√Årea de operan‚Äê
dos de la CPU

0 = false

I, Q, PI, PQ; M,
DB

1 .. 255 = true
N√∫meros
8, UInt8

0 .. 255

BYTE

BYTE,
USINT

Byte

8, UInt8

0 .. 255

CHAR

CHAR

Byte

16, UInt16 0 .. 65535

WORD

WORD,
UINT

UInt16

I, Q, PI, PQ; M,
DB

16, Int16

INT

INT

Int16

I, Q, PI, PQ; M,
DB

DWORD

DWORD,
UDINT

UInt32

I, Q, PI, PQ; M,
DB

-32768 .. 32767

32, UInt32 0 .. 4294967295

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

I, Q, PI, PQ; M,
DB
Caracteres ASCII
32 .. 255

I, Q, PI, PQ; M,
DB

7567

Instrucciones
4.2 Instrucciones
Tama√±o
[bit], tipo

√Årea

32, Int32
32, Float

Tipo de datos

Observaci√≥n

√Årea de operan‚Äê
dos de la CPU

SIMATIC S7

IEC 61131‚Äë3

OPC UA

2147483648 ..
2147483647

DINT

DINT

Int32

I, Q, PI, PQ; M,
DB

¬±1.175 495e-38 ..
3.402823e+38

REAL

REAL

Float

DB

S5TIME

TIME

UInt16

Fecha y hora
16, UInt16 0 .. 999

Hora SIMATIC

DB

Respecto a la codifica‚Äê
ci√≥n consulte la ayuda on‚Äê
line de STEP 7.
16, UInt16 D#1990‚Äë1‚Äë1 ..
D#2168‚Äë12‚Äë31

DATE

DATE

UInt16

Fecha IEC [d]

DB

UInt32

Hora [ms]

DB

UInt32

Hora IEC [ms]

DB

Fecha y hora

DB

(0 .. 65378)
TIME_OF_
32, UInt32 TOD#0:0:0.0 ..
TIME_OF_
DAY
DAY (TOD)
TOD#23:59:59.999
(0 .. 86399999)
32, UInt32 -24D_20H_31M_
23S_648MS ..
T#24D_20H_31M_
23S_647MS

TIME

TIME

(-2147483648 ..
2147483647)
Tipos de datos compuestos
64

254 * 8

1990‚Äë1‚Äë1-0:0:0.0 ..
2089‚Äë12‚Äë31-23:59:
59.999

UInt32+
DATE_AND_ DT DATE_
AND_TIME UInt32
TIME

STRING *

STRING

String

Respecto a la codifica‚Äê
ci√≥n consulte la ayuda on‚Äê
line de STEP 7.
M√°x. 254 bytes de datos
de usuario

DB

ARRAY *

Campo multidimensional DB
de tipos de datos elemen‚Äê
tales o compuestos

UDT *

Tipo de datos definido
por el usuario para gru‚Äê
pos de par√°metros espe‚Äê
c√≠ficos

DB

* Respecto a la codificaci√≥n v√©ase m√°s abajo.

Encontrar√° la descripci√≥n detallada de la codificaci√≥n de los tipos de datos en la Ayuda en
pantalla de STEP 7.
Particularidades de los tipos de datos compuestos
Para los tipos de datos compuestos que utiliza la funci√≥n OPC UA del CP rigen normas de
codificaci√≥n especiales, que se describen a continuaci√≥n.

STRING
Un STRING puede tener como m√°x. 254 caracteres.

7568

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Se admiten caracteres ASCII comprendidos en el rango 32 (0x20) .. 255 (0xFF).
De ellos, los caracteres siguientes no est√°n permitidos: 127 (0x7F), 129 (0x81), 141 (0x8D),
143 (0x8F), 144 (0x90), 157 (0x9D)
Particularidades del servidor OPC UA
Los caracteres se codifican en formato UTF‚Äë8 en el servidor OPC UA del CP.
Particularidades del cliente OPC UA
Para los datos de proceso con el tipo de datos STRING referenciados por el UDT
"UAAnyPointer" se indica el tipo de datos "2" (BYTE).
Como factor de repetici√≥n en el UAAnyPointer elija siempre el valor m√°ximo de 256 (0x100):
254 para los datos de usuario + 2 para el encabezado.

ARRAY
Particularidades del cliente OPC UA
Los bloques de programa del cliente solo soportan la transferencia de arrays unidimensionales
desde el √°rea de memoria "DB".
Los bloques de programa del cliente no soportan la transferencia del tipo de datos "ARRAY of
BOOL".
En un ARRAY of STRING, la longitud m√°xima (256) debe indicarse "n" veces en los l√≠mites de
la dimensi√≥n de cada elemento del string, siendo "n" el n√∫mero de strings en el array.
Particularidades del servidor OPC UA
El tipo de datos "ARRAY of BOOL" puede leerse en todos los casos.
El tipo de datos "ARRAY of BOOL" solo puede escribirse si la longitud es un m√∫ltiplo de 8.

UDT
La estructura de los UDT necesarios para los bloques de programa para la funci√≥n de cliente
OPC UA se explica en la descripci√≥n del bloque correspondiente, v√©ase por ejemplo
AUTOHOTSPOT.

Tipos de par√°metros
Los tipos de par√°metros "TIMER" y "COUNTER" solo se soportan para el servidor OPC UA del
CP.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7569

Instrucciones
4.2 Instrucciones

UDT para el CP 443-1 OPC UA
UASessionConnectInfo
UASessionConnectInfo
Consulte en la tabla siguiente el significado de la informaci√≥n de la conexi√≥n para el par√°metro
"SessionConnectInfo" del bloque UA_Connect.
Tabla 4-495 Par√°metros de UDT UASessionConnectInfo
Par√°metro

Tipo de datos
S7

Rango de valo‚Äê Significado
res

SessionName

STRING

0 .. 254 carac‚Äê
teres

Nombre de la sesi√≥n
Si la cadena permanece vac√≠a, el sistema asig‚Äê
na el siguiente nombre de sesi√≥n:
<Connection>+<Valor decimal de "Connec‚Äê
tionHdl">

ApplicationName

STRING

0 .. 254 carac‚Äê
teres

El par√°metro es asignado por STEP 7 con el
nombre de aplicaci√≥n del CP (cliente OPC UA)
configurado en HW Config.

SecurityMsgMode

WORD

0 .. 3

Procedimiento de seguridad
‚óè 0 = mejor procedimiento posible
‚óè 1 = Ning√∫n procedimiento de seguridad
‚óè 2 = Autentificar
‚óè 3 = Autentificar y cifrar

SecurityPolicy

WORD

0 .. 4

Perfil Security
‚óè 0 = Mejor perfil posible
‚óè 1 = Ning√∫n perfil de seguridad
‚óè 2 = Basic128Rsa15
‚óè 3 = Basic256
‚óè 4 = Basic256Sha256

CertificateStore

STRING

ClientCertificate‚Äê
Name

STRING

ServerUri

STRING

0 .. 254 carac‚Äê
teres

Memoria de certificado del CP (cliente OPC UA)
El par√°metro es asignado por STEP 7.

0 .. 254 carac‚Äê
teres

Nombre del certificado de cliente

0 .. 254 carac‚Äê
teres

Direcci√≥n de servidor (URI), que tambi√©n est√°
guardada en el certificado de servidor.

El par√°metro es asignado por STEP 7.

El par√°metro solo puede dejarse vac√≠o para se‚Äê
siones sin procedimiento de seguridad.
Ejemplo:
urn:<ApplicationName>:GUID

7570

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo de datos
S7

CheckServerCerti‚Äê BOOL
ficate

Rango de valo‚Äê Significado
res
0, 1

Sincronizaci√≥n (comprobaci√≥n) del certificado
enviado por el servidor con el certificado de
servidor guardado en la memoria de certifica‚Äê
dos del CP cliente:
‚óè 0 = ninguna comprobaci√≥n
‚óè 1 = comprobaci√≥n
Nota:
Los ajustes de este par√°metro se sobrescriben
con los ajustes de seguridad de la configura‚Äê
ci√≥n.
Si activa la comprobaci√≥n (1) pero las funciones
de seguridad est√°n desactivadas en la configu‚Äê
raci√≥n del CP, el establecimiento de la conexi√≥n
se cancelar√° con un mensaje de error.
Recomendaci√≥n: Deje el par√°metro en al ajuste
predeterminado (0), ya que las funciones de
seguridad se activan a trav√©s de la configura‚Äê
ci√≥n del CP.

TransportProfile

WORD

1

1 = UATP_UATcp
Solo se soporta este perfil de transporte confor‚Äê
me a la especificaci√≥n PLCopen.

UserIdentityToken

UDT

V√©ase "Signifi‚Äê Datos de la identificaci√≥n de usuario,
cado"
consulte UAUserIdentityToken (P√°gina 7572).

VendorSpecificPa‚Äê WORD
rameter

V√©ase "Signifi‚Äê Entrada de la direcci√≥n l√≥gica del
cado"
CP 443‚Äë1 OPC UA. La encontrar√° en el cuadro
de di√°logo de propiedades del CP de STEP 7
como direcci√≥n de entrada en la ficha "Direc‚Äê
ciones"

SessionTimeout

30000 ..
86 400 000

TIME

Intervalo m√°ximo (milisegundos) durante el
cual se mantiene una sesi√≥n sin tr√°fico de da‚Äê
tos.
Si se rebasa este valor, la sesi√≥n (conexi√≥n) se
cancela. En ese caso hay que volver a estable‚Äê
cer la conexi√≥n llamando UA_Connect.
Si se programan valores fuera del rango de va‚Äê
lores permitido (30 segundos ... 1 d√≠a) se utiliza
el valor 1200000 (20 minutos).

MonitorConnec‚Äê
tion

TIME

5000 ..
86 400 000

Tiempo de vigilancia de conexi√≥n (milisegun‚Äê
dos)
Intervalo sin tr√°fico de datos despu√©s del cual el
cliente comprueba la conexi√≥n con el servidor
enviando un telegrama.
Ajuste predeterminado: 15000 (15 segundos)

LocaleIDs

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

ARRAY[1..5]
of String[6]

Ejemplos:
en‚ÄëUS, de‚ÄëDE,
zh‚ÄëCHS ...

Identificador opcional de idioma y regi√≥n con‚Äê
forme a RFC 3066.
0 = ning√∫n LocaleID o uno desconocido

7571

Instrucciones
4.2 Instrucciones

UAUserIdentityToken
UAUserIdentityToken
Consulte en la tabla siguiente el significado de los datos de autenticaci√≥n de usuario que se
suministran al par√°metro "UserIdentityToken" del UDT "UASessionConnectInfo".
Tabla 4-496 Par√°metros de UDT UAUserIdentityToken
Par√°metro

Tipo de datos
S7

Rango de valo‚Äê Significado
res

UserIdentity
TokenType

WORD

0, 1

0 = ninguna autenticaci√≥n
1 = autenticaci√≥n
Si el interlocutor (servidor) requiere una auten‚Äê
ticaci√≥n mediante nombre de usuario y contra‚Äê
se√±a, ponga este par√°metro a 1 y los dos si‚Äê
guientes conforme a las exigencias del servidor.

TokenParam1

STRING

1 .. 254 carac‚Äê
teres

Nombre de usuario

TokenParam2

STRING

1 .. 254 carac‚Äê
teres

Contrase√±a

UANodeID
UANodeID
Consulte en la tabla siguiente el significado de los par√°metros de UANodeID para la
identificaci√≥n del nodo de destino en el servidor OPC UA. UANodeID alimenta el par√°metro
"NodeIDs" del bloque UA_NodeGetHandleList".
Tabla 4-497 Par√°metros de UDT UANodeID
Par√°metro

Tipo de da‚Äê
tos S7

Rango de va‚Äê Significado
lores

NamespaceIndex

WORD

0 .. 65535

√çndice del espacio de nombre del servidor

Identifier

STRING

M√°x. 254

Especifica el ID de nodo en el √≠ndice de espacio de
nombre.

IdentifierType

WORD

1 .. 2

Determina el formato y el rango de validez (general‚Äê
mente el servidor) de NodeID. Tipos soportados:
‚óè 1: UAIdentifierType_String
los identificadores de cadena distinguen entre
may√∫sculas y min√∫sculas.
‚óè 2: UAIdentifierType_Numeric
identificador num√©rico

7572

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

UANodeAdditionalInfo
UANodeAdditionalInfo
Especifica el atributo del item y el rango de √≠ndices para el par√°metro de bloque
"NodeAddInfos".
Tabla 4-498 Par√°metros de UDT UANodeAdditionalInfo
Par√°metro

Tipo de datos Rango de valores
S7

Significado

AttributeID

WORD

13

Atributo de los items. Solo se soporta el atri‚Äê
buto 13 (UAAI_Value) para el valor del item.

IndexRangeCount

WORD

0 .. 1

N√∫mero de √°reas de √≠ndice
El valor es irrelevante en tipos de datos ele‚Äê
mentales.
Para elementos con el tipo de datos ARRAY
rige lo siguiente:
‚óè 0: Un √∫nico √≠ndice. Se lee/escribe el Array
completo.
‚óè 1: Un √°rea parcial de una matriz definida
por "IndexRange".

IndexRange

UDT

V√©ase "Significa‚Äê
do"

√Årea de la matriz para el par√°metro Index‚Äê
RangeCount. Respecto a la estructura de
UDT consulte UAIndexRange (P√°gina 7573).

UAIndexRange
UAIndexRange
Determina los √≠ndices de inicio y fin para el par√°metro "IndexRange" del UDT
"UANodeAdditionalInfo".
Tabla 4-499 Par√°metros de UDT UAIndexRange
Par√°metro

Tipo de datos

Rango de va‚Äê Significado
lores

StartIndex

WORD

0 .. 65535

√çndice a partir del cual se lee.

EndIndex

WORD

0 .. 65535

√çndice hasta el cual se lee.

Reglas:
Si se utiliza IndexRangeCount = 1, rigen las siguientes reglas para la programaci√≥n del √°rea
de √≠ndices:
‚óè StartinIndex y EndIndex deben asignarse.
‚óè Para el acceso a m√°s de un elemento es necesario que StartIndex sea menor que
EndIndex.
La no observancia provoca un error con el n√∫mero 80360000.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7573

Instrucciones
4.2 Instrucciones
‚óè Para leer solo un elemento de la matriz, indique el mismo valor para StartIndex y EndIndex.
‚óè Para poder acceder a todos los elementos de la matriz hay que asignar StartIndex y
EndIndex en funci√≥n del n√∫mero total de los elementos de la matriz.
Las entradas fuera del tama√±o de la matriz provocan un error con el n√∫mero 80370000.
Ejemplo para la asignaci√≥n de "StartIndex" y "EndIndex" en matrices:
De una matriz con un tama√±o de 10 elementos (n.¬∫ 1 .. 10) deben leerse los elementos 3 a 5.
Ambos √≠ndices se programan del siguiente modo:
‚óè StartIndex = 2 (elemento n.¬∫ 3)
‚óè EndIndex = 4 (elemento n.¬∫ 5)

UATimeStamp
UATimeStamp
El UDT contiene los sellos de tiempo de los elementos del √°rea de datos en milisegundos.
UATimeStamp alimenta el par√°metro "TimeStamps" del bloque UA_ReadList".
Tabla 4-500 Par√°metros de UDT UATimeStamp
Par√°metro

Tipo de datos Rango de valores
S7

Significado

TimestampL

WORD

V√©ase m√°s abajo

Palabra menos significativa (bits 0..15)

TimestampH

WORD

V√©ase m√°s abajo

Palabra m√°s significativa (bits 16..31)

Rango de valores de la palabra doble completa:
TOD#0:0:0.0 .. TOD#23:59:59.999 (0 .. 86 399 999 Milisegundos)

UAAnyPointer
UAAnyPointer
El UDT "UAAnyPointer" es referenciado por el par√°metro "Variables" del bloque de programa.
El UDT hace referencia al √°rea de memoria de los datos de proceso en la CPU. Para ello es
necesario copiar en un bloque de datos los datos de proceso de las √°reas de operandos
"Entradas" o "Salidas".
Deposite el UDT en un bloque de datos.
Tabla 4-501 Par√°metros de UDT UAAnyPointer

7574

Par√°metro

Tipo de datos Valores posibles
S7

Significado

SyntaxID

WORD

10

El valor para el ID de sintaxis siempre es 10.

DataType

WORD

V√©ase "Significa‚Äê
do"

Tipo de datos del nodo de destino. Respecto
al rango de valores consulte la tabla "Codifi‚Äê
caci√≥n del tipo de datos" a continuaci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo de datos Valores posibles
S7

Significado

RepetitionFactor

WORD

Factor de repetici√≥n

0 .. 65535

Encontrar√° m√°s informaci√≥n en la Ayuda en
pantalla de STEP 7.
DB_Number

WORD

0 .. 65535

N√∫mero del bloque de datos (DB)
Como alternativa, indique el n√∫mero de un
DB o un √°rea de memoria. Si indica un DB,
introduzca un cero en "MemArea".

MemArea

WORD

V√©ase "Significa‚Äê
do"

√Årea de memoria
Como alternativa, indique el n√∫mero de un
DB o un √°rea de memoria. Si indica un √°rea
de memoria, introduzca un cero en
"DB_Number".
Respecto al rango de valores del √°rea de
memoria consulte la tabla "Codificaci√≥n del
√°rea de memoria" a continuaci√≥n.

ByteOffset

WORD

Dependiendo del
√°rea de memoria,
consulte "Signifi‚Äê
cado"

Decalaje de bytes en el √°rea de memoria in‚Äê
dicada a partir del cual se accede a los datos.

BitOffset

WORD

0 .. 7

Decalaje de bits en el √°rea de memoria indi‚Äê
cada

Tipo de datos
La tabla siguiente explica la codificaci√≥n del tipo de datos en el par√°metro "DataType" del UDT
UAAnyPointer.
Tabla 4-502 Codificaci√≥n del tipo de datos
C√≥digo hexadecimal

Tipo de datos S7

Descripci√≥n

b#16#01

BOOL

Bit

b#16#02

BYTE

Byte (8 bits)

b#16#03

CHAR

Car√°cter (8 bits)

b#16#04

WORD

Palabra (16 bits)

b#16#05

INT

Entero (16 bits)

b#16#06

DWORD

Palabra (32 bits)

b#16#07

DINT

Entero (32 bits)

b#16#08

REAL

N√∫mero en coma flotante (32 bits)

b#16#09

DATE

Fecha

b#16#0A

TIME_OF_DAY (TOD) Hora

b#16#0B

TIME

Tiempo

b#16#0C

S5TIME

Tipo de datos S5TIME

b#16#0E

DATE_AND_TIME
(DT)

Fecha y hora (64 bits)

b#16#02 *

STRING

Cadena de caracteres

* La cadena utiliza el tipo de datos subordinado BYTE. Observe las particularidades recogidas
en el cap√≠tulo Tipos de datos (P√°gina 7567).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7575

Instrucciones
4.2 Instrucciones
√Årea de memoria
La tabla siguiente explica la codificaci√≥n del √°rea de memoria en el par√°metro "MemArea" del
UDT UAAnyPointer.
Tabla 4-503 Codificaci√≥n del √°rea de memoria
C√≥digo hexadecimal

√Årea

Descripci√≥n

b#16#80

P

√Årea de memoria de la periferia

b#16#81

E

√Årea de memoria de las entradas

b#16#82

A

√Årea de memoria de las salidas

b#16#83

M

√Årea de memoria de las marcas

b#16#84

DB

Bloque de datos

N√∫meros de error
Valoraci√≥n de los par√°metros de salida
Los par√°metros de salida Done (BOOL), Error (BOOL) y ErrorID (DWORD) de los bloques de
programa del cliente OPC UA se actualizan en cada llamada del bloque. Valore los estados de
los par√°metros de salida en el programa de usuario.
Ejemplo:
Despu√©s de la llamada el bloque de programa UA_Connect proporciona los siguientes valores
a los tres par√°metros de salida:
‚óè Done = 1
‚óè Error = 0
‚óè ErrorID = 00000000
Significado: La petici√≥n se ha completado correctamente.

Significado de los n√∫meros de error (hexadecimales) de ErrorID
Tabla 4-504 Significado de ErrorID en combinaci√≥n con Done y Error
Done Error

ErrorID (hex) Nombre

Significado

1

00000000

El procesamiento del bloque se ha completado correctamente.

0

N√∫meros de error espec√≠ficos de CP
0

1

B0006001

Falta flanco positivo para llamar el bloque de programa

0

1

B0007001

Tiempo excedido

0

1

B0008004

NodeIDCount no v√°lido

0

1

B0008086

Handle de nodo no v√°lido

0

1

B0008087

Se ha alcanzado el n√∫mero m√°ximo de conexiones (5).

0

1

B0008090

Direcci√≥n l√≥gica incorrecta. Establecimiento de conexi√≥n can‚Äê
celado.

7576

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

B0008093

La direcci√≥n l√≥gica no se puede procesar. Se utiliza un m√≥dulo
no permitido.

0

1

B00080A1

El handle de nodo no se ha configurado para esta conexi√≥n.

0

1

B00080C3

Los recursos de conexi√≥n de la CPU est√°n agotados tempo‚Äê
ralmente.

0

1

B0009085

Se ha rebasado el espacio de memoria m√°ximo para elemen‚Äê
tos (64000 bytes) del cliente OPC UA.

0

1

B000800A

El cliente OPC UA no se ha activado en la configuraci√≥n.

0

1

B0008723

La petici√≥n de lectura/escritura referencia un √°rea de datos
que no existe en un DB.

0

1

B000F001

En un ciclo se han llamado dos bloques de funci√≥n.

0

1

B000F002

La sesi√≥n OPC UA todav√≠a no est√° establecida. Vuelva a lla‚Äê
mar el bloque UA_Connect.

0

1

B000F003

Error de comunicaci√≥n

0

1

B000F004

Valor no v√°lido para el par√°metro "SyntaxID" en el UDT
"UAAnyPointer"

0

1

B000F005

Tipo de datos no v√°lido en UAAnyPointer

0

1

B000F006

Valor no v√°lido para el par√°metro "RepetitionFactor" en el UDT
"UAAnyPointer"

0

1

B000F007

√Årea de operandos no v√°lida de UAAnyPointer

0

1

B000F010

√Årea de operandos no v√°lida en una petici√≥n de lectura o es‚Äê
critura: no se permiten arrays de entradas, arrays de salidas,
arrays de marcas, arrays de datos locales ni arrays de datos
locales del bloque predecesor.

0

1

B000F011

El offset de bits debe ser cero.

0

1

B0010001

Paquete datos err√≥neo en UA_Connect

0

1

B0010002

URL no v√°lida de un punto final de servidor

0

1

B0010003

Valor no v√°lido para Timeout

0

1

B0010004

Valor no v√°lido para SessionTimeout

0

1

B0010005

Valor no v√°lido para MonitorConnection

0

1

B0010006

Perfil de transporte no v√°lido

0

1

B0010007

URI de servidor no v√°lida

0

1

B0010008

Procedimiento de Security no v√°lido

0

1

B0010009

Perfil de Security no v√°lido

0

1

B001000A

Valor no v√°lido para UserIdentityToken

0

1

B001000B

Nombre de aplicaci√≥n no v√°lido

0

1

B0010101

Formato no v√°lido de la URL del punto final del servidor. Debe
empezar por "opc.tcp://".

0

1

B0010102

La ruta de la URL del punto final del servidor no se soporta.

0

1

B0010103

El cliente no debe conectarse al servidor del propio CP.

0

1

B0010104

Puerto no v√°lido

0

1

B0010105

Direcci√≥n no v√°lida. DNS no se soporta.

0

1

B0020001

Paquete datos err√≥neo en UA_NameSpaceGetIndex

0

1

B0030001

Paquete datos err√≥neo en UA_NodeGetHandleList

0

1

B0030002

Identifier de NodeID no v√°lido

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7577

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

B0030003

Se ha rebasado el n√∫mero m√°x. de elementos (64000)

0

1

B0030004

Atributo "ValueRank" no soportado de una variable. Los valo‚Äê
res 1 (array unidimensional) y -1 (de escala) de ValueRank no
se soportan.

0

1

B0040001

Paquete datos err√≥neo en UA_NodeReleaseHandleList

0

1

B0050001

Paquete datos err√≥neo en UA_Disconnect

0

1

B0050002

No es posible llamar UA_Disconnect porque no hay conexi√≥n.

0

1

B0060001

Paquete datos err√≥neo en UA_ReadList

0

1

B0060002

La longitud de los datos que deben leerse excede el m√°ximo
de 64000.

0

1

B0060003

Rango no v√°lido de IndexRangeCount

0

1

B0060004

IndexRange no v√°lido. StartIndex no debe ser mayor que En‚Äê
dIndex y EndIndex no debe ser mayor que la longitud del array.

0

1

B0060005

AttributeID no v√°lido

0

1

B0060006

El √°rea de datos le√≠da es demasiado peque√±a.

0

1

B0060007

Longitud de string no v√°lida. El valor (datos de usuario) debe
ser 254.

0

1

B0060008

Valor no v√°lido del nodo. El valor no puede leerse en una va‚Äê
riable S7.

0

1

B0060010

√Årea de operandos no v√°lida en una petici√≥n de lectura o es‚Äê
critura: no se permiten arrays de entradas, arrays de salidas,
arrays de marcas, arrays de datos locales ni arrays de datos
locales del bloque predecesor.

0

1

B0070001

Paquete de datos err√≥neo en UA_WriteList

0

1

B0070002

La longitud de los datos que deben escribirse excede el m√°xi‚Äê
mo.

0

1

B0070003

Rango no v√°lido de IndexRangeCount

0

1

B0070004

IndexRange no v√°lido. StartIndex no debe ser mayor que En‚Äê
dIndex y EndIndex no debe ser mayor que la longitud del array.

0

1

B0070005

AttributeID no v√°lido

0

1

B0070006

El √°rea de datos est√° fuera del rango admisible.

0

1

B0070009

Car√°cter no v√°lido en el string

Corrija los datos en el UDT "UAIndexRange".

N√∫meros de error seg√∫n IEC 61131‚Äë3 para OPC UA
0

1

002D0000

GoodSubscription
Transferred

The subscription was transferred to another session.

0

1

002E0000

GoodCompletes
Asynchronously

The processing will complete asynchronously.

0

1

002F0000

GoodOverload

Sampling has slowed down due to resource limitations.

0

1

00300000

GoodClamped

The value written was accepted but was clamped.

0

1

00960000

GoodLocalOverride

The value has been overridden.

0

1

00A20000

GoodEntryInserted

The data or event was successfully inserted into the historical
database.

0

1

00A30000

GoodEntryReplaced

The data or event field was successfully replaced in the histo‚Äê
rical database.

0

1

00A50000

GoodNoData

No data exists for the requested time range or event filter.

7578

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

00A60000

GoodMoreData

The data or event field was successfully replaced in the histo‚Äê
rical database.

0

1

00A70000

GoodCommunicationEvent

The communication layer has raised an event.

0

1

00A80000

GoodShutdownEvent

The system is shutting down.

0

1

00A90000

GoodCallAgain

The operation is not finished and needs to be called again.

0

1

00AA0000

GoodNonCriticalTimeout

A non-critical timeout occurred.

0

1

00BA0000

GoodResultsMayBe
Incomplete

The server should have followed a reference to a node in a
remote server but did not. The result set may be incomplete.

0

1

406C0000

UncertainReferenceOutOf
Server

One of the references to follow in the relative path references
to a node in the address space in another server.

0

1

408F0000

UncertainNoCommunication
LastUsableValue

Communication to the data source has failed. The variable va‚Äê
lue is the last value that had a good quality.

0

1

40900000

UncertainLastUsableValue

Whatever was updating this value has stopped doing so.

0

1

40910000

UncertainSubstituteValue

The value is an operational value that was manually overwrit‚Äê
ten.

0

1

40920000

UncertainInitialValue

The value is an initial value for a variable that normally receives
its value from another variable.

0

1

40930000

UncertainSensorNotAccurate The value is at one of the sensor limits.

0

1

40940000

UncertainEngineeringUnits
Exceeded

The value is outside of the range of values defined for this
parameter.

0

1

40950000

UncertainSubNormal

The value is derived from multiple sources and has less than
the required number of Good sources.

0

1

40A40000

UncertainDataSubNormal

The value is derived from multiple values and has less than the
required number of Good values.

0

1

40BC0000

UncertainReferenceNot
Deleted

The server was not able to delete all target references.

0

1

40C00000

UncertainNotAllNodes
Available

The list of references may not be complete because the un‚Äê
derlying system is not available.

0

1

80010000

BadUnexpectedError

An unexpected error occurred

0

1

80020000

BadInternalError

An internal error occurred as a result of a programming or con‚Äê
figuration error.

0

1

80030000

BadOutOfMemory

Not enough memory to complete the operation.

0

1

80040000

BadResourceUnavailable

An operating system resource is not available

0

1

80050000

BadCommunicationError

A low level communication error occurred.

0

1

80060000

BadEncodingError

Encoding halted because of invalid data in the objects being
serialized.

0

1

80070000

BadDecodingError

Decoding halted because of invalid data in the stream.

0

1

80080000

BadEncodingLimitsExcee‚Äê
ded

The message encoding/decoding limits imposed by the stack
have been exceeded.

0

1

80B80000

BadRequestTooLarge

The resources (memory) of the CPU are temporarily occupied

0

1

80B90000

BadResponseTooLarge

The response message size exceeds limits set by the client.

0

1

80B90000

BadUnknownResponse

An unrecognized response was received from the server.

0

1

800A0000

BadTimeout

The operation timed out.

0

1

800B0000

BadServiceUnsupported

The server does not support the requested service.

0

1

800C0000

BadShutdown

The operation was cancelled because the application is shut‚Äê
ting down.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7579

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

800D0000

BadServerNotConnected

The operation could not complete because the client is not
connected to the server.

0

1

800E0000

BadServerHalted

The server has stopped and cannot process any requests.

0

1

800F0000

BadNothingToDo

There was nothing to do because the client passed a list of
operations with no elements.

0

1

80100000

BadTooManyOperations

The request could not be processed because it specified too
many operations.

0

1

80110000

BadDataTypeIdUnknown

The extension object cannot be (de)serialized because the da‚Äê
ta type id is not recognized.

0

1

80120000

BadCertificateInvalid

The certificate provided as a parameter is not valid.

0

1

80130000

BadSecurityChecksFailed

The certificate provided as a parameter is not valid.

0

1

80140000

BadCertificateTimeInvalid

The Certificate has expired or is not yet valid.

0

1

80150000

BadCertificateIssuer
TimeInvalid

An Issuer Certificate has expired or is not yet valid.

0

1

80160000

BadCertificateHost
NameInvalid

The HostName used to connect to a Server does not match a
HostName in the Certificate.

0

1

80170000

BadCertificateUriInvalid

The URI specified in the Application Description does not
match the URI in the Certificate.

0

1

80180000

BadCertificateUseNotAllo‚Äê
wed

The Certificate may not be used for the requested operation.

0

1

80190000

BadCertificateIssuerUse
NotAllowed

The Issuer Certificate may not be used for the requested ope‚Äê
ration.

0

1

801A0000

BadCertificateUntrusted

The Certificate is not trusted.

0

1

801B0000

BadCertificateRevocation
Unknown

It was not possible to determine if the Certificate has been
revoked.

0

1

801C0000

BadCertificateIssuer
RevocationUnknown

It was not possible to determine if the Issuer
The Certificate has been revoked.

Certificate has been revoked.

0

1

801D0000

BadCertificateRevoked

0

1

801E0000

BadCertificateIssuerRevoked The Issuer Certificate has been revoked.

0

1

801F0000

BadUserAccessDenied

User does not have permission to perform the requested ope‚Äê
ration.

0

1

80200000

BadIdentityTokenInvalid

The user identity token is not valid.

0

1

80210000

BadIdentityTokenRejected

The user identity token is valid but the server has rejected it.

0

1

80220000

BadSecureChannelIdInvalid

The specified secure channel is no longer valid.

0

1

80230000

BadInvalidTimestamp

The timestamp is outside the range allowed by the server.

0

1

80240000

BadNonceInvalid

The nonce does appear to be not a random value or it is not the
correct length.

0

1

80250000

BadSessionIdInvalid

The session id is not valid.

0

1

80260000

BadSessionClosed

The session was closed by the client.

0

1

80270000

BadSessionNotActivated

The session cannot be used because ActivateSession has not
been called.

0

1

80280000

BadSubscriptionIdInvalid

The subscription id is not valid.

0

1

802A0000

BadRequestHeaderInvalid

The header for the request is missing or invalid.

0

1

802B0000

BadTimestampsTo
ReturnInvalid

The timestamps to return parameter is invalid.

7580

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

802C0000

BadRequestCancelled
ByClient

The request was cancelled by the client.

0

1

80310000

BadNoCommunication

Communication with the data source is defined, but not esta‚Äê
blished, and there is no last known value available.

0

1

80320000

BadWaitingForInitialData

Waiting for the server to obtain values from the underlying data
source.

0

1

80330000

BadNodeIdInvalid

The syntax of the node id is not valid.

0

1

80340000

BadNodeIdUnknown

The node id refers to a node that does not exist in the server
address space.

0

1

80350000

BadAttributeIdInvalid

The attribute is not supported for the specified Node.

0

1

80360000

BadIndexRangeInvalid

The syntax of the index range parameter is invalid.

0

1

80370000

BadIndexRangeNoData

No data exists within the range of indexes specified.

0

1

80380000

BadDataEncodingInvalid

The data encoding is invalid.

0

1

80390000

BadDataEncoding
Unsupported

The server does not support the requested data encoding for
the node.

0

1

803A0000

BadNotReadable

The access level does not allow reading or subscribing to the
Node.

0

1

803B0000

BadNotWritable

The access level does not allow writing to the Node.

0

1

803C0000

BadOutOfRange

The value was out of range.

0

1

803D0000

BadNotSupported

The requested operation is not supported.

0

1

803E0000

BadNotFound

A requested item was not found or a search operation ended
without success.

0

1

803F0000

BadObjectDeleted

The object cannot be used because it has been deleted.

0

1

80400000

BadNotImplemented

Requested operation is not implemented.

0

1

80410000

BadMonitoringModeInvalid

The monitoring mode is invalid.

0

1

80420000

BadMonitoredItemIdInvalid

The monitoring item id does not refer to a valid monitored item.

0

1

80430000

BadMonitoredItem
FilterInvalid

The monitored item filter parameter is not valid.

0

1

80440000

BadMonitoredItem
FilterUnsupported

The server does not support the requested monitored item fil‚Äê
ter.

0

1

80450000

BadFilterNotAllowed

A monitoring filter cannot be used in combination with the at‚Äê
tribute specified.

0

1

80460000

BadStructureMissing

A mandatory structured parameter was missing or null.

0

1

80470000

BadEventFilterInvalid

The event filter is not valid.

0

1

80480000

BadContentFilterInvalid

The content filter is not valid.

0

1

80490000

BadFilterOperandInvalid

The operand used in a content filter is not valid.

0

1

804A0000

BadContinuation
PointInvalid

The continuation point provide is longer valid.

0

1

804B0000

BadNoContinuationPoints

The operation could not be processed because all continuation
points have been allocated.

0

1

804C0000

BadReferenceTypeIdInvalid

The operation could not be processed because all continuation
points have been allocated.

0

1

804D0000

BadBrowseDirectionInvalid

The browse direction is not valid.

0

1

804E0000

BadNodeNotInView

The node is not part of the view.

0

1

804F0000

BadServerUriInvalid

The ServerUri is not a valid URI.

0

1

80500000

BadServerNameMissing

No ServerName was specified

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7581

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

80510000

BadDiscoveryUrlMissing

No DiscoveryUrl was specified.

0

1

80520000

BadSempahoreFileMissing

The semaphore file specified by the client is not valid.

0

1

80530000

BadRequestTypeInvalid

The security token request type is not valid.

0

1

80540000

BadSecurityModeRejected

The security mode does not meet the requirements set by the
Server.

0

1

80550000

BadSecurityPolicyRejected

The security policy does not meet the requirements set by the
Server.

0

1

80560000

BadTooManySessions

The server has reached its maximum number of sessions.

0

1

80570000

BadUserSignatureInvalid

The user token signature is missing or invalid.

0

1

80580000

BadApplicationSignature
Invalid

The signature generated with the client certificate is missing or
invalid.

0

1

80590000

BadNoValidCertificates

The client did not provide at least one software certificate that
is valid and meets the profile requirements for the server.

0

1

805A0000

BadRequestCancelled
ByRequest

The request was cancelled by the client with the Cancel servi‚Äê
ce.

0

1

805B0000

BadParentNodeIdInvalid

The parent node id does not to refer to a valid node.

0

1

805C0000

BadReferenceNotAllowed

The reference could not be created because it violates cons‚Äê
traints imposed by the data model.

0

1

805D0000

BadNodeIdRejected

The requested node id was reject because it was either invalid
or server does not allow node ids to be specified by the client.

0

1

805F0000

BadNodeClassInvalid

The node class is not valid.

0

1

80600000

BadBrowseNameInvalid

The browse name is invalid.

0

1

80610000

BadBrowseNameDuplicated

The browse name is not unique among nodes that share the
same relationship with the parent.

0

1

80620000

BadNodeAttributesInvalid

The node attributes are not valid for the node class.

0

1

80630000

BadTypeDefinitionInvalid

The type definition node id does not reference an appropriate
type node.

0

1

80640000

BadSourceNodeIdInvalid

The source node id does not reference a valid node.

0

1

80650000

BadTargetNodeIdInvalid

The target node id does not reference a valid node.

0

1

80660000

BadDuplicateReference
NotAllowed

The reference type between the nodes is already defined.

0

1

80670000

BadInvalidSelfReference

The server does not allow this type of selfreference on this
node.

0

1

80680000

BadReferenceLocalOnly

The reference type is not valid for a reference to a remote ser‚Äê
ver.

0

1

80690000

BadNoDeleteRights

The server will not allow the node to be deleted.

0

1

806A0000

BadServerIndexInvalid

The server index is not valid.

0

1

806B0000

BadViewIdUnknown

The view id does not refer to a valid view node.

0

1

806D0000

BadTooManyMatches

The requested operation has too many matches to return.

0

1

806E0000

BadQueryTooComplex

The requested operation requires too many resources in the
server.

0

1

806F0000

BadNoMatch

The requested operation has no match to return.

0

1

80700000

BadMaxAgeInvalid

The max age parameter is invalid.

0

1

80710000

BadHistoryOperationInvalid

The history details parameter is not valid.

0

1

80720000

BadHistoryOperation
Unsupported

The server does not support the requested operation.

7582

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

80730000

BadWriteNotSupported

The server not does support writing the combination of value,
status and timestamps provided.

0

1

80740000

BadTypeMismatch

The value supplied for the attribute is not of the same type as
the attribute's value.

0

1

80750000

BadMethodInvalid

The method id does not refer to a method for the specified
object.

0

1

80760000

BadArgumentsMissing

The client did not specify all of the input arguments for the
method.

0

1

80770000

BadTooManySubscriptions

The server has reached its maximum number of subscriptions.

0

1

80780000

BadTooManyPublish
Requests

The server has reached the maximum number of queued pu‚Äê
blish requests.

0

1

80790000

BadNoSubscription

There is no subscription available for this session.

0

1

807A0000

BadSequenceNumber
Unknown

The sequence number is unknown to the server.

0

1

807B0000

BadMessageNotAvailable

The requested notification message is no longer available.

0

1

807C0000

BadInsufficientClientProfile

The Client of the current Session does not support one or more
Profiles that are necessary for the Subscription.

0

1

80BF0000

BadStateNotActive

The sub-state machine is not currently active.

0

1

807D0000

BadTcpServerTooBusy

The server cannot process the request because it is too busy.

0

1

807E0000

BadTcpMessageTypeInvalid

The type of the message specified in the header invalid.

0

1

807F0000

BadTcpSecureChannel
Unknown

The SecureChannelId and/or TokenId are not currently in use.

0

1

80800000

BadTcpMessageTooLarge

The size of the message specified in the header is too large.

0

1

80810000

BadTcpNotEnough
Resources

There are not enough resources to process the request.

0

1

80820000

BadTcpInternalError

An internal error occurred.

0

1

80830000

BadTcpEndpointUrlInvalid

The Server does not recognize the QueryString specified.

0

1

80840000

BadRequestInterrupted

The request could not be sent because of a network interrup‚Äê
tion.

0

1

80850000

BadRequestTimeout

Timeout occurred while processing the request.

0

1

80860000

BadSecureChannelClosed

The secure channel has been closed.

0

1

80870000

BadSecureChannelToken
Unknown

The token has expired or is not recognized.

0

1

80880000

BadSequenceNumberInvalid

The sequence number is not valid.

0

1

80890000

BadConfigurationError

There is a problem with the configuration that affects the use‚Äê
fulness of the value.

0

1

808A0000

BadNotConnected

The variable should receive its value from another variable, but
has never been configured to do so.

0

1

808B0000

BadDeviceFailure

There has been a failure in the device/data source that gene‚Äê
rates the value that has affected the value.

0

1

808C0000

BadSensorFailure

There has been a failure in the sensor from which the value is
derived by the device/data source.

0

1

808D0000

BadOutOfService

The source of the data is not operational.

0

1

808E0000

BadDeadbandFilterInvalid

The dead band filter is not valid.

0

1

80970000

BadRefreshInProgress

This Condition refresh failed, a Condition refresh operation is
already in progress.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7583

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

80980000

BadConditionAlreadyDisa‚Äê
bled

This condition has already been disabled.

0

1

80990000

BadConditionDisabled

Property not available, this condition is disabled.

0

1

809A0000

BadEventIdUnknown

The specified event id is not recognized.

0

1

809B0000

BadNoData

No data exists for the requested time range or event filter.

0

1

809D0000

BadDataLost

Data is missing due to collection started/stopped/lost.

0

1

809E0000

BadDataUnavailable

Expected data is unavailable for the requested time range due
to an unmounted volume an off-line archive or tape or similar
reason for temporary unavailability.

0

1

809F0000

BadEntryExists

The data or event was not successfully inserted because a
matching entry exists.

0

1

80A00000

BadNoEntryExists

The data or event was not successfully updated because no
matching entry exists.

0

1

80A10000

BadTimestampNotSupported The client requested history using a timestamp format the ser‚Äê
ver does not support (i. e. requested ServerTimestamp when
server only supports SourceTimestamp).

0

1

80AB0000

BadInvalidArgument

0

1

80AC0000

BadConnectionRejected

Could not establish a network connection to remote server.

0

1

80AD0000

BadDisconnect

The server has disconnected from the client.

0

1

80AE0000

BadConnectionClosed

The network connection has been closed.

0

1

80AF0000

BadInvalidState

The operation cannot be completed because the object is clo‚Äê
sed uninitialized or in some other invalid state.

0

1

80B00000

BadEndOfStream

Cannot move beyond end of the stream.

0

1

80B10000

BadNoDataAvailable

No data is currently available for reading from a non-blocking
stream.

0

1

80B20000

BadWaitingForResponse

The asynchronous operation is waiting for a response.

0

1

80B30000

BadOperationAbandoned

The asynchronous operation was abandoned by the caller.

0

1

80B40000

BadExpectedStreamToBlock The stream did not return all data requested (possibly because
it is a non-blocking stream).

0

1

80B50000

BadWouldBlock

Non-blocking behavior is required and the operation would
block.

0

1

80B60000

BadSyntaxError

A value had an invalid syntax.

0

1

80B70000

BadMaxConnections
Reached

The operation could not be finished because all available con‚Äê
nections are in use.

0

1

80BB0000

BadEventNot
Acknowledgeable

The event cannot be acknowledged.

0

1

80BD0000

BadInvalidTimestamp
Argument

The defined timestamp to return was invalid.

0

1

80BE0000

BadProtocolVersion
Unsupported

The applications do not have compatible protocol versions.

0

1

80C10000

BadFilterOperatorInvalid

An unrecognized operator was provided in a filter.

0

1

80C20000

BadFilterOperator
Unsupported

A valid operator was provided, but the server does not provide
support for this filter operator.

0

1

80C30000

BadFilterOperandCount
Mismatch

The number of operands provided for the filter operator was
less than expected for the operand provided.

0

1

80C40000

BadFilterElementInvalid

The referenced element is not a valid element in the content
filter.

7584

One or more arguments are invalid.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

80C50000

BadFilterLiteralInvalid

The referenced literal is not a valid value.

0

1

80C90000

BadViewTimestampInvalid

The view timestamp is not available or not supported.

0

1

80CA0000

BadViewParameterMismatch The view parameters are not consistent with each other.

0

1

80CB0000

BadViewVersionInvalid

The view version is not available or not supported.

0

1

80CC0000

BadConditionAlready
Enabled

This condition has already been enabled.

0

1

80CD0000

BadDialogNotActive

The dialog condition is not active.

0

1

80CF0000

BadConditionBranch
AlreadyAcked

The condition branch has already been acknowledged.

0

1

80D00000

BadConditionBranch
AlreadyConfirmed

The condition branch has already been confirmed.

0

1

80D10000

BadConditionAlreadyShel‚Äê
ved

The condition has already been shelved.

0

1

80D20000

BadConditionNotShelved

The condition is not currently shelved.

0

1

80D30000

BadShelvingTimeOutOfRan‚Äê
ge

The shelving time not within an acceptable range.

0

1

80D40000

BadAggregateListMismatch

The requested number of Aggregates does not match the re‚Äê
quested number of NodeIds.

0

1

80D50000

BadAggregateNotSupported

The requested Aggregate is not support by the server.

0

1

80D60000

BadAggregateInvalidInputs

The aggregate value could not be derived due to invalid data
inputs.

0

1

80DB0000

BadTooManyMonitoredItems The request could not be processed because there are too
many monitored items in the subscription.

0

1

80D70000

BadBoundNotFound

0

1

80D80000

BadBoundNotSupported

The server cannot retrieve a bound for the variable.

0

1

00D90000

GoodDataIgnored

The request specifies fields which are not valid for the EventTy‚Äê
pe or cannot be saved by the historian.

0

1

80DA0000

BadAggregateConfiguration
Rejected

The aggregate configuration is not valid for specified node.

No data found to provide upper or lower bound value.

N√∫meros de error de PLCOpen para OPC UA
0

1

A0000001

PLCopenUA_Bad_FW_
PermanentError

Internal, permanent error.

0

1

A0000002

PLCopenUA_Bad_FW_
TempError

Temp. Error; FB could retry to reach FW.

0

1

A0000003

PLCopenUA_Bad_
ConnectionError

Connection could not be established.

0

1

A0000004

PLCopenUA_Bad_
HostNotFound

The requested hostname could not be found.

0

1

A0000005

PLCopenUA_Bad_
AlreadyConnected

Connection was already established.

0

1

A0000006

PLCopenUA_Bad_
SecurityFailed

Connection failed due to security setup.

0

1

A0000007

PLCopenUA_Bad_
Suspended

Connection is suspended.

0

1

A0000008

PLCopenUA_Bad_
ConnectionInvalidHdl

Provided ConnectionHdl is not known.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7585

Instrucciones
4.2 Instrucciones
Done Error

ErrorID (hex) Nombre

Significado

0

1

A0000009

PLCopenUA_Bad_
NSNotFound

A namespace with the requested name cannot be found on
server.

0

1

A000000A

PLCopenUA_Bad_
ResultTooLong

Target PLC variable is too short for retrieved data.

0

1

A000000B

PLCopenUA_Bad_
InvalidType

Invalid or unsupported Type.

0

1

A000000C

PLCopenUA_Bad_
NodeInvalidHdl

Provided NodeHdl is not known.

0

1

A000000D

PLCopenUA_Bad_
MethodInvalidHdl

Provided MethodHdl is not known.

0

1

A000000E

PLCopenUA_Bad_
ReadFailed

Read failed for unknown reason.

0

1

A000000F

PLCopenUA_Bad_
WriteFailed

Write failed for unknown reason.

0

1

A0000010

PLCopenUA_Bad_
CallFailed

Method Call failed for unknown reason.

0

1

A0000011

PLCopenUA_Bad_
InParamFailed

Method Call Input parameter conversion failed.

0

1

A0000012

PLCopenUA_Bad_
OutParamFailed

Method Call Output parameter conversion failed. ATTEN‚Äê
TION: this means the MethodCall was executed successfully
but the returned values could not be converted.

0

1

A0000013

PLCopenUA_Bad_
SubscriptionInvalidHdl

Provided SubscriptionHdl is not known.

0

1

A0000014

PLCopenUA_Bad_
MonitoredItemInvalidHdl

Provided MonitoredItemHdl is not known.

4.2.5.7

Funciones 300C

ASCII, 3964(R)
SEND_PTP: Enviar datos (ASCII, 3964(R))
Descripci√≥n
La instrucci√≥n "SEND_PTP" permite enviar un conjunto de datos de un bloque de datos.
‚óè El proceso de transmisi√≥n se activa despu√©s de la llamada del bloque y de un flanco
ascendente en la entrada de control REQ.
‚óè El √°rea de los datos que deben enviarse se indica con SD_1 (n√∫mero de DB y direcci√≥n
inicial), la longitud del conjunto de datos con LEN.
‚óè Para que la instrucci√≥n pueda procesar la petici√≥n, hay que llamarla con R(Reset)=FALSE.
En caso de un flanco ascendente en la entrada de control R se cancela el proceso de
transmisi√≥n en curso y se pone la instrucci√≥n al estado inicial. Una petici√≥n cancelada
finaliza con un mensaje de error (salida STATUS).

7586

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
‚óè Con LADDR se indica la direcci√≥n E/S del subm√≥dulo que se ha definido en la configuraci√≥n
hardware.
‚óè Si la petici√≥n ha finalizado sin errores, DONE se pone a TRUE, y si ha finalizado con
errores, ERROR se pone a TRUE.
Si la petici√≥n se ha ejecutado con DONE=TRUE, significa lo siguiente:
‚óè En caso de utilizar el driver ASCII: los datos se han enviado al interlocutor de la
comunicaci√≥n. Lo que no es seguro es si el interlocutor ha recibido los datos.
‚óè En caso de utilizar el procedimiento 3964(R): los datos se han enviado al interlocutor de la
comunicaci√≥n y √©ste los ha acusado positivamente. Lo que no es seguro es si los datos
tambi√©n se han transmitido a la CPU interlocutora.
En STATUS, la CPU indica en caso de error o advertencia el n√∫mero de evento
correspondiente. DONE y ERROR/STATUS tambi√©n se devuelven en caso de RESET de la
instrucci√≥n (R=TRUE).
En caso de producirse un error, el resultado binario BR se borra. Si la instrucci√≥n finaliza sin
errores, el resultado binario tiene el estado TRUE.
Nota
La instrucci√≥n no comprueba los par√°metros; en caso de parametrizaci√≥n err√≥nea la CPU
puede derivar al estado STOP.

DB de instancia
La instrucci√≥n "SEND_PTP" trabaja con un DB de instancia. El n√∫mero de DB se indica en la
llamada. No est√° permitido acceder a los datos del DB de instancia.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SEND_PTP":
Par√°metro

Declaraci√≥n Tipo de da‚Äê Rango de valores Ajuste predeter‚Äê
tos
minado

Descripci√≥n

REQ

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Request: activa el in‚Äê
tercambio de datos en caso de un flanco as‚Äê
cendente.

R

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Reset. La petici√≥n se
cancela. Transmisi√≥n bloqueada.

LADDR

Input

WORD

seg√∫n CPU

W#16#03FF

Direcci√≥n E/S del subm√≥dulo que se ha de‚Äê
finido en la configuraci√≥n hardware.

DONE

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada):
‚óè FALSE: la petici√≥n no se ha iniciado a√∫n
o se est√° ejecutando.
‚óè TRUE: la petici√≥n se ha ejecutado sin
errores.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7587

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n Tipo de da‚Äê Rango de valores Ajuste predeter‚Äê
tos
minado

Descripci√≥n

ERROR

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada):
petici√≥n terminada con error

STATUS

Output

WORD

W#16#0000 a
W#16#FFFF

W#16#0000

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada. Por ello,
para visualizar el estado debe copiarse el
STATUS en un √°rea de datos libre)
STATUS tiene el significado siguiente en
funci√≥n del bit ERROR:
‚óè ERROR=FALSE:
‚Äì

STATUS tiene el valor W#16#0000:
ni advertencias ni errores

‚Äì

STATUS tiene el valor<>
W#16#0000: advertencia, STATUS
da informaci√≥n detallada.

‚óè ERROR=TRUE:
hay un error, STATUS da informaci√≥n
detallada sobre el tipo de error.
SD_1

InOut

ANY

seg√∫n CPU

0

Par√°metro de transmisi√≥n:
Aqu√≠ se indican los valores siguientes:
‚óè n√∫mero del DB desde el que deben
enviarse los datos.
‚óè n√∫mero del byte de datos a partir del que
deben enviarse los datos. Valores
posibles: de 0 a 8190
P. ej.: DB 10 a partir del byte 2 ->
DB10.DBB2
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro SD_1 siempre requie‚Äê
re que se especifiquen por completo los pa‚Äê
r√°metros de DB (ej.: P#DB13.DBX0.0 byte
100). En las CPUs S7-300 no est√° permitido
omitir un n√∫mero de DB expl√≠cito; de lo con‚Äê
trario se genera un aviso de error en el pro‚Äê
grama de usuario.

LEN

InOut

INT

de 1 a 1024

1

Aqu√≠ se indica en bytes la longitud del con‚Äê
junto de datos que debe enviarse (la longi‚Äê
tud se indica indirectamente).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Coherencia de datos
La coherencia de datos est√° limitada a 206 bytes. Para la transferencia coherente de m√°s de
206 bytes hay que tener en cuenta lo siguiente:

7588

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
No vuelva a escribir en la parte utilizada actualmente del √°rea de transmisi√≥n SD_1 hasta que
no haya finalizado la transmisi√≥n. Esto sucede cuando el par√°metro de estado DONE adopta
el valor TRUE.

RCV_PTP: Recibir datos (ASCII, 3964(R))
Descripci√≥n
La instrucci√≥n "RCV_PTP" permite recibir datos y guardarlos en un bloque de datos.
‚óè Despu√©s de la llamada, la instrucci√≥n est√° lista para recibir con el valor TRUE en la entrada
de control EN_R. Es posible cancelar una transmisi√≥n en curso con el estado l√≥gico FALSE
del par√°metro EN_R. Una petici√≥n cancelada finaliza con un mensaje de error (salida
STATUS). La recepci√≥n estar√° desactivada mientras haya un estado l√≥gico de FALSE en
el par√°metro EN_R.
‚óè El √°rea de recepci√≥n se indica con RD_1 (n√∫mero de DB y direcci√≥n inicial), y la longitud del
bloque de datos con LEN.
‚óè Para que la instrucci√≥n pueda procesar la petici√≥n, hay que llamarla con R(Reset)=FALSE.
En caso de un flanco ascendente en la entrada de control R se cancela la transmisi√≥n en
curso y se pone la instrucci√≥n al estado inicial. Una petici√≥n de recepci√≥n cancelada finaliza
con un mensaje de error (salida STATUS).
‚óè Con LADDR se indica la direcci√≥n E/S del subm√≥dulo que se ha definido en la configuraci√≥n
hardware.
‚óè Si la petici√≥n ha finalizado sin errores, NDR se pone a TRUE, y si ha finalizado con errores,
ERROR se pone a TRUE.
‚óè En STATUS , la CPU indica el n√∫mero de evento correspondiente en caso de error o
advertencia.
‚óè NDR y ERROR/STATUS tambi√©n se devuelven en caso de RESET de la instrucci√≥n
(R=TRUE) (par√°metro LEN == 16#00).
En caso de producirse un error, el resultado binario BR se borra. Si la instrucci√≥n finaliza sin
errores, el resultado binario tiene el estado TRUE.
Nota
La instrucci√≥n no comprueba los par√°metros; en caso de parametrizaci√≥n err√≥nea la CPU
puede derivar al estado STOP.

DB de instancia
La instrucci√≥n "RCV_PTP" trabaja con un DB de instancia. El n√∫mero de DB se indica en la
llamada. No est√° permitido acceder a los datos del DB de instancia.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7589

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RCV_PTP":
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores Ajuste predeter‚Äê
minado

Descripci√≥n

EN_R

Input

BOOL

TRUE/FALSE

Par√°metro de control Enable to receive:

FALSE

Habilitaci√≥n de recepci√≥n
R

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Reset:
La petici√≥n se cancela.

LADDR

Input

WORD

seg√∫n CPU

W#16#03FF

Direcci√≥n E/S del subm√≥dulo que se ha
definido en la configuraci√≥n hardware.

NDR

Output

BOOL

TRUE/FALSE

FALSE

Petici√≥n finalizada sin errores, datos apli‚Äê
cados
‚óè FALSE: la petici√≥n no se ha iniciado
a√∫n o se est√° ejecutando.
‚óè TRUE: la petici√≥n se ha concluido
correctamente.

ERROR

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo
est√° activado durante una llamada):
petici√≥n terminada con error

STATUS

Output

WORD

W#16#0000 a
W#16#FFFF

W#16#0000

Par√°metro de estado (el par√°metro s√≥lo
est√° activado durante una llamada. Por
ello, para visualizar el estado debe copiar‚Äê
se el STATUS en un √°rea de datos libre)
STATUS tiene el significado siguiente en
funci√≥n del bit ERROR:
‚óè ERROR=FALSE:
‚Äì

STATUS tiene el valor
W#16#0000:
ni advertencias ni errores

‚Äì

STATUS tiene el valor<>
W#16#0000: advertencia,
STATUS da informaci√≥n detallada.

‚óè ERROR=TRUE:
hay un error, STATUS da informaci√≥n
detallada sobre el tipo de error.

7590

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores Ajuste predeter‚Äê
minado

Descripci√≥n

RD_1

InOut

ANY

seg√∫n CPU

Par√°metro de recepci√≥n:

0

Aqu√≠ se indica lo siguiente:
‚óè n√∫mero del DB en el que se guardan
los datos recibidos.
‚óè n√∫mero del byte de datos a partir del
que deben guardarse los datos
recibidos. Valores posibles: de 0 a
8190
P. ej.: DB 20 a partir del byte 5 ->
DB20.DBB5
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro RD_1 siempre re‚Äê
quiere que se especifiquen por completo
los par√°metros de DB (ej.:
P#DB13.DBX0.0 byte 100). En las CPUs
S7-300 no est√° permitido omitir un n√∫mero
de DB expl√≠cito; de lo contrario se genera
un aviso de error en el programa de usua‚Äê
rio.
LEN

InOut

INT

de 0 a 1024

0

Salida de la longitud de datos (n√∫mero de
bytes)

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Coherencia de datos
La coherencia de datos est√° limitada a 206 bytes. Para la transferencia coherente de m√°s de
206 bytes hay que tener en cuenta lo siguiente:
No vuelva a acceder al DB de recepci√≥n hasta que no se hayan recibido los datos por completo
(NDR = TRUE). Posteriormente, bloquee el DB de recepci√≥n (EN_R = FALSE) hasta que se
hayan procesado los datos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7591

Instrucciones
4.2 Instrucciones

RES_RCVB: Borrar b√∫fer de recepci√≥n (ASCII, 3964(R))
Descripci√≥n
Con la instrucci√≥n "RES_RECV" se borra todo el b√∫fer de recepci√≥n del m√≥dulo. Todos los
telegramas guardados se rechazan. Si en el momento de llamar la instrucci√≥n "RES_RCVB"
est√° entrando un telegrama, se guardar√°.
‚óè La petici√≥n se activa despu√©s de la llamada de la instrucci√≥n y de un flanco ascendente en
la entrada de control REQ. La petici√≥n puede durar varias llamadas (ciclos de programa).
‚óè Para que la instrucci√≥n pueda procesar la petici√≥n, hay que llamarla con R(Reset)=FALSE.
En caso de un flanco ascendente en la entrada de control R se cancela el proceso de
borrado y se pone la instrucci√≥n al estado inicial. Una petici√≥n cancelada finaliza con un
mensaje de error (salida STATUS).
‚óè Con LADDR se indica la direcci√≥n E/S del subm√≥dulo que se ha definido en la configuraci√≥n
hardware.
‚óè Si la petici√≥n ha finalizado sin errores, DONE se pone a TRUE, y si ha finalizado con
errores, ERROR se pone a TRUE.
‚óè En STATUS, la CPU indica el n√∫mero de evento correspondiente en caso de error o
advertencia.
‚óè DONE y ERROR/STATUS tambi√©n se devuelven en caso de RESET de la instrucci√≥n
(R=TRUE).
En caso de producirse un error, el resultado binario BR se borra. Si el bloque finaliza sin
errores, el resultado binario tiene el estado TRUE.
Nota
La instrucci√≥n no comprueba los par√°metros; en caso de parametrizaci√≥n err√≥nea la CPU
puede derivar al estado STOP.

DB de instancia
La instrucci√≥n "RES_RCVB" trabaja con un DB de instancia. El n√∫mero de DB se indica en la
llamada. No est√° permitido acceder a los datos del DB de instancia.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RES_RCVB":
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

Rango de valo‚Äê
res

Ajuste predeter‚Äê
minado

Descripci√≥n

REQ

Input

TRUE/FALSE

FALSE

Par√°metro de control Request:

BOOL

activa la petici√≥n en caso de un flanco as‚Äê
cendente
R

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Reset:
la petici√≥n se cancela.

7592

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n Tipo de da‚Äê
tos

Rango de valo‚Äê
res

Ajuste predeter‚Äê
minado

Descripci√≥n

LADDR

Input

WORD

seg√∫n CPU

W#16#03FF

Direcci√≥n E/S del subm√≥dulo que se ha de‚Äê
finido en la configuraci√≥n hardware.

DONE

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada):
‚óè FALSE: la petici√≥n no se ha iniciado a√∫n
o se est√° ejecutando.
‚óè TRUE: la petici√≥n se ha ejecutado sin
errores.

ERROR

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada):
petici√≥n terminada con error

STATUS

Output

WORD

W#16#0000 a
W#16#FFFF

W#16#0000

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada. Por ello,
para visualizar el estado debe copiarse el
STATUS en un √°rea de datos libre)
STATUS tiene el significado siguiente en
funci√≥n del bit ERROR:
‚óè ERROR=FALSE:
‚Äì

STATUS tiene el valor W#16#0000:
ni advertencias ni errores

‚Äì

STATUS tiene el valor <>
W#16#0000: advertencia, STATUS
da informaci√≥n detallada.

‚óè ERROR=TRUE:
hay un error, STATUS da informaci√≥n
detallada sobre el tipo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

RK 512
SEND_RK: Enviar datos (RK 512)
Descripci√≥n
La instrucci√≥n SEND_RK permite enviar un conjunto de datos de un bloque de datos.
‚óè El proceso de transmisi√≥n se activa despu√©s de la llamada de la instrucci√≥n y del flanco
ascendente en la entrada de control REQ.
‚óè El √°rea de los datos que deben enviarse se indica con SD_1 (n√∫mero de DB y direcci√≥n
inicial), la longitud del conjunto de datos con LEN.
‚óè En la instrucci√≥n se indica tambi√©n el √°rea de recepci√≥n en el interlocutor. La CPU registra
esta informaci√≥n en el encabezado del telegrama y la transmite al interlocutor.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7593

Instrucciones
4.2 Instrucciones
‚óè El destino se indica con el n√∫mero de CPU R_CPU (s√≥lo relevante en caso de
comunicaci√≥n multiprocesador), el tipo de datos R_TYPE (bloques de datos (DB) y bloques
de datos ampliados (DX)), el n√∫mero de bloque de datos R_DBNO y el offset R_OFFSET
en el que debe escribirse el primer byte.
‚óè Con R_CF_BYT y R_CF_BIT se definen el byte y bit de marcas de acoplamiento en la CPU
interlocutora.
‚óè Con el par√°metro SYNC_DB se establece el DB en el que se guardar√°n los datos comunes
a todas las instrucciones utilizadas para la inicializaci√≥n en el arranque y la sincronizaci√≥n.
El n√∫mero de DB debe ser id√©ntico para todas las instrucciones utilizadas en el programa
de usuario.
‚óè Para que la instrucci√≥n pueda procesar la petici√≥n, hay que llamarla con R(Reset)=FALSE.
En caso de un flanco ascendente en la entrada de control R se cancela el proceso de
transmisi√≥n en curso y se pone la instrucci√≥n al estado inicial. Una petici√≥n cancelada
finaliza con un mensaje de error (salida STATUS).
‚óè Con LADDR se indica la direcci√≥n E/S del subm√≥dulo que se ha definido en la configuraci√≥n
hardware.
‚óè Si la petici√≥n ha finalizado sin errores, DONE se pone a TRUE, y si ha finalizado con
errores, ERROR se pone a TRUE.
‚óè Si la petici√≥n se ha ejecutado con DONE = TRUE, los datos se han enviado al interlocutor
de la comunicaci√≥n, que los ha acusado positivamente, y los datos se han transferido a la
CPU interlocutora.
‚óè En STATUS, la CPU indica el n√∫mero de evento correspondiente en caso de error o
advertencia.
‚óè DONE y ERROR/STATUS tambi√©n se devuelven en caso de RESET de la instrucci√≥n
(R=TRUE).
En caso de producirse un error, el resultado binario BR se borra. Si el bloque finaliza sin
errores, el resultado binario tiene el estado TRUE.
Nota
La instrucci√≥n no comprueba los par√°metros; en caso de parametrizaci√≥n err√≥nea la CPU
puede derivar al estado STOP.

DB de instancia
La instrucci√≥n "SEND_RK" trabaja con un DB de instancia. El n√∫mero de DB se indica en la
llamada. No est√° permitido acceder a los datos del DB de instancia.

7594

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Particularidades de la transmisi√≥n de datos
Tenga en cuenta las particularidades siguientes al "enviar datos":
‚óè Con RK 512 s√≥lo es posible enviar un n√∫mero par de datos. Si se indica un n√∫mero impar
de datos como longitud (LEN), se transferir√° un byte de relleno adicional con el valor "0" al
final de los datos.
‚óè Con RK 512 s√≥lo es posible indicar un offset par. Si se indica un offset impar, los datos se
guardan en el interlocutor a partir del siguiente offset par m√°s peque√±o.
Ejemplo: el offset es "7", los datos se guardan a partir del byte "6".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SEND_RK":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Rango de valo‚Äê
tos
res

Ajuste predeter‚Äê Descripci√≥n
minado

SYNC_DB

Input

INT

seg√∫n CPU

0

REQ

Input

BOOL

TRUE/FALSE

FALSE

N√∫mero del DB en el que se guardan los
datos comunes para la sincronizaci√≥n de
las instrucciones RK (longitud m√≠nima 240
bytes).
Par√°metro de control Request:
activa la petici√≥n en caso de un flanco as‚Äê
cendente

R

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Reset:
la petici√≥n se cancela.

LADDR

Input

WORD

seg√∫n CPU

W#16#03FF

Direcci√≥n E/S del subm√≥dulo que se ha
definido en la configuraci√≥n hardware.

R_CPU

Input

INT

de 0 a 4

1

N√∫mero de la CPU interlocutora

R_TYPE

Input

CHAR

'D', 'X'

'D'

Tipo de direcci√≥n en la CPU interlocutora
(s√≥lo se admiten may√∫sculas)

(s√≥lo en modo multiprocesador)

'D': bloque de datos
'X': bloque de datos avanzado
R_DBNO

Input

INT

de 0 a 255

0

N√∫mero del bloque de datos en la CPU in‚Äê
terlocutora

R_OFFSET

Input

INT

de 0 a 510

0

N√∫mero del byte de datos en la CPU inter‚Äê
locutora

255

Byte de marcas de acoplamiento en la
CPU interlocutora

(s√≥lo valores pa‚Äê
res)
R_CF_BYT

Input

INT

de 0 a 255

(255: significa: sin marcas de acoplamien‚Äê
to)
R_CF_BIT

Input

INT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

de 0 a 7

0

Bit de marcas de acoplamiento en la CPU
interlocutora

7595

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê Rango de valo‚Äê
tos
res

Ajuste predeter‚Äê Descripci√≥n
minado

DONE

Output

BOOL

FALSE

TRUE/FALSE

Par√°metro de estado (el par√°metro s√≥lo
est√° activado durante una llamada):
‚óè FALSE: la petici√≥n no se ha iniciado
a√∫n o se est√° ejecutando.
‚óè TRUE: la petici√≥n se ha ejecutado sin
errores.

ERROR

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo
est√° activado durante una llamada):
petici√≥n terminada con error

STATUS

Output

WORD

W#16#0000 a
W#16#FFFF

W#16#0000

Par√°metro de estado (el par√°metro s√≥lo
est√° activado durante una llamada. Por
ello, para visualizar el estado debe copiar‚Äê
se el STATUS en un √°rea de datos libre)
STATUS tiene el significado siguiente en
funci√≥n del bit ERROR:
‚óè ERROR=FALSE:
‚Äì

STATUS tiene el valor
W#16#0000: ni advertencias ni
errores

‚Äì

STATUS tiene el valor<>
W#16#0000: advertencia,
STATUS da informaci√≥n detallada.

‚óè ERROR=TRUE:
hay un error, STATUS da informaci√≥n
detallada sobre el tipo de error.
SD_1

Input

ANY

seg√∫n CPU

0

Par√°metro de transmisi√≥n:
Aqu√≠ se indica lo siguiente:
‚óè n√∫mero del DB desde el que deben
enviarse los datos.
‚óè n√∫mero del byte de datos a partir del
que deben enviarse los datos. Valores
posibles: de 0 a 8190
P. ej.: DB 10 a partir del byte 2 ->
DB10.DBB2
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro SD_1 siempre re‚Äê
quiere que se especifiquen por completo
los par√°metros de DB (ej.:
P#DB13.DBX0.0 byte 100). En las CPUs
S7-300 no est√° permitido omitir un n√∫mero
de DB expl√≠cito; de lo contrario se genera
un aviso de error en el programa de usua‚Äê
rio.

LEN

7596

Input

INT

de 1 a 1024

1

Aqu√≠ se indica en bytes la longitud del con‚Äê
junto de datos que debe enviarse (la longi‚Äê
tud se indica indirectamente).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Datos del encabezado del telegrama
La tabla siguiente muestra los datos del encabezado del telegrama RK 512.
Origen en el propio sistema
de automatizaci√≥n S7
(CPU local)

Al destino, CPU interlocu‚Äê Encabezado del telegrama, bytes
tora
3/4 tipo de comando 5/6 Z-DBNR1 /
Z-Offset2

7/8 n√∫mero en

Bloque de datos

Bloque de datos

AD

DB/DW3

palabras

Bloque de datos

Bloque de datos avanza‚Äê
do

AD

DB/DW3

palabras

1

Z-DBNR: n√∫mero del bloque de datos de destino

2

Z-Offset: direcci√≥n inicial de destino

3

DW: offset en palabras

Coherencia de datos
La coherencia de datos est√° limitada a 128 bytes. Para la transferencia de datos coherente de
m√°s de 128 bytes hay que tener en cuenta lo siguiente:
No vuelva a escribir en la parte utilizada actualmente del √°rea de transmisi√≥n SD_1 hasta que
no haya finalizado la transmisi√≥n. Esto sucede cuando el par√°metro de estado DONE adopta
el valor TRUE.

FETCH_RK: Recoger datos (RK 512)
Descripci√≥n
La instrucci√≥n "FETCH_RK" permite recoger un conjunto de datos del interlocutor y guardar los
datos en un bloque de datos.
‚óè El proceso de transmisi√≥n se activa despu√©s de la llamada del bloque y de un flanco
ascendente en la entrada de control REQ.
‚óè El √°rea en el que se guardan los datos recogidos se indica con RD_1 (n√∫mero de DB y
direcci√≥n inicial), la longitud del conjunto de datos con LEN.
‚óè En la instrucci√≥n tambi√©n se indica el √°rea a partir de la cual deben recogerse los datos del
interlocutor. La CPU registra esta informaci√≥n en el encabezado del telegrama RK512 y la
transmite al interlocutor.
‚óè El √°rea del interlocutor se indica con el n√∫mero de CPU R_CPU (s√≥lo relevante en caso de
comunicaci√≥n multiprocesador), el tipo de datos R_TYPE (bloques de datos y bloques de
datos ampliados, marcas, entradas, salidas, contadores y temporizadores), el n√∫mero del
bloque de datos R_DBNO (s√≥lo relevante en bloques de datos y bloques de datos
ampliados) y el offset R_OFFSET del que debe recogerse el primer byte.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7597

Instrucciones
4.2 Instrucciones
‚óè Con R_CF_BYT y R_CF_BIT se definen el byte y bit de marcas de acoplamiento en la CPU
interlocutora.
‚óè Con el par√°metro SYNC_DB se establece el DB en el que se guardar√°n los datos comunes
a todas las instrucciones utilizadas para la inicializaci√≥n en el arranque y la sincronizaci√≥n.
El n√∫mero de DB debe ser id√©ntico para todas las instrucciones utilizadas en el programa
de usuario.
‚óè Para que la instrucci√≥n pueda procesar la petici√≥n, hay que llamarla con R(Reset)=FALSE.
En caso de un flanco ascendente en la entrada de control R se cancela la transmisi√≥n en
curso y se pone la instrucci√≥n al estado inicial. Una petici√≥n cancelada finaliza con un
mensaje de error (salida STATUS).
‚óè Con LADDR se indica la direcci√≥n E/S del subm√≥dulo que se ha definido en la configuraci√≥n
hardware.
‚óè Si la petici√≥n ha finalizado sin errores, DONE se pone a TRUE, y si ha finalizado con
errores, ERROR se pone a TRUE.
‚óè En STATUS, la CPU indica el n√∫mero de evento correspondiente en caso de error o
advertencia.
‚óè DONE y ERROR/STATUS tambi√©n se devuelven en caso de RESET de la instrucci√≥n
(R=TRUE).
En caso de producirse un error, el resultado binario BR se borra. Si la instrucci√≥n finaliza sin
errores, el resultado binario tiene el estado TRUE.
Nota
La instrucci√≥n no comprueba los par√°metros; en caso de parametrizaci√≥n err√≥nea la CPU
puede derivar al estado STOP. Si se recogen datos de la propia CPU, debe programarse una
instrucci√≥n "SERVE_RK (P√°gina 7602)" en la CPU.

DB de instancia
La instrucci√≥n "FETCH_RK" trabaja con un DB de instancia. El n√∫mero de DB se indica en la
llamada. No est√° permitido acceder a los datos del DB de instancia.

Particularidades de los bloques de datos (avanzados)
Tenga en cuenta las particularidades siguientes al "recoger datos" de bloques de datos y
bloques de datos ampliados:
‚óè Con RK 512 s√≥lo es posible recoger un n√∫mero par de datos. Si se indica un n√∫mero impar
como longitud (LEN), siempre se transmite un byte adicional. Sin embargo, en el DB de
destino se registra la cantidad correcta de datos.
‚óè Con RK 512 s√≥lo es posible indicar un offset par. Si se indica un offset impar, los datos se
recogen del interlocutor desde el siguiente offset par m√°s peque√±o.
Ejemplo: el offset es 7, los datos se recogen a partir del byte 6.

7598

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Particularidades en temporizadores y contadores
Si se recogen temporizadores o contadores del interlocutor, hay que tener en cuenta que para
cada temporizador y cada contador se recogen 2 bytes. As√≠, p. ej., si desea recoger 10
contadores, deber√° indicar una longitud de 20.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "FETCH_RK".
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores Ajuste prede‚Äê
terminado

Descripci√≥n

SYNC_DB

Input

INT

seg√∫n CPU

0

N√∫mero del DB en el que se guardan los
datos comunes para la sincronizaci√≥n de las
instrucciones RK (longitud m√≠nima 240
bytes).

REQ

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Request:
activa la petici√≥n en caso de un flanco as‚Äê
cendente

R

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Reset:
la petici√≥n se cancela.

LADDR

Input

WORD

seg√∫n CPU

W#16#03FF

Direcci√≥n E/S del subm√≥dulo que se ha de‚Äê
finido en la configuraci√≥n hardware.

R_CPU

Input

INT

de 0 a 4

1

N.¬∫ de la CPU interlocutora

R_TYPE

Input

CHAR

'D', 'X', 'M', 'E', 'A',
'Z', 'T'

'D'

Tipo de direcci√≥n en la CPU interlocutora

(s√≥lo en modo multiprocesador)
‚óè 'D': bloque de datos
‚óè 'X': bloque de datos avanzado
‚óè 'M': marcas
‚óè 'E': entradas
‚óè 'A': salidas
‚óè 'Z': contadores
‚óè 'T': temporizadores
R_DBNO

Input

INT

de 0 a 255

0

N√∫mero del bloque de datos en la CPU in‚Äê
terlocutora

R_OFFSET

Input

INT

V√©ase la tabla:
"Par√°metros del
origen de los da‚Äê
tos (CPU interlo‚Äê
cutora)"

0

N√∫mero del byte de datos en la CPU inter‚Äê
locutora

R_CF_BYT

Input

INT

de 0 a 255

255

Byte de marcas de acoplamiento en la CPU
interlocutora
(255: significa: sin marcas de acoplamiento)

R_CF_BIT

Input

INT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

de 0 a 7

0

Bit de marcas de acoplamiento en la CPU
interlocutora

7599

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores Ajuste prede‚Äê
terminado

Descripci√≥n

DONE

Output

BOOL

TRUE/FALSE

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada):

FALSE

‚óè FALSE: la petici√≥n no se ha iniciado a√∫n
o se est√° ejecutando.
‚óè TRUE: la petici√≥n se ha ejecutado sin
errores.
ERROR

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada):
petici√≥n finalizada con errores

STATUS

Output

WORD

W#16#0000 a
W#16#FFFF

W#16#0000

Par√°metro de estado (el par√°metro s√≥lo es‚Äê
t√° activado durante una llamada. Por ello,
para visualizar el estado debe copiarse el
STATUS en un √°rea de datos libre)
STATUS tiene el significado siguiente en
funci√≥n del bit ERROR:
‚óè ERROR=FALSE:
‚Äì

STATUS tiene el valor W#16#0000:
ni advertencias ni errores

‚Äì

STATUS tiene el valor<>
W#16#0000: advertencia, STATUS
da informaci√≥n detallada.

‚óè ERROR=TRUE:
hay un error, STATUS da informaci√≥n
detallada sobre el tipo de error.
RD_1

Input

ANY

seg√∫n CPU

0

Par√°metro de recepci√≥n:
Aqu√≠ se indica lo siguiente:
‚óè n√∫mero del DB en el que se guardan los
datos recogidos.
‚óè n√∫mero del byte de datos a partir del que
se guardan los datos recogidos. Valores
posibles: de 0 a 8190
P. ej.: DB 10 a partir del byte 2 ->
DB10.DBB2
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro RD_1 siempre requie‚Äê
re que se especifiquen por completo los pa‚Äê
r√°metros de DB (ej.: P#DB13.DBX0.0 byte
100). En las CPUs S7-300 no est√° permitido
omitir un n√∫mero de DB expl√≠cito; de lo con‚Äê
trario se genera un aviso de error en el pro‚Äê
grama de usuario.

LEN

Input

INT

de 1 a 1024

1

Aqu√≠ se indica la longitud del conjunto de
datos que debe recogerse en bytes (la lon‚Äê
gitud se indica indirectamente).
Para cada temporizador y contador debe in‚Äê
dicarse una longitud de dos bytes.

7600

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros del origen de los datos (CPU interlocutora)
La tabla siguiente muestra los tipos de datos que pueden transferirse.
El valor "R_OFFSET" est√° determinado por la CPU interlocutora.
Origen en la CPU interlocutora

R_TYPE

R_NO

R_OFFSET (en bytes)

Bloque de datos

'D'

0 - 255

0 - 510, s√≥lo tienen sentido valores pares

Bloque de datos avanzado

'X'

0 - 255

0 - 510, s√≥lo tienen sentido valores pares

Marcas

'M'

irrelevante

0 - 255

Entradas

'E'

irrelevante

0 - 255

Salidas

'A'

irrelevante

0 - 255

Contadores

'Z'

irrelevante

0 - 255

Temporizadores

'T'

irrelevante

0 - 255

Datos del encabezado del telegrama
La tabla siguiente muestra los datos del encabezado del telegrama RK 512.
Origen en la CPU in‚Äê Al destino, su sistema de automatiza‚Äê
terlocutora
ci√≥n S7 (CPU local)

Encabezado del telegrama, bytes
3/4 tipo de co‚Äê
mando

5/6 Q-DBNR1 /
Q-Offset2

7/8 n√∫mero en

Bloque de datos

Bloque de datos

ED

DB/DW

Palabras

Bloque de datos
avanzado

Bloque de datos

EX

DB/DW

Palabras

Marcas

Bloque de datos

EM

Direcci√≥n de byte

Bytes

Entradas

Bloque de datos

EE

Direcci√≥n de byte

Bytes

Salidas

Bloque de datos

EA

Direcci√≥n de byte

Bytes

Contadores

Bloque de datos

EZ

N√∫mero de conta‚Äê
dor

Palabras

Temporizadores

Bloque de datos

ET

N√∫mero de tempo‚Äê Palabras
rizador

1

Q-DBNR: n√∫mero del bloque de datos de origen

2

Q-Offset: direcci√≥n inicial de origen

Coherencia de datos
La coherencia de datos est√° limitada a 128 bytes. Para la transferencia de datos coherente de
m√°s de 128 bytes hay que tener en cuenta lo siguiente:
No vuelva a escribir en la parte utilizada actualmente del √°rea de recepci√≥n RD_1 hasta que no
haya finalizado la transmisi√≥n. Esto sucede cuando el par√°metro de estado DONE adopta el
valor TRUE.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7601

Instrucciones
4.2 Instrucciones

SERVE_RK: Recibir y preparar datos (RK 512)
Descripci√≥n
La instrucci√≥n "SERVE_RK" se utiliza para recibir datos y ponerlos a disposici√≥n.
‚óè Recibir datos: los datos se guardan en el √°rea de datos especificada por el interlocutor en
el encabezado del telegrama RK 512. La llamada de la instrucci√≥n es necesaria cuando el
interlocutor de la comunicaci√≥n ejecuta una petici√≥n "Enviar datos" (petici√≥n SEND).
‚óè Poner datos a disposici√≥n: los datos se recogen del √°rea de datos especificada por el
interlocutor en el encabezado del telegrama RK 512. La llamada de la instrucci√≥n es
necesaria cuando el interlocutor de la comunicaci√≥n ejecuta una petici√≥n "Recoger datos"
(petici√≥n FETCH).
Despu√©s de la llamada, la instrucci√≥n est√° disponible con el valor TRUE en la entrada de
control EN_R. Es posible cancelar una transmisi√≥n en curso con el estado l√≥gico FALSE del
par√°metro EN_R. Una petici√≥n cancelada finaliza con un mensaje de error (salida STATUS).
La recepci√≥n estar√° desactivada mientras haya un estado l√≥gico de FALSE en el par√°metro
EN_R.
Con el par√°metro "SYNC_DB" se establece el DB en el que se guardar√°n los datos comunes
a todas las instrucciones utilizadas para la inicializaci√≥n en el arranque y la sincronizaci√≥n. El
n√∫mero de DB debe ser id√©ntico para todas las instrucciones utilizadas en el programa de
usuario.
Para que la instrucci√≥n pueda procesar la petici√≥n, hay que llamarla con R(Reset)=FALSE. En
caso de un flanco ascendente en la entrada de control R se cancela la transmisi√≥n en curso y
se pone la instrucci√≥n al estado inicial. Una petici√≥n cancelada finaliza con un mensaje de error
(salida STATUS).
Con LADDR se indica la direcci√≥n E/S del subm√≥dulo que se ha definido en HW Config.
Si la petici√≥n ha finalizado sin errores, NDR se pone a TRUE, y si ha finalizado con errores,
ERROR se pone a TRUE.
Con NDR=TRUE para una llamada de la instrucci√≥n en los par√°metros L_TYPE, L_DBNO y
L_OFFSET, la CPU indica d√≥nde se guardan los datos y de d√≥nde se recogen. Adem√°s, para
una llamada se muestran los par√°metros L_CF_BYT y L_CF_BIT y la longitud LEN de la
petici√≥n en cuesti√≥n.
En STATUS, la CPU indica el n√∫mero de evento correspondiente en caso de error o
advertencia.
NDR y ERROR/STATUS tambi√©n se devuelven en caso de RESET de la instrucci√≥n
(R=TRUE) (par√°metro LEN == 16#00).
En caso de producirse un error, el resultado binario BR se borra. Si el bloque finaliza sin
errores, el resultado binario tiene el estado TRUE.
Nota
La instrucci√≥n no comprueba los par√°metros; en caso de parametrizaci√≥n err√≥nea la CPU
puede derivar al estado STOP.

7602

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

DB de instancia
La instrucci√≥n "SERVE_RK" trabaja con un DB de instancia. El n√∫mero de DB se indica en la
llamada. No est√° permitido acceder a los datos del DB de instancia.

Aplicaci√≥n de las marcas de acoplamiento
Mediante una marca de acoplamiento es posible bloquear y habilitar las peticiones SEND y
FETCH del interlocutor de la comunicaci√≥n. Existe la posibilidad de impedir que los datos que
todav√≠a no se han procesado, se sobrescriban o lean.
Puede definirse una marca de acoplamiento para cada petici√≥n.
,QWHUORFXWRU
6(1'B5.
5B&)B%<7

5B&)B%,7

5B7<3( '%

5B'%12

5B2))6(7

6X&38

8WLOL]DXQELWGHPDUFDVSDUDHVFULELUHQ'%

0DUFDGHDFRSODPLHQWR
0%        

6(59(B5.

)(7&+B5.
5B&)B%<7

5B&)B%,7

5B7<3( '%

5B'%12

5B2))6(7

/RVDFFHVRVDORVGDWRV
SXHGHQEORTXHDUVH
PHGLDQWHORVELWVGHPDUFDGH
DFRSODPLHQWR758()$/6(

/B&)B%<7

/B&)B%,7

/B7<3( '%

/B'%12

/B2))6(7

$VLJQDFL¬µQ
ELWGH
PDUFDV
D'%

'%
'%
'%
'%
0DUFDGHDFRSODPLHQWR

8WLOL]DXQELWGHPDUFDVSDUDOHHUGH'%
0%

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7603

Instrucciones
4.2 Instrucciones

Ejemplo: SEND_RK con marca de acoplamiento:
En este ejemplo, el interlocutor de la comunicaci√≥n env√≠a datos al DB 101 en su CPU
1. Ponga la marca de acoplamiento 100.6 de la propia CPU a FALSE.
2. En la petici√≥n SEND del interlocutor, indique la marca de acoplamiento 100.6 (par√°metros
R_CF_BYT, R_CF_BIT).
La marca de acoplamiento se transfiere a la propia CPU en el encabezado del telegrama
RK 512.
Antes de procesar la petici√≥n, la CPU comprueba la marca de acoplamiento indicada en el
encabezado del telegrama RK 512. La petici√≥n s√≥lo se procesa si la marca de acoplamiento
de la propia CPU tiene el valor FALSE. Si la marca de acoplamiento tiene el valor TRUE,
en el telegrama de reacci√≥n se enviar√° el mensaje de error "32 hex" al interlocutor de la
comunicaci√≥n.
Una vez transferidos los datos al DB101, la marca de acoplamiento 100.6 de la propia CPU
pasar√° de SERVE al valor TRUE y el byte y bit de marcas de acoplamiento se devolver√°n
en SERVE durante una llamada (si NDR =TRUE).
3. Evaluando la marca de acoplamiento en el programa de usuario (marca de acoplamiento
100.6 =TRUE) es posible saber si la petici√≥n ha finalizado y si los datos transferidos pueden
procesarse.
4. Una vez procesados los datos en el programa de usuario, se debe volver a poner la marca
de acoplamiento 100.6 a FALSE. S√≥lo entonces, el interlocutor acoplado podr√° volver a
ejecutar la petici√≥n sin errores.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SERVE_RK".
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores Ajuste predeter‚Äê
minado

Descripci√≥n

SYNC_DB

Input

INT

seg√∫n CPU

0

N√∫mero del DB en el que se guardan los
datos comunes para la sincronizaci√≥n de
las instrucciones RK (longitud m√≠nima 240
bytes).

EN_R

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Enable to receive:
petici√≥n habilitada

R

Input

BOOL

TRUE/FALSE

FALSE

Par√°metro de control Reset:
la petici√≥n se cancela.

LADDR

Input

WORD

seg√∫n CPU

W#16#03FF

Direcci√≥n E/S del subm√≥dulo que se ha
definido en la configuraci√≥n hardware.

NDR

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado New Data Ready (el
par√°metro s√≥lo est√° activado durante una
llamada):
‚óè FALSE: la petici√≥n no se ha iniciado
a√∫n o se est√° ejecutando.
‚óè TRUE: la petici√≥n se ha ejecutado
correctamente.

ERROR

Output

BOOL

TRUE/FALSE

FALSE

Par√°metro de estado (el par√°metro s√≥lo
est√° activado durante una llamada):
petici√≥n finalizada con errores

7604

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores Ajuste predeter‚Äê
minado

Descripci√≥n

STATUS

Output

WORD

W#16#0000 a
W#16#FFFF

Par√°metro de estado (el par√°metro s√≥lo
est√° activado durante una llamada. Por
ello, para visualizar el estado debe copiar‚Äê
se el STATUS en un √°rea de datos libre)

W#16#0000

STATUS tiene el significado siguiente en
funci√≥n del bit ERROR:
‚óè ERROR=FALSE:
‚Äì

STATUS tiene el valor
W#16#0000: ni advertencias ni
errores

‚Äì

STATUS tiene el valor <>
W#16#0000: advertencia,
STATUS da informaci√≥n detallada.

‚óè ERROR=TRUE:
hay un error, STATUS da informaci√≥n
detallada sobre el tipo de error.
L_TYPE

Output

CHAR

'D'

''

Recibir datos:
Tipo de zona de destino en la CPU local
(s√≥lo se admiten may√∫sculas):
‚óè 'D': bloque de datos
Poner datos a disposici√≥n:
Tipo de zona de origen en la CPU local
(s√≥lo se admiten may√∫sculas):

'D', 'M', 'I', 'O', 'C',
'T',

‚óè 'D': bloque de datos
‚óè 'M': marcas
‚óè 'I': entradas
‚óè 'O': salidas
‚óè 'C': contadores
‚óè 'T': temporizadores
El par√°metro s√≥lo est√° activado durante
una llamada.

L_DBNO

Output

INT

seg√∫n CPU

0

N√∫mero del bloque de datos en la CPU lo‚Äê
cal. El par√°metro s√≥lo est√° activado duran‚Äê
te una llamada.

L_OFFSET

Output

INT

0 - 510

0

N√∫mero del byte de datos en la CPU local.
El par√°metro s√≥lo est√° activado durante
una llamada.

L_CF_BYT

Output

INT

de 0 a 255

0

Byte de marcas de acoplamiento en la
CPU local. El par√°metro s√≥lo est√° activado
durante una llamada.
(255: significa: sin marcas de acoplamien‚Äê
to)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7605

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de
datos

Rango de valores Ajuste predeter‚Äê
minado

Descripci√≥n

L_CF_BIT

Output

INT

de 0 a 7

0

Bit de marcas de acoplamiento en la CPU
local. El par√°metro s√≥lo est√° activado du‚Äê
rante una llamada.

LEN

InOut

INT

de 0 a 1024

0

Longitud del telegrama, n√∫mero en bytes
(el par√°metro s√≥lo est√° activado durante
una llamada)

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Coherencia
La coherencia est√° limitada a 128 bytes. Para la transferencia de datos coherente de m√°s de
128 bytes hay que tener en cuenta lo siguiente:
Utilice la funci√≥n de marca de acoplamiento. No vuelva a acceder a los datos hasta que √©stos
no se hayan transferido por completo (evaluaci√≥n de la marca de acoplamiento definida para
esta petici√≥n; la marca de acoplamiento est√° pendiente para una llamada en la instrucci√≥n si
NDR = TRUE). No vuelva a poner la marca de acoplamiento a FALSE hasta que no se hayan
procesado los datos.

4.2.5.8

Comunicaci√≥n con iSlave/iDevice

I_GET: Leer datos de un interlocutor en la propia estaci√≥n S7
Descripci√≥n
La instrucci√≥n "I_GET" permite leer datos de un interlocutor que se encuentra dentro de la
estaci√≥n S7 propia. El interlocutor puede estar en el aparato central, en un aparato de
ampliaci√≥n o bien descentralizado. Recuerde que tiene que haber asignado los interlocutores
descentralizados a la CPU propia. En el interlocutor no existe una instrucci√≥n correspondiente.
El proceso de recepci√≥n se activa tras llamar la instrucci√≥n con REQ=1. A continuaci√≥n se
llama la instrucci√≥n hasta que la recepci√≥n de datos se indique con BUSY=0. RET_VAL
contiene entonces la longitud del bloque de datos recibido en bytes.
Aseg√∫rese de que el √°rea de recepci√≥n definida por el par√°metro RD (en la CPU recibida)
tenga como m√≠nimo la misma longitud que el √°rea de lectura definida por el par√°metro
VAR_ADDR (en el interlocutor). Adem√°s deben coincidir los tipos de datos en RD y
VAR_ADDR.

7606

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "I_GET":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control "request to activate"
Consulte tambi√©n: AUTOHOTSPOT

CONT

Input

BOOL

I, Q, M, D, L

Par√°metro de control "continue"
Consulte tambi√©n: AUTOHOTSPOT

IOID

Input

BYTE

I, Q, M, D, L, P o
constante

Identificaci√≥n del √°rea de direccionamiento del m√≥‚Äê
dulo interlocutor:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse la
identificaci√≥n de √°rea de la direcci√≥n m√°s baja. Si
las direcciones son id√©nticas, debe indicarse
B#16#54.

LADDR

Input

WORD

I, Q, M, D, L, P o
constante

Direcci√≥n l√≥gica del m√≥dulo interlocutor
Con un m√≥dulo mixto debe indicarse la direcci√≥n
m√°s baja de las dos.

VAR_ADDR

Input

ANY

I, Q, M, D

Referencia al √°rea de la CPU interlocutora que de‚Äê
be leerse. Seleccione un tipo de datos soportado
por el interlocutor.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° el c√≥‚Äê
digo de error correspondiente.
Si no se produce ning√∫n error, RET_VAL contiene
la longitud en bytes del bloque de datos copiado en
el √°rea de recepci√≥n RD en forma de n√∫mero posi‚Äê
tivo.

BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: recepci√≥n todav√≠a no finalizada.
‚óè BUSY=0: la recepci√≥n ha finalizado, o bien no
hay ning√∫n proceso de recepci√≥n activo.

RD

Output

ANY

I, Q, M, D

Referencia al √°rea de recepci√≥n (receive data
area). Se permiten los siguientes tipos de datos:
BOOL, BYTE, CHAR, WORD, INT, DWORD, DINT,
REAL, DATE, TOD, TIME, S5_TIME, DA‚Äê
TE_AND_TIME as√≠ como arrays de los tipos de da‚Äê
tos indicados, excepto BOOL.
El √°rea de recepci√≥n RD debe ser como m√≠nimo tan
larga como el √°rea de lectura VAR_ADDR en el
interlocutor. Adem√°s es necesario que los tipos de
datos coincidan en RD y VAR_ADDR.
El tama√±o m√°ximo del √°rea de recepci√≥n es de 76
bytes.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7607

Instrucciones
4.2 Instrucciones

Transici√≥n de estado operativo tras STOP
Si la CPU cambia al estado operativo STOP, la conexi√≥n establecida por "I_GET" se deshace.
El tipo de la llamada realizada a continuaci√≥n determina si los datos ya recibidos, que se
encuentran en una memoria intermedia del sistema operativo, se pierden o no:
‚óè Con un rearranque (no con S7-300 ni S7-400H), estos datos se copian en el √°rea definida
por RD.
‚óè En un rearranque completo (en caliente) o arranque en fr√≠o, los datos se rechazan.

Transici√≥n de estado operativo del interlocutor a STOP
Un cambio de la CPU del interlocutor al estado operativo STOP no tiene efecto alguno sobre
la transmisi√≥n con "I_GET": Los datos tambi√©n se leen en el estado operativo STOP.

Coherencia de datos
Los datos se reciben con coherencia.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

I_PUT: Escribir datos de un interlocutor en la propia estaci√≥n S7
Descripci√≥n
La instrucci√≥n "I_PUT" permite escribir datos en un interlocutor que se encuentra dentro de la
estaci√≥n S7 propia. El interlocutor puede estar en el aparato central, en un aparato de
ampliaci√≥n o bien descentralizado. Recuerde que tiene que haber asignado los interlocutores
descentralizados a la CPU propia. En el interlocutor no existe una instrucci√≥n correspondiente.
El proceso de transmisi√≥n se produce tras la llamada de la instrucci√≥n con nivel 1 en la entrada
de control REQ.
Aseg√∫rese de que el √°rea de transmisi√≥n definida por el par√°metro SD (en la CPU emisora)
tenga la misma longitud que el √°rea de recepci√≥n definida por el par√°metro VAR_ADDR (en el
interlocutor). Adem√°s deben coincidir los tipos de datos en SD y VAR_ADDR.

7608

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "I_PUT":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control "request to activate"
Consulte tambi√©n: AUTOHOTSPOT

CONT

Input

BOOL

I, Q, M, D, L

Par√°metro de control "continue"
Consulte tambi√©n: AUTOHOTSPOT

IOID

Input

BYTE

I, Q, M, D, L, P o cons‚Äê Identificaci√≥n del √°rea de direccionamiento del
tante
m√≥dulo interlocutor:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse la
identificaci√≥n de √°rea de la direcci√≥n m√°s baja. Si
las direcciones son id√©nticas, debe indicarse
B#16#54.

LADDR

Input

WORD

I, Q, M, D, L, P o cons‚Äê Direcci√≥n l√≥gica del m√≥dulo interlocutor. Con un
tante
m√≥dulo mixto debe indicarse la direcci√≥n m√°s ba‚Äê
ja de las dos.

VAR_ADDR

Input

ANY

I, Q, M, D, L

Referencia al √°rea de la CPU interlocutora en la
que debe escribirse. Seleccione un tipo de datos
soportado por el interlocutor.

SD

Input

ANY

I, Q, M, D

Referencia al √°rea de la CPU propia que contiene
los datos que deben enviarse. Se permiten los
siguientes tipos de datos: BOOL, BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE, TOD,
TIME, S5TIME, DATE_AND_TIME as√≠ como
arrays de los tipos de datos indicados, excepto
BOOL.
SD debe tener la misma longitud que el par√°me‚Äê
tro VAR_ADDR del interlocutor. Adem√°s es ne‚Äê
cesario que los tipos de datos coincidan en SD y
VAR_ADDR.
El tama√±o m√°ximo del √°rea de transmisi√≥n es de
76 bytes.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° el
c√≥digo de error correspondiente.

BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: la transmisi√≥n todav√≠a no ha
finalizado.
‚óè BUSY=0: la transmisi√≥n ha finalizado, o bien
no hay ning√∫n proceso de transmisi√≥n activo.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7609

Instrucciones
4.2 Instrucciones

Transici√≥n de estado operativo tras STOP
Si la CPU cambia al estado operativo STOP, la conexi√≥n establecida por "I_PUT" se deshace.
Ya no es posible enviar los datos. Si los datos enviados ya estaban copiados en el b√∫fer interno
en el momento de la transici√≥n de estado operativo, el contenido del b√∫fer se rechaza.

Transici√≥n de estado operativo del interlocutor a STOP
Un cambio de la CPU del interlocutor al estado operativo STOP no tiene efecto alguno sobre
la transmisi√≥n de datos con "I_PUT". Los datos enviados se escriben de todos modos.

Coherencia de datos
Los datos se env√≠an con coherencia.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

I_ABORT: Deshacer conexi√≥n con interlocutor en la propia estaci√≥n S7
Descripci√≥n
La instrucci√≥n "I_ABORT" deshace una conexi√≥n con un interlocutor dentro de la estaci√≥n S7
propia que se hab√≠a establecido con "I_GET (P√°gina 7606)" o "I_PUT (P√°gina 7608)". Si la
petici√≥n correspondiente a "I_GET (P√°gina 7606)" o "I_PUT (P√°gina 7608)" ha finalizado
(BUSY = 0), tras la llamada de "I_ABORT" los recursos de conexi√≥n ocupados para dicha
petici√≥n se liberan de nuevo en ambos lados.
Si la petici√≥n correspondiente a "I_GET (P√°gina 7606)" o "I_PUT (P√°gina 7608)" no ha
finalizado (BUSY = 1), despu√©s de interrumpirse la conexi√≥n el propio usuario debe volver a
llamar la instrucci√≥n correspondiente con REQ = 0 y CONT = 0 y esperar a BUSY = 0. S√≥lo as√≠
quedar√°n liberados todos los recursos de conexi√≥n ocupados.
"I_ABORT" s√≥lo puede llamarse en el lado en el que se ejecuta "I_PUT (P√°gina 7608)" o
"I_GET (P√°gina 7606)" (es decir, en el lado del cliente).
La interrupci√≥n de la conexi√≥n se activa tras la llamada de la instrucci√≥n con REQ=1.

7610

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "I_ABORT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control "request to activate"
Consulte tambi√©n: AUTOHOTSPOT

IOID

Input

BYTE

I, Q, M, D, L, P o
constante

Identificaci√≥n del √°rea de direccionamiento del
m√≥dulo interlocutor:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse la
identificaci√≥n de √°rea de la direcci√≥n m√°s baja. Si
las direcciones son id√©nticas, debe indicarse
B#16#54.

LADDR

Input

WORD

I, Q, M, D, L, P o
constante

Direcci√≥n l√≥gica del m√≥dulo interlocutor. Con un
m√≥dulo mixto debe indicarse la direcci√≥n m√°s
baja de las dos.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° el
c√≥digo de error correspondiente.

BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: la interrupci√≥n de la conexi√≥n
todav√≠a no se ha finalizado.
‚óè BUSY=0: la interrupci√≥n de la conexi√≥n ha
finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Transici√≥n de estado operativo tras STOP
Si la CPU cambia al estado operativo STOP, cualquier interrupci√≥n iniciada con "I_ABORT"
finaliza.

Transici√≥n de estado operativo del interlocutor a STOP
Un cambio de la CPU del interlocutor al estado operativo STOP no tiene efecto alguno sobre
la interrupci√≥n de la conexi√≥n con "I_ABORT": La conexi√≥n se deshace.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)
Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7611

Instrucciones
4.2 Instrucciones

4.2.5.9

PROFINET CBA

Informaci√≥n sobre PN_IN, PN_OUT y PN_DP

Nota
El sistema operativo actualiza de forma est√°ndar tanto el componente PROFINET CBA como
las interconexiones DP en el punto de control del ciclo. No obstante, en caso de haber
desconectado estas actualizaciones autom√°ticas en la configuraci√≥n (p. ej. para poder influir
mejor en el comportamiento en el tiempo de la CPU), tendr√° que realizar las actualizaciones
personalmente. Para ello, llame las instrucciones "PN_IN (P√°gina 7614)", "PN_OUT
(P√°gina 7615)" y "PN_DP (P√°gina 7616)" en momentos adecuados. En la configuraci√≥n, las
actualizaciones indicadas s√≥lo pueden desactivarse conjuntamente.

Memoria sombra
El DB interfaz es la interfaz con el programa de usuario del componente PROFINET CBA. Para
garantizar que sus entradas y salidas sean coherentes durante la ejecuci√≥n de las partes
correspondientes del programa de usuario, para cada DB interfaz existe un √°rea de memoria
de id√©ntica estructura gestionada por el sistema operativo, que se conoce como "memoria
sombra". En el programa de usuario s√≥lo es posible acceder al DB interfaz, mientras que otros
componentes PROFINET CBA (externos) s√≥lo pueden acceder a la memoria sombra. De este
modo se excluye la posibilidad de un conflicto de acceso a las entradas y salidas del DB
interfaz.

Actualizaci√≥n del componente PROFINET CBA
De la realizaci√≥n arriba descrita de la coherencia de datos mediante una memoria sombra se
deriva que la actualizaci√≥n de los componentes PROFINET CBA se compone de las siguientes
acciones:
‚óè Copia de las entradas de la memoria sombra en las entradas del DB interfaz antes de la
ejecuci√≥n del programa correspondiente al componente PROFINET CBA
‚óè Copia de las salidas del DB interfaz en las salidas de la memoria sombra tras la ejecuci√≥n
del programa correspondiente al componente PROFINET CBA
La actualizaci√≥n del componente PROFINET CBA se ejecuta en CPUs con interfaz
PROFINET integrada, ya sea por orden del sistema operativo o de las instrucciones "PN_IN
(P√°gina 7614)" y "PN_OUT (P√°gina 7615)" (seg√∫n se haya configurado al crear el componente
PROFINET CBA). En la siguiente figura se representa esquem√°ticamente la actualizaci√≥n con
las instrucciones "PN_IN (P√°gina 7614)" y "PN_OUT (P√°gina 7615)".

7612

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
'%LQWHUID]
LQWHUID]GHOSURJUDPDGHXVXDULR
,1

287
31B,1

0HPRULDVRPEUD
LQWHUID]352),1(7
31B287

,1

287

La actualizaci√≥n por parte del sistema siempre tiene lugar en el punto de control del ciclo.
Si por el contrario, las actualizaciones se llevan a cabo por orden de las instrucciones "PN_IN
(P√°gina 7614)" y "PN_OUT (P√°gina 7615)", llame "PN_IN (P√°gina 7614)" al principio del OB en
el que se encuentra el programa correspondiente al componente PROFINET CBA, y "PN_OUT
(P√°gina 7615)" al final de este OB. Este comportamiento se representa en la siguiente imagen
a partir del ejemplo del OB 30.
/ODPDGDGH31B,1

/ODPDGDGH31B287

2%

2%

2%
W

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7613

Instrucciones
4.2 Instrucciones

Nota
(varios DB interfaz PROFINET en un dispositivo):
Con componentes multifunci√≥n existe la posibilidad de actualizar todos los DBs interfaz con
una petici√≥n (DBNO=0) (un proceso similar a la actualizaci√≥n en el punto de control del ciclo,
disparado por instrucci√≥n). Si se produce un error durante la actualizaci√≥n de un DB interfaz,
la actualizaci√≥n de los DBs restantes contin√∫a. Un RET_VAL negativo se refiere a uno de los
DBs interfaz actualizados.

Actualizaci√≥n de las interconexiones DP
Las interconexiones DP son actualizadas por el sistema operativo o por la instrucci√≥n "PN_DP
(P√°gina 7616)", seg√∫n se haya configurado al crear el componente PROFINET CBA.

PN_IN: Actualizar entradas de la interfaz del programa de usuario
Descripci√≥n
La instrucci√≥n "PN_IN" copia los datos de entrada recibidos en PROFINET CBA desde la
memoria sombra del componente PROFINET CBA al DB interfaz correspondiente. Una vez
finalizada la instrucci√≥n, los datos de entrada actuales quedan a disposici√≥n de la aplicaci√≥n.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PN_IN":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DBNO

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

N.¬∫ del DB interfaz (DBNO=0: Actualizaci√≥n de
todos los DBs interfaz PROFINET CBA)

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de
error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8001

La configuraci√≥n de PROFINET CBA no existe o no es v√°lida.

8002

El n.¬∫ de DB no concuerda con la configuraci√≥n del componente.

8004

El n.¬∫ de DB concuerda con la configuraci√≥n del componente, pero el DB no est√° cargado.

7614

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de
error

Explicaci√≥n

(W#16#...)
8005

El DB interfaz se ha compilado con la palabra clave UNLINKED, de modo que s√≥lo se encuentra en la
memoria de carga, pero no en la de trabajo.

8006

El DB interfaz est√° protegido contra escritura en la CPU.

80B1

Error de longitud al leer o escribir. La configuraci√≥n del componente no concuerda con el DB cargado.

8xyy

Informaci√≥n de error general
V√©ase tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

PN_OUT: Actualizar salidas de la interfaz del programa de usuario
Descripci√≥n
La instrucci√≥n "PN_OUT" copia los datos de salida generados en la aplicaci√≥n desde el DB
interfaz del componente PROFINET CBA a la memoria sombra correspondiente. Una vez
finalizada la instrucci√≥n, los datos de salida actuales quedan disponibles para otros
componentes PROFINET CBA.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PN_OUT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DBNO

Input

WORD

I, Q, M, D, L o constante N.¬∫ del DB interfaz (DBNO=0: Actualizaci√≥n de
todos los DBs interfaz PROFINET)

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de
error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8001

La configuraci√≥n de PROFINET CBA no existe o no es v√°lida.

8002

El n.¬∫ de DB no concuerda con la configuraci√≥n del componente.

8004

El n.¬∫ de DB concuerda con la configuraci√≥n del componente, pero el DB no est√° cargado.

8005

El DB interfaz se ha compilado con la palabra clave UNLINKED, de modo que s√≥lo se encuentra en la
memoria de carga, pero no en la de trabajo.

8006

El DB interfaz est√° protegido contra escritura en la CPU.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7615

Instrucciones
4.2 Instrucciones
C√≥digo de
error

Explicaci√≥n

(W#16#...)
80B1

Error de longitud al leer o escribir. La configuraci√≥n del componente no concuerda con el DB cargado.

8xyy

Informaci√≥n de error general
V√©ase tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

PN_DP: Actualizar interconexiones DP
Descripci√≥n
Con la instrucci√≥n "PN_DP" se actualizan:
‚óè las interconexiones entre componentes PROFINET CBA en el PROFIBUS local y
‚óè las interconexiones con transmisi√≥n c√≠clica entre componentes PROFINET CBA en el
PROFIBUS local y componentes PROFINET CBA externos. Estas interconexiones
abarcan varias redes (Industrial Ethernet y PROFIBUS DP).

Funcionamiento
"PN_DP" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n puede prolongarse a lo largo
de varias llamadas. Para iniciar la actualizaci√≥n de las interconexiones DP, llame la instrucci√≥n
"PN_DP" con REQ= 1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PN_DP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ=1: actualizaci√≥n de las interconexio‚Äê
nes DP lanzada

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el valor de respuesta con‚Äê
tendr√° un c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY=1:
La actualizaci√≥n de las interconexiones DP
a√∫n no ha finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

7616

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de
error

Explicaci√≥n

(W#16#...)
0000

La petici√≥n se ha ejecutado sin errores.

7000

Primera llamada con REQ=0. No se lanza la actualizaci√≥n de las interconexiones DP. BUSY tiene el valor "0".

7001

(s√≥lo relevante para S7-400:) Primera llamada con REQ=1. BUSY tiene el valor "1".

7002

(s√≥lo relevante para S7-400:) Llamada intermedia (REQ irrelevante). La actualizaci√≥n de las interconexiones
DP a√∫n no ha finalizado. BUSY tiene el valor "1".

8001

La configuraci√≥n de PROFINET CBA no existe o no es v√°lida.

8095

Ha lanzado otra actualizaci√≥n de las interconexiones DP en una clase de prioridad superior. Sin embargo,
todav√≠a se est√° procesando la actualizaci√≥n en la clase de prioridad menor (por el sistema operativo o un
procesamiento "PN_DP").

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

4.2.5.10

Comunicaci√≥n MPI

X_SEND: Enviar datos a un interlocutor fuera de la propia estaci√≥n S7
Descripci√≥n
La instrucci√≥n "X_SEND" permite enviar datos a un interlocutor fuera de la estaci√≥n S7 propia.
La recepci√≥n de datos en el interlocutor se efect√∫a a trav√©s de la instrucci√≥n "X_RCV
(P√°gina 7618)". La transmisi√≥n inicia tras la llamada con REQ=1.
Aseg√∫rese de que el √°rea de transmisi√≥n definida por el par√°metro SD (en la CPU emisora) sea
menor o igual que el √°rea de recepci√≥n definida por el par√°metro RD (en el interlocutor). Si SD
es del tipo de datos BOOL, RD tambi√©n tiene que ser del tipo de datos BOOL.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "X_SEND":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control "request to activate"
Consulte tambi√©n: AUTOHOTSPOT

CONT

Input

BOOL

I, Q, M, D, L

Par√°metro de control "continue"
Consulte tambi√©n: AUTOHOTSPOT

DEST_ID

Input

WORD

I, Q, M, D, L o constan‚Äê Par√°metro de direccionamiento "destination ID".
te
Contiene la direcci√≥n MPI configurada del inter‚Äê
locutor.

REQ_ID

Input

DWORD

I, Q, M, D, L o constan‚Äê Identificaci√≥n de la petici√≥n para identificar los
te
datos en el interlocutor.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7617

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

SD

Input

ANY

I, Q, M, D

Referencia al √°rea de transmisi√≥n. Se permiten
los siguientes tipos de datos: BOOL, BYTE,
CHAR, WORD, INT, DWORD, DINT, REAL, DA‚Äê
TE, TOD, TIME, S5TIME, DATE_AND_TIME, as√≠
como matrices de los tipos de datos indicados,
excepto BOOL.
El tama√±o m√°ximo del √°rea de transmisi√≥n es de
76 bytes.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° el
c√≥digo de error correspondiente.

BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: la transmisi√≥n todav√≠a no ha
finalizado.
‚óè BUSY=0: la transmisi√≥n ha finalizado, o bien
no hay ning√∫n proceso de transmisi√≥n activo.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Coherencia de datos
Los datos se env√≠an con coherencia.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

X_RCV: Recibir datos de un interlocutor fuera de la propia estaci√≥n S7
Descripci√≥n
Con la instrucci√≥n "X_RCV" se reciben datos enviados por uno o m√°s interlocutores fuera de
la estaci√≥n S7 propia con la instrucci√≥n "X_SEND (P√°gina 7617)".

7618

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Con la instrucci√≥n "X_RCV":
‚óè se puede determinar si existen datos enviados en ese momento. Si es as√≠, el sistema
operativo los habr√° dispuesto en una cola de espera interna.
‚óè se puede copiar el bloque de datos m√°s antiguo de la cola de espera en un √°rea de
recepci√≥n definida por el usuario.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "X_RCV":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

EN_DT

Input

BOOL

I, Q, M, D, L

Par√°metro de control "enable data transfer". Con
el valor 0 se comprueba si existe como m√≠nimo un
bloque de datos. Con el valor "1" el bloque de
datos m√°s antiguo de la cola de espera se copia
en el √°rea de la memoria de trabajo especificada
por el usuario en RD.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° el c√≥‚Äê
digo de error correspondiente. Si no se produce
ning√∫n error, RET_VAL contiene
‚óè con EN_DT=0/1 y NDA=0:W#16#7000. En
este caso no hay ning√∫n bloque de datos en la
cola de espera.
‚óè con EN_DT=0 y NDA=1 la longitud del bloque
de datos m√°s antiguo registrado en la cola de
espera en bytes en forma de n√∫mero positivo.
‚óè con EN_DT=1 y NDA=1 la longitud del bloque
de datos copiado en el √°rea de recepci√≥n RD
en bytes en forma de n√∫mero positivo.

REQ_ID

Output

DWORD

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

I, Q, M, D, L

Identificaci√≥n de petici√≥n de la instrucci√≥n
"X_SEND (P√°gina 7617)" cuyos datos enviados
se encuentran en primer lugar en la cola de es‚Äê
pera, es decir, los datos m√°s antiguos de la cola.
Si no hay ning√∫n bloque de datos en la cola de
espera, REQ_ID tiene el valor "0".

7619

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

NDA

Output

BOOL

I, Q, M, D, L

Par√°metro de estado "new data arrived".
NDA=0:
‚óè En la cola de espera no hay ning√∫n bloque de
datos.
NDA=1:
‚óè En la cola de espera hay como m√≠nimo un
bloque de datos. (Llamada de "X_RCV" con
EN_DT=0).
‚óè El bloque de datos m√°s antiguo de la cola de
espera se ha copiado en el programa de
usuario (llamada de "X_RCV" con EN_DT=1).

RD

Output

ANY

I, Q, M, D

Referencia al √°rea de recepci√≥n (receive data
area). Se permiten los siguientes tipos de datos:
BOOL, BYTE, CHAR, WORD, INT, DWORD,
DINT, REAL, DATE, TOD, TIME, S5_TIME, DA‚Äê
TE_AND_TIME as√≠ como matrices de los tipos de
datos indicados, excepto BOOL.
Para rechazar el bloque de datos m√°s antiguo de
la cola de espera, asigne a RD el valor NIL.
El tama√±o m√°ximo del √°rea de recepci√≥n es de 76
bytes.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Indicar la recepci√≥n de datos con EN_DT=0
En cuanto se han recibido los datos de un interlocutor, el sistema operativo los dispone en la
lista de espera por orden de recepci√≥n.

7620

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para comprobar si existe como m√≠nimo un bloque de datos, llame "X_RCV" con EN_DT=0 y
eval√∫e el par√°metro de salida NDA:
‚óè NDA=0 significa que no hay ning√∫n bloque de datos registrado en la cola de espera.
REQ_ID es irrelevante, RET_VAL contiene W#16#7000.
‚óè NDA=1 significa que en la cola de espera hay como m√≠nimo un bloque de datos listo para
ser recogido.
En este caso, eval√∫e tambi√©n los par√°metros de salida RET_VAL y, si procede, REQ_ID.
RET_VAL contiene la longitud del bloque de datos en bytes, REQ_ID la identificaci√≥n de
petici√≥n del bloque de transmisi√≥n. Si en la cola de espera hay varios bloques de datos,
REQ_ID y RET_VAL corresponden al √∫ltimo bloque de la cola.
‡≤∞;B5&9‡≤∞


(1'75(4,'

5HFXUVRVGHUHFHSFL¬µQ

1'$
5'

5HFLELUGDWRVW
&RODGHHVSHUD
5HFLELUGDWRVW

W
W

W

Aplicar datos en el √°rea de recepci√≥n con EN_DT=1
Si se llama "X_RCV" con EN_DT=1, el bloque de datos m√°s antiguo de la cola de espera se
copia en el √°rea de la memoria de trabajo especificada por RD. RD debe ser mayor o igual que
el √°rea de transmisi√≥n definida por el par√°metro SD de la instrucci√≥n correspondiente
"X_SEND (P√°gina 7617)". Si el par√°metro de entrada correspondiente SD es del tipo de datos
BOOL, RD tambi√©n tiene que ser del tipo de datos BOOL. Para depositar los datos recibidos
en diferentes √°reas, determine REQ_ID (llamada de instrucci√≥n con EN_DT=0) y en la llamada
siguiente (con EN_DT=1) seleccione RD convenientemente. Si se produjo un error durante el
proceso de copia, en RET_VAL se indica la longitud del bloque de datos copiado en bytes, y
se devuelve un acuse positivo al emisor.
&RODGHHVSHUD

7UDQVIHULUGDWRV
‡≤∞;B5&9‡≤∞


(1B'75(4B,'
1'$
5'

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

¬ÉUHDGHUHFHSFL¬µQ

7621

Instrucciones
4.2 Instrucciones

Rechazar datos
Si no desea aplicar los datos, asigne a RD el valor NIL. En este caso, el emisor recibe un acuse
negativo (RET_VAL de la instrucci√≥n correspondiente "X_SEND (P√°gina 7617)" tiene el valor
W#16#80B8), y en RET_VAL de la instrucci√≥n "X_RCV" se registra "0".

Coherencia de datos
Tras la llamada con EN_DT=1 y RETVAL=W#16#00xy hay nuevos datos en el √°rea de
recepci√≥n RD. Otra llamada del bloque puede sobrescribir estos datos. Para impedirlo, no
vuelva a llamar "X_RCV" con la misma √°rea de recepci√≥n RD antes de haber evaluado los
datos recibidos.

Transici√≥n de estado operativo tras STOP
En caso de transici√≥n al estado operativo STOP
‚óè todas las nuevas peticiones entrantes se acusan negativamente.
‚óè rige lo siguiente para las nuevas peticiones: todas las peticiones registradas en la cola de
espera de recepci√≥n se acusan negativamente.
‚Äì Si a continuaci√≥n se produce un rearranque completo (en caliente) o arranque en fr√≠o se
rechazan todos los bloques de datos.
‚Äì Si a continuaci√≥n se produce un rearranque (no con S7-300 ni S7-400H), en el programa
de usuario se aplica el bloque de datos correspondiente a la petici√≥n m√°s antigua,
siempre que se haya consultado antes de la transici√≥n al estado operativo STOP
(llamada de "X_RCV" con EN_DT=0). De lo contrario se rechaza.
Todos los bloques de datos restantes se rechazan.

Interrupci√≥n de la conexi√≥n
Si se cancela una conexi√≥n y en la cola de espera de recepci√≥n ya hay registrada una petici√≥n
que pertenece a dicha conexi√≥n, la petici√≥n se rechaza.
Excepci√≥n: Si dicha petici√≥n es la m√°s antigua de la cola de espera y ya la ha reconocido con
la llamada de "X_RCV" con EN_DT=0, se puede aplicar en el √°rea de recepci√≥n con EN_DT=1.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

X_GET: Leer datos de un interlocutor fuera de la propia estaci√≥n S7
Descripci√≥n
La instrucci√≥n "X_GET" permite leer datos de un interlocutor que se encuentra fuera de la
estaci√≥n S7 propia. En el interlocutor no existe una instrucci√≥n correspondiente.

7622

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La activaci√≥n del proceso de lectura se produce tras la llamada de la instrucci√≥n con REQ=1.
A continuaci√≥n se llama "X_GET" hasta que la recepci√≥n de datos se indique con BUSY=0.
RET_VAL contiene entonces la longitud del bloque de datos recibido en bytes.
Aseg√∫rese de que el √°rea de recepci√≥n definida por el par√°metro RD (en la CPU recibida)
tenga como m√≠nimo la misma longitud que el √°rea de lectura definida por el par√°metro
VAR_ADDR (en el interlocutor). Adem√°s deben coincidir los tipos de datos en RD y
VAR_ADDR.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "X_GET":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control "request to activate"

CONT

Input

BOOL

I, Q, M, D, L

Par√°metro de control "continue"

DEST_ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Par√°metro de direccionamiento "destination
ID". Contiene la direcci√≥n MPI del interlocutor.
Dicha direcci√≥n ha sido configurada previa‚Äê
mente por el usuario.

VAR_ADDR

Input

ANY

I, Q, M, D

Referencia al √°rea de la CPU interlocutora que
debe leerse. Seleccione un tipo de datos so‚Äê
portado por el interlocutor.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
el c√≥digo de error correspondiente.

Consulte tambi√©n: AUTOHOTSPOT
Consulte tambi√©n: AUTOHOTSPOT

Si no se produce ning√∫n error, RET_VAL con‚Äê
tiene la longitud en bytes del bloque de datos
copiado en el √°rea de recepci√≥n RD en forma
de n√∫mero positivo.
BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: recepci√≥n todav√≠a no finalizada.
‚óè BUSY=0: la recepci√≥n ha finalizado, o bien
no hay ning√∫n proceso de recepci√≥n activo.

RD

Output

ANY

I, Q, M, D

Referencia al √°rea de recepci√≥n (receive data
area). Se permiten los siguientes tipos de da‚Äê
tos: BOOL, BYTE, CHAR, WORD, INT,
DWORD, DINT, REAL, DATE, TOD, TIME,
S5_TIME, DATE_AND_TIME as√≠ como matri‚Äê
ces de los tipos de datos indicados, excepto
BOOL.
El √°rea de recepci√≥n RD debe ser como m√≠ni‚Äê
mo tan larga como el √°rea de lectura
VAR_ADDR en el interlocutor. Adem√°s es ne‚Äê
cesario que los tipos de datos coincidan en RD
y VAR_ADDR.
El tama√±o m√°ximo del √°rea de recepci√≥n es de
76 bytes.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7623

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Transici√≥n de estado operativo tras STOP
Si la CPU cambia al estado operativo STOP, la conexi√≥n establecida por "X_GET" se deshace.
El tipo de la llamada realizada a continuaci√≥n determina si los datos ya recibidos, que se
encuentran en una memoria intermedia del sistema operativo, se pierden o no:
‚óè Con un rearranque (no con S7-300 ni S7-400H), estos datos se copian en el √°rea definida
por RD.
‚óè En un rearranque completo (en caliente) o arranque en fr√≠o, los datos se rechazan.

Transici√≥n de estado operativo del interlocutor a STOP
Un cambio de la CPU del interlocutor al estado operativo STOP no tiene efecto alguno sobre
la transmisi√≥n con "X_GET": Los datos tambi√©n se leen en el estado operativo STOP.

Coherencia de datos
Los datos se reciben con coherencia.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

X_PUT: Escribir datos en un interlocutor fuera de la propia estaci√≥n S7
Descripci√≥n
La instrucci√≥n "X_PUT" permite escribir datos en un interlocutor que se encuentra fuera de la
estaci√≥n S7 propia. En el interlocutor no existe una instrucci√≥n correspondiente.
La activaci√≥n del proceso de escritura se produce tras la llamada de la instrucci√≥n con REQ=1.
A continuaci√≥n se llama "X_PUT" hasta que la recepci√≥n de datos se indique con BUSY=0.
Aseg√∫rese de que el √°rea de transmisi√≥n definida por el par√°metro SD (en la CPU emisora)
tenga la misma longitud que el √°rea de recepci√≥n definida por el par√°metro VAR_ADDR (en el
interlocutor). Adem√°s deben coincidir los tipos de datos en SD y VAR_ADDR.

7624

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "X_PUT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control "request to activate"
Consulte tambi√©n: AUTOHOTSPOT

CONT

Input

BOOL

I, Q, M, D, L

Par√°metro de control "continue"
Consulte tambi√©n: AUTOHOTSPOT.

DEST_ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Par√°metro de direccionamiento "destination ID".
Contiene la direcci√≥n MPI del interlocutor. Dicha
direcci√≥n ha sido configurada previamente por el
usuario.

VAR_ADDR

Input

ANY

I, Q, M, D

Referencia al √°rea de la CPU interlocutora en la
que debe escribirse. Seleccione un tipo de datos
soportado por el interlocutor.

SD

Input

ANY

I, Q, M, D

Referencia al √°rea de la CPU propia que contie‚Äê
ne los datos que deben enviarse. Se permiten los
siguientes tipos de datos: BOOL, BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME,S5_TIME, DATE_AND_TIME as√≠ co‚Äê
mo matrices de los tipos de datos indicados, ex‚Äê
cepto BOOL.
SD debe tener la misma longitud que el par√°me‚Äê
tro VAR_ADDR del interlocutor. Adem√°s es ne‚Äê
cesario que los tipos de datos coincidan en SD y
VAR_ADDR.
El tama√±o m√°ximo del √°rea de transmisi√≥n es de
76 bytes.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° el
c√≥digo de error correspondiente.

BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: la transmisi√≥n todav√≠a no ha
finalizado.
‚óè BUSY=0: la transmisi√≥n ha finalizado, o bien
no hay ning√∫n proceso de transmisi√≥n activo.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Transici√≥n de estado operativo tras STOP
Si la CPU cambia al estado operativo STOP, la conexi√≥n establecida por "X_PUT" se deshace.
Ya no es posible enviar los datos. Si los datos enviados ya estaban copiados en el b√∫fer interno
en el momento de la transici√≥n de estado operativo, el contenido del b√∫fer se rechaza.

Transici√≥n de estado operativo del interlocutor a STOP
Un cambio de la CPU del interlocutor al estado operativo STOP no tiene efecto alguno sobre
la transmisi√≥n con "X_PUT": Los datos enviados se escriben de todos modos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7625

Instrucciones
4.2 Instrucciones

Coherencia de datos
Los datos se env√≠an con coherencia.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

X_ABORT: Deshacer conexi√≥n con un interlocutor fuera de la propia estaci√≥n S7
Descripci√≥n
La instrucci√≥n "X_ABORT" deshace la conexi√≥n con una estaci√≥n S7 fuera de la estaci√≥n S7
propia, que se hab√≠a establecido con las instrucciones "X_SEND (P√°gina 7617)", "X_GET
(P√°gina 7622)" o "X_PUT (P√°gina 7624)".
‚óè Si la petici√≥n correspondiente a "X_SEND (P√°gina 7617)", "X_GET (P√°gina 7622)" o
"X_PUT (P√°gina 7624)" ha finalizado (BUSY=0), tras la llamada de la instrucci√≥n
"X_ABORT" los recursos ocupados para ella se liberan de nuevo en ambos lados.
‚óè Si la petici√≥n correspondiente a "X_SEND (P√°gina 7617)", "X_GET (P√°gina 7622)" o
"X_PUT (P√°gina 7624)" no ha finalizado (BUSY=1), una vez interrumpida la conexi√≥n el
propio usuario debe volver a llamar la instrucci√≥n correspondiente con REQ=0 y CONT=0
y esperar a BUSY=0. S√≥lo as√≠ quedar√°n liberados todos los recursos de conexi√≥n
ocupados.
"X_ABORT" s√≥lo puede llamarse en el lado en el que se est√° ejecutando "X_SEND
(P√°gina 7617)", "X_PUT (P√°gina 7624)" o "X_GET (P√°gina 7622)". La interrupci√≥n de la
conexi√≥n se activa tras la llamada de la instrucci√≥n con REQ=1.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "X_ABORT":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control "request to activate"
Consulte tambi√©n: AUTOHOTSPOT

DEST_ID

7626

Input

WORD

I, Q, M, D, L o constan‚Äê Par√°metro de direccionamiento "destination ID".
te
Contiene la direcci√≥n MPI del interlocutor. Dicha
direcci√≥n ha sido configurada previamente por el
usuario.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° el
c√≥digo de error correspondiente.

BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: la interrupci√≥n de la conexi√≥n
todav√≠a no se ha finalizado.
‚óè BUSY=0: la interrupci√≥n de la conexi√≥n ha
finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Transici√≥n de estado operativo tras STOP
Si la CPU cambia al estado operativo STOP, cualquier interrupci√≥n iniciada con "X_ABORT"
finaliza.

Transici√≥n de estado operativo del interlocutor a STOP
Un cambio de la CPU del interlocutor al estado operativo STOP no tiene efecto alguno sobre
la interrupci√≥n de la conexi√≥n con "X_ABORT": La conexi√≥n se deshace.

Par√°metro RET_VAL
Consulte tambi√©n:
‚óè AUTOHOTSPOT
‚óè Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7627

Instrucciones
4.2 Instrucciones

4.2.5.11

TeleService

PG_DIAL: Establecer una conexi√≥n remota con una PG/un PC
Descripci√≥n de PG_DIAL
Descripci√≥n
La instrucci√≥n "PG_DIAL" transmite un n√∫mero de tel√©fono y una ID de evento a un TS Adapter.
El TS Adapter establece una conexi√≥n remota con una programadora o un PC con el n√∫mero
de tel√©fono indicado. La ID de evento se transmite a la programadora o el PC y se transfiere
a una aplicaci√≥n en espera.
Si la ID de evento (par√°metro EVENT_ID (P√°gina 7630)) de la aplicaci√≥n se transfiere
correctamente, el TS Adapter recibe un acuse, que se transmite a la instrucci√≥n "PG_DIAL". A
continuaci√≥n finaliza la ejecuci√≥n de "PG_DIAL" y el estado se transmite a la parte que llama
"PG_DIAL". La aplicaci√≥n de la programadora o el PC es responsable de deshacer la conexi√≥n
remota.
Si se produce un error durante la ejecuci√≥n, que provoca su interrupci√≥n, el c√≥digo de error se
transmite a la parte que llama la instrucci√≥n "PG_DIAL". El TS Adapter deshace cualquier
conexi√≥n remota que pueda haber establecida.

Llamada de "PG_DIAL"
La instrucci√≥n "PG_DIAL" puede llamarse c√≠clicamente o en un programa controlado por
tiempo. En la llamada de "PG_DIAL" es imprescindible indicar un DB de instancia.
Para procesar una funci√≥n de bloque son necesarias varias llamadas de "PG_DIAL". Por ello,
la llamada de "PG_DIAL" en un "bucle de espera" no es conveniente. El final de la funci√≥n de
bloque se indica con BUSY = 0.

Interrupci√≥n de la conexi√≥n
Si la CPU pasa al estado operativo STOP mientras "PG_DIAL" est√° activa, la conexi√≥n con el
TS Adapter se deshace.
La conexi√≥n con el TS Adapter tambi√©n se pierde cuando en el bus MPI se producen
problemas de comunicaci√≥n graves o, por ejemplo, si la CPU se desconecta. En estos casos
el TS Adapter no rechaza el n√∫mero de tel√©fono y la ID de evento que ya le hab√≠an sido
transmitidos. El TS Adapter establece la conexi√≥n remota con la programadora o el PC y
transmite la ID de evento. Sin embargo, el TS Adapter rechaza el acuse transmitido por la
programadora o el PC.
Si un programa de usuario intenta establecer una conexi√≥n remota mientras el TS Adapter se
encuentra en el estado arriba descrito, "PG_DIAL" finaliza con el valor de respuesta
W#16#B10A. El programa de usuario puede repetir la llamada de una conexi√≥n remota m√°s

7628

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
adelante. El valor de retorno W#16#B10A se obtiene tambi√©n cuando varias CPUs intentan
establecer una conexi√≥n remota simult√°neamente a trav√©s del mismo TS Adapter.
ATENCI√ìN
Cambiar programas de usuario
Las partes del programa de usuario con efecto directo sobre llamadas de "PG_DIAL" s√≥lo
pueden modificarse con la CPU en el estado operativo STOP. Esto se refiere en especial al
borrado e intercambio de bloques de programa que contienen llamadas de "PG_DIAL". En
caso de incumplimiento, es posible que los recursos de conexi√≥n permanezcan ocupados. El
sistema de automatizaci√≥n puede pasar a un estado no definido con las instrucciones de
comunicaci√≥n para conexiones S7 no configuradas. Una vez transmitidos los cambios es
necesario ejecutar un rearranque completo (en caliente) o un arranque en fr√≠o de la CPU.

Coherencia de datos
Los par√°metros de entrada del bloque de funci√≥n se copian en un b√∫fer interno en la primera
llamada de "PG_DIAL". No modifique estos datos antes de que la primera llamada haya
finalizado (valor de respuesta W#16#7001) ya que de lo contrario pueden transmitirse datos
incoherentes.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PG_DIAL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MPI_TS_ADAPTER

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n MPI del TS Adapter

PHONE_NO (P√°gi‚Äê
na 7630)

Input

ANY

D

Referencia a un string de datos con una
longitud m√°xima de 31 caracteres

EVENT_ID (P√°gi‚Äê
na 7630)

Input

ANY

I, Q, M, D

Referencia a una matriz de bytes con una
longitud m√°xima de 16 caracteres

BOOL

I, Q, M, D, L

‚óè BUSY=1: el establecimiento de la
conexi√≥n remota todav√≠a no ha
finalizado.

BUSY (P√°gina 7631) Output

‚óè BUSY=0: la ejecuci√≥n de "PG_DIAL"
ha finalizado.
STATUS (P√°gi‚Äê
na 7631)

Output

INT

I, Q, M, D, L

Valor de retorno de "PG_DIAL"

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7629

Instrucciones
4.2 Instrucciones

Par√°metros de bloque virtuales EN y ENO y el bit BR
Los par√°metros de bloque virtuales EN y ENO s√≥lo aparecen en caso de integraci√≥n de
"PG_DIAL" en la representaci√≥n KOP o FUP del editor STEP 7. Est√°n estrechamente
vinculados con el bit BR (resultado binario) de la palabra de estado.
‚óè Par√°metros de entrada EN
El estado del resultado l√≥gico (RLO) se almacena durante la llamada del bloque en el bit BR.
‚óè Par√°metros de salida ENO
Si "PG_DIAL" se ejecuta sin errores, el estado del bit BR disponible en el momento de la
llamada del bloque se restablece al final de la misma.
Cuando se indica un mensaje de error a trav√©s del par√°metro de salida STATUS, el bit BR
se pone a "0" inmediatamente antes de abandonar "PG_DIAL".

Par√°metro PHONE_NO
Descripci√≥n
El par√°metro de entrada PHONE_NO indica el n√∫mero de tel√©fono con el que debe
establecerse una conexi√≥n remota. Indique el n√∫mero de tel√©fono completo, incluidos los
prefijos y el n√∫mero de conexi√≥n. El string se transmite al m√≥dem sin modificaciones. Si utiliza
caracteres no num√©ricos, aseg√∫rese de que el m√≥dem utilizado los soporta.
Para establecer una conexi√≥n remota, el TS Adapter utiliza los siguientes valores
parametrizados:
‚óè Ubicaci√≥n: Sistema de marcaci√≥n, prefijo de l√≠nea externa
‚óè Ajustes de llamada: "Espere se√±al antes de marcar", "N√∫mero de intentos de marcado" y
"Tiempo de espera tras intento de marcado sin √©xito"

Par√°metro EVENT_ID
Descripci√≥n
El par√°metro de entrada EVENT_ID indica el ID de evento. √âste se transmite con transparencia
desde el programa de usuario del sistema de automatizaci√≥n al programa de usuario de la PG/
el PC a trav√©s de "PG_DIAL", el TS Adapter y la aplicaci√≥n TeleService de la PG/el PC. La ID
de evento puede tener una estructura cualquiera y transmitir cualquier informaci√≥n del sistema
de automatizaci√≥n a la PG/el PC.
Si en la llamada de "PG_DIAL" se transmite una longitud inferior a 16, los bytes restantes de
la matriz se rellenan con B#16#00.

7630

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro BUSY
Descripci√≥n
La instrucci√≥n "PG_DIAL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se prolonga
a lo largo de varias llamadas.
‚óè Si el par√°metro de salida BUSY = 1, en el par√°metro de salida STATUS (P√°gina 7631) se
indica el estado interno de "PG_DIAL".
‚óè Cuando la ejecuci√≥n ha finalizado, se indica con el par√°metro de salida BUSY = 0. El
par√°metro de salida STATUS (P√°gina 7631) indica si la petici√≥n ha finalizado sin errores
(STATUS = W#16#0000) o con errores.

Par√°metro STATUS
Descripci√≥n
Los valores de retorno de "PG_DIAL" pueden clasificarse del siguiente modo:
‚óè W#16#0000: "PG_DIAL" ha finalizado correctamente
‚óè W#16#7xxx: estado de "PG_DIAL"
‚óè W#16#8xxx: en la llamada interna de una instrucci√≥n de comunicaci√≥n o de la instrucci√≥n
"BLKMOV" se ha notificado un error
‚óè W#16#9xxx: error de par√°metro en la llamada de "PG_DIAL"
‚óè W#16#Bxxx: el TS Adapter ha notificado un error
La tabla siguiente muestra los valores de retorno de "PG_DIAL" a excepci√≥n del c√≥digo de error
de las instrucciones de comunicaci√≥n utilizadas.
Valor de retorno

Explicaci√≥n

Indicaciones

(W#16#...)
0000

La ejecuci√≥n de "PG_DIAL" ha finalizado sin errores.

7000

"PG_DIAL" se ha borrado (entretanto se ha deshecho la comuni‚Äê Vuelva a llamar "PG_DIAL".
caci√≥n con el TS Adapter).

7001

"PG_DIAL" est√° activa (primera llamada, BUSY = 1). La funci√≥n
se acaba de iniciar.

7002

"PG_DIAL" est√° activa (llamada siguiente, BUSY = 1). La ejecu‚Äê
ci√≥n de la funci√≥n todav√≠a no ha finalizado.

8xxx o bien 8zxx

La ejecuci√≥n de "PG_DIAL" ha finalizado con un c√≥digo de error
de las instrucciones de comunicaci√≥n llamadas internamente.
Si el mensaje de error procede de la instrucci√≥n "BLKMOV" sig‚Äê
nifica

Encontrar√° m√°s informaci√≥n en la
informaci√≥n de error de las instruc‚Äê
ciones de comunicaci√≥n:
AUTOHOTSPOT

‚óè z = 2: error al copiar el par√°metro PHONE_NO en el b√∫fer
interno
‚óè z = 3: error al copiar el par√°metro EVENT_ID en el b√∫fer
interno

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7631

Instrucciones
4.2 Instrucciones
Valor de retorno

Explicaci√≥n

Indicaciones

9001

Longitud de PHONE_NO = 0 √≥ > 31

El n√∫mero de tel√©fono debe conte‚Äê
ner como m√≠nimo 1 car√°cter y como
m√°ximo 31.

9002

Longitud de EVENT_ID = 0 √≥ > 16

La ID de evento debe contener co‚Äê
mo m√≠nimo 1 car√°cter y como m√°xi‚Äê
mo 16 caracteres.

B000

Se ha podido establecer la conexi√≥n remota con la programadora
o el PC. Sin embargo, en TeleService no se ha registrado ning√∫n
programa para la ID de evento transmitido.

B10A

En el TS Adapter ya hay una petici√≥n guardada, que a√∫n est√°
siendo ejecutada por dicho adaptador.

B10B

Tras el establecimiento de la conexi√≥n remota, √©sta ha sido des‚Äê Vuelva a llamar "PG_DIAL".
conectada por el interlocutor antes de que se pudiera transmitir la
ID de evento.

B206

No se ha podido establecer la conexi√≥n remota con la programa‚Äê Compruebe la parametrizaci√≥n del
dora o el PC.
m√≥dem en el TS Adapter (local y
remoto).

B302

El TS Adapter est√° conectado directamente con la programadora
o el PC (conexi√≥n directa).

Finalice la comunicaci√≥n v√≠a cone‚Äê
xi√≥n directa.

B305

Todav√≠a hay una conexi√≥n remota establecida en la programa‚Äê
dora o el PC.

Vuelva a llamar "PG_DIAL" m√°s tar‚Äê
de.

(W#16#...)

Vuelva a llamar "PG_DIAL".

AS_DIAL: Establecer una conexi√≥n remota con el AS
Descripci√≥n de AS_DIAL
Definici√≥n
Sistema de automatizaci√≥n local y remoto
‚óè Local: El sistema de automatizaci√≥n S7 del que parte la iniciativa de establecer la conexi√≥n
remota se denomina local.
‚óè Remoto: El sistema de automatizaci√≥n S7 con el que debe establecerse la conexi√≥n remota
se denomina remoto.

Descripci√≥n
La instrucci√≥n "AS_DIAL" permite establecer una conexi√≥n remota entre un sistema de
automatizaci√≥n S7 local y uno remoto y a continuaci√≥n intercambiar datos de proceso. Los
datos de proceso se pueden intercambiar con las instrucciones "X_GET (P√°gina 7622)",
"X_PUT (P√°gina 7624)" y "X_SEND (P√°gina 7617)".

7632

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La instrucci√≥n "AS_DIAL" cuenta con dos funciones:
‚óè Funci√≥n DIAL: Establecimiento de una conexi√≥n remota con un TS Adapter remoto. Esta
funci√≥n se solicita con el par√°metro de entrada REQ_DIAL (P√°gina 7635).
‚óè Funci√≥n HANGUP: Finalizaci√≥n de una conexi√≥n remota existente con un TS Adapter
remoto. Esta funci√≥n se solicita con el par√°metro de entrada REQ_HANGUP (P√°gina 7635).
S√≥lo puede haber una funci√≥n activa. Solicitando la funci√≥n HANGUP se cancela la funci√≥n
DIAL.
Si se produce un error durante la ejecuci√≥n, que provoca su interrupci√≥n, el c√≥digo de error se
transmite a la parte que llama la instrucci√≥n "AS_DIAL". El TS Adapter deshace cualquier
conexi√≥n remota que pueda haber establecida.

Llamada de "AS_DIAL"
"AS_DIAL" puede llamarse c√≠clicamente o en un programa controlado por tiempo. Si ejecuta
"AS_DIAL" en diferentes niveles de ejecuci√≥n, tiene que garantizar un bloqueo de llamada
entre niveles.
‚óè En la llamada de "AS_DIAL" es imprescindible indicar un DB de instancia. Para una
conexi√≥n remota siempre debe utilizarse la misma instancia.
Excepci√≥n: Si la CPU local se comunica a trav√©s de varios TS Adapter locales, hay que
asignar una instancia propia a cada TS Adapter.
‚óè Para procesar una funci√≥n de bloque son necesarias varias llamadas de "AS_DIAL". Por
ello, la llamada de "AS_DIAL" en un "bucle de espera" no es conveniente. El final de la
funci√≥n de bloque se indica con BUSY = 0.
‚óè Para la comunicaci√≥n con el TS Adapter, "AS_DIAL" tambi√©n utiliza instrucciones de
comunicaci√≥n para conexiones S7 no configuradas.
Por ello, en el programa de usuario local hay que garantizar que al establecer y deshacer
la conexi√≥n remota con "AS_DIAL" no haya ninguna instrucci√≥n de comunicaci√≥n para
conexiones S7 no configuradas ("X_PUT (P√°gina 7624)", "X_GET (P√°gina 7622)",
"X_SEND (P√°gina 7617)", "X_RCV (P√°gina 7618)", "X_ABORT (P√°gina 7626)") que haya
sido iniciada con DEST_ID = "direcci√≥n MPI del TS Adapter local".

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "AS_DIAL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ADDR_TS_
ADAPTER

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Par√°metro de entrada de la funci√≥n DIAL y
HANGUP:
Direcci√≥n MPI del TS Adapter en la red MPI
local

PHONE_NO
(P√°gina 7635)

Input

LOGIN

Input

ANY

D

Par√°metro de entrada de la funci√≥n DIAL:
N√∫mero de tel√©fono del m√≥dem del sistema
de automatizaci√≥n remoto (m√°x. 31 caracte‚Äê
res)

ANY

D

Par√°metro de entrada de la funci√≥n DIAL:
Nombre de usuario para la legitimaci√≥n en el
TS Adapter remoto (m√°x. 8 caracteres)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7633

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PASSWORD

Input

ANY

D

Par√°metro de entrada de la funci√≥n DIAL:
Contrase√±a para la legitimaci√≥n en el
TS Adapter remoto (m√°x. 8 caracteres)

ADDR_CPU

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Par√°metro de entrada de la funci√≥n DIAL:

REQ_DIAL (P√°‚Äê
gina 7635)

Input

BOOL

I, Q, M, D

Direcci√≥n MPI de la CPU en la red MPI re‚Äê
mota con la que debe establecerse la cone‚Äê
xi√≥n
Par√°metro de entrada para la solicitud de la
funci√≥n DIAL:
Establecimiento de una conexi√≥n remota
con un TS Adapter remoto

REQ_HANGUP
(P√°gina 7635)

Input

BOOL

I, Q, M, D

Par√°metro de entrada para la solicitud de la
funci√≥n HANGUP:
Deshacer una conexi√≥n remota existente
con un TS Adapter remoto

STATUS (P√°gi‚Äê
na 7636)

Output

INT

I, Q, M, D, L

Valor de retorno de "AS_DIAL"

BUSY (P√°gi‚Äê
na 7636)

Output

BOOL

I, Q, M, D, L

‚óè BUSY = 1: la funci√≥n DIAL o HANGUP
todav√≠a est√° activa, de modo que el
establecimiento/la finalizaci√≥n de la
conexi√≥n remota todav√≠a no ha
finalizado.
‚óè BUSY = 0: la ejecuci√≥n de la instrucci√≥n
"AS_DIAL" ha finalizado. Ya no hay
ninguna funci√≥n activa.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros de bloque virtuales EN y ENO y el bit BR
Los par√°metros de bloque virtuales EN y ENO s√≥lo aparecen en caso de integraci√≥n de
"AS_DIAL" en la representaci√≥n KOP o FUP.
‚óè Par√°metro de entrada EN: El estado del resultado l√≥gico (RLO) se almacena durante la
llamada del bloque en el bit BR.
‚óè Par√°metro de salida ENO:
Si "AS_DIAL" se ejecuta sin errores, el estado del bit BR disponible en el momento de la
llamada del bloque se restablece al final de la misma.
Cuando se indica un mensaje de error a trav√©s del par√°metro de salida STATUS
(P√°gina 7636), el bit BR se pone a "0" inmediatamente antes de abandonar "AS_DIAL".

7634

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro PHONE_NO
Descripci√≥n
El par√°metro de entrada PHONE_NO indica el n√∫mero de tel√©fono con el que debe
establecerse una conexi√≥n remota. Indique el n√∫mero de tel√©fono completo, incluidos los
prefijos de pa√≠s y poblaci√≥n y el n√∫mero de abonado. El string se transmite al m√≥dem sin
modificaciones. Si utiliza caracteres no num√©ricos, aseg√∫rese de que el m√≥dem utilizado los
soporta.
Para establecer una conexi√≥n remota, el TS Adapter utiliza los siguientes valores
parametrizados:
‚óè Ubicaci√≥n: sistema de marcaci√≥n, prefijo de l√≠nea externa
‚óè Ajustes de llamada: "Espere se√±al antes de marcar", "N√∫mero de intentos de marcado" y
"Tiempo de espera tras intento de marcado sin √©xito"

Par√°metro REQ_DIAL
Descripci√≥n
La funci√≥n DIAL s√≥lo puede solicitarse si en la √∫ltima llamada de "AS_DIAL" se notific√≥ BUSY
(P√°gina 7636) = 0. Con el par√°metro de entrada REQ_DIAL se inicia la funci√≥n DIAL. El
par√°metro de entrada REQ_DIAL se dispara por nivel.
REQ_DIAL lanza la funci√≥n DIAL de la instrucci√≥n "AS_DIAL". La instrucci√≥n "AS_DIAL"
comprueba la plausibilidad de los par√°metros y los transmite al TS Adapter local.
Si se detecta un error durante la ejecuci√≥n de la funci√≥n DIAL, la ejecuci√≥n de la funci√≥n DIAL
se cancela. "AS_DIAL" ejecuta autom√°ticamente la funci√≥n HANGUP (P√°gina 7635) y a
continuaci√≥n notifica el mensaje de error en el valor de retornoSTATUS (P√°gina 7636).
Resultado: Con BUSY (P√°gina 7636) = 0, el resultado del establecimiento de conexi√≥n se
indica en el valor de retorno STATUS (P√°gina 7636).

Par√°metro REQ_HANGUP
Descripci√≥n
Con el par√°metro de entrada REQ_HANGUP se inicia la funci√≥n HANGUP. La funci√≥n
HANGUP termina una conexi√≥n remota con el TS Adapter remoto que se hab√≠a establecido
anteriormente con la funci√≥n DIAL (P√°gina 7635).
El par√°metro de entrada REQ_HANGUP se dispara por nivel. La funci√≥n HANGUP tambi√©n
puede iniciarse aunque ya se haya iniciado la funci√≥n DIAL (P√°gina 7635).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7635

Instrucciones
4.2 Instrucciones
La finalizaci√≥n de la funci√≥n HANGUP se notifica a trav√©s del par√°metro de salida BUSY
(P√°gina 7636) = 0. El par√°metro de salida STATUS (P√°gina 7636) indica entonces el resultado
de la ejecuci√≥n de la funci√≥n.
Valor

Significado

W#16#0000

La conexi√≥n remota ha finalizado de forma regular con la funci√≥n HANGUP.

W#16#3007

El TS Adapter local ha finalizado la conexi√≥n remota porque se ha producido un error.

W#16#3008

La conexi√≥n remota se ha interrumpido de forma espont√°nea o el TS Adapter remoto
ha colgado.

Par√°metro BUSY
Descripci√≥n
La instrucci√≥n "AS_DIAL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se prolonga
a lo largo de varias llamadas.
‚óè Si BUSY = 1, en el par√°metro de salida STATUS (P√°gina 7636) se indica el STATUS
(P√°gina 7636) interno de "AS_DIAL". Se requiere como m√≠nimo una nueva llamada de
"AS_DIAL".
‚óè Si BUSY = 0, la ejecuci√≥n ha finalizado. El par√°metro de salida STATUS (P√°gina 7636)
indica si la petici√≥n ha finalizado sin o con errores.

Par√°metro STATUS
Descripci√≥n
Los valores de retorno de "AS_DIAL" pueden clasificarse del siguiente modo:
‚óè W#16#0000: "AS_DIAL" ha finalizado sin errores
‚óè W#16#3xxx: √∫ltimo estado de la conexi√≥n remota en el TS Adapter
‚óè W#16#7xxx: estado de "AS_DIAL"
‚óè W#16#8xxx: en la llamada interna de una instrucci√≥n de comunicaci√≥n ("X_ABORT
(P√°gina 7626)", "X_GET (P√°gina 7622)", "X_PUT (P√°gina 7624)", "X_RCV (P√°gina 7618)"
y "X_SEND (P√°gina 7617)") se ha notificado un error.
‚óè W#16#9xxx: error de par√°metro en la llamada de "AS_DIAL"
‚óè W#16#Bxxx: Error al establecer la conexi√≥n.

7636

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra los valores de retorno de "AS_DIAL" a excepci√≥n del c√≥digo de error
de las instrucciones de comunicaci√≥n utilizadas:
Valor de retorno

Explicaci√≥n

Indicaciones

No hay ninguna funci√≥n activa.
La ejecuci√≥n de "AS_DIAL" ha finalizado sin errores.

Este mensaje s√≥lo se recibe una vez al fina‚Äê
lizar correctamente la funci√≥n correspondien‚Äê
te.

3007

El TS Adapter local ha colgado.

S√≥lo lo indica la funci√≥n HANGUP.

3008

La conexi√≥n remota se ha interrumpido de forma espon‚Äê S√≥lo lo indica la funci√≥n HANGUP.
t√°nea o el TS Adapter remoto ha colgado.

7000

No hay ninguna funci√≥n activa.

Ni se ha ejecutado una funci√≥n ni se ha soli‚Äê
citado a trav√©s de los par√°metros de entrada.

7001

La funci√≥n DIAL est√° activa (primera llamada, BUSY
=1). La funci√≥n se acaba de iniciar.

Hasta el final de la funci√≥n (BUSY = 0) no se
eval√∫a el par√°metro de entrada REQ_DIAL.

7002

Hasta el final de la funci√≥n (BUSY = 0) no se
La funci√≥n DIAL est√° activa (siguiente llamada, BUSY
=1). La ejecuci√≥n de la funci√≥n todav√≠a no ha finalizado. eval√∫a el par√°metro de entrada REQ_DIAL.

7701

La funci√≥n HANGUP est√° activa (primera llamada). La
funci√≥n se acaba de iniciar.

Hasta el final de la funci√≥n (BUSY = 0) no se
eval√∫an los par√°metros de entrada
REQ_DIAL ni REQ_HANGUP.

7702

La funci√≥n HANGUP est√° activa (llamada siguiente). La
ejecuci√≥n de la funci√≥n todav√≠a no ha finalizado.

Hasta el final de la funci√≥n (BUSY = 0) no se
eval√∫an los par√°metros de entrada
REQ_DIAL ni REQ_HANGUP.

8xxx

Mensaje de error: La ejecuci√≥n de la funci√≥n de bloque
activa se ha cancelado debido a un mensaje de error
(RET_VAL < 0) de una instrucci√≥n llamada internamente
en un bloque.

Encontrar√° m√°s informaci√≥n en la informa‚Äê
ci√≥n de error de las instrucciones de comu‚Äê
nicaci√≥n:

9001

Longitud de PHONE_NO = 0 √≥ > 31

El n√∫mero de tel√©fono debe contener como
m√≠nimo 1 car√°cter y como m√°ximo 31.

9003

Longitud de LOGIN > 8

El nombre de usuario para la legitimaci√≥n en
el TS Adapter remoto no puede tener m√°s de
8 caracteres.

9004

Longitud de PASSWORD > 8

La contrase√±a para la legitimaci√≥n en el
TS Adapter remoto no puede tener m√°s de 8
caracteres.

B100

El TS Adapter no puede establecer ninguna conexi√≥n
remota en este momento.

El TS Adapter no puede establecer ninguna
conexi√≥n con el m√≥dem en este momento.
Vuelva a llamar "AS_DIAL".

B10A

En el TS Adapter ya hay guardada una ID de evento de
una funci√≥n "PG_DIAL" o hay una funci√≥n "AS_DIAL"
activa que a√∫n debe transmitirse.

Vuelva a llamar "AS_DIAL".

B10B

Tras el correcto establecimiento de la conexi√≥n remota,
√©sta ha vuelto a desconectarse.

Vuelva a llamar "AS_DIAL".

B206

No se ha podido establecer la conexi√≥n remota con el
TS Adapter remoto.

Compruebe la parametrizaci√≥n del m√≥dem
en el TS Adapter (local y remoto).

B20A

El tipo de TS Adapter remoto no soporta un acoplamien‚Äê Utilice un tipo de TS Adapter remoto que so‚Äê
to remoto inter-AS.
porte el acoplamiento remoto inter-AS.

B20B

La instrucci√≥n "AS_DIAL" y la versi√≥n del TS Adapter
son incompatibles.

(W#16#...)
0000

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

AUTOHOTSPOT.

Utilice un tipo de TS Adapter remoto que so‚Äê
porte el acoplamiento remoto inter-AS.

7637

Instrucciones
4.2 Instrucciones
Valor de retorno

Explicaci√≥n

Indicaciones

El TS Adapter remoto no se integra en la red MPI.

Compruebe la parametrizaci√≥n de los par√°‚Äê
metros de red en el TS Adapter remoto.

(W#16#...)
B20C

Causa: Error de par√°metros de red
B20D

La versi√≥n del TS Adapter remoto no soporta un acopla‚Äê Utilice un tipo de TS Adapter remoto que so‚Äê
miento remoto inter-AS.
porte el acoplamiento remoto inter-AS.

B20E

Se ha interrumpido la transmisi√≥n de datos con el
TS Adapter remoto.

Vuelva a llamar "AS_DIAL".

Causa: Error de transmisi√≥n
B20F

El TS Adapter remoto no ha devuelto la llamada.

Compruebe la parametrizaci√≥n de la protec‚Äê
ci√≥n de acceso (n√∫mero de llamada) y del
m√≥dem en el TS Adapter remoto.

B210

Fallo en la transmisi√≥n al TS Adapter remoto.

Vuelva a llamar "AS_DIAL".

Causa: Timeout
B252

El TS Adapter remoto rechaza la ejecuci√≥n de la peti‚Äê
ci√≥n, ya que falta la legitimaci√≥n.

No ha indicado ning√∫n nombre de usuario ni
contrase√±a en la llamada de "AS_DIAL".

B253

El TS Adapter remoto rechaza la legitimaci√≥n.

Compruebe los par√°metros de llamada de
"AS_DIAL" en su programa de usuario.

Causa: Nombre de usuario desconocido
B254

El TS Adapter remoto rechaza la legitimaci√≥n.
Causa: Contrase√±a incorrecta

Compruebe los par√°metros de llamada de
"AS_DIAL" en su programa de usuario.

B302

El TS Adapter est√° conectado directamente con la pro‚Äê
gramadora o el PC (conexi√≥n directa).

Finalice la comunicaci√≥n v√≠a conexi√≥n direc‚Äê
ta.

B305

Todav√≠a hay una conexi√≥n remota con una PG/un PC
establecida por el TS Adapter local.

Vuelva a llamar "AS_DIAL" m√°s tarde.

SMS_SEND: Enviar un mensaje SMS
Descripci√≥n de SMS_SEND
Descripci√≥n
La instrucci√≥n "SMS_SEND" transmite un n√∫mero de tel√©fono, un n√∫mero de servicio y un
mensaje SMS a un TS Adapter. El TS Adapter transmite esos datos mediante comandos GSM
a un m√≥dem de radiofrecuencia.
Tras el env√≠o del mensaje SMS, el TS Adapter recibe un acuse, que se transmite a la
instrucci√≥n "SMS_SEND". A continuaci√≥n se termina de ejecutar "SMS_SEND" y a la parte que
llama se le transmite el estado. Este estado no es m√°s que un acuse del env√≠o del SMS, pero
no es una confirmaci√≥n de recepci√≥n.
Si se produce un error durante la ejecuci√≥n, que provoca su interrupci√≥n, el c√≥digo de error se
transmite a la parte que llama la instrucci√≥n "SMS_SEND".

Llamada de "SMS_SEND"
La instrucci√≥n "SMS_SEND" puede llamarse c√≠clicamente o en un programa controlado por
tiempo.

7638

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En la llamada de "SMS_SEND" es imprescindible indicar un DB de instancia.
Para procesar una funci√≥n de bloque son necesarias varias llamadas de "SMS_SEND". Por
ello, la llamada de "SMS_SEND" en un "bucle de espera" no es conveniente. El final de la
funci√≥n de bloque se indica con BUSY = 0.

Interrupci√≥n de la conexi√≥n
Si la CPU pasa al estado operativo STOP mientras "SMS_SEND" est√° activa, la conexi√≥n con
el TS Adapter se deshace. La conexi√≥n con el TS Adapter tambi√©n se pierde cuando en el bus
MPI se producen problemas de comunicaci√≥n graves o, por ejemplo, si la CPU se desconecta.
En esos casos el TS Adapter no rechaza el n√∫mero de tel√©fono, el n√∫mero del centro de
servicios ni el mensaje SMS que ya le hab√≠an sido transmitidos. El TS Adapter transmite los
datos al m√≥dem de radiofrecuencia. Sin embargo, el TS Adapter rechaza el acuse que le env√≠a
el m√≥dem de radiofrecuencia.
Si un programa de usuario instalado en la CPU intenta enviar un SMS mientras el TS Adapter
se encuentra en el estado arriba descrito, "SMS_SEND" finaliza con el valor de
retornoW#16#B10A. El programa de usuario puede repetir el env√≠o de un SMS m√°s adelante.
El valor de retorno W#16#B10A se obtiene tambi√©n cuando varias CPUs intentan enviar un
SMS simult√°neamente a trav√©s del mismo TS Adapter.
ATENCI√ìN
Modificaci√≥n del programa de usuario STEP 7
Las partes del programa de usuario STEP 7 con efecto directo sobre llamadas de
"SMS_SEND" s√≥lo pueden modificarse con la CPU en el estado operativo STOP. Esto se
refiere en especial al borrado e intercambio de bloques de programa que contienen llamadas
de "SMS_SEND". En caso de incumplimiento, es posible que los recursos de conexi√≥n
permanezcan ocupados. El sistema de automatizaci√≥n puede entrar en un sistema no
definido debido a las instrucciones de comunicaci√≥n para conexiones S7 no configuradas
("X_PUT (P√°gina 7624)", "X_GET (P√°gina 7622)", "X_SEND (P√°gina 7617)", "X_RCV
(P√°gina 7618)", "X_ABORT (P√°gina 7626)").
Una vez transmitidos los cambios es necesario ejecutar un rearranque completo (en caliente)
o un arranque en fr√≠o de la CPU.

Coherencia de datos
Los par√°metros de entrada del bloque de funci√≥n se copian en un b√∫fer interno en la primera
llamada de "SMS_SEND". No modifique estos datos antes de que la primera llamada haya
finalizado (valor de respuesta W#16#7001) ya que de lo contrario pueden transmitirse datos
incoherentes.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7639

Instrucciones
4.2 Instrucciones

Transmisi√≥n del PIN al m√≥dem de radiofrecuencia
Si utiliza una tarjeta SIM con comprobaci√≥n de PIN activada, el PIN debe transmitirse al
m√≥dem de radiofrecuencia en la fase de inicializaci√≥n. Esto es posible con el string Init del TS
Adapter, que puede parametrizarse con TeleService. Parametrice el string Init de la siguiente
manera (ejemplo para PIN = 4711):
‚óè AT+CPIN="4711";AT&F.....
Tras recuperarse la tensi√≥n, el TS Adapter env√≠a una vez el string "AT+CPIN="4711" con el PIN
de la tarjeta SIM integrada en el m√≥dem de radiofrecuencia al componente conectado. A
continuaci√≥n, el m√≥dem se inicializa con "AT&F...".
Atenci√≥n: Si el PIN es err√≥neo, no se notifica en la inicializaci√≥n, sino al enviar un SMS, a trav√©s
de la respuesta de "SMS_SEND".

Enviar un fax
Anteponiendo un n√∫mero especial del proveedor de la red (p. ej. "99") al n√∫mero en s√≠, el
proveedor convierte el SMS en un fax y lo env√≠a a un aparato de fax. Se trata de un servicio del
proveedor de la red, y no de una funci√≥n del TS Adapter.
El n√∫mero de fax se indica con el prefijo del proveedor de la red en el par√°metro PHONE_NO.
Ejemplo de una red con el n√∫mero de fax 07214711:
‚óè PHONE_NO = '9907214711'

Env√≠o de un correo electr√≥nico
Marcando un n√∫mero especial del proveedor de la red (p. ej. "8000") y anteponiendo una
direcci√≥n de correo electr√≥nico al mensaje SMS es posible enviar el SMS a una direcci√≥n de
correo electr√≥nico. Se trata de un servicio del proveedor de la red, y no de una funci√≥n del TS
Adapter.
El n√∫mero correspondiente se transmite en el par√°metro PHONE_NO (P√°gina 7641).
La direcci√≥n de correo electr√≥nico se antepone al texto en s√≠ del mensaje SMS, y se separa de
√©l con un car√°cter de separaci√≥n. La longitud m√°xima del texto √∫til del SMS se reduce en la
direcci√≥n de correo electr√≥nico + el car√°cter de separaci√≥n. Los separadores son, p. ej. un
espacio (" ") o dos puntos (":").
En lugar del car√°cter "@", algunos proveedores de red requieren un "*".
Ejemplo:
‚óè Se pretende enviar el texto 'CPU in STOP' a la direcci√≥n de correo electr√≥nico
"Surname*provider.com".
‚óè PHONE_NO = 8000
‚óè MESSAGE = Surname*provider.comCPU in STOP

7640

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SMS_SEND":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MPI_TS_
ADAPTER

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n MPI del TS Adapter

PHONE_NO
(P√°gina 7641)

Input

ANY

D

Referencia a un string de datos con una longi‚Äê
tud m√°xima de 31 caracteres

SCENTER_NO
(P√°gina 7642)

Input

ANY

D

Referencia a un string de datos con una longi‚Äê
tud m√°xima de 20 caracteres

MESSAGE (P√°‚Äê
gina 7642)

Input

ANY

D

Referencia a un string de datos con una longi‚Äê
tud m√°xima de 160 caracteres

BUSY (P√°gi‚Äê
na 7642)

Output

BOOL

I, Q, M, D, L

‚óè BUSY=1: el env√≠o del SMS todav√≠a no ha
finalizado.
‚óè BUSY=0: la ejecuci√≥n de "SMS_SEND" ha
finalizado

STATUS (P√°gi‚Äê
na 7642)

Output

INT

I, Q, M, D, L

Valor de retorno de "SMS_SEND"

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros virtuales EN y ENO y el bit BR
Los par√°metros de bloque virtuales EN y ENO s√≥lo aparecen en caso de integraci√≥n de
"SMS_SEND" en la representaci√≥n KOP o FUP.
‚óè Par√°metro de entrada EN:
El estado del resultado l√≥gico (RLO) se almacena durante la llamada del bloque en el bit BR.
‚óè Par√°metro de salida ENO:
Si no ha habido errores en la ejecuci√≥n de "SMS_SEND", el estado del bit BR que hab√≠a en
el momento de la llamada del bloque se restablece al final de dicha llamada.
Si se emite un mensaje de error a trav√©s del par√°metro de salida STATUS, el bit BR se pone
a "0" inmediatamente antes abandonar "SMS_SEND".

Par√°metro PHONE_NO
Descripci√≥n
El par√°metro de entrada PHONE_NO indica el n√∫mero de tel√©fono al que debe enviarse un
SMS. Indique el n√∫mero de tel√©fono completo, incluidos los prefijos de pa√≠s y poblaci√≥n y el
n√∫mero de abonado. El string se transmite al m√≥dem de radiofrecuencia sin modificaciones. Si
utiliza caracteres no num√©ricos, aseg√∫rese de que el m√≥dem de radiofrecuencia utilizado los
soporta.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7641

Instrucciones
4.2 Instrucciones

Par√°metro SCENTER_NO
Descripci√≥n
El par√°metro de entrada SCENTER_NO indica el n√∫mero del service center a trav√©s del cual
debe enviarse el SMS. El string se transmite al m√≥dem de radiofrecuencia sin modificaciones.

Par√°metro MESSAGE
Descripci√≥n
El par√°metro de entrada MESSAGE indica el mensaje SMS. √âste se transmite a trav√©s de la
instrucci√≥n "SMS_SEND", el TS Adapter y el m√≥dem de radiofrecuencia GSM al proveedor de
red.

Par√°metro BUSY
Descripci√≥n
La instrucci√≥n "SMS_SEND" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n de la
petici√≥n se prolonga a lo largo de varias llamadas.
‚óè Si el par√°metro de salida BUSY = 1, en el par√°metro de salida STATUS (P√°gina 7642) se
indica el estado interno de "SMS_SEND".
‚óè Cuando la ejecuci√≥n ha finalizado, se indica con el par√°metro de salida BUSY = 0. El
par√°metro de salida STATUS (P√°gina 7642) indica si la petici√≥n ha finalizado sin errores
(STATUS = W#16#0000) o con errores.

Par√°metro STATUS
Descripci√≥n
Los valores de retorno de "SMS_SEND" pueden clasificarse del siguiente modo:
‚óè W#16#0000: "SMS_SEND" ha finalizado correctamente.
‚óè W#16#7xxx: estado de "SMS_SEND"
‚óè W#16#8xxx: con la llamada interna a una instrucci√≥n de comunicaci√≥n o a la instrucci√≥n
"BLKMOV" se ha notificado un error.
‚óè W#16#9xxx: error de par√°metro al llamar a "SMS_SEND"
‚óè W#16#Bxxx: TS Adapter ha notificado un error.
‚óè W#16#Cxxx: el m√≥dem de radiofrecuencia ha notificado un error.

7642

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra los valores de retorno de "SMS_SEND" con la excepci√≥n del c√≥digo
de error de las instrucciones de comunicaci√≥n utilizadas, as√≠ como el del m√≥dem de
radiofrecuencia.
Valor de retorno

Explicaci√≥n

Indicaciones

(W#16#...)
0000

La ejecuci√≥n de "SMS_SEND" ha finalizado sin erro‚Äê
res.

7000

"SMS_SEND" se ha restablecido (entre tanto se ha
cancelado la comunicaci√≥n con el TS Adapter).

7001

"SMS_SEND" est√° activado (primera llamada,
BUSY = 1). La funci√≥n se acaba de iniciar.

7002

"SMS_SEND" est√° activado (llamada sucesiva,
BUSY = 1). La ejecuci√≥n de la funci√≥n todav√≠a no ha
finalizado.

8xxx o bien

La ejecuci√≥n de "SMS_SEND" ha finalizado con un
c√≥digo de error de las instrucciones de comunica‚Äê
ci√≥n llamadas internamente o de la instrucci√≥n
"BLKMOV".

8zxx

Vuelva a llamar "SMS_SEND".

Encontrar√° informaci√≥n detallada en la descrip‚Äê
ci√≥n de la instrucci√≥n "BLKMOV", as√≠ como en la
informaci√≥n de errores de las instrucciones de
comunicaci√≥n:

Si el mensaje de error procede de "BLKMOV" signi‚Äê AUTOHOTSPOT
fica
‚óè z = 2 : error al copiar el par√°metro PHONE_NO
en el b√∫fer interno
‚óè z = 3 : error al copiar el par√°metro
SCENTER_NO en el b√∫fer interno
‚óè z = 4 : error al copiar el par√°metro MESSAGE en
el b√∫fer interno
9001

Longitud de PHONE_NO = 0 √≥ > 31

El n√∫mero de tel√©fono debe contener como m√≠‚Äê
nimo 1 car√°cter y como m√°ximo 31.

9002

Longitud de SCENTER_NO = 0 √≥ > 20

El n√∫mero del service center debe contener co‚Äê
mo m√≠nimo 1 car√°cter y como m√°ximo 20.

9003

Longitud de MESSAGE = 0 √≥ > 160

El mensaje SMS debe contener como m√≠nimo 1
car√°cter y como m√°ximo 160 caracteres.

B10A

En el TS Adapter ya hay una petici√≥n guardada, que
a√∫n est√° siendo ejecutada por dicho adaptador.

Vuelva a llamar "SMS_SEND".

B301

Todav√≠a hay una conexi√≥n remota establecida en la
programadora o el PC.

Vuelva a llamar "SMS_SEND" m√°s tarde.

B302

El TS Adapter est√° conectado directamente con una
PG/un PC (conexi√≥n directa)

Conecte el TS Adapter con un m√≥dem de radio‚Äê
frecuencia GSM.

B303

El TS Adapter no est√° conectado ni con un m√≥dem
de radiofrecuencia ni con una PG/un PG.

Conecte el TS Adapter con un m√≥dem de radio‚Äê
frecuencia GSM.

B304

La interfaz para el m√≥dem de radiofrecuencia no es‚Äê Vuelva a llamar "SMS_SEND" m√°s tarde.
t√° lista en este momento para enviar un SMS.

B614

El m√≥dem conectado no ha respondido al comando
espec√≠fico de SMS dentro del tiempo de vigilancia.

Compruebe si hay un m√≥dem de radiofrecuencia
GSM conectado.
Vuelva a llamar "SMS_SEND" m√°s tarde.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7643

Instrucciones
4.2 Instrucciones
Valor de retorno

Explicaci√≥n

Indicaciones

B615

El TS Adapter ha recibido un mensaje de error no
espec√≠fico del m√≥dem conectado.

Compruebe si hay un m√≥dem de radiofrecuencia
GSM conectado.

Cxxx

La ejecuci√≥n de "SMS_SEND" se ha interrumpido
con un c√≥digo de error del m√≥dem GSM.

Encontrar√° una lista de los n√∫meros de error en
el manual de su m√≥dem de radiofrecuencia o en
los est√°ndares GSM GSM 04.11, GSM 03.40 y
GSM 07.05.

(W#16#...)

xxx: N√∫mero de error

Ejemplos:
‚óè C136 = falta la tarjeta SIM del m√≥dem GSM
‚óè C137 = el PIN del m√≥dem GSM no es
correcto (consulte Transferencia del PIN al
m√≥dem de radiofrecuencia)
‚óè C001 = n√∫mero incorrecto de Service Center

AS_MAIL: Transmitir un mensaje de correo electr√≥nico
Descripci√≥n de AS_MAIL
Instrucciones necesarias
La instrucci√≥n "AS_MAIL" transmite un mensaje de correo electr√≥nico desde una CPU a un
servidor de correo a trav√©s del Simple Mail Transfer Protocol (SMTP). "AS_MAIL" requiere las
siguientes instrucciones para su ejecuci√≥n:
‚óè "S_COMP: Comparar cadenas de caracteres (P√°gina 5868)"
‚óè "FIND: Buscar caracteres en una cadena (P√°gina 5881)"
‚óè "INSERT: Insertar caracteres en una cadena (P√°gina 5879)"
‚óè "LEFT: Leer los caracteres izquierdos de una cadena (P√°gina 5876)"
‚óè "LEN: Determinar la longitud de una cadena de caracteres (P√°gina 5875)"
‚óè "RIGHT: Leer los caracteres derechos de una cadena (P√°gina 5877)"

Descripci√≥n
La instrucci√≥n "AS_MAIL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se prolonga
a lo largo de varias llamadas. En la llamada de la instrucci√≥n "AS_MAIL" es imprescindible
indicar un DB de instancia.
El bloque se inicializa con una llamada con COM_RST = 1.
El env√≠o de un mensaje de correo electr√≥nico se inicia con un cambio de flanco de "0" a "1" en
el par√°metro REQ.
A trav√©s de los par√°metros de salida "BUSY", "DONE", "ERROR", as√≠ como "STATUS" y
"SFC_STATUS" se indica el estado de la petici√≥n. "SFC_STATUS" corresponde al par√°metro
de salida "STATUS" de los bloques de comunicaci√≥n llamados, o bien a la instrucci√≥n
"BLKMOV".

7644

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Los par√°metros de salida DONE, ERROR, STATUS y SFC_STATUS s√≥lo se indican durante
un ciclo si el estado del par√°metro de salida BUSY cambia de "1" a "0".
En la tabla siguiente se muestra la correspondencia entre BUSY, DONE y ERROR. Permite
determinar en qu√© estado se encuentra la instrucci√≥n "AS_MAIL" actualmente o cu√°ndo se
complet√≥ el env√≠o del mensaje de correo electr√≥nico.
BUSY

DONE

ERROR

Descripci√≥n

1

Irrelevante

Irrelevante

La petici√≥n est√° en proceso.

0

1

0

La petici√≥n ha finalizado correctamente.

0

0

1

La petici√≥n se ha finalizado con un error. La causa del error se puede con‚Äê
sultar en los par√°metros STATUS y SFC_STATUS.

0

0

0

No se ha asignado ninguna (nueva) petici√≥n a la instrucci√≥n "AS_MAIL".

Si la CPU pasa al estado operativo STOP mientras "AS_MAIL" est√° activa, la conexi√≥n con el
servidor de correo se deshace. La conexi√≥n con el servidor de correo tambi√©n se pierde si
aparecen problemas de comunicaci√≥n en el bus Industrial Ethernet. En esos casos, el env√≠o
del mensaje de correo electr√≥nico se cancela y √©ste no llega al receptor.
ATENCI√ìN
Cambiar programas de usuario
Las partes del programa de usuario con efecto directo sobre llamadas de "AS_MAIL" s√≥lo
pueden modificarse en los siguientes casos:
‚óè Si la CPU est√° en estado operativo "STOP"
‚óè Si no se env√≠a ning√∫n mensaje (REQ = 0 y BUSY = 0).
Esto se refiere en especial al borrado e intercambio de bloques de programa que contienen
llamadas de "AS_MAIL" o llamadas del DB de instancia de "AS_MAIL"
En caso de incumplimiento, es posible que los recursos de conexi√≥n permanezcan ocupados.
El sistema de automatizaci√≥n puede pasar a un estado no definido con las funciones de
comunicaci√≥n TCP/IP a trav√©s de Industrial Ethernet.
Una vez transmitidas las modificaciones es necesario ejecutar un rearranque completo (en
caliente) o un arranque en fr√≠o de la CPU o activar el par√°metro COM_RST de la instrucci√≥n
"AS_MAIL".

Coherencia de datos
El par√°metro de entrada ADDR_MAIL_SERVER de la instrucci√≥n se aplica de nuevo cada vez
que se lanza el env√≠o de un mensaje de correo electr√≥nico de la instrucci√≥n "AS_MAIL". Si se
produce un cambio durante el funcionamiento, el valor "nuevo" no tendr√° efecto hasta que no
se vuelva a lanzar un mensaje de correo electr√≥nico.
Por el contrario, los par√°metros WATCH_DOG_TIME, TO_S, CC, FROM, SUB, TEXT,
ATTACHMENT, y, dado el caso, USERNAME y PASSWORD se aplican durante el
funcionamiento de la instrucci√≥n "AS_MAIL", por lo que no pueden modificarse hasta que la
petici√≥n no haya finalizado (BUSY = 0)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7645

Instrucciones
4.2 Instrucciones

Parametrizaci√≥n del TS Adapter IE
En el TS Adapter IE hay que introducir los par√°metros de las llamadas salientes de forma que
el TS Adapter IE establezca una conexi√≥n con el servidor de marcado del proveedor de
servicios de Internet.
Si para establecer la conexi√≥n se ajusta "Bajo demanda", la conexi√≥n se establecer√° cuando
deba enviarse un mensaje de correo electr√≥nico.
Con una conexi√≥n anal√≥gica v√≠a m√≥dem, el establecimiento de la llamada puede requerir cierto
tiempo (aprox. un minuto). El tiempo necesario para el establecimiento de la conexi√≥n debe
tenerse en cuenta al especificar el par√°metro WATCH_DOG_TIME.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "AS_MAIL":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

COM_RST

Input /
Output

BOOL

Par√°metro de entrada/salida "COMPLETE"

I, Q, M, D, L

RESTART: el bloque tiene una rutina de iniciali‚Äê
zaci√≥n, que se ejecuta cuando la entrada
COM_RST est√° activada.
El par√°metro COM_RST de la instrucci√≥n
"AS_MAIL" debe ponerse a "1":
‚óè Una vez antes de la primera llamada
‚óè Cada vez que se cargue el DB de instancia
correspondiente
Tras la inicializaci√≥n, la instrucci√≥n "AS_MAIL"
desactiva el par√°metro COM_RST.

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control REQUEST: Activa el env√≠o
de un mensaje de correo electr√≥nico con un flan‚Äê
co ascendente.

ADDR_MAIL_
SERVER

Input

DWORD

I, Q, M, D, L

Par√°metro de entrada Direcci√≥n IP del servidor
de correo: Debe indicarse en forma de palabra
de datos en formato HEX, p. ej.: Direcci√≥n IP =
192.168.0.200.
ADDR_MAIL_SERVER = DW#16#C0A800C8,
teniendo en cuenta lo siguiente:
‚óè 192 = 16#C0,
‚óè 168 =16#A8
‚óè 0 = 16#00 y
‚óè 200 = 16#C8.

7646

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

WATCH_DOG_
TIME

Input

TIME

Par√°metro de entrada Intervalo m√°x.:

USERNAME

Input

I, Q, M, D, L

En el tiempo predeterminado (WATCH_DOG_TI‚Äê
ME), la instrucci√≥n "AS_MAIL" deber√≠a estable‚Äê
cer una conexi√≥n. Si se supera este tiempo, el
bloque se finaliza con un error. El tiempo hasta
que el bloque finaliza y el error se notifica puede
superar el WATCH_DOG_TIME, ya que el esta‚Äê
blecimiento de la conexi√≥n tambi√©n requiere
tiempo. Para comenzar debe ajustarse un tiem‚Äê
po de 2 minutos. En la conexi√≥n telef√≥nica v√≠a
ISDN, puede seleccionarse un tiempo notable‚Äê
mente inferior.
ANY

D

Par√°metro de entrada Nombre de usuario:
Referencia a una variable del tipo STRING con
una longitud m√°xima de 180 caracteres. Para los
procesos de autenticaci√≥n es imprescindible un
nombre de usuario.

PASSWORD

Input

ANY

D

Par√°metro de entrada Contrase√±a:
Referencia a una variable del tipo STRING con
una longitud m√°xima de 180 caracteres. Para los
procesos de autenticaci√≥n es imprescindible una
contrase√±a.

TO_S

Input

ANY

D

Par√°metro de entrada Direcciones de destinata‚Äê
rio:
Referencia a una variable del tipo STRING con
una longitud m√°xima de 240 caracteres (v√©ase el
ejemplo de llamada).

CC

Input

ANY

D

Par√°metro de entrada Direcciones de destinata‚Äê
rio CC:
Referencia a una variable del tipo STRING con
una longitud m√°xima de 240 caracteres (v√©ase el
ejemplo de llamada).

FROM

Input

ANY

D

Par√°metro de entrada Direcci√≥n de remitente:
Referencia a una variable del tipo STRING con
una longitud m√°xima de 240 caracteres (v√©ase el
ejemplo de llamada).

SUB

Input

ANY

D

Par√°metro de entrada Asunto del mensaje:
Referencia a una variable del tipo STRING con
una longitud m√°xima de 240 caracteres.

TEXT

Input

ANY

D

Par√°metro de entrada Texto del mensaje:
Referencia a un string de datos con una longitud
m√°xima de 240 caracteres.

ATTACHMENT

Input

ANY

I, Q, M, D, L

Par√°metro de entrada Anexo del mensaje:
Referencia a un campo de byte/palabra/palabra
doble con una longitud m√°xima de 65534 bytes.

BUSY

Output

BOOL

I, Q, M, D, L

‚óè BUSY = 1: el env√≠o del mensaje de correo
electr√≥nico todav√≠a no ha finalizado.
‚óè BUSY=0: la ejecuci√≥n de "AS_MAIL" ha
finalizado.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7647

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

DONE

Output

BOOL

‚óè DONE = 0: la petici√≥n a√∫n no se ha iniciado o
todav√≠a se est√° ejecutando.

I, Q, M, D, L

‚óè DONE = 1: Petici√≥n finalizada sin errores.
ERROR

Output

BOOL

I, Q, M, D, L

ERROR = 1: durante la ejecuci√≥n se ha produci‚Äê
do un error. STATUS y SFC_STATUS devuelve
informaci√≥n detallada sobre el tipo de error.

STATUS (P√°gi‚Äê
na 7649)

Output

INT

I, Q, M, D, L

Par√°metro de salida/estado STATUS:

SFC_STATUS
(P√°gina 7649)

Output

Valor de retorno o informaci√≥n de error de la ins‚Äê
trucci√≥n "AS_MAIL".
INT

I, Q, M, D, L

Par√°metro de salida/estado "SFC_STATUS":
Informaci√≥n de error de los bloques de comuni‚Äê
caci√≥n llamados o de la instrucci√≥n "BLKMOV".

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Indicaciones sobre los par√°metros de la instrucci√≥n
‚óè Si en el bloque en el que se llama "AS_MAIL" se elimina, se inserta de nuevo o se modifica
la asignaci√≥n de los par√°metros USERNAME y PASSWORD, el cambio no tendr√° efecto
hasta que el DB de instancia correspondiente no se vuelva a cargar y se active el par√°metro
COM_RST. En cualquier otro caso el puntero hacia el par√°metro correspondiente se
mantiene en el DB de instancia.
‚óè Por motivos relacionados con el tiempo de ejecuci√≥n y el espacio en memoria, la instrucci√≥n
"AS_MAIL" no realiza una prueba de sintaxis de los par√°metros TO_S, CC y FROM.
Observe la sintaxis correcta de los par√°metros.
‚óè Los par√°metros opcionales CC, TEXT y ATTACHMENT s√≥lo se env√≠an con el mensaje de
correo electr√≥nico si se asignan dentro del bloque en el que se llama la instrucci√≥n
"AS_MAIL". Si una asignaci√≥n de este tipo se elimina de la interfaz de llamada de la
instrucci√≥n "AS_MAIL", el cambio no tendr√° efecto hasta que el DB de instancia
correspondiente no se vuelva a cargar y el par√°metro COM_RST se active. En cualquier
otro caso, el puntero hacia el par√°metro correspondiente se mantiene en el DB de instancia.
Recuerde que en una asignaci√≥n de par√°metros no est√°n permitidos los strings vac√≠os.
‚óè Si el par√°metro ATTACHMENT apunta a una matriz de un bloque de datos y se cambia el
tama√±o de dicha matriz y se guarda, la interfaz de llamada de la instrucci√≥n "AS_MAIL" de
los punteros ANY del par√°metro ATTACHMENT debe volver a registrarse.

Autenticaci√≥n SMTP
Bajo el t√©rmino "autenticaci√≥n" se entiende un proceso con el que se garantiza una identidad,
como puede ser una consulta de contrase√±a.
La instrucci√≥n "AS_MAIL" soporta el m√©todo de autenticaci√≥n SMTP AUTH-LOGIN, requerido
por la mayor√≠a de servidores de correo. Para m√°s informaci√≥n sobre el m√©todo de
autenticaci√≥n de su servidor de correo, consulte el manual del servidor o la p√°gina web del
proveedor de servicios de Internet.

7648

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para utilizar el m√©todo de autenticaci√≥n AUTH-LOGIN, la instrucci√≥n "AS_MAIL" requiere el
nombre de usuario con el que poder iniciar sesi√≥n en el servidor de correo. Este nombre de
usuario equivale al nombre de usuario con el que se ha configurado la cuenta de correo en el
servidor de correo. Se da a conocer a trav√©s del par√°metro USERNAME de la instrucci√≥n
"AS_MAIL".
Asimismo, para iniciar sesi√≥n la instrucci√≥n "AS_MAIL" requiere la contrase√±a
correspondiente. Esta contrase√±a equivale a la contrase√±a indicada al configurar la cuenta de
correo. Se da a conocer a trav√©s del par√°metro PASSWORD de la instrucci√≥n "AS_MAIL".
El nombre de usuario y la contrase√±a se transfieren sin cifrar (codificaci√≥n BASE64) al servidor
de correo.
Si en el DB no se indica ning√∫n nombre de usuario, no se utiliza el m√©todo de autenticaci√≥n
AUTH-LOGIN. El mensaje de correo electr√≥nico se env√≠a entonces sin autenticaci√≥n.

Par√°metros STATUS y SFC_STATUS
Descripci√≥n
Los valores de retorno de la instrucci√≥n "AS_MAIL" pueden clasificarse del siguiente modo:
‚óè W#16#0000: "AS_MAIL" ha finalizado correctamente
‚óè W#16#7xxx: estado de "AS_MAIL"
‚óè W#16#8xxx: se ha notificado un error en la llamada interna de un bloque de comunicaci√≥n,
en la llamada de la instrucci√≥n "BLKMOV" o por parte del servidor de correo.
La tabla siguiente muestra los valores de retorno de "AS_MAIL" con la excepci√≥n del c√≥digo de
error de los bloques de comunicaci√≥n llamados internamente, as√≠ como de la instrucci√≥n
"BLKMOV".
Valor de retorno

Valor de retorno

STATUS

SFC_STATUS

(W#16#...):

(W#16#...):

0000

-

7001

Explicaci√≥n

Indicaciones

La ejecuci√≥n de "AS_MAIL" ha finalizado sin
errores.

La finalizaci√≥n sin errores de
"AS_MAIL" no significa que el mensaje
de correo electr√≥nico enviado sea reci‚Äê
bido (v√©ase m√°s abajo - Punto 1 de la
nota)

"AS_MAIL" est√° activo (BUSY = 1).

7002

7002

"AS_MAIL" est√° activo (BUSY = 1).

8xxx

xxxx

La ejecuci√≥n de "AS_MAIL" ha finalizado con
un c√≥digo de error de las instrucciones de
comunicaci√≥n llamadas internamente o de la
instrucci√≥n "BLKMOV".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Encontrar√° informaci√≥n detallada so‚Äê
bre la evaluaci√≥n del par√°metro
SFC_STATUS en las descripciones del
par√°metro STATUS de las instruccio‚Äê
nes "BLKMOV".

7649

Instrucciones
4.2 Instrucciones
Valor de retorno

Valor de retorno

STATUS

SFC_STATUS

(W#16#...):

(W#16#...):

800z

xxxx

Explicaci√≥n

Indicaciones

El mensaje de error procede de la instrucci√≥n
"BLKMOV" y significa:
‚óè z = 1: error al copiar el par√°metro TO_S
en el b√∫fer interno
‚óè z = 2: error al copiar el par√°metro CC en el
b√∫fer interno
‚óè z = 3: error al copiar el par√°metro FROM
en el b√∫fer interno
‚óè z = 4: error al copiar el par√°metro SUB en
el b√∫fer interno
‚óè z = 5: error al copiar el par√°metro TEXT
en el b√∫fer interno
‚óè z = 6: error al copiar el par√°metro
ATTACHMENT en el b√∫fer interno
‚óè z = 7: error al copiar el par√°metro
USERNAME en el b√∫fer interno
‚óè z = 8: error al copiar el par√°metro
PASSWORD en el b√∫fer interno

8010

xxxx

Error al establecer la conexi√≥n.

Posiblemente COM_RST no se activ√≥
despu√©s de cargar el DB de instancia.

8011

xxxx

Error al enviar los datos.

Encontrar√° m√°s informaci√≥n sobre la
evaluaci√≥n de SFC_STATUS en las
descripciones del par√°metro STATUS
de la instrucci√≥n "TSEND (P√°gi‚Äê
na 6915)".

8012

xxxx

Error al recibir los datos.

Encontrar√° m√°s informaci√≥n sobre la
evaluaci√≥n de SFC_STATUS en las
descripciones del par√°metro STATUS
de la instrucci√≥n "TRCV (P√°gi‚Äê
na 6918)".

8013

xxxx

Error al establecer la conexi√≥n.

Encontrar√° m√°s informaci√≥n sobre la
evaluaci√≥n de SFC_STATUS en las
descripciones del par√°metro STATUS
de la instrucci√≥n "TCON (P√°gi‚Äê
na 6910)" y "TDISCON (P√°gina 6913)".

8014

-

No es posible establecer una conexi√≥n.

Posiblemente ha introducido una direc‚Äê
ci√≥n IP del servidor de correo incorrec‚Äê
ta (ADDR_MAIL_SERVER) o un inter‚Äê
valo demasiado reducido
(WATCH_DOG_TIME) para establecer
la conexi√≥n. Tambi√©n existe la posibili‚Äê
dad de que la CPU no tenga conexi√≥n
con la red o que la configuraci√≥n de la
CPU sea incorrecta.

7650

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Valor de retorno

Valor de retorno

STATUS

SFC_STATUS

(W#16#...):

(W#16#...):

82xx, 84xx, o
bien 85xx

-

Explicaci√≥n

Indicaciones

El mensaje de error procede del servidor de
correo y, exceptuando el "8", corresponde al
n√∫mero de error del protocolo SMTP.

V√©ase el punto 2 de la nota.

En las siguientes columnas se indican algu‚Äê
nos c√≥digos de error posibles:
8450

-

Acci√≥n no ejecutada: Buz√≥n de correo no dis‚Äê Vuelva a intentarlo m√°s tarde.
ponible/no accesible.

8451

-

Acci√≥n cancelada: Error local en el procesa‚Äê
miento

Vuelva a intentarlo m√°s tarde.

8500

-

Error de sintaxis: Error no detectado. Ello in‚Äê
cluye tambi√©n el error debido a una cadena
de comandos demasiado larga. Otra posible
causa es que el servidor de correo electr√≥ni‚Äê
co no soporte el m√©todo de autenticaci√≥n LO‚Äê
GIN.

Compruebe los par√°metros de
"AS_MAIL". Intente enviar un mensaje
de correo electr√≥nico sin autenticaci√≥n.
Sustituya para ello el par√°metro USER‚Äê
NAME por un string vac√≠o.

8501

-

Error de sintaxis: Par√°metro o argumento in‚Äê Posiblemente ha introducido una direc‚Äê
correcto
ci√≥n incorrecta en TO_S o CC.

8502

-

Comando desconocido o no implementado.

Compruebe las entradas realizadas,
especialmente el par√°metro FROM. Es
posible que est√© incompleto y que haya
olvidado "@" o ".".

8535

-

Autenticaci√≥n SMTP incompleta.

Puede que haya introducido un nombre
de usuario o una contrase√±a incorrec‚Äê
tas.

8550

-

No es posible acceder al servidor de correo,
no tiene derechos de acceso.

Posiblemente ha introducido un nom‚Äê
bre de usuario o una contrase√±a inco‚Äê
rrectos o el servidor de correo no so‚Äê
porta el LOGIN. Otra posible causa del
error puede ser la entrada incorrecta
del nombre del dominio despu√©s de
"@" en TO_S o CC.

8552

-

Acci√≥n cancelada: Rebase del espacio de
memoria asignado

Vuelva a intentarlo m√°s tarde.

8554

-

Transmisi√≥n fallida.

Vuelva a intentarlo m√°s tarde.

Nota
Error de estado
1. La entrada incorrecta de las direcciones de los destinatarios no genera un error de estado
de la instrucci√≥n "AS_MAIL". En tal caso no es posible garantizar el env√≠o del mensaje de
correo electr√≥nico a otros destinatarios, aunque se hayan introducido correctamente.
2. Encontrar√° m√°s informaci√≥n sobre el c√≥digo de error SMTP y otros c√≥digos de error en el
protocolo SMTP en Internet, o bien en la documentaci√≥n sobre errores del servidor de
correo. Tambi√©n es posible ver el √∫ltimo mensaje de error enviado por el servidor de correo
en forma de texto en el DB de instancia en el par√°metro BUFFER1. En √©l encontrar√° en
"Datos" los √∫ltimos datos enviados por la instrucci√≥n "AS_MAIL".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7651

Instrucciones
4.2 Instrucciones

Ejemplo de llamada de "AS_MAIL"
Descripci√≥n
En un bloque de datos se guardan los datos que se dan a conocer a trav√©s de punteros ANY
de la instrucci√≥n "AS_MAIL". En este ejemplo se utiliza para ello el DB 2.
Por motivos relacionados con el tiempo de ejecuci√≥n y el espacio en memoria, la instrucci√≥n
"AS_MAIL" no realiza una prueba de sintaxis de los par√°metros TO_S, CC y FROM.

Par√°metros TO_S, CCy FROM
Los par√°metros TO_S, CC y FROM son punteros ANY hacia strings con, por ejemplo, el
siguiente contenido:
‚óè TO: <wenna@mydomain.com>, <ruby@mydomain.com>,
‚óè CC: <admin@mydomain.com>, <judy@mydomain.com>,
‚óè FROM: <admin@mydomain.com>
Las siguientes reglas deben observarse a la hora de introducir los par√°metros:
‚óè Deben introducirse los caracteres "TO:", "CC:" y "FROM:".
‚óè Antes de cada direcci√≥n debe introducirse un espacio y un corchete en "<".
‚óè Despu√©s de cada direcci√≥n debe introducirse un corchete en ">".
‚óè Despu√©s de cada direcci√≥n en TO_S y CC debe introducirse una coma.
‚óè En FROM solo puede introducirse una direcci√≥n de correo electr√≥nico que adem√°s no debe
tener una coma al final.

Inicializaci√≥n / arranque en el OB 100
El par√°metro COM_RST de la instrucci√≥n "AS_MAIL" debe activarse antes de la primera
llamada de la instrucci√≥n
, o bien cada vez que se cargue el DB de instancia correspondiente.
En el siguiente ejemplo, DB 1 es el DB de instancia de la instrucci√≥n "AS_MAIL".
SET

7652

//Activar RLO

R

DB1.REQ

//REQ se desactiva, de modo que la instrucci√≥n "AS_MAIL" no comienza
a enviar un mensaje de correo electr√≥nico inmediatamente despu√©s de
la activaci√≥n de COM_RST.

S

DB1.COM_RST

//COM_RST se activa; esto tiene que ocurrir una vez antes de la primera
llamada de la instrucci√≥n "AS_MAIL" para la inicializaci√≥n, o bien des‚Äê
pu√©s de cada carga del DB de instancia correspondiente.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Llamada c√≠clica
Este ejemplo de llamada de la instrucci√≥n "AS_MAIL" debe llamarse c√≠clicamente (p. ej. en el
OB1).
El par√°metro REQ debe ponerse a "1" en el programa de usuario a trav√©s de "Forzar variable".
Esta l√≠nea puede copiarse en una fuente AWL y compilarse. Para ello es necesario que los
bloques DB 1 y DB 2 hayan sido registrados en la tabla de variables del proyecto.
Ejemplo de llamada de "AS_MAIL"
DATA_BLOCK "DB2"

Explicaci√≥n
//Bloque de datos global con los datos para la
instrucci√≥n "AS_MAIL"

TITLE =
VERSION : 1.0
STRUCT
TO_S : STRING [240 ] := 'TO:
<wenna@mydomain.com>,
<ruby@mydomain.com>,';

//Direcci√≥n del destinatario

CC : STRING [240 ] := 'CC:
<admin@mydomain.com>,
<judy@mydomain.com>,';

//Direcci√≥n del destinatario CC

FROM : STRING [60 ] := 'FROM:
<admin@mydomain.com>';

//Direcci√≥n del remitente

SUB : STRING [60 ] := 'Status plant 7';

//Asunto

TEXT : STRING [240 ] := 'Fault in plant 7
sector 2';

//Texto

USERNAME : STRING [60 ] := 'admin';

//Nombre de usuario para autentificaci√≥n LOGIN

PASSWORD : STRING [60 ] := 'test';

//Contrase√±a para autenticaci√≥n LOGIN

ATTACHMENT : ARRAY [1 .. 178 ] OF BYTE;

//Archivos adjuntos

END_STRUCT ;
BEGIN
END_DATA_BLOCK
DATA_BLOCK "DB1"

//DB de instancia de la instrucci√≥n "AS_MAIL"

TITLE =
AUTHOR : TELESERV
FAMILY : TELESERV
VERSION : 1.0
"AS_MAIL"
BEGIN
END_DATA_BLOCK
FUNCTION_BLOCK FB 1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7653

Instrucciones
4.2 Instrucciones
Ejemplo de llamada de "AS_MAIL"
TITLE =Example AS_MAIL

Explicaci√≥n
//El par√°metro COM_RST de la instrucci√≥n
"AS_MAIL" debe activarse antes de la primera
llamada de "AS_MAIL", o bien cada vez que se
cargue el DB de instancia correspondiente. La
condici√≥n de llamada se activa durante la
ejecuci√≥n del programa de usuario.

VERSION : 1.0
VAR
CallCondition: BOOL ;
END_VAR
BEGIN
NETWORK
CALL AS_MAIL, DB1 (

//Llamada de AS_MAIL

REQ := # CallCondition,

//Inicio de la petici√≥n con flanco ascendente

ADR_MAIL_SERVER := DW#16#C0A800C8,

//Equivale a la direcci√≥n IP 192.168.0.200 en
formato HEX

WATCH_DOG_TIME := T#2M,

//Intervalo de 2 min. dentro del cual deber√≠a
concluir el env√≠o

USERNAME := DB2.USERNAME,

//Puntero al nombre de usuario del remitente. Si
DB2.USERNAME se omite, es decir, si no se le
asigna ning√∫n par√°metro, no se utiliza el
proceso de autenticaci√≥n LOGIN.

PASSWORD := DB2.PASSWORD,

//Puntero hacia contrase√±a

TO_S := DB2.TO_S,

//Puntero hacia direcci√≥n de destinatario

CC := DB2.CC,

//Puntero a direcci√≥n de destinatario CC
(opcional). Si DB2.CC se omite, es decir, si no
se asigna, el mensaje de correo electr√≥nico no
se env√≠a a los destinatarios CC.

FROM := DB2.FROM,

//Puntero hacia direcci√≥n de remitente

SUB := DB2.SUB,

//Puntero hacia el asunto

TEXT := DB2.TEXT,

//Puntero hacia el texto del mensaje
(opcional). Si DB2.TEXT se omite, es decir, si
no se asigna, el mensaje de correo electr√≥nico
se env√≠a sin texto.

ATTACHMENT := DB2.ATTACHMENT,

//Puntero hacia los archivos adjuntos
(opcional). Ejemplo: 101 bytes adjuntos al
mensaje - ATTACHMENT := P#DB2.DBX974.0 BYTE 101
(el ejemplo se refiere al DB anterior).
//Si DB2.ATTACHMENT se omite, es decir, si no se
asigna, el mensaje de correo electr√≥nico se
env√≠a sin archivos adjuntos.

BUSY := M46.0,

//Par√°metro de salida/estado BUSY

DONE := M46.1,

//Par√°metro de salida/estado DONE

ERROR := M46.2,

//Par√°metro de salida/estado ERROR

STATUS := MW48,

//Par√°metro de salida/estado STATUS

SFC_STATUS := MW50

//Par√°metro de salida/estado SFC_STATUS

);
//Comprobaci√≥n de los resultados de la llamada
al final de la ejecuci√≥n

7654

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Ejemplo de llamada de "AS_MAIL"
U M 46.0;

Explicaci√≥n
//¬øes BUSY ==0?

SPB End;

//No, BUSY ==1. "AS_MAIL" todav√≠a est√°
ejecutando la petici√≥n

U M 46.1;

//¬øLa ejecuci√≥n de "AS_MAIL" ha finalizado sin
errores?

SPB End;
NOP 0;

//No, se ha producido un error en la ejecuci√≥n,
BUSY ==0, BR ==0
//Completar aqu√≠ valoraci√≥n del error si
procede, STATUS, SFC_STATUS

End:BE;
END_FUNCTION_BLOCK

Nota
Par√°metros opcionales
Para los par√°metros opcionales USERNAME, PASSWORD, CC, TEXT y ATTACHMENT rige:
Si se elimina una asignaci√≥n o se vuelve a insertar, el cambio no tiene efecto hasta que no se
vuelve a cargar el DB de instancia correspondiente (en el ejemplo DB 1), y se activa el
par√°metro "COM_RST".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7655

Instrucciones
4.2 Instrucciones

7656

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.1

5

Sinopsis del editor de programaci√≥n

Funci√≥n del editor de programaci√≥n
El editor de programaci√≥n es el entorno de desarrollo integrado para la programaci√≥n de
funciones, bloques de funci√≥n y bloques de organizaci√≥n. Proporciona toda la ayuda posible
para la creaci√≥n de programas y la b√∫squeda de errores.
En funci√≥n de la CPU utilizada, del lenguaje de programaci√≥n y del tipo de bloque, el aspecto
y las funciones del editor de programaci√≥n pueden variar.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7657

Editor de programaci√≥n
5.1 Sinopsis del editor de programaci√≥n

Estructura del editor de programaci√≥n
La figura siguiente muestra los componentes del editor de programaci√≥n, tomando como
ejemplo KOP:

5

1
3
2
5

3
6

4

‚ë†
‚ë°
‚ë¢
‚ë£
‚ë§
‚ë•

7658

Barra de herramientas
Interfaz del bloque
Paleta "Favoritos" de la Task Card "Instrucciones" y Favoritos en la ventana de programaci√≥n
Ventana de programaci√≥n
Task Card "Instrucciones"
Task Card "Test"

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.1 Sinopsis del editor de programaci√≥n

Barra de herramientas
La barra de herramientas permite acceder a las principales funciones del editor de
programaci√≥n, tales como:
‚óè Mostrar y ocultar operandos absolutos
‚óè Mostrar y ocultar Favoritos
‚óè Saltar a errores de sintaxis
‚óè Actualizar llamadas de bloque
‚óè Mostrar y ocultar el estado del programa
Las funciones disponibles en la barra de herramientas pueden variar seg√∫n el lenguaje de
programaci√≥n utilizado.

Interfaz del bloque
La interfaz del bloque contiene las declaraciones de las variables locales que se utilizan s√≥lo
en el bloque. Las secciones disponibles var√≠an seg√∫n el tipo de bloque.

Favoritos
Existe la posibilidad de crear favoritos para las instrucciones utilizadas con frecuencia. Estos
favoritos se muestran en la paleta "Favoritos" de la Task Card "Instrucciones". Adem√°s, los
favoritos tambi√©n se pueden visualizar en la ventana de programaci√≥n mediante la barra de
herramientas del editor de programaci√≥n. De esta manera, se puede acceder a los favoritos sin
que la Task Card "Instrucciones" est√© visible.

Ventana de programaci√≥n
La ventana de programaci√≥n es el √°rea de trabajo del editor de programaci√≥n. Aqu√≠ se puede
introducir el c√≥digo. En funci√≥n del lenguaje de programaci√≥n utilizado, la ventana de
programaci√≥n puede variar en su aspecto y funcionalidad.

Task Card "Instrucciones"
La Task Card "Instrucciones" permite acceder f√°cilmente a todas las instrucciones que pueden
utilizarse para crear el programa. Las instrucciones est√°n divididas tem√°ticamente en varias
paletas. Si un perfil de instrucciones est√° activo, las instrucciones disponibles var√≠an. Para
cada instrucci√≥n se dispone de una breve descripci√≥n. Si una instrucci√≥n est√° disponible en
varias versiones, las versiones se muestran en una lista desplegable y en el programa se
emplea la versi√≥n seleccionada actualmente. Si es necesario es posible elegir otra versi√≥n de
la instrucci√≥n. Para ello, siga las indicaciones de "Principios b√°sicos de las versiones de
instrucciones (P√°gina 7673)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7659

Editor de programaci√≥n
5.1 Sinopsis del editor de programaci√≥n
La barra de herramientas de la Task Card permite acceder a las siguientes funciones:
‚óè Examinar instrucciones hacia abajo o hacia arriba
Se pueden buscar instrucciones espec√≠ficas en las paletas.
‚óè Actualizar proyecto e instrucciones
Si se est√° trabajando en un proyecto creado con el TIA Portal V14, solo se dispone de las
versiones de instrucciones a partir de V14. El bot√≥n "Actualizar proyecto e instrucciones"
permite actualizar con total facilidad el proyecto al TIA Portal V14 SP1. A continuaci√≥n la
Task Card "Instrucciones" incluye tambi√©n las nuevas versiones de las instrucciones del
TIA Portal V14 SP1.
Nota
Observe las indicaciones siguientes:
‚óè La actualizaci√≥n no modifica el programa, es decir, sigue incluyendo las versiones
antiguas de las instrucciones de V14. Para utilizar las nuevas versiones de las
instrucciones es necesario actualizar el programa.
‚óè El bot√≥n "Actualizar proyecto e instrucciones" solo est√° activo si se contin√∫a trabajando
con un proyecto del TIA Portal V14. El bot√≥n se desactiva en cuanto se actualiza el
proyecto al TIA Portal V14 SP1.
‚óè Actualizar el programa en la CPU actual
Actualiza el programa de la CPU a las nuevas versiones de instrucciones.
‚óè Cambiar modo de paleta
Es posible elegir entre modo de paleta individual y modo multipaleta.
Consulte tambi√©n: Cambiar modo de paleta
‚óè Mostrar/ocultar t√≠tulos de las columnas
Es posible mostrar u ocultar los t√≠tulos de las columnas en las paletas. La disposici√≥n de las
columnas se puede modificar haciendo clic en el t√≠tulo de la columna y moviendo la columna
mediante Drag & Drop.

Task Card "Test"
En la Task Card "Test" pueden realizarse ajustes que influyen en la b√∫squeda de errores con
ayuda del estado del programa. Las funciones de la Task Card "Test" est√°n disponibles
√∫nicamente en modo online. Incluye las paletas siguientes, que se muestran en funci√≥n de la
CPU seleccionada y del lenguaje de programaci√≥n configurado del bloque:
‚óè Panel de control de la CPU
El estado operativo de la CPU se puede conmutar en el Panel de control de la CPU.
‚óè Puntos de parada
Los bloques creados en uno de los lenguajes de programaci√≥n textuales AWL o SCL
pueden probarse en el modo de etapa individual. Para ello, inserte puntos de parada en el
c√≥digo del programa.
En la paleta "Puntos de parada" puede encontrar todos los puntos de parada que ha
introducido; se pueden activar, borrar, navegar hasta puntos de parada concretos o bien
establecer el entorno de llamada del punto de parada.
‚óè Registro AS
En esta paleta se pueden leer los valores de los registros AS y los acumuladores.

7660

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.2 Comandos de teclado del editor de programaci√≥n
‚óè Control secuencial
En esta paleta se establece el modo de operaci√≥n para el test de las cadenas secuenciales
de los bloques GRAPH.
‚óè Ajustes de test
En esta paleta se establece la configuraci√≥n de test de los bloques GRAPH.
‚óè Entorno de llamada
En esta paleta se define el entorno de llamada del bloque.
‚óè Jerarqu√≠a de llamada
Esta paleta permite seguir la jerarqu√≠a de llamada de los bloques. La jerarqu√≠a de llamada
se visualiza √∫nicamente durante la observaci√≥n de bloques.

Consulte tambi√©n
Descripci√≥n de la interfaz de bloque (P√°gina 7783)
Ampliar la superficie de la ventana de programaci√≥n (P√°gina 7666)
Buscar instrucciones (P√°gina 7670)
Utilizar perfiles de instrucciones (P√°gina 7677)

5.2

Comandos de teclado del editor de programaci√≥n

Navegar en el editor
Funci√≥n

Combinaci√≥n de teclas

Abrir la Task Card "Instrucciones"

<Ctrl+May√∫s+C>

Abrir la Task Card "Test"

<Ctrl+May√∫s+O>

Agregar nuevo bloque

<Ctrl+N>

Abrir bloque/tipo de datos PLC

<F7>

Ampliar todos los segmentos

<Alt+F11>

Reducir todos los segmentos

<Alt+F12>

Navegar a la siguiente ubicaci√≥n del bloque u operando seleccio‚Äê <Ctrl+May√∫s+G>
nado
Navegar al lugar de anterior del bloque u operando seleccionado <Ctrl+May√∫s+F>
Navegar al siguiente acceso de lectura o escritura

<Alt+F8>

Navegar al acceso de lectura o escritura anterior

<Alt+F9>

Navegar a la definici√≥n del bloque u operando seleccionado

<Ctrl+May√∫s+D>

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7661

Editor de programaci√≥n
5.2 Comandos de teclado del editor de programaci√≥n

Navegar en el c√≥digo del programa (KOP/FUP)
Funci√≥n

Objeto seleccionado

Combinaci√≥n de teclas

Navegar entre los objetos del segmento

Objeto del segmento

Botones de direcci√≥n

Navegar al primer elemento del segmento

Objeto del segmento

<Inicio>

Navegar al √∫ltimo elemento del segmento

Objeto del segmento

<Fin>

Navegar al siguiente elemento del segmento

Objeto del segmento

<Tab>

Navegar al elemento anterior del segmento

Objeto del segmento

<May√∫s+Tab>

Insertar segmento

Cualquiera

<Ctrl+R>

Funci√≥n

Posici√≥n del cursor

Combinaci√≥n de teclas

Navegar en el c√≥digo del programa

L√≠nea

Botones de direcci√≥n

Una palabra hacia la derecha/izquierda

L√≠nea

<Ctrl+botones de direc‚Äê
ci√≥n>

Al inicio de la l√≠nea

L√≠nea

<Inicio>

Navegar en el c√≥digo del programa (AWL/SCL)

Al final de la l√≠nea

L√≠nea

<Fin>

Al inicio de una secci√≥n del c√≥digo

L√≠nea

<Ctrl+Inicio>

Al final de una secci√≥n del c√≥digo

L√≠nea

<Ctrl+Fin>

Ir al segmento siguiente (solo AWL)

T√≠tulo del segmento

<Flecha-hacia-abajo>

Ir al segmento siguiente (solo AWL)

L√≠nea

<Tab>
Repita la combinaci√≥n de
teclas hasta que la marca
de inserci√≥n se encuentre
en el siguiente segmento.

Ir al segmento anterior (solo AWL)

T√≠tulo del segmento

<Flecha-hacia-arriba>

Ir al segmento anterior (solo AWL)

L√≠nea

<May√∫s+Tab>
Repita la combinaci√≥n de
teclas hasta que la marca
de inserci√≥n se encuentre
en el segmento anterior.

Insertar segmento

Cualquiera

<Ctrl+R>

Objeto seleccionado

Combinaci√≥n de teclas

Insertar un contacto normalmente abierto

Circuito

<May√∫s+F2>

Insertar un contacto normalmente cerrado

Circuito

<May√∫s+F3>

Insertar instrucciones (KOP)
Funci√≥n

7662

Insertar cuadro vac√≠o

Circuito

<May√∫s+F5>

Insertar asignaci√≥n

Circuito

<May√∫s+F7>

Insertar "Abrir rama"

Circuito

<May√∫s+F8>

Insertar "Cerrar rama"

Circuito

<May√∫s+F9>

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.2 Comandos de teclado del editor de programaci√≥n

Insertar instrucciones (FUP)
Funci√≥n

Objeto seleccionado

Combinaci√≥n de teclas

Insertar operaci√≥n l√≥gica Y

Segmento, entrada o
salida

<May√∫s+F2>

Insertar operaci√≥n l√≥gica O

Segmento, entrada o
salida

<May√∫s+F3>

Insertar cuadro vac√≠o

Segmento

<May√∫s+F5>

Insertar asignaci√≥n

Segmento, entrada o
salida

<May√∫s+F7>

Insertar "Abrir rama"

L√≠nea de conexi√≥n
entre dos cuadros

<May√∫s+F8>

Invertir RLO

Segmento, entrada o
salida

<Ctrl+May√∫s+4>

Insertar entrada

Segmento, entrada o
salida

<Ctrl+May√∫s+3>

Introducir operandos (KOP/FUP/GRAPH)
Funci√≥n

Objeto seleccionado

Combinaci√≥n de teclas

Activar el campo de entrada para el primer ope‚Äê
rando de la instrucci√≥n

Instrucci√≥n

<Intro>
O bien:
<Letra/n√∫mero cualquiera>
Al pulsar la tecla <Intro> se
abre un campo de entrada;
al pulsar letras o n√∫meros,
estos se introducen en el
campo de entrada.

Activar el campo de entrada del operando

Operando

<F2>

Borrar operando

Operando

<Supr>

Definir variable

Operando

<Ctrl+May√∫s+I>

Reasignar variable

Operando

<Ctrl+May√∫s+P>

Cambiar nombre de la variable

Operando

<Ctrl+May√∫s+T>

Introducir operandos

Campo de entrada
de operandos

<Letra/n√∫mero cualquiera>

Confirmar la entrada del operando

Campo de entrada
de operandos

<Intro>

Abrir la funci√≥n de autocompletar

Campo de entrada
de operandos

<Ctrl+I>

Rechazar el cambio actual

Campo de entrada
de operandos

<ESC>

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

El campo de entrada se de‚Äê
sactiva y se restablece el
contenido anterior.

7663

Editor de programaci√≥n
5.2 Comandos de teclado del editor de programaci√≥n

Editar instrucciones (AWL/SCL)
Funci√≥n

Objeto seleccionado

Combinaci√≥n de teclas

Aplicar sangr√≠a (solo SCL)

L√≠nea

<Tab> o

Anular sangr√≠a (solo SCL)

L√≠nea

<Ctrl+R>
<May√∫s+Tab> o
<Ctrl+May√∫s+R>
Formatear el texto seleccionado de forma auto‚Äê
m√°tica (solo SCL)

<Ctrl+May√∫s+W>

Abrir el cuadro de di√°logo "Opciones de llamada" Cursor detr√°s de una
llamada de bloque

<Intro>

Definir variable

Operando

<Ctrl+May√∫s+I>

Reasignar variable

Operando

<Ctrl+May√∫s+P>

Cambiar nombre de la variable

Operando

<Ctrl+May√∫s+T>

Expandir/reducir lista de par√°metros (solo SCL)

Operando

<Ctrl+May√∫s+barra espa‚Äê
ciadora>

Expandir/contraer secci√≥n de c√≥digo

Marca de inserci√≥n
dentro de la secci√≥n
de c√≥digo

<Ctrl+May√∫s+Num+>

Expandir/contraer todas las secciones de c√≥digo Cualquiera

<Ctrl+May√∫s+Num->
<Ctrl+May√∫s+Num*>
<Ctrl+May√∫s+Num/>

Abrir la funci√≥n de autocompletar

Cualquiera

<Ctrl+I> o <Ctrl+barra espa‚Äê
ciadora>

Activar/borrar marcadores

<Ctrl+May√∫s+M>

Ir al marcador siguiente

<Ctrl+May√∫s+6>

Ir al marcador anterior

<Ctrl+May√∫s+5>

Marcar la selecci√≥n como comentario

L√≠nea

<Ctrl+May√∫s+Y>

Eliminar comentario

L√≠nea

<Ctrl+May√∫s+U>

Funci√≥n

√Årea

Combinaci√≥n de teclas

Retroceder/avanzar una p√°gina

Navegaci√≥n, vista de <Retroceder p√°gina>/
etapa individual, vis‚Äê <Avanzar p√°gina>
ta de cadena, instruc‚Äê
ciones permanentes

Navegar por la navegaci√≥n

Navegaci√≥n

Expandir/contraer objeto

Navegaci√≥n

Ventana de programaci√≥n de GRAPH

<Flecha-hacia-arriba>
<Flecha-hacia-abajo>
<+> o <Flecha-hacia-dere‚Äê
cha>/
<-> o <Flecha-hacia-iz‚Äê
quierda>

Cambiar entre la vista de etapa individual y la
vista de cadena si hay una etapa o una transici√≥n
seleccionada

7664

Navegaci√≥n

<Intro>

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.2 Comandos de teclado del editor de programaci√≥n
Funci√≥n

√Årea

Cambiar entre navegaci√≥n y √°rea de trabajo

Navegaci√≥n, vista de <ALT+F6>
etapa individual, vis‚Äê
ta de cadena, instruc‚Äê
ciones permanentes

Combinaci√≥n de teclas

Saltar hasta el primer elemento de un segmento Vista de etapa indivi‚Äê
dual

<Inicio>

Saltar hasta el √∫ltimo elemento de un segmento

Vista de etapa indivi‚Äê
dual

<Fin>

Cambiar a interlock

Vista de etapa indivi‚Äê
dual

<Ctrl+Inicio>

Cambiar a transici√≥n

Vista de etapa indivi‚Äê
dual

<Ctrl+Fin>

Navegar por la estructura

Vista de cadena

Botones de direcci√≥n

Saltar a la primera etapa

Vista de cadena

<Inicio> o <Ctrl+Inicio>

Saltar a la √∫ltima etapa

Vista de cadena

<Fin> o <Ctrl+Fin>

Abrir rama

Vista de cadena

<May√∫s+F8>

Cerrar rama

Vista de cadena

<May√∫s+F9>

Insertar fin de cadena

Vista de cadena

<May√∫s+F7>

Insertar salto

Vista de cadena

<May√∫s+F12>

Insertar etapa y transici√≥n

Vista de cadena

<May√∫s+F5>

Borrar elemento

Vista de cadena

<Supr>

Saltar hasta el primer elemento editable

Instrucciones perma‚Äê <Inicio>
nentes

Saltar hasta el siguiente elemento editable

Instrucciones perma‚Äê <Tab>
nentes

Saltar hasta el √∫ltimo elemento editable

Instrucciones perma‚Äê <Fin>
nentes

Saltar hasta el elemento editable anterior

Instrucciones perma‚Äê <May√∫s+Tab>
nentes

Saltar hasta el principio de la celda "Acci√≥n"

Acciones

<Inicio>

Saltar hasta el final de la celda "Acci√≥n"

Acciones

<Fin>

Insertar nueva acci√≥n

Acciones

<Intro>

Funci√≥n

√Årea

Combinaci√≥n de teclas

Expandir √°rea

Vista general de
<Ctrl+May√∫s+Num+>
√°reas, √°rea en la ven‚Äê
tana de programaci√≥n

Contraer √°rea

<Ctrl+May√∫s+Num->
Vista general de
√°reas, √°rea en la ven‚Äê
tana de programaci√≥n

Ventana de programaci√≥n de SCL

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7665

Editor de programaci√≥n
5.3 Ampliar la superficie de la ventana de programaci√≥n
Funci√≥n

√Årea

Combinaci√≥n de teclas

Expandir todas las √°reas

Vista general de
√°reas, ventana de
programaci√≥n

<Ctrl+May√∫s+Num*>

Contraer todas las √°reas

Vista general de
√°reas, ventana de
programaci√≥n

<Ctrl+May√∫s+Num/>

Observar el programa
Funci√≥n

Combinaci√≥n de teclas

Posicionar/borrar punto de parada (AWL, SCL)

<Ctrl+May√∫s+F9>

Saltar punto de parada (AWL, SCL)

<Ctrl+May√∫s+F10>

Saltar a un bloque subordinado (AWL, SCL)

<Ctrl+May√∫s+F11>

Regresar al bloque invocante (AWL, SCL)

<Ctrl+May√∫s+F12>

Ejecutar el programa hasta la marca (posici√≥n del cursor) (AWL, <Ctrl+F3>
SCL)

5.3

Mostrar el estado del programa (AWL, SCL, tabla de variables
PLC, tabla de observaci√≥n y bloque de datos)

<Ctrl+T>

Activar todos los puntos de parada (AWL, SCL)

<Ctrl+May√∫s+F2>

Desactivar todos los puntos de parada (AWL, SCL)

<Ctrl+May√∫s+F3>

Forzar a 0 (KOP, FUP)

<Ctrl+May√∫s+9>

Forzar a 1 (KOP, FUP)

<Ctrl+May√∫s+1>

Forzar operando (KOP, FUP)

<Ctrl+May√∫s+2>

Ampliar la superficie de la ventana de programaci√≥n

Introducci√≥n
Si se visualizan todos los elementos de la aplicaci√≥n, la superficie de la ventana de
programaci√≥n es relativamente peque√±a. Por este motivo, con programas extensos puede ser
preciso desplazar a menudo el √°rea de trabajo. Para evitarlo, es posible ocultar o minimizar la
visualizaci√≥n de los siguientes componentes de la aplicaci√≥n y del editor de programaci√≥n:
‚óè √Årbol del proyecto
‚óè Task Cards
‚óè Interfaz del bloque
‚óè Favoritos
‚óè Comentarios
‚óè Segmentos

7666

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.3 Ampliar la superficie de la ventana de programaci√≥n

Nota
Para las Task Cards, el √°rbol del proyecto y la ventana de inspecci√≥n se puede utilizar de
manera adicional la opci√≥n "Contraer autom√°ticamente". As√≠, las ventanas se cierran
autom√°ticamente cuando no se necesitan.
Consulte tambi√©n: Maximizar y minimizar el √°rea de trabajo

Mostrar y ocultar el √°rbol del proyecto
Desde el √°rbol del proyecto se accede a todas las √°reas del proyecto. Durante la creaci√≥n del
programa es posible ocultar el √°rbol del proyecto para ampliar el tama√±o de la ventana de
programaci√≥n.
Para mostrar u ocultar el √°rbol del proyecto, proceda del siguiente modo:
1. Desactive la casilla de verificaci√≥n "√Årbol del proyecto" del men√∫ "Ver" o haga clic en el
bot√≥n "Contraer" de la barra de t√≠tulo del √°rbol del proyecto para ocultarlo.
2. Active la casilla de verificaci√≥n "√Årbol del proyecto" del men√∫ "Ver" o haga clic en el bot√≥n
"Expandir" de la barra de t√≠tulo del √°rbol del proyecto para mostrarlo.

Abrir y cerrar Task Cards
Las Task Cards se encuentran en el margen derecho de la ventana de programaci√≥n.
Para abrir o cerrar Task Cards, proceda del siguiente modo:
1. Desactive la casilla de verificaci√≥n "Task Card" del men√∫ "Ver" o haga clic en el bot√≥n
"Contraer" de la barra de t√≠tulo de las Task Cards para cerrarlas.
2. Active la casilla de verificaci√≥n "Task Card" del men√∫ "Ver" o haga clic en el bot√≥n
"Expandir" de la barra de t√≠tulo de las Task Cards para abrirlas.

Mostrar y ocultar la interfaz del bloque
La interfaz de un bloque se encuentra en el √°rea superior del editor de programaci√≥n. Durante
la programaci√≥n es posible ocultarla y mostrarla de nuevo en caso necesario.
Para mostrar u ocultar la interfaz del bloque, proceda del siguiente modo:
1. Haga clic en la flecha hacia arriba o hacia abajo situada en el √°rea inferior de la interfaz,
dentro de la l√≠nea divisoria de ventanas.

Mostrar y ocultar Favoritos
Para mostrar u ocultar los Favoritos en el editor de programaci√≥n, proceda del siguiente modo:
1. Haga clic en el bot√≥n "Mostrar Favoritos tambi√©n en el editor" de la barra de herramientas
del editor de programaci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7667

Editor de programaci√≥n
5.4 Ajustar los nem√≥nicos

Mostrar y ocultar comentarios
En un bloque es posible introducir un comentario para el bloque o para cada segmento. Estos
dos tipos de comentarios se muestran y ocultan de distintas maneras.
Para mostrar u ocultar un comentario de bloque, proceda del siguiente modo:
1. Haga clic en el tri√°ngulo que aparece al comienzo de la fila que contiene el t√≠tulo del bloque.
Para mostrar u ocultar los comentarios de segmentos, proceda del siguiente modo:
1. Haga clic en el bot√≥n "Activar/desactivar comentarios de segmentos" de la barra de
herramientas del editor de programaci√≥n.
Nota
En funci√≥n del lenguaje de programaci√≥n utilizado, los comentarios disponibles pueden variar.

Expandir y contraer segmentos
Algunos lenguajes de programaci√≥n utilizan segmentos. √âstos pueden abrirse o cerrarse
seg√∫n necesidad.
Para expandir o contraer un segmento en particular, proceda del siguiente modo:
1. Si desea expandir un segmento, haga clic en la flecha hacia la derecha antepuesta al t√≠tulo
del segmento. Si desea contraer un segmento, haga clic en la flecha hacia abajo
antepuesta al t√≠tulo del segmento.
Para expandir o contraer todos los segmentos, proceda del siguiente modo:
1. Haga clic en el bot√≥n "Abrir todos los segmentos" o "Cerrar todos los segmentos" de la barra
de herramientas del editor de programaci√≥n.
Nota
Los segmentos no se utilizan en todos los lenguajes de programaci√≥n.

Consulte tambi√©n
Sinopsis del editor de programaci√≥n (P√°gina 7657)

5.4

Ajustar los nem√≥nicos
Los bloques pueden programarse utilizando nem√≥nicos alemanes o internacionales. Al abrir el
TIA Portal por primera vez est√°n preajustados los nem√≥nicos internacionales. No obstante,
pueden cambiarse en todo momento.

7668

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.5 Mostrar operandos simb√≥licos y absolutos

Procedimiento
Para ajustar los nem√≥nicos, proceda del siguiente modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "General" en la navegaci√≥n local.
3. Seleccione los nem√≥nicos deseados del grupo "Configuraci√≥n general".
Los nem√≥nicos se cambian en todos los bloques.

5.5

Mostrar operandos simb√≥licos y absolutos
Los operandos pueden representarse en el editor de programaci√≥n de las siguientes maneras:
‚óè Representaci√≥n simb√≥lica
En el programa se visualizan los operandos simb√≥licos. Las direcciones absolutas
correspondientes se visualizan en tooltips al situar el puntero del rat√≥n unos instantes sobre
el operando.
‚óè Representaci√≥n absoluta
En el programa se visualizan las direcciones absolutas. Los operandos simb√≥licos
correspondientes se visualizan en tooltips.
‚óè Representaci√≥n simb√≥lica y absoluta
En el programa se visualizan operandos simb√≥licos y direcciones absolutas. Este ajuste
solo tiene efecto en bloques programados en KOP, FUP, AWL y GRAPH.
Nota
Para bloques GRAPH, tenga en cuenta que no se muestran operandos absolutos si en el
men√∫ contextual de la columna "Acci√≥n" se ha desactivado la opci√≥n "Mostrar operandos
absolutos".
La representaci√≥n de los operandos se puede ajustar de forma centralizada para todos los
bloques nuevos del proyecto, o bien para un bloque en particular.

Ajustar la representaci√≥n de operandos de bloques nuevos
Para ajustar la representaci√≥n de operandos de todos los bloques nuevos del proyecto,
proceda del siguiente modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "Programaci√≥n PLC > General" en la navegaci√≥n local.
3. Seleccione la representaci√≥n deseada en la lista desplegable "Representaci√≥n de
operandos".
La representaci√≥n seleccionada se utilizar√° para todos los bloques nuevos del programa.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7669

Editor de programaci√≥n
5.6 Buscar instrucciones

Ajustar la representaci√≥n de operandos de un bloque concreto
Para cambiar la representaci√≥n de los operandos, proceda del siguiente modo:
1. Abra el bloque en el editor de programaci√≥n.
2. Haga clic en el bot√≥n "Operandos absolutos/simb√≥licos" de la barra de herramientas del
editor de programaci√≥n.
Cada vez que se hace clic en el bot√≥n se obtiene una representaci√≥n diferente y se modifica
el s√≠mbolo del bot√≥n.
O bien:
1. Abra el bloque en el editor de programaci√≥n.
2. Haga clic en la flecha peque√±a que aparece junto al bot√≥n "Operandos absolutos/
simb√≥licos" de la barra de herramientas del editor de programaci√≥n.
Se abre una lista desplegable.
3. Seleccione la representaci√≥n deseada de la lista desplegable.
Se modifica el s√≠mbolo del bot√≥n.

Consulte tambi√©n
Fundamentos de los operandos (P√°gina 95)

5.6

Buscar instrucciones
En la Task Card "Instrucciones" se pueden buscar instrucciones espec√≠ficas para agregarlas
al programa. Tenga en cuenta las reglas siguientes al introducir los t√©rminos de b√∫squeda:
‚óè No se distingue entre may√∫sculas y min√∫sculas.
‚óè En la b√∫squeda se tienen en cuenta partes de un t√©rmino buscado.
‚óè No pueden utilizarse caracteres comod√≠n como p. ej. "*" y "?".
‚óè Si una instrucci√≥n contiene guiones bajos, se encontrar√° en la b√∫squeda aunque no los
introduzca.
‚óè En la b√∫squeda se tienen en cuenta los textos de las columnas "Nombre" y "Descripci√≥n".

Requisitos
‚óè Hay un bloque abierto.
‚óè La Task Card "Instrucciones" est√° abierta.

7670

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.7 Edici√≥n de textos de proyectos multiling√ºes en bloques

Procedimiento
Para buscar una instrucci√≥n determinada en la Task Card "Instrucciones", proceda del
siguiente modo:
1. Seleccione el punto inicial de la b√∫squeda si desea buscar a partir de un punto concreto. Si
no selecciona nada, la b√∫squeda comenzar√° por arriba o por abajo dentro de la Task Card,
en funci√≥n del tipo de b√∫squeda que haya seleccionado.
2. En la barra de herramientas de la Task Card, introduzca un t√©rmino de b√∫squeda en el
campo de texto.
3. Haga clic en el bot√≥n "B√∫squeda descendente" para buscar en la Task Card de arriba a
abajo.
4. Haga clic en el bot√≥n "B√∫squeda ascendente" para buscar en la Task Card de abajo a arriba.
Como resultado aparece la primera coincidencia encontrada con el t√©rmino de b√∫squeda.
Para continuar la b√∫squeda, vuelva a hacer clic en el bot√≥n "B√∫squeda descendente" o
"B√∫squeda ascendente". Si no se encuentra ninguna coincidencia, aparecer√° el mensaje
correspondiente.

Consulte tambi√©n
Sinopsis del editor de programaci√≥n (P√°gina 7657)

5.7

Edici√≥n de textos de proyectos multiling√ºes en bloques

Introducci√≥n
Un bloque puede contener los siguientes textos de proyectos traducibles:
‚óè T√≠tulo del bloque y de los segmentos
‚óè Comentarios sobre el bloque y los segmentos
‚óè Comentarios en la interfaz del bloque
‚óè Comentarios sobre los operandos utilizados
‚óè Comentarios libres
Para traducir estos textos a otro idioma hay que activar el idioma como idioma del proyecto.
Encontrar√° m√°s informaci√≥n sobre la activaci√≥n de idiomas del proyecto en AUTOHOTSPOT.
Tenga en cuenta que los textos no deben sobrepasar la longitud de 32767 caracteres Unicode
tampoco una vez traducidos.

Requisitos
‚óè Hay varios idiomas de proyecto activados.
‚óè Hay un bloque abierto y este contiene como m√≠nimo un texto traducible.
‚óè El bloque no tiene protecci√≥n de know-how.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7671

Editor de programaci√≥n
5.7 Edici√≥n de textos de proyectos multiling√ºes en bloques

Procedimiento
Para editar un texto en todos los idiomas del proyecto, proceda del siguiente modo:
1. Seleccione el elemento deseado en el bloque abierto. La siguiente tabla proporciona una
vista general de las posibilidades de selecci√≥n.
Elemento selec‚Äê
cionado

Textos del proyecto mostrados

Paleta "T√≠tulo del
bloque"

Seleccionando la paleta "T√≠tulo del bloque" podr√° editar los siguientes textos del
proyecto:
‚óè T√≠tulo del bloque y de los segmentos
‚óè Comentarios sobre el bloque y los segmentos
‚óè Comentarios libres en todo el bloque
‚óè Comentarios en la interfaz del bloque
En el caso de las multiinstancias o las instancias de par√°metros solo se
muestran los comentarios de elementos que se hayan modificado
espec√≠ficamente para alguna instancia. Estos comentarios se reconocen
por el hecho de que no se muestran en gris. Los comentarios que se
muestran en gris solo pueden seleccionarse y editarse en el bloque de
funci√≥n correspondiente.

Paleta de seg‚Äê
mento

Seleccionando una o m√°s paletas de segmento podr√° editar los siguientes
textos del proyecto:
‚óè T√≠tulos y comentarios de los segmentos seleccionados
‚óè Comentarios libres en los segmentos

Elemento del len‚Äê Seleccionando uno o varios elementos del lenguaje (p. ej., cuadros en KOP/
guaje
FUP) o una parte del c√≥digo del programa en AWL o SCL, podr√° editar los
siguientes textos del proyecto:
‚óè Comentarios sobre los operandos utilizados, tambi√©n sobre las variables
PLC globales
‚óè En llamadas de bloques: comentarios sobre los par√°metros de bloque que
reciben par√°metros actuales
‚óè Comentarios libres en el elemento del lenguaje
Etapa o transici√≥n Seleccionando una etapa o una transici√≥n en un bloque GRAPH, podr√° editar
los siguientes textos del proyecto:
‚óè Nombre de la etapa
‚óè Nombre de la transici√≥n

2. Abra la ficha "Propiedades" de la ventana de inspecci√≥n.
3. Abra la ficha subordinada "Textos".
En la ficha "Textos" se muestran los textos en los idiomas del proyecto activos y, si los hay,
sus traducciones.
4. Las traducciones se pueden editar directamente en la tabla de la ficha "Textos".
5. Para editar las traducciones con un editor externo, los textos mostrados se pueden exportar
al formato OOXML con los botones "Exportar/Importar textos del proyecto".

7672

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.8 Utilizar versiones de instrucciones

Nota
Editar todos los textos del proyecto en la tabla global "Textos del proyecto"
Las traducciones de los textos del proyecto tambi√©n se pueden editar en la tabla global "Textos
del proyecto". La tabla se encuentra en el √°rbol del proyecto, en "Idiomas y recursos > Textos
del proyecto". Contiene todos los textos traducidos de todo el proyecto.
Encontrar√° m√°s informaci√≥n sobre la traducci√≥n de textos en AUTOHOTSPOT.

5.8

Utilizar versiones de instrucciones

5.8.1

Principios b√°sicos de las versiones de instrucciones

Introducci√≥n
Las instrucciones disponibles para programar el programa de usuario se gestionan en las
librer√≠as del sistema. Si debido a una actualizaci√≥n se instala una versi√≥n nueva de una librer√≠a
de sistema, se instalar√°n tambi√©n las versiones m√°s recientes de las instrucciones de dicha
librer√≠a, si las hubiere.
Si hay varias versiones de una instrucci√≥n, se relacionan en una lista desplegable detr√°s de la
instrucci√≥n correspondiente en la Task Card "Instrucciones". Si las versiones de la instrucci√≥n
est√°n ocultas, es posible visualizarlas mediante el men√∫ contextual del t√≠tulo de la columna.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7673

Editor de programaci√≥n
5.8 Utilizar versiones de instrucciones
Seleccione en la lista desplegable la versi√≥n de la instrucci√≥n que debe usarse en el programa.
Si no se selecciona ninguna versi√≥n se utilizar√°n las m√°s recientes.
Nota
Tenga en cuenta las indicaciones siguientes:
‚óè Dentro de un dispositivo s√≥lo es posible utilizar una misma versi√≥n de una instrucci√≥n.
‚óè Si en un bloque con protecci√≥n de know-how utiliza una instrucci√≥n de una versi√≥n diferente
de la versi√≥n ajustada en el proyecto, puede compilar el bloque con protecci√≥n de knowhow sin contrase√±a si las interfaces de las versiones de las instrucciones son id√©nticas.
Cuando vuelva a abrir el bloque con protecci√≥n de know-how deber√° actualizar la llamada
de la instrucci√≥n. La llamada correspondiente est√° marcada en rojo. Al compilar todo el
programa el sistema actualiza la llamada autom√°ticamente.
‚óè Si se modifica la versi√≥n de una instrucci√≥n de la que dependen otras instrucciones, se
modificar√°n tambi√©n las versiones de las instrucciones dependientes.
‚óè Si se selecciona una versi√≥n de una instrucci√≥n que no puede ejecutarse en la CPU
utilizada, la instrucci√≥n se mostrar√° atenuada. Esto significa que no es posible utilizar dicha
versi√≥n de la instrucci√≥n en la CPU.
‚óè En el √°rbol del proyecto, en las propiedades del bloque de sistema se indica el n√∫mero de
bloque y este no tiene que coincidir con el n√∫mero de versi√≥n de la instrucci√≥n
correspondiente en la Task Card.
‚óè Si modifica la versi√≥n de una instrucci√≥n en la Task Card, tendr√° que compilar el bloque de
sistema correspondiente en el √°rbol del proyecto para que el n√∫mero de bloque
correspondiente se actualice.

Modificaciones en las versiones
Las versiones nuevas pueden ser principales o secundarias. Las versiones principales
nuevas, p. ej. 2.0 √≥ 3.0, incluyen cambios importantes. Por consiguiente, las versiones
principales nuevas pueden provocar cambios en la interfaz del bloque. Las versiones
secundarias nuevas, p. ej. 1.3 √≥ 1.4, incluyen cambios menores o soluciones a errores.

Uso de versiones de instrucciones
Dentro de un dispositivo existe la posibilidad de decidir qu√© versi√≥n de una instrucci√≥n debe
utilizarse. Si se selecciona una versi√≥n distinta de una instrucci√≥n, se aplicar√° la versi√≥n nueva
en todas las ubicaciones de la instrucci√≥n dentro del programa. Estas instrucciones se marcan
con un borde rojo en el programa. Seguidamente hay que cargar el programa en el dispositivo
para que se utilicen las versiones nuevas de la instrucci√≥n.
Si se abre el proyecto con una versi√≥n nueva del TIA Portal, dentro de la Task Card
"Instrucciones" se puede actualizar el proyecto y las instrucciones a la versi√≥n nueva del TIA
Portal. De este modo se dispone de versiones m√°s recientes de algunas instrucciones. Sin
embargo, estas no reemplazan autom√°ticamente las versiones antiguas del programa. Para
utilizar en el programa las nuevas versiones de las instrucciones es necesario actualizar
expresamente el programa.

7674

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.8 Utilizar versiones de instrucciones

Consulte tambi√©n
Actualizar proyecto e instrucciones (P√°gina 7675)
Actualizar el programa de la CPU actual (P√°gina 7676)

5.8.2

Actualizar proyecto e instrucciones
Es posible actualizar un proyecto y las versiones de las instrucciones en un solo paso a una
nueva versi√≥n del TIA Portal. Al hacerlo no cambiar√° el programa.
Nota
No existe compatibilidad con versiones anteriores
Los proyectos guardados con la versi√≥n actual del TIA Portal no son compatibles con versiones
anteriores debido a la ampliaci√≥n de funciones de la versi√≥n actual. Al actualizar se guarda un
proyecto nuevo en la versi√≥n actual del proyecto. El proyecto de origen no se sobrescribe y
puede continuar edit√°ndose con una versi√≥n anterior compatible del TIA Portal.

Procedimiento
Para actualizar un proyecto y las instrucciones, proceda del siguiente modo:
1. Abra un bloque l√≥gico.
2. Abra la Task Card "Instrucciones".
3. Haga clic en el bot√≥n "Actualizar proyecto e instrucciones" de la barra de herramientas.
Se abre el cuadro de di√°logo "Compatibilidad del proyecto".
4. Para continuar el proceso de actualizaci√≥n, haga clic en "Aceptar".

Resultado
El proyecto y las instrucciones se actualizan. El bot√≥n "Actualizar proyecto e instrucciones" se
desactiva y la funci√≥n ya no puede ejecutarse de nuevo.
En el siguiente paso se actualiza el programa para utilizar las nuevas versiones de las
instrucciones.

Consulte tambi√©n
Principios b√°sicos de las versiones de instrucciones (P√°gina 7673)
Actualizar el programa de la CPU actual (P√°gina 7676)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7675

Editor de programaci√≥n
5.8 Utilizar versiones de instrucciones

5.8.3

Actualizar el programa de la CPU actual
Si en el proyecto hay nuevas versiones de instrucciones, se puede actualizar el programa de
una CPU para utilizar las nuevas versiones. Puede ser necesario, por ejemplo, despu√©s de una
actualizaci√≥n del proyecto a una nueva versi√≥n del TIA Portal. Tenga en cuenta que despu√©s
de la actualizaci√≥n es necesario compilar el programa.

Procedimiento
Para actualizar el programa de la CPU actual, proceda del modo siguiente:
1. En el √°rbol del proyecto, haga clic con el bot√≥n derecho del rat√≥n en la CPU para que la
desee actualizar el programa.
2. En el men√∫ contextual, elija el comando "Actualizar programa".
Se abre el cuadro de di√°logo "Actualizar el programa en la CPU actual".
3. Para ejecutar la actualizaci√≥n, haga clic en "Aceptar".
4. Compile el programa para finalizar la actualizaci√≥n.
O:
1. Abra un bloque l√≥gico.
2. Abra la Task Card "Instrucciones".
3. Haga clic en el bot√≥n "Actualizar el programa en la CPU actual" de la barra de herramientas.
Se abre el cuadro de di√°logo "Actualizar el programa en la CPU actual".
4. Para ejecutar la actualizaci√≥n, haga clic en "Aceptar".
5. Compile el programa para finalizar la actualizaci√≥n.

Consulte tambi√©n
Principios b√°sicos de las versiones de instrucciones (P√°gina 7673)
Actualizar proyecto e instrucciones (P√°gina 7675)

7676

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.9 Utilizar perfiles de instrucciones

5.9

Utilizar perfiles de instrucciones

5.9.1

Principios b√°sicos de los perfiles de instrucciones

Introducci√≥n
El TIA Portal proporciona un gran n√∫mero de instrucciones para la programaci√≥n del programa
de usuario. No obstante, si no desea utilizar todas las instrucciones, puede filtrar las que no
utilice. Para ese fin se pueden crear perfiles de instrucciones y definir dentro de cada perfil qu√©
instrucciones deben aparecer en la Task Card "Instrucciones". Dentro de un proyecto se
pueden crear varios perfiles de instrucciones, pero en cada caso solo puede estar activo un
perfil. A trav√©s de librer√≠as globales se pueden intercambiar perfiles de instrucciones con otros
usuarios.
Nota
Tenga en cuenta las indicaciones siguientes:
‚óè Si en un bloque se utilizan instrucciones que est√°n excluidas por el perfil activo, se muestra
un error al compilar el bloque. Eso puede ocurrir p. ej. con un bloque arrastrado al programa
desde una librer√≠a.
‚óè Las instrucciones de un perfil que no son soportadas por los productos instalados se borran
del perfil en la siguiente ejecuci√≥n del mismo. Si se transfiere el perfil a un sistema de
ingenier√≠a en el que las instrucciones s√≠ que son soportadas por los productos instalados,
las instrucciones estar√°n presentes en el perfil, pero estar√°n desactivadas. En caso
necesario, es posible volver a activarlas en cualquier momento.
‚óè Si se modifica el perfil activo, deber√°n compilarse nuevamente los bloques del proyecto.
Esto es necesario tambi√©n para desactivar y borrar el perfil activo o para activar un perfil.

Consulte tambi√©n
Crear un perfil de instrucciones (P√°gina 7677)
Abrir y editar un perfil de instrucciones (P√°gina 7679)
Activar y desactivar un perfil de instrucciones (P√°gina 7680)
Borrar un perfil de instrucciones (P√°gina 7681)

5.9.2

Crear un perfil de instrucciones

Requisitos
La carpeta "Datos comunes > Perfiles de instrucciones" del √°rbol del proyecto est√° abierta.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7677

Editor de programaci√≥n
5.9 Utilizar perfiles de instrucciones

Procedimiento
Para crear un perfil de instrucciones, proceda del siguiente modo:
1. Haga doble clic en el comando "Agregar perfil de instrucciones".
El editor de perfiles de instrucciones se abre y se muestra un perfil nuevo. En el perfil nuevo
est√°n activadas todas las instrucciones.
2. Edite el perfil de instrucciones nuevo conforme a las necesidades.
El nombre del perfil nuevo se puede modificar si es necesario. Proceda para ello del siguiente
modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en el nuevo perfil de instrucciones.
2. Elija el comando "Cambiar nombre" del men√∫ contextual.
3. Introduzca un nombre para el nuevo perfil de instrucciones.
Nota
Si se trata del primer perfil de instrucciones creado, se utilizar√° como perfil activo. En este caso,
hay que compilar todos los bloques del proyecto. Si ya existen otros perfiles de instrucciones,
ser√° necesario activar expl√≠citamente el perfil nuevo para que se utilice como perfil activo. En
el √°rbol del proyecto el perfil activo se reconoce por el s√≠mbolo.

Consulte tambi√©n
Principios b√°sicos de los perfiles de instrucciones (P√°gina 7677)
Abrir y editar un perfil de instrucciones (P√°gina 7679)
Activar y desactivar un perfil de instrucciones (P√°gina 7680)
Borrar un perfil de instrucciones (P√°gina 7681)

7678

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.9 Utilizar perfiles de instrucciones

5.9.3

Abrir y editar un perfil de instrucciones
Una vez que se ha abierto un perfil de instrucciones, se puede editar del siguiente modo:
‚óè Activar y desactivar instrucciones
Para cada instrucci√≥n se puede definir si est√° permitida o no dentro del perfil de
instrucciones.
Nota
Tenga en cuenta que existen dependencias entre determinadas instrucciones. Por esta
raz√≥n, es posible que una √∫nica acci√≥n active o desactive varias instrucciones. El s√≠mbolo
de la casilla de verificaci√≥n permite reconocer en qu√© carpetas hay instrucciones
desactivadas.
‚óè Activar y desactivar versiones de instrucci√≥n
Algunas instrucciones est√°n disponibles en diferentes versiones. Si una instrucci√≥n tiene
varias versiones, se puede definir para cada versi√≥n si est√° permitida o no dentro del perfil
de instrucciones.
‚óè Cambiar un n√∫mero de bloque
Si una instrucci√≥n es un bloque de funci√≥n (FB) o una funci√≥n (FC) internamente en el
sistema, la instrucci√≥n recibe del sistema un n√∫mero de bloque determinado. Ese n√∫mero
de bloque se puede cambiar por un n√∫mero de bloque propio. Para algunas instrucciones
existen varias implementaciones dentro de una versi√≥n. En ese tipo de instrucciones los
n√∫meros de bloque solo pueden modificarse individualmente para cada implementaci√≥n.
Nota
Si en el programa se utiliza la instrucci√≥n de un perfil y el n√∫mero de bloque definido ya est√°
ocupado en el programa de usuario por otro bloque, el n√∫mero de bloque definido para la
instrucci√≥n se cambia por un n√∫mero de bloque libre.

Requisitos
La carpeta "Datos comunes > Perfiles de instrucciones" del √°rbol del proyecto est√° abierta.

Abrir perfiles de instrucciones
Para abrir un perfil de instrucciones, proceda del siguiente modo:
1. Haga clic en el perfil de instrucciones que desea visualizar.
El perfil se abre en el editor de perfiles de instrucciones.

Editar perfiles de instrucciones
Para editar un perfil en el editor de perfiles de instrucciones, proceda del siguiente modo:
1. En la lista desplegable "Familia de dispositivos" seleccione el dispositivo para el cual desea
editar el perfil de instrucciones.
2. En la lista desplegable "Lenguaje" seleccione el lenguaje de programaci√≥n para el cual
desea editar el perfil de instrucciones.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7679

Editor de programaci√≥n
5.9 Utilizar perfiles de instrucciones
3. Desactive las instrucciones o versiones de instrucci√≥n que desea excluir del perfil. Si
desactiva una carpeta, se desactivar√°n todas las instrucciones que contiene.
4. Active las instrucciones o versiones de instrucci√≥n que desea permitir dentro del perfil.
5. Si es necesario, asigne n√∫meros de bloque propios.
Nota
Para CPUs de la serie S7-1200/1500 es posible asignar n√∫meros hasta 65535. Para CPUs
de la serie S7300/400 encontrar√° las restricciones de los rangos num√©ricos en el
correspondiente manual de la CPU.

Nota
Si se modifica el perfil activo, se precisar√° un nuevo proceso de compilaci√≥n para todos los
bloques del proyecto.

Consulte tambi√©n
Principios b√°sicos de los perfiles de instrucciones (P√°gina 7677)
Crear un perfil de instrucciones (P√°gina 7677)
Activar y desactivar un perfil de instrucciones (P√°gina 7680)
Borrar un perfil de instrucciones (P√°gina 7681)
Principios b√°sicos de las versiones de instrucciones (P√°gina 7673)

5.9.4

Activar y desactivar un perfil de instrucciones
Para que el filtrado de las instrucciones de un perfil pueda aplicarse, primero hay que activar
el perfil. El perfil activo puede desactivarse en cualquier momento, y entonces la Task Card
"Instrucciones" volver√° a contener las instrucciones est√°ndar.
Nota
Ser√° necesario un nuevo proceso de compilaci√≥n para todos los bloques del proyecto.

Requisitos
La carpeta "Datos comunes > Perfiles de instrucciones" del √°rbol del proyecto est√° abierta.

7680

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.9 Utilizar perfiles de instrucciones

Activar un perfil de instrucciones
Para activar un perfil de instrucciones, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en el perfil de instrucciones que desea activar.
2. Elija el comando "Activar perfil de instrucciones" del men√∫ contextual.
El perfil de instrucciones seleccionado ser√° entonces el perfil activo. As√≠, las instrucciones
solo pueden utilizarse conforme a los ajustes de ese perfil.

Desactivar un perfil de instrucciones
Para desactivar el perfil de instrucciones activo, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en el perfil de instrucciones que desea desactivar.
2. Elija el comando "Desactivar perfil de instrucciones" del men√∫ contextual.
Si no hay ning√∫n perfil de instrucciones activo, en la Task Card "Instrucciones" estar√°n
disponibles de nuevo todas las instrucciones.

Consulte tambi√©n
Principios b√°sicos de los perfiles de instrucciones (P√°gina 7677)
Crear un perfil de instrucciones (P√°gina 7677)
Abrir y editar un perfil de instrucciones (P√°gina 7679)
Borrar un perfil de instrucciones (P√°gina 7681)

5.9.5

Borrar un perfil de instrucciones

Requisitos
La carpeta "Datos comunes > Perfiles de instrucciones" del √°rbol del proyecto est√° abierta.

Procedimiento
Para borrar un perfil de instrucciones, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en el perfil de instrucciones que desea borrar.
2. Elija el comando "Borrar" del men√∫ contextual.
Nota
Si se borra el perfil activo, se precisar√° un nuevo proceso de compilaci√≥n para todos los
bloques del proyecto.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7681

Editor de programaci√≥n
5.10 Utilizar la funci√≥n autom√°tica de autocompletar

Resultado
El perfil de instrucciones seleccionado se borra. Si el perfil de instrucciones borrado era el perfil
activo, no habr√° ning√∫n perfil activo y en la Task Card "Instrucciones" se mostrar√°n de nuevo
todas las instrucciones disponibles de forma est√°ndar.

Consulte tambi√©n
Principios b√°sicos de los perfiles de instrucciones (P√°gina 7677)
Crear un perfil de instrucciones (P√°gina 7677)
Abrir y editar un perfil de instrucciones (P√°gina 7679)
Activar y desactivar un perfil de instrucciones (P√°gina 7680)

5.10

Utilizar la funci√≥n autom√°tica de autocompletar

5.10.1

Principios b√°sicos de la funci√≥n autom√°tica de autocompletar

Funci√≥n
En la ventana de programaci√≥n del editor de programaci√≥n se puede utilizar la funci√≥n
autom√°tica de autocompletar para acceder f√°cilmente a las variables o instrucciones
existentes durante la programaci√≥n. La funci√≥n autom√°tica de autocompletar significa que en
un cuadro de di√°logo se obtiene una lista espec√≠fica de contexto, desde la cual se pueden
seleccionar las variables e instrucciones deseadas.

Consulte tambi√©n
Utilizar la funci√≥n autom√°tica de autocompletar en los lenguajes de programaci√≥n gr√°ficos
(P√°gina 7683)
Utilizar la funci√≥n autom√°tica de autocompletar en los lenguajes de programaci√≥n textuales
(P√°gina 7684)

7682

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.10 Utilizar la funci√≥n autom√°tica de autocompletar

5.10.2

Utilizar la funci√≥n autom√°tica de autocompletar en los lenguajes de programaci√≥n
gr√°ficos

Insertar variables mediante la funci√≥n autom√°tica de autocompletar
Para insertar variables en los lenguajes gr√°ficos de programaci√≥n mediante la funci√≥n
autom√°tica de autocompletar, proceda del siguiente modo:
1. Seleccione un operando de la instrucci√≥n al que desee asignar una variable.
Se abre el campo de entrada del operando. Junto al campo de entrada aparece el bot√≥n de
la funci√≥n autom√°tica de autocompletar.
2. Haga clic en el bot√≥n para la funci√≥n autom√°tica de autocompletar o pulse la combinaci√≥n
de teclas <Ctrl+I>.
Se abre la funci√≥n autom√°tica de autocompletar. Seg√∫n el contexto, esta contiene solo las
variables locales y globales, los bloques de datos y las multiinstancias permitidos para el
operando. Con <Esc> se puede abandonar la funci√≥n autom√°tica de autocompletar en
cualquier momento.
3. Seleccione la variable deseada de la lista. Si lo desea, tambi√©n puede filtrar la lista:
‚Äì Introduzca p. ej. las iniciales de la variable o instrucci√≥n que desea insertar. Con cada
letra introducida se sigue filtrando la funci√≥n autom√°tica de autocompletar. Si no hay
variables o instrucciones que comiencen con las letras introducidas, la funci√≥n
autom√°tica de autocompletar se mantiene en la √∫ltima concordancia.
‚Äì Introduzca # para acceder a las variables locales de la interfaz del bloque.
‚Äì Introduzca " para acceder a las variables globales.
‚Äì Introduzca % para acceder a direcciones absolutas.
Si la variable es una variable estructurada, un bloque de datos o una multiinstancia, se
muestra una flecha al final de la fila. Haga clic en la flecha para visualizar los elementos
subordinados. De esta manera se puede navegar hasta el √∫ltimo nivel. Si para el operando
est√° permitida una estructura como tipo de datos, se puede seleccionar "Ninguna entrada"
en la lista. De ese modo se asigna al operando la estructura completa como variable. Utilice
<Retroceso> para regresar al nivel anterior.
4. Pulse la tecla <Intro> para aplicar la variable.

Consulte tambi√©n
Principios b√°sicos de la funci√≥n autom√°tica de autocompletar (P√°gina 7682)
Utilizar la funci√≥n autom√°tica de autocompletar en los lenguajes de programaci√≥n textuales
(P√°gina 7684)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7683

Editor de programaci√≥n
5.10 Utilizar la funci√≥n autom√°tica de autocompletar

5.10.3

Utilizar la funci√≥n autom√°tica de autocompletar en los lenguajes de programaci√≥n
textuales

Insertar variables e instrucciones mediante la funci√≥n autom√°tica de autocompletar
Para insertar variables e instrucciones en los lenguajes de programaci√≥n textuales mediante
la funci√≥n autom√°tica de autocompletar, proceda del siguiente modo:
1. Introduzca las iniciales de la variable o instrucci√≥n que desea insertar. Si lo desea, tambi√©n
puede filtrar por el tipo de variable:
‚Äì Introduzca # para acceder a las variables locales de la interfaz del bloque.
‚Äì Introduzca " para acceder a las variables globales.
‚Äì Introduzca % para acceder a direcciones absolutas.
Se abre la funci√≥n autom√°tica de autocompletar. Seg√∫n el contexto, esta contiene solo las
variables locales y globales, los bloques de datos, las multiinstancias y las instrucciones
permitidos en la posici√≥n actual. Con <Esc> se puede abandonar la funci√≥n autom√°tica de
autocompletar en cualquier momento.
2. Introduzca otras letras de la variable o instrucci√≥n que desea insertar. Con <Intro> o <Tab>
se aplica la variable o instrucci√≥n y se cierra la funci√≥n de autocompletar.
Con cada letra introducida se sigue filtrando la funci√≥n autom√°tica de autocompletar. Si no
hay variables ni instrucciones que comiencen con las letras introducidas, la funci√≥n de
autocompletar contiene solo los resultados coincidentes hasta entonces.
3. Seleccione la variable o instrucci√≥n deseadas de la lista.
Si una variable es una variable estructurada, un bloque de datos o una multiinstancia,
seleccione primero la variable, el bloque de datos o la multiinstancia desde la funci√≥n de
autocompletar y aplique la selecci√≥n con <Intro>. Para seleccionar los componentes
restantes de la estructura, del bloque de datos o de la multiinstancia, introduzca un punto.
A continuaci√≥n se vuelve a abrir la funci√≥n de autocompletar y se puede seleccionar el
siguiente componente.
4. Pulse la tecla <Intro> para aplicar la variable.

Consulte tambi√©n
Principios b√°sicos de la funci√≥n autom√°tica de autocompletar (P√°gina 7682)
Utilizar la funci√≥n autom√°tica de autocompletar en los lenguajes de programaci√≥n gr√°ficos
(P√°gina 7683)

7684

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.11 Configuraci√≥n general de la programaci√≥n PLC

5.11

Configuraci√≥n general de la programaci√≥n PLC

5.11.1

Sinopsis de la configuraci√≥n general

Sinopsis
La tabla siguiente muestra los ajustes generales que se pueden efectuar:
Grupo

Ajuste

Descripci√≥n

Vista

Representaci√≥n de los operandos (KOP/ Representaci√≥n de los operandos en el
FUP/AWL/GRAPH)
editor de programaci√≥n. Existen las op‚Äê
ciones siguientes:
‚óè Simb√≥lica y absoluta
‚óè Simb√≥lica
‚óè Absoluto

Compilaci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Informaci√≥n de variables
(KOP/FUP/AWL/GRAPH)

En el editor de programaci√≥n se visuali‚Äê
za informaci√≥n adicional de las varia‚Äê
bles utilizadas. Si selecciona la opci√≥n
"Informaci√≥n de la variable con comen‚Äê
tarios jer√°rquicos", en las variables es‚Äê
tructuradas se mostrar√°n tambi√©n los
comentarios de los niveles superiores
de la estructura.

Posici√≥n de la informaci√≥n de variables
(KOP/FUP)

Determina la posici√≥n en la que debe
mostrarse la informaci√≥n de las varia‚Äê
bles. La informaci√≥n de variable puede
visualizarse agrupada debajo de un seg‚Äê
mento KOP/FUP o bien directamente
en el operando correspondiente.

Con comentarios de segmento
(KOP/FUP/AWL)

Los comentarios de segmento se visua‚Äê
lizan.

Borrar par√°metros actuales al sincroni‚Äê
zar la interfaz

Los par√°metros actuales se borran si el
par√°metro formal correspondiente se
ha borrado del bloque llamado y se eje‚Äê
cuta la funci√≥n "Actualizar llamada de
bloque" o se compila el bloque.

7685

Editor de programaci√≥n
5.11 Configuraci√≥n general de la programaci√≥n PLC
Grupo

Ajuste

Ajuste predeterminado para bloques
nuevos

Comprobaci√≥n CEI para bloques l√≥gicos La compatibilidad de operandos en ope‚Äê
raciones de comparaci√≥n y aritm√©ticas
se verifica seg√∫n las normas CEI. Los
operandos no compatibles deben con‚Äê
vertirse expl√≠citamente.

Descripci√≥n

Consulte tambi√©n: Vista general de los
tipos de datos v√°lidos (P√°gina 241)
Activar "DB accesible desde OPC UA"
para bloques de datos nuevos

Si la casilla de verificaci√≥n est√° activa‚Äê
da, el atributo "DB accesible desde OPC
UA" se activar√° para bloques de datos
globales nuevos. De este modo, el blo‚Äê
que de datos es accesible como objeto
completo desde OPC UA. Seguidamen‚Äê
te, es posible habilitar o bloquear indivi‚Äê
dualmente las diferentes variables del
bloque de datos para OPC UA.

Definir como remanentes los elementos
de bloques de datos de instancia con
acceso "Est√°ndar".

Si la casilla de verificaci√≥n est√° activa‚Äê
da, el atributo "Remanente" se activar√°
en las variables nuevas. Este ajuste se
aplica a los siguientes tipos de bloques
de datos:

Consulte tambi√©n: AUTOHOTSPOT

‚óè S7-1200/S7-1500: bloques de datos
de instancia sin acceso optimizado el ajuste se aplica a todas las
variables del bloque de datos.
‚óè S7-1200/S7-1500: bloques de datos
de instancia con acceso optimizado
- el ajuste se aplica a todas las
variables que tienen el atributo
"Remanencia: ajustar en IDB".
Nota
En otros tipos de bloques de datos no es
posible definir ajustes predeterminados
para la remanencia.
‚óè S7-300/S7-400: las variables de
bloques de datos de instancia y
bloques de datos globales son
remanentes por defecto. Si se
modifican los ajustes de
remanencia, el cambio se aplica a
todas las variables del bloque.
‚óè S7-1200/S7-1500: las variables de
bloques de datos de instancia con
acceso optimizado no son
remanentes por defecto. La

7686

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.11 Configuraci√≥n general de la programaci√≥n PLC
Grupo

Ajuste

Descripci√≥n
remanencia puede activarse
individualmente para cada variable.
Consulte tambi√©n:
Ajustar remanencia (P√°gina 7855)

Configuraci√≥n avanzada

Definir el t√≠tulo del segmento autom√°ti‚Äê
camente

Define el t√≠tulo de un segmento a partir
del comentario del par√°metro de salida
de la primera instrucci√≥n de escritura en
el segmento.
Consulte tambi√©n: Insertar t√≠tulo del seg‚Äê
mento (P√°gina 7952)

Cargar sin reinicializar

Mostrar la funci√≥n autom√°tica de auto‚Äê
completar

La funci√≥n autom√°tica de autocomple‚Äê
tar se visualiza.

Nem√≥nicos

Representaci√≥n alemana o internacio‚Äê
nal de las operaciones y operandos

Reserva de memoria

Define el tama√±o de la reserva en la
memoria est√°ndar disponible para am‚Äê
pliaciones de interfaz.
Consulte tambi√©n: Cargar bloques para
S7-1200/1500 (P√°gina 8368)

Interfaz de bloque/elementos de bloque
de datos

Definir "Accesible desde HMI/OPC UA/ Activa la opci√≥n "Accesible desde HMI/
Web API" para nuevos elementos y ele‚Äê OPC UA/Web API" para nuevas varia‚Äê
mentos de bloques de datos ARRAY
bles en la interfaz del bloque y los blo‚Äê
ques de datos. Esta opci√≥n resulta es‚Äê
pecialmente √∫til al trabajar con grandes
cantidades de datos en bloques de da‚Äê
tos ARRAY.
Consulte tambi√©n: Principios b√°sicos de
la programaci√≥n de bloques de datos
(P√°gina 7839)
Definir "Escribible desde HMI/OPC UA/ Si la casilla de verificaci√≥n est√° activa‚Äê
Web API" para nuevos elementos y ele‚Äê da, el atributo "Escribible desde HMI/
mentos de bloques de datos ARRAY
OPC UA/Web API" se define para nue‚Äê
vos elementos en la interfaz del bloque
y en los bloques de datos. Esta opci√≥n
resulta especialmente √∫til al trabajar
con grandes cantidades de datos en
bloques de datos ARRAY.
Consulte tambi√©n: Principios b√°sicos de
la programaci√≥n de bloques de datos
(P√°gina 7839)

Consulte tambi√©n
Descripci√≥n de la interfaz de bloque (P√°gina 7783)
Modificar la configuraci√≥n (P√°gina 7688)
Direcciones y tipos de datos admisibles para variables PLC (P√°gina 7893)
Fundamentos del acceso a bloques (P√°gina 54)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7687

Editor de programaci√≥n
5.12 Corregir errores de sintaxis en el programa
Activar o desactivar la verificaci√≥n CEI (P√°gina 508)
Utilizar la funci√≥n autom√°tica de autocompletar (P√°gina 7682)

5.11.2

Modificar la configuraci√≥n

Procedimiento
Para modificar la configuraci√≥n, proceda del siguiente modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "Programaci√≥n PLC" en la navegaci√≥n local.
3. Modifique la configuraci√≥n.

Resultado
El cambio se aplica sin necesidad de guardarlo expl√≠citamente.

Consulte tambi√©n
Sinopsis de la configuraci√≥n general (P√°gina 7685)

5.12

Corregir errores de sintaxis en el programa

5.12.1

Principios b√°sicos de los errores de sintaxis

Error de sintaxis
Los siguientes errores se consideran errores de sintaxis:
‚óè Separadores ausentes o la utilizaci√≥n de demasiados separadores
‚óè Fallos de notaci√≥n de palabras clave
‚óè Notaci√≥n err√≥nea de las etiquetas
‚óè Falta de concordancia entre la notaci√≥n y los nem√≥nicos ajustados (p. ej. "I2.3" en lugar de
"I2.3")
‚óè Utilizaci√≥n de palabras clave como operandos

Identificaci√≥n de errores de sintaxis
Los errores de sintaxis se resaltan con subrayado rojo o con texto rojo.

7688

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.12 Corregir errores de sintaxis en el programa
Esta marca permite detectar a primera vista las entradas incorrectas, y saltar de error a error
para corregirlo. Asimismo, los errores de sintaxis se listan con el respectivo mensaje de error
en la ficha "Informaci√≥n" en la ventana de inspecci√≥n.

Consulte tambi√©n
Buscar errores de sintaxis en el programa (P√°gina 7689)

5.12.2

Buscar errores de sintaxis en el programa

Procedimiento
Para buscar errores de sintaxis en el programa de usuario, proceda del siguiente modo:
1. Seleccione la posici√≥n del programa en la que desea buscar los errores.
2. Haga clic en el bot√≥n "Ir al error siguiente" de la barra de herramientas.
Se marca el primer error desde la posici√≥n seleccionada.
Los botones "Ir al error siguiente" e "Ir al error anterior" de la barra de herramientas permiten
encontrar y corregir todos los errores del bloque.
O bien:
1. En la ventana de inspecci√≥n, elija "Informaci√≥n > Sintaxis" para abrir la lista de errores.
Todos los errores de sintaxis se listan en la tabla junto con una breve descripci√≥n del error.
2. Si aparece, haga clic en el signo de interrogaci√≥n azul situado junto al texto de error para
obtener indicaciones adicionales sobre c√≥mo solucionar el error.
3. Haga doble clic en el error que desea corregir.
Se selecciona el error en cuesti√≥n.

Consulte tambi√©n
Principios b√°sicos de los errores de sintaxis (P√°gina 7688)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7689

Editor de programaci√≥n
5.13 Cambiar el lenguaje de programaci√≥n

5.13

Cambiar el lenguaje de programaci√≥n

5.13.1

Reglas para cambiar el lenguaje de programaci√≥n

Reglas
Observe las reglas siguientes al cambiar el lenguaje de programaci√≥n de un bloque:
‚óè Todas las familias de CPU:
‚Äì S√≥lo es posible cambiar bloques completos. No es posible cambiar segmentos
individuales.
‚Äì No es posible cambiar entre bloques programados con los lenguajes de programaci√≥n
SCL o GRAPH. No obstante, en los bloques GRAPH se puede cambiar el lenguaje de
los segmentos entre KOP y FUP.
‚óè S7-300/400:
‚Äì Se puede cambiar entre los lenguajes de programaci√≥n KOP, FUP y AWL.
‚Äì Se pueden crear segmentos en un bloque con un lenguaje de programaci√≥n diferente y
copiarlos luego al bloque deseado.
‚Äì Los segmentos del bloque cuyo lenguaje de programaci√≥n no se puede cambiar se
visualizan en el lenguaje original.
‚óè S7-1200/1500:
‚Äì Se puede cambiar entre los lenguajes de programaci√≥n KOP y FUP.
‚óè S7-1500:
‚Äì Se pueden crear segmentos AWL dentro de bloques KOP y FUP. Lo que no es posible
es copiar entre AWL y KOP/FUP.

5.13.2

Cambiar el lenguaje de programaci√≥n

Procedimiento
Para cambiar el lenguaje de programaci√≥n, proceda del siguiente modo:
1. En el √°rbol del proyecto, haga clic con el bot√≥n derecho del rat√≥n en el bloque.
2. Elija el comando "Propiedades" del men√∫ contextual.
Se abre el cuadro de di√°logo con las propiedades del bloque.
3. Seleccione la entrada "General" en la navegaci√≥n local.
4. Seleccione el nuevo lenguaje de programaci√≥n de la lista desplegable "Lenguaje".
5. Confirme la selecci√≥n con "Aceptar".

7690

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Editor de programaci√≥n
5.13 Cambiar el lenguaje de programaci√≥n

Consulte tambi√©n
Reglas para cambiar el lenguaje de programaci√≥n (P√°gina 7690)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7691

Editor de programaci√≥n
5.13 Cambiar el lenguaje de programaci√≥n

7692

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.1

Principios b√°sicos de las Software Units

6.1.1

Introducci√≥n a las Software Units

6

Programaci√≥n con Software Units
Las Software Units permiten subdividir el programa de usuario en unidades de programa
individuales que se pueden editar y cargar independientemente unas de otras. Para ello, en el
√°rbol del proyecto se dispone de una nueva carpeta "Software Units" en la que podr√° crear y
programar sus propias Software Units.
La siguiente figura muestra la carpeta "Software Units" en el √°rbol del proyecto:

Cada Software Unit contiene los elementos principales siguientes:
‚óè Relaciones: la tabla de relaciones permite crear accesos desde la Software Unit a los
objetos siguientes:
‚Äì Tablas de variables PLC, tipos de datos PLC y bloques publicados de otras Software
Units para las que exista una relaci√≥n
‚Äì Bloques de datos globales que se encuentran fuera de la Software Unit
‚Äì Objetos tecnol√≥gicos
‚óè Carpeta "Bloques de programa": En esta carpeta se crean los bloques de programa
(bloques de organizaci√≥n, bloques de funci√≥n, funciones, bloques de datos).
‚óè Carpeta "Fuentes externas": en esta carpeta se importan fuentes SCL externas para
generar bloques o tipos de datos PLC a partir de ellas.
‚óè Carpeta "Variables PLC": en esta carpeta se crean las tablas de variables PLC, las
variables PLC y las constantes de usuario.
‚óè Carpeta "Tipos de datos PLC": en esta carpeta se crean los tipos de datos PLC.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7693

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units
‚óè Supervisiones y avisos de PLC: abre el editor de avisos y supervisiones
‚óè Listas de textos de aviso de PLC: abre el editor de listas de textos
La posibilidad de crear el programa de usuario dentro de Software Units es una posibilidad de
programaci√≥n adicional que no exist√≠a hasta ahora. Esto significa que se dispone de una gran
flexibilidad para elegir qu√© partes del programa se crear√°n dentro de las Software Units y
cu√°les fuera.
Nota
Tenga en cuenta las indicaciones siguientes al utilizar Software Units:
‚óè Las Software Units se pueden utilizar con todas las variantes de CPU S7-1500 con versi√≥n
de firmware V2.6 o superiores.
‚óè Por cada CPU se pueden utilizar hasta 255 Software Units.
‚óè El atributo "Acceso optimizado al bloque" est√° activado para todos los bloques de programa
de una Software Unit, y no puede desactivarse.
‚óè Si ha creado una copia de seguridad online de un dispositivo que soporte Software Units,
no podr√° utilizar esta copia de seguridad con un dispositivo que no soporte Software Units.
‚óè La informaci√≥n sobre el programa contiene informaci√≥n acerca de todos los bloques,
independientemente de si se han creado en una Software Unit o no.
‚óè Los bloques de datos y variables de Software Units tambi√©n pueden verse en un proxy de
dispositivo y, por tanto, se pueden exportar e importar. Aqu√≠ es indiferente si los bloques de
datos se han publicado o no.
‚óè Interfaz del cliente OPC UA: Los bloques de datos de configuraci√≥n que el sistema genera
a partir de interfaces de cliente OPC UA ("<nombre de la interfaz de
cliente_Configuration>") se crean siempre fuera de las Software Units. Para acceder a
ellas, se puede crear una relaci√≥n con estas interfaces de cliente. Como tipo de relaci√≥n
debe utilizarse la opci√≥n "Bloque de datos fuera de la Software Unit".

Estructura del programa
Independientemente de si desea distribuir un programa ya existente en Software Units o iniciar
un proyecto nuevo, primero debe planificar la estructura del programa. La distribuci√≥n pr√°ctica
del programa de usuario en Software Units puede regirse, por ejemplo, por los siguientes
criterios:
‚óè Unidades funcionales y tecnol√≥gicas
En Software Units se pueden formar unidades funcionales o tecnol√≥gicas que pueden
editarse y cargarse independientemente entre s√≠. Si los bloques de un programa existente
ya estaban distribuidos en grupos, quiz√°s resulte razonable crear Software Units con ellos.
‚óè Frecuencia de cambios esperada
Otra posibilidad de distribuci√≥n es la frecuencia de cambios esperada de las partes del
programa. Para que se generen unidades cargables independientemente entre s√≠, cree
Software Units propias para partes del programa con intervalos de cambio diferentes. De
ese modo es posible crear en una Software Unit bloques con funciones b√°sicas que no
requieran modificaciones frecuentes, y en otra Software Unit bloques que requieran
modificaciones frecuentes para la puesta en marcha. Esta distribuci√≥n tambi√©n puede
facilitar la b√∫squeda de errores.

7694

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units
‚óè Autores
Si distribuye el programa por autores, eso facilitar√° enormemente la coordinaci√≥n. Para
optimizar a√∫n m√°s la colaboraci√≥n entre los usuarios del proyecto, utilice Software Units en
combinaci√≥n con Multiuser Engineering.
‚óè Encapsulado m√°ximo posible de las Software Units
Para poder editar y cargar las Software Units independientemente entre s√≠ debe haber las
m√≠nimas referencias cruzadas posibles entre ellas. Por ello, utilice los elementos del
programa p√∫blicos y las relaciones solo si son realmente necesarios. Intente, de ese modo,
encapsular las distintas Software Units en el m√°ximo grado posible.
Naturalmente, tambi√©n es posible mezclar los diferentes criterios o establecer criterios propios
para la distribuci√≥n. No obstante, debe establecer el encapsulado de las Software Units como
criterio principal para obtener las m√°ximas ventajas posibles de ellas.
Consulte tambi√©n: Estructuras de programa posibles con Software Units (P√°gina 7700)

Uso de Software Units para la puesta en marcha com√∫n
La estructuraci√≥n del programa de usuario en Software Units facilita tambi√©n la puesta en
marcha del programa de usuario en un PLC por parte de varios usuarios. Tal estructuraci√≥n y
la distribuci√≥n en diferentes √°reas de responsabilidad permiten cargar en el PLC los cambios
realizados en distintas Software Units con independencia entre ellas. El TIA Portal garantiza
que los cambios no sean sobrescritos por otros usuarios. En la mayor√≠a de los casos eso
permite prescindir de la sincronizaci√≥n del programa de usuario a trav√©s del PLC, con lo que
se acelera el proceso de carga al PLC. Observe los requisitos para la carga de Software Units.
Nota
En la puesta en marcha com√∫n tenga en cuenta que solo es posible sincronizar bloques. En el
proceso de sincronizaci√≥n no se tienen en cuenta las relaciones ni las propiedades de las
Software Units.
Consulte tambi√©n: Reglas para la sincronizaci√≥n de PLC
Encontrar√° m√°s informaci√≥n en los siguientes cap√≠tulos:
‚óè Carga de Software Units (P√°gina 7720)
‚óè Introducci√≥n a Multiuser Commissioning

Accesos a datos
En las Software Units se pueden crear los siguientes elementos de programa:
‚óè Bloques (OB, FB, FC y DB)
‚óè Tablas de variables PLC y variables PLC
‚óè Tipos de datos PLC
Para poder acceder a estos elementos de programa desde fuera de la Software Unit propia es
necesario publicarlos. No obstante, esta funci√≥n no est√° disponible para bloques de
organizaci√≥n. A ellos solo puede accederse desde dentro de la Software Unit en la que est√°n
definidos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7695

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units
En las tablas de observaci√≥n y forzado permanente se puede acceder a todos los datos del
PLC, independientemente de su posici√≥n o de su estado de publicaci√≥n.
Para acceder a FB, FC, DB globales, tablas de variables PLC y tipos de datos PLC desde otras
Software Units es necesario que estos est√©n publicados y adem√°s debe existir una relaci√≥n
con la Software Unit correspondiente. Mediante relaciones tambi√©n se puede acceder a
bloques de datos globales y objetos tecnol√≥gicos existentes fuera de las Software Units.
La siguiente figura muestra los posibles accesos a datos entre programas dentro y fuera de
Software Units:

3URJUDPDHQ6RIWZDUH8QLWV

3URJUDPDIXHUDGH6RIWZDUH8QLWV

$FFHVRDEORTXHVGHGDWRV
JOREDOHV HO'%QRSXHGHFRQWHQHU
WLSRVGHGDWRV3/&
*OREDO
'%
P\)%

$FFHVRDREMHWRVWHFQRO¬µJLFRV

%ORFN
&DOO

/ODPDGDGHEORTXH
P\)%

$FFHVRDWLSRVGHGDWRV3/&
GHILQLGRVSRUHOXVXDULR
P\)&

XVHU7\SH8'7
(OHPHQW',17
(OHPHQW',17
(OHPHQW',17

$FFHVRDYDULDEOHV3/&JOREDOHV
FRQVWDQWHVPDUFDVWHPSRUL]DGR
UHV\FRQWDGRUHV
*OREDO
'%
$FFHVRGHOSURJUDPDIXHUDGH
6RIWZDUH8QLWV

5HODFL¬µQQHFHVDULD

7696

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units

Consulte tambi√©n
Creaci√≥n de programas de PLC en Software Units (P√°gina 7697)
Utilizar archivos fuente externos (P√°gina 7754)

6.1.2

Creaci√≥n de programas de PLC en Software Units
Los conceptos de programaci√≥n generales son los mismos cuando se crean programas en
Software Units. El programa de usuario se crea de la forma habitual en el editor de
programaci√≥n. Se dispone de las mismas ayudas de programaci√≥n que fuera de las Software
Units, p. ej. arrastrar y colocar instrucciones desde la Task Card "Instrucciones" y la funci√≥n de
autocompletar al introducir tipos de datos o nombres de operandos.

Particularidades de la creaci√≥n de programas en Software Units.
Cuando programe dentro de las Software Units tenga en cuenta los siguientes puntos:
‚óè El atributo "Acceso optimizado al bloque" est√° activado para todos los bloques de programa
de una Software Unit, y no puede desactivarse. Esto implica que este atributo debe estar
activado al desplazar bloques a una Software Unit desde fuera de Software Units. Por esa
raz√≥n, no utilice instrucciones cuyos par√°metros requieran un direccionamiento absoluto,
como p. ej. "PUT" o "GET".
‚óè Las partes del programa que se crean fuera de una Software Unit no tienen acceso a las
partes del programa que se crean dentro de una Software Unit. Y al rev√©s, los bloques que
se hayan programado en una Software Unit no pueden acceder a los bloques que se
encuentren fuera de las Software Units.
‚óè Sin embargo, es posible permitir a una Software Unit espec√≠fica el acceso a determinados
elementos de programa ubicados fuera de las Software Units. As√≠, p. ej., es posible acceder
a bloques de datos globales y objetos tecnol√≥gicos existentes fuera de las Software Units.
‚óè El c√≥digo que se encuentra dentro de las Software Units es parte del programa de usuario
completo. Por ello, p. ej. los nombres de los bloques deben ser un√≠vocos en toda la CPU.
‚óè En las Software Units solo es posible la programaci√≥n simb√≥lica.
‚óè En las Software Units no pueden utilizarse bloques de seguridad (bloques F).
‚óè Excepto los bloques de organizaci√≥n (OB), todos los bloques se numeran
autom√°ticamente. Los n√∫meros de bloque asignados autom√°ticamente no se muestran,
aunque se pueden ver en las propiedades del bloque.
‚óè Los tipos de par√°metros "TIMER", "COUNTER", "BLOCK_FB" y "BLOCK_FC" no est√°n
permitidos en la interfaz del bloque.
‚óè Las marcas, la funci√≥n de temporizador "Timer" y la funci√≥n de contaje "Counter" no est√°n
permitidas en la tabla de variables PLC. Utilice en su lugar temporizadores o contadores
CEI.
‚óè No pueden utilizarse marcas de sistema ni de ciclo. En Siemens Industry Online Support
tiene a su disposici√≥n funciones acabadas, que pueden utilizarse como alternativa.
Consulte tambi√©n: https://support.industry.siemens.com/cs/ww/es/view/109479728
(https://support.industry.siemens.com/cs/ww/en/view/109479728)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7697

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units
‚óè Las Software Units pueden editarse y cargarse por separado. Si debido a ello varios
usuarios modifican bloques de la misma Software Unit, al realizar la carga existe la
posibilidad de sincronizar los datos.
‚óè En caso de utilizar instrucciones que est√°n implementadas como funci√≥n o bloque de
funci√≥n en el sistema, las funciones o los bloques de funci√≥n de sistema correspondientes
se crear√°n en la carpeta "Bloques de sistema" fuera de las Software Units. Por el contrario,
la instancia individual del bloque de datos de un bloque de funci√≥n de sistema se crear√° sin
publicar en la carpeta "Bloques de sistema" de la Software Unit correspondiente. Si mueve
el bloque de datos y desea acceder a √©l, puede ser necesario cambiar el acceso a
"Publicado" y crear una relaci√≥n con el bloque de datos.
‚óè El uso de Software Units no afecta a las opciones de acceso a variables v√≠a HMI u OPC UA.
Estas se definen como hasta ahora en la interfaz del bloque en el caso de las variables
locales o en la tabla de variables PLC en el caso de las variables globales.

Lenguajes de programaci√≥n
Dentro de las Software Units pueden utilizarse los siguientes lenguajes de programaci√≥n:
‚óè KOP
‚óè FUP
‚óè SCL
‚óè GRAPH
‚óè PRODIAG
En los lenguajes de programaci√≥n KOP, FUP, SCL y GRAPH no hay diferencias respecto al
uso fuera de Software Units. Sin embargo, en la programaci√≥n con PRODIAG hay que tener
en cuenta las siguientes particularidades en el uso dentro de Software Units:
‚óè Las listas de textos definidas por el usuario que se referencian en textos espec√≠ficos de una
supervisi√≥n, pueden depositarse en cualquier Software Unit, pero no fuera de ellas.
‚óè Cada Software Unit tiene un OB ProDiag al que se le asigna un n√∫mero >=250.
‚óè Las supervisiones de variables globales de un FB ProDiag solo pueden supervisar
operandos de la misma Software Unit.
‚óè Un FB ProDiag solo contiene supervisiones de bloques que hacen referencia a par√°metros
de la misma Software Unit.
‚óè Un FB ProDiag no puede publicarse, por lo que el acceso desde otras Software Units no es
posible.
‚óè En supervisiones y llamadas globales, la adquisici√≥n de primeros valores para un FB
ProDiag solo tiene en cuenta los accesos de escritura dentro de la Software Unit en la que
se encuentre el FB ProDiag.

7698

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units

Listas de textos de aviso de PLC
Cada Software Unit contiene una entrada "Listas de textos de aviso de PLC" en el √°rbol del
proyecto. Esto significa que para cada Software Unit pueden crearse las listas de textos
correspondientes. Las listas de textos siempre est√°n publicadas, por lo que puede accederse
a ellas desde otras Software Units sin haber creado relaciones previamente. Sin embargo, no
es posible acceder a ellas desde fuera de Software Units.
En cada Software Unit se muestran √∫nicamente las listas de textos propias. Para crear o borrar
listas de textos, es preciso abrir en cada caso el editor de listas de textos de la Software Unit
o CPU correspondiente. Los nombres de las listas de textos deben ser un√≠vocos en toda la
CPU.

Supervisiones y avisos de PLC
Cada Software Unit contiene un editor general ProDiag propio, que puede abrirse con la
entrada "Supervisiones y avisos del PLC". En dicho editor se pueden agregar supervisiones
para una Software Unit. Las supervisiones que se crean en una Software Unit no se muestran
en otras Software Units. El editor general ProDiag fuera de Software Units, sin embargo,
muestra todas las supervisiones de un PLC, es decir, tambi√©n las que est√°n dentro de las
Software Units.
Las supervisiones creadas se pueden exportar a una hoja Excel y volverse a importar al TIA
Portal. Si realiza la exportaci√≥n de una Software Unit en el editor general ProDiag, solo se
exportar√°n las supervisiones de esa Software Unit concreta. Para exportar todas las
supervisiones de un PLC, inicie el proceso de exportaci√≥n en el editor general ProDiag fuera
de las Software Units. La hoja Excel tendr√° una columna adicional, en la que se indica la
Software Unit en la que se encuentra la supervisi√≥n.
Consulte tambi√©n:
‚óè Visualizaci√≥n de supervisiones ProDiag (P√°gina 8757)
‚óè Exportaci√≥n e importaci√≥n de supervisiones ProDiag y propiedades de un FB ProDiag
(P√°gina 8767)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7699

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units

Constantes de sistema
Las constantes de sistema son constantes globales un√≠vocas en toda la CPU que el sistema
necesita y crea autom√°ticamente. Las constantes de sistema sirven, p. ej., para direccionar e
identificar objetos de hardware. En funci√≥n del tipo de constante de sistema, se depositan en
diferentes tablas de variables PLC:
‚óè Algunas constantes de sistema se generan autom√°ticamente al crear un bloque de
organizaci√≥n. Dichas constantes se encuentran en la tabla de variables est√°ndar de la
Software Unit. Otras Software Units pueden acceder a estas constantes si existe una
relaci√≥n con la Software Unit y la tabla de variables est√°ndar est√° publicada.
Para garantizar la coherencia del programa online, si se modifica el valor de una constante
de sistema dentro de una Software Unit, la pr√≥xima vez que se cargue deber√°n cargarse
tambi√©n todas las Software Units dependientes.
‚óè Algunas constantes de sistema se generan autom√°ticamente al insertar un m√≥dulo o
subm√≥dulo en el proyecto. Dichas constantes se encuentran en la tabla de variables
est√°ndar, fuera de las Software Units. Todas las Software Units pueden acceder a estas
constantes.
Para garantizar la coherencia del programa online, si se modifica el valor de una constante
de sistema en la tabla de variables est√°ndar, la pr√≥xima vez que se cargue deber√° cargarse
toda la CPU.
Constantes de sistema ubicadas fuera de Software Units que no se pueden desplazar a una
Software Unit.

Comparaci√≥n de Software Units
Para las Software Units hay disponibles tanto la comparaci√≥n offline/online, como la
comparaci√≥n offline/offline. La comparaci√≥n se lleva a cabo exactamente igual que la
comparaci√≥n de PLC.
Consulte tambi√©n: Comparaci√≥n de Software Units (P√°gina 8415)

Consulte tambi√©n
Carga de Software Units en un dispositivo (P√°gina 7720)
Introducci√≥n a las Software Units (P√°gina 7693)
Estructuras de programa posibles con Software Units (P√°gina 7700)

6.1.3

Estructuras de programa posibles con Software Units
A continuaci√≥n se muestra a partir de dos ejemplos muy simplificados c√≥mo estructurar un
programa de usuario en Software Units reduciendo al m√°ximo las referencias cruzadas entre
las diferentes Software Units.
Ambos programas de ejemplo controlan una instalaci√≥n de producci√≥n compuesta por dos
estaciones. Las estaciones ejecutan diferentes etapas de procesamiento con piezas y realizan
tareas estandarizadas, como p. ej. sumar la cantidad de piezas producidas.

7700

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units

Estructura del programa: Ejemplo 1
En el primer ejemplo la unidad central "UnitMain" realiza tareas de control centralizadas.
Contiene un bloque de organizaci√≥n para la ejecuci√≥n c√≠clica del programa y un bloque de
funci√≥n "LineControl", que coordina ambas estaciones.
Ambas estaciones se representan en sendas Software Units. Las partes del programa
contenidas en ambas Software Units est√°n encapsuladas hasta el punto que pueden ser
editadas por dos programadores diferentes.
La "UnitStandard" cumple la funci√≥n de una librer√≠a que proporciona funciones generales. En
el ejemplo contiene el FB "PartCount" para contar la cantidad de piezas. Este FB es
instanciado una vez por cada estaci√≥n. En la pr√°ctica, una "Software Unit est√°ndar" de este
tipo puede contener un gran n√∫mero de partes del programa que se reutilizan y que pueden
llamarse a discreci√≥n.

8QLW0DLQ

8QLW6WDWLRQ

8QLW6WDQGDUG

3
&RQWURO
6WDWLRQ

2%
3URJUDP
&\FOH

%ORFN
&DOO

/LQH
&RQWURO

%ORFN
&DOO

,QVW
3DUW&RXQW

%ORFN
&DOO
3DUW
&RXQW

8QLW6WDWLRQ
,QVW
/LQH&RQWURO

%ORFN
&DOO

3
&RQWURO
6WDWLRQ

3

%ORFN
&DOO

,QVW
3DUW&RXQW

3

3XEOLVKHG

5HODFLRQHVQHFHVDULDV
2ULJHQGHODUHODFL¬µQ
8QLW0DLQ
8QLW6WDWLRQ
8QLW6WDWLRQ

'HVWLQRGHODUHODFL¬µQ
8QLW6WDWLRQ
8QLW6WDWLRQ
8QLW6WDQGDUG

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7701

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units

Estructura del programa: Ejemplo 2
Tambi√©n en el segundo ejemplo cada una de las unidades se encapsula en una Software Unit
propia. Sin embargo, en el segundo ejemplo cada estaci√≥n tiene un bloque de organizaci√≥n
c√≠clico propio. Si un programa contiene varios bloques de organizaci√≥n, el sistema operativo
los llama uno tras otro siguiendo el orden de sus n√∫meros de OB.
Igual que en el primer ejemplo, tambi√©n aqu√≠ existe la "UnitStandard", que se utiliza como
librer√≠a para partes del programa reutilizadas. Adem√°s del FB "PartCount", aqu√≠ recibe tambi√©n
un tipo de datos PLC (UDT) que refleja los datos de producci√≥n de una pieza. El tipo de datos
PLC puede utilizarse en la interfaz de cada uno de los bloques de programa, permitiendo as√≠
una ubicaci√≥n estandarizada de los datos de las piezas.
Para la ubicaci√≥n y el procesamiento centralizado de los datos se utiliza
"UnitGlobalMachineData". Contiene un bloque de datos global, en el que cada Software Unit
puede guardar los datos de las piezas.

7702

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.1 Principios b√°sicos de las Software Units

8QLW6WDWLRQ
%ORFN
&DOO

2%
6WDWLRQ

8QLW6WDQGDUG

&RQWURO
6WDWLRQ

%ORFN
&DOO
3DUW
&RXQW

,QVW&RQWURO
6WDWLRQ

,QVW
3DUW&RXQW

8QLW6WDWLRQ
%ORFN
&DOO

2%
6WDWLRQ

3
W\SH8'7
(OHPHQW',17
(OHPHQW',17
(OHPHQW',17
3/&'DWHQW\S

%ORFN
&DOO

&RQWURO
6WDWLRQ

8QLW*OREDO0DFKLQH'DWD
*OREDO'%

,QVW&RQWURO
6WDWLRQ

3

5HODFLRQHVQHFHVDULDV

8QLW6WDWLRQ
8QLW6WDWLRQ
8QLW*OREDO0DFKLQH'DWD

3

W\SH8'7
(OHPHQW',17
(OHPHQW',17
(OHPHQW',17

,QVW
3DUW&RXQW

2ULJHQGHODUHODFL¬µQ

3

3XEOLVKHG

'HVWLQRGHODUHODFL¬µQ
8QLW6WDQGDUG
8QLW*OREDO0DFKLQH'DWD
8QLW6WDQGDUG
8QLW*OREDO0DFKLQH'DWD
8QLW6WDQGDUG

Consulte tambi√©n
Introducci√≥n a las Software Units (P√°gina 7693)
Creaci√≥n de programas de PLC en Software Units (P√°gina 7697)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7703

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units

6.2

Creaci√≥n y administraci√≥n de Software Units

6.2.1

Creaci√≥n de Software Units

Requisitos
La carpeta "Software Units" del √°rbol del proyecto est√° abierta.

Procedimiento
Para crear una Software Unit nueva, proceda del siguiente modo:
1. Haga doble clic en la entrada "Agregar nueva Software Unit".
Se abre el cuadro de di√°logo "Agregar nueva Software Unit".
2. Introduzca un nombre para la nueva Software Unit.
3. Para introducir m√°s propiedades de la nueva Software Unit, haga clic en "Informaci√≥n
adicional".
Se abre un √°rea con campos de entrada adicionales.
4. Introduzca todas las propiedades deseadas.
5. Confirme las entradas con "Aceptar".

Resultado
Se crea la nueva Software Unit. A la Software Unit pueden agregarse elementos de programa
adicionales y crear las relaciones necesarias.

Consulte tambi√©n
Introducci√≥n a las Software Units (P√°gina 7693)
Cambiar el nombre de las Software Units (P√°gina 7704)
Copiar e insertar Software Units (P√°gina 7705)
Borrar Software Units (P√°gina 7706)
Mostrar y modificar las propiedades de una Software Unit (P√°gina 7710)

6.2.2

Cambiar el nombre de las Software Units

Requisitos
La carpeta "Software Units" del √°rbol del proyecto est√° abierta.

7704

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units

Procedimiento
Para cambiar el nombre de una Software Unit, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en la Software Unit cuyo nombre desea cambiar.
2. Elija el comando "Cambiar nombre" del men√∫ contextual.
El nombre de la Software Unit se convierte en un campo de entrada en el √°rbol del proyecto.
3. Introduzca el nuevo nombre para la Software Unit.
4. Confirme la entrada con la tecla Intro.

Resultado
El nombre de la Software Unit se cambia en todos los lugares de uso del programa.

Consulte tambi√©n
Creaci√≥n de Software Units (P√°gina 7704)
Copiar e insertar Software Units (P√°gina 7705)
Borrar Software Units (P√°gina 7706)
Mostrar y modificar las propiedades de una Software Unit (P√°gina 7710)

6.2.3

Copiar e insertar Software Units
Tambi√©n se pueden crear Software Units nuevas copiando Software Units existentes e
insertando la copia. Existen las posibilidades siguientes:
‚óè Copiar la Software Unit e insertarla en la misma CPU
‚óè Copiar la Software Unit e insertarla en otra CPU ubicada dentro del mismo proyecto
‚óè Copiar la Software Unit de un proyecto de referencia e insertarla en el proyecto abierto
‚óè Copiar la Software Unit desde una instancia del TIA Portal e insertarla en otra instancia del
TIA Portal.
Al insertar Software Units copiadas que tengan el mismo nombre que otras Software Units ya
existentes se producen conflictos que deben solucionarse del siguiente modo:
‚óè Insertar la Software Unit copiada en la misma CPU:
La copia de la Software Unit obtiene un nombre que se complementa con un n√∫mero. Por
ejemplo, si se copia la Software Unit "SoftwareUnit_1", un nombre posible de la copia ser√≠a
"SoftwareUnit_2". La numeraci√≥n no se realiza de forma correlativa, sino que se utiliza
siempre el n√∫mero libre m√°s bajo. Por tanto, el nombre de la copia de la Software Unit
"Software Unit_1" tambi√©n podr√≠a ser "SoftwareUnit_25" si no est√° disponible ning√∫n otro
n√∫mero m√°s bajo.
‚óè Insertar la Software Unit copiada en otra CPU:
Se abre un cuadro de di√°logo en el que es posible seleccionar si se desea sustituir la
Software Unit hom√≥nima o insertar la Software Unit copiada con un nombre nuevo.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7705

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units

Copiar Software Units
Para copiar una Software Unit, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en la Software Unit que desea copiar.
2. Elija el comando "Copiar" del men√∫ contextual.
El portapapeles contiene una copia de la Software Unit, que puede insertarse en la misma
CPU o en otra diferente.

Insertar Software Units
Para insertar una Software Unit, proceda del siguiente modo:
1. En el √°rbol del proyecto, abra la estructura de carpetas de la CPU en la que desea insertar
la Software Unit copiada.
2. Haga clic con el bot√≥n derecho del rat√≥n en la carpeta "Software Units".
3. Elija el comando "Pegar" del men√∫ contextual.
‚Äì Si inserta la Software Unit en la misma CPU, la copia se insertar√° con la extensi√≥n de
nombre "_<n√∫mero correlativo>".
‚Äì Si inserta la Software Unit en una CPU diferente y ya existe una Software Unit
hom√≥nima, se abrir√° el cuadro de di√°logo "Pegar". Seleccione la opci√≥n deseada y
conf√≠rmela con "Aceptar".

Consulte tambi√©n
Creaci√≥n de Software Units (P√°gina 7704)
Cambiar el nombre de las Software Units (P√°gina 7704)
Borrar Software Units (P√°gina 7706)
Mostrar y modificar las propiedades de una Software Unit (P√°gina 7710)

6.2.4

Borrar Software Units

Requisitos
La carpeta "Software Units" del √°rbol del proyecto est√° abierta.

Procedimiento
Para borrar una Software Unit, proceda del siguiente modo:
1. En la carpeta "Software Units" del √°rbol del proyecto, haga clic con el bot√≥n derecho del
rat√≥n en la Software Unit que desea borrar.
2. Elija el comando "Borrar" del men√∫ contextual.
3. Confirme la consulta de seguridad con "S√≠".
La Software Unit se borra del proyecto.

7706

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units

Consulte tambi√©n
Creaci√≥n de Software Units (P√°gina 7704)
Cambiar el nombre de las Software Units (P√°gina 7704)
Copiar e insertar Software Units (P√°gina 7705)
Mostrar y modificar las propiedades de una Software Unit (P√°gina 7710)

6.2.5

Reglas para elementos de programa en Software Units

Introducci√≥n
En las Software Units est√°n disponibles los siguientes elementos de programa:
‚óè Bloques y llamadas de bloque
‚óè Variables PLC y constantes globales
‚óè Tipos de datos PLC
B√°sicamente, estos elementos se pueden crear y utilizar igual que fuera de las Software Units.
No obstante, tenga en cuenta las particularidades descritas a continuaci√≥n.

Uso de bloques
Dentro de una Software Unit pueden utilizarse los tipos de bloque siguientes:
‚óè Bloques de organizaci√≥n (OB)
‚óè Funciones (FC)
‚óè Bloques de funci√≥n (FB)
‚óè Bloques de datos (DB)
Para programar los bloques pueden utilizarse los lenguajes de programaci√≥n KOP, FUP, SCL,
GRAPH y PRODIAG.
Los n√∫meros de los FB, FC y DB se asignan siempre de manera autom√°tica y no es posible
modificarlos. Por el contrario, los n√∫meros de bloque de los OB se pueden asignar libremente
dependiendo del rango de numeraci√≥n disponible. En una Software Unit los n√∫meros de
bloque no se muestran en el √°rbol del proyecto. Sin embargo, es posible abrir las propiedades
de un bloque para mostrar su n√∫mero.
Tenga en cuenta que todas las restricciones relativas a los bloques de organizaci√≥n
permanecen inalteradas en las Software Units. Esto significa que solo es posible utilizar el
n√∫mero m√°ximo de un tipo de bloque de organizaci√≥n, independientemente de que los bloques
de organizaci√≥n se encuentren dentro o fuera de las Software Units.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7707

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units
Si se desea acceder a un bloque de una Software Unit diferente, es necesario que en "Acceso"
est√© activada la opci√≥n "Publicado" para ese bloque. Tenga en cuenta las siguientes
particularidades:
‚óè Bloques de organizaci√≥n:
Para los bloques de organizaci√≥n no est√° disponible la propiedad "Acceso". No se puede
acceder a ellos desde una Software Unit diferente.
‚óè Bloques de funci√≥n ProDiag:
En los bloques de funci√≥n ProDiag la opci√≥n "Publicado" siempre est√° desactivada. Esto
significa que no se puede acceder a ellos desde una Software Unit diferente.

Llamar bloques
Dentro de las Software Units, las llamadas de bloque pueden usarse igual que fuera de ellas.
No obstante, tenga en cuenta las particularidades siguientes:
‚óè Dentro de una Software Unit pueden llamarse bloques independientemente de su estado
de publicaci√≥n. Eso significa que el bloque llamado no tiene que estar publicado.
‚óè En llamadas de bloque entre dos Software Units debe existir una relaci√≥n entre ellas y el
bloque llamado debe estar publicado. El bloque llamante debe obtener acceso al bloque
llamado y al bloque de datos de instancia correspondiente. El bloque de datos de instancia
tambi√©n debe tener acceso a su bloque de funci√≥n. Aseg√∫rese de que no se establecen
relaciones circulares.
‚óè Las llamadas entre bloques de Software Units y bloques fuera de ellas no son posibles.
‚óè No es posible publicar un bloque de datos de instancia si el bloque de funci√≥n
correspondiente no est√° publicado.

Uso de variables PLC y constantes globales
Dentro de las Software Units es posible trabajar con variables PLC y constantes globales de
igual modo que fuera de las Software Units. No obstante, tenga en cuenta las particularidades
siguientes:
‚óè En una Software Unit no est√° disponible la tabla de variables "Mostrar todas las variables".
‚óè La tabla de variables "Mostrar todas las variables" que est√° fuera de las Software Units
tambi√©n muestra las variables y las constantes globales de las Software Units. Aqu√≠
tambi√©n pueden editarse las variables y las constantes globales de las Software Units.
‚óè Las tablas de variables PLC se pueden publicar en Software Units para poder acceder a
ellas desde otras Software Units. Para ello es necesaria una relaci√≥n entre estas Software
Units. No est√° permitido el acceso a las variables y constantes globales de una Software
Unit desde fuera de las Software Units. Sin embargo, no se restringe el acceso v√≠a HMI y
OPC UA.
‚óè Los temporizadores y contadores S5 no est√°n permitidos como tipos de datos para
operandos.

7708

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units
‚óè No se permite el uso de marcas.
‚óè Tambi√©n es posible exportar a Software Units tablas de variables PLC para as√≠ poderlas
editar con aplicaciones externas. Del mismo modo es posible importar a Software Units
tablas de variables PLC editadas externamente. Para la importaci√≥n y exportaci√≥n se
soportan los formatos siguientes:
‚Äì XLSX (Excel)
‚Äì XML
‚Äì SDF
En el formato "XLSX" se crea una columna adicional, en la que se indica la Software Unit
desde la que se ha exportado la tabla de variables PLC. Los otros dos formatos no
contienen informaci√≥n sobre la Software Unit exportadora. Recuerde que las variables PLC
de un archivo Excel con la columna adicional para la Software Unit solo se pueden importar
a otras Software Units, pero no a tablas de variables PLC fuera de Software Units.

Uso de tipos de datos PLC
Dentro de una Software Unit tambi√©n es posible trabajar con tipos de datos PLC. Si desea
acceder a ellos desde otras Software Units, active la propiedad "Publicado" y cree una relaci√≥n
con la correspondiente Software Unit. Fuera de las Software Units no es posible utilizar este
tipo de datos PLC.

Consulte tambi√©n
Crear bloques (P√°gina 7727)
Llamadas de bloque (P√°gina 59)
Crear tipos de datos PLC (P√°gina 7929)
Declarar variables PLC (P√°gina 7899)

6.2.6

Copiar o mover elementos de programa

Principios b√°sicos sobre la copia y el movimiento de elementos de programa
Los siguientes elementos de programa pueden copiarse o moverse:
‚óè Bloques
‚óè Tabas de variables PLC y variables
‚óè Tipos de datos PLC
‚óè Listas de textos

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7709

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units
Los procesos de copia y desplazamiento posibles son los siguientes:
‚óè Copiar o mover un elemento del programa de una Software Unit a otra Software Unit
Todas las propiedades activas del elemento de programa se conservan.
‚óè Copiar o mover un elemento de programa de una Software Unit a un √°rea fuera de las
Software Units
En bloques, tablas de variables PLC y tipos de datos PLC se elimina la propiedad "Acceso".
Para bloques est√° ajustada la numeraci√≥n autom√°tica.
‚óè Copiar o mover un elemento del programa de un √°rea fuera de las Software Units a una
Software Unit
En una Software Unit solo se pueden insertar y editar bloques numerados autom√°ticamente
y que tengan activado el atributo "Acceso optimizado al bloque". Los bloques que no
cumplen los requisitos s√≠ que pueden insertarse, pero no se soportan y por ello no pueden
editarse.
En bloques, tablas de variables PLC y tipos de datos PLC soportados se agrega la
propiedad "Acceso" y la casilla de verificaci√≥n "Publicado" se desactiva.
Tenga en cuenta que al mover a otra CPU mediante la funci√≥n de arrastrar y colocar, siempre
se realiza una operaci√≥n de copia. El objeto no se borra en el origen.

Consulte tambi√©n
Reglas para elementos de programa en Software Units (P√°gina 7707)
Copiar o mover tablas de variables PLC (P√°gina 7898)
Copiar entradas de la tabla de variables PLC (P√°gina 7917)
Copiar o mover tipos de datos PLC (P√°gina 7930)
Copiar o mover bloques (P√°gina 7733)

6.2.7

Mostrar y modificar las propiedades de una Software Unit
Es posible mostrar y modificar las propiedades siguientes de las Software Units:
‚óè Nombre
‚óè Autor
‚óè Comentario

Requisitos
La carpeta "Software Units" del √°rbol del proyecto est√° abierta.

7710

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.2 Creaci√≥n y administraci√≥n de Software Units

Procedimiento
Para mostrar y modificar las propiedades de una Software Unit, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en la Software Unit cuyas propiedades desea
mostrar o editar.
2. Elija el comando "Propiedades" del men√∫ contextual.
Se abre el cuadro de di√°logo de propiedades del bloque y se muestran las propiedades.
3. Modifique la propiedad que desee, si es necesario.
4. Confirme las entradas con "Aceptar".

Consulte tambi√©n
Creaci√≥n de Software Units (P√°gina 7704)
Cambiar el nombre de las Software Units (P√°gina 7704)
Copiar e insertar Software Units (P√°gina 7705)
Borrar Software Units (P√°gina 7706)

6.2.8

Administraci√≥n de elementos de Software Units en librer√≠as

Introducci√≥n
Las Software Units pueden administrarse en librer√≠as para as√≠ poder reutilizarlas junto con los
elementos de programa que contienen. Las Software Units pueden insertarse como plantillas
maestras en la librer√≠a del proyecto o en una librer√≠a global.
Para crear plantillas maestras se dispone de las siguientes posibilidades:
‚óè Seleccionar una o varias Software Units y crear a partir de ellas plantillas maestras
independientes.
‚óè Seleccionar varias Software Units y crear a partir de ellas una √∫nica plantilla maestra que
contenga todas las Software Units seleccionadas.
Consulte tambi√©n: Agregar plantillas maestras
Los bloques y tipos de datos PLC incluidos en las Software Units se pueden insertar tambi√©n
en la librer√≠a del proyecto o en una librer√≠a global, independientemente de la Software Unit a
la que pertenezcan. No existe ninguna diferencia en el uso de bloques y tipos de datos PLC
que se hayan programado fuera de las Software Units. Por ejemplo, tambi√©n se pueden
insertar como plantillas maestras en la librer√≠a del proyecto o en librer√≠as globales para
reutilizarlos en el proyecto. Si el bloque o el tipo de datos PLC ya est√°n disponibles en el
proyecto, aparecer√° el correspondiente aviso. En este aviso puede elegir si desea mover el
objeto existente a la carpeta seleccionada o mantenerlo en la ubicaci√≥n actual.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7711

Utilizaci√≥n de las Software Units
6.3 Crear relaciones

6.3

Crear relaciones

6.3.1

Principios b√°sicos de las relaciones

Funci√≥n de las relaciones
Las Software Units le permiten subdividir el programa de usuario en unidades de programa
individuales que se pueden editar, compilar y cargar individualmente. Mediante las relaciones
se pueden crear conexiones que permiten acceder a los siguientes objetos ubicados fuera de
la Software Unit propia:
‚óè Bloques de funci√≥n (FB), funciones (FC)
‚óè Bloques de datos globales (DB)
‚óè Variables PLC
‚óè Tipos de datos PLC
‚óè Objetos tecnol√≥gicos
Al utilizar relaciones tenga en cuenta las indicaciones siguientes:
‚óè Una Software Unit no puede crear una relaci√≥n consigo misma.
‚óè Una relaci√≥n solo puede establecerse en un sentido. As√≠, una Software Unit no puede crear
una relaci√≥n con otra Software Unit si ya existe una relaci√≥n con ella.
Ejemplo: La Software Unit A tiene una relaci√≥n con la Software Unit B. La Software Unit B
no puede crear ninguna otra relaci√≥n con la Software Unit A ni acceder a los elementos de
programa de la Software Unit A.
‚óè No pueden crearse relaciones que produzcan referencias circulares.
Las relaciones pueden crearse, modificarse y borrarse en la tabla de relaciones.

Acceso a bloques de funci√≥n (FB) y funciones (FC)
Desde una Software Unit puede accederse a los bloques de funci√≥n y las funciones de otras
Software Units si est√°n publicados y existe una relaci√≥n con la Software Unit. En la Software
Unit que accede se puede crear un nuevo bloque de datos como instancia del bloque de
funci√≥n de la otra Software Unit. Como alternativa tambi√©n es posible publicar el bloque de
datos de instancia de un FB correspondiente para acceder a √©l
No es posible acceder a un bloque de funci√≥n o a una funci√≥n de una Software Unit desde un
bloque que no ha sido creado en una Software Unit. Del mismo modo, un bloque de funci√≥n o
una funci√≥n ubicados dentro de una Software Unit no pueden acceder a un bloque ubicado
fuera de una Software Unit. Fuera de una Software Unit se encuentran los bloques que se han
creado directamente en la carpeta "Bloques de programa" dentro de la CPU.
Una excepci√≥n son las funciones de sistema y los bloques de sistema: a ellos puede accederse
de la forma acostumbrada.

7712

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.3 Crear relaciones

Acceso a bloques de datos globales (DB)
Existen las siguientes posibilidades para acceder a bloques de datos globales que no se
encuentran en la propia Software Unit:
‚óè Desde una Software Unit es posible acceder a los bloques de datos globales ubicados fuera
de Software Units si se ha creado la correspondiente relaci√≥n. Para el acceso a bloques de
datos globales se aplican las siguientes reglas:
‚Äì No est√° permitido el acceso a un bloque de datos global que contenga tipos de datos
PLC.
‚Äì No est√° permitido acceder a un bloque de datos no optimizado.
‚Äì No est√° permitido acceder a bloques de datos ARRAY globales.
‚Äì No est√° permitido el acceso a un bloque de datos global de seguridad (F-DB).
‚óè A los bloques de datos globales de una Software Unit puede accederse desde otra
Software Unit si los bloques de datos est√°n publicados y existe una relaci√≥n con la Software
Unit. Sin embargo, no es posible acceder a los bloques de datos globales de una Software
Unit desde bloques que no est√°n depositados en Software Units.

Acceso a variables PLC
Desde una Software Unit puede accederse a las variables PLC de otra Software Unit si estas
est√°n incluidas en una tabla de variables PLC publicada y existe una relaci√≥n con esta
Software Unit. Sin embargo, no es posible acceder a las variables PLC de una Software Unit
desde bloques que no est√°n depositados en Software Units.

Acceso a tipos de datos PLC
Desde una Software Unit puede accederse a los tipos de datos PLC de otras Software Units
si est√°n publicados y existe una relaci√≥n con esta Software Unit. Sin embargo, no es posible
acceder a los tipos de datos PLC de una Software Unit desde bloques que no est√°n
depositados en Software Units.
Los bloques y los tipos de datos PLC que se utilicen en la interfaz del bloque en las secciones
"Input", "Output", "InOut" y "Static" deben tener el mismo estado de publicaci√≥n. As√≠, por
ejemplo, si un bloque "Motor" est√° publicado y el tipo de datos PLC "UDT1" utiliza la misma
Software Unit, este tipo de datos PLC "UDT1" tambi√©n debe estar publicado.

Acceso a objetos tecnol√≥gicos
Desde una Software Unit se puede acceder a objetos tecnol√≥gicos creando en la Software Unit
una relaci√≥n con el objeto correspondiente.

Consulte tambi√©n
Publicaci√≥n de elementos del programa (P√°gina 7714)
Crear relaciones (P√°gina 7715)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7713

Utilizaci√≥n de las Software Units
6.3 Crear relaciones

6.3.2

Publicaci√≥n de elementos del programa
Para que otras Software Units puedan acceder a los bloques de funci√≥n (FB), funciones (FC),
bloques de datos globales (DB), tablas de variables PLC y los tipos de datos PLC de una
Software Unit es necesario que estos elementos del programa est√©n publicados. Si no es lo
est√° en el momento de crear esos elementos, es posible cambiarlo en cualquier momento.
Tambi√©n es posible deshacer la publicaci√≥n de un elemento concreto. En tal caso ya no es
posible acceder desde fuera.
Para los siguientes elementos del programa no se puede modificar el estado de publicaci√≥n:
‚óè Bloques de organizaci√≥n (OB)
‚óè Bloques de funci√≥n ProDiag
Estos elementos del programa siempre est√°n sin publicar. No es posible acceder desde fuera
de la propia Software Unit.
El estado de publicaci√≥n de un elemento del programa se puede cambiar en las ubicaciones
siguientes:
‚óè En las propiedades del elemento del programa
‚óè En la vista general
‚óè En la vista del portal
En la vista detallada se puede visualizar el estado de publicaci√≥n para cada elemento del
programa.

Cambiar el estado de publicaci√≥n en las propiedades del elemento del programa
Para cambiar el estado de publicaci√≥n de un elemento del programa en sus propiedades,
proceda del siguiente modo:
1. En el √°rbol del proyecto abra la carpeta "Software Units" y despl√°cese al elemento del
programa cuyo estado de publicaci√≥n desee modificar.
2. Haga clic con el bot√≥n derecho del rat√≥n en el elemento del programa.
3. Elija el comando "Propiedades" del men√∫ contextual.
Se abre el cuadro de di√°logo de propiedades del elemento del programa.
4. En caso de que no se muestre el elemento, haga clic en el grupo "General" de la navegaci√≥n
local.
5. En "Acceso", active o desactive la casilla de verificaci√≥n "Publicado".
6. Confirme las entradas con "Aceptar".
Se modifica el estado de publicaci√≥n para el elemento del programa seleccionado.

7714

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.3 Crear relaciones

Cambiar el estado de publicaci√≥n en la vista general
Para cambiar el estado de publicaci√≥n de un elemento del programa en la vista general,
proceda del siguiente modo:
1. En el √°rbol del proyecto abra la carpeta "Software Units" y despl√°cese a la Software Unit del
elemento del programa cuyo estado de publicaci√≥n desea cambiar.
2. Seleccione la carpeta "Bloques de programa", "Variables PLC" o "Tipos de datos PLC",
dependiendo del tipo de elemento del programa.
3. Abra la vista general mediante el bot√≥n "Maximizar/minimizar vista" o mediante el men√∫
"Vista > Vista general".
4. Abra la ficha "Detalles".
En la columna "Publicado" se indica el estado de publicaci√≥n para cada elemento.
5. En la columna "Publicado", active o desactive la casilla de verificaci√≥n del elemento del
programa que desea modificar.
6. Como alternativa puede seleccionar varios elementos del programa y cambiar
simult√°neamente el estado de publicaci√≥n de todos los elementos seleccionados con el
comando "Publicaci√≥n" del men√∫ contextual.

Cambiar el estado de publicaci√≥n en la vista del portal
Para cambiar el estado de publicaci√≥n de un elemento del programa en la vista del portal,
proceda del siguiente modo:
1. Cambie a la vista del portal.
2. Haga clic en "Programaci√≥n PLC".
3. Haga clic en "Mostrar todos los objetos".
4. Abra la ficha "Detalles".
En la columna "Publicado" se indica el estado de publicaci√≥n para cada elemento.
5. En la columna "Publicado", active o desactive la casilla de verificaci√≥n del elemento del
programa que desea modificar.

Consulte tambi√©n
Principios b√°sicos de las relaciones (P√°gina 7712)
Crear relaciones (P√°gina 7715)

6.3.3

Crear relaciones
Es posible crear relaciones con otras Software Units, bloques de datos globales y objetos
tecnol√≥gicos. Tenga en cuenta que solo se puede acceder a los objetos de otra Software Unit
que tenga activada la propiedad "Publicado". Las relaciones se pueden modificar o borrar en
todo momento.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7715

Utilizaci√≥n de las Software Units
6.3 Crear relaciones

Requisitos
La carpeta "Software Units" del √°rbol del proyecto est√° abierta.

Crear relaciones
Para crear una relaci√≥n nueva, proceda del siguiente modo:
1. En el √°rbol del proyecto, abra la Software Unit para la que desea crear una relaci√≥n.
2. Haga doble clic en "Relaciones".
Se abre la tabla de relaciones.
3. Haga clic en "<Agregar nueva relaci√≥n>".
4. Seleccione el tipo de relaci√≥n en la columna "Tipo de relaci√≥n".
5. En la columna "Elemento utilizable" seleccione el elemento al que desea acceder, o
introd√∫zcalo.
Se crea la relaci√≥n y es posible acceder al elemento.

Modificar relaciones
Para modificar una relaci√≥n, proceda del siguiente modo:
1. En el √°rbol del proyecto, abra la Software Unit de la que desea modificar una relaci√≥n.
2. Haga doble clic en "Relaciones".
Se abre la tabla de relaciones.
3. En la columna "Elemento utilizable" seleccione en caso necesario el elemento al que desea
acceder.

Borrar relaciones
Para borrar una relaci√≥n, proceda del siguiente modo:
1. En el √°rbol del proyecto, abra la Software Unit de la que desea borrar una relaci√≥n.
2. Haga doble clic en "Relaciones".
Se abre la tabla de relaciones.
3. Seleccione las relaciones que desea borrar.
4. En el men√∫ contextual, elija el comando "Borrar" o pulse la tecla <Supr>.
5. Confirme la consulta de seguridad con "S√≠".
Las relaciones seleccionadas se borran.

Consulte tambi√©n
Principios b√°sicos de las relaciones (P√°gina 7712)
Publicaci√≥n de elementos del programa (P√°gina 7714)

7716

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units

6.4

Compilaci√≥n y carga de Software Units

6.4.1

Fundamentos sobre la compilaci√≥n y carga de Software Units

Introducci√≥n
Las Software Units son unidades de programa, que pueden compilarse y cargarse
independientemente del resto del c√≥digo de programa. Si existen dependencias entre las
Software Units, al compilar aparecer√° el mensaje correspondiente. Una vez completada la
compilaci√≥n, las Software Units pueden cargarse en un dispositivo o en una Memory Card. El
proceso de carga solo puede realizarse si se cumplen los requisitos siguientes:
‚óè El volumen de la carga no incluye ning√∫n elemento del programa que ya exista con el
mismo nombre o el mismo n√∫mero en otra posici√≥n en el dispositivo o en la Memory Card.
‚óè Si una Software Unit tiene relaciones con objetos situados fuera de ella y esos objetos han
cambiado desde la √∫ltima vez que se cargaron, los objetos en cuesti√≥n deben estar
contenidos en el volumen de carga. Eso afecta a bloques publicados de otras Software
Units, pero tambi√©n a bloques de datos globales, tablas de variables PLC y objetos
tecnol√≥gicos fuera de Software Units.
‚óè El volumen de la carga no incluye ning√∫n bloque de sistema que ya exista con otro n√∫mero
o versi√≥n en el dispositivo o en la Memory Card.
‚óè El volumen de la carga no incluye ning√∫n bloque de organizaci√≥n con n√∫meros que se
utilizan en el dispositivo o en la Memory Card para bloques de organizaci√≥n de otro tipo.
‚óè Si el volumen de la carga incluye un bloque de organizaci√≥n con un evento de arranque
determinado y hay otras Software Units con bloques de organizaci√≥n con el mismo evento
de arranque, estas √∫ltimas tambi√©n tendr√°n que estar incluidas en el volumen de la carga.
Eso afecta, p. ej., al OB c√≠clico y al OB de arranque.
‚óè El n√∫mero m√°ximo de bloques de organizaci√≥n de un tipo determinado no se supera en el
dispositivo o la Memory Card con el proceso de carga. Si a√∫n as√≠ desea ejecutar la carga,
cargue toda la CPU en el dispositivo o en la Memory Card. De ese modo restablecer√° la
coherencia entre el proyecto y el dispositivo o la Memory Card.
‚óè La carga de todas las Software Units a trav√©s de la carpeta "Software Units" solo es posible
si todas las Software Units que hay en el dispositivo o la Memory Card est√° tambi√©n en el
proyecto offline. De lo contrario, una Software Unit que solo existiera online se borrar√≠a.
Si a√∫n as√≠ desea ejecutar la carga, cargue toda la CPU en el dispositivo o en la Memory
Card. De ese modo restablecer√° la coherencia entre el proyecto y el dispositivo o la Memory
Card.
‚óè Todos los tipos de datos PLC existentes en el dispositivo o la Memory Card existen con la
misma versi√≥n tambi√©n en el proyecto offline.
‚óè En el dispositivo o en la Memory Card ya existe la configuraci√≥n hardware para el
dispositivo. Si no es as√≠, habr√° que cargar toda la CPU.
Si no existen dependencias con otras partes del programa, solo estar√°n en el volumen de la
carga las Software Units para las que se ha lanzado el proceso de carga. Eso significa que en

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7717

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units
el resto del programa podr√° haber diferencias entre los elementos del programa del proyecto
y del dispositivo o de la Memory Card.
Nota
Suma de verificaci√≥n con Software Units cargadas individualmente
Para comprobar la identidad o integridad de programas de PLC, al compilar una CPU se
genera una suma de verificaci√≥n en el proyecto, que tambi√©n se carga en el dispositivo o la
Memory Card. La instrucci√≥n "GetChecksum" permite leer la suma de verificaci√≥n en el
programa en tiempo de ejecuci√≥n. Si, por el contrario, carga Software Units individuales en un
dispositivo o una Memory Card, la suma de verificaci√≥n se pondr√° de nuevo a
"0x0000000000000000". Esto sucede porque la suma de verificaci√≥n del proyecto ya no
concuerda con la suma de verificaci√≥n del dispositivo. La pr√≥xima vez que cargue el programa
PLC completo obtendr√° de nuevo una suma de verificaci√≥n v√°lida. T√©ngalo en cuenta cuando
utilice "GetChecksum".

Carga de Software Units en el estado operativo "RUN"
Para cargar Software Units en el estado operativo "RUN" rigen las mismas normas que para
cargar los diferentes elementos de programa fuera de las Software Units. Observe al respecto
las descripciones de las p√°ginas "Carga de bloques en el dispositivo en el estado operativo
"RUN"" de las diferentes familias de CPU en el sistema de informaci√≥n.

Software Units en combinaci√≥n con OPC UA
Si utiliza la comunicaci√≥n OPC UA en combinaci√≥n con las Software Units, al compilar el
programa de usuario tenga en cuenta las particularidades siguientes:
‚óè Al compilar las interfaces de cliente se generan los bloques de datos relevantes para OPC
UA. Estos se guardan siempre fuera de las Software Units. Por ello, mu√©valos a las
Software Units que desee mediante la funci√≥n de arrastrar y colocar.
‚óè Al compilar las interfaces de cliente, adem√°s se generan nuevos tipos de datos PLC en la
carpeta "Tipos de datos de sistema" fuera de las Software Units. Mu√©valos tambi√©n a la
carpeta "Tipos de datos PLC" de las Software Units correspondientes.
‚óè Si cambia el nombre de listas de lectura, de escritura o de m√©todos, se generan nuevos
tipos de datos PLC. Estos tambi√©n deben moverse a las Software Units correspondientes.
‚óè Si crea nuevos nodos o cambia el nombre de nodos existentes en las listas es necesario
compilar de nuevo la interfaz de cliente correspondiente para que los nombres de los
bloques de datos y de los tipos de datos PLC se actualicen en las Software Units.

Consulte tambi√©n
Compilaci√≥n de Software Units (P√°gina 7719)
Fundamentos sobre la compilaci√≥n y carga de programas de PLC (P√°gina 8361)

7718

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units

6.4.2

Compilaci√≥n de Software Units
Para compilar Software Units dispone de las siguientes posibilidades:
‚óè Compilar los elementos de programa de un dispositivo. La compilaci√≥n incluye los
elementos de programa de las Software Units.
‚óè Compilar los elementos de programa de todas las Software Units de un dispositivo.
‚óè Compilar los elementos de programa de Software Units individuales.
‚óè Compilar los bloques de la carpeta "Bloques de programa" de una Software Unit
Dependiendo de la posibilidad que utilice, dispondr√° de diferentes opciones para el proceso de
compilaci√≥n:
‚óè Hardware y software (solo cambios)
‚óè Hardware (solo cambios)
‚óè Hardware (compilar por completo)
‚óè Software (solo cambios)
‚óè Software (compilar por completo)
‚óè Software (inicializar reserva de memoria)
Si una Software Unit accede a elementos de programa de otra Software Unit, pueden
producirse incoherencias al compilar. En tal caso, compile tambi√©n la Software Unit
dependiente.

Compilaci√≥n de los elementos de programa de un dispositivo
Para compilar los elementos de programa de un dispositivo con las Software Units incluidas,
proceda del siguiente modo:
1. Seleccione en el √°rbol del proyecto el dispositivo cuyos elementos de programa desea
compilar.
2. Seleccione la opci√≥n deseada del men√∫ contextual en el submen√∫ "Compilar".

Compilaci√≥n de los elementos de programa de todas las Software Units de un dispositivo
Para compilar los elementos de programa de todas las Software Units de un dispositivo,
proceda del siguiente modo:
1. Seleccione la carpeta "Software Units" en el √°rbol del proyecto.
2. Seleccione la opci√≥n deseada del men√∫ contextual en el submen√∫ "Compilar".

Compilaci√≥n de los elementos de programa de Software Units individuales
Para compilar los elementos de programa de Software Units individuales, proceda del
siguiente modo:
1. En la carpeta "Software Units" del √°rbol del proyecto, seleccione las Software Units cuyos
elementos de programa desea compilar.
2. Seleccione la opci√≥n deseada del men√∫ contextual en el submen√∫ "Compilar".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7719

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units

Compilar los bloques de la carpeta "Bloques de programa" de una Software Unit
Para compilar los bloques de una Software Unit, proceda del siguiente modo:
1. En la carpeta "Bloques de programa" del √°rbol del proyecto dentro de una Software Unit,
seleccione los bloques que desea compilar.
2. Seleccione la opci√≥n deseada del men√∫ contextual en el submen√∫ "Compilar".

Resultado
Los elementos de programa se compilan. En la ventana de inspecci√≥n puede verificar bajo
"Informaci√≥n > Compilar" si la compilaci√≥n se ha realizado correctamente.

Consulte tambi√©n
Fundamentos sobre la compilaci√≥n y carga de Software Units (P√°gina 7717)

6.4.3

Carga de Software Units

6.4.3.1

Carga de Software Units en un dispositivo
Es posible cargar una, varias o todas las Software Units en un dispositivo en un proceso de
carga. Para cargar todas las Software Units en un solo proceso, en el dispositivo no puede
haber ninguna Software Unit que no exista en el proyecto offline. En ese caso es posible cargar
toda la CPU o bien Software Units individuales.

Requisitos
La configuraci√≥n hardware existe en el dispositivo.

Carga de una o varias Software Units en un dispositivo
Para cargar una o varias Software Units en un dispositivo, proceda del siguiente modo:
1. Abra la carpeta "Software Units" en el √°rbol del proyecto.
2. Seleccione las Software Units que desea cargar.

7720

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units
3. Seleccione uno de los dos comandos siguientes del men√∫ contextual del submen√∫ "Cargar
en dispositivo":
‚Äì "Software (solo cambios)": Esta opci√≥n solo carga las Software Units seleccionadas. Sin
embargo, si se han realizado cambios en otras Software Units que provocan
incoherencias con las Units seleccionadas, tambi√©n habr√° que cargar esas Software
Units. En ese caso, el proceso de carga no puede llevarse a cabo y la carga debe volver
a iniciarse con la opci√≥n "Software (con Software Units relacionadas)".
‚Äì "Software (con Software Units relacionadas)": Esta opci√≥n carga las Software Units
seleccionadas junto con las Software Units con las que existen relaciones, siempre que
sean necesarias para garantizar la coherencia del programa online.
Si ya se ha definido una conexi√≥n online, los datos de proyecto se compilan en caso
necesario y se abre el cuadro de di√°logo "Cargar vista preliminar". En este cuadro de
di√°logo se visualizan avisos y se proponen las acciones necesarias para la carga. Si hasta
ahora no se ha establecido ninguna conexi√≥n online, aparece el cuadro de di√°logo "Carga
avanzada". Seguidamente, ejecute el paso 4.
4. Ajuste todos los par√°metros necesarios para la conexi√≥n y haga clic en "Cargar".
Se abre el cuadro de di√°logo "Cargar vista preliminar". En este cuadro de di√°logo se
visualizan avisos y se proponen las acciones necesarias para la carga.
5. Preste atenci√≥n a los avisos y, si es necesario, active las acciones en la columna "Acci√≥n".
En cuanto pueda efectuarse la carga se activar√° el bot√≥n "Cargar".
6. Haga clic en "Cargar".
Si es necesario realizar una sincronizaci√≥n, el sistema muestra autom√°ticamente el cuadro
de di√°logo "Sincronizaci√≥n". En √©l se muestran avisos y se proponen las acciones
necesarias para la sincronizaci√≥n. Existe la posibilidad de ejecutar estas acciones o forzar
la carga sin sincronizaci√≥n haciendo clic en "Forzar la carga en dispositivo". Si ha ejecutado
las acciones propuestas, el sistema le preguntar√° si desea continuar con la carga. Haga clic
en "Continuar carga" para que se carguen las Software Units. A continuaci√≥n se abre el
cuadro de di√°logo "Cargar resultados", que muestra el estado y las acciones despu√©s del
proceso de carga.
7. Si el proceso de carga no se ha ejecutado en el estado operativo "RUN" y los m√≥dulos se
deben rearrancar inmediatamente despu√©s de la carga, seleccione la entrada "Arrancar
m√≥dulo" en la lista desplegable "Arrancar m√≥dulos tras cargar".
8. Cierre el cuadro de di√°logo "Cargar resultados" haciendo clic en "Finalizar".

Carga de todas las Software Units en un dispositivo
Para cargar todas las Software Units en un dispositivo en un solo proceso de carga, proceda
del siguiente modo:
1. Seleccione la carpeta "Software Units" en el √°rbol del proyecto.
2. Elija el comando "Cargar en dispositivo > Software (solo cambios)" del men√∫ contextual.
Si ya se ha definido una conexi√≥n online, los datos de proyecto se compilan en caso
necesario y se abre el cuadro de di√°logo "Cargar vista preliminar". En este cuadro de
di√°logo se visualizan avisos y se proponen las acciones necesarias para la carga. Si hasta
ahora no se ha establecido ninguna conexi√≥n online, aparece el cuadro de di√°logo "Carga
avanzada". Seguidamente, ejecute el paso 3.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7721

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units
3. Ajuste todos los par√°metros necesarios para la conexi√≥n y haga clic en "Cargar".
Se abre el cuadro de di√°logo "Cargar vista preliminar". En este cuadro de di√°logo se
visualizan avisos y se proponen las acciones necesarias para la carga.
4. Preste atenci√≥n a los avisos y, si es necesario, active las acciones en la columna "Acci√≥n".
En cuanto pueda efectuarse la carga se activar√° el bot√≥n "Cargar".
5. Haga clic en "Cargar".
Si es necesario realizar una sincronizaci√≥n, el sistema muestra autom√°ticamente el cuadro
de di√°logo "Sincronizaci√≥n". En √©l se muestran avisos y se proponen las acciones
necesarias para la sincronizaci√≥n. Existe la posibilidad de ejecutar estas acciones o forzar
la carga sin sincronizaci√≥n haciendo clic en "Forzar la carga en dispositivo". Si ha ejecutado
las acciones propuestas, el sistema le preguntar√° si desea continuar con la carga. Haga clic
en "Continuar carga" para que se carguen las Software Units. A continuaci√≥n se abre el
cuadro de di√°logo "Cargar resultados", que muestra el estado y las acciones despu√©s del
proceso de carga.
6. Si el proceso de carga no se ha ejecutado en el estado operativo "RUN" y los m√≥dulos se
deben rearrancar inmediatamente despu√©s de la carga, seleccione la entrada "Arrancar
m√≥dulo" en la lista desplegable "Arrancar m√≥dulos tras cargar".
7. Cierre el cuadro de di√°logo "Cargar resultados" haciendo clic en "Finalizar".

Resultado
Las Software Units se cargan en el dispositivo. Si los cambios afectan a otros objetos, estos
tambi√©n se compilan y se cargan en el dispositivo. Los objetos que existen solo online en el
dispositivo se borran. Recuerde que al cargar Software Units individuales pueden surgir
incoherencias entre el programa de usuario del dispositivo y el programa de usuario del
proyecto offline.
Los mensajes que aparecen en la ventana de inspecci√≥n bajo "Informaci√≥n > General" indican
si la carga se ha realizado correctamente.

6.4.3.2

Carga de Software Units de un dispositivo
Puede cargar las Software Units por separado desde un dispositivo o bien junto con todos los
datos del proyecto. Para cargar las Software Units junto con los datos del proyecto desde un
dispositivo, observe la descripci√≥n de la p√°gina "Carga de datos de proyecto de un dispositivo".

Procedimiento
Para cargar Software Units de un dispositivo, proceda del siguiente modo:
1. Establezca una conexi√≥n online con el dispositivo del que desea cargar las Software Units.
Consulte tambi√©n: "Establecer o modificar conexi√≥n online"
2. Seleccione en el √°rbol del proyecto las Software Units que desea cargar desde el
dispositivo.
3. Elija el comando "Cargar de dispositivo" del men√∫ "Online".
Se abre el cuadro de di√°logo "Vista preliminar para cargar del dispositivo". En este cuadro
de di√°logo se visualizan avisos y se proponen las acciones necesarias para la carga.

7722

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units
4. Preste atenci√≥n a los avisos y, si es necesario, active las acciones en la columna "Acci√≥n".
El bot√≥n "Cargar de dispositivo" se activa tan pronto como sea posible la carga.
5. Haga clic en el bot√≥n "Cargar de dispositivo".
La carga se lleva a cabo.

Resultado
Las Software Units se cargan en el proyecto desde el dispositivo. Se pueden editar, compilarse
nuevamente y cargarse de nuevo en el dispositivo.

6.4.3.3

Carga de Software Units en una Memory Card
Existen las siguientes posibilidades para cargar Software Units junto con el resto de datos de
proyecto en una Memory Card:
‚óè Cargar los datos de proyecto en una Memory Card con la funci√≥n Drag & Drop
‚óè Escribir los datos de proyecto en una Memory Card

Requisitos
Se muestra una Memory Card.

Procedimiento
Para cargar Software Units junto con los restantes datos de proyecto en una Memory Card,
proceda del siguiente modo:
1. En el √°rbol del proyecto, arrastre los datos de proyecto que desea cargar hasta la Memory
Card. Tenga en cuenta que la carpeta "Bloques de programa" no se puede utilizar como
destino.
Los datos de proyecto se compilan en caso necesario. A continuaci√≥n se abre el cuadro de
di√°logo "Cargar vista preliminar". En este cuadro de di√°logo se visualizan avisos y se
proponen las acciones necesarias para la carga.
2. Preste atenci√≥n a los avisos y, si es necesario, active las acciones en la columna "Acci√≥n".
En cuanto pueda efectuarse la carga se activar√° el bot√≥n "Cargar".
3. Haga clic en el bot√≥n "Cargar".
4. La carga se lleva a cabo.
O bien:
1. En el √°rbol del proyecto, seleccione los datos de proyecto que desea cargar.
2. Haga clic en la selecci√≥n con el bot√≥n derecho del rat√≥n y elija el comando "Copiar" del
men√∫ contextual. Alternativamente puede usar la combinaci√≥n de teclas <Ctrl+C>.
3. Haga clic en la Memory Card con el bot√≥n derecho del rat√≥n y elija el comando "Pegar" del
men√∫ contextual. Alternativamente puede usar la combinaci√≥n de teclas <Ctrl+V>.
Los datos de proyecto se compilan en caso necesario. A continuaci√≥n se abre el cuadro de
di√°logo "Cargar vista preliminar". En este cuadro de di√°logo se visualizan avisos y se
proponen las acciones necesarias para la carga.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7723

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units
4. Preste atenci√≥n a los avisos y, si es necesario, active las acciones en la columna "Acci√≥n".
En cuanto pueda efectuarse la carga se activar√° el bot√≥n "Cargar".
5. Haga clic en el bot√≥n "Cargar".
La carga se lleva a cabo.
O bien:
1. En el √°rbol del proyecto, seleccione los datos de proyecto que desea cargar.
2. Elija el comando "Lector de tarjetas/memoria USB > Escribir en Memory Card" del men√∫
"Proyecto".
Se abre el cuadro de di√°logo "Seleccionar Memory Card".
3. Seleccione una Memory Card compatible con la CPU.
En la parte inferior del cuadro de di√°logo se activa un bot√≥n con una marca de verificaci√≥n
verde.
4. Haga clic en el bot√≥n con la marca de verificaci√≥n verde.
Los datos de proyecto se compilan en caso necesario. A continuaci√≥n se abre el cuadro de
di√°logo "Cargar vista preliminar". En este cuadro de di√°logo se visualizan avisos y se
proponen las acciones necesarias para la carga.
5. Preste atenci√≥n a los avisos y, si es necesario, active las acciones en la columna "Acci√≥n".
En cuanto pueda efectuarse la carga se activar√° el bot√≥n "Cargar".
6. Haga clic en el bot√≥n "Cargar".
La carga se lleva a cabo.

6.4.3.4

Carga de Software Units desde una Memory Card
Es posible volver a cargar en el proyecto Software Units que se encuentran en una Memory
Card junto con los datos de proyecto restantes. Para ello existen las posibilidades siguientes:
‚óè Cargar datos de proyecto de la Memory Card como estaci√≥n nueva
Esta opci√≥n permite cargar los datos de proyecto de una Memory Card en el proyecto
propio como estaci√≥n nueva.
‚óè Cargar datos de proyecto de la Memory Card en un dispositivo existente
Esta opci√≥n permite cargar los datos de proyecto de una Memory Card en un dispositivo
existente en el proyecto.

Requisitos
‚óè Hay un proyecto abierto.
‚óè Se muestra la Memory Card.

Carga como estaci√≥n nueva
Para cargar los datos de proyecto de una Memory Card en el proyecto como estaci√≥n nueva,
proceda del siguiente modo:
1. En el √°rbol del proyecto, seleccione la Memory Card cuyos datos de proyecto desea cargar.
2. En el men√∫ "Online" seleccione el comando "Carga del dispositivo como estaci√≥n nueva
(hardware y software)".

7724

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units
O bien:
1. En el √°rbol del proyecto, arrastre la carpeta de la Memory Card al proyecto.
O bien:
1. Haga clic en la Memory Card con el bot√≥n derecho del rat√≥n.
2. Elija el comando "Copiar" del men√∫ contextual.
3. Haga clic con el bot√≥n derecho del rat√≥n en el proyecto.
4. Elija el comando "Pegar" del men√∫ contextual.

Carga en un dispositivo existente
Para cargar los datos de proyecto de una Memory Card en un dispositivo existente, proceda
del siguiente modo:
1. En el √°rbol del proyecto, arrastre la carpeta de la Memory Card a un dispositivo del proyecto
o bien copie la Memory Card y pegue los datos en un dispositivo.
Se abre el cuadro de di√°logo "Vista preliminar para cargar del dispositivo".
2. Verifique los avisos en el cuadro de di√°logo "Vista preliminar para cargar del dispositivo" y,
dado el caso, active las acciones en la columna "Acci√≥n".
El bot√≥n "Cargar de dispositivo" se activa tan pronto como sea posible la carga.
3. Haga clic en el bot√≥n "Cargar de dispositivo".
La carga se lleva a cabo.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7725

Utilizaci√≥n de las Software Units
6.4 Compilaci√≥n y carga de Software Units

7726

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.1

Crear bloques

7.1.1

Carpeta de bloques

7

Funci√≥n
El √°rbol del proyecto contiene la carpeta "Bloques de programa" en la que se pueden crear y
gestionar los bloques siguientes:
‚óè Bloques de organizaci√≥n (OB)
‚óè Bloques de funci√≥n (FB)
‚óè Funciones (FC)
‚óè Bloques de datos (DB)
Adem√°s, en la carpeta "Bloques de programa" se crea una subcarpeta "Bloques de sistema"
con otra subcarpeta "Recursos de programa" al arrastrar por primera vez al programa una
instrucci√≥n que ejerce de bloque de funci√≥n en el programa. El bloque de datos de instancia del
bloque de funci√≥n interno del sistema se inserta as√≠ en la carpeta "Recursos de programa".
Estos bloques de datos de instancia de la carpeta "Recursos de programa" se pueden copiar,
renombrar y borrar. La carpeta "Recursos de programa" se borrar√° junto con la carpeta
"Bloques de sistema" si ya no contiene bloques.
Para cada dispositivo se crea autom√°ticamente un OB de ciclo y se inserta en la carpeta
"Bloques de programa".
Nota
Mover bloques desde la carpeta "Recursos de programa" o a la carpeta "Recursos de
programa"
Existe la posibilidad de mover bloques entre la carpeta "Recursos de programa" y otras
carpetas. Cuando mueva bloques desde la carpeta "Recursos de programa" o a la carpeta
"Recursos de programa" tenga en cuenta las indicaciones siguientes:
‚óè Mover bloques desde la carpeta "Recursos de programa" a cualquier otra carpeta: La
pr√≥xima vez que se compile el programa de usuario, los bloques de datos de instancia
desplazados se volver√°n a mover a la carpeta "Recursos de programa".
‚óè Mover bloques cualesquiera a la carpeta "Bloques de programa": Los bloques de la carpeta
"Recursos de programa" que no sean necesarios para la ejecuci√≥n del programa de usuario
se eliminar√°n en el pr√≥ximo proceso de compilaci√≥n. El resultado puede ser que se borre
el bloque que ha desplazado.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7727

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques

Consulte tambi√©n
Crear funciones y bloques de funci√≥n (P√°gina 7729)
Crear bloques de datos (P√°gina 7730)
Crear bloques de organizaci√≥n (P√°gina 7728)
Utilizar bloques de librer√≠as (P√°gina 7731)

7.1.2

Crear bloques de organizaci√≥n

Requisitos
La carpeta "Bloques de programa" del √°rbol del proyecto est√° abierta.

Procedimiento
Para crear un bloque de organizaci√≥n, proceda del siguiente modo:
1. Haga doble clic en el comando "Agregar nuevo bloque".
Se abre el di√°logo "Agregar nuevo bloque".
2. Haga clic en el bot√≥n "Bloque de organizaci√≥n (OB)".
3. Seleccione el tipo del nuevo bloque de organizaci√≥n.
4. Introduzca un nombre para el nuevo bloque de organizaci√≥n.
5. Introduzca las propiedades del nuevo bloque de organizaci√≥n.
6. Haga clic en "M√°s informaci√≥n" para introducir m√°s propiedades del nuevo bloque de
organizaci√≥n.
Se abre un √°rea con campos de entrada adicionales.
7. Introduzca todas las propiedades deseadas.
8. Active la casilla de verificaci√≥n "Agregar y abrir" si el bloque de organizaci√≥n debe abrirse
inmediatamente despu√©s de crearse.
9. Confirme las entradas realizadas con "Aceptar".

Resultado
Se crea el nuevo bloque de organizaci√≥n. √âste se encuentra entonces en la carpeta "Bloques
de programa" del √°rbol del proyecto. Algunos bloques de organizaci√≥n se pueden seguir
parametrizando en la ventana de inspecci√≥n o en la vista de dispositivos despu√©s de crearse.
En la descripci√≥n del bloque de organizaci√≥n se puede leer si el bloque de organizaci√≥n creado
recientemente tiene par√°metros adicionales.

Consulte tambi√©n
Bloques de organizaci√≥n (OB) (P√°gina 39)
Carpeta de bloques (P√°gina 7727)

7728

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques
Crear funciones y bloques de funci√≥n (P√°gina 7729)
Crear bloques de datos (P√°gina 7730)
Utilizar bloques de librer√≠as (P√°gina 7731)
Introducir el t√≠tulo del bloque (P√°gina 7737)
Introducir el comentario de bloque (P√°gina 7738)

7.1.3

Crear funciones y bloques de funci√≥n

Requisitos
La carpeta "Bloques de programa" del √°rbol del proyecto est√° abierta.

Procedimiento
Para crear una funci√≥n (FC) o un bloque de funci√≥n (FB), proceda del siguiente modo:
1. Haga doble clic en el comando "Agregar nuevo bloque".
Se abre el di√°logo "Agregar nuevo bloque".
2. Haga clic en el bot√≥n "Bloque de funci√≥n (FB)" o "Funci√≥n (FC)".
3. Introduzca un nombre para el nuevo bloque.
4. Introduzca las propiedades del nuevo bloque.
5. Haga clic en "M√°s informaci√≥n" para introducir m√°s propiedades del nuevo bloque.
Se abre un √°rea con campos de entrada adicionales.
6. Introduzca todas las propiedades deseadas.
7. Active la casilla de verificaci√≥n "Agregar y abrir" si el bloque debe abrirse inmediatamente
despu√©s de crearse.
8. Confirme las entradas realizadas con "Aceptar".

Resultado
Se crea el nuevo bloque. √âste se encuentra entonces en la carpeta "Bloques de programa" del
√°rbol del proyecto.

Consulte tambi√©n
Bloques de funci√≥n (FB) (P√°gina 40)
Funciones (FC) (P√°gina 39)
Fundamentos del acceso a bloques (P√°gina 54)
Carpeta de bloques (P√°gina 7727)
Crear bloques de organizaci√≥n (P√°gina 7728)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7729

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques
Crear bloques de datos (P√°gina 7730)
Utilizar bloques de librer√≠as (P√°gina 7731)
Introducir el t√≠tulo del bloque (P√°gina 7737)
Introducir el comentario de bloque (P√°gina 7738)

7.1.4

Crear bloques de datos

Requisitos
La carpeta "Bloques de programa" del √°rbol del proyecto est√° abierta.

Procedimiento
Para crear un bloque de datos, proceda del siguiente modo:
1. Haga doble clic en el comando "Agregar nuevo bloque".
Se abre el cuadro de di√°logo "Agregar nuevo bloque".
2. Haga clic en el bot√≥n "Bloque de datos (DB)".
3. Seleccione el tipo de bloque de datos. Existen las posibilidades siguientes:
‚Äì Para crear un bloque de datos global, seleccione la entrada de la lista "DB global".
‚Äì Para crear un bloque de datos ARRAY, seleccione la entrada de la lista "DB ARRAY".
‚Äì Para crear un bloque de datos instancia, seleccione de la lista el bloque de funci√≥n al
que desea asignar el bloque de datos instancia. En la lista solo aparecen bloques de
funci√≥n que se han creado con anterioridad para la CPU.
‚Äì Para crear un bloque de datos basado en un tipo de datos PLC, seleccione en la lista el
tipo de datos en cuesti√≥n. En la lista solo aparecen tipos de datos PLC que se han
creado con anterioridad para la CPU.
‚Äì Para crear un bloque de datos basado en un tipo de datos de sistema, seleccione en la
lista el tipo de datos en cuesti√≥n. En la lista solo se muestran los tipos de datos del
sistema que se han insertado con anterioridad en bloques de programa de la CPU.
4. Introduzca un nombre para el bloque de datos.
5. Introduzca las propiedades del nuevo bloque de datos.
6. Si se ha seleccionado como "tipo" un bloque de datos ARRAY, introduzca el tipo de datos
ARRAY y el l√≠mite superior de ARRAY.
El l√≠mite superior de ARRAY puede modificarse en todo momento en la ventana de
propiedades del bloque generado. El tipo de datos ARRAY no puede modificarse a
posteriori.
7. Si en "Tipo" se ha seleccionado un bloque que contiene supervisiones, asigne un bloque de
funci√≥n ProDiag a dichas supervisiones.
8. Haga clic en "M√°s informaci√≥n" para introducir m√°s propiedades del nuevo bloque de datos.
Se abre un √°rea con campos de entrada adicionales.

7730

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques
9. Introduzca todas las propiedades deseadas.
10.Active la casilla de verificaci√≥n "Agregar y abrir" si el bloque debe abrirse inmediatamente
despu√©s de crearse.
11.Confirme la entrada realizada con "Aceptar".

Resultado
Se crea el nuevo bloque de datos. Este se encuentra entonces en la carpeta "Bloques de
programa" del √°rbol del proyecto.
Nota
Remanencia de bloques de datos ARRAY
Los bloques de datos ARRAY y sus componentes no se pueden ajustar como remanentes.

Consulte tambi√©n
Principios b√°sicos de la programaci√≥n de bloques de datos (P√°gina 7839)
Bloques de datos globales (DB) (P√°gina 41)
Bloques de datos instancia (P√°gina 52)
Tipos de datos de sistema (P√°gina 360)
Utilizar bloques de librer√≠as (P√°gina 7731)

7.1.5

Utilizar bloques de librer√≠as
Los bloques se pueden depositar en la librer√≠a del proyecto o en una librer√≠a global para poder
utilizarlos varias veces en el programa de usuario. Para ello, los bloques pueden insertarse
como plantilla maestra o como tipo.
Consulte tambi√©n: Principios b√°sicos de las librer√≠as

Requisitos
‚óè Se visualiza la Task Card "Librer√≠as".
‚óè Las librer√≠as globales no est√°n protegidas contra escritura.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7731

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques

Agregar bloques como plantillas maestras a la librer√≠a del proyecto o a una librer√≠a global
Para agregar bloques nuevos como plantillas maestras a la librer√≠a del proyecto o a una librer√≠a
global, proceda del siguiente modo:
1. Maximice la librer√≠a del proyecto o la librer√≠a global.
2. Arrastre el bloque que quiere agregar a la librer√≠a mediante Drag & Drop a la carpeta
"Plantillas maestras" o a una subcarpeta cualquiera de las "Plantillas maestras" de la
librer√≠a del proyecto o de una librer√≠a global. No suelte el bot√≥n izquierdo del rat√≥n hasta que
aparezca un signo "m√°s" (+) peque√±o debajo del puntero del rat√≥n.
O bien:
1. Copie el bloque que desea agregar como plantilla maestra.
2. Maximice la librer√≠a del proyecto o la librer√≠a global.
3. Haga clic con el bot√≥n derecho del rat√≥n en la carpeta "Plantillas maestras" o en cualquier
subcarpeta de "Plantillas maestras".
4. Elija el comando "Pegar" del men√∫ contextual.

Agregar bloques como tipos a la librer√≠a del proyecto o a una librer√≠a global
Para agregar bloques nuevos como tipos a la librer√≠a del proyecto o a una librer√≠a global,
proceda del siguiente modo:
1. Maximice la librer√≠a del proyecto.
2. Arrastre mediante Drag and Drop el bloque que desea agregar como tipo hasta la carpeta
"Tipos" o a cualquier subcarpeta de "Tipos" de la librer√≠a. No suelte el bot√≥n izquierdo del
rat√≥n hasta que aparezca un signo "m√°s" (+) peque√±o debajo del puntero del rat√≥n.
3. En caso necesario, arrastre el bloque desde la carpeta "Tipos" de la librer√≠a del proyecto
hasta la carpeta "Tipos" de una librer√≠a global. Otra posibilidad consiste en copiar el bloque
en la librer√≠a del proyecto y pegarlo en una librer√≠a global.
O bien:
1. Copie el bloque que desea agregar como tipo.
2. Maximice la librer√≠a del proyecto.
3. Haga clic con el bot√≥n derecho del rat√≥n en la carpeta "Tipos" o en cualquier subcarpeta de
"Tipos".
4. Elija el comando "Pegar" del men√∫ contextual.
5. En caso necesario, arrastre el bloque desde la carpeta "Tipos" de la librer√≠a del proyecto
hasta la carpeta "Tipos" de una librer√≠a global. Otra posibilidad consiste en copiar el bloque
en la librer√≠a del proyecto y pegarlo en una librer√≠a global.

7732

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques

Utilizar bloques de la librer√≠a del proyecto o de una librer√≠a global
Para utilizar un bloque de la librer√≠a del proyecto o de una librer√≠a global en el proyecto,
proceda del siguiente modo:
1. Maximice la librer√≠a del proyecto o la librer√≠a global, de manera que se visualice el bloque
que desea utilizar.
2. Arrastre el bloque mediante Drag & Drop hasta la carpeta de bloques de la CPU. Los puntos
de inserci√≥n no permitidos se identifican por el hecho de que el puntero del rat√≥n se
transforma en un c√≠rculo tachado (se√±al de prohibici√≥n).
Nota
Al derivar una instancia de un tipo de una librer√≠a global, el tipo tambi√©n se agregar√° a la librer√≠a
del proyecto. A partir de entonces la instancia solo estar√° enlazada al tipo de la librer√≠a del
proyecto.

7.1.6

Copiar o mover bloques

7.1.6.1

Principios b√°sicos sobre la copia de bloques

Funci√≥n
Los bloques nuevos tambi√©n se pueden crear copiando bloques existentes e insertando la
copia. A este respecto, tenga en cuenta lo siguiente a la hora de copiar en las CPU de la misma
familia de dispositivos:
‚óè Los bloques de organizaci√≥n (OBs), funciones (FCs), bloques de funci√≥n (FBs) y bloques
de datos globales (DBs) pueden copiarse sin limitaci√≥n alguna.
‚óè Los bloques de datos instancia solo se pueden copiar para el mismo bloque de funci√≥n,
puesto que la asignaci√≥n al bloque de funci√≥n no se puede modificar a posteriori. No
obstante, la asignaci√≥n se deshace si el bloque de datos instancia se copia a una CPU
diferente. Sin embargo, si all√≠ existe un bloque de funci√≥n con el mismo nombre, el bloque
de datos de instancia se asignar√° a este bloque de funci√≥n. Si el bloque de datos instancia
se copia junto con el bloque de funci√≥n a la otra CPU, se asignar√° a la copia del bloque de
funci√≥n.
Las diferentes familias de dispositivos soportan en parte diferentes bloques, especialmente en
el caso de los bloques de organizaci√≥n. No obstante, tambi√©n es posible programar bloques de
funci√≥n y funciones en los diferentes dispositivos con distintos tipos de acceso. Por

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7733

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques
consiguiente, no todos los dispositivos soportan todos los bloques. Al copiar en otra familia de
dispositivos, tenga en cuenta lo siguiente
‚óè Copiar en una CPU S7-1200:
‚Äì En una S7-1200 pueden copiarse bloques de organizaci√≥n con tipo de acceso
"optimizado". Si la CPU S7-1200 soporta el tipo de OB copiado, el OB copiado conserva
las propiedades de su evento. No obstante, es necesario compilarlo de nuevo.
‚Äì En un S7-1200 pueden copiarse bloques de organizaci√≥n con tipo de acceso "est√°ndar",
pero la CPU no los soportar√°.
‚Äì En un S7-1200 pueden copiarse bloques de funci√≥n (FB), funciones (FC) y bloques de
datos globales (DB) con tipo de acceso "optimizado". A continuaci√≥n es necesario
compilarlos de nuevo.
‚Äì Bloques de datos de instancia: si en la CPU de destino ya existe un bloque de funci√≥n
con el nombre asignado al bloque de datos de instancia en la CPU de origen, el bloque
de datos de instancia se asignar√° al bloque de funci√≥n en la CPU de destino. Si el bloque
de datos de instancia se copia a la CPU de destino junto con el bloque de funci√≥n al que
fue asignado en la CPU de origen, el bloque de datos de instancia se asignar√° a la copia
del bloque de funci√≥n.
‚óè Copiar en una CPU S7-1500:
‚Äì En un S7-1500 pueden copiarse bloques de organizaci√≥n con tipo de acceso
"optimizado". Si la CPU S7-1500 soporta el tipo de OB copiado, el OB copiado conserva
las propiedades de su evento. No obstante, es necesario compilarlo de nuevo. Los tipos
de OB no soportados se marcan con el s√≠mbolo de "prohibido aparcar".
‚Äì En un S7-1500 pueden copiarse bloques de organizaci√≥n con el tipo de acceso
"est√°ndar". Si el OB procede de una CPU S7-300/400, obtiene el evento est√°ndar del
tipo de OB correspondiente. Si el OB procede de una CPU S7-1200/1500, conserva las
propiedades de su evento pero es necesario compilarlo de nuevo.
‚Äì En un S7-1500 pueden copiarse bloques de funci√≥n (FB), funciones (FC) y bloques de
datos globales (DB) con tipo de acceso "optimizado". A continuaci√≥n es necesario
compilarlos de nuevo.
‚Äì Bloques de datos de instancia: si en la CPU de destino ya existe un bloque de funci√≥n
con el nombre asignado al bloque de datos de instancia en la CPU de origen, el bloque
de datos de instancia se asignar√° al bloque de funci√≥n en la CPU de destino. Si el bloque
de datos de instancia se copia a la CPU de destino junto con el bloque de funci√≥n al que
fue asignado en la CPU de origen, el bloque de datos de instancia se asignar√° a la copia
del bloque de funci√≥n.
‚óè Copiar en CPU S7-300/400:
‚Äì Los bloques de organizaci√≥n pueden copiarse a voluntad entre S7-300 y S7-400.
‚Äì Los bloques de organizaci√≥n de las CPU S7-1200/1500 se pueden copiar en las CPU
S7-300/400, pero la CPU de destino no los soportar√°.
‚Äì Los bloques de funci√≥n (FB), las funciones (FC) y los bloques de datos globales (DB) se
pueden copiar a voluntad entre S7-300 y S7-400.
‚Äì Los bloques de funci√≥n (FB), las funciones (FC) y los bloques de datos globales (DB) de
las CPU S7-1200/1500 se pueden copiar en las CPU S7-300/400, pero la CPU de
destino no los soportar√°.

7734

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques
‚Äì Bloques de datos de instancia: si en la CPU de destino ya existe un bloque de funci√≥n
con el nombre asignado al bloque de datos de instancia en la CPU de origen, el bloque
de datos de instancia se asignar√° al bloque de funci√≥n en la CPU de destino. Si el bloque
de datos de instancia se copia a la CPU de destino junto con el bloque de funci√≥n al que
fue asignado en la CPU de origen, el bloque de datos de instancia se asignar√° a la copia
del bloque de funci√≥n.
‚Äì Los bloques de funci√≥n (FB) y las funciones (FC) que se han programado con KOP o
FUP y est√°n incluidos en segmentos SCL se pueden copiar en las CPU S7-300/400,
pero la CPU de destino no los soportar√°.
Los bloques no soportados se identifican en el √°rbol del proyecto con el s√≠mbolo de "prohibido
aparcar". Los bloques con un s√≠mbolo de "prohibido aparcar" no pueden editarse, solo
reutilizarse como fuentes para copiar.
Nota
Cuando se copian bloques entre diferentes familias de dispositivos, existe la posibilidad de que
el bloque copiado deba compilarse de nuevo. Esto tambi√©n afecta a la copia de bloques entre
CPU y controladores por software. Si el bloque tiene una protecci√≥n de know-how, solo se
puede volver a compilar introduciendo la contrase√±a correcta.

Datos copiados
Al insertar se copian todos los datos del bloque y se transmiten a la copia. Algunos de estos
datos son:
‚óè Variables de la interfaz del bloque
‚óè Todos los segmentos
‚óè Comentarios en todas las traducciones existentes
‚óè Avisos definidos en el bloque
‚óè El c√≥digo del programa completo del bloque copiado, incluyendo las instrucciones de
llamada que contiene.
Sin embargo, no se copian los siguientes objetos:
‚Äì bloques llamados ni bloques de datos instancia asociados
‚Äì variables globales referenciadas en el bloque copiado
‚Äì los tipos de datos PLC utilizados en el bloque copiado para la declaraci√≥n de los
par√°metros de bloque y las variables locales
‚Äì los objetos tecnol√≥gicos utilizados en el bloque copiado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7735

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques

Evitar conflictos de nombre al insertar
Al insertar un bloque copiado cuyo nombre sea id√©ntico al de un bloque existente, se aplican
los siguientes mecanismos para evitar conflictos de nombre:
‚óè Inserci√≥n del bloque copiado en la misma CPU:
La copia del bloque obtiene un nombre que se complementa con un n√∫mero. Por ejemplo,
si se copia el bloque "A", un nombre posible de la copia ser√≠a "A_1". La numeraci√≥n no se
realiza de forma correlativa, sino que se utiliza siempre el n√∫mero libre m√°s bajo. Por tanto,
el nombre de la copia del bloque "A" tambi√©n podr√≠a ser "A_25" si no est√° disponible ning√∫n
otro n√∫mero m√°s bajo.
‚óè Inserci√≥n del bloque copiado en una CPU diferente:
Se abre un di√°logo en el que es posible seleccionar si se desea sustituir el bloque
hom√≥nimo o insertar el bloque copiado con una identificaci√≥n de duplicado
(nombre_n√∫mero).
Nota
Conflictos de n√∫meros
No obstante, pueden ocurrir conflictos de nombre si el bloque insertado tiene el mismo n√∫mero
que un bloque existente. El n√∫mero de bloque no se modifica autom√°ticamente al realizar la
inserci√≥n. Esto puede afectar p. ej. a las llamadas de bloques. Por tanto, al copiar bloques,
compruebe con cuidado los n√∫meros de bloque y, en caso necesario, corrija manualmente los
n√∫meros repetidos a trav√©s de las propiedades del bloque. Los n√∫meros de bloque repetidos
provocan un error de compilaci√≥n.

Consulte tambi√©n
Copiar o mover bloques (P√°gina 7736)
Copiar o mover elementos de programa (P√°gina 7709)

7.1.6.2

Copiar o mover bloques

Requisitos
La carpeta "Bloques de programa" del √°rbol del proyecto est√° abierta.

Copiar bloques
Para copiar un bloque, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en el bloque que desea copiar.
2. Elija el comando "Copiar" del men√∫ contextual.

7736

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques
3. En el √°rbol del proyecto, haga clic con el bot√≥n derecho del rat√≥n en la carpeta de bloques
de programa en la que desea insertar el bloque copiado.
4. Elija el comando "Pegar" del men√∫ contextual.
‚Äì Si inserta el bloque en la misma CPU, la copia se insertar√° con la extensi√≥n "_<n√∫mero
correlativo>".
‚Äì Si inserta el bloque en una CPU diferente y ya existe un bloque con el mismo nombre,
se abrir√° el cuadro de di√°logo "Pegar". Seleccione la opci√≥n deseada y conf√≠rmela con
"Aceptar".
Tambi√©n es posible copiar el bloque mediante la funci√≥n Drag & Drop con la tecla <Ctrl>
pulsada.

Mover bloques
Para mover un bloque, proceda del siguiente modo:
1. Seleccione el bloque que desea mover.
2. Arrastre el bloque hasta la posici√≥n nueva mediante la funci√≥n Drag & Drop.

Consulte tambi√©n
Principios b√°sicos sobre la copia de bloques (P√°gina 7733)

7.1.7

Introducir el t√≠tulo del bloque
El t√≠tulo del bloque es la cabecera del bloque. No es id√©ntico al nombre de bloque que se asign√≥
al crear el bloque. La longitud del t√≠tulo del bloque est√° limitada a una l√≠nea. Es posible
introducir t√≠tulos de bloque para los bloques tanto abiertos como cerrados.

Requisitos
Existe un bloque l√≥gico.

Introducir el t√≠tulo de un bloque abierto
Para introducir el t√≠tulo de un bloque abierto, proceda del siguiente modo:
1. En el editor de programaci√≥n, haga clic en en la barra de t√≠tulo del bloque.
2. Introduzca el t√≠tulo del bloque.

Introducir el t√≠tulo de un bloque cerrado
Para introducir el t√≠tulo de un bloque cerrado, proceda del siguiente modo:
1. En el √°rbol del proyecto, haga clic con el bot√≥n derecho del rat√≥n en el bloque.
2. Elija el comando "Propiedades" del men√∫ contextual.
Se abre el cuadro de di√°logo con las propiedades del bloque.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7737

Creaci√≥n y gesti√≥n de bloques
7.1 Crear bloques
3. Seleccione la entrada "Informaci√≥n" en la navegaci√≥n local.
4. Introduzca el t√≠tulo del bloque en el campo de entrada "T√≠tulo".
5. Confirme las entradas realizadas con "Aceptar".

Consulte tambi√©n
Crear bloques de organizaci√≥n (P√°gina 7728)
Crear funciones y bloques de funci√≥n (P√°gina 7729)
Introducir el comentario de bloque (P√°gina 7738)

7.1.8

Introducir el comentario de bloque
El comentario de bloque permite documentar todo el bloque l√≥gico. Por ejemplo, se puede
describir la finalidad del bloque, o bien llamar la atenci√≥n sobre peculiaridades. Es posible
introducir comentarios de bloque para los bloques tanto abiertos como cerrados.
Nota
El comentario del bloque no deber√≠a tener m√°s de 32.767 caracteres Unicode.

Requisitos
Existe un bloque l√≥gico.

Introducir el comentario de un bloque abierto
Para introducir el comentario de un bloque abierto, proceda del siguiente modo:
1. Haga clic en la flecha peque√±a antepuesta al t√≠tulo del bloque.
La flecha hacia la derecha se convierte en una flecha hacia abajo y aparece el √°rea de
comentario.
2. En el √°rea de comentario, haga clic en "Comentario".
El texto "Comentario" aparece seleccionado.
3. Introduzca el comentario de bloque.

Introducir el comentario de un bloque cerrado
Para introducir el comentario de un bloque cerrado, proceda del siguiente modo:
1. En el √°rbol del proyecto, haga clic con el bot√≥n derecho del rat√≥n en el bloque.
2. Elija el comando "Propiedades" del men√∫ contextual.
Se abre el cuadro de di√°logo con las propiedades del bloque.
3. Seleccione la entrada "Informaci√≥n" en la navegaci√≥n local.

7738

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques
4. Introduzca el comentario de bloque en el campo de entrada "Comentario".
5. Confirme las entradas realizadas con "Aceptar".

Consulte tambi√©n
Crear bloques de organizaci√≥n (P√°gina 7728)
Crear funciones y bloques de funci√≥n (P√°gina 7729)
Introducir el t√≠tulo del bloque (P√°gina 7737)

7.2

Definir propiedades de bloques

7.2.1

Principios b√°sicos de las propiedades de bloques

Propiedades de bloques
Todo bloque tiene determinadas propiedades que se pueden visualizar y editar. Estas
propiedades tienen, por ejemplo, las siguientes tareas:
‚óè Identificar el bloque
‚óè Visualizar la memoria necesaria y el estado de compilaci√≥n del bloque
‚óè Visualizar el sello de tiempo
‚óè Visualizar la informaci√≥n de referencia
‚óè Ajustar la protecci√≥n de acceso

Consulte tambi√©n
Sinopsis de las propiedades de bloques (P√°gina 7740)
Sellos de tiempo de bloques (P√°gina 7745)
Mostrar y editar propiedades de bloques (P√°gina 7747)
Ajustar los nem√≥nicos (P√°gina 7668)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7739

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques

7.2.2

Sinopsis de las propiedades de bloques

Sinopsis
Las propiedades de los bloques son espec√≠ficos del bloque y la CPU. Por eso, no todas las
propiedades est√°n disponibles para todos los bloques y en todas las familias de CPU. La
siguiente tabla muestra una vista general de las propiedades del bloque:
Grupo

Propiedad

Descripci√≥n

Propiedades

Nombre

Nombre un√≠voco del bloque en la estaci√≥n.

Nombre de la constante

Nombre de la constante que se inserta para el OB en
la tabla de variables PLC

Tipo

Tipo de bloque (no se puede modificar)

N√∫mero

N√∫mero de bloque

Clase de evento

Clase de evento de un OB (no modificable)

Lenguaje

Lenguaje de programaci√≥n del bloque

Lenguaje en segmentos

Es el lenguaje que se utiliza para programar las con‚Äê
diciones en los bloques GRAPH.

Versi√≥n

Versi√≥n del bloque GRAPH

N√∫mero de la memoria
Indicaci√≥n de las memorias imagen parciales de pro‚Äê
imagen parcial del proceso ceso asignadas al bloque de organizaci√≥n (no modi‚Äê
ficable)
Tipo de datos ARRAY

Tipo de datos de un bloque de datos ARRAY (no mo‚Äê
dificable)

L√≠mite de ARRAY

L√≠mite superior de un bloque de datos ARRAY
La secci√≥n "Transferencia" de la Task Card "Instruc‚Äê
ciones" permite direccionar bloques de datos ARRAY.

Informaci√≥n

Sello de tiempo

7740

T√≠tulo

T√≠tulo del bloque

Comentario

Comentario del bloque

Versi√≥n

N√∫mero de versi√≥n del bloque

Familia

Nombre de la familia de bloques

Autor

Nombre del autor, empresa, departamento u otro
nombre

ID personalizada

ID creada por el usuario

Bloque

Fecha y hora de creaci√≥n y modificaci√≥n del bloque
(no modificable)

Interfaz

Fecha de modificaci√≥n de la interfaz del bloque (no
modificable)

C√≥digo

Fecha de modificaci√≥n del c√≥digo (no modificable)

Datos

Fecha de modificaci√≥n de los datos (no modificable)

Relevante para la carga

Hora del √∫ltimo cambio relevante para la carga (no
modificable)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques
Grupo

Propiedad

Descripci√≥n

Compilaci√≥n

Estado

Detalles de la √∫ltima compilaci√≥n (no modificable)

Longitudes

Detalles de las longitudes de bloque (no modificable)

Simulaci√≥n

Indica si el bloque puede simularse con SIMATIC S7PLCSIM Advanced. Para ello es imprescindible que
la opci√≥n "Permitir la simulaci√≥n al compilar bloques"
est√© activada en las propiedades del proyecto.
Consulte tambi√©n: Visualizar las propiedades del pro‚Äê
yecto

Protecci√≥n

Idoneidad para la librer√≠a

Indica si el bloque puede agregarse como tipo a una
librer√≠a.

Protecci√≥n

Ajustar protecci√≥n de know-how y contra copia del
bloque
Consulte tambi√©n: Proteger bloques (P√°gina 7763)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7741

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques
Grupo

Propiedad

Descripci√≥n

Atributos

Verificaci√≥n CEI

La compatibilidad de operandos en operaciones de
comparaci√≥n y aritm√©ticas se verifica seg√∫n CEI
61131. Los operandos no compatibles deben conver‚Äê
tirse expl√≠citamente.
Consulte tambi√©n: Sinopsis de la conversi√≥n de tipos
de datos (P√°gina 506)

Tratamiento de errores lo‚Äê
cales en el bloque

Tratamiento de errores en el bloque con las instruc‚Äê
ciones GET_ERROR y/o GET_ERR_ID (no modifica‚Äê
ble).
Consulte tambi√©n: Tratamiento de errores de ejecu‚Äê
ci√≥n del programa (P√°gina 145)

Acceso optimizado al blo‚Äê
que

En bloques de acceso optimizado, la declaraci√≥n de
variables solo contiene los nombres simb√≥licos de los
elementos de datos. Las direcciones son optimizadas
y gestionadas autom√°ticamente por el sistema. El
rendimiento de la CPU aumenta y no se producen
errores de acceso, p. ej. desde SIMATIC HMI.
Consulte tambi√©n: Bloques con acceso optimizado
(P√°gina 54)

7742

Apto para multiinstancia

El bloque se puede llamar con la opci√≥n de llamada
"Multiinstancia". Este atributo no se puede modificar.

Crear informaci√≥n avanza‚Äê
da de estado

Permite observar todas las variables de un bloque
SCL. Sin embargo, la cantidad de memoria que re‚Äê
quiere el programa y los tiempos de ejecuci√≥n au‚Äê
mentan con esta opci√≥n.

Comprobar l√≠mites de
ARRAY

Comprueba durante el tiempo de ejecuci√≥n de un blo‚Äê
que SCL si hay √≠ndices de campo en el √°rea declara‚Äê
da para un ARRAY. Si un √≠ndice de campo est√° fuera
del rango permitido, la salida de habilitaci√≥n ENO del
bloque se pone a "0".

Activar ENO autom√°tica‚Äê
mente/Activar ENO auto‚Äê
m√°ticamente para bloques
SCL y segmentos SCL

Comprueba durante el tiempo de ejecuci√≥n de un blo‚Äê
que SCL si se producen errores en el procesamiento
de determinadas instrucciones. Si se produce un
error en el tiempo de ejecuci√≥n, la salida de habilita‚Äê
ci√≥n ENO del bloque se pone a "0".

Generar DB minimizado

Genera bloques de datos de instancia en formato mi‚Äê
nimizado para bloques GRAPH de las S7-300 y
S7-400. Esta opci√≥n reduce considerablemente la
cantidad de memoria que requiere el FB GRAPH. Por
otro lado, solo se obtiene informaci√≥n limitada sobre
el estado del programa.

Saltar etapas

Si las transiciones en un bloque GRAPH se vuelven
v√°lidas al mismo tiempo antes y despu√©s de una eta‚Äê
pa, esta no se activa y por consiguiente se salta.

Acuse obligatorio de erro‚Äê
res de supervisi√≥n

Si se produce un error de supervisi√≥n durante el fun‚Äê
cionamiento de un bloque GRAPH, dicho error se de‚Äê
be acusar antes de que se siga ejecutando el progra‚Äê
ma.

Procesamiento permanen‚Äê
te de todos los interlocks
en modo manual

Hace que las condiciones de interlock de un bloque
GRAPH se comprueben permanentemente en modo
manual.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques
Grupo

Propiedad

Descripci√≥n

Adquisici√≥n de primeros
valores
(solo puede activarse a
partir de la versi√≥n del blo‚Äê
que V4.0)

El estado l√≥gico de operandos y el resultado de com‚Äê
paradores de una etapa o una transici√≥n se guardan
en los par√°metros est√°ticos "CRIT_LOC",
"CRIT_LOC_ERR", "CRIT" y "CRIT_FLT" de la inter‚Äê
faz de bloque GRAPH.

Bloqueo de selecci√≥n de
modo

Impide la selecci√≥n de un modo de operaci√≥n de un
bloque GRAPH.

Nombre del bloque de am‚Äê Define el bloque de ampliaci√≥n que permite acceder a
pliaci√≥n
los par√°metros no visibles en la interfaz del bloque de
funci√≥n GRAPH.
Bloque de datos protegido
contra escritura en el dis‚Äê
positivo

Indica si el bloque de datos est√° protegido contra es‚Äê
critura en el sistema de destino, por lo que no se pue‚Äê
de sobrescribir durante la ejecuci√≥n del programa. La
opci√≥n solo est√° disponible para bloques de datos.

Depositar solo en la memo‚Äê Si se activa, el bloque de datos se depositar√° solo en
ria de carga
la memoria de carga, no ocupar√° espacio en la me‚Äê
moria de trabajo y no se incorporar√° en el programa.
La paleta "Instrucciones avanzadas > Funciones de
bloques de datos" de la Task Card "Instrucciones"
ofrece posibilidades de manejar los bloques de datos.
La opci√≥n solo est√° disponible para bloques de datos.
Bloque de datos accesible
desde OPC UA

Si la casilla de verificaci√≥n est√° activada, el bloque de
datos es accesible como objeto completo desde OPC
UA. Seguidamente, es posible habilitar o bloquear in‚Äê
dividualmente las diferentes variables del bloque de
datos para OPC UA.
La opci√≥n solo est√° disponible para bloques de datos
de S7-1200/S7-1500.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Bloque de datos accesible
a trav√©s del servidor web

Si la casilla de verificaci√≥n est√° activada, el bloque de
datos es accesible como objeto completo a trav√©s de
un servidor web. A continuaci√≥n es posible habilitar o
bloquear individualmente las diferentes variables del
bloque de datos. Esta opci√≥n solo est√° disponible pa‚Äê
ra bloques de datos.

Informaci√≥n de arranque

En las CPU S7-1500, aqu√≠ se define la estructura de
la informaci√≥n de arranque del bloque de organiza‚Äê
ci√≥n: como en las CPU S7-300 y S7-400 o bien infor‚Äê
maci√≥n de arranque optimizada.

Prioridad

En los bloques de organizaci√≥n muestra la prioridad
ajustada. El que pueda cambiarse la prioridad depen‚Äê
der√° de la familia de CPU utilizada y del tipo de bloque
de organizaci√≥n.

Alimentaci√≥n de par√°me‚Äê
tros a trav√©s de registros

En un bloque AWL de una CPU S7-1500, permite
alimentar par√°metros a trav√©s de registros. Ello per‚Äê
mite utilizar las instrucciones "Llamada condicional"
(CC) y "Llamada incondicional" (UC) en el bloque.

Activar relectura

Permite marcar diferentes par√°metros del bloque co‚Äê
mo "relegibles". La funci√≥n "Releer variables" es re‚Äê
levante cuando el bloque se utiliza en un esquema
CFC.

7743

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques
Grupo

Propiedad

Descripci√≥n

Representaci√≥n del bloque Determina c√≥mo se representar√° el bloque en un es‚Äê
quema CFC.
Encontrar√° m√°s informaci√≥n al respecto en la ayuda
de CFC, en la p√°gina "Variantes de representaci√≥n
del s√≠mbolo de bloque en el esquema CFC".
Alarma horaria

Alarma horaria

Par√°metros del OB de alarma horaria: Activo (s√≠ o
no), ejecuci√≥n, fecha y hora de inicio, hora local o de
sistema

Alarma c√≠clica

Alarma c√≠clica

Tiempo de ciclo y desfase del OB de alarma c√≠clica

Eventos de inicio

Eventos de inicio

Indicaci√≥n de los eventos de inicio del OB de alarma
de proceso

Modo is√≥crono

Modo is√≥crono

Par√°metros del OB de alarma de sincronismo: Ciclo
de aplicaci√≥n, ajuste autom√°tico (s√≠ o no), tiempo de
retardo.
Adem√°s se indica el sistema PROFINET IO o el sis‚Äê
tema maestro DP cuyos dispositivos IO o esclavos
DP, respectivamente, est√°n asignados al OB de alar‚Äê
ma de sincronismo.

Cargar sin reini‚Äê
cializar

Reserva de memoria

Tama√±o de la reserva en la memoria est√°ndar dispo‚Äê
nible para ampliaciones de interfaz.
El n√∫mero de bytes disponibles actualmente se indica
entre par√©ntesis. Esta indicaci√≥n se actualiza en cada
proceso de compilaci√≥n.

Activar la carga sin reinicia‚Äê Permite definir una reserva en la memoria remanente.
lizar para variables rema‚Äê
nentes
Reserva en la memoria re‚Äê Tama√±o de la reserva en la memoria remanente dis‚Äê
manente
ponible para ampliaciones de interfaz.
El n√∫mero de bytes disponibles actualmente se indica
entre par√©ntesis. Esta indicaci√≥n se actualiza en cada
proceso de compilaci√≥n.

Consulte tambi√©n
Principios b√°sicos de las propiedades de bloques (P√°gina 7739)
Sellos de tiempo de bloques (P√°gina 7745)
Mostrar y editar propiedades de bloques (P√°gina 7747)
Fundamentos del acceso a bloques (P√°gina 54)
Configuraci√≥n general de la programaci√≥n PLC (P√°gina 7685)

7744

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques

7.2.3

Sellos de tiempo de bloques

Introducci√≥n
A los bloques se les asignan diferentes sellos de tiempo, que permiten saber cu√°ndo se ha
creado el bloque y cu√°ndo se ha modificado por √∫ltima vez. Estos sellos de tiempo tambi√©n se
utilizan para comprobar la coherencia de forma autom√°tica antes de un proceso de
compilaci√≥n.

Sellos de tiempo para bloques l√≥gicos
Para los bloques l√≥gicos (OBs, FBs, FCs) se generan los siguientes sellos de tiempo:
‚óè Bloque: Fecha de creaci√≥n, fecha de la √∫ltima modificaci√≥n
‚óè Interfaz: Fecha de la √∫ltima modificaci√≥n
‚óè C√≥digo/datos: Fecha de la √∫ltima modificaci√≥n
‚óè Relevante para la carga: Fecha de la √∫ltima modificaci√≥n
Al compilar se indica un conflicto de sello de tiempo cuando el sello de tiempo del bloque que
llama es m√°s antiguo que el de la interfaz del bloque llamado.
Los sellos de tiempo de los bloques l√≥gicos se actualizan del siguiente modo:
‚óè Bloque: El sello de tiempo de la √∫ltima modificaci√≥n del bloque corresponde siempre al sello
de tiempo de la interfaz o del c√≥digo, dependiendo de qu√© √°rea fue modificada por √∫ltima
vez.
‚óè Interfaz: El sello de tiempo de la interfaz se actualiza cada vez que √©sta se modifica. Aunque
se deshaga manualmente la modificaci√≥n de la interfaz, p. ej. se vuelva a cambiar el
nombre, la modificaci√≥n actualiza el sello de tiempo. Pero si se deshace la modificaci√≥n
mediante la funci√≥n "Deshacer", el sello de tiempo se restablece al valor anterior a la
modificaci√≥n deshecha.
‚óè C√≥digo/datos: El sello de tiempo del c√≥digo se actualiza cada vez que se modifica el c√≥digo
del bloque. Aunque se deshaga manualmente la modificaci√≥n del c√≥digo, p. ej. se vuelva a
quitar una instrucci√≥n, la modificaci√≥n actualiza el sello de tiempo. Pero si se deshace la
modificaci√≥n mediante la funci√≥n "Deshacer", el sello de tiempo se restablece al valor
anterior a la modificaci√≥n deshecha.
‚óè Relevante para la carga: El sello de tiempo de "Relevante para la carga" se modifica cada
vez que se modifica un bloque l√≥gico. Estos cambios pueden afectar al c√≥digo, a los datos
o a la interfaz.

Sellos de tiempo para bloques de datos globales
Para los bloques de datos globales se generan los siguientes sellos de tiempo:
‚óè Bloque: Fecha de creaci√≥n, fecha de la √∫ltima modificaci√≥n
‚óè Interfaz: Fecha de la √∫ltima modificaci√≥n
‚óè Datos: Fecha de la √∫ltima modificaci√≥n
‚óè Relevante para la carga: Fecha de la √∫ltima modificaci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7745

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques
Al compilar un bloque de datos global basado en un tipo de datos PLC se indica un conflicto de
sello de tiempo cuando el sello de tiempo del bloque de datos global es m√°s antiguo que el del
tipo de datos PLC utilizado.
Los sellos de tiempo de los bloques de datos globales se actualizan del siguiente modo:
‚óè Bloque: El sello de tiempo de la √∫ltima modificaci√≥n de un bloque de datos global
corresponde siempre al sello de tiempo de la interfaz y los datos.
‚óè Interfaz y datos: Los sellos de tiempo de la interfaz y los datos se actualizan cada vez que
se modifica el bloque de datos global. Aunque se deshaga manualmente la modificaci√≥n,
p. ej. se vuelva a quitar una variable, la modificaci√≥n actualiza los sellos de tiempo. Pero si
se deshace la modificaci√≥n mediante la funci√≥n "Deshacer", los sellos de tiempo se
restablecen al valor anterior a la modificaci√≥n deshecha.
‚óè Relevante para la carga: El sello de tiempo de "Relevante para la carga" se modifica cada
vez que se modifica el bloque de datos global. Estos cambios pueden afectar a los datos o
a la interfaz.

Sellos de tiempo para bloques de datos de instancia
Para los bloques de datos de instancia se generan los siguientes sellos de tiempo:
‚óè Bloque: Fecha de creaci√≥n, fecha de la √∫ltima modificaci√≥n
‚óè Interfaz: Fecha de la √∫ltima modificaci√≥n
‚óè Datos: Fecha de la √∫ltima modificaci√≥n
‚óè Relevante para la carga: Fecha de la √∫ltima modificaci√≥n
Al compilar un bloque de datos de instancia se indica un conflicto del sello de tiempo cuando
el sello de tiempo de las interfaces del bloque de datos de instancia y del bloque de funci√≥n no
son id√©nticos.
Los sellos de tiempo de los bloques de datos de instancia se actualizan del siguiente modo:
‚óè Bloque: El sello de tiempo de la √∫ltima modificaci√≥n de un bloque de datos de instancia
corresponde siempre al sello de tiempo de la interfaz y los datos.
‚óè Interfaz y datos: Los sellos de tiempo de la interfaz y los datos se actualizan cada vez que
se modifica el bloque de datos de instancia. Aunque se deshaga manualmente la
modificaci√≥n, p. ej. se vuelva a anular la remanencia de una variable, la modificaci√≥n
actualiza los sellos de tiempo. Pero si se deshace la modificaci√≥n mediante la funci√≥n
"Deshacer", los sellos de tiempo se restablecen al valor anterior a la modificaci√≥n deshecha.
‚óè Relevante para la carga: El sello de tiempo de "Relevante para la carga" se modifica cada
vez que se modifica un bloque de datos de instancia. Estos cambios pueden afectar a los
datos o a la interfaz.

Sellos de tiempo para tipos de datos PLC
Para los tipos de datos PLC se generan los siguientes sellos de tiempo:
‚óè Bloque: Fecha de creaci√≥n, fecha de la √∫ltima modificaci√≥n
‚óè Interfaz: Fecha de la √∫ltima modificaci√≥n
‚óè Relevante para la carga: Fecha de la √∫ltima modificaci√≥n

7746

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.2 Definir propiedades de bloques
Los sellos de tiempo de los tipos de datos PLC se actualizan del siguiente modo:
‚óè Bloque: El sello de tiempo de la √∫ltima modificaci√≥n de un tipo de datos PLC corresponde
siempre al sello de tiempo de la interfaz.
‚óè Interfaz: El sello de tiempo de la interfaz se actualiza cada vez que se modifica el tipo de
datos PLC. Aunque se deshaga manualmente la modificaci√≥n, p. ej. se vuelva a borrar el
contenido del tipo de datos PLC, la modificaci√≥n actualiza el sello de tiempo. Pero si se
deshace la modificaci√≥n mediante la funci√≥n "Deshacer", el sello de tiempo se restablece
al valor anterior a la modificaci√≥n deshecha.
‚óè Relevante para la carga: El sello de tiempo de "Relevante para la carga" se modifica cada
vez que se modifica un tipo de datos PLC.

Consulte tambi√©n
Principios b√°sicos de las propiedades de bloques (P√°gina 7739)
Sinopsis de las propiedades de bloques (P√°gina 7740)
Mostrar y editar propiedades de bloques (P√°gina 7747)
Principios b√°sicos de la compilaci√≥n de bloques (P√°gina 8362)

7.2.4

Mostrar y editar propiedades de bloques
Las propiedades de los bloques son espec√≠ficos del bloque y la CPU. Por eso, no todas las
propiedades est√°n disponibles para todos los bloques y en todas las familias de CPU. Las
propiedades que s√≥lo se pueden mostrar est√°n protegidas contra escritura.

Mostrar y editar las propiedades de un bloque cerrado
Para mostrar o editar las propiedades de un bloque cerrado, proceda del siguiente modo:
1. Abra la carpeta "Bloques de programa" del √°rbol del proyecto.
2. Haga clic con el bot√≥n derecho del rat√≥n en el bloque cuyas propiedades desea mostrar o
editar.
3. Elija el comando "Propiedades" del men√∫ contextual.
Se abre el di√°logo de propiedades del bloque.
4. En la navegaci√≥n local, haga clic en el grupo cuyas propiedades desea mostrar o editar.
5. Modifique la propiedad deseada.
6. Confirme las entradas realizadas con "Aceptar".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7747

Creaci√≥n y gesti√≥n de bloques
7.3 Gestionar bloques

Mostrar y editar las propiedades de un bloque abierto
Para mostrar o editar las propiedades de un bloque abierto, proceda del siguiente modo:
1. Active la opci√≥n "Ventana de inspecci√≥n" del men√∫ "Ver".
Se abre la ventana de inspecci√≥n.
2. Haga clic en la ficha "Propiedades".
Las propiedades del bloque se visualizan en la ficha "Propiedades" de la ventana de
inspecci√≥n.
3. En la navegaci√≥n local, haga clic en el grupo cuyas propiedades desea mostrar o editar.
4. Modifique la propiedad deseada.

Resultado
Se modifican las propiedades del bloque. No obstante, los cambios no se guardar√°n hasta que
se guarde el proyecto.

Consulte tambi√©n
Principios b√°sicos de las propiedades de bloques (P√°gina 7739)
Sinopsis de las propiedades de bloques (P√°gina 7740)
Sellos de tiempo de bloques (P√°gina 7745)

7.3

Gestionar bloques

7.3.1

Abrir bloques
Es posible abrir tanto los bloques del proyecto (bloques offline) como los bloques del
dispositivo (bloques online).
Los bloques offline se abren de las maneras siguientes:
‚óè Abrir bloque offline directamente
Puede abrir directamente un bloque si ha abierto la correspondiente carpeta de bloques en
el √°rbol del proyecto o en la ventana general.
‚óè Buscar y abrir bloque offline
Puede buscar bloques dentro de un proyecto, un dispositivo, la carpeta "Bloques de
programa" y en el editor de programaci√≥n y despu√©s abrirlos.
Al abrir bloques online observe las siguientes particularidades:
‚óè Los bloques online no se pueden editar.
‚óè Debido al trabajo conjunto en paralelo en una CPU, es posible que otro usuario est√©
ejecutando una operaci√≥n de carga en la CPU seleccionada. Esto puede provocar que el
bloque online que tenga abierto se borre con el proceso de carga si solo existe en el
dispositivo. En este caso, el bloque online se cierra y aparece un mensaje en la ventana de
inspecci√≥n.

7748

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.3 Gestionar bloques

Abrir bloque offline directamente
Para abrir un bloque offline directamente, proceda del siguiente modo:
1. Abra la carpeta con el bloque que desee abrir, en el √°rbol del proyecto o en la ventana
general.
2. Haga doble clic en el bloque que desea abrir.
El bloque se abre en el editor de programaci√≥n.

Buscar y abrir bloque offline
Para buscar un bloque offline y abrirlo, proceda del siguiente modo:
1. El proceso de b√∫squeda se puede iniciar de las dos formas siguientes:
‚Äì Dentro del √°rbol del proyecto, en el men√∫ contextual del proyecto, un dispositivo o de la
carpeta "Bloque de programa", elija el comando "Abrir bloque/Tipo de datos PLC" o
pulse la tecla <F7>.
‚Äì Pulse la tecla <F7> en el editor de programaci√≥n abierto.
Se abre el cuadro de di√°logo "Abrir bloque/Tipo de datos PLC".
2. Introduzca el nombre, la direcci√≥n o el tipo de bloque que est√° buscando.
Con cada letra introducida se sigue filtrando la lista de bloques. Si no hay ning√∫n bloque que
coincida con su entrada, se cierra la lista de bloques. Puede mostrar la lista completa de
bloques en todo momento haciendo clic en el bot√≥n situado a la derecha del campo de
texto. Sin embargo, tenga en cuenta que despu√©s no tiene lugar ning√∫n filtrado. Si desea
filtrar de nuevo por sus entradas, vuelva a hacer clic en el bot√≥n.
3. En la lista de bloques, haga clic en el bloque que desee abrir.
El bloque se abre en el editor de programaci√≥n y se muestra como selecci√≥n en el √°rbol del
proyecto.

Abrir bloque online
Para abrir un bloque online, proceda del siguiente modo:
1. Abra la carpeta "Accesos online" en el √°rbol del proyecto.
2. Haga clic en el s√≠mbolo de flecha que aparece a la izquierda de la interfaz para mostrar
todos los objetos subordinados.
3. Haga doble clic en el comando "Actualizar dispositivos accesibles" debajo de la interfaz.
Se muestran todos los dispositivos accesibles desde esta interfaz.
4. Abra la carpeta del dispositivo que contiene el bloque que desea abrir.
5. Abra la carpeta "Bloques de programa".
Se muestran todos los bloques del dispositivo.
6. Haga doble clic en el bloque que desea abrir.
El bloque se abre en el editor de programaci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7749

Creaci√≥n y gesti√≥n de bloques
7.3 Gestionar bloques

Consulte tambi√©n
Guardar bloques (P√°gina 7750)
Cerrar bloques (P√°gina 7750)
Cambiar el nombre de bloques (P√°gina 7751)
Borrar bloques offline (P√°gina 7752)
Borrar bloques online (P√°gina 7752)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)

7.3.2

Guardar bloques
Los bloques se guardan siempre junto con el proyecto. Tambi√©n es posible guardar bloques
err√≥neos. Los errores pueden solucionarse en cualquier momento.

Procedimiento
Para guardar un bloque, proceda del siguiente modo:
1. Elija el comando "Guardar" o "Guardar como" del men√∫ "Proyecto".
Consulte tambi√©n: Guardar proyectos

Consulte tambi√©n
Abrir bloques (P√°gina 7748)
Cerrar bloques (P√°gina 7750)
Cambiar el nombre de bloques (P√°gina 7751)
Borrar bloques offline (P√°gina 7752)
Borrar bloques online (P√°gina 7752)

7.3.3

Cerrar bloques

Procedimiento
Para cerrar un bloque, proceda del siguiente modo:
1. Haga clic en el bot√≥n "Cerrar" de la barra de t√≠tulo del editor de programaci√≥n.
Nota
Tenga en cuenta que el bloque no se guarda al cerrarlo.

7750

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.3 Gestionar bloques

Consulte tambi√©n
Abrir bloques (P√°gina 7748)
Guardar bloques (P√°gina 7750)
Cambiar el nombre de bloques (P√°gina 7751)
Borrar bloques offline (P√°gina 7752)
Borrar bloques online (P√°gina 7752)

7.3.4

Cambiar el nombre de bloques

Requisitos
La carpeta "Bloques de programa" del √°rbol del proyecto est√° abierta.

Procedimiento
Para cambiar el nombre de un bloque, proceda del siguiente modo:
1. Haga clic con el bot√≥n derecho del rat√≥n en el bloque cuyo nombre desea cambiar.
2. Elija el comando "Cambiar nombre" del men√∫ contextual.
El nombre del bloque se transforma en un campo de entrada en el √°rbol del proyecto.
3. Introduzca el nuevo nombre para el bloque.
4. Confirme las entradas realizadas pulsando la tecla Intro.

Resultado
El nombre del bloque se cambia en todas las ubicaciones del programa.

Consulte tambi√©n
Abrir bloques (P√°gina 7748)
Guardar bloques (P√°gina 7750)
Cerrar bloques (P√°gina 7750)
Borrar bloques offline (P√°gina 7752)
Borrar bloques online (P√°gina 7752)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7751

Creaci√≥n y gesti√≥n de bloques
7.3 Gestionar bloques

7.3.5

Borrar bloques offline

Requisitos
La carpeta "Bloques de programa" del √°rbol del proyecto est√° abierta.

Procedimiento
Para borrar un bloque que exista offline, proceda del siguiente modo:
1. En la carpeta "Bloques de programa" del √°rbol del proyecto, haga clic con el bot√≥n derecho
del rat√≥n en el bloque que desea borrar.
2. Elija el comando "Borrar" del men√∫ contextual.
3. Confirme la consulta de seguridad con "S√≠".
El bloque se borra del proyecto offline.
Nota
Al borrar bloques de organizaci√≥n, recuerde que pueden tener eventos asignados. Si borra
estos bloques de organizaci√≥n, el programa no podr√° reaccionar a los eventos parametrizados.

Consulte tambi√©n
Abrir bloques (P√°gina 7748)
Guardar bloques (P√°gina 7750)
Cerrar bloques (P√°gina 7750)
Cambiar el nombre de bloques (P√°gina 7751)
Borrar bloques online (P√°gina 7752)
Cargar bloques para S7-1200/1500 (P√°gina 8368)

7.3.6

Borrar bloques online

Requisitos
La carpeta "Bloques de programa" del √°rbol del proyecto est√° abierta.

7752

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.3 Gestionar bloques

Procedimiento
Para borrar un bloque que exista online, proceda del siguiente modo:
1. En la carpeta "Bloques de programa" del √°rbol del proyecto, haga clic con el bot√≥n derecho
del rat√≥n en el bloque que desea borrar del dispositivo.
2. Elija el comando "Borrar" del men√∫ contextual.
Se abre el cuadro de di√°logo "Borrar".
3. Active el bot√≥n de opci√≥n "Borrar del dispositivo".
4. Haga clic en "S√≠".
El bloque se borra del dispositivo online.

Consulte tambi√©n
Abrir bloques (P√°gina 7748)
Guardar bloques (P√°gina 7750)
Cerrar bloques (P√°gina 7750)
Cambiar el nombre de bloques (P√°gina 7751)
Borrar bloques offline (P√°gina 7752)

7.3.7

Borrar bloques de datos de CPU
Los bloques de datos de CPU se pueden borrar tanto offline como online.

Borrar bloques de datos de CPU offline
Para borrar un bloque de datos de CPU disponible offline en el proyecto, proceda del siguiente
modo:
1. En la carpeta "Bloques de programa" del √°rbol del proyecto, haga clic con el bot√≥n derecho
del rat√≥n en el bloque de datos de CPU que desea borrar.
2. Elija el comando "Borrar" del men√∫ contextual.
3. Confirme la consulta de seguridad con "S√≠".
El bloque de datos de CPU se borra del proyecto offline.

Borrar un bloque de datos de CPU online
Para borrar un bloque de datos de CPU disponible online, proceda del siguiente modo:
1. Establezca una conexi√≥n online con el dispositivo que contiene el bloque de datos de CPU
que desea borrar.
2. En la carpeta "Bloques de programa" del √°rbol del proyecto, haga clic con el bot√≥n derecho
del rat√≥n en el bloque de datos de CPU que desea borrar en el dispositivo.
3. Elija el comando "Borrar" del men√∫ contextual.
Se abre el cuadro de di√°logo "Borrar".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7753

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos
4. Active el bot√≥n de opci√≥n "Borrar del dispositivo".
5. Haga clic en "S√≠".
El bloque de datos de CPU se borra online del dispositivo.

Consulte tambi√©n
Bloques de datos de CPU (P√°gina 52)

7.4

Utilizar archivos fuente externos

7.4.1

Principios b√°sicos de la utilizaci√≥n de archivos fuente externos

Funci√≥n
Para los lenguajes de programaci√≥n textual AWL y SCL existe la posibilidad de introducir el
c√≥digo de programa en un editor ASCII cualquiera y guardarlo como un archivo fuente externo.
Aqu√≠ pueden realizarse p. ej. las siguientes acciones:
‚óè Declarar variables
‚óè Definir propiedades de bloques
‚óè Programar bloques
Adicionalmente, es posible guardar tipos de datos PLC en archivos fuente externos.
Nota
Observe las indicaciones siguientes:
‚óè Para que sea posible generar bloques o tipos de datos PLC en TIA Portal a partir del archivo
fuente externo, este debe almacenarse con una de las siguientes codificaciones de
caracteres:
‚Äì ANSI
‚Äì UTF-8 con BOM (Byte Order Mark)
‚Äì UTF-16 con BOM, formato Little Endian y Big Endian
‚Äì UTF-32 con BOM, formato Little Endian y Big Endian
‚Äì UCS2 en formato Little Endian y Big Endian
‚óè Dentro de las Software Units pueden utilizarse archivos fuente externos solo con bloques
optimizados en lenguaje de programaci√≥n SCL y con tipos de datos PLC.
‚óè Con las fuentes externas solo es posible generar bloques y tipos de datos PLC en el entorno
correspondiente, es decir, dentro de una Software Unit o directamente debajo del PLC. Esto
significa, por ejemplo, que en otras Software Units no se sobrescribir√°n bloques ni tipos de
datos PLC. Si esto fuera necesario debido a la fuente externa seleccionada, la generaci√≥n
no se llevar√° a cabo.

7754

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos
Los archivos fuente externos se pueden importar al proyecto para generar bloques o tipos de
datos PLC a partir de ellos. De esta manera se pueden generar varios objetos a partir de un
archivo fuente. Cuando genere bloques a partir de un archivo fuente, tenga en cuenta las
siguientes particularidades:
‚óè Si en el proyecto ya existe un bloque o tipo de datos PLC con el mismo nombre, el bloque
o tipo de datos PLC se sobrescribe en el proyecto.
‚óè Si un bloque se ha programado en el archivo fuente con su n√∫mero de bloque absoluto en
lugar de con un nombre simb√≥lico, y ese n√∫mero ya est√° asignado a otro bloque del
proyecto, el bloque reci√©n generado recibir√° el siguiente nombre simb√≥lico libre.
‚óè Si en el archivo fuente externo no ha definido expl√≠citamente el tipo de acceso para un
bloque, el tipo de acceso para el bloque se ajustar√° en funci√≥n de la familia de CPU:
‚Äì Los bloques generados para una CPU de la serie S7-1200/1500 reciben de forma
predeterminada el tipo de acceso "optimizado".
‚Äì Los bloques generados para una CPU de la serie S7-300/400 reciben de forma
predeterminada el tipo de acceso "est√°ndar".
Son excepci√≥n los bloques de organizaci√≥n que, en ese caso, siempre reciben de forma
predeterminada el tipo de acceso "est√°ndar", independientemente de la familia de CPU. El
acceso al bloque se puede cambiar manualmente.
‚óè Puede suceder que no todos los comentarios del archivo fuente se adopten en el bloque.
‚óè Si en el archivo de origen externo se utiliza el direccionamiento absoluto, al crear el bloque
se genera una variable simb√≥lica para cada direcci√≥n absoluta. Los nombres de dichas
variables se componen de "Tag_" y un sello de tiempo. De esta composici√≥n pueden
resultar nombres de variables relativamente largos, que pueden modificarse manualmente
en caso necesario.
‚óè Si en el archivo fuente externo utiliza instrucciones de una versi√≥n distinta al dispositivo de
destino, esto puede provocar errores de compilaci√≥n. En ese caso, corrija las instrucciones
correspondientes e inicie de nuevo el proceso de compilaci√≥n. Otra posibilidad es
seleccionar otra versi√≥n para el dispositivo de destino.
‚óè Las CPU de la serie S7-300/400 aceptan durante la importaci√≥n bloques de organizaci√≥n
con cualquier nombre. Si se importa un OB con un nombre est√°ndar (por ejemplo,
CYCL_EXC o CYC_INT5), autom√°ticamente se asignar√° la clase de OB correcta. Si se
importa un OB con un nombre desconocido, se crear√° un OB 0. Este n√∫mero puede
modificarse despu√©s de la importaci√≥n para, de este modo, asignar la clase de OB
deseada. Para cambiar el n√∫mero del OB, elija el comando "Propiedades" del men√∫
contextual.
‚óè Al importar una fuente SCL, esta no se comprueba autom√°ticamente. Esto conlleva que los
bloques que se generen a partir de ella puedan contener errores que no se mostrar√°n con
mensajes de error hasta la pr√≥xima compilaci√≥n.
Asimismo, existe la posibilidad de guardar bloques existentes como archivos fuente externos.
Es posible guardar en un archivo fuente solo el c√≥digo del bloque seleccionado, o tambi√©n el
c√≥digo de todos los bloques y tipos de datos PLC dependientes del bloque seleccionado. Al
guardar varios bloques en un archivo fuente, todos los bloques deben emplear el mismo
lenguaje de programaci√≥n y ning√∫n bloque puede tener protecci√≥n de know-how. Los tipos de
datos PLC tambi√©n pueden copiarse individualmente como texto e insertarse en un archivo de
texto.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7755

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos

Consulte tambi√©n
Reglas para la programaci√≥n de archivos fuente externos (P√°gina 7756)
Guardar un bloque como archivo fuente externo (P√°gina 7757)
Integrar archivos fuente externos (P√°gina 7759)
Abrir y editar archivos fuente externos (P√°gina 7759)
Generar bloques a partir de archivos fuente externos (P√°gina 7760)

7.4.2

Reglas para la programaci√≥n de archivos fuente externos
Un archivo fuente externo consta, en principio, de un texto continuo. Sin embargo, para poder
compilarlo en bloques se deben respetar estructuras y normas sint√°cticas determinadas.

Reglas de sintaxis
La sintaxis de las instrucciones en los archivos fuente externos se parece a la utilizada en la
creaci√≥n del programa de usuario en el editor de programaci√≥n con AWL o SCL. Pero tenga en
cuenta las siguientes reglas sint√°cticas adicionales:
‚óè Llamada de bloque
Al llamar un bloque, transfiera los par√°metros en una secuencia definida en el editor ASCII.
De lo contrario, las asignaciones de comentario de estas filas posiblemente no
concordar√°n.
Indique los par√°metros entre par√©ntesis. Los distintos par√°metros se separan entre s√≠
mediante una coma.
‚óè May√∫sculas o min√∫sculas
Por lo general, el editor de programaci√≥n no tiene en cuenta may√∫sculas o min√∫sculas.
Excepto en las etiquetas. Al introducir cadenas de caracteres (tipo de datos "STRING")
tambi√©n se deben tener en cuenta las may√∫sculas y min√∫sculas. Las palabras clave se
representan en may√∫scula. En la compilaci√≥n no se tienen en cuenta las may√∫sculas o
min√∫sculas, as√≠ que las palabras clave se pueden indicar en may√∫sculas, min√∫sculas o
ambas mezcladas.
‚óè Punto y coma
Identifique el final de las instrucciones y declaraciones de variables con un punto y coma.
Se pueden introducir varias instrucciones por fila.
‚óè Barras inclinadas
Comience cada comentario con dos barras inclinadas (//) y final√≠celo con la tecla <Intro>.
‚óè Uso de constantes String
Para evitar errores de compilaci√≥n al utilizar constantes String, introduzca los textos en el
lenguaje del proyecto de destino. Para CPU de la serie S7-1200/1500 se puede utilizar el
tipo de datos WSTRING expl√≠citamente mediante el prefijo "WString#":
Operando := WString#'<constante String>';

7756

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos

Consulte tambi√©n
Principios b√°sicos de la utilizaci√≥n de archivos fuente externos (P√°gina 7754)
Guardar un bloque como archivo fuente externo (P√°gina 7757)
Integrar archivos fuente externos (P√°gina 7759)
Abrir y editar archivos fuente externos (P√°gina 7759)
Generar bloques a partir de archivos fuente externos (P√°gina 7760)

7.4.3

Guardar un bloque como archivo fuente externo
Existen las posibilidades siguientes para guardar bloques AWL y SCL y tipos de datos PLC
como archivos fuente externos:
‚óè Copiar un bloque como texto
Tenga en cuenta que en el caso de bloques protegidos solo se adopta en el archivo fuente
la informaci√≥n que es visible incluso sin contrase√±a.
‚óè Generar archivo fuente externo a partir de bloques
Es posible guardar en un archivo fuente externo solo el c√≥digo del bloque seleccionado, o
tambi√©n el c√≥digo de todos los bloques y tipos de datos PLC dependientes del bloque
seleccionado. En ese caso, todos los bloques deben emplear el mismo lenguaje de
programaci√≥n y ning√∫n bloque puede tener protecci√≥n de know-how.
Nota
Al utilizar la interfaz de bloque tabular, recuerde que no todos los valores iniciales se
exportan al origen, p. ej. tipos de datos PLC.

Copiar un bloque como texto
Para copiar un bloque o tipo de datos PLC como texto y guardarlo en un archivo fuente externo,
proceda del siguiente modo:
1. En el √°rbol del proyecto, haga clic con el bot√≥n derecho del rat√≥n en el bloque que desea
guardar en un archivo fuente externo.
2. Seleccione el comando "Copiar como texto" del men√∫ contextual.
3. Abra un editor de texto externo.
4. En el editor de texto, inserte el texto copiado desde el portapapeles.
5. Guarde el archivo con una de las siguientes extensiones de nombre de archivo:
‚Äì ".scl", si quiere generar un archivo fuente para un bloque SCL
‚Äì ".awl", si quiere generar un archivo fuente para un bloque AWL
‚Äì ".DB", si quiere generar un archivo fuente para un bloque de datos
‚Äì ".UDT", si quiere generar un archivo fuente para un tipo de datos PLC

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7757

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos

Generar archivo fuente externo a partir de bloques
Para generar archivos fuente externos a partir de bloques AWL o SCL o tipos de datos PLC,
proceda del siguiente modo:
1. En el √°rbol del proyecto o en la ventana general, seleccione los bloques o tipos de datos
PLC a partir de los que desea generar un archivo fuente externo.
Nota
Seleccione solo bloques que tengan el mismo lenguaje de programaci√≥n y no tengan
protecci√≥n de know-how.
2. Seleccione el comando "Generar fuente a partir de bloques > Solo bloques seleccionados"
del men√∫ contextual para guardar los bloques o tipos de datos PLC seleccionados en un
archivo fuente externo. O bien seleccione el comando "Generar fuente a partir de bloques
> Incluir bloques dependientes" si tambi√©n desea guardar en el archivo fuente externo el
c√≥digo de los bloques dependientes y de los tipos de datos PLC referenciados.
Se abre el cuadro de di√°logo "Guardar como".
3. Especifique una ruta y un nombre para la fuente externa.
4. Haga clic en "Aceptar".
Tambi√©n se puede generar un archivo fuente externo a partir de un bloque AWL o SCL abierto.
Para ello, proceda del siguiente modo:
1. En la lista desplegable "Generar fuente a partir de bloques" de la barra de herramientas del
editor de programaci√≥n seleccione el comando "Generar fuente a partir de este bloque"
para guardar el bloque abierto en un archivo fuente externo. O bien seleccione el comando
"Generar fuente a partir de este bloque y de todos los bloques dependientes" si tambi√©n
desea guardar en el archivo fuente externo el c√≥digo de programa de los bloques
dependientes y de los tipos de datos PLC referenciados.
Se abre el cuadro de di√°logo "Guardar como".
2. Especifique una ruta y un nombre para la fuente externa.
3. Haga clic en "Aceptar".

Resultado
Dependiendo de la opci√≥n seleccionada, se guardar√° como archivo fuente externo solo el
bloque, o el bloque junto con los bloques y los tipos de datos PLC dependientes. Este archivo
fuente se puede integrar en un proyecto en el TIA Portal para volver a generar bloques a partir
de √©l. Pero tenga en cuenta que los archivos fuente AWL solo pueden utilizarse en las CPU
S7-300/400/1500.

Consulte tambi√©n
Principios b√°sicos de la utilizaci√≥n de archivos fuente externos (P√°gina 7754)
Reglas para la programaci√≥n de archivos fuente externos (P√°gina 7756)
Integrar archivos fuente externos (P√°gina 7759)
Abrir y editar archivos fuente externos (P√°gina 7759)
Generar bloques a partir de archivos fuente externos (P√°gina 7760)

7758

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos

7.4.4

Integrar archivos fuente externos

Requisitos
‚óè Existe un archivo fuente externo y se corresponde con las reglas de sintaxis y estructura.
‚óè La carpeta "Fuentes externas" del √°rbol del proyecto est√° abierta.

Procedimiento
Para integrar un archivo fuente externo, proceda del siguiente modo:
1. Haga doble clic en el comando "Agregar nuevo archivo externo".
Se abrir√° el cuadro de di√°logo "Abrir".
2. Navegue hasta el archivo fuente externo existente y selecci√≥nelo.
3. Confirme la selecci√≥n con "Abrir".
Si ya existe un archivo fuente externo con este nombre en el proyecto, se abre el cuadro de
di√°logo "Agregar archivo externo". A continuaci√≥n, siga con el paso 4.
4. Elija si la nueva fuente externa debe insertarse cambi√°ndole el nombre o bien si debe
reemplazarse la fuente externa existente.
5. Haga clic en "Aceptar".

Resultado
El nuevo archivo fuente se inserta en la carpeta "Fuentes externas".

Consulte tambi√©n
Principios b√°sicos de la utilizaci√≥n de archivos fuente externos (P√°gina 7754)
Reglas para la programaci√≥n de archivos fuente externos (P√°gina 7756)
Guardar un bloque como archivo fuente externo (P√°gina 7757)
Abrir y editar archivos fuente externos (P√°gina 7759)
Generar bloques a partir de archivos fuente externos (P√°gina 7760)

7.4.5

Abrir y editar archivos fuente externos
Si enlaza archivos con las extensiones "awl", "scl", "db" y "udt" con un editor, existe la
posibilidad de abrir y editar directamente los archivos fuente externos con estos formatos.
Como editor se debe utilizar Notepad, ya que con otros editores de texto posiblemente no
puedan abrirse varias fuentes al mismo tiempo.
De esta manera no es necesario volver a integrar los archivos fuente externos despu√©s de
editarlos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7759

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos

Enlazar archivos con las extensiones "awl", "scl", "db" y "udt" a un editor
Para enlazar los archivos con las extensiones "awl", "scl", "db" y "udt" con un editor, proceda
del siguiente modo:
1. Abra el Explorador de Windows.
2. Haga clic con el bot√≥n derecho del rat√≥n en un archivo AWL.
3. Elija "Propiedades" del men√∫ contextual.
Se abre el cuadro de di√°logo "Propiedades".
4. Haga clic en "Cambiar" en el √°rea "Tipo de datos" de la ficha "General".
Se abre el cuadro de di√°logo "Abrir con".
5. Elija el editor de texto que desea enlazar con el tipo de archivo "awl".
6. Confirme la selecci√≥n con "Aceptar".
7. Cierre el cuadro de di√°logo "Propiedades" con "Aceptar".
8. Repita los pasos 2 a 7 con cada uno de los tipos de archivo restantes.

Abrir y editar archivos fuente externos
Para abrir un archivo fuente externo, proceda del siguiente modo:
1. Abra la carpeta "Fuentes externas" del √°rbol del proyecto.
2. Haga doble clic en el archivo fuente externo que desea abrir.
El archivo fuente externo se abre en el editor enlazado y se puede editar.

Consulte tambi√©n
Principios b√°sicos de la utilizaci√≥n de archivos fuente externos (P√°gina 7754)
Reglas para la programaci√≥n de archivos fuente externos (P√°gina 7756)
Guardar un bloque como archivo fuente externo (P√°gina 7757)
Integrar archivos fuente externos (P√°gina 7759)
Generar bloques a partir de archivos fuente externos (P√°gina 7760)

7.4.6

Generar bloques a partir de archivos fuente externos

Requisitos
‚óè La carpeta "Fuentes externas" del √°rbol del proyecto est√° abierta.
‚óè Existe un archivo fuente externo.
‚óè El archivo fuente externo se guard√≥ con una codificaci√≥n de caracteres permitida.

7760

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos

Procedimiento
Para generar bloques desde un archivo fuente externo, proceda del siguiente modo:
1. Seleccione el archivo fuente externo desde el que desea generar los bloques.
2. Elija el comando "Generar fuente a partir de bloques" del men√∫ "Edici√≥n".
3. Una consulta de seguridad le informa de que los bloques existentes posiblemente se
sobrescribir√°n.
4. Confirme la consulta de seguridad con "S√≠".

Resultado
Los bloques del archivo fuente externo se generan e insertan en la carpeta "Bloques de
programa" del √°rbol del proyecto. Si se producen errores, encontrar√° informaci√≥n sobre este
respecto en la ventana de inspecci√≥n. Sin embargo, esta informaci√≥n se refiere al archivo
fuente externo y no al bloque generado.

Consulte tambi√©n
Principios b√°sicos de la utilizaci√≥n de archivos fuente externos (P√°gina 7754)
Reglas para la programaci√≥n de archivos fuente externos (P√°gina 7756)
Guardar un bloque como archivo fuente externo (P√°gina 7757)
Integrar archivos fuente externos (P√°gina 7759)
Abrir y editar archivos fuente externos (P√°gina 7759)
Definir propiedades de bloques (P√°gina 7739)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7761

Creaci√≥n y gesti√≥n de bloques
7.4 Utilizar archivos fuente externos

7762

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.1

8

Proteger bloques

Introducci√≥n
Existen las siguientes posibilidades de proteger bloques:
‚óè Protecci√≥n de know-how:
Mediante la protecci√≥n de know-how es posible proteger por contrase√±a contra accesos no
autorizados los bloques del tipo OB, FB, FC y los bloques de datos globales.
‚óè Protecci√≥n contra copia:
Para las CPU S7-1200/1500 se puede establecer una protecci√≥n contra copia para bloques
l√≥gicos que vincule la ejecuci√≥n del bloque a la CPU o la Memory Card con el n√∫mero de
serie especificado. Si se utiliza la protecci√≥n contra copia para un bloque, es razonable
dotar tambi√©n a ese bloque de una protecci√≥n de know-how para que la protecci√≥n contra
copia solo pueda suprimirse con contrase√±a.
‚óè Protecci√≥n contra escritura:
Para bloques l√≥gicos es posible asignar una protecci√≥n contra escritura que impida que el
bloque pueda modificarse inadvertidamente.
Para la protecci√≥n de know-how tenga en cuenta las siguientes particularidades:
‚óè No es posible proteger manualmente los bloques de datos de instancia, sino que dependen
de la protecci√≥n de know-how del FB asignado. Esto significa que si se genera un bloque
de datos instancia para un FB con protecci√≥n de know-how, el bloque de datos instancia
obtiene tambi√©n la protecci√≥n de know-how. Esto sucede independientemente de si se crea
el bloque de datos instancia de forma expl√≠cita o si se genera por una llamada de bloque.
‚óè Con bloques de datos globales y con bloques de datos de instancia la protecci√≥n de knowhow act√∫a como protecci√≥n contra escritura.
‚óè Los bloques de datos ARRAY no pueden dotarse de protecci√≥n de know-how.
‚óè La memoria de carga necesaria puede ser mayor con bloques con protecci√≥n de know-how.
En un bloque con protecci√≥n de know-how pueden leerse √∫nicamente los datos siguientes sin
una contrase√±a correcta:
‚óè Par√°metros de transferencia Input, Output, InOut, Return, Static
‚óè T√≠tulo del bloque
‚óè Comentario del bloque
‚óè Propiedades de bloques
‚óè Variables de bloques de datos globales sin indicaci√≥n de la ubicaci√≥n
Adem√°s, en un bloque con protecci√≥n de know-how pueden realizarse las acciones siguientes:
‚óè Copiar y borrar
‚óè Llamar en un programa

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7763

Protecci√≥n de bloques
8.1 Proteger bloques
‚óè Comparaci√≥n offline/online
‚óè Cargar
En cambio, el c√≥digo del bloque no se puede leer ni modificar si no se dispone de la
autorizaci√≥n necesaria.
Nota
Tenga en cuenta las indicaciones siguientes:
‚óè S7-1200 versi√≥n 1.0 y S7-300/400 (solo bloques GRAPH y SCL): Si carga un bloque con
protecci√≥n de know-how en un dispositivo, no se cargar√° la informaci√≥n de restauraci√≥n.
Esto significa que un bloque con know-how protegido no se podr√° volver a abrir si se carga
del dispositivo, ni siquiera conociendo la contrase√±a correcta.
‚óè En las versiones offline y online de los bloques con protecci√≥n de know-how solo se
comparan los datos sin protecci√≥n.
‚óè Sin la contrase√±a no es posible acceder al bloque.
‚óè Si se inserta un bloque con protecci√≥n de know-how a una librer√≠a, la plantilla maestra
resultante obtiene tambi√©n la protecci√≥n de know-how.
‚óè En las propiedades del bloque, bajo "Compilaci√≥n > Conformidad con librer√≠a" se indica si
el bloque puede utilizarse como elemento protegido de librer√≠a. Para ello, el bloque no
puede utilizar variables de las √°reas de operandos Salidas (Q), Entradas (I), Marcas (M),
Temporizadores (T) o Contadores (Z) y no puede acceder a bloques de datos.
‚óè Las referencias cruzadas a variables, marcas, entradas y salidas utilizadas en bloques con
protecci√≥n de know-how solo se muestran si los bloques en cuesti√≥n se han desbloqueado
introduciendo la contrase√±a correcta antes de generar la lista de referencias cruzadas.
‚óè La renumeraci√≥n autom√°tica o manual del n√∫mero de bloques con protecci√≥n de know-how
sin una contrase√±a solo es posible en las CPU de las series S7-1500 y S7-1200 (a partir de
V4). Adem√°s, la protecci√≥n de know-how debe haberse activado con una versi√≥n del TIA
Portal igual o superior a V13 SP1. Si no se cumplen estos requisitos para un bloque con
protecci√≥n de know-how, en caso de cambio de n√∫mero el componente binario cargable del
bloque ya no es actual. En este caso, el bloque debe volver a compilarse antes de cargarlo
en un dispositivo, lo que en el caso de un bloque con protecci√≥n de know how solo es
posible con la contrase√±a correcta. Este punto debe recordarse especialmente si se desea
copiar un bloque con protecci√≥n de know how a otro dispositivo que ya contenga un bloque
con ese n√∫mero.
‚óè Transmita siempre como fichero de proyecto o de librer√≠a un proyecto que contenga
bloques con protecci√≥n de know-how. De ese modo, se asegurar√° de que no se omita la
protecci√≥n de know-how.
‚óè En un bloque abierto con protecci√≥n de know-how no pueden modificarse los ajustes de
protecci√≥n de know-how.

Empleo de un proveedor de contrase√±as
Existe la posibilidad de vincular el TIA Portal a una administraci√≥n de contrase√±as externa a
trav√©s de un proveedor de contrase√±as. Para ello se necesita un proyecto con versi√≥n de
producto V14 SP1 o superior.
Si se utiliza un proveedor de contrase√±as, al activar la protecci√≥n de know-how, contra copia
o contra escritura es posible seleccionar la contrase√±a de una lista. En la lista se muestran solo

7764

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.1 Proteger bloques
los nombres de las contrase√±as; las contrase√±as como tales no son visibles. Al abrir el bloque,
el TIA Portal se conecta con el proveedor de contrase√±as y recoge la contrase√±a
correspondiente. Si en ese momento el proveedor de contrase√±as no est√° disponible, solo es
posible abrir completamente el bloque si como estrategia alternativa se ha establecido la
introducci√≥n manual de la contrase√±a y se conoce la contrase√±a correspondiente. En este
caso el nombre de la contrase√±a no es suficiente. Dependiendo del ajuste de seguridad
seleccionado, en el proveedor de contrase√±as es posible cambiar la contrase√±a para un
bloque con protecci√≥n de know-how o desbloquear de nuevo la protecci√≥n.
El uso de un proveedor de contrase√±as incrementa la seguridad del c√≥digo del programa,
puesto que no es necesario trasmitir a otros operadores las contrase√±as para bloques con
protecci√≥n de know-how. En vez de eso, todos los operadores pueden vincularse con el mismo
proveedor de contrase√±as para obtener acceso a los bloques. Si un operador abandona el
proyecto, no es necesario cambiar la contrase√±a.
Si se producen problemas con los proveedores de contrase√±as vinculados, existe la
posibilidad de registrar las actividades del proveedor de contrase√±as y remitirlas al Customer
Support para su an√°lisis.
Nota
Informaci√≥n de seguridad sobre la protecci√≥n de bloques
Si un bloque est√° protegido por una contrase√±a introducida manualmente, esta deber√°
introducirse cada vez que quiera editarse el bloque o modificar sus ajustes de protecci√≥n. Esto
tambi√©n se aplica si posteriormente un proveedor de contrase√±a contiene una contrase√±a con
el mismo texto.

Consulte tambi√©n
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7765

Protecci√≥n de bloques
8.2 Vincular un proveedor de contrase√±as

8.2

Vincular un proveedor de contrase√±as
Como alternativa a la entrada manual de contrase√±as, existe la posibilidad de vincular al TIA
Portal un proveedor de contrase√±as. Si se utiliza un proveedor de contrase√±as se puede
seleccionar una contrase√±a de una lista de contrase√±as disponibles. Al abrir un bloque con
protecci√≥n de know-how, el TIA Portal se conecta con el proveedor de contrase√±as y recoge
la contrase√±a correspondiente.
Para vincular un proveedor de contrase√±as es necesario instalarlo y activarlo. Adem√°s se
necesita un archivo de configuraci√≥n en el que est√© definido el uso de un proveedor de
contrase√±as.

Instalar y activar un proveedor de contrase√±as
Para instalar y activar un proveedor de contrase√±as, proceda del siguiente modo:
1. Instale el proveedor de contrase√±as deseado siguiendo las instrucciones de instalaci√≥n del
proveedor de contrase√±as.
2. Abra el TIA Portal.
3. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
4. Seleccione el grupo "Proveedor de contrase√±a > Proveedores de contrase√±a disponibles"
en la navegaci√≥n local.
El proveedor de contrase√±as reci√©n instalado se mostrar√° en la tabla de los proveedores de
contrase√±as disponibles.
5. Active la casilla de verificaci√≥n de la columna "Estado" para utilizar el proveedor de
contrase√±as.
El proveedor de contrase√±as instalado est√° activo y puede utilizarse.
6. Ajuste la entrada de contrase√±a preferente de modo que se utilice el proveedor de
contrase√±as.
Consulte tambi√©n: Definir la asignaci√≥n preferente de contrase√±a (P√°gina 7770)

Crear un archivo de configuraci√≥n para el empleo de proveedores de contrase√±as
Para crear un archivo de configuraci√≥n para el empleo de proveedores de contrase√±as,
proceda del siguiente modo:
1. Cree un archivo de configuraci√≥n XML con el contenido indicado a continuaci√≥n. Utilice la
codificaci√≥n "UTF-8".
2. En el Setting-Tag denominado "EnablePasswordPreference" especifique si el usuario
puede conmutar entre la asignaci√≥n manual de contrase√±as y la asignaci√≥n de contrase√±as
mediante un proveedor de contrase√±as.
3. En el Setting-Tag denominado "PasswordPreference" especifique el tipo de asignaci√≥n de
contrase√±a que debe emplearse.
4. Guarde el archivo XML.
5. Guarde el archivo con el nombre "CorporateSettings.xml" en el siguiente directorio del PC:
C:\ProgramData\Siemens\Automation\Portal V15_1\CorporateSettings\

7766

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.2 Vincular un proveedor de contrase√±as

Contenido del archivo de configuraci√≥n
El archivo de configuraci√≥n debe tener el contenido siguiente:
XML
<?xml version="1.0" encoding="utf-8"?>
<Document>
<Settings.Settings ID="0">
<ObjectList>
<Settings.General ID="1" AggregationName="General">
<ObjectList>
<Settings.PasswordProviders ID="3" AggregationeName="PasswordProviders">
<AttributeList>
<EnablePasswordPreference>
<Value>true</Value>
</EnablePasswordPreference>
<DefaultPasswordPreference>
<Value>Advanced</Value>
</DefaultPasswordPreference>
</AttributeList>
</Settings.PasswordProviders>
</ObjectList>
</Settings.General>
</ObjectList>
</Settings.Settings>
</Document>

Los ajustes del proveedor de contrase√±as se definen en el elemento
"Settings.PasswordProviders":
‚óè Para "EnablePasswordPreference" son posibles los valores siguientes:
‚Äì "true": El usuario puede conmutar en el TIA Portal entre la asignaci√≥n manual de
contrase√±as y la asignaci√≥n de contrase√±as mediante proveedor de contrase√±as.
‚Äì "false": En el TIA Portal no est√° permitido conmutar entre asignaci√≥n manual de
contrase√±as y asignaci√≥n de contrase√±as mediante proveedor de contrase√±as.
El ajuste est√°ndar es "false".
‚óè Para "DefaultPasswordPreference" son posibles los valores siguientes:
‚Äì "Manual": En el TIA Portal las contrase√±as se asignan manualmente.
‚Äì "Advanced": En el TIA Portal las contrase√±as se asignan mediante un proveedor de
contrase√±as.
‚Äì "AdvancedWithManualFallback": En el TIA Portal las contrase√±as se asignan mediante
un proveedor de contrase√±as. Si el proveedor de contrase√±as no est√° disponible, puede
accederse al bloque protegido introduciendo manualmente una contrase√±a.
El ajuste est√°ndar es "Manual":
Si el archivo "CorporateSettings.xml" ya existe y contiene otros ajustes, complete el
elemento "Settings.PasswortProviders" dentro del elemento "ObjectList".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7767

Protecci√≥n de bloques
8.3 Mostrar proveedores de contrase√±as disponibles

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.3

Mostrar proveedores de contrase√±as disponibles
Es posible visualizar los proveedores de contrase√±as que est√°n disponibles en el TIA Portal.

Requisitos
Mediante un archivo de configuraci√≥n se ha especificado la asignaci√≥n de contrase√±as
mediante proveedor de contrase√±as.

Procedimiento
Para mostrar los proveedores de contrase√±as disponibles, proceda del siguiente modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "Proveedor de contrase√±a > Proveedores de contrase√±a disponibles"
en la navegaci√≥n local.
Los proveedores de contrase√±as disponibles se muestran en la tabla de la vista general.

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)

7768

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.4 Registrar actividades de los proveedores de contrase√±as
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.4

Registrar actividades de los proveedores de contrase√±as
Si se presentan problemas relacionados con los proveedores de contrase√±as vinculados,
existe la posibilidad de registrar las actividades de los mismos. En tal caso no se registran
contrase√±as. El registro se puede transferir al Customer Support para su an√°lisis.

Requisitos
Hay un proveedor de contrase√±as vinculado y activado.

Activar el registro de las actividades de los proveedores de contrase√±as
Para activar el registro, proceda del siguiente modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "Proveedor de contrase√±a > An√°lisis del proveedor de contrase√±a" en
la navegaci√≥n local.
3. Active la casilla de verificaci√≥n "Grabar actividades del proveedor de contrase√±a".
Se activan el campo de texto para la ubicaci√≥n del archivo de registro y el bot√≥n "Examinar".
4. Introduzca una ubicaci√≥n para el archivo de registro o selecci√≥nelo mediante el bot√≥n
"Examinar".

Desactivar el registro de las actividades de los proveedores de contrase√±as
Para desactivar el registro, proceda del siguiente modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "Proveedor de contrase√±a > An√°lisis del proveedor de contrase√±a" en
la navegaci√≥n local.
3. Desactive la casilla de verificaci√≥n "Grabar actividades del proveedor de contrase√±a".
Se desactivan el campo de texto para la ubicaci√≥n del archivo de registro y el bot√≥n
"Examinar".

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7769

Protecci√≥n de bloques
8.5 Definir el tipo de asignaci√≥n de contrase√±as
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.5

Definir el tipo de asignaci√≥n de contrase√±as
En el tipo de asignaci√≥n de contrase√±a para bloques con protecci√≥n de know-how, con
protecci√≥n contra copia y con protecci√≥n contra escritura, el TIA Portal le ofrece las siguientes
posibilidades:
‚óè "Entrada manual de contrase√±a"
En la entrada manual de contrase√±a, la contrase√±a se introduce directamente en el cuadro
de di√°logo de consulta de contrase√±a.
‚óè "Selecci√≥n mediante proveedor de contrase√±a"
Al introducir una contrase√±a mediante un proveedor de contrase√±as externo, esta puede
seleccionarse mediante un nombre en la lista de contrase√±as disponibles. Si el proveedor
de contrase√±as no est√° disponible, no es posible activar la protecci√≥n. Un acceso posterior
al bloque solo es posible si existe conexi√≥n con el proveedor de contrase√±as.
‚óè "Selecci√≥n mediante proveedor de contrase√±a con entrada manual como estrategia
alternativa para el acceso"
Igual que la entrada de contrase√±a mediante un proveedor de contrase√±as externo. Si el
proveedor de contrase√±as no est√° disponible y se conoce la contrase√±a, introduciendo
manualmente la contrase√±a se puede abrir el bloque para ejecutarlo.
La entrada manual de la contrase√±a es el ajuste predeterminado.

Requisitos
Para poder utilizar la asignaci√≥n de contrase√±as mediante un proveedor de contrase√±as
externo deben cumplirse los requisitos siguientes:
‚óè Mediante un archivo de configuraci√≥n se ha especificado la asignaci√≥n de contrase√±as
mediante proveedor de contrase√±as.
‚óè En el archivo de configuraci√≥n se ha permitido cambiar el tipo de asignaci√≥n de
contrase√±as.
‚óè Hay conectado un proveedor de contrase√±as.

7770

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.6 Establecer y quitar la protecci√≥n contra copia de un bloque

Procedimiento
Para definir el tipo de asignaci√≥n de contrase√±as, proceda del siguiente modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "Proveedor de contrase√±a > Asignaci√≥n de contrase√±a" en la
navegaci√≥n local.
3. Active el tipo deseado de asignaci√≥n de contrase√±as.

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.6

Establecer y quitar la protecci√≥n contra copia de un bloque
Para las CPU S7-1200/1500 se puede crear una protecci√≥n contra copia, de modo que la
ejecuci√≥n del bloque quede vinculada a una CPU o una Memory Card determinadas. Solo si
el bloque se encuentra en el dispositivo con el n√∫mero de serie definido es posible ejecutarlo.
Si desea insertar el n√∫mero de serie autom√°ticamente mediante una operaci√≥n de carga, hay
que definir una contrase√±a de protecci√≥n contra copia. Esta contrase√±a deber√° introducirse
cuando se cargue el bloque. Es posible cambiar la contrase√±a sin eliminar la protecci√≥n de
know how del bloque. Cuando se cambian los ajustes de protecci√≥n contra copia o se elimina
dicha protecci√≥n, la contrase√±a se conserva hasta el pr√≥ximo proceso de compilaci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7771

Protecci√≥n de bloques
8.6 Establecer y quitar la protecci√≥n contra copia de un bloque
Si se establece una protecci√≥n contra copia para un bloque, es importante dotar a ese bloque
tambi√©n con una protecci√≥n de know-how. De lo contrario, cualquier persona puede desactivar
la protecci√≥n contra copia.
Nota
Observe las notas siguientes:
S7-1500 y S7-1200 V2.2 y superior: Si carga un bloque con protecci√≥n de copia en un
dispositivo que no coincide con el n√∫mero de serie determinado, se rechaza todo el proceso de
carga. Eso significa que tampoco se cargan bloques sin protecci√≥n contra copia.

Configurar protecci√≥n contra copia
Para configurar la protecci√≥n contra copia, proceda del siguiente modo:
1. Abra las propiedades del bloque para el que desea crear la protecci√≥n contra copia.
2. En las propiedades del bloque de la navegaci√≥n local seleccione la entrada "Protecci√≥n".
3. Seleccione la entrada "Asociar al n√∫mero de serie de la CPU" o "Asociar a n√∫mero de serie
de la Memory Card" en la secci√≥n "Protecci√≥n contra copia" de la lista desplegable.
4. Introduzca directamente el n√∫mero de serie o active la opci√≥n "N√∫mero de serie agregado
al cargar en un dispositivo o una Memory Card", si el n√∫mero de serie se debe insertar
autom√°ticamente en el proceso de carga.
Si ha introducido directamente el n√∫mero de serie, contin√∫e con el paso 7. Si el n√∫mero de
serie debe insertarse autom√°ticamente durante el proceso de carga, deber√°n ejecutarse
tambi√©n los pasos 5 y 6.
5. Haga clic en "Definir contrase√±a".
Se abre el cuadro de di√°logo "Definir protecci√≥n".
6. Si se emplea la entrada manual de la contrase√±a, introduzca la contrase√±a en los campos
"Contrase√±a nueva" y "Confirmar contrase√±a".
7. Si se utiliza un proveedor de contrase√±as, seleccione primero el proveedor de contrase√±as
y a continuaci√≥n la contrase√±a.
8. Confirme las entradas con "Aceptar".
En el campo de estado se indicar√° que se ha definido una contrase√±a de protecci√≥n contra
copia.
9. En el √°rea "Protecci√≥n de know-how" se puede configurar la protecci√≥n de know-how del
bloque, siempre que el bloque no tenga ya protecci√≥n de know-how.

7772

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.7 Establecer y quitar la protecci√≥n contra escritura de bloques

Quitar protecci√≥n contra copia
Para quitar la protecci√≥n contra copia, proceda del siguiente modo:
1. Abra las propiedades del bloque del que desea eliminar la protecci√≥n contra copia.
Nota
Si el bloque posee una protecci√≥n de know-how, para poder cambiar los ajustes a
protecci√≥n contra copia es necesario abrir el bloque con la contrase√±a correcta.
2. En las propiedades del bloque de la navegaci√≥n local seleccione la entrada "Protecci√≥n".
3. Seleccione la entrada "Sin binding" de la lista desplegable en el √°rea "Protecci√≥n contra
copia".

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.7

Establecer y quitar la protecci√≥n contra escritura de bloques
Es posible establecer una protecci√≥n contra escritura para bloques del tipo OB, FB y FC con
el fin de evitar que se modifiquen involuntariamente. Los bloques con una protecci√≥n contra
escritura solo pueden abrirse en modo de lectura, pero es posible seguir editando las
propiedades del bloque.
Tenga en cuenta que la protecci√≥n contra escritura no es una protecci√≥n de know-how, puesto
que la protecci√≥n contra escritura se puede volver a quitar en cualquier momento. Si un bloque
est√° protegido contra escritura, no es posible configurar adem√°s la protecci√≥n de know-how.
Si desea que el bloque est√© protegido por know-how, quite su protecci√≥n contra escritura.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7773

Protecci√≥n de bloques
8.7 Establecer y quitar la protecci√≥n contra escritura de bloques

Configurar la protecci√≥n contra escritura
Para configurar la protecci√≥n contra escritura de un bloque, proceda del siguiente modo:
1. Abra las propiedades del bloque para el que desea configurar la protecci√≥n contra escritura.
2. En las propiedades del bloque de la navegaci√≥n local seleccione la entrada "Protecci√≥n".
3. En el √°rea "Protecci√≥n contra escritura" haga clic en "Definir contrase√±a".
Se abre el cuadro de di√°logo "Definir protecci√≥n".
4. Si se emplea la entrada manual de la contrase√±a, introduzca la contrase√±a en los campos
"Contrase√±a nueva" y "Confirmar contrase√±a".
5. Si se utiliza un proveedor de contrase√±as, seleccione primero el proveedor de contrase√±as
y a continuaci√≥n la contrase√±a.
6. Confirme las entradas con "Aceptar".
En el campo de estado se indicar√° que se ha definido una contrase√±a de protecci√≥n contra
escritura. El texto del bot√≥n cambia a "Cambiar contrase√±a".
7. Haga clic en la casilla de verificaci√≥n "Protecci√≥n contra escritura".
Se abre el cuadro de di√°logo "Protecci√≥n de acceso".
8. Introduzca la contrase√±a correcta o, si utiliza un proveedor de contrase√±as, seleccione la
contrase√±a correcta.
La protecci√≥n contra escritura se activa y continuar√° activa a partir de la siguiente vez que
se abra el bloque.

Desactivar la protecci√≥n contra escritura
Para desactivar la protecci√≥n contra escritura, proceda del siguiente modo:
1. Abra las propiedades del bloque para el que desea desactivar la protecci√≥n contra
escritura.
2. En las propiedades del bloque de la navegaci√≥n local seleccione la entrada "Protecci√≥n".
3. En el √°rea "Protecci√≥n contra escritura" haga clic en la casilla de verificaci√≥n "Protecci√≥n
contra escritura".
Se abre el cuadro de di√°logo "Protecci√≥n de acceso".
4. Introduzca la contrase√±a correcta o, si utiliza un proveedor de contrase√±as, seleccione la
contrase√±a correcta.
La protecci√≥n contra escritura se desactiva, y el bloque podr√° ejecutarse de nuevo la
siguiente vez que se abra. Sin embargo, la contrase√±a se mantiene, de manera que la
protecci√≥n contra escritura puede activarse de nuevo en todo momento.

Activar la protecci√≥n contra escritura
Para activar de nuevo la protecci√≥n contra escritura, proceda del siguiente modo:
1. Abra las propiedades del bloque para el que desea activar de nuevo la protecci√≥n contra
escritura.
2. Seleccione la entrada "Protecci√≥n" en la ventana de inspecci√≥n, en la navegaci√≥n local.

7774

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.7 Establecer y quitar la protecci√≥n contra escritura de bloques
3. En el √°rea "Protecci√≥n contra escritura" haga clic en la casilla de verificaci√≥n "Protecci√≥n
contra escritura".
Se abre el cuadro de di√°logo "Protecci√≥n de acceso".
4. Introduzca la contrase√±a correcta o, si utiliza un proveedor de contrase√±as, seleccione la
contrase√±a correcta.
La protecci√≥n contra escritura se activa de nuevo para el bloque y continuar√° activa la
siguiente vez que se abra el bloque.

Cambiar contrase√±a de protecci√≥n contra escritura
Para cambiar la contrase√±a de protecci√≥n contra escritura, proceda del siguiente modo:
1. Abra las propiedades del bloque para el que desea cambiar la contrase√±a de protecci√≥n
contra escritura.
2. En las propiedades del bloque de la navegaci√≥n local seleccione la entrada "Protecci√≥n".
3. Haga clic en el bot√≥n "Cambiar contrase√±a".
Se abre el cuadro de di√°logo "Cambiar protecci√≥n".
4. Si se emplea la entrada manual de la contrase√±a, introduzca la contrase√±a antigua en el
campo "Contrase√±a antigua" y la contrase√±a nueva en el campo "Contrase√±a nueva".
Adem√°s, introduzca la contrase√±a nueva en el campo "Confirmar contrase√±a".
5. Si se utiliza un proveedor de contrase√±as, seleccione primero el proveedor de contrase√±as
y a continuaci√≥n la contrase√±a nueva.
6. Confirme las entradas con "Aceptar".
La contrase√±a de protecci√≥n contra escritura para el bloque cambia.
Nota
Siempre es posible cambiar la contrase√±a de protecci√≥n contra escritura para el bloque. Solo
depende de si la protecci√≥n contra escritura est√° activa o no.

Quitar la protecci√≥n contra escritura
Para quitar la protecci√≥n contra escritura de un bloque, proceda del siguiente modo:
1. Abra las propiedades del bloque del que desea eliminar la protecci√≥n contra escritura.
2. En las propiedades del bloque de la navegaci√≥n local seleccione la entrada "Protecci√≥n".
3. Haga clic en el bot√≥n "Cambiar contrase√±a".
Se abre el cuadro de di√°logo "Cambiar protecci√≥n".
4. Si se emplea la entrada manual de la contrase√±a, introduzca la contrase√±a actual en el
campo "Contrase√±a antigua".
5. Si se utiliza un proveedor de contrase√±as, seleccione primero el proveedor de contrase√±as
y a continuaci√≥n la contrase√±a actual.
6. Haga clic en "Eliminar".
La protecci√≥n contra escritura del bloque se elimina. Al contrario que al desactivar la
protecci√≥n contra escritura, tambi√©n se borra la contrase√±a.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7775

Protecci√≥n de bloques
8.8 Configurar la protecci√≥n de know-how para bloques

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.8

Configurar la protecci√≥n de know-how para bloques
Es posible configurar una protecci√≥n de know-how para los bloques en los dispositivos del
proyecto.

Procedimiento
Para configurar una protecci√≥n de know-how para bloques, proceda del siguiente modo:
1. Seleccione los bloques sin protecci√≥n de know-how que desea proteger.
2. En el men√∫ "Edici√≥n", elija el comando "Protecci√≥n de know-how".
Se abre el cuadro de di√°logo "Definir protecci√≥n".
3. Si se emplea la entrada manual de la contrase√±a, introduzca la contrase√±a en los campos
"Contrase√±a nueva" y "Confirmar contrase√±a".
4. Si se utiliza un proveedor de contrase√±as, seleccione primero el proveedor de contrase√±as
y a continuaci√≥n la contrase√±a.
5. Confirme las entradas con "Aceptar".
6. Cierre el cuadro de di√°logo "Definir protecci√≥n" con "Aceptar".

Resultado
Los bloques seleccionados se dotan con una protecci√≥n de know-how. Los bloques con
protecci√≥n de know-how se marcan con un candado en el √°rbol del proyecto. La contrase√±a es
v√°lida para todos los bloques seleccionados.

7776

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.9 Abrir bloques con protecci√≥n de know-how

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.9

Abrir bloques con protecci√≥n de know-how
Si como tipo de asignaci√≥n de contrase√±as se ha configurado el empleo de un proveedor de
contrase√±as, al abrir un bloque protegido el TIA Portal se conecta con el proveedor de
contrase√±as. Si la conexi√≥n se realiza correctamente no es necesario introducir la contrase√±a.
Si el proveedor de contrase√±as no est√° disponible, solo es posible abrir completamente el
bloque si como estrategia alternativa se ha establecido la entrada manual de la contrase√±a y
se conoce la contrase√±a correspondiente. En este caso el nombre de la contrase√±a no es
suficiente.
S√≥lo es posible abrir varios bloques con protecci√≥n de know-how en conjunto, si se protegen
con la misma contrase√±a.

Requisitos
‚óè Est√° configurado el tipo de asignaci√≥n de contrase√±as "Entrada manual de la contrase√±a".
‚óè Est√° configurado el tipo de asignaci√≥n de contrase√±as "Selecci√≥n mediante proveedor de
contrase√±a con entrada manual como estrategia alternativa para el acceso" y no existe
conexi√≥n con el proveedor de contrase√±as.

Procedimiento
Para abrir un bloque con protecci√≥n de know-how, proceda del siguiente modo:
1. Haga clic en el bloque que desea abrir.
Se abre el cuadro de di√°logo "Protecci√≥n de acceso".
2. Introduzca la contrase√±a para el bloque con protecci√≥n de know-how.
3. Confirme las entradas con "Aceptar".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7777

Protecci√≥n de bloques
8.10 Imprimir bloques con protecci√≥n de know-how

Resultado
Si se introduce la contrase√±a correcta, se abre el bloque con protecci√≥n de know-how. Sin
embargo, la protecci√≥n de know-how del bloque no se anula. Si el bloque se copia o se inserta
a una librer√≠a, el know-how de las copias tambi√©n estar√° protegido.
Despu√©s de abrir el bloque, el c√≥digo del programa y la interfaz del bloque se pueden editar
hasta que se cierre el bloque o el TIA Portal. Cuando se vuelva a abrir el bloque, ser√° necesario
volver a introducir la contrase√±a. Si se cierra el cuadro de di√°logo "Protecci√≥n de acceso" con
"Cancelar", el bloque se abre pero el c√≥digo del bloque no se visualiza y por consiguiente el
bloque no se puede editar.

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.10

Imprimir bloques con protecci√≥n de know-how
S√≥lo es posible imprimir completamente los bloques con protecci√≥n de know-how si el bloque
en cuesti√≥n se ha abierto con la contrase√±a correcta. Si se imprime un bloque cerrado o se
abre con una contrase√±a incorrecta, s√≥lo se imprimir√°n los datos del bloque que no est√©n
protegidos.

Procedimiento
Para imprimir completamente un bloque con protecci√≥n de know-how, proceda del siguiente
modo:
1. Abra el bloque con protecci√≥n de know-how que desea imprimir.
Consulte tambi√©n: Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
2. Elija el comando "Imprimir" del men√∫ "Proyecto".
Se abre el cuadro de di√°logo "Imprimir".
3. Seleccione la impresora en el campo "Nombre".
4. Haga clic en "Avanzadas", para editar los ajustes de Windows de la impresora.

7778

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.11 Cambiar la contrase√±a
5. Seleccione en la lista desplegable "Informaci√≥n del documento" el juego de datos del
documento que se debe utilizar para el dise√±o del borde.
6. En "Impresi√≥n de objeto/√°rea desactivada", elija si desea imprimir todo el objeto o el √°rea
completa, o bien √∫nicamente una selecci√≥n.
7. Seleccione el alcance de la impresi√≥n en "Propiedades".
‚Äì Elija "Todos" para imprimir todo el bloque.
‚Äì Elija "Visible" para imprimir toda la informaci√≥n actualmente visible en pantalla del
interior del bloque.
‚Äì Elija "Compacto" para imprimir el bloque en un formato reducido.
8. Haga clic en "Vista preliminar" para generar una vista preliminar.
En el √°rea de trabajo se crea una vista preliminar.
9. Haga clic en "Imprimir" para iniciar la impresi√≥n.

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Cambiar la contrase√±a (P√°gina 7779)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.11

Cambiar la contrase√±a
Si se utiliza un proveedor de contrase√±as, de las especificaciones del mismo depende que se
pueda modificar la contrase√±a para bloques con protecci√≥n de know-how.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7779

Protecci√≥n de bloques
8.12 Quitar la protecci√≥n de know-how para los bloques

Procedimiento
Para cambiar la contrase√±a, proceda del siguiente modo:
1. Seleccione los bloques con protecci√≥n de know-how cuya contrase√±a desea cambiar.
Nota
Si desea cambiar simult√°neamente la contrase√±a de varios bloques, los bloques
seleccionados deben tener la misma contrase√±a.
2. En el men√∫ "Edici√≥n", elija el comando "Protecci√≥n de know-how".
Se abre el cuadro de di√°logo "Cambiar protecci√≥n".
3. Si se emplea la entrada manual de la contrase√±a, introduzca la contrase√±a antigua en el
campo "Contrase√±a antigua" y la contrase√±a nueva en el campo "Contrase√±a nueva".
Adem√°s, introduzca la contrase√±a nueva en el campo "Confirmar contrase√±a".
4. Si se utiliza un proveedor de contrase√±as, seleccione primero el proveedor de contrase√±as
y a continuaci√≥n la contrase√±a nueva.
5. Cierre el cuadro de di√°logo "Cambiar protecci√≥n" con "Aceptar".

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Quitar la protecci√≥n de know-how para los bloques (P√°gina 7780)

8.12

Quitar la protecci√≥n de know-how para los bloques
Si se utiliza un proveedor de contrase√±as, de las especificaciones del mismo depende que se
pueda eliminar la protecci√≥n de know-how de un bloque.

7780

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Protecci√≥n de bloques
8.12 Quitar la protecci√≥n de know-how para los bloques

Procedimiento
Para quitar la protecci√≥n de know-how para los bloques, proceda del siguiente modo:
1. Seleccione el bloque cuya protecci√≥n de know-how desea quitar.
Nota
Si desea quitar simult√°neamente la protecci√≥n de know-how de varios bloques, los bloques
seleccionados deben tener la misma contrase√±a.
2. En el men√∫ "Edici√≥n", elija el comando "Protecci√≥n de know-how".
Se abre el cuadro de di√°logo "Cambiar protecci√≥n".
3. Si se emplea la entrada manual de la contrase√±a, introduzca en el campo "Contrase√±a
antigua" la contrase√±a para la protecci√≥n de know-how del bloque. No es necesario hacerlo
si se utiliza un proveedor de contrase√±as.
4. Haga clic en el bot√≥n "Eliminar".

Resultado
La protecci√≥n de know-how del bloque se elimina.

Consulte tambi√©n
Proteger bloques (P√°gina 7763)
Vincular un proveedor de contrase√±as (P√°gina 7766)
Mostrar proveedores de contrase√±as disponibles (P√°gina 7768)
Registrar actividades de los proveedores de contrase√±as (P√°gina 7769)
Definir el tipo de asignaci√≥n de contrase√±as (P√°gina 7770)
Establecer y quitar la protecci√≥n contra copia de un bloque (P√°gina 7771)
Establecer y quitar la protecci√≥n contra escritura de bloques (P√°gina 7773)
Configurar la protecci√≥n de know-how para bloques (P√°gina 7776)
Abrir bloques con protecci√≥n de know-how (P√°gina 7777)
Imprimir bloques con protecci√≥n de know-how (P√°gina 7778)
Cambiar la contrase√±a (P√°gina 7779)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7781

Protecci√≥n de bloques
8.12 Quitar la protecci√≥n de know-how para los bloques

7782

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

9

Declaraci√≥n de la interfaz del bloque
9.1

Descripci√≥n de la interfaz de bloque

Introducci√≥n
La interfaz contiene las declaraciones de las variables y constantes locales que se utilizan en
el bloque. Las variables se dividen en dos grupos:
‚óè Par√°metros de bloque que forman la interfaz de bloque para la llamada del bloque en el
programa.
‚óè Datos locales que sirven para almacenar resultados intermedios.
La declaraci√≥n de variables permite determinar la interfaz de llamada de un bloque en el
programa, as√≠ como el nombre y el tipo de datos de las variables y constantes que se desean
utilizar en el bloque.
La interfaz de los bloques de funci√≥n define adem√°s la estructura de las instancias que se
asignan al bloque de funci√≥n.

Representaci√≥n tabular o textual de la interfaz del bloque
Por defecto la interfaz se muestra en la vista tabular. En SCL la interfaz tambi√©n puede
representarse en una vista textual.
Consulte tambi√©n:
Seleccionar representaci√≥n tabular o textual de la interfaz del bloque (P√°gina 7790)

Par√°metros del bloque
La tabla siguiente muestra los tipos de par√°metros del bloque:
Tipo

Secci√≥n

Funci√≥n

Disponible en

Par√°metros de entrada

Input

Par√°metros cuyos valores lee el bloque.

Funciones, bloques de funci√≥n
y algunos tipos de bloques de
organizaci√≥n

Par√°metros de salida

Output

Par√°metros cuyos valores escribe el bloque. Funciones y bloques de fun‚Äê
ci√≥n

Par√°metros de entrada/salida

InOut

El bloque lee los valores de estos par√°me‚Äê
Funciones y bloques de fun‚Äê
tros al efectuar la llamada y los vuelve a es‚Äê ci√≥n
cribir en ellos tras la ejecuci√≥n.

Valor de retorno

Return

Valor que se devuelve al bloque que realiza
la llamada.

Funciones

Seg√∫n el tipo del bloque abierto se pueden visualizar m√°s secciones.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7783

Declaraci√≥n de la interfaz del bloque
9.1 Descripci√≥n de la interfaz de bloque

Datos locales
La tabla siguiente muestra los tipos de datos locales:
Tipo

Secci√≥n

Funci√≥n

Disponible en

Datos locales temporales

Temp

Variables que sirven para almacenar resul‚Äê
tados intermedios temporales. Los datos
temporales se conservan solo durante un ci‚Äê
clo. Si utiliza datos locales temporales, se
debe asegurar de que los valores se escri‚Äê
ben dentro del ciclo en el que desea leerlos.

Funciones, bloques de funci√≥n
y bloques de organizaci√≥n

Nota:

Nota:
en los bloques de datos de ins‚Äê
tancia no se visualizan los da‚Äê
tos locales temporales.

Si utiliza datos locales temporales en funcio‚Äê
nes (FC) con acceso est√°ndar, inicialice los
datos antes de usarlos. De lo contrario los
valores pueden ser aleatorios.
Datos locales est√°ticos

Static

Variables que sirven para almacenar resul‚Äê Bloques de funci√≥n
tados intermedios est√°ticos en el bloque de
datos de instancia. Los datos est√°ticos se
conservan hasta que se vuelven a escribir,
tambi√©n a lo largo de varios ciclos. Los nom‚Äê
bres de los bloques que son llamados como
multiinstancia en un bloque l√≥gico tambi√©n
se depositan en datos locales est√°ticos.

Constante

Constant

Constantes con nombres simb√≥licos decla‚Äê
rados que se utilizan dentro del bloque.

Funciones, bloques de funci√≥n
y bloques de organizaci√≥n
Nota:
en los bloques de datos de ins‚Äê
tancia no se visualizan las
constantes locales.

Consulte tambi√©n
Variables (P√°gina 102)
Palabras clave (P√°gina 95)
Tipos de datos v√°lidos en la interfaz de bloque (P√°gina 7787)
Remanencia de las variables locales (P√°gina 7789)
Principios b√°sicos de las constantes (P√°gina 103)
Transferencia de par√°metros en la llamada de un bloque (P√°gina 80)
Utilizar valores de ajuste durante la puesta en marcha (P√°gina 7882)

7784

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.2 Reglas de la declaraci√≥n de la interfaz del bloque

9.2

Reglas de la declaraci√≥n de la interfaz del bloque

9.2.1

Reglas generales de la declaraci√≥n de la interfaz del bloque

Uso de par√°metros de bloque
Para el uso de par√°metros de bloque en un bloque rigen las reglas siguientes:
‚óè Los par√°metros de entrada solo pueden leerse.
‚óè Los par√°metros de salida solo pueden escribirse.
‚óè Los par√°metros de entrada/salida pueden leerse y escribirse.
Nota
N√∫mero m√°ximo de par√°metros por bloque
El n√∫mero m√°ximo permitido de par√°metros formales es suficiente para todos los casos de
aplicaciones habituales. El n√∫mero exacto depende, entre otros, de los tipos de datos
seleccionados y de las secciones de declaraci√≥n.
En caso de exceder el n√∫mero m√°ximo aparecer√° un mensaje durante el proceso de
compilaci√≥n. En este caso se pueden agrupar varios par√°metros en un tipo de datos PLC
(UDT) o en un bloque de datos global (DB) y transferir el tipo o el bloque en forma de par√°metro
de bloque.

Asignar valores predeterminados a los par√°metros de bloque
Es posible asignar valores predeterminados a determinados par√°metros en la interfaz de los
bloques de funci√≥n. La posibilidad de asignar estos valores depende de la secci√≥n de
declaraci√≥n y del tipo de datos de cada par√°metro. Si no se introduce ning√∫n valor
predeterminado, se utilizar√° el valor predefinido para el tipo de datos indicado. Por ejemplo, el
valor predefinido para BOOL es "false".
La tabla siguiente muestra a qu√© par√°metros puede asignarse un valor predeterminado:
Tipo de par√°metro

Secci√≥n

Par√°metros de entrada Input

Es posible asignar un valor predeterminado
Tipos de datos simples Tipos de datos estruc‚Äê
turados

Tipos de par√°metros

X

X

-

Par√°metros de salida

Output

X

X

-

Par√°metros de entra‚Äê
da/salida

InOut

X

- (1)

-

Datos locales est√°ticos Static

X

X

-

Datos locales tempora‚Äê Temp
les

-

-

-

Constantes

X

-

-

Constant

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7785

Declaraci√≥n de la interfaz del bloque
9.2 Reglas de la declaraci√≥n de la interfaz del bloque
Excepci√≥n: en los bloques con acceso optimizado, en determinadas condiciones existe la
posibilidad de utilizar tipos de datos PLC como valores predeterminados.

(1)

Nota
Encontrar√° m√°s informaci√≥n sobre los caracteres admisibles en nombres de variables en el
Siemens Industry Online Support, en el art√≠culo siguiente:
¬øCu√°ndo hay que utilizar identificadores u operandos "entre comillas" en STEP 7 (TIA Portal)?
https://support.industry.siemens.com/cs/ww/es/view/10947785 (https://
support.industry.siemens.com/cs/ww/es/view/109477857)
Encontrar√° recomendaciones para nombrar variables un√≠vocamente en todo el proyecto en la
gu√≠a de estilo del programador:
https://support.industry.siemens.com/cs/ww/de/view/109478084 (https://
support.industry.siemens.com/cs/ww/es/view/81318674)

Consulte tambi√©n
Variables (P√°gina 102)
Palabras clave (P√°gina 95)
Declarar par√°metros actuales predefinidos (P√°gina 7805)

9.2.2

Tipos de datos v√°lidos en la interfaz de bloque

Tipos de datos v√°lidos en la interfaz de bloque, en S7-300/400
La tabla siguiente muestra a qu√© tipos de datos pueden asignarse los par√°metros en las
diferentes secciones de la interfaz.
Secci√≥n

Est√°ndar

ARRAY

Tipos de da‚Äê
tos

STRUCT

Tipos de pa‚Äê
r√°metros

VOID

POINTER

ANY

-

-

-

X

-

-

-

-

STRING
DT

Bloque de organizaci√≥n
Temp

X

X

Constant

X

X

X

X

X

-

X

X

(3)

Bloque de funci√≥n
Input
Output

X

X

-

-

-

-

InOut

X

X(1)

-

-

X

X

Static

X

X

-

-

-

-

Temp

X

X

-

-

-

X

7786

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.2 Reglas de la declaraci√≥n de la interfaz del bloque
Secci√≥n

Est√°ndar

ARRAY

Tipos de da‚Äê
tos

STRUCT

Tipos de pa‚Äê
r√°metros

VOID

POINTER

ANY

STRING
DT

Constant

X

X (3)

-

-

-

-

Input

X

X (1)

X

-

X

X

Output

X

X

(1)

-

-

X

X

InOut

X

X(1)

-

-

X

X

Funci√≥n

Temp

X

X

-

-

-

X

Return

X

X

-

X

X

X (2)

Constant

X

X (3)

-

-

-

-

(1)

STRING solo puede definirse en la longitud est√°ndar de 254 caracteres.

(2)

En SCL, ANY no se admite como valor de funci√≥n.

(3)

No se admiten constantes con los tipos de datos ARRAY o STRUCT.

Consulte tambi√©n
Transferencia de par√°metros en la llamada de un bloque (P√°gina 80)

9.2.3

Tipos de datos v√°lidos en la interfaz de bloque

Tipos de datos v√°lidos en la interfaz de bloque, en S7-1200
La tabla siguiente muestra qu√© tipos de datos pueden asignarse en los par√°metros de las
diferentes secciones de la interfaz.
Secci√≥n

Est√°ndar

ARRAY

Tipos de datos

STRUCT

ARRAY [*]

VOID

VARIANT

STRING/
WSTRING
DT
Bloque de organizaci√≥n
Temp

X

X (5)

-

-

X

Constant

X

X

-

-

-

X

X

-

-

X

(1) (2)

Bloque de funci√≥n
Input
Output

X

X

-

-

-

InOut

X

X (1)

X (4)

-

X

Static

X

X

-

-

-

Temp

X

X (5)

-

-

X

Constant

X

X

-

-

-

(1) (2)

Funci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7787

Declaraci√≥n de la interfaz del bloque
9.2 Reglas de la declaraci√≥n de la interfaz del bloque
Secci√≥n

Est√°ndar

ARRAY

Tipos de datos

STRUCT

ARRAY [*]

VOID

VARIANT

STRING/
WSTRING
DT
Input

X

X (1)

X (4)

-

X

Output

X

X (1)

X (4)

-

X

InOut

X

X (1)

X (4)

-

X

Temp

X

X (5)

-

-

X

Return

X

X (3)

-

X

-

Constant

X

X

-

-

-

(1) (2)

En estas secciones no se pueden indicar declaraciones de longitud para STRING y WSTRING. Los STRING siempre
tienen una longitud est√°ndar de 254 y los WSTRING, de 16832. La declaraci√≥n en formato MyString[3] no ser√≠a admisible.
En estas secciones, WSTRING solo est√° permitido en bloques con acceso optimizado.

(1)

(2)

No se admiten constantes con los tipos de datos ARRAY o STRUCT.

(3)

Los valores de funci√≥n del tipo de datos WSTRING no pueden tener m√°s de 1022 caracteres.

(4)

ARRAY[*] est√° disponible a partir del firmware V4.2 en bloques con acceso optimizado.

Los accesos a tipos de datos estructurados (p. ej., ARRAY, STRUCT, tipo de datos PLC, etc.) que se hayan declarado en
la secci√≥n "Temp", pueden influir en el tiempo de ejecuci√≥n del programa. En tal caso, no acceda a toda la estructura sino a
los distintos elementos de la misma.
(5)

Tipos de datos v√°lidos en la interfaz de bloque, en S7-1500
La tabla siguiente muestra qu√© tipos de datos pueden asignarse en los par√°metros de las
diferentes secciones de la interfaz.
Secci√≥n

Est√°n‚Äê
dar

ARRAY

Tipos
de da‚Äê
tos

STRING/
WSTRIN
G

STRUCT

ARRAY[ Tipos
VOID
*]
de par√°‚Äê
metros

DB_AN
Y

POIN‚Äê
TER

ANY

VA‚Äê
RIANT

REF_T
O

DT
Bloque de organizaci√≥n
Temp

X

X(9)

-

- (4)

-

X

-

X (3)

X

X

Constant

X

X

-

-

-

-

-

-

-

-

Input

X

X

-

X

-

X

X

X

X

-

Output

X

X

-

-

-

X

-

-

-

-

InOut

X

X (1)

X(7)(8)

- (4)

-

X

X

X

X

-

Static

X

X

-

-

-

X

-

-

-

-

Temp

X

X

-

-

-

X

-

X

X

X

Constant

X

X (1) (5)

-

-

-

-

-

-

-

-

Input

X

X (1)

X(7)

X

-

X

X

X

X

X

Output

X

X

X

-

-

X

X

X

X

X

InOut

X

X (1)

X(7)

- (4)

-

X

X

X

X

-

(1) (5)

Bloque de funci√≥n

(9)

(4)

(3)

Funci√≥n

7788

(1)

(7)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.2 Reglas de la declaraci√≥n de la interfaz del bloque
Secci√≥n

Est√°n‚Äê
dar

ARRAY

Tipos
de da‚Äê
tos

STRING/
WSTRIN
G

STRUCT

ARRAY[ Tipos
VOID
*]
de par√°‚Äê
metros

DB_AN
Y

POIN‚Äê
TER

ANY

VA‚Äê
RIANT

REF_T
O

DT
Temp

X

X(9)

-

- (4)

-

X

-

X (3)

X

X

Return

X

X

(6)

-

-

X

X

X

x

-

X

Constant

X

X

(1) (5)

-

-

-

-

-

-

-

-

(2)

En estas secciones no se pueden indicar declaraciones de longitud para STRING y WSTRING. Los STRING
siempre tienen una longitud est√°ndar de 254 y los WSTRING, de 16832. La declaraci√≥n en formato MyString[3] no
ser√≠a admisible. En estas secciones, WSTRING solo est√° permitido en bloques con acceso optimizado.

(1)

(2)

En SCL, ANY no se admite como valor de funci√≥n.

(3)

ANY solo puede utilizarse en bloques con acceso est√°ndar de la secci√≥n "Temp".

(4)

El tipo de par√°metros "INSTANCE" es la √∫nica excepci√≥n permitida en las secciones "TEMP" e "InOut".

(5)

No se admiten constantes con los tipos de datos ARRAY o STRUCT.

(6)

Los valores de funci√≥n del tipo de datos WSTRING no pueden tener m√°s de 1022 caracteres.

(7)

ARRAY[*] est√° disponible a partir del firmware V2.0 en bloques con acceso optimizado.

(8)

ARRAY[*] solo est√° disponible si no se ha activado el atributo "Ajustar en IDB".

Los accesos a tipos de datos estructurados (p. ej., ARRAY, STRUCT, tipo de datos PLC, etc.) que se hayan
declarado en la secci√≥n "Temp", pueden influir en el tiempo de ejecuci√≥n del programa. En tal caso, no acceda a
toda la estructura sino a los distintos elementos de la misma.
(9)

Consulte tambi√©n
Transferencia de par√°metros en la llamada de un bloque (P√°gina 80)

9.2.4

Remanencia de las variables locales

Introducci√≥n
Los bloques de funci√≥n almacenan sus datos en una instancia. Para impedir la p√©rdida de
estos datos en caso de un corte de alimentaci√≥n, los datos pueden marcarse como
remanentes. Entonces se guardar√°n en un √°rea de memoria remanente. Las posibilidades de
ajustar la remanencia dependen del tipo de acceso configurado para el bloque de funci√≥n.

Comportamiento remanente en los bloques con acceso est√°ndar
En los bloques con acceso est√°ndar, el comportamiento remanente de las distintas variables
no puede ajustarse. S√≥lo se pueden definir como remanentes en la instancia asignada. Todas
las variables que contiene son consideradas entonces remanentes.

Remanencia en el acceso optimizado a bloques
En los bloques de datos con acceso optimizado se puede definir el comportamiento de
remanencia de las distintas variables.
Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7789

Declaraci√≥n de la interfaz del bloque
9.3 Seleccionar representaci√≥n tabular o textual de la interfaz del bloque
En las variables de tipo de datos estructurado, la configuraci√≥n de remanencia se aplica
siempre a la totalidad de la estructura. No se puede ajustar la remanencia individualmente para
cada uno de los elementos de la estructura.
En la secci√≥n "InOut" no se pueden crear variables remanentes de tipos de datos
estructurados. Los par√°metros de entrada/salida con tipo de datos estructurado, p. ej. ARRAY,
STRUCT o STRING siempre son no remanentes.
Existen los siguientes ajustes:
‚óè Remanente
Los valores de la variable o estructura est√°n disponibles incluso despu√©s de un corte de
alimentaci√≥n.
‚óè No remanente
Los valores de la variable o estructura se pierden en caso de corte de alimentaci√≥n.
‚óè Ajustar en IDB
La remanencia se puede ajustar en el bloque de datos instancia. El ajuste realizado en el
bloque de datos instancia rige, sin embargo, de forma centralizada para todas las variables
que est√°n marcadas con "Ajustar en IDB".

Consulte tambi√©n
Propiedades de variables y constantes locales (P√°gina 7829)
Fundamentos del acceso a bloques (P√°gina 54)

9.3

Seleccionar representaci√≥n tabular o textual de la interfaz del bloque

Representaci√≥n tabular o textual de la interfaz de bloque
Por defecto la interfaz se muestra en la vista de tabla. En SCL la interfaz tambi√©n puede
representarse en una vista de texto.
La representaci√≥n de la interfaz de un bloque SCL se puede configurar de forma centralizada.
Si selecciona la representaci√≥n textual como ajuste predeterminado, la interfaz de todos los
bloques generados a partir de ese momento se mostrar√° en la vista de texto.
Los elementos siguientes solo se pueden utilizar en la vista de texto:
‚óè Comentarios entre las secciones o al inicio de una secci√≥n
‚óè Varias secciones de un tipo (p.ej. VAR_INPUT).
Nota
Bloques de seguridad y bloques de sistema
Con bloques de seguridad y bloques de sistema, la interfaz se muestra exclusivamente en la
representaci√≥n tabular.

7790

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Configurar la representaci√≥n de la interfaz para bloques nuevos
Para configurar la representaci√≥n de la interfaz para bloques nuevos, proceda del siguiente
modo:
1. Elija el comando "Configuraci√≥n" del men√∫ "Opciones".
Se abre la ventana "Configuraci√≥n" en el √°rea de trabajo.
2. Seleccione el grupo "Programaci√≥n PLC > SCL" en la navegaci√≥n local.
3. Vaya a "Ajuste predeterminado para bloques nuevos > Interfaz de bloque" y elija la vista
deseada de la interfaz.
Si crea bloques nuevos, su interfaz se representar√° en la vista seleccionada.
Nota
Representaci√≥n de la interfaz tras importar un bloque
Tras importar un bloque su interfaz se representa en la vista de tabla.

Consulte tambi√©n
Estructura de la interfaz de bloque (P√°gina 7791)
Estructura de la interfaz de bloque textual (P√°gina 7809)

9.4

Declaraci√≥n de la interfaz de bloque

9.4.1

Estructura de la interfaz de bloque

Estructura de la interfaz de bloque
La siguiente figura muestra la estructura de la interfaz de bloque. El n√∫mero de columnas y
secciones var√≠a seg√∫n el tipo de bloque.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7791

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Significado de las columnas
En la siguiente tabla se explica el significado de las distintas columnas. Las columnas pueden
mostrarse u ocultarse seg√∫n convenga. El n√∫mero de columnas mostradas var√≠a en funci√≥n de
la familia de CPU y del tipo de objeto que est√© abierto.
Columna

Explicaci√≥n
S√≠mbolo en el que se puede hacer clic para arrastrar un elemento
mediante Drag & Drop hasta un programa y utilizarlo all√≠ como ope‚Äê
rando.

Nombre

Nombre del elemento.

Tipo de datos

Tipo de datos del elemento.

Offset

Direcci√≥n relativa de una variable del bloque. Esta columna solo es
visible en los bloques con acceso est√°ndar.
Nota:
Muchas instrucciones de las librer√≠as de sistema SIMATIC tienen la
propiedad "Acceso optimizado al bloque" y por tanto no ocupan di‚Äê
recciones de memoria fijas. Para estas instrucciones no se muestra
ning√∫n offset aunque se utilicen como multiinstancia en un bloque de
acceso est√°ndar.

Valor predeterminado

Valor que permite predeterminar determinadas variables en la interfaz
del bloque l√≥gico o bien valor de una constante local.
La indicaci√≥n del valor predeterminado es opcional para variables. Si
no se especifica ning√∫n valor, se utilizar√° el valor predefinido para el
tipo de datos indicado. Por ejemplo, el valor predefinido para BOOL es
"false".
El valor predeterminado de una variable se aplica como valor de
arranque en el respectivo bloque de datos de instancia. Los valores
aplicados pueden sustituirse en el bloque de datos de instancia por los
valores de arranque espec√≠ficos de la instancia.
Las constantes siempre tienen el valor predeterminado que se declar√≥
en la interfaz de bloque. No se visualizan en los bloques de datos de
instancia y por tanto tampoco se les puede asignar valores espec√≠fi‚Äê
cos de la instancia.

Remanencia

Marca una variable como remanente.
Los valores de las variables remanentes se conservan incluso tras
desconectar la alimentaci√≥n.
Esta columna solo es visible en la interfaz de bloques de funci√≥n con
acceso optimizado.

Visible en HMI Engineering

Indica si una variable est√° visible en la lista de selecci√≥n de HMI de
forma predeterminada.

Accesible desde HMI / OPC
UA / Web API

Indica si HMI / OPC UA / Web API puede acceder a esta variable en
tiempo de ejecuci√≥n.

Escribible desde HMI / OPC
UA / Web API

Indica si la variable puede escribirse desde HMI / OPC UA / Web API
en tiempo de ejecuci√≥n.

Valor de ajuste

Marca una variable como valor de ajuste. Los valores de ajuste son
valores que requieren un ajuste fino en la puesta en marcha.
Esta columna solo existe en la interfaz de bloques de funci√≥n.

7792

Supervisi√≥n

Muestra si para la variable se ha creado una supervisi√≥n para el diag‚Äê
n√≥stico de proceso.

Comentario

Comentario para documentar el elemento.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Consulte tambi√©n
Variables (P√°gina 102)
Palabras clave (P√°gina 95)
Tipos de datos v√°lidos en la interfaz de bloque (P√°gina 7787)
Remanencia de las variables locales (P√°gina 7789)
Principios b√°sicos de las constantes (P√°gina 103)
Seleccionar representaci√≥n tabular o textual de la interfaz del bloque (P√°gina 7790)
Transferencia de par√°metros en la llamada de un bloque (P√°gina 80)
Utilizar valores de ajuste durante la puesta en marcha (P√°gina 7882)

9.4.2

Declarar variables y constantes locales en la interfaz del bloque

Requisitos
La interfaz del bloque est√° abierta.

Procedimiento
Para declarar una variable o constante, proceda del siguiente modo:
1. Seleccione la secci√≥n de declaraci√≥n que desee en la interfaz de bloque.
Las constantes deben declararse en la secci√≥n "Constant".
2. En la columna "Nombre", introduzca un nombre para el elemento.
3. Introduzca el tipo de datos deseado en la columna "Tipo de datos". Al introducirlo, se
dispone de la funci√≥n de autocompletar.
4. Introduzca un valor para constantes en la columna "Valor predeterminado".
5. Opcionalmente: Modifique las propiedades que se visualizan en las otras columnas de la
interfaz del bloque.

Resultado
Se crea el elemento.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7793

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Comprobaci√≥n de sintaxis
Cada vez que se efect√∫a una entrada se comprueba la sintaxis. Si hay errores, se destacan en
color rojo. No es necesario corregir estos errores inmediatamente, sino que es posible
continuar con la edici√≥n y efectuar las correcciones necesarias en un momento posterior. No
obstante, mientras que la declaraci√≥n de variables contenga errores de sintaxis, no se podr√°
compilar el programa.
Nota
Si se modifica la interfaz de un bloque, las llamadas del bloque ser√°n posiblemente
incoherentes en el programa. Los puntos de llamada se actualizan autom√°ticamente si es
posible.
Si no es posible una actualizaci√≥n autom√°tica, se tendr√°n que actualizar manualmente las
llamadas de bloque incoherentes.
Consulte tambi√©n:
Actualizar llamadas de bloque en KOP (P√°gina 7966)
Actualizar llamadas de bloque en FUP (P√°gina 8027)

Consulte tambi√©n
Reglas de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)
Variables (P√°gina 102)
Constantes (P√°gina 103)
Declarar variables del tipo de datos ARRAY (P√°gina 7796)
Declarar variables del tipo de datos STRUCT (P√°gina 7798)
Declaraci√≥n de variables del tipo de datos STRING y WSTRING (P√°gina 7799)
Declarar variables basadas en un tipo de datos PLC (P√°gina 7800)
Declarar variables superpuestas (P√°gina 7801)
Declarar multiinstancias (P√°gina 7802)
Declaraci√≥n de instancias de par√°metro (P√°gina 7803)
Principios b√°sicos de los valores de arranque (P√°gina 7853)
Remanencia de las variables locales (P√°gina 7789)
Propiedades de variables y constantes locales (P√°gina 7829)

9.4.3

Declarar una variable local en el editor de programaci√≥n

Requisitos
El editor de programaci√≥n est√° abierto.

7794

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Procedimiento
Para declarar una variable local, proceda del siguiente modo:
1. Inserte una instrucci√≥n en el programa.
Las cadenas de caracteres "<???>", "<??.?>" o "..." representan comodines de operandos.
2. Reemplace un comod√≠n de operando con el nombre de la variable que se va a crear.
3. Seleccione el nombre del elemento.
Si desea declarar varios elementos, seleccione los nombres de todos los elementos que
desea declarar.
4. Elija el comando "Definir variable" del men√∫ contextual.
Se abre el cuadro de di√°logo "Definir variable". Muestra una tabla de declaraci√≥n en la que
ya figura el nombre del elemento.
5. Para declarar una variable local, seleccione una de las secciones siguientes:
‚Äì Local In
‚Äì Local Out
‚Äì Local InOut
‚Äì Local Static
‚Äì Local Temp
6. Introduzca el tipo de datos y el comentario en las respectivas columnas.
7. Haga clic en el bot√≥n "Definir" para finalizar la entrada.

Resultado
La declaraci√≥n se escribe directamente en la interfaz del bloque y es v√°lida en todo el bloque.
Nota
Si se modifica la interfaz de un bloque, las llamadas del bloque ser√°n posiblemente
incoherentes en el programa. Los puntos de llamada se actualizan autom√°ticamente si es
posible.
Si no es posible una actualizaci√≥n autom√°tica, se tendr√°n que actualizar manualmente las
llamadas de bloque incoherentes.
Consulte tambi√©n:
Actualizar llamadas de bloque en KOP (P√°gina 7966)
Actualizar llamadas de bloque en FUP (P√°gina 8027)

Consulte tambi√©n
Variables (P√°gina 102)
Palabras clave (P√°gina 95)
Principios b√°sicos de los valores de arranque (P√°gina 7853)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7795

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque
Propiedades de variables y constantes locales (P√°gina 7829)
Remanencia de las variables locales (P√°gina 7789)
Edici√≥n de la tabla de la interfaz de bloque (P√°gina 7806)
Reglas de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)

9.4.4

Declarar variables del tipo de datos ARRAY

Requisitos
La interfaz del bloque est√° abierta.

Procedimiento
Para declarar una variable del tipo de datos ARRAY, proceda del siguiente modo:
1. Seleccione la secci√≥n de declaraci√≥n que desee en la interfaz de bloque.
2. Introduzca un nombre de variable en la columna "Nombre".
3. Haga clic en el bot√≥n para la selecci√≥n del tipo de datos de la columna "Tipo de datos".
Se abre una lista de los tipos de datos permitidos.
4. Seleccione el tipo de datos "Array".
Se abre el cuadro de di√°logo "Array".
5. Indique el tipo de datos de los elementos ARRAY en el campo de entrada "Tipo de datos".
6. A continuaci√≥n, indique los l√≠mites inferior y superior de cada dimensi√≥n en el campo
"L√≠mites de matriz".
Ejemplo de un ARRAY unidimensional:
Array[0..3] of Bool
Ejemplo de un ARRAY tridimensional:
Array[0..3, 0..15, 0..33]of Bool
Ejemplo de un Array unidimensional con l√≠mites variables:
Array[*]of Bool
Ejemplo de un ARRAY tridimensional con l√≠mites variables:
Array[*, *, *]of Bool
Ejemplo de un ARRAY unidimensional con constantes locales como l√≠mites de ARRAY
Array[#My_local_const1..#My_local_const2]of Bool
Ejemplo de un ARRAY unidimensional con constantes globales como l√≠mites de ARRAY
Array["My_global_const1".."My_global_const1"]of Bool
7. Confirme la entrada.
8. Opcionalmente: Modifique las propiedades de las variables que se visualizan en las otras
columnas de la interfaz de bloque.

7796

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque
Se crea la variable, pero permanece contra√≠da. Para expandir el ARRAY, haga clic en el
tri√°ngulo situado delante de la variable. Tenga en cuenta que los ARRAYs de m√°s de 10000
elementos no pueden expandirse para garantizar una mayor claridad.
Nota
Disponibilidad de ARRAY[*]
ARRAY[*] est√° disponible en las CPU de la serie S7-1200 a partir de la versi√≥n de firmware >=
4.2 y en las CPU de la serie S7-1500 a partir de la versi√≥n de firmware >= 2.0 en bloques
optimizados. En las funciones (FC) es posible utilizar ARRAY[*] en todas las secciones de
declaraci√≥n. En los bloques de funci√≥n (FB) solo es posible declarar ARRAY[*] como
par√°metro de entrada/salida en la secci√≥n "InOut".

Introducir valores predeterminados de elementos ARRAY
Para preseleccionar los valores predeterminados de los distintos elementos de un ARRAY,
proceda del siguiente modo:
1. Haga clic en el tri√°ngulo situado delante de la variable del tipo de datos ARRAY.
El ARRAY se expande y cada uno de sus elementos aparece en una fila.
2. Introduzca los valores deseados en la columna "Valor predeterminado".

Comentar ARRAYs
Para introducir un comentario para todo el ARRAY, introd√∫zcalo en la fila superior de la
declaraci√≥n ARRAY. El comentario se utiliza como ajuste predeterminado para todos los
elementos ARRAY subordinados.
Para asignar comentarios espec√≠ficos a los diferentes elementos de un ARRAY, proceda del
siguiente modo:
1. Haga clic en el tri√°ngulo situado delante de la variable del tipo de datos ARRAY.
El ARRAY se expande y cada uno de sus elementos aparece en una fila.
2. Introduzca los valores que desee en la columna "Comentario".

Visualizar los ARRAYs en modo avanzado
En la vista "Modo avanzado", los ARRAYs se muestran expandidos de forma predeterminada.
Para activar el modo avanzado, proceda del siguiente modo:
1. Haga clic en el bot√≥n "Modo avanzado" de la barra de herramientas.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7797

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Nota
Restricci√≥n en la vista "Modo avanzado"
Dependiendo del tama√±o de la memoria de trabajo del equipo existen los siguientes l√≠mites
m√°ximos para el modo avanzado:
‚óè Memoria de trabajo < 8 GB: Como m√°ximo se visualizan 10.000 l√≠neas.
‚óè Memoria de trabajo >= 8 GB: Como m√°ximo se visualizan 40.000 l√≠neas.

Consulte tambi√©n
ARRAY (P√°gina 293)
Reglas de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)
Variables (P√°gina 102)
Palabras clave (P√°gina 95)
Propiedades de variables y constantes locales (P√°gina 7829)
Remanencia de las variables locales (P√°gina 7789)

9.4.5

Declarar variables del tipo de datos STRUCT

Requisitos
La interfaz del bloque est√° abierta.

Procedimiento
Para declarar una variable del tipo de datos STRUCT, proceda del siguiente modo:
1. Seleccione la secci√≥n de declaraci√≥n que desee en la interfaz de bloque.
2. Introduzca un nombre de variable en la columna "Nombre".
3. Introduzca "Struct" en la columna "Tipo de datos". Al introducirlo, se dispone de la funci√≥n
de autocompletar.
Debajo de las nuevas variables se inserta una fila vac√≠a sangrada.
4. Inserte el primer elemento de estructura en la fila vac√≠a.
Debajo del elemento se inserta nuevamente una fila vac√≠a.
5. Seleccione un tipo de datos para el elemento de estructura.
6. Opcionalmente: Modifique las propiedades del elemento de estructura que se visualizan en
las otras columnas de la interfaz del bloque.

7798

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque
7. Repita los pasos 4 a 6 para todos los dem√°s elementos de estructura.
No es necesario finalizar expl√≠citamente la estructura. La estructura termina con el √∫ltimo
elemento introducido.
8. Para insertar una nueva variable despu√©s de la estructura, deje una fila vac√≠a al final de la
estructura e introduzca la nueva variable en la segunda fila vac√≠a.

Resultado
Se crea la variable del tipo de datos STRUCT.

Nota
S7-1500: M√°ximo 252 estructuras en un bloque de datos
En un bloque de datos se permite un m√°ximo de 252 estructuras. Si necesita m√°s estructuras,
tendr√° que reestructurar el programa. Por ejemplo se pueden crear las estructuras en varios
bloques de datos globales.

Consulte tambi√©n
Declaraci√≥n de STRUCT (P√°gina 7813)
Reglas de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)
Variables (P√°gina 102)
Palabras clave (P√°gina 95)
Propiedades de variables y constantes locales (P√°gina 7829)
Remanencia de las variables locales (P√°gina 7789)

9.4.6

Declaraci√≥n de variables del tipo de datos STRING y WSTRING

Requisitos
La interfaz de bloque est√° abierta.

Procedimiento
Para declarar una variable del tipo de datos STRING o WSTRING, proceda del siguiente modo:
1. Seleccione la secci√≥n de declaraci√≥n que desee en la interfaz de bloque.
2. Introduzca un nombre de variable en la columna "Nombre".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7799

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque
3. Introduzca "STRING" o "WSTRING" en la columna "Tipo de datos". Al introducirlo, se
dispone de la funci√≥n de autocompletar.
4. Opcionalmente: Indique la longitud m√°xima de la cadena de caracteres entre corchetes a
continuaci√≥n de la palabra clave STRING o WSTRING. Si no indica una longitud m√°xima,
STRING tendr√° una longitud est√°ndar de 254 caracteres.
Ejemplo de un WSTRING de la longitud m√°xima 4:
WSTRING[4]
Ejemplo de un STRING cuya longitud m√°xima se define mediante una constante local:
STRING[#My_local_const1]
Ejemplo de un STRING cuya longitud m√°xima se define mediante una constante global:
STRING["My_global_const1"]

Resultado
Se crea la variable del tipo de datos STRING o WSTRING.

Consulte tambi√©n
Declaraci√≥n de STRING y WSTRING (P√°gina 7820)

9.4.7

Declarar variables basadas en un tipo de datos PLC

Requisitos
En la CPU actual est√° declarado un tipo de datos PLC.

Procedimiento
Para declarar una variable basada en el tipo de datos PLC, proceda del siguiente modo:
1. Seleccione la secci√≥n de declaraci√≥n que desee en la interfaz de bloque.
2. Introduzca el tipo de datos PLC en la columna "Tipo de datos". Al introducirlo, se dispone
de la funci√≥n de autocompletar.
La variable se crea.
3. Si en la declaraci√≥n del tipo de datos PLC ya se han definido valores predeterminados o
comentarios para las variables de un tipo de datos PLC, se mostrar√°n en gris. Esos valores
se pueden modificar en la interfaz del bloque.
Los valores modificados se representan en negro y solo son v√°lidos para el lugar de uso
espec√≠fico.
Nota
Si modifica o borra tipos de datos PLC utilizados en la interfaz del bloque, la interfaz se volver√°
incoherente. Para corregir esta incoherencia es necesario volver a compilar el programa.
Consulte tambi√©n: Actualizar la interfaz del bloque (P√°gina 7834)

7800

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

9.4.8

Declarar variables superpuestas

Introducci√≥n
Para acceder a determinadas √°reas de datos dentro de una variable declarada, se puede
superponer a las variables declaradas otra declaraci√≥n m√°s. De esta manera existe la
posibilidad de direccionar una variable ya declarada con otro tipo de datos. Por ejemplo, cada
bit de una variable del tipo de datos WORD se puede direccionar con un ARRAY of BOOL.

Superponer variable
Para superponer una variable con un tipo de datos nuevo, proceda del siguiente modo:
1. Abra la interfaz del bloque.
2. En la interfaz, seleccione la variable que desea superponer con un tipo de datos nuevo.
3. Haga clic en el bot√≥n "Agregar fila" de la barra de herramientas.
Debajo de la variable superpuesta se agrega una fila. La variable que se va a superponer
debe declararse en la fila inmediatamente despu√©s de la variable superpuesta.
4. Introduzca un nombre de variable en la columna "Nombre".
5. Introduzca la entrada "AT" en la columna "Tipo de datos". Se dispone de la ayuda de la
funci√≥n de autocompletar.
La entrada de la columna "Nombre" se complementa con el siguiente suplemento.
"AT<Nombre de la variable superpuesta>"
6. Haga clic nuevamente en el bot√≥n para seleccionar el tipo de datos y seleccione el tipo de
datos para la variable nueva.
La variable se crea. En ella aparecen los mismos datos de la variable superpuesta pero se
interpretan con el tipo de datos nuevo.

Eliminar superposici√≥n
Para eliminar la superposici√≥n de una variable, proceda del siguiente modo:
1. Seleccione en la interfaz del bloque la variable superpuesta que desee eliminar.
2. Elija el comando "Borrar" del men√∫ contextual.
La superposici√≥n se elimina.

Consulte tambi√©n
Superponer variables con AT (P√°gina 118)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7801

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

9.4.9

Declarar multiinstancias

Requisitos
El bloque de funci√≥n que debe llamarse se encuentra disponible en el √°rbol del proyecto y es
apto para multiinstancia.

Declaraci√≥n de multiinstancias
Para declarar como multiinstancia un bloque de funci√≥n que debe llamarse, proceda del
siguiente modo:
1. Abra la interfaz del bloque de funci√≥n que efect√∫a la llamada.
2. Introduzca una denominaci√≥n para la llamada de bloque en la columna "Nombre" de la
secci√≥n "Static".
3. Introduzca en la columna "Tipo de datos" un nombre simb√≥lico para el bloque de funci√≥n
que debe llamarse.
Nota
El editor de programaci√≥n declara autom√°ticamente la multiinstancia si se programa una
llamada de bloque en un segmento y en el cuadro de di√°logo siguiente "Opciones de llamada"
se indica que el bloque debe llamarse como multiinstancia.

Declaraci√≥n de multiinstancias como ARRAY
Para declarar un ARRAY de multiinstancias, proceda del siguiente modo:
1. Abra la interfaz del bloque de funci√≥n que efect√∫a la llamada.
2. En la secci√≥n "Static", introduzca un nombre para el ARRAY en la columna "Nombre".
3. Seleccione el tipo de datos ARRAY en la columna "Tipo de datos".
Se abre el cuadro de di√°logo "Array".
4. Introduzca en el campo "Tipo de datos" el nombre del bloque de funci√≥n para el que deba
definirse una instancia. El nombre del bloque tiene que indicarse entre comillas.
5. A continuaci√≥n, indique los l√≠mites inferior y superior de cada dimensi√≥n en el campo
"L√≠mites de matriz".
Ejemplo de un ARRAY unidimensional: ARRAY:[0..3]
Ejemplo de un ARRAY tridimensional:[0..3, 0..15, 0..33]
6. Confirme la entrada.

Consulte tambi√©n
Actualizar la interfaz del bloque (P√°gina 7834)
Declaraci√≥n de instancias (P√°gina 7821)

7802

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

9.4.10

Declaraci√≥n de instancias de par√°metro

Introducci√≥n
La tabla siguiente muestra las posibilidades de declaraci√≥n y uso de instancias de par√°metro
en la interfaz del bloque:
Declaraci√≥n

Tipo de
bloque

Utilizaci√≥n

InOut

FB

La instancia que se transfiere en calidad de par√°metro actual se puede llamar posteriormente en
el bloque de funci√≥n.

Input

FC

Se puede acceder en lectura a los datos de la instancia que se transfiera en calidad de par√°‚Äê
metro actual. Sin embargo, la instancia no se puede llamar desde el bloque.

Output

FC

Se puede acceder en escritura a los datos de la instancia que se transfiera en calidad de par√°‚Äê
metro actual. Sin embargo, la instancia no se puede llamar desde el bloque.

FC

Requisitos
La interfaz del bloque est√° abierta.

Procedimiento
Para declarar una instancia de par√°metro, proceda del siguiente modo:
1. Abra la secci√≥n deseada de la interfaz del bloque (ver tabla).
2. Introduzca en la columna "Nombre" un nombre para el par√°metro de entrada/salida al que
se transfiera la instancia.
3. Introduzca en la columna "Tipo de datos" el nombre del bloque de funci√≥n para el que deba
definirse una instancia. El nombre del bloque tiene que indicarse entre comillas.
Nota
Declaraci√≥n autom√°tica de la instancia de par√°metro
El editor de programaci√≥n declara la instancia de par√°metro aunque se programe una llamada
de bloque en un segmento y en el cuadro de di√°logo siguiente "Opciones de llamada" se
indique que el bloque debe llamarse como instancia de par√°metro.

Consulte tambi√©n
Instancias de par√°metro (P√°gina 67)
Declaraci√≥n de instancias (P√°gina 7821)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7803

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

9.4.11

Ocultar par√°metros en la llamada del bloque

Introducci√≥n
Existe la posibilidad de ocultar par√°metros de bloque al llamar el bloque en KOP o FUP. En
principio, los par√°metros ocultos no son visibles, aunque pueden visualizarse utilizando una
peque√±a flecha situada en el borde inferior del cuadro de llamada.
Para ocultar un par√°metro existen dos posibilidades:
‚óè

Ocultar
El par√°metro se oculta siempre.

‚óè Ocultar cuando no hay ning√∫n par√°metro asignado
El par√°metro se oculta a menos que est√© conectado. Cuando se asigna un par√°metro
actual se muestra el par√°metro en el cuadro de llamada.

Procedimiento
Para definir si un par√°metro de bloque debe mostrarse u ocultarse durante la llamada, proceda
del siguiente modo:
1. Abra la interfaz del bloque.
2. Seleccione un par√°metro en la interfaz del bloque.
3. Abra la ficha "Propiedades" en la ventana de inspecci√≥n.
4. Seleccione el grupo "Atributos" en la navegaci√≥n local.
5. En "Visibilidad en llamadas de bloque en KOP/FUP" elija una de las opciones siguientes:
‚Äì "Mostrar"
‚Äì "Ocultar"
‚Äì "Ocultar si no hay ning√∫n par√°metro asignado"

Resultado
Al llamar el bloque en KOP o FUP, el par√°metro se muestra u oculta en funci√≥n del ajuste.
Si se detecta un error de sintaxis en la llamada del bloque no es posible ocultar el par√°metro.

Consulte tambi√©n
Cablear par√°metros ocultos (P√°gina 7982)
Declarar par√°metros actuales predefinidos (P√°gina 7805)

7804

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

9.4.12

Declarar par√°metros actuales predefinidos

Introducci√≥n
Cuando se declara un par√°metro de bloque es posible especificar qu√© par√°metro actual debe
utilizarse en la llamada del bloque.
Esto puede ser √∫til cuando se utilizan bloques de programa como elementos de librer√≠a y se
desea almacenar junto con el elemento de librer√≠a informaci√≥n sobre los par√°metros actuales
que deben utilizarse.
Adem√°s, en KOP y FUP es posible ocultar en la llamada del bloque par√°metros que tienen un
par√°metro actual predefinido y v√°lido. En principio, los par√°metros ocultos no son visibles,
aunque pueden visualizarse utilizando una peque√±a flecha situada en el borde inferior del
cuadro de llamada.
Para ocultar un par√°metro predefinido existen dos posibilidades:
‚óè El par√°metro se oculta siempre.
‚óè El par√°metro se ocultar√° mientras el par√°metro actual predefinido est√© asignado. Sin
embargo, al asignar otro par√°metro actual se muestra el par√°metro.

Requisitos
El par√°metro se encuentra en la secci√≥n "Input", "Output" o "InOut".

Procedimiento
Para predefinir un par√°metro actual, proceda del siguiente modo:
1. Abra la interfaz del bloque.
2. Seleccione un par√°metro en la interfaz del bloque.
3. Abra la ficha "Propiedades" en la ventana de inspecci√≥n.
4. Seleccione el grupo "Atributos" en la navegaci√≥n local.
5. Introduzca el par√°metro actual deseado en el campo de entrada "Par√°metro actual
predefinido".
6. Tambi√©n puede optar por elegir la opci√≥n "Ocultar" en "Visibilidad en llamadas de bloque en
KOP/FUP".
7. Como opci√≥n adicional elija "Mostrar cuando el par√°metro actual asignado no sea id√©ntico
al par√°metro actual predefinido". Esta opci√≥n solo est√° disponible si previamente se ha
activado la opci√≥n "Ocultar".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7805

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Resultado
‚óè Hay un par√°metro actual predefinido. Si se guarda el bloque de programa como elemento
de librer√≠a, se incluir√° tambi√©n la informaci√≥n sobre el par√°metro actual que debe utilizarse.
‚óè Si se utiliza el elemento de librer√≠a en el programa, se comprueba si se puede direccionar
el par√°metro actual que ha predefinido. En caso afirmativo se utiliza autom√°ticamente
como par√°metro actual.
‚óè Si no se encuentra el par√°metro actual en el programa se notifica un error de sintaxis y el
suministro de par√°metros debe llevarse a cabo manualmente. Los par√°metros con un
suministro no v√°lido no se ocultan.

Consulte tambi√©n
Ocultar par√°metros en la llamada del bloque (P√°gina 7804)

9.4.13

Edici√≥n de la tabla de la interfaz de bloque

9.4.13.1

Insertar filas en la tabla

Procedimiento
Para insertar una fila encima de la fila seleccionada, proceda del siguiente modo:
1. Seleccione la fila sobre la cual desea insertar una fila nueva.
2. Haga clic en el bot√≥n "Insertar fila" de la barra de herramientas de la tabla.

Resultado
Se inserta una fila nueva sobre la seleccionada.

9.4.13.2

Agregar filas en la tabla

Procedimiento
Para agregar una fila nueva detr√°s de la fila seleccionada, proceda del siguiente modo:
1. Seleccione la fila tras la que desea insertar la fila nueva.
2. Haga clic en el bot√≥n "Agregar fila" de la barra de herramientas de la tabla.

Resultado
Se inserta una fila nueva y vac√≠a detr√°s de la fila seleccionada.

7806

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

9.4.13.3

Borrar variables

Procedimiento
Para borrar variables, proceda del siguiente modo:
1. Seleccione la fila que contiene la variable que desea borrar. Tambi√©n puede seleccionar
varias filas simult√°neamente manteniendo pulsada la tecla <Ctrl> y haciendo clic
consecutivamente en las filas que desea seleccionar, o bien en la primera y en la √∫ltima.
2. Elija el comando "Borrar" del men√∫ contextual.

9.4.13.4

Rellenar celdas consecutivas autom√°ticamente
Es posible transferir el contenido de una o varias celdas de la tabla a las celdas situadas
debajo, rellenando as√≠ las celdas consecutivas autom√°ticamente.
Si se rellenan autom√°ticamente las celdas de la columna "Nombre", cada uno de los nombres
se complementar√° con un n√∫mero correlativo. Por ejemplo, el nombre "Motor" se transforma
en "Motor_1".
Es posible definir como √°rea de origen una celda individual o varias celdas, o bien filas
completas.
Si la tabla abierta contiene menos filas de las que deben rellenarse, en primer lugar se deben
insertar m√°s filas vac√≠as.

Requisitos
‚óè La tabla est√° abierta.
‚óè Se dispone de filas de declaraci√≥n suficientes.

Procedimiento
Para rellenar celdas consecutivas autom√°ticamente, proceda del siguiente modo:
1. Seleccione las celdas cuyo contenido desea transferir.
2. Haga clic en el s√≠mbolo de rellenar situado en la esquina inferior derecha de la celda.
El puntero del rat√≥n adopta la forma de una cruz con puntas de flecha.
3. Con el bot√≥n del rat√≥n pulsado, arrastre el puntero hacia abajo hasta situarlo sobre las
celdas que desea rellenar autom√°ticamente.
4. Suelte el bot√≥n del rat√≥n.
Las celdas se rellenan autom√°ticamente.
5. Si ya existen entradas en las celdas que van a rellenarse autom√°ticamente, aparece un
cuadro de di√°logo. En este di√°logo puede indicarse si se quieren sobrescribir las entradas
existentes o si se quieren insertar nuevas filas para las variables nuevas.

9.4.13.5

Mostrar y ocultar las columnas de la tabla
Las columnas de las tablas pueden mostrase u ocultarse seg√∫n necesidad.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7807

Declaraci√≥n de la interfaz del bloque
9.4 Declaraci√≥n de la interfaz de bloque

Procedimiento
Para mostrar u ocultar las columnas de una tabla, proceda del siguiente modo:
1. Haga clic en el encabezado de una columna.
2. Elija el comando "Mostrar/ocultar" del men√∫ contextual.
Aparece una selecci√≥n de las columnas disponibles.
3. Para mostrar una columna, active la casilla de verificaci√≥n correspondiente.
4. Para ocultar una columna, desactive la casilla de verificaci√≥n correspondiente.
5. Para mostrar u ocultar varias columnas, haga clic en "M√°s" y active o desactive la casilla de
verificaci√≥n de las columnas en cuesti√≥n en el cuadro de di√°logo "Mostrar/ocultar".

9.4.13.6

Editar variables con editores externos
Para editar variables individuales en editores de tablas, p. ej., en Excel, √©stas se pueden copiar
y pegar para exportarlas o importarlas.
Nota
Restricciones en la visualizaci√≥n y copia de elementos ARRAY
Dependiendo del tama√±o de la memoria de trabajo del equipo existen los siguientes l√≠mites
m√°ximos para la visualizaci√≥n y copia de elementos ARRAY de la interfaz del bloque a una
tabla Excel:
‚óè Memoria de trabajo < 8 GB: Como m√°ximo se visualizan y se copian 10.000 elementos.
‚óè Memoria de trabajo >= 8 GB: Como m√°ximo se visualizan y se copian 40.000 elementos.

Requisitos
Hay una interfaz de bloque y un editor externo abiertos.

Procedimiento
Para exportar distintas variables a un editor externo y volverlas a importar, proceda del
siguiente modo:
1. Para mostrar todos los elementos de tipos de datos estructurados, haga clic en el bot√≥n
"Modo avanzado".
2. Seleccione una o m√°s variables.
3. Elija el comando "Copiar" del men√∫ contextual.
4. Cambie al editor externo y pegue la variable copiada.
5. Edite las variables de la forma necesaria.
6. Copie las variables en el editor externo.
7. Seleccione las variables en el editor externo.
8. Cambie nuevamente a la interfaz del bloque.
9. Elija el comando "Pegar" del men√∫ contextual.

7808

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

9.5

Declaraci√≥n de la interfaz de bloque en la vista de texto

9.5.1

Estructura de la interfaz de bloque textual

Estructura de la interfaz de bloque textual
La siguiente figura muestra la estructura de la interfaz de bloque textual tal y como se
representa tras crear un bloque de funci√≥n nuevo.

1

2

3

4

La interfaz de bloque textual se compone de las √°reas siguientes:

√Årea

‚ë† Declaraci√≥n de
bloques
‚ë° Secciones de
declaraci√≥n

Significado
La declaraci√≥n de bloques define el nombre y el tipo del bloque.
En las secciones de declaraci√≥n se declaran los par√°metros y los datos locales del bloque. En la interfaz
de bloque vac√≠a ya se han introducido las secciones de declaraci√≥n. No obstante, las secciones se
pueden mover, copiar y eliminar de la forma deseada.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7809

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
√Årea

Significado

‚ë¢ Barra lateral
‚ë£ N√∫meros de l√≠‚Äê

En la barra lateral se pueden insertar marcadores.
A la izquierda se muestran los n√∫meros de l√≠nea junto a las secciones de declaraci√≥n.

nea

Consulte tambi√©n
Seleccionar representaci√≥n tabular o textual de la interfaz del bloque (P√°gina 7790)

9.5.2

Declaraci√≥n de bloque y valor de retorno

Declaraci√≥n de bloques
La interfaz de bloque textual comienza con la declaraci√≥n de bloques. No es necesario
introducir la declaraci√≥n de bloques personalmente. Ya est√° contenida en la plantilla de la
interfaz.

Valor de retorno
En las funciones (FC), indique el valor de retorno de la funci√≥n despu√©s de la declaraci√≥n del
bloque. El valor de retorno es el valor que se devuelve al bloque que realiza la llamada. Si se
indica el valor "VOID", la funci√≥n no devolver√° ning√∫n valor de retorno.

Sintaxis
Para la declaraci√≥n de bloques y el valor de retorno se utiliza la siguiente sintaxis:

Tipo de bloque

Sintaxis

Ejemplo

Funci√≥n (FC)

FUNCTION <Nombre> [:Tipo de datos
Valor de retorno>]

FUNCTION "My_Function" : Int

<Declaraci√≥n>
Bloque de funci√≥n
(FB)

FUNCTION_BLOCK <Nombre>

Bloque de organi‚Äê
zaci√≥n (OB)

ORGANIZATION_BLOCK <Nombre>

FUNCTION "My_Function" : Void
FUNCTION_BLOCK "My_FunctionBlock"

<Declaraci√≥n>
ORGANIZATION_BLOCK "My_OrganizationBlock"

<Declaraci√≥n>

Consulte tambi√©n
Ejemplo de una interfaz de bloque textual (P√°gina 7827)

7810

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

9.5.3

Secciones de declaraci√≥n

Secciones de declaraci√≥n
La interfaz de bloque textual se divide en diferentes secciones de declaraci√≥n marcadas
mediante pares de palabras clave. Dependiendo del tipo de bloque se admiten diferentes
secciones.
El orden de las secciones de declaraci√≥n puede ser cualquiera. Una determinada secci√≥n
puede aparecer varias veces en la interfaz de bloque.
Para las secciones de declaraci√≥n se utiliza la siguiente sintaxis:

Secci√≥n de declaraci√≥n

Sintaxis

Par√°metros de entrada

VAR_INPUT [<ATRIBUTO>]
<Declaraci√≥n>
END_VAR

Par√°metros de salida

VAR_OUTPUT [<ATRIBUTO>]
<Declaraci√≥n>
END_VAR

Par√°metros de entrada/
salida

VAR_IN_OUT [<ATRIBUTO>]
<Declaraci√≥n>
END_VAR

Datos locales tempora‚Äê
les

VAR_TEMP
<Declaraci√≥n>
END_VAR

Datos locales est√°ticos

VAR [<ATRIBUTO>]
<Declaraci√≥n>
END_VAR

Constante

VAR CONSTANT
<Declaraci√≥n>
END_VAR

Encontrar√° m√°s informaci√≥n sobre el significado de las diferentes secciones de declaraci√≥n en:
Descripci√≥n de la interfaz de bloque (P√°gina 7783)

Atributos para las secciones de declaraci√≥n
Opcionalmente es posible asignar atributos a secciones. Los atributos son aplicables para
todas las variables declaradas en esa secci√≥n. Si una secci√≥n aparece varias veces, se
pueden utilizar atributos diferentes para cada instancia.
Los atributos disponibles son los siguientes:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7811

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

Atributo

Significado

RETAIN

Las variables de esta secci√≥n son remanentes, lo que significa que sus valores contin√∫an disponibles
tras un corte el√©ctrico.

DB_SPECIFIC

La remanencia se puede configurar en el bloque de datos de instancia.

Si no se indica ning√∫n atributo, los datos de la secci√≥n de declaraci√≥n no son remanentes.

Consulte tambi√©n
Remanencia de las variables locales (P√°gina 7789)
Ejemplo de una interfaz de bloque textual (P√°gina 7827)

9.5.4

Declaraci√≥n de variables e inicializaci√≥n

Declaraci√≥n e inicializaci√≥n de variables o constantes
En las diferentes secciones de declaraci√≥n se declaran las variables y constantes locales que
se utilizan en el bloque.
Una declaraci√≥n de variables se compone de un nombre simb√≥lico y un tipo de datos.
Opcionalmente se puede indicar un valor predeterminado para la inicializaci√≥n de las
variables.
Adem√°s del nombre simb√≥lico y el tipo de datos, una declaraci√≥n de constantes siempre
contiene un valor. Las declaraciones de constantes solo est√°n permitidas en la secci√≥n "VAR
CONSTANT".

Superponer variables con AT
Para acceder a determinadas √°reas de datos dentro de una variable declarada, se puede
superponer a la variable declarada otra declaraci√≥n m√°s. De esta manera existe la posibilidad
de direccionar una variable ya declarada con otro tipo de datos. Por ejemplo, cada bit de una
variable del tipo de datos WORD se puede direccionar con un ARRAY of BOOL.
Mientras en la vista tabular una declaraci√≥n AT debe estar justo detr√°s de la variable
referenciada, en la vista de texto puede estar en cualquier posici√≥n.
Las declaraciones AT no pueden inicializarse. Tenga en cuenta que las declaraciones AT en
principio solo pueden utilizarse en bloques no optimizados.

Sintaxis
Para la declaraci√≥n de variables y constantes se utiliza la siguiente sintaxis:

7812

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

Declaraci√≥n

Sintaxis

Ejemplos

Variable

<Nombre> : <Tipo de datos> [:= <Valor>];

myBit : BOOL;

Constante

<Nombre> : <Tipo de datos> := <Valor>;

myBit : BOOL := true;
PI : REAL := 3.141592;
myInt: INT := INT#16#7FFF;
myString: STRING := 'hello';
Declaraci√≥n
AT

<Nombre> AT <Nombre de la variable referenciada> : <Ti‚Äê myReferenceToVar2 AT Var_2 : Int;
po de datos>;

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Reglas generales de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)
Superponer variables con AT (P√°gina 118)
Declarar variables superpuestas (P√°gina 7801)
Ejemplo de una interfaz de bloque textual (P√°gina 7827)
Constantes (P√°gina 103)

9.5.5

Declaraci√≥n de STRUCT

Declaraci√≥n de STRUCT
El tipo de datos STRUCT representa una estructura de datos compuesta por un n√∫mero fijo de
componentes de diferentes tipos de datos.
Una estructura tambi√©n puede basarse en un tipo de datos PLC (UDT). Para ello, indique el tipo
de datos PLC como tipos de datos de la estructura. Un Tooltip indica los diversos elementos
del tipo de datos PLC.

Sintaxis
Para declarar un STRUCT se utiliza la siguiente sintaxis:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7813

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

Declaraci√≥n

Sintaxis

Ejemplos

STRUCT

<Nombre> : Struct

myStruct : Struct

<Nombre del elemento> : <Tipo de datos> [:= <Va‚Äê
lor>];
<Nombre del elemento> : <Tipo de datos> [:= <Va‚Äê
lor>];
...

mem_1 : Int;
mem_2 : Int;
mem_3 : BOOL;
END_Struct := (6,0, TRUE) ;

END_Struct := (<Lista de inicializaci√≥n>);
STRUCT a
<Nombre> : "<Nombre UDT>" := (<Lista de iniciali‚Äê
partir de un ti‚Äê zaci√≥n>);
po de datos
PLC (UDT)

myStruct : "myType" := (6,0, TRUE);

Nota
S7-1500: M√°ximo 252 estructuras en un bloque de datos
En las CPU de la serie S7-1500 se permite un m√°ximo de 252 estructuras en un bloque de
datos. Si necesita m√°s estructuras, tendr√° que reestructurar el programa. Por ejemplo se
pueden crear las estructuras en varios bloques de datos globales.

Inicializaci√≥n de STRUCT
La inicializaci√≥n de STRUCT es opcional. Para la inicializaci√≥n introduzca un valor
directamente despu√©s de la declaraci√≥n de variables o utilice una lista de inicializaci√≥n.
Las listas de inicializaci√≥n aparecen entre par√©ntesis tras la palabra clave END_STRUCT y se
introducen con :=. Si la estructura contiene estructuras subordinadas, para la inicializaci√≥n se
utilizan par√©ntesis anidados. Si por error se utilizan las dos posibilidades de inicializaci√≥n, se
emplear√° el valor de la lista de inicializaci√≥n.

7814

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Para la lista de inicializaci√≥n se utiliza la siguiente sintaxis:
Declaraci√≥n

Sintaxis

Ejemplos

Comentario

Inicializaci√≥n
de STRUCT

<Nombre> : Struct

myStruct : Struct

Los elementos de es‚Äê
tructura se inicializan
como se indica a conti‚Äê
nuaci√≥n:

<Nombre del elemento> : <Tipo
de datos> [:= <Valor>];
...
END_Struct

mem_1 : Int := 1;
mem_2 : Int := 2;
mem_3 : BOOL := FALSE
End_Struct

// mem_1 := 1
// mem_2 := 2
// mem_3 := FALSE

Lista de inicia‚Äê := (<Valor>,<Valor>,<Valor>... )
lizaci√≥n para
STRUCT

myStruct : Struct
mem_1 : Int;
mem_2 : Int;
mem_3 : BOOL
End_Struct:=(2,0,TRUE);

Los elementos de es‚Äê
tructura se inicializan
como se indica a conti‚Äê
nuaci√≥n:
// mem_1 := 2
// mem_2 := 0
// mem_3 := TRUE

Lista de inicia‚Äê := (<Valor>,(<Valor>,<Valor>... )) myStruct : Struct
lizaci√≥n para
mem_1 : Int;
STRUCT ani‚Äê
mem_2 : Int;
dada
mem_3 : Struct
mem_4 : BOOL;
mem_5 : BOOL;
End_Struct;
End_Struct:=(2,0, (TRUE,TRUE));
Lista de inicia‚Äê := (<Nombre de elemento> :=
lizaci√≥n para
<Valor>), (<Nombre de elemen‚Äê
STRUCT con to> := <Valor>)...
indicaci√≥n del
nombre del
elemento

myStruct : Struct

Lista de inicia‚Äê := (<Valor>,<Valor>,<Valor>... )
lizaci√≥n para
el tipo de da‚Äê
tos PLC
(UDT)

myStruct : "myType" := (2,0,TRUE);

mem_1 : Int;
mem_2 : Int;
End_Struct:=(mem_2:=55);

Los elementos de es‚Äê
tructura se inicializan
como se indica a conti‚Äê
nuaci√≥n:
// mem_1 := 2
// mem_2 := 0
// mem_4 := TRUE
// mem_5 := TRUE
Los elementos de es‚Äê
tructura se inicializan
como se indica a conti‚Äê
nuaci√≥n:
// mem_2 := 55
Los elementos de es‚Äê
tructura se inicializan
como se indica a conti‚Äê
nuaci√≥n:
// mem_1 := 2
// mem_2 := 0
// mem_3 := TRUE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7815

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Declaraci√≥n

Sintaxis

Ejemplos

Comentario

Lista de inicia‚Äê := (<Valor>,(<Valor>,<Valor>... )) myStruct : "myType" := (2,0,
(TRUE,TRUE);
lizaci√≥n para
el tipo de da‚Äê
tos PLC
(UDT) anida‚Äê
do

Los elementos de es‚Äê
tructura se inicializan
como se indica a conti‚Äê
nuaci√≥n:
// mem_1 := 2
// mem_2 := 0
// mem_3 := TRUE
// mem_4 := TRUE

Lista de inicia‚Äê := (<Nombre de elemento> :=
lizaci√≥n para
<Valor>), (<Nombre de elemen‚Äê
el tipo de da‚Äê to> := <Valor>)...
tos PLC
(UDT) con in‚Äê
dicaci√≥n del
nombre del
elemento

Los elementos de es‚Äê
tructura se inicializan
como se indica a conti‚Äê
nuaci√≥n:

myStruct : "myType" :=
(mem_1:=22,mem_2:=55);

// mem_1 := 22
// mem_2 := 55

Consulte tambi√©n
Declarar variables del tipo de datos STRUCT (P√°gina 7798)
Estructura de datos STRUCT (estructuras an√≥nimas) (P√°gina 288)
Reglas de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)
Ejemplo de una interfaz de bloque textual (P√°gina 7827)

9.5.6

Declaraci√≥n de ARRAY

Declaraci√≥n de ARRAY
El tipo de datos ARRAY representa una estructura de datos compuesta por un n√∫mero fijo de
elementos del mismo tipo de datos.
Para declarar un ARRAY se utiliza la siguiente sintaxis:

Declaraci√≥n

Sintaxis

Ejemplos

ARRAY

<Nombre> : ARRAY [valor l√≠mite inferior..valor l√≠mite supe‚Äê
rior] OF <Tipo de datos> := [<Lista de inicializaci√≥n>];

MyARRAY_1 : ARRAY[0..7] OF BOOL;

ARRAY con
l√≠mites varia‚Äê
bles

7816

<Nombre> : ARRAY [*] OF <Tipo de datos>;

MyARRAY_1 : ARRAY[0..7] OF BOOL :=
[1,1,0,0,0,1,0,0];
MyARRAY_1 : ARRAY[*] OF INT;
MyARRAY_2 : ARRAY[*, *, *] OF INT;

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Declaraci√≥n

Sintaxis

Ejemplos

ARRAY con
constantes
locales como
l√≠mites

<Nombre> : ARRAY [#<Nombre de constante>..#<Nombre
de constante>] OF <Tipo de datos> := [<Lista de inicializa‚Äê
ci√≥n>];

MyARRAY_1 :
ARRAY[#LocConst1..#LocConst2] OF
INT;
MyARRAY_2 : ARRAY[1..#LocConst]
OF INT;
MyARRAY_3 : ARRAY[1..#LocConst]
OF INT := [1,1,0,0];

ARRAY con
constantes
globales co‚Äê
mo l√≠mites

<Nombre> : ARRAY ["<Nombre de constante>".."<Nombre MyARRAY_1 :
de constante>"] OF <Tipo de datos> := [<Lista de inicializa‚Äê ARRAY["GlobConst1".."GlobConst2"]
ci√≥n>];
OF INT;
MyARRAY_2 : ARRAY[1.."GlobConst",
2..5,#l..#u] OF INT;
MyARRAY_3 : ARRAY[1.."GlobConst"]
OF INT:= [1,1,0,0];

ARRAY OF
STRUCT

<Nombre> : ARRAY[valor l√≠mite inferior..valor l√≠mite supe‚Äê
rior] OF Struct
<Nombre de elemento> : <Tipo de datos>;
<Nombre de elemento> : <Tipo de datos>;
...

MyARRAY_1 : Array[0..1] OF Struct
mem_1 : Int;
mem_2 : Int;
END_STRUCT := [ (2,4),(22,44) ];

END_Struct := [<Lista de inicializaci√≥n>];
ARRAY OF
UDT

<Nombre> : ARRAY[Valor l√≠mite inferior..valor l√≠mite supe‚Äê
rior] OF "<Nombre_UDT>" := [<Lista de inicializaci√≥n>];

MyARRAY_1 : Array[0..1] OF
MyType := [ (2,4),(22,44) ];

Inicializaci√≥n de ARRAY
La inicializaci√≥n de un ARRAY es opcional. Para ello se utiliza una lista de inicializaci√≥n. Esta
aparece entre corchetes tras la declaraci√≥n y se introduce con :=. La lista contiene valores
separados por coma para todos los elementos del ARRAY. Se pueden inicializar como m√°ximo
10000 elementos.
Opcionalmente se pueden utilizar factores de repetici√≥n entre par√©ntesis para inicializar varios
elementos consecutivos con el mismo valor. El factor de repetici√≥n debe ser un entero positivo.
En el caso de ARRAY OF STRUCT tambi√©n existe la opci√≥n de inicializar por elementos. Para
ello se asigna un valor a cada elemento de la estructura de un tipo de forma centralizada.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7817

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Para la lista de inicializaci√≥n se utiliza la siguiente sintaxis:
Declaraci√≥n

Sintaxis

Ejemplos

Comentario

Lista de ini‚Äê
cializaci√≥n

:= [<Valor>,<Valor>,<Valor>... ]

myArray : ARRAY[0..2] OF
BOOL := [1,1,0];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[0] := 1
// myArray[1] := 1
// myArray[2] := 0

Lista de ini‚Äê
cializaci√≥n
con factor de
repetici√≥n

:= [<Valor>,<Factor de repeti‚Äê
ci√≥n>(Valor),<Valor>... ]

myArray : ARRAY[1..2, 1..3]
OF INT := [9,8,3(10),6];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[1,1] := 9
// myArray[1,2] := 8
// myArray[1,3] := 10
// myArray[2,1] := 10
// myArray[2,2] := 10
// myArray[2,3] := 6

Lista de ini‚Äê
cializaci√≥n
para ARRAY
of STRUCT

:= [(<Lista de valores Elemento 1>),
(<Lista de valores Elemento 2>)...]

myArray : Array[0..1] OF
Struct
Element1 : Int;
Element2 : Int;
END_Struct := [ (2,4),
(22,44) ];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[0].Element1 := 2
// myArray[0].Element2 := 4
// myArray[1].Element1 := 22
// myArray[1].Element2 := 44

Lista de ini‚Äê
:= [(<Nombre de elemento> := <Va‚Äê
cializaci√≥n
lor>), (<Nombre de elemento> :=
para ARRAY <Valor>)...]
of STRUCT
con indica‚Äê
ci√≥n del nom‚Äê
bre del ele‚Äê
mento

7818

myArray : Array[0..1] OF
Struct
Element1 : Int;
Element2 : Int;
END_Struct := [ (Element1 :=
2 , Element2:=4),
(Element1 := 22,
Element2:=44) ];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[0].Element1 := 2
// myArray[0].Element2 := 4
// myArray[1].Element1 := 22
// myArray[1].Element2 := 44

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Declaraci√≥n

Sintaxis

Ejemplos

Comentario

Lista de ini‚Äê
cializaci√≥n
para ARRAY
of STRUCT
con factor de
repetici√≥n

:= [<Factor de repetici√≥n>(Lista de
valores Elemento 1),<Factor de re‚Äê
petici√≥n>(Lista de valores Elemen‚Äê
to 2),... ]

myArray : Array[0..1, 0..1]
OF Struct
Element_x : Int;
Element_y : Int;
End_Struct:=[2((1, 11)),
2((2, 22))];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[0,0].Element_x:=
1
// myArray[0,0].Element_y:=
11
// myArray[0,1].Element_x:=
1
// myArray[0,1].Element_y:=
11
// myArray[1,0].Element_x:=
2
// myArray[1,0].Element_y:=
22
// myArray[1,1].Element_x:=
2
// myArray[1,1].Element_y:=
22

Lista de ini‚Äê
cializaci√≥n
para ARRAY
of UDT

:= [(Lista de valores Elemento 1>),
(<Lista de valores Elemento 2>)...]

myArray : Array[0..1] OF
MyType := [ (2,4),(22,44) ];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[0].UDT-Ele‚Äê
ment1 := 2
// myArray[0].UDT-Ele‚Äê
ment2 := 4
// myArray[1].UDT-Ele‚Äê
ment1 := 22
// myArray[1].UDT-Ele‚Äê
ment2 := 44

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7819

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Declaraci√≥n

Sintaxis

:= [(<Nombre de elemento> := <Va‚Äê
Lista de ini‚Äê
lor>), (<Nombre de elemento> :=
cializaci√≥n
para ARRAY <Valor>)...]
of UDT con in‚Äê
dicaci√≥n del
nombre del
elemento

Ejemplos

Comentario

myArray : Array[0..1] OF
MyType := [ (UDT-Element1 :=
2,UDT-Element2:=4),(UDTElement1 := 22,UDTElement2:=44) ];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[0].UDT-Ele‚Äê
ment1 := 2
// myArray[0].UDT-Ele‚Äê
ment2 := 4
// myArray[1].UDT-Ele‚Äê
ment1 := 22
// myArray[1].UDT-Ele‚Äê
ment2 := 44

Lista de ini‚Äê
cializaci√≥n
para ARRAY
of UDT con
factor de re‚Äê
petici√≥n

:= [<Factor de repetici√≥n>(Lista de
valores Elemento 1),<Factor de re‚Äê
petici√≥n>(Lista de valores Elemen‚Äê
to 2),... ]

myArray : Array[0..1] OF
myType :=[2(((),1))];

Los elementos ARRAY se ini‚Äê
cializan como se indica a con‚Äê
tinuaci√≥n:
// myArray[0].UDT-Ele‚Äê
ment1 := 0
// myArray[0].UDT-Ele‚Äê
ment2 := 1
// myArray[1].UDT-Ele‚Äê
ment1 := 0
// myArray[1].UDT-Ele‚Äê
ment2 := 1

Consulte tambi√©n
ARRAY (P√°gina 293)
Reglas de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)
Ejemplo de una interfaz de bloque textual (P√°gina 7827)

9.5.7

Declaraci√≥n de STRING y WSTRING

Declaraci√≥n de STRING y WSTRING
Los tipos de datos STRING y WSTRING guardan varios caracteres en una cadena de
caracteres. En la cadena de caracteres se admiten todos los caracteres del c√≥digo ASCII. Los
caracteres se indican entre comillas simples.
Opcionalmente se puede indicar un valor predeterminado para la inicializaci√≥n de la cadena de
caracteres.
En la declaraci√≥n de un operando, la longitud m√°xima de la cadena de caracteres puede
indicarse entre corchetes a continuaci√≥n de la palabra clave STRING o WSTRING (p. ej.
WSTRING[4]). Para la declaraci√≥n de la longitud m√°xima se puede introducir un valor absoluto
o pueden utilizarse constantes locales o globales.
Si no se indica la longitud m√°xima, se utilizar√° para el correspondiente operando la longitud
est√°ndar de 254 caracteres.

7820

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

Sintaxis
Para la declaraci√≥n de STRING y WSTRING se utiliza la siguiente sintaxis:

Declaraci√≥n

Sintaxis

Ejemplos

STRING

<Nombre> : STRING [:=
<Valor>];

myString: STRING;

WSTRING

<Nombre> : WSTRING [:=
<Valor>];

myWstring: WSTRING;

STRING con longitud m√°‚Äê <Nombre> :
xima definida
STRING[[Constante]];

myString: STRING := 'hello';
myWstring_var: WSTRING := 'helloWorld';
myString: STRING[10];
myString: STRING["globConst"];
myString: STRING[#locConst];

Consulte tambi√©n
STRING (P√°gina 274)
WSTRING (P√°gina 277)
Declaraci√≥n de variables del tipo de datos STRING y WSTRING (P√°gina 7799)
Reglas de la declaraci√≥n de la interfaz del bloque (P√°gina 7785)
Ejemplo de una interfaz de bloque textual (P√°gina 7827)

9.5.8

Declaraci√≥n de instancias

Declaraci√≥n de multiinstancias
Las multiinstancias se declaran en la secci√≥n "VAR...END_VAR" de la interfaz de bloque
textual. En ese caso sencillamente se coloca el nombre del bloque llamado como tipo de datos.
Las multiinstancias tambi√©n pueden crearse como ARRAY.
En la interfaz textual no es posible inicializar los par√°metros del bloque llamado.
Consulte tambi√©n:
Multiinstancias (P√°gina 64)
Declarar multiinstancias (P√°gina 7802)

Declaraci√≥n de instancias de par√°metros
Lo mejor es declarar instancias de par√°metros como par√°metros de entrada/salida en la
secci√≥n "VAR_IN_OUT...END_VAR" de la interfaz de bloque textual. No obstante, tambi√©n son
posibles en funciones (FC) como par√°metros de entrada o de salida. En ese caso
sencillamente se coloca el nombre del bloque llamado como tipo de datos.
Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7821

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
En la interfaz textual no es posible inicializar los par√°metros del bloque llamado.
Consulte tambi√©n:
Instancias de par√°metro (P√°gina 67)
Declaraci√≥n de instancias de par√°metro (P√°gina 7803)

Instan‚Äê
cia

Sintaxis

Mul‚Äê
VAR
tiinstan‚Äê
<Nombre de multiinstancia>:"<Nombre de blo‚Äê
cia
que>";
END_VAR

Ejemplos

Significado

VAR

"instFB" es una multiins‚Äê
tancia del bloque "MyFB".

instFB : "MyFB";
END_VAR

ARRAY VAR
de mul‚Äê
<Nombre de multiinstancia>: ARRAY [n...m] of
tiinstan‚Äê "<Nombre de bloque>";
cias
END_VAR

VAR

Instan‚Äê
cia de
par√°‚Äê
metro

VAR_IN_OUT

VAR

"instArray" es un array de
instArray : ARRAY [0‚Ä¶ multiinstancias del blo‚Äê
que "MyFB".
4] of "MyFB";
END_VAR

<Nombre de la instancia de par√°metro>:"<Nom‚Äê
instParam:"MyFB";
bre del bloque>";
END_VAR
END_VAR

"instParam" es una ins‚Äê
tancia de par√°metro del
bloque "MyFB".

Consulte tambi√©n
Ejemplo de una interfaz de bloque textual (P√°gina 7827)

9.5.9

Atributos para variables

Atributos para variables
Opcionalmente es posible asignar atributos a las diferentes variables. Si no asigna un atributo
expl√≠citamente a una variable, esta tendr√° los valores de atributo predeterminados. El ajuste
predeterminado de algunos atributos se puede modificar en la configuraci√≥n general para la
programaci√≥n del PLC.
Los atributos disponibles son los siguientes:

Atributo

Significado

Ajuste predetermi‚Äê
nado

Visible en HMI Engineering

Indica si una variable est√° visible en la lista de selecci√≥n de
HMI de forma predeterminada.

TRUE

Accesible desde HMI / OPC UA / Web
API

Indica si HMI / OPC UA / Web API puede acceder a esta
variable en tiempo de ejecuci√≥n.

TRUE

7822

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Atributo

Significado

Ajuste predetermi‚Äê
nado

Escribible desde HMI / OPC UA / Web
API

Indica si la variable puede escribirse desde HMI / OPC UA /
Web API en tiempo de ejecuci√≥n.

FALSE

Valor de ajuste

Marca una variable como valor de ajuste. Los valores de
ajuste son valores que requieren un ajuste fino en la puesta
en marcha. Esta columna solo existe en la interfaz de blo‚Äê
ques de funci√≥n.

FALSE

Sintaxis
Para los atributos se utiliza la siguiente sintaxis:

Atributo

Sintaxis

Ejemplos

Visible en HMI
Engineering

<Nombre> {EXTERNALVISIBLE:=<Valor>}: <Tipo de
datos>;

myInt {EXTERNALVISIBLE:=
'False'} : INT;

Accesible des‚Äê
de HMI / OPC
UA / Web API

<Nombre> {EXTERNALACCESSIBLE:=<Valor>}: <Ti‚Äê
po de datos>;

myInt {EXTERNALACCESSIBLE:=
'False'} : INT;

Escribible des‚Äê
de HMI / OPC
UA / Web API

<Nombre> {EXTERNALWRITABLE:=<Valor>}: <Tipo
de datos>;

myInt {EXTERNALWRITABLE:=
'False'} : INT;

Valor de ajuste

<Nombre> {S7_SETPOINT:=<Valor>}: <Tipo de da‚Äê
tos>;

myInt {S7_SETPOINT:= 'False'} :
INT;

Consulte tambi√©n
Ejemplo de una interfaz de bloque textual (P√°gina 7827)
Configuraci√≥n general de la programaci√≥n PLC (P√°gina 7685)

9.5.10

Comentarios

Comentarios
Tiene varias posibilidades para comentar una variable en la interfaz de bloque textual:
‚óè Comentario de l√≠nea
Los comentarios de l√≠nea comienzan con "//" y se extienden hasta el final de la l√≠nea.
‚óè Secci√≥n de comentario
Una secci√≥n de comentario se inicia con "(*" y se cierra con "*)". Esta secci√≥n puede abarcar
varias l√≠neas.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7823

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
Para los comentarios se aplican las reglas siguientes:
‚óè Los comentarios no pueden anidarse unos dentro de otros.
‚óè No es posible introducir comentarios en varios idiomas en la interfaz de bloque textual.
‚óè Entre la declaraci√≥n del bloque y la primera secci√≥n de declaraci√≥n no se permiten
comentarios.
Excepci√≥n: en las funciones (FC) se permite en este punto un comentario de una l√≠nea.

Sintaxis
Para los comentarios se utiliza la siguiente sintaxis:

Atributo

Sintaxis

Ejemplos

Comentario de
l√≠nea

<Declaraci√≥n>; //<Co‚Äê
mentario>

MyInt : INT; // este es mi comentario

Secci√≥n de co‚Äê
mentario

<Declaraci√≥n>; (*<Co‚Äê
mentario>*)

MyInt : INT; (* estos son mis comentarios:
1er comentario
2.¬∫ comentario*)

Consulte tambi√©n
Editar comentarios multiling√ºes en la interfaz del bloque (P√°gina 7833)
Ejemplo de una interfaz de bloque textual (P√°gina 7827)

9.5.11

Edici√≥n de la interfaz de bloque textual
Al editar la interfaz de bloque textual se pueden utilizar las mismas funciones de edici√≥n que
al editar el c√≥digo del programa.

Utilizar la funci√≥n de autocompletar
1. Introduzca la sintaxis de la declaraci√≥n mediante el teclado.
Mientras introduce la sintaxis se abre la funci√≥n de autocompletar. Esta ofrece todos los
elementos de sintaxis permitidos en la posici√≥n actual.
2. Seleccione el elemento deseado de la funci√≥n de autocompletar.
Consulte tambi√©n: Entrada manual de instrucciones SCL (P√°gina 8150)

7824

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

Formatear l√≠neas autom√°ticamente
1. Seleccione el texto que desea formatear o sit√∫e la marca de inserci√≥n en la l√≠nea en
cuesti√≥n.
2. Seleccione el bot√≥n "Formatear autom√°ticamente el texto seleccionado" en la barra de
herramientas del editor de programaci√≥n.
Todas las l√≠neas marcadas se formatean siempre que sean sint√°cticamente correctas.
Consulte tambi√©n: Formatear un c√≥digo SCL (P√°gina 8143)

Anulaci√≥n y aplicaci√≥n individual de sangr√≠as
1. Haga clic en las l√≠neas en las que desea aplicar o anular la sangr√≠a.
2. Seleccione en la barra de herramientas del editor del programa el bot√≥n "Aplicar sangr√≠a"
o "Anular sangr√≠a".
El ancho de la sangr√≠a se define en "Opciones > Configuraci√≥n".
Consulte tambi√©n: Formatear un c√≥digo SCL (P√°gina 8143)

Expandir y contraer secciones de c√≥digo
1. Haga clic en el s√≠mbolo menos de la vista de esquema.
La secci√≥n de c√≥digo se contrae.
2. Haga clic en el s√≠mbolo m√°s de la vista de esquema.
La secci√≥n de c√≥digo se expande.
Consulte tambi√©n: Expandir y contraer secciones de c√≥digo (P√°gina 8144)

Uso de marcadores
1. Haga clic en la l√≠nea en la que desea colocar el marcador.
2. Haga clic en el bot√≥n "Activar/borrar marcadores" de la barra de herramientas.
Nota
Navegaci√≥n entre interfaz y c√≥digo de programa
Si se han activado marcadores tanto en la interfaz como en el c√≥digo de programa, los
comandos "Ir al marcador siguiente/anterior" no permiten navegar entre ambas ventanas.
Consulte tambi√©n: Uso de marcadores (P√°gina 8146)

Copiar o mover variables entre interfaz textual y tabular.
Es posible copiar o mover variables entre una interfaz textual y una interfaz tabular.
1. Seleccione una o varias variables de una secci√≥n de declaraci√≥n.
2. Elija el comando "Copiar" o "Cortar" del men√∫ contextual.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7825

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto
3. Sit√∫e el cursor en la posici√≥n en la que desea insertar la variable.
4. Elija el comando "Pegar" del men√∫ contextual.
Nota
Copiar o mover tipos de datos estructurados con inicializaciones
Al copiar tipos de datos estructurados anidados (p.ej., ARRAY of STRUCT) de una interfaz
textual a una interfaz tabular no se copian ni mueven los valores predeterminados de las
estructuras anidadas.

9.5.12

Restablecimiento de la interfaz est√°ndar de un bloque de organizaci√≥n

Introducci√≥n
Los bloques de organizaci√≥n tienen par√°metros de interfaz definidos que contienen la
informaci√≥n de arranque del OB. Si modifica o borra los par√°metros predeterminados en la
interfaz de bloque textual, en el caso de los bloques de organizaci√≥n optimizados podr√°
restablecer la interfaz est√°ndar definida.

Procedimiento
Para restablecer la interfaz est√°ndar de un bloque de organizaci√≥n, proceda del siguiente
modo:
1. En el men√∫ contextual, elija el comando "Restablecer interfaz est√°ndar".

Resultado
‚óè Se restablecen los par√°metros borrados o modificados del OB.
‚óè Los par√°metros agregados manualmente no se borran, sino que se conservan.

7826

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

9.5.13

Ejemplo de una interfaz de bloque textual

Ejemplo
La figura siguiente muestra el ejemplo de una interfaz de bloque textual:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

7827

Declaraci√≥n de la interfaz del bloque
9.5 Declaraci√≥n de la interfaz de bloque en la vista de texto

7828

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Declaraci√≥n de la interfaz del bloque
9.6 Editar las propiedades de variables y constantes locales

9.6

Editar las propiedades de variables y constantes locales

9.6.1

Propiedades de variables y constantes locales

Propiedades
La tabla siguiente muestra una vista general de las propiedades de las variables y constantes
locales:
Grupo

Propiedad

Descripci√≥n

General

Nombre

Nombre del elemento

Tipo de datos

Tipo de datos del elemento

Valor predetermina‚Äê
do

Valor que permite predeterminar determinadas variables
en la interfaz del bloque l√≥gico o bien valor de una cons‚Äê
tante local.
La indicaci√≥n del valor predeterminado es opcional para
variables. Si no se especifica ning√∫n valor, se utilizar√° el
valor predefinido para el tipo de datos indicado. Por ejem‚Äê
plo, el valor predefinido para BOOL es "false".
El valor predeterminado de una variable se aplica como
valor de arranque en la respectiva instancia. Estos valores
aplicados pueden sustituirse por valores de arranque es‚Äê
pec√≠ficos de la instancia.

Comentario

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Comentario sobre el elemento

7829

Declaraci√≥n de la interfaz del bloque
9.6 Editar las propiedades de variables y constantes locales
Grupo

Propiedad

Descripci√≥n

Atributos

Remanencia

Marca la variable como remanente.
Los valores de las variables remanentes se conservan
incluso tras desconectar la alimentaci√≥n.
Este atributo solo est√° disponible en la interfaz de bloques
de funci√≥n con acceso optimizado.

Visible en HMI Engi‚Äê Indica si la variable est√° visible de forma predeterminada
neering
en la lista desplegable de HMI.
Indica si la variable puede escribirse desde HMI / OPC
Escribible desde
HMI / OPC UA / Web UA / Web API en tiempo de ejecuci√≥n.
API
Indica si HMI / OPC UA / Web API puede acceder a esta
Accesible desde
HMI / OPC UA / Web variable en tiempo de ejecuci√≥n.
API
No obstante, tenga en cuenta que con el atributo "Acce‚Äê
sible desde HMI /OPC UA / Web API" no se consigue una
protecci√≥n de acceso general para la variable. El acceso
en modo de escritura o lectura a trav√©s de otras aplica‚Äê
ciones puede ser posible aunque el atributo no est√© acti‚Äê
vado.
Visibilidad con lla‚Äê
madas de bloques
en KOP/FUP

Mostrar:
El par√°metro es visible siempre en llamadas de bloques
en KOP 