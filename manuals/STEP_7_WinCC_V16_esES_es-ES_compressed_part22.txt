óneo. El ajuste predeterminado de
velocidad está fuera del rango admisible de velocidad lenta de hasta 1000000 impul‐
sos/s. Pero como máximo hasta la velocidad máxima parametrizada.

W#16#3203

El ajuste predeterminado de aceleración ACCEL está fuera del rango admisible de 1
a 100000 impulsos/s2.

W#16#3204

El ajuste predeterminado de deceleración DECEL está fuera del rango admisible de
1 a 100000 impulsos/s2.

W#16#3206

El ajuste predeterminado de velocidad SPEED debe ser mayor o igual a la frecuencia
parametrizada de búsqueda de referencia.

W#16#3301

Distancia de cambio de velocidad/desconexión demasiado grande. Especificar una
distancia de cambio de velocidad/desconexión de 108 como máximo.

W#16#3304

Distancia de desconexión insuficiente. La distancia de desconexión debe ser como
mínimo igual a la mitad de la zona de destino.

Programación del PLC
Manual de programación y manejo, 11/2019

6801

Instrucciones
4.2 Instrucciones
Clase de even‐ Explicación
to código de
error
W#16#3305

Distancia de cambio de velocidad insuficiente. La distancia de cambio de velocidad
debe ser como mínimo igual a la mitad de la zona de destino.

W#16#3401

Destino especificado fuera de la zona de trabajo. En un eje lineal con modo incre‐
mental absoluto, el destino especificado debe encontrarse entre los finales de carrera
por software (éstos inclusive).

W#16#3402

Destino especificado erróneo. En un eje rotativo, el destino especificado debe ser
mayor que 0 y menor que el fin del eje rotativo.

W#16#3403

Indicación de recorrido errónea. El trayecto que debe recorrerse en modo incremental
relativo debe ser positivo.

W#16#3404

Indicación de recorrido errónea. La coordenada de destino absoluta resultante debe
ser mayor que -5x108.

W#16#3405

Indicación de recorrido errónea. La coordenada de destino absoluta resultante debe
ser menor que 5x108.

W#16#3406

Indicación de recorrido errónea. La coordenada de destino absoluta resultante debe
encontrarse dentro de la zona de trabajo (+/- la mitad de la zona de destino).

W#16#3501

Zona de desplazamiento demasiado grande. La coordenada de destino + el trayecto
residual actual debe ser mayor/igual a -5x108.

W#16#3502

Zona de desplazamiento demasiado grande. La coordenada de destino + el trayecto
residual actual debe ser menor/igual a 5x108.

W#16#3503

Recorrido de desplazamiento insuficiente. El recorrido de desplazamiento en sentido
positivo debe ser mayor que la distancia de desconexión indicada para el sentido
positivo.

W#16#3504

Recorrido de desplazamiento insuficiente. El recorrido de desplazamiento en sentido
negativo debe ser mayor que la distancia de desconexión indicada para el sentido
negativo.

W#16#3505

Recorrido de desplazamiento insuficiente o final de carrera sobrepasado en sentido
positivo. El último destino alcanzable en sentido positivo (límite de la zona de trabajo
o de la zona de desplazamiento) está demasiado cerca de la posición actual.

W#16#3506

Recorrido de desplazamiento insuficiente o final de carrera sobrepasado en sentido
negativo. El último destino alcanzable en sentido negativo (límite de la zona de trabajo
o de la zona de desplazamiento) está demasiado cerca de la posición actual.

Error de petición (JOB_ERR = TRUE)
Si se detecta un error, el parámetro de salida JOB_ERR se pone a TRUE. En el parámetro
JOB_STAT se indica la causa del error.
Clase de even‐ Explicación
to código de
error

6802

W#16#4001

El eje no está parametrizado. Parametrice el submódulo "Posicionar" en HW Config.

W#16#4002

La petición no es posible, pues hay un posicionamiento activo. Espere hasta que
WORKING = FALSE y vuelva a ejecutar la petición.

W#16#4004

Petición desconocida. Compruebe el número de petición y ejecute nuevamente la
petición.

W#16#4101

En un eje lineal, la coordenada del punto de referencia no puede estar fuera de los
límites de la zona de trabajo.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Clase de even‐ Explicación
to código de
error
W#16#4102

En un eje lineal, la coordenada indicada para el punto de referencia + el trayecto
residual actual todavía debe ser mayor/igual a -5x108.

W#16#4103

En un eje lineal, la coordenada indicada para el punto de referencia + el trayecto
residual actual todavía debe ser menor/igual a 5x108.

W#16#4104

En un eje lineal, la coordenada indicada para el punto de referencia + la distancia
actual del punto inicial del desplazamiento todavía debe ser mayor/igual a -5x108.

W#16#4105

En un eje lineal, la coordenada indicada para el punto de referencia + la distancia
actual del punto inicial del desplazamiento todavía debe ser menor/igual a 5x108.

W#16#4106

En un eje rotativo, la coordenada del punto de referencia no puede ser menor que 0
ni mayor/igual al fin del eje rotativo.

Error externo (ERR)
La tecnología vigila el desplazamiento, la zona de desplazamiento y la periferia conectada.
Para ello, es imprescindible haber conectado previamente las respectivas vigilancias en las
máscaras de parametrización "Accionamiento", "Eje" y "Encoder".
Cuando hay una respuesta de las vigilancias se notifica un error externo. Los errores externos
pueden producirse en cualquier momento, independientemente de las funciones iniciadas.
Dichos errores deben acusarse siempre con ERR_A = TRUE.
Los errores externos se indican en el parámetro ERR (WORD) mediante la activación de un bit.
Vigilancia

Código de error

Bit en ERR-WORD

Error en señal (señal cero)

W#16#0004

2

Zona de desplazamiento

W#16#0800

11

Zona de trabajo

W#16#1000

12

Valor real

W#16#2000

13

Aproximación a destino

W#16#4000

14

Zona de destino

W#16#8000

15

Errores de sistema
Un error de sistema se señaliza con BR = FALSE. Es originado por un error al escribir/leer el
DB de instancia o bien por una llamada múltiple de la instrucción.

DIGITAL: Posicionar con salida digital
Descripción
Utilice la instrucción "DIGITAL" para controlar las funciones de posicionamiento desde el
programa de usuario.
Cuatro salidas digitales de 24 V fijamente asignadas controlan la etapa de potencia (para más
información, consulte la documentación del hardware utilizado). Según el tipo de control

Programación del PLC
Manual de programación y manejo, 11/2019

6803

Instrucciones
4.2 Instrucciones
parametrizado, la salidas digitales controlan el sentido y las marchas de velocidad (marcha
rápida/lenta).
La lectura de recorrido se realiza mediante un encoder incremental asimétrico de 24 V con dos
señales desfasadas en 90 grados.
● Primero se efectúa una aproximación al destino a la velocidad (Vrápida).
● En el punto de cambio de velocidad se cambia a la velocidad lenta (Vlenta).
● En el punto de desconexión se desconecta el accionamiento.
● El punto de cambio de velocidad y el punto de desconexión se establecen con los valores
de los parámetros CHGDIFF_P/M y CUTOFFDIFF_P/M. Es posible definir valores distintos
para la distancia de cambio de velocidad y la distancia de desconexión según si el sentido
de desplazamiento es hacia delante (positivo) o hacia atrás (negativo).
● El desplazamiento finaliza (WORKING = FALSE) cuando se alcanza el punto de
desconexión. A partir de este momento puede iniciarse otro desplazamiento.
● El destino especificado se alcanza (POS_RCD = TRUE) cuando el valor real de posición
alcanza la zona de destino. Si el valor real de posición abandona la zona de destino sin que
se inicie otro desplazamiento, la señal "Posición alcanzada" no se desactiva.

Parámetros básicos:
Aquí se describen los parámetros de la instrucción que son idénticos para todos los modos de
operación. Los parámetros específicos de cada modo de operación se describen en los
distintos modos de operación.
Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste prede‐
(DB de ins‐
terminado
tancia)

Descripción

LADDR

Input

WORD

0

Dirección E/S del submódulo
que se ha definido en la configu‐
ración hardware.

según CPU

W#16#0310

Si las direcciones de E y S son
diferentes, debe indicarse la me‐
nor de las dos direcciones.
CHANNEL

Input

INT

2

0

0

Número de canal

STOP

Input

BOOL

4.4

TRUE/FALSE

FALSE

Detener desplazamiento
Si STOP = TRUE es posible fi‐
nalizar/interrumpir el desplaza‐
miento anticipadamente.

ERR_A

Input

BOOL

4.5

TRUE/FALSE

FALSE

Acuse de grupo error externo
Con ERR_A = TRUE se acusan
errores externos.

SPEED

Input

BOOL

12.0

TRUE/FALSE

FALSE

Dos marchas de velocidad para
marcha rápida/lenta
TRUE=marcha rápida
FALSE=marcha lenta

WORKING

6804

Output

BOOL

14.0

TRUE/FALSE

FALSE

Desplazamiento en curso

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste prede‐
(DB de ins‐
terminado
tancia)

Descripción

ACT_POS

Output

DINT

16

de -5x108 a
+5x108 impulsos

0

Valor real de posición actual

MODE_OUT

Output

INT

20

0, 1, 3, 4, 5

0

Modo de operación activo/ajus‐
tado

ERR

Output

WORD

22

Cada bit

0

Error externo

0ó1

● Bit2: vigilancia de marca
cero
● Bit11: vigilancia de la zona
de desplazamiento (siempre
1)
● Bit12: vigilancia de la zona
de trabajo
● Bit13: vigilancia del valor real
● Bit14: vigilancia de
aproximación a destino
● Bit15: vigilancia de la zona
de destino
Bits restantes reservados

ST_ENBLD

Output

BOOL

24.0

TRUE/FALSE

TRUE

La CPU activa la habilitación de
inicio cuando se cumplen todas
las condiciones siguientes:
● STOP no está presente
(STOP = FALSE)
● No hay ningún error externo
(ERR = 0)
● La habilitación del
accionamiento está activada
(DRV_EN = TRUE)
● No hay ningún
posicionamiento activo
(WORKING = FALSE)

ERROR

Output

BOOL

24.1

TRUE/FALSE

FALSE

Error al iniciar/continuar un des‐
plazamiento

STATUS

Output

WORD

26.0

W#16#0000 a
W#16#FFFF

W#16#0000

Número de error

Programación del PLC
Manual de programación y manejo, 11/2019

6805

Instrucciones
4.2 Instrucciones
Parámetros no interconectados en el bloque (datos locales estáticos):
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

CHGDIFF_P

STATIC

DINT

28

Distancia de cambio de velo‐
cidad positiva:

de 0 a +108 impul‐ 1000
sos

La "distancia de cambio de
velocidad positiva" define el
punto en el que el acciona‐
miento cambia de marcha rá‐
pida a marcha lenta avanzan‐
do.
CUTOFFDIFF_P

STATIC

DINT

32

de 0 a +108 impul‐ 100
sos

Distancia de desconexión po‐
sitiva:
La "distancia de desconexión
positiva" define el punto a
partir del cual el accionamien‐
to desconecta la marcha len‐
ta al avanzar.

CHGDIFF_M

STATIC

DINT

36

de 0 a +108 impul‐ 1000
sos

Distancia de cambio de velo‐
cidad negativa:
La "distancia de cambio de
velocidad negativa" define el
punto en el que el acciona‐
miento cambia de marcha rá‐
pida a marcha lenta retroce‐
diendo.

CUTOFFDIFF_M

STATIC

DINT

40

de 0 a +108 impul‐ 100
sos

Distancia de desconexión ne‐
gativa:
La "distancia de desconexión
negativa" define el punto de
desconexión a partir del cual
el accionamiento desconecta
la marcha lenta al retroceder.

PARA

STATIC

BOOL

44.0

TRUE/FALSE

FALSE

Eje parametrizado

DIR

STATIC

BOOL

44.1

TRUE/FALSE

FALSE

Sentido actual/último del mo‐
vimiento
FALSE = adelante (sentido
positivo)
TRUE = atrás (sentido nega‐
tivo)

CUTOFF

STATIC

BOOL

44.2

TRUE/FALSE

FALSE

Accionamiento en la zona de
desconexión (desde el punto
de desconexión hasta iniciar
el siguiente desplazamiento)

CHGOVER

STATIC

BOOL

44.3

TRUE/FALSE

FALSE

Accionamiento en la zona de
cambio de velocidad (desde
que se alcanza la velocidad
lenta hasta que se inicia el si‐
guiente desplazamiento)

6806

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

DIST_TO_GO STATIC

DINT

46

de -5x108 a
+5x108 impulsos

0

Trayecto residual actual

LAST_TRG

DINT

50

de -5x108 a
+5x108 impulsos

0

Destino último/actual

STATIC

● Modo incremental
absoluto:
al iniciar el
desplazamiento,
LST_TRG = destino
absoluto actual
(TARGET).
● Modo incremental
relativo:
al iniciar el
desplazamiento,
LST_TRG = LAST_TRG
del desplazamiento
anterior +/- el recorrido
indicado (TARGET).

Parámetros del modo de operación "Jog"
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

DRV_EN

Input

BOOL

4.0

TRUE/FALSE

FALSE

Habilitación del accionamien‐
to

DIR_P

Input

BOOL

4.2

TRUE/FALSE

FALSE

Jog en sentido positivo (flan‐
co ascendente)

DIR_M

Input

BOOL

4.3

TRUE/FALSE

FALSE

Jog en sentido negativo (flan‐
co ascendente)

MODE_IN

Input

INT

6

0, 1, 3, 4, 5

1

Modo de operación, 1 = Jog

WORKING

Output

BOOL

14.0

TRUE/FALSE

FALSE

Desplazamiento en curso

ACT_POS

Output

DINT

16

de -5x10 a
+5x108 impulsos

0

Valor real de posición actual

MODE_OUT

Output

INT

20

0, 1, 3, 4, 5

0

Modo de operación activo/
ajustado

Programación del PLC
Manual de programación y manejo, 11/2019

8

6807

Instrucciones
4.2 Instrucciones

Parámetros del modo de operación "Búsqueda del punto de referencia"
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

DRV_EN

Input

BOOL

4.0

TRUE/FALSE

FALSE

Habilitación del accionamien‐
to

DIR_P

Input

BOOL

4.2

TRUE/FALSE

FALSE

Búsqueda del punto de refe‐
rencia en sentido positivo
(flanco ascendente)

DIR_M

Input

BOOL

4.3

TRUE/FALSE

FALSE

Búsqueda del punto de refe‐
rencia en sentido negativo
(flanco ascendente)

MODE_IN

Input

INT

6

0, 1, 3, 4, 5

1

Modo de operación, 3 = "Bús‐
queda del punto de referen‐
cia"

WORKING

Output

BOOL

14.0

TRUE/FALSE

FALSE

Desplazamiento en curso

SYNC

Output

BOOL

14.3

TRUE/FALSE

FALSE

SYNC = TRUE: el eje está
sincronizado

ACT_POS

Output

DINT

16

de -5x108 a
+5x108 impulsos

0

Valor real de posición actual

MODE_OUT

Output

INT

20

0, 1, 3, 4, 5

0

Modo de operación activo/
ajustado

Parámetros del modo de operación "Modo incremental relativo"
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

DRV_EN

Input

BOOL

4.0

TRUE/FALSE

FALSE

Habilitación del accionamien‐
to

DIR_P

Input

BOOL

4.2

TRUE/FALSE

FALSE

Desplazamiento en sentido
positivo (flanco ascendente)

DIR_M

Input

BOOL

4.3

TRUE/FALSE

FALSE

Desplazamiento en sentido
negativo (flanco ascendente)

MODE_IN

Input

INT

6

0, 1, 3, 4, 5

1

Modo de operación, 4 = Mo‐
do incremental relativo

TARGET

Input

DINT

8

de 0 a 109

1000

Recorrido en impulsos (sólo
se admiten valores positivos)

WORKING

Output

BOOL

14.0

TRUE/FALSE

FALSE

Desplazamiento en curso

POS_RCD

Output

BOOL

14.1

TRUE/FALSE

FALSE

Posición alcanzada

ACT_POS

Output

DINT

16

de -5x10 a
+5x108 impulsos

0

Valor real de posición actual

MODE_OUT

Output

INT

20

0, 1, 3, 4, 5

0

Modo de operación activo/
ajustado

impulsos

6808

8

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros del modo de operación "Modo incremental absoluto"
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

DRV_EN

Input

BOOL

4.0

TRUE/FALSE

FALSE

Habilitación del accionamien‐
to

START

Input

BOOL

4.1

TRUE/FALSE

FALSE

Iniciar desplazamiento (flan‐
co ascendente)

DIR_P

Input

BOOL

4.2

TRUE/FALSE

FALSE

Desplazamiento en sentido
positivo (flanco ascendente)

DIR_M

Input

BOOL

4.3

TRUE/FALSE

FALSE

Desplazamiento en sentido
negativo (flanco ascendente)

MODE_IN

Input

INT

6

0, 1, 3, 4, 5

1

Modo de operación, 5 = Mo‐
do incremental absoluto

TARGET

Input

DINT

8

Eje lineal:

1000

Destino en impulsos

FALSE

Desplazamiento en curso

de -5x10 a
+5x108
8

Eje rotativo:
de 0 a fin de eje
rotativo -1
WORKING

Output

BOOL

14.0

TRUE/FALSE

POS_RCD

Output

BOOL

14.1

TRUE/FALSE

FALSE

Posición alcanzada

ACT_POS

Output

DINT

16

de -5x108 a
+5x108 impulsos

0

Valor real de posición actual

MODE_OUT

Output

INT

20

0, 1, 3, 4, 5

0

Modo de operación activo/
ajustado

Parámetros de la petición "Posicionar el punto de referencia"
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

SYNC

Output

BOOL

14.3

El eje está sincronizado

TRUE/FALSE

FALSE

Parámetros no interconectados en el bloque (datos locales estáticos):
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

JOB_REQ

STATIC

BOOL

66.0

TRUE/FALSE

FALSE

Lanzamiento de petición
(flanco ascendente)

JOB_DONE

STATIC

BOOL

66.1

TRUE/FALSE

TRUE

La nueva petición puede ini‐
ciarse

JOB_ERR

STATIC

BOOL

66.2

TRUE/FALSE

FALSE

Petición errónea

JOB_ID

STATIC

INT

68

1, 2

0

Petición, 1 = "Posicionar el
punto de referencia"

Programación del PLC
Manual de programación y manejo, 11/2019

6809

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

JOB_STAT

STATIC

WORD

70

W#16#0000 a
W#16#FFFF

W#16#0000

Número de error de petición

JOB_VAL

STATIC

DINT

72

de -5x108 a
+5x108 impulsos

0

Parámetros de la petición
Coordenada del punto de re‐
ferencia

Parámetros de la petición "Borrar trayecto residual"
Parámetros no interconectados en el bloque (datos locales estáticos):
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

JOB_REQ

STATIC

BOOL

66.0

TRUE/FALSE

FALSE

Lanzamiento de petición
(flanco ascendente)

JOB_DONE

STATIC

BOOL

66.1

TRUE/FALSE

TRUE

La nueva petición puede ini‐
ciarse

JOB_ERR

STATIC

BOOL

66.2

TRUE/FALSE

FALSE

Petición errónea

JOB_ID

STATIC

INT

68

1, 2

0

Petición, 2 = "Borrar trayecto
residual"

JOB_STAT

STATIC

WORD

70

de 0 a FFFF hex

0

Número de error de petición

JOB_VAL

STATIC

DINT

72

-

0

Ninguna

Parámetros de la función "Medición de longitud"
La función se inicia mediante un flanco en la entrada digital. No hay parámetros específicos de
entrada.
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

MSR_DONE

Output

BOOL

14.2

Medición de longitud finaliza‐
da

TRUE/FALSE

FALSE

Parámetros no interconectados en el bloque (datos locales estáticos):
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

BEG_VAL

STATIC

DINT

54

de -5x108 a
+5x108 impulsos

0

Valor real de posición para
inicio de medición de longitud

END_VAL

STATIC

DINT

58

de -5x108 a
+5x108 impulsos

0

Valor real de posición para fin
de medición de longitud

LEN_VAL

STATIC

DINT

62

de 0 a 109 impul‐
sos

0

Longitud medida

6810

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
Si se detecta un error, el parámetro de salida ERROR se pone a TRUE. En el parámetro
STATUS se indica la causa del error.
Código de error
STATUS

Explicación

W#16#2001

Instrucción errónea, utilizar la instrucción "DIGITAL".

W#16#2004

Número de canal erróneo (CHANNEL). Ajuste el número de canal "0".

W#16#3001

Petición de desplazamiento no aceptada por tarea errónea en la misma llamada.
Corrija los parámetros del JOB correspondiente.

W#16#3002

No está permitido modificar MODE_IN mientras el accionamiento está activo. Es‐
pere hasta que el posicionamiento haya terminado.

W#16#3003

Modo de operación desconocido (MODE_IN). Se admiten 1(Jog), 3 (Búsqueda del
punto de referencia), 4 (Modo incremental relativo) y 5 (Modo incremental absoluto).

W#16#3004

No debe haber más de una solicitud de inicio activada al mismo tiempo. Las solici‐
tudes de inicio permitidas son DIR_P o DIR_M o START.

W#16#3005

START sólo está permitido en el modo de operación "Modo incremental absoluto".
Inicie el desplazamiento con DIR_P o DIR_M.

W#16#3006

DIR_P o DIR_M no está permitido en un eje lineal con el modo de operación "Modo
incremental absoluto". Inicie el desplazamiento con START.

W#16#3007

El eje no está sincronizado. "Modo incremental absoluto" sólo es posible con el eje
sincronizado.

W#16#3008

Abandonar la zona de trabajo. El desplazamiento retrocediendo a la zona de trabajo
sólo está permitido en modo "Jog".

W#16#3101

No hay habilitación de inicio, puesto que el eje no está parametrizado. Parametrice
el submódulo "Posicionar" en HW Config.

W#16#3102

No hay habilitación de inicio, puesto que la habilitación del accionamiento no está
activada. Active la "habilitación del accionamiento" en la instrucción
(DRV_EN=TRUE).

W#16#3103

No hay habilitación de inicio, puesto que STOP está activado. Borre STOP de la
instrucción (STOP=FALSE).

W#16#3104

No hay habilitación de inicio, puesto que el eje se está posicionando (WOR‐
KING=TRUE). Espere hasta que el posicionamiento haya terminado.

W#16#3105

No hay habilitación de inicio, puesto que todavía hay por lo menos un error externo
no acusado. Elimine y acuse primero todos los errores externos y reinicie después
el desplazamiento.

W#16#3201

Ajuste predeterminado de velocidad SPEED erróneo. En el posicionamiento con
salidas digitales, sólo se admite "marcha lenta" (0) y "marcha rápida" (1).

W#16#3301

Distancia de cambio de velocidad/desconexión demasiado grande. Determinar una
distancia de cambio de velocidad/desconexión igual a 108 como máximo.

W#16#3303

Distancia de cambio de velocidad insuficiente. La distancia de cambio de velocidad
debe ser mayor o igual a la distancia de desconexión.

W#16#3304

Distancia de desconexión insuficiente. La distancia de desconexión debe ser como
mínimo igual a la mitad de la zona de destino.

W#16#3401

Destino especificado fuera de la zona de trabajo. En un eje lineal con modo incre‐
mental absoluto, el destino especificado debe encontrarse entre los finales de ca‐
rrera por software (éstos inclusive).

W#16#3402

Destino especificado erróneo. En un eje rotativo, el destino especificado debe ser
mayor que "0" y menor que el fin del eje rotativo.

Programación del PLC
Manual de programación y manejo, 11/2019

6811

Instrucciones
4.2 Instrucciones
Código de error
STATUS

Explicación

W#16#3403

Indicación de recorrido errónea. El trayecto que debe recorrerse en modo incre‐
mental relativo debe ser positivo.

W#16#3404

Indicación de recorrido errónea. La coordenada de destino absoluta resultante debe
ser mayor que -5x108.

W#16#3405

Indicación de recorrido errónea. La coordenada de destino absoluta resultante debe
ser menor que 5x108.

W#16#3406

Indicación de recorrido errónea. La coordenada de destino absoluta resultante debe
encontrarse dentro de la zona de trabajo (+/- la mitad de la zona de destino).

W#16#3501

Recorrido de desplazamiento demasiado grande. La coordenada de destino + el
trayecto residual actual debe ser mayor/igual a -5x108.

W#16#3502

Recorrido de desplazamiento demasiado grande. La coordenada de destino + el
trayecto residual actual debe ser menor/igual a 5x108.

W#16#3503

Recorrido de desplazamiento insuficiente. El recorrido de desplazamiento en sen‐
tido positivo debe ser mayor que la distancia de desconexión indicada para el sen‐
tido positivo.

W#16#3504

Recorrido de desplazamiento insuficiente. El recorrido de desplazamiento en sen‐
tido negativo debe ser mayor que la distancia de desconexión indicada para el
sentido negativo.

W#16#3505

Recorrido de desplazamiento insuficiente o final de carrera sobrepasado en sentido
positivo. El último destino alcanzable en sentido positivo (límite de la zona de trabajo
o de la zona de desplazamiento) está demasiado cerca de la posición actual.

W#16#3506

Recorrido de desplazamiento insuficiente o final de carrera sobrepasado en sentido
negativo. El último destino alcanzable en sentido negativo (límite de la zona de
trabajo o de la zona de desplazamiento) está demasiado cerca de la posición actual.

Error de petición (JOB_ERR = TRUE)
Si se detecta un error, el parámetro JOB_ERR se pone a TRUE. En el parámetro JOB_STAT
se indica la causa del error.

6812

Clase de evento
código de error

Explicación

W#16#4001

El eje no está parametrizado. Parametrice el submódulo "Posicionar" en HW Config.

W#16#4002

La petición no es posible, pues hay un posicionamiento activo. Las peticiones sólo
pueden ejecutarse si no hay ningún posicionamiento activo. Espere hasta que
WORKING = FALSE y vuelva a ejecutar la petición.

W#16#4004

Petición desconocida. Compruebe el número de petición y ejecute nuevamente la
petición.

W#16#4101

En un eje lineal, la coordenada del punto de referencia no puede estar fuera de los
límites de la zona de trabajo.

W#16#4102

En un eje lineal, la coordenada indicada para el punto de referencia + el trayecto
residual actual todavía debe ser mayor/igual a -5x108.

W#16#4103

En un eje lineal, la coordenada indicada para el punto de referencia + el trayecto
residual actual todavía debe ser menor/igual a 5x108.

W#16#4104

En un eje lineal, la coordenada indicada para el punto de referencia + la distancia
actual del punto inicial del desplazamiento todavía debe ser mayor/igual a -5x108.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Clase de evento
código de error

Explicación

W#16#4105

En un eje lineal, la coordenada indicada para el punto de referencia + la distancia
actual del punto inicial del desplazamiento todavía debe ser menor/igual a 5x108.

W#16#4106

En un eje rotativo, la coordenada del punto de referencia no puede ser menor que
0 ni mayor/igual al fin del eje rotativo.

Error externo (ERR)
La tecnología vigila el desplazamiento, la zona de desplazamiento y la periferia conectada.
Para ello, es imprescindible haber conectado previamente las respectivas vigilancias en las
máscaras de parametrización "Accionamiento", "Eje" y "Encoder".
Cuando hay una respuesta de las vigilancias se notifica un error externo. Los errores externos
pueden producirse en cualquier momento, independientemente de las funciones iniciadas.
Dichos errores deben acusarse siempre con ERR_A = TRUE.
Los errores externos se indican en el parámetro ERR (WORD) mediante la activación de un bit.
Vigilancia

Código de error

Bit en ERR-WORD

Error en señal (señal cero)

W#16#0004

2

Zona de desplazamiento

W#16#0800

11

Zona de trabajo

W#16#1000

12

Valor real

W#16#2000

13

Aproximación a destino

W#16#4000

14

Zona de destino

W#16#8000

15

Errores de sistema
Un error de sistema se señaliza con BR = FALSE. Es originado por un error al escribir/leer el
DB de instancia o por una llamada múltiple de la instrucción.

COUNT: Controlar contador
Descripción
Utilice la instrucción "COUNT" para controlar el contador desde el programa de usuario.
Se dispone de la funcionalidad siguiente:
● Iniciar/parar el contador con la puerta de software SW_GATE
● Habilitar/controlar la salida DO
● Leer los bits de estado STS_CMP, STS_OFLW, STS_UFLW y STS_ZP
● Leer el estado actual del contador COUNTVAL
● Peticiones para leer y escribir los registros de contaje internos
● Leer el período actual TIMEVAL

Programación del PLC
Manual de programación y manejo, 11/2019

6813

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declaración Tipo de
datos

Direc‐
Rango de valores
ción (DB
de instan‐
cia)

Ajuste prede‐
terminado

Descripción

LADDR

Input

0

W#16#0300

Dirección E/S del submódu‐
lo que se ha definido en la
configuración hardware.

WORD

según CPU

Si las direcciones de entra‐
da y salida son diferentes,
debe indicarse la menor de
las dos direcciones.
CHANNEL

Input

INT

2

CPU 312C: de 0 a 1

0

Número de canal

CPU 313C: de 0 a 2
CPU 314C: de 0 a 3
SW_GATE

Input

BOOL

4.0

TRUE/FALSE

FALSE

Puerta de software para ini‐
ciar/parar el contador

CTRL_DO

Input

BOOL

4.1

TRUE/FALSE

FALSE

Habilitar salida

SET_DO

Input

BOOL

4.2

TRUE/FALSE

FALSE

Controlar salida

JOB_REQ

Input

BOOL

4.3

TRUE/FALSE

FALSE

Lanzamiento de petición
(flanco ascendente)

JOB_ID

Input

WORD

6

W#16#0000
Petición sin función

W#16#0000

Número de petición

W#16#0001
Escribir valor de contaje
W#16#0002
Escribir valor de carga
W#16#0004
Escribir valor de compa‐
ración
W#16#0008
Escribir histéresis
W#16#0010
Escribir duración de im‐
pulso
W#16#0082
Leer valor de carga
W#16#0084
Leer valor de compara‐
ción
W#16#0088
Leer histéresis
W#16#0090
Leer duración de impul‐
so
JOB_VAL

Input

DINT

8

-231 a
+231 -1

0

Valor para peticiones de es‐
critura.

STS_GATE

Output

BOOL

12.0

TRUE/FALSE

FALSE

Estado de puerta interna

6814

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de
datos

Direc‐
Rango de valores
ción (DB
de instan‐
cia)

Ajuste prede‐
terminado

Descripción

STS_STRT

Output

BOOL

12.1

TRUE/FALSE

FALSE

Estado de puerta hardware
(entrada de inicio)

STS_LTCH

Output

BOOL

12.2

TRUE/FALSE

FALSE

Estado de entrada de con‐
gelación

STS_DO

Output

BOOL

12.3

TRUE/FALSE

FALSE

Estado de salida

STS_C_DN

Output

BOOL

12.4

TRUE/FALSE

FALSE

Estado de sentido hacia
atrás.
Se indica siempre el último
sentido de contaje. Des‐
pués de la primera llamada
de la instrucción,
STS_C_DN tiene el valor
FALSE.

STS_C_UP

Output

BOOL

12.5

TRUE/FALSE

FALSE

Estado de sentido hacia de‐
lante
Se indica siempre el último
sentido de contaje. Des‐
pués de la primera llamada
de la instrucción,
STS_C_UP tiene el valor
TRUE

COUNTVAL

Output

DINT

14

-231 a
+231 -1

0

Valor actual de contaje

LATCHVAL

Output

DINT

18

-231 a
+231 -1

0

Valor actual de congelación

JOB_DONE

Output

BOOL

22.0

TRUE/FALSE

TRUE

La nueva petición puede
iniciarse

JOB_ERR

Output

BOOL

22.1

TRUE/FALSE

FALSE

Petición errónea

JOB_STAT

Output

WORD

24

de 0 a W#16#FFFF

0

Número de error de peti‐
ción

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".
Nota
Si se ha ajustado el parámetro "Comportamiento de la salida" (que se ajusta mediante la
interfaz de parametrización) a "Sin comparación", rige lo siguiente:
● la salida se conecta como una salida normal.
● los parámetros de entrada CTRL_DO y SET_DO no son efectivos.
● Los bits de estado STS_DO y STS_CMP (estado del comparador en el IDB) permanecen
desactivados

Programación del PLC
Manual de programación y manejo, 11/2019

6815

Instrucciones
4.2 Instrucciones
Parámetros no interconectados en el bloque (datos locales estáticos):
Parámetro

Declaración

Tipo de
datos

Direc‐
ción (DB
de ins‐
tancia)

Rango de va‐
lores

Ajuste prede‐
terminado

Descripción

STS_CMP

STATIC

BOOL

26.3

TRUE/FALSE

FALSE

Estado del comparador.
Se desactiva con RES_STS.
El bit de estado STS_CMP indica que
la condición de comparación del
comparador se cumple o se cumplía.
Con STS_CMP también se indica
que la salida estaba activada
(STS_DO = TRUE)

STS_OFLW

STATIC

BOOL

26.5

TRUE/FALSE

FALSE

Estado de rebase por exceso
Se desactiva con RES_STS.

STS_UFLW

STATIC

BOOL

26.6

TRUE/FALSE

FALSE

Estado de rebase por defecto
Se desactiva con RES_STS.

STS_ZP

STATIC

BOOL

26.7

TRUE/FALSE

FALSE

Estado de paso por cero
Se desactiva con RES_STS.
Sólo se activa en contajes sin sentido
normal de contaje.
Indica el paso por cero. También se
activa si el contador se pone a 0 o si
el contador cuenta a partir del valor
de carga=0.

JOB_OVAL

STATIC

DINT

28

-231 a
+231 -1

0

Valor de salida para peticiones de
lectura.

RES_STS

STATIC

BOOL

32.2

TRUE/FALSE

FALSE

Desactivar bits de estado.
Desactiva los bits de estado
STS_CMP, STS_OFLW,
STS_UFLW y STS_ZP.
Para desactivar los bits de estado se
requieren dos llamadas de la instruc‐
ción.

Parámetros JOB_ERR y JOB_STAT
Si se ha producido un error de petición, se pone JOB_ERR = TRUE. La causa exacta del error
se indica en JOB_STAT.

6816

Clase de evento có‐
digo de error

Explicación

W#16#0121

Valor de comparación demasiado bajo.

W#16#0122

Valor de comparación demasiado alto.

W#16#0131

Histéresis insuficiente.

W#16#0132

Histéresis excesiva.

W#16#0141

Duración de impulso insuficiente.

W#16#0142

Duración de impulso excesiva.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Clase de evento có‐
digo de error

Explicación

W#16#0151

Valor de carga demasiado bajo.

W#16#0152

Valor de carga demasiado alto.

W#16#0161

Estado de contaje demasiado bajo.

W#16#0162

Estado de contaje demasiado alto.

W#16#01FF

Número de petición no válido.

Errores de sistema
Si se ha producido un error de sistema, BR se pone = FALSE.
Clase de evento có‐
digo de error

Explicación

W#16#8001

Modo de operación erróneo o error de parametrización. Ajuste el modo de ope‐
ración correcto en la configuración hardware o utilice la instrucción adecuada al
modo de operación ajustado.

W#16#8009

Número de canal no válido. Ajuste un número de canal ≤ 3 (valor específico de
la CPU).

FREQUENC: Controlar frecuencímetro
Descripción
Utilice la instrucción "FREQUENC" para manejar el frecuencímetro desde el programa de
usuario.
Se dispone de la funcionalidad siguiente:
● Iniciar/parar con la puerta de software SW_GATE
● Habilitar/controlar la salida DO
● Leer los bits de estado STS_CMP, STS_OFLW y STS_UFLW
● Leer el valor de frecuencia actual MEAS_VAL
● Peticiones para leer y escribir los registros internos de medida de frecuencia

Programación del PLC
Manual de programación y manejo, 11/2019

6817

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declaración

Tipo de
datos

Dirección
(DB
de instan‐
cia)

Rango de valores Ajuste predeter‐
minado

Descripción

LADDR

Input

WORD

0

según CPU

Dirección E/S del submódulo
que se ha definido en la con‐
figuración hardware.

W#16#0300

Si las direcciones E y S son
diferentes, debe indicarse la
menor de las dos direcciones.
CHANNEL

Input

INT

2

CPU 312C:
de 0 a 1
CPU 313C:
de 0 a 2
CPU 314C:
de 0 a 3

0

Número de canal

SW_GATE

Input

BOOL

4.0

TRUE/FALSE

FALSE

Puerta de software para ini‐
ciar/parar la medida de fre‐
cuencia

MAN_DO

Input

BOOL

4.1

TRUE/FALSE

FALSE

Habilitar el control manual de
la salida

SET_DO

Input

BOOL

4.2

TRUE/FALSE

FALSE

Controlar salida

JOB_REQ

Input

BOOL

4.3

TRUE/FALSE

FALSE

Lanzamiento de petición
(flanco ascendente)

JOB_ID

Input

WORD

6

W#16#0000 =
petición sin fun‐
ción

0

Número de petición

W#16#0001 = es‐
cribir límite infe‐
rior
W#16#0002 = es‐
cribir límite supe‐
rior
W#16#0004 = es‐
cribir tiempo de
integración
W#16#0081 =
leer límite inferior
W#16#0082 =
leer límite supe‐
rior
W#16#0084 =
leer tiempo de in‐
tegración
JOB_VAL

Input

DINT

8

-231 a
+231 -1

0

Valor para peticiones de es‐
critura

STS_GATE

Output

BOOL

12.0

TRUE/FALSE

FALSE

Estado de puerta interna

STS_STRT

Output

BOOL

12.1

TRUE/FALSE

FALSE

Estado de puerta hardware
(entrada de inicio)

6818

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de
datos

Dirección
(DB
de instan‐
cia)

Rango de valores Ajuste predeter‐
minado

Descripción

STS_DO

Output

BOOL

12.2

TRUE/FALSE

FALSE

Estado de salida

STS_C_DN

Output

BOOL

12.3

TRUE/FALSE

FALSE

Estado de sentido hacia atrás
Se indica siempre el último
sentido de contaje. Después
de la primera llamada de la
instrucción, STS_C_DN tiene
el valor FALSE.

STS_C_UP

Output

BOOL

12.4

TRUE/FALSE

FALSE

Estado de sentido hacia de‐
lante
Se indica siempre el último
sentido de contaje. Después
de la primera llamada de la
instrucción, STS_C_UP tiene
el valor TRUE.

MEAS_VAL

Output

DINT

14

de 0 a +231 -1

0

Valor de frecuencia actual

COUNTVAL

Output

DINT

18

-2 a
+231 -1

0

Valor de contaje actual (em‐
pieza por 0 cada vez que se
abre la puerta)

JOB_DONE

Output

BOOL

22.0

TRUE/FALSE

TRUE

La nueva petición puede ini‐
ciarse

JOB_ERR

Output

BOOL

22.1

TRUE/FALSE

FALSE

Petición errónea

JOB_STAT

Output

WORD

24

W#16#0000 a
W#16#FFFF

W#16#0000

Número de error de petición

31

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".
Nota
Si se ha ajustado el parámetro "Comportamiento de la salida" (que se ajusta mediante la
interfaz de parametrización) a "Sin comparación", rige lo siguiente:
● la salida se conecta como una salida normal.
● los parámetros de entrada MAN_DO y SET_DO no son efectivos.
● el bit de estado STS_DO permanece desactivado.

Programación del PLC
Manual de programación y manejo, 11/2019

6819

Instrucciones
4.2 Instrucciones
Parámetros no interconectados en el bloque (datos locales estáticos sin los parámetros
reservados RESxx):
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

STS_CMP

STATIC

BOOL

26.3

Estado de fin de medición

TRUE/FALSE

FALSE

Se desactiva con RES_STS .
El valor medido se actualiza
cada vez que finaliza un inter‐
valo. El fin de una medición
se notifica con el bit de esta‐
do STS_CMP
STS_OFLW

STATIC

BOOL

26.5

TRUE/FALSE

FALSE

Estado de rebase por exceso
Se desactiva con RES_STS.

STS_UFLW

STATIC

BOOL

26.6

TRUE/FALSE

FALSE

Estado de rebase por defecto

JOB_OVAL

STATIC

DINT

28

-2 a 2 -1

0

Valor de salida para peticio‐
nes de lectura

RES_STS

STATIC

BOOL

32.2

TRUE/FALSE

FALSE

Desactivar bits de estado.

Se desactiva con RES_STS.
31

31

Desactiva los bits de estado
STS_CMP, STS_OFLW y
STS_UFLW.
Para desactivar los bits de
estado se requieren dos lla‐
madas de la instrucción.

Parámetros JOB_ERR y JOB_STAT
Si se ha producido un error de petición, se pone JOB_ERR = TRUE. La causa exacta del error
se indica en JOB_STAT.

6820

Clase de evento
código de error

Explicación

W#16#0221

Tiempo de integración demasiado corto.

W#16#0222

Tiempo de integración demasiado largo.

W#16#0231

Límite inferior de frecuencia demasiado bajo.

W#16#0232

Límite inferior de frecuencia demasiado alto.

W#16#0241

Límite superior de frecuencia demasiado bajo.

W#16#0242

Límite superior de frecuencia demasiado alto.

W#16#02FF

Número de petición no válido.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Errores de sistema
Si se ha producido un error de sistema, BR se pone = FALSE.
Clase de evento
código de error

Explicación

W#16#8001

Modo de operación erróneo o error de parametrización. Ajuste el modo de opera‐
ción correcto en la configuración hardware o utilice la instrucción adecuada al
modo de operación ajustado

W#16#8009

Número de canal no válido. Ajuste un número de canal ≤ 3 (valor específico de la
CPU).

PULSE: Controlar modulación por ancho de impulso
Descripción
Utilice la instrucción "PULSE" para controlar la modulación por ancho de impulso desde el
programa de usuario.
Se dispone de la funcionalidad siguiente:
● Iniciar/parar con la puerta de software SW_EN
● Habilitar/controlar la salida DO
● Leer los bits de estado STS_EN, STS_STRT y STS_DO
● Introducir el valor de salida
● Peticiones para leer y escribir los registros

Parámetros
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Significado

LADDR

Input

WORD

0

Dirección E/S del submódulo
que se ha definido en la con‐
figuración hardware.

según CPU

W#16#0300

Si las direcciones E y S son
diferentes, debe indicarse la
menor de las dos direcciones.
CHANNEL

Input

INT

2

CPU 312C:
de 0 a 1
CPU 313C:
de 0 a 2
CPU 314C:
de 0 a 3

0

Número de canal

SW_EN

Input

BOOL

4.0

TRUE/FALSE

FALSE

Puerta de software para ini‐
ciar/parar la salida

MAN_DO

Input

BOOL

4.1

TRUE/FALSE

FALSE

Habilitar el control manual de
la salida

SET_DO

Input

BOOL

4.2

TRUE/FALSE

FALSE

Controlar salida

Programación del PLC
Manual de programación y manejo, 11/2019

6821

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Significado

OUTP_VAL

Input

INT

6.0

Especificación del valor de
salida

en tanto por mil:
de 0 a 1000

0

como valor analó‐
gico S7:
de 0 a 27648

Si se determina un valor de
salida > 1 000 ó 27648, la
CPU lo limita a 1 000 ó
27648, respectivamente

JOB_REQ

Input

BOOL

8.0

TRUE/FALSE

FALSE

Lanzamiento de petición
(flanco ascendente)

JOB_ID

Input

WORD

10

W#16#0000 = pe‐ W#16#0000
tición sin función

Número de petición

W#16#0001 = es‐
cribir período
W#16#0002 = es‐
cribir retardo a la
conexión
W#16#0004 = es‐
cribir duración mí‐
nima de impulso
W#16#0081 =
leer período
W#16#0082 =
leer retardo a la
conexión
W#16#0084 =
leer duración mí‐
nima de impulso
JOB_VAL

Input

DINT

12

-231 a +231 -1

0

Valor para peticiones de es‐
critura.

STS_EN

Output

BOOL

16.0

TRUE/FALSE

FALSE

Estado de la habilitación

STS_STRT

Output

BOOL

16.1

TRUE/FALSE

FALSE

Estado de puerta hardware
(entrada de inicio)

STS_DO

Output

BOOL

16.2

TRUE/FALSE

FALSE

Estado de salida

JOB_DONE

Output

BOOL

16.3

TRUE/FALSE

TRUE

La nueva petición puede ini‐
ciarse

JOB_ERR

Output

BOOL

16.4

TRUE/FALSE

FALSE

Petición errónea

JOB_STAT

Output

WORD

18

W#16#0000 a
W#16#FFFF

W#16#0000

Número de error de petición

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

6822

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetros no interconectados en el bloque (datos locales estáticos):
Parámetro

Declaración

Tipo de
datos

Dirección
Rango de valores Ajuste predeter‐
(DB de ins‐
minado
tancia)

Descripción

JOB_OVAL

Output

DINT

20

Valor de salida para peticio‐
nes de lectura

-231 a 231 -1

0

Parámetros JOB_ERR y JOB_STAT
Si se ha producido un error de petición, se pone JOB_ERR = TRUE. La causa exacta del error
se indica en JOB_STAT.
Clase de evento
código de error

Explicación

W#16#0411

Período demasiado corto.

W#16#0412

Período demasiado largo.

W#16#0421

Retardo a la conexión demasiado corto.

W#16#0422

Retardo a la conexión demasiado largo.

W#16#0431

Duración mínima de impulso demasiado corta.

W#16#0432

Duración mínima de impulso demasiado larga.

W#16#04FF

Número de petición no válido.

Errores de sistema
Si se ha producido un error de sistema, BR se pone = FALSE.
Clase de evento
código de error

Explicación

W#16#8001

Modo de operación erróneo o error de parametrización. Ajuste el modo de opera‐
ción correcto en la configuración hardware o utilice la instrucción adecuada al
modo de operación ajustado.

W#16#8009

Número de canal no válido. Ajuste un número de canal ≤ 3 (valor específico de la
CPU).

Programación del PLC
Manual de programación y manejo, 11/2019

6823

Instrucciones
4.2 Instrucciones

4.2.5

Comunicación

4.2.5.1

Información común de parámetros y errores

Parámetros comunes a las instrucciones para la comunicación básica S7
Parámetro REQ
El parámetro de entrada REQ (request to activate) es un parámetro de control disparado por
nivel. Permite lanzar la petición (la transmisión de datos o la interrupción de la conexión):
● Si se llama la instrucción para una petición que no está activada en ese momento, la
petición se lanza con REQ=1. Si en el momento de la primera llamada de una instrucción
todavía no existe una conexión con el interlocutor, ésta se establece antes de iniciar la
transmisión.
● Si ha lanzado una petición y ésta todavía no ha finalizado y vuelve a llamar la instrucción
para la misma petición, la instrucción no evalúa REQ.

Parámetro REQ_ID (sólo "X_SEND" y "X_RCV")
El parámetro de entrada REQ_ID permite identificar los datos de transmisión. Se transmite
desde el sistema operativo de la CPU emisora a la instrucción "X_RCV (Página 7618)" de la
CPU del interlocutor.
En el lado receptor es necesario el parámetro REQ_ID en los siguientes casos:
● Para llamar varias instrucciones "X_SEND (Página 7617)" con diferentes parámetros
REQ_ID en una CPU emisora y transmitir los datos a un interlocutor.
● Para transmitir datos de varias CPUs emisoras a un interlocutor con la instrucción
"X_SEND (Página 7617)".
Evaluando REQ_ID es posible depositar los datos de recepción en diferentes áreas de
memoria.

Parámetros RET_VAL y BUSY
Las instrucciones para la comunicación básica S7 son asíncronas, de modo que la ejecución
de una petición se prolonga a lo largo de varias llamadas. El estado de la petición se indica a
través de los parámetros de salida RET_VAL y BUSY.
Véase también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813).

6824

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro CONT
El parámetro de entrada CONT (continue) es un parámetro de control. Con él se especifica si
la conexión con el interlocutor debe mantenerse una vez finalizada la petición.
● Si en la primera llamada selecciona CONT=0, la conexión se deshace tras finalizar la
transmisión. De ese modo estará disponible para el intercambio de datos con otro
interlocutor.
Con este procedimiento se garantiza que sólo estén ocupados los recursos de conexión
necesarios en cada momento.
● Si en la primera llamada selecciona CONT=1, la conexión se mantiene tras finalizar la
transmisión.
Este procedimiento resulta apropiado, por ejemplo, para intercambiar datos cíclicamente
entre dos estaciones.
Nota
Una conexión establecida con CONT=1 también puede interrumpirse explícitamente con
"X_ABORT (Página 7626)" o "I_ABORT (Página 7610)".

Información de error de las instrucciones de comunicación para conexiones S7 no configuradas
Mostrar
Las informaciones de error "reales" indicadas, entre otras, en la siguiente tabla para las
instrucciones "X_SEND (Página 7617)", "X_RCV (Página 7618)", "X_GET (Página 7622)",
"X_PUT (Página 7624)", "X_ABORT (Página 7626)", "I_PUT (Página 7608)", "I_GET
(Página 7606)" y "I_ABORT (Página 7610)" pueden clasificarse de la siguiente manera:
Código de
error
(W#16# ...)

Explicación

809x

Error en la CPU en la que se ejecuta la instrucción

80Ax

Error de comunicación permanente

80Bx

Error en el interlocutor

80Cx

Error temporal

La tabla siguiente contiene información de errores específicos de las instrucciones.
Código de
error
(W#16# ...)

Explicación (general)

Explicación (específica de instrucción)

0000

La ejecución ha finalizado sin errores.

"X_ABORT (Página 7617)" y "I_ABORT (Pá‐
gina 7610)": REQ=1, y la conexión indicada
no está establecida.
"X_RCV (Página 7618)": EN_DT=1 y
RD=NIL

Programación del PLC
Manual de programación y manejo, 11/2019

6825

Instrucciones
4.2 Instrucciones
Código de
error
(W#16# ...)

Explicación (general)

Explicación (específica de instrucción)

00xy

-

"X_RCV (Página 7618)" con NDA=1 y
RD<>NIL: RET_VAL contiene la longitud
del bloque de datos recibido (con
EN_DT=0) o copiado en RD (con
EN_DT=1).
"X_GET (Página 7622)": RET_VAL contiene
la longitud del bloque de datos recibido.
"I_GET (Página 7606)": RET_VAL contiene
la longitud del bloque de datos recibido.

7000

-

"X_SEND (Página 7617)", "X_GET (Pági‐
na 7622)", "X_PUT (Página 7624)",
"X_ABORT (Página 7626)", "I_GET (Pági‐
na 7606)", "I_PUT (Página 7608)" y
"I_ABORT (Página 7610)": Llamada con
REQ=0 (llamada sin procesamiento), BUSY
tiene el valor "0", no hay ninguna transmi‐
sión de datos activa.
"X_RCV (Página 7618)": EN_DT=0/1 y
NDA=0

7001

Primera llamada con REQ=1: La trans‐
misión de datos se ha iniciado; BUSY
tiene el valor "1".

-

7002

Llamada intermedia (REQ irrelevante):
La transmisión de datos ya está activa;
BUSY tiene el valor "1".

"X_ABORT (Página 7626)" y "I_ABORT (Pá‐
gina 7610)": Llamada intermedia con
REQ=1

8090

La dirección de destino del interlocutor
indicada no es válida, p. ej.

-

● IOID incorrecta
● Dirección básica incorrecta
● Dirección MPI incorrecta (> 126)

6826

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16# ...)

Explicación (general)

Explicación (específica de instrucción)

8092

Error en SD o RD, p. ej.: El direcciona‐
miento del área de datos local no está
permitido.

"X_SEND (Página 7617)", p. ej..
● Longitud no permitida de SD
● SD=NIL no está permitido
"X_RCV (Página 7618)", p. ej.
● Se han recibido más datos de los que
caben en el área especificada por RD.
● RD es del tipo de datos BOOL, pero la
longitud de los datos recibidos es mayor
que un byte.
"X_GET (Página 7622)" e "I_GET (Pági‐
na 7606)", p. ej.
● Longitud no permitida en RD
● La longitud o el tipo de datos de RD no
coincide con los datos recibidos.
● RD=NIL no está permitido.
"X_PUT (Página 7624)" e "I_PUT (Pági‐
na 7608)", p. ej.
● Longitud no permitida en SD
● SD=NIL no está permitido

8095

El bloque ya se está ejecutando en una
clase de prioridad inferior.

80A0

Error en el acuse recibido

"X_PUT (Página 7624)" e "I_PUT (Pági‐
na 7608)":
El interlocutor no soporta el tipo de datos
indicado en SD de la CPU emisora.

80A1

Problemas de comunicación: Llamada
de la instrucción tras la interrupción de
una conexión existente

"AS_DIAL (Página 7632)":
● El TS Adapter local ha rechazado la
ejecución de una instrucción de
comunicación porque no hay ninguna
conexión remota configurada con
"AS_DIAL".
● Durante la ejecución de la instrucción de
comunicación se ha interrumpido la
conexión remota con el TS Adapter
remoto.

80B0

El objeto no está accesible, p. ej. DB no
cargado

Posible con "X_GET (Página 7622)" y
"X_PUT (Página 7624)", y con "I_GET (Pá‐
gina 7606)" e "I_PUT (Página 7608)"

80B1

Error en el puntero ANY. La longitud del
área de datos que debe transmitirse es
incorrecta.

-

Programación del PLC
Manual de programación y manejo, 11/2019

6827

Instrucciones
4.2 Instrucciones
Código de
error
(W#16# ...)

Explicación (general)

80B2

Error de HW: El módulo no existe.

Explicación (específica de instrucción)

Posible con "X_GET (Página 7622)" y
● El slot configurado no está ocupado. "X_PUT (Página 7624)", y con "I_GET (Pá‐
gina 7606)" e "I_PUT (Página 7608)"
● El tipo de módulo real no coincide
con el tipo de módulo configurado

● La periferia descentralizada no está
disponible.
● En el SDB correspondiente no hay
ninguna entrada para el módulo.
80B3

Los datos sólo pueden leerse o sólo pue‐ Posible con "X_GET (Página 7622)" y
den escribirse, p. ej. DB protegido contra "X_PUT (Página 7624)", y con "I_GET (Pá‐
escritura
gina 7606)" e "I_PUT (Página 7608)"

80B4

Error de tipo de datos en el puntero ANY,
o ARRAY del tipo de datos indicado no
permitido.

"X_GET (Página 7622)" y "X_PUT (Pági‐
na 7624)", así como "I_GET (Página 7606)"
e "I_PUT (Página 7608)": El interlocutor no
soporta el tipo de datos indicado en
VAR_ADDR.

80B5

Ejecución rechazada debido a un estado
operativo no permitido

Posible con "X_SEND (Página 7617)".
Con "AS_DIAL (Página 7632)":
● El TS Adapter local ha rechazado la
ejecución de una instrucción de
comunicación porque la función DIAL de
"AS_DIAL" todavía no ha finalizado.
● La función DIAL del "AS_DIAL" se ha
solicitado a pesar de que ya hay una
conexión remota configurada para el
acoplamiento remoto inter-AS.

6828

80B6

En el acuse recibido hay un código de
error desconocido.

-

80B7

Tipo de datos y/o longitud de los datos
transmitidos no son compatibles con el
área de la CPU interlocutora en la que
deben escribirse.

Posible con "X_PUT (Página 7624)" e
"I_PUT (Página 7608)"

80B8

-

"X_SEND (Página 7617)": "X_RCV (Pági‐
na 7618)" del interlocutor ha rechazado los
datos (RD=NIL).

80B9

-

"X_SEND (Página 7617)": El interlocutor ha
identificado el bloque de datos (llamada de
"X_RCV (Página 7618)" con EN_DT=0), pe‐
ro debido al estado operativo STOP todavía
no se ha aplicado en el programa de usuario.

80BA

La respuesta del interlocutor no cabe en
el telegrama de comunicación.

-

80C0

La conexión indicada ya está ocupada
por otra petición.

-

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16# ...)

Explicación (general)

Explicación (específica de instrucción)

80C1

Escasez de recursos en la CPU en la que se ejecuta la instrucción. p. ej.:
● Ya se está procesando el número
máximo de peticiones de transmisión
diferentes del módulo.
● El recurso de conexión está ocupado
p. ej. por la recepción.

80C2

Falta temporal de recursos del interlocu‐ Con "AS_DIAL (Página 7632)":
tor, p. ej.:
● Escasez de recursos temporal en la
● El interlocutor está procesando el
CPU remota.
número máximo de peticiones.
● La CPU remota con la dirección MPI no
● Los recursos necesarios (memoria,
etc.) están ocupados.

está disponible o no existe.

● La memoria de trabajo disponible no
es suficiente. (Lance un proceso de
compresión.)
80C3

Error al establecer la conexión, p. ej.:

-

● La estación S7 propia no se
encuentra en la subred MPI.
● Ha direccionado la estación propia
en la subred MPI.
● El interlocutor ya no está accesible.
● Falta de recursos temporal del
interlocutor

4.2.5.2

Comunicación S7

Sinopsis de las instrucciones para la comunicación S7
Clasificación
Para la comunicación S7 es necesario configurar las conexiones. La llamada de las funciones
de comunicación integradas se efectúa en el programa de usuario mediante instrucciones.
Estas instrucciones pueden clasificarse en las siguientes categorías:
● Instrucciones para el intercambio de datos
● Instrucciones para cambiar de estado operativo

Programación del PLC
Manual de programación y manejo, 11/2019

6829

Instrucciones
4.2 Instrucciones
● Instrucciones para la consulta del estado operativo
● Una instrucción para cada consulta de conexión
Nota
Si la CPU S7-300 utilizada no dispone de interfaz Ethernet, para ejecutar las instrucciones
S7-300 se requiere un CP SIMATIC NET (Página 7309) de la serie S7-300. Encontrará más
información al respecto en la documentación correspondiente.

Instrucciones para el intercambio de datos
Las instrucciones de comunicación para el intercambio de datos permiten el intercambio de
datos entre dos interlocutores. Dependiendo de si hay una instrucción de comunicación sólo
en el módulo local o tanto en éste como en el remoto, se habla de un intercambio de datos
unilateral o bilateral.
Instrucción

Descripción

"USEND (Pá‐ Transmisión rápida y no acusada de datos independientemente de la ejecución tem‐
gina 6845)" / poral de la función de comunicación ("URCV") en el interlocutor (p. ej. avisos de ope‐
"URCV (Pá‐ ración y de mantenimiento). Ello significa que en el interlocutor los datos pueden ser
sobrescritos por datos más actuales.
gina 6848)"
"BSEND (Pá‐ Transmisión segura de un bloque de datos al interlocutor. En este caso, la transmisión
gina 6851)" / no finaliza hasta que la función de recepción ("BRCV") en el interlocutor no haya reci‐
"BRCV (Pá‐ bido los datos.
gina 6854)"

"GET (Pági‐
na 6840)"

Lectura controlada por programa de variables sin función de comunicación adicional en
el programa de usuario del interlocutor.

"PUT (Pági‐
na 6842)"

Escritura controlada por programa de variables sin función de comunicación adicional
en el programa de usuario del interlocutor.

"PRINT (Pá‐
gina 6870)"

Enviar datos a una impresora (sólo S7-400: CP441).

Instrucciones para cambiar de estado operativo
Con instrucciones para cambiar de estado operativo se controla el estado operativo de un
dispositivo remoto.
En las instrucciones para el cambio de estado operativo, el intercambio de datos es unilateral.
Instrucción

Descripción

"START (Pá‐
gina 6876)"

Lanzar el REARRANQUE completo de una CPU S7-300/400 cuando ésta se encuentra
en el estado operativo STOP.

"STOP (Pági‐ Lanzar el STOP de una CPU S7-300/400 cuando ésta se encuentra en el estado ope‐
na 6878)"
rativo RUN, PARADA o en arranque.
"RESUME
(Pági‐
na 6880)"

6830

Lanzar el rearranque de una CPU S7-400 cuando ésta se encuentra en el estado
operativo STOP.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Instrucciones para la consulta del estado operativo
Las instrucciones de consulta del estado operativo permiten recibir información sobre el
estado operativo de un dispositivo remoto.
Con la instrucción "STATUS", el intercambio de datos es unilateral, mientras que con la
instrucción "USTATUS (Página 6884)" es bilateral.
Instrucción

Descripción

"STATUS
(Pági‐
na 6882)"

Devuelve el estado operativo de un interlocutor (CPU S7-400) cuando el usuario lo
consulta.

"USTATUS
(Pági‐
na 6884)"

Recibe el estado operativo de una CPU S7-400 cuando cambia su estado operativo,
siempre que el atributo de conexión correspondiente (Enviar avisos sobre el estado
operativo) esté activado.

Instrucción para la consulta de una conexión
Instrucción S7-400

Instrucción S7-300

Descripción

"CONTROL (Pági‐
na 6867)"

-

Consulta del estado de una conexión perteneciente a
una instancia de una instrucción.

-

"C_CNTRL (Pági‐
na 6857)"

Consulta del estado de una conexión a través de la ID de
conexión.

Nota
El estado de la conexión actual también puede diagnosticarse con la instrucción "C_DIAG
(Página 6184)" (sólo con S7-400).

Coherencia de datos
Definición
El tamaño del área de datos que no puede ser modificado simultáneamente por procesos
concurrentes se denomina área de datos coherente. Así, un área de datos que supera el
tamaño del área de datos coherente puede falsearse en su totalidad.
Esto significa que un área de datos conexa cuyo volumen supere el del área de datos
coherente puede estar compuesta en un momento dado en parte por bloques de datos nuevos
y en parte por bloques coherentes antiguos.

Programación del PLC
Manual de programación y manejo, 11/2019

6831

Instrucciones
4.2 Instrucciones

Ejemplo
Las incoherencias pueden surgir en el momento en que un bloque de comunicación es
interrumpido p. ej. por un OB de alarma de proceso de mayor prioridad. Si el programa de
usuario modifica entonces en este OB los datos, que en parte ya han sido procesados por el
bloque de comunicación, los datos transmitidos procederán:
● en parte, de antes de la ejecución de la alarma de proceso
● y, en parte, de después de ejecutar la alarma de proceso.
Esto significa que los datos son incoherentes (inconexos).

Efecto
Cuando deben transmitirse grandes cantidades de datos con coherencia, la transmisión no
puede ser interrumpida. Con ello puede, por ejemplo, prolongarse el tiempo de reacción a
alarmas de la CPU.

Coherencia de datos en SIMATIC
● Si en el programa de usuario existe una función de comunicación como p. ej. "BSEND
(Página 6851)" / "BRCV (Página 6854)", que accede a datos conjuntos, el acceso a esa
área de datos puede coordinarse p. ej. con el parámetro DONE. La coherencia de datos de
las áreas de comunicación que se transmite localmente con un bloque de comunicación
puede garantizarse por tanto en el programa de usuario.
● En las funciones de comunicación S7 como "PUT (Página 6842)" / "GET (Página 6840)" o
escribir/leer vía comunicación OP, el tamaño de las áreas de datos coherentes ya debe
tenerse en cuenta en la programación o configuración, puesto que en el programa de
usuario del dispositivo de destino (servidor) no hay un bloque de comunicación que pueda
sincronizar los datos de comunicación al entrar en el programa de usuario.
● En el S7-300 los datos de comunicación se copian de forma coherente en la memoria de
usuario, en forma de bloques de 32 bytes y en el punto de control del ciclo del sistema
operativo. Para todas las áreas de datos de mayor tamaño no se garantiza la coherencia de
datos. Si se requiere una coherencia de datos definida, los datos de comunicación en el
programa de usuario no pueden superar los 32 bytes (según la versión, máximo 8 bytes).
● Por el contrario, en la CPU S7-400 los datos de comunicación no se procesan en el punto
de control del ciclo, sino en intervalos fijos del ciclo del programa. El propio sistema
garantiza la coherencia de una variable.
● Así, un OP o una OS, por ejemplo, puede acceder con coherencia a estas áreas de
comunicación con las instrucciones "PUT (Página 6842)" / "GET (Página 6840)" o bien leer/
escribir variables.
Nota
Encontrará más indicaciones sobre la coherencia de datos en la descripción de las distintas
instrucciones.

6832

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros comunes de las instrucciones para la comunicación S7
Clasificación
Los parámetros de las instrucciones para la comunicación S7 pueden clasificarse en las
siguientes cinco categorías funcionales:
1. Los parámetros de control permiten activar una instrucción.
2. Los parámetros de direccionamiento sirven para direccionar el interlocutor remoto.
3. Los parámetros de transmisión indican las diferentes áreas de datos que deben
transmitirse al interlocutor remoto.
4. Los parámetros de recepción indican las áreas de datos en las que se registran los datos
recibidos del interlocutor remoto.
5. Los parámetros de estado permiten controlar si la instrucción ha terminado su cometido
correctamente, o bien analizar los errores ocurridos.

Parámetros de control
El intercambio de datos no se activa hasta que en la llamada de la instrucción los parámetros
de control correspondientes no tengan un valor definido (p. ej. que estén activados) o hasta
que el valor haya cambiado en un modo determinado respecto a la última llamada (p. ej. flanco
ascendente).
Nota
Primera llamada en el S7-300
En la primera llamada, al parámetro REQ debe asignársele FALSE .

Parámetros de direccionamiento
Parámetro

Descripción

ID

Referencia a la descripción de la conexión local (predeterminada por la configuración de
conexiones). Nota: En las instrucciones de la comunicación S7 no se permite la ID
W#16#EEEE.

R_ID

Con el parámetro R_ID se define la correspondencia entre una instrucción de transmisión
y una de recepción: El parámetro R_ID debe coincidir en las instrucciones del lado de
transmisión y del lado de recepción.
Ello permite la comunicación de varios pares de instrucciones a través de la misma co‐
nexión lógica.
● R_ID debe indicarse en la forma DW#16#wxyzWXYZ.
● Los pares de instrucciones de una conexión lógica definidos con R_ID deben ser
unívocos para dicha conexión.

Programación del PLC
Manual de programación y manejo, 11/2019

6833

Instrucciones
4.2 Instrucciones
El parámetro PI_NAME sólo se describe en las instrucciones relevantes (sólo S7-400).
Nota
Parámetros de direccionamiento ID y R_ID
S7-300: Los parámetros de direccionamiento ID y R_ID pueden reparametrizarse en runtime.
Los nuevos parámetros se hacen efectivos con cada nueva petición al finalizar la petición
anterior.
Las siguientes posibilidades permiten reducir el número de DBs de instancia y, con ello,
ahorrar memoria de trabajo:
1. Con IDs variables pueden utilizarse varias conexiones a través de un bloque de datos de
instancia.
2. Con R_IDs variables es posible definir con una instancia varias correspondencias entre
pares de instrucciones de transmisión y recepción para una petición.
3. Los casos 1 y 2 pueden combinarse entre sí.
Recuerde que los nuevos parámetros no se hacen efectivos hasta no haberse completado la
petición anterior. Al activar el proceso de transmisión, el parámetro R_ID debe coincidir en la
instrucción del lado de transmisión y en la del lado de recepción.
S7-400: Los parámetros de direccionamiento ID y R_ID sólo se evalúan en la primera llamada
de la instrucción o cuando se carga la instancia (los parámetros actuales o los valores
predefinidos de la instancia). Así, con la primera llamada se fija la relación de comunicación
(conexión) con el interlocutor remoto hasta el siguiente rearranque completo (en caliente) o el
siguiente arranque en frío.

Parámetros de estado
Con los parámetros de control se controla si la instrucción ha terminado su cometido
correctamente o si todavía está activa. Además, indican los errores ocurridos.
Nota
Los parámetros de estado sólo son válidos durante un ciclo, es decir, desde el primer comando
que sigue a la llamada, hasta la siguiente llamada. Por ello es necesario evaluar estos
parámetros cada vez que se ejecuta la instrucción.

6834

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros de transmisión y recepción
Si en una instrucción no se utilizan todos los parámetros de transmisión o recepción, cada
primer parámetro no utilizado debe ser un puntero NIL, y los parámetros utilizados deben ir
seguidos y sin espacios.
Nota
Primera llamada en el S7-400
En la primera llamada los punteros ANY fijan la cantidad de datos de usuario máxima
transmisible de la petición; en la memoria de trabajo de la CPU se crea un búfer de datos de
comunicación para asegurar la coherencia de los datos. Este búfer ocupa hasta 480 bytes de
la memoria de trabajo. Se recomienda realizar la primera llamada en el OB de rearranque
completo (en caliente) o en el OB de arranque en frío si el bloque que contiene la llamada de
la instrucción no se carga a posteriori en el estado operativo RUN de la CPU.
En llamadas consecutivas se puede transmitir/recibir un número indefinido de datos, pero
como máximo tantos como en la primera llamada.
La excepción a esta regla son las instrucciones "BSEND (Página 6851)" y "BRCV
(Página 6854)". Éstas permiten transmitir hasta 64 Kbytes por petición.
En las instrucciones para la comunicación bilateral
● el número de parámetros SD_i y RD_i utilizados en los lados de transmisión y recepción
debe coincidir
● en los parámetros SD_i y RD_i conexos deben coincidir los tipos de datos en los lados de
transmisión y recepción
● el número de datos que deben transferirse a través del parámetro SD_i no puede ser
superior al área abarcada por el parámetro correspondiente RD_i (no es válido para
"BSEND (Página 6851)" / "BRCV (Página 6854)").
La infracción de estas reglas se indica con ERROR = 1 y STATUS = 4.

Volumen de datos de usuario
En las instrucciones "USEND (Página 6845)", "URCV (Página 6848)", "GET (Página 6840)" y
"PUT (Página 6842)", el número de datos que deben transferirse no puede superar una
longitud de datos de usuario determinada. El volumen máximo de datos de usuario depende:
● de la instrucción utilizada y
● del interlocutor
El volumen mínimo garantizado de datos de usuario para una instrucción con 1-4 variables se
puede consultar en la siguiente tabla:
Instrucción

Interlocutor: S7-300

Interlocutor: S7-400

PUT / GET

160 bytes

400 bytes

USEND / URCV

160 bytes

440 bytes

BSEND / BRCV

32768/65534 bytes

65534 bytes

Observe las limitaciones relativas al volumen de datos de usuario en los datos técnicos de la
respectiva CPU.

Programación del PLC
Manual de programación y manejo, 11/2019

6835

Instrucciones
4.2 Instrucciones

Volumen exacto de datos de usuario
Si el volumen de datos de usuario indicado anteriormente no es suficiente, es posible
determinar la longitud de datos de usuario máxima exacta en bytes del siguiente modo:
● En primer lugar consulte en la tabla siguiente el tamaño válido para bloques de datos en la
comunicación:
CPU propia

CPU remota

Tamaño del bloque de datos en bytes

S7-300

cualquiera

240 (S7-300)

S7-400

S7-300

240 (S7-400)

S7-400

S7-400

480

● Partiendo de este valor, consulte en la tabla siguiente la longitud de datos de usuario
máxima posible en bytes, como suma de los parámetros de usuario. Es aplicable a
longitudes pares de las áreas SD_i, RD_i, ADDR_i. Para cada área de longitud impar la
longitud de datos de usuario máxima posible se reduce en un byte.
Número de parámetros utilizados SD_i, RD_i, ADDR_i
Tamaño del bloque
de datos

Instrucción

1

2

3

4

240 (S7-300)

PUT/GET/
USEND

160

-

-

-

240 (S7-300 vía in‐
terfaz integrada)

PUT

212

-

-

-

GET

222

-

-

-

USEND

212

-

-

-

PUT

212

196

180

164

GET

222

218

214

210

USEND

212

-

-

-

PUT

452

436

420

404

GET

462

458

454

450

USEND

452

448

444

440

240 (S7-400)

480

Comportamiento de arranque de las instrucciones para la comunicación S7
Requisitos
En adelante, para la S7-400 se parte de los siguientes supuestos:
● Las descripciones de las conexiones (SDBs) están disponibles en los módulos.
● Las conexiones configuradas están establecidas.
● En cada instrucción el parámetro actual de ID coincide con la ID de conexión configurada.

6836

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Rearranque completo (en caliente) y arranque en frío
En el rearranque completo (en caliente) y en el arranque en frío todas las instrucciones se
ponen en estado NO_INIT. Los parámetros actuales guardados en los DBs de instancia
permanecen invariables.

Rearranque completo (en caliente) y arranque en frío con instrucciones para la comunicación bilateral
En general, en las instrucciones de comunicación bilateral, los dos módulos no ejecutan un
rearranque completo (en caliente) o un arranque en frío simultáneamente. La adaptación es
realizada implícitamente por la instrucción siguiendo las reglas siguientes.
● Los bloques de recepción ("URCV (Página 6848)", "BRCV (Página 6854)") se comportan
del siguiente modo:
– Si la instrucción ha recibido una petición, pero en el momento del rearranque completo
(en caliente) o del arranque en frío aún no la ha acusado, genera un telegrama de
interrupción de secuencia ("BRCV (Página 6854)") y a continuación pasa
inmediatamente al estado NO_INIT.
– Con "BRCV (Página 6854)" puede ocurrir que entre un segmento de datos adicional a
pesar de haberse enviado la interrupción de la secuencia. En ese caso, el segmento se
rechaza localmente.
– En el caso de "URCV (Página 6848)" se produce una transición inmediata al estado
NO_INIT.
● Los bloques de transmisión ("USEND (Página 6845)", "BSEND (Página 6851)") se
comportan del siguiente modo:
– Si la instrucción "BSEND (Página 6851)" ha iniciado una secuencia de la petición que
todavía no ha finalizado, transmite una interrupción de secuencia en el rearranque
completo (en caliente) o en el arranque en frío. Inmediatamente después deriva al
estado NO_INIT. Cualquier acuse que entre con posterioridad se rechaza localmente.
– Si la instrucción "BSEND (Página 6851)" ya ha enviado o recibido una interrupción de
secuencia al solicitarse el rearranque completo (en caliente) o arranque en frío, cambia
inmediatamente al estado NO_INIT.
– En cualquier otro caso, y cuando la instrucción sólo envía mensajes (p. ej. "USEND
(Página 6845)"), la ejecución local se interrumpe y la instrucción pasa inmediatamente
al estado NO_INIT.

Rearranque completo (en caliente) y arranque en frío con instrucciones para la comunicación unilateral
Se parte del supuesto de que una vez establecidas las conexiones, el servidor del interlocutor
está operativo, es decir, que puede procesar peticiones o enviar mensajes en cualquier
momento.
Las instrucciones que transmiten peticiones y esperan la llegada de acuses tienen la siguiente
respuesta:
● La ejecución en curso se interrumpe y a continuación se pasa inmediatamente al estado
NO_INIT. Cualquier acuse que llegue después para la petición transmitida antes del
rearranque completo (en caliente) o arranque en frío se rechaza localmente.
● Es posible lanzar una nueva petición antes de que llegue el acuse pendiente.

Programación del PLC
Manual de programación y manejo, 11/2019

6837

Instrucciones
4.2 Instrucciones
Las instrucciones que envían o reciben mensajes se comportan de la siguiente manera:
● La ejecución en curso se interrumpe y se deriva inmediatamente al estado NO_INIT.
● Con "USTATUS (Página 6884)", los mensajes que llegan en los estados NO_INIT y
DISABLED se rechazan localmente.

Comportamiento en rearranque
Las instrucciones para la comunicación S7 sólo pasan al estado NO_INIT en el rearranque
completo (en caliente) o en el arranque en frío. De ahí resulta que en el rearranque se
comporten como bloques de función de usuario continuables.

Comportamiento tras un borrado total
El borrado total siempre causa la interrupción de todas las conexiones. Dado que tras el
borrado total el único modo de arranque posible para el programa de usuario es el rearranque
completo (en caliente) o el arranque el frío, todas las instrucciones de la comunicación S7 (si
todavía las hay) se ponen en estado NO_INIT y se inicializan. Como consecuencia de
interrumpirse la conexión, los bloques interlocutores de un módulo que no se ha sometido al
borrado total pasan a los estados IDLE, ENABLED o DISABLED.

Comportamiento en caso de fallo de las instrucciones para la comunicación S7
Introducción
A continuación se describe el comportamienot de las instrucciones para la comunicación S7 en
caso de fallo para la S7-400.

Interrupción de la conexión
Las conexiones asignadas a las instancias de la instrucción se someten a un control de
interrupción.
En caso de interrupción, la reacción de la instrucción dependerá de su estado interno:
● Si se detecta la interrupción de la conexión en los estados IDLE o ENABLED, la instrucción
reacciona del siguiente modo:
– Cambia al estado ERROR y devuelve la ID de error "Problemas de comunicación" a
través de los parámetros de salida ERROR y STATUS.
– En la siguiente llamada recobra su estado original y vuelve a comprobar la conexión.
● Una instrucción que no se encuentra en los estados IDLE o DISABLED reacciona del
siguiente modo:
– Cancela su ejecución, cambia inmediatamente o en la siguiente llamada al estado
ERROR y devuelve la ID de error "Problemas de comunicación" a través de los
parámetros de salida ERROR y STATUS.
– En la siguiente llamada, la instrucción adopta el estado IDLE, DISABLED o ENABLED.
En los estados IDLE y ENABLED se vuelve a comprobar la conexión.

6838

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Este procedimiento también se lleva a cabo aunque entretanto se haya restablecido la
conexión.

Fallo de red
Un fallo de red respaldado por pila con rearranque conlleva la interrupción de todas las
conexiones establecidas. Por ello, para todas las instrucciones afectadas rige lo arriba descrito.
En el caso de un fallo de red respaldado por pila con rearranque completo (en caliente) o
arranque en frío automáticos son aplicables las reacciones descritas tanto para el caso de
interrupción de la conexión, como para el rearranque completo (en caliente) o el arranque en
frío.
En el caso especial del rearranque completo (en caliente) o arranque en frío automático no
respaldado por pila, en el que con la recuperación de la red se produce un borrado total
automático, las instrucciones para la comunicación S7 se comportan de la forma descrita en
el capítulo "Comportamiento de arranque de las instrucciones para la comunicación S7
(Página 6836)".

Respuesta a las transiciones de estado operativo
En una transición entre los estados STOP, ARRANQUE, RUN Y PARADA la instrucción
permanece en su estado actual (excepción: en un rearranque completo (en caliente) o
arranque en frío se adopta el estado NO_INIT). Esto es aplicable tanto en instrucciones para
la comunicación unilateral como bilateral.

Interfaz de error con el programa de usuario
Si se produce un error durante la ejecución de una instrucción, siempre se pasa al estado
ERROR; al mismo tiempo el parámetro de salida ERROR se pone a "1" y en el parámetro de
salida STATUS se registra la ID de error correspondiente. Estas indicaciones pueden
evaluarse en el programa de usuario.
Ejemplos de posibles errores:
● Error al recoger los datos de transmisión
● Error al copiar los datos de recepción en las áreas de recepción (p. ej. acceso a un DB no
existente)
● La longitud del área de datos transferida no coincide con la longitud del área de recepción
registrada en la instrucción del interlocutor.

Programación del PLC
Manual de programación y manejo, 11/2019

6839

Instrucciones
4.2 Instrucciones

GET: Leer datos de una CPU remota
Descripción
La instrucción permite leer datos de una CPU remota si no se realiza la conexión a través de
un CP.
● S7-300: El proceso de lectura se inicia tras un flanco ascendente en REQ. Con cada flanco
ascendente en REQ se aplican los parámetros ID, ADDR_1 y RD_1. Una vez finalizada una
petición se pueden asignar nuevos valores a los parámetros ID, ADDR_1 y RD_1.
● S7-400: Con un flanco ascendente en la entrada de control REQ se inicia la instrucción. Los
punteros hacia las áreas que deben leerse (ADDR_i) se transfieren a la CPU interlocutora.
El interlocutor remoto devuelve los contenidos de los datos. Los datos recibidos se copian en
la siguiente llamada en las áreas de recepción configuradas (RD_i). Hay que asegurarse de
que las áreas definidas por los parámetros ADDR_i y RD_i se correspondan entre sí en cuanto
a la cantidad, la longitud y el tipo de datos.
El término de este proceso se indica con "1" en el parámetro de estado NDR. No es posible
activar otro proceso de lectura hasta que no haya finalizado el último.
La CPU remota puede encontrarse en el estado operativo RUN o STOP. En caso de problemas
de acceso al leer los datos, o si la comprobación del tipo de datos devolvió un error, los errores
y advertencias correspondientes se indican a través de ERROR y STATUS.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "GET":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el inter‐
cambio de datos con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de
las instrucciones para la comunicación S7 (Pá‐
gina 6833)

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● 0: La petición aún no se ha iniciado o
todavía está en curso.
● 1: La petición ha finalizado correctamente.

ERROR /

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, in‐
dicación de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS
devuelve información detallada.
● ERROR=1
Hay un error. STATUS devuelve
información detallada sobre el tipo de error.

6840

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

S7-300:
ADDR_1

InOut

ANY

S7-300: M, D

Puntero hacia las áreas de la CPU interlocuto‐
ra que deben leerse.

S7-400:
I, Q, M, D, T, C

Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse (p. ej.:
P#DB10.DBX5.0 byte 10).

S7-400: ADDR_i
(1≤ i ≤4)

En la transferencia de estructuras de datos (p.
ej. Struct, Array) en el parámetro ADDR debe
utilizarse el tipo de datos CHAR, BYTE,
WORD o DWORD.

S7-300: RD_1

InOut

ANY

S7-400: RD_i
(1≤ i ≤4)

S7-300: M, D

Puntero hacia las áreas de la CPU propia en
las que se depositan los datos leídos.

S7-400:
I, Q, M, D, T, C

Sólo se permiten los tipos de datos BOOL (no
permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, COUN‐
TER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse (p. ej.:
P#DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de error específica de la instrucción "GET" que
puede indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Adicionalmente para el S7-300:
–

Se ha superado el número máximo de peticiones/instancias paralelas.

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

4

Error en los punteros de áreas de recepción RD_i en cuanto a la longitud o el tipo de datos.

1

8

Error de acceso en la CPU interlocutora.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

Programación del PLC
Manual de programación y manejo, 11/2019

6841

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(decimal)

Explicación

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "GET"
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

20

● S7-400
La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del programa
que se encuentra en la memoria.
● S7-300

1

27

–

Se ha superado el número máximo de peticiones/instancias paralelas

–

Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOPRUN de la CPU o del CP)

–

Es posible en la primera llamada

Solo con S7-300: Para esta instrucción no existe ningún código de función en la CPU.

Coherencia de datos
Los datos se reciben con coherencia si se observa lo siguiente:
Evalúe la parte actualmente utilizada del área de recepción RD_i por completo antes de activar
una nueva petición.

PUT: Escribir datos en una CPU remota
Descripción
La instrucción permite escribir datos en una CPU remota si no se realiza la conexión a través
de un CP.
● S7-300: El proceso de transmisión se inicia tras un flanco ascendente en REQ. Con cada
flanco ascendente en REQ se aplican los parámetros ID, ADDR_1 y SD_1. Una vez
finalizada una petición se pueden asignar nuevos valores a los parámetros ID, ADDR_1 y
SD_1.
● S7-400: Con un flanco ascendente en la entrada de control REQ se inicia la instrucción. Los
punteros hacia las áreas que deben escribirse (ADDR_i) y los datos (SD_i) se transfieren a
la CPU interlocutora.
El interlocutor remoto deposita los datos transmitidos en las direcciones indicadas y devuelve
un acuse de ejecución. Hay que asegurarse de que las áreas definidas por los parámetros
ADDR_i y SD_i se correspondan entre sí en cuanto a la cantidad, la longitud y el tipo de datos.
Si no se ha producido ningún error, esto se indica en la siguiente llamada con "1" en el
parámetro de estado DONE . No es posible activar otro proceso de escritura hasta que no haya
finalizado el último.
La CPU remota puede encontrarse en el estado operativo RUN o STOP. En caso de problemas
de acceso al escribir los datos, o si la comprobación del acuse de ejecución devolvió un error,
los errores y advertencias correspondientes se indican a través de ERROR y STATUS .

6842

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "PUT":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el inter‐
cambio de datos con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de
las instrucciones para la comunicación S7 (Pá‐
gina 6833)

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o
todavía se está ejecutando.
● 1: Petición finalizada sin errores.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, in‐
dicación de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS
devuelve información detallada.
● ERROR=1
Hay un error. STATUS devuelve
información detallada sobre el tipo de error.

S7-300:
ADDR_1

InOut

ANY

S7-400: ADDR_i
(1≤ i ≤4)

S7-300: SD_1

S7-300: M, D

Puntero hacia las áreas de la CPU interlocuto‐
ra en las que debe escribirse.

S7-400:
I, Q, M, D, T, C

Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse (p. ej.:
P#DB10.DBX5.0 byte 10).
En la transferencia de estructuras de datos (p.
ej. Struct, Array) en el parámetro ADDR debe
utilizarse el tipo de datos CHAR, BYTE,
WORD o DWORD.

InOut

ANY

S7-400: SD_i
(1≤ i ≤4)

S7-300: M, D

Puntero hacia las áreas de la CPU propia que
contienen los datos que deben transmitirse.

S7-400:
I, Q, M, D, T, C

Sólo se permiten los tipos de datos BOOL (no
permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, COUN‐
TER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse (p. ej.:
P#DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Programación del PLC
Manual de programación y manejo, 11/2019

6843

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de errores específicos de PUT, que puede
indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Adicionalmente para el S7-300:
–

Se ha superado el número máximo de peticiones/instancias paralelas.

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

4

Error en los punteros de área de transmisión SD_i en cuanto a la longitud o el tipo de datos.

1

8

Error de acceso en la CPU interlocutora

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado)

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "PUT"
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente)

1

20

● S7-400
La memoria de trabajo disponible no es suficiente. Solución: vuelva a cargar el DB de instancia
correspondiente.
● S7-300

1

27

–

Se ha superado el número máximo de peticiones/instancias paralelas

–

Las instancias se han sobrescrito en el estado RUN de la CPU (se requiere una transición
STOP-RUN de la CPU o del CP)

–

Es posible en la primera llamada

Solo con S7-300: Para esta instrucción no existe ningún código de función en la CPU.

Coherencia de datos en el S7-300:
Para garantizar la coherencia de datos, no puede volver a escribirse en el área de transmisión
SD_1 hasta que no haya finalizado el proceso de transmisión actual. Esto ocurre cuando el
parámetro de estado DONE adopta el valor "1".

6844

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Coherencia de datos en el S7-400 y S7-300 a través de una interfaz integrada:
Con la activación de un proceso de transmisión (flanco ascendente en REQ) los datos que
deben transmitirse de las áreas de transmisión SD_i se copian del programa de usuario. Se
puede volver a escribir en estas áreas tras la llamada de la instrucción, sin que se falsifiquen
los datos de transmisión actuales.
Nota
El proceso de transmisión completo finaliza sólo cuando el parámetro de estado DONE adopta
el valor "1".

USEND: Envío de datos sin coordinación
Descripción
La instrucción "USEND" envía datos a una instrucción remota de interlocutor del tipo "URCV
(Página 6848)". El proceso de transmisión se desarrolla sin coordinación con la instrucción del
interlocutor, es decir, que la transmisión de datos se produce sin acuse por parte de la
instrucción del interlocutor.
● S7-300: El proceso de transmisión se inicia tras un flanco ascendente en REQ. Con cada
flanco ascendente en REQ se aplican los parámetros R_ID, ID y SD_1. Una vez finalizada
una petición se pueden asignar nuevos valores a los parámetros R_ID, ID y SD_1.
● S7-400: El proceso de transmisión se inicia tras un flanco ascendente en la entrada de
control REQ. Los datos que deben transmitirse se referencian con los parámetros SD_1, ...
SD_4, aunque no es necesario que los cuatro parámetros estén ocupados.
No obstante, hay que asegurarse de que las áreas definidas por los parámetros SD_1 a
SD_4 / SD_1 y RD_1 a RD_4 / RD_1 (en la respectiva instrucción de interlocutor "URCV
(Página 6848)") coincidan en:
● Número
● Longitud
● Tipo de datos
El parámetro R_ID debe ser idéntico en ambas instrucciones.
La finalización correcta del proceso de transmisión se indica con un "1" lógico en el parámetro
de estado DONE .

Programación del PLC
Manual de programación y manejo, 11/2019

6845

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "USEND":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el inter‐
cambio de datos con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las
instrucciones para la comunicación S7 (Pági‐
na 6833)

R_ID

DONE

Input

Output

DWORD

BOOL

I, Q, M, D, L o cons‐
tante

I, Q, M, D, L

Parámetro de direccionamiento R_ID
Consulte también: Parámetros comunes de las
instrucciones para la comunicación S7 (Pági‐
na 6833)
Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía
se está ejecutando.
● 1: Petición finalizada sin errores.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indi‐
cación de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

S7-300: SD_1
S7-400: SD_i
(1≤ i ≤4)

InOut

ANY

S7-300: M, D
S7-400:
I, Q, M, D, T, C

Puntero al área de transmisión n.º i.
Solo se permiten los tipos de datos BOOL (no
permitido: mapa de bits), BYTE, CHAR, WORD,
INT, DWORD, DINT, REAL, DATE, TOD, TIME,
S5TIME, DATE_AND_TIME, COUNTER, TI‐
MER.
Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse (p. ej.:
P#DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

6846

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Adicionalmente para el S7-300:
–

Se ha superado el número máximo de peticiones/instancias paralelas

1

4

Error en los punteros de área de transmisión SD_i en cuanto a la longitud o el tipo de datos.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "USEND"
● No se ha indicado ningún DB de instancia, sino un DB global
● Se ha encontrado un DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

18

● R_ID ya existe en la conexión ID.
● Adicionalmente para el S7-300:
Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP).

1

20

● S7-400
La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del programa
que se encuentra en la memoria.
● S7-300

1

27

–

Se ha superado el número máximo de peticiones/instancias paralelas

–

Las instancias se han sobrescrito en el estado RUN de la CPU (se requiere una transición
STOP-RUN de la CPU o del CP)

–

Es posible en la primera llamada

Solo con S7-300: Para esta instrucción no existe ningún código de función en la CPU.

Coherencia de datos
S7-300: Para garantizar la coherencia de datos, no puede volver a escribirse en el área de
transmisión SD_1 hasta que no haya finalizado el proceso de transmisión actual. Esto ocurre
cuando el parámetro de estado DONE adopta el valor "1".
S7-400 y S7-300 a través de una interfaz integrada: Con la activación de un proceso de
transmisión (flanco ascendente en REQ) los datos que deben transmitirse de las áreas de

Programación del PLC
Manual de programación y manejo, 11/2019

6847

Instrucciones
4.2 Instrucciones
transmisión SD_i se copian del programa de usuario. Se puede volver a escribir en estas áreas
tras la llamada de la instrucción, sin que se falsifiquen los datos de transmisión actuales.
Nota
El proceso de transmisión completo finaliza sólo cuando el parámetro de estado DONE adopta
el valor "1".

URCV: Recibir datos sin coordinación
Descripción
La instrucción "URCV" recibe datos de forma asíncrona de una instrucción remota del
interlocutor del tipo "USEND (Página 6845)" y los copia en las áreas de recepción
configuradas.
La instrucción está lista para recibir cuando en la entrada EN_R hay un "1" lógico. Con EN_R=0
no es posible interrumpir una petición en curso.
● S7-300: Con cada flanco ascendente en EN_R se aplican los parámetros R_ID, ID y RD_1.
Una vez finalizada una petición se pueden asignar nuevos valores a los parámetros R_ID,
ID y RD_1.
● S7-400: Las áreas de datos de recepción se referencian con los parámetros RD_1, ... RD_4.
Hay que asegurarse de que las áreas definidas por los parámetros RD_i / RD_1 y SD_i / SD_1
(en la respectiva instrucción del interlocutor correspondiente "USEND (Página 6845)")
coincidan en:
● Número
● Longitud
● Tipo de datos
La finalización correcta del proceso de copia se indica con un "1" lógico en el parámetro de
estado NDR . El parámetro R_ID debe ser idéntico en ambas instrucciones.

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "URCV":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L

El parámetro de control enabled to receive señaliza
disponibilidad de recepción cuando la entrada está
activada.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las ins‐
trucciones para la comunicación S7 (Página 6833)

R_ID

6848

Input

DWORD

I, Q, M, D, L o cons‐
tante

Parámetro de direccionamiento R_ID
Consulte también: Parámetros comunes de las ins‐
trucciones para la comunicación S7 (Página 6833)

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● 0: La petición aún no se ha iniciado o todavía
está en curso.
● 1: La petición ha finalizado correctamente.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indica‐
ción de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

S7-300: RD_1

InOut

ANY

S7-400: RD_i
(1≤ i ≤4)

S7-300: M, D
S7-400:
I, Q, M, D, T, C

Puntero al área de recepción n.º i.
Solo se permiten los tipos de datos BOOL (no per‐
mitido: mapa de bits), BYTE, CHAR, WORD, INT,
DWORD, DINT, REAL, DATE, TOD, TIME, S5TI‐
ME, DATE_AND_TIME, COUNTER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse (p.
ej.: P#DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(decimal)

Explicación

0

9

Advertencia Overrun: Los datos de recepción antiguos han sido sobrescritos por datos de re‐
cepción más actuales.

0

11

Advertencia: Los datos de recepción ya se están procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Adicionalmente para el S7-300:
Se ha superado el número máximo de peticiones/instancias paralelas

1

4

Error en los punteros de áreas de recepción RD_i en cuanto a la longitud o el tipo de datos.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

Programación del PLC
Manual de programación y manejo, 11/2019

6849

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(decimal)

Explicación

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "URCV"
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

18

● R_ID ya existe en la ID de conexión
● Adicionalmente para el S7-300:
Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP.)

1

19

La instrucción correspondiente "USEND (Página 6845)" envía datos más rápido de lo que
"URCV" puede copiarlos en las áreas de recepción.

1

20

● S7-400
La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del programa
que se encuentra en la memoria.
● S7-300

1

27

–

Se ha superado el número máximo de peticiones/instancias paralelas

–

Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOPRUN de la CPU o del CP.)

–

Es posible en la primera llamada

Solo con S7-300: Para este bloque no existe ningún código de función en la CPU.

Coherencia de datos
Los datos se reciben con coherencia si se observa lo siguiente:
● S7-300: Una vez que el parámetro de estado NDR ha adoptado el valor "1", hay que volver
a llamar inmediatamente "URCV" con el valor "0" en EN_R. Con ello queda garantizado que
el área de recepción no se sobrescriba antes de haberse evaluado. Evalúe el área de
recepción RD_1 por completo antes de volver a llamar el bloque con el valor "1" en la
entrada de control EN_R.
● S7-400: Una vez que el parámetro de estado NDR ha adoptado el valor "1", hay nuevos
datos de recepción en las áreas de recepción (RD_i). Una nueva llamada del bloque puede
sobrescribir estos datos con nuevos datos de recepción. Para impedirlo, llame "URCV" con
el valor "0" en EN_R (p. ej. en caso de ejecución cíclica del bloque) hasta haber finalizado
el procesamiento de los datos de recepción.

6850

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

BSEND: Transmitir datos en segmentos
Descripción
La instrucción "BSEND" envía datos a una instrucción remota del interlocutor del tipo "BRCV
(Página 6854)". En este tipo de transferencia de datos es posible transportar una cantidad de
datos mayor entre los interlocutores que con las demás instrucciones de comunicación para
conexiones S7 configuradas. Pueden transmitirse las siguientes cantidades de datos:
● 32768 bytes con el S7-300 a través de CPs SIMATIC-Net
● 65534 bytes con el S7-400 y S7-300 a través de una interfaz integrada

Funcionamiento
El área de datos que se va a transmitir se segmenta. Cada segmento se transmite
individualmente al interlocutor. El interlocutor acusa el último segmento ya en el momento de
su llegada, independientemente de la respectiva llamada de la instrucción "BRCV
(Página 6854)".
● S7-300: El proceso de transmisión se inicia tras un flanco ascendente en REQ. Con cada
flanco ascendente en REQ se aplican los parámetros R_ID, ID, SD_1 y LEN. Una vez
finalizada una petición se pueden asignar nuevos valores a los parámetros R_ID, ID, SD_1
y LEN. Para la transmisión de datos segmentados es necesario llamar la instrucción
cíclicamente en el programa de usuario.
La dirección de inicio y la longitud máxima de los datos que van a transmitirse vienen
determinadas por SD_1. La longitud del bloque de datos se fija individualmente para cada
petición con LEN.
● S7-400 y S7-300 a través de una interfaz integrada: La activación del proceso de
transmisión se produce tras llamar la instrucción y un flanco ascendente en la entrada de
control REQ. La transmisión de los datos desde la memoria de usuario es asíncrona
respecto a la ejecución del programa de usuario.
La dirección inicial de los datos que deben transmitirse viene determinada por SD_1. La
longitud de los datos de transmisión se define individualmente para cada petición con LEN.
LEN sustituye así la parte de SD_1 correspondiente a la longitud.
El parámetro R_ID debe ser idéntico en las instrucciones conexas. Con un flanco ascendente
en la entrada de control R se cancela el proceso de transmisión en curso. La finalización
correcta del proceso de transmisión se indica con "1" en el parámetro de estado DONE .
Una vez finalizado el proceso de transmisión, no se puede procesar otra petición de
transmisión hasta que los parámetros de estado DONE o ERROR no hayan adoptado el valor
"1".
Debido a la transmisión de datos asíncrona, no es posible iniciar una nueva transmisión de
datos mientras los datos anteriores no hayan sido recogidos por la llamada de la instrucción del
interlocutor. Hasta que los datos no hayan sido recogidos, con la llamada de "BSEND" se
devuelve el valor de estado "7" (ver a continuación).

Programación del PLC
Manual de programación y manejo, 11/2019

6851

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "BSEND":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el intercambio
de datos con un flanco ascendente.

R

Input

BOOL

I, Q, M, D, L

El parámetro de control reset activa la cancelación de
un intercambio de datos todavía en curso con un flan‐
co ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las ins‐
trucciones para la comunicación S7 (Página 6833)

R_ID

Input

DWORD

I, Q, M, D, L o cons‐
tante

Parámetro de direccionamiento R_ID
Consulte también: Parámetros comunes de las ins‐
trucciones para la comunicación S7 (Página 6833)
En caso de acoplamiento vía CP441 a dispositivos S5
o de otros fabricantes, R_ID contiene la información
de direccionamiento del dispositivo remoto. Encontra‐
rá más información en la descripción del CP441.

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía se
está ejecutando.
● 1: Petición finalizada sin errores

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error

SD_1

InOut

ANY

S7-300: M, D

Puntero al área de memoria.

S7-400:
I, Q, M, D, T, C

Solo se permiten los tipos de datos BOOL (no permi‐
tido: mapa de bits), BYTE, CHAR, WORD, INT,
DWORD, DINT, REAL, DATE, TOD, TIME, S5TIME,
DATE_AND_TIME, COUNTER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste siempre
debe especificarse. (p. ej.: P#DB10.DBX5.0 byte 10)

LEN

InOut

WORD

I, Q, M, D, L

Longitud en bytes del bloque de datos que debe trans‐
ferirse

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

6852

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de error específica de "BSEND", que puede
indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

● Problemas de comunicación, p. ej. descripción de conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Adicionalmente para el S7-300:
Se ha superado el número máximo de peticiones/instancias paralelas.

1

2

Acuse negativo de la instrucción del interlocutor. La función no puede ejecutarse.

1

3

R_ID no es conocido en la conexión de comunicación especificada por ID, o el bloque de recepción
no se ha llamado nunca.

1

4

Error en el puntero de área de transmisión SD_1 referente a la longitud o al tipo de datos, o en el
parámetro LEN se ha transmitido el valor "0".

1

5

Se ha ejecutado la solicitud de reset.

1

6

La instrucción del interlocutor se encuentra en estado DISABLED (EN_R tiene el valor "0"). Com‐
pruebe también si los parámetros de entrada de BRCV son coherentes con BSEND.

1

7

La instrucción del interlocutor está en estado incorrecto

1

8

Se ha rechazado el acceso al objeto remoto en la memoria de usuario: El área de destino en el
"BRCV" correspondiente es demasiado pequeña.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:

Las instrucciones de recepción no se han vuelto a llamar desde la última transmisión de datos.

En el BRCV correspondiente se notifica ERROR = 1, STATUS = 4 ó ERROR = 1, STATUS = 10.

● Se ha indicado un DB de instancia que no pertenece a "BSEND" .
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).
1

18

● R_ID ya existe en la conexión.
● Adicionalmente para el S7-300:
Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP.)

Programación del PLC
Manual de programación y manejo, 11/2019

6853

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(decimal)

Explicación

1

20

● S7-400
La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del programa
que se encuentra en la memoria.
● S7-300

1

27

–

Se ha superado el número máximo de peticiones/instancias paralelas

–

Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOPRUN de la CPU o del CP.)

–

Es posible en la primera llamada

–

Escasez de memoria del CP

Solo con S7-300: Para esta instrucción no existe ningún código de función en la CPU.

Coherencia de datos
Para garantizar la coherencia de datos, no puede volver a escribirse en la parte del área de
transmisión SD_1 utilizada actualmente hasta que no haya finalizado el proceso de
transmisión actual. Esto ocurre cuando el parámetro de estado DONE adopta el valor "1".

BRCV: Recibir datos en segmentos
Descripción
La instrucción "BRCV" recibe datos de una instrucción remota del interlocutor del tipo "BSEND
(Página 6851)". Después de cada segmento de datos recibido se envía un acuse a la
instrucción del interlocutor, y el parámetro LEN se actualiza.
La instrucción está lista para recibir tras la llamada con el valor "1" en la entrada de control
EN_R. Con EN_R=0 no es posible interrumpir una petición en curso.
La dirección inicial y la longitud máxima del área de recepción vienen dadas por RD_1. La
longitud del bloque de datos recibido se indica en LEN .
● S7-300: Con cada flanco ascendente en EN_R se aplican los parámetros R_ID, ID y RD_1.
Una vez finalizada una petición se pueden asignar nuevos valores a los parámetros R_ID,
ID y RD_1. Para transmitir datos segmentados es necesario llamar la instrucción
cíclicamente en el programa de usuario.
● S7-400 y S7-300 a través de una interfaz integrada: La recepción de los datos de la
memoria de usuario es asíncrona al procesamiento del programa de usuario.
El parámetro R_ID debe ser idéntico en las instrucciones conexas.
La recepción sin errores de todos los segmentos de datos se indica en el parámetro de estado
NDR con el valor "1". Los datos recibidos permanecen invariables hasta la siguiente llamada
con EN_R=1.
Si se vuelve a llamar la instrucción durante una recepción asíncrona, se devuelve una
advertencia en el parámetro de estado STATUS; si la llamada se produce con EN_R=0, el
proceso de recepción se interrumpe y la instrucción pasa a su estado inicial.

6854

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "BRCV":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L

El parámetro de control enabled to receive seña‐
liza disponibilidad de recepción cuando la entra‐
da está activada.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las
instrucciones para la comunicación S7 (Pági‐
na 6833)

R_ID

Input

DWORD

I, Q, M, D, L o cons‐
tante

Parámetro de direccionamiento R_ID
Consulte también: Parámetros comunes de las
instrucciones para la comunicación S7 (Pági‐
na 6833)
En caso de acoplamiento vía CP441 a dispositi‐
vos S5 o de otros fabricantes, R_ID contiene la
información de direccionamiento del dispositivo
remoto. Encontrará más información en la des‐
cripción del CP441.

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● 0: La petición aún no se ha iniciado o todavía
está en curso.
● 1: La petición ha finalizado correctamente.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indi‐
cación de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

RD_1

InOut

ANY

S7-300: M, D
S7-400:
I, Q, M, D, T, C

Puntero al área de recepción. La indicación de
longitud indica la longitud máxima del bloque que
se va a recibir.
Solo se permiten los tipos de datos BOOL (no
permitido: mapa de bits), BYTE, CHAR, WORD,
INT, DWORD, DINT, REAL, DATE, TOD, TIME,
S5TIME, DATE_AND_TIME, COUNTER, TI‐
MER.
Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse.
(p. ej.: P# DB10.DBX5.0 byte 10).

LEN

InOut

WORD

I, Q, M, D, L

Longitud de los datos recibidos hasta el momen‐
to en bytes.

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Programación del PLC
Manual de programación y manejo, 11/2019

6855

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de error específica de "BRCV", que puede
indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia: Los datos de recepción ya se están procesando en una clase de menor prioridad.

0

17

Advertencia: La instrucción recibe datos de forma asíncrona. El parámetro LEN indica el número
de datos recibidos hasta ahora en bytes.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Adicionalmente para el S7-300:
Se ha superado el número máximo de peticiones/instancias paralelas.

1

2

Función no ejecutable (error de protocolo)

1

4

Error en el puntero del área de recepción RD_1 en cuanto a la longitud o el tipo de datos. El bloque
de datos enviado supera la longitud del área de recepción.

1

5

Petición de reset recibida, transmisión incompleta.

1

8

Error de acceso en el respectivo "BSEND (Página 6851)": Tras enviar el último segmento de datos
válido, se indica ERROR = 1 y STATUS = 4 o ERROR = 1 y STATUS = 10.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "BRCV"
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

18

● R_ID ya existe en la conexión.
● Adicionalmente para el S7-300:
Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP.)

1

20

● S7-400
La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del programa
que se encuentra en la memoria.
● S7-300

1

6856

27

–

Se ha superado el número máximo de peticiones/instancias paralelas

–

Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOPRUN de la CPU o del CP.)

–

Es posible en la primera llamada

–

Escasez de memoria del CP

Solo con S7-300: Para esta instrucción no existe ningún código de función en la CPU.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Coherencia de datos
Los datos se reciben con coherencia si se observa lo siguiente: Evalúe por completo la parte
del área de recepción RD_1 utilizada en ese momento antes de volver a llamar el bloque con
el valor "1" en la entrada de control EN_R.

Caso especial de una recepción de datos (sólo S7-400)
Si la CPU receptora pasa a STOP con una instrucción "BRCV" lista para recibir (es decir, ya
ha habido una llamada con EN_R =1) antes de que la instrucción de transmisión
correspondiente haya enviado el primer segmento de datos de una petición, ocurre lo
siguiente:
● Los datos de la primera petición tras la transición de la CPU receptora a STOP se registran
por completo en el área de recepción.
● La instrucción del interlocutor "BSEND (Página 6851)" recibe un acuse positivo al respecto.
● La CPU receptora ya no puede aceptar más peticiones "BSEND (Página 6851)" en estado
STOP.
● Mientras se encuentre en estado STOP, NDR y LEN tienen el valor "0".
Para no perder la información sobre los datos recibidos, será necesario ejecutar un rearranque
de la CPU receptora y llamar "BRCV" con EN_R=1.

C_CNTRL: Consultar el estado de la conexión
Descripción
Con esta instrucción se determina el estado de una conexión en el S7-300. Tras la llamada de
la instrucción con el valor "1" en la entrada de control EN_R se determina el estado actual de
la conexión direccionada con ID.

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "C_CNTRL":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L

El parámetro de control señaliza disponibilidad
de recepción cuando la entrada está activada.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las
instrucciones para la comunicación S7 (Pági‐
na 6833)

RET_VAL

Output

INT

Programación del PLC
Manual de programación y manejo, 11/2019

I, Q, M, D, L

Información de error

6857

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indi‐
cación de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

C_CONN

Output

BOOL

I, Q, M, D, L

Estado de la respectiva conexión.
Valores posibles:
● 0: Conexión interrumpida o no establecida.
● 1: Conexión disponible.

C_STATUS

Output

WORD

I, Q, M, D, L

Estado de la conexión:
● W#16#0000: la conexión no está establecida
● W#16#0001: la conexión se está
estableciendo
● W#16#0002: la conexión está establecida
● W#16#000F: no hay datos disponibles para
el estado de la conexión (p. ej. en el arranque
del CP)
● W#16#00FF: la conexión no está configurada

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros RET_VAL, ERROR y STATUS
El parámetro de salida RET_VAL puede adoptar los dos siguientes valores con "C_CNTRL":
● 0000H: no se ha producido ningún error durante le ejecución.
● 8000H: se ha producido un error durante le ejecución.
ERROR

STATUS
(decimal)

Explicación

1

10

Error durante el acceso al CP, porque hay otra petición en curso. Repetición de la petición con
posterioridad.

1

27

Para esta instrucción no existe ningún código de función en la CPU.

Nota
Incluso si en el parámetro de salida RET_VAL se indica el valor 0000H , deben evaluarse los
parámetros de salida ERROR y STATUS .

6858

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Otras
GET_S: Leer datos de una CPU remota
Descripción
En el S7-300 la instrucción permite leer datos de una CPU remota. La conexión puede
realizarse a través de la interfaz integrada o a través de un CP.
El proceso de lectura inicia tras un flanco ascendente en REQ. Con cada flanco ascendente en
REQ se aplican los parámetros ID, ADDR_1 y RD_1. Una vez finalizada una petición se
pueden asignar nuevos valores a los parámetros ID, ADDR_1 y RD_1.
El interlocutor remoto devuelve los contenidos de los datos. Los datos recibidos se copian en
la siguiente llamada en las áreas de recepción configuradas (RD_1). Hay que asegurarse de
que las áreas definidas por los parámetros ADDR_1 y RD_1 se correspondan entre sí en
cuanto a la cantidad, la longitud y el tipo de datos.
El término de este proceso se indica con "1" en el parámetro de estado NDR. No es posible
activar otro proceso de lectura hasta que no haya finalizado el último.
La CPU remota puede encontrarse en el estado operativo RUN o STOP. En caso de problemas
de acceso al leer los datos, o si la comprobación del tipo de datos devolvió un error, los errores
y advertencias correspondientes se indican a través de ERROR y STATUS.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "GET_S":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el intercam‐
bio de datos con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las ins‐
trucciones para la comunicación S7 (Página 6833)

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● 0: La petición aún no se ha iniciado o todavía
está en curso.
● 1: La petición ha finalizado correctamente.

ERROR /

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indica‐
ción de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

Programación del PLC
Manual de programación y manejo, 11/2019

6859

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

ADDR_1

InOut

ANY

M, D

Puntero hacia las áreas de la CPU interlocutora
que deben leerse.

RD_1

InOut

ANY

M, D

Puntero hacia las áreas de la CPU propia en las
que se depositan los datos leídos.
Sólo se permiten los tipos de datos BOOL (no per‐
mitido: mapa de bits), BYTE, CHAR, WORD, INT,
DWORD, DINT, REAL, COUNTER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste
siempre debe especificarse (p. ej.:
P#DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de error específica de la instrucción "GET_S"
que puede indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Se ha superado el número máximo de peticiones/instancias paralelas.

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

4

Error en los punteros de áreas de recepción RD_1 en cuanto a la longitud o el tipo de datos.

1

8

Error de acceso en la CPU interlocutora.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "GET_S"
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

20

● Se ha superado el número máximo de peticiones/instancias paralelas
● Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP)
● Es posible en la primera llamada

1

6860

27

Para esta instrucción no existe ningún código de función en la CPU.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Coherencia de datos
Los datos se reciben con coherencia si se observa lo siguiente:
Evalúe la parte actualmente utilizada del área de recepción RD_1 por completo antes de
activar una nueva petición.

PUT_S: Escribir datos en una CPU remota
Descripción
En el S7-300 la instrucción permite escribir datos en una CPU remota. La conexión puede
realizarse a través de la interfaz integrada o a través de un CP.
El proceso de transmisión inicia tras un flanco ascendente en REQ. Con cada flanco
ascendente en REQ se aplican los parámetros ID, ADDR_1 y SD_1. Una vez finalizada una
petición se pueden asignar nuevos valores a los parámetros ID, ADDR_1 y SD_1.
El interlocutor remoto deposita los datos transmitidos en las direcciones indicadas y devuelve
un acuse de ejecución. Hay que asegurarse de que las áreas definidas por los parámetros
ADDR_1 y SD_1 se correspondan entre sí en cuanto a la cantidad, la longitud y el tipo de datos.
Si no se ha producido ningún error, esto se indica en la siguiente llamada con "1" en el
parámetro de estado DONE . No es posible activar otro proceso de escritura hasta que no haya
finalizado el último.
La CPU remota puede encontrarse en el estado operativo RUN o STOP. En caso de problemas
de acceso al escribir los datos, o si la comprobación del acuse de ejecución devolvió un error,
los errores y advertencias correspondientes se indican a través de ERROR y STATUS .

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "PUT_S":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el intercambio de
datos con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las instruc‐
ciones para la comunicación S7 (Página 6833)

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía se está
ejecutando.
● 1: Petición finalizada sin errores.

Programación del PLC
Manual de programación y manejo, 11/2019

6861

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

ADDR_1

InOut

ANY

M, D

Puntero hacia las áreas de la CPU interlocutora en las
que debe escribirse.

SD_1

InOut

ANY

M, D

Puntero hacia las áreas de la CPU propia que contienen
los datos que deben transmitirse.
Sólo se permiten los tipos de datos BOOL (no permitido:
mapa de bits), BYTE, CHAR, WORD, INT, DWORD,
DINT, REAL, COUNTER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste siempre
debe especificarse (p. ej.: P#DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de error específica de "PUT_S", que puede
indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Se ha superado el número máximo de peticiones/instancias paralelas.

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

4

Error en los punteros de área de transmisión SD_1 en cuanto a la longitud o el tipo de datos.

1

8

Error de acceso en la CPU interlocutora

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado)

6862

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(decimal)

Explicación

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "PUT_S"
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente)

1

20

● Se ha superado el número máximo de peticiones/instancias paralelas
● Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP)
● Es posible en la primera llamada

1

27

Para esta instrucción no existe ningún código de función en la CPU.

Coherencia de datos
Para garantizar la coherencia de datos, no puede volver a escribirse en el área de transmisión
SD_1 hasta que no haya finalizado el proceso de transmisión actual. Esto ocurre cuando el
parámetro de estado DONE adopta el valor "1".

USEND_S: Enviar datos de forma no coordinada
Descripción
La instrucción "USEND_S" envía en el S7-300 datos a una instrucción remota del interlocutor
del tipo "URCV_S (Página 6865)". El proceso de transmisión se desarrolla sin coordinación
con la instrucción del interlocutor, es decir, que la transmisión de datos se produce sin acuse
por parte de la instrucción del interlocutor.
El proceso de transmisión inicia tras un flanco ascendente en REQ. Con cada flanco
ascendente en REQ se aplican los parámetros R_ID, ID y SD_1. Una vez finalizada una
petición se pueden asignar nuevos valores a los parámetros R_ID, ID y SD_1.
Hay que asegurase de que las áreas definidas por los parámetros SD_1 y RD_1 (en la
respectiva instrucción del interlocutor "URCV_S (Página 6865)") coincidan en:
● Número
● Longitud
● Tipo de datos
El parámetro R_ID debe ser idéntico en ambas instrucciones.
La finalización correcta del proceso de transmisión se indica con un "1" lógico en el parámetro
de estado DONE .

Programación del PLC
Manual de programación y manejo, 11/2019

6863

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "USEND_S":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el intercambio
de datos con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Véase también: Parámetros comunes de las instruc‐
ciones para la comunicación S7 (Página 6833)

R_ID

Input

DONE

Output

DWORD

BOOL

I, Q, M, D, L o cons‐
tante

Parámetro de direccionamiento R_ID

I, Q, M, D, L

Parámetro de estado DONE:

Véase también: Parámetros comunes de las instruc‐
ciones para la comunicación S7 (Página 6833)
● 0: La petición aún no se ha iniciado o todavía se
está ejecutando.
● 1: Petición finalizada sin errores.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indica‐
ción de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

SD_1

InOut

ANY

M, D

Puntero hacia área de transmisión.
Sólo se permiten los tipos de datos BOOL (no permi‐
tido: mapa de bits), BYTE, CHAR, WORD, INT,
DWORD, DINT, REAL, DATE, TOD, TIME, S5TIME,
DATE_AND_TIME, COUNTER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste siem‐
pre debe especificarse (p. ej.: P#DB10.DBX5.0 byte
10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

6864

25

La comunicación se ha iniciado. La petición está en proceso.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(decimal)

Explicación

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Se ha superado el número máximo de peticiones/instancias paralelas

1

4

Error en los punteros de área de transmisión SD_1 en cuanto a la longitud o el tipo de datos.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "USEND_S"
● No se ha indicado ningún DB de instancia, sino un DB global
● Se ha encontrado un DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

18

● R_ID ya existe en la conexión ID.
● Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP).

1

20

● Se ha superado el número máximo de peticiones/instancias paralelas
● Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP)
● Es posible en la primera llamada

1

27

Para esta instrucción no existe ningún código de función en la CPU.

Coherencia de datos
Para garantizar la coherencia de datos, no puede volver a escribirse en el área de transmisión
SD_1 hasta que no haya finalizado el proceso de transmisión actual. Esto ocurre cuando el
parámetro de estado DONE adopta el valor "1".

URCV_S: Recibir datos de forma no coordinada
Descripción
La instrucción "URCV_S" recibe en el S7-300 datos de forma asíncrona de una instrucción
remota del interlocutor del tipo "USEND_S (Página 6863)" y los copia en las áreas de recepción
configuradas.
La instrucción está lista para recibir cuando en la entrada EN_R hay un "1" lógico. Con EN_R=0
no es posible interrumpir una petición en curso.
Con cada flanco ascendente en EN_R se aplican los parámetros R_ID, ID y RD_1. Una vez
finalizada una petición se pueden asignar nuevos valores a los parámetros R_ID, ID y RD_1.

Programación del PLC
Manual de programación y manejo, 11/2019

6865

Instrucciones
4.2 Instrucciones
Hay que asegurarse de que las áreas definidas por los parámetros RD_1 y SD_1 (en la
respectiva instrucción del interlocutor "USEND_S (Página 6863)") coincidan en:
● Número
● Longitud
● Tipo de datos
La finalización correcta del proceso de copia se indica con un "1" lógico en el parámetro de
estado NDR . El parámetro R_ID debe ser idéntico en ambas instrucciones.

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "URCV_S":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L

El parámetro de control enabled to receive señaliza dis‐
ponibilidad de recepción cuando la entrada está activa‐
da.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Véase también: Parámetros comunes de las instruccio‐
nes para la comunicación S7 (Página 6833)

R_ID

Input

DWORD

I, Q, M, D, L o cons‐ Parámetro de direccionamiento R_ID
tante
Véase también: Parámetros comunes de las instruccio‐
nes para la comunicación S7 (Página 6833)

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● 0: La petición aún no se ha iniciado o todavía está en
curso.
● 1: La petición ha finalizado correctamente.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

RD_1

InOut

ANY

M, D

Puntero hacia el área de recepción n.º i.
Sólo se permiten los tipos de datos BOOL (no permitido:
mapa de bits), BYTE, CHAR, WORD, INT, DWORD,
DINT, REAL, DATE, TOD, TIME, S5TIME, DA‐
TE_AND_TIME, COUNTER, TIMER.
Nota: Si el puntero ANY accede a un DB, éste siempre
debe especificarse (p. ej.: P#DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

6866

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
ERROR

STATUS
(decimal)

Explicación

0

9

Advertencia Overrun: Los datos de recepción antiguos han sido sobrescritos por datos de re‐
cepción más actuales.

0

11

Advertencia: Los datos de recepción ya se están procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto)
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP)
● Conexión con el interlocutor todavía no establecida
● Se ha superado el número máximo de peticiones/instancias paralelas

1

4

Error en los punteros de área de recepción RD_1 en cuanto a la longitud o el tipo de datos.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "URCV_S".
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

18

● R_ID ya existe en la ID de conexión
● Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP)

1

19

La instrucción correspondiente "USEND_S (Página 6863)" envía datos más rápido de lo que
"URCV_S" los puede copiar en las áreas de recepción.

1

20

● Se ha superado el número máximo de peticiones/instancias paralelas
● Las instancias se han sobrescrito con RUN de la CPU (se requiere una transición STOP-RUN
de la CPU o del CP)
● Es posible en la primera llamada

1

27

Para este bloque no existe ningún código de función en la CPU.

Coherencia de datos
Los datos se reciben con coherencia si se observa lo siguiente:
Una vez que el parámetro de estado NDR ha adoptado el valor "1", hay que volver a llamar
inmediatamente "URCV_S" con el valor "0" en EN_R. Con ello queda garantizado que el área
de recepción no se sobrescriba antes de haberse evaluado. Evalúe el área de recepción RD_1
por completo antes de volver a llamar el bloque con el valor "1" en la entrada de control EN_R.

CONTROL: Consultar estado de la conexión con la instancia de una instrucción
Descripción
Con la instrucción "CONTROL" se determina en el S7-400 el estado de la conexión que
pertenece a una instancia local de una instrucción de comunicación.

Programación del PLC
Manual de programación y manejo, 11/2019

6867

Instrucciones
4.2 Instrucciones
Tras la llamada de la instrucción con el valor "1" en la entrada de control EN_R se determina
el estado actual de la conexión que pertenece a la instancia de la instrucción de comunicación
seleccionada con I_DB.

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "CONTROL":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L

El parámetro de control señaliza disponibilidad de re‐
cepción cuando la entrada está activada.

I_DB

Input

WORD

I, Q, M, D, L o cons‐
tante

Número del DB de instancia

OFFSET

Input

WORD

I, Q, M, D, L o cons‐
tante

Offset del registro en bytes en el DB multiinstancia (si
no hay ningún DB multiinstancia, aquí debe indicarse
"0").

RET_VAL

Return

INT

I, Q, M, D, L

Información de error

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

I_TYP

Output

BYTE

I, Q, M, D, L

Identificación del tipo de bloque que pertenece a la
instancia seleccionada.

I_STATE

Output

BYTE

I, Q, M, D, L

● = 0: La instancia correspondiente de la instrucción
no se ha llamado desde el último arranque en frío,
rearranque completo (en caliente) o carga.
● <> 0: La instancia correspondiente de la
instrucción se ha llamado como mínimo una vez
desde el último arranque en frío, rearranque
completo (en caliente) o carga.

I_CONN

Output

BOOL

I, Q, M, D, L

Estado de la respectiva conexión.
Valores posibles:
● 0: Conexión interrumpida o no establecida.
● 1: Conexión disponible.

I_STATUS

Output

WORD

I, Q, M, D, L

Parámetro de estado STATUS de la instancia de la
instrucción de comunicación consultada.

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

6868

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro de salida I_TYP
La siguiente tabla muestra qué identificación pertenece a qué tipo de instrucción.
Tipo de instrucción

Identificación (W#16#...)

USEND (Página 6845)

00

URCV (Página 6848)

01

BSEND (Página 6851)

04

BRCV (Página 6854)

05

GET (Página 6840)

06

PUT (Página 6842)

07

PRINT (Página 6870)

08

START (Página 6876)

0B

STOP (Página 6878)

0C

RESUME (Página 6880)

0D

STATUS (Página 6882)

0E

USTATUS (Página 6884)

0F

ALARM (Página 6083)

15

ALARM_8 (Página 6075)

16

ALARM_8P (Página 6077)

17

NOTIFY (Página 6080)

18

AR_SEND (Página 6103)

19

NOTIFY_8P (Página 6073)

1A

(ninguna instrucción disponible; I_DB o OFFSET
incorrectos)

FF

Parámetros RET_VAL, ERROR y STATUS
El parámetro de salida RET_VAL puede adoptar los dos siguientes valores con la instrucción
"CONTROL":
● 0000H: no se ha producido ningún error durante le ejecución.
● 8000H: se ha producido un error durante le ejecución.
ERROR

STATUS
(decimal)

Explicación

1

10

El acceso a la memoria de usuario local no es posible (p. ej.: Como parámetro
actual para I_TYP se ha indicado un byte de marcas que no existe en la CPU
utilizada.)

1

12

Al llamar la instrucción
● en el parámetro I_DB se ha indicado un DB de instancia que no pertenece
a la instrucción "CONTROL".
● no se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el
DB de instancia correspondiente).

Programación del PLC
Manual de programación y manejo, 11/2019

6869

Instrucciones
4.2 Instrucciones

Nota
Incluso si en el parámetro de salida RET_VAL se indica el valor 0000H , deben evaluarse los
parámetros de salida ERROR y STATUS .

PRINT: Enviar datos a una impresora
Descripción de PRINT
Descripción
La instrucción "PRINT" permite enviar en el S7-400 datos junto con una instrucción de formato
a una impresora remota, p. ej. con el CP 441.
Con un flanco ascendente en la entrada de control REQ se envían la descripción de formato
(parámetro FORMAT) y los datos (SD_i) a la impresora seleccionada con ID y PRN_NR .
Si no se utilizan las cuatro áreas de transmisión, asegúrese de escribir la primera área con el
parámetro SD_1, la segunda (si procede) con SD_2, la tercera (si procede) con SD_3.
La finalización correcta de la petición se indica en el parámetro de estado DONE con "1", y los
errores ocurridos se indican a través de los parámetros de estado ERROR y STATUS.

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "PRINT":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa el intercambio de
datos con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Véase también: Parámetros comunes de las instruccio‐
nes para la comunicación S7 (Página 6833)

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía se está
ejecutando.
● 1: Petición finalizada sin errores.

6870

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: advertencia, STATUS devuelve
información detallada
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error

PRN_NR

InOut

BYTE

I, Q, M, D, L

Número de impresora

FORMAT (Pá‐ InOut
gina 6872)

STRING

I, Q, M, D, L

Descripción de formato

SD_i

ANY

M, D, T, C

InOut

Puntero al área de transmisión n.º i.
Sólo se permiten los tipos de datos BOOL (no permitido:
mapa de bits), BYTE, CHAR, WORD, INT, DWORD,
DINT, REAL, DATE, TOD, TIME, S5TIME, DA‐
TE_AND_TIME.

(1≤ i ≤4)

Nota: Si el puntero ANY accede a un DB, éste siempre
debe especificarse (p. ej.: P# DB10.DBX5.0 byte 10).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de los errores específicos de "PRINT", que
puede indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto).
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP).

1

2

Acuse negativo de la impresora. La función no puede ejecutarse.

1

3

PRN_NR no es conocido en la conexión de comunicación especificada por ID.

1

4

Error en el parámetro de entrada/salida FORMAT o en los punteros de área de transmisión SD_i
en cuanto a la longitud o el tipo de datos.

1

6

La impresora remota está en estado OFFLINE.

1

7

La impresora remota se encuentra en un estado erróneo (p. ej. paper out).

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

Programación del PLC
Manual de programación y manejo, 11/2019

6871

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(decimal)

Explicación

1

12

Al llamar la instrucción
● se ha indicado un DB de instancia que no pertenece a "PRINT".
● no se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

13

Error en el parámetro de entrada/salida FORMAT (Página 6872).

1

20

S7-400
La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del programa
que se encuentra en la memoria.

Número de datos transmisibles
El número de datos transmisibles a una impresora remota no puede superar una longitud
máxima. La longitud de datos máxima en bytes se calcula de la siguiente manera:
maxleng = 420 - format
format es la longitud actual del parámetro FORMAT en bytes. Es irrelevante si los datos que
se van a imprimir se reparten entre una o varias áreas de transmisión.

Parámetro FORMAT
Descripción
La cadena de caracteres FORMAT contiene los caracteres y elementos de formato que deben
imprimirse. Su estructura es la siguiente:

&DU£FWHU

,QVWUXFFLµQGHFRQYHUVLµQ

,QVWUXFFLµQGHFRQWURO

Figura 4-41

Estructura de caracteres y elementos de formato

Para cada área de transmisión que debe imprimirse SD_1 a SD_4 debe haber exactamente
una instrucción de conversión en FORMAT. Las instrucciones de conversión se aplican a las
áreas de transmisión SD_i siguiendo su orden. Además, los caracteres y las instrucciones
pueden figurar en cualquier orden.

6872

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Carácter
Son admisibles:
● Todos los caracteres imprimibles
● $$ (símbolo del dólar), $' (signo de exclamación sencillo), $L y $l (avance de línea), $P y $p
(página), $R y $r (retorno de carro), $T y $t (tabulador)


)ODJV

Figura 4-42

$QFKR



3UHFLVLµQ

7LSRGHUHSUHVHQWDFLµQ

Diagrama sintáctico de una instrucción de conversión

Elemento de una ins‐ Significado
trucción de conver‐
sión
Flags
Ancho

Precisión

● Sin:

Impresión con sangría a derecha

● -:

Impresión con sangría a izquierda

● Sin:

La impresión se realiza en la representación estándar

● n:

Se imprimen exactamente n caracteres.
En una impresión con sangría a la derecha, en caso necesario
se anteponen espacios, mientras que con sangría a la izquierda
se colocan al final.

La precisión sólo es relevante para los tipos de representación A, D, F y R (ver
la tabla siguiente).
● Sin:
● 0:
● n:

La impresión se realiza en representación estándar
Sin impresión del punto decimal ni de
decimales en los tipos de representación F y R
● Con F y R: Impresión del punto decimal y de n decimales.
● Con A y D (fecha): Número de posiciones en el número de
año. Valores posibles: 2 y 4.

Tipo de representa‐
ción

La tabla siguiente contiene
● Los tipos de representación posibles
● Los tipos de datos posibles para cada tipo de representación
● Para cada tipo de representación, la representación estándar (la impresión
se realiza en representación estándar si en el parámetro FORMAT no se
indica el ancho ni la precisión) y la longitud máxima.

Instrucción de conversión
La tabla siguiente muestra los tipos de representación posibles en la instrucción de conversión
del parámetro FORMAT.
Tipo de repre‐
sentación

Tipos de datos posi‐ Ejemplo
bles

Longitud

Observaciones

A, a

DATE

25.07.1996

10

-

CHAR

K

1

-

BYTE

M

1

DWORD
C, c

Programación del PLC
Manual de programación y manejo, 11/2019

6873

Instrucciones
4.2 Instrucciones
Tipo de repre‐
sentación

Tipos de datos posi‐ Ejemplo
bles

Longitud

Observaciones

WORD

KL

2

DWORD

KLMN

4

ARRAY of CHAR

KLMNOP

Número de
caracteres

1996-07-25

10

-

0.345678

8

-

ARRAY of BYTE
D, d

DATE
DWORD

F, f

REAL
DWORD

H, h

Todos los tipos de
datos incluido
ARRAY of BYTE

según el tipo de
datos

según el ti‐ Representación hexadeci‐
po de datos mal

I, i

INT

- 32 768

Máx. 6

WORD

- 2 147 483 648

Máx. 11

N, n

WORD

Impresión de tex‐ to

El área de transmisión
SD_i correspondiente con‐
tiene una referencia (núme‐
ro) a un texto que debe im‐
primirse. El texto se en‐
cuentra en el módulo (p. ej.
CP 441) que genera una
cadena de caracteres im‐
primible. Se imprime **** si
no se encuentra ningún tex‐
to con el número indicado.

R, r

REAL

0.12E-04

-

8

-

DWORD
S, s

STRING

Impresión de tex‐
to

-

T, t

TIME

2d_3h_10m_5s_
250ms

Máx. 21

Se imprime **** en caso de
error.

BYTE

255

Máx. 3

-

WORD

65 535

Máx. 5

DWORD

4 294 967 295

Máx. 10

BOOL

1

1

BYTE

101 ..

8

WORD

101 ..

16

DWORD

101 ..

32

TIME_OF_DAY
(TOD)

15:38:59.874

12

DWORD
U, u

X, x

Z, z

6874

-

-

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En los puntos de esta tabla en los que se indica una longitud máxima para la representación
estándar, también es posible que la impresión sea más corta.
Nota
Con los tipos de datos C y S depende de la impresora utilizada
● qué caracteres podrán imprimirse
● qué imprimirá la impresora para caracteres no imprimibles, a no ser que el driver de la
impresora contenga una tabla de conversión para esos caracteres.

Instrucción de control
Con ayuda de las instrucciones de control es posible:
● Imprimir los caracteres % y \
● Modificar ajustes de impresora
?

,PSUHVLµQGHOFDU£FWHU
,PSUHVLµQGHOFDU£FWHU?

?
1HJULWD

$FWLYDU
'HVDFWLYDU





E
%

/HWUDFRPSULPLGD

F
&

/HWUDH[SDQGLGD

H
(

&XUVLYD

L
,

9HUVDOHV

N
.

6XEUD\DGR

X
8

Figura 4-43

Programación del PLC
Manual de programación y manejo, 11/2019

Diagrama sintáctico de la instrucción de control

6875

Instrucciones
4.2 Instrucciones
Si se solicita por ejemplo la desactivación de una fuente, a pesar de que ésta no está activada,
o si se pretende ejecutar una función desconocida por la impresora, la instrucción de control
se ignora. La tabla siguiente contiene los errores en el parámetro de entrada/salida FORMAT.
Error

Impresión

Instrucción de conversión no ejecuta‐ Conforme a la longitud (máx.) de la representación estándar o
ble
del ancho indicado se imprimen caracteres *.
Ancho indicado insuficiente

En los tipos de representación A, C, D, N, S, T, Z se imprimen
tantos caracteres como determine el ancho indicado. Para el
resto de tipos de representación se imprimen caracteres * con‐
forme al ancho indicado.

Demasiadas instrucciones de conver‐ Las instrucciones de conversión a las que no pertenece ningún
sión
puntero de área de transmisión SD_i se ignoran.
Instrucciones de conversión insufi‐
cientes

Las áreas de transmisión para las que no existe una instrucción
de conversión no se imprimen.

Instrucciones de conversión no defi‐
nidas o no soportadas

Se imprime ******.

Instrucción de conversión incompleta Se imprime ******.
Instrucciones de control no definidas
o no soportadas

Las instrucciones de control que no se correspondan con la
sintaxis de la imagen anterior se ignoran.

START: Ejecutar un rearranque completo o arranque en frío en un dispositivo remoto
Descripción
Con un flanco ascendente en la entrada de control REQ, la instrucción "START" activa en el
S7-400 un rearranque completo (en caliente) o un arranque en frío en el dispositivo remoto
direccionado por ID.
Encontrará más información sobre el tema de arranque en caliente y frío en: Arranque en frío
y caliente (http://support.automation.siemens.com/WW/view/de/34053759)
Para la ejecución en el dispositivo remoto (si se trata de una CPU) deben cumplirse las
siguientes condiciones:
● La CPU está en estado operativo STOP.
● El selector de modo de la CPU debe estar en "RUN".
Una vez que éste ha realizado el rearranque completo (en caliente) o un arranque en frío, pasa
al estado operativo RUN y envía un acuse de ejecución positivo. Con la evaluación del acuse
positivo, el parámetro de estado DONE se pone a "1". Los errores ocurridos se indican a través
de los parámetros de estado ERROR y STATUS.
Una nueva activación de un rearranque completo (en caliente) o un arranque en frío en el
mismo dispositivo remoto no será posible hasta que no haya finalizado la última activación.

6876

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "START":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa la instrucción con
un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las instruc‐
ciones para la comunicación S7 (Página 6833)

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía se está
ejecutando.
● 1: Petición finalizada sin errores.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

PI_NAME

InOut

ANY

I, Q, M, D, T, C

Puntero hacia el área de memoria en la que se encuen‐
tra el nombre del programa que debe iniciarse (código
ASCII). El nombre no puede constar de más de 32 ca‐
racteres.
Con un sistema estándar de la familia S7 debe ser
P_PROGRAM.

ARG

InOut

ANY

I, Q, M, D, T, C

Argumento de ejecución.
● Si no se asigna ningún valor a ARG en el dispositivo
remoto se ejecutará un rearranque completo (en
caliente).
● Si se asigna el valor "C", en el dispositivo remoto se
ejecutará un arranque en frío (si el dispositivo
remoto conoce este tipo de arranque).

IO_STATE

InOut

BYTE

I, Q, M, D, L

Actualmente irrelevante. A este parámetro es posible no
asignarle ningún parámetro siempre que el interlocutor
sea un sistema de automatización de la familia S7.

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Programación del PLC
Manual de programación y manejo, 11/2019

6877

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de los errores específicos de START , que
puede indicarse a través de los parámetros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto).
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP).

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

3

El nombre de programa guardado en PI_NAME es desconocido.

1

4

Error en los punteros PI_NAME o ARG en cuanto a la longitud o el tipo de datos.

1

7

En el dispositivo interlocutor no puede ejecutarse un rearranque completo.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "START"
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

20

S7-400: La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del pro‐
grama que se encuentra en la memoria.

STOP: Poner el dispositivo remoto en el estado operativo STOP
Descripción
Con un flanco ascendente en la entrada de control REQ , la instrucción "STOP" activa en el
S7-400 el paso del dispositivo remoto direccionado por ID al estado operativo STOP; el cambio
de estado operativo es posible si el dispositivo se encuentra en RUN, PARADA o arranque.
La finalización correcta de la petición se indica en el parámetro de estado DONE con "1", y los
errores ocurridos se indican a través de los parámetros de estado ERROR y STATUS.
Una nueva ejecución de la transición de estado operativo descrita en el mismo dispositivo
remoto sólo será posible cuando haya finalizado el lanzamiento anterior de la instrucción
"STOP".

6878

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "STOP":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa la instrucción
con un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Véase también: Parámetros comunes de las instruc‐
ciones para la comunicación S7 (Página 6833)

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía se
está ejecutando.
● 1: Petición finalizada sin errores.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

PI_NAME

InOut

ANY

I, Q, M, D

Puntero hacia el área de memoria en la que se en‐
cuentra el nombre del programa que debe pararse
(código ASCII). El nombre no puede constar de más
de 32 caracteres.
Con un sistema estándar de la familia S7 debe ser
P_PROGRAM.

IO_STATE

InOut

BYTE

I, Q, M, D, L

Actualmente irrelevante. A este parámetro es posible
no asignarle ningún parámetro siempre que el inter‐
locutor sea un sistema de automatización de la familia
S7.

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Programación del PLC
Manual de programación y manejo, 11/2019

6879

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información sobre los errores específicos de la instrucción
"STOP" y que puede indicarse a través de los parámetros ERRORy STATUS.
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto).
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP).

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

3

El nombre de programa guardado en PI_NAME es desconocido.

1

4

Error en el puntero PI_NAME en cuanto a la longitud o el tipo de datos.

1

7

El dispositivo interlocutor ya se encuentra en estado STOP.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "".
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

20

S7-400: La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del pro‐
grama que se encuentra en la memoria.

RESUME: Ejecutar un rearranque en un dispositivo remoto
Descripción
Con un flanco ascendente en la entrada de control REQ, la instrucción "RESUME" activa en el
S7-400 un rearranque en el dispositivo remoto direccionado por ID. Si el dispositivo remoto es
una CPU, deben cumplirse las siguientes condiciones:
● La CPU está en estado operativo STOP.
● El selector de modo de la CPU debe estar en RUN.
● Es necesario haber permitido el rearranque manual en la configuración.
● No puede haber ningún impedimento para el rearranque.
Una vez que se ha realizado el rearranque, pasa al estado operativo RUN y transmite un acuse
de ejecución positivo. Con la evaluación del acuse positivo, el parámetro de estado DONE se
pone a "1". Los errores ocurridos se indican a través de los parámetros de estado ERROR y
STATUS.
Una nueva activación de un rearranque en el mismo dispositivo remoto no será posible hasta
que no haya finalizado la última activación.

6880

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "RESUME":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa la instrucción con
un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Véase también: Parámetros comunes de las instruccio‐
nes para la comunicación S7 (Página 6833)

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía se está
ejecutando.
● 1: Petición finalizada sin errores.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: Advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

PI_NAME

InOut

ANY

I, Q, M, D

Puntero hacia el área de memoria en la que se encuen‐
tra el nombre del programa que debe iniciarse (código
ASCII). El nombre no puede constar de más de 32 ca‐
racteres. En el S7 debe ser P_PROGRAM.

ARG

InOut

ANY

I, Q, M, D, T, C

Argumento de ejecución. Actualmente irrelevante. A es‐
te parámetro es posible no asignarle ningún parámetro
siempre que el interlocutor sea un sistema de automati‐
zación de la familia S7.

IO_STATE

InOut

BYTE

I, Q, M, D, L

Actualmente irrelevante. A este parámetro es posible no
asignarle ningún parámetro siempre que el interlocutor
sea un sistema de automatización de la familia S7.

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Programación del PLC
Manual de programación y manejo, 11/2019

6881

Instrucciones
4.2 Instrucciones

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de los errores específicos de "RESUME", que
puede indicarse a través de los parámetros ERROR y STATUS.
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

● Problemas de comunicación, p. ej. descripción de la conexión no cargada (local o remoto).
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP).

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

3

El nombre de programa guardado en PI_NAME es desconocido.

1

4

Error en los punteros PI_NAME o ARG en cuanto a la longitud o el tipo de datos.

1

7

Rearranque no ejecutable.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a RESUME.
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

20

S7-400: La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del pro‐
grama que se encuentra en la memoria.

STATUS: Consultar el estado de dispositivo de un interlocutor remoto
Descripción
La instrucción "STATUS" permite consultar en el S7-400 el estado del dispositivo de un
interlocutor remoto.
Con un flanco ascendente en la entrada de control REQ se envía una petición al interlocutor
remoto. La respuesta se evalúa para comprobar si ha habido algún problema. Si no ha ocurrido
ningún error, el estado recibido se copia en las variables de los parámetros PHYS, LOG y
LOCAL en la siguiente llamada. El término de este proceso se indica con "1" en el parámetro
de estado NDR.
No es posible volver a realizar una consulta en el mismo interlocutor hasta que no haya
finalizado la última.

6882

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "STATUS":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L

El parámetro de control request activa la instrucción con
un flanco ascendente.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Véase también: Parámetros comunes de las instruccio‐
nes para la comunicación S7 (Página 6833)

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● 0: La petición aún no se ha iniciado o todavía está en
curso.
● 1: La petición ha finalizado correctamente.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
<> 0000H: advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

PHYS

InOut

ANY

I, Q, M, D

Estado físico (longitud mínima: un byte)
Valores posibles:
● 10H funciona correctamente.
● 13H requiere trabajos de servicio.

LOG

InOut

ANY

I, Q, M, D

Estado lógico (longitud mínima: un byte)
Valor posible:
● 00H cambio de estado permitido.

LOCAL

InOut

ANY

I, Q, M, D

Estado operativo en caso de que el dispositivo interlo‐
cutor sea una CPU S7 (longitud mínima: dos bytes).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetro de entrada/salida LOCAL
Si el interlocutor es una CPU S7, el parámetro de entrada/salida LOCAL contiene su estado
operativo actual: El primer byte está reservado, el segundo byte contiene una identificación del
estado operativo.
Estado operativo

Identificación correspondiente

STOP

00H

ARRANQUE (rearranque completo)

01H

Programación del PLC
Manual de programación y manejo, 11/2019

6883

Instrucciones
4.2 Instrucciones
Estado operativo

Identificación correspondiente

RUN

02H

ARRANQUE (rearranque)

03H

PARADA

04H

ARRANQUE (arranque en frío)

06H

RUN

09H

ACOPLAR

0BH

SINCRONIZAR

0CH

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de los errores específicos de STATUS, que
puede indicarse a través de los parámetros ERROR y STATUS.
ERROR

STATUS
(decimal)

Explicación

0

11

Advertencia:
● La nueva petición no tiene efecto, ya que la anterior todavía no ha finalizado.
● La petición ya se está procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto).
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP).

1

2

Acuse negativo del interlocutor. La función no puede ejecutarse.

1

4

Error en PHYS, LOG, o LOCAL en cuanto a la longitud o el tipo de datos.

1

8

Se ha rechazado el acceso a un objeto remoto.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a STATUS.
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente).

1

20

S7-400: La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del pro‐
grama que se encuentra en la memoria.

USTATUS: Recepción no coordinada de un estado de dispositivo remoto
Descripción
La instrucción "USTATUS" recibe en el S7-400 el cambio de estado del dispositivo de un
interlocutor remoto; si se ha configurado así, el interlocutor envía su estado en caso de cambio
sin que se le solicite.
Si en la llamada hay EN_R 1 en la entrada de control y hay un telegrama del interlocutor, en la
siguiente llamada se deposita la información de estado en las variables de los parámetros

6884

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
PHYS, LOG y LOCAL. El término de este proceso se indica con "1" en el parámetro de estado
NDR.
En la conexión utilizada por la instrucción "USTATUS" debe estar habilitada la transmisión de
avisos sobre el estado operativo.
Nota
Por cada conexión sólo se puede posicionar una instancia de la instrucción "USTATUS".

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "USTATUS":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L

El parámetro de control (enabled to receive) señaliza
la disponibilidad de recepción cuando la entrada está
activada.

ID

Input

WORD

M, D o constante

Parámetro de direccionamiento ID
Consulte también: Parámetros comunes de las ins‐
trucciones para la comunicación S7 (Página 6833)

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● 0: La petición aún no se ha iniciado o todavía está
en curso.
● 1: La petición ha finalizado correctamente.

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

Parámetros de estado ERROR y STATUS, indicación
de error:
● ERROR=0
STATUS tiene el valor:
0000H: ni advertencia ni error
0000H: advertencia, STATUS devuelve
información detallada.
● ERROR=1
Hay un error. STATUS devuelve información
detallada sobre el tipo de error.

PHYS

InOut

ANY

I, Q, M, D

Estado físico (longitud mínima: un byte)
Valores posibles:
● 10H funciona correctamente.
● 13H requiere trabajos de servicio.

LOG

InOut

ANY

I, Q, M, D

Estado lógico (longitud mínima: un byte)
Valor posible:
● 00H cambio de estado permitido.

LOCAL

InOut

ANY

I, Q, M, D

Estado operativo en caso de que el dispositivo inter‐
locutor sea una CPU S7 (longitud mínima: dos bytes).

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Programación del PLC
Manual de programación y manejo, 11/2019

6885

Instrucciones
4.2 Instrucciones

Parámetro de entrada/salida LOCAL
Si el interlocutor es una CPU S7, el parámetro de entrada/salida LOCAL contiene su estado
operativo actual: El primer byte está reservado, el segundo byte contiene una identificación del
estado operativo.
Estado operativo

Identificación correspondiente

STOP

00H

ARRANQUE (rearranque completo)

01H

RUN

02H

ARRANQUE (rearranque)

03H

PARADA

04H

ARRANQUE (arranque en frío)

06H

RUN

09H

ACOPLAR

0BH

SINCRONIZAR

0CH

Parámetros ERROR y STATUS
La siguiente tabla contiene toda la información de error específica de "USTATUS", que puede
indicarse a través de los parámetros ERROR y STATUS.
ERROR

STATUS
(decimal)

Explicación

0

9

Advertencia Overrun: Un estado de dispositivo anterior ha sido sobrescrito con un estado más
actual.

0

11

Los datos de recepción ya se están procesando en una clase de menor prioridad.

0

25

La comunicación se ha iniciado. La petición está en proceso.

1

1

Problemas de comunicación, p. ej.
● Descripción de la conexión no cargada (local o remoto).
● Conexión interrumpida (p. ej. cable, CPU desconectada, CP en STOP).

1

4

Error en PHYS, LOG, o LOCAL en cuanto a la longitud o el tipo de datos.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado).

1

12

En la llamada de la instrucción ha ocurrido lo siguiente:
● Se ha indicado un DB de instancia que no pertenece a "USTATUS".
● No se ha indicado ningún DB de instancia, sino un DB global
● No se ha encontrado ningún DB de instancia (solución: vuelva a cargar el DB de instancia
correspondiente)

1

18

Para la conexión especificada por ID ya existe una instancia de "USTATUS".

1

19

La CPU remota transmite datos más rápido de lo que la instrucción puede aplicarlos en el programa
de usuario.

1

20

S7-400: La memoria de trabajo disponible no es suficiente. Solución: Reduzca el código del pro‐
grama que se encuentra en la memoria.

6886

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

4.2.5.3

Open User Communication

Vista general
Open User Communication vía Industrial Ethernet
Para poder intercambiar datos con otros interlocutores vía Ethernet (protocolo TCP, ISO-onTCP y UDP) a través del programa de usuario, se ponen a disposición las siguientes
instrucciones y UDTs:
● Protocolos orientados a la conexión: TCP según RFC 793, ISO on TCP según RFC 1006:
– UDT 65 "TCON_PAR (Página 6897)" con la estructura de datos para parametrizar la
conexión
– UDT 651 hasta UDT 656 con la asignación de valores predeterminados específica del
protocolo
– "TCON (Página 6910)" para establecer la conexión
– "TDISCON (Página 6913)" para deshacer la conexión
– "TSEND (Página 6915)" para enviar datos
– "TRCV (Página 6918)" para recibir datos
● Protocolo orientado a la no-conexión: UDP según RFC 768
– UDT 65 "TCON_PAR (Página 6897)" con la estructura de datos para parametrizar el
punto de acceso local de comunicación
– UDT 657 con la asignación de valores predeterminados específica del protocolo
– UDT 66 "TCON_ADR (Página 6899)" con la estructura de datos de los parámetros de
direccionamiento del interlocutor remoto
– UDT 661 con la asignación de valores predeterminados específica del protocolo
– "TCON (Página 6910)" para crear el punto de acceso local de comunicación
– "TDISCON (Página 6913)" para deshacer el punto de acceso local de comunicación
– "TUSEND (Página 6922)" para enviar datos
– "TURCV (Página 6925)" para recibir datos

Programación del PLC
Manual de programación y manejo, 11/2019

6887

Instrucciones
4.2 Instrucciones

Funcionamiento de las instrucciones para Open User Communication vía Industrial Ethernet
Protocolos orientados a la conexión y a la no-conexión
En la comunicación de datos se distingue entre las siguientes variantes de protocolo:
● Variantes de protocolo orientadas a la conexión:
establecen una conexión (lógica) con el interlocutor antes de la transferencia de datos y,
dado el caso, la deshacen una vez que ésta ha concluido. Los protocolos orientados a la
conexión se utilizan especialmente cuando lo importante en la transferencia de datos es la
seguridad. A través de una línea física es posible establecer, por lo general, varias
conexiones lógicas.
En las instrucciones para Open User Communication vía Industrial Ethernet se soportan los
siguientes protocolos orientados a la conexión:
– TCP según RFC 793
– ISO on TCP según RFC 1006
● Variantes de protocolo orientadas a la no-conexión:
trabajan sin conexión. Así, no se establece ni deshace la conexión con el interlocutor
remoto. Los protocolos orientados a la no-conexión transmiten datos al interlocutor remoto
sin acuse y, por lo tanto, de forma insegura; esto significa que se pueden extraviar datos sin
que su pérdida se indique en el bloque.
En las instrucciones para Open User Communication vía Industrial Ethernet se soportan los
siguientes protocolos orientados a la no-conexión:
– UDP según RFC 768 (broadcast o singlecast; no se soporta multicast)
El funcionamiento de las instrucciones depende de la variante de protocolo utilizada. Este
tema se describe más adelante.

Área de recepción
Este término se utiliza repetidamente en los siguientes apartados. Se entiende como tal el área
en la que la instrucción registra los datos recibidos.
El área de recepción está definida por los dos valores siguientes:
● Puntero hacia el inicio del área
● Longitud del área
En función de la variante de protocolo utilizada, la longitud del área se fija con el parámetro
LEN (si LEN <> 0) o por la indicación de longitud del parámetro DATA (si LEN = 0).
En el puntero ANY se permiten los siguientes tipos de datos: BOOL, BYTE, CHAR, WORD,
INT, DWORD, DINT, REAL, DATE, TIME_OF_DAY, TIME, S5TIME, DATE_AND_TIME.

6888

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

TCP
Al transferir datos no se transfiere ni información relacionada con la longitud de un mensaje ni
con su principio o fin. Esto no supone un problema a la hora de enviar, ya que el emisor sabe
cuántos bytes de datos quiere enviar. Sin embargo, el receptor no tiene ninguna posibilidad de
detectar dónde termina un mensaje dentro del flujo de datos y dónde empieza el siguiente. Por
ello se recomienda elegir el área de recepción de la instrucción "TRCV (Página 6918)" de un
tamaño equivalente al valor del parámetro LEN de la instrucción "TRCV (Página 6915)" en el
interlocutor (número de bytes, que se deben enviar).
● Recepción de datos en modo Ad hoc:
El área de recepción es idéntica al área especificada por el parámetro DATA de la
instrucción "TRCV (Página 6918)".
– Inmediatamente después de la recepción de un bloque de datos, la instrucción "TRCV
(Página 6918)" lo transmite al área de recepción y pone NDR a "1". La longitud máxima
es de 8192 bytes.
– Si ha elegido una longitud del área de recepción más grande que la longitud de los datos
enviados, la instrucción "TRCV (Página 6918)" copia por completo los datos recibidos
en el área de recepción. A continuación, pone NDR a TRUE y escribe en RCVD_LEN la
longitud de los datos recibidos.
– Si ha elegido una longitud del área de recepción más pequeña que la longitud de los
datos enviados, "TRCV (Página 6918)" copiará tantos bytes en el área de recepción
como quepan hasta llenarla. A continuación, pone NDR a TRUE y escribe en
RCVD_LEN la longitud del área de recepción. Con cada llamada posterior se obtiene un
bloque adicional de los datos enviados.
● Recepción de datos con longitud especificada:
– El área de recepción está formada por los parámetros DATA (dirección inicial del área
de recepción) y LEN (longitud del área de recepción) de "TRCV (Página 6918)".
– Si se reciben datos que no llenan completamente el área de recepción, en un principio
éstos no pueden ponerse a disposición. No se pondrán a disposición hasta que otros
datos hayan llenado completamente el área de recepción. Tenga en cuenta que, en este
caso, hay datos de dos órdenes de envío distintas en la misma área de recepción. Si no
puede definir el final del primer mensaje o el inicio del segundo mensaje, no tiene
posibilidad alguna de reconocer el primer o el segundo mensaje.
– Si ha elegido una longitud del área de recepción más pequeña que la longitud de los
datos enviados, "TRCV (Página 6918)" copiará tantos bytes en el área de recepción
como quepan hasta llenarla.
– Si "TRCV (Página 6918)" ha llenado completamente el área de recepción, pone NDR a
TRUE y escribe en RCVD_LEN el valor de LEN. Con cada llamada posterior se obtiene
así un bloque adicional de los datos enviados.

ISO on TCP
Al transferir datos se transfieren informaciones relacionadas con la longitud y el fin de un
mensaje.
Si ha elegido un área recepción más grande que la longitud de los datos enviados, la
instrucción "TRCV (Página 6918)" copia completamente los datos enviados en el área de

Programación del PLC
Manual de programación y manejo, 11/2019

6889

Instrucciones
4.2 Instrucciones
recepción. A continuación, pone NDR a TRUE y escribe en RCVD_LEN la longitud de los datos
enviados.
Si ha elegido un área de recepción más pequeña que la longitud de los datos enviados, "TRCV
(Página 6918)" no copia datos en el área de recepción, sino que devuelve la siguiente
información de error: ERROR=1, STATUS=W#16#8088.

UDP
No se establece una conexión como con los protocolos TCP y ISO on TCP. Por esa razón, al
llamar el bloque de envío "TUSEND (Página 6922)" se tiene que indicar una referencia a los
parámetros de dirección del receptor (dirección IP y n° de puerto). Paralelamente, se recibe
una referencia a los parámetros de dirección del emisor (dirección IP y n° de puerto) tras
concluir el bloque de recepción "TURCV (Página 6925)".
● Para poder utilizar las instrucciones "TUSEND (Página 6922)" y "TURCV (Página 6925)" se
tiene que llamar con anterioridad la instrucción "TCON (Página 6910)" tanto en el lado del
emisor como en el del receptor para configurar el punto de acceso local de comunicación.
● En cada llamada de "TUSEND (Página 6922)" se puede referenciar de nuevo al interlocutor
remoto indicando su dirección IP y su n° de puerto.
● Al transferir datos se transfieren informaciones relacionadas con la longitud y el fin de un
mensaje.
Si ha elegido un área recepción más grande que la longitud de los datos enviados, "TURCV
(Página 6925)" copia completamente los datos enviados en el área de recepción. A
continuación, pone NDR a TRUE y escribe en RCVD_LEN la longitud de los datos enviados.
Si ha elegido un área recepción más pequeña que la longitud de los datos enviados, "TURCV"
no copia los datos en el área de recepción, sino que devuelve la siguiente información de error:
ERROR = 1, STATUS = W#16#8088.

Números de puerto en TCP y UDP
El direccionamiento de una conexión se realiza así:
● Con TCP:
– Conexión activa: A través de la dirección IP remota, el puerto remoto y el puerto local (el
número de puerto del puerto local se debe especificar explícitamente o será
proporcionado por el sistema operativo).
– Conexión pasiva: a través del puerto local. Si desea utilizar el puerto local más de una
vez, especifique también o la dirección IP remota o la dirección IP remota y el puerto
remoto.
● Con UDP: A través de la dirección IP remota, el puerto remoto y el puerto local (el número
de puerto del puerto local se debe especificar explícitamente).

6890

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para el puerto local valen las áreas mencionadas a continuación. Para el puerto remoto, esas
áreas sólo son válidas si el interlocutor remoto es una CPU S7. De otro modo no hay
restricciones para el puerto remoto.
● Para CPU 31x-2 PN/DP hasta la versión de firmware V2.6 incluida y CPU 41x3 PN/DP
hasta la versión de firmware V5.1 incluida:
– Números de puerto permitidos en la parametrización (UDT 65): de 2000 hasta 5000
– En parametrizaciones sin un número de puerto predeterminado, el sistema operativo
asigna un puerto del rango numérico dinámico comprendido entre 49152 y 65534.
● Para CPU 31x-2 PN/DP a partir de la versión de firmware V2.7 y CPU 41x-3 PN/DP a partir
de la versión de firmware V5.2:
– Números de puerto permitidos en la parametrización (UDT 65): 1 a 49151
Se recomienda limitarse a los números de puerto 2000 a 5000, ya que Siemens se
reserva utilizar en el sistema puertos del rango numérico de 1 hasta 1999 y 5001 hasta
49151.
– En parametrizaciones sin un número de puerto predeterminado, el sistema operativo
asigna un puerto del rango numérico dinámico comprendido entre 49152 y 65534.
● Para CPU 31x-2 PN/DP a partir de la versión de firmware V3.2 y CPU 41x-3 PN/DP a partir
de la versión de firmware V6.0 y CPU 41x-5 PN/DP a partir de la versión de firmware V6.0:
– Es posible utilizar un puerto más de una vez.
Los números de puerto reservados para el sistema se indican en la siguiente lista:
Protocolo

Número de puerto

Servicio

-

0

(Este puerto tiene una asignación fija. No pue‐
de utilizarse.)

TCP

20 y 21

FTP

TCP

25

SMTP

TCP

80

HTTP

TCP

102

RFC 1006

UDP

135

RPC-DCOM

UDP

161

SNMP REQUEST

TCP, UDP

34962

PNIO

TCP, UDP

34963

PNIO

TCP, UDP

34964

PNIO

UDP

65532

NTP

UDP

65533

NTP

UDP

65534

NTP

UDP

65535

NTP

Programación del PLC
Manual de programación y manejo, 11/2019

6891

Instrucciones
4.2 Instrucciones
Para más detalles, consulte también http://www.iana.org/assignments/port-numbers.
Nota
No utilice números de puerto reservados para el sistema.
No se pueden utilizar números de puerto idénticos para el establecimiento de llamada activo
y pasivo en un dispositivo.

Parametrización de las conexiones de comunicación en TCP e ISO on TCP
Bloque de datos para la parametrización de conexiones
Para parametrizar las conexiones en TCP e ISO on TCP se debe crear un DB que contenga
la estructura de datos de UDT 65 "TCON_PAR". Esta estructura de datos contiene los
parámetros necesarios que se requieren para establecer la conexión. Para cada una de las
conexiones se necesita una estructura de datos que se pueda agrupar en un DB global.
El parámetro de conexión CONNECT de la instrucción "TCON (Página 6910)" contiene una
referencia a la dirección de la correspondiente descripción de conexión (p. ej.
P#DB100.DBX0.0 byte 64).

Estructura de la descripción de la conexión (UDT 65)
Byte

Parámetro

Tipo de da‐
tos

Valor de
arranque

Descripción

de 0 a 1

block_length

WORD

W#16#40

Longitud del UDT 65: 64 bytes (fija)

de 2 a 3

id

WORD

W#16#0001

Referencia a esta conexión (rango de valores:
W#16#0001 a W#16#0FFF)
El valor de este parámetro se tiene que indicar en el
bloque respectivo en ID.

4

connection_type

BYTE

B#16#11

Variante de protocolo:
● B#16#11: TCP
● B#16#12: ISO on TCP
● B#16#01: TCP (modo de compatibilidad)

5

active_est

BOOL

FALSE

Identificador del tipo de establecimiento de conexión:
● FALSE: establecimiento pasivo de la conexión
● TRUE: establecimiento activo de la conexión

6892

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Byte

Parámetro

Tipo de da‐
tos

Valor de
arranque

Descripción

6

local_device_id

BYTE

B#16#02

● B#16#00: comunicación a través del CP 443-1EX
(solo en S7-400 y connection_type = B#16#12) CP
admisibles: CP443-1EX4x, CP443-1EX20,
CP443-1GX20, CP443-1EX30, CP443-1GX30
● B#16#01: comunicación a través de la interfaz IE en
slot para interfaz 1 (IF1) con WinAC RTX (sólo TCP)
● B#16#02: comunicación a través de la interfaz IE
integrada en las CPUs 315-2 PN/DP y 317-2 PN/DP
● B#16#03: comunicación a través de la interfaz IE
integrada en la CPU 319-3 PN/DP
● B#16#05: comunicación a través de la interfaz IE
integrada en las CPU 414-3 PN/DP, 416-3 PN/DP,
416-3F PN/DP y 41x-5H PN/DP (rack 0)
● B#16#06: comunicación a través de la interfaz IE en
slot para interfaz 2 (IF2) con WinAC RTX (sólo TCP)
● B#16#0B: comunicación a través de la interfaz IE en
slot para interfaz 3 (IF3) con WinAC RTX (sólo TCP)
● B#16#0F: comunicación a través de la interfaz IE en
slot para interfaz 4 (IF4) con WinAC RTX (sólo TCP)
● B#16#15: comunicación a través de la interfaz IE
integrada en las CPU 41x-5H PN/DP (rack 1)

7

local_tsap_id_len

BYTE

B#16#02

Longitud utilizada del parámetro local_tsap_id; valores
posibles:
● 0 ó 2, si connection_type = B#16#01
(lado activo: 0, lado pasivo: 2)
● 0 ó 2, si connection_type = B#16#11
(lado activo: 0 ó 2, lado pasivo: 2)
● de 2 a 16, si connection_type = B#16#12

8

rem_subnet_id_len

BYTE

B#16#00

Este parámetro no se utiliza actualmente. Se le debe
asignar el valor B#16#00.

9

rem_staddr_len

BYTE

B#16#00

Longitud de la dirección del punto final de conexión re‐
moto:
● 0: Sin especificar, es decir, el parámetro rem_staddr
es irrelevante.
● 4: Dirección IP válida en el parámetro rem_staddr

10

rem_tsap_id_len

BYTE

B#16#00

Longitud utilizada del parámetro rem_tsap_id; valores
posibles:
● 0 ó 2, si connection_type = B#16#01
Para el lado pasivo sólo se admite el valor B#16#00.
● 0 ó 2, si connection_type = B#16#11
● 0 ó 2 a 16, si connection_type = B#16#12
(lado activo: 2 a 16; lado pasivo: 0 ó 2 a 16, 0
significa no especificado)

11

next_staddr_len

BYTE

Programación del PLC
Manual de programación y manejo, 11/2019

B#16#00

longitud utilizada del parámetro next_staddr (relevante
solo con ISO on TCP)

6893

Instrucciones
4.2 Instrucciones
Byte

Parámetro

Tipo de da‐
tos

Valor de
arranque

Descripción

de 12 a 27

local_tsap_id

ARRAY
[1..16] of
BYTE

B#16#07
B#16#D0
B#16#00 ...

con connection_type =
● B#16#11: n.º de puerto local (valores posibles
véase: Funcionamiento de las instrucciones para
Open User Communication vía Industrial Ethernet
(Página 6888)),
local_tsap_id[1] = byte alto del n.º de puerto en
representación hexadecimal,
local_tsap_id[2] = byte bajo del n.º de puerto en
representación hexadecimal,
local_tsap_id[3-16] = B#16#00.
● B#16#12: ID TSAP local:
Véase abajo.
● B#16#01: n.º de puerto local (valores posibles
véase: Funcionamiento de las instrucciones para
Open User Communication vía Industrial Ethernet
(Página 6888)),
local_tsap_id[1] = byte bajo del n.º de puerto en
representación hexadecimal,
local_tsap_id[2] = byte alto del n.º de puerto en
representación hexadecimal,
local_tsap_id[3-16] = B#16#00
Nota: Si existen varias conexiones con el mismo inter‐
locutor, hay que asegurarse de que cada uno de los
valores utilizados de local_tsap_id sea unívoco en la
CPU.

de 28 a 33

rem_subnet_id

ARRAY
[1..6] of
BYTE

B#16#00 ...

Este parámetro no se utiliza actualmente. Debe asig‐
nársele el valor 0.

de 34 a 39

rem_staddr

ARRAY
[1..6] of
BYTE

B#16#00 ...

Dirección IP del punto final remoto de la conexión, p. ej.
192.168.0.1:
con connection_type =
● B#16#1x:
rem_staddr[1] = B#16#C0 (192),
rem_staddr[2] = B#16#A8 (168),
rem_staddr[3] = B#16#00 (0),
rem_staddr[4] = B#16#01 (1),
rem_staddr[5-6]= B#16#00 (reservado)
● B#16#01:
rem_staddr[1] = B#16#01 (1),
rem_staddr[2] = B#16#00 (0),
rem_staddr[3] = B#16#A8 (168),
rem_staddr[4] = B#16#C0 (192),
rem_staddr[5-6]= B#16#00 (reservado)

6894

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Byte

Parámetro

Tipo de da‐
tos

Valor de
arranque

Descripción

de 40 a 55

rem_tsap_id

ARRAY
[1..16] of
BYTE

B#16#00 ...

con connection_type =
● B#16#11: n.º de puerto remoto (valores posibles
véase: Funcionamiento de las instrucciones para
Open User Communication vía Industrial Ethernet
(Página 6888)),
rem_tsap_id[1] = byte alto del n.º de puerto en
representación hexadecimal,
rem_tsap_id[2] = byte bajo del n.º de puerto en
representación hexadecimal,
rem_tsap_id[3-16] = B#16#00
● B#16#12: ID TSAP remota:
Véase abajo.
● B#16#01: n.º de puerto remoto (valores posibles
véase: Funcionamiento de las instrucciones para
Open User Communication vía Industrial Ethernet
(Página 6888)),
local_tsap_id[1] = byte bajo del n.º de puerto en
representación hexadecimal,
local_tsap_id[2] = byte alto del n.º de puerto en
representación hexadecimal,
local_tsap_id[3-16] = B#16#00

de 56 a 61

next_staddr

ARRAY
[1..6] of
BYTE

B#16#00 ...

con local_device_id =
● B#16#00:
next_staddr[1]: rack y slot del correspondiente CP
(local) (bits 0 a 4: slot, bits 5 a 7: número de rack)
next_staddr[2-6]: B#16#00
● B#16#02, B#16#03, B#16#05:
next_staddr[1-6]: B#16#00
● B#16#01, B#16#06, B#16#0B, B#16#0F:
next_staddr[1-6]: B#16#00 (en este caso,
next_staddr_len=B#16#00)

de 62 a 63

spare

WORD

W#16#0000

Reserva. Asigne a este parámetro el valor "0".

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Programación del PLC
Manual de programación y manejo, 11/2019

6895

Instrucciones
4.2 Instrucciones

Longitud y estructura del ID TSAP local y remoto en ISO on TCP
● Establecimiento activo de la conexión:
– ID TSAP remota:
todas las secuencias de caracteres con una longitud entre 1 y 16 bytes están permitidas.
Cada carácter puede tener un valor entre B#16#00 y B#16#FF.
– ID TSAP local:
en una interfaz IE integrada están permitidas todas las secuencias de caracteres con
una longitud entre 1 y 16 bytes. Cada carácter puede tener un valor entre B#16#00 y
B#16#FF.
● Establecimiento pasivo de la conexión:
– ID TSAP remota:
todas las secuencias de caracteres con una longitud entre 0 y 16 bytes están permitidas.
Cada carácter puede tener un valor entre B#16#00 y B#16#FF.
– ID TSAP local:
loc_tsap_id_len

local_tsap_id[1]

local_tsap_id[2]

local_tsap_id[3 bis 16]

2

B#16#E0 (tipo de cone‐
xión "conexión T")

0 (sólo en interfaz IE inte‐
grada) o rack y slot de la
propia CPU (slot bits 0 a 4,
número de rack bits 5 a 7)

No existe

>2

B#16#E0 (tipo de cone‐
xión "conexión T")

0 (sólo en interfaz IE inte‐
grada) o rack y slot de la
propia CPU (slot bits 0 a 4,
número de rack bits 5 a 7)

Extensión TSAP

Sólo en interfaz IE integra‐ Irrelevante
da: Un carácter ASCII
(B#16#20 a B#16#7E)

Extensión TSAP

Dependencia de la CPU de las variantes de protocolo TCP e ISO on TCP
En el párrafo siguiente se indica cuál de las dos variantes de protocolo TCP e ISP on TOP se
puede utilizar en qué CPU:
Relación entre la CPU utilizada, la variante de protocolo (connection_type) y la longitud de
datos transferible (Página 6900).
El número de conexiones posibles se indica en los datos técnicos de la CPU.

Establecimiento de la conexión
Un interlocutor A debe iniciar el establecimiento activo de la conexión. Un interlocutor B debe
iniciar el establecimiento pasivo de la conexión. Cuando ambos interlocutores han lanzado su
establecimiento de conexión, el sistema operativo puede establecer por completo la conexión.
En la parametrización se determina el interlocutor que activa el establecimiento de la conexión
y el que responde a la petición del interlocutor estableciendo una conexión pasiva.
En UDP, ambos interlocutores tienen que iniciar el establecimiento pasivo.

6896

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parametrización del punto de acceso local de comunicación en UDP
Estructura de datos para la parametrización del punto de acceso local de comunicación
Para parametrizar el punto de acceso local de comunicación se debe crear un DB que
contenga la estructura de datos de UDT 65 "TCON_PAR". Esta estructura de datos contiene
los parámetros necesarios para establecer la conexión entre el programa de usuario y el nivel
de comunicación del sistema operativo.
El parámetro CONNECT de la instrucción "TCON (Página 6910)" contiene una referencia a la
dirección de la correspondiente descripción de la conexión (p. ej. P#DB100.DBX0.0 byte 64).

Estructura de la descripción de la conexión en UDP (UDT 65)
Byte

Parámetro

Tipo de da‐
tos

Valor inicial

Descripción

de 0 a 1

block_length

WORD

W#16#40

Longitud del UDT 65: 64 bytes (fija)

de 2 a 3

id

WORD

W#16#0001

Referencia a esta conexión entre el programa de usuario y
el nivel de comunicación del sistema operativo (rango de
valores: W#16#0001 a W#16#0FFF)
El valor de este parámetro se tiene que indicar en el bloque
respectivo en ID.

4

connection_type

BYTE

B#16#13

Variante de protocolo:

5

active_est

BOOL

FALSE

Identificador del tipo de establecimiento de conexión: A
este parámetro debe asignársele el valor FALSE.

6

local_device_id

BYTE

B#16#02

● B#16#01: comunicación a través de la interfaz IE en
slot para interfaz 1 (IF1) con WinAC RTX

● B#16#13: UDP

● B#16#02: comunicación a través de la interfaz IE
integrada en la CPU 317-2 PN/DP
● B#16#03: comunicación a través de la interfaz IE
integrada en la CPU 319-3 PN/DP
● B#16#05: comunicación a través de la interfaz IE
integrada en las CPU 414-3 PN/DP, 416-3 PN/DP,
416-3F PN/DP y 41x-5H PN/DP (rack 0)
● B#16#06: comunicación a través de la interfaz IE en
slot para interfaz 2 (IF2) con WinAC RTX
● B#16#0B: comunicación a través de la interfaz IE en
slot para interfaz 3 (IF3) con WinAC RTX
● B#16#0F: comunicación a través de la interfaz IE en
slot para interfaz 4 (IF4) con WinAC RTX
● B#16#15: comunicación a través de la interfaz IE
integrada en las CPU 41x-5H PN/DP (rack 1)
7

local_tsap_id_len

BYTE

B#16#02

Longitud utilizada del parámetro local local_tsap_id (puer‐
to local); 2 bytes

8

rem_subnet_id_len

BYTE

B#16#00

Este parámetro no se utiliza. Se le debe asignar el valor
B#16#00.

Programación del PLC
Manual de programación y manejo, 11/2019

6897

Instrucciones
4.2 Instrucciones
Byte

Parámetro

Tipo de da‐
tos

Valor inicial

Descripción

9

rem_staddr_len

BYTE

B#16#00

Este parámetro no se utiliza. Se le debe asignar el valor
B#16#00.

10

rem_tsap_id_len

BYTE

B#16#00

Este parámetro no se utiliza. Se le debe asignar el valor
B#16#00.

11

next_staddr_len

BYTE

B#16#00

Este parámetro no se utiliza. Se le debe asignar el valor
B#16#00.

de 12 a
27

local_tsap_id

ARRAY
[1..16] of
BYTE

B#16#07
B#16#D0
B#16#00 ...

N.º de puerto local (valores posibles véase: Funcionamien‐
to de las instrucciones para Open User Communication vía
Industrial Ethernet (Página 6888)),
local_tsap_id[1] = byte alto del n.º de puerto en represen‐
tación hexadecimal,
local_tsap_id[2] = byte bajo del n.º de puerto en represen‐
tación hexadecimal,
local_tsap_id[3-16] = B#16#00 (reservado)
Nota: Asegúrese de que todos los valores de local_tsap_id
que utiliza en la CPU sean unívocos.

de 28 a
33

rem_subnet_id

ARRAY
[1..6] of
BYTE

B#16#00 ...

Este parámetro no se utiliza. Debe asignársele el valor "0".

de 34 a
39

rem_staddr

ARRAY
[1..6] of
BYTE

B#16#00 ...

Este parámetro no se utiliza. Debe asignársele el valor "0".

de 40 a
55

rem_tsap_id

ARRAY
[1..16] of
BYTE

B#16#00 ...

Este parámetro no se utiliza. Debe asignársele el valor "0".

de 56 a
61

next_staddr

ARRAY
[1..6] of
BYTE

B#16#00 ...

Este parámetro no se utiliza. Debe asignársele el valor "0".

de 62 a
63

spare

WORD

W#16#0000

Reserva. Asigne a este parámetro el valor "0".

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Dependencia de la CPU de la variante de protocolo UDP
En el párrafo siguiente se indica en qué CPU se puede utilizar la variante de protocolo UDP:
Relación entre la CPU utilizada, la variante de protocolo (connection_type) y la longitud de
datos transferible (Página 6900)
El número de conexiones posibles entre el programa de usuario y el nivel de comunicación del
sistema operativo se indica en los datos técnicos de la CPU.

Configuración del punto de acceso local de comunicación
Todos los interlocutores tienen que configurar su punto de acceso local de comunicación
independientemente del otro, es decir, establecer la conexión entre el programa de usuario y
el nivel de comunicación del sistema operativo.

6898

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En UDP, ambos interlocutores tienen que iniciar el establecimiento pasivo.

Estructura de la información de dirección del interlocutor remoto en UDP
Vista general
● En "TUSEND (Página 6922)", en el parámetro ADDR se transfiere la información de
dirección del receptor. La información de dirección tiene que tener la estructura indicada a
continuación.
● En "TURCV (Página 6918)" se recibe la dirección del remitente de los datos recibidos en el
parámetro ADDR. La información de dirección tiene que tener la estructura indicada a
continuación.

Bloque de datos para la información de dirección del interlocutor remoto
Se tiene que crear un DB que contenga una o más estructuras de datos según UDT 66
"TADDR_PAR".
En el parámetro ADDR de "TUSEND (Página 6922)" se transfiere un puntero hacia la dirección
del interlocutor remoto correspondiente (p. ej.P#DB100.DBX0.0 byte 8) y en el parámetro
ADDR de TURCV (Página 6918) se recibe dicho puntero.

Estructura de la información de dirección del interlocutor remoto (UDT 66)
Byte

Parámetro

de 0 a 3 rem_ip_addr

Tipo de datos

Valor inicial

Descripción

ARRAY [1..4] of BYTE

B#16#00 ...

Dirección IP del interlocutor remoto, p. ej. 192.168.2.3:
● rem_ip_addr[1] = B#16#C0 (192)
● rem_ip_addr[2] = B#16#A8 (168)
● rem_ip_addr[3] = B#16#02 (2)
● rem_ip_addr[4] = B#16#03 (3)

4a5

rem_port_nr

ARRAY [1..2] of BYTE

B#16#00 ...

N.º de puerto remoto (valores posibles véase: Funcio‐
namiento de las instrucciones para Open User Commu‐
nication vía Industrial Ethernet (Página 6888))
● rem_port_nr[1] = byte alto del n.º de puerto en
representación hexadecimal
● rem_port_nr[2] = byte bajo del n.º de puerto en
representación hexadecimal

6a7

spare

ARRAY [1..2] of BYTE

Programación del PLC
Manual de programación y manejo, 11/2019

B#16#00 ...

Reserva. Asigne a este parámetro el valor "0".

6899

Instrucciones
4.2 Instrucciones

Relación entre la CPU utilizada, la variante de protocolo (connection_type) y la longitud de datos
transferible
Relación entre la CPU utilizada, la variante de protocolo (connection_type) y la longitud de datos
transferible
En la siguiente tabla se describe, qué variante se utiliza en qué CPU y cuáles son las longitudes
de datos que se pueden transferir
Variante de proto‐
colo

Parámetro "con‐
nection _type" en
UDT 65

CPU

Longitud de datos en
Longitud de datos
bytes en la comunica‐
en bytes en la co‐
ción vía interfaz integra‐ municación vía CP
da IE

TCP

B#16#11

CPUs 31x-2 PN/DP a partir de la
versión de firmware V2.4

de 1 a 8192

CPUs 31x-2 PN/DP a partir de la
versión de firmware V3.1

de 1 a 32767

CPUs 31x-3 PN/DP a partir de la
versión de firmware V3.2

de 1 a 32767

CPU 41x-3 PN/DP

de 1 a 32767

-

ISO on TCP

UDP

-

CPU 41x-5H PN/DP

de 1 a 32767

-

B#16#01

CPUs 31x-2 PN/DP

de 1 a 1472

-

B#16#12

CPUs 31x-2 PN/DP a partir de la
versión de firmware V2.4

de 1 a 8192

-

CPUs 31x-2 PN/DP a partir de la
versión de firmware V3.1

de 1 a 32767

CPUs 31x-3 PN/DP a partir de la
versión de firmware V3.2

de 1 a 32767

CPUs 41x a partir de la versión
de firmware V4.1 (sin CPUs
41x-4H)

-

de 1 a 1452

CPU 41x-3 PN/DP

de 1 a 32767

de 1 a 1452

CPU 41x-5H PN/DP

de 1 a 32767

de 1 a 1452

CPU 31x-2 PN/DP a partir de la
versión de firmware V2.4, CPU
41x-3 PN/DP y 41x-5H PN/DP

de 1 a 1472

-

B#16#13

Ejemplos de parametrización de las conexiones de comunicación
Ejemplo 1: Comunicación vía ISO on TCP y CP 443-1 entre dos CPUs S7-400
Los dos interlocutores son dos CPUs 414-2. La comunicación se lleva a cabo a través de dos
CPs 443-1.

6900

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La siguiente tabla muestra los datos más importantes de los dos interlocutores:
Propiedad

Interlocutor A:
CPU 414-2 con CP 443-1

Interlocutor B:
CPU 414-2 con CP 443-1

Establecimiento de la conexión

Activo

Pasivo

Dirección IP

192.168.4.14

192.168.4.16

Dirección física de la CPU

Rack 0, slot 3

Rack 0, slot 4

Dirección física del CP correspondiente

Rack 0, slot 6

Rack 1, slot 8

ID TSAP local (nota: Para diferenciar la co‐
nexión, la codificación del TSAP real se lleva
a cabo a partir del tercer byte).

0xE0 03 54 43 50 2D 31

0xE0 04 54 43 50 2D 31

La siguiente tabla muestra las entradas de parámetros en el DB relevantes para que el
interlocutor A establezca la conexión de forma activa:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

id

WORD

W#16#0414

Referencia a esta conexión

connection_type

BYTE

B#16#12

Variante de protocolo: ISO on TCP

active_est

BOOL

TRUE

Establecimiento activo de la conexión

local_device_id

BYTE

B#16#00

Comunicación interna del AS vía CP

local_tsap_id_len

BYTE

B#16#07

Longitud utilizada del parámetro lo‐
cal_tsap_id

rem_staddr_len

BYTE

B#16#04

Longitud de la dirección del punto final de
conexión remoto:
● 4: dirección IP válida en el parámetro
rem_staddr

rem_tsap_id_len

BYTE

B#16#07

Longitud utilizada del parámetro
rem_tsap_id

next_staddr_len

BYTE

B#16#01

Longitud utilizada del parámetro
next_staddr

local_tsap_id

ARRAY
[1..16] of
BYTE

● local_tsap_id[1] = B#16#E0

ID TSAP local: 0xE0035443502D31

● local_tsap_id[2] = B#16#03
● local_tsap_id[3] = B#16#54
(equivalente ASCII de "T")
● local_tsap_id[4] = B#16#43
(equivalente ASCII de "C")
● local_tsap_id[5] =
B#16#50(equivalente ASCII de "P")
● local_tsap_id[6] =
B#16#2D(equivalente ASCII de "-")
● local_tsap_id[7] =
B#16#31(equivalente ASCII de "1")
● local_tsap_id[8-16] = B#16#00

Programación del PLC
Manual de programación y manejo, 11/2019

6901

Instrucciones
4.2 Instrucciones
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

rem_staddr

ARRAY
[1..6] of
BYTE

"192.168.4.16"

Dirección IP del punto final de conexión re‐
moto

● rem_staddr[1] = B#16#C0 (192)
● rem_staddr[2] = B#16#A8 (168)
● rem_staddr[3] = B#16#04 (4)
● rem_staddr[4] = B#16#10 (16)
● rem_staddr[5-6] = B#16#00

rem_tsap_id

ARRAY
[1..16] of
BYTE

● rem_tsap_id[1] = B#16#E0

ID TSAP remota: 0xE0045443502D31

● rem_tsap_id[2] = B#16#04
● rem_tsap_id[3] = B#16#54
(equivalente ASCII de "T")
● rem_tsap_id[4] = B#16#43
(equivalente ASCII de "C")
● rem_tsap_id[5] = B#16#50
(equivalente ASCII de "P")
● rem_tsap_id[6] = B#16#2D
(equivalente ASCII de "-")
● rem_tsap_id[7] = B#16#31
(equivalente ASCII de "1")
● rem_tsap_id[8-16] = B#16#00

next_staddr

ARRAY
[1..6] of
BYTE

● next_staddr[1] = B#16#06
● next_staddr[2-6] = B#16#00

Rack = 0, slot = 6
(bits 7 a 5: N.° de rack, bits de 4 a 0: N.º de
slot)

La siguiente tabla muestra las entradas de parámetros en el DB relevantes para que el
interlocutor B establezca la conexión de forma pasiva:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

id

WORD

W#16#0416

Referencia a esta conexión

connection_type

BYTE

B#16#12

Variante de protocolo: ISO on TCP

active_est

BOOL

FALSE

Establecimiento pasivo de la conexión

local_device_id

BYTE

B#16#00

Comunicación interna del AS vía CP

local_tsap_id_len

BYTE

B#16#07

Longitud utilizada del parámetro lo‐
cal_tsap_id

rem_staddr_len

BYTE

B#16#04

Longitud de la dirección del punto final de
conexión remoto:
● 4: dirección IP válida en el parámetro
rem_staddr

rem_tsap_id_len

BYTE

B#16#07

Longitud utilizada del parámetro
rem_tsap_id

next_staddr_len

BYTE

B#16#01

Longitud utilizada del parámetro
next_staddr

6902

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

local_tsap_id

ARRAY
[1..16] of
BYTE

● local_tsap_id[1] = B#16#E0

ID TSAP local: 0xE0045443502D31

● local_tsap_id[2] = B#16#04
● local_tsap_id[3] = B#16#54
(equivalente ASCII de "T")
● local_tsap_id[4] = B#16#43
(equivalente ASCII de "C")
● local_tsap_id[5] = B#16#50
(equivalente ASCII de "P")
● local_tsap_id[6] =
B#16#2D(equivalente ASCII de "-")
● local_tsap_id[7] = B#16#31
(equivalente ASCII de "1")
● local_tsap_id[8-16] = B#16#00

rem_staddr

ARRAY
[1..6] of
BYTE

"192.168.4.14"
● rem_staddr[1] = B#16#C0 (192)

Dirección IP del punto final de conexión re‐
moto

● rem_staddr[2] = B#16#A8 (168)
● rem_staddr[3] = B#16#04 (4)
● rem_staddr[4] = B#16#0E (14)
● rem_staddr[5-6] = B#16#00

rem_tsap_id

ARRAY
[1..16] of
BYTE

● rem_tsap_id[1] = B#16#E0

ID TSAP remota: 0xE0035443502D31

● rem_tsap_id[2] = B#16#03
● rem_tsap_id[3] = B#16#54
(equivalente ASCII de "T")
● rem_tsap_id[4] = B#16#43
(equivalente ASCII de "C")
● rem_tsap_id[5] = B#16#50
(equivalente ASCII de "P")
● rem_tsap_id[6] = B#16#2D
(equivalente ASCII de "-")
● rem_tsap_id[7] = B#16#31
(equivalente ASCII de "1")
● rem_tsap_id[8-16] = B#16#00

next_staddr

ARRAY
[1..6] of
BYTE

● next_staddr[1] = B#16#28
● next_staddr[2-6] = B#16#00

Programación del PLC
Manual de programación y manejo, 11/2019

Rack = 1, slot = 8
(bits 7 a 5: N.° de rack, bits de 4 a 0: N.º de
slot)

6903

Instrucciones
4.2 Instrucciones

Ejemplo 2: Comunicación vía TCP e interfaces PROFINET integradas entre una CPU S7-400 y una
CPU S7-300
Un interlocutor es una CPU 416-3 PN/DP y el otro es una CPU 319-3 PN/DP. La siguiente tabla
muestra los datos más importantes de los dos interlocutores:
Propiedad

Interlocutor A:
CPU 416-3 PN/DP

Interlocutor B:
CPU 319-3 PN/DP

Establecimiento de la conexión

Activo

Pasivo

Dirección IP

192.168.3.142

192.168.3.125

N.º de puerto local

Irrelevante

2005

La siguiente tabla muestra las entradas de parámetros en el DB relevantes para que el
interlocutor A establezca la conexión de forma activa:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

id

WORD

W#16#0014

Referencia a esta conexión

connection_type

BYTE

B#16#11

Variante de protocolo: TCP

active_est

BOOL

TRUE

Establecimiento activo de la conexión

local_device_id

BYTE

B#16#05

Comunicación vía interfaz Ethernet integra‐
da en CPUs S7-400

local_tsap_id_len

BYTE

B#16#00 (sólo es posible este valor)

El parámetro local_tsap_id no se utiliza

rem_staddr_len

BYTE

B#16#04

Longitud de la dirección del punto final de
conexión remoto:
● 4: Dirección IP válida en el parámetro
rem_staddr

rem_tsap_id_len

BYTE

B#16#02 (sólo es posible este valor)

Longitud utilizada del parámetro
rem_tsap_id

rem_staddr

ARRAY
[1..6] of
BYTE

"192.168.3.125"

Dirección IP del punto final de conexión re‐
moto

● rem_staddr[1] = B#16#C0 (192)
● rem_staddr[2] = B#16#A8 (168)
● rem_staddr[3] = B#16#03 (3)
● rem_staddr[4] = B#16#7D (125)
● rem_staddr[5-6] = B#16#00

rem_tsap_id

ARRAY
[1..16] of
BYTE

"2005"

N.º de puerto remoto: 2005 = W#16#07D5

● rem_tsap_id[1] = B#16#07
● rem_tsap_id[2] = B#16#D5
● rem_tsap_id[3-16] = B#16#00

6904

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La siguiente tabla muestra las entradas de parámetros en el DB relevantes para que el
interlocutor B establezca la conexión de forma pasiva:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

id

WORD

W#16#000F

Referencia a esta conexión

connection_type

BYTE

B#16#11

Variante de protocolo: TCP

active_est

BOOL

FALSE

Establecimiento pasivo de la conexión

local_device_id

BYTE

B#16#03

Comunicación a través de la interfaz Ether‐
net integrada en la CPU 319-3 PN/DP

local_tsap_id_len

BYTE

B#16#02 (sólo es posible este valor)

Longitud utilizada del parámetro lo‐
cal_tsap_id

rem_staddr_len

BYTE

B#16#04

Longitud de la dirección del punto final de
conexión remoto:
● 4: dirección IP válida en el parámetro
rem_staddr

rem_tsap_id_len

BYTE

B#16#00 (sólo es posible este valor)

Longitud utilizada del parámetro
rem_tsap_id

local_tsap_id

ARRAY
[1..16] of
BYTE

"2005"

N.º de puerto local: 2005 = W#16#07D5

● local_tsap_id[1] = B#16#07
● local_tsap_id[2] = B#16#D5
● local_tsap_id[3-16] = B#16#00

rem_staddr

ARRAY
[1..6] of
BYTE

"192.168.3.142"
● rem_staddr[1] = B#16#C0 (192)

Dirección IP del punto final de conexión re‐
moto

● rem_staddr[2] = B#16#A8 (168)
● rem_staddr[3] = B#16#03 (3)
● rem_staddr[4] = B#16#8E (142)
● rem_staddr[5-6] = B#16#00

Ejemplo 3: Comunicación vía UDP e interfaces PROFINET integradas entre una CPU S7-300 y una
CPU S7-400
Un interlocutor es una CPU 319-3 PN/DP y el otro es una CPU 414-3 PN/DP. La siguiente tabla
muestra los datos más importantes de los dos interlocutores:
Propiedad

Interlocutor A:
CPU 319-3 PN/DP

Interlocutor B:
CPU 414-3 PN/DP

Emisor/receptor

Emisor

Receptor

Dirección IP

192.168.3.142

192.168.3.125

N.º de puerto local

2004

2005

Programación del PLC
Manual de programación y manejo, 11/2019

6905

Instrucciones
4.2 Instrucciones
La siguiente tabla muestra las entrada en el DB relevantes para el emisor (interlocutor A) a la
hora de parametrizar el punto de acceso de comunicación local:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

id

WORD

W#16#0014

Referencia a esta conexión entre el progra‐
ma de usuario y el nivel de comunicación
del sistema operativo

connection_type

BYTE

B#16#13

Variante de protocolo: UDP

active_est

BOOL

FALSE

Sólo este valor es posible en la variante de
protocolo UDP.

local_device_id

BYTE

B#16#03

Comunicación a través de la interfaz Ether‐
net integrada en la CPU 319-3 PN/DP

local_tsap_id_len

BYTE

B#16#02

Longitud utilizada del parámetro lo‐
cal_tsap_id

local_tsap_id

ARRAY
[1..16] of
BYTE

● local_tsap_id[1] = B#16#07

N.º de puerto local: 2004 = W#16#07D4

● local_tsap_id[2] = B#16#D4
● local_tsap_id[3-16] = B#16#00

La siguiente tabla muestra las entrada en el DB relevantes para el receptor (interlocutor B) a
la hora de parametrizar el punto de acceso de comunicación local:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

id

WORD

W#16#000F

Referencia a esta conexión entre el progra‐
ma de usuario y el nivel de comunicación
del sistema operativo

connection_type

BYTE

B#16#13

Variante de protocolo: UDP

active_est

BOOL

FALSE

Sólo este valor es posible en la variante de
protocolo UDP.

local_device_id

BYTE

B#16#05

Comunicación vía interfaz Ethernet integra‐
da en CPUs S7-400

local_tsap_id_len

BYTE

B#16#02

Longitud utilizada del parámetro lo‐
cal_tsap_id

local_tsap_id

ARRAY
[1..16] of
BYTE

● local_tsap_id[1] = B#16#07

N.º de puerto local: 2005 = W#16#07D5

6906

● local_tsap_id[2] = B#16#D5
● local_tsap_id[3-16] = B#16#00

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Al llamar "TUSEND (Página 6922)" en el emisor, se transfieren en un DB los siguientes
parámetros de dirección del receptor:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

rem_ip_addr

ARRAY
[1..4] of
BYTE

● rem_ip_addr[1] = B#16#C0 (192)

Dirección IP del receptor: 192.168.3.125

● rem_ip_addr[2] = B#16#A8 (168)
● rem_ip_addr[3] = B#16#3 (3)
● rem_ip_addr[4] = B#16#7D (125)

rem_port_nr

ARRAY
[1..2] of
BYTE

● rem_port_nr[1] = B#16#07
● rem_port_nr[2] = B#16#D5

N.° de puerto del receptor: 2005 =
W#16#07D5

Al llamar "TURCV (Página 6925)" en el receptor, se reciben en un DB los siguientes
parámetros de dirección del emisor:
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

rem_ip_addr

ARRAY
[1..4] of
BYTE

● rem_ip_addr[1] = B#16#C0 (192)

Dirección IP del emisor: 192.168.3.142

● rem_ip_addr[2] = B#16#A8 (168)
● rem_ip_addr[3] = B#16#3 (3)
● rem_ip_addr[4] = B#16#8E (142)

rem_port_nr

ARRAY
[1..2] of
BYTE

● rem_port_nr[1] = B#16#07
● rem_port_nr[2] = B#16#D4

N.° de puerto del emisor: 2004 =
W#16#07D4

Ejemplo 4: Comunicación vía ISO on TCP e interfaces PROFINET integradas entre dos CPUs S7-400
Un interlocutor es una CPU 414-3 PN/DP a partir de la versión de firmware V5.0 y el otro es una
CPU 416-3 PN/DP con versión de firmware V5.0. La comunicación se lleva a cabo a través de
las interfaces PROFINET integradas.
La siguiente tabla muestra los datos más importantes de los dos interlocutores.
Propiedad

Interlocutor A:
CPU 414-3 PN/DP

Interlocutor B:
CPU 416-3 PN/DP

Emisor/receptor

Emisor

Receptor

Establecimiento de la conexión

Pasivo

Activo

Dirección IP

192.168.0.14

192.168.0.16

La siguiente tabla muestra todas las entradas de parámetros del interlocutor A en el DB
correspondiente.
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

block_length

WORD

W#16#40

Longitud del UDT 65: 64 bytes (fija)

id

WORD

W#16#0001

Referencia a esta conexión

Programación del PLC
Manual de programación y manejo, 11/2019

6907

Instrucciones
4.2 Instrucciones
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

connection_type

BYTE

B#16#12

Variante de protocolo:
● B#16#12: ISO on TCP

active_est

BOOL

FALSE

Establecimiento pasivo de la conexión

local_device_id

BYTE

B#16#05

Comunicación a través de la interfaz IE in‐
tegrada en las CPUs 41x PN/DP

local_tsap_id_len

BYTE

B#16#03

Longitud utilizada del parámetro lo‐
cal_tsap_id

rem_subnet_id_len

BYTE

B#16#00

Este parámetro no se utiliza. Se le debe
asignar el valor B#16#00.

rem_staddr_len

BYTE

B#16#04

Longitud de la dirección del punto final de
conexión remoto:
● 4: dirección IP válida en el parámetro
rem_staddr

rem_tsap_id_len

BYTE

B#16#03

Longitud utilizada del parámetro
rem_tsap_id

next_staddr_len

BYTE

B#16#00

Este parámetro no se utiliza (debido a la
comunicación vía interfaz integrada). Se le
debe asignar el valor B#16#00 .

local_tsap_id

ARRAY
[1..16] of
BYTE

● local_tsap_id[1] = B#16#E0

ID TSAP local: 0xE00301

● local_tsap_id[2] = B#16#03
● local_tsap_id[3] = B#16#01
● local_tsap_id[4-16] = B#16#00

rem_subnet_id

ARRAY
[1..6] of
BYTE

rem_subnet_id[1-6] = B#16#00

Este parámetro no se utiliza. Debe asignár‐
sele el valor "0".

rem_staddr

ARRAY
[1..6] of
BYTE

"192.168.0.16"

Dirección IP del punto final de conexión re‐
moto

● rem_staddr[1] = B#16#C0 (192)
● rem_staddr[2] = B#16#A8 (168)
● rem_staddr[3] = B#16#00 (0)
● rem_staddr[4] = B#16#10 (16)
● rem_staddr[5-6] = B#16#00

rem_tsap_id

ARRAY
[1..16] of
BYTE

● rem_tsap_id[1] = B#16#E0

ID TSAP remota: 0xE00301

● rem_tsap_id[2] = B#16#03
● rem_tsap_id[3] = B#16#01
● rem_tsap_id[4-16] = B#16#00

next_staddr

ARRAY
[1..6] of
BYTE

next_staddr[1-6] = B#16#00

Este parámetro no se utiliza (debido a la
comunicación vía interfaz integrada).

spare

WORD

W#16#0000

Este parámetro no se utiliza. Debe asignár‐
sele el valor "0".

6908

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La siguiente tabla muestra todas las entradas de parámetros del interlocutor B en el DB
correspondiente.
Parámetro

Tipo de
datos

Valor en el ejemplo

Descripción

block_length

WORD

W#16#40

Longitud del UDT 65: 64 bytes (fija)

id

WORD

W#16#0001

Referencia a esta conexión

connection_type

BYTE

B#16#12

Variante de protocolo:

active_est

BOOL

TRUE

Establecimiento activo de la conexión

local_device_id

BYTE

B#16#05

Comunicación a través de la interfaz IE in‐
tegrada en las CPUs 41x PN/DP

local_tsap_id_len

BYTE

B#16#03

Longitud utilizada del parámetro lo‐
cal_tsap_id

rem_subnet_id_len

BYTE

B#16#00

Este parámetro no se utiliza. Se le debe
asignar el valor B#16#00.

rem_staddr_len

BYTE

B#16#04

Longitud de la dirección del punto final de
conexión remoto:

● B#16#12: ISO on TCP

● 4: dirección IP válida en el parámetro
rem_staddr
rem_tsap_id_len

BYTE

B#16#03

Longitud utilizada del parámetro
rem_tsap_id

next_staddr_len

BYTE

B#16#00

Este parámetro no se utiliza (debido a la
comunicación vía interfaz integrada). Se le
debe asignar el valor B#16#00.

local_tsap_id

ARRAY
[1..16] of
BYTE

● local_tsap_id[1] = B#16#E0

ID TSAP local: 0xE00301

● local_tsap_id[2] = B#16#03
● local_tsap_id[3] = B#16#01
● local_tsap_id[4-16] = B#16#00

rem_subnet_id

ARRAY
[1..6] of
BYTE

rem_subnet_id[1-6] = B#16#00

Este parámetro no se utiliza. Debe asignár‐
sele el valor "0".

rem_staddr

ARRAY
[1..6] of
BYTE

"192.168.0.14"

Dirección IP del punto final de conexión re‐
moto

● rem_staddr[1] = B#16#C0 (192)
● rem_staddr[2] = B#16#A8 (168)
● rem_staddr[3] = B#16#00 (0)
● rem_staddr[4] = B#16#0E (14)
● rem_staddr[5-6] = B#16#00

rem_tsap_id

ARRAY
[1..16] of
BYTE

● rem_tsap_id[1] = B#16#E0

ID TSAP remota: 0xE00301

● rem_tsap_id[2] = B#16#03
● rem_tsap_id[3] = B#16#01
● rem_tsap_id[4-16] = B#16#00

next_staddr

ARRAY
[1..6] of
BYTE

next_staddr[1-6] = B#16#00

Este parámetro no se utiliza (debido a la
comunicación vía interfaz integrada).

spare

WORD

W#16#0000

Este parámetro no se utiliza. Debe asignár‐
sele el valor "0".

Programación del PLC
Manual de programación y manejo, 11/2019

6909

Instrucciones
4.2 Instrucciones

Tipos de datos
Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

TCON: Establecer una conexión
Número de conexiones posibles
El número de conexiones TCP o UDP posibles se indica en los datos técnicos de la CPU.

Conexión vía TCP e ISO on TCP
Ambos interlocutores llaman la instrucción "TCON" para crear y establecer la conexión. En la
parametrización se especifica cuál es el punto final de la comunicación activo y cuál el pasivo.
Una vez creada y establecida la conexión, la CPU la mantiene y la vigila automáticamente.
Si se interrumpe la conexión p. ej. debido a una interrupción de la línea o por el interlocutor
remoto, el interlocutor activo intenta restablecerla. No es preciso volver a llamar "TCON".
Con la llamada de la instrucción "TDISCON" o en el estado operativo STOP de la CPU se
interrumpe una conexión existente y se elimina la conexión creada. Para volver a crear y
establecer la conexión es preciso ejecutar "TCON" de nuevo.

Uso con UDP
Ambos interlocutores llaman la instrucción "TCON" para establecer su punto de acceso local
(puerto local). Se configura una conexión entre el programa de usuario y la capa de
comunicación del sistema operativo. No se establece comunicación con el interlocutor remoto.
El punto de acceso local se utiliza para transmitir y recibir telegramas UDP.
En la parametrización del punto de acceso local (UDT65) o del interlocutor remoto (UDT 66)
deben coincidir los siguientes parámetros.
● Con UDP: Referencia a la conexión y n.º de puerto local.

Funcionamiento
La instrucción "TCON" trabaja de forma asíncrona, de modo que la ejecución de la petición se
prolonga a lo largo de varias llamadas. Para iniciar la petición para la creación y el
establecimiento de la conexión, llame "TCON" con REQ = 1.
El estado de la petición se indica a través de los parámetros de salida BUSY y STATUS.
STATUS corresponde al parámetro de salida RET_VAL de las instrucciones asíncronas.
Consulte también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813).

6910

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En la tabla siguiente se muestra la correspondencia entre BUSY, DONE y ERROR. Le ayudará
a determinar en qué estado se encuentra actualmente "TCON" o cuándo se ha creado o
establecido la conexión (con TCP e ISO on TCP).
BUSY

DONE

ERROR

Descripción

TRUE

Irrelevante

Irrelevante

La petición está en proceso.

FALSE

TRUE

FALSE

La petición ha finalizado correctamente.

FALSE

FALSE

TRUE

La petición se ha finalizado con un error. La causa del error se puede consultar
en el parámetro STATUS.

FALSE

FALSE

FALSE

No se ha asignado ninguna petición (nueva) a la instrucción.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "TCON":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L, T, C

Parámetro de control REQUEST, inicia la pe‐
tición para el establecimiento de la conexión
indicada en ID. La petición se inicia con un
flanco ascendente.

ID

Input

WORD

M, D o constante

Referencia a la conexión que debe establecer‐
se con el interlocutor remoto o bien entre el
programa de usuario y la capa de comunica‐
ción del sistema operativo. ID debe ser idénti‐
ca al respectivo parámetro ID en la descripción
local de la conexión.
Rango de valores: W#16#0001 a W#16#0FFF

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o
todavía se está ejecutando.
● 1: Petición finalizada sin errores

BUSY

Output

BOOL

I, Q, M, D, L

● BUSY = 1: la petición todavía no ha
finalizado.
● BUSY = 0: la petición ha finalizado.

ERROR

Output

BOOL

I, Q, M, D, L

Parámetro de estado ERROR:
● ERROR=1: se ha producido un error
durante la ejecución de la petición.
STATUS devuelve información detallada
sobre el tipo de error

Programación del PLC
Manual de programación y manejo, 11/2019

6911

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

STATUS

Output

WORD

M, D

Parámetro de estado STATUS: Información
de error

CONNECT

InOut

ANY

D

Puntero hacia la descripción de conexión co‐
rrespondiente (UDT 65)
Consulte también:
● Parametrización de las conexiones de
comunicación en TCP e ISO on TCP
(Página 6892)
● Parametrización del punto de acceso local
de comunicación en UDP (Página 6897)
Nota: El parámetro CONNECT se puede indi‐
car de las dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: CONN_DB.Conn1

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(W#16#...)

Explicación

0

0000

Se ha podido establecer la conexión

0

7000

No se está procesando ninguna petición

0

7001

Inicio de la ejecución de la petición, estableciendo conexión

0

7002

Llamada intermedia (REQ irrelevante), estableciendo conexión

1

8086

El parámetro ID se encuentra fuera del rango admisible.

1

8087

Se ha alcanzado el número máximo de conexiones, no es posible establecer más conexiones.

1

8089

El parámetro CONNECT no apunta a un bloque de datos.

1

809A

El parámetro CONNECT apunta a un campo que no tiene la longitud de la descripción de la
conexión (UDT65).

1

809B

El local_device_id indicado en la descripción de la conexión no concuerda con la CPU.

1

80A0

Error de grupo para los códigos de error W#16#80A1 y W#16#80A2

1

80A1

La conexión o el puerto ya están ocupados por el usuario

1

80A2

El puerto local o remoto está ocupado por el sistema

1

80A3

Se está intentando volver a establecer una conexión existente.

1

80A4

La dirección IP del punto final de la conexión no es válida o coincide con la dirección IP propia

1

80A7

Error de comunicación: Tras un "TCON" no finalizado se ha llamado un "TDISCON (Página 6913)".
El establecimiento de la conexión ha sido interrumpido anticipadamente por la llamada de un
"TDISCON (Página 6913)".

1

80B2

El parámetro CONNECT apunta a un bloque de datos generado con la palabra clave UNLINKED.

1

80B3

Parametrización incoherente: Error de grupo para los códigos de error W#16#80A0 a W#16#80A2,
W#16#80A4, W#16#80B4 a W#16#80B9

6912

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(W#16#...)

Explicación

1

80B4

Con la variante de protocolo ISO on TCP (connection_type = B#16#12), en el establecimiento
pasivo de la conexión (active_est = FALSE) ha vulnerado una o varias de las siguientes condicio‐
nes:
● local_tsap_id_len >= B#16#02
● local_tsap_id[1] = B#16#E0
● Con local_tsap_id_len >= B#16#03, local_tsap_id[1] es un carácter ASCII
● local_tsap_id[1] es un carácter ASCII y local_tsap_id_len >= B#16#03

1

80B5

Error en el parámetro active_est (UDT 65) en la variante de protocolo UDP

1

80B6

Error de parametrización respecto al parámetro connection_type (UDT 65)

1

80B7

Error en uno de los parámetros siguientes de UDT 65: block_length, local_tsap_id_len, rem_sub‐
net_id_len, rem_staddr_len, rem_tsap_id_len, next_staddr_len

1

80B8

Los parámetros de la descripción de la conexión local (UDT 65) y el parámetro ID son diferentes

1

80C3

Todos los recursos de conexión están ocupados.

1

80C4

Error de comunicación temporal:
● La conexión no se puede establecer en estos momentos.
● La interfaz se está reparametrizando
● La conexión creada está siendo eliminada por un "TDISCON (Página 6913)".
● El sistema H se encuentra en Acoplar y Sincronizar.

1

8xyy

Información de error general
Consulte también: Evaluación de errores con el parámetro de salida RET_VAL (Página 174)

Consulte también
Parametrización de las conexiones de comunicación en TCP e ISO on TCP (Página 6892)
Parametrización del punto de acceso local de comunicación en UDP (Página 6897)

TDISCON: Desconectar comunicación
Conexión vía TCP e ISO on TCP
La instrucción "TDISCON" deshace la conexión entre la CPU y un interlocutor.

Uso con UDP
La instrucción "TDISCON" deshace el punto de acceso local, es decir, que se deshace la
conexión entre el programa de usuario y la capa de comunicación del sistema operativo.

Funcionamiento
La instrucción "TDISCON" es una instrucción asíncrona, de modo que la ejecución de la
petición se prolonga a lo largo de varias llamadas. Para iniciar la petición para el
establecimiento de la conexión, llame la instrucción "TDISCON" con REQ = 1.

Programación del PLC
Manual de programación y manejo, 11/2019

6913

Instrucciones
4.2 Instrucciones
Tras la ejecución correcta de la instrucción "TDISCON", el ID indicado en la instrucción "TCON
(Página 6910)" ya no es válido, por lo que no puede utilizarse para transmitir ni para recibir.
El estado de la petición se indica a través de los parámetros de salida BUSY y STATUS.
STATUS corresponde al parámetro de salida RET_VAL de las instrucciones asíncronas
(véase también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813)).

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "TDISCON":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L, T, C

Inicia la petición de deshacer la conexión es‐
pecificada en ID cuando se detecta un flanco
ascendente.

ID

Input

WORD

M, D o constante

Referencia a la conexión establecida con
"TCON (Página 6910)".
Rango de valores: W#16#0001 a W#16#0FFF

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado con los valores siguien‐
tes:
● 0: Petición no iniciada aún o en ejecución
● 1: Petición finalizada sin errores

BUSY

Output

BOOL

I, Q, M, D, L

Parámetro de estado con los valores siguien‐
tes:
● 0: Petición no iniciada aún o ya finalizada
● 1: Petición no finalizada aún. No es posible
iniciar una nueva petición.

ERROR

Output

BOOL

I, Q, M, D, L

Parámetro de estado ERROR:
● 0: Ningún error
● 1: Con errores

STATUS

Output

WORD

M, D

Estado de la instrucción

Parámetros BUSY, DONE y ERROR
El estado de ejecución se controla a través de los parámetros BUSY, DONE, ERROR y
STATUS. El parámetro BUSY indica el estado de ejecución. El parámetro DONE permite
comprobar si una petición se ha ejecutado correctamente. El parámetro ERRORse activa
cuando ocurren errores durante la ejecución de TDISCON. La información de error se indica
en el parámetro STATUS.
La tabla siguiente muestra la relación entre los parámetros BUSY, DONE y ERROR:
BUSY

DONE

ERROR

Descripción

1

-

-

La petición se está procesando.

0

1

0

La petición se ha ejecutado correctamente.

6914

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
BUSY

DONE

ERROR

Descripción

0

0

1

La petición se ha finalizado con un error. La causa del error se indica en el parámetro
STATUS.

0

0

0

No se ha asignado ninguna petición nueva.

Parámetros ERROR y STATUS
ERROR

STATUS
(W#16#...)

Explicación

0

0000

La conexión se ha deshecho correctamente

0

7000

No se está procesando ninguna petición

0

7001

Inicio del procesamiento de la petición, deshaciendo la conexión.

0

7002

Deshaciendo la conexión (REQ es irrelevante).

1

8086

El parámetro ID se encuentra fuera del rango de direcciones admisible.

1

80A3

Se está intentando finalizar una conexión no existente.

1

80C4

Error de comunicación temporal: La interfaz está recibiendo nuevos parámetros o bien la conexión
se está estableciendo o el sistema H se encuentra en Acoplar y Sincronizar.

Consulte también
Vista general de los tipos de datos válidos (Página 241)

TSEND: Enviar datos a través de la conexión
Descripción
La instrucción "TSEND" envía datos a través de una conexión existente.

Funcionamiento
"TSEND" es una instrucción asíncrona, de modo que la ejecución se prolonga a lo largo de
varias llamadas. Para iniciar la petición de transmisión, llame la instrucción "TSEND" con REQ
= 1.
El estado de la petición se indica a través de los parámetros de salida BUSY y STATUS.
STATUS corresponde al parámetro de salida RET_VAL de las instrucciones asíncronas.
Consulte también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813).
El parámetro de salida DONE se activa si los datos se han transferido completamente a la
interfaz local para su envío.

Programación del PLC
Manual de programación y manejo, 11/2019

6915

Instrucciones
4.2 Instrucciones
En la tabla siguiente se muestra la correspondencia entre BUSY, DONE y ERROR. Con su
ayuda se puede determinar en qué estado se encuentra actualmente "TSEND".
BUSY

DONE

ERROR

Descripción

TRUE

Irrelevante

Irrelevante

La petición está en proceso.

FALSE

TRUE

FALSE

La petición ha finalizado correctamente.

FALSE

FALSE

TRUE

La petición se ha finalizado con un error. La causa del error se puede consultar
en el parámetro STATUS.

FALSE

FALSE

FALSE

No se ha asignado ninguna (nueva) petición a la instrucción.

Nota
Debido al funcionamiento asíncrono de "TSEND", los datos del área de transmisión deben
mantenerse coherentes hasta que el parámetro DONE o el parámetro ERROR adopten el
valor TRUE.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "TSEND":
Parámetro

Declaración

Tipo de datos Área de memoria

Descripción

REQ

Input

BOOL

El parámetro de control REQUEST activa la
petición de transmisión con un flanco ascen‐
dente.

I, Q, M, D, L, T, C

Los datos se transmiten desde el área indica‐
da con DATA y LEN.
ID

Input

WORD

M, D o constante

Referencia a la conexión correspondiente. ID
debe coincidir con el parámetro ID correspon‐
diente en la descripción local de la conexión.
Rango de valores: W#16#0001 a W#16#0FFF

LEN

Input

INT

I, Q, M, D, L

Número máximo de bytes que deben enviarse
con la petición
Véase también: Relación entre la CPU utiliza‐
da, la variante de protocolo (connection_type)
y la longitud de datos transferible (Pági‐
na 6900)

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o
todavía se está ejecutando.
● 1: Los datos se han transferido
completamente a la interfaz local para su
envío.

BUSY

Output

BOOL

I, Q, M, D, L

● BUSY = 1: la petición todavía no ha
finalizado. No es posible iniciar otra
petición.
● BUSY = 0: la petición ha finalizado.

6916

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos Área de memoria

Descripción

ERROR

Output

BOOL

Parámetro de estado ERROR:

I, Q, M, D, L

● ERROR=1: se ha producido un error
durante la ejecución. STATUS devuelve
información detallada sobre el tipo de error
STATUS

Output

WORD

M, D

Parámetro de estado STATUS: Información
de error

DATA

InOut

ANY

I, Q, M, D

Área de transmisión, contiene la dirección y la
longitud
La dirección remite a:
● La memoria imagen de proceso de las
entradas
● La memoria imagen de proceso de las
salidas
● Una marca
● Un bloque de datos
Nota: No utilice ARRAY of BOOL como área
de transmisión.
Nota: El parámetro DATA se puede indicar de
las dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: DB_name.variable

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(W#16#...)

Explicación

0

0000

La petición de transmisión ha finalizado sin errores

0

7000

No se está procesando ninguna petición

0

7001

Inicio del procesamiento de la petición, enviando los datos.
Nota: En esta fase de la ejecución, el sistema operativo accede a los datos del área de transmisión
DATA.

0

7002

Llamada intermedia (REQ irrelevante), la petición se está ejecutando
Nota: En esta fase de la ejecución, el sistema operativo accede a los datos del área de transmisión
DATA.

1

8085

El parámetro LEN tiene el valor "0" o excede el valor máximo admisible

1

8086

El parámetro ID se encuentra en un rango de valores no válido

1

8088

El parámetro LEN es mayor que el área de memoria indicada en DATA

Programación del PLC
Manual de programación y manejo, 11/2019

6917

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(W#16#...)

Explicación

1

80A1

Error de comunicación:
● La conexión indicada no se ha establecido todavía.
● La conexión indicada se está estableciendo en este momento. No es posible transmitir a través
de esta conexión.
● La interfaz se está reinicializando.

1

80B3

El tipo de conexión parametrizado (parámetro connection_type en la descripción de la conexión) es
UDP. Utilice "TUSEND (Página 6922)".

1

80C3

● Ya se está ejecutando un bloque con esta ID en otra clase de prioridad.
● Falta de recursos internos

1

80C4

Error de comunicación temporal:
● La conexión con el interlocutor no se puede establecer en estos momentos.
● La interfaz se está reparametrizando o estableciendo.

1

8xyy

Información de error general
Consulte también: Evaluación de errores con el parámetro de salida RET_VAL (Página 174)

TRCV: Recibir datos a través de la conexión
Descripción
La instrucción "TRCV" recibe datos a través de una conexión existente.

Área de recepción
Se entiende como tal el área en la que el bloque de función registra los datos recibidos.
El área de recepción está definida por los dos valores siguientes:
● Puntero hacia el inicio del área
● Longitud del área
En función de la variante de protocolo utilizada, la longitud del área se fija con el parámetro
LEN (si LEN <> 0) o por la indicación de longitud del parámetro DATA (si LEN = 0).

Modos de recepción de TRCV
En la tabla siguiente se describe cómo "TRCV" registra los datos recibidos en el área de
recepción.
Variante de protocolo Introducir los datos en el área
de recepción

Parámetro connection_type

Valor del parámetro LEN

TCP

Modo Ad hoc

B#16#01, B#16#11

0

TCP

Recepción de datos con la lon‐ B#16#01, B#16#11
gitud especificada

<> 0

ISO on TCP

Controlado por protocolo

0 (recomendado) o <> 0

6918

B#16#12

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

TCP/modo Ad hoc
El modo Ad hoc sólo está disponible con el protocolo TCP. El modo Ad hoc se establece
asignando el valor 0 al parámetro LEN.
El área de recepción es idéntica al área especificada en el parámetro DATA. Como máximo se
reciben 8192 bytes. Inmediatamente después de la recepción de un bloque de datos, la
instrucción "TRCV" los transmite al área de recepción y pone NDR a "1".

TCP / Recepción de datos con la longitud especificada
Asignando al parámetro LEN un valor distinto a cero se establece la recepción de datos con la
longitud dada.
El área de recepción está formada por los parámetros LEN y DATA. En cuanto se han recibido
LEN bytes, TRCV los transmite al área de recepción y pone NDR a "1".

ISO on TCP / transferencia de datos controlada por protocolo
En el caso del protocolo ISO on TCP, los datos se transfieren de forma controlada por el
protocolo.
El área de recepción está formada por los parámetros LEN y DATA. En cuanto se han recibido
todos los datos de una petición, "TRCV" los transmite al área de recepción y pone NDR a "1".

Intercambio de datos de tipo STRING
Para intercambiar datos de tipo STRING con las instrucciones "TSEND" y "TRCV", se
recomienda utilizar únicamente el modo Ad hoc con LEN=0. Además, en la instrucción "TRCV"
hay que seleccionar una longitud del string al menos igual de larga que en la instrucción
"TSEND". Si no se respeta esta regla, pueden producirse errores durante la posterior
ejecución del string.
Cuando se utiliza ARRAY of BYTE como área de recepción para una cadena de caracteres
enviada, el primer byte contiene la longitud máxima definida por el emisor y el segundo byte,
la longitud actual de la cadena.

Funcionamiento
"TRCV" es una instrucción asíncrona, de modo que la ejecución se prolonga a lo largo de
varias llamadas. Para iniciar la petición de recepción, llame la instrucción TRCV con EN_R = 1.
El estado de la petición se indica a través de los parámetros de salida BUSY y STATUS.
STATUS corresponde al parámetro de salida RET_VAL de las instrucciones asíncronas.
Consulte también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813).
En la tabla siguiente se muestra la correspondencia entre BUSY, NDR y ERROR. Permite
determinar en qué estado se encuentra "TRCV" actualmente o cuándo finalizó la recepción.
BUSY

NDR

ERROR

Descripción

TRUE

Irrelevante

Irrelevante

La petición está en proceso.

FALSE

TRUE

FALSE

La petición ha finalizado correctamente.

Programación del PLC
Manual de programación y manejo, 11/2019

6919

Instrucciones
4.2 Instrucciones
BUSY

NDR

ERROR

Descripción

FALSE

FALSE

TRUE

La petición se ha finalizado con un error. La causa del error se puede consultar
en el parámetro STATUS.

FALSE

FALSE

FALSE

No se ha asignado ninguna (nueva) petición a la instrucción.

Nota
Debido al funcionamiento asíncrono de "TRCV", los datos no son coherentes en el área de
recepción hasta que el parámetro NDR no adopta el valor TRUE.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "TRCV":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L, T, C

Parámetro de control enabled to receive: Con
EN_R = 1 "TRCV" pasa a disponibilidad de re‐
cepción. La petición de recepción se está eje‐
cutando.

ID

Input

WORD

M, D o constante

Referencia a la conexión correspondiente. ID
debe coincidir con el parámetro ID correspon‐
diente en la descripción local de la conexión.
Rango de valores: W#16#0001 a W#16#0FFF

LEN

Input

INT

I, Q, M, D, L

Longitud del área de recepción en bytes
Para conocer el significado de LEN = 0 ó LEN
<> 0, ver arriba (modos de recepción de
"TRCV").
Respecto al rango de valores, véase tam‐
bién: Relación entre la CPU utilizada, la va‐
riante de protocolo (connection_type) y la lon‐
gitud de datos transferible (Página 6900).

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● NDR = 0: la petición todavía no se ha
iniciado o está en curso
● NDR = 1: la petición ha finalizado
correctamente

ERROR

Output

BOOL

I, Q, M, D, L

Parámetro de estado ERROR:
● ERROR=1: se ha producido un error
durante la ejecución. STATUS devuelve
información detallada sobre el tipo de error

BUSY

Output

BOOL

I, Q, M, D, L

● BUSY = 1: la petición todavía no ha
finalizado. No es posible iniciar otra
petición.
● BUSY = 0: la petición ha finalizado.

STATUS

6920

Output

WORD

M, D

Parámetro de estado STATUS: Información
de error

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

RCVD_LEN

Output

INT

I, Q, M, D, L

Número de datos recibidos realmente en
bytes.

DATA

InOut

ANY

I, Q, M, D

Área de recepción (para definición, véase arri‐
ba), contiene la dirección y la longitud
La dirección remite a:
● La memoria imagen de proceso de las
entradas
● La memoria imagen de proceso de las
salidas
● Una marca
● Un bloque de datos
Nota: No utilice ARRAY of BOOL como área
de recepción.
Nota: El parámetro DATA se puede indicar de
las dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: DB_name.variable

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(W#16#...)

Explicación

0

0000

Se han aplicado nuevos datos. La longitud actual de los datos recibidos se indica en RCVD_LEN.

0

7000

El bloque no está preparado para la recepción

0

7001

El bloque está preparado para la recepción, la petición de recepción se ha activado

0

7002

Llamada intermedia, la petición de recepción está en proceso
Nota: En esta fase de ejecución, la instrucción escribe datos en el área de recepción. Por ello, en
caso de error es posible que haya datos incoherentes en el área de recepción.

1

8085

El parámetro LEN es mayor que el valor máximo permitido, o ha modificado uno de los parámetros
LEN o DATA respecto a la primera llamada

1

8086

El parámetro ID se encuentra en un rango de valores no válido

1

8088

● El área de recepción es demasiado pequeña
● El valor de LEN es mayor que el área de recepción especificada por DATA

1

80A1

Error de comunicación:
● La conexión indicada no se ha establecido todavía.
● La conexión indicada se está estableciendo en este momento. No es posible ejecutar una
petición de recepción a través de esta conexión.
● La interfaz se está reparametrizando.

1

80B3

La variante de protocolo parametrizada (parámetro connection_type en la descripción de la cone‐
xión) es UDP. Utilice "TURCV (Página 6925)".

Programación del PLC
Manual de programación y manejo, 11/2019

6921

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(W#16#...)

Explicación

1

80C3

● Ya se está ejecutando un bloque con esta ID en otra clase de prioridad.
● Falta de recursos internos

1

80C4

Error de comunicación temporal:
● La conexión con el interlocutor no se puede establecer en estos momentos.
● La interfaz se está reparametrizando o estableciendo.

1

8xyy

Información de error general
Consulte también: Evaluación de errores con el parámetro de salida RET_VAL (Página 174)

TUSEND: Enviar datos vía Ethernet (UDP)
Descripción
La instrucción "TUSEND" envía datos a través de UDP al interlocutor remoto direccionado con
el parámetro ADDR.
ADVERTENCIA
Transmisión de datos a través de UDP
En la transmisión de datos a través de UDP según RFC 768, los datos se transmiten al
interlocutor remoto sin acuse y, por lo tanto, sin seguridad. Ello significa que es posible que
se pierdan datos, sin que ello se indique en el bloque.
Nota
En procesos de transmisión consecutivos a diferentes interlocutores, en las llamadas de
"TUSEND" sólo es necesario adaptar el parámetro ADDR. Sin embargo, se prescinde de la
nueva llamada de las instrucciones "TCON (Página 6910)" y "TDISCON (Página 6913)".

Funcionamiento
"TUSEND" es una instrucción asíncrona, de modo que la ejecución de la petición se prolonga
a lo largo de varias llamadas. Para iniciar la petición de transmisión, llame la instrucción
"TUSEND" con REQ = 1.
El estado de la petición se indica a través de los parámetros de salida BUSY y STATUS.
STATUS corresponde al parámetro de salida RET_VAL de las instrucciones asíncronas.
Consulte también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813).

6922

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En la tabla siguiente se muestra la correspondencia entre BUSY, DONE y ERROR. Permite
determinar en qué estado se encuentra "TUSEND" actualmente o cuándo finalizó la
transmisión.
BUSY

DONE

ERROR

Descripción

TRUE

Irrelevante

Irrelevante

La petición está en proceso.

FALSE

TRUE

FALSE

La petición ha finalizado correctamente.

FALSE

FALSE

TRUE

La petición se ha finalizado con un error. La causa del error se puede consultar
en el parámetro STATUS.

FALSE

FALSE

FALSE

No se ha asignado ninguna (nueva) petición a la instrucción.

Nota
Debido al funcionamiento asíncrono de "TUSEND", los datos del área de transmisión deben
mantenerse coherentes hasta que el parámetro DONE o el parámetro ERROR adopten el
valor TRUE.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "TUSEND":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L, T, C

El parámetro de control REQUEST activa la pe‐
tición de transmisión con un flanco ascendente.
Los datos se transmiten desde el área indicada
con DATA y LEN.

ID

Input

WORD

M, D o constante

Referencia a la conexión correspondiente entre
el programa de usuario y la capa de comunica‐
ción del sistema operativo. ID debe coincidir con
el parámetro ID correspondiente en la descrip‐
ción local de la conexión.
Rango de valores: W#16#0001 a W#16#0FFF

LEN

Input

INT

I, Q, M, D, L

Número de bytes que deben enviarse con la pe‐
tición
Rango de valores: de 1 a 1472

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o todavía
se está ejecutando.
● 1: Petición finalizada sin errores

BUSY

Output

BOOL

I, Q, M, D, L

● BUSY = 1: la petición todavía no ha
finalizado. No es posible iniciar otra petición.

ERROR

Output

BOOL

I, Q, M, D, L

Parámetro de estado ERROR:

● BUSY = 0: la petición ha finalizado.
● ERROR=1: se ha producido un error durante
la ejecución. STATUS devuelve información
detallada sobre el tipo de error
STATUS

Output

WORD

Programación del PLC
Manual de programación y manejo, 11/2019

M, D

Parámetro de estado STATUS: Información de
error

6923

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

DATA

InOut

ANY

I, Q, M, D

Área de transmisión, contiene la dirección y la
longitud
La dirección remite a:
● La memoria imagen de proceso de las
entradas
● La memoria imagen de proceso de las salidas
● Una marca
● Un bloque de datos
Nota: El parámetro DATA se puede indicar de las
dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: DB_name.variable

ADDR

InOut

ANY

D

Puntero hacia la dirección del receptor (p. ej.
P#DB100.DBX0.0 byte 8)
Consulte también: Estructura de la información
de dirección del interlocutor remoto en UDP (Pá‐
gina 6899)
Nota: El parámetro ADDR se puede indicar de las
dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: DB_name.variable

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(W#16#...)

Explicación

0

0000

La petición de transmisión ha finalizado sin errores

0

7000

No se está procesando ninguna petición

0

7001

Inicio del procesamiento de la petición, enviando los datos.
Nota: En esta fase de la ejecución, el sistema operativo accede a los datos del área de transmisión
DATA.

0

7002

Llamada intermedia (REQ irrelevante), la petición se está ejecutando
Nota: En esta fase de la ejecución, el sistema operativo accede a los datos del área de transmisión
DATA.

1

8085

El parámetro LEN tiene el valor "0" o excede el valor máximo admisible

1

8086

El parámetro ID se encuentra en un rango de valores no válido

0

8088

El parámetro LEN es mayor que el área de memoria indicada en DATA

1

8089

El parámetro ADDR no apunta a un bloque de datos

6924

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(W#16#...)

Explicación

1

80A1

Error de comunicación:
● Todavía no se ha establecido la conexión indicada entre el programa de usuario y la capa de
comunicación del sistema operativo.
● Se está estableciendo la conexión indicada entre el programa de usuario y la capa de
comunicación del sistema operativo. No es posible transmitir a través de esta conexión.
● La interfaz se está reinicializando.

1

80A4

La dirección IP del punto final de la conexión no es válida o coincide con la dirección IP propia.

1

80B3

● La variante de protocolo parametrizada (parámetro connection_type en la descripción de la
conexión) no es UDP. Utilice "TSEND (Página 6915)".
● Parámetro ADDR: Indicación no válida para n.º de puerto.

1

80C3

● Ya se está ejecutando un bloque con esta ID en otra clase de prioridad.
● Falta de recursos internos

1

80C4

Error de comunicación temporal:
● En este momento no es posible establecer la conexión entre el programa de usuario y la capa
de comunicación del sistema operativo.
● La interfaz se está reparametrizando.

1

8xyy

Información de error general
Consulte también: Evaluación de errores con el parámetro de salida RET_VAL (Página 174)

TURCV: Recibir datos vía Ethernet (UDP)
Descripción
La instrucción "TURCV" recibe datos a través de UDP. Tras la finalización correcta de
"TURCV" en el parámetro ADDR se pone a disposición la dirección del interlocutor remoto, es
decir, del transmisor.
ADVERTENCIA
Transmisión de datos a través de UDP según RFC 768
En la transmisión de datos a través de UDP según RFC 768, los datos se transmiten al
interlocutor remoto sin acuse y, por lo tanto, sin seguridad. Ello significa que es posible que
se pierdan datos, sin que ello se indique en el bloque.

Funcionamiento
"TURCV" es una instrucción asíncrona, de modo que la ejecución de la petición se prolonga a
lo largo de varias llamadas. Para iniciar la petición de recepción, llame la instrucción "TURCV"
con EN_R = 1.
El estado de la petición se indica a través de los parámetros de salida BUSY y STATUS.
STATUS corresponde al parámetro de salida RET_VAL de las instrucciones asíncronas.

Programación del PLC
Manual de programación y manejo, 11/2019

6925

Instrucciones
4.2 Instrucciones
Consulte también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813).
En la tabla siguiente se muestra la correspondencia entre BUSY, NDR y ERROR. Permite
determinar en qué estado se encuentra TURCV actualmente o cuándo finalizó la recepción.
BUSY

NDR

ERROR

Descripción

TRUE

Irrelevante

Irrelevante

La petición está en proceso.

FALSE

TRUE

FALSE

La petición ha finalizado correctamente.

FALSE

FALSE

TRUE

La petición se ha finalizado con un error. La causa del error se puede consultar
en el parámetro STATUS.

FALSE

FALSE

FALSE

No se ha asignado ninguna (nueva) petición a la instrucción.

Nota
Debido al funcionamiento asíncrono de "TURCV", los datos no son coherentes en el área de
recepción hasta que el parámetro NDR no adopta el valor TRUE.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "TURCV":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

EN_R

Input

BOOL

I, Q, M, D, L, T, C

Parámetro de control enabled to receive: Con
EN_R = 1 "TURCV" pasa a disponibilidad de re‐
cepción. La petición de recepción se está ejecu‐
tando.

ID

Input

WORD

M, D o constante

Referencia a la conexión correspondiente entre
el programa de usuario y la capa de comunica‐
ción del sistema operativo. ID debe coincidir con
el parámetro ID correspondiente en la descrip‐
ción local de la conexión.
Rango de valores: W#16#0001 a W#16#0FFF

LEN

Input

INT

I, Q, M, D, L

Longitud del área de recepción en bytes: 0 (re‐
comendado) o bien 1 a 1472
Consulte también: Funcionamiento de las ins‐
trucciones para Open User Communication vía
Industrial Ethernet (Página 6888)

NDR

Output

BOOL

I, Q, M, D, L

Parámetro de estado NDR:
● NDR = 0: la petición todavía no se ha iniciado
o está en curso
● NDR = 1: la petición ha finalizado
correctamente

ERROR

Output

BOOL

I, Q, M, D, L

Parámetro de estado ERROR:
● ERROR=1: se ha producido un error durante
la ejecución. STATUS devuelve información
detallada sobre el tipo de error

6926

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

BUSY

Output

BOOL

I, Q, M, D, L

● BUSY = 1: la petición todavía no ha
finalizado. No es posible iniciar otra petición.
● BUSY = 0: la petición ha finalizado.

STATUS

Output

WORD

M, D

Parámetro de estado STATUS: Información de
error

RCVD_LEN

Output

INT

I, Q, M, D, L

Número de datos recibidos realmente en bytes.

DATA

InOut

ANY

I, Q, M, D

Área de recepción (véase la definición en Fun‐
cionamiento de las instrucciones para Open
User Communication vía Industrial Ethernet (Pá‐
gina 6888))
La dirección remite a:
● La memoria imagen de proceso de las
entradas
● La memoria imagen de proceso de las salidas
● Una marca
● Un bloque de datos
Nota: El parámetro DATA se puede indicar de las
dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: DB_name.variable

ADDR

InOut

ANY

D

Puntero hacia la dirección del emisor (p. ej.
P#DB100.DBX0.0 byte 8), véase también: Es‐
tructura de la información de dirección del inter‐
locutor remoto en UDP (Página 6899)
Nota: El parámetro ADDR se puede indicar de
las dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: DB_name.variable

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(W#16#...)

Explicación

0

0000

Se han aplicado nuevos datos. La longitud actual de los datos recibidos se indica en RCVD_LEN.

0

7000

El bloque no está preparado para la recepción

0

7001

El bloque está preparado para la recepción, la petición de recepción se ha activado

0

7002

Llamada intermedia, la petición de recepción está en proceso
Nota: En esta fase de ejecución, "TURCV" escribe datos en el área de recepción. Por ello, en caso
de error es posible que haya datos incoherentes en el área de recepción.

1

8085

El parámetro LEN es mayor que el valor máximo permitido, o ha modificado uno de los parámetros
LEN o DATA respecto a la primera llamada

Programación del PLC
Manual de programación y manejo, 11/2019

6927

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(W#16#...)

Explicación

1

8086

El parámetro ID se encuentra en un rango de valores no válido

1

8088

● El área de recepción es demasiado pequeña

1

8089

El parámetro ADDR no apunta a un bloque de datos

1

80A1

Error de comunicación:

● El valor de LEN es mayor que el área de recepción especificada por DATA

● Todavía no se ha establecido la conexión indicada entre el programa de usuario y la capa de
comunicación del sistema operativo.
● Se está estableciendo la conexión indicada entre el programa de usuario y la capa de
comunicación del sistema operativo. No es posible ejecutar una petición de recepción a través
de esta conexión.
● La interfaz se está reparametrizando.
1

80B3

La variante de protocolo parametrizada (parámetro connection_type en la descripción de la cone‐
xión) no es UDP. Utilice "TRCV (Página 6918)".

1

80C3

● Ya se está ejecutando un bloque con esta ID en otra clase de prioridad.
● Falta de recursos internos

1

80C4

Error de comunicación temporal: La interfaz se está reparametrizando.

1

8xyy

Información de error general
Consulte también: Evaluación de errores con el parámetro de salida RET_VAL (Página 174)

IP_CONF: Modificar parámetros de configuración IP
Descripción de IP_CONF
Descripción
La instrucción "IP_CONF" sirve para realizar la configuración controlada por el programa de la
interfaz PROFINET integrada en la CPU. Los datos de configuración hasta ahora válidos se
sobrescriben.
Se pueden realizar los siguientes ajustes de configuración de la interfaz:
● Parámetro IP: dirección IP, máscara de subred, dirección de router
● Nombre de dispositivo PROFINET IO (en caso de que la CPU se utilice como dispositivo
PROFINET IO)
Los datos de configuración deben almacenarse en un DB de configuración.
Los ajustes de la configuración IP controlados por el programa con la instrucción "IP_CONF"
también se pueden configurar alternativamente con STEP 7. No obstante, sólo son efectivos

6928

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
si se preselecciona explícitamente en la configuración de hardware que la asignación de
parámetros IP se lleva a cabo a través del programa de usuario.
Nota
Como alternativa a la configuración, los datos de configuración de un procesador de
comunicaciones también pueden establecerse con la instrucción "IP_CONFIG" (véase
SIMATIC NET CP).

Funcionamiento
La instrucción "IP_CONF" es una instrucción asíncrona, de modo que la ejecución se prolonga
a lo largo de varias llamadas. Para iniciar el proceso de transferencia, llame la instrucción
"IP_CONF" con REQ = 1.
Sólo puede haber una petición activa cada vez.
El estado de la petición se indica a través de los parámetros de salida BUSY y STATUS.
STATUS corresponde al parámetro de salida RET_VAL de las instrucciones asíncronas
(véase también: Diferencia entre las instrucciones que funcionan síncronamente y las que
funcionan asíncronamente (Página 4813)).
En la tabla siguiente se muestra la correspondencia entre BUSY, DONE y ERROR. Permite
determinar en qué estado se encuentra la instrucción actualmente o cuándo se completó la
transferencia de los datos de configuración.
BUSY

DONE

ERROR

Descripción

TRUE

Irrelevante

Irrelevante

La petición está en proceso.

FALSE

TRUE

FALSE

La petición ha finalizado correctamente.

FALSE

FALSE

TRUE

La petición se ha finalizado con un error. La causa del error se puede con‐
sultar en el parámetro STATUS.

FALSE

FALSE

FALSE

No se ha asignado ninguna (nueva) petición a la instrucción.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "IP_CONF":
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

REQ

Input

BOOL

I, Q, M, D, L, T, C

El parámetro de control REQUEST. activa la
instrucción con un flanco ascendente.

LADDR

Input

WORD

M, D o constante

Dirección de diagnóstico de la interfaz PROFI‐
NET

CONF_DB (Pá‐
gina 6931)

Input

ANY

D

Puntero hacia los datos de configuración (tipos
de datos admisibles: BYTE, WORD,
BLOCK_DB)
Nota: El parámetro CONF_DB se puede indi‐
car de las dos formas siguientes:
● absoluta. Ej.: P#DB13.DBX0.0 byte 64
● simbólica. Ej.: DB_name.variable

Programación del PLC
Manual de programación y manejo, 11/2019

6929

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Área de memoria

Descripción

DONE

Output

BOOL

I, Q, M, D, L

Parámetro de estado DONE:
● 0: La petición aún no se ha iniciado o
todavía se está ejecutando.
● 1: Petición finalizada sin errores

BUSY

Output

BOOL

I, Q, M, D, L

● 0: La petición ha finalizado.
● 1: La petición todavía no ha finalizado. No
es posible iniciar otra petición.

ERROR

Output

BOOL

I, Q, M, D, L

Parámetro de estado ERROR:
ERROR=1: se ha producido un error durante
la ejecución. STATUS devuelve información
detallada sobre el tipo de error

STATUS

Output

DWORD

I, Q, M, D, L

Información de error

ERR_LOC

Output

DWORD

I, Q, M, D, L

Origen del error (field_id y subfield_type_id del
bloque de parámetros que ha causado el error)

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetros ERROR y STATUS
ERROR

STATUS
(DW#16#..)

ERR_LOC*

Explicación

0

00000000

0

Procesamiento de la petición finalizado sin errores

0

00700000

0

No se está procesando ninguna petición

0

00700100

0

Inicio del procesamiento de la petición

0

00700200

0

Llamada intermedia (REQ es irrelevante)

1

C08xyy00

0

Información de error general
Consulte también: Evaluación de errores con el parámetro de salida RET_VAL
(Página 174)

1

C0808000

0

LADDR no es válido

1

C0808100

0

LADDR no está asignado a la interfaz PROFINET soportada

1

C0808200

0

Error en el parámetro CONF_DB: No se soporta el tipo de datos.

1

C0808300

0

Error en el parámetro CONF_DB: El puntero señala a un área no soportada.

1

C0808400

0

Error en el parámetro CONF_DB: Longitud incorrecta del puntero ANY

1

C0808700

0

Error en el parámetro CONF_DB: Incoherencia de la indicación de longitud en los
datos de configuración

1

C0808800

s, 0

field_type_id tiene un valor no admisible

1

C0808900

s, 0

field_id tiene un valor no admisible

1

C0808A00

s, 0

Número incorrecto en subfield_cnt

1

C0808B00

s, t

subfield_id tiene un valor no admisible

1

C0808C00

s, t

Subcampo utilizado más de una vez

1

C0808D00

s, t

subfield_len tiene un valor incorrecto o no admisible

1

C0808E00

s, t

subfield_mode tiene un valor no admisible

1

C0808F00

s, t

En el subcampo hay un conflicto con un subcampo anterior.

6930

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ERROR

STATUS
(DW#16#..)

ERR_LOC*

Explicación

1

C0809000

s, t

Los parámetros del subcampo están protegidos contra escritura. P. ej. se realizó
el preajuste de parámetros por configuración o el modo PNIO está activo.

1

C0809400

s, t

El valor del parámetro en el subcampo no está definido o no es admisible

1

C080C200

0

No se puede realizar la transferencia (p. ej., porque la interfaz no es accesible).

1

C080C300

0

Recursos insuficientes (p. ej., llamada múltiple de "IP_CONF" con parámetros
diferentes)

1

C080C400

0

Error de comunicación temporal

* En la tabla anterior f es la field_id y s la subfield_type_id del bloque de parámetros que ha causado el error.

Bloque de datos CONF_DB
Descripción
En la siguiente imagen se muestra cómo se almacenan en el DB de configuración los datos de
configuración que deben transferirse.
'%GHFRQILJXUDFLµQ

&DPSR

&21)B'%

'DWRVGHFRQILJXUDFLµQ

ILHOGBW\SHBLG



ILHOGBLG



VXEILHOGBFQW

Q

VXEILHOG

6XEFDPSR
(QFD
EH]DGR

VXEILHOGBW\SHBLG
VXEILHOGBOHQJWK
VXEILHOGBPRGH

(QFD
EH]DGR

VXEILHOG
3DU£PHWURV
HVSHF¯ILFRVGH
VXEFDPSR
VXEILHOGQ

Programación del PLC
Manual de programación y manejo, 11/2019

6931

Instrucciones
4.2 Instrucciones
Los datos de configuración se componen exactamente de un campo y varios subcampos:
● El campo se compone de un encabezado y de los subcampos. A su vez, el encabezado se
compone de los elementos siguientes:
– field_type_id (tipo de datos INT): Cero
– field_id (tipo de datos INT): Cero
– subfield_cnt (tipo de datos INT): Número de subcampos
● Cada subcampo se compone de un encabezado (subfield_type_id, subfield_length,
subfield_mode) y de los parámetros específicos del subcampo. Cada subcampo debe
componerse de un número entero de bytes.
subfield_mode admite los siguientes valores:
– 1: validez permanente de los datos de configuración
– 2: validez temporal de los datos de configuración, incluido el borrado de los datos de
configuración permanentes existentes
Nota
Actualmente se permite un campo. Sus parámetros field_type_id y field_id deben tener
el valor cero. Los campos con otros valores para field_type_id y field_id quedan
reservados para futuras ampliaciones.

Subcampos admisibles
subfield_type_id

Nombre del subcampo

Explicación

30

SUB_IP_SUITE_IPV4

Parámetro IP: dirección IP, máscara de subred, direc‐
ción de router

40

SUB_NOS

Nombre de dispositivo PROFINET IO (Name of Station)

Definiciones de tipo para el subcampo "SUB_IP_SUITE_IPV4"

6932

Nombre

Tipo de da‐
tos

SUB_IP_SUITE_V4

Struct

Valor de
arranque

Descripción

Id

INT

30

subfield_type_id

len

INT

18

subfield_length

mode

INT

1

subfield_mode (1: permanente, 2: temporal)

ipaddr_3

BYTE

b#16#C8

Byte High de la dirección IP: 200

ipaddr_2

BYTE

b#16#0C

Byte High de la dirección IP: 12

ipaddr_1

BYTE

b#16#01

Byte Low de la dirección IP: 1

ipaddr_0

BYTE

b#16#90

Byte Low de la dirección IP: 144

snmask_3

BYTE

b#16#FF

Byte High de la máscara de subred: 255

snmask_2

BYTE

b#16#FF

Byte High de la máscara de subred: 255

snmask_1

BYTE

b#16#FF

Byte Low de la máscara de subred: 255

snmask_0

BYTE

b#16#00

Byte Low de la máscara de subred: 0

router_3

BYTE

b#16#C8

Byte High del router: 200

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre

Tipo de da‐
tos

Valor de
arranque

Descripción

router_2

BYTE

b#16#0C

Byte High del router: 12

router_1

BYTE

b#16#01

Byte Low del router: 1

router_0

BYTE

b#16#01

Byte Low del router: 1

Definiciones de tipo para el subcampo "SUB_NOS"
Nombre

Tipo de da‐
tos

SUB_NOS

Struct

Valor de
arranque

Descripción

id

INT

40

subfield_type_id

len

INT

246

subfield_length

mode

INT

1

subfield_mode (1: permanente, 2: temporal)

nos

ARRAY[1..2 0
40] of BYTE

Nombre de dispositivo: ARRAY debe ocupar‐
se desde el primer byte. Si ARRAY es más
largo que el nombre de dispositivo que se va a
asignar, se debe introducir un byte cero des‐
pués del nombre de dispositivo (de acuerdo
con IEC 61158-6-10). De lo contrario, nos se
rechaza y la instrucción "IP_CONF (Pági‐
na 6928)" registra el código de error
DW#16#C0809400 en STATUS. Si se ocupa
el primer byte con un cero, se borra el nombre
de dispositivo.

Los nombres de dispositivo están sujetos a las siguientes restricciones:
● Limitación a 240 caracteres en total (letras minúsculas, cifras, guión o punto)
● Los distintos componentes del nombre de dispositivo, es decir, las cadenas de caracteres
entre dos puntos, no deben superar los 63 caracteres de longitud, respectivamente. Los
componentes del nombre no pueden empezar ni terminar con el carácter "-".
● No se admiten caracteres especiales como vocales acentuadas o con diéresis, los
paréntesis, caracteres de subrayado, barras, espacios en blanco, etc. El único carácter
especial permitido es el guión.
● El nombre de dispositivo no puede empezar ni acabar por los caracteres "-" o ".".
● El nombre de dispositivo no puede empezar con una cifra.
● El nombre de dispositivo no puede tener el formato n.n.n.n (n = 0, ... 999).

Programación del PLC
Manual de programación y manejo, 11/2019

6933

Instrucciones
4.2 Instrucciones
● El nombre de dispositivo no puede empezar con la cadena de caracteres "port-xyz" o "portxyz-abcde" (a, b, c, d, e, x, y, z = 0... 9).
● No se admite la cadena de caracteres ".." dentro del nombre de dispositivo.
Nota
El ARRAY "nos" también se puede crear con menos de 240 bytes, siendo 2 bytes la longitud
mínima. En este caso se debe adaptar la variable "len" (longitud del subcampo) en
correspondencia.

Intercambio de datos a través de FETCH y WRITE
FW_TCP: Intercambiar datos mediante FETCH y WRITE vía TCP
Descripción
Con la instrucción "FW_TCP" se ofrecen los servicios FETCH/WRITE a través de la conexión
TCP.

Llamada
Dado que para los servicios FETCH/WRITE se requiere una conexión TCP separada,
respectivamente, la instrucción se llama dos veces en el OB1:
● La primera llamada con el bloque de datos de instancia FETCH_TCP_DB ofrece el servicio
FETCH a través de las conexiones TCP.
● La segunda llamada con el bloque de datos de instancia WRITE_TCP_DB ofrece la función
WRITE a través de la conexión TCP.
La conexión TCP se establece automáticamente tras un arranque en frío, un arranque en
caliente y un rearranque de la CPU, así como después de modificar los parámetros de
conexión. Los parámetros para el establecimiento de la conexión se encuentran en el DB
"ConnectParam" (descripción: véase más abajo). A través del parámetro de entrada ENABLE
existe la posibilidad de controlar manualmente la conexión y desconexión de la comunicación.
Si se modifican los parámetros de la conexión, ésta se desconecta y restablece
automáticamente.
En la siguiente figura se representa esquemáticamente el desarrollo de la instrucción
"FW_TCP", que se llama en el OB1 y que ejecuta los servicios FETCH y WRITE a través de
conexiones TCP.

6934

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
(VWDEOHFLPLHQWRGHOD
FRQH[LµQ

ಱ&RQQHFW3DUDPಯ

5HFHSFLµQGHOWHOHJUDPD
GHHQFDEH]DGR 
E\WHV

(YDOXDU
HQFDEH]DGRGH
E\WHV
)(7&+

:5,7(

3URFHVDUGDWRV

5HFHSFLµQGHORV
GDWRVGHXVXDULR

*HQHUDU
WHOHJUDPDGHDFXVH

(VFULELUGDWRVHQ
£UHDGHGHVWLQR

(QYLDUWHOHJUDPDGHDFXVH
GDWRVGHXVXDULR

*HQHUDU
WHOHJUDPDGHDFXVH
(QYLDU
WHOHJUDPDGHDFXVH

Parámetros de conexión del bloque de datos de instancia "ConnectParam"
Los siguientes parámetros de conexión se comprueban antes de establecer la conexión:
● connection_type
● id
● local_tsap_id
Si uno de ellos no está definido correctamente, la conexión no se establece. No se transmiten
ni reciben datos.
● Una vez que la conexión se ha establecido, se recibe un telegrama de encabezado de 16
bytes de los servicios FETCH/WRITE. El telegrama de encabezado contiene la información
que indica si se trata de una petición FETCH o una petición WRITE.
● Si se trata de una petición FETCH, los datos solicitados por el interlocutor se procesan en
el bloque de datos de instancia DB210 de la instrucción y se genera el telegrama de acuse.
El telegrama de acuse se envía junto con los datos procesados.
● Si se trata de una petición WRITE, tras la evaluación del telegrama de encabezado de 16
bytes se reciben los datos de usuario, que se escriben en el área de destino. A continuación
se genera y transmite el telegrama de acuse en el bloque de datos de instancia DB310.

Programación del PLC
Manual de programación y manejo, 11/2019

6935

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra la estructura de los parámetros de una conexión TCP. Ésta tiene
una longitud de 64 bytes.
Parámetro

Tipo de datos

Valor de
arranque

Descripción

id

WORD

W#16#1

ID de la conexión: El valor del parámetro debe encontrarse dentro
del siguiente rango de valores:
id = W#16#0001 a W#16#0FFF (1 a 4095)

connection_type

BYTE

B#16#11

Tipo de conexión. Para la conexión TCP rige lo siguiente:
● connection_type = B#16#11 (TCP native) o
● connection_type = B#16#1 (modo de compatibilidad TCP native)

active_est

BOOL

FALSE

Establecimiento pasivo de la conexión.

local_device_id

BYTE

B#16#3

Identificación de la interfaz local PN/IE (aquí: CPU 319-3PN/DP).

local_tsap_id_len

BYTE

B#16#2

Longitud utilizada del parámetro local_tsap_id en bytes:
● 0 ó 2, con el tipo de conexión = 17 (TCP)
● Para el lado activo sólo se admite el valor "0".

rem_subnet_id_len

BYTE

B#16#0

Este parámetro no se utiliza.

rem_staddr_len

BYTE

B#16#0

Longitud de la dirección del punto final del interlocutor (parámetro
rem_staddr) en bytes. Dado que se trata de una conexión no espe‐
cificada, el parámetro es irrelevante.

rem_tsap_id_len

BYTE

B#16#0

Longitud utilizada del parámetro rem_tsap_id en bytes:
● 0 ó 2, con el tipo de conexión = 17 (TCP).
● Para el lado pasivo sólo se admite el valor 0.

next_staddr_len

BYTE

B#16#0

Este parámetro no se utiliza.

local_tsap_id

ARRAY
[1..16] of
BYTE

B#16#7

Puerto local para la conexión TCP. Valores posibles: 1...49151 (va‐
lores recomendados: 2000...5000).

B#16#D0
B#16#0
:
:
B#16#0

● local_tsap_id[1] = byte alto del n.º de puerto en representación
hexadecimal;
● local_tsap_id[2] = byte bajo del n.º de puerto en representación
hexadecimal;
● local_tsap_id[3-16] = irrelevante
Nota: Asegúrese de que todos los valores de local_tsap_id sean
unívocos dentro de la CPU.

rem_subnet_id

ARRAY [1..6]
of BYTE

B#16#0 …

rem_staddr

ARRAY [1..6]
of BYTE

B#16#0

Este parámetro no se utiliza.
Dirección IP del punto final del interlocutor, p. ej. para 192.168.2.3:
● rem_staddr[1] = 192
● rem_staddr[2] = 168
● rem_staddr[3] = 2
● rem_staddr[4] = 3
● rem_staddr[5-6] = irrelevante
Irrelevante para conexiones no especificadas con establecimiento
pasivo de la conexión.

6936

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Tipo de datos

Valor de
arranque

Descripción

rem_tsap_id

ARRAY
[1..16] of
BYTE

B#16#0

Puerto del interlocutor.
Valores posibles con 17 (TCP): 1...49151 (valores recomendados:
2000...5000).
● rem_tsap_id[1] = byte alto del n.º de puerto en representación
hexadecimal;
● rem_tsap_id[2] = byte bajo del n.º de puerto en representación
hexadecimal;
● rem_tsap_id[3-16] = irrelevante
Irrelevante para conexiones no especificadas con establecimiento
pasivo de la conexión.

next_staddr

ARRAY [1..6]
of BYTE

B#16#0

Este parámetro no se utiliza.

spare

WORD

W#16#0

Este parámetro no se utiliza.

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "FW_TCP":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

ENABLE

Input

BOOL

I, Q, M, D, L, T, C

Con este parámetro se inicia el establecimiento o la in‐
terrupción de la conexión:
● 0 = la conexión se deshace
● 1 = la conexión se establece

CONNECT

Input

ANY

D

Puntero ANY hacia el área de datos del DB211 que
contiene los parámetros para el establecimiento de la
conexión TCP. Esta área de datos debe tener un tama‐
ño mínimo de 64 bytes.

ADDRMODE

Input

INT

I, Q, M, D, L o cons‐ Con este parámetro se especifica el modo en que se
tante
produce el direccionamiento de los datos de la petición
FETCH o WRITE (en el modo de direccionamiento S7 o
S5).
● 0 = modo de direccionamiento S7
(La dirección inicial de los datos se interpreta como
dirección de byte)
● 1 = modo de direccionamiento S5
(La dirección inicial de los datos se interpreta como
dirección de palabra)

NDR

Output

BOOL

I, Q, M, D, L

Parámetro new data record:
Con este parámetro se indica que los datos de la peti‐
ción WRITE se han aplicado correctamente y que el te‐
legrama de acuse se ha generado y enviado.

Programación del PLC
Manual de programación y manejo, 11/2019

6937

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

ERROR

Output

BOOL

I, Q, M, D, L

Este parámetro se activa en los siguientes casos:
● Si se ha producido un error en el establecimiento o la
interrupción de la conexión
● Si se ha producido un error al enviar o recibir los
datos.
● Si se ha recibido un telegrama de encabezado no
válido de FETCH/WRITE.

MODE

Output

BYTE

I, Q, M, D, L

Con este parámetro se indica si se está ejecutando una
petición FETCH o WRITE.
● 0 = ninguna petición activa
● 1 = Petición WRITE
● 2 = Petición FETCH

STATUS (Pá‐
gina 6942)

Output

WORD

M, D

En el parámetro STATUS se indican bits de comunica‐
ción internos.

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

FW_IOT: Intercambiar datos mediante FETCH y WRITE vía ISO-on-TCP
Descripción
Con la instrucción "FW_IOT" se ofrecen los servicios FETCH/WRITE a través de la conexión
ISO on TCP.

Llamada
Dado que para los servicios FETCH/WRITE se requiere una conexión ISO on TCP separada,
respectivamente, la instrucción "FW_IOT" se llama dos veces en el OB1.
● La primera llamada con el bloque de datos de instancia FETCH_IOT_DB ofrece el servicio
FETCH a través de las conexiones ISO on TCP.
● La segunda llamada con el bloque de datos de instancia WRITE_IOT_DB ofrece el servicio
WRITE a través de la conexión ISO on TCP.
La conexión ISO on TCP se establece automáticamente tras un arranque en frío, un arranque
en caliente y un rearranque de la CPU, así como después de modificar los parámetros de
conexión. Los parámetros para el establecimiento de la conexión se encuentran en el DB
"ConnectParam". El parámetro de entrada ENABLE permite al usuario controlar manualmente
el establecimiento y la interrupción de la conexión. Si se modifican los parámetros de la
conexión, ésta se desconecta y restablece automáticamente. La tabla siguiente muestra la
estructura de datos de los parámetros de una conexión ISO on TCP. Ésta tiene una longitud
de 64 bytes.
En la siguiente figura se representa esquemáticamente el desarrollo de la instrucción
"FW_IOT", que se llama en el OB1 y que ejecuta los servicios FETCH y WRITE a través de
conexiones ISO on TCP.

6938

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
(VWDEOHFLPLHQWRGHOD
FRQH[LµQ

'%
ಱ&RQQHFW3DUDPಯ

5HFHSFLµQGHOWHOHJUDPD
GHHQFDEH]DGRGDWRV
GHXVXDULR
P£[E\WHV

(YDOXDU
HQFDEH]DGRGH
E\WHV
)(7&+

:5,7(

/RVGDWRVVH
SURFHVDQ

5HFHSFLµQGHORV
GDWRVGHXVXDULR

*HQHUDU
WHOHJUDPDGHDFXVH

(VFULELUGDWRVHQ
£UHDGHGHVWLQR

(QYLDUWHOHJUDPDGHDFXVH
GDWRVGHXVXDULR

*HQHUDU
WHOHJUDPDGHDFXVH
(QYLDU
WHOHJUDPDGHDFXVH

Parámetros de conexión del bloque de datos de instancia "ConnectParam"
Los siguientes parámetros de conexión se comprueban antes de establecer la conexión:
● connection_type
● id
● local_tsap_id
● local_tsap_id _len

Programación del PLC
Manual de programación y manejo, 11/2019

6939

Instrucciones
4.2 Instrucciones
Si uno de ellos no está definido correctamente, la conexión no se establece. No se transmiten
ni reciben datos.
● Una vez que la conexión se ha establecido, se recibe un telegrama de encabezado de 16
bytes de los servicios FETCH/WRITE. El telegrama de encabezado contiene la información
que indica si se trata de una petición FETCH o una petición WRITE.
● Si se trata de una petición FETCH, los datos solicitados por el interlocutor se procesan en
el bloque de datos de instancia FETCH_IOT_DB de la instrucción y se genera el telegrama
de acuse. El telegrama de acuse se envía junto con los datos procesados.
● Si se trata de una petición WRITE, tras la evaluación del telegrama de encabezado de 16
bytes se reciben los datos de usuario, que se escriben en el área de destino. A continuación
se genera y transmite el telegrama de acuse en el bloque de datos de instancia
WRITE_IOT_DB.
La tabla siguiente muestra la estructura de los parámetros de una conexión TCP. Ésta tiene
una longitud de 64 bytes.
Parámetro

Tipo de datos

Valor de
arranque

Descripción

id

WORD

W#16#1

ID de la conexión: El valor del parámetro debe encontrarse dentro
del siguiente rango de valores:
id = W#16#0001 a W#16#0FFF (1 a 4095)

connection_type

BYTE

B#16#12

Tipo de conexión. Para la conexión ISO on TCP rige lo siguiente:
connection_type = B#16#12

active_est

BOOL

FALSE

Establecimiento pasivo de la conexión.

local_device_id

BYTE

B#16#3

Identificación de la interfaz local PN/IE (aquí: CPU 319-3PN/DP).

local_tsap_id_len

BYTE

B#16#2

Longitud utilizada del parámetro local_tsap_id en bytes:

rem_subnet_id_len

BYTE

B#16#0

Este parámetro no se utiliza.

rem_staddr_len

BYTE

B#16#0

Longitud de la dirección del punto final del interlocutor (parámetro
rem_staddr) en bytes. Dado que se trata de una conexión no espe‐
cificada, el parámetro es irrelevante.

rem_tsap_id_len

BYTE

B#16#0

Longitud utilizada del parámetro rem_tsap_id en bytes:

next_staddr_len

BYTE

B#16#0

Este parámetro no se utiliza.

local_tsap_id

ARRAY
[1..16] of
BYTE

B#16#7

ID TSAP local de la conexión ISO on TCP.

B#16#D0

● local_tsap_id[1] = B#16#E0;

B#16#0
:

● local_tsap_id[2] = rack y slot del punto final local (bits 0 a 4:
número de slot, bits de 5 a 7: número de rack);

:

● local_tsap_id[3-16] = extensión TSAP, opcional

B#16#0

Nota: Asegúrese de que todos los valores de local_tsap_id sean
unívocos dentro de la CPU.

B#16#0 …

Este parámetro no se utiliza.

● De 2 a 16, si el tipo de conexión = 18 (ISO on TCP)

● De 2 a 16, si el tipo de conexión = 18 (ISO on TCP)

rem_subnet_id

6940

ARRAY [1..6]
of BYTE

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Tipo de datos

Valor de
arranque

Descripción

rem_staddr

ARRAY [1..6]
of BYTE

B#16#0

Dirección IP del punto final del interlocutor, p. ej. para 192.168.2.3:
● rem_staddr[1] = 192
● rem_staddr[2] = 168
● rem_staddr[3] = 2
● rem_staddr[4] = 3
● rem_staddr[5-6] = irrelevante
Irrelevante para conexiones no especificadas con establecimiento
pasivo de la conexión.

rem_tsap_id

ARRAY
[1..16] of
BYTE

B#16#0

Puerto del interlocutor.
Para ID TSAP del interlocutor con ISO on TCP:
● rem_tsap_id[1] = B#16#E0;
● rem_tsap_id[2] = rack y slot del punto final del interlocutor (bits 0
a 4: número de slot, bits de 5 a 7: número de rack);
● rem_tsap_id[3-16] = extensión TSAP, opcional
Irrelevante para conexiones no especificadas con establecimiento
pasivo de la conexión.

next_staddr

ARRAY [1..6]
of BYTE

B#16#0

Este parámetro no se utiliza.

spare

WORD

W#16#0

Este parámetro no se utiliza.

Parámetro
La tabla siguiente muestra los parámetros de la instrucción "FW_IOT":
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

ENABLE

Input

BOOL

I, Q, M, D, L, T, C

Con este parámetro se inicia el establecimiento o la
interrupción de la conexión:
● 0 = la conexión se deshace
● 1 = la conexión se establece

CONNECT

Input

ANY

D

Puntero ANY hacia el área de datos del DB que con‐
tiene los parámetros para el establecimiento de la co‐
nexión TCP. Esta área de datos debe tener un tama‐
ño mínimo de 64 bytes.

ADDRMODE

Input

INT

I, Q, M, D, L o cons‐ Con este parámetro se especifica el modo en que se
tante
produce el direccionamiento de los datos de la peti‐
ción FETCH o WRITE (en el modo de direcciona‐
miento S7 o S5).
● 0 = modo de direccionamiento S7
(La dirección inicial de los datos se interpreta
como dirección de byte)
● 1 = modo de direccionamiento S5
(La dirección inicial de los datos se interpreta
como dirección de palabra)

Programación del PLC
Manual de programación y manejo, 11/2019

6941

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de da‐
tos

Área de memoria

Descripción

NDR

Output

BOOL

I, Q, M, D, L

Parámetro new data record:
Con este parámetro se indica que los datos de la pe‐
tición WRITE se han aplicado correctamente y que el
telegrama de acuse se ha generado y enviado.

ERROR

Output

BOOL

I, Q, M, D, L

Este parámetro se activa en los siguientes casos:
● Si se ha producido un error en el establecimiento
o la interrupción de la conexión
● Si se ha producido un error al enviar o recibir los
datos.
● Si se ha recibido un telegrama de encabezado no
válido de FETCH/WRITE.

MODE

Output

BYTE

I, Q, M, D, L

Con este parámetro se indica si se está ejecutando
una petición FETCH o WRITE.
● 0 = ninguna petición activa
● 1 = Petición WRITE
● 2 = Petición FETCH

STATUS (Pági‐ Output
na 6942)

WORD

M, D

En el parámetro STATUS se indican bits de comuni‐
cación internos.

Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetro STATUS
Estructura del parámetro STATUS
El parámetro de salida STATUS de las instrucciones "FW_TCP" y "FW_IOT" devuelve
información sobre el estado de la comunicación entre la estación S7 y la estación PC.
Esta palabra de estado presenta la siguiente estructura:
Bit

DB de instancia.Estado
FB

Descripción

High Byte
0

NotConnected

Ninguna conexión establecida o interrumpida
● El cliente FETCH/WRITE todavía no ha iniciado el establecimiento de la conexión
● Error al establecer la conexión

1

ErrorConnect

Error al establecer la conexión (p. ej.: Error en la estructura de los parámetros de
conexión)

2

ErrorDisConnect

Error al deshacer la conexión

3

ErrorConType

Tipo de conexión errónea en la estructura de los parámetros de conexión

4

No asignado

5

BusyConnect

Establecimiento de conexión en curso

6

BusyDisConnect

Desconexión en curso

7

No asignado

6942

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Bit

DB de instancia.Estado
FB

Descripción

Low Byte
8

ErrorRec1

Conexión TCP:
● Error en la petición de recepción
● FETCH/WRITE No se ha podido recibir el telegrama de encabezado
Conexión ISO on TCP
● Error en la petición de recepción
● FETCH/WRITE No se ha podido recibir el telegrama de encabezado junto con los
datos de usuario

9

ErrorRec2

Conexión TCP
● Error en la petición de recepción
● No se han podido recibir los datos de usuario

10

ErrorSend

Conexión TCP e ISO on TCP
● Error en la petición de transmisión
● FETCH/WRITE No se ha podido transmitir el telegrama de acuse junto con los
datos de usuario

11

No asignado

12

BusyRec1

Petición de recepción en curso

13

BusyRec2

Petición de recepción en curso

14

BusySend

Petición de transmisión en curso

15

ErrorHeader

Se ha recibido un telegrama de encabezado FETCH/WRITE no definido

Direcciones y variables del bloque de datos de instancia
En el bloque de datos de instancia de la instrucción "FW_TCP" y "FW_IOT" se guardan el
estado de error del establecimiento y la interrupción de la conexión, así como el estado de error
de la petición de transmisión y recepción.
● El bloque de datos de instancia de la instrucción "FW_TCP" abarca 8348 bytes.
● El bloque de datos de instancia de la instrucción "FW_IOT" abarca 16544 bytes.
La tabla siguiente ofrece una vista general de las direcciones y variables del bloque de datos
de instancia en donde se guardan los estados.
Variable

Tipo de datos

Dirección

Descripción

DoneError.STATUS_Connect

WORD

22.0

Estado de establecimiento de la conexión

DoneError.STATUS_REC_1

WORD

24.0

Estado de la primera petición de recepción

DoneError.STATUS_REC_2

WORD

26.0

Estado de la segunda petición de recepción (sólo
con TCP)

DoneError.STATUS_SEND

WORD

28.0

Estado de la petición de transmisión

DoneError.STATUS_DisConnect

WORD

30.0

Estado de interrupción de la conexión

Programación del PLC
Manual de programación y manejo, 11/2019

6943

Instrucciones
4.2 Instrucciones

Valores del parámetro STATUS
La tabla siguiente ofrece una vista general de los valores de estado del establecimiento de la
conexión.
STATUS
(W#16#...)

Descripción

0000

Se ha podido establecer la conexión.

8086

El parámetro ID se encuentra fuera del rango admisible.

8087

Se ha alcanzado el número máximo de conexiones, no es posible establecer más conexiones.

8089

El parámetro CONNECT no apunta a un DB.

809A

El parámetro CONNECT apunta a un campo que no tiene la longitud de la descripción de la conexión.

809B

El local_device_id indicado en la descripción de la conexión no concuerda con la CPU.

80A1

La conexión o el puerto ya están ocupados.

80A2

El puerto local o remoto está ocupado por el sistema.

80A3

Se está intentando deshacer una conexión que no existe.

80A4

La dirección IP del punto final de conexión remoto no es válida o coincide con la dirección IP propia

80B2

El parámetro CONNECT apunta a un DB generado con la palabra clave UNLINKED.

80B3

Parametrización incoherente

80B4

Con la variante de protocolo ISO on TCP (connection_type = B#16#12), en el establecimiento pasivo de la
conexión (active_est = FALSE) ha vulnerado una o varias de las siguientes condiciones:
● local_tsap_id_len >= B#16#02
● local_tsap_id[1] = B#16#E0

80B6

Error de parametrización referente al parámetro connection_type.

80B7

Error en la descripción de la conexión

80C3

Todos los recursos de conexión están ocupados:
● Ya se está procesando otro bloque con esta ID en una categoría de prioridad diferente.
● Falta de recursos internos

80C4

Error de comunicación temporal:
● La conexión no se puede establecer en estos momentos.
● La interfaz se está reparametrizando.
● La conexión creada está siendo eliminada por la instrucción "TDISCON".

82xx

4.2.5.4

Información de error general

Servidor web

WWW: Sincronizar las páginas web definidas por el usuario
Descripción
La instrucción WWW inicializa el servidor web de la CPU, o bien sincroniza las páginas web
definidas por el usuario con el programa de usuario en la CPU.

6944

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Las páginas web definidas por el usuario, junto con el servidor web de la CPU, ofrecen la
posibilidad de acceder con un navegador web a páginas web de libre configuración de la CPU.
Mediante instrucciones de scripts (por ej., Javascript) y de código HTML en páginas web
definidas por el usuario, es posible transmitir datos a la CPU desde un navegador para su
posterior procesamiento, así como visualizar en el navegador datos del área de operandos.
Para la sincronización del programa de usuario con el servidor web, y también para la
inicialización, es necesario llamar la instrucción WWW en el programa de usuario.

Inicialización
Las páginas web definidas por el usuario se "comprimen" en bloques de datos para que la CPU
pueda procesarlas. Durante la configuración deberá generar los correspondientes bloques de
datos a partir de los datos fuente (archivos HTML, imágenes, archivos Javascript...). El DB
Web Control (predeterminado: DB 333), que contiene información de estado y de control, así
como referencias a otros bloques de datos con páginas web cifradas, desempeña una función
particular. Los bloques de datos con páginas web codificadas se denominan DBs de
fragmento.
Si los bloques de datos se han cargado en la CPU, esta no "sabe" que las páginas web
definidas por el usuario que contiene están cifradas. Por medio de la instrucción "WWW", por
ejemplo, en el OB de arranque, se notifica a la CPU qué DB es el DB de Web Control. Tras esta
inicialización, es posible acceder a las páginas web definidas por el usuario desde un
navegador web.

Sincronización
Cuando el programa de usuario debe interactuar con las páginas web definidas por el usuario,
se debe utilizar la instrucción WWW en la parte cíclica del programa.
Ejemplos de interacción entre programa de usuario y página web:
● Comprobar los datos recibidos
● Recopilar y reenviar los datos para el navegador web solicitante
En este caso, la información de estado ha de poder evaluarse en el acto, debiendo notificarse
al servidor la información de control, por ejemplo, para habilitar una página web solicitada por
el navegador web.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "WWW":
Parámetro

Declaración

Tipo de datos

Área de memo‐ Descripción
ria

CTRL_DB

Input

BLOCK_DB

I, Q, M, D, L o
constante

Bloque de datos que describe las pá‐
ginas web definidas por el usuario
(DB Web Control)

RET_VAL

Output

INT

I, Q, M, D, L

Información de error

Programación del PLC
Manual de programación y manejo, 11/2019

6945

Instrucciones
4.2 Instrucciones
Encontrará más información sobre los tipos de datos válidos en "Vista general de los tipos de
datos válidos (Página 241)".

Parámetro RET_VAL
Código de
error
(W#16#...)

Explicación

0000

No ha ocurrido ningún error. No hay pendiente ninguna solicitud de página web que
deba ser habilitada por el programa de usuario.

00xy

x: indica si ha ocurrido un error al inicializar el DB Web Control (CTRL_DB):
x=0: no ha ocurrido ningún error.
x=1: se han producido errores. El error está codificado en el byte "CTRL_DB.com‐
mandstate.last_error" del DB Web Control, consulte la descripción del DB Web Control.
y: número de peticiones pendientes. Son posibles varias peticiones (p. ej., petición "0"
y "1" pendientes: y="3".
y="1": petición "0"
y="2": petición "1"
y="4": petición "2"
y="8": petición "3"

4.2.5.5

803A

El DB Web Control indicado no se encuentra en la CPU.

8081

La versión o el formato del DB Web Control son incorrectos.

80C1

No se dispone de recursos para inicializar la aplicación web, p. ej., porque solamente
pueden ejecutarse dos o cuatro aplicaciones web.

Comunicación adicional

MODBUS/TCP
MODBUSPN: Comunicación como cliente Modbus/TCP o servidor Modbus/TCP
MODBUSPN V2
Información general
Generalidades
La instrucción MODBUSPN representa un producto de software para CPU con interfaz PN
integrada del SIMATIC S7-300, S7-400 y la CPU IM 151-8 PN/DP.
Con esta instrucción se posibilita la comunicación entre una CPU SIMATIC con interfaz PN
integrada y un dispositivo que soporte el protocolo Modbus/TCP .
La transferencia de datos se lleva a cabo según el principio de cliente-servidor.

6946

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
SIMATIC S7 puede operar como cliente o como servidor durante la transferencia.

Instrucciones paso a paso
1. Asignación de la dirección IP de la CPU
2. Llamada de la instrucción MODBUSPN en el OB necesario;
consulte Puesta en marcha (Página 6947)
3. Parametrización del DB de parámetros de acuerdo con los requisitos (ID, Número de
puerto, Cliente/Servidor, establecimiento de conexión en el rearranque, Registro Modbus,
áreas de DB, etc.);
consulte Bloque de datos de parámetros (Página 6949)
4. Parametrización del bloque Modbus;
véase Funcionamiento de la instrucción (Página 6954)
5. Carga del programa de usuario en la CPU y concesión de licencia del bloque Modbus para
esta CPU;
consulte Concesión de licencia (Página 6959)

Puesta en marcha
Requisitos y principios básicos
El uso de la instrucción MODBUSPN V2.0 es posible con STEP7 V14 SP1 (TIA Portal) o
superior.
La instrucción MODBUSPN se creó tomando como base la Modbus Application Protocol
Specification V1.1b3, April 26, 2012 ; , consulte Página de inicio de Modbus (http://
www.modbus.org).

Llamada de la instrucción
Para que el programa se ejecute correctamente, la instrucción MODBUSPN debe llamarse en
un OB cíclico (OB1 o en un OB controlado por tiempo, p. ej., OB35).
No se permite la llamada simultánea de la instrucción MODBUSPN en el OB1 y en un OB
controlado por tiempo (p. ej. OB35). El OB121 debe estar presente en la CPU. Para más
información al respecto, consulte Concesión de licencia (Página 6959).

Inserción del bloque Modbus
Abra el bloque "Main [OB1]" o un bloque cíclico. La instrucción MODBUSPN está ubicada en
la Task Card, paleta y carpeta "Instrucciones> Comunicación > Otros". Abra allí la carpeta
"MODBUS TCP" y arrastre la instrucción MODBUSPN al bloque OB.
Ahora, en "Bloques de sistema > Recursos de programa" se muestran, además de
MODBUSPN (FB70), las instrucciones subordinadas MOD_CLI (FB72) y MOD_SERV (FB73) .
Estas instrucciones no se pueden llamar adicionalmente en un OB. Se siguen visualizando las

Programación del PLC
Manual de programación y manejo, 11/2019

6947

Instrucciones
4.2 Instrucciones
instrucciones de comunicación TSEND (FB63), TRCV (FB64), TCON (FB65) y TDISCON
(FB66) llamadas internamente.

Versiones de los bloques T
Tenga en cuenta que, para un perfecto funcionamiento de la instrucción MODBUSPN, se
necesita la versión correcta de los bloques T:
Si utiliza los bloques migrados en V13, necesitará las siguientes versiones en la librería Open
User Communication V2.5:
● TCON

V2.4

● TDISCON V2.1
● TSEND

V2.1

● TRCV

V2.2

Si utiliza los bloques integrados en V13, necesitará las siguientes versiones en la librería Open
User Communication V3.0:
● TCON

V3.0

● TDISCON V2.1
● TSEND

V3.0

● TRCV

V3.0

Si utiliza los bloques integrados en V13 SP1 o V14, necesitará las siguientes versiones en la
librería Open User Communication V4.0:
● TCON

V4.0

● TDISCON V2.1
● TSEND

V4.0

● TRCV

V4.0

Si utiliza los bloques integrados en V14 SP1, necesitará las siguientes versiones en la librería
Open User Communication V5.0:
● TCON

V4.0

● TDISCON V2.1
● TSEND

V4.0

● TRCV

V4.0

Conexiones múltiples a cliente y servidor
Una CPU S7 puede admitir varias conexiones TCP, si bien el número máximo de conexiones
depende de la CPU utilizada. El total de conexiones de una CPU, incluidas las conexiones
Modbus/TCP, no debe exceder el número máximo de conexiones admitidas.

6948

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Uso del número de puerto 502
El protocolo Modbus/TCP pasa habitualmente por el puerto 502. Este número de puerto solo
es posible con las CPU PN que tengan una versión de firmware correcta. La información
relativa a la habilitación de los números de puerto se encuentra aquí: "¿Qué puertos se han
habilitado para la comunicación Modbus/TCP y cuántos clientes Modbus pueden comunicarse
con una CPU SIMATIC S7 como servidor Modbus? (http://
support.automation.siemens.com/WW/view/es/34010717)".
Determinados tipos de CPU pueden mantener y manejar paralelamente, a través del puerto
502 local, conexiones a varios clientes (multipuerto). Durante la parametrización, se deben
realizar los siguientes ajustes:
● CPU como servidor
● Puerto 502 como puerto local
● Establecimiento de conexión pasivo
El número de conexiones que una CPU puede aceptar en el puerto 502 depende del
dispositivo y puede consultarse en los datos técnicos de la CPU. Para cada cliente que desee
conectarse con el puerto 502 del servidor se requiere, respectivamente, 1 conexión unívoca en
el DB de parámetros y 1 instancia del bloque Modbus en el OB cíclico.

Bloque de datos de parámetros
Parametrización de la comunicación Modbus
Para la comunicación mediante la interfaz PN integrada de la CPU, no es necesario configurar
ninguna conexión en el editor de redes. Las conexiones se establecen o se deshacen con
ayuda de las instrucciones TCON y TDISCON.
Bloque de datos de parámetros
Los datos necesarios para el establecimiento de las conexiones y el procesamiento de las
tramas Modbus se definen en el tipo de datos PLC MB_PN_PARAM. Este tipo de datos PLC
contiene una estructura para los datos específicos de conexión y otra para los parámetros
Modbus.
Para cada conexión con un interlocutor, se requiere 1 instancia del tipo de datos PLC en un
bloque de datos, en la que se definen los parámetros de conexión y los parámetros Modbus.
Para cada conexión adicional, el bloque de datos se puede ampliar o se puede crear un bloque
de datos nuevo.
Este o estos bloques de datos solo están previstos para los parámetros de conexión y Modbus,
por lo que en ellos no se pueden guardar otros parámetros.
Cada instancia de la instrucción "MODBUSPN" necesita una conexión unívoca. Por tanto,
establezca una estructura propia de la descripción de la conexión para cada instancia de la
instrucción.

Programación del PLC
Manual de programación y manejo, 11/2019

6949

Instrucciones
4.2 Instrucciones

Figura 4-44

Estructura Param_DB

Parámetros de conexión en la estructura "Connection settings"
En la 1.ª estructura "Connection settings" se definen los parámetros específicos de la
conexión, como p. ej., la interfaz hardware utilizada localmente y la dirección IP del interlocutor.
Con ayuda de estos parámetros, las instrucciones TCON y TDISCON pueden establecer o
deshacer una conexión.
La estructura de datos del bloque de parámetros de conexión se debe respetar
obligatoriamente porque, de lo contrario, no se podrá establecer ninguna conexión.
Parámetros Modbus en la estructura "Modbus settings"
En la 2.ª estructura (los "Modbus settings") se almacenan los datos necesarios para el modo
de operación y la referencia de dirección, p. ej., las áreas Modbus que se mapean en los
bloques de datos y el modo de operación del S7 como servidor Modbus o cliente Modbus. La
estructura de datos de los parámetros Modbus se debe respetar para que sea posible el
procesamiento sin errores.

6950

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Configuración
Existen 2 opciones para llevar a cabo la configuración de los parámetros Modbus y de
conexión.
1. Opción:
En "Objetos tecnológicos", cree un objeto del tipo MB_PN_PARAM con "Insertar nuevo
objeto" en Modbus. Se crea un bloque de datos de parámetros. Con ayuda de un editor, que
se llama mediante "Configuración", es posible realizar la parametrización. Se recomienda
utilizar el editor para editar el bloque de datos de parámetros gracias a la claridad de la
interfaz gráfica de usuario.
2. Opción:
Cree un bloque de datos global nuevo y ábralo. Agregue un parámetro y seleccione el tipo
de datos MB_PN_PARAM para dicho parámetro. En caso de que este tipo de datos no se
muestre en la lista desplegable, introdúzcalo manualmente.
Esta opción permite insertar varias instancias en 1 bloque de datos.
Modificación de los valores
Los valores del bloque de datos de parámetros no se pueden modificar en tiempo de ejecución.
Después de modificar los parámetros es preciso inicializar nuevamente el bloque con Init =
TRUE.

Parámetros de conexión "Connection settings"
Parámetro

Descripción

block_length

Este parámetro indica la longitud de los parámetros de conexión y no se puede cambiar.
Valor fijo:

id

Rango de valores:
connection_type

W#16#40

Para cada conexión lógica se asigna una ID de conexión. Debe ser unívoca en toda la CPU. La
ID se indica en la llamada de la instrucción MODBUSPN y se utiliza en las llamadas internas de
los bloques T (TCON, TSEND, TRCV y TDISCON).
de W#16#1 a W#16#FFF

Aquí se define el tipo de conexión para el establecimiento de esta mediante la instrucción TCON.
El valor que debe ajustarse depende de la CPU.
TCP (modo de compatibilidad):
B#16#01 para CPU 315 o 317 <= FW V2.3
TCP:
B#16#11 para CPU 315 o 317 >= FW V2.4, IM 151-8 PN/DP CPU, CPU314C, CPU319, CPU412,
CPU414 y CPU416
Estos datos pueden variar según el firmware utilizado.

active_est

Este parámetro indica el tipo de establecimiento de la conexión, activo o pasivo. El cliente Mod‐
bus asume el establecimiento de conexión activo y el servidor Modbus el pasivo.
Establecimiento activo de la conexión:
TRUE
Establecimiento pasivo de la conexión: FALSE

local_device_id

La local_device_id define la interfaz IE de la CPU PN utilizada. Según el tipo de CPU PN se
requieren distintos ajustes.
IM 151-8 PN/DP CPU:
CPU 314C, 315 o 317:
CPU 319:
CPU 412, 414 o CPU 416

Programación del PLC
Manual de programación y manejo, 11/2019

B#16#1
B#16#2
B#16#3
B#16#5

6951

Instrucciones
4.2 Instrucciones
Parámetro

Descripción

local_tsap_id_len

Se indica la longitud del parámetro local_tsap_id (= número de puerto local).
Establecimiento activo de la conexión:
0
Establecimiento pasivo de la conexión: 2

rem_subnet_id_len

Este parámetro no se usa actualmente y debe estar ocupado por B#16#0.

rem_staddr_len

Se indican la longitud del parámetro rem_staddr, es decir, la dirección IP del interlocutor. Si se
debe comunicar mediante una conexión no especificada, no se indica ninguna dirección IP para
el interlocutor.
Conexión no especificada: B#16#0
Conexión especificada:
B#16#4

rem_tsap_id_len

Este parámetro define la longitud del parámetro rem_tsap_id, el número de puerto del interlocutor
remoto.
Establecimiento activo de la conexión:
2
Establecimiento pasivo de la conexión: 0

next_staddr_len

Aquí se define la longitud del parámetro next_staddr.
Con interfaz PN: B#16#0

local_tsap_id

Con este parámetro se ajusta el número de puerto local. El modo de representación se distingue
en función del parámetro connection_type. El rango de valores depende de la CPU. Si hay
conexiones activas, no es necesario indicarlo. En el caso de las conexiones pasivas, el número
de puerto local puede utilizarse varias veces.
Con connection_type B#16#01:
local_tsap_id[1]
local_tsap_id[2]
local_tsap_id[3-16]

low byte del n.º de puerto en formato hexadecimal
high byte del n.º de puerto en formato hexadecimal
B#16#00

Con connection_type B#16#11:
local_tsap_id[1]
local_tsap_id[2]
local_tsap_id[3-16]

high byte del n.º de puerto en formato hexadecimal
low byte del n.º de puerto en formato hexadecimal
B#16#00

rem_subnet_id

Este parámetro no se usa actualmente y debe estar ocupado por 0.

rem_staddr

En este array de bytes se introduce la dirección IP del interlocutor remoto. En el caso de una
conexión no especificada no se introduce ninguna dirección IP. El modo de representación se
distingue en función del parámetro connection_type. Ejemplo: Dirección IP 192.168.0.1:

6952

Para connection_type B#16#01:
rem_staddr[1] =
rem_staddr[2] =
rem_staddr[3] =
rem_staddr[4] =
rem_staddr[5-6]=

B#16#01 (1)
B#16#00 (0)
B#16#A8 (168)
B#16#C0 (192)
B#16#00 (reservado)

Con connection_type B#16#11:
rem_staddr[1] =
rem_staddr[2] =
rem_staddr[3] =
rem_staddr[4] =
rem_staddr[5-6]=

B#16#C0 (192)
B#16#A8 (168)
B#16#00 (0)
B#16#01 (1)
B#16#00 (reservado)

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Descripción

rem_tsap_id

Con este parámetro se ajusta el remote número de puerto. El modo de representación se dis‐
tingue en función del parámetro connection_type. El rango de valores depende de la CPU. Se
indica con rem_tsap_id_len > 0.
Con connection_type B#16#01:
rem_tsap_id[1]
rem_tsap_id[2]
rem_tsap_id[3-16]

low byte del n.º de puerto en formato hexadecimal
low byte del n.º de puerto en formato hexadecimal
B#16#00

Con connection_type B#16#11:
rem_tsap_id[1]
rem_tsap_id[2]
rem_tsap_id[3-16]

high byte del n.º de puerto en formato hexadecimal
low byte del n.º de puerto en formato hexadecimal
B#16#00

next_staddr

Este parámetro indica el número de rack y de slot del CP utilizado. Al usar la interfaz PN integrada
de la CPU este parámetro se debe poner a 0.
next_staddr[1-6]
B#16#00

spare

Este parámetro no se usa y debe estar predeterminado con 0.

Parámetros Modbus "Modbus settings"
Parámetro

Descripción

server_client

TRUE:
FALSE:

single_write

En el modo de operación "S7 es cliente", con el parámetro single_write = TRUE en las órdenes
de escritura de longitud 1, se utilizan los códigos de función 5 y 6.

S7 es servidor
S7 es cliente

Si es single_write = FALSE, en todas las peticiones de escritura se utilizan los códigos de
función 15 y 16.
connect_at_startup

Con ello se determina el momento en que se establece la conexión.
Si connect_at_startup se pone a TRUE, la conexión se establece directamente tras la iniciali‐
zación. En este caso, no se puede iniciar ninguna orden de datos hasta que se haya estable‐
cido correctamente la conexión (CONN_ESTABLISHED = TRUE) o hasta que aparezca un
error correspondiente en ERROR y STATUS.
FALSE:
establecimiento de la conexión con ENQ_ENR
TRUE activado:
establecimiento de la conexión directamente tras la inicialización

8 áreas de datos

Se ofrecen 8 áreas de datos para mapear las direcciones MODBUS en la memoria S7. Se debe
definir, al menos, la primera área de datos, las 7 áreas de datos restantes son opcionales. En
las áreas de datos se lee o se escribe según el tipo de orden.
Con una orden se puede leer/escribir siempre en un solo DB. Los accesos a registros o valores
de bit que se encuentren en varios DB, aunque los números sean directamente correlativos, se
deben repartir entre dos peticiones. Esto se debe tener presente durante la configuración.
Es posible mapear más áreas Modbus (registros o valores de bit) en un bloque de datos que las
que se pueden procesar con una trama.

data_type

Con el parámetro data_type se indica qué tipos de datos MODBUS se mapean en el bloque de
datos. Si se introduce el valor 0 en data_type, no se utilizará el área de datos correspondiente.
Identificador

Tipo de datos

Ancho de datos

0
1
2
3
4

Área no utilizada
Coils
Inputs
Holding Registers
Input Registers

Bit
Bit
Word
Word

Programación del PLC
Manual de programación y manejo, 11/2019

6953

Instrucciones
4.2 Instrucciones
Parámetro

Descripción

db

El parámetro db especifica el bloque de datos en que se mapean los registros MODBUS o
valores de bit definidos seguidamente. El número de DB 0 no está permitido, ya que se reserva
para el sistema.
Número de DB

de 1 a 65535 (de W#16#0001 a W#16#FFFF)

El bloque de datos debe crearse 2 bytes más largo de lo que es necesario para los datos
parametrizados. Los dos últimos bytes se usan para fines internos.
start
end

Con start se indica la primera dirección Modbus que se mapea en la palabra de datos 0 del DB.
El parámetro end define la dirección de la última dirección MODBUS.
Al acceder a registros, el número de la palabra de datos del DB S7 en que se introduce la última
dirección Modbus se calcula según la fórmula siguiente:
Número DBW = (end – start) * 2
Al acceder a bits, el número del byte de datos del DB S7 en que se introduce la última dirección
Modbus se calcula según la fórmula siguiente:
Número DBB = (end – start + 7) / 8
Las áreas de datos definidas no deben solaparse. El parámetro end no puede ser menor que
start. En caso de fallo, el arranque de la instrucción termina con error. Si ambos valores coin‐
ciden, se asigna 1 dirección Modbus (1 registro o 1 valor de bit).
Ejemplo de la mapeo de las direcciones MODBUS en las áreas de memoria de S7.
MODBUS Dirección

de 0 a 65535 (de W#16#0000 a W#16#FFFF)

internal_send_buffer

Este array se usa internamente en la instrucción para los datos enviados. No se permiten
accesos ni modificaciones en esta área.

internal_recv_buffer

Este array se usa internamente en la instrucción para los datos recibidos. No se permiten
accesos ni modificaciones en esta área.

Descripción MODBUSPN
Descripción
La instrucción MODBUSPN permite establecer la comunicación entre una CPU con interfaz
PN integrada y un interlocutor que soporte el protocolo Modbus/TCP. Se soportan los códigos
de función 1, 2, 3, 4, 5, 6, 15 y 16. Según la parametrización, la instrucción puede operar como
cliente (S7 es cliente) o como servidor (S7 es servidor). Mediante la instrucción MODBUSPN
se establece una conexión entre los interlocutores, se realiza la transferencia de datos y se
controla el establecimiento de conexión.
Durante la transferencia de datos se ejecutan las acciones siguientes:
● Generación del encabezado del telegrama (trama) específico de MODBUS durante la
transmisión
● Comprobación del encabezado del telegrama (trama) específico de MODBUS durante la
recepción
● Comprobación de la existencia de las áreas de datos a las que accede el cliente
● Generación de telegramas (tramas) de excepción cuando aparece un error (solo cuando S7
es servidor)
● Transferencia de datos del/al bloque de datos parametrizado

6954

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Además, se efectúa una vigilancia temporal del establecimiento de conexión y de la
desconexión, así como de la recepción de datos.
La instrucción MODBUSPN V2.0 puede utilizarse tanto para el S7-300 como para el S7-400.
La conexión se realiza mediante la interfaz local de la CPU. Para utilizar esta instrucción no se
requiere ningún módulo de hardware adicional.

Funcionamiento de la instrucción
Inicialización
La instrucción MODBUSPN se llama con un flanco ascendente en la entrada "Init".
● Los parámetros de inicialización deben estar asignados de acuerdo con la configuración de
la instalación.
● Los parámetros de inicialización se adoptan en el DB de instancia.
● Los parámetros de tiempo de ejecución no se evalúan en el arranque.
● Se comprueba la coherencia de los datos procedentes del bloque de datos de parámetros.
Si se detecta un flanco ascendente en el parámetro Init, se ejecutan las acciones anteriores.
Si la comprobación finalizó sin errores, se borra Init, Init_Error e Init_Status indican 0.
Si se producen errores durante la comprobación, ello se indica en las salidas Init_Error y
Init_Status. Mientras haya presente un error de Init, no es posible la comunicación Modbus/
TCP a través de este bloque. Antes hay que solucionar el error de Init.
Funcionamiento cíclico
En modo cíclico, la instrucción MODBUSPN se llama en el OB1 o en el OB de alarma cíclica.
● Las funciones del bloque se activan mediante los parámetros de tiempo de ejecución.
● Mientras haya una orden en curso, no se evalúan las modificaciones de los parámetros de
tiempo de ejecución.
● Los parámetros de inicialización no se evalúan mientras no se ejecute una inicialización.
Procesamiento de la conexión
El cliente Modbus ejecuta el establecimiento de conexión activo. Los datos necesarios se
obtienen de los parámetros de conexión del bloque de datos de parámetros.
Mediante un parámetro del bloque de parámetros de conexión (active_est) se determina si la
CPU PN debe actuar como interlocutor activo o pasivo.
En ambos tipos de conexión, activo y pasivo, con la instrucción TCON se abre un canal de
comunicación con el interlocutor durante el tiempo de ejecución.
El momento del establecimiento de conexión se especifica con el parámetro
connect_at_startup en el bloque de datos de parámetros.
La desconexión se controla con el parámetro DISCONNECT en la instrucción MODBUSPN.

Programación del PLC
Manual de programación y manejo, 11/2019

6955

Instrucciones
4.2 Instrucciones

Inicio de la orden con "S7 es cliente" o activación de la instrucción con "S7 es servidor"
Los parámetros de salida son indicadores dinámicos y solo se aplican a 1 ciclo de la CPU. Para
poderlos procesar posteriormente o visualizarlos en la tabla de observación, se deben copiar
en otras áreas de memoria.
S7 es cliente: Inicio de la orden
Mediante un cambio de flanco positivo en la entrada de disparo ENQ_ENR se activa una orden.
Dependiendo de los parámetros de entrada UNIT, DATA_TYPE, START_ADDRESS,
LENGTH y WRITE_READ, se genera un telegrama de solicitud MODBUS y se envía a la
estación interlocutora a través de la conexión TCP/IP. El cliente espera durante el tiempo
parametrizado RECV_TIMEOUT la respuesta del servidor.
Si se rebasa el tiempo (no hay respuesta del servidor), la orden activada termina con error. Se
puede iniciar una nueva orden.
Tras recibirse el telegrama de respuesta se realiza una comprobación de coherencia. Si el
resultado de dicha comprobación es positivo, se llevan a cabo las acciones necesarias y la
orden termina sin error; se activa la salida DONE_NDR. En caso de detectarse errores durante
la comprobación, la orden termina con error, se activa el bit ERROR y se muestra un número
de error en STATUS.
S7 es servidor: Activación de la instrucción
Mediante un nivel positivo en la entrada de disparo ENQ_ENR, la instrucción está lista para
recibir una trama de solicitud del cliente. El servidor se comporta pasivamente y espera un
telegrama del cliente. Se verifica la trama recibida. Si el resultado de la comprobación es
positivo, se responde a la trama de solicitud. El intercambio de tramas finalizado se comunica
al usuario mediante la activación del bit DONE_NDR. En esta fase se visualiza la función
ejecutada en las salidas UNIT, DATA_TYPE, START_ADDRESS, LENGTH y WRITE_READ.
Un telegrama de solicitud erróneo da lugar a un mensaje de error. El bit ERROR se activa, en
STATUS se indica el número de error y la orden del cliente no se procesa. Según el error se
envía una trama de excepción al cliente.

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "MODBUSPN":
Parámetro

De‐
cla‐
ra‐
ción

Tipo
de da‐
tos

id (Página 6965)

Input

Descripción

Rango de valores

Init

WORD ID de conexión, debe ser idéntica al respectivo parámetro
id en el DB de parámetros

de 1 a 4095

Sí

de W#16#1 a
W#16#FFF

db_param (Pági‐
na 6965)

Input

BLOC
K_DB

Número del DB de parámetros; contiene todos los datos
de conexión y de Modbus de esta instancia del bloque
Modbus

Depende de la
CPU

Sí

REG_KEY_DB (Pá‐
gina 6959)

Input

BLOC
K_DB

Bloque de datos con la clave de registro para la licencia

Depende de la
CPU

No

RECV_TIMEOUT
(Página 6966)

Input

TIME

Tiempo de vigilancia para la recepción de datos del inter‐ De T#20ms a T# No
locutor
+24d20h31m23s6
47ms
El tiempo mínimo ajustable es de 20 ms

6956

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

De‐
cla‐
ra‐
ción

Tipo
de da‐
tos

Descripción

Rango de valores

CONN_TIMEOUT
(Página 6966)

Input

TIME

Tiempo de vigilancia para el establecimiento de conexión
o la desconexión

De T#100ms a T# No
+24d20h31m23s6
47ms

El tiempo mínimo ajustable es de 100 ms
DISCONNECT (Pá‐
gina 6966)

Input

BOOL

Mediante este parámetro se controla el establecimiento
de la conexión y la desconexión del servidor Modbus:
S7 es cliente:
TRUE: tras recibir la trama de respuesta se efectúa la
desconexión

TRUE

Init

No

FALSE

S7 es servidor:
TRUE: si ENQ_ENR = FALSE se efectúa la desconexión
ENQ_ENR (Pági‐
na 6966)

Input

BOOL

S7 es cliente:
inicia la orden en caso de un flanco ascendente
● Las modificaciones de los parámetros de entrada no
se hacen efectivas hasta que se recibe una respuesta
del servidor o se emite un mensaje de error.

TRUE

No

FALSE

● Si durante una orden Modbus en curso se vuelve a
activar el parámetro ENQ_ENR, no se ejecutan más
transmisiones.
S7 es servidor:
listo para recepción con nivel positivo
LICENSED (Pági‐
na 6959)

Out‐
put

BOOL

Estado de licencia del bloque
El bloque tiene licencia
El bloque no tiene licencia

TRUE
FALSE

CONN_ESTABLIS‐
HED

Out‐
put

BOOL

Se establece la conexión al interlocutor

TRUE

La conexión al interlocutor está desconectada

FALSE

BUSY

Out‐
put

BOOL

Estado de ejecución de las funciones T (TCON, TDIS‐
CON, TSEND o TRCV)
una función T está en ejecución
una función T no está en ejecución

TRUE
FALSE

DONE_NDR

Out‐
put

BOOL

S7 es cliente:
TRUE: la orden activada terminó sin error
S7 es servidor:
TRUE: Se ejecutó y se respondió a la solicitud del cliente

ERROR

TRUE

No

No
No

No

FALSE

FALSE: Sin errores

FALSE

TRUE: Con errores. La causa del error se indica mediante
los parámetros STATUS.

TRUE

No

Out‐
put

BOOL

STATUS (Pági‐
na 6969)

Out‐
put

WORD Número de error o información de estado

STATUS_FUNC
(Página 6969)

Out‐
put

STRIN
G[8]

Nombre de la instrucción que ha causado el error en STA‐ Carácter
TUS

No

IDENT_CODE (Pá‐
gina 6959)

Out‐
put

STRIN
G[18]

Carácter
Número de identificación para la concesión de licencia
Con esta identificación puede solicitar el código de valida‐
ción REG_KEY (clave del Registro) para su licencia.

No

Init_Error (Pági‐
na 6969)

Out‐
put

BOOL

TRUE: se ha producido un error al inicializar.

No

Programación del PLC
Manual de programación y manejo, 11/2019

De 0 a FFFF

TRUE/FALSE

No

6957

Instrucciones
4.2 Instrucciones
Parámetro

De‐
cla‐
ra‐
ción

Tipo
de da‐
tos

Init_Status (Pági‐
na 6969)

Out‐
put

WORD Estado de la inicialización

UNIT (Página 6967)

InOut BYTE

InOut BYTE

DATA_TYPE (Pági‐
na 6967)

Descripción

Unit Identifier
(INPUT con función de cliente, OUTPUT con función de
servidor)
Tipo de datos que procesar:
(INPUT en la función de cliente, OUTPUT en la función de
servidor)
Coils
Inputs
Holding Register
Input Register

START_ADDRESS
(Página 6967)

InOut WORD Dirección inicial MODBUS

LENGTH (Pági‐
na 6967)

InOut WORD Número de valores que procesar (INPUT con función de
cliente, OUTPUT con función de servidor)

InOut BOOL

Init (Página 6965)

InOut BOOL

Init

De 0 a FFFF

No

De 0 a 255

No

De B#16#0 a
B#16#FF
No
1
2
3
4
De 0 a 65535

(INPUT en la función de cliente, OUTPUT en la función de
servidor)

WRITE_READ (Pá‐
gina 6967)

Rango de valores

No

De W#16#0000 a
W#16#FFFF
No

Coils
Función de lectura
Función de escritura

De 1 a 2000
De 1 a 1968

Inputs
Función de lectura

De 1 a 2000

Holding Register
Función de lectura
Función de escritura

De 1 a 125
De 1 a 123

Input Register
Función de lectura

De 1 a 125

Acceso de escritura o

TRUE

acceso de lectura
(INPUT con función de cliente, OUTPUT con función de
servidor)

FALSE

Inicialización en caso de flanco ascendente

TRUE/FALSE

No

No

Encontrará más información al respecto en Siemens Industry Online Support, en la FAQ con
el ID de artículo: 75330636 (https://support.industry.siemens.com/cs/es/es/view/75330636)

Consulte también
Puesta en marcha (Página 6947)

6958

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Licencia con los parámetros IDENT_CODE y REG_KEY_DB
Descripción
Se debe obtener una licencia individual de la instrucción MODBUSPN en cada CPU. La
licencia se concede en 2 pasos:
● lectura del IDENT_CODE y
● introducción del código de validación REG_KEY (clave del Registro).
Para ello, el OB121 debe estar presente en la CPU.
Para la lectura del IDENT_CODE proceda de la manera siguiente:
1. Parametrice la instrucción MODBUSPN de acuerdo con sus requisitos en un OB cíclico.
Cargue el programa en la CPU y póngala en RUN.
2. Abra el DB de instancia de la instrucción Modbus y haga clic en el botón "Observar todos".
3. En la salida IDENT_CODE se visualiza una cadena de caracteres de 18 dígitos.

Figura 4-45

Programación del PLC
Manual de programación y manejo, 11/2019

IDENT_CODE en el DB

6959

Instrucciones
4.2 Instrucciones
4. Copie este string mediante copiar/pegar desde el bloque de datos al formulario
SOFTWARE REGISTRATION FORM. Este formulario se encuentra en el CD de
instalación.
Introduzca el n.º de licencia del embalaje del producto en el formulario.

Figura 4-46

IDENT_CODE y formulario de licencia

5. Envíe el formulario mediante una Service Request (solicitud de servicio) al Customer
Support (https://support.industry.siemens.com/my/ww/en/requests/#createRequest).
Luego recibirá el código de validación para la CPU.
El código de validación REG_KEY se debe indicar en cada instrucción MODBUSPN. La clave
REG_KEY debe guardarse en un bloque de datos global a través del cual todas las
instrucciones MODBUSPN reciban el código de validación necesario.

6960

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para la introducción del código de validación REG_KEY proceda del modo siguiente:
● Mediante "Agregar nuevo bloque…" inserte un bloque de datos global nuevo con un
nombre simbólico unívoco, p. ej. "DB_Licencia".
● Defina un parámetro REG_KEY con el tipo de datos STRING[17] en este bloque.

Figura 4-47

REG_KEY en DB

● Copie el código de validación de 17 dígitos determinado mediante Copiar/Pegar en la
columna 'Valor de arranque'.
● Introduzca el número de bloque o el nombre del DB de licencia en el OB cíclico, en el
parámetro REG_KEY_DB de la instrucción MODBUSPN.
● Cargue los bloques modificados en la CPU. La introducción del código de validación se
puede realizar durante el tiempo de ejecución, no es necesario pasar de STOP -> RUN.
La comunicación Modbus/TCP a través de la instrucción MODBUSPN ahora tiene licencia
para esta CPU, el bit de salida LICENSED es TRUE.
Falta la concesión de licencia o esta es errónea
Si no se introdujo ningún código de validación o si es incorrecto, parpadea el SF-LED (en
S7-300 e IM151-8) o INTF-LED (en S7-400) de la CPU y se realiza cíclicamente una entrada
en el búfer de diagnóstico relativa a la falta de licencia. El número de error por falta de licencia
es W#16#A090.

Figura 4-48

Búfer de diagnóstico con A090

Programación del PLC
Manual de programación y manejo, 11/2019

6961

Instrucciones
4.2 Instrucciones

ADVERTENCIA
En caso de que el OB121 falte en el controlador, la CPU pasa al estado STOP.

En caso de que falte el código de validación o sea incorrecto, se procesa la comunicación
Modbus/TCP; sin embargo, en la salida STATUS se indica constantemente W#16#A090 "No
existe ninguna licencia válida". El bit de salida LICENSED es FALSE.

Consulte también
Descripción MODBUSPN (Página 6954)

Mapeo de dirección
Interpretación de las direcciones Modbus
El modelo de datos MODBUS contiene las áreas siguientes:
● Coils
● Inputs
● Holding Register
● Input Register
En algunos sistemas, como los PLC MODICON, la distinción de estas áreas de memoria se
realiza mediante la dirección de registro o la dirección de bit. Así por ejemplo, el Holding
Register con Offset 0 se denomina Registro 40001 (tipo de memoria 4xxxx, Reference 0001).
Siempre da lugar a confusión porque, en algunos manuales, se describe y se hace referencia
a la dirección de registro de Application Layers y, en otros, a la dirección de registro/dirección
de bit transmitida realmente en el protocolo.
La instrucción MODBUSPN utiliza, en sus parámetros start, end y START_ADDRESS la
dirección Modbus realmente transmitida. Por tanto, con cada código de función se pueden
transferir direcciones de registro/direcciones de bits de 0000H a FFFFH.

Ejemplo
Las direcciones Modbus se pueden indicar en formato decimal o hexadecimal en el DB de
parámetros.

6962

Parámetro

Notación decimal

Notación hexadeci‐
mal

Significado

data_type

3

B#16#3

Holding Register

db

11

W#16#B

DB 11

start

0

W#16#0

Dirección inicial: 0

end

499

W#16#1F3

Dirección final:

499

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
data_type

3

B#16#3

Holding Register

db

12

W#16#C

DB 12

start

720

W#16#2D0

Dirección inicial: 720

end

900

W#16#384

Dirección final:

900

En la siguiente figura se muestra una comparativa de las áreas de memoria SIMATIC con la
partición de memoria orientada a registro y a bit de los dispositivos Modbus. Se hace referencia
a la parametrización mencionada anteriormente.
En el dispositivo Modbus:
Las direcciones Modbus resaltadas en negro afectan al Data Link Layer, mientras que las
grises al Applikation Layer.
En SIMATIC:
Las direcciones SIMATIC representadas en la 1.ª columna son el Offset en el DB. Los números
de registro Modbus aparecen entre corchetes.

Programación del PLC
Manual de programación y manejo, 11/2019

6963

Instrucciones
4.2 Instrucciones

6964

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Figura 4-49

Mapeo de dirección

Consulte también
Descripción MODBUSPN (Página 6954)

Parameter id, db_param e Init
Descripción
id
Para cada conexión de la CPU PN a un interlocutor se requiere una ID de conexión. Si hay
varios interlocutores se debe utilizar una ID de conexión distinta para cada conexión lógica.
Esta ID de conexión se configura en el bloque de parámetros de conexión que contiene el
bloque de datos de parámetros. La ID de conexión describe unívocamente la conexión de la
CPU a su interlocutor y puede adoptar valores de 1 a 4095.
Aquí se debe introducir la ID de conexión del bloque de parámetros de conexión y debe ser
unívoca para toda la CPU.
db_param
El parámetro db_param indica el número del bloque de datos de parámetros. En este bloque
de datos de parámetros se guardan los parámetros específicos de conexión y de Modbus que
son necesarios para la comunicación entre la CPU PN y su interlocutor.
El rango de valores de este parámetro depende de la CPU. El número de DB 0 no se admite
ya que se reserva para el sistema.
La introducción del número de DB se realiza en texto explícito con el formato "DBxy".
Si se deben establecer varias conexiones, el bloque de datos de parámetros puede contener
los parámetros necesarios de todas las conexiones de forma secuencial. También es posible
crear un bloque de datos de parámetros aparte para cada conexión.
Init
El bloque Modbus se inicializa con un flanco ascendente en el parámetro Init. La inicialización
solo puede ejecutarse si no hay peticiones en curso. Esta condición debe garantizarse
programando ENQ_ENR = FALSE y BUSY = FALSE.
Nota
Al inicializar se interrumpen y restablecen las conexiones configuradas. Si se modifica el
parámetro id, las conexiones deben establecerse manualmente antes de inicializar con
DISCONNECT = TRUE.

Consulte también
Descripción MODBUSPN (Página 6954)
Bloque de datos de parámetros (Página 6949)

Programación del PLC
Manual de programación y manejo, 11/2019

6965

Instrucciones
4.2 Instrucciones

Parámetros RECV_TIMEOUT y CONN_TIMEOUT
Descripción
RECV_TIMEOUT
El tiempo de vigilancia RECV_TIMEOUT vigila la recepción de datos del interlocutor. Si se
rebasa el tiempo de vigilancia, se notifica un error y se deshace la conexión.
El valor mínimo es de 20 ms.
Si el RECV_TIMEOUT se establece en <20 ms en el modo de operación "S7 es cliente",
aparece el mensaje de error correspondiente y la petición activada se rechaza.
Si RECV_TIMEOUT se ajusta en <20 ms en el modo de operación "S7 es servidor", se utiliza
el valor predeterminado de 1,2 s. El RECV_TIMEOUT vigila el tiempo de ejecución del stream
TCP. La pausa entre cada solicitud del cliente no se toma en consideración.
CONN_TIMEOUT
El CONN_TIMEOUT indica el tiempo para la vigilancia del establecimiento de la conexión o la
desconexión. Si la conexión no pudo establecerse o desconectarse correctamente durante el
tiempo de vigilancia parametrizado, aparece el mensaje de error correspondiente en la salida
STATUS.
El valor mínimo es de 100 ms.
En el modo de operación "S7 es cliente" y si connect_at_startup = TRUE, un CONN_TIMEOUT
parametrizado demasiado bajo se ajusta al valor predeterminado de 5 s. En el funcionamiento
cíclico y si el CONN_TIMEOUT es demasiado bajo, se emite un mensaje de error y la petición
activada se rechaza.
Si el CONN_TIMEOUT se ajustó en <100 ms en el modo de operación "S7 es servidor", se
utiliza también el valor predeterminado de 5 s.

Consulte también
Descripción MODBUSPN (Página 6954)

Parámetros ENQ_ENR y DISCONNECT
Descripción
Modo de operación "S7 es cliente"
Con un flanco positivo en ENQ_ENR se inicia la transferencia de datos. El telegrama de
solicitud se genera con los valores de los parámetros de entrada UNIT, DATA_TYPE,
START_ADDRESS, LENGTH y WRITE_READ. Solo se puede enviar una nueva trama si la
trama anterior ya ha finalizado con DONE_NDR o ERROR.
Si no se estableció la conexión (CONN_ESTABLISHED = FALSE), primero se establece la
conexión y, a continuación, se realiza la transferencia de datos.
Si se ajusta el parámetro DISCONNECT = TRUE, se realiza la desconexión tras la
transferencia de datos.

6966

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Modo de operación "S7 es servidor"
Con un nivel positivo en la entrada ENQ_ENR se activa la instrucción. Se evalúan y se
responden las solicitudes del cliente. En caso de que no se haya establecido la conexión
estando ENQ_ENR activado (CONN_ESTABLISHED = FALSE), se activa el establecimiento
de conexión.
Si durante el funcionamiento ENQ_ENR pasa de TRUE a FALSE, se deshace la conexión si
está ajustado el parámetro DISCONNECT = TRUE.
Si hay una conexión existente y ENQ_ENR = FALSE se rechazan las solicitudes recibidas.

Consulte también
Descripción MODBUSPN (Página 6954)

Parámetros DATA_TYPE, START_ADDRESS, LENGTH, WRITE_READ y UNIT
Descripción
En el modo de operación "S7 es cliente" se trata de parámetros de entrada, mientras que en
el modo de operación "S7 es servidor", de parámetros de salida.
DATA_TYPE
El parámetro DATA_TYPE indica qué tipo de datos Modbus se procesa con la trama actual. Se
admiten los valores siguientes:
Tipo de datos Modbus

DATA_TYPE

Coils

B#16#1

Inputs

B#16#2

Holding Register

B#16#3

Input Register

B#16#4

Los distintos tipos de datos mantienen una relación directa con los códigos de función
utilizados.
Tipo de datos Mod‐ DATA_TYPE
bus

Función

Longitud

single_write

Código de función

Coils

1

leer

cualquiera

irrelevante

1

Coils

1

escribir

1

TRUE

5

Coils

1

escribir

1

FALSE

15

Coils

1

escribir

>1

irrelevante

15

Inputs

2

leer

cualquiera

irrelevante

2

Holding Register

3

leer

cualquiera

irrelevante

3

Holding Register

3

escribir

1

TRUE

6

Holding Register

3

escribir

1

FALSE

16

Holding Register

3

escribir

>1

irrelevante

16

Input Register

4

leer

cualquiera

irrelevante

4

Programación del PLC
Manual de programación y manejo, 11/2019

6967

Instrucciones
4.2 Instrucciones
START_ADDRESS
El parámetro START_ADDRESS determina la primera dirección MODBUS que se lee o se
escribe.
LENGTH
El parámetro LENGTH determina el número de valores MODBUS que se leen o se escriben.
En las funciones de lectura, para Holding e Input Register es posible un máximo de 125
registros por trama. Para Coils e Inputs es posible un máximo de 2000 bits.
En las funciones de escritura, en Holding Register, el número máximo es de 123 registros y en
Coils, de 1968 bits.
Los registros o valores de bit procesados con una trama de solicitud deben encontrarse dentro
de un bloque de datos.
WRITE_READ
Este parámetro define si se debe ejecutar una función de lectura o escritura. Si la entrada/
salida tiene el valor FALSE, se trata de una función de lectura. El valor TRUE define una
función de escritura.
Solo se pueden escribir Holding Register y Coils. Input Register e Inputs únicamente se
pueden leer.
UNIT
El parámetro UNIT, Unit Identifier, indica la asignación unívoca del interlocutor. Sobre todo, es
necesario si detrás de un convertidor se encuentran varios dispositivos serie a los que se
accede con distintos números de UNIT.
En la función "S7 es cliente" el parámetro UNIT es un parámetro de entrada. Esta entrada se
debe ajustar de acuerdo con los requisitos. La instrucción aplica este valor a la trama de
solicitud y lo verifica al recibir la respuesta.
En la función "S7 es servidor" el parámetro UNIT es un parámetro de salida. La instrucción
aplica el valor de la trama de solicitud a la trama de respuesta y lo muestra una vez terminada
la petición.
DONE_NDR
En el modo de operación "S7 es cliente" la petición activada terminó sin errores. En una función
de lectura, los datos de respuesta ya se introdujeron en el DB desde el servidor; en una función
de lectura, la respuesta se recibió en la trama de solicitud desde el servidor.
En el modo de operación "S7 es servidor" la salida muestra un intercambio de tramas con el
cliente finalizado sin errores. En los parámetros UNIT, DATA_TYPE, START_ADDRESS,
LENGTH y WRITE_READ se muestran los parámetros de petición del cliente. Estas salidas
solo son válidas siempre que esté activado DONE_NDR.

Consulte también
Descripción MODBUSPN (Página 6954)
Mapeo de dirección (Página 6962)

6968

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros ERROR, STATUS, STATUS_FUNC, Init_Error y Init_Status
Evaluación de errores
La instrucción MODBUSPN posee 3 salidas de estado para el diagnóstico de errores:
STATUS, STATUS_FUNC und Init_Status.
ERROR
Si se activó esta salida es que se detectó un error.
En el modo de operación "S7 es cliente" la petición activada finalizó con errores. El número de
error correspondiente se indica en la salida STATUS .
En el modo de operación "S7 es servidor“ se detectó un error en una trama de solicitud del
cliente o al enviar la trama de respuesta. El número de error correspondiente se indica en la
salida STATUS .
STATUS
En STATUS aparecen los mensajes de error y la información de estado mientras se procesan
los bloques. La instrucción MODBUSPN utiliza distintos bloques de sistema. Los mensajes de
error de estos bloques se transmiten inalterados a STATUS.
STATUS_FUNC
En STATUS_FUNC se muestra el nombre de la función que causó el error.
Init_Status
En la salida Init_Status se emiten mensajes de error e información de estado durante la
inicialización.
Más adelante, encontrará un listado de los mensajes de error específicos de las instrucciones.
Parámetro STATUS en STATUS_FUNC = "MODBUSPN" y parámetro Init_Status
STATUS*
(W#16#)

Descripción

Solución

A001

El bloque de datos de parámetros es demasiado corto.

Corrija la longitud del DB de pará‐
metros.

A002

El parámetro end es menor que el start.

Corrija las indicaciones en el DB de
parámetros.

A003

Un DB en el que se deben mapear direcciones MODBUS es demasiado
corto.
Longitud mínima:

Amplíe el DB.

● para registros: ( end - start + 1) * 2 + 2
● para valores de bits: (end - start) / 8 + 1 + 2
otras causas posibles:

S7 es cliente: corrija los paráme‐
tros de llamada START_AD‐
DRESS o LENGTH.
S7 es servidor: cambie la solicitud
delcliente.

● S7 es cliente: parámetros de llamada incorrectos
● S7 es servidor: rango de direcciones incorrecto en la trama de solicitud
del cliente. El S7 responde con una trama de excepción.

Programación del PLC
Manual de programación y manejo, 11/2019

6969

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

A004

Solo S7 es cliente:

A005

S7 es cliente: Se indicó un valor inadmisible en el parámetro LENGTH.

Solución

Corrija los parámetros de llamada.
Solo
se pueden escribir los tipos de
Se indicó una combinación inadmisible de DATA_TYPE y WRITE_READ.
datos 1 y 3.
S7 es cliente: corrija el parámetro
LENGTH.

S7 es servidor: el número de registros/bits en la trama de solicitud es
inadmisible. El S7 responde con una trama de excepción.

S7 es servidor: Cambie el número
en la trama de solicitud del cliente.

Rangos de valores: leer
Coils/Inputs: de 1 a 2000
escribir Coils: de 1 a 1968
leer Register: de 1 a 125
escribir Holding Register: de 1 a 123
A006

El área indicada mediante DATA_TYPE, START_ADDRESS y LENGTH
no existe en data_type de data_area_1 a data_area_8.
S7 es servidor: El S7 responde con una trama de excepción.

S7 es cliente: corrija la combina‐
ción DATA_TYPE, START_AD‐
DRESS y LENGTH.
S7 es servidor: cambie la solicitud
del Cliente o corrija la parametriza‐
ción en el DB de parámetros.

A007

Corrija la parametrización.
S7 es cliente: se parametrizó un tiempo de vigilancia no válido en
RECV_TIMEOUT o CONN_TIMEOUT. Para RECV_TIMEOUT debe intro‐
ducirse un valor >= 20 ms, para CONN_TIMEOUT >= 100 ms.

A009

S7 es cliente:
La Transaction Identifier TI que se recibió es distinta de la enviada.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

Se deshace la conexión de comunicación.
A00A

S7 es cliente:
La Unit Identifier UNIT que se recibió es distinta de la enviada.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A00B

S7 es cliente:
El código de función que se recibió es distinto del enviado.

S7 es cliente:
Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

S7 es servidor:
se recibió un código de función no válido. El S7 responde con una trama
de excepción.

A00C
A00D

A00E

S7 es servidor:
cambie la solicitud del cliente. La
instrucción MODBUSPN procesa
los códigos de función 1, 2, 3, 4, 5,
6, 15 y 16.

El número de bytes recibido no se corresponde con el número de registros. Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
Se deshace la conexión de comunicación.
mas.
Solo con S7 es cliente:
la dirección de registro/bit o el número de registros/bits en la trama de
respuesta es diferente al de la trama de solicitud.
La indicación de longitud del encabezado de trama específico de Modbus
no se corresponde con las indicaciones del número de registros/bits o del
número de bytes de la trama.
La instrucción rechaza todos los datos.
Se deshace la conexión de comunicación.

A00F

Se recibió un Protocol Identifier distinto de 0.
Se deshace la conexión de comunicación.

6970

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

Solución

A010

En el parámetro db de data_area_1 a data_area_8 se asignó doblemente
un número de DB.

Corrija la parametrización en el DB
de parámetros.

A011

En el parámetro de entrada DATA_TYPE se indicó un valor inadmisible
(los valores admitidos son 1, 2, 3 y 4).

Corrija los parámetros de llamada.

A012

Las áreas parametrizadas data_area_1 y data_area_2 se solapan

Corrija la parametrización.

A013

Las áreas parametrizadas data_area_1 y data_area_3 se solapan.

A014

Las áreas parametrizadas data_area_1 y data_area_4 se solapan.

A015

Las áreas parametrizadas data_area_1 y data_area_5 se solapan.

Las áreas de datos no deben dis‐
poner de ningún área común de di‐
recciones de registro.

A016

Las áreas parametrizadas data_area_1 y data_area_6 se solapan.

A017

Las áreas parametrizadas data_area_1 y data_area_7 se solapan.

A018

Las áreas parametrizadas data_area_1 y data_area_8 se solapan.

A019

Uno de los parámetros db se ajustó a 0, aunque el data_type pertinente
esté parametrizado con > 0.

Corrija la parametrización del pará‐
metro db a > 0.

A01A

Longitud incorrecta en el encabezado: se admiten de 1 a 253 bytes.
Se deshace la conexión de comunicación.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A01B

S7 es servidor y código de función 5:
se recibió un estado no válido para Coil.
El S7 responde con una trama de excepción.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A023

Las áreas parametrizadas data_area_2 y data_area_3 se solapan.

A024

Las áreas parametrizadas data_area_2 y data_area_4 se solapan.

Corrija la parametrización en el DB
de parámetros.

A025

Las áreas parametrizadas data_area_2 y data_area_5 se solapan.

A026

Las áreas parametrizadas data_area_2 y data_area_6 se solapan.

A027

Las áreas parametrizadas data_area_2 y data_area_7 se solapan.

A028

Las áreas parametrizadas data_area_2 y data_area_8 se solapan.

A034

Las áreas parametrizadas data_area_3 y data_area_4 se solapan.

A035

Las áreas parametrizadas data_area_3 y data_area_5 se solapan.

A036

Las áreas parametrizadas data_area_3 y data_area_6 se solapan.

A037

Las áreas parametrizadas data_area_3 y data_area_7 se solapan.

A038

Las áreas parametrizadas data_area_3 y data_area_8 se solapan.

A045

Las áreas parametrizadas data_area_4 y data_area_5 se solapan.

A046

Las áreas parametrizadas data_area_4 y data_area_6 se solapan.

A047

Las áreas parametrizadas data_area_4 y data_area_7 se solapan.

A048

Las áreas parametrizadas data_area_4 y data_area_8 se solapan.

A056

Las áreas parametrizadas data_area_5 y data_area_6 se solapan.

A057

Las áreas parametrizadas data_area_5 y data_area_7 se solapan.

A058

Las áreas parametrizadas data_area_5 y data_area_8 se solapan.

A067

Las áreas parametrizadas data_area_6 y data_area_7 se solapan.

A068

Las áreas parametrizadas data_area_6 y data_area_8 se solapan.

A078

Las áreas parametrizadas data_area_7 y data_area_8 se solapan.

A079

El DB de parámetros no contiene la ID de conexión indicada en el pará‐
metro id.

A07A

Se indicó un valor inadmisible en el parámetro id (rango de valores de 1 a
4095).

Programación del PLC
Manual de programación y manejo, 11/2019

Las áreas de datos no deben dis‐
poner de ningún área común de di‐
recciones de registro.

Corrija la parametrización en la en‐
trada id.

6971

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

Solución

A07B

La id indicada está duplicada en el DB de parámetros.

A07C

En el DB de parámetros se indicó un valor inadmisible en el parámetro
data_type (los valores admitidos van de 0 a 4).

Corrija la parametrización en el DB
de parámetros.

A07D

En el DB de parámetros, el parámetro data_type de la data_area_1 no
contiene ninguna entrada. La sección de parámetros „_1" es la sección
inicial y se debe parametrizar.

A07E

En db se indicó el número del DB de parámetros o el número del DB de
instancia de la instrucción MODBUSPN.

A07F

El DB indicado en el db_param no es un DB de parámetros Modbus. Se
modificó la información de longitud en el DBW0 o se indicó un DB inco‐
rrecto.

Corrija la parametrización en la en‐
trada db_param.

A080

La instrucción MODBUSPN no se ha inicializado todavía.

Después de transferir el IDB a la
CPU es preciso inicializar la ins‐
trucción MODBUSPN con Init =
TRUE.

A081

Solo con S7 es cliente y código de función 5:
Los datos de la trama de respuesta no son el eco de la solicitud.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A082

Solo con S7 es cliente y código de función 6:
El valor de registro recibido es distinto del que se envió.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A083

S7 es cliente: se lanzó una petición mientras la petición anterior aún es‐
taba en curso. No se ejecuta la petición.
Es una información de estado. El bit ERROR no está activado.

No lance una nueva petición hasta
que la petición anterior haya finali‐
zado con DONE _NDR = TRUE o
ERROR = TRUE.

Se ha intentado inicializar el bloque mientras hay una petición en curso o
mientras ENQ_ENR estaba activo.

Espere a que finalicen todas las
peticiones en curso antes de inicia‐
lizar. Ajuste ENQ_ENR = FALSE.

A084

No se pudo determinar ningún código de identificación IDENT_CODE pa‐ Diríjase al Product Support.
ra la concesión de licencia.

A085

Se produjo un error durante la determinación de licencia.

Compruebe si se realizaron acce‐
sos de escritura no permitidos al
DB de licencia. Dado el caso, dirí‐
jase al Product Support.

A086

Hubo el intento de escribir en un bloque de datos protegido contra escri‐
tura.

Quite la protección contra escritura
o utilice otro DB.

A090

El bloque aún no tiene licencia para esta CPU.
Consulte el IDENT_CODE de esta
Es una información de estado. El bit ERROR no está activado. La comu‐ CPU y solicite con él el código de
nicación Modbus también funciona sin licencia.
validación. Consulte "Concesión
de licencia (Página 6959)".

A091

Como respuesta se recibió una trama de excepción con código de excep‐ El interlocutor no soporta la función
ción 1 (solo con S7 es cliente).
requerida.

A092

Como respuesta se recibió una trama de excepción con código de excep‐ Corrija la longitud LENGTH o la
START_ADDRESS en la llamada
ción 2 (solo con S7 es cliente).
Se produjo el acceso a una dirección no existente/no admitida en el inter‐ de la instrucción.

locutor.
A093

6972

Como respuesta se recibió una trama de excepción con código de excep‐ El interlocutor no es capaz de pro‐
ción 3 (solo con S7 es cliente).
cesar la trama recibida (p. ej. no
soporta la longitud requerida).

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

Solución

A094

Como respuesta se recibió una trama de excepción con código de excep‐ El interlocutor se encuentra en un
ción 4 (solo con S7 es cliente).
estado en que no es capaz de pro‐
cesar la trama recibida.

A095

Como respuesta se recibió una trama de excepción con un código de
excepción desconocido (solo con S7 es cliente)

Controle los mensajes de error del
interlocutor y, dado el caso, com‐
pruebe los datos con un registro de
tramas.

A100

El tiempo de vigilancia CONN_TIMEOUT o RECV_TIMEOUT expiró para
una petición. La conexión se desconectará una vez transcurrido el
RECV_TIMEOUT.

Compruebe la parametrización de
la conexión.

A101

Ha expirado el tiempo de vigilancia interno de la función TDISCON.

Póngase en contacto con el Pro‐
duct Support.

Parámetro STATUS en STATUS_FUNC = 'BLKMOV', 'TEST_DB', 'RDSYSST' o 'WR_USMSG'
STATUS*
(W#16#)

Descripción

Solución

7xxx

Encontrará más información al respecto en la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

80B1

STATUS_FUNC = 'TEST_DB': El DB no existe en la CPU.

Todos los bloques de datos que se indi‐
caron en el db deben crearse y transfe‐
rirse a la CPU.

80B2

STATUS_FUNC = 'TEST_DB': DB UNLINKED

No generar el DB como UNLINKED.

8xxx

Encontrará más información al respecto en la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

Parámetro STATUS en STATUS_FUNC = 'TCON', 'TSEND', 'TRCV' o 'TDISCON'
STATUS*
(W#16#)

Descripción

Solución

7xxx

Consulte la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

8xxx

Consulte la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

Consulte también
Descripción MODBUSPN (Página 6954)

Programación del PLC
Manual de programación y manejo, 11/2019

6973

Instrucciones
4.2 Instrucciones

MODBUSPN V1
Información general
Generalidades
La instrucción MODBUSPN representa un producto de software para CPU con interfaz PN
integrada del SIMATIC S7-300, S7-400 y la CPU IM 151-8 PN/DP.
Con esta instrucción se posibilita la comunicación entre una CPU SIMATIC con interfaz PN
integrada y un dispositivo que soporte el protocolo Modbus/TCP .
La transferencia de datos se lleva a cabo según el principio de cliente-servidor.
SIMATIC S7 puede operar como cliente o como servidor durante la transferencia.

Instrucciones paso a paso
1. Asignación de la dirección IP de la CPU
2. Llamada de la instrucción MODBUSPN en los OB necesarios;
consulte Puesta en marcha (Página 6974)
3. Parametrización del DB de parámetros de acuerdo con los requisitos (ID, Número de
puerto, Cliente/Servidor, establecimiento de conexión en el rearranque, Registro Modbus,
áreas de DB, etc.);
consulte Bloque de datos de parámetros (Página 6976)
4. Parametrización del bloque Modbus para la inicialización y el tiempo de ejecución;
consulte Funcionamiento de la instrucción (Página 6982)
5. Carga del programa de usuario en la CPU y concesión de licencia del bloque Modbus para
esta CPU;
consulte Concesión de licencia (Página 6986)

Puesta en marcha
Requisitos y principios básicos
Es posible el uso de la instrucción MODBUSPN con STEP7 V13 (TIA Portal) o superior.
La instrucción MODBUSPN se creó tomando como base la Modbus Application Protocol
Specification V1.1b3, April 26, 2012 ; , consulte Página de inicio de Modbus (http://
www.modbus.org).

6974

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Llamada de la instrucción
La instrucción MODBUSPN se debe incorporar a dos OBs para que el programa se ejecute
correctamente:
● al OB100 de arranque y
● a un OB cíclico (OB1 o a un OB controlado por tiempo, p. ej. OB35)
Al hacerlo, debe utilizarse el mismo bloque de datos de instancia. No se permite la llamada
simultánea de la instrucción MODBUSPN en el OB1 y en un OB controlado por tiempo (p. ej.
OB35). El OB121 debe estar presente en la CPU. Para más información al respecto, consulte
Concesión de licencia (Página 6986).

Inserción del bloque Modbus
Abra el bloque "COMPLETE RESTART [OB100]". En caso de que no se encuentre entre los
bloques de programa, insértelo a través de "Agregar nuevo bloque > Bloque de organización
> Startup > COMPLETE RESTART [OB 100]".
La instrucción MODBUSPN está ubicada en la Task Card, paleta y carpeta "Instrucciones>
Comunicación > Otros". Abra allí la carpeta "MODBUS TCP" y arrastre la instrucción
MODBUSPN al bloque OB100.
Ahora, en "Bloques de sistema > Recursos de programa" se muestran, además de
MODBUSPN (FB70), las instrucciones subordinadas MOD_CLI (FB72), MOD_SERV (FB73) y
TCP_COMM (FB71) . Estas instrucciones no se pueden llamar adicionalmente en un OB. Se
siguen visualizando las instrucciones de comunicación TSEND (FB63), TRCV (FB64), TCON
(FB65) y TDISCON (FB66) llamadas internamente.
Abra el bloque “Main [OB1]" o un bloque cíclico y arrastre la instrucción MODBUSPN [FB70]
al OB. Seleccione el bloque de datos MODBUSPN_DB como bloque de datos de instancia en
la llamada del OB100. No se debe crear un bloque de datos de instancia nuevo.

Versiones de los bloques T
Tenga en cuenta que, para un perfecto funcionamiento de la instrucción MODBUSPN, se
necesita la versión correcta de los bloques T:
Si utiliza los bloques migrados en V13, necesitará las siguientes versiones en la librería Open
User Communication V2.5:
● TCON

V2.4

● TDISCON V2.1
● TSEND

V2.1

● TRCV

V2.2

Si utiliza los bloques integrados en V13, necesitará las siguientes versiones en la librería Open
User Communication V3.0:
● TCON

V3.0

● TDISCON V2.1
● TSEND

V3.0

● TRCV

V3.0

Programación del PLC
Manual de programación y manejo, 11/2019

6975

Instrucciones
4.2 Instrucciones
Si utiliza los bloques integrados en V13 SP1, necesitará las siguientes versiones en la librería
Open User Communication V4.0:
● TCON

V4.0

● TDISCON V2.1
● TSEND

V4.0

● TRCV

V4.0

Conexiones múltiples a cliente y servidor
Una CPU S7 puede admitir varias conexiones TCP, si bien el número máximo de conexiones
depende de la CPU utilizada. El total de conexiones de una CPU, incluidas las conexiones
Modbus/TCP, no debe exceder el número máximo de conexiones admitidas.

Uso del número de puerto 502
El protocolo Modbus/TCP pasa habitualmente por el puerto 502. Este número de puerto solo
es posible con las CPU PN que tengan una versión de firmware correcta. La información
relativa a la habilitación de los números de puerto se encuentra aquí: "¿Qué puertos se han
habilitado para la comunicación Modbus/TCP y cuántos clientes Modbus pueden comunicarse
con una CPU SIMATIC S7 como servidor Modbus? (http://
support.automation.siemens.com/WW/view/es/34010717)".
Determinados tipos de CPU pueden mantener y manejar paralelamente, a través del puerto
502 local, conexiones a varios clientes (multipuerto). Durante la parametrización, se deben
realizar los siguientes ajustes:
● CPU como servidor
● Puerto 502 como puerto local
● Conexión TCP no especificada
● Establecimiento de conexión pasivo
El número de conexiones que una CPU puede aceptar en el puerto 502 depende del
dispositivo y puede consultarse en los datos técnicos de la CPU. Para cada cliente que se
desee conectar con el puerto 502 del servidor, se requiere, respectivamente, 1 conexión
unívoca en el DB de parámetros y 1 instancia de bloque Modbus en el OB100 o el OB cíclico.

Bloque de datos de parámetros
Parametrización de la comunicación Modbus
Para la comunicación mediante la interfaz PN integrada de la CPU, no es necesario configurar
ninguna conexión en el editor de redes. Las conexiones se establecen o se deshacen con
ayuda de las instrucciones TCON y TDISCON.
Bloque de datos de parámetros
Los datos necesarios para el establecimiento de las conexiones y el procesamiento de las
tramas Modbus se definen en el tipo de datos PLC MB_PN_PARAM. Este tipo de datos PLC

6976

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
contiene una estructura para los datos específicos de conexión y otra para los parámetros
Modbus.
Para cada conexión con un interlocutor, se requiere 1 instancia del tipo de datos PLC en un
bloque de datos, en la que se definen los parámetros de conexión y los parámetros Modbus.
Para cada conexión adicional, el bloque de datos se puede ampliar o se puede crear un bloque
de datos nuevo.
Este o estos bloques de datos solo están previstos para los parámetros de conexión y Modbus,
por lo que en ellos no se pueden guardar otros parámetros.
Cada instancia de la instrucción "MODBUSPN" necesita una conexión unívoca. Por tanto,
establezca una estructura propia de la descripción de la conexión para cada instancia de la
instrucción.

Figura 4-50

Estructura Param_DB

Parámetros de conexión en la estructura "Connection settings"
En la 1.ª estructura "Connection settings" se definen los parámetros específicos de la
conexión, como p. ej. la interfaz de hardware utilizada localmente y la dirección IP del
interlocutor. Con ayuda de estos parámetros, las instrucciones TCON y TDISCON pueden
establecer o deshacer una conexión.
La estructura de datos del bloque de parámetros de conexión se debe respetar
obligatoriamente porque, de lo contrario, no se podrá establecer ninguna conexión.

Programación del PLC
Manual de programación y manejo, 11/2019

6977

Instrucciones
4.2 Instrucciones
Parámetros Modbus en la estructura "Modbus settings"
En la 2.ª estructura (los "Modbus settings") se almacenan los datos necesarios para el modo
de operación y la referencia de dirección, p. ej., las áreas Modbus que se mapean en los
bloques de datos y el modo de operación del S7 como servidor Modbus o cliente Modbus. La
estructura de datos de los parámetros Modbus se debe respetar para que sea posible el
procesamiento sin errores.
Configuración
Existen 2 opciones para llevar a cabo la configuración de los parámetros Modbus y de
conexión.
1. opción:
Cree un bloque de datos global nuevo y ábralo. Agregue un parámetro y seleccione el tipo
de datos MB_PN_PARAM para dicho parámetro. En caso de que este tipo de datos no se
muestre en la lista desplegable, introdúzcalo manualmente.
Esta opción permite insertar varias instancias en 1 bloque de datos.
2. opción:
Cree un bloque de datos nuevo mediante "Agregar nuevo bloque" y
seleccione MB_PN_PARAM como "Tipo". El bloque de datos nuevo se abre con la
estructura Modbus y de conexión insertada.
Este bloque de datos está protegido contra escritura. No se pueden agregar parámetros
adicionales. Es posible editar los parámetros existentes.
Cambio de valores
Los valores del bloque de datos de parámetros no se pueden cambiar durante el tiempo de
ejecución. Tras cambiar los parámetros, se debe rearrancar la CPU con STOP -> RUN.

Parámetros de conexión "Connection settings"
Parámetro

Descripción

block_length

Este parámetro indica la longitud de los parámetros de conexión y no se puede cambiar.
Valor fijo:

id

Rango de valores:
connection_type

W#16#40

Para cada conexión lógica se asigna una ID de conexión. Esta debe ser unívoca en todo el bloque
de datos de parámetros. La ID se indica en la llamada de la instrucción MODBUSPN y se utiliza
en las llamadas internas de los bloques T (TCON, TSEND, TRCV y TDISCON).
W#16#1 a W#16#FFF

Aquí se define el tipo de conexión para el establecimiento de esta mediante la instrucción TCON.
El valor que debe ajustarse depende de la CPU.
TCP (modo de compatibilidad):
B#16#01 para CPU 315 o 317 <= FW V2.3
TCP:
B#16#11 para CPU 315 o 317 >= FW V2.4, IM 151-8 PN/DP CPU, CPU314C, CPU319, CPU412,
CPU414, CPU416 y WinAC RTX
Estos datos pueden variar según el firmware utilizado.

active_est

Este parámetro indica el tipo de establecimiento de la conexión, activo o pasivo. El cliente Mod‐
bus asume el establecimiento de conexión activo y el servidor Modbus el pasivo.
Establecimiento activo de la conexión:
TRUE
Establecimiento pasivo de la conexión: FALSE

6978

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Descripción

local_device_id

La local_device_id define la interfaz IE de la CPU PN utilizada. Según el tipo de CPU PN se
requieren distintos ajustes.
IM 151-8 PN/DP CPU, WinAC RTX,
IF 1:
CPU 314C, 315 o 317:
CPU 319:
CPU 412, 414 o CPU 416
WinAC RTX, IF 2
WinAC RTX, IF 3
WinAC RTX, IF 4

B#16#1
B#16#2
B#16#3
B#16#5
B#16#6
B#16#B
B#16#F

local_tsap_id_len

Se indica la longitud del parámetro local_tsap_id (= número de puerto local).
Establecimiento activo de la conexión:
0
Establecimiento pasivo de la conexión: 2

rem_subnet_id_len

Este parámetro no se usa actualmente y debe estar ocupado por B#16#0.

rem_staddr_len

Se indican la longitud del parámetro rem_staddr, es decir, la dirección IP del interlocutor. Si se
debe comunicar mediante una conexión no especificada, no se indica ninguna dirección IP para
el interlocutor.
Conexión no especificada: B#16#0
Conexión especificada:
B#16#4

rem_tsap_id_len

Este parámetro define la longitud del parámetro rem_tsap_id, el número de puerto del interlocutor
remoto.
Establecimiento activo de la conexión:
2
Establecimiento pasivo de la conexión: 0

next_staddr_len

Aquí se define la longitud del parámetro next_staddr.
Con interfaz PN: B#16#0

local_tsap_id

Con este parámetro se ajusta el número de puerto local. El modo de representación se distingue
en función del parámetro connection_type. El rango de valores depende de la CPU. El número de
puerto debe ser unívoco en la CPU.

rem_subnet_id

Con connection_type B#16#01:
local_tsap_id[1]
local_tsap_id[2]
local_tsap_id[3-16]

low byte del n.º de puerto en formato hexadecimal
high byte del n.º de puerto en formato hexadecimal
B#16#00

Con connection_type B#16#11:
local_tsap_id[1]
local_tsap_id[2]
local_tsap_id[3-16]

high byte del n.º de puerto en formato hexadecimal
low byte del n.º de puerto en formato hexadecimal
B#16#00

Este parámetro no se usa actualmente y debe estar ocupado por 0.

Programación del PLC
Manual de programación y manejo, 11/2019

6979

Instrucciones
4.2 Instrucciones
Parámetro

Descripción

rem_staddr

En este array de bytes se introduce la dirección IP del interlocutor remoto. En el caso de una
conexión no especificada no se introduce ninguna dirección IP. El modo de representación se
distingue en función del parámetro connection_type. Ejemplo: Dirección IP 192.168.0.1:

rem_tsap_id

Para connection_type B#16#01:
rem_staddr[1] =
rem_staddr[2] =
rem_staddr[3] =
rem_staddr[4] =
rem_staddr[5-6]=

B#16#01 (1)
B#16#00 (0)
B#16#A8 (168)
B#16#C0 (192)
B#16#00 (reservado)

Con connection_type B#16#11:
rem_staddr[1] =
rem_staddr[2] =
rem_staddr[3] =
rem_staddr[4] =
rem_staddr[5-6]=

B#16#C0 (192)
B#16#A8 (168)
B#16#00 (0)
B#16#01 (1)
B#16#00 (reservado)

Con este parámetro se ajusta el remote número de puerto. El modo de representación se dis‐
tingue en función del parámetro connection_type. El rango de valores depende de la CPU.
Con connection_type B#16#01:
rem_tsap_id[1]
rem_tsap_id[2]
rem_tsap_id[3-16]

low byte del n.º de puerto en formato hexadecimal
low byte del n.º de puerto en formato hexadecimal
B#16#00

Con connection_type B#16#11:
rem_tsap_id[1]
rem_tsap_id[2]
rem_tsap_id[3-16]

high byte del n.º de puerto en formato hexadecimal
low byte del n.º de puerto en formato hexadecimal
B#16#00

next_staddr

Este parámetro indica el número de rack y de slot del CP utilizado. Al usar la interfaz PN integrada
de la CPU este parámetro se debe poner a 0.
next_staddr[1-6]
B#16#00

spare

Este parámetro no se usa y debe estar predeterminado con 0.

Parámetros Modbus "Modbus settings"
Parámetro

Descripción

server_client

TRUE:
FALSE:

single_write

En el modo de operación "S7 es cliente", con el parámetro single_write = TRUE en las peti‐
ciones de escritura de longitud 1, se utilizan los códigos de función 5 y 6.

S7 es servidor
S7 es cliente

Si es single_write = FALSE, en todas las peticiones de escritura se utilizan los códigos de
función 15 y 16.
connect_at_startup

Con ello se determina el momento en que se establece la conexión.
Si connect_at_startup se pone a TRUE, la conexión se establece directamente tras el rearran‐
que de la CPU. En este caso, no se puede emitir ninguna petición de datos hasta que se haya
establecido correctamente la conexión (CONN_ESTABLISHED = TRUE) o hasta que aparezca
un error correspondiente en ERROR y STATUS_CONN.
FALSE:
establecimiento de la conexión con ENQ_ENR
TRUE activado:
Establecimiento de la conexión directamente después de reinicio

6980

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Descripción

8 áreas de datos

Se ofrecen 8 áreas de datos para mapear las direcciones MODBUS en la memoria S7. Se debe
definir, al menos, la primera área de datos, las 7 áreas de datos restantes son opcionales. En
las áreas de datos se lee o se escribe según el tipo de petición.
Con una petición siempre se puede leer un solo DB / escribir en un solo DB. Los accesos a
registros o valores de bit que se encuentren en varios DB, aunque los números sean directa‐
mente correlativos, se deben repartir entre dos peticiones. Esto se debe tener presente durante
la configuración.
Es posible mapear más áreas Modbus (registros o valores de bit) en un bloque de datos que las
que se pueden procesar con una trama.

data_type

db

Con el parámetro data_type se indica qué tipos de datos MODBUS se mapean en el bloque de
datos. Si se introduce el valor 0 en data_type, no se utilizará el área de datos correspondiente.
Identificación

Tipo de datos

Ancho de datos

0
1
2
3
4

Área no utilizada
Coils
Inputs
Holding Registers
Input Registers

Bit
Bit
Word
Word

El parámetro db especifica el bloque de datos en que se mapean los registros MODBUS o
valores de bit definidos seguidamente. El número de DB 0 no está permitido, ya que se reserva
para el sistema.
Número de DB

de 1 a 65535 (de W#16#0001 a W#16#FFFF)

El bloque de datos debe crearse 2 bytes más largo de lo que es necesario para los datos
parametrizados. Los dos últimos bytes se usan para fines internos.
start
end

Con start se indica la primera dirección Modbus que se mapea en la palabra de datos 0 del DB.
El parámetro end define la dirección de la última dirección MODBUS.
Al acceder a registros, el número de la palabra de datos del DB S7 en que se introduce la última
dirección Modbus se calcula según la fórmula siguiente:
Número DBW = (end – start) * 2
Al acceder a bits, el número del byte de datos del DB S7 en que se introduce la última dirección
Modbus se calcula según la fórmula siguiente:
Número DBB = (end – start + 7) / 8
Las áreas de datos definidas no pueden solaparse. El parámetro end no puede ser menor que
start. En caso de fallo, el arranque de la instrucción termina con error. Si ambos valores coin‐
ciden, se asigna 1 dirección Modbus (1 registro o 1 valor de bit).
Ejemplo de la mapeo de las direcciones MODBUS en las áreas de memoria de S7.
MODBUS Dirección

de 0 a 65535 (de W#16#0000 a W#16#FFFF)

internal_send_buffer

Este array se usa internamente en la instrucción para los datos enviados. No se permiten
accesos ni modificaciones en esta área.

internal_recv_buffer

Este array se usa internamente en la instrucción para los datos recibidos. No se permiten
accesos ni modificaciones en esta área.

Programación del PLC
Manual de programación y manejo, 11/2019

6981

Instrucciones
4.2 Instrucciones

Descripción MODBUSPN
Descripción
La instrucción MODBUSPN permite establecer la comunicación entre una CPU con interfaz
PN integrada y un interlocutor que soporte el protocolo Modbus/TCP. Se soportan los códigos
de función 1, 2, 3, 4, 5, 6, 15 y 16. Según la parametrización, la instrucción puede operar como
cliente (S7 es cliente) o como servidor (S7 esservidor). Mediante la instrucción MODBUSPN
se establece una conexión entre los interlocutores, se realiza la transferencia de datos y se
controla el establecimiento de conexión.
Durante la transferencia de datos se ejecutan las acciones siguientes:
● Generación del encabezado de trama específico de MODBUS durante el envío
● Comprobación del encabezado de trama específico de MODBUS durante la recepción
● Comprobación de la existencia de las áreas de datos a las que accede el cliente
● Generación de tramas de excepción cuando aparece un error (solo cuando S7 es servidor)
● Transferencia de datos del/al bloque de datos parametrizado
Además, se efectúa una vigilancia temporal del establecimiento de conexión y de la
desconexión, así como de la recepción de datos.
La instrucción MODBUSPN V1.0 se puede usar tanto para el S7-300 como para el S7-400. La
conexión se realiza mediante la interfaz local de la CPU. Para utilizar esta instrucción no se
requiere ningún módulo de hardware adicional.

Funcionamiento de la instrucción
Arranque
La instrucción MODBUSPN se llama una sola vez en el OB100.
● Los parámetros de inicialización deben estar inicializados de acuerdo con la configuración
del sistema.
● Los parámetros de inicialización se adoptan en el DB de instancia.
● Los parámetros de tiempo de ejecución no se evalúan en el arranque.
● Se comprueba la coherencia de los datos procedentes del bloque de datos de parámetros.
Funcionamiento cíclico
En modo cíclico, la instrucción MODBUSPN se llama en el OB1 o en el OB de alarma cíclica.
● Las funciones del bloque se activan en función de los parámetros de tiempo de ejecución.
● Mientras una petición está en curso, no se evalúan las modificaciones de los parámetros de
tiempo de ejecución.
● Los parámetros de inicialización no se evalúan.
Rearranque durante la puesta en marcha
Durante la puesta en marcha, el rearranque repetido de la CPU puede resultar muy difícil tras
modificar los parámetros de inicialización. Mediante el ajuste manual del parámetro "Init_Start"

6982

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
existente en la sección estática, se puede ejecutar la sección del programa para rearranque del
bloque Modbus. Durante la inicialización manual no puede haber ninguna petición en curso.
Para la inicialización correcta, todos los parámetros de inicialización se deben parametrizar en
el OB cíclico.
Procesamiento de la conexión
El cliente Modbus ejecuta el establecimiento de conexión activo. Los datos necesarios se
obtienen de los parámetros de conexión del bloque de datos de parámetros.
Mediante un parámetro del bloque de parámetros de conexión (active_est) se determina si la
CPU PN debe actuar como interlocutor activo o pasivo.
En ambos tipos de conexión, activo y pasivo, con la instrucción TCON se abre un canal de
comunicación con el interlocutor durante el tiempo de ejecución.
El momento del establecimiento de conexión se especifica con el parámetro
connect_at_startup en el bloque de datos de parámetros.
La desconexión se controla con el parámetro DISCONNECT en la instrucción MODBUSPN.

Lanzamiento de petición con "S7 es cliente" o activación de la instrucción con "S7 es servidor"
Los parámetros de salida son indicadores dinámicos y solo se aplican a 1 ciclo de la CPU. Para
poderlos procesar posteriormente o visualizarlos en la tabla de observación, se deben copiar
en otras áreas de memoria.
S7 es cliente: Lanzamiento de petición
Mediante un cambio de flanco positivo en la entrada de disparo ENQ_ENR se activa una
petición. En función de los parámetros de entrada UNIT, DATA_TYPE, START_ADDRESS,
LENGTH, TI y WRITE_READ se genera una trama de solicitud MODBUS y se envía a la
estación interlocutora mediante la conexión TCP/IP. El cliente espera, durante el tiempo
parametrizado RECV_TIME, a una respuesta del servidor.
Si se rebasa el tiempo (ninguna respuesta del servidor) la petición activada termina con error.
Se puede iniciar una nueva petición.
Tras recibirse la trama de respuesta se realiza una comprobación de coherencia. Si el
resultado de dicha comprobación es positivo, se llevan a cabo las acciones necesarias y la
petición termina sin error; se activa la salida DONE_NDR. Si se detectaron errores durante la
verificación, la petición termina con error, se activa el bit ERROR y se indica un número de error
en STATUS_MODBUS.
S7 es servidor: Activación de la instrucción
Mediante un nivel positivo en la entrada de disparo ENQ_ENR, la instrucción está lista para
recibir una trama de solicitud del cliente. El servidor se comporta pasivamente y espera una
trama del cliente. Se verifica la trama recibida. Si el resultado de la comprobación es positivo,
se responde a la trama de solicitud. El intercambio de tramas finalizado se comunica al usuario
mediante la activación del bit DONE_NDR. En ese momento, se visualiza la función ejecutada
en las salidas UNIT, DATA_TYPE, START_ADDRESS, LENGTH, TI y WRITE_READ.
Una trama de solicitud errónea da lugar a un mensaje de error. Se activa el bit ERROR, en el
STATUS_MODBUS se indica el número de error y la solicitud del cliente no se procesa. Según
el error se envía una trama de excepción al cliente.

Programación del PLC
Manual de programación y manejo, 11/2019

6983

Instrucciones
4.2 Instrucciones

Parámetros
La tabla siguiente muestra los parámetros de la instrucción "MODBUSPN":
Parámetro

Decla‐ Tipo de
ración datos

Descripción

Rango de valo‐
res

ID (Página 6993)

Input

ID de conexión, debe ser idéntica al respectivo parámetro id
en el DB de parámetros

de 1 a 4095

WORD

de W#16#1 a
W#16#FFF

DB_PARAM (Pági‐
na 6993)

Input

BLOCK_ Número del DB de parámetros
DB

Depende de la
CPU

RECV_TIME (Pági‐
na 6993)

Input

TIME

De T#20ms a
T#
+24d20h31m2
3s647ms

Tiempo de vigilancia para la recepción de datos del interlo‐
cutor
El tiempo mínimo ajustable es de 20 ms

CONN_TIME (Pági‐
na 6993)

Input

TIME

Tiempo de vigilancia para el establecimiento de conexión o
la desconexión
El tiempo mínimo ajustable es de 100 ms

KEEP_ALIVE

Input

TIME

no utilizado

ENQ_ENR (Pági‐
na 6994)

Input

BOOL

S7 es cliente:
Lanzamiento de petición con flanco positivo
● Las modificaciones de los parámetros de entrada no se
hacen efectivas hasta que hay respuesta del servidor o
hasta que se devuelve un mensaje de error.

De T#100ms a
T#
+24d20h31m2
3s647ms
TRUE
FALSE

● Si durante una petición Modbus en curso se vuelve a
activar el parámetro ENQ_ENR, a continuación no se
ejecuta ninguna otra transferencia.
S7 es servidor:
listo para recepción con nivel positivo
DISCONNECT (Pági‐
na 6994)

Input

BOOL

Mediante este parámetro se controla el establecimiento de
conexión y la desconexión con el servidor Modbus:
S7 es cliente:
TRUE: tras recibir la trama de respuesta se efectúa la des‐
conexión

TRUE
FALSE

S7 es servidor:
TRUE: si ENQ_ENR = FALSE se efectúa la desconexión
STRIN
G[17]

Clave del Registro (código de validación) para la concesión
de licencia

Carácter

REG_KEY (Pági‐
na 6986)

Input

LICENSED (Pági‐
na 6986)

Output BOOL

Estado de licencia del bloque
El bloque tiene licencia
El bloque no tiene licencia

TRUE
FALSE

BUSY

Output BOOL

Estado de ejecución de las funciones T (TCON, TDISCON,
TSEND o TRCV)
una función T está en ejecución
una función T no está en ejecución

TRUE
FALSE

Se establece la conexión al interlocutor

TRUE

La conexión al interlocutor está desconectada

FALSE

CONN_ESTABLISHED

6984

Output BOOL

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Decla‐ Tipo de
ración datos

Descripción

Rango de valo‐
res

DONE_NDR

Output BOOL

S7 es cliente:
TRUE: la petición activada terminó sin error

TRUE

S7 es servidor:
TRUE: Se ejecutó y respondió la solicitud del cliente
ERROR

Output BOOL

FALSE

FALSE: Sin errores

FALSE

TRUE: Con errores. La causa del error se indica mediante
los parámetros STATUS_MODBUS y STATUS_CONN.

TRUE

STATUS_MODBUS
(Página 6997)

Output WORD

Número de error para errores de protocolo en el procesa‐
miento de las tramas Modbus

de 0 a FFFF

STATUS_CONN (Pági‐
na 6997)

Output WORD

Número de error para errores de conexión en el procesa‐
miento de funciones T (TCON, TSEND, TRCV, TDISON)

de 0 a FFFF

STATUS_FUNC (Pági‐
na 6997)

Output STRIN
G[8]

Nombre de la instrucción que ha causado el error en STA‐
TUS_MODBUS o STATUS_CONN

Carácter

IDENT_CODE (Pági‐
na 6986)

Output STRIN
G[18]

Número de identificación para la concesión de licencia
Con esta identificación puede solicitar el código de valida‐
ción REG_KEY (clave del Registro) para su licencia.

Carácter

UNIT (Página 6995)

InOut

BYTE

de 0 a 255
Unit Identifier
(INPUT con función de cliente, OUTPUT con función de ser‐ De B#16#0 a
vidor)
B#16#FF

DATA_TYPE (Pági‐
na 6995)

InOut

BYTE

Tipo de datos que procesar:
(INPUT con función de cliente, OUTPUT con función de ser‐
vidor)
Coils
Inputs
Holding Register
Input Register

START_ADDRESS (Pá‐ InOut
gina 6995)

WORD

LENGTH (Página 6995)

WORD

InOut

Dirección inicial MODBUS

1
2
3
4
de 0 a 65535

(INPUT con función de cliente, OUTPUT con función de ser‐ De
vidor)
W#16#0000 a
W#16#FFFF

Programación del PLC
Manual de programación y manejo, 11/2019

Número de valores que procesar (INPUT con función de
cliente, OUTPUT con función de servidor)
Coils
Función de lectura
Función de escritura

De 1 a 2000
De 1 a 1968

Inputs
Función de lectura

De 1 a 2000

Holding Register
Función de lectura
Función de escritura

De 1 a 125
De 1 a 123

Input Register
Función de lectura

De 1 a 125

6985

Instrucciones
4.2 Instrucciones
Parámetro

Decla‐ Tipo de
ración datos

Descripción

Rango de valo‐
res

TI (Página 6995)

InOut

Transaction Identifier
(INPUT en función de cliente, OUTPUT con función de ser‐
vidor)

de 0 a 65535

Acceso de escritura o

TRUE

WRITE_READ (Pági‐
na 6995)

InOut

WORD

BOOL

De W#16#0 a
W#16#FFFF

acceso de lectura
FALSE
(INPUT con función de cliente, OUTPUT con función de ser‐
vidor)

Consulte también
Puesta en marcha (Página 6974)

Concesión de licencia con los parámetros IDENT_CODE y REG_KEY
Descripción
Se debe obtener una licencia individual de la instrucción MODBUSPN en cada CPU. La
licencia se concede en 2 pasos:
● lectura del IDENT_CODE y
● introducción del código de validación REG_KEY (clave del Registro).
Para ello, el OB121 debe estar presente en la CPU.
Para la lectura del IDENT_CODE proceda de la manera siguiente:
1. Parametrice la instrucción MODBUSPN de acuerdo con sus requisitos en un OB cíclico y
en el OB100. Cargue el programa en la CPU y póngala en RUN.
2. Abra el DB de instancia de la instrucción Modbus y haga clic en el botón "Observar todos".

6986

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
3. En la salida IDENT_CODE se visualiza una cadena de caracteres de 18 dígitos.

Figura 4-51

Programación del PLC
Manual de programación y manejo, 11/2019

IDENT_CODE en el DB

6987

Instrucciones
4.2 Instrucciones
4. Copie este string mediante copiar/pegar desde el bloque de datos al formulario
SOFTWARE REGISTRATION FORM. Este formulario se encuentra en el CD de
instalación.
Introduzca el n.º de licencia del embalaje del producto en el formulario.

Figura 4-52

IDENT_CODE y formulario de licencia

5. Envíe el formulario mediante una Service Request (solicitud de servicio) al Customer
Support (https://support.industry.siemens.com/my/ww/en/requests/#createRequest).
Luego recibirá el código de validación para la CPU.
El código de validación REG_KEY se debe indicar en cada instrucción MODBUSPN. La clave
REG_KEY debe guardarse en un bloque de datos global a través del cual todas las
instrucciones MODBUSPN reciban el código de validación necesario.

6988

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para la introducción del código de validación REG_KEY proceda del modo siguiente:
● Mediante "Agregar nuevo bloque…" inserte un bloque de datos global nuevo con un
nombre simbólico unívoco, p. ej. "DB_Licencia".
● Defina un parámetro REG_KEY con el tipo de datos STRING[17] en este bloque.

Figura 4-53

REG_KEY en DB

● Copie el código de validación de 17 dígitos determinado mediante Copiar/Pegar en la
columna 'Valor de arranque'.
● En el OB cíclico, en el parámetro REG_KEY de la instrucción MODBUSPN, introduzca el
valor "DB_Licencia.REG_KEY".
● Cargue los bloques modificados en la CPU. La introducción del código de validación se
puede realizar durante el tiempo de ejecución, no es necesario pasar de STOP -> RUN.
La comunicación Modbus/TCP a través de la instrucción MODBUSPN ahora tiene licencia
para esta CPU, el bit de salida LICENSED es TRUE.
Falta la concesión de licencia o esta es errónea
Si no se introdujo ningún código de validación o si es incorrecto, parpadea el SF-LED (en
S7-300 e IM151-8) o INTF-LED (en S7-400) de la CPU y se realiza cíclicamente una entrada
en el búfer de diagnóstico relativa a la falta de licencia. El número de error por falta de licencia
es W#16#A090.

Figura 4-54

Búfer de diagnóstico con A090

Programación del PLC
Manual de programación y manejo, 11/2019

6989

Instrucciones
4.2 Instrucciones

ADVERTENCIA
En caso de que el OB121 falte en el controlador, la CPU pasa al estado STOP.

En caso de que falte el código de validación o sea incorrecto, se procesa la comunicación
Modbus/TCP; sin embargo, en la salida STATUS_MODBUS se muestra constantemente
W#16#A090 "No existe ninguna licencia válida". El bit de salida LICENSED es FALSE.

Consulte también
Descripción MODBUSPN (Página 6982)

Mapeo de dirección
Interpretación de las direcciones Modbus
El modelo de datos MODBUS contiene las áreas siguientes:
● Coils
● Inputs
● Holding Register
● Input Register
En algunos sistemas, como los PLC MODICON, la distinción de estas áreas de memoria se
realiza mediante la dirección de registro o la dirección de bit. Así por ejemplo, el Holding
Register con Offset 0 se denomina Registro 40001 (tipo de memoria 4xxxx, Reference 0001).
Siempre da lugar a confusión porque, en algunos manuales, se describe y se hace referencia
a la dirección de registro de Application Layers y, en otros, a la dirección de registro/dirección
de bit transmitida realmente en el protocolo.
La instrucción MODBUSPN utiliza, en sus parámetros start, end y START_ADDRESS la
dirección Modbus realmente transmitida. Por tanto, con cada código de función se pueden
transferir direcciones de registro/direcciones de bits de 0000H a FFFFH.

Ejemplo
Las direcciones Modbus se pueden indicar en formato decimal o hexadecimal en el DB de
parámetros.

6990

Parámetro

Notación decimal

Notación hexadeci‐
mal

Significado

data_type

3

B#16#3

Holding Register

db

11

W#16#B

DB 11

start

0

W#16#0

Dirección inicial: 0

end

499

W#16#1F3

Dirección final:

499

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
data_type

3

B#16#3

Holding Register

db

12

W#16#C

DB 12

start

720

W#16#2D0

Dirección inicial: 720

end

900

W#16#384

Dirección final:

900

En la siguiente figura se muestra una comparativa de las áreas de memoria SIMATIC con la
partición de memoria orientada a registro y a bit de los dispositivos Modbus. Se hace referencia
a la parametrización mencionada anteriormente.
En el dispositivo Modbus:
Las direcciones Modbus resaltadas en negro afectan al Data Link Layer, mientras que las
grises al Applikation Layer.
En SIMATIC:
Las direcciones SIMATIC representadas en la 1.ª columna son el Offset en el DB. Los números
de registro Modbus aparecen entre corchetes.

Programación del PLC
Manual de programación y manejo, 11/2019

6991

Instrucciones
4.2 Instrucciones

6992

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Figura 4-55

Mapeo de dirección

Consulte también
Descripción MODBUSPN (Página 6982)

ID de parámetro y DB_PARAM
Descripción
ID
Para cada conexión de la CPU PN a un interlocutor se requiere una ID de conexión. Si hay
varios interlocutores se debe utilizar una ID de conexión distinta para cada conexión lógica.
Esta ID de conexión se configura en el bloque de parámetros de conexión que contiene el
bloque de datos de parámetros. La ID de conexión describe unívocamente la conexión de la
CPU a su interlocutor y puede adoptar valores de 1 a 4095.
Aquí se debe introducir la ID de conexión del bloque de parámetros de conexión y debe ser
unívoca para toda la CPU.
DB_PARAM
El parámetro DB_PARAM indica el número del bloque de datos de parámetros. En este bloque
de datos de parámetros se guardan los parámetros específicos de conexión y de Modbus que
son necesarios para la comunicación entre la CPU PN y su interlocutor.
El rango de valores de este parámetro depende de la CPU. El número de DB 0 no se admite
ya que se reserva para el sistema.
La introducción del número de DB se realiza en texto explícito con el formato "DBxy".
Si se deben establecer varias conexiones, el bloque de datos de parámetros puede contener
los parámetros necesarios de todas las conexiones de forma secuencial. También es posible
crear un bloque de datos de parámetros aparte para cada conexión.

Consulte también
Descripción MODBUSPN (Página 6982)
Bloque de datos de parámetros (Página 6976)

Parámetros RECV_TIME y CONN_TIME
Descripción
RECV_TIME
El tiempo de vigilancia RECV_TIME vigila la recepción de datos de su interlocutor. Si se rebasa
el tiempo de vigilancia, se notifica un error y se deshace la conexión.
El valor mínimo es de 20 ms.

Programación del PLC
Manual de programación y manejo, 11/2019

6993

Instrucciones
4.2 Instrucciones
Si en el modo de operación "S7 es cliente" el RECV_TIME se ajusta a < 20 ms, aparece el
mensaje de error correspondiente y se deniega la petición activada.
Si en el modo de operación "S7 es servidor" el RECV_TIME se ajusta a < 20 ms, se utiliza el
valor predeterminado de 1,2 s. El RECV_TIME vigila el tiempo de ejecución de la secuencia
TCP. La pausa entre cada solicitud del cliente no se toma en consideración.
CONN_TIME
El CONN_TIME indica el tiempo de vigilancia de establecimiento de la conexión o de la
desconexión. Si dentro del tiempo de vigilancia parametrizado la conexión o desconexión no
se realizan satisfactoriamente, aparece un mensaje de error en la salida STATUS_CONN.
El valor mínimo es de 100 ms.
En el modo de operación "S7 es cliente", con connect_at_startup = TRUE un CONN_TIME
insuficiente se ajusta al valor predeterminado de 5 s. En funcionamiento cíclico, si el
CONN_TIME es demasiado corto, se emite un mensaje de error y se deniega la petición
activada.
Si en el modo de operación "S7 es servidor" el CONN_TIME se ajustó a < 100 ms, se utiliza
igualmente el valor predeterminado de 5 s.

Consulte también
Descripción MODBUSPN (Página 6982)

Parámetros ENQ_ENR y DISCONNECT
Descripción
Modo de operación "S7 es cliente"
Con un flanco positivo en ENQ_ENR se inicia la transferencia de datos. Con los valores de los
parámetros de entrada UNIT, DATA_TYPE, START_ADDRESS, LENGTH, TI y
WRITE_READ se genera la trama de solicitud. Solo se puede enviar una nueva trama si la
trama anterior ya ha finalizado con DONE_NDR o ERROR.
Si no se estableció la conexión (CONN_ESTABLISHED = FALSE), primero se establece la
conexión y, a continuación, se realiza la transferencia de datos.
Si se ajusta el parámetro DISCONNECT = TRUE, se realiza la desconexión tras la
transferencia de datos.
Modo de operación "S7 es servidor"
Con un nivel positivo en la entrada ENQ_ENR se activa la instrucción. Se evalúan y se
responden las solicitudes del cliente. En caso de que no se haya establecido la conexión
estando ENQ_ENR activado (CONN_ESTABLISHED = FALSE), se activa el establecimiento
de conexión.
Si durante el funcionamiento ENQ_ENR pasa de TRUE a FALSE, se deshace la conexión si
está ajustado el parámetro DISCONNECT = TRUE.
Si hay una conexión existente y ENQ_ENR = FALSE se rechazan las solicitudes recibidas.

6994

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte también
Descripción MODBUSPN (Página 6982)

Parámetros DATA_TYPE, START_ADDRESS, LENGTH, TI, WRITE_READ y UNIT
Descripción
En el modo de operación "S7 es cliente" se trata de parámetros de entrada, mientras que en
el modo de operación "S7 es servidor", de parámetros de salida.
DATA_TYPE
El parámetro DATA_TYPE indica qué tipo de datos Modbus se procesa con la trama actual. Se
admiten los valores siguientes:
Tipo de datos Modbus

DATA_TYPE

Coils

B#16#1

Inputs

B#16#2

Holding Register

B#16#3

Input Register

B#16#4

Los distintos tipos de datos mantienen una relación directa con los códigos de función
utilizados.
Tipo de datos Mod‐ DATA_TYPE
bus

Función

Longitud

single_write

Código de función

Coils

1

leer

cualquiera

irrelevante

1

Coils

1

escribir

1

TRUE

5

Coils

1

escribir

1

FALSE

15

Coils

1

escribir

>1

irrelevante

15

Inputs

2

leer

cualquiera

irrelevante

2

Holding Register

3

leer

cualquiera

irrelevante

3

Holding Register

3

escribir

1

TRUE

6

Holding Register

3

escribir

1

FALSE

16

Holding Register

3

escribir

>1

irrelevante

16

Input Register

4

leer

cualquiera

irrelevante

4

START_ADDRESS
El parámetro START_ADDRESS determina la primera dirección MODBUS que se lee o se
escribe.
LENGTH
El parámetro LENGTH determina el número de valores MODBUS que se leen o se escriben.
En las funciones de lectura, para Holding e Input Register es posible un máximo de 125
registros por trama. Para Coils e Inputs es posible un máximo de 2000 bits.
En las funciones de escritura, en Holding Register, el número máximo es de 123 registros y en
Coils, de 1968 bits.

Programación del PLC
Manual de programación y manejo, 11/2019

6995

Instrucciones
4.2 Instrucciones
Los registros o valores de bit procesados con una trama de solicitud deben encontrarse dentro
de un bloque de datos.
TI
El parámetro TI, Transaction Identifier se copia, conforme a la especificación MODBUS del
servidor, de la trama de solicitud a la trama de respuesta.
En el modo de operación "S7 es cliente" se trata de un parámetro de entrada. La instrucción
aplica este valor a la trama de solicitud y lo verifica al recibir la respuesta.
En el modo de operación "S7 es servidor“ se trata de un parámetro de salida. La instrucción
aplica este valor de la trama de solicitud a la respuesta.
La Transaction Identifier sirve para identificar las tramas o para asignar unívocamente las
respuestas a las consultas. La instrucción MODBUSPN solo puede realizar esta asignación si
también se cambia el TI en cada trama. Solo así se garantiza un funcionamiento fiable de la
instrucción.
Por ello, recomendamos aumentar a razón de 1 el TI en cada solicitud.
WRITE_READ
Este parámetro define si se debe ejecutar una función de lectura o escritura. Si la entrada/
salida tiene el valor FALSE, se trata de una función de lectura. El valor TRUE define una
función de escritura.
Solo se pueden escribir Holding Register y Coils. Input Register e Inputs únicamente se
pueden leer.
UNIT
El parámetro UNIT, Unit Identifier, indica la asignación unívoca del interlocutor. Sobre todo, es
necesario si detrás de un convertidor se encuentran varios dispositivos serie a los que se
accede con distintos números de UNIT.
En la función "S7 es cliente" el parámetro UNIT es un parámetro de entrada. Esta entrada se
debe ajustar de acuerdo con los requisitos. La instrucción aplica este valor a la trama de
solicitud y lo verifica al recibir la respuesta.
En la función "S7 es servidor" el parámetro UNIT es un parámetro de salida. La instrucción
aplica el valor de la trama de solicitud a la trama de respuesta y lo muestra una vez terminada
la petición.
DONE_NDR
En el modo de operación "S7 es cliente" la petición activada terminó sin errores. En una función
de lectura, los datos de respuesta ya se introdujeron en el DB desde el servidor; en una función
de lectura, la respuesta se recibió en la trama de solicitud desde el servidor.
En el modo de operación "S7 es servidor" la salida muestra un intercambio de tramas con el
cliente finalizado sin errores. En los parámetros UNIT, DATA_TYPE, START_ADDRESS,
LENGTH, TI y WRITE_READ se muestran los parámetros de petición del cliente. Estas salidas
solo son válidas siempre que esté activado DONE_NDR.

6996

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte también
Descripción MODBUSPN (Página 6982)
Mapeo de dirección (Página 6990)

Parámetros ERROR, STATUS_MODBUS, STATUS_CONN y STATUS_FUNC
Evaluación de errores
La instrucción MODBUSPN posee 3 salidas de estado para el diagnóstico de errores:
STATUS_MODBUS, STATUS_CONN y STATUS_FUNC.
ERROR
Si se activó esta salida es que se detectó un error.
En el modo de operación "S7 es cliente" la petición activada finalizó con errores. El número de
error correspondiente se muestra en las salidas STATUS_MODBUS o STATUS_CONN.
En el modo de operación "S7 es servidor“ se detectó un error en una trama de solicitud del
cliente o al enviar la trama de respuesta. El número de error correspondiente se muestra en las
salidas STATUS_MODBUS o STATUS_CONN.
STATUS_MODBUS
En STATUS_MODBUS se muestran los mensajes de error y la información de estado acerca
del procesamiento de tramas específico de Modbus. La instrucción MODBUSPN utiliza
distintos bloques de sistema. Los mensajes de error de estos bloques se transmiten
inalterados a STATUS_MODBUS.
STATUS_CONN
En STATUS_CONN se muestran los mensajes de error relativos al procesamiento de la
conexión. Además, en STATUS_CONN se muestran avisos como "Petición en ejecución". En
este caso, no se activó el bit de ERROR. Además, las instrucciones TCON, TSEND, TRCV y
TDISCON se llaman internamente. Los mensajes de error de estos bloques se transmiten
inalterados a STATUS_CONN.
STATUS_FUNC
En STATUS_FUNC se muestra el nombre de la función que causó el error.
Más adelante, encontrará un listado de los mensajes de error específicos de las instrucciones.
Parámetro STATUS_MODBUS en STATUS_FUNC = 'MODBUSPN'
STATUS*
(W#16#)

Descripción

Solución

A001

El bloque de datos de parámetros es demasiado corto.

Corrija la longitud del DB de pará‐
metros.

A002

El parámetro end es menor que el start.

Corrija las indicaciones en el DB de
parámetros.

Programación del PLC
Manual de programación y manejo, 11/2019

6997

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

Solución

A003

Un DB en el que se deben mapear direcciones MODBUS es demasiado
corto.
Longitud mínima:

Amplíe el DB.

● para registros: ( end - start + 1) * 2 + 2

S7 es cliente: corrija los paráme‐
tros de llamada START_AD‐
DRESS o LENGTH.
S7 es servidor: cambie la solicitud
delcliente.

● para valores de bits: (end - start) / 8 + 1 + 2
otras causas posibles:
● S7 es cliente: parámetros de llamada incorrectos
● S7 es servidor: rango de direcciones incorrecto en la trama de solicitud
del cliente. El S7 responde con una trama de excepción.

Corrija los parámetros de llamada.
Se indicó una combinación inadmisible de DATA_TYPE y WRITE_READ. Solo se pueden escribir los tipos de
datos 1 y 3.

A004

Solo S7 es cliente:

A005

S7 es cliente: Se indicó un valor inadmisible en el parámetro LENGTH.

S7 es cliente: corrija el parámetro
LENGTH.

S7 es servidor: el número de registros/bits en la trama de solicitud es
inadmisible. El S7 responde con una trama de excepción.

S7 es servidor: Cambie el número
en la trama de solicitud del cliente.

Rangos de valores: leer
Coils/Inputs: de 1 a 2000
escribir Coils: de 1 a 1968
leer Register: de 1 a 125
escribir Holding Register: de 1 a 123
A006

El área indicada mediante DATA_TYPE, START_ADDRESS y LENGTH
no existe en data_type de data_area_1 a data_area_8.
S7 es servidor: El S7 responde con una trama de excepción.

S7 es cliente: corrija la combina‐
ción DATA_TYPE, START_AD‐
DRESS y LENGTH.
S7 es servidor: cambie la solicitud
del Cliente o corrija la parametriza‐
ción en el DB de parámetros.

A007

Corrija la parametrización.
S7 es cliente: Se parametrizó un tiempo de vigilancia no válido en
RECV_TIME o CONN_TIME. Para RECV_TIME se debe introducir un va‐
lor >= 20 ms, para CONN_TIME >= 100 ms.

A009

S7 es cliente:
La Transaction Identifier TI que se recibió es distinta de la enviada.

A00A

S7 es cliente:
La Unit Identifier UNIT que se recibió es distinta de la enviada.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A00B

S7 es cliente:
El código de función que se recibió es distinto del enviado.

S7 es cliente:
Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

Se deshace la conexión de comunicación.

S7 es servidor:
se recibió un código de función no válido. El S7 responde con una trama
de excepción.

6998

S7 es servidor:
cambie la solicitud del cliente. La
instrucción MODBUSPN procesa
los códigos de función 1, 2, 3, 4, 5,
6, 15 y 16.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

A00C

El número de bytes recibido no se corresponde con el número de registros. Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
Se deshace la conexión de comunicación.
mas.
Solo con S7 es cliente:
la dirección de registro/bit o el número de registros/bits en la trama de
respuesta es diferente al de la trama de solicitud.

A00D

A00E

Solución

La indicación de longitud del encabezado de trama específico de Modbus
no se corresponde con las indicaciones del número de registros/bits o del
número de bytes de la trama.
La instrucción rechaza todos los datos.
Se deshace la conexión de comunicación.

A00F

Se deshace la conexión de comunicación.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A010

En el parámetro db de data_area_1 a data_area_8 se asignó doblemente
un número de DB.

Corrija la parametrización en el DB
de parámetros.

A011

En el parámetro de entrada DATA_TYPE se indicó un valor inadmisible
(los valores admitidos son 1, 2, 3 y 4).

Corrija los parámetros de llamada.

A012

Las áreas parametrizadas data_area_1 y data_area_2 se solapan

Corrija la parametrización.

A013

Las áreas parametrizadas data_area_1 y data_area_3 se solapan.

A014

Las áreas parametrizadas data_area_1 y data_area_4 se solapan.

A015

Las áreas parametrizadas data_area_1 y data_area_5 se solapan.

Las áreas de datos no deben dis‐
poner de ningún área común de di‐
recciones de registro.

A016

Las áreas parametrizadas data_area_1 y data_area_6 se solapan.

A017

Las áreas parametrizadas data_area_1 y data_area_7 se solapan.

A018

Las áreas parametrizadas data_area_1 y data_area_8 se solapan.

A019

Uno de los parámetros db se ajustó a 0, aunque el data_type pertinente
esté parametrizado con > 0.

Corrija la parametrización del pará‐
metro db a > 0.

A01A

Longitud incorrecta en el encabezado: se admiten de 1 a 253 bytes.
Se deshace la conexión de comunicación.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

S7 es servidor y código de función 5:
se recibió un estado no válido para Coil.
El S7 responde con una trama de excepción.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A01B

Se recibió un Protocol Identifier distinto de 0.

Programación del PLC
Manual de programación y manejo, 11/2019

6999

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

Solución

A023

Las áreas parametrizadas data_area_2 y data_area_3 se solapan.

A024

Las áreas parametrizadas data_area_2 y data_area_4 se solapan.

Corrija la parametrización en el DB
de parámetros.

A025

Las áreas parametrizadas data_area_2 y data_area_5 se solapan.

A026

Las áreas parametrizadas data_area_2 y data_area_6 se solapan.

A027

Las áreas parametrizadas data_area_2 y data_area_7 se solapan.

A028

Las áreas parametrizadas data_area_2 y data_area_8 se solapan.

A034

Las áreas parametrizadas data_area_3 y data_area_4 se solapan.

A035

Las áreas parametrizadas data_area_3 y data_area_5 se solapan.

A036

Las áreas parametrizadas data_area_3 y data_area_6 se solapan.

A037

Las áreas parametrizadas data_area_3 y data_area_7 se solapan.

A038

Las áreas parametrizadas data_area_3 y data_area_8 se solapan.

A045

Las áreas parametrizadas data_area_4 y data_area_5 se solapan.

A046

Las áreas parametrizadas data_area_4 y data_area_6 se solapan.

A047

Las áreas parametrizadas data_area_4 y data_area_7 se solapan.

A048

Las áreas parametrizadas data_area_4 y data_area_8 se solapan.

A056

Las áreas parametrizadas data_area_5 y data_area_6 se solapan.

A057

Las áreas parametrizadas data_area_5 y data_area_7 se solapan.

A058

Las áreas parametrizadas data_area_5 y data_area_8 se solapan.

A067

Las áreas parametrizadas data_area_6 y data_area_7 se solapan.

A068

Las áreas parametrizadas data_area_6 y data_area_8 se solapan.

A078

Las áreas parametrizadas data_area_7 y data_area_8 se solapan.

A079

La ID de conexión indicada en el parámetro ID no se encuentra en el DB
de parámetros.

A07A

Se indicó un valor inadmisible en el parámetro ID (rango de valores de 1
a 4095).

A07B

La ID indicada está duplicada en el DB de parámetros.

A07C

En el DB de parámetros se indicó un valor inadmisible en el parámetro
data_type (los valores admitidos van de 0 a 4).

A07D

En el DB de parámetros, el parámetro data_type de la data_area_1 no
contiene ninguna entrada. El área de parámetros „_1" es el área inicial y se
debe parametrizar.

A07E

En db se indicó el número del DB de parámetros o el número del DB de
instancia de la instrucción MODBUSPN.

A07F

El DB indicado en el DB_PARAM no es ningún DB de parámetros Modbus. Corrija la parametrización en la en‐
Se modificó la información de longitud en el DBW0 o se indicó un DB
trada DB_PARAM.
incorrecto.

A080

Este mensaje de error se produce cuando, para la llamada de la instruc‐
ción MODBUSPN en el OB1 o el OB de alarma y el OB100 se utilizan
diferentes DBs de instancia.

Utilice el mismo IDB en el OB100 y
en el OB cíclico.

A081

Solo con S7 es cliente y código de función 5:
Los datos de la trama de respuesta no son el eco de la solicitud.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

A082

Solo con S7 es cliente y código de función 6:
El valor de registro recibido es distinto del que se envió.

Compruebe los datos del interlocu‐
tor con ayuda de un registro de tra‐
mas.

7000

Las áreas de datos no deben dis‐
poner de ningún área común de di‐
recciones de registro.

Corrija la parametrización en la en‐
trada id.

Corrija la parametrización en el DB
de parámetros.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
STATUS*
(W#16#)

Descripción

Solución

A083

S7 es cliente: se lanzó una petición mientras la petición anterior aún es‐
taba en curso. No se ejecuta la petición.
Es una información de estado. El bit ERROR no está activado.

No lance una nueva petición hasta
que la petición anterior haya finali‐
zado con DONE _NDR = TRUE o
ERROR = TRUE.

A084

No se pudo determinar ningún código de identificación IDENT_CODE pa‐ Diríjase al Product Support.
ra la concesión de licencia.

A085

Se produjo un error durante la determinación de licencia.

Compruebe si se realizaron acce‐
sos de escritura no permitidos al
DB de licencia. Dado el caso, dirí‐
jase al Product Support.

A086

Hubo el intento de escribir en un bloque de datos protegido contra escri‐
tura.

Quite la protección contra escritura
o utilice otro DB.

A090

El bloque aún no tiene licencia para esta CPU.
Consulte el IDENT_CODE de esta
Es una información de estado. El bit ERROR no está activado. La comu‐ CPU y solicite con él el código de
nicación Modbus también funciona sin licencia.
validación. Consulte "Concesión
de licencia (Página 6986)".

A091

Como respuesta se recibió una trama de excepción con código de excep‐ El interlocutor no soporta la función
ción 1 (solo con S7 es cliente).
requerida.

A092

Como respuesta se recibió una trama de excepción con código de excep‐ Corrija la longitud LENGTH o la
START_ADDRESS en la llamada
ción 2 (solo con S7 es cliente).
Se produjo el acceso a una dirección no existente/no admitida en el inter‐ de la instrucción.

A093

Como respuesta se recibió una trama de excepción con código de excep‐ El interlocutor no es capaz de pro‐
ción 3 (solo con S7 es cliente).
cesar la trama recibida (p. ej. no
soporta la longitud requerida).

A094

Como respuesta se recibió una trama de excepción con código de excep‐ El interlocutor se encuentra en un
ción 4 (solo con S7 es cliente).
estado en que no es capaz de pro‐
cesar la trama recibida.

A095

Como respuesta se recibió una trama de excepción con un código de
excepción desconocido (solo con S7 es cliente)

locutor.

Controle los mensajes de error del
interlocutor y, dado el caso, com‐
pruebe los datos con un registro de
tramas.

Parámetro STATUS_MODBUS en STATUS_FUNC = 'RD_SINFO', 'BLKMOV', 'TEST_DB',
'RDSYSST' o 'WR_USMSG'
STATUS*
(W#16#)

Descripción

Solución

7xxx

Encontrará más información al respecto en la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

80B1

STATUS_FUNC = 'TEST_DB': El DB no existe en la CPU.

Todos los bloques de datos que se indi‐
caron en el db deben crearse y transfe‐
rirse a la CPU.

80B2

STATUS_FUNC = 'TEST_DB': DB UNLINKED

No generar el DB como UNLINKED.

8xxx

Encontrará más información al respecto en la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

Programación del PLC
Manual de programación y manejo, 11/2019

7001

Instrucciones
4.2 Instrucciones
Parámetro STATUS_CONN en STATUS_FUNC = 'MODBUSPN'
STATUS*
(W#16#)

Descripción

Solución

A100

El tiempo de vigilancia CONN_TIME o RECV_TIME expiró para una Compruebe la parametrización de la co‐
petición. Una vez transcurrido el RECV_TIME se realiza la descone‐ nexión.
xión.

A101

Ha expirado el tiempo de vigilancia interno de la función TDISCON.

Póngase en contacto con el Product
Support.

Parámetro STATUS_CONN en STATUS_FUNC = 'TCON', 'TSEND', 'TRCV' o 'TDISCON'
STATUS*
(W#16#)

Descripción

Solución

7xxx

Consulte la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

8xxx

Consulte la Ayuda en pantalla.

Consulte la Ayuda en pantalla (TIA Por‐
tal -> Seleccionar bloque -> Tecla F1)

Consulte también
Descripción MODBUSPN (Página 6982)

4.2.5.6

Procesador de comunicaciones

Punto a punto
Sinopsis de la comunicación Freeport
STEP 7 ofrece instrucciones avanzadas que permiten realizar la comunicación Freeport
utilizando un protocolo especificado en el programa de usuario. Dichas instrucciones se
dividen en dos categorías:
● Instrucciones de configuración
● Instrucciones de comunicación
Nota
Capacidad de la CPU
Las instrucciones Freeport se comunican con los módulos de comunicaciones mediante
lectura o escritura de registros.
Por ello, al utilizar las instrucciones debe tenerse en cuenta la capacidad de lectura y escritura
de registros de la CPU correspondiente.
Si varias instrucciones de una CPU deben leer o escribir registros de forma simultánea, es
posible que el programa de usuario tenga que llamar las instrucciones con un desfase
temporal.

7002

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Instrucciones de configuración
Antes de que el programa de usuario pueda iniciar la comunicación Freeport, es necesario
configurar la interfaz de comunicación y los parámetros para transmitir y recibir datos.
La configuración de interfaces y datos se realiza para cada CM en la configuración de
dispositivos o con las siguientes instrucciones del programa de usuario:
● Port_Config (Página 7007)
● Send_Config (Página 7010)
● Receive_Config (Página 7012)
● P3964_Config (Página 7017)
ATENCIÓN
Configuración de dispositivos <-> Instrucciones de configuración
Los parámetros de la configuración de dispositivos se transfieren al CM en cada Power On de
la CPU (retorno de la tensión).
Los parámetros de las instrucciones de configuración se transfieren al CM de acuerdo con su
programa de usuario.
No existe ninguna sincronización entre los parámetros de la configuración de dispositivos y
los parámetros de las instrucciones de configuración, es decir, los parámetros de las
instrucciones de configuración no se aplican a la configuración de dispositivos de la CPU.
El programa de usuario permite controlar qué parámetros se aplican en el CM en cada
momento.

Instrucciones de comunicación
Las instrucciones de la comunicación Freeport permiten al programa de usuario enviar datos
a las interfaces de comunicación y recibirlos de estas. Los CM envían datos a los dispositivos
de comunicación y los reciben de ellos.
● Send_P2P (Página 7019)
● Receive_P2P (Página 7023)
Nota
Coherencia de datos
● En el caso de que los datos que vayan a enviarse deban transferirse de forma coherente,
no deben modificarse desde el ascenso del flanco del parámetro REQ hasta establecer
DONE con la instrucción Send_P2P .
● Si los datos recibidos deben leerse de forma coherente, solo deben evaluarse en el ciclo en
el que NDR = TRUE.

Programación del PLC
Manual de programación y manejo, 11/2019

7003

Instrucciones
4.2 Instrucciones
Con instrucciones adicionales es posible inicializar el búfer de recepción, así como consultar
y activar señales RS232 especiales.
● Receive_Reset (Página 7025)
● Signal_Get (Página 7026)
● Signal_Set (Página 7027)
Las siguientes instrucciones permiten leer y escribir funciones avanzadas, siempre que el
módulo las soporte.
● Get_Features (Página 7029)
● Set_Features (Página 7030)
Todas las instrucciones Freeport funcionan de forma asíncrona. Por ello, las instrucciones
deben llamarse repetidas veces hasta que el parámetro de salida DONE indique que ha
finalizado la ejecución.
Utilizando una arquitectura de consultas, el programa de usuario puede determinar el estado
de transmisión y recepción. Send_P2P y Receive_P2P pueden ejecutarse a la vez. Los
módulos de comunicaciones respaldan los datos enviados y recibidos hasta un tamaño
máximo del búfer específico del módulo.

Nota
Resolución de tiempos de bit
Para diversos parámetros se indica el número de tiempos de bits en la velocidad de
transferencia configurada. Debido a la indicación del parámetro en tiempos de bit, dicho
parámetro es independiente de la velocidad de transferencia. Todos los parámetros con la
unidad de tiempos de bit pueden indicarse con un número máximo de 65535.

Aplicación de las instrucciones
Las instrucciones Freeport deben llamarse cíclicamente para consultar los datos recibidos o el
fin de una transmisión.
En función del volumen de datos, la transmisión puede desarrollarse en varias llamadas (ciclos
del programa).
Si la petición se ha completado con DONE = TRUE o NDR = TRUE, se ha ejecutado sin errores.
Nota
Guardar STATUS
Los parámetros DONE, NDR, ERROR y STATUS solo permanecen durante una ejecución del
bloque. Por ello, para visualizar STATUS debe copiarlo en un área de datos libre.

7004

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

maestro
Secuencia típica de un maestro:
1. La instrucción Send_P2P lanza una transferencia al CM.
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
2. La instrucción Send_P2P se ejecuta en ciclos consecutivos para consultar el estado del
proceso de transferencia.
3. Si la instrucción Send_P2P en la salida DONE notifica que la transferencia ha finalizado, el
código de usuario puede preparar la recepción de la respuesta.
4. La instrucción Receive_P2P se ejecuta repetidamente para consultar una respuesta. Una
vez que el CM ha leído los datos de respuesta, la instrucción Receive_P2P copia la
respuesta en la CPU y notifica en la salida NDR que se han recibido datos nuevos.
5. El programa de usuario puede procesar la respuesta.
6. Regreso al paso 1 y repetición de la secuencia.

esclavo
Secuencia típica de un esclavo:
1. El programa de usuario ejecuta la instrucción Receive_P2P en cada ciclo.
2. Una vez que el CM ha recibido una solicitud, la instrucción Receive_P2P notifica en la salida
NDR que hay datos nuevos preparados y la solicitud se copia en la CPU.
3. El programa de usuario procesa la solicitud y genera una respuesta.
4. Con la instrucción Send_P2P , la respuesta se devuelve al maestro.
5. La instrucción Send_P2P debe ejecutarse repetidamente para asegurarse de que el
proceso de transmisión tiene lugar realmente.
6. Regreso al paso 1 y repetición de la secuencia.
El esclavo debe procurar que Receive_P2P se llame tantas veces como sea necesario para
que el maestro pueda recibir una transferencia antes de que cancele el proceso por rebasar el
tiempo mientras espera una respuesta. Para cumplir esta tarea, el programa de usuario puede
llamar a Receive_P2P desde un OB de ciclo cuyo tiempo de ciclo sea lo suficientemente corto
como para recibir una transferencia del maestro antes de que transcurra el timeout ajustado.
Si el tiempo de ciclo para el OB se ajusta de modo que se lleven a cabo dos ejecuciones dentro
del timeout ajustado, el programa de usuario puede recibir todas las transferencias sin
pérdidas.

Programación del PLC
Manual de programación y manejo, 11/2019

7005

Instrucciones
4.2 Instrucciones

Parámetros comunes para las operaciones Freeport
Tabla 4-370 Parámetros de entrada comunes de las instrucciones Freeport
Parámetro

Descripción

REQ

Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos. Un flanco
adicional en REQ solamente puede generarse una vez finalizada la petición (DONE o bien
ERROR). Dependiendo del volumen de datos, la transmisión puede desarrollarse en varias lla‐
madas (ciclos del programa).
Al insertar una instrucción Freeport en el programa, STEP 7 le pedirá que indique el DB de instancia
(o que cree mediante STEP 7 un DB de instancia correspondiente). Utilice un DB unívoco para
cada llamada de instrucción PtP.

PORT

Al configurar el módulo de comunicaciones se asigna una dirección de puerto. Con el parámetro
PORT se comunica a la instrucción la asignación a un determinado módulo de comunicaciones.
Tras la configuración se puede seleccionar un nombre simbólico para el puerto estándar. El valor
de puerto asignado del CM es la propiedad "identificador de hardware" de la configuración de
dispositivos en el S7-1200/1500 o la "dirección de entrada" en el S7-300/400. El nombre simbólico
del puerto se asigna en la tabla de símbolos.

Los parámetros de salida DONE, NDR, ERROR y STATUS de las instrucciones Freeport
indican el estado de ejecución de las funciones Freeport.
Tabla 4-371 Parámetros de salida DONE, NDR, ERROR y STATUS
Parámetro

Tipo de datos

Estándar

Descripción

DONE

Bool

FALSE

Se pone a TRUE durante todo un ciclo para indicar que la última
petición ha concluido correctamente; en caso contrario, FALSE.

NDR

Bool

FALSE

Se pone a TRUE durante todo un ciclo para indicar que se han
recibido nuevos datos; en caso contrario, FALSE.

ERROR

Bool

FALSE

Se pone a TRUE durante todo un ciclo para indicar que la última
petición ha concluido con error; el código de error correspondiente
se encuentra en STATUS; en caso contrario, FALSE.

STATUS

Word

16#0000 o
16#7000

Estado del resultado:
● Si el bit DONE o NDR está activado, se ajusta STATUS a
0/16#7000 o a un código de error específico.
● Si está activado el bit ERROR, se indica un código de error en
STATUS.
● Si no se activa ninguno de los bits mencionados, la instrucción
puede devolver resultados de estado que describen el estado
actual de la función.
El valor de STATUS es válido hasta la siguiente llamada de esta
instrucción (con la misma dirección única de puerto).

7006

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tabla 4-372 Parámetro de entrada/salida COM_RST
Parámetro

Tipo de datos

Estándar

Descripción

COM_RST

Bool

FALSE

Inicialización de la instrucción
Con TRUE se inicializa la instrucción. Seguidamente se ajusta
COM_RST de nuevo a FALSE.
Nota: En el arranque, COM_RST debe ajustarse a TRUE y, des‐
pués, no debería modificar más este parámetro, p. ej., no asignar
ningún valor al llamar la instrucción. Tras inicializar el DB de ins‐
tancia, la instrucción resetea COM_RST.

Nota
Tenga en cuenta que los parámetros DONE, NDR, ERROR y STATUS solo están activados
durante un ciclo.

Tabla 4-373 Códigos de error comunes
Código de error

Descripción

16#0000

No hay error

16#7000

Función inactiva

16#7001

Primera llamada tras iniciar una petición.

16#7002

Llamada posterior tras iniciar una petición.

16#8x3A

Puntero no admisible en parámetro x

Tabla 4-374 Clases de errores comunes del parámetro STATUS
Descripción de la clase

Clases de error

Descripción

Configuración del puerto

16#81Ax

Para la descripción de errores frecuentes en la configuración de
interfaces

Configuración de transmisión

16#81Bx

Para la descripción de errores en la configuración de transmisión

Configuración de recepción

16#81Cx

Para la descripción de errores en la configuración de recepción

Transferir

16#81Dx

Para la descripción de errores del tiempo de ejecución al transmitir

Recibir

16#81Ex

Para la descripción de errores del tiempo de ejecución al recibir

Señales cualificadoras RS232

16#81Fx

Para la descripción de errores en relación con el procesamiento
de señales

Port_Config: configurar el puerto de comunicación PtP
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Programación del PLC
Manual de programación y manejo, 11/2019

7007

Instrucciones
4.2 Instrucciones

Descripción
La instrucción Port_Config (configuración del puerto) permite modificar parámetros como la
velocidad de transferencia desde el programa durante el funcionamiento. Los datos
pendientes del CM se borran al ejecutar Port_Config.
Los cambios de configuración de Port_Config no se guardan en la CPU sino en el CM. En caso
de retorno de la tensión, el CM se parametriza con los datos guardados en la configuración de
dispositivos.

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/1500

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste prede‐ Descripción
terminado

FALSE

Inicia la transferencia de datos al CM con un flanco as‐
cendente en esta entrada.

0

Especifica el módulo de comunicación a través del cual
se produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware"
de la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de
variables PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada
en HWCN.

PROTO‐
COL

IN

UInt

Word

0

Protocolo
● 0 = protocolo Freeport
● 1 = protocolo 3964(R)

BAUD

IN

UInt

Word

6

Velocidad de transferencia del puerto:
● 1 = 300 bits/s
● 2 = 600 bits/s
● 3 = 1200 bits/s
● 4 = 2400 bits/s
● 5 = 4800 bits/s
● 6 = 9600 bits/s
● 7 = 19200 bits/s
● 8 = 38400 bits/s
● 9 = 57600 bits/s
● 10 = 76800 bits/s
● 11 = 115200 bits/s

7008

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

PARITY

Declara‐
ción

IN

Tipo de datos
S71200/1500
UInt

S7300/400/
WinAC
Word

Ajuste prede‐ Descripción
terminado

1

Paridad del puerto:
● 1 = ninguna
● 2 = paridad par
● 3 = paridad impar
● 4 = paridad Mark
● 5 = paridad Space
● 6 = cualquiera

DATABITS IN

UInt

Word

1

Bits por carácter:
● 1 = 8 bits de datos
● 2 = 7 bits de datos

STOPBITS IN

UInt

Word

1

Bits de parada:
● 1 = 1 bit de parada
● 2 = 2 bits de parada

FLOWCTR IN
L

UInt

Word

1

Control del flujo:
● 1 = no hay control del flujo
● 2 = XON/XOFF
● 3 = RTS de HW siempre ON
● 4 = RTS de HW con protocolo de intercambio
● 5 = RTS de HW siempre ON, ignorar DTR/DSR

XON‐
CHAR

IN

Char

16#0011

Indica el carácter que sirve de carácter XON. Suele ser
un carácter DC1 (11H). Este parámetro solo se evalúa
cuando está activado el control del flujo de software.

XOFF‐
CHAR

IN

Char

16#0013

Indica el carácter que sirve de carácter XOFF. Suele ser
un carácter DC3 (13H). Este parámetro solo se evalúa
cuando está activado el control del flujo de software.

WAITIME

IN

UInt

Word

2000

Indica el tiempo durante el que se espera un carácter
XON tras recibir un carácter XOFF o bien el tiempo du‐
rante el que se espera la señal CTS = ON tras CTS =
OFF (de 0 a 65535 ms). Este parámetro solo se evalúa
cuando está activado el control del flujo.

MODE

IN

USInt

Byte

0

Modo de operación
Los modos de operación admitidos son:
● 0 = dúplex (RS232)
● 1 = dúplex (RS422) modo a cuatro hilos (punto a
punto)
● 2 = dúplex (RS422) modo a cuatro hilos (maestro
multipunto, CM PtP (ET 200SP))
● 3 = dúplex (RS422) modo a cuatro hilos (esclavo
multipunto, CM PtP (ET 200SP))
● 4 = semidúplex (RS485) modo a dos hilos 1)

Programación del PLC
Manual de programación y manejo, 11/2019

7009

Instrucciones
4.2 Instrucciones
Parámetro

LINE_PRE

Declara‐
ción

IN

Tipo de datos
S71200/1500
USInt

S7300/400/
WinAC
Byte

Ajuste prede‐ Descripción
terminado

0

Estado inicial de la línea de recepción
Los estados iniciales admitidos son:
● 0 = "sin" asignación inicial 1)
● 1 = señal R(A) = 5 V, señal R(B) = 0 V (detección
Break):
en este estado inicial es posible una detección de
rotura (Break).
Solo disponible con: "Dúplex (RS422) modo a
cuatro hilos (acoplamiento punto a punto)" y "Dúplex
(RS422) modo a cuatro hilos (esclavo multipunto)".
● 2 = señal R(A) = 0 V, señal R(B) = 5 V:
este estado inicial corresponde al estado de reposo
(ninguna transmisión activa). Con este estado inicial
no es posible la detección de rotura (Break).

BRK_DET

IN

USInt

Byte

0

Detección break
Se admiten:
● 0 = detección Break desactivada
● 1 = detección Break activada

COM_RST IN/OUT

---

Bool

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.

DONE

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última peti‐
ción se haya ejecutado correctamente

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última peti‐
ción se haya ejecutado con errores

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

1)

Ajuste necesario si se utilizan cables PROFIBUS en CM 1241 para RS485

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Send_Config: configurar el emisor PtP
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

7010

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Descripción
Con la instrucción Send_Config (configuración de transmisión) puede cambiar los parámetros
de transmisión durante el funcionamiento desde el programa (condiciones que marcan el
principio y fin de los datos que deben enviarse). Los datos pendientes en un CM se borran
cuando se ejecuta Send_Config.
Los cambios de configuración de Send_Config no se guardan en la CPU sino en el CM. Los
parámetros guardados en la configuración de dispositivos se restablecen al retornar la tensión
de la CPU o del módulo de comunicaciones.

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste prede‐ Descripción
terminado

FALSE

Activa el cambio de configuración con un flanco ascen‐
dente en esta entrada.

0

Especifica el módulo de comunicación a través del cual
se produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware"
de la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

RTSONDL
Y

IN

UInt

Word

0

Número de milisegundos que debe esperarse tras la ac‐
tivación de RTS antes de iniciar una transferencia de da‐
tos de envío. Este parámetro solo es válido cuando está
activado el control del flujo de hardware. El rango válido
es de 0 a 65535 ms. El valor 0 desactiva la función.

RTSOFFD
LY

IN

UInt

Word

0

Número de milisegundos que debe esperarse después
de transferir datos de transmisión antes de que se de‐
sactive RTS: Este parámetro solo es válido cuando está
activado el control del flujo de hardware. El rango válido
es de 0 a 65535 ms. El valor 0 desactiva la función.

BREAK

IN

UInt

Word

0

Este parámetro indica que se envía un BREAK antes de
iniciar cada trama durante el número indicado de tiempos
de bit. El número máximo de tiempos de bit es 65535. El
valor 0 desactiva la función.

IDLELINE

IN

UInt

Word

0

Este parámetro indica que la línea permanece vacía an‐
tes de iniciar cada trama durante el número indicado de
tiempos de bit. El número máximo de tiempos de bit es
65535. El valor 0 desactiva la función.

Programación del PLC
Manual de programación y manejo, 11/2019

7011

Instrucciones
4.2 Instrucciones
Parámetro

Declara‐
ción

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Ajuste prede‐ Descripción
terminado

USR_END

IN

STRING[2]

0

Entrada de los caracteres de fin.
Se pueden configurar como máximo 2 caracteres de fin.
Se envían el o los caracteres de fin, independientemente
de la longitud de trama parametrizada.

APP_END

IN

STRING[5]

0

Entrada de los caracteres que deben añadirse.
Se pueden añadir como máximo 5 caracteres.

COM_RST IN/OUT

---

Bool

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.

DONE

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado correctamente

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado con errores

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Receive_Config: configurar el receptor PtP
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
Con la instrucción Receive_Config (configuración de recepción) puede cambiar los parámetros
de recepción durante el funcionamiento desde el programa. Esta instrucción configura las
condiciones que marcan el principio y fin de los datos recibidos. Los datos pendientes en un
CM se borran cuando se ejecuta Receive_Config.
Los cambios de configuración de Receive_Config no se guardan de manera remanente en el
CM. Los parámetros guardados en la configuración de dispositivos se restablecen al retornar
la tensión de la CPU o del módulo de comunicaciones. Por eso, se debe llamar de nuevo la
instrucción Receive_Config desde el programa de usuario al retornar la tensión de la CPU o del
módulo de comunicación, para volver a sobrescribir los parámetros guardados en la
configuración del dispositivo.

7012

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/1500

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste prede‐ Descripción
terminado

FALSE

Activa el cambio de configuración con un flanco ascen‐
dente en esta entrada.

0

Especifica el módulo de comunicación a través del cual
se produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware"
de la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

RECEI‐
VE_CON‐
DITIONS

IN

COM_RST IN/OUT

Variant

Any

‑

La estructura de datos de Receive_Conditions indica las
condiciones de inicio y fin en virtud de las cuales se iden‐
tifica el principio y fin de una trama.

---

Bool

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.

DONE

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado correctamente

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado con errores

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Condiciones de inicio de la instrucción Receive_P2P
La instrucción Receive_P2P utiliza la configuración de dispositivos o bien la indicada por la
instrucción Receive_Config para determinar el inicio y el fin de tramas de la comunicación
Freeport. El inicio de la trama queda definido por las condiciones de inicio. El inicio de la trama
puede especificarse mediante una o varias condiciones de inicio.
Si están activados tanto Break como Idle Line, debe cumplirse Break y, además, Idle Line. A
continuación, basta una de las condiciones restantes (carácter de inicio o secuencia de inicio)
para iniciar la transmisión de datos.
La condición de inicio "Cualquier carácter" no puede combinarse con otras condiciones de
inicio.

Programación del PLC
Manual de programación y manejo, 11/2019

7013

Instrucciones
4.2 Instrucciones

Estructura del tipo de datos del parámetro Receive_Conditions, parte 1 (condiciones de inicio)
Tabla 4-375 Estructura de Receive_Conditions para condiciones de inicio
Parámetro

Declaración Tipo de
datos

Ajuste prede‐ Descripción
terminado

START.START‐
COND

IN

16#0002

Word

Indicación de la condición de inicio
● 01H - detección del carácter de inicio
● 02H - cualquier carácter
● 04H - detección de Line Break
● 08H - detección de Idle Line
● 10H - detección de la secuencia de inicio 1
● 20H - detección de la secuencia de inicio 2
● 40H - detección de la secuencia de inicio 3
● 80H - detección de la secuencia de inicio 4
Las condiciones de inicio pueden combinarse sumando los va‐
lores.

START.IDLETI‐
ME

IN

Word

16#0028

Número de tiempos de bit necesarios en vacío para que se de‐
tecte un nuevo inicio de la trama (valor predeterminado:
W#16#28). Solo en combinación con la condición "detección de
Idle Line".

START.START‐
CHAR

IN

Byte

16#0002

Carácter de inicio para la condición "carácter de inicio". (valor
predeterminado: B#16#2)

START.SEQ[1].
CTL

IN

Byte

0

Secuencia de inicio 1, desactivar/activar comparación para ca‐
da carácter: (valor predeterminado: B#16#0)

0 a FFFF

Estos son los bits de activación para cada carácter de la se‐
cuencia de inicio.
● 01H - carácter 1
● 02H - carácter 2
● 04H - carácter 3
● 08H - carácter 4
● 10H - carácter 5
Si se desactiva un bit para un carácter determinado, significa
que en esta posición de la secuencia cada carácter representa
una secuencia de inicio válida (p. ej. 1FH = se interpretan los 5
caracteres).
START.SEQ[1].
STR[1] ..
START.SEQ[1].
STR.[5]

IN

Char[5]

0

Secuencia de inicio 1, carácter de inicio (5 caracteres).

START.SEQ[2].
CTL

IN

Byte

0

Secuencia de inicio 2, desactivar/activar comparación para ca‐
da carácter. Valor predeterminado: B#16#0)

START.SEQ[2].
STR[1] ..
START.SEQ[2].
STR.[5]

IN

Char[5]

0

Secuencia de inicio 2, carácter de inicio (5 caracteres).

7014

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de
datos

Ajuste prede‐ Descripción
terminado

START.SEQ[3].
CTL

IN

Byte

0

Secuencia de inicio 3, desactivar/activar comparación para ca‐
da carácter. Valor predeterminado: B#16#0

START.SEQ[3].
STR[1] ..
START.SEQ[3].
STR.[5]

IN

Char[5]

0

Secuencia de inicio 3, carácter de inicio (5 caracteres).

START.SEQ[4].
CTL

IN

Byte

0

Secuencia de inicio 4, desactivar/activar comparación para ca‐
da carácter. Valor predeterminado: B#16#0

START.SEQ[4].
STR[1] ..
START.SEQ[4].
STR.[5]

IN

Char[5]

0

Secuencia de inicio 4, carácter de inicio (5 caracteres).

Ejemplo
Observe los siguientes datos recibidos en código hexadecimal: "68 10 aa 68 bb 10 aa 16".
Encontrará las secuencias de caracteres de inicio configuradas en la tabla siguiente. Las
secuencias de caracteres de inicio se evalúan una vez se ha recibido correctamente el primer
carácter 68H. Tras la recepción correcta del cuarto carácter (el segundo 68H) se ha cumplido
la condición de inicio 1. Si se cumplen las condiciones de inicio, empieza la evaluación de las
condiciones de fin.
El procesamiento de la secuencia de caracteres inicial puede finalizarse debido a diferentes
errores de paridad, framing o intervalos entre los caracteres. Dichos errores hacen que los
datos no se reciban porque no se cumple la condición de inicio (se genera un mensaje de error).
Tabla 4-376 Condiciones de inicio
Condición de inicio

Primer carácter

Primer carácter +1 Primer carácter +2 Primer carácter +3 Primer carácter +4

1

68H

xx

xx

68H

xx

2

10H

aaH

xx

xx

xx

3

dcH

aaH

xx

xx

xx

4

e5H

xx

xx

xx

xx

Condiciones de fin de la instrucción Receive_P2P
El final de una trama se define por la primera aparición de una o varias condiciones de fin
configuradas.
Las condiciones de fin se configuran en las propiedades de la interfaz de comunicación de la
configuración de dispositivos o bien mediante la instrucción Receive_Config. Tras retornar la
tensión de la CPU o del módulo de comunicaciones, los parámetros de recepción (condiciones
de inicio y fin) se ponen de nuevo a los ajustes de la configuración de dispositivos. Si el
programa de usuario de STEP 7 ejecuta Receive_Config, los ajustes cambian a los parámetros
de Receive_Config .

Programación del PLC
Manual de programación y manejo, 11/2019

7015

Instrucciones
4.2 Instrucciones

Estructura del tipo de datos del parámetro Receive_Conditions, parte 2 (condiciones de fin)
Tabla 4-377 Estructura de Receive_Conditions para condiciones de fin
Parámetro

Declaración Tipo de
datos

Ajuste prede‐ Descripción
terminado

END.END‐
COND

IN

0

Word

Este parámetro indica la condición para el fin de trama:
● 01H - tiempo de respuesta excedido
● 02H - tiempo de espera del mensaje excedido
● 04H - tiempo de retardo de caracteres
● 08H - longitud máxima de trama
● 10H - leer longitud del mensaje en el mensaje (N+LEN+M)
● 20H - secuencia de fin
● 40H - longitud fija de trama

END.FIXLEN

IN

Word

1

Longitud fija de trama: solo se utiliza si se selecciona la condi‐
ción de fin "Longitud fija de trama".
De 1 a 4000 bytes (en función del módulo hasta 4 kbytes)

END.MAXLEN

IN

Word

1

Longitud máxima de trama: solo se utiliza si se selecciona la
condición de fin "Longitud máxima de trama".
De 1 a 4000 bytes (en función del módulo hasta 4 kbytes)

END.N

IN

Word

0

Posición de byte del campo de longitud en la trama. Solo se
utiliza con la condición de fin N+LEN+M.
De 1 a 4000 bytes (en función del módulo hasta 4 kbytes)

END.LENGTH‐
SIZE

IN

Word

0

Tamaño del campo de longitud (1, 2 o 4 bytes). Solo se utiliza
con la condición de fin N+LEN+M.

END.LENGTHM IN

Word

0

Número de caracteres posteriores al campo de longitud que no
están incluidos en el valor del mismo. Este dato solo se utiliza
con la condición de fin N+LEN+M. 0 a 255 bytes

END.RCVTIME

Word

200

Indique el tiempo durante el que debe esperarse el primer ca‐
rácter recibido tras enviar una trama. La instrucción de recep‐
ción finalizará con un mensaje de error si dentro del tiempo
indicado no se recibe ningún carácter correctamente. Este dato
solo se utiliza con la condición "tiempo de respuesta excedido".
(0 a 65535 ms).

IN

Nota: Este parámetro no puede utilizarse como criterio único de
fin, sino solamente en combinación con al menos otra condición
de fin.
END.MSGTIME

IN

Word

200

Indique el tiempo que debe esperarse a la recepción completa
de la trama tras haber recibido el primer carácter. Este paráme‐
tro solo se utiliza cuando está seleccionada la condición "tiempo
de espera del mensaje excedido". (0 a 65535 ms)

END.CHARGAP IN

Word

12

Indique el número máximo de tiempos de bit entre los caracte‐
res. Si el número de tiempos de bit entre los caracteres rebasa
por exceso el valor indicado, se cumple la condición de fin. Este
dato solo se utiliza con la condición "tiempo de retardo de ca‐
racteres". (0 a 65535 tiempos de bit)

7016

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de
datos

Ajuste prede‐ Descripción
terminado

END.SEQ.CTL

IN

0

Byte

Secuencia de caracteres 1, desactivar/activar comparación pa‐
ra cada carácter:
Estos son los bits de activación para cada carácter de la se‐
cuencia de fin. El carácter 1 es el bit 0, el carácter 2 es el bit 1, ...,
el carácter 5 es el bit 4. Si se desactiva un bit para un carácter
concreto, significa que en esta posición de la secuencia cada
carácter representa una coincidencia.

END.SEQ.STR[
1] ..
END.SEQ.STR[
5]

IN

Char[5]

0

Secuencia de caracteres 1, carácter de inicio (5 caracteres)

Tabla 4-378 Parámetros generales de la instrucción Receive_P2P
Parámetro

Declaración Tipo de
datos

Ajuste prede‐ Descripción
terminado

GENE‐
RAL.MBUF_SI‐
ZE

IN

Byte

255

Entrada del número de tramas que deben guardarse en el búfer
de recepción del CM.
Si no hay otras condiciones activas que influyan en el compor‐
tamiento del búfer de recepción (impedir sobrescritura, control
del flujo de datos), tras alcanzar el límite se rechazan las nuevas
tramas (1 a 255 tramas).

GENE‐
IN
RAL.OW_PROT

Byte

0

Activa la función para no sobrescribir la trama en búfer, en caso
de que el CM reciba una nueva trama sin que se haya efectuado
la lectura del búfer de recepción del CM. Con esto se evita una
eventual pérdida de las tramas de recepción que ya están en el
búfer.
● 0 - no activado
● 1 - activado

GENE‐
RAL.CLR_MBU
F

IN

Byte

0

Activa el borrado del búfer de recepción en el arranque de la
CPU.
Si este parámetro está activado, el búfer de recepción se borra
automáticamente en la transición de la CPU de STOP a RUN.
En el búfer de recepción solo hay tramas que fueron recibidas
después del arranque de la CPU.
● 0 - no activado
● 1 - activado

P3964_Config: Configurar el protocolo 3964(R)
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Programación del PLC
Manual de programación y manejo, 11/2019

7017

Instrucciones
4.2 Instrucciones

Descripción
La instrucción P3964_Config (configuración del protocolo) permite modificar desde el
programa y durante el funcionamiento los parámetros del protocolo 3964(R) como tiempo de
retardo de caracteres, prioridad y control de bloque.
Los cambios de configuración de P3964_Config no se guardan en la CPU sino en el CM. Los
parámetros guardados en la configuración de dispositivos se restablecen al retornar la tensión
de la CPU o del módulo de comunicaciones.

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste pre‐
determina‐
do

Descripción

FALSE

Inicia la instrucción con un flanco ascendente en esta
entrada.

0

Especifica el módulo de comunicación a través del
cual se produce la comunicación:
● para S7-1500/S7-1200: "Identificador de
hardware" de la configuración del dispositivo.
El nombre simbólico del puerto está asignado en
la ficha "Constantes de sistema" de la tabla de
variables PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada
en HWCN.

BCC

IN

USInt

Byte

1

Activa/desactiva el uso de la comprobación de bloque
● 0 = sin control de bloque
● 1 = con control de bloque

Priority

IN

USInt

Byte

1

Ajuste de la prioridad
● 0 = prioridad baja
● 1 = prioridad alta

CharacterDe‐
layTime

IN

UInt

Word

16#00DC

AcknDelayTime IN

UInt

Word

16#07D0

Ajuste del tiempo de retardo de caracteres (en función
de la velocidad de transferencia de datos ajustada)
(valor predeterminado: 220 ms)
De 1 a 65535 ms
Ajuste del tiempo de retardo de acuse (en función de
la velocidad de transferencia de datos ajustada) (valor
predeterminado: 2000 ms)
De 1 a 65535 ms

BuildupAt‐
tempts

7018

IN

USInt

Byte

16#0006

Ajuste del número de intentos de establecer conexión
(valor predeterminado: 6 intentos de establecer cone‐
xión)
1 a 255

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declara‐
ción

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Ajuste pre‐
determina‐
do

Descripción

Ajuste del número de intentos de transmisión (valor
predeterminado: 6 intentos de establecer conexión)
1 a 255

RepetitionAt‐
tempts

IN

USInt

Byte

16#0006

COM_RST

IN/OUT

---

Bool

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente,
la instrucción ajusta COM_RST de nuevo a FALSE.

DONE

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última pe‐
tición se haya ejecutado correctamente

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última pe‐
tición se haya ejecutado con errores

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Send_P2P: transferir datos
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Send_P2P (enviar datos punto a punto) inicia la transferencia de los datos y
transfiere el contenido del búfer asignado al módulo de comunicaciones. El programa de la
CPU se sigue ejecutando mientras el CM envía los datos a la velocidad de transferencia. No
puede haber más de una instrucción de transmisión a la vez para cada módulo de
comunicaciones. El CM emite un error si se ejecuta una segunda instrucción Send_P2P
mientras el CM está enviando una trama.

Programación del PLC
Manual de programación y manejo, 11/2019

7019

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste prede‐ Descripción
terminado

FALSE

Inicia la transferencia de datos al CM con un flanco as‐
cendente en esta entrada.

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

BUFFER

IN

Variant

Any

0

Este parámetro señala el área de memoria del búfer de
transmisión.
Notas:
● No se soportan datos booleanos ni campos
booleanos.
● Si el búfer de transmisión está en el área de memoria
optimizada, la máxima longitud admisible de datos
enviados es de 1024 bytes.
Excepción: los arrays de Byte, Word o DWord se
soportan hasta una longitud de 4096 bytes.
● Si el búfer de transmisión es de tipo String o WString,
el contenido del string se transmite sin la longitud
actual y máxima.
Más información en "Uso de los parámetros BUFFER y
LENGTH en operaciones de comunicación (Página 7022)"

LENGTH

IN

UInt

Word

0

Longitud de los datos que deben transmitirse en bytes.
Con LENGTH = 0 se transfiere completamente el área de
memoria direccionada en el parámetro BUFFER.
Más información en "Uso de los parámetros BUFFER y
LENGTH en operaciones de comunicación (Página 7022)"

COM_RST IN/OUT

---

Bool

FALSE

Inicialización de la instrucción Send_P2P
Con 1 se inicializa la instrucción. Seguidamente, la ins‐
trucción pone COM_RST de nuevo a 0.
Nota:
El parámetro solo está disponible para instrucciones
S7-300/400.

DONE

7020

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado correctamente

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declara‐
ción

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Ajuste prede‐ Descripción
terminado

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado con errores

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Parámetros
Cuando una instrucción de transmisión se está procesando, las salidas DONE y ERROR están
en estado FALSE. Una vez finalizada una instrucción de transmisión, una de las salidas DONE
o ERROR se pone a TRUE durante un ciclo para notificar el estado de la instrucción de
transmisión. Si ERROR está en estado TRUE, puede evaluarse el código de error en la salida
STATUS.
La instrucción emite el estado 16#7001 si la interfaz de comunicación acepta los datos
transmitidos. Las ejecuciones posteriores de Send_P2P emiten el valor 16#7002 mientras el
CM sigue enviando. Tras finalizar la instrucción de transmisión, el CM emite el estado 16#0000
para la instrucción de transmisión (siempre que no se produzca ningún error). Las ejecuciones
posteriores de Send_P2P con REQ = 0 dan el estado 16#7000 (libre).
El diagrama siguiente muestra la relación entre los valores de salida y REQ. Se presupone que
la instrucción se llama cíclicamente para comprobar el estado del proceso de transmisión (se
representa mediante los valores de STATUS).

La figura siguiente muestra cómo los parámetros DONE y STATUS solo son válidos durante
un ciclo si en la línea REQ (durante un ciclo) hay un impulso para lanzar la instrucción de
transmisión.

La figura siguiente muestra la relación de los parámetros DONE, ERROR y STATUS en caso
de error.

Programación del PLC
Manual de programación y manejo, 11/2019

7021

Instrucciones
4.2 Instrucciones

Los valores de DONE, ERROR y STATUS son válidos únicamente hasta que Send_P2P se
ejecuta con el mismo DB de instancia.

Uso de los parámetros BUFFER y LENGTH en operaciones de comunicación
Interacción de los parámetros BUFFER y LENGTH para Send_P2P
El tamaño mínimo de los datos que puede enviar la instrucción Send_P2P es de un byte.
El parámetro BUFFER define el tamaño de los datos que deben enviarse si durante una
llamada se transfiere un "0" en el parámetro LENGTH. De ese modo basta con indicar una
variable.
Para el parámetro BUFFER no es posible utilizar el tipo de datos Bool ni matrices del tipo Bool.
Si se transfieren grandes cantidades de datos, se recomienda reflejarlo en los tipos de datos
Array o Struct.
Tabla 4-379 Parámetro BUFFER
BUFFER

Descripción

Tipo de datos simple

En el envío, se aplica lo siguiente: El valor LENGTH debe contener el número de bytes de este tipo
de datos.
Ejemplo: con un valor Word, LENGTH debe ser dos. Con un valor DWord o Real, LENGTH debe ser
cuatro.

Estructura

En relación con la memoria optimizada, se aplica lo siguiente: la longitud máxima permitida de
BUFFER es 1024 Byte; de lo contrario, se admiten hasta 4 kbytes en función del módulo.
En la transmisión se aplica lo siguiente: el valor de LENGTH puede contener un número de bytes
inferior a la longitud completa de bytes de la estructura; en este caso, solo se envían los primeros
bytes LENGTH de la estructura de BUFFER.

Array

En relación con la memoria optimizada, se aplica lo siguiente: Si el tipo de datos Array es diferente
de Byte, Word o DWord, la longitud máxima permitida del búfer es de 1024 Byte. Si la memoria no
está optimizada, pueden transferirse hasta 4 KB en función del módulo, independientemente de la
estructura de datos.
En el envío se aplica lo siguiente: el valor de LENGTH puede contener un número de bytes inferior
a la longitud completa de bytes de la matriz, siendo siempre un múltiplo del número de bytes del
elemento de datos. Ejemplo: el parámetro LENGTH de una matriz del tipo Word debe ser un múltiplo
de dos y, con una matriz del tipo Real, un múltiplo de cuatro.
Si se indica LENGTH, se transfiere el número de elementos de matriz. Si, por ejemplo, BUFFER
contiene una matriz con 15 elementos DWord (60 Bytes en total) y se indica LENGTH = 20, se
transfieren los cinco primeros elementos DWord de la matriz.

String

7022

El parámetro LENGTH contiene el número de caracteres que deben transmitirse. Solo se transmiten
los caracteres de String. Los bytes con la longitud máxima y real de String no se transmiten.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tabla 4-380 Parámetro LENGTH
LENGTH

Descripción

=0

Se transfiere el contenido completo del área de memoria especificada mediante BUFFER.
Si BUFFER señala a un string, se transfiere todo el contenido del string sin los bytes con la longitud
máxima y real.

>0

Se transfiere el contenido hasta la longitud parametrizada del área de memoria especificada me‐
diante BUFFER.

Receive_P2P: recibir datos
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Receive_P2P (datos recibidos mediante una comunicación punto a punto)
comprueba las tramas que se han recibido en el CM. Cuando hay una trama disponible, el CM
la transfiere a la CPU. Un error de recepción se indica en el parámetro STATUS.

Programación del PLC
Manual de programación y manejo, 11/2019

7023

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declara‐
ción

PORT

IN

Tipo de datos
S71200/150
0
PORT
(UInt)

S7300/400/
WinAC
Word

Ajuste prede‐
terminado

Descripción

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

BUFFER

IN

Variant

Any

0

Este parámetro señala la dirección de inicio del búfer de
recepción. Este búfer debe ser lo suficientemente grande
como para recibir la longitud máxima de la trama.
Nota:
● No se soportan datos booleanos o campos booleanos.
● Si el búfer de recepción está en el área de memoria
optimizada, la máxima longitud admisible de datos
recibidos es de 1024 bytes.
Excepción: los arrays de Byte, Word o DWord se
soportan hasta una longitud de 4096 bytes.
● Si el búfer de recepción es de tipo String o WString, los
datos recibidos se escriben en el contenido del string,
y la longitud actual del string se ajusta de forma
correspondiente.
Más información en "Uso de los parámetros BUFFER y
LENGTH en operaciones de comunicación (Página 7022)"

LENGTH

OUT

UInt

Word

0

Longitud de la trama recibida en bytes
Más información en "Uso de los parámetros BUFFER y
LENGTH en operaciones de comunicación (Página 7022)"

NDR

OUT

Bool

COM_RST IN/OUT

---

Bool

FALSE

TRUE durante un ciclo cuando hay datos nuevos prepa‐
rados y la instrucción ha finalizado correctamente.

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la instrucción haya
finalizado con errores.

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

7024

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Si ERROR está en estado TRUE, puede evaluarse el código de error en la salida STATUS. El
valor de STATUS suministra el motivo para finalizar la operación de recepción en el CM.
Este suele ser un valor positivo que indica que la operación de recepción ha sido correcta y qué
criterio de fin de trama se ha detectado.
Si el valor de STATUS es negativo (se ha activado el bit más significativo del valor
hexadecimal), la operación de recepción ha finalizado debido a una condición de error, como
error de paridad, framing o desbordamiento.
Cada módulo de comunicaciones puede respaldar un número de tramas específico del
módulo. Si hay varias tramas disponibles en el CM, la instrucción Receive_P2P emite la más
antigua (FIFO).

Receive_Reset: borrar el búfer de recepción
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Receive_Reset (resetear receptor) borra el búfer de recepción del CM.

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste prede‐ Descripción
terminado

FALSE

Inicia la transferencia de datos al CM con un flanco as‐
cendente en esta entrada.

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

COM_RST IN/OUT

---

Bool

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.

Programación del PLC
Manual de programación y manejo, 11/2019

7025

Instrucciones
4.2 Instrucciones
Parámetro

Declara‐
ción

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Ajuste prede‐ Descripción
terminado

DONE

OUT

Bool

FALSE

TRUE durante un ciclo significa que la última petición se
ha ejecutado correctamente.

ERROR

OUT

Bool

FALSE

TRUE significa que la última petición se ha ejecutado con
errores. Si esta salida es TRUE, la salida STATUS con‐
tiene los códigos de error correspondientes.

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Signal_Get: leer estado
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Signal_Get (consultar señales RS232) lee los estados actuales de las señales
cualificadoras RS232 y las muestra en las salidas correspondientes de la instrucción.
Nota
Limitación
● Esta instrucción solo puede utilizarse con los CM RS232 BA y RS232 HF.
● Si en el modo de operación está ajustado RS232C, esta instrucción también podrá
utilizarse con el CM PtP (ET200SP).

7026

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste prede‐ Descripción
terminado

FALSE

Inicia la transferencia de datos al CM con un flanco as‐
cendente en esta entrada.

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

NDR

OUT

Bool

FALSE

TRUE durante un ciclo cuando las señales cualificadoras
RS232 se han leído y la instrucción ha finalizado correc‐
tamente.

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la instrucción haya
finalizado con errores.

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

DTR

OUT

Bool

FALSE

Terminal de datos preparado, módulo disponible (salida)

DSR

OUT

Bool

FALSE

Terminal de datos preparado, dispositivo de comunica‐
ción preparado (entrada)

RTS

OUT

Bool

FALSE

petición de transmisión, módulo preparado para enviar
(salida)

CTS

OUT

Bool

FALSE

Listo para transmitir, el dispositivo de comunicación pue‐
de recibir datos (entrada)

DCD

OUT

Bool

FALSE

Señal del soporte de datos detectada, nivel de señal reci‐
bido

RING

OUT

Bool

FALSE

Indicador de llamada, aviso de una llamada entrante

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Signal_Set: activar señales cualificadoras
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Programación del PLC
Manual de programación y manejo, 11/2019

7027

Instrucciones
4.2 Instrucciones

Descripción
La instrucción Signal_Set (establecer señales RS232) permite establecer las señales de
comunicación RS232.
Nota
Limitaciones
● Esta instrucción solo puede utilizarse con los CM RS232 BA y RS232 HF.
● Si en el modo de operación está ajustado RS232C, esta instrucción también podrá
utilizarse con el CM PtP (ET200SP).

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste prede‐ Descripción
terminado

FALSE

Inicia la instrucción con un flanco ascendente en esta en‐
trada.

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

SIGNAL

IN

Byte

0

Selección de la señal que debe establecerse (se admiten
varias):
● 01H = RTS
● 02H = DTR
● 04H = DSR (solo válido para el tipo de interfaz DCE)

RTS

IN

Bool

FALSE

petición de transmisión, módulo preparado para enviar
Definir este valor en la salida (TRUE o FALSE), valor pre‐
determinado: FALSE

DTR

IN

Bool

FALSE

Terminal de datos preparado, módulo preparado
Definir este valor en la salida (TRUE o FALSE), valor pre‐
determinado: FALSE

DSR

IN

COM_RST IN/OUT

Bool
---

Bool

FALSE

Terminal de datos preparado (solo válido para el tipo de
interfaz DCE), no utilizado.

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.

7028

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declara‐
ción

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Ajuste prede‐ Descripción
terminado

DONE

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado correctamente

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la última petición
se haya ejecutado con errores

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Get_Features: obtener funciones avanzadas
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Get_Features (obtener funciones avanzadas) permite consultar información
relacionada con la capacidad del módulo para soportar CRC y generar avisos de diagnóstico,
siempre que el módulo la soporte.

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/15
00

S7300/400/
WinAC
Bool

PORT

Word

Ajuste pre‐
Descripción
determinado

FALSE

Inicia la instrucción con un flanco ascendente en esta en‐
trada.

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

Programación del PLC
Manual de programación y manejo, 11/2019

7029

Instrucciones
4.2 Instrucciones
Parámetro

Declara‐
ción

Tipo de datos
S71200/15
00

S7300/400/
WinAC

Ajuste pre‐
Descripción
determinado

NDR

OUT

Bool

FALSE

TRUE durante un ciclo cuando hay datos nuevos prepa‐
rados y la instrucción ha finalizado correctamente

MOD‐
BUS_CRC

OUT

Bool

FALSE

Soporte de Modbus CRC

DIAG_ALA
RM

OUT

Bool

FALSE

Generación de avisos de diagnóstico

SUPPLY_V
OLT

OUT

Bool

FALSE

Diagnóstico disponible para Falta tensión de alimentación
L+

COM_RST

IN/OUT

---

Bool

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la instrucción haya
finalizado con errores.

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Set_Features: activar funciones avanzadas
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Set_Features (seleccionar funciones avanzadas) permite activar la
compatibilidad con CRC y la generación de avisos de diagnóstico, siempre que el módulo la
soporte.

7030

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
PORT
(UInt)

Word

Ajuste pre‐
determina‐
do

Descripción

FALSE

La instrucción para establecer funciones avanzadas
se inicia con un flanco ascendente en esta entrada.

0

Especifica el módulo de comunicación a través del
cual se produce la comunicación:
● para S7-1500/S7-1200: "Identificador de
hardware" de la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de
variables PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada
en HWCN.

EN_MOD‐
BUS_CRC

IN

Bool

FALSE

Activar soporte de Modbus CRC

EN_DIAG_AL
ARM

IN

Bool

FALSE

Activar generación de avisos de diagnóstico

EN_SUPPLY_
VOLT

IN

Bool

FALSE

Activar diagnóstico para Falta tensión de alimentación
L+
Nota:
Los módulos de comunicación S7-1500 y ET 200MP
no soportan este diagnóstico. Esto es aplicable aun‐
que el parámetro se pueda activar en combinación
con, p. ej., MODBUS_CRC.

COM_RST

IN/OUT

---

Bool

FALSE

Inicialización de la instrucción
La instrucción se inicializa con TRUE. Seguidamente,
la instrucción ajusta COM_RST de nuevo a FALSE.

DONE

OUT

Bool

FALSE

TRUE durante una ejecución después de que la última
petición se haya ejecutado correctamente

ERROR

OUT

Bool

FALSE

TRUE durante un ciclo después de que la instrucción
haya finalizado con errores.

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Pági‐
na 7032))

Encontrará más información acerca de los parámetros generales en "Parámetros comunes
para las operaciones Freeport (Página 7006)".

Programación del PLC
Manual de programación y manejo, 11/2019

7031

Instrucciones
4.2 Instrucciones

Mensajes de error
Sinopsis de los mensajes de error PtP
Los mensajes de error se ponen a disposición en la salida STATUS de una instrucción y allí
pueden ser evaluados o procesados en el programa de usuario.
Código de
error

Descripción

Solución

16#0000

No hay error

‑

Estado de RECEIVE y códigos de error
16#0094

Fin de telegrama detectado por "recepción de una lon‐ ‑
gitud fija/máxima de telegrama"

16#0095

Fin de telegrama detectado por "tiempo de espera del
mensaje excedido"

‑

16#0096

Fin de telegrama detectado por fin del "tiempo de re‐
tardo de caracteres"

‑

16#0097

El telegrama se ha cancelado porque se ha alcanzado
el tiempo de respuesta máximo.

‑

16#0098

Fin de telegrama detectado por cumplirse las condi‐
ciones de "Leer longitud del mensaje en el mensaje"

‑

16#0099

Fin de telegrama detectado por recepción de la "se‐
cuencia de fin"

‑

Estado de SEND y códigos de error
16#7000

Bloque en vacío

‑

16#7001

Primera llamada para un nuevo telegrama: transferen‐ ‑
cia de datos iniciada

16#7002

Llamada intermedia: transferencia de datos en curso

‑

16#8085

Indicación de longitud no válida

Seleccione una longitud de telegrama adecuada.
Se admiten (en función del módulo):
1-1024/2048/4096 (Byte)

16#8088

Indicación de longitud mayor que el área ajustada en el
búfer de recepción.
Nota: En el caso de que en el parámetro BUFFER se
haya especificado el tipo de datos STRING, también
aparece este código de error si la longitud de String
actual es inferior al valor indicado en el parámetro
LENGTH.

16#8090

Error de configuración: número impar de bytes como
WString

Modifique el área en el búfer de recepción o seleccio‐
ne una longitud de telegrama adecuada al área ajus‐
tada en el búfer.
Se admiten (en función del módulo):
1-1024/2048/4096 (bytes)

Elija un número par de bytes.

Estado de RECEIVE y códigos de error
16#7001

Primera llamada para un nuevo telegrama: transferen‐ ‑
cia de datos iniciada

16#7002

Llamada intermedia: transferencia de datos en curso

‑

16#8088

El número de caracteres recibidos es superior al es‐
pecificado en el parámetro BUFFER.

Seleccione una longitud de telegrama adecuada.

Error de configuración: número impar de bytes como
WString

Elija un número par de bytes.

16#8090

7032

Se admiten (en función del módulo):
1-1024/2048/4096 (bytes)

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

Códigos de mensajes de error de las funciones especiales
16#818F

Ajuste erróneo del número de parámetro (solo en USS) Seleccione un número de parámetro adecuado (PA‐
RAM).
Se admiten: 0-2047

16#8190

Ajuste erróneo del cálculo CRC

Seleccione un valor adecuado para el cálculo CRC.
Se admiten: desactivado o activado.
Compruebe si el módulo direccionado soporta el cál‐
culo CRC.

16#8191

Ajuste erróneo de la alarma de diagnóstico

Seleccione un valor adecuado para "Alarma de diag‐
nóstico".
Se admiten: alarma de diagnóstico desactivada o
alarma de diagnóstico activada.
Compruebe si el módulo direccionado soporta la ge‐
neración de alarmas de diagnóstico.

16#8193

El módulo no soporta el diagnóstico de tensión de ali‐ Seleccione un valor adecuado para "Alarma de diag‐
mentación L+.
nóstico".
Se admiten: alarma de diagnóstico desactivada o
alarma de diagnóstico activada.
Compruebe si el módulo direccionado soporta la ge‐
neración de alarmas de diagnóstico.

Códigos de mensajes de error de la "Configuración del puerto"
16#81A0

El módulo no soporta este protocolo.

Seleccione un protocolo compatible con el módulo
(PROTOCOL).

16#81A1

El módulo no soporta esta velocidad de transferencia
de datos.

Seleccione una velocidad de transferencia de datos
compatible con el módulo (BAUD).

16#81A2

El módulo no soporta este ajuste de paridad.

Seleccione un valor adecuado para "Paridad" (PA‐
RITY).
Se admiten:
● Sin (1)
● Par (2)
● Impar (3)
● Mark (4)
● Space (5)
● Cualquiera (6)

16#81A3

El módulo no soporta este número de bits de datos.

Seleccione un valor adecuado para "Bits de datos"
(DATABITS).
Se admiten:
● 7 (2)
● 8 (1)

16#81A4

El módulo no soporta este número de bits de parada.

Seleccione un valor adecuado para "Bits de parada"
(STOPBITS).
Se admiten:
● 1 (1)
● 2 (2)

Programación del PLC
Manual de programación y manejo, 11/2019

7033

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#81A5

El módulo no soporta este tipo de control del flujo de
datos.

Seleccione un control del flujo de datos compatible
con el módulo (FLOWCTRL).

16#81A7

Valor no admisible para XON o XOFF

Seleccione valores adecuados para XON (XON‐
CHAR) y XOFF (XOFFCHAR).

16#81AA

Modo de operación no admisible

Rango admisible: 0...255
Los modos de operación admitidos son:
● Dúplex (RS232) (0)
● Dúplex (RS422) modo a cuatro hilos (punto a
punto) (1)
● Dúplex (RS422) modo a cuatro hilos (maestro
multipunto) (2)/(CM PtP (ET 200SP))
● Dúplex (RS422) modo a cuatro hilos (esclavo
multipunto) (3)/(CM PtP (ET 200SP))
● Semidúplex (RS485) modo a dos hilos (4)
16#81AB

Estado inicial no admisible de la línea de recepción

Los estados iniciales admitidos son:
● "Sin" estado inicial (0)
● Señal R(A) = 5 V, señal R(B) = 0 V (detección
break) (1):
Solo disponible con: "Dúplex (RS422) modo a
cuatro hilos (acoplamiento punto a punto)" y
"Dúplex (RS422) modo a cuatro hilos (esclavo
multipunto)".
● Señal R(A) = 0 V, señal R(B) = 5 V (2): este estado
inicial corresponde al estado de reposo (ninguna
transmisión activa).

16#81AC

Valor no admisible para "Detección break"

Seleccione un valor adecuado para "Detección
break". Se admiten:
● Detección break desactivada (0)
● Detección break activada (1)

16#81AF

El módulo no soporta este protocolo.

Seleccione un protocolo compatible con el módulo.

Códigos de error de la "Configuración de transmisión"
16#81B5

Más de 2 caracteres de fin -o biensecuencia de fin > 5 caracteres

Seleccione valores adecuados para "Carácter de fin"
y "Secuencia de fin".
Se admiten:
● desactivado (0)
● 1 (1) o 2 (2) caracteres de fin
o bien:
● desactivado (0)
● de 1 (1) a 5 (5) caracteres para la secuencia de fin

16#81B6

Send Configuration rechazado porque está seleccio‐
nado el protocolo 3964(R)

Asegúrese de que no se envía ninguna configuración
de transmisión cuando esté ajustado el protocolo
3964(R).

Códigos de error de la "Configuración de recepción"

7034

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#81C0

Condición de inicio no admisible

Seleccione una condición de inicio adecuada.
Se admiten:
● Enviar break antes de iniciar el telegrama
● Enviar Idle Line.

16#81C1

Condición de fin no admisible o no se ha seleccionado
ninguna condición de fin

Seleccione una condición de fin adecuada (consulte
AUTOHOTSPOT).

16#81C3

Valor no admisible para "Longitud máxima del mensa‐ Seleccione un valor adecuado para "Longitud máxi‐
je"
ma del mensaje" (MAXLEN).
Rango admisible (en función del módulo):
1‑1024/2048/4096 (bytes)

16#81C4

Valor no admisible para "Offset de la longitud en el
mensaje"

Seleccione un valor adecuado para "Offset de la lon‐
gitud en el mensaje".
Rango admisible (en función del módulo):
1‑1024/2048/4096 (bytes)

16#81C5

Valor no admisible de "Tamaño del campo de longitud" Seleccione un valor adecuado para "Tamaño del
campo de longitud" (LENGTHSIZE).
Rango admisible en bytes:
● 1 (1)
● 2 (2)
● 4 (4)

16#81C6

Valor no admisible para "Número de caracteres que se
excluyen de la longitud"

16#81C7

La suma de "Offset del mensaje + tamaño del campo
de longitud + número de caracteres que se excluyen"
es mayor que la longitud máxima del telegrama

Seleccione un valor adecuado para "Número de ca‐
racteres que se excluyen de la longitud" (LENGTHM).
Rango admisible: de 0 a 255 (bytes)
Seleccione valores adecuados para "Offset del men‐
saje", "Tamaño del campo de longitud" y "Número de
caracteres excluidos".
Rango admisible:
● Offset del mensaje (en función del módulo):
0-1024/2048/4096 (bytes)
● Tamaño del campo de longitud: 1, 2 o 4 (bytes)
● Número de caracteres excluidos: 0-255 (bytes)

16#81C8

Valor no admisible para "Tiempo de respuesta excedi‐ Seleccione un valor adecuado para "Tiempo de res‐
do"
puesta excedido".
Rango admisible: 1-65535 (ms)

16#81C9

Valor no admisible para "Tiempo de retardo de carac‐ Seleccione un valor adecuado para "Tiempo de retar‐
teres"
do de caracteres".
Rango admisible: 1-65535 (tiempos de bit)

16#81CB

Secuencia de fin de telegrama activada, pero ninguno
de los caracteres está activado para la comprobación

Active uno o varios caracteres para la comprobación.

16#81CC

Secuencia de principio de telegrama activada, pero
ninguno de los caracteres está activado para la com‐
probación

Active uno o varios caracteres para la comprobación.

Programación del PLC
Manual de programación y manejo, 11/2019

7035

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#81CD

Valor no admisible para "Impedir sobrescritura"

Seleccione un valor adecuado para "Impedir sobres‐
critura".
Se admiten:
● Impedir sobrescritura desactivado (0)
● Impedir sobrescritura activado (1)

16#81CE

Valor no admisible para "Borrar búfer de recepción al
arrancar"

Seleccione un valor adecuado para "Borrar búfer de
recepción al arrancar".
Se admiten:
● Borrar búfer de recepción al arrancar desactivado
(0)
● Borrar búfer de recepción al arrancar activado (1)

Estado de SEND y códigos de error
16#81D0

Recibir orden de transmisión durante el tiempo de eje‐ Asegúrese de que no se solicitan más transmisiones
cución de una orden de transmisión
durante el tiempo de ejecución de una orden de trans‐
misión.

16#81D1

El tiempo de espera a XON o CTS = ON ha transcurri‐ El interlocutor falla, es demasiado lento o está offline.
do.
Compruebe el interlocutor o modifique la parametri‐
zación en caso necesario.

16#81D2

"Hardware RTS siempre ON": orden de transmisión
cancelada por cambio de DSR = ON a OFF

Compruebe el interlocutor. Asegúrese de que DSR
está ON durante toda la transferencia.

16#81D3

Desbordamiento del búfer de transmisión / telegrama
de transmisión demasiado grande

Seleccione una longitud de telegrama menor.

16#81D5

Transferencia cancelada por cambio en la parametri‐
zación, detección de rotura de hilo o CPU en STOP

Compruebe la parametrización, rotura de hilo o el es‐
tado de la CPU.

16#81D6

Transferencia cancelada porque no se ha recibido el
delimitador de fin

Compruebe la parametrización de los caracteres de
fin y el telegrama del interlocutor.

16#81D7

Fallo de comunicación entre programa de usuario y
módulo

Compruebe la comunicación (p. ej. coincidencia del
número de secuencia).

16#81D8

Intento de transmisión rechazado porque el módulo no
está parametrizado

Parametrice el módulo.

16#81DF

El módulo ha inicializado la interfaz al FB por uno de
los motivos siguientes:

—

Se admiten (en función del módulo):
1-1024/2048/4096 (bytes)

● El módulo se ha rearrancado.
● El módulo se ha parametrizado nuevamente.
● STOP de la CPU
Códigos de error de la configuración de recepción
16#81E0

En el programa de usuario, llame la función de recep‐
Telegrama cancelado: desbordamiento del búfer de
recepción / telegrama de recepción demasiado grande ción con mayor frecuencia o parametrice una comu‐
nicación con control del flujo de datos.

16#81E1

Telegrama cancelado: error de paridad

7036

Compruebe la línea de conexión de los interlocutores
y asegúrese de que en ambos interlocutres esté ajus‐
tada la misma velocidad de transmisión, la misma pa‐
ridad y el mismo número de bits de parada.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#81E2

Telegrama cancelado: error de trama

Compruebe los ajustes de bit de inicio, bits de datos,
bit de paridad, velocidad de transferencia de datos y
bit(s) de parada.

16#81E3

Telegrama cancelado: error de desbordamiento de ca‐ Error de firmware: póngase en contacto con el Cus‐
racteres
tomer Support.

16#81E4

Telegrama cancelado: la longitud de "Offset del men‐ Compruebe los ajustes de offset en el mensaje, ta‐
saje + tamaño del campo de longitud + número de ca‐ maño del campo de longitud y número de caracteres
racteres excluidos" es mayor que el búfer de recepción excluidos.

16#81E5

Telegrama cancelado: break

La línea de recepción hacia el interlocutor está inte‐
rrumpida.
Restablezca la conexión o conecte el interlocutor.

16#81E6

Número máximo de "Tramas de recepción en búfer"
excedido

En el programa de usuario llame la instrucción con
más frecuencia o parametrice una comunicación con
control del flujo de datos, o bien aumente el número
de telegramas en búfer.

16#81E7

Error de sincronización entre módulo y Receive_P2P

Asegúrese de que no haya diferentes instancias de
Receive_P2P accediendo al mismo módulo.

16#81E8

Telegrama cancelado: tiempo de retardo de caracte‐
res transcurrido antes de detectar el criterio de fin del
mensaje

El interlocutor es demasiado lento o falla. Si fuese
necesario, utilice un dispositivo de comprobación de
interfaces que se conecte a la línea de transferencia.

16#81E9

Error de Modbus CRC (solo módulos de comunicacio‐ Error de suma de verificación del telegrama Modbus.
nes compatibles con Modbus)
Compruebe el interlocutor.

16#81EA

Telegrama Modbus demasiado corto (solo módulos de
comunicaciones compatibles con Modbus)

Rebase por defecto de la longitud mínima de la trama
Modbus. Compruebe el interlocutor.

16#81EB

Telegrama cancelado: longitud máxima de telegrama
alcanzada

Seleccione una longitud de telegrama menor en el
interlocutor.
Se admiten (en función del módulo):
1-1024/2048/4096 (bytes)
Compruebe los parámetros de detección de fin del
telegrama.

Códigos de error de las señales cualificadoras V24
16#81F0

El módulo no soporta señales cualificadoras V24

Ha intentado ajustar señales cualificadoras para un
módulo que no soporta señales cualificadoras V24.
Asegúrese de estar utilizando un módulo RS232 y de
que esté ajustado el modo RS232 (ET 200SP).

16#81F1

No es posible manejar las señales cualificadoras V24

Si el control del flujo de datos de hardware está activo
no es posible controlar manualmente las señales cua‐
lificadoras V24.

16#81F2

No se puede activar la señal DSR porque el módulo es
del tipo DTE.

Compruebe el tipo parametrizado del módulo.

No se puede ajustar la señal DSR porque el módulo es
del tipo DCE.

Compruebe el tipo parametrizado del módulo.

16#81F3

16#81F4

Error en el encabezado del bloque (p. ej. tipo o longitud
del bloque incorrecto)

El tipo de módulo debe ser del tipo DCE (data com‐
munication equipment).
El tipo de módulo debe ser del tipo DTE (data terminal
equipment).
Compruebe el DB de instancia y el encabezado del
bloque.

Códigos de error de la configuración de recepción

Programación del PLC
Manual de programación y manejo, 11/2019

7037

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

16#8201 1)

Receive_Conditions señala a un tipo de datos no per‐ Introduzca un puntero hacia uno de los siguientes ti‐
mitido
pos de datos:
DB, BOOL, BYTE, CHAR, WORD, INT, DWORD,
DINT, REAL, DATE, TIME_OF_DAY, TIME, S5TIME,
DATE_AND_TIME, STRING

16#8225

Receive_Conditions señala al área de memoria opti‐
mizada mayor que 1 kbyte

Introduzca un puntero hacia un área con la longitud
máxima siguiente:

o bien

● Área de memoria optimizada: 1 KB

Receive_Conditions señala al área de memoria opti‐
mizada y la longitud de recepción es mayor que la del
área direccionada por Receive_Conditions.

● Área de memoria no optimizada: 4 KB

16#8229 1)

Receive_Conditions señala a BOOL con un número de
bits diferente de n * 8

Solución

Nota: Si el puntero señala a un área de memoria op‐
timizada, no envíe más de 1 KB.
Si utiliza un puntero hacia BOOL, el número de bits
debe ser un múltiplo de 8.

Códigos de error generales
16#8280

Acuse negativo al leer el módulo

Encontrará información más detallada sobre la causa
del error en los parámetros estáticos RDREC.STA‐
TUS, así como en la descripción del SFB RDREC.
● Compruebe la entrada en el parámetro PORT
● Ajuste el parámetro COM_RST antes de la 1.ª
llamada.

16#8281

Acuse negativo al escribir en el módulo

Compruebe la entrada en el parámetro PORT
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos WRREC.STA‐
TUS, así como en la descripción del SFB WRREC.

16#8282

Módulo no disponible

Compruebe la entrada en el parámetro PORT y ase‐
gúrese de que el módulo está accesible.

Códigos de error de la configuración de recepción
16#82C1

Valor no admisible para "Tramas de recepción en bú‐
fer".

Seleccione un valor adecuado para "Tramas de re‐
cepción en búfer".
Rango admisible: 1-255

16#82C2

Receive Configuration rechazado porque está selec‐
cionado el protocolo 3964(R)

Asegúrese de que no se envía ninguna configuración
de recepción si está ajustado el protocolo 3964(R).

16#8301 1)

Receive_Conditions señala a un tipo de datos no per‐ Seleccione un tipo de datos compatible.
mitido
Se admiten: DB, BOOL, BYTE, CHAR, WORD, INT,
DWORD, DINT, REAL, DATE, TIME_OF_DAY, TI‐
ME, S5TIME, DATE_AND_TIME, STRING

16#8322

Error de longitud de área al leer un parámetro

Compruebe la entrada en el parámetro Receive_Con‐
ditions

16#8324

Error de área al leer un parámetro

Compruebe la entrada en el parámetro Receive_Con‐
ditions

16#8328

Error de ajuste al leer un parámetro

Compruebe la entrada en el parámetro Receive_Con‐
ditions

Estado de SEND y códigos de error
16#8328 1)

BUFFER señala a BOOL con un número de bits dife‐
rente de n * 8

Si utiliza un puntero hacia BOOL, el número de bits
debe ser un múltiplo de 8.

Códigos de error de la configuración de recepción

7038

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#8332

Bloque de datos no admisible en el parámetro Recei‐
ve_Conditions

Compruebe la entrada en el parámetro Receive_Con‐
ditions

16#833A

El nombre del bloque de datos del parámetro Recei‐
Compruebe la entrada en el parámetro Receive_Con‐
ve_Conditions señala un bloque de datos no cargado. ditions

16#8351

Tipo de datos no admisible

Compruebe la entrada en el parámetro Receive_Con‐
ditions

16#8352 1)

Receive_Conditions no señala un bloque de datos

Compruebe el puntero hacia Receive_Conditions

16#8353

Receive_Conditions no señala a una estructura del ti‐
po Receive_Conditions

Compruebe el puntero hacia Receive_Conditions

1)

Códigos de error del protocolo 3964(R)
16#8380

Error de parametrización: valor no admisible para
"Tiempo de retardo de caracteres".

Seleccione un valor adecuado para "Tiempo de retar‐
do de caracteres" (CharacterDelayTime).
Rango admisible: 1-65535 (ms)

16#8381

Error de parametrización: Valor no admisible para
"Tiempo de respuesta excedido".

16#8382

Error de parametrización: valor no admisible para
"Prioridad".

Seleccione un valor adecuado para "Tiempo de res‐
puesta excedido" (AcknDelayTime).
Rango admisible: 1-65535 (ms)
Seleccione un valor adecuado para "Prioridad" (Prio‐
rity).
Se admiten:
● Alta (1)
● Baja (0)

16#8383

Error de parametrización: valor no admisible para
"Comprobación de bloque"

Seleccione un valor adecuado para "Comprobación
de bloque" (BCC).
Se admiten:
● con comprobación de bloque (1)
● sin comprobación de bloque (0)

16#8384

Error de parametrización: valor no admisible para "In‐
tentos de establecer conexión".

Seleccione un valor adecuado para "Intentos de es‐
tablecer conexión" (BuildupAttempts).
Rango admisible: 1-255

16#8385

Error de parametrización: valor no admisible para "In‐
tentos de transmisión".

Seleccione un valor adecuado para "Intentos de trans‐
misión" (RepetitionAttempts).
Rango admisible: 1-255

16#8386

Error en tiempo de ejecución: se ha excedido el núme‐ Compruebe el cable de la interfaz y los parámetros de
ro de intentos de establecer conexión
transferencia.
Compruebe también que la función de recepción esté
correctamente parametrizada en el interlocutor.

16#8387

Error en tiempo de ejecución: se ha excedido el núme‐ Compruebe el cable de la interfaz, los parámetros de
ro de intentos de transmisión
transferencia y la parametrización del interlocutor.

16#8388

Error en tiempo de ejecución: error en el "Carácter de
comprobación de bloque"

Compruebe que la conexión no tenga fuertes interfe‐
rencias. De ser así, observará de vez en cuando có‐
El valor del carácter de control de bloque determinado digos de error. Si fuese necesario, verifique el com‐
internamente no concuerda con el recibido por el inter‐ portamiento correcto del dispositivo interlocutor con
un dispositivo de test de interfaz conectado a la línea
locutor al final de la conexión.
de transferencia.

Programación del PLC
Manual de programación y manejo, 11/2019

7039

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#8389

Error en tiempo de ejecución: se ha recibido un carác‐ Cuando el búfer de recepción está vacío, se responde
ter no admisible mientras se esperaba un búfer de re‐ a la orden de transmisión del interlocutor (STX, 02H)
con DLE. Antes no se debe recibir ningún otro carác‐
cepción libre
ter (excepto STX de nuevo).
Si fuese necesario, verifique el comportamiento co‐
rrecto del dispositivo interlocutor con un dispositivo
de test de interfaz conectado a la línea de transferen‐
cia.

16#838A

16#838B

Tras la recepción de DLE se ha recibido otro carácter
cualquiera (salvo DLE, ETX).

Compruebe que el interlocutor no haya incluido el
DLE por duplicado en el encabezado del telegrama o
en la cadena de datos, y que la conexión se establez‐
ca con DLE ETX. Si fuese necesario, verifique el
comportamiento correcto del dispositivo interlocutor
con un dispositivo de test de interfaz conectado a la
línea de transferencia.

Error en tiempo de ejecución: tiempo de retardo de
caracteres excedido

El dispositivo interlocutor es demasiado lento o está
defectuoso.

Error en tiempo de ejecución: error lógico durante la
recepción.

Si fuese necesario, verifíquelo con un dispositivo de
test de interfaz conectado a la línea de transferencia.
16#838C

Error en tiempo de ejecución: se ha iniciado el tiempo
de espera a un búfer de recepción libre

En el programa de usuario llame la instrucción con
más frecuencia o parametrice una comunicación con
control del flujo de datos.

16#838D

Error en tiempo de ejecución: después de NAK, el te‐
legrama no se repite hasta transcurridos 4 s

Compruebe el interlocutor. Si un telegrama se recibe
con errores, el interlocutor debe repetirlo en un inter‐
valo de 4 segundos.

16#838E

Error en tiempo de ejecución: se han recibido uno o
más caracteres durante el estado de reposo (excepto
NAK y STX).

Verifique el comportamiento correcto del dispositivo
interlocutor si fuese necesario con un dispositivo de
test de interfaz conectado a la línea de transferencia.

16#838F

Error en tiempo de ejecución: conflicto de inicializa‐
ción; ambos interlocutores tienen ajustada una priori‐
dad alta

Ajuste una prioridad "baja" en uno de los interlocuto‐
res

16#8391

Error de parametrización: se han rechazado los datos
de parametrización 3964 porque está ajustado Free‐
port

Asegúrese de que no se envía ningún dato de para‐
metrización 3964 si está ajustado el protocolo Free‐
port.

Códigos de error generales
16#8FFF
1)

El módulo no está operativo temporalmente debido a
un reset.

Repita la consulta.

Solo en instrucciones para CPU S7-300/400

Consulte también
Modbus_Master: comunicarse como maestro Modbus (Página 7067)

7040

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

USS
Resumen de la comunicación USS
Comunicación USS
Las instrucciones USS controlan el funcionamiento de accionamientos que soportan el
protocolo de la interfaz serie universal (USS). Los módulos de comunicación PtP hacen posible
la comunicación con varios accionamientos a través de conexiones RS485 e instrucciones
USS. Cada puerto RS485 puede operar un máximo de 16 accionamientos.
El protocolo USS utiliza una red de maestros y esclavos para la comunicación a través de un
bus serie. El maestro utiliza un parámetro de dirección para enviar datos a un esclavo concreto.
Un esclavo no puede enviar nunca por sí mismo sin haber recibido previamente una solicitud.
La comunicación entre los diferentes esclavos no es posible. La comunicación USS funciona
en modo semidúplex. La figura siguiente muestra un diagrama de red para un ejemplo de
aplicación con 16 accionamientos.
1

2

&38

&0

3

               

①
②
③

CPU
CM

Accionamientos USS en una red USS
Figura 4-56
Ejemplo de interconexión con un módulo de comunicación S7-1500

Nota
Comunicación con un accionamiento mediante RS232
En principio, también es posible utilizar CM PtP RS232 BA y CM PtP RS232 HF para la
comunicación con un accionamiento. Sin embargo, solo es posible conectar un accionamiento
a un puerto RS232.
Comunicación con un accionamiento mediante RS422
En principio, también es posible utilizar la interfaz RS422 del CM PtP RS422/485 BA y CM PtP
RS422/485 HF para la comunicación con un accionamiento. Sin embargo, solo es posible
conectar un accionamiento a un puerto RS422.

Programación del PLC
Manual de programación y manejo, 11/2019

7041

Instrucciones
4.2 Instrucciones

Instrucciones USS en el programa
● USS_Port_Scan: la instrucción USS_Port_Scan permite la comunicación a través de un
módulo de comunicaciones con hasta 16 accionamientos, mediante una red USS (debe ser
llamada de forma cíclica).
En el programa solo hay una instrucción USS_Port_Scan por puerto de comunicación PtP
que controla la transferencia a todos los accionamientos.
● USS_Drive_Control: la instrucción USS_Drive_Control permite preparar los datos de
USS_Port_Scan para un accionamiento y mostrar los datos recibidos.
USS_Drive_Control configura los datos que deben enviarse y evalúa los datos recibidos por
USS_Port_Scan en una solicitud anterior.
● USS_Read_Param: la instrucción USS_Read_Param permite leer parámetros de un
accionamiento.
● USS_Write_Param: la instrucción USS_Write_Param permite modificar los parámetros de
un accionamiento.

Requisitos para utilizar el protocolo USS
Las cuatro instrucciones USS utilizan 2 FB y 2 FC para soportar el protocolo USS. Para cada
red USS se emplea un bloque de datos de instancia para USS_Port_Scan y un bloque de datos
de instancia común para todas las llamadas de USS_Drive_Conrol.
'%GHLQVWDQFLD
866B3RUWB6FDQ
'%GHLQVWDQFLD
866B'ULYHB&RQWURO
$FFWR

6HQGB33

0µGXORGH
FRPXQLFDFLRQHV
PDHVWUR

5HFHLYHB33
B&RQILJ

866B'ULYHB&RQWURO
$FFWR

866B'ULYHB&RQWURO
$FFWR

866
$FFWR
866
$FFWR
866
$FFWR

866B5HDGB3DUDP
866B:ULWHB3DUDP

Figura 4-57

Ejecución del programa - USS

Todos los accionamientos (máx. 16) que están conectados a un puerto RS485 forman parte de
la misma red USS. Todos los accionamientos que están conectados a otro puerto RS485
forman parte de otra red USS. Cada red USS se gestiona por medio de un bloque de datos de
instancia único para todas las instrucciones USS_Drive_Control y otro bloque de datos de
instancia para la instrucción USS_Port_Scan. Todas las instrucciones que forman parte de una
red USS deben utilizar conjuntamente el bloque de datos de instancia para USS_Drive_Conrol.
Para ello, las instrucciones USS_Port_Scan, USS_Read_Param y USS_Write_Param cuentan

7042

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
con el parámetro USS_DB, que debe interconectarse con el parámetro (estático) USS_DB del
DB de instancia de la instrucción USS_Drive_Control.
● Las instrucciones USS_Drive_Control y USS_Port_Scan son bloques de función (FB). Si se
inserta la instrucción USS_Drive_Control o USS_Port_Scan en el editor de programación,
deberá asignarse un DB a este FB en el cuadro de diálogo "Opciones de llamada". Si se
trata de la primera instrucción USS_Drive_Control del programa para esta red USS, existe
la posibilidad de aplicar la asignación estándar de DB (o cambiar el nombre en caso
necesario) y el nuevo DB se creará automáticamente. Sin embargo, si no se trata de la
primera instrucción USS_Drive_Control para este accionamiento, es necesario seleccionar
en la lista desplegable del cuadro de diálogo "Opciones de llamada" el DB que se ha
asignado previamente a esta red USS.
● Las instrucciones USS_Write_Param y USS_Read_Param son funciones (FC). Si se
insertan estas FC en el editor, no se asignará ningún DB. Si se insertan estas FC o la
instrucción USS_Port_Scan en el editor, deberá asignarse a la entrada USS_DB de estas
instrucciones el parámetro USS_DB del DB de instancia correspondiente de
USS_Drive_Control. Haga doble clic en el campo de parámetros y pulse seguidamente el
icono para visualizar los DB disponibles. Introduzca un punto "." y seleccione el parámetro
USS_DB en la lista desplegable.
● La función USS_Port_Scan controla la comunicación entre la CPU y los accionamientos a
través del puerto de comunicación punto a punto RS485. Cada vez que se llama esta
función se procesa una comunicación con un accionamiento. El programa debe llamar esta
función con la suficiente rapidez como para que los accionamientos no notifiquen un rebase
de tiempo. Para garantizar un comportamiento temporal constante de la transmisión de
tramas, esta instrucción debe llamarse con un OB de alarma cíclica.
● La instrucción USS_Drive_Control proporciona al programa acceso a un accionamiento
concreto de la red USS. Sus entradas y salidas corresponden a los estados y las funciones
de control del accionamiento. Si hay 16 accionamientos en la red, USS_Drive_Control debe
llamarse 16 veces en el programa, es decir, una vez por accionamiento.
La instrucción USS_Drive_Control solo debería llamarse desde un OB cíclico.
● Con las funciones USS_Read_Param y USS_Write_Param se leen y escriben los
parámetros operativos del accionamiento. Dichos parámetros controlan el funcionamiento
interno del accionamiento. Encontrará una definición de estos parámetros en el manual del
accionamiento. El programa puede contener un número cualquiera de estas funciones,
aunque únicamente puede estar activa una orden de lectura o escritura para un
accionamiento. Las funciones USS_Read_Param y USS_Write_Param solo deben
llamarse desde el OB de ciclo de un programa principal.

Programación del PLC
Manual de programación y manejo, 11/2019

7043

Instrucciones
4.2 Instrucciones

ATENCIÓN
Llamadas de las instrucciones USS
Llame USS_Drive_Control, USS_Read_Param y USS_Write_Param únicamente desde un
OB de ciclo del programa principal. La instrucción USS_Port_Scan puede llamarse desde
cualquier OB, aunque normalmente se llama desde un OB de alarma cíclica.
No utilice las instrucciones USS_Drive_Control, USS_Read_Param y USS_Write_Param en
un OB con una prioridad más alta que la instrucción USS_Port_Scan correspondiente. No
inserte USS_Port_Scan en el programa principal ni USS_Read_Param en un OB de alarma
cíclica, por ejemplo. Si la ejecución de USS_Port_Scan es interrumpida por otra instrucción,
pueden producirse errores imprevistos.
Nota
Valor de identificación del parámetro
Para los accionamientos es preciso configurar el uso de 4 palabras PKW.

Calcular el tiempo para la comunicación con el accionamiento
La comunicación con el accionamiento se lleva a cabo de forma asíncrona al ciclo de la CPU.
La CPU suele ejecutar varios ciclos antes de que finalice la comunicación con un
accionamiento.
Para que la vigilancia de tiempo parametrizada durante el accionamiento no responda, las
tramas de transmisión deben enviarse al accionamiento dentro de esta vigilancia de tiempo.
También debe incluirse el número de intentos si se requieren varios para completar la
transacción debido a errores de comunicación. De forma predeterminada, para el protocolo
USS se realizan hasta 2 intentos en cada transacción.
El intervalo máximo entre dos tramas de transmisión se calcula del siguiente modo:
N * (5 * tiempo de ciclo + tiempo de ejecución de tramas + timeout de la trama de recepción
máx.) * (número de intentos de transmisión)
N
Factor 5
Tiempo de ciclo
Tiempo de ejecución
de tramas
Número de intentos
de transmisión
Timeout de la trama
de recepción
Timeout de la trama
de recepción máx.

7044

Número de accionamientos en esta red
Para la transmisión y recepción de tramas se requieren 5 ciclos típi‐
camente.
Tiempo de ciclo máx. de los OB de alarma cíclica en los que se llama
la instrucción USS_Port_Scan.
Tiempo de ejecución de tramas = (número de caracteres por trama) *
(11 Bit por carácter) / (velocidad de transferencia en Bit/s)
Número de intentos + 1
RCVTIME (si no se recibe respuesta del accionamiento)
RCVTIME + MSGTIME (si poco antes de transcurrir RCVTIME se
recibe una respuesta incompleta y la vigilancia de MSGTIME finali‐
za o bien si al transcurrir RCVTIME aún hay una respuesta en proce‐
so, se prolonga el Timeout con el tiempo de MSGTIME)

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para el "Timeout de la trama de recepción" se aplican los siguientes tiempos (ms):
Bits/s

115200

57600

38400

19200

9600

4800

2400

1200

Receive_Condi‐
tions.END.RCVTIME

25

29

33

56

72

100

100

100

Receive_Condi‐
tions.END.MSGTIME

25

29

33

56

72

124

240

460

Timeout de la trama de recepción máx. = (Receive_Conditions.END.RCVTIME (0,072 s) +
Receive_Conditions.END.MSGTIME (0,072 s))
Ejemplo:
5 accionamientos
Velocidad de transferencia de datos = 9600 bits/s
28 caracteres por trama
Tiempo de ciclo = 0,020 s
Número de intentos = 2
Intervalo = 5 * ((5*0,02) + ((1*28*11)/9600) + 0,072 + 0,072) * (2+1) = 4,14 (segundos)
La vigilancia de tiempo del accionamiento debe ajustarse a aprox. 4 segundos en este caso.

Consulte también
Mensajes de error (Página 7060)

USS_Port_Scan / USS_Port_Scan_31: comunicación vía red USS
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.
Nota
Uso de la instrucción USS_Port_Scan_31
La instrucción USS_Port_Scan_31 solo puede usarse en una CPU S7-1500.

Descripción
La instrucción USS_Port_Scan procesa la comunicación a través de una red USS para un
máximo de 16 accionamientos.
La instrucción USS_Port_Scan_31 procesa la comunicación a través de una red USS para un
máximo de 31 accionamientos.
STEP 7 crea automáticamente un DB de instancia cuando se inserta la instrucción.

Programación del PLC
Manual de programación y manejo, 11/2019

7045

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

PORT

Declaración

IN

Tipo de datos
S7-1200/1
500

S7-300/4
00/
WinAC

Port

Word

Estándar

Descripción

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la
ficha "Constantes de sistema" de la tabla de variables
PLC y puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

BAUD

IN

DInt

9600

Velocidad de transferencia de datos para la comunicación
USS
Se admiten:
● 1200 bits/s
● 2400 bits/s
● 4800 bits/s
● 9600 bits/s
● 19200 bits/s
● 38400 bits/s
● 57600 bits/s
● 115200 bits/s

USS_DB

INOUT

COM_RST INOUT

USS_BASE

---

Bool

–

El parámetro USS_DB debe interconectarse con el pará‐
metro (estático) USS_DB del DB de instancia, que se crea
e inicializa cuando se inserta una instrucción USS_Dri‐
ve_Control / USS_Drive_Control_31 en el programa.

FALSE

Inicialización de la instrucción USS_Port_Scan /
USS_Port_Scan_31
Con TRUE se inicializa la instrucción. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.
Nota:
El parámetro solo está disponible para instrucciones
S7-300/400.

ERROR

OUT

Bool

FALSE

Si es TRUE, la salida indica que se ha producido un error y
la salida STATUS es válida.
Si es necesario, compruebe además el valor de la variable
estática USS_DB. w_USSExtendedError en el DB de ins‐
tancia de la instrucción USS_Drive_Control / USS_Dri‐
ve_Control_31.

STATUS

7046

OUT

Word

0

Código de error (consulte Mensajes de error (Pági‐
na 7060)).

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Solo hay una instrucción USS_Port_Scan / USS_Port_Scan_31 por puerto de comunicación
PtP en el programa y cada llamada de dicha instrucción controla una transferencia hacia o
desde todos los accionamientos de esta red. Todas las funciones USS que están asignadas a
una red USS y a un puerto de comunicación PtP deben utilizar el mismo DB de instancia.
El programa debe ejecutar la instrucción USS_Port_Scan / USS_Port_Scan_31 tantas veces
como sea necesario para que no se produzca ningún timeout en el accionamiento (consulte
Requisitos para utilizar el protocolo USS (Página 7042) el apartado "Calcular el tiempo para la
comunicación con el accionamiento").
La instrucción USS_Port_Scan / USS_Port_Scan_31 se llama normalmente desde un OB de
alarma cíclica para impedir timeouts del accionamiento y tener disponibles las últimas
actualizaciones de datos USS para llamadas de USS_Drive_Control / USS_Drive_Control_31 .

Variables de bloques de datos de USS_Port_Scan / USS_Port_Scan_31
La tabla siguiente muestra las variables estáticas públicas del DB de instancia de
USS_Port_Scan / USS_Port_Scan_31 que pueden utilizarse en el programa.
Tabla 4-381 Variables estáticas en el DB de instancia
Variable

Tipo de da‐ Estándar
tos

Descripción

MODE

USInt

Modo de operación

4

Los modos de operación admitidos son:
● 0 = dúplex (RS232)
● 1 = dúplex (RS422) modo a cuatro hilos (punto a punto)
● 2 = dúplex (RS422) modo a cuatro hilos (maestro multipunto, CM PtP
(ET 200SP))
● 3 = dúplex (RS422) modo a cuatro hilos (esclavo multipunto, CM PtP
(ET 200SP))
● 4 = semidúplex (RS485) modo a dos hilos 1)
LINE_PRE

USInt

2

Estado inicial de la línea de recepción
Los estados iniciales admitidos son:
● 0 = "sin" asignación inicial 1)
● 1 = señal R(A) = 5 V, señal R(B) = 0 V (detección Break):
en este estado inicial es posible una detección de rotura (Break).
Solo disponible con: "Dúplex (RS422) modo a cuatro hilos (acoplamiento
punto a punto)" y "Dúplex (RS422) modo a cuatro hilos (esclavo multipunto)".
● 2 = señal R(A) = 0 V, señal R(B) = 5 V:
este estado inicial corresponde al estado de reposo (ninguna transmisión
activa). Con este estado inicial no es posible la detección de rotura (Break).

BRK_DET

USInt

0

Activar aviso de diagnóstico:
● 0 - no activado
● 1 - activado

RETRIES_MAX

SInt/Byte

2

Número de intentos cuando se producen errores de comunicación.
Este parámetro permite establecer el número de intentos de envío de una trama
de petición en el caso de que la trama de respuesta no se reciba dentro del
tiempo ajustado.

Programación del PLC
Manual de programación y manejo, 11/2019

7047

Instrucciones
4.2 Instrucciones
Variable

Tipo de da‐ Estándar
tos

Descripción

EN_DIAG_ALAR
M

Bool

Activar aviso de diagnóstico:

EN_SUPPLY_V
OLT

Bool

0

● 0 - no activado
● 1 - activado
0

Activar diagnóstico para Falta tensión de alimentación L+
● 0 - no activado
● 1 - activado

1)

Ajuste necesario si se utilizan cables PROFIBUS en CM 1241 para RS485

Aunque la versión 2.5 tiene exactamente tiene la misma funcionalidad que la versión 2.4, se ha
incrementado el número por motivos internos.

Versiones de la instrucción
USS_Port_Scan:
Aunque la versión 2.5 tiene exactamente tiene la misma funcionalidad que la versión 2.4, se ha
incrementado el número por motivos internos.
USS_Port_Scan_31:
Aunque la versión 1.2 tiene exactamente tiene la misma funcionalidad que la versión 1.1, se ha
incrementado el número por motivos internos.

USS_Drive_Control / USS_Drive_Control_31: Preparar y mostrar datos para el accionamiento
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.
Nota
Uso de la instrucción USS_Drive_Control_31
La instrucción USS_Drive_Control_31 solo puede usarse en una CPU S7-1500.

Descripción
La instrucción USS_Drive_Control prepara datos de transmisión para un máximo de 16
accionamientos y evalúa los datos de respuesta de estos.
La instrucción USS_Drive_Control_31 prepara datos de transmisión para un máximo de 31
accionamientos y evalúa los datos de respuesta de estos.
Para cada accionamiento debe utilizarse una instancia propia de la instrucción, y todas las
funciones USS que están asignadas a una red USS y a un puerto de comunicación PtP deben
utilizar el mismo bloque de datos de instancia. Debe introducirse el nombre del DB al insertar

7048

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
la primera instrucción USS_Drive_Control / USS_Drive_Control_31. Seguidamente, hay que
remitir al DB que se ha creado al insertar la primera instrucción.
STEP 7 crea automáticamente el DB cuando se inserta la instrucción.

Parámetros
Parámetro

Declaración

Tipo de datos

Estándar

Descripción

S7S7-300/4
1200/1500
00/
WinAC
RUN

IN

Bool

FALSE

Bit de arranque del accionamiento: si este parámetro es
TRUE, la entrada hace posible el funcionamiento del accio‐
namiento con el número de revoluciones predeterminado.
Si RUN pasa a FALSE mientras el accionamiento está en
marcha, el motor se desacelera hasta pararse. Este com‐
portamiento difiere de la desconexión de la alimentación
(OFF2) y del frenado del motor (OFF3).

OFF2

IN

Bool

FALSE

Bit "Decelerar hasta parar": si este parámetro es FALSE,
este bit provoca la parada natural del accionamiento sin
frenar.

OFF3

IN

Bool

FALSE

Bit de parada rápida: si este parámetro es FALSE, este bit
provoca una parada rápida frenando el accionamiento.

F_ACK

IN

Bool

FALSE

Bit de acuse de error: con este bit se desactiva el bit de error
de un accionamiento. El bit se activa tras borrar el error, con
lo que el accionamiento detecta que el error anterior no de‐
be seguir notificándose.

DIR

IN

Bool

FALSE

Control de sentido del accionamiento: este bit se activa
cuando el accionamiento debe funcionar hacia delante
(cuando SPEED_SP es positivo, ver tabla "Interacción de
los parámetros SPEED_SP y DIR").

DRIVE

IN

USInt

Byte

1

Dirección del accionamiento: esta entrada es la dirección
del accionamiento USS. El rango válido está entre acciona‐
miento 1 y accionamiento 16.

PZD_LEN

IN

USInt

Byte

2

Longitud de palabra: es el número de palabras de datos
PZD. Los valores válidos son 2, 4, 6 u 8 palabras.

SPEED_S
P

IN

Real

0.0

Consigna de velocidad: es el número de revoluciones del
accionamiento proporcionalmente a la frecuencia configu‐
rada. Un valor positivo significa que el accionamiento fun‐
ciona hacia delante (si DIR es true). El rango válido es de
200,00 a -200,00.

CTRL3

IN

Word

0

Palabra de control 3: valor que se escribe en un parámetro
personalizable del accionamiento. Debe configurarse en el
accionamiento (parámetro opcional).

CTRL4

IN

Word

0

Palabra de control 4: valor que se escribe en un parámetro
personalizable del accionamiento. Debe configurarse en el
accionamiento (parámetro opcional).

CTRL5

IN

Word

0

Palabra de control 5: valor que se escribe en un parámetro
personalizable del accionamiento. Debe configurarse en el
accionamiento (parámetro opcional).

Programación del PLC
Manual de programación y manejo, 11/2019

7049

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Estándar

Descripción

S7S7-300/4
1200/1500
00/
WinAC
CTRL6

IN

Word

0

Palabra de control 6: valor que se escribe en un parámetro
personalizable del accionamiento. Debe configurarse en el
accionamiento (parámetro opcional).

CTRL7

IN

Word

0

Palabra de control 7: valor que se escribe en un parámetro
personalizable del accionamiento. Debe configurarse en el
accionamiento (parámetro opcional).

CTRL8

IN

Word

0

Palabra de control 8: valor que se escribe en un parámetro
personalizable del accionamiento. Debe configurarse en el
accionamiento (parámetro opcional).

FALSE

Inicialización de la instrucción USS_Drive_Control /
USS_Drive_Control_31

COM_RST IN/OUT

---

Bool

Con TRUE se inicializa la instrucción. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.
Nota:
El parámetro solo está disponible para instrucciones
S7-300/400.
NDR

OUT

Bool

FALSE

Datos nuevos preparados: si este parámetro es TRUE, el bit
notifica que en la salida hay preparados datos de una nueva
petición de comunicación.

ERROR

OUT

Bool

FALSE

Se ha producido un error: Si es TRUE, indica que se ha
producido un error y la salida STATUS es válida. Todas las
salidas restantes se ponen a cero en caso de error. Los
errores de comunicación solo se notifican en las salidas
ERROR y STATUS de la instrucción USS_Port_Scan /
USS_Port_Scan_31.

STATUS

OUT

Word

0

Código de error (consulte Mensajes de error (Página 7060)).

RUN_EN

OUT

Bool

FALSE

Servicio habilitado: este bit notifica si el accionamiento está
en marcha.

D_DIR

OUT

Bool

FALSE

Sentido del accionamiento: este bit notifica si el acciona‐
miento funciona hacia delante.
● FALSE – adelante
● TRUE – atrás

INHIBIT

OUT

Bool

FALSE

Accionamiento bloqueado: este bit notifica el estado del bit
de bloqueo para el accionamiento.
● FALSE – no bloqueado
● TRUE – bloqueado

FAULT

OUT

Bool

FALSE

Error en accionamiento: este bit notifica que en el acciona‐
miento se ha producido un error. Hay que eliminar el fallo y
activar el bit F_ACK para borrar este bit.

SPEED

OUT

Real

0.0

Valor real de velocidad del accionamiento (valor escalado
de STATUS 2 del accionamiento): es la velocidad del ac‐
cionamiento proporcionalmente a la velocidad configurada.

STATUS1

OUT

Word

0

STATUS 1 del accionamiento
Este valor contiene bits de estado fijos de un accionamiento.

7050

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Estándar

Descripción

0

STATUS 3 del accionamiento

S7S7-300/4
1200/1500
00/
WinAC
STATUS3

OUT

Word

Este valor contiene una palabra de estado personalizable
del accionamiento.
STATUS4

OUT

Word

0

STATUS 4 del accionamiento
Este valor contiene una palabra de estado personalizable
del accionamiento.

STATUS5

OUT

Word

0

STATUS 5 del accionamiento
Este valor contiene una palabra de estado personalizable
del accionamiento.

STATUS6

OUT

Word

0

STATUS 6 del accionamiento
Este valor contiene una palabra de estado personalizable
del accionamiento.

STATUS7

OUT

Word

0

STATUS 7 del accionamiento
Este valor contiene una palabra de estado personalizable
del accionamiento.

STATUS8

OUT

Word

0

STATUS 8 del accionamiento
Este valor contiene una palabra de estado personalizable
del accionamiento.

Cuando USS_Drive_Control / USS_Drive_Control_31 se ejecuta por primera vez, el
accionamiento indicado por la dirección USS (parámetro DRIVE) se inicializa en el DB de
instancia. Al término de la inicialización, las instrucciones USS_Port_Scan /
USS_Port_Scan_31 posteriores pueden iniciar la comunicación con el accionamiento con este
número.
Si se cambia el número de accionamiento, la CPU debe ponerse primero a STOP y después
a RUN de nuevo para que se inicialice el DB de instancia. Los parámetros de entrada se
configuran en el búfer de transmisión USS y las salidas, si existen, se leen de un búfer de
respuesta "anterior" válido. USS_Drive_Control / USS_Drive_Control_31 configura solo los
datos que deben enviarse y evalúa los datos recibidos en una petición anterior.
El sentido de giro del accionamiento se controla desde la entrada D_IR (Bool) o mediante el
signo (positivo o negativo) de la entrada SPEED_SP (Real). La tabla siguiente explica cómo
funcionan estas entradas conjuntamente para especificar el sentido de giro del accionamiento,
suponiendo que el motor gira hacia delante.
Tabla 4-382 Interacción de los parámetros SPEED_SP y DIR
SPEED_SP

DIR

Sentido de giro del accionamiento

Valor > 0

0

Atrás

Valor > 0

1

Adelante

Valor < 0

0

Adelante

Valor < 0

1

Atrás

Programación del PLC
Manual de programación y manejo, 11/2019

7051

Instrucciones
4.2 Instrucciones

Variables de bloques de datos de USS_Drive_Control / USS_Drive_Control_31
La tabla siguiente muestra las variables estáticas públicas del DB de instancia de
USS_Drive_Control/ USS_Drive_Control_31 que pueden utilizarse en el programa.
Tabla 4-383 Variables estáticas en el DB de instancia
Variable

Tipo de da‐ Estándar
tos

Descripción

USS_DB. w_US‐
SExtendedError

Word

USS Drive Extended Error Code: valor específico del accionamiento

16#0

El significado del mensaje de error depende de qué instrucción ha
notificado antes un error (ERROR = TRUE). Se distinguen los siguientes casos:
● USS_Write_Param / USS_Write_Param_31: : el significado del código de
error figura en la descripción del accionamiento.
● USS_Read_Param / USS_Read_Param_31: : el significado del código de
error figura en la descripción del accionamiento.
● USS_Port_Scan / USS_Port_Scan_31: : número del accionamiento
afectado por el mensaje de error.

Versiones de la instrucción
USS_Drive_Control:
Aunque la versión 2.0 tiene exactamente tiene la misma funcionalidad que la versión 1.2, se ha
incrementado el número por motivos internos.
USS_Drive_Control_31:
Aunque la versión 2.0 tiene exactamente tiene la misma funcionalidad que la versión 1.0, se ha
incrementado el número por motivos internos.

USS_Read_Param / USS_Read_Param_31: leer datos del accionamiento
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.
Nota
Uso de la instrucción USS_Read_Param_31
La instrucción USS_Read_Param_31 solo puede usarse en una CPU S7-1500.

Descripción
La instrucción USS_Read_Param lee un parámetro de un accionamiento de como máximo 16.
La instrucción USS_Read_Param_31 lee un parámetro de un accionamiento de como máximo
31.

7052

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Todas las funciones USS que están asignadas a una red USS y a un puerto de comunicación
PtP deben utilizar el bloque de datos de instancia de la instrucción USS_Drive_Control /
USS_Drive_Control_31 . USS_Read_Param / USS_Read_Param_31 debe llamarse desde un
OB de ciclo del programa principal.

Parámetros
Parámetro

Declaración

Tipo de datos
S71200/1500

Estándar

Descripción

–

Con un flanco ascendente en REQ se genera una nueva
orden de lectura.

–

Dirección del accionamiento: DRIVE es la dirección del ac‐
cionamiento USS. El rango válido está entre accionamiento
1 y accionamiento 16.

S7300/400/
WinAC

REQ

IN

Bool

DRIVE

IN

PARAM

IN

UInt

–

Número de parámetro: PARAM indica el parámetro de ac‐
cionamiento que se escribe. El rango de este parámetro
está entre 0 y 2047. En algunos accionamientos se puede
acceder a valores de parámetro superiores a 2047 por me‐
dio del byte más significativo del parámetro INDEX. Encon‐
trará más información sobre el acceso a un rango ampliado
en el manual del accionamiento.

INDEX

IN

UInt

–

Índice de parámetro: INDEX indica el índice de parámetro
del accionamiento en el que debe escribirse. Es un valor de
16 bits en el que el byte menos significativo es el valor real
del índice, con un rango de (0 a 255). El byte más signifi‐
cativo también puede ser utilizado por el accionamiento y
es específico del mismo. Encontrará más información en el
manual del accionamiento.

USS_DB

INOUT

USS_BASE

–

El parámetro USS_DB debe interconectarse con el pará‐
metro (estático) USS_DB del DB de instancia, que se crea
e inicializa cuando se inserta una instrucción USS_Dri‐
ve_Control / USS_Drive_Control_31 en el programa.

DONE1

OUT

Bool

FALSE

Si este parámetro es TRUE, en la salida VALUE está pen‐
diente el valor previamente solicitado para el parámetro de
lectura. Este bit se activa cuando la instrucción USS_Dri‐
ve_Control / USS_Drive_Control_31 detecta la respuesta
de lectura del accionamiento. Este bit se inicializará con la
siguiente llamada de USS_Read_Param / USS_Read_Pa‐
ram_31 .

ERROR

OUT

Bool

FALSE

ERROR = TRUE: se ha producido un error y la salida STA‐
TUS es válida. Todas las salidas restantes se ponen a cero
en caso de error. Los errores de comunicación solo se no‐
tifican en las salidas ERROR y STATUS de la instrucción
USS_Port_Scan / USS_Port_Scan_31.

USInt

Byte

Si es necesario, compruebe además el valor de la variable
estática USS_DB. w_USSExtendedError en el DB de ins‐
tancia de la instrucción USS_Drive_Control / USS_Dri‐
ve_Control_31.

Programación del PLC
Manual de programación y manejo, 11/2019

7053

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos
S71200/1500

1

STATUS

OUT

VALUE

OUT

Estándar

Descripción

0

Código de error (consulte Mensajes de error (Pági‐
na 7060)).

–

Es el valor del parámetro que se ha leído y solo es válido si
el bit DONE es true.

S7300/400/
WinAC

UInt
Variant

Any

(Word, Int,
UInt,
DWord,
DInt,
UDInt,
Real)

(Word,
Int,
DWord,
DInt,
Real)

El bit DONE indica que se han leído datos válidos del accionamiento de motor referenciado y se han suministrado a la CPU.
No hace referencia al hecho de que la instrucción está preparada para leer inmediatamente otro parámetro. Una orden de
lectura vacía debe enviarse al accionamiento del motor y también debe ser acusada por la instrucción antes de que se
habilite el canal de parámetros para que sea utilizado por el accionamiento correspondiente. La llamada inmediata de
USS_Read_Param / USS_Read_Param_31 o USS_Write_Param / USS_Write_Param_31 para el accionamiento de motor
específico provoca el error 16#818A.

Versiones de la instrucción
USS_Read_Param:
Aunque la versión 1.5 tiene exactamente tiene la misma funcionalidad que la versión 1.4, se ha
incrementado el número por motivos internos.
USS_Read_Param_31:
Aunque la versión 1.1 tiene exactamente tiene la misma funcionalidad que la versión 1.0, se ha
incrementado el número por motivos internos.

USS_Write_Param / USS_Write_Param_31: modificar datos del accionamiento
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.
Nota
Uso de la instrucción USS_Write_Param_31
La instrucción USS_Write_Param_31 solo puede usarse en una CPU S7-1500.
Nota
Para instrucciones de escritura EEPROM (EEPROM en un accionamiento USS) se aplica lo
siguiente:
Mantenga en un número reducido las operaciones de escritura EEPROM para garantizar una
larga vida útil del EEPROM.

7054

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Descripción
La instrucción USS_Write_Param modifica un parámetro de un accionamiento de como
máximo 16.
La instrucción USS_Write_Param_31 modifica un parámetro de un accionamiento de como
máximo 31.
Todas las funciones USS que están asignadas a una red USS y a un puerto de comunicación
PtP deben utilizar el bloque de datos de instancia del USS_Drive_Control /
USS_Drive_Control_31.
USS_Write_Param / USS_Write_Param_31 debe llamarse desde el OB de ciclo de un
programa principal.

Parámetros
Tabla 4-384 Tipos de datos de los parámetros
Parámetro

Declaración

Tipo de datos

Estándar

Descripción

–

Con un flanco ascendente en REQ se genera una nueva
orden de escritura.

–

Dirección del accionamiento: DRIVE es la dirección del ac‐
cionamiento USS. El rango válido está entre accionamien‐
to 1 y accionamiento 16.

S7S7-300/40
1200/1500
0/
WinAC
REQ

IN

Bool

DRIVE

IN

PARAM

IN

UInt

–

Número de parámetro: PARAM indica el parámetro de ac‐
cionamiento que se escribe. El rango de este parámetro
está entre 0 y 2047. En algunos accionamientos se puede
acceder a valores de parámetro superiores a 2047 por me‐
dio del byte más significativo del parámetro INDEX. En‐
contrará más información sobre el acceso a un rango am‐
pliado en el manual del accionamiento.

INDEX

IN

UInt

–

Índice de parámetro: INDEX indica el índice de parámetro
del accionamiento en el que debe escribirse. Es un valor de
16 bits en el que el byte menos significativo es el valor real
del índice, con un rango de (0 a 255). El byte más signifi‐
cativo también puede ser utilizado por el accionamiento y
es específico del mismo. Encontrará más información en el
manual del accionamiento.

EEPROM

IN

Bool

–

Guardar en el EEPROM del accionamiento: si es TRUE, la
transacción de un parámetro para escribir en el acciona‐
miento se guarda en el EEPROM del accionamiento. Si es
FALSE, el valor escrito solo se guarda temporalmente y se
perderá la próxima vez que se conecte el accionamiento.

VALUE

IN

–

Valor del parámetro en el que debe escribirse. Debe ser
válido con un flanco ascendente de REQ.

USInt

Byte

Variant

Any

(Word, Int,
UInt,
DWord,
DInt,
UDInt,
Real)

(Word,
Int,
DWord,
DInt, Real)

Programación del PLC
Manual de programación y manejo, 11/2019

7055

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Estándar

Descripción

–

El parámetro USS_DB debe interconectarse con el pará‐
metro (estático) USS_DB del DB de instancia, que se crea
e inicializa cuando se inserta una instrucción USS_Dri‐
ve_Control / USS_Drive_Control_31 en el programa.

S7S7-300/40
1200/1500
0/
WinAC
USS_DB

INOUT

USS_BASE

DONE1

OUT

Bool

FALSE

Si es TRUE, la entrada VALUE se ha escrito en el accio‐
namiento. Este bit se activa cuando la instrucción USS_Dri‐
ve_Control / USS_Drive_Control_31 detecta la respuesta
de escritura del accionamiento. Este bit se inicializará con
la siguiente llamada de USS_Write_Param / USS_Wri‐
te_Param_31.

ERROR

OUT

Bool

FALSE

Si es TRUE, se ha producido un error y la salida STATUS
es válida. Todas las salidas restantes se ponen a cero en
caso de error. Los errores de comunicación solo se notifi‐
can en las salidas ERROR y STATUS de la instrucción
USS_Port_Scan / USS_Port_Scan_31 .
Si es necesario, compruebe además el valor de la variable
estática USS_DB. w_USSExtendedError en el DB de ins‐
tancia de la instrucción USS_Drive_Control / USS_Dri‐
ve_Control_31.

STATUS
1

OUT

UInt

0

Código de error (consulte Mensajes de error (Pági‐
na 7060)).

El bit DONE indica que se han leído datos válidos del accionamiento de motor referenciado y se han suministrado a la CPU.
No hace referencia al hecho de que la librería USS está preparada para leer inmediatamente otro parámetro. Una orden de
escritura vacía debe enviarse al accionamiento del motor y también debe ser acusada por la instrucción antes de que se
habilite el canal de parámetros para que sea utilizado por el accionamiento correspondiente. La llamada inmediata de
USS_Read_Param / USS_Read_Param_31 o USS_Write_Param / USS_Write_Param_31 FC para el accionamiento de
motor específico provoca el error 0x818A.

Versiones de la instrucción
USS_Write_Param:
Aunque la versión 1.6 tiene exactamente tiene la misma funcionalidad que la versión 1.5, se ha
incrementado el número por motivos internos.
USS_Write_Param_31:
Aunque la versión 1.1 tiene exactamente tiene la misma funcionalidad que la versión 1.0, se ha
incrementado el número por motivos internos.

7056

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Información general sobre el dispositivo de accionamiento
Requisitos para la configuración del accionamiento
● Para los accionamientos debe configurar el uso de 4 palabras PKW
(Parameterkennungswert o valor de identificación de parámetro).
● Configure los accionamientos para 2, 4, 6 u 8 palabras PZD (Prozessdatenbereich o rango
de datos de proceso).
● Procure que el número de palabras PZD en el accionamiento se corresponda con la
entrada PZD_LEN de la instrucción USS_Drive_Control del accionamiento.
● Procure que la velocidad de transferencia de todos los accionamientos se corresponda con
la entrada BAUD de la instrucción USS_Port_Scan.
● Procure que el accionamiento esté configurado para la comunicación USS.
● Asegúrese de que se haya determinado en el accionamiento que la consigna de frecuencia
se proporcione a través de la interfaz USS.
● Asegúrese de que la dirección del accionamiento esté definida (rangos: 1-16).
Esta dirección debe corresponderse con la entrada DRIVE en el bloque USS_Drive_Control
del accionamiento.
● Asegúrese de que la red RS485 esté correctamente cerrada.

Conexión y configuración del accionamiento SINAMICS V20
Un ejemplo de aplicación para el funcionamiento de un SINAMICS V20 en una S7-1200 se
puede consultar en Internet. (http://support.automation.siemens.com/WW/view/es/63696870)

Conexión del accionamiento SINAMICS V20
Ejemplo de conexión de un accionamiento SIEMENS G120(C) a una red USS. Encontrará
ejemplos de conexión para otros accionamientos en el manual del correspondiente
accionamiento.
La conexión de un accionamiento SINAMICS G120(C) a la red USS se realiza a través de un
conector. La conexión es resistente a cortocircuitos y está aislada galvánicamente.

1

0 V potencial de referencia

2

RS485N, recepción y transmisión (-)

3

RS485N, recepción y transmisión (+)

4

Pantalla del cable

5
No utilizado
Figura 4-58
Conexión USS

Programación del PLC
Manual de programación y manejo, 11/2019

7057

Instrucciones
4.2 Instrucciones

ATENCIÓN
Diferentes tensiones de referencia
Si se conectan entre sí dispositivos que no tienen la misma tensión de referencia, pueden
producirse intensidades no deseadas en el cable de conexión. Estas intensidades no
deseadas pueden provocar errores de comunicación o daños materiales en los dispositivos.
Asegúrese de que todos los dispositivos que estén conectados entre sí a través de un cable
de comunicación tengan el mismo conductor de referencia en el circuito o bien estén
separados eléctricamente para que no se produzcan intensidades no deseadas.
Asegúrese de que la pantalla esté conectada a masa o al pin 1 del conector de bus del
accionamiento.
Asegúrese de que el borne de cableado 2 (GND) del G120(C) esté conectado a masa.
En caso de que el maestro RS485 (p. ej., una CPU S7-1200 con módulo de comunicaciones
CM1241) esté conectado a través de un conector PROFIBUS, los cables de bus deben
tenderse como sigue:

A1
B1

Figura 4-59

A2
B2

Conexión del módulo de comunicaciones

Si el maestro RS485 es un dispositivo terminador de red o si se tiene una conexión punto a
punto, deben utilizarse los bornes A1 y B1 (no A2 y B2) del conector PROFIBUS, porque dichos
bornes permiten los ajustes de terminación (p. ej. en el conector DP 6ES7972‑0BB52‑0XA0).
En caso de que el G120(C) esté configurado como dispositivo terminador de red, debe ajustar
el interruptor para la resistencia terminadora de bus en "ON".
&RQHFWRU56SDUDOD
FRPXQLFDFLµQDWUDY«VGH
VLVWHPDVGHEXVGHFDPSR
,QWHUUXSWRUSDUD
UHVLVWHQFLDWHUPLQDGRUD

Figura 4-60

7058

Conexión del dispositivo terminador

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Configuración de un accionamiento G120(C)
Antes de conectar un accionamiento al S7-1500 o al ET 200SP, hay que asegurarse de que se
dispone de los siguientes parámetros de sistema.
Paso
1

Instrucción

Instrucciones de servicio
G120 1)

G120C 2)

Cap. 4.4.3

Cap. 6.4.1

Cap. 6.2.2.1

Cap. 8.4.2.1

En los pasos siguientes, con el BOP-2 se accede directamente a parámetros
seleccionando sus números y modificando sus valores.

Cap. 4.4.2

Cap. 6.4.2

Adapte los siguientes parámetros de convertidor de su aplicación relativos a la
comunicación:

Cap. 6.2.2.2

Cap. 8.4.2.1

Efectúe una puesta en marcha básica del accionamiento con el panel de ope‐
rador BOP-2.
El convertidor ofrece diferentes asignaciones predefinidas (macros) para sus
entradas y salidas y la interfaz del bus de campo. Elija en el 9.º paso de la puesta
en marcha básica (MAC PAR p15) la macro 21 para la comunicación USS. Con
ello estarán también predefinidos los siguientes parámetros:
● Velocidad de transferencia (p2020): 38400 bits/s
● Número de PZD (p2022): 2
● Número de PKW (p2023): variable
Nota:
La puesta en marcha básica también se puede ejecutar con el software de
puesta en marcha STARTER o con SINAMICS Startdrive.

2

Defina la dirección de USS del convertidor a través del interruptor de dirección
de la Control Unit del G120 o del G120(C).
● Área de direcciones válida: 1 … 30
Nota:
La dirección USS también se puede ajustar a través del parámetro p2021 o a
través de STARTER o de SINAMICS Startdrive.

3

● Velocidad de transferencia (p2020), siempre que sea ≠ 38400 bits/s
(Preste atención a la concordancia con el parámetro BAUD de la instrucción
de comunicación USS_Port_Scan.)
● Número de PZD (p2022), siempre que sea ≠ 2
(Preste atención a la concordancia con el parámetro PZD_LEN de la
instrucción de comunicación USS_Drive_Control.)
● Número de PKW (p2023) = 4
(Modifique a "4" el valor ajustado por defecto a través de la macro 21 a
"variable" (127) (las instrucciones USS_Read_Param y USS_Write_Param lo
requieren.)
● Bus de campo SS Tiempo de vigilancia [ms] (p2040)
4

Defina el origen para la consigna de velocidad.
● Selec n_cons (p1000[0]) = 6
(La consigna de velocidad se proporciona a través del bus USS.)

Programación del PLC
Manual de programación y manejo, 11/2019

7059

Instrucciones
4.2 Instrucciones
Paso

Instrucción

Instrucciones de servicio
G120 1)

5

G120C 2)

Ajuste la magnitud de referencia para la velocidad y la frecuencia.
● n_ref f_ref (p2000) = (6.00 min-1 hasta 210000.00 min-1)
(Todas las velocidades o frecuencias indicadas como relativas se refieren a esta
magnitud de referencia. La magnitud de referencia corresponde al 100% o a
4000hex (Palabra) o 4000 0000hex (Palabra doble). En ese caso:
fmagnitud ref (en Hz) = nmagnitud ref (en ((min-1) / 60) x número de pares de polos))

6

Transfiera los parámetros a la memoria no volátil.
● Guardar par (p0971) = 1

1) G120 (http://support.automation.siemens.com/CN/view/es/62089662)
2) G120(C) (http://support.automation.siemens.com/WW/view/es/61462568)

Mensajes de error
Sinopsis de los mensajes de error USS
Código de
error

Descripción

Solución

16#0000

No hay error

‑

16#8180

Error de longitud en la respuesta del accionamiento

Compruebe el telegrama de respuesta del acciona‐
miento.

16#8181

Error del tipo de datos

Compruebe el parámetro VALUE.

Error de número de parámetro

Rango admisible del parámetro PARAM: de 0 a 2047

16#8182

Error del tipo de datos: no se permite devolver "palabra
doble" o "real" a la orden de "palabra".

Compruebe el telegrama de respuesta del acciona‐
miento.

16#8183

Error del tipo de datos: no se permite devolver "pala‐
bra" a la orden de "palabra doble" o "real".

Compruebe el telegrama de respuesta del acciona‐
miento.

16#8184

Error de suma de verificación en la respuesta del ac‐
cionamiento

Compruebe el accionamiento y la conexión de comu‐
nicación.

16#8185

Error de direccionamiento

Rango de direcciones admisible del accionamiento:
de 1 a 16

16#8186

Error de consigna

Rango de consignas admisible: de -200 % a +200 %

16#8187

Devolución de número de accionamiento erróneo

Compruebe el telegrama de respuesta del acciona‐
miento.

16#8188

Longitud de PZD no admisible

Longitudes de PZD admisibles: 2, 4, 6 u 8 palabras

16#8189

El módulo no soporta esta velocidad de transferencia
de datos.

Seleccione una velocidad de transferencia de datos
compatible con el módulo.

16#818A

Para este accionamiento está activa otra orden.

Repita la orden de lectura o de escritura de paráme‐
tros más tarde.

16#818B

El accionamiento no responde.

Compruebe el accionamiento.

7060

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#818C

El accionamiento responde a una consulta de paráme‐ Compruebe el telegrama de respuesta del acciona‐
tros con un mensaje de error.
miento.
Compruebe la consulta de parámetros.
Compruebe si las instrucciones USS_Read_Param,
USS_Write_Param o USS_Port_Scan han notificado
un error. En caso afirmativo, compruebe el valor de
las variables estáticas USS_DB. w_USSExtendedE‐
rror de la instrucción USS_Drive_Control.

16#818D

El accionamiento responde a una consulta de paráme‐ Compruebe el telegrama de respuesta del acciona‐
tros con un error de acceso.
miento.

16#818E

El accionamiento no se ha inicializado.

Compruebe el programa de usuario y asegúrese de
que se llama la instrucción USS_Drive_Control para
este accionamiento.

16#8280

Acuse negativo al leer el módulo

Compruebe la entrada en el parámetro PORT.

Compruebe la consulta de parámetros.

Encontrará información más detallada sobre la causa
del error en los parámetros estáticos Port_Con‐
fig.RDREC.STATUS, Send_Config.RDREC.STA‐
TUS , Receive_Config.RDREC.STATUS ,
Send_P2P.RDREC.STATUS o Recei‐
ve_P2P.RDREC.STATUS, así como en la descrip‐
ción del SFB RDREC.
16#8281

Acuse negativo al escribir en el módulo

Compruebe la entrada en el parámetro PORT.
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos Port_Con‐
fig.WRREC.STATUS, Send_Config.WRREC.STA‐
TUS , Receive_Config.WRREC.STATUS ,
Send_P2P.RDREC.STATUS o Recei‐
ve_P2P.RDREC.STATUS, así como en la descrip‐
ción del SFB WRREC.

Códigos de error generales
16#8FFF
1)

El módulo no está operativo temporalmente debido a
un reset.

Repita la consulta.

Solo en instrucciones para CPU S7-300/400

MODBUS (RTU)
Resumen de la comunicación Modbus RTU
Comunicación Modbus RTU
Modbus RTU (Remote Terminal Unit) es un protocolo estándar para la comunicación en la red
y utiliza la conexión RS232 o RS422/485 para la transferencia de datos serie entre dispositivos
Modbus de la red.
Modbus RTU utiliza una red de maestro/esclavos en la que toda la comunicación sale de un
solo dispositivo maestro, mientras que los esclavos simplemente reaccionan a la solicitud del

Programación del PLC
Manual de programación y manejo, 11/2019

7061

Instrucciones
4.2 Instrucciones
maestro. El maestro envía una solicitud a una dirección de esclavo y solo responde al comando
el esclavo con dicha dirección de esclavo.
Caso especial: la dirección de esclavo Modbus 0 envía una trama Broadcast (difusión) a todos
los esclavos (sin respuesta del esclavo).

Códigos de función Modbus
● Una CPU que se utiliza como maestro Modbus RTU puede leer y escribir datos y estados
E/S en un esclavo Modbus RTU conectado por medio de una conexión de comunicación.
● Una CPU que se utiliza como esclavo Modbus RTU permite a un maestro Modbus RTU
conectado por medio de una conexión de comunicación leer y escribir datos y estados E/S
en la propia CPU.
Tabla 4-385 Funciones para leer datos: leer datos de programa y E/S descentralizadas
Código de función Modbus

Funciones para lectura de datos del esclavo (servidor) - direccionamien‐
to estándar

01

Leer bits de salida: 1 hasta 2000/19921) bits por solicitud

02

Leer bits de entrada: 1 hasta 2000/19921) bits por solicitud

03

Leer registro de paradas: 1 hasta 125/1241) palabras por solicitud

04

Leer palabras de entrada: 1 hasta 125/1241) palabras por solicitud

1) Con direccionamiento avanzado

Tabla 4-386 Funciones para escribir datos: escribir E/S descentralizadas y modificar datos de programa
Código de función Modbus

Funciones para escritura de datos en el esclavo (servidor) - direcciona‐
miento estándar

05

Escribir un bit de salida: 1 bit por solicitud

06

Escribir un registro de paradas: 1 palabra por solicitud

15

Escribir uno o varios bits de salida: 1 a 1960 bits por solicitud

16

Escribir uno o varios registros de paradas: 1 a 122 palabras por solicitud

● Los códigos de función Modbus 08 y 11 ofrecen posibilidades de diagnóstico para la
comunicación con el dispositivo esclavo.
● La dirección de esclavo Modbus 0 envía una trama Broadcast (de difusión) a todos los
esclavos (sin respuesta del esclavo; para códigos de función 5, 6, 15, 16).
Tabla 4-387 Direcciones de estación en la red Modbus
Estación
Equipo RTU

7062

Dirección
Dirección de estación estándar

1 a 247 , así como 0 para Broadcast

Dirección de estación avanzada

1 a 65535, así como 0 para Broadcast

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Direcciones de memoria Modbus
El número de direcciones de memoria Modbus (direcciones de entrada/salida) realmente
disponibles se rige por la variante de CPU y la memoria de trabajo disponible.

Instrucciones Modbus RTU en el programa
● Modbus_Comm_Load: es necesario ejecutar Modbus_Comm_Load para establecer
parámetros PtP como velocidad de transferencia de datos, paridad y control del flujo de
datos. Una vez se ha configurado el módulo de comunicación para el protocolo Modbus
RTU, solo pueden utilizarlo la instrucción Modbus_Master o la instrucción Modbus_Slave.
● Modbus_Master: con la instrucción de maestro Modbus es posible utilizar la CPU como
dispositivo maestro Modbus RTU para la comunicación con uno o varios dispositivos
esclavos Modbus.
● Modbus_Slave: con la instrucción de esclavo Modbus es posible utilizar la CPU como
dispositivo esclavo Modbus RTU para la comunicación con un dispositivo maestro Modbus.

Modbus_Comm_Load: configurar un módulo de comunicaciones para Modbus
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Modbus_Comm_Load configura un módulo de comunicaciones para la
comunicación a través del protocolo Modbus RTU. Si se inserta la instrucción
Modbus_Comm_Load en el programa, se asigna automáticamente un bloque de datos de
instancia.
Los cambios de configuración de Modbus_Comm_Load no se guardan en la CPU sino en el
CM. Al restablecerse la tensión y al desenchufar/enchufar, el CM se parametriza con los datos
guardados en la configuración de dispositivos. En estos casos debe volverse a llamar la
instrucción Modbus_Comm_Load.

Programación del PLC
Manual de programación y manejo, 11/2019

7063

Instrucciones
4.2 Instrucciones

Parámetro
Parámetro

Declara‐
ción

REQ

IN

PORT

IN

Tipo de datos
S71200/150
0

S7300/400/
WinAC

Bool
Port

Estándar Descripción

Word

FALSE

Inicia la instrucción con un flanco ascendente en esta en‐
trada.

0

Especifica el módulo de comunicación a través del cual se
produce la comunicación:
● para S7-1500/S7-1200: "Identificador de hardware" de
la configuración del dispositivo.
El nombre simbólico del puerto está asignado en la ficha
"Constantes de sistema" de la tabla de variables PLC y
puede adoptarse de ahí.
● para S7-300/S7-400: "Dirección de entrada" de la
configuración del dispositivo.
En los sistemas S7-300/400/WinAC se asigna al
parámetro PORT la dirección de entrada otorgada en
HWCN.

BAUD

IN

UDInt

DInt

9600

Selección de la velocidad de transferencia de datos
Los valores admisibles son: 300, 600, 1200, 2400, 4800,
9600, 19200, 38400, 57600, 76800, 115200 bit/s.

PARITY

IN

UInt

Word

0

Selección de la paridad:
● 0 – ninguna
● 1 – impar
● 2 – par

FLOW_CTR
L

IN

UInt

Word

0

Selección del control del flujo:
● 0 – (estándar) no hay control del flujo
● 1 – control del flujo de hardware con RTS siempre ON
(no es válido para CM RS422/485)
● 2 – control del flujo de hardware con RTS con protocolo
de intercambio (no es válido para CM RS422/485)

RTS_ON_D
LY

IN

UInt

Word

0

Selección del retardo a la conexión RTS:
● 0 – no hay retardo de "RTS activo" hasta que se envía el
primer carácter de la trama.
● 1 a 65535 – retardo en milisegundos de "RTS activo"
hasta que se envía el primer carácter de la trama (no es
válido para CM RS422/485). Los retardos RTS deben
aplicarse independientemente de la selección
FLOW_CTRL.

7064

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declara‐
ción

RTS_OFF_D IN
LY

Tipo de datos
S71200/150
0
UInt

Estándar Descripción

S7300/400/
WinAC
Word

0

Selección del retardo a la desconexión RTS:
● 0 – no hay retardo tras la transferencia del último
carácter hasta "RTS inactivo"
● 1 a 65535 – retardo en milisegundos desde la
transferencia del último carácter hasta "RTS inactivo"
(no es válido para puertos RS422/485). Los retardos
RTS deben aplicarse independientemente de la
selección FLOW_CTRL.

RESP_TO

IN

UInt

Word

1000

Timeout de respuesta:
5 ms a 65535 ms - tiempo en milisegundos que Mod‐
bus_Master espera una respuesta del esclavo. Si el esclavo
no responde durante este período, Modbus_Master repite la
petición o la finaliza con un error una vez que se ha enviado
el número indicado de repeticiones (ver abajo, parámetro
RETRIES).

MB_DB

IN/OUT

MB_BASE

‑

Una referencia al bloque de datos de instancia de las ins‐
trucciones Modbus_Master o Modbus_Slave.
El parámetro MB_DB debe interconectarse con el paráme‐
tro MB_DB (estático y, por tanto, no visible en la instrucción)
de la instrucción Modbus_Master o Modbus_Slave .

COM_RST

IN/OUT

---

Bool

FALSE

Inicialización de la instrucción Modbus_Comm_Load
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.
Nota:
El parámetro solo está disponible para instrucciones
S7-300/400.

DONE

OUT

Bool

FALSE

El bit DONE es TRUE durante un ciclo después de que se
haya ejecutado correctamente la última orden.

ERROR

OUT

Bool

FALSE

El bit ERROR es TRUE durante un ciclo después de que la
última orden haya finalizado con errores. El código de error
del parámetro STATUS solo es válido en el ciclo en que
ERROR = TRUE.

STATUS

OUT

Word

16#7000

Código de error (consulte Mensajes de error (Página 7087))

Modbus_Comm_Load se ejecuta para configurar un puerto para el protocolo Modbus RTU.
Una vez se ha configurado un puerto para el protocolo Modbus RTU, solo pueden utilizarlo la
instrucción Modbus_Master o Modbus_Slave.
Para la configuración de cada puerto de comunicación utilizado para la comunicación Modbus
debe utilizarse una ejecución de Modbus_Comm_Load. Hay que asignar un DB de instancia
Modbus_Comm_Load unívoco a cada puerto utilizado. Posteriormente, solo debe volver a
ejecutarse Modbus_Comm_Load cuando deban modificarse parámetros de comunicación
como velocidad de transferencia de datos o paridad, así como tras restablecerse la red, en
caso necesario.
Si se inserta, p. ej., Modbus_Master o Modbus_Slave en el programa, se asigna
automáticamente un bloque de datos de instancia a la instrucción. Debe interconectar el

Programación del PLC
Manual de programación y manejo, 11/2019

7065

Instrucciones
4.2 Instrucciones
parámetro MB_DB de la instrucción Modbus_Comm_Load con el parámetro MB_DB de la
instrucción Modbus_Master o Modbus_Slave.

Variables de bloques de datos de Modbus_Comm_Load
La tabla siguiente muestra las variables estáticas públicas del DB de instancia de
Modbus_Comm_Load que pueden utilizarse en el programa.
Tabla 4-388 Variables estáticas en el DB de instancia
Variable

Tipo de datos
S71200/150
0

Están‐
dar

Descripción

S7300/400/
WinAC

ICHAR_GAP

Word

0

Tiempo de retardo de caracteres máximo entre caracteres. Este pará‐
metro se indica en milisegundos y sirve para aumentar el período pre‐
visto entre los caracteres recibidos. El número correspondiente de
tiempos de bit para este parámetro se suma al valor estándar Modbus
de 35 tiempos de bit (3,5 tiempos de carácter).

RETRIES

Word

2

Número de intentos repetidos que lleva a cabo el maestro antes de
devolver el código de error 0x80C8 para "sin respuesta".

EN_SUPPLY_V
OLT

Bool

0

Activar diagnóstico para Falta tensión de alimentación L+

0

Modo de operación

MODE

USInt

Byte

Los modos de operación admitidos son:
● 0 = dúplex (RS232)
● 1 = dúplex (RS422) modo a cuatro hilos (punto a punto)
● 2 = dúplex (RS422) modo a cuatro hilos (maestro multipunto, CM
PtP (ET 200SP))
● 3 = dúplex (RS422) modo a cuatro hilos (esclavo multipunto, CM
PtP (ET 200SP))
● 4 = semidúplex (RS485) modo a dos hilos 1)
LINE_PRE

USInt

Byte

0

Estado inicial de la línea de recepción
Los estados iniciales admitidos son:
● 0 = "sin" asignación inicial 1)
● 1 = señal R(A) = 5 V, señal R(B) = 0 V (detección Break):
en este estado inicial es posible una detección de rotura (Break).
Solo disponible con: "Dúplex (RS422) modo a cuatro hilos
(acoplamiento punto a punto)" y "Dúplex (RS422) modo a cuatro
hilos (esclavo multipunto)".
● 2 = señal R(A) = 0 V, señal R(B) = 5 V:
este estado inicial corresponde al estado de reposo (ninguna
transmisión activa). Con este estado inicial no es posible la
detección de rotura (Break).

7066

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Variable

BRK_DET

Tipo de datos
S71200/150
0

S7300/400/
WinAC

USInt

Byte

Están‐
dar

Descripción

0

Detección break
Se admiten:
● 0 = detección Break desactivada
● 1 = detección Break activada

EN_DIAG_ALAR
M

Bool

0

Activar aviso de diagnóstico:
● 0 - no activado
● 1 - activado

STOP_BITS

USINT

Byte

1

N.º de bits parada
● 1 = 1 bit de parada,
● 2 = 2 bits de parada,
● 0, 3 a 255 = reservado

1)

Ajuste necesario si se utilizan cables PROFIBUS en CM 1241 para RS485

Versiones de la instrucción
Aunque la versión 3.1 tiene exactamente tiene la misma funcionalidad que la versión 3.0, se ha
incrementado el número por motivos internos.

Modbus_Master: comunicarse como maestro Modbus
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

Descripción
La instrucción Modbus_Master se comunica en calidad de maestro Modbus a través de un
puerto configurado con la instrucción Modbus_Comm_Load. Si se inserta la instrucción
Modbus_Master en el programa, se asigna automáticamente un bloque de datos de instancia.
El parámetro MB_DB de la instrucción Modbus_Comm_Load debe interconectarse con el
parámetro MB_DB (estático) de la instrucción Modbus_Master .
Nota
Para un DB de instancia de la instrucción Modbus_Master no está permitido activar la
remanencia (Retain).

Programación del PLC
Manual de programación y manejo, 11/2019

7067

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declaración

Tipo de datos
S71200/1500

REQ

IN

MB_ADDR IN

Descripción

FALSE

FALSE = no hay orden
TRUE = orden de enviar datos al esclavo Modbus

‑

Dirección de estación Modbus RTU:

S7300/400/
WinAC

Bool
UInt

Estándar

Word

Área de direccionamiento estándar (1 a 247 y 0 para Broad‐
cast)
Área de direccionamiento ampliada (1 a 65535 y 0 para
Broadcast)
El valor 0 está reservado para el Broadcast (difusión) de
una trama a todos los esclavos Modbus. Para el Broadcast
(difusión) solo se soportan los códigos de función Modbus
05, 06, 15 y 16.
MODE

IN

USInt

Byte

0

Selección de modo: indica el tipo de orden (lectura, escri‐
tura o diagnóstico). Encontrará más información en la tabla
de las funciones Modbus más adelante.

DA‐
TA_ADDR

IN

UDInt

DWord

0

Dirección inicial en el esclavo: indica la dirección inicial de
los datos a los que debe accederse en el esclavo Modbus.
Encontrará las direcciones válidas en la tabla de las fun‐
ciones Modbus más adelante.

DA‐
TA_LEN

IN

UInt

Word

0

Longitud de datos: indica el número de bits o palabras a los
que debe acceder esta orden. Encontrará las longitudes
válidas en la tabla de las funciones Modbus más adelante.

---

Bool

FALSE

COM_RST IN/OUT

Inicialización de la instrucción Modbus_Master
Con TRUE se inicializa la instrucción. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.
Nota:
El parámetro solo está disponible para instrucciones
S7-300/400.

DA‐
TA_PTR

IN/OUT

Variant

Any

‑

Puntero de datos: apunta a la dirección de marca o DB de
los datos que deben escribirse o leerse.
A partir de la versión de la instrucción V3.0:
El parámetro puede apuntar también a un área de memoria
optimizada. En el área de memoria optimizada puede ha‐
ber un elemento single o un array con los siguientes tipos
de datos: Bool, Byte, Char, Word, Int, DWord, DInt, Real,
USInt, UInt, UDInt, SInt, WChar. Cualquier otro tipo de da‐
tos da lugar al mensaje de error 16#818C.

DONE

OUT

Bool

FALSE

El bit DONE es TRUE durante un ciclo después de que se
haya ejecutado correctamente la última orden.

BUSY

OUT

Bool

‑

● FALSE – no hay órdenes activas para Modbus_Master
● TRUE – se está procesando una orden para
Modbus_Master

7068

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos
S71200/1500

Estándar

Descripción

S7300/400/
WinAC

ERROR

OUT

Bool

FALSE

El bit ERROR es TRUE durante un ciclo después de que la
última orden haya finalizado con errores. El código de error
del parámetro STATUS solo es válido en el ciclo en que
ERROR = TRUE.

STATUS

OUT

Word

0

Código de error (consulte Mensajes de error (Página 7087))

Variables en el bloque de datos del maestro Modbus
La tabla siguiente muestra las variables estáticas públicas del DB de instancia de
Modbus_Master que pueden utilizarse en el programa.
Tabla 4-389 Variables estáticas en el DB de instancia
Variable

Tipo de
datos

Estándar

Descripción

Blocked_Proc_Timeout

Real

3.0

Tiempo (en segundos) que debe esperarse una instancia bloquea‐
da del maestro Modbus antes de que esta se elimine como ACTIVA.
Esto puede suceder, por ejemplo, cuando se ha emitido una orden
de maestro y, seguidamente, el programa deja de llamar la función
del maestro antes de que la orden haya finalizado por completo. El
valor de tiempo debe ser mayor que 0 y menor que 55 segundos, de
lo contrario se produce un error.
Ver también los apartados "Reglas para la comunicación del Mod‐
bus-Master" y "Llamada de la instrucción Modbus_Master con dife‐
rentes ajustes de parámetros".

Extended_Addressing

Bool

FALSE

Configura la dirección de estación del esclavo como byte único o
doble.
● FALSE = dirección de un byte; 0 a 247
● TRUE = dirección de dos bytes (corresponde al
direccionamiento avanzado);
0 a 65535

Programación del PLC
Manual de programación y manejo, 11/2019

7069

Instrucciones
4.2 Instrucciones
Variable

Tipo de
datos

Estándar

Descripción

Compatibility_Mode 1)

Bool

FALSE

Modo de compatibilidad con CP 341, CP 441-2 y ET 200S 1Sl con
driver para Modbus RTU y con ET 200S 1SI para Modbus.
El valor predeterminado es 0.
● FALSE = según especificación Modbus, no compatible
● TRUE = compatible

MB_DB

1)

MB_BA‐
SE

-

–

Con FC1 y FC2 se aplica lo siguiente: Los datos leídos en la
trama de recepción se escriben palabra por palabra en la
memoria direccionada de la CPU y se sustituyen byte por
byte.
Si el número de bits que deben transmitirse no es múltiplo de
16, los bits no relevantes de la última palabra se ponen a
cero.

–

Con FC15 se aplica lo siguiente: Las palabras que deben
transmitirse se leen una a una en la memoria direccionada y
se escriben byte por byte en la trama de transmisión.
Si el número de bits que deben transmitirse no es múltiplo de
8, los bits no relevantes del último byte se leen sin cambios
en la memoria direccionada y se insertan en la trama de
transmisión.

El parámetro MB_DB de la instrucción Modbus_Comm_Load debe
conectarse con el parámetro MB_DB de la instrucción Modbus_Mas‐
ter.

Los módulos de comunicación PtP se comportan según la especificación Modbus. Para que Modbus se comporte como en
los CP 341, CP 441‑2 y ET 200SP 1SI , utilice el parámetro "Compatibility_Mode".

El programa puede escribir valores en las variables Blocked_Proc_Timeout y
Extended_Addressing para controlar las operaciones del maestro Modbus.

Reglas para la comunicación del Modbus-Master
● Modbus_Comm_Load debe ejecutarse para configurar un puerto con el fin de que la
instrucción Modbus_Master pueda comunicarse con dicho puerto.
● Si debe utilizarse un puerto como Modbus Master, Modbus_Slave no debe utilizar este
puerto. Con este puerto pueden utilizarse una o varias instancias de Modbus_Master 1). Sin
embargo, todas las ejecuciones de Modbus_Master deben utilizar el mismo DB de instancia
para el puerto.
● Las instrucciones Modbus no utilizan eventos de alarma de la comunicación para controlar
el proceso de comunicación. El programa debe consultar la instrucción Modbus_Master si
hay órdenes terminadas (DONE, ERROR).
● Se recomienda llamar todas las ejecuciones de Modbus_Master para un puerto concreto
desde un OB de ciclo de programa. Las instrucciones de maestro Modbus solo pueden
ejecutarse en cada caso en un ciclo de programa o bien en un nivel de procesamiento
cíclico/controlado por tiempo. No deben procesarse en distintos niveles de procesamiento.
La interrupción de preferencia de una instrucción de maestro Modbus por otra instrucción
de maestro Modbus en un nivel de procesamiento con mayor prioridad provoca un
funcionamiento incorrecto. Las instrucciones de maestro Modbus no deben procesarse en
niveles de arranque, diagnóstico o errores de tiempo.

7070

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El concepto "instancia de maestro Modbus" significa en este caso una llamada de la
instrucción Modbus_Master con la misma interconexión que una instrucción
Modbus_Comm_Load y el mismo ajuste para los parámetros MB_ADDR, MODE,
DATA_ADDR y DATA_LEN .

1)

Ejemplo.
Modbus_Master se llama con MODE=0 y DATA_ADDR=10
Esta orden está activa hasta que finaliza con DONE=1 o ERROR=1 o hasta que ha
transcurrido la vigilancia de tiempo parametrizada en el parámetro Blocked_Proc_Timeout . Si
una vez finalizada la vigilancia de tiempo se inicia una nueva orden antes de que la orden
anterior haya finalizado, la orden anterior se cancelará sin mensaje de error.
En caso de que se produzca una segunda llamada de la instrucción con los mismos datos de
instancia pero con ajustes distintos en los parámetros MODE y DATA_ADDR mientras se esté
ejecutando la orden, esta segunda llamada finalizará con ERROR=1 y STATUS=8200.

Llamada de la instrucción Modbus_Master con diferentes ajustes de parámetros
Si en el programa deben disponerse varias llamadas de la instrucción Modbus_Master con
distintos ajustes para MB_ADDR, MODE, DATA_ADDR o DATA_LEN , debe asegurarse de
que no haya más de una llamada activa a la vez, ya que, de lo contrario, se emitirá el mensaje
de error 16#8200 (la interfaz está ocupada por una orden en curso).
Si el procesamiento de la llamada no puede completarse, se activará la vigilancia de tiempo a
través del parámetro Blocked_Proc_Timeout y se cancelará la orden en curso.

Parámetro REQ
FALSE = no hay orden; TRUE = orden de enviar datos al esclavo Modbus
Habilitación de la transferencia solicitada. Con ello, el contenido del búfer se transfiere a la
interfaz de comunicación punto a punto.

Por medio de los parámetros DATA_ADDR y MODE se selecciona el código de función Modbus.
DATA_ADDR (dirección inicial Modbus en el esclavo): indica la dirección inicial de los datos a
los que debe accederse en el esclavo Modbus.
La instrucción Modbus_Master utiliza una entrada MODE en lugar de una entrada de código de
función. La combinación entre MODE y DATA_ADDR especifica el código de función que se
utiliza en la trama Modbus propiamente dicha. La tabla siguiente muestra la asignación entre
el parámetro MODE, el código de función Modbus y el área de direcciones Modbus en
DATA_ADDR.
Tabla 4-390 Funciones Modbus
MODE

DATA_ADDR (dirección
Modbus)

0

DATA_LEN
(longitud de los datos)

Código de fun‐
ción Modbus

Bits por orden
1 a

9999

Programación del PLC
Manual de programación y manejo, 11/2019

1 a

Operación y datos
01 Leer bits de salida:

2000/1992

1

0 a

9998

7071

Instrucciones
4.2 Instrucciones
MODE

DATA_ADDR (dirección
Modbus)

0

DATA_LEN
(longitud de los datos)

Código de fun‐
ción Modbus

Bits por orden
10001 a

19999

0

1 a

02 Leer bits de entrada:
2000/1992

49999

1 a

125/124 1

400001 a

465535

1 a

125/124

1

Palabras por orden
39999

1

1 a

1 a

9999

125/124 1

49999

400001 a

465535

1
9999

1

0 a

1

49999

2 a

400001 a

465534

2 a

22

1968/1960 1

9999

22

1 a

9998

0 a

9998

0 a

65524

0 a

9998

16 Escribir varios registros de parada:
123/122

123/122

1

Bits por orden
1 a

9998

15 Escribir varios bits de salida:

Palabras por orden
40001 a

65534

06 Escribir un registro de paradas:

1

2 a

0 a
0 a

1

Bits por orden
1 a

9998

05 Escribir un bit de salida:

1 palabra por orden
40001 a

0 a
04 Leer palabras de entrada:

Bit por orden

1

9998

03 Leer registro de paradas:

40001 a

30001 a

0 a

1

Palabras por orden

0

Operación y datos

0 a

9998

0 a

65534

15 Escribir uno o varios bits de salida:
1968/1960 1

Palabras por orden

0 a

9998

16 Escribir uno o varios registros de pa‐
radas:

40001 a

49999

1 a

123

0 a

9998

400001 a

465535

1 a

122 1

0 a

65534

11 Los dos operandos DATA_ADDR y DATA_LEN de Mod‐
bus_Master se ignoran en esta función.

11 Leer palabra de estado y contador
de eventos de la comunicación del
esclavo. La palabra de estado indi‐
ca la ocupación (0 - no ocupado,
0xFFFF - ocupado). El contador de
eventos se incrementa cada vez
que se procesa correctamente una
trama.

80

08

1 palabra por orden

81

1 palabra por orden

-

7072

1

1

Comprobar el estado del esclavo
mediante el código de diagnóstico
de datos 0x0000 (test de bucle de
control - el esclavo devuelve un eco
de la orden)
-

08 Inicializar el contador de eventos del
esclavo mediante el código de diag‐
nóstico de datos 0x000A
-

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
MODE

DATA_ADDR (dirección
Modbus)

104 3

Código de fun‐
ción Modbus

Palabras por orden
0 a

3 a 10,
12 a
79,
82 a
103,
105 a
255

DATA_LEN
(longitud de los datos)

65535

-

1 a
-

125/124

Operación y datos
04 Leer palabras de entrada
0 a

1

65535

Reservado

1

En el direccionamiento avanzado (ver parámetro Extended_Adressing), la longitud de datos máxima es 1 byte o 1 palabra
menos, según sea el tipo de datos de la función.

2

MODE 2 permite escribir uno o varios bits de salida y uno o varios registros Holding utilizando las funciones Modbus 15 y 16.
MODE 1 utiliza las funciones Modbus 5 y 6 para escribir 1 bit de salida y 1 registro Holding y las funciones Modbus 15 y 16
para escribir varios bits de salida y varios registros Holding.

3

En el caso de S7-300/400/WinAC, no se soporta.

Parámetro DATA_PTR
El parámetro DATA_PTR indica la dirección DB o M en la que se escribe o de la que se lee. Si
se utiliza un bloque de datos, hay que crear un bloque de datos global que ponga a disposición
la memoria de datos para procesos de lectura y escritura en esclavos Modbus.
Nota
S7-1200/1500 - El bloque de datos direccionado mediante DATA_PTR debe permitir el
direccionamiento directo
El bloque de datos debe permitir el direccionamiento directo (absoluto) y simbólico.
Nota
Uso del código de función 5
Con el código de función 5 puede activarse o borrarse un bit individual.
Para activar un bit debe predefinirse el valor "16#FF00" en la primera palabra del área de
marcas o de DB direccionada mediante DATA_PTR.
● En S7-1200 también se puede predefinir el valor "16#0100" para activar un bit.
● Para desactivar un bit debe predefinirse el valor "16#0000" en la primera palabra del área
de marcas o de DB direccionada mediante DATA_PTR.
El resto de los valores se rechazan con ERROR = TRUE y STATUS = 16#8384.

Programación del PLC
Manual de programación y manejo, 11/2019

7073

Instrucciones
4.2 Instrucciones

Estructuras de bloques de datos para el parámetro DATA_PTR
● Estos tipos de datos son válidos para leer palabras del área de direcciones Modbus
(DATA_PTR) 30001 a 39999, 40001 a 49999 y 400001 a 465535, así como para escribir
palabras del área de direcciones Modbus (parámetro DATA_PTR) 40001 a 49999 y 400001
a 465535.
– Matriz estándar de los tipos de datos WORD, UINT o INT
– Estructura denominada del tipo WORD, UINT o INT en la que cada elemento tiene un
nombre unívoco y un tipo de datos de 16 bits.
– Estructura compleja denominada en la que cada elemento tiene un nombre unívoco y un
tipo de datos de 16 o 32 bits.
● Para leer y escribir bits para el área de direcciones Modbus (parámetro DATA_PTR) 00001
a 09999 y para leer bits de 10001 a 19999.
– Campo estándar de tipos de datos booleanos.
– Estructura booleana con nombres a partir de variables booleanas de nombre unívoco
● Si bien no es necesario que cada instrucción Modbus_Master tenga un área de memoria
propia y separada, es recomendable. Esto se debe a que la posibilidad de que se destruyan
datos es mayor cuando varias instrucciones Modbus_Master leen y escriben en la misma
área de memoria.
● No es necesario que las áreas de memoria de DATA_PTR estén en el mismo bloque de
datos global. Es posible crear un bloque de datos con varias áreas para procesos de lectura
Modbus, un bloque de datos para procesos de escritura Modbus o un bloque de datos para
cada estación esclava.

Versiones de la instrucción
Aunque la versión 3.0 tiene exactamente tiene la misma funcionalidad que la versión 2.4, se ha
incrementado el número por motivos internos.

Consulte también
Modbus_Slave: comunicarse como esclavo Modbus (Página 7074)

Modbus_Slave: comunicarse como esclavo Modbus
Nota
Uso con CM1241
El uso de esta instrucción con un CM 1241 solo es posible con una versión de firmware V2.1
o superior del módulo.

7074

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Descripción
La instrucción Modbus_Slave permite al programa comunicarse como esclavo Modbus a
través de un CM (RS422/485 o RS232). STEP 7 crea automáticamente un DB de instancia
cuando se inserta la instrucción. El parámetro MB_DB de la instrucción Modbus_Comm_Load
debe interconectarse con el parámetro MB_DB (estático) de la instrucción Modbus_Slave .
Nota
Para un DB de instancia de la instrucción Modbus_Slave no está permitido activar la
remanencia (Retain).

Parámetros
Parámetro

MB_ADDR

Declara‐
ción

IN

Tipo de datos
S71200/1500
UInt

Estándar

Descripción

‑

Dirección de estación del esclavo Modbus:
área de direccionamiento estándar (1 a 247)
área de direccionamiento ampliada (0 a 65535)

S7300/400/
WinAC
Word

Nota: 0 es la dirección Broadcast
COM_RST

IN/OUT

---

Bool

FALSE

Inicialización de la instrucción Modbus_Slave
La instrucción se inicializa con TRUE. Seguidamente, la
instrucción ajusta COM_RST de nuevo a FALSE.
Nota:
El parámetro solo está disponible para instrucciones
S7-300/400.

MB_HOLD_
REG

IN/OUT

Variant

Any

‑

Puntero hacia el DB de registro de paradas Modbus: el re‐
gistro de paradas Modbus puede ser el área de memoria de
las marcas o bien un bloque de datos.
A partir de la versión de la instrucción V4.0:
El parámetro debe apuntar a un área de memoria con una
longitud mínima de 16 bits. Las longitudes menores dan
lugar al mensaje de error 16#8187. Esto afecta a los ele‐
mentos single, arrays, STRUCT y UDT. P. ej., un Single
Bool o un array con una longitud inferior a 16 elementos
booleanos da lugar al mensaje de error.
Si la longitud no es un múltiplo de 16 bits, la instrucción
Modbus_Slave no puede leer ni escribir los bits restantes al
final del área de memoria.
El parámetro puede apuntar también a un área de memoria
optimizada. En el área de memoria optimizada puede haber
un elemento single o un array con los siguientes tipos de
datos: Bool, Byte, Char, Word, Int, DWord, DInt, Real,
USInt, UInt, UDInt, SInt, WChar. Cualquier otro tipo de da‐
tos da lugar al mensaje de error 16#818C.

Programación del PLC
Manual de programación y manejo, 11/2019

7075

Instrucciones
4.2 Instrucciones
Parámetro

NDR

Declara‐
ción

Tipo de datos
S71200/1500

OUT

Estándar

Descripción

FALSE

Datos nuevos preparados:

S7300/400/
WinAC

Bool

● FALSE – No hay datos nuevos
● TRUE – Indica que se han escrito datos nuevos del
maestro Modbus
El bit NDR es TRUE durante un ciclo después de que la
última petición haya finalizado sin errores.
DR

OUT

Bool

FALSE

Leer datos:
● FALSE – No se han leído datos
● TRUE – Indica que la instrucción del maestro Modbus
ha guardado datos recibidos en la zona de destino.
El bit DR es TRUE durante un ciclo después de que la últi‐
ma petición haya finalizado sin errores.

ERROR

OUT

Bool

FALSE

El bit ERROR es TRUE durante un ciclo después de que la
última orden haya finalizado con errores. Si la ejecución
finaliza con un error, el código de error del parámetro STA‐
TUS solo es válido en el ciclo en que ERROR = TRUE.

STATUS

OUT

Word

0

Código de error (consulte Mensajes de error (Página 7087))

Los códigos de función de la comunicación Modbus (1, 2, 4, 5 y 15) pueden leer y escribir bits
y palabras directamente en la memoria imagen de proceso de las entradas y en la memoria
imagen de proceso de las salidas de la CPU. En estos códigos de función debe definirse el
parámetro MB_HOLD_REG como un tipo de datos mayor que un byte. La tabla siguiente
muestra la asignación de ejemplo de las direcciones Modbus a la memoria imagen de proceso
de la CPU.
Tabla 4-391 Asignación de las direcciones Modbus a la memoria imagen de proceso
Funciones Modbus
Código

S7-1200

Función

Área de datos Área de direccio‐ Área de datos
nes

01

Leer bits

Salida

0 a

8191 Memoria imagen de proce‐
so de las salidas

Q0.0 a

Q1023.7

02

Leer bits

Entrada

0 a

8191 Memoria imagen de proce‐
so de las entradas

I0.0 a

I1023.7

04

Leer pala‐
bras

Entrada

0 a

511 Memoria imagen de proce‐
so de las entradas

IW0 a

IW1022

05

Escribir bit

Salida

0 a

8191 Memoria imagen de proce‐
so de las salidas

Q0.0 a

Q1023.7

15

Escribir bits

Salida

0 a

8191 Memoria imagen de proce‐
so de las salidas

Q0.0 a

Q1023.7

7076

Dirección de la CPU

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tabla 4-392 Asignación de las direcciones Modbus a la memoria imagen de proceso
Funciones Modbus

S7-1500/S7-300/S7-400

Código de fun‐
ción

Función

Área de datos Área de direccio‐
nes

01

Leer bits

Salida

0 a

9998 Memoria imagen de proceso
de las salidas

Q0.0 a

Q1249.6

02

Leer bits

Entrada

0 a

9998 Memoria imagen de proceso
de las entradas

I0.0 a

I1249.6

04

Leer pala‐ Entrada
bras

0 a

9998 Memoria imagen de proceso
de las entradas

IW0 a

IW19996

05

Escribir bit Salida

0 a

9998 Memoria imagen de proceso
de las salidas

Q0.0 a

Q1249.6

15

Escribir
bits

0 a

9998 Memoria imagen de proceso
de las salidas

Q0.0 a

Q1249.6

Salida

Área de datos

Dirección de la CPU

Nota
El área de direcciones disponible puede ser también más pequeña, en función de la
configuración de memoria de la CPU.
Los códigos de función de la comunicación Modbus (3, 6, 16) utilizan un registro de paradas
Modbus que puede ser un área de direcciones del área de memoria de las marcas o bien un
bloque de datos. El tipo del registro de paradas se indica en el parámetro MB_HOLD_REG de
la instrucción Modbus_Slave.
Nota
S7-1200/1500 - Tipo del bloque de datos MB_HOLD_REG
Un bloque de datos con registro de paradas Modbus debe permitir el direccionamiento directo
(absoluto) y simbólico.

Tabla 4-393 Funciones de diagnóstico
Funciones de diagnóstico Modbus de Modbus_Slave del S7-1200
Códigos de fun‐
ción

Función par‐ Descripción
cial

08

0000H

Emitir datos de consulta Echotest: la instrucción Modbus_Slave devuelve a un maestro
Modbus el eco de una palabra de datos recibida.

08

000AH

Borrar contador de eventos de comunicación: la instrucción Modbus_Slave borra el con‐
tador de eventos de comunicación utilizado para la función Modbus 11.

11

Consultar contador de eventos de comunicación: la instrucción Modbus_Slave utiliza un
contador interno de eventos de comunicación para registrar el número de peticiones
correctas de lectura y escritura Modbus que se envían al esclavo Modbus. El contador no
se incrementa con la función 8, función 11 y peticiones Broadcast. Tampoco se incre‐
menta en las peticiones que provocan errores de comunicación (p. ej., errores de paridad
o CRC).

Programación del PLC
Manual de programación y manejo, 11/2019

7077

Instrucciones
4.2 Instrucciones
La instrucción Modbus_Slave soporta peticiones de escritura Broadcast de maestros Modbus,
en tanto que las peticiones abarquen el acceso a direcciones válidas. Para códigos de función
que no se soporten en la función Broadcast, Modbus_Slave genera el código de error 16#8188.

Variables del esclavo Modbus en la versión de la instrucción V3.0
Esta tabla muestra las variables estáticas públicas del bloque de datos de instancia de
Modbus_Slave que pueden utilizarse en el programa.
Tabla 4-394 Variables del esclavo Modbus
Variable

Tipo de
datos

Estándar

Descripción

HR_Start_Offset

Word

0

Indica la dirección inicial del registro de paradas Modbus (estándar =
0)

QB_Start

Word

0

Dirección inicial del área de direcciones escribibles de las salidas (byte
0 a 65535).
Nota:
La variable no está disponible para S7-300, S7-400 y WinAC.

QB_Count

Word

0xFFFF

Número de bytes de salida escribibles por el maestro Modbus.
Nota:
La variable no está disponible para S7-300, S7-400 y WinAC.

Extended_Addressing

Bool

FALSE

Direccionamiento avanzado, configura el direccionamiento del escla‐
vo como byte individual o doble
(FALSE = dirección de byte único, TRUE = dirección de byte doble)

Request_Count

Word

0

Número de todas las peticiones recibidas por este esclavo

Slave_Message_Count

Word

0

Número de las peticiones recibidas para este esclavo específico

Bad_CRC_Count

Word

0

Número de peticiones recibidas que presentan un error CRC

Broadcast_Count

Word

0

Número de peticiones Broadcast recibidas

Exception_Count

Word

0

Errores específicos de Modbus, que se acusan en el maestro con una
excepción

Success_Count

Word

0

Número de las peticiones recibidas para este esclavo específico sin
errores de protocolo

MB_DB

MB_BA‐
SE

-

El parámetro MB_DB de la instrucción Modbus_Comm_Load debe
conectarse con el parámetro MB_DB de la instrucción Modbus_Mas‐
ter.

El programa puede escribir valores en las variables HR_Start_Offset y Extended_Addressing
y controlar las operaciones del esclavo Modbus. Las demás variables pueden leerse para
vigilar el estado de Modbus.

Reglas para la comunicación del esclavo Modbus
● Modbus_Comm_Load debe ejecutarse para configurar un puerto con el fin de que la
instrucción Modbus_Slave pueda comunicarse a través de dicho puerto.
● Si un puerto debe reaccionar como esclavo a un maestro Modbus, dicho puerto no debe
programarse con la instrucción Modbus_Master .
● Solo es posible utilizar una instancia de Modbus_Slave con un puerto concreto, de lo
contrario pueden producirse comportamientos imprevistos.

7078

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
● Las instrucciones Modbus no utilizan eventos de alarma de la comunicación para controlar
el proceso de comunicación. El programa debe controlar el proceso de comunicación
consultando la instrucción Modbus_Slave respecto de procesos de transmisión y recepción
terminados.
● La instrucción Modbus_Slave debe ejecutarse regularmente y con una frecuencia que
permita una respuesta temprana a peticiones entrantes de un maestro Modbus. Se
recomienda ejecutar Modbus_Slave en cada ciclo desde un OB de ciclo de programa.
Modbus_Slave puede ejecutarse desde un OB de alarma cíclica, aunque no es
recomendable, porque unos retardos de tiempo excesivos en el programa de interrupción
pueden bloquear temporalmente la ejecución de otros programas de interrupción.

Control de tiempo de la señal Modbus
Modbus_Slave debe ejecutarse regularmente para recibir todas las peticiones del maestro
Modbus y responder de un modo adecuado. La frecuencia de ejecución de Modbus_Slave se
rige por el valor de timeout para la respuesta especificado por el maestro Modbus. Esto se
representa en la figura siguiente.

$'5

)&

'DWD

7LPHRXW
GHUHVSXHVWD

&5&

(OHVFODYRHQY¯D

(OPDHVWURHQY¯D
,QWHUYDOR
&5& LQLFLDO WLHPSRVGH
FDUDFWHUHV

$'5

5HWDUGR
GH

$'5

)&

'DWD

,QWHUYDOR
&5& LQLFLDO

El período de timeout de la respuesta (RESP_TO) es el tiempo que espera un maestro Modbus
al principio de una respuesta de un esclavo Modbus. Dicho período no se define en el protocolo
Modbus, sino en un parámetro de la instrucción Modbus_Comm_Load. Puesto que tanto la
recepción como la transmisión de una trama requieren varias llamadas (tres como mínimo) de
la instrucción Modbus_Slave, debería ejecutarse Modbus_Slave un mínimo de doce veces
durante el período de timeout para la respuesta del maestro Modbus para que la recepción y
transmisión de datos por parte del esclavo Modbus se ejecute el doble de veces de las
especificadas por el período de timeout.

HR_Start_Offset
Las direcciones del registro de paradas Modbus empiezan en 40001 o 400001. Estas
direcciones equivalen a la dirección de inicio del registro de paradas en la memoria del sistema
de destino. De todas formas, es posible configurar la variable HR_Start_Offset para configurar
una dirección inicial distinta de 40001 o 400001 para el registro de paradas Modbus.
La dirección 0 en el telegrama de recepción corresponde a la dirección inicial del registro de
paradas en la memoria del sistema de destino. A través de la variable HR_Start_Offset se
puede configurar otra dirección inicial como 0 para el registro de paradas de Modbus.
Así, por ejemplo, existe la posibilidad de configurar un registro de paradas que empiece en
MW100 y una longitud de 100 palabras. Si HR_Start_Offset = 20, la dirección 20 del telegrama
de recepción corresponde a la dirección de inicio del registro de paradas en la memoria de

Programación del PLC
Manual de programación y manejo, 11/2019

7079

Instrucciones
4.2 Instrucciones
destino (MW100). Toda dirección del telegrama de recepción por debajo de 20 y por encima
de 119 provoca un error de direccionamiento.
Tabla 4-395 Ejemplo de direccionamiento del registro de paradas de Modbus si DATA_PTR señala a MW100 con una
longitud de 100 palabras
HR_Start_Offset
0
20

Dirección

Mínimo

Máximo

Dirección Modbus (palabra)

0

99

Dirección S7-1500

MW100

MW298

Dirección Modbus (palabra)

20

119

Dirección S7-1500

MW100

MW298

HR_Start_Offset es un valor de palabra que indica la dirección inicial del registro de paradas
Modbus y está guardado en el bloque de datos de instancia Modbus_Slave . Esta variable
estática pública se selecciona mediante la lista desplegable de parámetros después de haber
insertado Modbus_Slave en el programa.
Si, por ejemplo, se ha insertado Modbus_Slave en un segmento KOP, es posible pasar a un
segmento anterior y asignar el valor HR_Start_Offset con el comando Move. El valor debe
asignarse antes de ejecutar Modbus_Slave.
Introducir una variable de esclavo Modbus mediante el nombre de DB estándar:
1. Coloque el cursor en el campo de parámetros OUT1 e introduzca el carácter m.
2. Seleccione en la lista desplegable el DB de instancia que desee para la instrucción
Modbus_Slave.
3. Coloque el cursor a la derecha del nombre de DB (después de las comillas) e introduzca un
punto.
4. Seleccione en la lista desplegable "Modbus_Slave_DB.HR_Start_Offset".

Versiones de la instrucción
Aunque la versión 4.0 tiene exactamente tiene la misma funcionalidad que la versión 3.0, se ha
incrementado el número por motivos internos.

Estructura de la trama
Extended_Addressing
A la variable Extended_Addressing se accede de un modo similar que a la referencia
HR_Start_Offset, excepto por el hecho de que la variable Extended_Addressing es un valor
booleano.
Para el direccionamiento de esclavo Modbus puede configurarse un byte individual (el
estándar de Modbus) con Extended_Adressing = FALSE, o bien dos bytes
(Extended_Adressing = TRUE). El direccionamiento avanzado sirve para direccionar más de
247 dispositivos en una sola red. Con Extended_Adressing = TRUE es posible activar un

7080

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
máximo de 65535 direcciones. A continuación se muestra una trama Modbus a modo de
ejemplo.
Tabla 4-396 Dirección del esclavo con un byte (byte 0)
Byte 0

Byte 1

Byte 2

Byte 3

Solicitud

Dirección
del esclavo

Código de
función

Respuesta váli‐
da

Dirección
del esclavo

Código de
función

Longitud

Mensaje de error

Dirección
del esclavo

0xxx

Código de ex‐
cepción

Byte 4

Byte 5

Dirección inicial

Datos
Datos...

Tabla 4-397 Dirección del esclavo con dos bytes (byte 0 y byte 1)
Byte 0

Byte 1

Byte 2

Byte 3

Byte 4

Solicitud

Dirección del esclavo

Código de
función

Respuesta váli‐
da

Dirección del esclavo

Código de
función

Longitud

Mensaje de error

Dirección del esclavo

0xxx

Código de ex‐
cepción

Byte 5

Dirección inicial

Byte 6
Datos

Datos...

Descripción de las tramas
El intercambio de datos entre maestro y esclavo comienza con la dirección del esclavo,
seguida del código de función. A continuación se transfieren los datos. La estructura del campo
de datos depende del código de función utilizado. Al final de la trama se transmitirá la suma de
comprobación (CRC).

Código de función 1 - Esta función permite leer bits de salida individuales
Tabla 4-398 FC 1 - Leer bits de salida
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 1

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 1

Longitud 1

Mensaje de
error

0x81

Código de ex‐
cepción 2

Petición

Dirección del
esclavo

Byte 2

Byte 3
Dirección inicial

Byte 4

Byte 5
Número de salidas

Datos de salida 3)
---

1

Longitud: si de la división de las salidas entre 8 se obtiene un residuo, el número de bytes debe incrementarse en 1.

2

Código E: 01, 02, 03 o 04

3

Los datos de salida pueden abarcar varios bytes

Programación del PLC
Manual de programación y manejo, 11/2019

7081

Instrucciones
4.2 Instrucciones

Byte 0

Byte 1

Byte 2

Byte 3

Byte 4

Petición

Dirección del esclavo

Código de
función 1

Respuesta
válida

Dirección del esclavo

Código de
función 1

Longitud 1

Mensaje de
error

Dirección del esclavo

0x81

Código de ex‐
cepción 2

Byte 5

Dirección inicial

Byte 6

Número de salidas
Datos de salida
---

1

Longitud: si de la división de las salidas entre 8 se obtiene un residuo, el número de bytes debe incrementarse en 1.

2

Código E: 01, 02, 03 o 04

3

Los datos de salida pueden abarcar varios bytes

Código de función 2 - Esta función permite leer bits de entrada individuales
Tabla 4-399 FC 2 - Leer bits de entrada
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 2

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 2

Longitud 1

Mensaje de
error

0x82

Código de ex‐
cepción 2

Petición

Dirección del
esclavo

Byte 2

Byte 3

Byte 4

Dirección inicial

Byte 5
Número de entradas

Datos de entrada
---

1

Longitud: si de la división de las entradas entre 8 se obtiene un residuo, el número de bytes debe incrementarse en 1.

2

Código E: 01, 02, 03 o 04

Byte 0

Byte 1

Byte 2

Byte 3

Byte 4

Petición

Dirección del esclavo

Código de
función 2

Dirección inicial

Respuesta
válida

Dirección del esclavo

Código de
función 2

Longitud 1

Mensaje de
error

Dirección del esclavo

0x82

Código de ex‐
cepción 2

Byte 5

Byte 6

Número de entradas
Datos de entrada
---

1

Longitud: si de la división de las entradas entre 8 se obtiene un residuo, el número de bytes debe incrementarse en 1.

2

Código E: 01, 02, 03 o 04

7082

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Código de función 3 - Esta función permite leer registros individuales
Tabla 4-400 FC 3 - Leer registro de paradas
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 3

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 3

Longitud 1

Mensaje de
error

0x83

Código de ex‐
cepción 2

Petición

Dirección del
esclavo

1

Longitud: Número de bytes

2

Código E: 01, 02, 03 o 04

Byte 0

Byte 1

Byte 2

Byte 3
Dirección inicial

Byte 2

Byte 3

Byte 4

Código de
función 3

Respuesta
válida

Dirección del esclavo

Código de
función 3

Longitud 1

Mensaje de
error

Dirección del esclavo

0x83

Código de ex‐
cepción 2

Longitud: Número de bytes
Código E: 01, 02, 03 o 04

Número de registros

---

Dirección del esclavo

2

Byte 5

Datos de registro

Petición

1

Byte 4

Byte 5

Dirección inicial

Byte 6

Número de registros
Datos de registro
---

Código de función 4 - Esta función permite leer registros individuales
Tabla 4-401 FC 4 - Leer palabras de entrada
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 4

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 4

Longitud 1

Mensaje de
error

0x84

Código de ex‐
cepción 2

Petición

Dirección del
esclavo

1

Longitud: 2 * número de palabras de entrada

2

Código E: 01, 02, 03 o 04

Programación del PLC
Manual de programación y manejo, 11/2019

Byte 2

Byte 3
Dirección inicial

Byte 4

Byte 5

Número de palabras de entrada
Datos de entrada
---

7083

Instrucciones
4.2 Instrucciones

Byte 0

Byte 1

Byte 2

Byte 3

Byte 4

Petición

Dirección del esclavo

Código de
función 4

Respuesta
válida

Dirección del esclavo

Código de
función 4

Longitud 1

Mensaje de
error

Dirección del esclavo

0x84

Código de ex‐
cepción 2

1

Longitud: 2 * número de palabras de entrada

2

Código E: 01, 02, 03 o 04

Dirección inicial

Byte 5

Byte 6

Número de palabras de en‐
trada
Datos de entrada
---

Código de función 5- Con esta función puede activarse o borrarse un bit individual
Tabla 4-402 FC 5 - Escribir un bit de salida
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 5

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 5

Longitud

Mensaje de
error

0x85

Código de ex‐
cepción 1

Petición

1

Dirección del
esclavo

Byte 3

Byte 4

Byte 5

Dirección inicial

Valor
Valor
---

Código E: 01, 02, 03 o 04

Byte 0

1

Byte 2

Byte 1

Byte 2

Byte 3

Byte 4

Petición

Dirección del esclavo

Código de
función 5

Respuesta
válida

Dirección del esclavo

Código de
función 5

Longitud

Mensaje de
error

Dirección del esclavo

0x85

Código de ex‐
cepción 1

Byte 5

Dirección inicial

Byte 6
Valor

Valor
---

Código E: 01, 02, 03 o 04

Código de función 6 - Esta función permite escribir registros individuales
Tabla 4-403 FC 6 - Escribir registro de paradas
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 6

Dirección

Registros

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 6

Dirección

Registros

Mensaje de
error

0x86

Petición

1

Dirección del
esclavo

Byte 2

Byte 3

Código de ex‐
cepción 1

Byte 4

Byte 5

---

Código E: 01, 02, 03 o 04

7084

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Byte 0

1

Byte 1

Byte 2

Byte 3

Byte 4

Byte 5

Byte 6

Petición

Dirección del esclavo

Código de
función 6

Dirección

Registros

Respuesta
válida

Dirección del esclavo

Código de
función 6

Dirección

Registros

Mensaje de
error

Dirección del esclavo

0x86

Código de ex‐
cepción 1

---

Código E: 01, 02, 03 o 04

Código de función 8 - Esta función permite comprobar la conexión de comunicación
Tabla 4-404 FC 8 - Estado del esclavo
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 8

Código de diagnóstico

Valor de prueba

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 8

Código de diagnóstico

Valor de prueba

Mensaje de
error

0x88

Petición

1

Dirección del
esclavo

Byte 3

Byte 4

Código de ex‐
cepción 1

Byte 5

---

Código E: 01, 03 o 04

Byte 0

1

Byte 2

Byte 1

Byte 2

Byte 3

Byte 4

Byte 5

Byte 6

Petición

Dirección del esclavo

Código de
función 8

Código de diagnóstico

Valor de prueba

Respuesta
válida

Dirección del esclavo

Código de
función 8

Código de diagnóstico

Valor de prueba

Mensaje de
error

Dirección del esclavo

0x88

Código de ex‐
cepción 1

---

Código E: 01, 03 o 04

Código de función 11 - Esta función permite leer una "Status-Word" de 2 bytes y un "Event-Counter" de
2 bytes
Tabla 4-405 FC 11 - Contador de eventos de la comunicación del esclavo
Byte 0

Byte 1

Dirección del
esclavo

Código de fun‐
ción 11

Respuesta váli‐ Dirección del
da
esclavo

Código de fun‐
ción 11

Mensaje de
error

0x8B

Petición

1

Dirección del
esclavo

Byte 2

Byte 3

Byte 4

Byte 5

--Status
Código de ex‐
cepción 1

Contador de eventos
---

Código E: 01 o 04

Programación del PLC
Manual de programación y manejo, 11/2019

7085

Instrucciones
4.2 Instrucciones

Byte 0

1

Byte 1

Byte 2

Byte 3

Petición

Dirección del esclavo

Código de
función 11

Respuesta
válida

Dirección del esclavo

Código de
función 11

Mensaje de
error

Dirección del esclavo

0x8B

Byte 4

Byte 5

Byte 6

--Status

Contador de eventos

Código de ex‐
cepción 1

---

Código E: 01 o 04

Código de función 15 - Esta función permite escribir varios bits
Tabla 4-406 FC 15 - Escribir uno o varios bits de salida
Byte 0

Byte 1

Petición

Dirección del
esclavo

Código de
función 15

Dirección inicial

Número de palabras
de salida

Respuesta
válida

Dirección del
esclavo

Código de
función 15

Dirección inicial

Número de palabras
de salida

Mensaje de
error

Dirección del
esclavo

0x8F

Byte 2

Byte 3

Byte 4

Byte 5

Código
de ex‐
cepción

Byte 6

Byte 7

Contador
de bytes 1

Byte n
Valor

-----

2

1

Contador de bytes: si de la división del número de bytes entre 8 se obtiene un residuo, el número de bytes debe
incrementarse en 1.

2

Código E: 01, 02, 03 o 04

Byte 0

Byte 1

Byte 2

Byte 3

Byte 4

Byte 5

Byte 6

Petición

Dirección del es‐ Código de
clavo
función 15

Dirección inicial

Número de palabras
de salida

Respuesta
válida

Dirección del es‐ Código de
clavo
función 15

Dirección inicial

Número de palabras
de salida

Mensaje de
error

Dirección del es‐ 0x8F
clavo

Código de ex‐
cepción 2

Byte 7

Byte 8

Contador
de bytes 1

Byte n
Valor

-----

1

Contador de bytes: si de la división del número de bytes entre 8 se obtiene un residuo, el número de bytes debe
incrementarse en 1.

2

Código E: 01, 02, 03 o 04

7086

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Código de función 16 - Esta función permite escribir uno o varios registros
Tabla 4-407 FC 16 - Escribir uno o varios registros de paradas
Byte 0

Byte 1

Byte 2

Byte 3

Byte 4

Byte 5

Petición

Dirección del
esclavo

Código de
función 16

Dirección inicial

Número de registros Contador
de bytes 1

Respuesta
válida

Dirección del
esclavo

Código de
función 16

Dirección inicial

Número de registros

Mensaje de
error

Dirección del
esclavo

0x90

Código
de ex‐
cepción

Byte 6

Byte 7

Byte n
Valor

-----

2

1

Contador de bytes: Número de registros * 2

2

Código E: 01, 02, 03 o 04

Byte 0

Byte 1

Byte 2

Byte 3

Byte 4

Byte 5

Byte 6

Petición

Dirección del es‐ Código de
clavo
función 16

Dirección inicial

Número de registros

Respuesta
válida

Dirección del es‐ Código de
clavo
función 16

Dirección inicial

Número de registros

Mensaje de
error

Dirección del es‐ 0x90
clavo

Código de ex‐
cepción 2

1

Contador de bytes: Número de registros * 2

2

Código E: 01, 02, 03 o 04

Byte 7

Byte 8

Contador
de bytes 1

Byte n
Valor

-----

Mensajes de error
Sinopsis de los mensajes de error Modbus
Código de
error

Descripción

Solución

16#0000

No hay error

‑

Error de configuración de la interfaz: Modbus_Comm_Load
16#8181

El módulo no soporta esta velocidad de transferencia
de datos.

Seleccione una velocidad de transferencia de datos
compatible con el módulo en el parámetro BAUD.

16#8182

El módulo no soporta este ajuste de paridad.

Seleccione un valor adecuado para "Paridad" en el
parámetro PARITY.
Se admiten:
● Sin (1)
● Par (2)
● Impar (3)
● Mark (4)
● Space (5)
● Cualquiera (6)

Programación del PLC
Manual de programación y manejo, 11/2019

7087

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#8183

El módulo no soporta este tipo de control del flujo de
datos.

Seleccione un control del flujo de datos compatible
con el módulo en el parámetro FLOW_CTRL.

16#8184

Valor no admisible para "Tiempo de respuesta excedi‐ Seleccione un valor adecuado para "Tiempo de res‐
do".
puesta excedido" en el parámetro RESP_TO.

16#8280

Acuse negativo al leer el módulo

Rango admisible: 1-65535 (ms)
Compruebe la entrada en el parámetro PORT.
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos Send_Con‐
fig.RDREC.STATUS, Receive_Config.RDREC.STA‐
TUS o RDREC.STATUS, así como en la descripción
del SFB RDREC.
16#8281

Acuse negativo al escribir en el módulo

Compruebe la entrada en el parámetro PORT.
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos Send_Con‐
fig.WRREC.STATUS, Receive_Config.WRREC.STA‐
TUS o WRREC.STATUS, así como en la descripción
del SFB WRREC.

16#8282

Módulo no disponible

Compruebe la entrada en el parámetro PORT y ase‐
gúrese de que el módulo está accesible.

Error de configuración: Modbus_Slave
16#8186

Dirección del esclavo no admisible

Seleccione una dirección del esclavo adecuada en el
parámetro MB_ADDR.
Se admiten: 1-247 con área de direcciones estándar;
1-65535 con área de direcciones ampliada
(0 está reservado para Broadcast)

16#8187

Valor no admisible en el parámetro MB_HOLD_REG

Seleccione un valor adecuado para el Holding Regis‐
ter en el parámetro MB_HOLD_REG.

16#8188

Modo de operación no admisible o Broadcast
(MB_ADDR = 0) y parámetro MODE ≠ 1

En el modo de operación Broadcast seleccione el
valor 1 para MODE o elija un modo de operación dis‐
tinto.

16#818C

El puntero hacia un área MB_HOLD_REG debe ser un
bloque de datos o un área de marcas.

Seleccione un valor adecuado para el puntero hacia
el área MB_HOLD_REG.

16#8280

Acuse negativo al leer el módulo

Compruebe la entrada en el parámetro PORT.
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos
Send_P2P.RDREC.STATUS o Recei‐
ve_P2P.RDREC.STATUS, así como en la descrip‐
ción del SFB RDREC.

16#8281

Acuse negativo al escribir en el módulo

Compruebe la entrada en el parámetro PORT.
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos
Send_P2P.WRREC.STATUS o Recei‐
ve_P2P.WRREC.STATUS, así como en la descrip‐
ción del SFB WRREC.

16#8452 1)

MB_HOLD_REG no señala a ningún DB ni área de
marcas

Compruebe el puntero MB_HOLD_REG

16#8453 1)

MB_HOLD_REG no es un puntero del tipo BOOL o
WORD

Compruebe el puntero MB_HOLD_REG

7088

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#8454 1)

La longitud del área direccionada con
MB_HOLD_REG supera la longitud del DB o el área
direccionada es demasiado pequeña para el número
de datos que deben leerse o escribirse.

Compruebe el puntero MB_HOLD_REG

16#8455 1)

MB_HOLD_REG señala a un DB protegido contra es‐ Compruebe el puntero MB_HOLD_REG
critura

16#8456 1)

Error al ejecutar la instrucción. La causa del error figura Determine el valor del parámetro SFCSTATUS. Lea
en el parámetro estático STATUS.
su significado en la descripción del SFC51, paráme‐
tro STATUS.

Error de configuración: Modbus_Master
16#8180

Valor no admisible para el parámetro MB_DB

El valor parametrizado para MB_DB (DB de datos de
instancia) en la instrucción Modbus_Comm_Load no
es admisible.
Compruebe la interconexión de la instrucción Mod‐
bus_Comm_Load y sus mensajes de error.

16#8186

Dirección de estación no admisible

Seleccione una dirección de estación adecuada en el
parámetro MB_ADDR.
Se admiten: 1-247 con área de direcciones estándar;
1-65535 con área de direcciones ampliada
(0 está reservado para Broadcast)

16#8188

Modo de operación no admisible o Broadcast
(MB_ADDR = 0) y parámetro MODE ≠ 1

En el modo de operación Broadcast, seleccione el
valor 1 para MODE o elija un modo de operación dis‐
tinto.

16#8189

Dirección de datos no admisible

Seleccione un valor adecuado para la dirección de
datos en el parámetro DATA_ADDR.
Consulte la descripción Modbus_Master en el siste‐
ma de información

16#818A

Indicación de longitud no válida

Seleccione una longitud de datos adecuada en el pa‐
rámetro DATA_LEN.
Consulte la descripción Modbus_Master en el siste‐
ma de información

16#818B

Valor no admisible para DATA_PTR

Seleccione un valor adecuado para el puntero de da‐
tos (dirección M o DB) en el parámetro DATA_PTR.
Consulte la descripción Modbus_Master en el siste‐
ma de información

16#818C

Error de interconexión del parámetro DATA_PTR

Compruebe la interconexión de la instrucción.

16#818D

La longitud del área direccionada con DATA_PTR re‐
basa la longitud del DB o el área direccionada es de‐
masiado pequeña para el número de datos que debe
leerse o escribirse.

Compruebe el puntero DATA_PTR

16#8280

Acuse negativo al leer el módulo

Compruebe la entrada en el parámetro PORT.
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos
Send_P2P.RDREC.STATUS o Recei‐
ve_P2P.RDREC.STATUS, así como en la descrip‐
ción del SFB RDREC.

Programación del PLC
Manual de programación y manejo, 11/2019

7089

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#8281

Acuse negativo al escribir en el módulo

Compruebe la entrada en el parámetro PORT.
Encontrará información más detallada sobre la causa
del error en los parámetros estáticos
Send_P2P.WRREC.STATUS, Recei‐
ve_P2P.WRREC.STATUS o Receive_Reset, así co‐
mo en la descripción del SFB WRREC.

Error de comunicación - Modbus_Master y Modbus_Slave
16#80D1

El tiempo de espera a XON o CTS = ON ha transcurri‐ El interlocutor falla, es demasiado lento o está offline.
do.
Compruebe el interlocutor o modifique la parametri‐
zación en caso necesario.

16#80D2

"Hardware RTS siempre ON": orden de transmisión
cancelada por cambio de DSR = ON a OFF

Compruebe el interlocutor. Asegúrese de que DSR
está ON durante toda la transferencia.

16#80E0

Telegrama cancelado: Desbordamiento del búfer de
transmisión / telegrama de transmisión demasiado
grande

En el programa de usuario llame la instrucción con
más frecuencia o parametrice una comunicación con
control del flujo de datos.

16#80E1

Telegrama cancelado: error de paridad

Compruebe la línea de conexión de los interlocutores
y asegúrese de que en ambos interlocutres esté ajus‐
tada la misma velocidad de transmisión, la misma pa‐
ridad y el mismo número de bits de parada.

16#80E2

Telegrama cancelado: error de trama

Compruebe los ajustes de bit de inicio, bits de datos,
bit de paridad, velocidad de transferencia de datos y
bit(s) de parada.

16#80E3

Telegrama cancelado: error de desbordamiento de ca‐ Compruebe el número de datos en el telegrama del
racteres
interlocutor.

16#80E4

Telegrama cancelado: longitud máxima de telegrama
alcanzada

Seleccione una longitud de telegrama menor en el
interlocutor.
Se admiten (en función del módulo):
1-1024/2048/4096 (bytes)

Error de comunicación - Modbus_Master
16#80C8

El esclavo no responde dentro del tiempo ajustado

Compruebe la velocidad de transferencia de datos, la
paridad y el cableado del esclavo.

16#80C9

El esclavo no responde dentro del tiempo ajustado
mediante Blocked_Proc_Timeout.

Compruebe el ajuste de Blocked_Proc_Timeout.

La interfaz está ocupada por una orden en curso.

Repita la orden más tarde. Asegúrese de que no se
esté ejecutando ninguna orden antes de iniciar una
nueva.

16#8200

Compruebe si el módulo se ha parametrizado con la
instrucción Modbus_Comm_Load. Tal vez tenga que
reparametrizarse el módulo mediante Mod‐
bus_Comm_Load tras desenchufar/enchufar o tras
restablecerse la corriente.

Error de protocolo - Modbus_Slave (solo módulos de comunicaciones compatibles con Modbus)
16#8380

Error CRC

16#8381

El código de función no se soporta o no se soporta para Compruebe el interlocutor y asegúrese de que se en‐
Broadcast.
vía un código de función válido.

16#8382

Indicación de longitud no válida en el telegrama de
orden

7090

Error de suma de verificación del telegrama Modbus.
Compruebe el interlocutor.

Seleccione una longitud de datos adecuada en el pa‐
rámetro DATA_LEN.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#8383

Dirección de datos no válida en el telegrama de orden Seleccione un valor adecuado para la dirección de
datos en el parámetro DATA_ADDR.

16#8384

Error de valor de datos no válido en el telegrama de
orden

Compruebe el valor de datos en el telegrama de or‐
den del maestro Modbus

16#8385

El esclavo Modbus no soporta el valor de diagnóstico
(código de función 08)

El esclavo Modbus solo soporta los valores de diag‐
nóstico 16#0000 y 16#000A.

Error de protocolo - Modbus_Master (solo módulos de comunicaciones compatibles con Modbus)
16#8380

Error CRC

Error de suma de verificación del telegrama Modbus.
Compruebe el interlocutor.

16#8381

Telegrama de respuesta de Modbus Slave con men‐
saje de error: El código de función no se soporta.

Compruebe el interlocutor y asegúrese de que se en‐
vía un código de función válido.

16#8382

Telegrama de respuesta de Modbus Slave con men‐
saje de error: Indicación de longitud no válida

Seleccione una longitud de datos adecuada.

16#8383

Telegrama de respuesta de Modbus Slave con men‐
saje de error: Dirección de datos no válida en el tele‐
grama de orden

Seleccione un valor adecuado para la dirección de
datos en el parámetro DATA_ADDR.

16#8384

Telegrama de respuesta de Modbus Slave con men‐
saje de error: Error de valor de datos

Compruebe el telegrama de orden en el esclavo Mod‐
bus.

16#8385

Telegrama de respuesta de Modbus Slave con men‐
saje de error: El esclavo Modbus no soporta el valor de
diagnóstico

Los esclavos Modbus solo soportan los valores de
diagnóstico 16#0000 y 16#000A.

16#8386

El código de función devuelto no concuerda con el có‐ Compruebe el telegrama de respuesta y el direccio‐
digo de función solicitado.
namiento del esclavo.

16#8387

Un esclavo no consultado responde

Compruebe el telegrama de respuesta del esclavo.
Compruebe los ajustes de direcciones de los escla‐
vos.

16#8388

Error en la respuesta del esclavo a una orden de es‐
critura.

Compruebe el telegrama de respuesta del esclavo.

16#8828 1)

DATA_PTR señala a una dirección de bit diferente de
n*8

Compruebe el puntero DATA_PTR

16#8852 1)

DATA_PTR no señala a ningún DB ni área de marcas Compruebe el puntero DATA_PTR

16#8853

1)

DATA_PTR no es un puntero del tipo BOOL o WORD Compruebe el puntero DATA_PTR

16#8855

1)

16#8856 1)

DATA_PTR señala a un DB protegido contra escritura Compruebe el puntero DATA_PTR
Error al llamar el SFC51

Repita la llamada de la instrucción Modbus_Master

Error - Modbus_Slave (solo módulos de comunicaciones compatibles con Modbus)
16#8428 1)

MB_HOLD_REG señala a una dirección de bit diferen‐ Compruebe el puntero MB_HOLD_REG
te de n * 8

16#8452 1)

MB_HOLD_REG no señala a ningún DB ni área de
marcas

Compruebe el puntero MB_HOLD_REG

16#8453 1)

MB_HOLD_REG no es un puntero del tipo BOOL o
WORD

Compruebe el puntero MB_HOLD_REG

16#8454 1)

La longitud del área direccionada con
MB_HOLD_REG supera la longitud del DB o el área
direccionada es demasiado pequeña para el número
de datos que deben leerse o escribirse.

Compruebe el puntero MB_HOLD_REG

16#8455 1)

MB_HOLD_REG señala a un DB protegido contra es‐ Compruebe el puntero MB_HOLD_REG
critura

Programación del PLC
Manual de programación y manejo, 11/2019

7091

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

16#8456 1)

Error al llamar el SFC51

Repita la llamada de la instrucción Modbus_Slave

Códigos de error generales
16#8FFF
1)

El módulo no está operativo temporalmente debido a
un reset.

Repita la consulta.

Solo en instrucciones para CPU S7-300/400

Acoplamiento PtP CP 340
P_SEND: Enviar datos
Descripción
La instrucción P_SEND transmite un conjunto de datos de un bloque de datos especificado por
los parámetros DB_NO, DBB_NO y LEN, al CP 340. La instrucción P_SEND se llama para
transferir datos cíclica o estáticamente (sin condiciones) en un programa controlado por
tiempo.

Funcionamiento
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
Dependiendo del volumen de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).
La instrucción P_SEND puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al CP 340 y la instrucción P_SEND
pasa al estado inicial. Los datos que ya ha recibido el CP 340 se envían al interlocutor. Si la
entrada R tiene el estado lógico estático "1", la transmisión está desactivada.
Con el parámetro LADDR se indica la dirección del CP 340 que debe llamarse.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
Parámetro STATUS (Página 7105). Si no se producen errores, STATUS asume el valor 0.
DONE y ERROR/STATUS también se visualizan en caso de RESET de la instrucción
P_SEND. Si se ha producido un error, se desactiva el resultado binario RB. Si el bloque finaliza
sin errores, el estado del resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascenden‐
te

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso.
Transmisión bloqueada.

7092

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

LADDR

INPUT

INT

Dirección inicial del CP 340
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
N.º de DB emisor:
específico de la CPU. No se admite el
valor 0.

DBB_NO

INPUT

INT

Número del byte de datos
0 ≤ DBB_NO ≤ 8190 datos de transmi‐
sión a partir del byte de datos

LEN

INPUT

INT

Longitud de datos
1 ≤ LEN ≤ 1024, indicados en número
de bytes

DONE1

OUTPUT

BOOL

Petición finalizada sin errores
Parámetro STATUS == 16#00;

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
Parámetro STATUS (Página 7105)
contiene la información de error.

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el Parámetro STA‐
TUS (Página 7105) figura la informa‐
ción de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción P_SEND opera conjuntamente con un DB instancia I_SEND. El número del DB
se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0F, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS.

Programación del PLC
Manual de programación y manejo, 11/2019

7093

Instrucciones
4.2 Instrucciones

Cronograma
La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de las entradas REQ y R.

5(4

5

'21(

/DSHWLFLµQQR
VHHMHFXWD
7UDQVPLVLµQ
GHVDFWLYDGD

)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURU

7UDQVIHULU5(6(7

3DUWHlQl6(1'

)LQVLQHUURUHV

3HWLFLµQGHWUDQVPLVLµQ

(5525

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ . El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

Regulación
Nota
La instrucción P_SEND no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP .
Nota
Antes de que el CP 340 pueda procesar una petición iniciada después de una transición de
estado de la CPU de STOP a RUN , debe haber concluido el mecanismo de arranque CP–CPU
de la instrucción P_SEND. Una petición iniciada entretanto no se pierde. Se transfiere al
CP 340 una vez concluida la coordinación de arranque.

7094

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

P_RCV: Recibir datos
Descripción
La instrucción P_RCV transmite datos del CP 340 a un área de datos S7, especificada por los
parámetros DB_NO, DBB_NO y LEN. La instrucción P_RCV se llama para transferir datos
cíclica o estáticamente (sin condiciones) en un programa controlado por tiempo.

Funcionamiento
Con el estado lógico (estático) "1" en el parámetro EN_R se habilita la comprobación de si
pueden leerse datos del CP 340. Es posible cancelar una transmisión en curso con un estado
lógico "0" en el parámetro EN_R. (Puesto que puede suceder esporádicamente que tras
ajustar el parámetro EN_R a "1" la transferencia ya no se inicie, para cancelar una
transferencia en curso, debe ajustar el parámetro R a "1" en paralelo al ajuste del parámetro
EN_R a "0".) La petición de recepción cancelada finaliza con un mensaje de error (salida
STATUS). La recepción está desactivada mientras el parámetro EN_R tenga el estado lógico
"0".. Dependiendo del volumen de datos, la transmisión puede desarrollarse en varias
llamadas (ciclos del programa).
Si la instrucción detecta el estado lógico "1" en el parámetro R, se cancela la petición actual de
transmisión y la instrucción P_RCV pasa al estado inicial. La recepción está desactivada
mientras el parámetro R tenga el estado lógico "1". Cuando el estado de señal vuelve a ser "0",
el telegrama interrumpido se vuelve a recibir desde el principio.
Con el parámetro LADDR se selecciona el CP 340 que se llamará.
La salida NDR indica "Petición finalizada sin errores/Datos aceptados" (leídos todos los datos).
ERROR indica que se ha producido un error. En caso de producirse un error, el número de
evento correspondiente se indica en STATUS (Página 7105). Si no se produce ningún error,
STATUS asume el valor 0. NDR y ERROR/STATUS también se visualizan en caso de RESET
del P_RCV (parámetro LEN == 16#00). Si se ha producido un error, se desactiva el resultado
binario RB. Si el bloque finaliza sin errores, el estado del resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

EN_R

INPUT

BOOL

Habilitar lectura de datos

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Blo‐
queo de recepción.

LADDR

INPUT

INT

DB_NO

INPUT

INT

Dirección inicial del CP 340
La dirección inicial se toma de STEP 7.
Número del bloque de datos
N.º del DB de recepción:
específico de la CPU. No se admite el va‐
lor 0.

DBB_NO

INPUT

INT

Número del byte de datos
0 ≤ DBB_NO ≤ 8190 datos de recepción a
partir del byte de datos

Programación del PLC
Manual de programación y manejo, 11/2019

7095

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

NDR 1

OUTPUT

BOOL

Petición finalizada sin errores, datos
aceptados

ERROR 1

OUTPUT

BOOL

Petición interrumpida con errores

Parámetro STATUS == 16#00;
El parámetro STATUS (Página 7105)
contiene la información de error.
LEN 1

OUTPUT

INT

Longitud del telegrama recibido
1 ≤ LEN ≤ 1024, indicados en número de
bytes

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STA‐
TUS (Página 7105) figura la información
de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción P_RCV opera conjuntamente con un DB instancia I_RCV. El número del DB se
indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0E, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS.

7096

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Cronograma
La siguiente figura muestra el comportamiento de los parámetros NDR, LEN y ERROR en
función de la conexión de la entrada EN_R y R.

(1B5

5

1'5

)LQFRQHUURU

5HFHSFLµQHQFXUVR

5(6(7
)LQVLQHUURUHV

6LQUHFHSFLµQ

)LQFRQHUURU

5HFHSFLµQHQFXUVR

)LQVLQHUURUHV

+DELOLWDUUHFHSFLµQ

/(1
ORQJLWXG

5HFHSFLµQGHVFRQHFWDGD

(5525

Nota
La entrada EN_R debe ponerse estáticamente a "1". Mientras dure toda la petición de
recepción, el parámetro EN_R debe recibir el RLO "1" (resultado lógico).

Regulación
Nota
La instrucción P_RCV no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP.
Nota
Antes de que el CP 340 pueda recibir una petición después de una transición de estado de la
CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CP–CPU de la
instrucción P_RCV .

Programación del PLC
Manual de programación y manejo, 11/2019

7097

Instrucciones
4.2 Instrucciones

P_PRINT: Imprimir un texto de aviso con hasta cuatro variables
Descripción
Para imprimir textos de aviso se dispone de la instrucción P_PRINT . La instrucción P_PRINT
transmite, por ejemplo, un aviso de proceso al CP 340. El CP 340 registra el aviso de proceso
en la impresora conectada.
La instrucción P_PRINT transmite un texto de aviso con hasta cuatro variables al CP 340. La
instrucción P_PRINT se llama para transferir datos cíclica o estáticamente (sin condiciones)
en un programa controlado por tiempo.

Funcionamiento
A través de los parámetros DB_NO y DBB_NO se accede a los punteros (puntero hacia
bloques de datos) para la cadena de formato y las cuatro variables. Los punteros deben estar
depositados sin huecos y en un orden determinado en el bloque de datos parametrizado (DB
de punteros) (véase la figura "DB de punteros").
La transmisión del texto de aviso se dispara con un flanco ascendente en la entrada REQ.
Primero se transfiere la cadena de formato del texto de aviso. Después se transfieren las
variables 1 a 4.
Dependiendo de la cantidad de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).
La instrucción P_PRINT puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al CP 340y la instrucción P_PRINT
pasa al estado inicial. Los datos que ya ha recibido el CP 340 se envían al interlocutor. Si en
la entrada R está activado el estado lógico estático "1", significa que la transmisión de trabajos
de impresión está desactivada.
En el parámetro LADDR se indica la dirección del CP 340 que se va a llamar.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUSasume el valor 0. DONEy ERROR/
STATUStambién se visualizan en caso de RESETde la instrucción P_PRINT . Si se ha
producido un error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el
estado del resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Blo‐
queada salida por impresora.

7098

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

LADDR

INPUT

INT

Dirección inicial del CP 340
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
Puntero del DB de punteros:
específico de la CPU. No se admite el va‐
lor 0.
(Los punteros a variables y cadena de
formato están registrados en el DB de
punteros en un orden fijo. (Véase la ima‐
gen siguiente)).

DBB_NO

INPUT

INT

Número del byte de datos
0 ≤ DBB_NO ≤ 8162 puntero a partir de
byte de datos

DONE 1

OUTPUT

BOOL

Petición finalizada sin errores
Parámetro STATUS == 16#00;

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7105)
contiene la información de error.

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STA‐
TUS (Página 7105) figura la información
de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos, DB de instancia
La instrucción P_PRINT opera conjuntamente con un DB instancia I_PRINT. El número del DB
se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0F, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS.

Asignación en el área de datos, DB de punteros
La instrucción P_PRINT accede, a través de los parámetros DB_NO y DBB_NO, a un DB de
punteros en el que están depositados en un orden fijo los punteros hacia los bloques de datos
con los textos de aviso y las variables. El DB de punteros debe crearlo usted.
La figura muestra la estructura del DB de punteros, al que se accede con los parámetros
DB_NO y DBB_NO de la instrucción P_PRINT .

Programación del PLC
Manual de programación y manejo, 11/2019

7099

Instrucciones
4.2 Instrucciones

'%:Q

1¼PHUR'%

'%:Q

1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q
'%:Q

1¼PHUR'%
1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q
'%:Q

1¼PHUR'%
1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q

1¼PHUR'%

'%:Q

1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q
'%:Q

1¼PHUR'%

'%:Q

/RQJLWXG

1¼PHUR'%%

3XQWHURDlYDULDEOH

3XQWHURDlYDULDEOH

3XQWHURDlYDULDEOH

3XQWHURDlYDULDEOH

3XQWHURDVWULQJGHIRUPDWR

Números de DB permitidos
Los números de DB permitidos son específicos de la CPU. Si con "Puntero en variable" se
indica como número de DB el valor 16#00, dicha variable se interpreta como inexistente, y el
puntero se coloca en la siguiente variable o en la cadena de formato.
Si con "Puntero hacia cadena de formato" el número de DB es igual al valor 16#00, se
interrumpe el trabajo de impresión y se indica el número de evento 16#1E43 en la salida del
parámetro STATUS de la instrucción P_PRINT .

Números de DBB permitidos
A partir del número de DBB parametrizado figura la variable o la cadena de formato. La máxima
longitud permitida de las variables es 32 bytes, y de la cadena de formato 150 bytes.
Si se sobrepasa la longitud máxima, se interrumpe el trabajo de impresión y se indica el
número de evento 16#1E41 en la salida del parámetro STATUS de la instrucción P_PRINT.

Longitud permitida
La longitud indicada en el DB de punteros debe adaptarse para cada modo de representación
(tipos de datos) y en función de la precisión utilizada.

7100

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Cronograma

/DSHWLFLµQ35,17
QRVHHMHFXWD
(QYLDUHVW£
GHVFRQHFWDGR

)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURU

7UDQVIHULU5(6(7

lHQ«VLPDSDUWH35,17

)LQVLQHUURUHV

(QYLDUSHWLFLµQ

La siguiente figura muestra el comportamiento de los parámetros DONEy ERRORen función
de la conexión de las entradas REQy R.

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. No tiene que estar durante toda la transmisión en el estado lógico "1".

Regulación
Nota
La instrucción P_PRINT no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP.
Nota
Antes de que el CP 341 pueda procesar una petición iniciada después de una transición de
estado de la CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CP–CPU
de la instrucción P_PRINT . Una petición iniciada entretanto no se pierde. Se transfiere al
CP 340una vez concluida la coordinación de arranque.

Programación del PLC
Manual de programación y manejo, 11/2019

7101

Instrucciones
4.2 Instrucciones

P_RESET: Borrar el búfer de recepción
Descripción
La instrucción P_RESET borra completamente el búfer de recepción del CP 340. Todos los
telegramas guardados se rechazan. Un telegrama entrante en el momento de llamar a la
instrucción P_RESET se guarda.
Con un flanco ascendente en la entrada REQ se activa la instrucción. La petición puede
extenderse varias llamadas (ciclos de programa).
Con el parámetro LADDR se indica la dirección del CP 340 que debe llamarse.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
Parámetro STATUS (Página 7105). Si no ha aparecido ningún error, STATUS tiene el valor 0.
Si ha aparecido un error, se borra el resultado binario RB. Si el bloque finaliza sin errores, el
estado del resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

LADDR

INPUT

INT

Dirección inicial del CP 340
La dirección inicial se toma de STEP 7.

DONE

1

OUTPUT

BOOL

Petición finalizada sin errores
Parámetro STATUS == 16#00;

ERROR 1

OUTPUT

BOOL

Petición interrumpida con errores
Parámetro STATUS (Página 7105) contie‐
ne la información de error.

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el Parámetro STATUS
(Página 7105) figura la información de
error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción P_RESET opera conjuntamente con un DB instancia I_P_RESET. El número del
DB se indica con la llamada. No se puede acceder a los datos del DB de instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0F, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS.

7102

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Cronograma
La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de la entrada REQ.

5(4


)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURU

7UDQVIHULU5(6(7

)LQVLQHUURUHV

(5525


%RUUDUE¼IHUGHUHFHSFLµQ

'21(


Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ . El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

Regulación
Nota
La instrucción P_RESET no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP .

Programación del PLC
Manual de programación y manejo, 11/2019

7103

Instrucciones
4.2 Instrucciones

V24_STAT_340 / V24_STAT: Leer señales cualificadoras en la interfaz RS232C
Descripción
La instrucción V24_STAT_340 (CP 340) / V24_STAT (CP 341) lee del CP 34x las señales
cualificadoras RS 232C y las pone a disposición del usuario en los parámetros del bloque. La
instrucción V24_STAT_340 / V24_STAT se llama cíclica o estáticamente (sin condiciones) en
un programa controlado por tiempo.
Las señales cualificadoras RS 232C se actualizan cada vez que se llama la instrucción
(sondeo cíclico). El CP 34x actualiza el estado de las entradas/salidas en un tiempo de 20 ms.
Con independencia de ello, las entradas/salidas se actualizan continuamente.
El resultado binario RB permanece igual. La instrucción no emite mensajes de error.
Con el parámetro LADDR se selecciona el CP 34x que se llamará.

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

LADDR

INPUT

INT

Dirección inicial del CP 34x

DTR_OUT

OUTPUT

BOOL

La dirección inicial se toma de STEP 7.
Data terminal ready,
CP 34x operativo
(salida del CP 34x)
DSR_IN

OUTPUT

BOOL

Data set ready,
interlocutor operativo
(entrada del CP 34x)

RTS_OUT

OUTPUT

BOOL

Request to send,
CP 34x listo para transmitir
(salida del CP 34x)

CTS_IN

OUTPUT

BOOL

Clear to send,
el interlocutor puede recibir datos del CP 34x
(respuesta a RTS = ON del CP 34x)
(entrada del CP 34x)

DCD_IN

OUTPUT

BOOL

Data Carrier detect,
nivel de señal de recepción
(entrada del CP 34x)

RI_IN

OUTPUT

BOOL

Ring Indicator,
indicador de llamada
(entrada del CP 34x)

Asignación en el área de datos
La instrucción V24_STAT_340 / V24_STAT no ocupa áreas de datos.

7104

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Regulación
Nota
Para detectar un cambio de señal se requiere una duración de impulso mínima. Las
magnitudes decisivas son el tiempo de ciclo de la CPU, el tiempo de actualización en la CP 34x
y el tiempo de reacción del interlocutor.

V24_SET_340 / V24_SET: Escribir señales cualificadoras en la interfaz RS232C
Descripción
El usuario puede activar o desactivar las correspondientes salidas de la interfaz a través de las
entradas de parámetros de la instrucción V24_SET_340 (CP 340) / V24_SET (CP 341). La
instrucción V24_SET_340 / V24_SET se llama cíclica o estáticamente (sin condiciones) en un
programa controlado por tiempo.
El resultado binario RB permanece igual. La instrucción no emite mensajes de error.
Con el parámetro LADDR se selecciona el CP 34x que se llamará.

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

LADDR

INPUT

INT

Dirección inicial del CP 34x
La dirección inicial se toma de STEP 7.

RTS

INPUT

BOOL

Request to send,
CP 34x listo para transmitir
(controlar la salida del CP 34x)

DTR

INPUT

BOOL

Data terminal ready,
CP 34x operativo
(controlar la salida del CP 34x)

Asignación en el área de datos
La instrucción V24_SET_340 / V24_SETno ocupa áreas de datos.

Parámetro STATUS
Clases de eventos
Clase de evento Significado
5

Error al procesar una orden de la CPU

7

Error de transmisión

Programación del PLC
Manual de programación y manejo, 11/2019

7105

Instrucciones
4.2 Instrucciones
Clase de evento Significado
8

Error de recepción

30 (1EH)

Error en la comunicación entre el CP y la CPU

Parámetro STATUS
Código de
error

Descripción

Solución

(W#16#...)
0502

La orden no está permitida en este estado Evalúe la alarma de diagnóstico y corrija el
operativo del CP (p. ej. interfaz de disposi‐ error correspondiente.
tivo no parametrizada).

0505

Sólo con driver de impresora:
Bloque de datos del sistema con textos de
aviso no disponible en CP

0506

Sólo con driver de impresora:

0507

Sólo con driver de impresora:

Texto de aviso no disponible
Texto de aviso demasiado largo
0508

Sólo con driver de impresora:
Demasiadas instrucciones de conversión

0509

Sólo con driver de impresora:
Demasiadas variables

050A

Sólo con driver de impresora:
Instrucción de conversión desconocida

050B

Sólo con driver de impresora:
Instrucción de control desconocida

050C

Sólo con driver de impresora:
Instrucción de conversión no ejecutable

050D

7106

Configure los textos de aviso con el softwa‐
re de parametrización y reinicie.
Configure los textos de aviso con el softwa‐
re de parametrización y reinicie.
Modifique el texto de aviso hasta un máximo
de 150 caracteres (a un máximo de 250 ca‐
racteres en caso de variables)
Ha configurado más instrucciones de con‐
versión que variables. Las instrucciones de
conversión sin la variable correspondiente
se ignoran.
Ha configurado más variables que instruc‐
ciones de conversión. Las variables sin ins‐
trucción de conversión no se imprimen.
Revise la instrucción de conversión. Las ins‐
trucciones de conversión no definidas o no
compatibles se sustituyen por ****** en la
impresión.
Revise la instrucción de control. Las instruc‐
ciones de control indefinidas o incompati‐
bles se ignoran. La instrucción de control
tampoco se imprime en forma de texto.
Revise la instrucción de conversión. Las ins‐
trucciones de conversión no ejecutables se
imprimen con asteriscos * de acuerdo con el
ancho definido y la parte válida restante de
la instrucción, o bien de la representación
estándar.

Corrija el ancho especificado para la varia‐
Ancho insuficiente o excesivo en la instruc‐ ble de la instrucción de conversión a partir
del número máximo de caracteres de la va‐
ción de conversión
riable en los modos de representación ba‐
sados en texto (A, C, D, S, T, Y, Z). En la
impresión sólo se imprime el número de ca‐
racteres correspondiente al ancho especifi‐
cado, el resto no se imprime. En el resto de
casos se imprimen asteriscos * en la canti‐
dad equivalente al ancho.
Sólo con driver de impresora:

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

Sólo para driver 3964(R) y ASCII:

La longitud de telegrama es > 1024 bytes. El
CP 340 continúa recibiendo el resto del te‐
legrama (> 1024 bytes) y, por tanto, rechaza
la primera parte del telegrama.

(W#16#...)
050E

Longitud de telegrama no válida

Seleccione una longitud de telegrama me‐
nor.
051B

Sólo con driver de impresora:
Precisión no válida

051C

Sólo con driver de impresora:
Variable no válida
(Longitud de variable incorrecta/tipo inco‐
rrecto)

051E

Sólo con driver de impresora:
Las "secuencias de fin de línea" enviadas
con esta orden (p. ej., $R/$L/$N) (ya) no
encajan en la página (empezada)

0701

Sólo con 3964(R):
Transmisión de la primera repetición:
● Se ha detectado un error durante el
envío del telegrama o bien
● El interlocutor ha solicitado una
repetición con un carácter de
confirmación negativo (NAK).

0702

Sólo con 3964(R):
Error al establecer la conexión:
Después del envío del carácter STX, se ha
recibido el carácter NAK o cualquier otro
carácter (salvo DLE o STX).

0703

Sólo con 3964(R):
Se ha excedido el tiempo de retardo de
acuse (TRA):
Tras el envío de STX no se ha recibido
ninguna respuesta del interlocutor en el
tiempo de retardo de acuse.

Programación del PLC
Manual de programación y manejo, 11/2019

Corrija la precisión indicada en la instruc‐
ción de conversión. La precisión siempre va
precedida de un punto que identifica y limita
el ancho (p. ej.: ".2" para la salida de punto
decimal y dos decimales). La precisión sólo
es relevante en los modos de representa‐
ción F, R, A y D. En el resto de casos se
ignora.
Corrija la variable indicada. Consulte los ti‐
pos de datos válidos para el modo de repre‐
sentación en cuestión en la tabla respectiva.
Aumente la longitud de la página, reduzca la
cantidad de líneas (o los saltos de línea) o
reparta la impresión en varias páginas
Un reintento no es un error, pero puede ser
un indicio de que hay interferencias en la
línea de transmisión o de que el interlocutor
no funciona correctamente. Si una vez al‐
canzado el número máximo de repeticiones
el telegrama no ha podido ser enviado, se
notifica un número de error que describe el
error que se produjo en primer lugar.
Compruebe por qué falla el dispositivo del
interlocutor y, si es necesario, con un dispo‐
sitivo de comprobación de interfaz
(FOXPG) conectado a la línea de transmi‐
sión.
El dispositivo interlocutor es demasiado len‐
to o no está preparado para recibir o bien
hay p. ej. una rotura de la línea de envío.
Compruebe el comportamiento erróneo del
dispositivo interlocutor, en caso necesario
con un dispositivo de comprobación de in‐
terfaz (FOXPG) conectado a la línea de
transmisión.

7107

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

(W#16#...)
0704

Sólo con 3964(R):

Compruebe si el interlocutor también indica
errores porque no se han recibido todos los
datos enviados (p. ej. debido a una rotura en
Durante el proceso de transmisión en cur‐
la línea de transmisión) o que haya fallos
so el interlocutor ha recibido uno o varios
graves, o bien un comportamiento erróneo
caracteres.
del interlocutor. Verifíquelo con un dispositi‐
vo de test de interfaz (FOXPG) conectado a
la línea de transmisión.
Cancelación por parte del interlocutor:

0705

Sólo con 3964(R):
Acuse negativo durante la transmisión

0706

Sólo con 3964(R):
Error en el extremo de la conexión:
● El telegrama ha sido rechazado por el
interlocutor con NAK u otro carácter al
final (con la excepción de DLE) o bien
● El carácter DLE se ha recibido
demasiado pronto.

0707

Sólo con 3964(R):
Se ha excedido el tiempo de retardo de
acuse en el extremo de la conexión/tiempo
de vigilancia de la respuesta excedido tras
el telegrama de transmisión:

Compruebe si el interlocutor también indica
errores porque no se han recibido todos los
datos enviados (p. ej. debido a una rotura en
la línea de transmisión) o que haya fallos
graves, o bien un comportamiento erróneo
del interlocutor. Verifíquelo con un dispositi‐
vo de test de interfaz (FOXPG) conectado a
la línea de transmisión.
Compruebe si el interlocutor también indica
errores porque no se han recibido todos los
datos enviados (p. ej. debido a una rotura en
la línea de transmisión) o que haya fallos
graves, o bien un comportamiento erróneo
del interlocutor. Verifíquelo con un dispositi‐
vo de test de interfaz (FOXPG) conectado a
la línea de transmisión.
El dispositivo interlocutor es demasiado len‐
to o está defectuoso. Verifíquelo con un dis‐
positivo de test de interfaz (FOXPG) conec‐
tado a la línea de transmisión.

Tras deshacer la conexión con DLE ETX
no ha llegado ninguna respuesta del inter‐
locutor dentro del TRA.
0708

070B

El tiempo de espera a XON o CTS = ON ha
transcurrido.

El interlocutor falla, es demasiado lento o
está offline. Compruebe el interlocutor o mo‐
difique la parametrización en caso necesa‐
rio.

Sólo con 3964(R):

Cambie la parametrización.

Sólo para driver ASCII y driver de impre‐
sora:

El conflicto de inicialización no puede re‐
solverse, puesto que ambos interlocutores
tienen ajustada prioridad alta.
070C

Sólo con 3964(R):

Cambie la parametrización.

El conflicto de inicialización no puede re‐
solverse, puesto que ambos interlocutores
tienen ajustada prioridad baja.

7108

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

(W#16#...)
0801

Un reintento no es un error, pero puede ser
un indicio de que hay interferencias en la
línea de transmisión o de que el interlocutor
Al recibir un telegrama se ha detectado un
no funciona correctamente. Si una vez al‐
error y el CP exige mediante un acuse ne‐
canzado el número máximo de repeticiones
gativo (NAK) un reintento del interlocutor.
el telegrama no ha podido ser enviado, se
notifica un número de error que describe el
error que se produjo en primer lugar.
Sólo con 3964(R):

Esperando al primer reintento:

0802

Sólo con 3964(R):
Error al establecer la conexión:
● En posición de reposo se han recibido
uno o más caracteres (cualquiera con
la excepción de NAK o STX) o bien

Compruebe el comportamiento erróneo del
interlocutor, en caso necesario con un dis‐
positivo de comprobación de interfaz
(FOXPG) conectado a la línea de transmi‐
sión.

● Tras la recepción de un STX el
interlocutor ha enviado otros
caracteres sin esperar a recibir la
respuesta DLE.
Tras conectar la alimentación del interlo‐
cutor:
● Durante el tiempo de conexión del
interlocutor, el CP recibe un carácter
indefinido.
0805

Sólo con 3964(R):
Error lógico durante la recepción:
Tras la recepción del DLE se ha recibido
otro carácter cualquiera (salvo DLE O
ETX).

0806

Se ha excedido el tiempo de retardo de
caracteres (TRC):
● No se han recibido dos caracteres
consecutivos dentro del TRC o bien
Sólo con 3964(R):

Compruebe que el interlocutor no haya in‐
cluido el DLE por duplicado en el encabeza‐
do del telegrama o en la cadena de datos, y
que la conexión se establezca con DLE
ETX. Compruebe el comportamiento erró‐
neo del dispositivo interlocutor, en caso ne‐
cesario con un dispositivo de comprobación
de interfaz (FOXPG) conectado a la línea de
transmisión.
El dispositivo interlocutor es demasiado len‐
to o está defectuoso. Compruébelo con el
dispositivo de comprobación de interfaz
(FOXPG) conectado a la línea de transmi‐
sión.

● El 1.er carácter tras la transmisión de
DLE al establecer la conexión no se ha
recibido dentro del TRC.
0807

La recepción de un telegrama de longitud 0
Se ha recibido un telegrama de longitud 0. no es un error.
Compruebe el motivo por el que el interlo‐
cutor envía telegramas sin datos útiles.
Longitud de telegrama no válida:

Programación del PLC
Manual de programación y manejo, 11/2019

7109

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

(W#16#...)
0808

Compruebe que la conexión no tenga fuer‐
tes interferencias. De ser así, observará de
vez en cuando códigos de error. Comprue‐
be el comportamiento erróneo del interlocu‐
El valor interno del BCC no concuerda con
tor, en caso necesario con un dispositivo de
el BCC recibido por el interlocutor en el ex‐
comprobación de interfaz (FOXPG) conec‐
tremo de la conexión.
tado a la línea de transmisión.
Sólo con 3964(R):

Error en el carácter de control de bloque
BCC:

0809

Sólo con 3964(R):
El número de repeticiones debe ajustarse
igual.

080A

No hay ningún búfer de recepción libre:
Durante la recepción no se disponía de
ningún búfer de recepción vacío.

080C

Error de transmisión:
● Se ha detectado un error de
transmisión (error de paridad, error de
bit de parada, error de
desbordamiento).
Sólo con 3964(R):
● Si esto ocurre durante el modo de
transmisión o recepción, se inician
repeticiones.
● Si durante la posición de reposo se
recibe un carácter defectuoso, el error
se indica inmediatamente para facilitar
la detección precoz de fallos en la línea
de transmisión.

Parametrice en el interlocutor el mismo tiem‐
po de espera de bloque que en el CP 340.
En caso necesario, verifique el comporta‐
miento erróneo del interlocutor con un dis‐
positivo de test de interfaz (FOXPG) conec‐
tado a la línea de transmisión.
La instrucción P_RCV se debe llamar con
más frecuencia.
Las interferencias en la línea de transmisión
provocan repeticiones del telegrama redu‐
ciendo la media de datos útiles. Todo ello
aumenta el riesgo de que exista un error no
detectado. Modifique la configuración del
sistema o el tendido de cables.
Compruebe la línea de conexión de los in‐
terlocutores y asegúrese de que en ambos
interlocutres esté ajustada la misma veloci‐
dad de transmisión, la misma paridad y el
mismo número de bits de parada.

● Si están encendidos los LEDs SF (rojo)
y RxD (verde), existe una interrupción
(rotura de hilo) en el cable que conecta
ambos interlocutores.
080D

BREAK:
La línea de recepción hacia el interlocutor
está interrumpida.

0810

Sólo con drivers ASCII:
Error de paridad:
Si están encendidos el LED SF (rojo) y el
LED RxD (verde), existe una interrupción
del cable de unión (interrupción de cable)
entre ambos interlocutores.

7110

Restablezca la conexión o conecte el inter‐
locutor.
Compruebe la línea de conexión de los in‐
terlocutores y asegúrese de que en ambos
interlocutres esté ajustada la misma veloci‐
dad de transmisión, la misma paridad y el
mismo número de bits de parada.
Modifique la configuración del sistema o el
tendido de cables.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error

Descripción

Solución

Sólo con drivers ASCII:

Compruebe la línea de conexión de los in‐
terlocutores y asegúrese de que en ambos
interlocutres esté ajustada la misma veloci‐
dad de transmisión, la misma paridad y el
mismo número de bits de parada.

(W#16#...)
0811

Error de trama de caracteres:
Si están encendidos el LED SF (rojo) y el
LED RxD (verde), existe una interrupción
del cable de unión (interrupción de cable)
entre ambos interlocutores.

Modifique la configuración del sistema o el
tendido de cables.

Vuelva a parametrizar el interlocutor o pro‐
Después de que el CP enviara XOFF o pu‐ cure una lectura más rápida del CP.
siera CTS a OFF, se recibieron más carac‐
teres.

0812

Sólo con drivers ASCII:

0818

Sólo con drivers ASCII:
DSR = OFF o CTS = OFF

El interlocutor ha puesto todas las señales
DSR o CTS a "OFF" antes o durante una
transmisión.
Revise el control de las señales cualificado‐
ras RS 232C en el interlocutor.

1E0D

Cancelación de la orden por rearranque
completo, rearranque o reset

1E0E

Error estático al llamar la SFC RD_REC o
al SFB RDREC. Puede disponer del valor
de retorno RET_VAL de la SFC / el SFB en
la variable SFCERR o SFCSTATUS del
DB de instancia, para su evaluación.

Cargue la variable SFCERR o SFCSTATUS
del DB de instancia.

1E0F

Error estático al llamar la SFC WR_REC o
al SFB RDREC. Puede disponer del valor
de retorno RET_VAL de la SFC / el SFB en
la variable SFCERR o SFCSTATUS del
DB de instancia, para su evaluación.

Cargue la variable SFCERR o SFCSTATUS
del DB de instancia.

1E41

No está permitido el número de bytes indi‐ Respete el intervalo de 1 a 1024 bytes.
cado en el parámetro LEN de los FB

1E41

Observe las longitudes permitidas:
Instrucción P_PRINT:
El número de bytes indicado para la varia‐ 32 bytes para variables, 150 bytes para ca‐
ble o la cadena de formato dentro de la
dena de formato
longitud del DB de punteros no es válido.

1E43

Instrucción P_PRINT:
No existe puntero para la cadena de for‐
mato.

Indique en el DB de punteros el n.º del blo‐
que de datos y el nº de la palabra de datos
para la cadena de formato.

Nota
Sólo se envía un mensaje de error si simultáneamente está activado el bit ERROR (orden
interrumpida con errores). En otro caso, la palabra de STATUS será cero.

Programación del PLC
Manual de programación y manejo, 11/2019

7111

Instrucciones
4.2 Instrucciones

Llamar la variable SFCERR o SFCSTATUS
Obtendrá más información sobre el error producido, 14 (1E0EH) y 15 (1E0FH), de la clase de
evento 30 mediante la variable SFCERR o SFCSTATUS.
Puede cargar la variable SFCERR o SFCSTATUS sólo desde un acceso simbólico al DB
instancia de la instrucción correspondiente.
Los mensajes de error que se registran en la variable SFCERR se encuentran en las funciones
de sistema SFC 58 en "WR_REC: Escribir registro en periferia" y SFC 59 en "RD_REC: Leer
registro de periferia".
Los mensajes de error que se registran en la variable SFCSTATUS se encuentran en las
funciones de sistema SFB 52 en "RDREC: Leer registro" y SFB 53 en "WRREC: Escribir
registro".

Consulte también
RDREC: Leer registro (Página 5888)
WRREC: Escribir registro (Página 5890)
WR_REC: Escribir registro en periferia (Página 5927)
RD_REC: Leer registro de periferia (Página 5922)

Acoplamiento PtP CP 341
P_SND_RK: Enviar o recuperar
P_SND_RK
La instrucción P_SND_RK distingue los siguientes casos de aplicación:
● P_SND_RK: Enviar datos con 3964(R) o driver ASCII (Página 7112)
● P_SND_RK: Enviar datos con RK 512 (Página 7115)
● P_SND_RK: Recuperar datos con RK 512 (Página 7119)

P_SND_RK: Enviar datos con 3964(R) o driver ASCII
Descripción
La instrucción P_SND_RK transmite un conjunto de datos de un bloque de datos especificado
por los parámetros DB_NO, DBB_NO y LEN, al CP 341. La instrucción P_SND_RK se llama
para transferir datos cíclica o estáticamente (sin condiciones) en un programa controlado por
tiempo.

7112

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Funcionamiento
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
Dependiendo del volumen de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).
La instrucción P_SND_RK puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al CP 341 y la instrucción P_SND_RK
pasa al estado inicial. Los datos que ya ha recibido el CP 341 se envían al interlocutor. Si en
la entrada R hay un estado lógico estático "1", la transmisión está desactivada.
Con el parámetro LADDR se indica la dirección del CP 341 que debe llamarse.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS
también se visualizan en caso de RESET de la instrucción P_SND_RK . Si se ha producido un
error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el estado del
resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso.
Transmisión bloqueada.

LADDR

INPUT

INT

Dirección inicial del CP 341
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
N.º de DB emisor: específico de CPU,
no está permitido el cero

DBB_NO

INPUT

INT

Número del byte de datos
0 ≤ DBB_NO ≤ 8190 datos de transmi‐
sión a partir del byte de datos

LEN

INPUT

INT

Longitud de datos
1 ≤ LEN ≤ 4096, indicados en número
de bytes

DONE1

OUTPUT

BOOL

ERROR1

OUTPUT

BOOL

Petición finalizada sin errores
Parámetro STATUS == 16#00;
Petición interrumpida con errores
El parámetro STATUS (Página 7139)
contiene la información de error.

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STA‐
TUS (Página 7139) figura la informa‐
ción de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Programación del PLC
Manual de programación y manejo, 11/2019

7113

Instrucciones
4.2 Instrucciones

Nota
Los parámetros R_CPU_NO, R_TYP, R_NO, R_OFFSET, R_CF_BYT y R_CF_BIT no son
importantes para el procedimiento 3964(R) y el driver ASCII y no tienen que recibir valores. El
parámetro SF tampoco tiene que recibir valores, porque "S" está predeterminado para enviar.

Asignación en el área de datos
La instrucción P_SND_RKopera conjuntamente con un DB instancia I_SND_RK. El número del
DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0F, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS. Esta variable de error sólo puede
cargarse en el DB instancia mediante un acceso simbólico.

Cronograma
La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de las entradas REQ y R.

5(4

5

'21(

7114

/DSHWLFLµQQR
VHHMHFXWD
7UDQVPLVLµQ
GHVDFWLYDGD

)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURU

7UDQVIHULU5(6(7

3DUWHlQl6(1'

)LQVLQHUURUHV

3HWLFLµQGHWUDQVPLVLµQ

(5525

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

Regulación
Nota
La instrucción P_SND_RK no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.
Nota
Antes de que el CP 341 pueda procesar una petición iniciada después de una transición de
estado de la CPU de STOP a RUN , debe haber concluido el mecanismo de arranque CP–CPU
de la instrucción P_SND_RK . Una petición iniciada entretanto no se pierde. Se transfiere al
CP 341 una vez concluida la coordinación de arranque.

P_SND_RK: Enviar datos con RK 512
Descripción
La instrucción P_SND_RK puede transmitir datos desde un área de datos S7 a un CP 341
configurando el parámetro SF = 'S'.

Funcionamiento
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
Dependiendo del volumen de datos (LEN), la transmisión puede desarrollarse en varias
llamadas (ciclos del programa).
Con el parámetro LADDR se indica la dirección del CP 341 que debe llamarse.
La única fuente permitida para los datos a enviar es el área de los bloques de datos. La fuente
está completamente especificada si se indica el número de bloque de datos (DB_NO) y el
offset (DBB_NO) del primer byte de datos que debe enviarse de dicho bloque de datos.
Los tipos de datos (R_TYP) permitidos como áreas de destino son los bloques de datos (DB)
y los bloques de datos ampliados (DX). El destino está completamente especificado mediante
el número de CPU (R_CPU_NO sólo relevante en la comunicación multiprocesador), el tipo de
datos (R_TYP: DB o DX), el número de bloque de datos (R_NO) y el offset (R_OFFSET), en el
que debe escribirse el primer byte.
Con R_CF_BYT y R_CF_BIT se definen en la CPU del interlocutor el byte y el bit de marca de
acoplamiento.

Programación del PLC
Manual de programación y manejo, 11/2019

7115

Instrucciones
4.2 Instrucciones
La instrucción P_SND_RK puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al CP 341 y la instrucción P_SND_RK
pasa al estado inicial. Los datos que ya ha recibido el CP 341 se envían al interlocutor. Si la
entrada R tiene el estado lógico estático "1", la transmisión está desactivada.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS
también se visualizan en caso de RESET de la instrucción P_SND_RK . Si se ha producido un
error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el estado del
resultado binario es "1".

Parámetros
Parámetro

Declaración Tipo de
datos

Descripción

SF

INPUT

Selección para enviar o recuperar datos

CHAR

SF = 'S' (enviar)
Valor predeterminado: 'S'
REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se cancela la petición en curso. Transmisión bloqueada. Va‐
lor predeterminado: 0

LADDR

INPUT

INT

Dirección inicial del CP 341
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos del origen
N.º de DB emisor: específico de la CPU. No se admite el valor
0.

DBB_NO

INPUT

INT

Número del byte de datos del origen
0 ≤ DBB_NO ≤ 8190 datos de transmisión a partir del byte de
datos

LEN

INPUT

INT

Longitud de datos del telegrama que debe enviarse
1 ≤ LEN ≤ 4096, indicación en número de bytes, sólo se
recomiendan valores pares

R_CPU_NO

INPUT

INT

N.º de la CPU del interlocutor
0 ≤ R_CPU_NO ≤ 4, sólo en modo multiprocesador, valor
predeterminado: 1

R_TYP

INPUT

CHAR

Tipo de dirección en la CPU del interlocutor
'D': Bloque de datos
'X': bloque de datos ampliado

R_NO

INPUT

INT

Número de bloque de datos en la CPU del interlocutor
0 ≤ R_NO ≤ 255

R_OFFSET

INPUT

INT

Número de byte de datos en la CPU del interlocutor
0 ≤ R_OFFSET ≤ 510,sólo valores pares

7116

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de
datos

Descripción

R_CF_BYT

INPUT

Byte de marca de acoplamiento en la CPU del interlocutor

INT

0 ≤ R_CF_BYTE ≤ 255
Valor predeterminado: 255 (significa: sin marca de acopla‐
miento)
R_CF_BIT

INPUT

INT

Bit de marca de acoplamiento en la CPU del interlocutor
0 ≤ R_CF_BIT ≤ 7

DONE

OUTPUT

1

BOOL

La petición ha finalizado sin errores
Parámetro STATUS == 16#00;

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7139) contiene la informa‐
ción de error.

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS (Página 7139)
figura la información de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Información del encabezado del telegrama
En la siguiente tabla encontrará las indicaciones que figuran en el encabezado del telegrama
RK 512.
Tabla 4-408 Información del encabezado del telegrama RK 512 para la petición "Enviar datos"
Origen en el sistema de
automatización S7 (CPU
local)

Para el destino,
CPU del interlo‐
cutor

Encabezado del telegrama, bytes

3/4 tipo de
comando

5/6
DBNR D/Offset D

7/8
Número en

Bloque de datos

Bloque de datos

AD

DB/DW

Palabras

Bloque de datos

Bloque de datos
ampliado

AD

DB/DW

Palabras

Z-DBNR: Número del bloque de datos de destino
Z-Offset: Dirección inicial del destino
DW: Offset en palabras

Asignación en el área de datos
La instrucción P_SND_RK opera conjuntamente con un DB instancia I_SND_RK. El número
del DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.

Programación del PLC
Manual de programación y manejo, 11/2019

7117

Instrucciones
4.2 Instrucciones

Particularidades al enviar datos
Observe las siguientes particularidades al "Enviar datos":
● Con el protocolo RK 512 sólo es posible enviar un número par de datos. Por esta razón, si
especifica una longitud (LEN) impar de datos, al final de los datos se transmite un byte de
relleno adicional con el valor "0".
● Con el protocolo RK 512 sólo puede indicarse un offset par. Por esta razón, si se especifica
un offset impar, se depositan los datos a partir del siguiente Offset par inmediatamente
inferior del interlocutor.
Ejemplo: offset es 7; se depositan los datos a partir del byte 6.

Cronograma
La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de las entradas REQ y R.

5(4

5

'21(

/DSHWLFLµQQR
VHHMHFXWD
7UDQVPLVLµQ
GHVDFWLYDGD

)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURU

7UDQVIHULU5(6(7

3DUWHlQl6(1'

)LQVLQHUURUHV

3HWLFLµQGHWUDQVPLVLµQ

(5525

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

7118

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Regulación
Nota
La instrucción P_SND_RK no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.

P_SND_RK: Recuperar datos con RK 512
Descripción
La instrucción P_SND_RK recupera datos de un interlocutor remoto configurando el parámetro
SF = F y los deposita en un área de datos S7 del sistema de automatización.
Nota
Si se recuperan los datos de un CP 341, hay que programar siempre en el CP 341 una
instrucción P_RCV_RK.

Funcionamiento
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
Dependiendo del volumen de datos (LEN), la transmisión puede desarrollarse en varias
llamadas (ciclos del programa).
Con el parámetro LADDR se indica la dirección del CP 341 que debe llamarse.
Indicando el número de CPU (R_CPU_NO, sólo relevante en la comunicación
multiprocesador) se especifica el interlocutor del que se recuperan los datos. Las fuentes
permitidas para recuperar los datos son los siguientes tipos de datos (R_TYP): bloques de
datos, bloques de datos ampliados, marcas, entradas, salidas, contadores y temporizadores.
La fuente está completamente especificada indicando el tipo de datos (R_TYP), el número de
bloque de datos (R_NO, sólo relevante en bloques de datos y bloques de datos ampliados) y
el offset (R_OFFSET) del primer byte de datos que debe enviarse de dicha área.
Con R_CF_BYT y R_CF_BIT se definen en la CPU del interlocutor el byte y el bit de marca de
acoplamiento.
Las únicas áreas de destino permitidas son los bloques de datos (DB). La fuente está
completamente especificada si se indica el número de bloque de datos (DB_NO) y el offset
(DBB_NO) en el que debe escribirse el primer byte de datos.
La instrucción P_SND_RK puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia del CP 341 y la instrucción
P_SND_RK pasa al estado inicial. Si la entrada R tiene el estado lógico estático "1", la
recuperación está desactivada.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS

Programación del PLC
Manual de programación y manejo, 11/2019

7119

Instrucciones
4.2 Instrucciones
también se visualizan en caso de RESET de la instrucción P_SND_RK . Si se ha producido un
error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el estado del
resultado binario es "1".

Parámetros
Parámetro

Declaración Tipo de
datos

Descripción

SF

INPUT

Selección para enviar o recuperar datos

CHAR

SF = 'F' (Fetch = recoger), valor por defecto: 'S' (enviar)
REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se cancela la petición en curso. Bloqueo de recogida. Va‐
lor por defecto: 0

LADDR

INPUT

INT

Dirección inicial del CP 341
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos del destino
N.º de DB emisor: específico de la CPU. No se admite el
valor 0.

DBB_NO

INPUT

INT

Número del byte de datos del destino
0 ≤ DBB_NO ≤ 8190 datos de transmisión a partir del byte
de datos

LEN

INPUT

INT

Longitud de datos del telegrama que debe recogerse
1 ≤ LEN ≤ 4096, indicación en número de bytes1

R_CPU_NO

INPUT

INT

N.º de la CPU del interlocutor
0 ≤ R_CPU_NO ≤ 4, sólo en modo multiprocesador, valor
predeterminado: 1

R_TYP

INPUT

CHAR

Tipo de dirección en la CPU del interlocutor
'D': bloque de datos
'X': bloque de datos ampliado
'M': marcas
'I': entradas
'Q': salidas
'C': contadores
'T': temporizadores

R_NO

INPUT

INT

Número de bloque de datos en la CPU del interlocutor
0 ≤ R_NO ≤ 255

R_OFFSET

INPUT

INT

Número de byte de datos en la CPU del interlocutor

R_CF_BYT

INPUT

INT

Byte de marca de acoplamiento en la CPU del interlocutor
0 ≤ CF_BYTE ≤ 255
valor por defecto: 255 (significa: sin marca de acoplamien‐
to)

R_CF_BIT

INPUT

INT

Bit de marca de acoplamiento en la CPU del interlocutor
0 ≤ CF_BIT ≤ 7

DONE

1

OUTPUT

BOOL

La petición ha finalizado sin errores
Parámetro STATUS == 16#00;

7120

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de
datos

Descripción

ERROR1

OUTPUT

Petición interrumpida con errores

BOOL

El parámetro STATUS (Página 7139) contiene la informa‐
ción de error.
STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS (Página 7139)
figura la información de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Parámetros R_TYP, R_NO y R_OFFSET
Origen en la CPU
del interlocutor

R_TYP

R_NO

R_OFFSET (en bytes)

Bloque de datos

'D'

0 - 255

0 - 510

Bloque de datos
ampliado

'X'

0 - 255

0 - 510

Marcas

'M'

Irrelevante

0 - 255

Entradas

'I'

Irrelevante

0 - 255

Salidas

'Q'

Irrelevante

0 - 255

Contadores

'C'

Irrelevante

0 - 255

Temporizadores

'T'

Irrelevante

0 - 255

(Este valor está predeterminado por la CPU del interlo‐
cutor.)
(sólo se recomiendan valores pares)
(sólo se recomiendan valores pares)

Información del encabezado del telegrama
En la siguiente tabla encontrará las indicaciones que figuran en el encabezado del telegrama
RK 512.
Origen en la CPU
del interlocutor

Para el destino de su siste‐
ma de automatización S7
(CPU local)

3/4 tipo de
comando

Encabezado del telegrama, bytes

Bloque de datos

Bloque de datos

ED

DB/DW

Palabras

Bloque de datos
ampliado

Bloque de datos

EX

DB/DW

Palabras

Marcas

Bloque de datos

EM

Dirección de byte

Bytes

Entradas

Bloque de datos

EI

Dirección de byte

Bytes

Salidas

Bloque de datos

EQ

Dirección de byte

Bytes

Contadores

Bloque de datos

EC

Número del conta‐
dor

Palabras

Temporizadores

Bloque de datos

ET

Número del tempo‐
rizador

Palabras

5/6
DBNR F/Offset F

7/8
Número en

Q-DBNR: Número de bloque de datos fuente
Q-Offset: Dirección inicial de la fuente

Programación del PLC
Manual de programación y manejo, 11/2019

7121

Instrucciones
4.2 Instrucciones

Asignación en el área de datos
La instrucción P_SND_RK opera conjuntamente con un DB instancia I_SND_RK. El número
del DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.

Particularidades de los bloques de datos (ampliados)
Al "Recoger datos" de bloques de datos y de bloques de datos ampliados, observe las
siguientes particularidades:
● Con el protocolo RK 512 sólo es posible recoger un número par de datos. Si se ha
especificado como longitud (LEN) un número impar, se transmite siempre un byte más. Sin
embargo, en el DB de destino se registra el número correcto de datos.
● Con RK 512 sólo es posible indicar un offset par. Por esta razón, si se especifica un offset
impar, se recogen los datos del siguiente offset par inmediatamente inferior del interlocutor.
Ejemplo: Offset es 7; se recogen los datos a partir del byte 6.

Particularidades de temporizadores y contadores
Si recoge temporizadores o contadores del interlocutor, debe tener en cuenta que para cada
temporizador o contador se recogen 2 bytes. Si, p. ej., desea recoger 10 contadores, debe
indicar la longitud 20.

Cronograma
La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de las entradas REQ y R.

5(4

5

'21(

7122

/DSHWLFLµQQR
VHHMHFXWD
7UDQVPLVLµQ
GHVDFWLYDGD

)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURU

7UDQVIHULU5(6(7

3DUWHlQl6(1'

)LQVLQHUURUHV

3HWLFLµQGHWUDQVPLVLµQ

(5525

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

Regulación
Nota
La instrucción P_SND_RK no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.

P_RCV_RK: Recibir datos o preparar datos
P_RCV_RK
La instrucción P_RCV_RK distingue los siguientes casos de aplicación:
● P_RCV_RK: Recibir datos con 3964(R) o driver ASCII (Página 7123)
● P_RCV_RK: Recibir datos con RK 512 (Página 7126)
● P_RCV_RK: Preparar datos con RK 512 (Página 7130)

P_RCV_RK: Recibir datos con 3964(R) o driver ASCII
Descripción
La instrucción P_RCV_RK transmite datos del CP 341 a un área de datos S7, especificada por
los parámetros DB_NO, DBB_NO y LEN. La instrucción P_RCV_RK se llama para transferir
datos cíclica o estáticamente (sin condiciones) en un programa controlado por tiempo.

Funcionamiento
Con el estado lógico (estático) "1" en el parámetro EN_R se habilita la comprobación de si
pueden leerse datos del CP 341 . Es posible cancelar una transmisión en curso con un estado
lógico "0" en el parámetro EN_R . (Puesto que puede suceder esporádicamente que tras
ajustar el parámetro EN_R a "1" la transferencia ya no se inicie, para cancelar una
transferencia en curso, debe ajustar el parámetro R a "1" en paralelo al ajuste del parámetro
EN_R a "0".) La petición de recepción cancelada finaliza con un mensaje de error (salida
STATUS). La recepción está desactivada mientras el parámetro EN_R tenga el estado lógico
"0". Dependiendo del volumen de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).

Programación del PLC
Manual de programación y manejo, 11/2019

7123

Instrucciones
4.2 Instrucciones
Si la instrucción detecta el estado lógico "1" en el parámetro R, se cancela la petición actual de
transmisión y la instrucción P_RCV_RK pasa al estado inicial. La recepción está desactivada
mientras el parámetro R tenga el estado lógico "1".
Con el parámetro LADDR se selecciona el CP 341 que se llamará.
La salida NDR indica "Petición finalizada sin errores/Datos aceptados" (leídos todos los datos).
ERROR indica que se ha producido un error. En caso de producirse un error, el número de
evento correspondiente se indica en STATUS . Si no se producen errores, STATUS asume el
valor 0. NDR y ERROR/STATUS también se visualizan en caso de RESET de la instrucción
P_RCV_RK (parámetro LEN == 16#00). Si se ha producido un error, se desactiva el resultado
binario RB. Si el bloque finaliza sin errores, el estado del resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

EN_R

INPUT

BOOL

Habilitar lectura de datos

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Blo‐
queo de recepción.

LADDR

INPUT

INT

Dirección inicial del CP 341
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
N.º del DB de recepción:
específico de la CPU, no se admite el
valor cero

DBB_NO

INPUT

INT

Número del byte de datos
0 ≤ DBB_NO ≤ 8190 datos de recep‐
ción a partir del byte de datos

NDR 1

OUTPUT

BOOL

Petición finalizada sin errores, datos
aceptados
Parámetro STATUS == 16#00;

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7139)
contiene la información de error.

LEN 1

OUTPUT

INT

Longitud del telegrama recibido
1 ≤ LEN ≤ 4096, indicados en número
de bytes

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STA‐
TUS (Página 7139) figura la informa‐
ción de error.

1

7124

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
Los parámetros L_TYP, L_NO, L_OFFSET, L_CF_BYT y L_CF_BIT no son importantes para
el procedimiento 3964(R) y el driver ASCII y no tienen que recibir valores.

Asignación en el área de datos
La instrucción P_RCV_RK opera conjuntamente con un DB instancia I_RCV_RK. El número
del DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0E, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS. Esta variable de error sólo puede
cargarse en el DB instancia mediante un acceso simbólico.

Cronograma
La siguiente figura muestra el comportamiento de los parámetros NDR, LEN y ERROR en
función de la conexión de la entrada EN_R y R.

(1B5

5

1'5

Programación del PLC
Manual de programación y manejo, 11/2019

)LQFRQHUURU

5HFHSFLµQHQFXUVR

5(6(7
)LQVLQHUURUHV

6LQUHFHSFLµQ

)LQFRQHUURU

5HFHSFLµQHQFXUVR

)LQVLQHUURUHV

+DELOLWDUUHFHSFLµQ

/(1
ORQJLWXG

5HFHSFLµQGHVFRQHFWDGD

(5525

7125

Instrucciones
4.2 Instrucciones

Nota
La entrada EN_R debe ponerse estáticamente a "1". Mientras dure toda la petición de
recepción, el parámetro EN_R debe recibir el RLO "1" (resultado lógico).

Regulación
Nota
La instrucción P_RCV_RK no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP .
Nota
Antes de que el CP 341 pueda recibir una petición después de una transición de estado de la
CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CP–CPU de la
instrucción P_RCV_RK .

P_RCV_RK: Recibir datos con RK 512
Descripción
La instrucción P_RCV_RK transmite datos del CP 341 a un área de datos S7. La instrucción
P_RCV_RK se llama para transferir datos cíclica o estáticamente (sin condiciones) en un
programa controlado por tiempo.

Funcionamiento
Con el estado lógico (estático) "1" en el parámetro EN_R se habilita la comprobación de si
pueden leerse datos del CP 341 . Es posible cancelar una transmisión en curso con el estado
lógico "0" en el parámetro EN_R . La petición de recepción cancelada finaliza con un mensaje
de error (salida STATUS). La recepción está desactivada mientras exista el estado lógico "0"
en el parámetro EN_R . Dependiendo de la cantidad de datos, la transmisión puede
desarrollarse en varias llamadas (ciclos del programa).
Con el parámetro LADDR se indica la dirección del CP 341 que debe llamarse.
Si el interlocutor indica como destino de datos "DB", los datos se depositan en el área de datos
especificada en el encabezado del telegrama RK 512. Con ayuda de los parámetros (L_...) se
indica al usuario el tipo del área de destino (L_TYP), el número de bloque de datos de destino
(L_NO, sólo relevante si L_TYP = DB), el offset del área de destino (L_OFFSET) y la longitud
(LEN) de los datos transmitidos. Si el interlocutor indica el destino de datos "DX", los datos se
depositan en el bloque de datos (DB) especificado por los parámetros DB_NO y DBB_NO .

7126

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Si la instrucción detecta el estado lógico "1" en el parámetro R, se cancela la petición actual de
transmisión y la instrucción P_RCV_RK pasa al estado inicial. La recepción estará desactivada
mientras el parámetro R tenga el estado lógico "1".
La salida NDR indica "Petición finalizada sin errores/Datos aceptados" (leídos todos los datos).
A continuación, en los parámetros L_TYP, L_NO y L_OFFSET se indica dónde se van a
depositar los datos de un mismo ciclo. Además, para un mismo ciclo se indican los parámetros
L_CF_BYT y L_CF_BIT y la longitud LEN de la petición correspondiente.

Utilización de las marcas de acoplamiento
Antes de recibir los datos se comprueba la marca de acoplamiento indicada en el encabezado
del telegrama RK 512. Los datos sólo se envían si la marca de acoplamiento tiene el valor "0".
Una vez concluido el proceso de transmisión, la instrucción pone la marca de acoplamiento al
valor "1", y en la instrucción se visualiza la marca de acoplamiento para un ciclo (NDR).
Evaluando la marca de acoplamiento en el programa de usuario puede detectarse que los
datos transmitidos pueden procesarse. En cuanto han sido procesados los datos, el usuario
debe poner nuevamente a "0" la marca de acoplamiento. Es posible una nueva petición SEND
del interlocutor.

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

EN_R

INPUT

BOOL

Habilitación para recibir datos

R

INPUT

BOOL

Interrupción de la petición
Se cancela la petición en curso. Recep‐
ción bloqueada. Valor predeterminado: 0

LADDR

INPUT

INT

DB_NO

INPUT

INT

Dirección base del CP 341
La dirección inicial se toma de STEP 7.
Número del bloque de datos de recepción
(destino)
N.º DB de recepción: específico de la
CPU. No se permite el valor 0.
(sólo relevante si el destino de datos es
DX)

DBB_NO

INPUT

INT

Número de byte de los datos de recepción
(destino)
0 ≤ DBB_NO ≤ 8190 datos de recepción a
partir del byte de datos
(sólo relevante si el destino de datos es
DX)

L_TYP1

OUTPUT

CHAR

Tipo de área en la CPU local (destino)
'D': Bloque de datos

L_NO

1

OUTPUT

INT

Número de bloque de datos en la CPU
local (destino)
0 ≤ L_NO ≤ 255

Programación del PLC
Manual de programación y manejo, 11/2019

7127

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

L_OFFSET1

OUTPUT

INT

Número de byte de datos en la CPU local
(destino)

L_CF_BYT1

OUTPUT

INT

Byte de marcas de acoplamiento en la
CPU local

0 ≤ L_OFFSET ≤ 510

0 ≤ L_CF_BYTE ≤ 255255 significa: sin
marca de acoplamiento
L_CF_BIT 1

OUTPUT

INT

Bit de marca de acoplamiento en la CPU
local
0 ≤ L_CF_BIT ≤ 7

NDR

OUTPUT

1

BOOL

La petición ha finalizado sin errores, datos
transferidos
Parámetro STATUS == 16#00;

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7139) con‐
tiene la información de error.

LEN1

OUTPUT

INT

Longitud del telegrama recibido
0 ≤ LEN ≤ 4096, indicación en número de
bytes

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7139) figura la información de
error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción P_RCV_RK opera conjuntamente con un DB instancia I_RCV_RK. El número
del DB se indica con la llamada. No está permitido acceder a los datos en el DB de instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0E, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS. Esta variable de error sólo puede
cargarse en el DB de instancia mediante un acceso simbólico.

7128

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Cronograma de ejecución
La siguiente figura muestra el comportamiento de los parámetros NDR, LEN y ERROR en
función de la conexión de las entradas EN_R y R.

(1B5

5

1'5

)LQFRQHUURU

5HFHSFLµQHQFXUVR

5(6(7
)LQVLQHUURUHV

6LQUHFHSFLµQ

)LQFRQHUURU

5HFHSFLµQHQFXUVR

)LQVLQHUURUHV

+DELOLWDUUHFHSFLµQ

/(1
ORQJLWXG

5HFHSFLµQGHVFRQHFWDGD

(5525

Nota
La entrada EN_R debe ponerse estáticamente a "1". Mientras dure toda la petición de
recepción, el parámetro EN_R debe recibir el RLO "1" (resultado lógico).

Comportamiento en caso de error
ERROR indica que se ha producido un error. En caso de producirse un error, el número de
evento correspondiente se indica en STATUS . Si no se producen errores, STATUS asume el
valor 0. NDR y ERROR/STATUS también se indican en caso de RESET de la instrucción
P_RCV_RK (parámetro LEN == 16#00). Si se ha producido un error, se desactiva el resultado
binario RB. Si se termina el bloque sin errores, el estado del resultado binario es "1".

Regulación
Nota
La instrucción P_RCV_RK no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP .

Programación del PLC
Manual de programación y manejo, 11/2019

7129

Instrucciones
4.2 Instrucciones

P_RCV_RK: Preparar datos con RK 512
Descripción
Es necesario llamar la instrucción P_RCV_RK cuando el interlocutor ejecuta una petición
"Recuperar datos" (petición FETCH).
La instrucción P_RCV_RK prepara datos procedentes de un área de datos S7 para el CP 341 .
La instrucción P_RCV_RK se llama para transferir datos cíclica o estáticamente (sin
condiciones) en un programa controlado por tiempo.

Funcionamiento
Con el estado lógico (estático) "1" en el parámetro EN_R se habilita la comprobación de si
pueden prepararse datos en el CP 341 . Es posible cancelar una transmisión en curso con el
estado lógico "0" en el parámetro EN_R . La petición de recepción cancelada finaliza con un
mensaje de error (salida STATUS). La petición está desactivada mientras exista el estado
lógico "0" en el parámetro EN_R . Dependiendo del volumen de datos, la transmisión puede
desarrollarse en varias llamadas (ciclos del programa).
El tipo del área de origen (L_TYP), el número de bloque de datos de origen (L_NO, sólo
relevante si L_TYP = DB), el offset en el área de origen (L_OFFSET) así como la longitud
(LEN) de los datos que deben prepararse se determinan a partir del primer telegrama RK 512.
La instrucción evalúa la información de ese telegrama y transmite los datos solicitados al
CP 341. Los parámetros DB_NO y DBB_NO no son importantes para la instrucción
P_RCV_RK .
Con el parámetro LADDR se indica la dirección del CP 341 que debe llamarse.
Si la instrucción detecta el estado lógico "1" en el parámetro R, se cancela la petición actual de
transmisión y la instrucción P_RCV_RK pasa al estado inicial. La petición está desactivada
mientras exista el estado de señal "1" en el parámetro R.
La salida NDR indica "Petición finalizada sin errores/Datos aceptados" (leídos todos los datos).
A continuación, en los parámetros L_TYP, L_NO y L_OFFSET se indica desde dónde se han
recuperado los datos dentro de un mismo ciclo (posibles tipos de datos: bloques de datos,
bytes de entrada, bytes de salida, temporizadores y contadores). Además, para un mismo ciclo
se indican los parámetros L_CF_BYT y L_CF_BIT y la longitud LEN de la petición
correspondiente.
Nota
Si el interlocutor recupera temporizadores o contadores del CP 341 , la longitud máxima está
limitada a 32 bytes (16 temporizadores o contadores, cada uno de 2 bytes).

7130

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Utilización de las marcas de acoplamiento
Una vez recibido el telegrama se comprueban las marcas de acoplamiento indicadas en el
encabezado del telegrama RK 512. Los datos sólo se proporcionan si la marca de
acoplamiento tiene el valor "0". Una vez concluido el proceso de transmisión, la instrucción
pone la marca de acoplamiento al valor "1", y en la instrucción se visualiza la marca de
acoplamiento para un ciclo (NDR).
Evaluando la marca de acoplamiento en el programa de usuario puede detectarse que puede
accederse nuevamente a los datos proporcionados. En cuanto han sido procesados los datos,
el usuario debe poner nuevamente a "0" la marca de acoplamiento. Es posible una nueva
petición FETCH del interlocutor.

Parámetros
Parámetro

Declaración Tipo de
datos

Descripción

EN_R

INPUT

BOOL

Habilitación para preparar datos

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Preparación bloquea‐
da. Valor por defecto: 0

LADDR

INPUT

INT

Dirección inicial del CP 341

DB_NO

INPUT

INT

Irrelevante

DBB_NO

INPUT

INT

irrelevante

L_TYP

OUTPUT

CHAR

Tipo de área en la CPU local (origen)

La dirección base se toma de STEP 7.

1

'D': Bloque de datos
'M': marcas
'I': entradas
'Q': salidas
'C': contadores
'T': Temporizadores
L_NO1

OUTPUT

INT

Número del bloque de datos en la CPU local (origen)
0 ≤ L_NO ≤ 255 (sólo relevante si L_TYP = D)

L_OFFSET

1

OUTPUT

INT

Número del byte de datos en la CPU local (origen)
0 ≤ L_OFFSET ≤ 510 (en función del tipo de área)

L_CF_BYT

1

OUTPUT

INT

Byte de marca de acoplamiento en la CPU local
0 ≤ CF_BYTE ≤ 255
255 significa: sin marca de acoplamiento

L_CF_BIT1

OUTPUT

INT

Bit de marca de acoplamiento en la CPU local

NDR1

OUTPUT

BOOL

La petición ha finalizado sin errores, datos transferidos

ERROR1

OUTPUT

BOOL

Petición interrumpida con errores

0 ≤ CF_BIT ≤ 7
Parámetro STATUS == 16#00;
El parámetro STATUS (Página 7139) contiene la informa‐
ción de error.
LEN1

OUTPUT

INT

Longitud del telegrama recibido
0 ≤ LEN ≤ 4096, indicados en número de bytes

Programación del PLC
Manual de programación y manejo, 11/2019

7131

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de
datos

Descripción

STATUS1

OUTPUT

Especificación del error

WORD

Si ERROR == 1, en el parámetro STATUS (Página 7139)
figura la información de error.
1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción P_RCV_RK opera conjuntamente con un DB instancia I_RCV_RK. El número
del DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0E, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS.

Cronograma
La siguiente figura muestra el comportamiento de los parámetros NDR, LEN y ERROR en
función de la conexión de las entradas EN_Ry R.

(1B5

5

1'5

7132

)LQFRQHUURU

5HFHSFLµQHQFXUVR

5(6(7
)LQVLQHUURUHV

6LQUHFHSFLµQ

)LQFRQHUURU

5HFHSFLµQHQFXUVR

)LQVLQHUURUHV

+DELOLWDUUHFHSFLµQ

/(1
ORQJLWXG

5HFHSFLµQGHVFRQHFWDGD

(5525

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
La entrada EN_R debe ponerse estáticamente a "1". Mientras dure toda la petición de
recepción, el parámetro EN_R debe recibir el RLO "1" (resultado lógico).

Comportamiento en caso de error
ERROR indica que se ha producido un error. En caso de producirse un error, el número de
evento correspondiente se indica en STATUS. Si no se producen errores, STATUS asume el
valor 0. NDR y ERROR/STATUS también se visualizan en caso de RESET de la instrucción
P_RCV_RK (parámetro LEN == 16#00). Si se ha producido un error, se desactiva el resultado
binario RB. Si el bloque finaliza sin errores, el estado del resultado binario es "1".

Regulación
Nota
La instrucción P_RCV_RK no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.

P_PRT341: Imprimir un texto de aviso con hasta cuatro variables
Descripción
Para imprimir textos de aviso se dispone de la instrucción P_PRT341 . La instrucción
P_PRT341 transmite, por ejemplo, un aviso de proceso al CP 341. El CP 341 registra el aviso
de proceso en la impresora conectada.

Funcionamiento
La instrucción P_PRT341 transmite al CP 341 un texto de aviso que contiene hasta cuatro
variables. La instrucción P_PRT341 se llama para transferir datos cíclica o estáticamente (sin
condiciones) en un programa controlado por tiempo.
A través de los parámetros DB_NO y DBB_NO se accede a los punteros (puntero hacia
bloques de datos) para la cadena de formato y las cuatro variables. Los punteros deben estar
depositados sin huecos y en un orden determinado en el bloque de datos parametrizado (DB
de punteros) (véase la figura "DB de punteros").
La transmisión del texto de aviso se dispara con un flanco ascendente en la entrada REQ.
Primero se transfiere la cadena de formato del texto de aviso. Después se transfieren las
variables 1 a 4.
Dependiendo de la cantidad de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).

Programación del PLC
Manual de programación y manejo, 11/2019

7133

Instrucciones
4.2 Instrucciones
La instrucción P_PRT341 puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al CP 341 y la instrucción P_PRT341
pasa al estado inicial. Los datos que ya ha recibido el CP 341 se envían al interlocutor. Si en
la entrada R está activado el estado lógico estático "1", significa que la transmisión de trabajos
de impresión está desactivada.
En el parámetro LADDR se indica la dirección del CP 341 que se va a llamar.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS
también se visualizan en caso de RESET de la instrucción P_PRT341 . Si se ha producido un
error, se desactiva el resultado binario RB. Si se termina el bloque sin errores, el estado del
resultado binario es "1".

Parámetro
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición en flanco positivo

R

INPUT

BOOL

Interrupción de la petición
Se cancela la petición en curso. Impre‐
sión bloqueada.

LADDR

INPUT

INT

Dirección base del CP 341
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
Puntero hacia DB de punteros:
específico de la CPU. No se permite el
valor 0
(Los punteros en variable y cadena de
formato están guardados en el DB de
punteros en un orden fijo).

DBB_NO

INPUT

INT

Número del byte de datos
0 ≤ DBB_NO ≤ 8162, puntero a partir
del byte de datos

DONE1

OUTPUT

BOOL

ERROR1

OUTPUT

BOOL

Petición terminada sin errores
Parámetro STATUS == 16#00;
Petición interrumpida con errores
El parámetro STATUS (Página 7139)
contiene la información de error.

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STA‐
TUS (Página 7139) figura la informa‐
ción de error.

1

7134

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ocupación en el área de datos, DB de instancia
La instrucción P_PRT341 opera conjuntamente con un DB instancia I_PRINT. El número del
DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, STATUS == W#16#1E0F, encontrará una indicación más precisa
sobre el error en la variable SFCERR o SFCSTATUS.

Ocupación en el área de datos - DB de punteros
La instrucción P_PRT341 accede, a través de los parámetros DB_NO y DBB_NO, a un DB de
punteros en el que están depositados en un orden fijo los punteros hacia los bloques de datos
con los textos de aviso y las variables. El DB de punteros debe crearlo el usuario.
La figura muestra la estructura del DB de punteros, al que se accede con los parámetros
DB_NO y DBB_NO de la instrucción P_PRT341 .

'%:Q

1¼PHUR'%

'%:Q

1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q
'%:Q

1¼PHUR'%
1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q
'%:Q

1¼PHUR'%
1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q

1¼PHUR'%

'%:Q

1¼PHUR'%%

'%:Q

/RQJLWXG

'%:Q
'%:Q

1¼PHUR'%

'%:Q

/RQJLWXG

1¼PHUR'%%

3XQWHURDlYDULDEOH

3XQWHURDlYDULDEOH

3XQWHURDlYDULDEOH

3XQWHURDlYDULDEOH

3XQWHURDVWULQJGHIRUPDWR

Número de DB permitido
Los números de DB permitidos son específicos de cada CPU. Si con "Puntero en variable" se
indica como número de DB el valor 16#00, dicha variable se interpreta como inexistente, y el
puntero se coloca en la siguiente variable o en la cadena de formato.
Si con "Puntero hacia cadena de formato" el número de DB es igual al valor 16#00, se
interrumpe el trabajo de impresión y se indica el número de evento 16#1E43 en la salida del
parámetro STATUS de la instrucción P_PRT341 .

Programación del PLC
Manual de programación y manejo, 11/2019

7135

Instrucciones
4.2 Instrucciones

Número de DBB permitido
A partir del número de DBB parametrizado figura la variable o la cadena de formato. La máxima
longitud permitida de las variables es 32 bytes, y de la cadena de formato 150 bytes.
Si se sobrepasa la longitud máxima, se interrumpe el trabajo de impresión y se indica el
número de evento 16#1E41 en la salida del parámetro STATUS de la instrucción P_PRT341 .

Longitud permitida
La información sobre la longitud en el DB de punteros debe adaptarse para cada modo de
representación (tipos de datos) y en función de la precisión utilizada.

Cronograma

/DSHWLFLµQ35,17
QRVHHMHFXWD
(QYLDUHVW£
GHVFRQHFWDGR

)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURU

7UDQVIHULU5(6(7

lHQ«VLPDSDUWH35,17

)LQVLQHUURUHV

(QYLDUSHWLFLµQ

La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de las entradas REQ y R.

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. No tiene que estar durante toda la transmisión en el estado lógico "1".

7136

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Regulación
Nota
La instrucción P_PRT341 no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.
Nota
Antes de que el CP 341 pueda procesar una petición iniciada después de una transición de
estado de la CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CP–CPU
de la instrucción P_PRT341 . Una petición iniciada entretanto no se pierde. Se transfiere al CP
341 una vez concluida la coordinación de arranque.

V24_STAT_340 / V24_STAT: Leer señales cualificadoras en la interfaz RS232C
Descripción
La instrucción V24_STAT_340 (CP 340) / V24_STAT (CP 341) lee del CP 34x las señales
cualificadoras RS 232C y las pone a disposición del usuario en los parámetros del bloque. La
instrucción V24_STAT_340 / V24_STAT se llama cíclica o estáticamente (sin condiciones) en
un programa controlado por tiempo.
Las señales cualificadoras RS 232C se actualizan cada vez que se llama la instrucción
(sondeo cíclico). El CP 34x actualiza el estado de las entradas/salidas en un tiempo de 20 ms.
Con independencia de ello, las entradas/salidas se actualizan continuamente.
El resultado binario RB permanece igual. La instrucción no emite mensajes de error.
Con el parámetro LADDR se selecciona el CP 34x que se llamará.

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

LADDR

INPUT

INT

Dirección inicial del CP 34x
La dirección inicial se toma de STEP 7.

DTR_OUT

OUTPUT

BOOL

Data terminal ready,
CP 34x operativo
(salida del CP 34x)

DSR_IN

OUTPUT

BOOL

Data set ready,
interlocutor operativo
(entrada del CP 34x)

RTS_OUT

OUTPUT

BOOL

Request to send,
CP 34x listo para transmitir
(salida del CP 34x)

Programación del PLC
Manual de programación y manejo, 11/2019

7137

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

CTS_IN

OUTPUT

BOOL

Clear to send,
el interlocutor puede recibir datos del CP 34x
(respuesta a RTS = ON del CP 34x)
(entrada del CP 34x)

DCD_IN

OUTPUT

BOOL

Data Carrier detect,
nivel de señal de recepción
(entrada del CP 34x)

RI_IN

OUTPUT

BOOL

Ring Indicator,
indicador de llamada
(entrada del CP 34x)

Asignación en el área de datos
La instrucción V24_STAT_340 / V24_STAT no ocupa áreas de datos.

Regulación
Nota
Para detectar un cambio de señal se requiere una duración de impulso mínima. Las
magnitudes decisivas son el tiempo de ciclo de la CPU, el tiempo de actualización en la CP 34x
y el tiempo de reacción del interlocutor.

V24_SET_340 / V24_SET: Escribir señales cualificadoras en la interfaz RS232C
Descripción
El usuario puede activar o desactivar las correspondientes salidas de la interfaz a través de las
entradas de parámetros de la instrucción V24_SET_340 (CP 340) / V24_SET (CP 341). La
instrucción V24_SET_340 / V24_SET se llama cíclica o estáticamente (sin condiciones) en un
programa controlado por tiempo.
El resultado binario RB permanece igual. La instrucción no emite mensajes de error.
Con el parámetro LADDR se selecciona el CP 34x que se llamará.

7138

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

LADDR

INPUT

INT

Dirección inicial del CP 34x

RTS

INPUT

BOOL

Request to send,

La dirección inicial se toma de STEP 7.
CP 34x listo para transmitir
(controlar la salida del CP 34x)
DTR

INPUT

BOOL

Data terminal ready,
CP 34x operativo
(controlar la salida del CP 34x)

Asignación en el área de datos
La instrucción V24_SET_340 / V24_SETno ocupa áreas de datos.

Parámetro STATUS
Clases de eventos
Clase de evento Significado
0

Arranque del CP

1

Error de hardware en el CP

2

Error al inicializar

3

Error al parametrizar las instrucciones

4

Error detectado por el CP en la comunicación CP - CPU

5

Error al procesar una orden de la CPU

6

Error al procesar una orden del interlocutor (sólo con RK 512)

7

Error de transmisión

8

Error de recepción

9

Se recibió telegrama de respuesta erróneo o telegrama de error del interlocutor
acoplado

10 (0AH)

Errores del telegrama de respuesta del interlocutor que fueron detectados por el CP

30 (1EH)

Error en la comunicación entre el CP y la CPU

Parámetro STATUS
Código de
error
(W#16#...)

Descripción

Solución

0003

Parámetros PtP aceptados

-

0004

Parámetros ya en el CP (sellos de tiempo
idénticos)

-

0007

Cambio de estado de la CPU a STOP

-

Programación del PLC
Manual de programación y manejo, 11/2019

7139

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0008

Cambio de estado de la CPU a RUN/
ARRANQUE

-

0101

Error al comprobar el EPROM del sistema
operativo del CP

CP defectuoso, debe cambiarse el CP.

0102

Error al comporbar la RAM del CP

0103

Interfaz de orden del CP defectuosa

0110

Error en el firmware del CP

Desconecte el módulo y vuelva a conectar‐
lo. Si es necesario, cambie el módulo.

020F

Al iniciarse la comunicación parametrizada
se detecta una parametrización no válida.
No se ha podido parametrizar la interfaz.

Corrija la parametrización no válida y realice
un rearranque completo..

0301

Tipo de datos fuente/destino no válido o no
encontrado Área (dirección inicial, longi‐
tud) no válida

Revise la parametrización de CPU y CP y
corríjala en caso necesario.
Sólo en RK 512: El interlocutor transmite
parámetros no válidos en el encabezado del
telegrama.

DB no encontrado o no válido (por ejemplo
DB 0) u
otro tipo de datos de fuente o destino no
válido o no disponible

Revise la parametrización de CPU y CP y
configure un bloque en caso necesario.

N.º del byte de marcas de acoplamiento no
válido o

Consulte en las tablas de órdenes los tipos
de datos permitidos.

Tipo de datos erróneo, desconocido o no
autorizado

Revise el programa, p. ej. error en la para‐
metrización de la instrucción.

Sólo con RK 512: El interlocutor transmite
N.º del bit de marca de acoplamiento no
válido o no está seleccionado ni 'S' ni 'F' (en parámetros incorrectos en el encabezado
del telegrama.
la instrucción P_SND_RK)

0403

7140

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0407

Error en la transmisión de datos entre la
CPU y el CP

Si el error se notifica de forma permanente,
compruebe si las instrucciones a las que
accede en el programa de usuario están pa‐
rametrizadas correctamente.
Si el error se notifica inmediatamente tras
conectar la alimentación, en ese momento
todavía no hay ninguna conexión estableci‐
da con la CPU. Con el procedimiento
3964(R) y con el driver ASCII, el CP 341 que
recibe repite la transmisión de datos hasta
que éstos hayan sido transferidos a la CPU.
En caso de RK 512, la orden se confirma
negativamente y debe repetirse en el pro‐
grama de usuario.
Si el mensaje aparece esporádicamente du‐
rante el desarrollo de una transmisión de
datos, la CPU no acepta los datos tempo‐
ralmente. Con el procedimiento 3964(R) y
con el driver ASCII, el CP 341 que recibe
repite la transmisión de datos hasta que és‐
tos hayan sido transferidos a la CPU. En
caso de RK 512, la orden se confirma nega‐
tivamente y debe repetirse en el programa
de usuario. Para solucionar el problema, en
su programa de usuario debe llamar la ins‐
trucción P_RCV_RK con más frecuencia.

0408

Error en la transmisión de datos entre la
CPU y el CP (recepción)
● La CPU está temporalmente
sobrecargada, la orden se repite

● Reduzca el número de llamadas de
comunicación

● No es posible acceder temporalmente
al área de datos de la CPU, p. ej.,
porque no se accede con suficiente
frecuencia al bloque de recepción.

● Llame el bloque de recepción con más
frecuencia

● No es posible acceder temporalmente
al área de datos de la CPU, p. ej.,
porque el bloque de recepción está
temporalmente bloqueado (EN=false).

● Compruebe si el bloque de recepción
está bloqueado durante demasiado
tiempo

Programación del PLC
Manual de programación y manejo, 11/2019

7141

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

0409

No es posible recibir datos. Error en la
transmisión de datos entre la CPU y el CP
(recepción). No es posible recibir datos.
Tras varios intentos se ha interrumpido la
orden al cabo de 10 s, porque
● no se accede al bloque de recepción.

Solución

● Compruebe en su programa de usuario
si se accede al bloque de recepción.

● el bloque de recepción está bloqueado. ● Compruebe si el bloque de recepción
está bloqueado.

040A

● no puede accederse al área de datos
de la CPU.

● Compruebe si existe el área de datos a
la que van a transmitirse los datos.

● el área de datos de la CPU es
demasiado corta.

● Compruebe la longitud del área de
datos.

Cree el DB de destino en el programa de
Error en la transmisión de datos entre la
CPU y el CP. La transmisión de datos se ha usuario o prolongue el DB de destino ya
interrumpido con RESET porque:
existente.
● no existe DB de destino
● el DB de destino es demasiado corto
● en la instrucción está activado el bit
RESET

0501

La orden en curso ha sido interrumpida por
un rearranque del CP.

0502

La orden no es válida en este estado ope‐ Parametrice la interfaz del dispositivo.
rativo del CP (p. ej. interfaz de dispositivo
no parametrizada).

0505

Sólo con driver de impresora:
Bloque de datos del sistema con textos de
aviso no disponible en CP

0506

Sólo con driver de impresora:
Texto de aviso no disponible

0507

Sólo con driver de impresora:
Texto de aviso demasiado largo

0508

Sólo con driver de impresora:
Demasiadas instrucciones de conversión

0509

Sólo con driver de impresora:
Demasiadas variables

050A

Sólo con driver de impresora:
Instrucción de conversión desconocida

7142

En caso de conexión de la alimentación no
hay ninguna solución. Al reparametrizar el
CP con la programadora y antes de escribir
en una interfaz, asegúrese de que no se
ejecuten más órdenes desde la CPU.

Configure los textos de aviso con el softwa‐
re de parametrización y reinicie.
Configure los textos de aviso con el softwa‐
re de parametrización y reinicie.
Modifique el texto de aviso hasta un máximo
de 150 caracteres (a un máximo de 250 ca‐
racteres en caso de variables)
Ha configurado más instrucciones de con‐
versión que variables. Las instrucciones de
conversión sin la variable correspondiente
se ignoran.
Ha configurado más variables que instruc‐
ciones de conversión. Las variables sin ins‐
trucción de conversión no se imprimen.
Revise la instrucción de conversión. Las ins‐
trucciones de conversión no definidas o no
compatibles se sustituyen por ****** en la
impresión.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

050B

Sólo con driver de impresora:

Revise la instrucción de control. Las instruc‐
ciones de control indefinidas o incompati‐
bles se ignoran. La instrucción de control
tampoco se imprime en forma de texto.

Instrucción de control desconocida
050C

Sólo con driver de impresora:
Instrucción de conversión no ejecutable

Revise la instrucción de conversión. Las ins‐
trucciones de conversión no ejecutables se
imprimen con asteriscos * de acuerdo con el
ancho definido y la parte válida restante de
la instrucción, o bien de la representación
estándar.

050D

Corrija el ancho especificado para la varia‐
Ancho insuficiente o excesivo en la instruc‐ ble de la instrucción de conversión a partir
del número máximo de caracteres de la va‐
ción de conversión
riable en los modos de representación ba‐
sados en texto (A, C, D, S, T, Y, Z). En la
impresión sólo se imprime el número de ca‐
racteres correspondiente al ancho especifi‐
cado, el resto no se imprime. En el resto de
casos se imprimen asteriscos * en la canti‐
dad equivalente al ancho.

050E

Sólo con drivers ASCII:

Sólo con driver de impresora:

Error al enviar. Los caracteres de marca de
fin parametrizados no han aparecido den‐
tro de la longitud máxima admitida o bien
se ha excedido la longitud de envío máxi‐
ma al generarse anexos automáticamente.

Complemente los caracteres de marca de
fin en el lugar deseado del búfer de envío o
seleccione una longitud de telegrama me‐
nor en la generación automática de anexos.

0514

Direcciones de inicio demasiado elevadas
para el tipo de datos deseado o dirección
de inicio o n.º DB/DX demasiado bajo.

Consulte en la tabla de órdenes las direc‐
ciones de inicio y los números DB/DX que
pueden especificarse en el programa.

0515

N.º de bit permitido: de 0 a 7
Sólo con RK 512:
Número de bit erróneo en la marca de aco‐
plamiento.

0516

Sólo con RK 512:
Número de CPU demasiado elevado.

N.º permitido de CPU: ninguno, 0, 1, 2, 3 ó 4

0517

Longitud de transmisión > 1 kByte es de‐
masiado elevado para CP o longitud insu‐
ficiente para parámetros de interfaz.

Divida la orden en varias órdenes de una
longitud menor.

051A

Sólo con RK 512:
Error al enviar un telegrama de orden

Vea las medidas a tomar en el número de
evento anterior.

Se ha registrado un número de error de
procedimiento inmediatamente antes en
STATUS.
051B

Sólo con driver de impresora:
Precisión no válida

Programación del PLC
Manual de programación y manejo, 11/2019

Corrija la precisión indicada en la instruc‐
ción de conversión. La precisión siempre va
precedida de un punto que identifica y limita
el ancho (p. ej.: ".2" para la salida de punto
decimal y dos decimales). La precisión sólo
es relevante en los modos de representa‐
ción F, R, A y D. En el resto de casos se
ignora.

7143

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

051C

Sólo con driver de impresora:

Corrija la variable indicada. Consulte los ti‐
pos de datos válidos para el modo de repre‐
sentación en cuestión en la tabla respectiva.

Variable no válida
(Longitud de variable incorrecta/tipo inco‐
rrecto)
051E

Sólo con driver de impresora:
Las "secuencias de fin de línea" enviadas
con esta orden (p. ej., $R/$L/$N) (ya) no
encajan en la página (empezada)

7144

Aumente la longitud de la página, reduzca la
cantidad de líneas (o los saltos de línea) o
reparta la impresión en varias páginas

0601

Error en el 1er byte de orden (excepto 00 ó
FFH)

Error de estructura del encabezado en el in‐
terlocutor. Si fuese necesario, compruebe el
comportamiento erróneo del equipo interlo‐
cutor con un dispositivo de comprobación
de interfaces que se conecta a la línea de
transmisión.

0602

Error en el 3er byte de orden (excepto A, 0
ó E)

Error de estructura del encabezado en el in‐
terlocutor. Si fuese necesario, compruebe el
comportamiento erróneo del equipo interlo‐
cutor con un dispositivo de comprobación
de interfaces que se conecta a la línea de
transmisión.

0603

Error en el 3er byte de orden en telegramas Error de estructura del encabezado en el in‐
de continuación (orden diferente a la del
terlocutor. Si fuese necesario, compruebe el
comportamiento erróneo del equipo interlo‐
1er telegrama).
cutor con un dispositivo de comprobación
de interfaces que se conecta a la línea de
transmisión.

0604

Error en el 4º byte de orden (letra de orden
incorrecta)

Error de estructura del encabezado en el in‐
terlocutor o se ha solicitado una combina‐
ción de órdenes no autorizada en el CP.
Compruebe las órdenes permitidas. Si fue‐
se necesario, compruebe el comportamien‐
to erróneo del equipo interlocutor con un
dispositivo de comprobación de interfaces
que se conecta a la línea de transmisión.

0605

Error en el 4º byte de orden en el telegrama
de continuación (la orden no es como en el
1er telegrama)

Error de estructura del encabezado en el in‐
terlocutor. Si fuese necesario, compruebe el
comportamiento erróneo del equipo interlo‐
cutor con un dispositivo de comprobación
de interfaces que se conecta a la línea de
transmisión.

0606

Error en el 5º byte de orden (número de DB
no permitido)

Consulte los números de DB, las direccio‐
nes de inicio y las longitudes válidas en las
tablas de órdenes.

0607

Error en el 5.º y 6.º byte de orden (dirección
de inicio demasiado elevada)

Consulte los números de DB, las direccio‐
nes de inicio y las longitudes válidas en las
tablas de órdenes.

0608

Error en el 7.º y 8.º byte de orden (longitud
no válida)

Consulte los números de DB/DX, las direc‐
ciones de inicio y las longitudes válidas en
las tablas de órdenes.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

0609

Error en el 9.º y 10.º byte de orden (marca Error de estructura del encabezado en el in‐
de coordinación no válida en este tipo de terlocutor. Consulte en las tablas de órde‐
datos o número de bit demasiado elevado) nes los casos en los que se permiten utilizar
las marcas de coordinación.

060A

Error en el 10º byte de orden (número de
CPU no válido)

060B

Telegrama SEND de mayor/menor longi‐
Es necesaria una corrección en el interlocu‐
tud que la esperada (se han recibido más/ tor
menos datos que los anunciados en el en‐
cabezado del telegrama).

060C

Recibido telegrama de orden FETCH con
datos útiles.

060D

EL CP ha recibido el telegrama en un modo
de operación no válido:

060E

Solución

Error de estructura de encabezado en el in‐
terlocutor

Es necesaria una corrección en el interlocu‐
tor

● El enlace de recepción entre la CPU y
el CP no está estructurado
correctamente

● Compruebe si la conexión que se intenta
establecer está (bien) parametrizada

● El CP todavía no ha arrancado por
completo

● Este aviso de error sólo puede aparecer
durante el arranque del CP. Repita la
orden.

● La CPU receptora se encuentra en
estado operativo STOP

● Ponga de nuevo la CPU en estado
operativo RUN y repita la orden.

● La interfaz solicitada se está
reparametrizando es este momento

● Se trata de un error temporal. Repita la
orden.

Error de sincronización del interlocutor

Este error puede indicarse tras un reinicio
del autómata propio en caso de telegramas
de gran longitud o de reinicio del interlocu‐
tor. En estos casos se trata de un compor‐
tamiento de arranque normal del sistema.

● Se ha recibido un nuevo telegrama de
orden (de continuación) antes de haber
enviado un telegrama de reacción.

● Se esperaba el 1.er telegrama de orden Durante el funcionamiento normal, el error
y se ha recibido un telegrama de
también puede aparecer como consecuen‐
continuación.
cia de estados de error que sólo ha detec‐
● Se esperaba un telegrama de orden de tado el interlocutor.
continuación y se ha recibido el 1.er
En cualquier otro caso debe deducirse un
comportamiento erróneo del dispositivo in‐
telegrama.
terlocutor. Es posible que el error no se pro‐
duzca en órdenes <128 bytes.
060F

DB bloqueado por función de coordinación En el propio programa: Desactive la marca
de acoplamiento después de procesar los
últimos datos de transmisión.
En el programa del interlocutor: Repetición
de la orden

0610

Se ha recibido un telegrama de longitud in‐
suficiente (longitud < 4 bytes para telegra‐
mas de continuación o reacción o longitud
< 10 bytes para telegramas de orden)

Programación del PLC
Manual de programación y manejo, 11/2019

Si fuese necesario, compruebe el compor‐
tamiento erróneo del equipo interlocutor con
un dispositivo de comprobación de interfa‐
ces que se conecta a la línea de transmisión.

7145

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0611

La longitud del telegrama y la longitud es‐
pecificada en el encabezado de telegrama
no coinciden.

Si fuese necesario, compruebe el compor‐
tamiento erróneo del equipo interlocutor con
un dispositivo de comprobación de interfa‐
ces que se conecta a la línea de transmisión.

0612

Error al enviar el telegrama de reacción (de
continuación), se ha registrado un número
de error de procedimiento inmediatamente
antes en STATUS.

Vea las medidas de solución correspondien‐
tes al número de error registrado inmediata‐
mente antes en STATUS.

0701

Transmisión de la primera repetición:

Un reintento no es un error, pero puede ser
un indicio de que hay interferencias en la
línea de transmisión o de que el interlocutor
no funciona correctamente. Si una vez al‐
canzado el número máximo de repeticiones
el telegrama no ha podido ser enviado, se
registra un n.º de error que describe el error
que apareció en primer lugar.

● Se ha detectado un error durante el
envío del telegrama o bien
● El interlocutor ha solicitado una
repetición con un carácter de
confirmación negativo (NAK).
0702

Sólo con 3964(R):
Error al establecer la conexión:
Tras el envío de STX se ha recibido NAK o
un carácter cualquiera (salvo DLE o STX).

0703

Si fuese necesario, compruebe el compor‐
tamiento erróneo del equipo interlocutor con
un dispositivo de comprobación de interfa‐
ces que se conecta a la línea de transmisión.

El dispositivo interlocutor es demasiado len‐
to o no está preparado para recibir o bien
hay p. ej. una rotura de la línea de envío. Si
fuese necesario, compruebe el comporta‐
Tras el envío de STX no se ha recibido nin‐
miento erróneo del equipo interlocutor con
guna respuesta del interlocutor en el tiem‐
un dispositivo de comprobación de interfa‐
po de retardo de acuse.
ces que se conecta a la línea de transmisión.
Sólo con 3964(R):

Se ha excedido el tiempo de retardo de
acuse (TRA):

0704

Sólo con 3964(R):
Cancelación por parte del interlocutor:
Durante el proceso de transmisión en cur‐
so el interlocutor ha recibido uno o varios
caracteres.

0706

Sólo con 3964(R):
Error en el extremo de la conexión:
● El telegrama ha sido rechazado por el
interlocutor con NAK u otro carácter al
final (con la excepción de DLE) o bien
● El carácter DLE se ha recibido
demasiado pronto.

7146

Compruebe si el interlocutor también indica
error porque quizá no han llegado todos los
datos de transmisión (p. ej. rotura de la línea
de transmisión), existen interferencias im‐
portantes o el interlocutor no funciona co‐
rrectamente. Utilice para ello un dispositivo
de comprobación de interfaces que se co‐
necta a la línea de transmisión.
Compruebe si el interlocutor también indica
error porque quizá no han llegado todos los
datos de transmisión (p. ej. rotura de la línea
de transmisión), existen interferencias im‐
portantes o el interlocutor no funciona co‐
rrectamente. Utilice para ello un dispositivo
de comprobación de interfaces que se co‐
necta a la línea de transmisión.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0707

Sólo con 3964(R):

El dispositivo interlocutor es demasiado len‐
to o está defectuoso. Utilice para ello un dis‐
positivo de comprobación de interfaces que
se conecta a la línea de transmisión.

Se ha excedido el tiempo de retardo de
acuse en el extremo de la conexión/tiempo
de vigilancia de la respuesta excedido tras
el telegrama de transmisión:
Tras deshacer la conexión con DLE ETX
no ha llegado ninguna respuesta del inter‐
locutor dentro del TRA.
0708

Sólo para driver ASCII y driver de impreso‐ El interlocutor falla, es demasiado lento o
está offline. Compruebe el interlocutor o mo‐
ra:
difique
la parametrización en caso necesa‐
El tiempo de espera a XON o CTS = ON ha
rio.
transcurrido.

0709

No es posible establecer la conexión, se ha Revise el cable de la interfaz o los paráme‐
sobrepasado el número de intentos de es‐ tros de la transmisión.
tablecimiento permitido.
Compruebe también en el interlocutor si la
función de recepción entre la CPU y el CP
está correctamente parametrizada.

070A

Los datos no han podido ser transmitidos,
se ha sobrepasado el número de intentos
de transmisión permitido.

0801

Esperando al primer reintento:

0802

Sólo con 3964(R):

Revise el cable de la interfaz o los paráme‐
tros de la transmisión.

Un reintento no es un error, pero puede ser
Al recibir un telegrama se ha detectado un un indicio de que hay interferencias en la
error y el CP exige mediante un acuse ne‐ línea de transmisión o de que el interlocutor
gativo (NAK) un reintento del interlocutor. no funciona correctamente. Si una vez al‐
canzado el número máximo de repeticiones
el telegrama no ha podido ser enviado, se
registra un n.º de error que describe el error
que apareció en primer lugar.

Error al establecer la conexión:
● En posición de reposo se han recibido
uno o más caracteres (cualquiera con
la excepción de NAK o STX) o bien

Si fuese necesario, compruebe el compor‐
tamiento erróneo del equipo interlocutor con
un dispositivo de comprobación de interfa‐
ces que se conecta a la línea de transmisión.

● Tras la recepción de un STX el
interlocutor ha enviado otros
caracteres sin esperar a recibir la
respuesta DLE.
Tras conectar la alimentación del interlocu‐
tor:
● Durante el tiempo de conexión del
interlocutor, el CP recibe un carácter
indefinido.

Programación del PLC
Manual de programación y manejo, 11/2019

7147

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

0805

Sólo con 3964(R):

Solución

Compruebe que el interlocutor no haya in‐
cluido el DLE por duplicado en el encabeza‐
do del telegrama o en la cadena de datos, y
Tras la recepción de DLE se ha recibido
que la conexión se establezca con DLE
otro carácter cualquiera (salvo DLE, ETX).
ETX. Compruebe el comportamiento erró‐
neo del dispositivo interlocutor con un dis‐
positivo de comprobación de interfaz conec‐
tado a la línea de transmisión.
Error lógico durante la recepción:

0806

Transcurrido el tiempo de retardo caracte‐
res (TRC):
● No se han recibido dos caracteres
consecutivos dentro del TRC o bien

El dispositivo interlocutor es demasiado len‐
to o está defectuoso. Utilice para ello un dis‐
positivo de comprobación de interfaces que
se conecta a la línea de transmisión.

Sólo con 3964(R):
● El 1.er carácter tras la transmisión de
DLE al establecer la conexión no se ha
recibido dentro del TRC.
0808

Compruebe que la conexión no tenga fuer‐
tes interferencias. De ser así, observará de
Error en el carácter de control de bloque
vez en cuando códigos de error. Si fuese
BCC:
necesario, compruebe el comportamiento
El valor interno del BCC no concuerda con
erróneo del equipo interlocutor con un dis‐
el BCC recibido por el interlocutor en el ex‐
positivo de comprobación de interfaces que
tremo de la conexión.
se conecta a la línea de transmisión.

080A

No hay ningún búfer de recepción libre:

Sólo con 3964(R):

Durante la recepción no se disponía de
ningún búfer de recepción vacío.
080C

Error de transmisión:
● Se ha detectado un error de
transmisión (error de paridad, error de
bit de parada, error de
desbordamiento).
Sólo con 3964(R):
● Si durante la posición de reposo se
recibe un carácter defectuoso, el error
se indica inmediatamente para facilitar
la detección precoz de fallos en la línea
de transmisión.

La instrucción P_RCV_RK se debe llamar
con mayor frecuencia.
Las interferencias en la línea de transmisión
provocan repeticiones del telegrama redu‐
ciendo la media de datos útiles. Todo ello
aumenta el riesgo de que exista un error no
detectado. Modifique la configuración del
sistema o el tendido de cables.
Compruebe la línea de conexión de los in‐
terlocutores y asegúrese de que en ambos
interlocutres esté ajustada la misma veloci‐
dad de transmisión, la misma paridad y el
mismo número de bits de parada.

Sólo con RK 512 y 3964(R):
● Si esto ocurre durante el modo de
transmisión o recepción, se inician
repeticiones.
080D

BREAK:
La línea de recepción que llega al interlo‐
cutor está interrumpida.

7148

Restablezca la conexión o conecte el inter‐
locutor.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0815

La parametrización del número de intentos
de transmisión del CP y del interlocutor no
concuerda.

Parametrice en el interlocutor el mismo nú‐
mero de intentos de transmisión que en el
CP. Si fuese necesario, compruebe el com‐
portamiento erróneo del equipo interlocutor
con un dispositivo de comprobación de in‐
terfaces que se conecta a la línea de trans‐
misión.

0816

Es necesaria una corrección en el interlocu‐
La longitud de un telegrama recibido era
superior a la longitud máxima parametriza‐ tor.
da.

0818

Sólo con driver ASCII:
DSR = OFF o CTS = OFF

El interlocutor ha puesto todas las señales
DSR o CTS a "OFF" antes o durante una
transmisión.
Compruebe el control de las señales cualifi‐
cadoras RS 232C en el interlocutor.

0902

Compruebe si el área de datos en cuestión
existe
en el interlocutor y si es suficiente‐
Error de acceso a la memoria en el interlo‐
mente
grande o revise los parámetros del
cutor (memoria no disponible)
bloque de función de sistema llamado.
Con SIMATIC S5 como interlocutor:
Compruebe también la longitud indicada en
● Área incorrecta en la palabra
el bloque de función del sistema.
indicadora o
Sólo con RK 512:

● área de datos no disponible (excepto
DB/DX) o
● área de datos demasiado corta
(excepto DB/DX)
0903

Sólo con RK 512:
Error de acceso DB/DX en el interlocutor
(DB/DX no disponible o demasiado corto)
Con SIMATIC S5 como interlocutor:
● DB/DX no disponible o
● DB/DX demasiado corto o

Compruebe si el área de datos en cuestión
existe en el interlocutor y si es suficiente‐
mente grande o revise los parámetros del
bloque de función de sistema llamado.
Compruebe también la longitud indicada en
el bloque de función del sistema.

● N.º DB/DX no válido
Se ha sobrepasado el área de origen per‐
mitida en la orden FETCH
0904

Sólo con RK 512:
El interlocutor notifica: "Tipo de orden no
permitido".

Programación del PLC
Manual de programación y manejo, 11/2019

Comportamiento erróneo del interlocutor,
ya que el CP nunca envía una orden del sis‐
tema.

7149

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0905

Sólo con RK 512: Error en el interlocutor o
en el SIMATIC S5 como interlocutor:

Compruebe si el interlocutor puede transmi‐
tir el tipo de datos en cuestión.

● Tipo de origen/destino no válido o bien Compruebe la instalación del hardware del
interlocutor.
● Error de memoria en el autómata del
interlocutor o bien

● Error de entendimiento CP/CPU en el
interlocutor o bien

Conmute el selector del autómata interlocu‐
tor a la posición RUN.

● el autómata del interlocutor se
encuentra en estado STOP
Este error se produce durante el rearranque
completo
del propio autómata o del del in‐
El interlocutor ha detectado un error de sin‐
terlocutor.
Se trata de un comportamiento
cronización:
normal de arranque de la instalación. No es
El orden de los telegramas es incorrecto.
necesario tomar ninguna medida. Durante
el funcionamiento, este error también puede
producirse como consecuencia de errores
anteriores. De lo contrario, puede partir de
la base de un comportamiento erróneo del
interlocutor.

0908

Sólo con RK 512:

0909

En el programa del interlocutor: Desactive la
DB/DX se encuentra bloqueado en el inter‐ marca de coordinación después de proce‐
sar los últimos datos de transmisión.
locutor por marcas de coordinación
En el programa: Repita la orden.

090A

Sólo con RK 512:

Sólo con RK 512:

El interlocutor ha detectado errores en el
encabezado del telegrama: El 3.er byte de
orden del encabezado es incorrecto.

Compruebe si el error se debe a interferen‐
Error en el encabezado del telegrama: 1.er cias o a un comportamiento erróneo del in‐
o 4.º byte de orden en el encabezado erró‐ terlocutor. Utilice para ello un dispositivo de
comprobación de interfaces que se conecta
neo
a la línea de transmisión.

090B

Sólo con RK 512:

090C

Compruebe si el error se debe a interferen‐
El interlocutor detecta una longitud de tele‐ cias o a un comportamiento erróneo del in‐
terlocutor. Utilice para ello un dispositivo de
grama errónea (longitud total).
comprobación de interfaces que se conecta
a la línea de transmisión.

090D

Sólo con RK 512:

Sólo con RK 512:

Hasta el momento no se ha llevado a cabo
el rearranque completo del interlocutor.
090E

Sólo con RK 512:
Se ha recibido un número de error desco‐
nocido en el telegrama de reacción.

7150

Compruebe si el error se debe a interferen‐
cias o a un comportamiento erróneo del in‐
terlocutor. Utilice para ello un dispositivo de
comprobación de interfaces que se conecta
a la línea de transmisión.

Lleve a cabo el rearranque completo del au‐
tómata del interlocutor o ponga el selector
de modo del CP en posición RUN.
Compruebe si el error se debe a interferen‐
cias o a un comportamiento erróneo del in‐
terlocutor. Utilice para ello un dispositivo de
comprobación de interfaces que se conecta
a la línea de transmisión.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0A01

Este error aparece tras un rearranque com‐
Error de sincronización del interlocutor por‐ pleto del propio autómata en telegramas de
gran longitud o en caso de un rearranque
que
completo del interlocutor. Se trata de un
● telegrama de reacción sin orden
comportamiento normal de la instalación,
● telegrama de reacción recibido antes
no debe tomar ninguna medida.
de que se enviara el telegrama de
Durante el funcionamiento normal, el error
continuación
también puede aparecer como consecuen‐
● tras enviar un primer telegrama se ha cia de estados de error que sólo ha detec‐
tado el interlocutor.
recibido un telegrama de reacción de
Sólo con RK 512:

continuación

● tras enviar un telegrama de
continuación se ha recibido el primer
telegrama de reacción

En cualquier otro caso puede deducirse un
comportamiento erróneo del dispositivo in‐
terlocutor. Es posible que el error no se pro‐
duzca en órdenes <128 bytes.

0A02

Sólo con RK 512: Se han localizado erro‐ Si fuese necesario, compruebe el compor‐
res en la estructura del telegrama de reac‐ tamiento erróneo del equipo interlocutor con
ción recibido (1er byte diferente de 00 o FF) un dispositivo de comprobación de interfa‐
ces que se conecta a la línea de transmisión.

0A03

Sólo con RK 512: El telegrama de reacción
recibido contiene demasiados o bien muy
pocos datos.

Si fuese necesario, compruebe el compor‐
tamiento erróneo del equipo interlocutor con
un dispositivo de comprobación de interfa‐
ces que se conecta a la línea de transmisión.

0A04

Sólo con RK 512: El telegrama de reacción
a una orden SEND ha llegado con datos.

Si fuese necesario, compruebe el compor‐
tamiento erróneo del equipo interlocutor con
un dispositivo de comprobación de interfa‐
ces que se conecta a la línea de transmisión.

0A05

Sólo con RK 512: No se ha recibido ningún ¿Es el interlocutor un dispositivo muy lento?
telegrama de reacción del interlocutor den‐ Este error se presenta a menudo como con‐
tro del tiempo de vigilancia.
secuencia de un error que se ha producido
con anterioridad. Por ejemplo, pueden vi‐
sualizarse errores de recepción de procedi‐
miento (clase de evento 8) después de en‐
viar un telegrama FETCH. Motivo: No se ha
podido recibir el telegrama de reacción de‐
bido a perturbaciones. El tiempo de vigilan‐
cia ha expirado. Este error también puede
producirse si se ha rearrancado el interlocu‐
tor antes de que este haya respondido al
último telegrama FETCH recibido.

1E0D

Cancelación de la orden por rearranque
completo, rearranque o reset

1E0E

Error estático al lamar la SFC RD_REC. El
valor de retorno RET_VAL de la SFC que‐
da disponible en la variable SFCERR del
DB de instancia para su evaluación.

1E0F

Error estático al llamar la SFC WR_REC. El Cargue la variable SFCERR del DB de ins‐
valor de retorno RET_VAL de la SFC que‐ tancia.
da disponible en la variable SFCERR del
DB de instancia para su evaluación.

Programación del PLC
Manual de programación y manejo, 11/2019

Cargue la variable SFCERR del DB de ins‐
tancia.

7151

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

1E41

El número de bytes indicado en el paráme‐ Respete el rango de 1 a 4096 bytes.
tro LEN de las instrucciones no está permi‐
tido

1E42

Instrucción P_PRINT_RK:
Observe las longitudes permitidas:
El número de bytes indicado para la varia‐ 32 bytes para variables, 150 bytes para ca‐
ble o la cadena de formato dentro de la
dena de formato
longitud del DB de punteros no es válido.

1E43

Instrucción P_PRINT_RK:
No existe ningún puntero para la cadena
de formato.

Indique en el DB de punteros el n.º del blo‐
que de datos y el nº de la palabra de datos
para la cadena de formato.

Nota
Sólo se envía un mensaje de error si simultáneamente está activado el bit ERROR (orden
interrumpida con errores). En cualquier otro caso la palabra de STATUS es cero.

Llamar la variable SFCERR o SFCSTATUS
Obtendrá más información sobre el error producido, 14 (1E0EH) y 15 (1E0FH), de la clase de
evento 30 mediante la variable SFCERR o SFCSTATUS.
Puede cargar la variable SFCERR o SFCSTATUS sólo desde un acceso simbólico al DB
instancia de la instrucción correspondiente.
Los mensajes de error que se registran en la variable SFCERR se encuentran en las funciones
de sistema SFC 58 en "WR_REC: Escribir registro en periferia" y SFC 59 en "RD_REC: Leer
registro de periferia".
Los mensajes de error que se registran en la variable SFCSTATUS se encuentran en las
funciones de sistema SFB 52 en "RDREC: Leer registro" y SFB 53 en "WRREC: Escribir
registro".

Consulte también
WR_REC: Escribir registro en periferia (Página 5927)
RD_REC: Leer registro de periferia (Página 5922)
RDREC: Leer registro (Página 5888)
WRREC: Escribir registro (Página 5890)

7152

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Acoplamiento PtP CP 440
SEND_440: Enviar datos
Descripción
La instrucción SEND_440 transmite un conjunto de datos de un bloque de datos especificado
por los parámetros DB_NO, DBB_NO y LEN, al CP 440. La instrucción SEND_440 se llama
para transferir datos cíclica o estáticamente (sin condiciones) en un programa controlado por
tiempo.

Funcionamiento
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
Dependiendo de la cantidad de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).
La instrucción SEND_440 puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al CP 440 y la instrucción SEND_440
pasa al estado inicial. Los datos que ya ha recibido el CP 440 se envían al interlocutor. Si la
entrada R tiene el estado lógico estático "1", la transmisión está desactivada.
Con el parámetro LADDR se indica la dirección del CP 440 que debe llamarse.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS
también se visualizan en caso de RESET de la instrucción SEND_440 . Si se ha producido un
error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el estado del
resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Envío blo‐
queado.

LADDR

INPUT

INT

DB_NO

INPUT

INT

Dirección base del CP 440
La dirección inicial se toma de STEP 7.
Número del bloque de datos
Nº de DB de envío:
específico de la CPU. No se admite el valor 0.

DBB_NO

INPUT

INT

Número del byte de datos
0 ≤ DBB_NO ≤ 8190 datos de transmisión a
partir del byte de datos;
Offset es específico de la CPU

Programación del PLC
Manual de programación y manejo, 11/2019

7153

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

LEN

INPUT

INT

Longitud de datos
1 ≤ LEN ≤ 400, indicados en número de bytes

DONE

OUTPUT

1

BOOL

Petición finalizada sin errores
Parámetro STATUS == 16#00;

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7160) contiene
la información de error.

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS (Pá‐
gina 7160) figura la información de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción SEND_440 opera conjuntamente con un DB instancia I_SEND_440. El número
del DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, (STATUS == W#16#1E0F), encontrará una indicación más
precisa sobre el error en la variable SFCERR.

7154

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Cronograma
La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de las entradas REQ y R.

5(4

5

'21(

/DSHWLFLµQQR
VHHMHFXWD
/DHPLVLµQHVW£
GHVFRQHFWDGD

)LQVLQHUURUHV

7UDQVIHULU5(6(7

)LQFRQHUURUHV

7UDQVIHULU5(6(7

lQlSDUWH6(1'

)LQVLQHUURUHV

3HWLFLµQ(QYLDU

(5525

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

Regulación
Nota
La instrucción SEND_440 no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.

RECV_440: Recibir datos
Descripción
La instrucción RECV_440 transmite datos del CP 440 a un área de datos S7, especificada por
los parámetros DB_NO, DBB_NO y LEN. La instrucción RECV_440 se llama para transferir
datos cíclica o estáticamente (sin condiciones) en un programa controlado por tiempo .

Programación del PLC
Manual de programación y manejo, 11/2019

7155

Instrucciones
4.2 Instrucciones

Funcionamiento
Con el estado lógico (estático) "1" en el parámetro EN_R se habilita la comprobación de si
pueden leerse datos del CP 440. Es posible cancelar una transmisión en curso con el estado
lógico "0" en el parámetro EN_R. La petición de recepción cancelada finaliza con un mensaje
de error (salida STATUS). La recepción está desactivada mientras exista el estado lógico "0"
en el parámetro EN_R. Dependiendo del volumen de datos, la transmisión puede desarrollarse
en varias llamadas (ciclos del programa).
Si la instrucción detecta el estado lógico "1" en el parámetro R, se cancela la petición actual de
transmisión y la instrucción RECV_440 pasa al estado inicial. La recepción está desactivada
mientras exista el estado lógico "1" en el parámetro R.
Con el parámetro LADDR se selecciona el CP 440 que se llamará.
La salida NDR indica "Petición finalizada sin errores/Datos aceptados" (leídos todos los datos).
ERROR indica que se ha producido un error. En caso de producirse un error, el número de
evento correspondiente se indica en STATUS. Si no se producen errores, STATUS asume el
valor 0. NDR y ERROR/STATUS también se indican en caso de RESET de la instrucción
RECV_440 (parámetro LEN == 16#00). Si se ha producido un error, se desactiva el resultado
binario RB. Si el bloque finaliza sin errores, el estado del resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de da‐
tos

Descripción

EN_R

INPUT

BOOL

Habilitar lectura de datos

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Bloqueo
de recepción.

LADDR

INPUT

INT

Dirección inicial del CP 440
La dirección base se toma de la tabla de
configuración de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
N.º del DB de recepción:
específico de la CPU. No se admite el valor
0.

DBB_NO

INPUT

INT

Número del byte de datos
El offset es específico de la CPU

NDR

1

OUTPUT

BOOL

OUTPUT

BOOL

Petición finalizada sin errores, datos acep‐
tados
Parámetro STATUS == 16#00;

ERROR1

Petición interrumpida con errores
El parámetro STATUS (Página 7160) con‐
tiene la información de error.

LEN1

OUTPUT

INT

Longitud del telegrama recibido
1 ≤ LEN ≤ 400, indicados en número de
bytes

7156

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de da‐
tos

Descripción

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7160) figura la información de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción RECV_440 opera conjuntamente con un DB instancia I_RECV_440. El número
del DB se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: En caso de error, (STATUS == W#16#1E0E), encontrará una indicación más
precisa sobre el error en la variable SFCERR.

Cronograma
La siguiente figura muestra el comportamiento de los parámetros NDR, LEN y ERROR en
función de la conexión de las entrada EN_R y R.

(1B5

5

1'5

(5525

Programación del PLC
Manual de programación y manejo, 11/2019

)LQFRQHUURUHV

5HFHSFLµQHQFXUVR

5(6(7
)LQVLQHUURUHV

6LQUHFHSFLµQ

5HFHSFLµQGHVFRQHFWDGD

)LQFRQHUURUHV

5HFHSFLµQHQFXUVR

)LQVLQHUURUHV

+DELOLWDUUHFHSFLµQ

/(1
/RQJLWXG

7157

Instrucciones
4.2 Instrucciones

Nota
La entrada EN_R debe ponerse estáticamente a "1". Mientras dure toda la petición de
recepción, el parámetro EN_R debe recibir el RLO "1" (resultado lógico).

Regulación
Nota
La instrucción RECV_440 no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.

RES_RECV: Borrado del búfer de recepción
Descripción
La instrucción RES_RECV borra completamente el búfer de recepción del CP 440. Todos los
telegramas guardados se rechazan. Un telegrama entrante en el momento de llamar a la
instrucción RES_RECV se guarda.

Funcionamiento
Con un flanco ascendente en la entrada REQ se activa la instrucción. La petición puede
recorrer varias llamadas (ciclos de programa).
La instrucción RES_RECV puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De esta forma se interrumpe el proceso de borrado y la instrucción RES_RECV
pasa al estado inicial.
Con el parámetro LADDR se indica la dirección del CP 440 que debe llamarse.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS
también se visualizan en caso de RESET de la instrucción RES_RECV . Si se ha producido un
error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el estado del
resultado binario es "1".

7158

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascenden‐
te

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso.
Transmisión bloqueada.

LADDR

INPUT

INT

DONE1

OUTPUT

BOOL

Dirección inicial del CP 440
La dirección inicial se toma de STEP 7.
Petición finalizada sin errores
Parámetro STATUS == 16#00;

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7160)
contiene la información de error.

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STA‐
TUS (Página 7160) figura la informa‐
ción de error.

1

El parámetro está disponible hasta la siguiente llamada de la instrucción.

Asignación en el área de datos
La instrucción RES_RECV opera conjuntamente con un DB instancia I_RES_RECV. El
número del DB se indica con la llamada. No está permitido acceder a los datos del DB
instancia.
Nota
Excepción: en caso de error, (STATUS == W#16#1E0F), encontrará una indicación más
precisa sobre el error en la variable SFCERR.

Programación del PLC
Manual de programación y manejo, 11/2019

7159

Instrucciones
4.2 Instrucciones

Cronograma
La siguiente figura muestra el comportamiento de los parámetros DONE y ERROR en función
de la conexión de las entradas REQ y R.

5(4

5

'21(

/DSHWLFLµQ
QRVHHMHFXWD

)LQVLQHUURUHV

5(6(7WUDQVIHULGR

)LQFRQHUURU

5(6(7WUDQVIHULGR

)LQVLQHUURUHV

%RUUDUE¼IHUGHUHFHSFLµQ

(5525

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

Regulación
Nota
La instrucción RES_RECV no dispone de comprobación de parámetros. Si la parametrización
es incorrecta, la CPU puede cambiar al estado STOP.

Parámetro STATUS
Clases de eventos
Clase de evento Significado

7160

0 (0H)

Arranque del CP

2 (02H)

Error al inicializar

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Clase de evento Significado
5 (05H)

Error al procesar una orden de la CPU

7 (07H)

Error de transmisión

8 (08H)

Error de recepción

11 (0BH)

Advertencias

30 (1EH)

Error en la comunicación entre el CP y la CPU

128 (80 H)

Fallo de módulo

Parámetro STATUS
Código de
error
(W#16#...)

Descripción

Solución

0001

Init del CP concluida

-

0003

Parámetros PtP aceptados

-

0004

Parámetros ya en el CP (sellos de tiem‐ po idénticos)

0007

Transición de estado de la CPU a STOP -

0008

Transición de estado de la CPU a RUN/ ARRANQUE

0201

No hay parámetros disponibles

Cargue los parámetros de la interfaz.

Memoria de parámetros vacía o conteni‐
do desconocido
0204

Trama de caracteres no permitida

Corrija la parametrización no permitida, car‐
gue los parámetros en el módulo y realice
un rearranque completo.

0205

Velocidad de transmisión no permitida

Corrija la parametrización no permitida, car‐
gue los parámetros en el módulo y realice
un rearranque completo.

020F

Al iniciarse la comunicación parametri‐
zada se detecta una parametrización no
válida. No se ha podido parametrizar la
interfaz.

Corrija la parametrización no válida y realice
un rearranque completo.

0212

No permitido

Corrija la parametrización no permitida, car‐
gue los parámetros en el módulo y realice
un rearranque completo.

● Tiempo de vigilancia
● Tiempo de retardo de caracteres
Sólo con 3964(R):
● Tiempo de retardo de confirmación
0501

La orden en curso ha sido interrumpida
por un rearranque del CP.

0502

La orden no está permitida en este esta‐ Parametrice la interfaz del dispositivo.
do operativo del CP (p. ej. interfaz del
dispositivo no parametrizada).

Programación del PLC
Manual de programación y manejo, 11/2019

En caso de conexión de la alimentación no
hay ninguna solución. Al reparametrizar el
CP con la programadora y antes de escribir
en una interfaz, asegúrese de que no se
ejecuten más órdenes desde la CPU.

7161

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

050E

● Longitud del telegrama no válida
o

● La longitud del telegrama es > 400
bytes. Seleccione una longitud menor
o

● Los caracteres de marca de fin
parametrizados no se encuentran
dentro de la máxima longitud
permitida.

● Complete los caracteres de marca de fin
en el búfer de emisión en el lugar
deseado.

0517

La longitud de transmisión > 400 bytes
es demasiado grande para el CP

Divida la orden en varias órdenes de una
longitud menor.

051D

Orden de transmisión/recepción inte‐
rrumpida por

Repita la llamada al bloque del comunica‐
ción.

● reset del bloque de comunicación
● reparametrización
0522

Se ha iniciado una nueva orden SEND
No inicie la nueva orden SEND hasta que la
aunque la orden antigua aún no ha fina‐ orden antigua haya finalizado con DONE o
lizado.
ERROR.

0701

Sólo con 3964(R):
Transmisión de la primera repetición:
● Se ha detectado un error durante el
envío del telegrama o bien
● El interlocutor ha solicitado una
repetición con un carácter de
confirmación negativo (NAK).

0702

Sólo con 3964(R):
Error al establecer la conexión:
Tras el envío de STX se ha recibido NAK
o un carácter cualquiera (salvo DLE o
STX).

0703

Sólo con 3964(R):
Se ha excedido el tiempo de retardo de
acuse (TRA):
Tras el envío de STX no se ha recibido
ninguna respuesta del interlocutor en el
tiempo de retardo de acuse.

0704

Sólo con 3964(R):
Cancelación por parte del interlocutor:
Durante el proceso de transmisión en
curso el interlocutor ha recibido uno o
varios caracteres.

7162

Un reintento no es un error, pero puede ser
un indicio de que hay interferencias en la
línea de transmisión o de que el interlocutor
no funciona correctamente. Si una vez al‐
canzado el número máximo de repeticiones
el telegrama no ha podido ser enviado, se
notifica un número de error que describe el
error que se produjo en primer lugar.
Compruebe el comportamiento erróneo del
dispositivo interlocutor, en caso necesario
con un dispositivo de comprobación de in‐
terfaz conectado a la línea de transmisión.
El dispositivo interlocutor es demasiado len‐
to o no está preparado para recibir o bien p.
ej. hay una rotura en la línea de transmisión.
Compruebe el comportamiento erróneo del
dispositivo interlocutor, en caso necesario
con un dispositivo de comprobación de in‐
terfaz conectado a la línea de transmisión.
Compruebe si el interlocutor también indica
errores porque no se han recibido todos los
datos enviados (p. ej. debido a una rotura en
la línea de transmisión) o que haya fallos
graves, o bien un comportamiento erróneo
del interlocutor. Dado el caso, verifíquelo
con un dispositivo de comprobación de in‐
terfaz conectado a la línea de transmisión.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0705

Sólo con 3964(R):

Compruebe si el interlocutor también indica
error porque quizá no han llegado todos los
datos de transmisión (p. ej. rotura de la línea
de transmisión), existen interferencias gra‐
ves o el interlocutor no funciona correcta‐
mente. Dado el caso, verifíquelo con un dis‐
positivo de comprobación de interfaz conec‐
tado a la línea de transmisión.

Acuse negativo durante la transmisión

0706

Sólo con 3964(R):
Error en el extremo de la conexión:
● El telegrama ha sido rechazado por
el interlocutor con NAK u otro
carácter al final (con la excepción de
DLE) o bien
● El carácter DLE se ha recibido
demasiado pronto.

0707

Sólo con 3964(R):
Tiempo de retardo de acuse al final de la
conexión/tiempo de vigilancia de res‐
puesta excedido tras el telegrama de
transmisión:

Compruebe si el interlocutor también indica
errores porque no se han recibido todos los
datos enviados (p. ej. debido a una rotura en
la línea de transmisión) o que haya fallos
graves, o bien un comportamiento erróneo
del interlocutor. Dado el caso, verifíquelo
con un dispositivo de comprobación de in‐
terfaz conectado a la línea de transmisión.
El interlocutor es demasiado lento o falla.
Dado el caso, verifíquelo con un dispositivo
de comprobación de interfaz conectado a la
línea de transmisión.

Tras deshacer la conexión con DLE ETX
no ha llegado ninguna respuesta del in‐
terlocutor dentro del TRA.
0708

Sólo con driver ASCII:
El tiempo de espera a XON o CTS = ON
ha transcurrido.

0709

Sólo con 3964(R):
No es posible establecer la conexión, se
ha sobrepasado el número de intentos
de establecimiento permitido.

070A

Sólo con 3964(R):
Los datos no han podido ser transmiti‐
dos, se ha sobrepasado el número de
intentos de transmisión permitido.

070B

Sólo con 3964(R):

El interlocutor falla, es demasiado lento o
está offline. Compruebe el interlocutor o mo‐
difique la parametrización en caso necesa‐
rio.
Revise el cable de la interfaz o los paráme‐
tros de la transmisión.
Compruebe también en el interlocutor si la
función de recepción entre la CPU y el CP
está correctamente parametrizada.
Revise el cable de la interfaz o los paráme‐
tros de la transmisión.

Cambie la parametrización.

El conflicto de inicialización no puede re‐
solverse, puesto que ambos interlocuto‐
res tienen ajustada prioridad alta.
070C

Sólo con 3964(R):

Cambie la parametrización.

El conflicto de inicialización no puede re‐
solverse, puesto que ambos interlocuto‐
res tienen ajustada prioridad baja.

Programación del PLC
Manual de programación y manejo, 11/2019

7163

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0801

Sólo con 3964(R):

Un reintento no es un error, pero puede ser
un indicio de que hay interferencias en la
línea de transmisión o de que el interlocutor
no funciona correctamente. Si una vez al‐
canzado el número máximo de repeticiones
el telegrama no ha podido ser enviado, se
notifica un número de error que describe el
error que se produjo en primer lugar.

Esperando al primer reintento:
Al recibir un telegrama se ha detectado
un error y el CP exige mediante un acuse
negativo (NAK) un reintento del interlo‐
cutor.
0802

Sólo con 3964(R):
Error al establecer la conexión:
● En posición de reposo se han
recibido uno o más caracteres
(cualquiera con la excepción de NAK
o STX) o bien

Compruebe el comportamiento erróneo del
dispositivo interlocutor, en caso necesario
con un dispositivo de comprobación de in‐
terfaz conectado a la línea de transmisión.

● Tras la recepción de un STX el
interlocutor ha enviado otros
caracteres sin esperar a recibir la
respuesta DLE.
Tras conectar la alimentación del interlo‐
cutor:
● Durante el tiempo de conexión del
interlocutor, el CP recibe un carácter
indefinido.
0805

Sólo con 3964(R):
Error lógico durante la recepción:
Tras la recepción de DLE se ha recibido
otro carácter cualquiera (salvo DLE,
ETX).

0806

Compruebe que el interlocutor no haya in‐
cluido el DLE por duplicado en el encabeza‐
do del telegrama o en la cadena de datos, y
que la conexión se establezca con DLE
ETX. Compruebe el comportamiento erró‐
neo del dispositivo interlocutor, en caso ne‐
cesario con un dispositivo de comprobación
de interfaz conectado a la línea de transmi‐
sión.

Transcurrido el tiempo de retardo carac‐ El interlocutor es demasiado lento o falla.
Dado el caso, verifíquelo con un dispositivo
teres (TRC):
de comprobación de interfaz conectado a la
● No se han recibido dos caracteres
línea de transmisión.
consecutivos dentro del TRC o bien
Sólo con 3964(R):
● El 1.er carácter tras la transmisión de
DLE al establecer la conexión no se
ha recibido dentro del TRC.

0807

Longitud de telegrama no permitida:
Se ha recibido un telegrama de longitud
0.

7164

La recepción de un telegrama de longitud 0
no es un error.
Compruebe por qué el interlocutor envía te‐
legramas sin datos útiles.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0808

Sólo con 3964(R):

Compruebe que la conexión no tenga fuer‐
tes interferencias. De ser así, observará de
vez en cuando códigos de error. Comprue‐
be el comportamiento erróneo del dispositi‐
vo interlocutor, en caso necesario con un
dispositivo de comprobación de interfaz co‐
nectado a la línea de transmisión.

Error en el carácter de control de bloque
BCC:
El valor interno del BCC no concuerda
con el BCC recibido por el interlocutor en
el extremo de la conexión.
0809

Sólo con 3964(R):
Agotado tiempo de espera a repetición
de bloque

080A

No hay ningún búfer de recepción libre:
Durante la recepción no se disponía de
ningún búfer de recepción vacío.

080C

Error de transmisión:
● Se ha detectado un error de
transmisión (error de paridad, error
de bit de parada, error de
desbordamiento).
Sólo con 3964(R):
● Si durante la posición de reposo se
recibe un carácter defectuoso, el
error se indica inmediatamente para
facilitar la detección precoz de fallos
en la línea de transmisión.

Parametrice en el interlocutor el mismo tiem‐
po de espera de bloque que en el CP 440. Si
fuese necesario, verifique el comportamien‐
to erróneo del interlocutor con un dispositivo
de test de interfaz conectado a la línea de
transferencia.
La instrucción RECV_440 se debe llamar
con más frecuencia.
Las interferencias en la línea de transmisión
provocan repeticiones del telegrama redu‐
ciendo el paso de datos útiles. Todo ello au‐
menta el riesgo de que exista un error no
detectado. Modifique la configuración del
sistema o el tendido de cables.
Compruebe la línea de conexión de los in‐
terlocutores y asegúrese de que en ambos
interlocutres esté ajustada la misma veloci‐
dad de transmisión, la misma paridad y el
mismo número de bits de parada.

Sólo con 3964(R):
● Si esto ocurre durante el modo de
transmisión o recepción, se inician
repeticiones.
080D

BREAK:

Restablezca la conexión o conecte al inter‐
La línea de recepción hacia el interlocu‐ locutor.
tor está interrumpida.

080E

Desbordamiento de búfer de recepción
con control de flujo no habilitado.

En el programa de usuario debe llamarse
con más frecuencia la instrucción para la re‐
cepción, o bien debe parametrizarse una
comunicación con control de flujo.

0810

Error de paridad

Compruebe la línea de conexión de los in‐
terlocutores y asegúrese de que en ambos
interlocutres esté ajustada la misma veloci‐
dad de transmisión, la misma paridad y el
mismo número de bits de parada.

Programación del PLC
Manual de programación y manejo, 11/2019

7165

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0811

Error de trama de caracteres

Compruebe la línea de conexión de los in‐
terlocutores y asegúrese de que en ambos
interlocutres esté ajustada la misma veloci‐
dad de transmisión, la misma paridad y el
mismo número de bits de parada.
Modifique la configuración del sistema o el
tendido de cables.

0812

Sólo con driver ASCII:
Después de que el CP enviara XOFF o
pusiera CTS a OFF, se recibieron más
caracteres.

7166

Vuelva a parametrizar el interlocutor o pro‐
cure una lectura más rápida de los datos en
el CP.

0814

Siempre que sea posible, trabaje con con‐
Se han perdido uno o varios telegramas, trol de flujo. Utilice el búfer de recepción
puesto que se ha trabajado sin control de completo. En los parámetros predetermina‐
dos, configure el parámetro "Reacción a
flujo.
CPU-STOP" predeterminando "Continuar
funcionamiento".

0816

La longitud de un telegrama recibido era Es necesaria una corrección en el interlocu‐
superior a la longitud máxima parametri‐ tor.
zada

0820

Error estático al lamar la SFC RD_REC. Analice la variable SFCERR del DB de ins‐
El valor de retorno RET_VAL de la SFC tancia.
queda disponible en la variable SFCERR
del DB de instancia para su evaluación.

0B01

El búfer de recepción está lleno en más
de 2/3 partes

Llame con más frecuencia al bloque de re‐
cepción, para evitar el desbordamiento del
búfer de recepción.

8000

No existe firmware del módulo

Realice una actualización de firmware.

1E0D

● Interrupción de orden por rearranque
completo, rearranque, reset, o

● Repita la orden.

● porque no existe el módulo.

● Compruebe si está enchufado el
módulo.

Sólo con driver ASCII:

1E0E

Error estático al llamar la SFC RD_REC. Cargue la variable SFCERR del DB de ins‐
El valor de retorno RET_VAL de la SFC tancia.
queda disponible en la variable SFCERR
del DB de instancia para su evaluación.

1E0F

Error estático al llamar la SFC WR_REC. Cargue la variable SFCERR del DB de ins‐
El valor de retorno RET_VAL de la SFC tancia.
queda disponible en la variable SFCERR
del DB de instancia para su evaluación.

1E41

El número de bytes indicado en el pará‐ Respete el rango de valores de 1 a 400
metro LEN de las instrucciones no está bytes.
permitido.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
Sólo se envía un mensaje de error si simultáneamente está activado el bit ERROR (orden
interrumpida con errores). En cualquier otro caso la palabra de STATUS es cero.

Llamada a variable SFCERR
Puede obtener más información sobre el error producido, 14 (1E0EH) y 15 (1E0FH) de la clase
de evento 30, a través de la variable SFCERR.
La variable SFCERR se puede cargar desde el DB instancia de la instrucción correspondiente.
Los mensajes de error que se registran en la variable SFCERR se encuentran en las funciones
de sistema SFC 58 en "WR_REC: Escribir registro en periferia" y SFC 59 en "RD_REC: Leer
registro de periferia".

Consulte también
WR_REC: Escribir registro en periferia (Página 5927)
RD_REC: Leer registro de periferia (Página 5922)

Acoplamiento PtP CP 441
Instrucciones de comunicación
Introducción
El CP 441 no sólo se comunica a través de bloques propios sino también a través de
instrucciones del sistema de automatización S7-400.
El sistema de automatización S7-400 pone a disposición una serie de instrucciones que inician
y controlan la comunicación entre la CPU y el procesador de comunicaciones CP 441 en el
programa de usuario. Las instrucciones están almacenadas de forma fija en la memoria de la
CPU.

Programación del PLC
Manual de programación y manejo, 11/2019

7167

Instrucciones
4.2 Instrucciones

Instrucciones del sistema de automatización S7-400
La tabla siguiente muestra las instrucciones del sistema de automatización S7-400 que están
disponibles para la comunicación entre la CPU y el CP 441.
Tabla 4-409 Instrucciones del sistema de automatización S7-400
SFB

Significado

BSEND

La instrucción BSEND permite enviar datos desde un área de datos S7 a un interlocutor
con una indicación de destino fija.

BRCV

La instrucción BRCV permite recibir datos de un interlocutor y depositarlos en área de
datos S7.

FETCH

Sólo con RK 512: La instrucción FETCH permite recuperar datos de un interlocutor.

PUT

Sólo con RK 512: la instrucción PUT permite enviar datos a un interlocutor con una
indicación de destino modificable dinámicamente.

PRINT

La instrucción PRINT permite imprimir un texto de aviso con hasta cuatro variables.

STATUS

La instrucción STATUS permite consultar el estado de una conexión.

Información adicional
Para obtener un descripción detallada de las instrucciones del sistema de automatización
S7-400 y sus parámetros, consulte "Resumen de las instrucciones de la comunicación S7".

Consulte también
Sinopsis de las instrucciones para la comunicación S7 (Página 6829)

V24_STAT_441: Leer señales cualificadoras en la interfaz RS232C
Descripción
La instrucción V24_STAT_441 lee de una interfaz del CP 441 las señales cualificadoras RS
232C y las pone a disposición del usuario en los parámetros del bloque. La instrucción
V24_STAT_441 se llama cíclica o estáticamente (sin condiciones) en un programa controlado
por tiempo.

Funcionamiento
Las señales cualificadoras RS 232C se actualizan cada vez que se llama la instrucción
(sondeo cíclico). La interfaz se selecciona indicando en la instrucción V24_STAT_441 como ID
la "ID local" de una de las conexiones que pasan por esta interfaz.

7168

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El resultado binario RB permanece igual.
Nota
Una tensión de entrada positiva en las señales de entrada DSR, CTS, DCD y RI del RS232 C
se reproduce en el estado lógico "1" de las señales de entrada DSR_IN, CTS_IN, DCD_IN y
RI_IN de la instrucción V24_STAT_441 , respectivamente.

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

VAR_INPUT

BOOL

Activa una transmisión con flanco positivo

ID

VAR_INPUT

WORD

Enlace de comunicación unívoco con un
interlocutor

NDR

VAR_OUTPUT

BOOL

Señalizado flanco positivo, el programa
de usuario dispone de nuevos datos reci‐
bidos

ERROR

VAR_OUTPUT

BOOL

Flanco positivo indica error

STATUS

VAR_OUTPUT

WORD

Contiene información de error detallada o
advertencia

DTR_OUT

OUTPUT

BOOL

Data terminal ready,
CP 441 listo para entrar en funcionamien‐
to

DSR_IN

OUTPUT

BOOL

Data set ready,
interlocutor operativo

(salida del CP 441)

(entrada del CP 441)
RTS_OUT

OUTPUT

BOOL

Request to send,
CP 441 listo para enviar1
(salida del CP 441)

CTS_IN

OUTPUT

BOOL

Clear to send,
el interlocutor puede recibir datos del
CP 441 (respuesta a RTS = ON del
CP 441)

DCD_IN

OUTPUT

BOOL

Data Carrier detect,
nivel de señal de recepción

(entrada del CP 441)

(entrada del CP 441)
RI_IN

OUTPUT

BOOL

Ring Indicator,
indicador de llamada
(entrada del CP 441)

Programación del PLC
Manual de programación y manejo, 11/2019

7169

Instrucciones
4.2 Instrucciones

Ejemplo
Tabla 4-410 Ejemplo para acceder a la instrucción V24_STAT_441
AWL
CALL FB 5, DB55
REQ

:= DB30.DBX10.0

ID

:=W#16#1000

NDR

:= DB30.DBX10.1

ERROR

:= DB30.DBX10.2

STATUS

:= DB30.DBW20

DTR_OUT

:= DB30.DBX30.0

DSR_IN

:= DB30.DBX30.1

RTS_OUT

:= DB30.DBX30.2

CTS_IN

:= DB30.DBX30.3

DCD_IN

:= DB30.DBX30.4

RI_IN

:= DB30.DBX30.5

V24_SET_441: Escribir señales cualificadoras en la interfaz RS232C
Descripción
El usuario puede activar o desactivar las correspondientes salidas de la interfaz a través de las
entradas de parámetros de la instrucción V24_SET_441 desde una interfaz del CP 441 . La
instrucción V24_SET_441 se llama cíclica o estáticamente (sin condiciones) en un programa
controlado por tiempo.

Funcionamiento
La interfaz se selecciona indicando en la instrucción V24_SET_441 como ID la "ID local" de
una de las conexiones que pasan por esta interfaz.
El resultado binario RB permanece igual.

Parámetros

7170

Parámetro

Declaración

Tipo de datos

Descripción

REQ

VAR_INPUT

BOOL

Activa una transmisión con flanco as‐
cendente

ID

VAR_INPUT

WORD

Conexión unívoca con un interlocutor

DONE

VAR_OUTPUT

BOOL

Indica con flanco ascendente que la
petición se ha completado sin errores

ERROR

VAR_OUTPUT

BOOL

Flanco ascendente indica error

STATUS

VAR_OUTPUT

WORD

Contiene información de error detalla‐
da o advertencia

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

RTS

INPUT

BOOL

Request to send,
CP 441 listo para enviar

DTR

INPUT

BOOL

(Forzar salida del CP 441)
Data terminal ready,
CP 441 listo para entrar en funciona‐
miento
(Forzar salida del CP 441)

Ejemplo
Tabla 4-411 Ejemplo para acceder a la instrucción V24_SET_441
AWL
CALL FB 6, DB56
REQ

:= DB40.DBX10.0

ID

:=W#16#1000

DONE

:= DB40.DBX10.1

ERROR

:= DB40.DBX10.2

STATUS

:= DB40.DBW20

RTS

:= DB40.DBX30.2

DTR

:= DB40.DBX30.0

Área de registro de errores SYSTAT
Área de errores del SYSTAT
El área de registro de errores SYSTAT es un área de errores existente en todas las interfaces.
En el SYSTAT se registran todos los errores/eventos que se han producido durante la
transmisión de datos a una interfaz.
Nota
Dado que la petición STATUS se produce de forma asincrónica con respecto al resto de
peticiones que se desarrollan en una interfaz, no es posible asignar a los mensajes de error un
SFB con R_ID determinado. Es decir, puede indicarse qué errores se han producido en una
interfaz pero no qué acceso (número R_ID) ha provocado el error.

Errores/eventos
Los mensajes SYSTAT se registran en los accesos del SFB STATUS en los bytes 2 a 15 del
parámetro LOCAL. Además del byte de error (byte 2) se indican los primeros seis errores/
eventos. El evento 1 es el más antiguo.
Si se producen otros eventos de error, éstos no pueden indicarse si no se borran antes las
entradas más antiguas. Por ello es importante borrar a tiempo el área de registro de errores.
Para ello hay que acceder al SFB STATUS.

Programación del PLC
Manual de programación y manejo, 11/2019

7171

Instrucciones
4.2 Instrucciones
Los errores/eventos se registran del siguiente modo:
● Byte 0
● Byte 1
● Byte 2

●
●
●
●
●
●
●

Estado operativo del CP (02H para RUN, 05H para defectuoso)
Reservado
Bit 0 -F Error registrado en el SYSTAT
Bit 1 -U Desbordamiento de errores
Bit 2 -B Break
Reservado
Evento 1:
Evento 2:
Evento 3:
Evento 4:
Evento 5:
Evento 6:

Byte 3
Byte 4/5
Byte 6/7
Byte 8/9
Byte 10/11
Byte 12/13
Byte 14/15

Categorías de evento
Clase de evento Significado
1

Error de hardware en el CP

2

Error al inicializar

3

Error al parametrizar las instrucciones

4

Error detectado por el CP en la comunicación CP - CPU

5

Error al procesar una petición de la CPU

6

Error al procesar una petición del interlocutor (sólo con RK 512)

7

Error de transmisión

8

Error de recepción

9

Se recibió telegrama de respuesta erróneo o telegrama de error del interlocutor
acoplado

10 (0AH)

Errores del telegrama de respuesta del interlocutor que fueron detectados por el CP

Números de evento
Código de
error
(W#16#...)

Descripción

Remedio

0101

Error en la comprobación del EPROM del
sistema operativo del CP

CP defectuoso, debe cambiarse el CP.

0102

Error en comprobación de RAM del CP

0103

Interfaz solicitante del CP defectuosa

0104

No hay submódulo interfaz insertado

Inserte un submódulo interfaz apropiado
para el CP.

0105

● Memoria de parámetros defectuosa

Cambie el CP o bien inserte un submódulo
interfaz apropiado para el CP.

● Submódulo interfaz extraído tras
parametrización

7172

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0110

Error en el firmware del CP

Desconecte el módulo y vuelva a conectar‐
lo. Si es necesario, cambie el módulo.

0201

No hay parámetros disponibles

Cargue los parámetros de la interfaz.

Memoria de parámetros vacía o contenido
desconocido
0208

La parametrización no concuerda con el
submódulo interfaz.

Comprobar la configuración de parámetros
del submódulo interfaz con la parametriza‐
ción.

020F

Al iniciarse la comunicación parametrizada
se detecta una parametrización no válida.
No se ha podido parametrizar la interfaz.

Corrija la parametrización no válida y reini‐
cie.

0210

Velocidad total de transferencia sobrepa‐
sada

Reduzca la velocidad de transferencia de
ambas interfaces de modo que no se so‐
brepase la velocidad total de transferencia.

0211

Velocidad total de transferencia de nuevo
dentro del margen permitido

Se ha sobrepasado la velocidad total de
transferencia con anterioridad. Ahora vuel‐
ve a estar dentro del margen permitido

0301

Tipo de datos de fuente o destino no válido
o no disponible

Revise la parametrización de CPU y CP y
corríjala en caso necesario.

Área (dirección de inicio, longitud) no válida Solo en RK 512: El interlocutor transmite
parámetros no válidos en el encabezado
del telegrama.

DB no disponible o no válido (p. ej. DB 0) o
bien
otro tipo de datos de fuente o destino no
válido o no disponible

Revise la parametrización de CPU y CP y
configure un bloque en caso necesario.
Consulte los tipos de datos válidos en las
tablas de peticiones.
Sólo con RK 512: El interlocutor transmite
parámetros incorrectos en el encabezado
del telegrama.

0302

Área demasiado corta

Revise la parametrización de CPU y CP y
compruebe el bloque/área en caso necesa‐
rio.
Sólo en RK 512:El interlocutor transmite
parámetros incorrectos en el encabezado
del telegrama.

0303

No es posible acceder al área

Revise la parametrización de CPU y CP.
Consulte las direcciones de inicio y las lon‐
gitudes válidas en las tablas de peticiones.
Sólo con RK 512: El interlocutor transmite
parámetros incorrectos en el encabezado
del telegrama.

0401

CP no puede aceptar ninguna petición (so‐ Reduzca el número de peticiones simultá‐
brecarga).
neas al CP en el programa de usuario.

0402

El CP no puede procesar este tipo de peti‐ Compruebe si los bloques de función de
ción.
sistema a que ha accedido desde el pro‐
grama de usuario están autorizados para el
CP.

Programación del PLC
Manual de programación y manejo, 11/2019

7173

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0403

Tipo de datos erróneo, desconocido o no
autorizado

Revise el programa, p. ej. error en la para‐
metrización del SFB.

0407

Error en la transferencia de datos entre la Compruebe el área de datos de destino en
la CPU. Compruebe la parametrización
CPU y el CP. No es posible recibir datos
porque no puede accederse al área de da‐ "Respuesta a una parada de la CPU".
tos de destino de la CPU o bien el área de
destino de la CPU no existe o es demasia‐
do corta. No es posible escribir datos en el
área de destino ni leer datos del área de
datos fuente de la CPU en estado STOP de
la CPU a causa de la parametrización.

0408

● Sólo para 3964R y driver ASCII
● Error temporal en la transferencia de
datos entre la CPU y el CP (recepción).
La petición se repetirá porque la CPU
está temporalmente sobrecargada, el
bloque de recepción (BRCV) se llama
demasiado poco o el bloque de
recepción está bloqueado
temporalmente.

0409

● Sólo para 3964R y driver ASCII
● Error en la transferencia de datos entre
la CPU y el CP. No es posible recibir
datos. Tras varios intentos (véase
(04)07H), la petición se ha cancelado al
cabo de 10s porque el bloque de
recepción (BRCV) no se llama o está
bloqueado.

040B

Error en la transmisión de datos entre la
CPU y el CP porque
● no se ha configurado ningún enlace
● no es posible la recepción a través del
enlace configurado

7174

● Reducir la cantidad de llamadas de
comunicación. Llamar el bloque de
recepción con más frecuencia.
Comprobar si el bloque de recepción
está bloqueado durante demasiado
tiempo.

● Comprobar si el bloque de recepción se
llama o está bloqueado.

● Configure la conexión en "NetPro"
● En "NetPro" indique en "Propiedades
del objeto del enlace" para sentido de la
comunicación:
–

2: Interlocutor → Local o

–

3: Local ↔ Interlocutor

0501

La petición en marcha ha sido interrumpida
por un rearranque del CP.

En caso de conexión de la alimentación no
hay ninguna solución. Al reparametrizar el
CP desde la unidad de programación, an‐
tes de describir una interfaz debe asegu‐
rarse de que no se ejecuten más peticiones
desde la CPU.

0502

La petición no es válida en este estado
Parametrice la interfaz de dispositivo.
operativo del CP (p. ej. interfaz de disposi‐
tivo no parametrizada).

0503

Hora errónea, formato incorrecto

Compruebe los parámetros de la hora.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0505

Sólo con driver de impresora:

Configure el texto de aviso con el software
de parametrización y reinicie.

Bloque de datos del sistema con textos de
aviso no disponible en CP
0506

Sólo con driver de impresora:
Texto de aviso no disponible

0507

Sólo con driver de impresora:
Texto de aviso demasiado largo

0508

Sólo con driver de impresora:
Demasiadas instrucciones de conversión

0509

Sólo con driver de impresora:
Demasiadas variables

050A

Sólo con driver de impresora:
Instrucción de conversión desconocida

050B

Sólo con driver de impresora:
Instrucción de control desconocida

050C

Sólo con driver de impresora:
Instrucción de conversión no ejecutable

Configure los textos de aviso con el softwa‐
re de parametrización y reinicie.
Modifique el texto de aviso hasta un máxi‐
mo de 150 caracteres (a un máximo de 250
caracteres en caso de variables)
Ha configurado más instrucciones de con‐
versión que variables. Las instrucciones de
conversión sin la variable correspondiente
se ignoran.
Ha configurado más variables que instruc‐
ciones de conversión. Las variables sin ins‐
trucción de conversión no se imprimen.
Revise la instrucción de conversión. Las
instrucciones de conversión no definidas o
no compatibles se sustituyen por ****** en
la impresión.
Revise la instrucción de control. Las ins‐
trucciones de control indefinidas o incom‐
patibles se ignoran. La instrucción de con‐
trol tampoco se imprime en forma de texto.
Revise la instrucción de conversión. Las
instrucciones de conversión no ejecutables
se imprimen con caracteres * de acuerdo
con el ancho definido y la parte válida res‐
tante de la instrucción o bien de la repre‐
sentación estándar.

050D

Corrija el ancho especificado para la varia‐
Ancho insuficiente o excesivo en la instruc‐ ble de la instrucción de conversión a partir
del número máximo de caracteres de la va‐
ción de conversión
riable en los modos de representación ba‐
sados en texto (A, C, D, S, T, Y, Z). En la
impresión sólo se imprime el número de
caracteres correspondiente al ancho espe‐
cificado, el resto no se imprime. En el resto
de casos se imprimen caracteres * en la
cantidad equivalente al ancho.

050E

Complemente los caracteres de marca de
Error al enviar. Los caracteres de marca de fin en el lugar deseado del búfer de envío o
fin parametrizados no han aparecido den‐ seleccione una longitud de telegrama me‐
tro de la longitud máxima admitida o bien se nor en la generación automática de anexos.
ha excedido la longitud de envío máxima al
generarse anexos automáticamente.

050F

Número de peticiones simultáneas dema‐
siado elevado

Modifique su programa STEP 7 de modo
que se ejecuten menos peticiones simultá‐
neamente.

0510

Área ocupada (recurso).

Repita la petición.

Sólo con driver de impresora:

Sólo con driver ASCII:

Programación del PLC
Manual de programación y manejo, 11/2019

7175

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0511

Longitud no válida para este tipo de peti‐
ción.

Divida los datos a transmitir en varias peti‐
ciones.

0512

Sólo en RK 512: Los parámetros de fuente
y destino especificados en el SFB no se
corresponden.

Consulte los valores válidos en las tablas
de peticiones.

0513

Error en el tipo de datos (DB ...):

Consulte los tipos de datos autorizados y
las correspondientes combinaciones en las
tablas de peticiones.

Tipo de datos desconocido o tipo de datos
no autorizado (p. ej. DE)
Sólo en RK 512: Los tipos de datos de fuen‐
te y destino especificados en el SFB no se
corresponden.
0514

Direcciones de inicio demasiado elevadas
para el tipo de datos deseado o dirección
de inicio o nº DB/DX demasiado bajo.

Consulte en la tabla de peticiones las direc‐
ciones de inicio y los números DB/DX que
pueden definirse en el programa.

0515

Sólo en RK 512: Número de bit erróneo en
la marca de coordinación.

Nº de bit válido: 0 a 7

0516

Sólo en RK 512: Número de CPU demasia‐ Nº de CPU válido: ninguno, 1, 2, 3 ó 4
do elevado.

0517

Error al recibir. El telegrama de recepción Reduzca la longitud de telegrama de su in‐
es mayor que 4 kbytes o mayor que la "lon‐ terlocutor o prolongue el DB de recepción.
gitud de recepción fija" parametrizada o
bien no se ajusta al área de datos de desti‐
no.

0518

Longitud de transmisión demasiado eleva‐
da en el envío ( >4 kbytes).

Sólo en RK 512: Consulte las longitudes
válidas en las tablas de peticiones.
Divida la petición en varias peticiones de
una longitud menor.

0519

CP en modo de operación incorrecto para
petición de autómata

Compruebe si la interfaz solicitada está pa‐
rametrizada.

051A

Sólo en RK 512: Error al enviar un telegra‐ Vea las medidas de solución en el número
ma de orden
de evento anterior.
Se ha registrado un número de error de
procedimiento inmediatamente antes en
STATUS.

051B

Sólo con driver de impresora:
Precisión no válida

051C

Sólo con driver de impresora:

Corrija la precisión indicada en la instruc‐
ción de conversión. La precisión siempre
está precedida por un punto que identifica y
limita el ancho (p. ej.: ".2" para la impresión
de punto flotante y 2 posiciones tras la co‐
ma). La precisión sólo es relevante en los
modos de representación F, R, A y D. En el
resto de casos se ignora.
Corrija la variable de envío indicada.

Variable no válida
(Longitud de variable incorrecta/tipo inco‐
rrecto)

7176

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0601

Error en el 1er byte de orden (no es 00 ó
FFH)

En principio, error de estructura de encabe‐
zado en el interlocutor. Compruebe el com‐
portamiento erróneo del dispositivo interlo‐
cutor si corresponde con un dispositivo de
comprobación de interfaz conectado a la
línea de transmisión.

0602

Error en el 3er byte de orden (no es A, 0 ó
E)

En principio, error de estructura de encabe‐
zado en el interlocutor. Compruebe el com‐
portamiento erróneo del dispositivo interlo‐
cutor si corresponde con un dispositivo de
comprobación de interfaz conectado a la
línea de transmisión.

0603

Error en el 3er byte de orden en telegramas
de continuación (la orden no es como en el
1er telegrama)

En principio, error de estructura de encabe‐
zado en el interlocutor. Compruebe el com‐
portamiento erróneo del dispositivo interlo‐
cutor si corresponde con un dispositivo de
comprobación de interfaz conectado a la
línea de transmisión.

0604

Error en el 4º byte de orden (letra de orden
incorrecta)

En principio, error de estructura de encabe‐
zado en el interlocutor o se ha solicitado
una combinación de órdenes no autorizada
en el CP. Compruebe que las órdenes son
válidas. Compruebe el comportamiento
erróneo del dispositivo interlocutor si co‐
rresponde con un dispositivo de comproba‐
ción de interfaz conectado a la línea de
transmisión.

0605

Error en el 4º byte de orden en el telegrama
de continuación (la orden no es como en el
1er telegrama)

En principio, error de estructura de encabe‐
zado en el interlocutor. Compruebe el com‐
portamiento erróneo del dispositivo interlo‐
cutor si corresponde con un dispositivo de
comprobación de interfaz conectado a la
línea de transmisión.

0606

Error en el 5º byte de orden (Nº de DB no
válido)

Consulte los números de DB, las direccio‐
nes de inicio y las longitudes válidas en las
tablas de peticiones.

0607

Error en el 5º ó 6º byte de orden (dirección
de inicio demasiado elevada)

Consulte los números de DB, las direccio‐
nes de inicio y las longitudes válidas en las
tablas de peticiones.

0608

Error en el 7º u 8º byte de orden (longitud no Consulte los números de DB/DX, las direc‐
válida)
ciones de inicio y las longitudes válidas en
las tablas de peticiones.

0609

Error en el 9º y 10º byte de orden (marca de
coordinación no válida en este tipo de da‐
tos o número de bit demasiado elevado)

En principio, error de estructura de encabe‐
zado en el interlocutor. Consulte en la tabla
de peticiones cuándo está permitida una
marca de coordinación.

060A

Error en el 10º byte de error (Nº de CPU no
válido)

En principio, error de estructura de encabe‐
zado en el interlocutor

Programación del PLC
Manual de programación y manejo, 11/2019

7177

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

060B

Telegrama SEND de mayor/menor longitud Es necesaria una corrección en el interlo‐
que la esperada (se han recibido más/
cutor
menos datos de los anunciados en el en‐
cabezado de telegrama).

060C

Recibido telegrama de orden GET con da‐
tos útiles.

060D

EL CP ha recibido el telegrama en un modo
de operación no válido.
● El enlace de recepción entre la CPU y el
CP no está estructurado correctamente
● El CP todavía no ha arrancado por
completo
● La interfaz solicitada se está
reparametrizando es este momento

060E

Error de sincronización del interlocutor
● Se ha recibido un nuevo telegrama de
orden (de continuación) antes de haber
enviado un telegrama de respuesta.
● 1. Se esperaba 1er telegrama de orden
y se ha recibido un telegrama de
continuación.
● Se esperaba telegrama de orden de
continuación y se ha recibido el 1er
telegrama.

060F

Remedio

Es necesaria una corrección en el interlo‐
cutor
● Compruebe si la conexión que se
intenta establecer está (bien)
parametrizada.
● Este aviso de error sólo puede aparecer
durante el arranque del CP. Repita la
petición
● Se trata de un error temporal. Repita la
petición.
Este error puede indicarse tras un reinicio
del autómata propio en caso de telegramas
de gran longitud o de reinicio del interlocu‐
tor. En estos casos se trata de un compor‐
tamiento de arranque normal del sistema.
Durante el funcionamiento normal, el error
también puede aparecer como consecuen‐
cia de estados de error que sólo ha reco‐
nocido el interlocutor.
En cualquier otro caso debe partir de un
comportamiento erróneo del dispositivo in‐
terlocutor. El error puede no producirse en
peticiones <128 bytes.

DB bloqueado por función de coordinación En el propio programa: Tras el procesa‐
miento de los últimos datos transmitidos,
desbloquear el bloque de recepción con
"EN".
En el programa del interlocutor: Repetición
de la petición

7178

0610

Se ha recibido un telegrama de longitud
demasiado reducida (longitud <4 bytes pa‐
ra telegramas de continuación o reacción o
longitud <10 bytes para telegramas de or‐
den)

Compruebe el comportamiento erróneo del
dispositivo interlocutor si corresponde con
un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.

0611

La longitud del telegrama y la longitud es‐
pecificada en el encabezado de telegrama
no coinciden.

Compruebe el comportamiento erróneo del
dispositivo interlocutor si corresponde con
un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.

0612

Error al enviar el telegrama de respuesta
Vea las medidas de solución correspon‐
(de continuación), se ha registrado un nú‐ dientes al número de error registrado inme‐
mero de error de procedimiento inmediata‐ diatamente antes en STATUS.
mente antes en STATUS.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0701

Envío del primer reintento:

Un reintento no es un error, si bien puede
ser un indicio de que se ha producido un
fallo en la línea de transmisión o que el in‐
terlocutor no funciona correctamente (com‐
portamiento erróneo del interlocutor). Si
una vez alcanzado el número máximo de
repeticiones el telegrama no ha podido ser
enviado, se registra un Nº de error que des‐
cribe el error que apareció en primer lugar.

● Se ha detectado un error durante el
envío del telegrama o bien
● El interlocutor ha solicitado una
repetición con un carácter de
confirmación negativo (NAK).

0702

Compruebe el comportamiento erróneo del
Error al establecer la conexión:
● Tras el envío de STX se ha recibido un dispositivo interlocutor si corresponde con
carácter cualquiera (menos DLE o STX) un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.
o bien
● La respuesta se produjo demasiado
pronto o bien
● Se ha producido un conflicto de
inicialización

0703

El dispositivo interlocutor es demasiado
lento o no está preparado para recibir o
Tras en envío de STX no ha llegado ningu‐ bien hay p. ej. una rotura de la línea de en‐
vío. Compruebe el comportamiento erró‐
na respuesta del interlocutor dentro del
neo del dispositivo interlocutor si corres‐
tiempo de retardo de acuse.
ponde con un dispositivo de comprobación
de interfaz conectado a la línea de transmi‐
sión.

0704

Compruebe si también se indica un error en
Durante el proceso de envío actual el inter‐ el interlocutor, ya que puede que no todos
los datos de envío hayan llegado (p. ej. ro‐
locutor ha recibido uno o más caracteres
tura en la línea de envío) o que haya fallos
graves o un comportamiento defectuoso
del dispositivo interlocutor. Compruebe si
es así con un dispositivo de comprobación
de interfaz conectado a la línea de transmi‐
sión.

0705

Acuse negativo durante el envío

Tiempo de retardo de acuse (TRA) trans‐
currido:

Interrupción por parte del interlocutor:

Programación del PLC
Manual de programación y manejo, 11/2019

Compruebe si también se indica un error en
el interlocutor, ya que puede que no todos
los datos de envío hayan llegado (p. ej. ro‐
tura en la línea de envío) o que haya fallos
graves o un comportamiento defectuoso
del dispositivo interlocutor. Compruebe si
es así con un dispositivo de comprobación
de interfaz conectado a la línea de transmi‐
sión.

7179

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0706

Error en el fin del enlace:

Compruebe si también se indica un error en
el interlocutor, ya que puede que no todos
los datos de envío hayan llegado (p. ej. ro‐
tura en la línea de envío) o que haya fallos
graves o un comportamiento defectuoso
del dispositivo interlocutor. Compruebe si
es así con un dispositivo de comprobación
de interfaz conectado a la línea de transmi‐
sión.

● El telegrama ha sido rechazado por el
interlocutor con NAK u otro carácter al
final (con la excepción de DLE) o bien
● El carácter de confirmación (DLE) se ha
recibido demasiado pronto.

0707

Tiempo de retardo de acuse al final del en‐ El dispositivo interlocutor es demasiado
lace/tiempo de vigilancia de respuesta tras lento o es defectuoso. Compruebe si es así
el telegrama de envío agotados:
con un dispositivo de comprobación de in‐
Tras la interrupción de la conexión con DLE terfaz conectado a la línea de transmisión.
ETX no ha llegado ninguna respuesta del
interlocutor dentro del TRA.

0708

Sólo con driver ASCII y driver de impreso‐
ra: El tiempo de espera a XON o CTS = ON
ha transcurrido.

El interlocutor tiene un defecto, es dema‐
siado lento o está offline. Revise el interlo‐
cutor o modifique la parametrización en ca‐
so necesario.

0709

No es posible establecer la conexión, se ha
sobrepasado el número de intentos de es‐
tablecimiento permitido.

Revise el cable de la interfaz o los paráme‐
tros de la transmisión.

070A

Los datos no han podido ser transmitidos,
se ha sobrepasado el número de intentos
de transmisión permitido.

Revise el cable de la interfaz o los paráme‐
tros de la transmisión.

Esperando al primer reintento:

Un reintento no es un error, si bien puede
ser un indicio de que se ha producido un
fallo en la línea de transmisión o que el in‐
terlocutor no funciona correctamente (com‐
portamiento erróneo del interlocutor). Si
una vez alcanzado el número máximo de
repeticiones el telegrama no ha podido ser
enviado, se registra un Nº de error que des‐
cribe el error que apareció en primer lugar.

0801

Al recibir un telegrama se ha detectado un
error y el CP exige mediante un acuse ne‐
gativo (NAK) un reintento del interlocutor.

0802

Compruebe el comportamiento erróneo del
● En posición de reposo se han recibido dispositivo interlocutor si corresponde con
un dispositivo de comprobación de interfaz
uno o más caracteres (cualquiera con la
conectado a la línea de transmisión.
excepción de NAK o STX) o bien
Error al establecer la conexión:

● Tras la recepción de un STX el
interlocutor ha enviado otros caracteres
sin esperar la recepción de la respuesta
DLE.
Tras la conexión de la alimentación del in‐
terlocutor:
● Durante el tiempo de conexión del
interlocutor, el CP recibe un carácter
indefinido.

7180

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)
0805

Descripción

Remedio

Error lógico durante la recepción:

Compruebe si el interlocutor siempre dupli‐
ca DLE en el encabezado del telegrama y
en la cadena de datos o si la interrupción de
la conexión se realiza con DLE ETX. Com‐
pruebe el comportamiento erróneo del dis‐
positivo interlocutor si corresponde con un
dispositivo de comprobación de interfaz co‐
nectado a la línea de transmisión.

Tras la recepción de DLE se ha recibido
otro carácter cualquiera (con la excepción
de DLE, ETX).

0806

Tiempo de retardo de caracteres (TRC)
transcurrido:
● No se han recibido dos caracteres
consecutivos dentro del TRC o bien

El dispositivo interlocutor es demasiado
lento o es defectuoso. Compruébelo con un
dispositivo de comprobación de interfaz co‐
nectado a la línea de transmisión.

● 1. El 1er carácter tras el envío de DLE
en el establecimiento de la conexión no
se ha recibido dentro del TRC.
0808

Compruebe si el enlace está muy deterio‐
Error en el carácter de comprobación de
bloques BCC (sólo con RK 512 con proce‐ rado; en ese caso también pueden apare‐
cer códigos de error de la categoría de
dimiento 3964R y procedimiento 3964R)
El valor del BCC determinado internamente evento 8/ número de error 12. Compruebe
el comportamiento erróneo del dispositivo
no concuerda con el BCC recibido por el
interlocutor si corresponde con un disposi‐
interlocutor al final de la conexión.
tivo de comprobación de interfaz conecta‐
do a la línea de transmisión.

080A

No hay un búfer de recepción libre disponi‐ En el programa de usuario debe llamarse
con más frecuencia la instrucción para la
ble:
Tras la recepción de STX el procedimiento recepción.

no ha podido disponer de un búfer de re‐
cepción libre durante el establecimiento de
la conexión y un tiempo de espera posterior.
080C

Error de transmisión:
Se ha detectado un error de transmisión
(error de paridad, error de bit de parada,
error de rebosamiento).
Si durante la posición de reposo se recibe
un carácter defectuoso, el error se indica
inmediatamente para facilitar la detección
prematura de fallos en la línea de transmi‐
sión.

Los fallos en la línea de transmisión provo‐
can repeticiones del telegrama reduciendo
el paso de datos útiles. El aumento de que
se produzca un error no detectado aumen‐
ta. Modifique la configuración de su siste‐
ma o la disposición de la línea.
Compruebe si la velocidad de transmisión,
la paridad y el número de bit de parada
coinciden en ambos equipos.

Sólo con RK 512 y 3964(R):
Si esto ocurre durante el modo de envío o
recepción, se inician repeticiones.
080D

Establezca la conexión entre los equipos o
conecte
el equipo interlocutor. En el modo
La línea de enlace (línea de recepción) que
TTY,
compruebe
si hay corriente en la línea
llega al equipo interlocutor está interrumpi‐
en estado de reposo.
da.

0812

Vuelva a parametrizar el interlocutor o pro‐
Después de que el CP enviara XOFF o pu‐ cure una lectura más rápida del CP.
siera CTS a OFF, se recibieron más carac‐
teres.

BREAK

Sólo con driver ASCII:

Programación del PLC
Manual de programación y manejo, 11/2019

7181

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0815

La parametrización del número de intentos
de transmisión del CP y del interlocutor no
concuerda

Parametrice en el interlocutor el mismo nú‐
mero de intentos de envío que en el CP.
Compruebe el comportamiento erróneo del
dispositivo interlocutor si corresponde con
un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.

0816

● La longitud de un telegrama recibido
era superior a la longitud máxima
parametrizada o bien

● Es necesaria una corrección en el
interlocutor o bien

● La longitud del buzón configurado (sólo
en CP 441) es demasiado reducida.

● Aumente la longitud del buzón (sólo en
CP 441).

Sólo con driver ASCII:

Antes o durante un proceso de envío el in‐
terlocutor ha puesto todas las señales DSR
o CTS a "OFF".

0818

DSR = OFF o CTS = OFF

Revise el control de las señales cualifica‐
doras RS 232C en el interlocutor.
0902

Sólo en RK 512: Error de acceso a memo‐ Compruebe si el área de datos en cuestión
existe en el interlocutor y si es suficiente‐
ria en el interlocutor (no hay memoria)
mente grande o revise los parámetros del
Con SIMATIC S5 como interlocutor:
bloque de función de sistema llamado.
● Área errónea en palabra indicadora o
Compruebe la longitud indicada en el blo‐
bien
que de función de sistema.
● Área de datos no existente (con la
excepción de DB/DX) o bien
● Área de datos demasiado reducida
(con la excepción de DB/DX)

0903

Sólo en RK 512: Error de acceso DB/DX en Compruebe si el área de datos en cuestión
el interlocutor (DB/DX no existente o dema‐ existe en el interlocutor y si es suficiente‐
siado reducido)
mente grande o revise los parámetros del
bloque de función de sistema llamado.
Con SIMATIC S5 como interlocutor:
● DB/DX no existente o bien
● DB/DX demasiado reducido o bien

Compruebe la longitud indicada en el blo‐
que de función de sistema.

● Nº DB/DX no válido
Sobrepasada área de fuente permitida en
petición GET
0904

Sólo en RK 512: El interlocutor indica "Tipo
de petición no permitido".

Comportamiento erróneo del interlocutor,
ya que el CP 441 nunca envía una orden de
sistema.

0905

Sólo en RK 512: Error en el interlocutor o
con SIMATIC S5 como interlocutor:

Compruebe si el interlocutor puede trans‐
mitir el tipo de datos en cuestión.

● Tipo de fuente/destino no válido o bien

Compruebe la configuración del hardware
del interlocutor.

● Error de memoria en el autómata del
interlocutor o bien
● Error de entendimiento CP/CPU en el
interlocutor o bien

Ponga el selector del autómata del interlo‐
cutor en posición RUN.

● Autómata del interlocutor en modo
STOP

7182

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0908

Sólo en RK 512: El interlocutor detecta
error de sincronización:

0909

Sólo en RK 512: DB/DX bloqueado en el
interlocutor por marca de coordinación

090A

Sólo en RK 512: Error en el encabezado del Compruebe si el error se debe a alguna
telegrama que reconoce el interlocutor: 3er avería o a un comportamiento erróneo del
byte de orden en el encabezado erróneo
interlocutor. Compruébelo con un dispositi‐
vo de comprobación de interfaz conectado
a la línea de transmisión.

090B

Sólo en RK 512: Error en el encabezado de
telegrama: 1. ó 4º byte de orden en el en‐
cabezado erróneo

Compruebe si el error se debe a alguna
avería o a un comportamiento erróneo del
interlocutor. Compruébelo con un dispositi‐
vo de comprobación de interfaz conectado
a la línea de transmisión.

090C

Sólo en RK 512: El interlocutor reconoce
una longitud de telegrama errónea (longi‐
tud total).

Compruebe si el error se debe a alguna
avería o a un comportamiento erróneo del
interlocutor. Compruébelo con un dispositi‐
vo de comprobación de interfaz conectado
a la línea de transmisión.

090D

Sólo en RK 512: Hasta ahora no se ha pro‐ Reinicie el autómata del interlocutor o bien
ducido ningún reinicio en el interlocutor.
ponga el selector de modo de operación del
CP o de la CPU en la posición RUN.

090E

Sólo en RK 512: Se ha recibido un número
de error desconocido en el telegrama de
respuesta.

Compruebe si el error se debe a alguna
avería o a un comportamiento erróneo del
interlocutor. Compruébelo con un dispositi‐
vo de comprobación de interfaz conectado
a la línea de transmisión.

0A01

Sólo en RK 512: Error de sincronización del
interlocutor porque

Este error aparece tras un reinicio del au‐
tómata propio en caso de telegramas de
gran longitud o en caso de reinicio del in‐
terlocutor. Se trata de un comportamiento
normal de la instalación, no debe tomar nin‐
guna medida.

Este error se produce al reiniciar el autó‐
mata propio o el del interlocutor. Se trata de
La secuencia del telegrama es defectuosa. un comportamiento de arranque normal del
sistema. No tiene que tomar ninguna medi‐
da. Durante el funcionamiento normal el
error también puede deberse a errores que
se han producido anteriormente. En cual‐
quier otro caso debe partir de un compor‐
tamiento erróneo del interlocutor.
En el programa del interlocutor: Una vez
procesados los últimos datos transmitidos,
vuelva a anular la marca de coordinación
En el programa: Repita la petición.

● telegrama de respuesta sin petición
● telegrama de respuesta recibido antes
de que se enviara el telegrama de
continuación
● tras el envío de un primer telegrama se
ha recibido un telegrama de respuesta
de continuación
● tras el envío de un telegrama de
continuación se ha recibido el primer
telegrama de respuesta

Programación del PLC
Manual de programación y manejo, 11/2019

Durante el funcionamiento normal, el error
también puede aparecer como consecuen‐
cia de estados de error que sólo ha reco‐
nocido el interlocutor.
En cualquier otro caso debe partir de un
comportamiento erróneo del equipo interlo‐
cutor. El error puede no producirse en peti‐
ciones <128 bytes.

7183

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Remedio

0A02

Sólo en RK 512: Error de parametrización
del telegrama de respuesta recibido
(1er byte no es 00 o FF)

Compruebe el comportamiento erróneo del
dispositivo interlocutor si corresponde con
un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.

0A03

Sólo en RK 512: El telegrama de respuesta
recibido tiene exceso o escasez de datos.

Compruebe el comportamiento erróneo del
dispositivo interlocutor si corresponde con
un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.

0A04

Sólo en RK 512: El telegrama de respuesta Compruebe el comportamiento erróneo del
a una petición SEND ha llegado con datos. dispositivo interlocutor si corresponde con
un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.

0A05

Sólo en RK 512: Dentro del tiempo de vigi‐ ¿Es el interlocutor un equipo demasiado
lancia no se ha recibido ningún telegrama lento? Este error se presenta a menudo co‐
mo consecuencia de un error que se ha
de respuesta del interlocutor.
producido con anterioridad. Pueden indi‐
carse por ejemplo errores de recepción de
procedimiento (categoría de eventos 8)
después de que se enviara un telegrama
GET. Causa: No ha sido posible recibir el
telegrama, el tiempo de vigilancia se ha
agotado. Este error también puede produ‐
cirse si se ha reiniciado el interlocutor antes
de que éste hubiera contestado al último
telegrama GET recibido.

0A06

Sólo en RK 512: El telegrama de respuesta Compruebe el comportamiento erróneo del
recibido tras la petición GET tiene poco da‐ dispositivo interlocutor si corresponde con
tos
un dispositivo de comprobación de interfaz
conectado a la línea de transmisión.

Esclavo Modbus (RTU)
Instrucciones Modbus
Introducción
Para el maestro Modbus no son necesarias instrucciones separadas Modbus para la
comunicación.

7184

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Instrucciones del CP 341
La transferencia de datos entre el CP 341 y la CPU se realiza con las instrucciones P_SND_RK
y P_RCV_RK.
Tabla 4-412 Instrucciones del CP 341
Instrucción

Significado

P_RCV_RK

La instrucción P_RCV_RK permite recibir datos de un interlocutor y depositarlos en
un bloque de datos o poner los datos a disposición del interlocutor.

P_SND_RK

La instrucción P_SND_RK permite enviar a un interlocutor todo el área o un área
parcial de un bloque de datos o recuperar datos del interlocutor.

Instrucciones del sistema de automatización S7-400
La transferencia de datos entre el CP 441 y la CPU se realiza con las instrucciones BSEND y
BRCV.
Tabla 4-413 Instrucciones del sistema de automatización S7-400
SFB

Significado

BSEND

La instrucción BSEND permite enviar datos desde un área de datos S7 a un interlocutor
con una indicación de destino fija.

BRCV

La instrucción BRCV permite recibir datos de un interlocutor y depositarlos en área de
datos S7.

MODB_341: Instrucción de esclavo Modbus para CP 341
Descripción
La instrucción MODB_341 y el respectivo driver permiten una conexión entre el sistema de
control del maestro Modbus y el módulo de comunicación CP 341 como un sistema de esclavo
"apto para Modbus".

Funcionamiento
En el programa de usuario, la instrucción MODB_341 debe llamarse en el programa cíclico. La
instrucción utiliza el DB instancia respectivo IDB_MODB_341 como área de trabajo.
La instrucción MODB_341 inicializa el CP y ejecuta las funciones Modbus que el driver no
puede realizar por sí solo.
Después de cada rearranque completo o rearranque de la CPU se tiene que realizar una
inicialización de la instrucción MODB_341. La inicialización se activa con un flanco ascendente
en la entrada CP_START. La instrucción borra primero el DB instancia, lee las áreas de
operandos I, Q, M, T y C con la instrucción de sistema SZL_LESEN de la CPU y las deposita
en el DB instancia. De ese modo, es posible comprobar si los requisitos de escritura del
sistema maestro Modbus exceden el rango.
Con la petición SEND se notifica al CP el número de los DBs instancia y el transcurso correcto
de la inicialización hasta el momento.

Programación del PLC
Manual de programación y manejo, 11/2019

7185

Instrucciones
4.2 Instrucciones
Tan pronto finalice la petición SEND sin errores, la salida CP_START_OK se activa y la
inicialización de la instrucción concluye.

Parámetros
Parámetro

Declaración Tipo de
datos

LADDR

INPUT

Int

Descripción
Dirección inicial del CP
Aplicar asignación de HW Config

START_TIMER

INPUT

Timer

Temporizador para iniciar el tiempo de vigilancia

START_TIME

INPUT

S5Time

Valor de tiempo para iniciar el tiempo de vigilancia

OB_MASK

INPUT

BOOL

Enmascarar errores de acceso a periferia, retardar
alarmas
FALSE:
Los errores de acceso a la periferia no se enmas‐
caran
TRUE:
Los errores de acceso a la periferia se enmascaran
y las alarmas se retardan

CP_START

INPUT

BOOL

Instrucción Iniciar inicialización

CP_START_FM

INPUT

BOOL

La inicialización se activa con el flanco ascendente
de CP_START.

CP_START_NDR

OUTPUT

BOOL

Información: Requisitos de escritura del CP

CP_START_OK

OUTPUT

BOOL

El arranque ha finalizado sin errores
TRUE:
La petición de inicialización se ha podido ejecutar
sin errores antes de transcurrir el tiempo de vigi‐
lancia.

CP_START_ERROR

OUTPUT

BOOL

El arranque se ha cancelado con errores
TRUE:
La petición de inicialización no se ha podido ejecu‐
tar sin errores ni siquiera después de transcurrir el
tiempo de vigilancia.

ERROR_NR

OUTPUT

Word

Número de error
Asignación véase Parámetro ERROR_NR,
ERROR_INFO (Página 7189)

ERROR_INFO

OUTPUT

Word

Información adicional de error
Asignación véase Parámetro ERROR_NR,
ERROR_INFO (Página 7189)

Comportamiento en caso de error
Si la petición SEND concluye con errores, se desactivará CP_START y se activará
CP_START_ERROR.
Si la inicialización ha finalizado con errores no será posible una comunicación Modbus. Todos
los requisitos del sistema maestro Modbus se responden con un telegrama de código de
excepción.

7186

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Tras una conexión (POWER ON) el CP necesita varios segundos para el test de hardware y
memoria hasta que esté operativo. Los intentos de inicialización realizados por la instrucción
MODB_341 durante este tiempo finalizan con errores. Por eso, la instrucción repite varias
veces su petición de inicialización durante el tiempo de vigilancia.
Si la inicialización finaliza sin errores dentro del START-TIME parametrizado del STARTTIMERS, se activará CP_START_OK. Si la petición de inicialización no se ha podido ejecutar
sin errores incluso después de transcurrir el tiempo de vigilancia, se activará
CP_START_ERROR.

MODB_441: Instrucción de esclavo Modbus para CP 441
Descripción
La instrucción MODB_441 y el respectivo driver permiten una conexión entre el sistema de
control del maestro Modbus y el módulo de comunicación CP 441-2 como un sistema de
esclavo "apto para Modbus".

Funcionamiento
En el programa de usuario, la instrucción MODB_441 debe llamarse en el programa cíclico. La
instrucción utiliza el DB instancia respectivo IDB_MODB_441 como área de trabajo.
Los códigos de función Modbus 01, 02, 03, 04, 06 y 16 se procesan directamente con el CP.
En los códigos de función 05 y 15, la instrucción aplica la entrada de los datos de bit en bit en
el área de memoria SIMATIC.
La instrucción MODB_441 inicializa el CP y ejecuta las funciones Modbus que el driver no
puede realizar por sí solo.
Después de cada rearranque completo o rearranque de la CPU se tiene que realizar una
inicialización de la instrucción MODB_441 . La inicialización se activa con un flanco
ascendente en la entrada CP_START. La instrucción borra primero el DB instancia, lee las
áreas de operandos I, Q, M, T y C con la instrucción de sistema SZL_LESEN de la CPU y las
deposita en el DB instancia. De ese modo, es posible comprobar si los requisitos de escritura
del sistema maestro Modbus exceden el rango.
Con la petición SEND se notifica al CP el número de los DBs instancia y el transcurso correcto
de la inicialización hasta el momento.
Tan pronto finalice la petición SEND sin errores, la salida CP_START_OK se activa y la
inicialización de la instrucción concluye.

Parámetros
Parámetro

Declaración Tipo de
datos

ID

INPUT

Word

Descripción
ID de conexión
ID de conexión de la configuración

START_TIMER

INPUT

Timer

Temporizador para iniciar el tiempo de vigilancia

START_TIME

INPUT

S5Time

Valor de tiempo para iniciar el tiempo de vigilancia

Programación del PLC
Manual de programación y manejo, 11/2019

7187

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de
datos

Descripción

STATUS_TIMER

INPUT

Timer

Temporizador para leer SYSTAT

STATUS_TIME

INPUT

S5Time

Intervalo de tiempo para leer SYSTAT

OB_MASK

INPUT

BOOL

Enmascarar errores de acceso a periferia, retardar
alarmas
FALSE:
Los errores de acceso a la periferia no se enmas‐
caran.
TRUE:
Los errores de acceso a la periferia se enmascaran
y las alarmas se retardan.

CP_START

INPUT

BOOL

Instrucción Iniciar inicialización

CP_START_FM

INPUT

BOOL

La inicialización se activa con el flanco ascendente
de CP_START

CP_START_NDR

OUTPUT

BOOL

Información: Requisitos de escritura del CP

CP_START_OK

OUTPUT

BOOL

El arranque ha finalizado sin errores
TRUE:
La petición de inicialización se ha podido ejecutar
sin errores antes de transcurrir el tiempo de vigi‐
lancia.

CP_START_ERROR

OUTPUT

BOOL

El arranque se ha cancelado con errores
TRUE:
La petición de inicialización no se ha podido ejecu‐
tar sin errores ni siquiera después de transcurrir el
tiempo de vigilancia.

ERROR_NR

OUTPUT

Word

Número de error
Asignación véase Parámetro ERROR_NR,
ERROR_INFO (Página 7189)

ERROR_INFO

OUTPUT

Word

Información adicional de error
Asignación véase Parámetro ERROR_NR,
ERROR_INFO (Página 7189)

Comportamiento en caso de error
Si la petición SEND concluye con errores, se desactivará CP_START y se activará
CP_START_ERROR.
Si la inicialización ha finalizado con errores no será posible una comunicación Modbus. Todos
los requisitos del sistema maestro Modbus se responden con un telegrama de código de
excepción.
Tras una conexión (POWER ON) el CP necesita varios segundos para el test de hardware y
memoria hasta que esté operativo. Los intentos de inicialización realizados por la instrucción
MODB_441 durante este tiempo finalizan con errores. Por eso, la instrucción repite varias
veces su petición de inicialización durante el tiempo de vigilancia.
Si la inicialización finaliza sin errores dentro del START-TIME parametrizado del STARTTIMERS, se activará CP_START_OK. Si la petición de inicialización no se ha podido ejecutar

7188

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
sin errores incluso después de transcurrir el tiempo de vigilancia, se activará
CP_START_ERROR.

Parámetro ERROR_NR, ERROR_INFO
Clases de error
Números de error
de ... a

Descripción

Significado

1 ... 9

Error en la inicializa‐ La inicialización ha finalizado con errores en los números
ción, instrucción y CP de error 1...9. El parámetro CP_START_ERROR es 1.
No es posible la comunicación MODBUS con el sistema
maestro.

10 ... 19

Error al procesar un
código de función

Ha ocurrido un error al procesar un código de función en
los números de error 10...19. El CP ha enviado una peti‐
ción de procesamiento no permitida a la instrucción de
comunicación.
El error también será notificado al driver.
Las siguientes peticiones se seguirán procesando.

90 ... 99

Otros errores

Se ha producido un error de procesamiento.
El error no será notificado al driver.
Las siguientes peticiones se seguirán procesando.

Parámetro ERROR_NR, ERROR_INFO
ERROR_NR
(decimal)

ERROR_INFO

Texto del error

0

0

No hay errores

1

SFC 51->RET_VAL

Error al leer la lista de estado del sistema Analizar RET_VAL en ERROR_INFO, eli‐
con la SFC 51.
minar la causa.

2

Timeout en la inicialización del CP o
error en la inicialización del CP

Solución

Compruebe si el "esclavo MODBUS" ha
sido parametrizado como protocolo para
la interfaz CP.
Analice ERROR_INFO.

10

P_SND_RK -> STA‐
TUS

Error en la petición P_SND_RK

Compruebe la dirección del módulo
LADDR en la instrucción de comunica‐
ción.

SFB 12->STATUS

Error en la petición BSEND

Compruebe la ID de conexión en la ins‐
trucción de comunicación.

Código de procesa‐
miento

Función de procesamiento no válida
transferida por el driver a la instrucción
de comunicación.

Rearranque del CP (POWER ON)

Programación del PLC
Manual de programación y manejo, 11/2019

7189

Instrucciones
4.2 Instrucciones
ERROR_NR
(decimal)

ERROR_INFO

Texto del error

Solución

11

Dirección inicial

Dirección inicial no válida transferida por
el driver a la instrucción de comunica‐
ción.

Comprobar la dirección MODBUS del sis‐
tema maestro MODBUS.

12

Número de registros

Número de registros no válido transferi‐ Comprobar número de registro del siste‐
do por el driver a la instrucción de comu‐ ma maestro MODBUS, dado el caso, rea‐
nicación:
rranque del CP (POWER ON)
Número de registros = 0.

13

Número de registros

Número de registros no válido transferi‐ Comprobar número de registro del siste‐
do por el driver a la instrucción de comu‐ ma maestro MODBUS, dado el caso, rea‐
nicación:
rranque del CP (POWER ON)
Número de registros > 128.

14

Marca M - Dirección
final

Intento de acceso a la "marca" del área
de memoria SIMATIC más allá del final
del área.

Reducir la dirección inicial de MODBUS o
la longitud de acceso en el sistema maes‐
tro MODBUS.

Atención:
La longitud del área en la CPU SIMATIC
depende del tipo de CPU.
15

Salidas Q - Dirección
final

Intento de acceso a las "salidas" del
área de memoria SIMATIC más allá del
final del área.

Reducir la dirección inicial de MODBUS o
la longitud de acceso en el sistema maes‐
tro MODBUS.

Atención:
La longitud del área en la CPU SIMATIC
depende del tipo de CPU.
16

Temporizadores T Dirección final

Intento de acceso a los "temporizadores
(timer)" del área de memoria SIMATIC
más allá del final del área.

Reducir la dirección inicial de MODBUS o
la longitud de acceso en el sistema maes‐
tro MODBUS.

Atención:
La longitud del área en la CPU SIMATIC
depende del tipo de CPU.
17

Contadores C - Direc‐ Intento de acceso a los "contadores" del
ción final
área de memoria SIMATIC más allá del
final del área.

Reducir la dirección inicial de MODBUS o
la longitud de acceso en el sistema maes‐
tro MODBUS.

Atención:
La longitud del área en la CPU SIMATIC
depende del tipo de CPU.
18

0

19
90

Área de memoria SIMATIC no válida
transferida por el driver a la instrucción
de comunicación.

Dado el caso, rearranque del CP (PO‐
WER ON)

Error al acceder a la periferia SIMATIC.

Compruebe si la periferia necesaria exis‐
te y no tiene errores.

P_SND_RK -> STA‐
TUS

Error al enviar al driver un aviso de acu‐ Analizar información de STATUS
se con la instrucción P_SND_RK

SFB 12->STATUS

Error al enviar al driver un aviso de acu‐ Analizar información de STATUS
se con el SFB 12 BSEND

91

SFB 22->STATUS

Error al leer SYSTAT con el SFB 22
(STATUS)

92

P_RCV_RK -> STA‐
TUS

Error al ejecutar una llamada RECEIVE/ Analizar P_RCV_RK-STATUS
FETCH con la instrucción P_RCV_RK

7190

Analizar información de STATUS

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Área de registro de errores SYSTAT
Clases de eventos
Clase de evento

Significado

5

Error al procesar una orden de la CPU

8

Error de recepción

14 (0EH)

Error general de procesamiento

Parámetro STATUS
Código de
error
(W#16#...)

Descripción

Solución

0518

La longitud de transmisión al enviar es demasiado grande
(> 4 KB) o la longitud de transmisión SEND es demasiado
pequeña.

Comprobar la instrucción de comunicación, da‐
do el caso volver a cargar.

0806

Tiempo de retardo de caracteres TRC excedido

Eliminar error en el dispositivo interlocutor o fa‐
llos en la línea de transmisión.

080C

En un carácter se ha detectado un error de transmisión
(error de paridad, error de desbordamiento, error de bit de
parada (trama)).

Compruebe si los fallos afectan a la línea de
transmisión.
Modifique la estructura del sistema o el cablea‐
do si fuera necesario.
Compruebe si los parámetros de protocolo de
velocidad de transmisión, número de bits de
datos, paridad, número de bits de parada están
ajustados en el CP y el interlocutor acoplado.

080D

BREAK
La línea de recepción que llega al dispositivo interlocutor
está interrumpida.

Establezca la conexión entre los dispositivos o
conecte el dispositivo interlocutor.
Compruebe en el modo TTY si la corriente de
línea fluye en el estado de reposo.
Compruebe y modifique, dado el caso, la asig‐
nación previa de la línea de recepción R(A) y
R(B) en una conexión RS422/485(X27).

0830

Broadcast no está permitido con este código de función.

El sistema maestro MODBUS sólo puede em‐
plear broadcast en los códigos de función ha‐
bilitados al efecto.

0831

El código de función recibido no está permitido.

Este código de función no puede emplearse
para este driver.

0832

Se ha sobrepasado el número máximo de bits o registros o
el número de bits no es divisible por 16 al acceder al área
de memoria SIMATIC de temporizadores o contadores.

Limitar el número máximo de bits a 2040 y el
número máximo de registros a 127. Acceso a
los temporizadores/contadores SIMATIC úni‐
camente en tramas de 16 bits.

0833

El número de bits o registros en el código de función FC
15/16 y el elemento de telegrama byte_count no concuer‐
dan.

Corregir número de bits, número de registros o
byte_count.

0834

Se ha detectado una codificación de bits no permitida para
"activar bit"/"desactivar bit".

En FC 05 se deben utilizar únicamente las co‐
dificaciones 0000Hex o FF00Hex.

Programación del PLC
Manual de programación y manejo, 11/2019

7191

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0835

Se ha detectado un subcódigo de diagnóstico no permitido
(≠ 0000Hex) en el código de función FC 08 "Loop Back
Test".

En FC 08 se debe utilizar únicamente el sub‐
código 0000Hex.

0836

El valor creado internamente para la suma de verificación Comprobar la formación de la suma de verifi‐
CRC 16 no coincide con la suma de verificación CRC reci‐ cación CRC en el sistema maestro MODBUS.
bida.

0837

Error de ejecución de telegrama:
el sistema maestro MODBUS ha enviado un nuevo tele‐
grama de solicitud antes de que el driver haya transferido el
último telegrama de respuesta.

Aumente el timeout del telegrama de respuesta
del esclavo en el sistema maestro MODBUS.

0E01

Error al inicializar el proceso SCC específico del driver.

Parametrizar y cargar el driver de nuevo.

0E02

Error de arranque del driver:
Proceso SCC activo erróneo (driver SCC).
El driver no funciona con este driver SCC.

Parametrizar y cargar el driver de nuevo.

0E03

Error de arranque del driver:
Proceso de transmisión de datos activo erróneo (interfaz
hacia los SFBs).
El driver no funciona con este proceso de transmisión de
datos.

Parametrizar y cargar el driver de nuevo.

0E04

Error de arranque del driver:
Módulo de interfaz inadmisible.
El driver no puede utilizarse con el módulo de interfaz pa‐
rametrizado.

Comprobar la parametrización y corregirla.

0E05

Error de dongle del driver:
No hay ningún dongle insertado o el dongle insertado es
defectuoso.
El driver no está operativo.

Compruebe si el dongle del driver está inserta‐
do en el CP.
Si hay un dongle insertado, sustituya el dongle
defectuoso por uno correcto.

0E06

Error de dongle del driver:
El dongle no tiene un contenido válido.
El driver no está operativo.

Consiga un dongle correcto en la sucursal Sie‐
mens en la que adquirió el driver.

0E10

Error de procedimiento interno:
Rama predeterminada en el autómata emisor.

Rearranque del CP (POWER ON)

0E11

Error de procedimiento interno:
Rama predeterminada en el autómata receptor.

Rearranque del CP (POWER ON)

0E12

Error interno de autómata activo:
Rama predeterminada

Rearranque del CP (POWER ON)

0E13

Error interno de autómata pasivo:
Rama predeterminada

Rearranque del CP (POWER ON)

0E20

El número de bits de datos de este acoplamiento debe ser
8.
El driver no está operativo.

Corrija la parametrización del driver.

0E21

El factor de multiplicación parametrizado para el tiempo de
retardo de caracteres no está entre 1 y 10. El driver trabaja
con la configuración estándar 1.

Corrija la parametrización del driver.

0E22

El modo de operación parametrizado del driver no es váli‐
do.
Debe indicarse "Modo normal" o "Modo con supresión de
frecuencias perturbadoras".
El driver no está operativo.

Corrija la parametrización del driver.

7192

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0E23

Se ha parametrizado un valor no válido como dirección de
esclavo. La dirección de esclavo 0 no es válida.
El driver no está operativo.

Corrija la parametrización del driver.

0E24

Se han parametrizado límites no válidos para accesos de
escritura.
El driver no está operativo.

Corrija la parametrización del driver.

0E25

Se ha parametrizado una combinación "de/a" no válida en
la introducción de las áreas "cambio del direccionamiento
Modbus en la FC 01, 05, 15".
(Área de marcas, salidas, temporizadores, contadores).
El driver no está operativo.

Corrija la parametrización del driver.

0E26

Se ha parametrizado una combinación "de/a" no válida en
la introducción de las áreas "cambio del direccionamiento
Modbus en la FC 02".
(Área de marcas, entradas).
El driver no está operativo.

Corrija la parametrización del driver.

0E27

Se ha parametrizado un solapamiento de combinaciones Corrija la parametrización del driver.
"de/a" en la introducción de las áreas "cambio del direccio‐
namiento Modbus en la FC 01, 05, 15".
(Área de marcas, salidas, temporizadores, contadores).
El driver no está operativo.

0E28

Se ha parametrizado un solapamiento de combinaciones Corrija la parametrización del driver.
"de/a" en la introducción de las áreas "cambio del direccio‐
namiento Modbus en la FC 02".
(Área de marcas, entradas).
El driver no está operativo.

0E2E

Se ha producido un error al leer el archivo de parámetros de Rearranque del CP (POWER ON).
la interfaz.
El driver no está operativo.

0E30

Error interno de entrega a la CPU:
Acuse inesperado pasivo.

0E31

Timeout en la entrega de datos a la CPU.

Comprobar la interfaz CP-CPU.

0E32

Error en la entrega de datos con RCV a la CPU:
Analizar la causa - El error detallado se encuentra antes de
esta entrada en SYSTAT.

Comprobar la interfaz CP-CPU.

0E33

Error interno en la entrega de datos CP-CPU:
Estado del autómata no permitido

Comprobar la interfaz CP-CPU.

Se puede ignorar si ocurre esporádicamente.

:
0E38

Se ha producido un error al acceder a una de las áreas
Compruebe si existe el área SIMATIC que se
SIMATIC "marcas, salidas, temporizadores, contadores,
ha llamado y si se ha intentado acceder fuera
entradas" con el código de función FC 01 o FC 02:
del área.
P. ej., la entrada no existe o se intenta leer fuera del área.

0E39

Se ha producido un error al acceder al área SIMATIC "blo‐ Compruebe si existe el bloque de datos que se
que de datos" con el código de función FC 03, 04, 06, 16: ha llamado y si es suficientemente largo.
El bloque de datos no existe o es demasiado corto.

0E3A

Se ha producido un error al ejecutar una orden de escritura
con el código de función FC 05, 15:
No existe el bloque de datos instancia de la instrucción
MODBUS o es demasiado corto.

Programación del PLC
Manual de programación y manejo, 11/2019

Compruebe si existe el DB instancia parametri‐
zado en la instrucción de comunicación MOD‐
BUS y si es suficientemente largo.

7193

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0E3B

Timeout (esperando acuse) al ejecutar una orden de escri‐ Comprobar configuración de conexión e inter‐
tura por medio de la instrucción de comunicación Modbus. faz CP-CPU (SFB BSEND), dado el caso, vol‐
ver a cargar la instrucción de comunicación
MODBUS.

0E3C

Orden no permitida con este driver.

Únicamente están permitidos SFB SEND, STA‐
TUS (sólo con el CP 441-2)

0E50

En las áreas SIMATIC de temporizadores/contadores, que
están orientadas a palabras, el número de bits restante que
resulta de la dirección Modbus es diferente a 0

Utilizar solamente direcciones MODBUS con
las que resulten números de bits válidos.

0E51

La dirección Modbus recibida se encuentra fuera de las
áreas parametrizadas "de/a".

Como indicación de dirección en el telegrama
de solicitud, utilizar únicamente direcciones
que se hayan definido antes en la parametriza‐
ción.

0E52

● Rebase por exceso de un límite de área SIMATIC al
intentar acceder el sistema maestro Modbus:
N° de DB resultante < 1

Limitar el área de acceso a las áreas de me‐
moria SIMATIC válidas.

● Acceso de escritura a un área no habilitada
(parametrización)
● Acceso de escritura a un DB instancia de la instrucción
de comunicación
0E53

Rebase por exceso de un límite de área SIMATIC al inten‐ Limitar el área de acceso a las áreas de me‐
moria SIMATIC válidas.
tar acceder el sistema maestro MODBUS.
P. ej., rebase por exceso al calcular el n.° de DB resultante
(>65535)

0E54

El acceso va más allá del final de área parametrizado o del
final de área SIMATIC.

Limitar el área de acceso a las áreas de me‐
moria SIMATIC válidas.

0E55

No está permitido un acceso de escritura a esta área de
memoria SIMATIC.

Realizar accesos de escritura únicamente a las
áreas de datos SIMATIC de marcas y salidas.

0E56

No es posible un funcionamiento del acoplamiento porque
la instrucción de comunicación no se está ejecutando.

Llame cíclicamente la instrucción de comunica‐
ción MODBUS en el programa de usuario
STEP 7.
Dado el caso, ejecute de nuevo una inicializa‐
ción de la instrucción de comunicación.

0E57

Se ha producido un error en la instrucción de comunicación
al procesar el código de función Modbus.

Analice la causa exacta.

7194

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Interfaz serie ET 200S
ET 200S 1SI para 3964(R) y ASCII
S_RCV: Recibir datos
Descripción
La instrucción S_RCV transmite datos del módulo ET 200S 1SI a un área de datos S7,
especificada por los parámetros DB_NO y DBB_NO. La instrucción S_RCV se llama para
transferir datos cíclica o estáticamente (sin condiciones) en un programa controlado por
tiempo.

Funcionamiento
Con el estado lógico (estático) "1" en el parámetro EN_R se habilita la comprobación de si
pueden leerse datos del módulo ET 200S 1SI. Una transferencia en curso se puede cancelar
con el estado de señal "0" en el parámetro EN_R y, adicionalmente, con el estado de señal "1"
en el parámetro R. (Puesto que puede suceder esporádicamente que tras ajustar el parámetro
EN_R a "1" la transferencia ya no se inicie, para cancelar una transferencia en curso, debe
ajustar el parámetro R a "1" en paralelo al ajuste del parámetro EN_R a "0".) La petición de
recepción cancelada finaliza con un mensaje de error (salida STATUS). La recepción está
desactivada mientras exista el estado lógico "0" en el parámetro EN_R. Dependiendo de la
cantidad de datos, la transmisión puede desarrollarse en varias llamadas (ciclos del
programa).
Si la instrucción detecta el estado lógico "1" en el parámetro R, se cancela la petición actual de
transmisión y la instrucción S_RCV pasa al estado inicial. La recepción está desactivada
mientras exista el estado lógico "1" en el parámetro R. Cuando el estado de señal vuelve a ser
"0", el telegrama interrumpido se vuelve a recibir desde el principio.
En el parámetro LADDR se indica la dirección del módulo ET 200S 1SI que se va a llamar.
La salida NDR indica "Petición finalizada sin errores/Datos aceptados" (leídos todos los datos).
ERROR indica que se ha producido un error. En caso de producirse un error, el número
correspondiente se indica en STATUS. Si el búfer de recepción está lleno en más de 2/3
partes, STATUS contiene una advertencia después de cada llamada de S_RCV. Si no hay
errores ni advertencias, STATUS tiene el valor "0".
NDR y ERROR/STATUS también se visualizan cuando se desactiva la instrucción S_RCV
(parámetro LEN == 16#00) (véase el cronograma). Si se ha producido un error, se desactiva
el resultado binario RB. Si se termina el bloque sin errores, el estado del resultado binario es
"1".

Programación del PLC
Manual de programación y manejo, 11/2019

7195

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

EN_R

INPUT

BOOL

Habilitar lectura de datos

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Bloqueo
de recepción.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
N.º DB de recepción: Específico de la CPU.
No se permite el valor 0.

DBB_NO

INPUT

INT

Número de bytes de datos (datos recibidos)
S7-1500: 0 ≤ DBB_NO y
DBB_NO + LEN ≤ tamaño del DB
S7-300/400: 0 ≤ DBB_NO y
DBB_NO + LEN < 8190

NDR 1

OUTPUT

BOOL

La petición ha finalizado sin errores, datos
transferidos

ERROR 1

OUTPUT

BOOL

Petición interrumpida con errores

Parámetro STATUS == 16#00
El parámetro STATUS (Página 7209) con‐
tiene la información de error.
LEN 1

OUTPUT

INT

Longitud del telegrama recibido
1 ≤ LEN ≤ 224
indicación en número de bytes

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7209) figura la información de error.

COM_RST

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición de recepción correcta, los parámetros NDR, ERROR, LEN y STATUS están dis‐
ponibles durante un ciclo de la CPU.
1

Asignación en el área de datos
La instrucción S_RCV opera conjuntamente con un DB instancia I_RCV. El número del DB se
indica con la llamada. No está permitido acceder a los datos del DB de instancia.
Nota
Excepción: en caso de error, (STATUS == W#16#1Exx), encontrará una indicación más
precisa sobre el error en la variable SFCERR. Esta variable de error sólo puede cargarse en
el DB de instancia mediante un acceso simbólico.

Arranque
El parámetro COM_RST de la instrucción S_RCV permite notificar un arranque a la instrucción.

7196

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Ponga el parámetro COM_RST a 1 en el OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

Cronograma
La figura siguiente muestra el comportamiento de los parámetros NDR, LEN y ERROR según
sea el cableado de las entradas EN_R y R.

(1B5

5

1'5

(5525

)LQFRQHUURUHV

5HFHSFLµQHQFXUVR

5(6(7
)LQVLQHUURUHV
(5525

VLQUHFHSFLµQ

5HFHSFLµQ
GHVFRQHFWDGD

)LQFRQHUURUHV

5HFHSFLµQHQFXUVR

)LQVLQHUURUHV

KDELOLWDUUHFHSFLµQ

/(1
ORQJLWXG

Nota
La entrada EN_R debe ponerse estáticamente a "1". Mientras dure toda la petición de
recepción, el parámetro EN_R debe recibir el RLO "1" (resultado lógico).

Programación del PLC
Manual de programación y manejo, 11/2019

7197

Instrucciones
4.2 Instrucciones

Regulación
Nota
La instrucción S_RCV no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP.
Nota
Antes de que el ET 200S 1SI pueda recibir una petición iniciada después de una transición de
estado de la CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CPU del
módulo ET 200S para la instrucción S_RCV .

S_SEND: Enviar datos
Descripción
La instrucción S_SEND transmite un conjunto de datos de un bloque de datos especificado por
los parámetros DB_NO, DBB_NO y LEN, al módulo ET 200S 1SI. La instrucción S_SEND se
llama para transferir datos en el ciclo estáticamente (sin condiciones) o alternativamente en un
programa controlado por tiempo.

Funcionamiento
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
Dependiendo del volumen de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).
La instrucción S_SEND puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al módulo ET 200S 1SI y la
instrucción S_SEND pasa al estado inicial. Los datos que ya ha recibido el módulo ET 200S 1SI
se envían al interlocutor. Si la entrada R tiene el estado lógico estático "1", la transmisión está
desactivada.
En el parámetro LADDR se indica la dirección del módulo ET 200S 1SI que se va a llamar.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS
también se indican en caso de RESET de la instrucción S_SEND (véase el cronograma). Si se
ha producido un error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el
estado del resultado binario es "1".

7198

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco positivo

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Envío
bloqueado.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.

DB_NO

INPUT

INT

Número del bloque de datos
Nº de DB de envío: específico de la CPU.
No se admite el valor 0.

DBB_NO

INPUT

INT

Número de bytes de datos (datos de trans‐
misión)
S7-1500: 0 ≤ DBB_NO y
DBB_NO + LEN ≤ tamaño del DB
S7-300/400: 0 ≤ DBB_NO y
DBB_NO + LEN < 8190

LEN

INPUT

INT

Longitud de datos
1 ≤ LEN ≤ 224
indicación en número de bytes

DONE 1

OUTPUT

BOOL

La petición ha finalizado sin errores

ERROR 1

OUTPUT

BOOL

Petición interrumpida con errores

Parámetro STATUS == 16#00
El parámetro STATUS (Página 7209) con‐
tiene la información de error.
STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7209) figura la información de error.

COM_RST

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición de transmisión correcta, los parámetros DONE, ERROR y STATUS están dispo‐
nibles durante
un ciclo de la CPU.
1

Asignación en el área de datos
La instrucción S_SEND opera conjuntamente con un DB instancia I_SEND. El número del DB
se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, (STATUS == W#16#1Exx), encontrará una indicación más
precisa sobre el error en la variable SFCERR. Esta variable de error sólo puede cargarse en
el DB instancia mediante un acceso simbólico.

Programación del PLC
Manual de programación y manejo, 11/2019

7199

Instrucciones
4.2 Instrucciones

Arranque
El parámetro COM_RST de la instrucción S_SEND permite notificar un arranque a la
instrucción.
Ponga el parámetro COM_RST a 1 en el OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

Cronograma
La figura siguiente muestra el comportamiento de los parámetros DONE y ERROR según sea
el cableado de las entradas REQ y R.

5(4

5

)LQVLQHUURUHV
(UURU

7UDQVIHUHQFLD5(6(7

)LQFRQHUURUHV

7UDQVIHUHQFLD5(6(7

3DUWHQ6(1'

)LQVLQHUURUHV
(UURU

(QYLDUSHWLFLµQ

(5525

/DSHWLFLµQ6(1'QRVH
HMHFXWD
ODWUDQVIHUHQFLDHVW£
GHVDFWLYDGD

'21(

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

7200

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Regulación
Nota
La instrucción S_SEND no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP.
Nota
Antes de que el ET 200S 1SI pueda procesar una petición iniciada después de una transición
de estado de la CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CPU
del módulo ET 200S para la instrucción S_SEND . Una petición iniciada entre tanto no se
pierde. Se transfiere al módulo ET 200S 1SI una vez concluida la coordinación de arranque.

S_VSTAT: Leer señales cualificadoras en la interfaz RS 232C
Descripción
La instrucción S_VSTAT lee las señales cualificadoras RS 232C del módulo ET 200S 1SI y las
pone a disposición del usuario en los parámetros de bloque. La instrucción S_VSTAT se llama
de forma estática (sin condiciones) para transferir datos en el ciclo o, alternativamente, en un
programa controlado por tiempo.

Funcionamiento
Las señales cualificadoras RS 232C se actualizan cada vez que se llama la instrucción
(sondeo cíclico).
En el parámetro LADDR se indica la dirección del módulo ET 200S 1SI con el que debe
realizarse la conexión.

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Transmi‐
sión bloqueada.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.

DONE

OUTPUT

1

BOOL

Indica que la instrucción ha finalizado
(Salida ET 200S 1SI)

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7209) con‐
tiene la información de error.

Programación del PLC
Manual de programación y manejo, 11/2019

7201

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7209) figura la información de error.

DTR_OUT 1

OUTPUT

BOOL

DSR_IN 1

OUTPUT

BOOL

Data terminal ready,
ET 200S 1SI listo para funcionar.
(salida ET 200S 1SI)
Data set ready, interlocutor listo para funcio‐
nar.
(Entrada ET 200S 1SI)

RTS_OUT

1

OUTPUT

BOOL

Request to send,
ET 200S 1SI listo para enviar.
(salida ET 200S 1SI)

1

CTS_IN

OUTPUT

BOOL

Clear to send, el interlocutor puede recibir
datos del módulo ET 200S 1SI (respuesta a
RTS = ON del ET 200S 1SI)

DCD_IN 1

OUTPUT

BOOL

Data carrier detect, nivel de señal de recep‐
ción

COM_RST

IN_OUT

BOOL

(entrada ET 200S 1SI)

(entrada ET 200S 1SI)
1

Reinicio de la instrucción

Tras una petición correcta, estos parámetros están disponibles durante un ciclo de la CPU.

Asignación en el área de datos
La instrucción S_VSTAT opera conjuntamente con un DB instancia I_STAT. El número del DB
se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Para detectar un cambio de señal es necesario una duración de impulso mínima. Las
magnitudes decisivas son el tiempo de ciclo de la CPU, el tiempo de actualización en el módulo
ET 200S 1SI y el tiempo de respuesta del interlocutor.

Arranque
El parámetro COM_RST de la instrucción S_VSTAT permite notificar un arranque a la
instrucción.
Asigne el estado 1 al parámetro COM_RST del OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).

7202

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

S_VSET: Escribir señales cualificadoras en la interfaz RS 232C
Descripción
Las salidas de las interfaces se activan y desactivan mediante las correspondientes entradas
de parámetros de la instrucción S_VSET . La instrucción S_VSET se llama cíclica o
estáticamente (sin condiciones) en un programa controlado por tiempo.
En el parámetro LADDR se indica la dirección del módulo ET 200S 1SI con el que debe
realizarse la conexión.

Parámetro
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Transmi‐
sión bloqueada.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.

RTS

INPUT

BOOL

Request to send,
ET 200S 1SI listo para enviar.
(forzar salida ET 200S 1SI)

DTR

INPUT

BOOL

Data terminal ready,
ET 200S 1SI operativo.

DONE 1

OUTPUT

BOOL

(salida ET 200S 1SI)

ERROR 1

OUTPUT

BOOL

Petición interrumpida con errores

(forzar salida ET 200S 1SI)

El parámetro STATUS (Página 7209) con‐
tiene la información de error.
STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7209) figura la información de error.

COM_RST
1

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición correcta, estos parámetros están disponibles durante un ciclo de la CPU.

Asignación en el área de datos
La instrucción S_VSET opera conjuntamente con un DB instancia I_SET. El número del DB se
indica con la llamada. No está permitido acceder a los datos del DB instancia.

Programación del PLC
Manual de programación y manejo, 11/2019

7203

Instrucciones
4.2 Instrucciones

Arranque
El parámetro COM_RST de la instrucción S_VSET permite notificar un arranque a la
instrucción.
Ponga el parámetro COM_RST a 1 en el OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

S_XON: Parametrizar el control de flujo de datos con XON/XOFF
Descripción
La instrucción S_XON permite ajustar otros parámetros adicionales si el módulo ha sido
parametrizado para el control de flujo de datos XON/XOFF.
Nota
La instrucción S_XON debe llamarse antes de las instrucciones S_SEND, S_RCV, S_VSET y
S_VSTAT y haber finalizado su petición (DONE = TRUE).

Parámetro
Parámetro

Declaración Tipo de da‐
tos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Transmisión blo‐
queada.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.

XON

INPUT

BYTE

Carácter XON
0 a 7FH (7 bits de datos)
0 a FFH (8 bits de datos)
Configuración predeterminada: 11 (DC1)

XOFF

INPUT

BYTE

Carácter XOFF
0 a 7FH (7 bits de datos)
0 a FFH (8 bits de datos)
Configuración predeterminada: 13 (DC3)

7204

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de da‐
tos

Descripción

WAIT_FOR_XON

INPUT

Tiempo de espera para XON tras XOFF

TIME

20 ms a 10 min 55 s 350ms
Configuración predeterminada: 2 s
DONE

OUTPUT

1

BOOL

Petición finalizada sin errores
Parámetro STATUS == 16#00

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7209) contiene la in‐
formación de error.

STATUS1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS (Pági‐
na 7209) figura la información de error.

COM_RST

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición correcta, los parámetros DONE, ERROR y STATUS están disponibles durante un
ciclo de la CPU.
1

Asignación en el área de datos
La instrucción S_XON opera conjuntamente con un DB instancia I_XON. El número del DB se
indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: En caso de error (STATUS == W#16#1Exx) se pueden consultar más detalles
sobre el error en la variable SFCERR .

Arranque
El parámetro COM_RST de la instrucción S_XON permite notificar un arranque a la instrucción.
Ponga el parámetro COM_RST a 1 en el OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

Programación del PLC
Manual de programación y manejo, 11/2019

7205

Instrucciones
4.2 Instrucciones

S_RTS: Parametrizar el control de flujo de datos con RTS/CTS
Descripción
La instrucción S_RTS permite ajustar otros parámetros adicionales si el módulo ha sido
parametrizado para el control de flujo de datos RTS/CTS.
Nota
La instrucción S_RTS debe llamarse antes de las instrucciones S_SEND, S_RCV, S_VSET y
S_VSTAT y haber finalizado su petición (DONE = TRUE).

Parámetro
Parámetro

Declaración Tipo de
datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco ascendente

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Transmisión blo‐
queada.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S SI

WAIT_FOR_CTS

INPUT

TIME

Tiempo de espera para CTS = ON

La dirección inicial se toma de STEP 7.
20 ms a 10 min 55 s 350 ms
Configuración predeterminada: 2 s
DONE

OUTPUT

1

BOOL

Petición finalizada sin errores
Parámetro STATUS == 16#00

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7209) contiene la infor‐
mación de error.

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS (Pági‐
na 7209) figura la información de error.

COM_RST

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición correcta, los parámetros DONE, ERROR y STATUS están disponibles durante un
ciclo de la CPU.
1

Asignación en el área de datos
La instrucción S_RTS opera conjuntamente con un DB instancia I_RTS. El número del DB se
indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error (STATUS == W#16#1Exx) encontrará una indicación más precisa
sobre el error en la variable SFCERR.

7206

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Arranque
El parámetro COM_RST de la instrucción S_RTS permite notificar un arranque a la instrucción.
Ponga el parámetro COM_RST a 1 en el OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

S_V24: Parametrizar el control de flujo de datos para el manejo automático de las señales cualificadoras
RS 232C
Descripción
La instrucción S_V24 permite configurar parámetros adicionales, si el módulo está
parametrizado para el manejo automático de las señales cualificadoras RS 232C.
Nota
La instrucción S_V24 debe llamarse antes de las instrucciones S_SEND, S_RCV, S_VSET y
S_VSTAT y haber finalizado su petición (DONE = TRUE).

Parámetro
Parámetros

Declaración Tipo de
datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco positivo

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Envío bloqueado.

LADDR

INPUT

INT

TIME_RTS_OFF

INPUT

TIME

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.
Tiempo que debe transcurrir después de la transmi‐
sión antes de que se desconecte RTS.
0 ms a 10 min 55 s 350ms
Configuración predeterminada: 10 ms

DATA_WAIT_TIME

INPUT

TIME

Tiempo que se espera para que el interlocutor active
CTS = ON después de activar RTS.
0 ms a 10 min 55 s 350 ms
Configuración predeterminada: 10 ms

Programación del PLC
Manual de programación y manejo, 11/2019

7207

Instrucciones
4.2 Instrucciones
Parámetros

Declaración Tipo de
datos

Descripción

DONE1

OUTPUT

BOOL

La petición ha finalizado sin errores

ERROR 1

OUTPUT

BOOL

Parámetro STATUS == 16#00
Petición interrumpida con errores
El parámetro STATUS (Página 7209) contiene la in‐
formación de error.
STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS (Pági‐
na 7209) figura la información de error.

COM_RST

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición correcta, los parámetros DONE, ERROR y STATUS están disponibles durante un
ciclo de la CPU.
1

Asignación en el área de datos
La instrucción S_V24 opera conjuntamente con un DB instancia I_V24. El número del DB se
indica con la llamada. No está permitido acceder a los datos del DB de instancia.
Nota
Excepción: En caso de error (STATUS == W#16#1Exx) se pueden consultar más detalles
sobre el error en la variable SFCERR .

Arranque
El parámetro COM_RST de la instrucción S_V24 permite notificar un arranque a la instrucción.
Asigne el estado 1 al parámetro COM_RST del OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

7208

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro STATUS
Clases de evento
Clase de evento Significado
2

Error al inicializar

5

Error al procesar una petición de la CPU

7

Error de transmisión

8

Error de recepción

11 (0BH)

Advertencia

30 (1EH)

Error en la comunicación entre el módulo y la CPU

Parámetro STATUS
Código de error
(W#16#...)

Descripción

Solución

0201

Sin parametrización (válida).

Asigne parámetros correctos al módulo. Dado el caso,
compruebe que el equipo se haya instalado de forma
adecuada.

0502

La petición no está permitida en este estado
El telegrama de envío tiene más de 224 bytes. La pe‐
operativo del módulo ET 200S 1SI (p. ej. inter‐ tición de envío ha sido cancelada por el módulo
faz del equipo no parametrizada).
ET 200S 1SI.
Seleccione una longitud de telegrama menor.

050E

Longitud de telegrama no válida

El telegrama de envío tiene más de 224 bytes. La pe‐
tición de envío ha sido cancelada por el módulo
ET 200S 1SI.

0550

Petición de actualización de parámetros no vá‐ Modifique los parámetros de las instrucciones
lida para el control del flujo de datos actual del (S_XON, S_RTS, S_V24) en el programa del AS o
módulo ET 200S 1SI.
modifique el control del flujo de datos del módulo
ET 200S 1SI en la configuración de hardware, de mo‐
do que ambos coincidan.

0551

Error de secuencia de trama en la comunica‐
ción entre el módulo ET 200S 1SI y el sistema
de automatización. El error ha surgido al trans‐
mitir un telegrama recibido del módulo
ET 200S 1SI en el sistema de automatización.

El módulo y el sistema de automatización han cance‐
lado la transferencia. Repita la petición de recepción;
el módulo ET 200S 1SI vuelve a enviar el mensaje
recibido.

0702

Sólo con 3964(R):

Compruebe por qué falla el dispositivo interlocutor co‐
nectando, si procede, un dispositivo de comprobación
de interfaz (FOXPG) a la línea de transmisión.

Seleccione una longitud de telegrama menor.

Error al establecer la conexión:
Tras el envío de STX se ha recibido NAK o un
carácter cualquiera (excepto DLE o STX).
0703

Sólo con 3964(R):
Tiempo de retardo de acuse (TRA) transcurri‐
do:
Tras en envío de STX no ha llegado ninguna
respuesta del interlocutor dentro del tiempo de
retardo de acuse.

Programación del PLC
Manual de programación y manejo, 11/2019

El dispositivo interlocutor es demasiado lento o no es‐
tá preparado para recibir o bien hay p. ej. una rotura de
la línea de envío. Compruebe por qué falla el disposi‐
tivo interlocutor conectando, si procede, un dispositivo
de comprobación de interfaz (FOXPG) a la línea de
transmisión.

7209

Instrucciones
4.2 Instrucciones
Código de error
(W#16#...)

Descripción

Solución

0704

Sólo con 3964(R):

Compruebe si el interlocutor también indica error por‐
que quizá no han llegado todos los datos de transmi‐
sión (p. ej. rotura de la línea de transmisión), existen
interferencias importantes o el interlocutor no funcio‐
na correctamente. Compruebe por qué falla el dispo‐
sitivo interlocutor conectando, si procede, un disposi‐
tivo de comprobación de interfaz (FOXPG) a la línea
de transmisión.

Interrupción por parte del interlocutor:
Durante el proceso de envío en curso el inter‐
locutor ha recibido uno o varios caracteres.

0705

Sólo con 3964(R):
Acuse negativo al enviar

0706

Sólo con 3964(R):
Error al terminar la conexión:
● El telegrama ha sido rechazado por el
interlocutor con NAK u otro carácter al final
(con la excepción de DLE) o bien
● El carácter de confirmación (DLE) se ha
recibido demasiado pronto.

0707

Sólo con 3964(R):
Tiempo de retardo de acuse al terminar la co‐
nexión/tiempo de supervisión de respuesta
tras el telegrama de envío agotados:

Compruebe si el interlocutor también indica error por‐
que quizá no han llegado todos los datos de transmi‐
sión (p. ej. rotura de la línea de transmisión), existen
interferencias importantes o el interlocutor no funcio‐
na correctamente. Compruebe por qué falla el dispo‐
sitivo interlocutor conectando, si procede, un disposi‐
tivo de comprobación de interfaz (FOXPG) a la línea
de transmisión.
Compruebe si el interlocutor también indica error por‐
que quizá no han llegado todos los datos de transmi‐
sión (p. ej. rotura de la línea de transmisión), existen
interferencias importantes o el interlocutor no funcio‐
na correctamente. Compruebe por qué falla el dispo‐
sitivo interlocutor conectando, si procede, un disposi‐
tivo de comprobación de interfaz (FOXPG) a la línea
de transmisión.
El dispositivo interlocutor es demasiado lento o es de‐
fectuoso. Compruebe si es así con un dispositivo de
comprobación de interfaz conectado a la línea de
transmisión.

Tras la interrupción de la conexión con DLE
ETX no ha llegado ninguna respuesta del inter‐
locutor dentro del TRA.
0708

070B

Sólo con driver ASCII:
El tiempo de espera a XON o CTS = ON ha
transcurrido.

El interlocutor tiene un defecto, es demasiado lento o
está offline. Revise el interlocutor o modifique la para‐
metrización en caso necesario.

Sólo con 3964(R):

Cambie la parametrización.

El conflicto de inicialización no puede resolver‐
se, puesto que ambos interlocutores tienen
predeterminada prioridad alta.
070C

Sólo con 3964(R):

Cambie la parametrización.

El conflicto de inicialización no puede resolver‐
se, puesto que ambos interlocutores tienen
ajustada prioridad baja.

7210

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de error
(W#16#...)

Descripción

Solución

0802

Sólo con 3964(R):

Compruebe por qué falla el dispositivo interlocutor co‐
nectando, si procede, un dispositivo de comprobación
de interfaz (FOXPG) a la línea de transmisión.

Error al establecer la conexión:
● En posición de reposo se han recibido uno
o más caracteres (cualquiera con la
excepción de NAK o STX) o bien
● Tras la recepción de un STX el interlocutor
ha enviado otros caracteres sin esperar la
recepción de la respuesta DLE.
Tras Power ON del interlocutor:
● Mientras el interlocutor se conecta, el
módulo recibe un carácter indefinido.
0805

Sólo con 3964(R):
Error lógico durante la recepción:
Tras la recepción de DLE se ha recibido otro
carácter cualquiera (con la excepción de DLE,
ETX).

0806

Tiempo de retardo entre caracteres (TRC)
transcurrido:
● No se han recibido dos caracteres
consecutivos dentro del TRC o bien
Sólo con 3964(R):

Compruebe si el interlocutor siempre duplica DLE en
el encabezado del telegrama y en la cadena de datos
o si la interrupción de la conexión se realiza con DLE
ETX. Compruebe por qué falla el dispositivo interlocu‐
tor conectando, si procede, un dispositivo de compro‐
bación de interfaz (FOXPG) a la línea de transmisión.
El dispositivo interlocutor es demasiado lento o es de‐
fectuoso. Compruebe por qué falla el dispositivo inter‐
locutor conectando, si procede, un dispositivo de com‐
probación de interfaz (FOXPG) a la línea de transmi‐
sión.

● 1. El 1er carácter tras el envío de DLE en el
establecimiento de la conexión no se ha
recibido dentro del TRC.
0807

Sólo con 3964(R):
Longitud de telegrama no permitida:

0808

La recepción de un telegrama de longitud 0 no es un
error.

Se ha recibido un telegrama de longitud 0.

Compruebe el motivo por el que el interlocutor envía
telegramas sin datos útiles.

Sólo con 3964(R):

Compruebe si el enlace tiene grandes interferencias;
en ese caso, ocasionalmente también pueden apare‐
cer códigos de error. Compruebe por qué falla el dis‐
positivo interlocutor conectando, si procede, un dispo‐
sitivo de comprobación de interfaz (FOXPG) a la línea
de transmisión.

Error en el carácter de comprobación de blo‐
que BCC:
El valor del BCC determinado internamente no
concuerda con el BCC recibido por el interlo‐
cutor al final de la conexión.

Parametrice en el interlocutor el mismo tiempo de es‐
El número de repeticiones debe ajustarse igual. pera de bloque que en el módulo. En caso necesario,
compruebe el comportamiento erróneo del interlocu‐
tor con un dispositivo de comprobación de interfaz co‐
nectado a la línea de transmisión.

0809

Sólo con 3964(R):

080A

No hay un búfer de recepción libre disponible:
Durante la recepción no se disponía de ningún
búfer de recepción vacío.

Programación del PLC
Manual de programación y manejo, 11/2019

La instrucción S_RCV se debe llamar con más fre‐
cuencia.

7211

Instrucciones
4.2 Instrucciones
Código de error
(W#16#...)

Descripción

Solución

080C

Error de transmisión:

Los fallos en la línea de transmisión provocan repeti‐
ciones del telegrama reduciendo el paso de datos úti‐
les. El riesgo de que se produzca un error no detecta‐
do aumenta. Modifique la configuración de su sistema
o la disposición de la línea. Compruebe la línea de
enlace del interlocutor, o compruebe si la velocidad de
transmisión, la paridad y el número de bits de parada
coinciden en ambos dispositivos.

● Se ha detectado un error de transmisión
(error de paridad, error de bit de parada,
error de rebosamiento).
Sólo con 3964(R):
● Si esto ocurre durante el modo de envío o
recepción, se inician repeticiones.
● Si durante la posición de reposo se recibe
un carácter defectuoso, el error se indica
inmediatamente para facilitar la detección
prematura de fallos en la línea de
transmisión.
● Si el LED SF (rojo) está encendido, se ha
interrumpido la línea de conexión de ambos
interlocutores.
080D

BREAK: La línea de recepción que llega al in‐
terlocutor está interrumpida.

Restablezca la conexión o conecte el interlocutor.

0810

Sólo con driver ASCII:

Compruebe la línea de enlace del interlocutor, o com‐
pruebe si la velocidad de transmisión, la paridad y el
número de bits de parada coinciden en ambos dispo‐
sitivos.

Error de paridad:

● Si el LED SF (rojo) está encendido, se ha
interrumpido la línea de conexión de ambos
Modifique la configuración de su sistema o la disposi‐
interlocutores.
ción de la línea.
0811

Sólo con driver ASCII:
Error de trama de caracteres:

Compruebe la línea de enlace del interlocutor, o com‐
pruebe si la velocidad de transmisión, la paridad y el
número de bits de parada coinciden en ambos dispo‐
sitivos.

● Si el LED SF (rojo) está encendido, se ha
interrumpido la línea de conexión de ambos
Modifique la configuración de su sistema o la disposi‐
interlocutores.
ción de la línea.
0812

Vuelva a parametrizar el interlocutor o lea los datos
Después de que el módulo enviara XOFF o pu‐ del módulo con más rapidez.
siera CTS a OFF, se recibieron más caracteres.

0818

Sólo con driver ASCII:

Sólo con driver ASCII:

DSR = OFF o CTS = OFF

0850

La longitud del telegrama de recepción es su‐
perior a 224 bytes o mayor que la longitud de
telegrama parametrizada

0B01

El búfer de recepción está lleno en más de 2/3
partes

1E0D

"Interrupción del trabajo por rearranque com‐
pleto, rearranque o reset"

1E0E

Error estático al llamar la SFC DPRD_DAT. Se
puede disponer del valor de retorno RET_VAL
de la SFC en la variable SFCERR del DB de
instancia para su evaluación.

7212

Antes o durante un proceso de envío el interlocutor ha
puesto todas las señales DSR o CTS a "OFF".
Revise el control de las señales cualificadoras RS
232C en el interlocutor.
Adaptar la longitud de telegrama del interlocutor

Cargue la variable SFCERR del DB de instancia.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de error
(W#16#...)

Descripción

Solución

1E0F

Error estático al llamar la SFC DPWR_DAT. Se
puede disponer del valor de retorno RET_VAL
de la SFC en la variable SFCERR del DB de
instancia para su evaluación.

Cargue la variable SFCERR del DB de instancia.

1E10

Error estático al llamar la SFC RD_LGADR. El
valor de respuesta RET_VAL de la SFC está
disponible para la evaluación en las variables
SFCERR del DB de instancia.

Cargue la variable SFCERR del DB de instancia.

1E11

Error estático al llamar la SFC RDSYSST. El
Cargue la variable SFCERR del DB instancia.
valor de retorno RET_VAL de la SFC está dis‐
ponible para la evaluación en las variables
SFCERR del DB instancia.

1E20

Parámetro fuera del rango.

Cambie la entrada de la instrucción para que esté en
el área válida.

1E41

El número de bytes indicado en el parámetro
LEN de las instrucciones no está permitido

Respete el rango de 1 a 224 bytes.

Evaluación de la variable SFCERR
Obtendrá más información sobre los errores ocurridos (1E) 0EH, (1E) 0FH, (1E) 10H y (1E) 11H
de la clase de evento 30 a través de la variable SFCERR.
La variable SFCERR se puede cargar desde el DB instancia de la instrucción correspondiente.
Los mensajes de error registrados en la variable SFCERR se encuentran en las funciones de
sistema "DPRD_DAT" y SFC15 "DPWR_DAT" en el manual de referencia Software de sistema
para S7-300 y S7-400. Funciones estándar y funciones de sistema.

ET 200S 1SI de Modbus
Enviar y recibir como maestro Modbus
Descripción
La transmisión de datos entre el módulo y la CPU se realiza mediante las instrucciones
S_SEND y S_RCV. La instrucción S_SEND se activa con un flanco en la entrada REQ cuando
deben emitirse datos. La instrucción S_RCV se prepara para la recepción con EN_R=1. En
todos los códigos de función de lectura es necesario un S_RCV.

Programación del PLC
Manual de programación y manejo, 11/2019

7213

Instrucciones
4.2 Instrucciones

Enviar y recibir con el protocolo del maestro Modbus
Para ejecutar una petición del maestro Modbus tienen que activarse las instrucciones S_SEND
y S_RCV. La instrucción S_SEND se activa con un flanco en la entrada REQ cuando deben
emitirse datos al módulo. La instrucción S_RCV se prepara con EN_R=1 para recibir datos del
módulo. En todos los códigos de función de lectura es necesario un S_RCV. La figura siguiente
muestra el comportamiento global de los parámetros de S_SEND y S_RCV cuando se ejecuta
una petición Modbus.

6B6(1'5(4
'DWRVDHVFODYR

6B6(1''21(
6B6(1'(5525
'DWRVGHHVFODYR

6B5&9(1B5

6B5&91'5

6B5&9(5525
5HVSXHVWDFRUUHFWDGHOHVFODYR

QLQJXQDUHVSXHVWDGHOHVFODYR

Nota
Secuencia de enviar y recibir
Dado que la interfaz entre el programa de usuario y el módulo interfaz funciona en modo
semidúplex, hay que tener en cuenta lo siguiente:
Después de una petición de lectura del maestro Modbus con acuse positivo, hay que recuperar
los datos recibidos del módulo de interfaz con la instrucción S_RCV antes de iniciar una nueva
petición de envío del maestro Modbus.

7214

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

S_RCV: Recibir datos
Descripción
La instrucción S_RCV transmite datos del módulo ET 200S 1SI a un área de datos S7,
especificada por los parámetros DB_NO y DBB_NO. La instrucción S_RCV se llama para
transferir datos cíclica o estáticamente (sin condiciones) en un programa controlado por
tiempo.

Funcionamiento
Con el estado lógico (estático) "1" en el parámetro EN_R se habilita la comprobación de si
pueden leerse datos del módulo ET 200S 1SI. Una transferencia en curso se puede cancelar
con el estado de señal "0" en el parámetro EN_R y, adicionalmente, con el estado de señal "1"
en el parámetro R. (Puesto que puede suceder esporádicamente que tras ajustar el parámetro
EN_R a "1" la transferencia ya no se inicie, para cancelar una transferencia en curso, debe
ajustar el parámetro R a "1" en paralelo al ajuste del parámetro EN_R a "0".) La petición de
recepción cancelada finaliza con un mensaje de error (salida STATUS). La recepción está
desactivada mientras exista el estado lógico "0" en el parámetro EN_R. Dependiendo de la
cantidad de datos, la transmisión puede desarrollarse en varias llamadas (ciclos del
programa).
Si la instrucción detecta el estado lógico "1" en el parámetro R, se cancela la petición actual de
transmisión y la instrucción S_RCV pasa al estado inicial. La recepción está desactivada
mientras exista el estado lógico "1" en el parámetro R. Cuando el estado de señal vuelve a ser
"0", el telegrama interrumpido se vuelve a recibir desde el principio.
En el parámetro LADDR se indica la dirección del módulo ET 200S 1SI que se va a llamar.
La salida NDR indica "Petición finalizada sin errores/Datos aceptados" (leídos todos los datos).
ERROR indica que se ha producido un error. En caso de producirse un error, el número
correspondiente se indica en STATUS. Si el búfer de recepción está lleno en más de 2/3
partes, STATUS contiene una advertencia después de cada llamada de S_RCV. Si no hay
errores ni advertencias, STATUS tiene el valor "0".
NDR y ERROR/STATUS también se visualizan cuando se desactiva la instrucción S_RCV
(parámetro LEN == 16#00) (véase el cronograma). Si se ha producido un error, se desactiva
el resultado binario RB. Si se termina el bloque sin errores, el estado del resultado binario es
"1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

EN_R

INPUT

BOOL

Habilitar lectura de datos

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Bloqueo
de recepción.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.

Programación del PLC
Manual de programación y manejo, 11/2019

7215

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

DB_NO

INPUT

INT

Número del bloque de datos
N.º DB de recepción: Específico de la CPU.
No se permite el valor 0.

DBB_NO

INPUT

INT

Número de bytes de datos (datos recibidos)
S7-1500: 0 ≤ DBB_NO y
DBB_NO + LEN ≤ tamaño del DB
S7-300/400: 0 ≤ DBB_NO y
DBB_NO + LEN < 8190

NDR 1

OUTPUT

BOOL

La petición ha finalizado sin errores, datos
transferidos

ERROR 1

OUTPUT

BOOL

Petición interrumpida con errores

Parámetro STATUS == 16#00
El parámetro STATUS (Página 7223) con‐
tiene la información de error.
LEN 1

OUTPUT

INT

Longitud del telegrama recibido
1 ≤ LEN ≤ 224
indicación en número de bytes

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7223) figura la información de error.

COM_RST

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición de recepción correcta, los parámetros NDR, ERROR, LEN y STATUS están dis‐
ponibles durante un ciclo de la CPU.
1

Asignación en el área de datos
La instrucción S_RCV opera conjuntamente con un DB instancia I_RCV. El número del DB se
indica con la llamada. No está permitido acceder a los datos del DB de instancia.
Nota
Excepción: en caso de error, (STATUS == W#16#1Exx), encontrará una indicación más
precisa sobre el error en la variable SFCERR. Esta variable de error sólo puede cargarse en
el DB de instancia mediante un acceso simbólico.

Arranque
El parámetro COM_RST de la instrucción S_RCV permite notificar un arranque a la instrucción.
Ponga el parámetro COM_RST a 1 en el OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).

7216

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

Cronograma
La figura siguiente muestra el comportamiento de los parámetros NDR, LEN y ERROR según
sea el cableado de las entradas EN_R y R.

(1B5

5

1'5

(5525

)LQFRQHUURUHV

5HFHSFLµQHQFXUVR

5(6(7
)LQVLQHUURUHV
(5525

VLQUHFHSFLµQ

5HFHSFLµQ
GHVFRQHFWDGD

)LQFRQHUURUHV

5HFHSFLµQHQFXUVR

)LQVLQHUURUHV

KDELOLWDUUHFHSFLµQ

/(1
ORQJLWXG

Nota
La entrada EN_R debe ponerse estáticamente a "1". Mientras dure toda la petición de
recepción, el parámetro EN_R debe recibir el RLO "1" (resultado lógico).

Regulación
Nota
La instrucción S_RCV no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP.

Programación del PLC
Manual de programación y manejo, 11/2019

7217

Instrucciones
4.2 Instrucciones
Nota
Antes de que el ET 200S 1SI pueda recibir una petición iniciada después de una transición de
estado de la CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CPU del
módulo ET 200S para la instrucción S_RCV .

S_SEND: Enviar datos
Descripción
La instrucción S_SEND transmite un conjunto de datos de un bloque de datos especificado por
los parámetros DB_NO, DBB_NO y LEN, al módulo ET 200S 1SI. La instrucción S_SEND se
llama para transferir datos en el ciclo estáticamente (sin condiciones) o alternativamente en un
programa controlado por tiempo.

Funcionamiento
Con un flanco ascendente en la entrada REQ se inicia la transmisión de los datos.
Dependiendo del volumen de datos, la transmisión puede desarrollarse en varias llamadas
(ciclos del programa).
La instrucción S_SEND puede llamarse en el ciclo con el estado lógico "1" en la entrada de
parámetros R. De este modo, se cancela la transferencia al módulo ET 200S 1SI y la
instrucción S_SEND pasa al estado inicial. Los datos que ya ha recibido el módulo ET 200S 1SI
se envían al interlocutor. Si la entrada R tiene el estado lógico estático "1", la transmisión está
desactivada.
En el parámetro LADDR se indica la dirección del módulo ET 200S 1SI que se va a llamar.
La salida DONE indica "Fin de petición sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el número de evento correspondiente se indica en
STATUS. Si no se producen errores, STATUS asume el valor 0. DONE y ERROR/STATUS
también se indican en caso de RESET de la instrucción S_SEND (véase el cronograma). Si se
ha producido un error, se desactiva el resultado binario RB. Si el bloque finaliza sin errores, el
estado del resultado binario es "1".

Parámetros
Parámetro

Declaración

Tipo de datos

Descripción

REQ

INPUT

BOOL

Inicio de petición con flanco positivo

R

INPUT

BOOL

Interrupción de la petición
Se interrumpe la petición en curso. Envío
bloqueado.

LADDR

INPUT

INT

Dirección inicial del módulo ET 200S 1SI
La dirección inicial se toma de STEP 7.

7218

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetro

Declaración

Tipo de datos

Descripción

DB_NO

INPUT

INT

Número del bloque de datos
Nº de DB de envío: específico de la CPU.
No se admite el valor 0.

DBB_NO

INPUT

INT

Número de bytes de datos (datos de trans‐
misión)
S7-1500: 0 ≤ DBB_NO y
DBB_NO + LEN ≤ tamaño del DB
S7-300/400: 0 ≤ DBB_NO y
DBB_NO + LEN < 8190

LEN

INPUT

INT

Longitud de datos
1 ≤ LEN ≤ 224
indicación en número de bytes

DONE 1

OUTPUT

BOOL

La petición ha finalizado sin errores
Parámetro STATUS == 16#00

ERROR

1

OUTPUT

BOOL

Petición interrumpida con errores
El parámetro STATUS (Página 7223) con‐
tiene la información de error.

STATUS 1

OUTPUT

WORD

Especificación del error
Si ERROR == 1, en el parámetro STATUS
(Página 7223) figura la información de error.

COM_RST

IN_OUT

BOOL

Reinicio de la instrucción

Tras una petición de transmisión correcta, los parámetros DONE, ERROR y STATUS están dispo‐
nibles durante
un ciclo de la CPU.

1

Asignación en el área de datos
La instrucción S_SEND opera conjuntamente con un DB instancia I_SEND. El número del DB
se indica con la llamada. No está permitido acceder a los datos del DB instancia.
Nota
Excepción: en caso de error, (STATUS == W#16#1Exx), encontrará una indicación más
precisa sobre el error en la variable SFCERR. Esta variable de error sólo puede cargarse en
el DB instancia mediante un acceso simbólico.

Arranque
El parámetro COM_RST de la instrucción S_SEND permite notificar un arranque a la
instrucción.
Ponga el parámetro COM_RST a 1 en el OB de arranque.
Llame la instrucción en modo cíclico sin activar o desactivar el parámetro COM_RST.

Programación del PLC
Manual de programación y manejo, 11/2019

7219

Instrucciones
4.2 Instrucciones
Si el parámetro COM_RST está activado,
● la instrucción proporciona información sobre el módulo ET 200S 1SI (número de bytes en
el área de periferia, en periferia descentralizada o no).
● la instrucción se desactiva y finaliza cualquier petición que pudiera haberse iniciado antes
(antes de la última transición a Stop de la CPU).
Una vez que la instrucción ha proporcionado información sobre el módulo ET 200S 1SI,
desactiva el parámetro COM_RST automáticamente.

Cronograma
La figura siguiente muestra el comportamiento de los parámetros DONE y ERROR según sea
el cableado de las entradas REQ y R.

5(4

5

)LQVLQHUURUHV
(UURU

7UDQVIHUHQFLD5(6(7

)LQFRQHUURUHV

7UDQVIHUHQFLD5(6(7

3DUWHQ6(1'

)LQVLQHUURUHV
(UURU

(QYLDUSHWLFLµQ

(5525

/DSHWLFLµQ6(1'QRVH
HMHFXWD
ODWUDQVIHUHQFLDHVW£
GHVDFWLYDGD

'21(

Nota
La entrada REQ está activada por flanco. Es suficiente un flanco ascendente en la entrada
REQ. El RLO (resultado lógico) no tiene que estar a "1" durante toda la transmisión.

Regulación
Nota
La instrucción S_SEND no dispone de comprobación de parámetros. Si la parametrización es
incorrecta, la CPU puede cambiar al estado STOP.

7220

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nota
Antes de que el ET 200S 1SI pueda procesar una petición iniciada después de una transición
de estado de la CPU de STOP a RUN, debe haber concluido el mecanismo de arranque CPU
del módulo ET 200S para la instrucción S_SEND . Una petición iniciada entre tanto no se
pierde. Se transfiere al módulo ET 200S 1SI una vez concluida la coordinación de arranque.

S_MODB: Instrucción de esclavo Modbus para ET 200S 1SI
Descripción
Para ejecutar una petición de esclavo Modbus debe activarse cíclicamente la instrucción
S_MODB en el programa de usuario. La instrucción S_MODB recibe la petición del módulo de
interfaz serie ET 200S Modbus/USS, la ejecuta y devuelve la respuesta al módulo. La
comunicación entre la CPU y el módulo se realiza mediante las instrucciones S_SEND y
S_RCV , que se llaman con S_MODB .

Funcionamiento
Tras cada rearranque de la CPU, el programa de usuario tiene que inicializar la instrucción de
comunicación Modbus. La inicialización se activa con un flanco ascendente en la entrada
CP_START. La instrucción registra los tamaños de las áreas de operandos I, Q, M, T y C de
la CPU en el bloque de datos instancia de la instrucción. Una vez finalizada correctamente la
inicialización, la instrucción activa la salida CP_START_OK.
La salida CP_START_ERROR indica un error de inicialización. En este caso, no es posible una
comunicación Modbus y todas las peticiones del maestro Modbus se responden con un
mensaje de código de excepción.
S_MODB utiliza una tabla de conversión de datos Modbus, que se encuentra en el bloque de
datos, para reproducir las direcciones Modbus en las áreas de memoria de SIMATIC S7.

Parámetros
Parámetro

Declaración Tipo de datos

Descripción

LADDR

INPUT

Dirección inicial del módulo de interfaz serie
ET 200S 1SI

INT

La dirección inicial se toma de STEP 7.
START_TIMER

INPUT

TIMER

Temporizador del timeout de inicialización:
Temporizador de la CPU que utiliza la instruc‐
ción para impedir que la inicialización se cuel‐
gue.

START_TIME

INPUT

S5TIME

Valor de tiempo del timeout de inicialización:
Tiempo máximo que puede durar la inicializa‐
ción de la instrucción

Programación del PLC
Manual de programación y manejo, 11/2019

7221

Instrucciones
4.2 Instrucciones
Parámetro

Declaración Tipo de datos

Descripción

DB_No

INPUT

BLOCK_DB

Número del bloque de datos que contiene la
tabla de conversión Modbus:

OB_MASK

INPUT

BOOL

Enmascara errores de acceso E/S y retarda las
alarmas:

Véase áreas de datos en la SIMATIC CPU

TRUE permite que se notifiquen errores de ac‐
ceso a E/S no existentes sólo al esclavo Mod‐
bus
CP_START

INPUT

BOOL

Empezar la inicialización de la instrucción

CP_START_FM

INPUT

BOOL

La inicialización se activa con un flanco ascen‐
dente en la entrada START:
Elemento de memoria en el que la instrucción
guarda el valor anterior de CP_START

CP_NDR

OUTPUT

BOOL

Trama de petición recibida

CP_START_OK

OUTPUT

BOOL

Inicialización finalizada sin errores:
La inicialización ha finalizado sin errores antes
de que el tiempo de vigilancia transcurriera.

CP_START_ERROR

OUTPUT

BOOL

Inicialización finalizada con errores:
La inicialización no se ha podido finalizar sin
errores, tampoco tras haber transcurrido el
tiempo de vigilancia.

ERROR_NR

OUTPUT

WORD

Número de error
Véase el diagnóstico

ERROR_INFO

OUTPUT

WORD

Información adicional de error
Véase el diagnóstico

Asignación en el área de datos
La instrucción S_MODB opera conjuntamente con un DB instancia IDB_MODB cuyo número
se indica en la llamada.
No es posible acceder a los datos del DB instancia.

Comportamiento en caso de error
El parámetro de entrada OB_MASK permite indicar a la instrucción Modbus que enmascare los
errores de acceso E/S. Si se produce un acceso de escritura a periferia no existente, la CPU
no pasa al estado operativo STOP y no llama ningún OB de error. La instrucción detecta el
error de acceso y se finaliza con una respuesta de error en el maestro Modbus.

7222

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetro STATUS (Modbus / USS)
Clases de evento
Clase de evento Significado
2

Error al inicializar

5

Error al procesar una petición de la CPU

8

Error de recepción

14 (0EH)

Errores generales de procesamiento: parametrización, procesamiento de una peti‐
ción S_SEND. Evaluación de recepción, recepción del aviso del código de excepción

30 (1EH)

Error en la comunicación entre el módulo y la CPU

Parámetro STATUS
Código de
error
(W#16#...)

Descripción

Solución

0201

Sin parametrización (válida).

Asigne parámetros correctos al módulo. Dado
el caso, compruebe que el equipo se haya ins‐
talado de forma adecuada.

0502

Petición no permitida en este estado Evalúe la alarma de diagnóstico y corrija el
error correspondiente.
operativo del módulo interfaz serie
ET 200S Modbus/USS (ejemplo: la in‐
terfaz del equipo no está parametriza‐
da).

050E

Longitud de telegrama no válida

El telegrama de envío tiene más de 224 bytes.
La petición de envío ha sido cancelada por el
módulo ET 200S Modbus/USS.

0530

Petición de envío del maestro Modbus
rechazada, ya que todavía no se ha
consultado la respuesta del interlocu‐
tor a la petición de envío de escritura
anterior del maestro Modbus.

Después de una petición de envío de lectura
del maestro Modbus completada con éxito,
hay que recoger del módulo la respuesta del
interlocutor antes de iniciar una nueva petición
de envío del maestro Modbus.

0551

Error de proceso de trama en la comu‐
nicación entre el módulo interfaz serie
ET 200S Modbus/USS y la CPU. El
error ha surgido al transferir un tele‐
grama recibido del módulo interfaz se‐
rie ET 200S 1SI en la CPU.

El módulo y la CPU han cancelado la transfe‐
rencia. Repita la petición de recepción. El mó‐
dulo interfaz serie ET 200S Modbus/USS vuel‐
ve a enviar el mensaje recibido.

0806

Tiempo de retardo entre caracteres
excedido. Dos caracteres consecuti‐
vos no se han recibido dentro del tiem‐
po de retardo entre caracteres.

El dispositivo interlocutor es demasiado lento
o es defectuoso. Compruebe por qué falla el
dispositivo interlocutor conectando, si proce‐
de, un dispositivo de comprobación de interfaz
(FOXPG) a la línea de transmisión.

080A

Desbordamiento por exceso del búfer Compruebe las configuraciones de protocolo
de recepción en el maestro durante la del esclavo.
recepción del telegrama de respuesta.

Seleccione una longitud de telegrama menor.

Programación del PLC
Manual de programación y manejo, 11/2019

7223

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

080C

Se ha detectado un error de transmi‐
sión (error de paridad, error de bit de
parada, error de rebosamiento).

Los fallos en la línea de transmisión provocan
repeticiones del telegrama reduciendo el paso
de datos útiles. El riesgo de que se produzca
un error no detectado aumenta. Modifique la
configuración de su sistema o la disposición
de la línea.
Compruebe la línea de enlace del interlocutor,
o compruebe si la velocidad de transmisión, la
paridad y el número de bits de parada coinci‐
den en ambos dispositivos.

080D

BREAK: La línea de recepción hacia
el interlocutor está interrumpida.

Restablezca la conexión o conecte al interlo‐
cutor.

0810

Error de paridad: Si el LED SF (rojo)
está encendido, se ha interrumpido la
línea de conexión (rotura de línea) de
ambos interlocutores.

Compruebe la línea de enlace del interlocutor,
o compruebe si la velocidad de transmisión, la
paridad y el número de bits de parada coinci‐
den en ambos dispositivos.
Modifique la configuración de su sistema o la
disposición de la línea.

0811

Error de trama de caracteres: Si el
LED SF (rojo) está encendido, se ha
interrumpido la línea de conexión (ro‐
tura de línea) de ambos interlocutores.

Compruebe la línea de enlace del interlocutor,
o compruebe si la velocidad de transmisión, la
paridad y el número de bits de parada coinci‐
den en ambos dispositivos.
Modifique la configuración de su sistema o la
disposición de la línea.

0812

Se han recibido más caracteres des‐
pués de que la interfaz serie haya
puesto CTS en OFF.

Parametrice de nuevo el interlocutor o descar‐
gue la interfaz de serie más rápidamente.

0830

Maestro: Se ha enviado un telegrama
de solicitud y ya se ha agotado el tiem‐
po de supervisión de respuesta sin
que se haya reconocido el principio de
un telegrama de respuesta.

Compruebe si la línea de transferencia está
interrumpida (puede ser necesario un análisis
de la interfaz).

Esclavo: Broadcast no está permitido
con este código de función.

Compruebe que el módulo y el interlocutor
tengan la misma configuración para los pará‐
metros de protocolo velocidad de transferen‐
cia, número de bits de datos, paridad y número
de bits de parada.
Compruebe si el valor del tiempo de supervi‐
sión de respuesta en PtP_PARAM es suficien‐
temente elevado.
Compruebe si la dirección de esclavo indicada
existe.
El sistema maestro Modbus sólo puede em‐
plear broadcast en los códigos de función ha‐
bilitados para ello.

7224

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0831

Maestro: El primer carácter del tele‐
grama de respuesta del esclavo es di‐
ferente de la dirección de esclavo en‐
viada en el telegrama de solicitud (pa‐
ra el modo normal).

Ha respondido el esclavo erróneo.

Esclavo: El código de función recibido
no está permitido.

Compruebe si la línea de transferencia está
interrumpida (puede ser necesario un análisis
de la interfaz).
Este código de función no puede emplearse
para este driver.

0832

Se ha superado el número máximo de
bits o de registros
o el número de bits no es divisible por
16 cuando se accede a las áreas de
memoria SIMATIC de temporizadores
o contadores.

Limite el máximo número de bits a 2040 y el
máximo número de registros a 127. Acceso a
temporizadores/contadores SIMATIC solo en
intervalos de 16 bits.

0833

El número de bits o de registros en el
código de función FC 15/16 y el ele‐
mento de telegrama byte_count no
concuerdan.

Corrija el número de bits/registros o
byte_count.

0834

Se ha detectado una codificación de Utilice para FC05 sólo las codificaciones
bits no permitida para "activar bit"/"de‐ 0000Hex o FF00Hex.
sactivar bit".

0835

Se ha detectado un subcódigo de diag‐ Utilice para FC08 sólo el subcódigo 0000Hex.
nóstico no permitido (diferente
a 0000Hex) en el código de función
FC 08 "Loop Back Test".

0836

El valor creado internamente para la
suma de verificación CRC16 no coin‐
cide con la suma de verificación CRC
recibida.

Compruebe la formación de la suma de verifi‐
cación CRC en el sistema maestro Modbus.

0837

Error en proceso de telegrama:
el sistema maestro Modbus ha envia‐
do un nuevo telegrama de solicitud
antes de que el driver haya transferido
el último telegrama de respuesta.

Aumente el timeout del telegrama de respues‐
ta del esclavo en el sistema maestro Modbus.

0850

La longitud del telegrama de recep‐
Adaptar la longitud de telegrama del interlocu‐
ción es superior a 224 bytes o mayor tor.
que la longitud de telegrama parame‐
trizada.

0E20

El número de bits de datos de este
acoplamiento debe ser 8.
El driver no está listo.

0E21

El factor de multiplicación parametri‐ Corrija la parametrización del driver.
zado para el tiempo de retardo de ca‐
racteres no está entre 1 y 10. El driver
trabaja con la configuración estándar
1.

0E22

El modo de operación parametrizado
del driver no es válido. Debe indicarse
"Modo normal" o "Modo con supresión
de frecuencias perturbadoras".
El driver no está listo.

Programación del PLC
Manual de programación y manejo, 11/2019

Corrija la parametrización del driver.

Corrija la parametrización del driver.

7225

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0E23

Maestro: Se ha ajustado un valor no
válido para el tiempo de supervisión
de respuesta: Los valores válidos es‐
tán entre 50 y 655000 ms.
El driver no está listo.

Corrija la parametrización del driver.
Corrija la parametrización del driver.

Esclavo: Se ha ajustado un valor no
válido para la dirección de esclavo: La
dirección de esclavo 0 no es válida.
El driver no está listo.
0E2E

Se ha producido un error al leer el ar‐
chivo de parámetros de la interfaz.
El driver no está listo.

Reinicie el maestro (Mains_ON).

0E40

El valor indicado para LEN en
S_SEND es demasiado pequeño.

La longitud mínima es de 2 bytes.

0E41

El valor indicado para LEN en
S_SEND es demasiado pequeño. Es
necesaria una longitud mayor para el
código de función transferido.

La longitud mínima para este código de fun‐
ción es de 6 bytes.

0E42

El código de función transferido no es
válido.

Utilice sólo códigos de función permitidos.

0E43

Dirección del esclavo 0 (= broadcast)
no permitida en este código de fun‐
ción.

Utilice la dirección de esclavo 0 sólo en los
códigos de función adecuados.

0E44

El valor del "número de bits" transferi‐ El "número de bits" debe estar entre 1 y 2040.
do no está entre 1 y 2040.

0E45

El valor del "número de registros"
transferido no está entre 1 y 127.

0E46

El "número de bits" o "número de registros"
Código de función 15 ó 16:
Los valores del "número de bits" o "nú‐ debe estar entre 1 y 2040 o entre 1 y 127, res‐
mero de registros" transferidos no es‐ pectivamente.
tán entre 1 y 2040 o entre 1 y 127,
respectivamente.

0E47

Código de función 15 ó 16:
LEN para S_SEND no coincide con el
"número de bits" o "número de regis‐
tros" transmitido.
LEN es demasiado pequeño.

7226

El "número de registros" debe estar entre 1 y
127.

Aumente LEN para SEND hasta que se trans‐
mita una cantidad suficiente de datos de usua‐
rio al módulo.
Debe transmitirse una cantidad mayor de da‐
tos de usuario al módulo debido al "número de
bits" o "número de registros".

0E48

Los únicos códigos válidos son "activar bit"
Código de función 5:
El código indicado en el DB de origen (FF00H), "desactivar bit" o 0000H.
SEND para "activar bit" (FF00H) o pa‐
ra "desactivar bit" (0000H) es erróneo.

0E49

Código de función 8:
El código indicado en el DB de origen
SEND para "código de diagnóstico" es
erróneo.

El único código válido es "código de diagnós‐
tico" 0000H.

0E4A

La longitud de este código de función
es superior a la longitud máxima.

En el manual encontrará los datos de longitud
máxima para cada código de función.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0E50

El maestro ha recibido una respuesta
sin enviar.

Hay un esclavo u otro maestro en la red.
Compruebe si la línea de transferencia está
interrumpida (puede ser necesario un análisis
de la interfaz).

0E51

Código de función erróneo:
Compruebe el equipo esclavo.
El código de función recibido en el te‐
legrama de respuesta es distinto del
código de función enviado.

0E52

Rebase por defecto de bytes:
El número de caracteres recibidos es
inferior al que resultaría del contador
de bytes del telegrama de respuesta o
bien es inferior al esperado para este
código de función.

Compruebe el equipo esclavo.

0E53

Rebase por exceso de bytes:
El número de caracteres recibidos es
superior al que resultaría del contador
de bytes del telegrama de respuesta o
bien es superior al esperado para este
código de función.

Compruebe el equipo esclavo.

0E54

Error de contador de bytes:
Compruebe el equipo esclavo.
El contador de bytes recibido en el te‐
legrama de respuesta es demasiado
pequeño.

0E55

Error de contador de bytes:
Compruebe el equipo esclavo.
El contador de bytes recibido en el te‐
legrama de respuesta es incorrecto.

0E56

Compruebe el equipo esclavo.
Error de eco:
Los datos del telegrama de respuesta
(número de bits, ...) repetidos por el
esclavo son distintos de los datos en‐
viados en el telegrama de solicitud.

0E57

Error en la comprobación CRC:
Al comprobar la suma de verificación
CRC16 del telegrama de respuesta
del esclavo se ha producido un error.

Compruebe el equipo esclavo.

0E61

Telegrama de respuesta con código
de excepción 01:
función no válida

Véase el manual del equipo esclavo.

0E62

Telegrama de respuesta con código
de excepción 02:
dirección de datos no válida

Véase el manual del equipo esclavo.

0E63

Telegrama de respuesta con código
de excepción 03:
valor de datos no válido

Véase el manual del equipo esclavo.

0E64

Telegrama de respuesta con código
de excepción 04:
fallo en el equipo correspondiente

Véase el manual del equipo esclavo.

Programación del PLC
Manual de programación y manejo, 11/2019

7227

Instrucciones
4.2 Instrucciones
Código de
error
(W#16#...)

Descripción

Solución

0E65

Telegrama de respuesta con código
de excepción 05:
acuse

Véase el manual del equipo esclavo.

0E66

Telegrama de respuesta con código
de excepción 06:
ocupado, telegrama rechazado

Véase el manual del equipo esclavo.

0E67

Telegrama de respuesta con código
de excepción 07:
acuse negativo

Véase el manual del equipo esclavo.

1E0D

"Interrupción de petición por rearran‐
que completo, rearranque o reset"

1E0E

Error estático al llamar la SFC
DP_RDDAT. El valor de respuesta
RET_VAL de la SFC está disponible
para la evaluación en las variables
SFCERR del DB de instancia.

Cargue la variable SFCERR del DB de instan‐
cia.

1E0F

Error estático al llamar la SFC
DP_WRDAT. El valor de respuesta
RET_VAL de la SFC está disponible
para la evaluación en las variables
SFCERR del DB de instancia.

Cargue la variable SFCERR del DB de instan‐
cia.

1E10

Error estático al llamar la SFC
RD_LGADR. El valor de retorno
RET_VAL de la SFC está disponible
para la evaluación en las variables
SFCERR del DB instancia.

Cargue la variable SFCERR del DB instancia.

1E11

Error estático al llamar la SFC
RDSYSST. El valor de retorno
RET_VAL de la SFC está disponible
para la evaluación en las variables
SFCERR del DB instancia.

Cargue la variable SFCERR del DB instancia.

1E20

Parámetro fuera del rango.

Introduzca un parámetro dentro del rango vá‐
lido para la instrucción.

1E41

El número de bytes indicado en el pa‐ Respete el rango de 1 a 256 bytes.
rámetro LEN de las instrucciones no
está permitido

Evaluación de la variable SFCERR
Obtendrá más información sobre los errores ocurridos (1E) 0EH, (1E) 0FH, (1E) 10H y (1E) 11H
de la clase de evento 30 a través de la variable SFCERR.
La variable SFCERR se puede cargar desde el DB instancia de la instrucción correspondiente.
Los mensajes de error, que se registran en la variable SFCERR, se encuentran en las
funciones de sistema "DPRD_DAT: Leer datos coherentes de un esclavo DP normalizado",
SFC15 "DPWR_DAT: Escribir datos coherentes de un esclavo DP normalizado" y
RD_LGADR: Determinar todas las direcciones lógicas de un módulo.

7228

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte también
DPRD_DAT: Leer datos coherentes de un esclavo DP normalizado (Página 5929)
DPWR_DAT: Escribir datos coherentes de un esclavo DP normalizado (Página 5932)
RD_LGADR: Determinar todas las direcciones lógicas de un módulo (Página 6229)

Parámetro ERROR_NR, ERROR_INFO
Clase de errores del diagnóstico
Números de error
de ... a

Descripción

Significado

1 ... 9

Error en la inicializa‐ La inicialización ha finalizado con errores en los números
ción, instrucción y CP de error 1...9. El parámetro CP_START_ERROR es 1.
No es posible la comunicación MODBUS con el sistema
maestro.

10 ... 19

Error al procesar un
código de función

Ha ocurrido un error al procesar un código de función en
los números de error 10...19. El CP ha enviado una peti‐
ción de procesamiento no permitida a la instrucción de
comunicación.
El error también será notificado al driver.
Las siguientes peticiones se seguirán procesando.

90 ... 99

Otros errores

Se ha producido un error de procesamiento.
El error no será notificado al driver.
Las siguientes peticiones se seguirán procesando.

Números de error
ERROR_NR
(decimal)

ERROR_INFO

Texto del error

Solución

0

0

Ningún error.

1

SFC51->RET_VAL

Error al leer la lista de estado del
sistema con la SFC51.

Analizar RET_VAL en ERROR_INFO, eliminar
la causa.

2

S_SEND->STATUS,
S_RCV->STATUS

Timeout en la inicialización del
módulo o error al inicializar el mó‐
dulo (error en la petición
S_SEND).

Compruebe si para esta interfaz se ha confi‐
gurado "MODBUS Slave" como protocolo.
Compruebe si la "ID" indicada en la instrucción
de comunicación es correcta.
Analice ERROR_INFO.

11

Dirección inicial

Dirección inicial no válida trans‐ Compruebe la dirección Modbus del sistema
ferida por el driver a la instrucción maestro Modbus.
de comunicación.

12

Número de registros

Número de registros no válido
transferido por el driver a la ins‐
trucción de comunicación.
Número de registros = 0.

Programación del PLC
Manual de programación y manejo, 11/2019

Compruebe el número de registros del siste‐
ma maestro Modbus,
en caso necesario, reinicie el módulo
(Mains_ON).

7229

Instrucciones
4.2 Instrucciones
ERROR_NR
(decimal)

ERROR_INFO

Texto del error

Solución

13

Número de registros

Número de registros no válido
transferido por el driver a la ins‐
trucción de comunicación:
Número de registros > 128.

Compruebe el número de registros del siste‐
ma maestro Modbus,
en caso necesario, reinicie el módulo
(Mains_ON).

14

Marcas M –
Dirección final

Intento de acceso al área de me‐ Reduzca la dirección inicial Modbus o la longi‐
tud de acceso en el sistema maestro Modbus.
moria SIMATIC de las marcas
más allá del límite final del área.
Atención:
La longitud de área en la CPU SI‐
MATIC depende del tipo de CPU.

15

Salidas Q –
Dirección final

Intento de acceso al área de me‐ Reduzca la dirección inicial Modbus o la longi‐
tud de acceso en el sistema maestro Modbus.
moria SIMATIC de las salidas
más allá del límite final del área.
Atención:
La longitud de área en la CPU SI‐
MATIC depende del tipo de CPU.

Entradas I –
Dirección final
16

Temporizadores T –
Dirección final

Intento de acceso al área de me‐ Reduzca la dirección inicial Modbus o la longi‐
moria SIMATIC de los temporiza‐ tud de acceso en el sistema maestro Modbus.
dores más allá del límite final del
área.
Atención:
La longitud de área en la CPU SI‐
MATIC depende del tipo de CPU.

17

Contadores C – Di‐
rección final

Intento de acceso al área de me‐ Reduzca la dirección inicial Modbus o la longi‐
tud de acceso en el sistema maestro Modbus.
moria SIMATIC de los contado‐
res más allá del límite final del
área.
Atención:
La longitud de área en la CPU SI‐
MATIC depende del tipo de CPU.

18

0

En caso necesario, reinicie el módulo
Área de memoria SIMATIC no
válida transferida por el driver a la (Mains_ON).
instrucción de comunicación.

19

Error al acceder a la periferia SI‐
MATIC.

Compruebe si la periferia necesaria existe y no
tiene errores.
Incluya el DB en su proyecto.

20

DB#

El DB no existe.

21

DB#

Longitud de DB no válida

Aumente la longitud de DB.

22

DB#

DB# por debajo del valor mínimo
de DB.

Cambie el valor mínimo de DB.

23

DB#

DB# por encima del valor máxi‐
mo de DB.

Cambie el valor máximo de DB.

24

Dirección de marca

Marca por debajo del límite míni‐ Cambie los límites mínimos de las marcas en
mo.
el DB de conversión.

25

Dirección de marca

Marca por encima del límite má‐
ximo.

26

Dirección de salida

Salida por debajo del límite míni‐ Cambie los límites mínimos de las salidas en
mo.
el DB de conversión.

27

Dirección de salida

Salida por encima del límite má‐
ximo.

7230

Cambie los límites máximos de las marcas en
el DB de conversión.

Cambie los límites máximos de las salidas en
el DB de conversión.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ERROR_NR
(decimal)

ERROR_INFO

Texto del error

Solución

90

S_SEND-> STATUS

Error al transferir un telegrama
de acuse al driver con S_SEND.

Analice la información de STATUS.

94

S_RCV->STATUS

Error al leer de SYSTAT con
S_RCV (STATUS).

Analice la información de STATUS.

ET 200S 1SI de USS
S_USST: Enviar datos a un esclavo USS
Descripción
La instrucción S_USST ejecuta la transferencia de los datos de red (PZD y, si procede, datos
PKW) a los esclavos según la estructura de datos de red utilizados.

Funcionamiento
La instrucción toma la parametrización del esclavo actual de la lista de sondeo (DB de
parametrización) y envía los datos desde el DB de datos de red. Evalúa la palabra de control
de comunicación del esclavo actual (inicio de una orden PKW o acuse de un informe de
modificación de parámetros), completa los datos de transmisión de USS y los transfiere al
búfer de transmisión del DB de procesador de comunicaciones. Finalmente, lanza la
transferencia de los datos de red al esclavo mediante la instrucción S_SEND .
Si la instrucción detecta un error de parametrización en el DB de parametrización, se guarda
una señal de error en el byte Pafe 2 del DB de datos de red.
La instrucción se llama una vez en cada ciclo del sistema de automatización.

Parámetros
Parámetro

Declaración Tipo de da‐
tos

Descripción

DBPA

INPUT

INT

Número de bloque del DB de parametrización

SYPA

INPUT

INT

Dirección inicial de los parámetros de sistema en el DB de
parametrización

SLPA

INPUT

INT

Dirección inicial de los parámetros del esclavo en el DB de
parametrización

Específico de la CPU (no se admite el valor cero)

0 <= SYPA <= 8174

0 <= SLPA <= 8184

Programación del PLC
Manual de programación y manejo, 11/2019

7231

Instrucciones
4.2 Instrucciones

Estructura del programa de S_USST

)&6B8667

'%GHSURFHVDGRUGH
FRPXQLFDFLRQHV
3DUDPHWUL]DFLµQ\HVWDGR
%ORTXHVGHPDQHMR

'%3$
6<3$
6/3$

%¼IHUGHHQY¯R
%¼IHUGHUHFHSFLµQ

2%
'%GHGDWRVGHUHG
&RQWUROGHFRPXQLFDFLµQHVFODYR

(QY¯RHVFODYR

5HFHSFLµQHVFODYR

ವ
ವ

'%GHSDUDPHWUL]DFLµQ
3DU£PHWURVGHOVLVWHPD
3DUDPHWUL]DFLµQGHFRPXQLFDFLµQ
(VFODYRDQ

S_USSR: Recibir datos de un esclavo USS
Descripción
La instrucción S_USSR ejecuta la recepción de datos de red (datos de PZD y, dado el caso,
también de PKW) de los esclavos según la estructura de datos de red utilizada.

7232

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Funcionamiento
La instrucción toma la parametrización del esclavo actual de la lista de sondeo (DB de
parametrización) y evalúa la palabra de estado del bloque TRANSMIT.
Si la orden actual ha finalizado sin errores (bit 9 = 0 en la palabra de estado de comunicación
del DB de datos de red), los datos entrantes se transfieren del búfer de recepción del DB de
procesador de comunicaciones al DB de datos de red y se evalúan. A continuación, se
actualiza la palabra de estado de comunicación en el DB de datos de red.
Si la orden actual no ha finalizado sin errores (bit 9 = 1 en la palabra de estado de comunicación
del DB de datos de red), el búfer de recepción del DB de procesador de comunicaciones no
acepta los datos del esclavo actual. La instrucción indica esta situación en la palabra de estado
de comunicación del DB de datos de red y registra la causa del error en la palabra de errores
de comunicación.
Si el bloque detecta un error de parametrización en el DB de parametrización, se guarda una
señal de error en el byte Pafe 1 del DB de datos de red.
La instrucción se llama una vez en cada ciclo del sistema de automatización.

Parámetros
Parámetro

Declaración

Tipo de da‐
tos

Descripción

DBPA

INPUT

INT

Número de bloque del DB de parametrización
Específico de la CPU (no se admite el valor cero)

SYPA

INPUT

INT

Dirección inicial de los parámetros de sistema en el DB de
parametrización

SLPA

INPUT

INT

Dirección inicial de los parámetros del esclavo en el DB de
parametrización

0 <= SYPA <= 8174

0 <= SLPA <= 8184

Programación del PLC
Manual de programación y manejo, 11/2019

7233

Instrucciones
4.2 Instrucciones

Estructura del programa de S_USSR
La figura siguiente muestra la estructura del programa de S_USSR.

)&6B8665

'%GHSURFHVDGRUGH
FRPXQLFDFLRQHV
3DUDPHWUL]DFLµQ\HVWDGR
%ORTXHVGHPDQHMR

'%3$
6<3$
6/3$

%¼IHUGHHQY¯R
%¼IHUGHUHFHSFLµQ

2%
'%GHGDWRVGHUHG
&RQWUROGHFRPXQLFDFLµQHVFODYR

(QY¯RHVFODYR

5HFHSFLµQHVFODYR

ವ
ವ

'%GHSDUDPHWUL]DFLµQ
3DU£PHWURVGHOVLVWHPD
3DUDPHWUL]DFLµQGHFRPXQLFDFLµQ
(VFODYRDQ

Regulación
Nota
Los parámetros de la instrucción U_USST corresponden a los parámetros de la instrucción
S_USSR. Ambas instrucciones acceden a la misma parametrización (parámetros del sistema
y del esclavo) en el DB de parametrización y, por ello, deben parametrizarse de forma idéntica.

7234

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

S_USSI: Inicializar USS
Descripción
La instrucción S_USSI es una función opcional.
Si se llama esta instrucción al arrancar el sistema S7, se generan los bloques de datos de
procesador de comunicaciones, datos de red y parametrización necesarios para la
comunicación. Asimismo, se asignan valores predeterminados a DBPA. La instrucción
S_USSI sirve para generar las áreas de datos mencionadas y asignarles valores
predeterminados, sólo cuando la estructura de los datos de red es igual para todos los
esclavos.
Nota
Si no utiliza S_USSI, preasigne un valor (p. ej. 20000) a DBW 2 en el DB del procesador de
comunicaciones.
Nota
S_USSI a S7‑1500
Tenga en cuenta lo siguiente si utiliza la instrucción S_USSI de la periferia descentralizada
ET 200S 1SI en un S7‑1500.
El parámetro ANZ indica el valor 0 también en caso de error.
Si la CPU es conmutada a STOP por la instrucción S_USSI, compruebe todos los errores
posibles listados en el parámetro ANZ.

Funcionamiento
Cuando se llama, la instrucción comprueba primero la plausibilidad de su parametrización en
relación con el número de esclavos, la estructura de los datos de red, el número de nodo de
inicio y las repeticiones de PKW. Si el bloque detecta un error, no se ejecuta ni la generación
ni la asignación de valores predeterminados de los bloques de datos. La CPU pasa al estado
operativo STOP y el usuario obtiene un mensaje de error a través del byte de error de la
instrucción S_USSI. Una vez solucionado el error de parametrización, deben borrarse todos
los bloques de datos generados antes del rearranque completo.
Después de verificar la plausibilidad, el bloque comprueba si los bloques de datos que deben
generarse ya existen:
● Si los bloques de datos que deben generarse aún no existen, se crean y se asignan valores
predeterminados a DBPA.
● Si ya existen, se comprueba la longitud de cada bloque. Si el DB es lo suficientemente
largo, se vuelve a crear la preselección de valores predeterminados del DB de
parametrización y se borra el contenido del DB de datos de red y del DB del procesador de
comunicaciones. Si un DB es demasiado corto, la CPU pasa al estado operativo STOP. El
usuario reconoce el DB defectuoso en el byte de visualización de la instrucción S_USSI.
Para solucionar el error, deben borrarse por completo los tres bloques de datos. Cuando se
realiza un rearranque completo, se crean de nuevo y se asignan valores predeterminados
al DB de parametrización.

Programación del PLC
Manual de programación y manejo, 11/2019

7235

Instrucciones
4.2 Instrucciones
La instrucción S_USSI tiene que llamarse una vez durante el arranque del sistema (OB100).

Parámetros
Parámetro

Declaración

Tipo de
datos

Descripción

SANZ

INPUT

INT

Número de esclavos con la misma estructura de datos
de red (parámetros del sistema en DBPA)
1 ≤ SANZ ≤ 31

TNU1

INPUT

INT

Número de estación de inicio (número de equipo)
0 ≤ TNU1 ≤ 31

PKW

INPUT

INT

PKW, cantidad
Número de palabras de la interfaz PKW 0, 3 ó 4

PZD

INPUT

INT

PZD, cantidad
Número de palabras de la interfaz PZD
0 ≤ PZD ≤ 16

DBND

INPUT

INT

Número de DB de datos de red
Específico de la CPU (no se admite el valor cero)
Rango admisible: 60000 a 60999

DBPA

INPUT

INT

Número del DB de parametrización
Específico de la CPU (no se admite el valor cero)
Rango admisible: 60000 a 60999

DBCP

INPUT

INT

Número del DB del procesador de comunicaciones
Específico de la CPU (no se admite el valor cero)
Rango admisible: 60000 a 60999

WDH

INPUT

INT

Número de repeticiones permitidas de una orden PKW
0 ≤ WDH ≤ 32767

ANZ

OUTPUT

BYTE

Byte de error
0: No hay error
1: número de esclavos excesivo
2: datos no permitidos para estructura de datos de red
3: DB de parametrización: número no admisible o DB
demasiado corto
4: DB de datos de red: número no admisible o DB de‐
masiado corto
5: error en número de estación
6: DB del procesador de comunicaciones: número no
admisible o DB demasiado corto
7: libre
8: Contador de repeticiones: valor incorrecto

7236

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

DB de datos de red
Descripción
El DB de datos de red constituye la interfaz entre el programa de comunicación y el programa
de control. El usuario debe preparar este bloque "vacío" con la longitud suficiente.

Funcionamiento
Estos bloques de datos pueden crearse con la instrucción S_USSI al arrancar la CPU; también
se les pueden asignar valores predeterminados (sólo DBPA) o introducirse manualmente.
En el búfer de transmisión del DB de datos de red, asignado al esclavo por el programa de
control, sólo se registran los datos de envío para un esclavo. Los datos de respuesta del
esclavo se toman desde el búfer de recepción correspondiente (tras la evaluación del bit 9 en
la palabra de control de comunicación). Las palabras de estado permiten controlar la
comunicación y la palabra de mando, el lanzamiento selectivo de una orden de
parametrización.
La interfaz de comunicación contiene los datos siguientes una vez para cada esclavo:
● Datos de comunicación relacionados con el esclavo (control de comunicación,
seguimiento, 6 palabras de datos)
● Búfer para la orden PKW en curso (sólo si existe un área PKW)
● Búfer de transmisión para datos de red (máximo 20 palabras de datos)
● Búfer de recepción para datos de red (máximo 20 palabras de datos)
La longitud de los búferes de transmisión y recepción depende de la estructura de datos de red
seleccionada. Si falta la interfaz PKW, se suprime el búfer para la orden PKW actual.
La longitud total del DB de datos de red necesario depende de la cantidad de esclavos y de la
estructura de datos de red empleada.
Número de palabras de datos por esclavo = 2 x (PKW + PZD) + PKW + 6
Si PKW = 0, 3 ó 4 y 0 <= PZD <= 16
Ejemplo: Un accionamiento con un área PKW de 3 palabras y un área PZD de 2 palabras
ocupa 19 palabras de datos en el DB de datos de red.
El DB de datos de red tiene 1550 palabras de datos con 31 esclavos y la longitud máxima de
datos de red. DBW0 está reservado.

Programación del PLC
Manual de programación y manejo, 11/2019

7237

Instrucciones
4.2 Instrucciones

Asignación de datos del esclavo en el DB de datos de red con 4 palabras en el área PKW y de 0 a 16
palabras en el área PZD
DBWn

Interna

Control de la comunicación

DBWn+2

Palabra de control de comunicación
(KSTW)

DBWn+4

Palabra de estado de comunicación

Seguimiento de la comunicación

DBWn+6

Palabra de error de comunicación

DBW n+8

Interna

DBW n+10

Byte PAFE 1, byte PAFE 2

DBW n+12

ID de parámetro

PKE

DBW n+14

Índice

IND

Búfer para orden

DBW n+16

Valor de parámetro 1

PWE1

PKW actual

DBW n+18

Valor de parámetro 2

PWE2

DBW n+20

ID de parámetro

PKE

DBW n+22

Índice

IND

Valor de parámetro 1

PWE1

DBW n+26

Valor de parámetro 2

PWE2

DBW n+28

Palabra de mando (STW)

PZD1

DBW n+30

Valor de consigna principal
(HSW)

PZD2

DBW n+32

Valor consigna/palabra de man‐ PZD3
do adicional

DBW n+34

Valor consigna/palabra de man‐ PZD4
do adicional
Valor consigna/palabra de man‐ PZD16
do adicional

DBW n+60

ID de parámetro

PKE

DBW n+62

Índice

IND

DBW n+64

Valor de parámetro 1

PWE1

DBW n+66

Valor de parámetro 2

PWE2

DBW n+68

Palabra de estado (ZSW)

PZD1

DBW n+70

Valor real principal (HIW)

PZD2

DBW n+72

Valor real/palabra de estado
adicional

PZD3

DBW n+74

Valor real/palabra de estado
adicional

PZD4

DBW n+98

Área PKW

Área PZD

Búfer de transmi‐
sión

(máx. 16 palabras PZD)

...

DBW n+58

...

Contador de intentos de PKW
Error de parámetro

DBW n+24

...

Estado de error

Área PKW

Área PZD

Búfer de recep‐
ción

(máx. 16 palabras PZD)

...
Valor real/palabra de estado
adicional

PZD16

•
(n = 2,4,6...)

7238

•

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
Si hay un área PKW, el búfer para las órdenes PKW actuales y el área PKW del búfer de
transmisión no existen.

Palabra de control de comunicación KSTW (DBW n)
Los bits de la palabra de control de comunicación coordinan el programa de usuario y la
instrucción S_USST.
15

14

13

12

11

10

9

8

7

6

5

4

3

2

1

0

● Bit 0: Inicio de orden PKW
El usuario activa el bit 0 cuando hay una nueva orden PKW nueva en el búfer de transmisión
y debe procesarse. La instrucción desactiva el bit cuando se ha aceptado la orden PKW.
● Bit 1: Aceptación del informe de modificación de parámetros
El usuario activa el bit 1 cuando se ha aceptado el informe de modificación de parámetros.
La instrucción desactiva el bit para acusar la admisión. Tras este acuse, el esclavo prosigue
con el procesamiento interrumpido de la orden en curso o transfiere el siguiente informe de
modificación de parámetros.

Palabra de estado de comunicación (DBW n+4)
Los bits de la palabra de estado de comunicación son activados por las instrucciones S_USST
y S_USSR.
15

14

13

12

11

10

9

8

7

6

5

4

3

2

1

0

● Bit 0: Orden PKW en proceso
La instrucción S_USST activa el bit 0 cuando se ha aceptado la orden PKW y el ID de
parámetro (PKE) contiene un ID de orden válido. La instrucción S_USSR desactiva el bit
cuando se ha ejecutado la orden PKW (con o sin errores) o cuando la interfaz PKW falla.
● Bit 1: La orden ha finalizado sin errores
La instrucción S_USSR activa el bit 1 cuando se ha ejecutado una orden PKW sin errores.
La respuesta debe tomarse del búfer de recepción. La instrucción S_USST desactiva el bit
cuando se inicia una nueva orden PKW.
Nota
Las órdenes PKW del esclavo se procesan en el orden de la lista de sondeo (DBPA). Cada
esclavo sólo tiene una orden activa. Si hay más de un esclavo registrado en la lista de
sondeo, los datos de respuesta para una nueva orden PKW sólo están disponibles en un
flanco positivo del bit 1 (o del bit 2).

Programación del PLC
Manual de programación y manejo, 11/2019

7239

Instrucciones
4.2 Instrucciones
● Bit 2: orden PKW finalizada con errores
La instrucción S_USSR activa el bit 2 en caso de ID de respuesta en PKE. El número de
error se encuentra en PWE de la respuesta del esclavo. La instrucción S_USST desactiva
el bit cuando se inicia una nueva orden PKW.
Nota
La última orden PKW que ha transferido el usuario se guarda en la interfaz de transmisión
tras su procesamiento. La transferencia al esclavo se repite hasta que se introduce una
nueva orden. De este modo, es posible que se requieran respuestas adicionales en el
programa de usuario si la orden PKW de estado finaliza con errores (bit 2) y con un fallo de
interfaz PKW (bit 4).
● Bit 3: ID de orden PKW no válido.
La instrucción S_USST activa el bit 3 cuando se determina el ID de orden 15 en PKE o
cuando se registra el índice 255 en el ID de orden 4. La instrucción S_USST desactiva el bit
cuando se inicia la siguiente orden PKW con un ID de orden válido en PKE.
● Bit 4: Interfaz PKW con errores (desbordamiento del contador).
La instrucción S_USSR activa el bit 4 cuando el esclavo no responde a una orden PKW tras
repetirla un número de veces parametrizable (parámetro WDH en el DB de
parametrización) o cuando el ID de respuesta en PKE es 8. La instrucción S_USSR
desactiva el bit cuando se inicia y ejecuta correctamente una nueva orden PKW.
● Bit 5: Los datos de respuesta contienen un informe de modificación de parámetros.
La instrucción S_USSR activa el bit 5 cuando existe un informe de modificación de
parámetros del esclavo (ID de respuesta 9 - 12 y bit de conmutación 11 invertido). La
instrucción S_USST desactiva el bit cuando el usuario acusa el informe de modificación de
parámetros (palabra de mando de comunicación, bit 1).
● Bit 6: Fallo de funcionamiento en el esclavo.
La instrucción S_USSR activa y desactiva el bit 6. La instrucción evalúa la palabra de
estado (bit 3) del esclavo.
● Bit 7: Hay una advertencia del esclavo
La instrucción S_USSR activa y desactiva el bit 7. La instrucción evalúa la palabra de
estado (bit 7) del esclavo.
● Bit 8: Se requiere control desde el sistema de automatización.
La instrucción S_USSR activa y desactiva el bit 8. La instrucción evalúa la palabra de
estado (bit 9) y la palabra de control (bit 10).
● Bit 9: Error colectivo de comunicación.
La instrucción S_USSR activa y desactiva el bit 9. La instrucción evalúa las respuestas de
los bloques estándar S_SEND y S_RCV y comprueba el telegrama recibido en relación con
ADR, STX, BCC y LGE. La instrucción comunica además que se ha excedido el tiempo de
vigilancia de telegrama.
Nota
Los datos de recepción del DB de datos de red sólo son válidos si el bit 9 = 0.

7240

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Estructura de la palabra de error de comunicación (DBW n+6)
15

14

13

12

11

10

9

8

7

6

5

4

3

2

1

0

● Bit 0: Error de direccionamiento (ADR)
● Bit 3: Inicio de telegrama no detectado (el primer carácter no es STX)
● Bit 4: Error de carácter de comprobación de bloque (BCC)
● Bit 6: Error de longitud de telegrama (LGE)
La instrucción S_USSR activa los bits 0, 3, 4 y 6 cuando se detecta un error al verificar el
telegrama recibido (ADR, STX, BCC, LGE).
● Bit 7: Tiempo de supervisión de telegrama transcurrido
La instrucción S_USSR activa el bit 7 cuando el tiempo entre la transmisión del telegrama
por parte del maestro al esclavo y la llegada de la respuesta del esclavo supera el tiempo
permitido calculado por el programa (tiempo de vigilancia de telegrama).
Los demás bits no se utilizan.

Byte PAFE 1
Mensaje de error de la instrucción S_USSR, error de parametrización en el DB de
parametrización
● Valor 0: No hay fallo
● Valor 1: Datos erróneos para PKW / PZD

Byte PAFE 2
Mensaje de error de la instrucción S_USST, error de parametrización en el DB de
parametrización
● Valor 0: No hay fallo
● Valor 1: Datos erróneos para PKW / PZD

ID de parámetro PKE en el búfer de transmisión
El usuario debe introducir el número de parámetros (bits 0 a 10) y el ID de orden (bits 12 a 15).
El bit de conmutación para el informe de modificación de parámetros (bit 11) es enmascarado
por las instrucciones S_USSR y S_USST.

DB de parametrización
Descripción
El DB de parametrización contiene los parámetros de programa necesarios para controlar la
comunicación. El usuario debe crear este bloque y asignar valores predeterminados a la
configuración del sistema de comunicación de forma pertinente (S_USSI o manualmente). Los
esclavos del bus se procesan en el orden de la entrada en DBPA (lista de sondeo).

Programación del PLC
Manual de programación y manejo, 11/2019

7241

Instrucciones
4.2 Instrucciones
Un esclavo también puede registrarse varias veces en el DB de parametrización, con lo que su
prioridad aumenta de forma efectiva.

Funcionamiento
La longitud del DB de parametrización depende del número n de los esclavos a los que debe
accederse en un ciclo de bus.
Número de palabras de datos del DB de parametrización = (n x 4) + 5.
Para cada comunicación con un esclavo se requieren 4 palabras de datos y para los
parámetros de sistema se ocupan 4 palabras de datos una sola vez. DBW0 está reservado.

Asignación del bloque de datos
DBW 0

Libre

DBW 2

DBCP

DBW 4

SANZ

DBW 6

SLAV

DBW 8

WDH

DBW 10

Número de PKW, número de PZD

Parámetros del sistema

DBW 12

TUN

Comunicación

DBW 14

DBND

Registro de parámetros esclavo 1

DBW 16

KSTW

DBW 18

Número de PKW, número de PZD

DBW 20

TUN

Comunicación

DBW 22

DBND

Registro de parámetros esclavo 2

DBW 24

KSTW

Número de PKW, número de PZD

DBW (n x 8 + 8)

TUN

Comunicación

DBND

Registro de parámetros esclavo n

KSTW

Parámetros del sistema

7242

DBCP

Número de bloque del DB de procesador de comunicaciones

SANZ

Número total de registros de parámetros de esclavo en el DB de parametrización Si hay que
acceder a determinados esclavos con mayor frecuencia que a otros dentro de un ciclo de
bus, registre los parámetros de esclavo varias veces en el DB de parametrización. El pará‐
metro de sistema SANZ debe adaptarse de la forma correspondiente.

SLAV

Número correlativo del esclavo actual. Es requerido por la FC S_USST y la FC S_USSR para
determinar el registro de parámetros actual. A esta palabra de datos debe asignársele el
valor predeterminado 1 De ello se encarga la FC S_USSI, siempre que se utilice.

WDH

Número de repeticiones permitidas de una orden PKW (rango de valores: 0 a 32767). Si la
orden PKW actual no finaliza dentro del número de registro, se notifica que la interfaz PKW
está defectuosa.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parametrización de comunicación de esclavo:
Número de
Definición de la estructura de datos de red
PKW,
Byte izquierdo: Número de palabras para el área PKW (0, 3, 4)
número de PZD Byte derecho: Número de palabras para el área PZD (0 a 16)
Cualquier dato que no se corresponda será interpretado como error de parametriza‐
ción (por las FC S_USST y S_USSR) y se registrará en los bytes Pafe 1 y 2 del DB de
datos de red.
TUN

Número de estación, que equivale a la dirección de bus ajustada en el accionamiento
(0 a 31).

DBND

Número de bloque del DB de datos de red.

KSTW

Dirección de la palabra de mando de comunicación KSTW para el esclavo en el DB
de datos de red.

DB del procesador de comunicaciones
Descripción
A través de este bloque de datos tiene lugar el intercambio de datos entre la CPU y el módulo
de interfaz serie ET 200S Modbus/USS. El usuario debe poner este bloque a disposición con
la longitud suficiente. El DB del procesador de comunicaciones debe tener una longitud
mínima de 50 palabras (DBW 0 a 98)

Estructura del DB del procesador de comunicaciones
DBW 0

Estado de la comunicación

ENVIAR y RECIBIR

DBW 2

Número máximo de
Contador de ci‐
ciclos al esperar a re‐ clos para formar
cibir
timeout al espe‐
rar a recibir

FC17

DBW 4

Pausa de inicio medida

DBW 6

Duración dle último ciclo
(OB1_MIN_CYCLE)

DBW 8

Longitud del telegrama de envío (LEN)

DBB10

Libre

FC17
FC17, OB1
ENVIAR

DBB 11
:

Búfer de transmisión

Enviar telegrama a módulo
(La longitud se rige por la estructura de los
datos útiles del esclavo actual)

:
DBB 54
DBB 55
:

Búfer de recepción

:
DBB 98

Programación del PLC
Manual de programación y manejo, 11/2019

Telegrama recibido por el módulo (La lon‐
gitud se rige por la estructura de los datos
útiles del esclavo actual)

7243

Instrucciones
4.2 Instrucciones

Estado de comunicación DBW0
Bit n.º
0

Entrada REQ para S_SEND

Este bit se pone a 0 cuando se activa el bit 8.

1

Entrada R para S_SEND

S_USST pone cíclicamente este bit a cero.

2

Salida DONE de S_SEND

3

Salida ERROR de S_SEND

4

Entrada EN_R para S_RCV

S_USSR pone cíclicamente este bit a 1.

5

Entrada R para S_RCV

S_USSR pone cíclicamente este bit a 0.

6

Salida NDR de S_RCV

7

Salida ERROR de S_RCV

8

Petición en curso (bit DONE de
S_SEND guardado)

S_USST pone cíclicamente este bit a 0.

Duración dle último ciclo DBW6
S_USST mide con este parámetro el tiempo de respuesta de un esclavo. El programa de
usuario debe copiar en este parámetro el tiempo de ciclo del sistema de automatización
(OB1_MIN_CYCLE) antes de cada llamada del S_USST .

MODBUS/TCP CP
MODBUSCP: Comunicación como cliente Modbus/TCP o servidor Modbus/TCP
MODBUSCP V2
Información general
Generalidades
La instrucción MODBUSCP es un producto de software para los procesadores de
comunicaciones CP 343-1 y CP 443-1.
Con la instrucción se establece una comunicación entre un CP 443-1 o CP 343-1 y un
interlocutor que soporta el protocolo Modbus/TCP.
Las conexiones TCP/IP vía CP son conexiones estáticas que no se desconectan durante el
funcionamiento correcto.
La configuración de conexiones de STEP 7 solo permite utilizar, con la pila de TCP del CP, un
número de puerto determinado una única vez. Determinados tipos de CP pueden mantener y
manejar paralelamente conexiones a varios clientes a través del puerto 502 local.
En el capítulo "Uso de conexiones en el puerto 502 (Página 7253) " se explican los detalles
técnicos al respecto.
La transferencia de datos se gestiona según elprincipio de cliente-servidor.

7244

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
SIMATIC S7 puede operar como cliente o como servidor durante la transferencia.

Instrucciones paso a paso
1. Configuración del CP como servidor (Página 7249) o cliente (Página 7245).
2. Llamada de la instrucción MODBUSCP en el OB necesario.
– Consulte Puesta en marcha (Página 7251)
3. Parametrización del DB de parámetros de acuerdo con los requisitos (ID, cliente/servidor,
registro Modbus, áreas de DB, etc.).
– Consulte Bloque de datos de parámetros (Página 7254)
4. Parametrización del bloque Modbus para la inicialización y el tiempo de ejecución.
– Consulte Funcionamiento de la instrucción (Página 7258)
5. Carga del programa de usuario en la CPU y concesión de licencia del bloque Modbus para
esta CPU.
– Consulte Concesión de licencia (Página 7263).

Puesta en marcha
Configuración del CP como cliente Modbus/TCP
Requisitos
● El editor "Dispositivos y redes" está abierto.
● El hardware siguiente está presente en la "Vista de dispositivos":
– S7 300/400, por ejemplo, 315-2 DP o 414-2 DP
– Procesador de comunicaciones CP 343-1/443-1

Parametrización del CP
1. Seleccione el CP.
2. Añada una subred en la ventana de inspección, bajo "Propiedades > General > Direcciones
Ethernet" de la interfaz PROFINET del CP.
3. Introduzca la dirección IP y la máscara de subred.

Programación del PLC
Manual de programación y manejo, 11/2019

7245

Instrucciones
4.2 Instrucciones

Agregar conexión TCP
1. En la vista de redes, haga clic en "Conexiones".
2. Seleccione el tipo de conexión "Conexión TCP".
3. En el menú contextual de la CPU, elija el comando "Agregar nueva conexión".
4. Seleccione el interlocutor de conexión "Sin especificar".
5. Seleccione el módulo de comunicación como interfaz local.
6. Active la función "Establecer conexión activa".
7. Haga clic en "Agregar" y cierre el cuadro de diálogo.

7246

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Programación del PLC
Manual de programación y manejo, 11/2019

7247

Instrucciones
4.2 Instrucciones

Parametrización de la conexión TCP
1. En la ventana de inspección, bajo "Propiedades > General > General", introduzca la
dirección IP del interlocutor.

2. En "Propiedades > General > ID local", introduzca la ID local que parametriza para la
conexión Modbus/TCP en el bloque "MODBUSCP".
También necesita el valor del parámetro "LADDR" para la parametrización del bloque
"MODBUSCP", consulte Bloque de datos de parámetros (Página 7254).

3. En "Propiedades > General > Detalles de dirección", indique como puerto interlocutor
"502".
Acepte el valor predeterminado para el puerto local del CP, por ejemplo, 2000.

7248

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Configurar el CP como servidor Modbus/TCP
Requisitos
● El editor "Dispositivos y redes" está abierto.
● El hardware siguiente está presente en la "Vista de dispositivos":
– S7 300/400, por ejemplo, 315-2 DP o 414-2 DP
– Procesador de comunicaciones CP 343-1/443-1

Parametrización del CP
1. Seleccione el CP.
2. Añada una subred en la ventana de inspección, bajo "Propiedades > General > Direcciones
Ethernet" de la interfaz PROFINET del CP.
3. Introduzca la dirección IP y la máscara de subred.

Programación del PLC
Manual de programación y manejo, 11/2019

7249

Instrucciones
4.2 Instrucciones

Agregar conexión TCP
1. En la vista de redes, haga clic en "Conexiones".
2. Seleccione el tipo de conexión "Conexión TCP".
3. En el menú contextual de la CPU, elija el comando "Agregar nueva conexión".
4. Seleccione el interlocutor de conexión "Sin especificar".
5. Seleccione el módulo de comunicación como interfaz local.
6. Desactive la función "Establecer una conexión activa".
7. Haga clic en "Agregar" y cierre el cuadro de diálogo.

7250

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parametrización de la conexión TCP
1. En la ventana de inspección, bajo "Propiedades > General > ID local", introduzca la ID local
que parametrice para la conexión Modbus/TCP en el bloque "MODBUSCP".
También necesita el valor del parámetro "LADDR" para la parametrización del bloque
"MODBUSCP", consulte Uso de conexiones en el puerto 502 (Página 7253).

2. En "Propiedades > General > Detalles de dirección", indique como puerto local "502".

Consulte también
Bloque de datos de parámetros (Página 7254)
Bloques add-on para la comunicación Modbus/TCP (http://
support.automation.siemens.com/WW/view/es/62830463)

Llamada de la instrucción MODBUSCP
Requisitos y principios básicos
El uso de la instrucción MODBUSCP V2.0 es posible con STEP7 V14 SP1 Update 2 (TIA
Portal) o superior.
La instrucción MODBUSCP se ha creado tomando como base la Modbus Application Protocol
Specification V1.1b3, April 26, 2012 ; , consulte Página de inicio de Modbus (http://
www.modbus.org).

Programación del PLC
Manual de programación y manejo, 11/2019

7251

Instrucciones
4.2 Instrucciones

Llamada de la instrucción
Para que el programa se ejecute correctamente, la instrucción MODBUSCP debe llamarse en
un OB cíclico (OB1 o en un OB controlado por tiempo, p. ej., OB35).
No se permite la llamada simultánea de la instrucción MODBUSCP en el OB1 y en un OB
controlado por tiempo (p. ej., OB35). El OB121 debe estar presente en la CPU. Para más
información al respecto, consulte Concesión de licencia (Página 7263).

Inserción del bloque Modbus
Abra el bloque "Main [OB1]" o un bloque cíclico. La instrucción MODBUSCP está ubicada en
la Task Card, paleta y carpeta "Instrucciones> Comunicación > Procesador de
comunicaciones". Abra allí la carpeta "MODBUS TCP" y arrastre la instrucción MODBUSCP al
bloque OB.
En "Bloques de sistema > Recursos de programa", junto a MODBUSCP (FB75), se visualizan
ahora las instrucciones subordinadas MB_CPCLI (FB76) y MB_CPSRV (FB77). Estas
instrucciones subordinadas no se pueden llamar adicionalmente en un OB. Se siguen
visualizando las instrucciones de comunicación AG_(L)SEND (FC5/FC50), AG_(L)RECV
(FC6/FC60) y AG_CNTRL (FC10) llamadas internamente.

Versiones de los bloques AG
Si en V14 utiliza los bloques migrados, se utilizarán las siguientes versiones:
● Uso de un S7-300:
– AG_SEND

V4.2

– AG_RECV

V4.7

– AG_CNTRL

V1.4

● Uso de un S7-400:
– AG_LSEND

V3.1

– AG_LRECV

V3.1

– AG_CNTRL

V1.0

Si en V14 utiliza los bloques integrados, necesitará las siguientes versiones en la librería
"Simatic NET CP":
● Uso de un S7-300:
– AG_SEND

V1.2

– AG_RECV

V1.2

– AG_CNTRL

V1.1

● Uso de un S7-400:

7252

– AG_LSEND

V1.1

– AG_LRECV

V1.1

– AG_CNTRL

V1.1

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Uso de conexiones en el puerto 502
Algunos procesadores de comunicaciones pueden multiplexar las conexiones TCP. Al
hacerlo, pueden conectarse varios clientes Modbus/TCP en el puerto 502 del CP. El CP opera
como servidor Modbus/TCP.
Nota
En caso de usar versiones anteriores del firmware, tenga en cuenta que solo se configura una
conexión, independientemente de cuántos clientes tengan acceso al CP como servidor.
Con los nuevos CP o las nuevas versiones de software pueden configurarse varias conexiones
para el puerto 502.
Encontrará información al respecto en los datos del CP y del firmware o siguiendo el enlace:
SIMATIC Modbus/TCP (https://support.industry.siemens.com/cs/de/en/view/104946406)

Requisitos
Para poder utilizar esta función, en la parametrización de la conexión deben efectuarse los
siguientes ajustes:
● CP es servidor
● Puerto 502 como puerto local
● Conexión TCP sin especificar en "Dispositivos y redes"
● Establecimiento de conexión pasivo

Número de conexiones
El CP puede comunicarse mediante el puerto 502 con un máximo de 4 clientes a la vez.

Visualización del estado de la conexión
El estado de la conexión puede visualizarse tanto en el editor "Dispositivos y redes" de la
ventana de inspección, bajo "Diagnóstico > Información del dispositivo", como en el
diagnóstico especial del CP.
Puesto que en el editor "Dispositivos y redes" solo hay configurada una conexión, la indicación
muestra el estado de todas las conexiones TCP de los distintos clientes.
Si no hay ningún cliente que haya establecido una conexión, aparece la indicapassción
"Establecimiento de conexión pasiva". En cuanto un cliente haya establecido una conexión, se
mostrará "Conexión establecida". No puede determinarse cuántos clientes están conectados
actualmente con el CP.

Comportamiento en caso de fallo
En determinados casos de fallo, el CP tiene que interrumpir y establecer de nuevo la conexión
para volver al estado básico. De esta acción se encarga la instrucción MODBUSCP. Al hacerlo
se deshacen todas las conexiones existentes a través el puerto 502.

Programación del PLC
Manual de programación y manejo, 11/2019

7253

Instrucciones
4.2 Instrucciones

Sugerencias para el programa de usuario
Si hay varias conexiones a través del puerto 502, en el programa de usuario no es evidente qué
cliente ha enviado la petición de Modbus/TCP actual. Si los clientes utilizan distintos números
UNIT, puede hacerse distinción con los medios propios del programa.

Consulte también
Configurar el CP como servidor Modbus/TCP (Página 7249)

Comportamiento en arranque del CP 343-1 y el CP 443-1
El arranque del CP se divide en las siguientes fases:
● Inicialización (conexión del CP)
En cuanto hay tensión en el CP, se prepara el firmware del CP para el funcionamiento
después de ejecutar un programa de test del hardware.
● Parametrización
Durante la parametrización el CP recibe los parámetros de módulo asignados al slot actual.
El procesador de comunicaciones ahora está operativo.

Bloque de datos de parámetros
Parametrización de la comunicación Modbus
Para la comunicación a través de un CP 343 y un CP 443 es necesario configurar las
conexiones en el editor "Dispositivos y redes".
Pueden configurarse y establecerse simultáneamente varias conexiones con diferentes
interlocutores de comunicación. El número de conexiones que pueden establecerse
simultáneamente varía en función de la CPU utilizada y del CP empleado.
Bloque de datos de parámetros
Los datos necesarios para la asignación de las conexiones y el procesamiento de los
telegramas Modbus/TCP se definen en el tipo de datos PLC MB_CP_PARAM. Este tipo de
datos PLC contiene una estructura para los datos específicos de las conexiones y los
parámetros Modbus. Cada instancia de la instrucción "MODBUSCP" necesita una conexión
unívoca. Por tanto, establezca una conexión propia con cada interlocutor de comunicación en
el editor "Dispositivos y redes" para cada instancia de la instrucción.
Para cada una de estas conexiones se necesita una instancia del tipo de datos PLC en un
bloque de datos, en la que se definen los datos de conexión y los parámetros Modbus. Para
cada conexión adicional, el bloque de datos se puede ampliar o se puede crear un bloque de
datos nuevo.
En el bloque de datos de parámetros pueden encontrarse los datos de configuración de todas
las conexiones. También es posible crear un bloque de datos de parámetros aparte para cada

7254

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
conexión. Este o estos bloques de datos solo están previstos para los parámetros de conexión
y Modbus, por lo que en ellos no se pueden guardar otros datos.
Nota
Si en una estación hay varios CP y a través de ellos se configuran conexiones Modbus/TPC,
respectivamente, no pueden guardarse conexiones con la misma ID en el mismo bloque de
datos de parámetros. En este caso, debe crearse un bloque de datos de parámetros por cada
CP.
Cada parámetro empieza con el prefijo "ID_x_", donde x es el número del ID de la conexión. En
esta ayuda en pantalla se omite este prefijo para una mayor claridad.

Programación del PLC
Manual de programación y manejo, 11/2019

7255

Instrucciones
4.2 Instrucciones
Figura 4-61

MODBUS_PARAM_CP

Estructura
'LUHFFLµQ

1RPEUH



&RQH[LµQ3DU£PHWURVGHFRQH[LµQ



&RQH[LµQ3DU£PHWURV0RGEXV



&RQH[LµQ3DU£PHWURVGHFRQH[LµQ



&RQH[LµQ3DU£PHWURV0RGEXV


 L
 L


&RQH[LµQL3DU£PHWURVGHFRQH[LµQ
&RQH[LµQL3DU£PHWURV0RGEXV

● Parámetros de conexión
En el primer bloque se definen los parámetros específicos de la conexión "id" y "laddr". Con
estos parámetros puede asignarse la conexión configurada en el editor "Dispositivos y
redes".
● Parámetros Modbus/TCP
En los parámetros Modbus/TCP se guardan los datos necesarios para el modo de
operación y la referencia de direcciones, por ejemplo, el modo de operación del S7 como
servidor Modbus/TCP o como cliente Modbus/TCP, las direcciones del registro Modbus/
TCP y los números de DB en los que se mapean los datos. La estructura de datos de los
parámetros Modbus/TCP se debe respetar obligatoriamente para que sea posible el
procesamiento sin errores.
Posibilidades de configuración
Existen dos opciones para llevar a cabo la configuración de los parámetros Modbus/TCP y de
conexión.
1. Opción:
En "Objetos tecnológicos", cree un objeto del tipo MB_CP_PARAM con "Insertar nuevo
objeto" en Modbus. Se crea un bloque de datos de parámetros. Con ayuda de un editor, que
se llama mediante "Configuración", es posible realizar la parametrización. Se recomienda
utilizar el editor para editar el bloque de datos de parámetros gracias a la claridad de la
interfaz gráfica de usuario.
2. Opción:
Cree un bloque de datos global nuevo y ábralo. Agregue un parámetro y seleccione el tipo
de datos MB_CP_PARAM para dicho parámetro. En caso de que este tipo de datos no se
muestre en la lista desplegable, introdúzcalo manualmente.
Esta opción permite insertar varias instancias en un bloque de datos.
Modificación de los valores
Los valores del bloque de datos de parámetros no se pueden modificar en tiempo de ejecución.
Después de modificar los parámetros, debe reinicializarse el bloque Modbus con "Init" = TRUE.

7256

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros de conexión
Los dos primeros parámetros del bloque son parámetros de conexión que se emplean
internamente en la instrucción MODBUSCP en las llamadas de AG_SEND/AG_RECV o
AG_LSEND/AG_LRECV.
Parámetros

Descripción

id

Para cada conexión configurada en el TIA Portal (editor "Dispositivos y redes"), se asigna una ID de cone‐
xión. El ID de la conexión describe de forma unívoca la conexión entre la CPU y el interlocutor a través del
CP. Aquí debe introducirse el número de la configuración de la conexión. El rango de valores de este
parámetro es de 1 a 64.

laddr

El parámetro "laddr" es la dirección inicial del CP procedente de la "Vista de dispositivos" (dirección E). Aquí
debe introducirse el valor configurado. El rango de valores de este parámetro depende de la CPU. Los
parámetros "id" y "laddr" pueden consultarse en la máscara "Propiedades > General > ID local" de la
conexión TCP.

Parámetros Modbus/TCP
Con el resto de parámetros se determinan el modo de operación de la comunicación Modbus/
TCP y el mapeo de las direcciones Modbus/TCP en las direcciones SIMATIC. Pueden
parametrizarse hasta 8 áreas de datos. Para ello, se debe definir, al menos, la primera de estas
áreas de datos; las 7 restantes son opcionales.
Parámetros

Descripción

server_client

Este parámetro distingue entre modo de cliente y modo de servidor. Si la entrada es TRUE, se trabaja en el
modo de operación "S7 es servidor". El ajuste FALSE selecciona el modo de operación "S7 es cliente".

single_write

En el modo de operación "S7 es cliente", con el parámetro "single_write" = TRUE en las peticiones de
escritura de longitud 1, se utilizan los códigos de función 5 y 6. Si "single_write" = FALSE, en todas las
peticiones de escritura se utilizan los códigos de función 15 y 16.

data_type_x

Con el parámetro "data_type_x" se indica qué tipos de datos Modbus/TCP se mapean en este DB. Si se
introduce el valor 0 en data_type_x, no se utilizará el área de datos correspondiente.
Identificador

Tipo de datos

Ancho de datos

0

Área no utilizada

–

1

Coils

Bit

2

Inputs

Bit

3

Holding Register

Word

4

Input Register

Word

Programación del PLC
Manual de programación y manejo, 11/2019

7257

Instrucciones
4.2 Instrucciones
Parámetros

Descripción

db_x

El parámetro "db_x" especifica el bloque de datos en que se mapean los registros Modbus/TCP o valores
de bit definidos seguidamente. Si se utiliza un bloque de datos global, el número de DB 0 no está permitido,
ya que se reserva para el sistema.
Número DB de 1 a 65535 (de W#16#0001 a W#16#FFFF)

start_x, end_x

Con "start_x" se indica la primera dirección Modbus/TPC que se mapea en la palabra de datos 0 del DB. El
parámetro "start_x" define la dirección de la última dirección Modbus/TCP.
● Al acceder a registros, el número de la palabra de datos del DB S7 en que se introduce la última dirección
Modbus/TCP se calcula según la fórmula siguiente:
Número DBW = (end_x – start_x) ∗ 2
● En accesos de bits, el número del byte de datos del DB S7 en que se introduce la última dirección
Modbus/TCP se calcula según la fórmula siguiente:
Número DBB = (end_x – start_x) / 8
Las áreas de datos definidas no deben solaparse. El parámetro "end_x" no puede ser menor que "start_x".
En caso de fallo, el arranque del FB termina con error. Si ambos valores coinciden, se asigna 1 dirección
Modbus/TCP (1 registro o 1 valor de bit).
En "Mapeo de direcciones (Página 7268)" hay un ejemplo del mapeo de las direcciones Modbus/TCP en las
áreas de memoria de S7.

Descripción MODBUSCP
Descripción
La instrucción MODBUSCP permite establecer una comunicación entre un CP 443-1 o CP
343-1 y un interlocutor que soporte el protocolo Modbus/TCP. Se soportan los códigos de
función 1, 2, 3, 4, 5, 6, 15 y 16.
Según la parametrización, la instrucción puede operar como cliente o como servidor. También
es posible operar simultáneamente un CP como cliente y como servidor. Para ello son
necesarias dos conexiones configuradas en el editor "Dispositivos y redes" y dos llamadas de
la instrucción.
Por parte de la librería no hay ningún límite para el número máximo de bloques Modbus/TCP
funcionando paralelamente. Sin embargo, sí hay un número máximo posible de llamadas de
función de PLC operando simultáneamente, que depende de la CPU y del CP. En el manual
de la CPU, en "Datos técnicos > Comunicación" figura el número máximo de llamadas de PLC.
En el manual del CP se indica cuántos AG_SEND/AG_RECV o AG_LSEND/AG_LRECV
puede procesar paralelamente este CP.
Tareas de los bloques
● Llamada de las funciones estándar para la transmisión de datos entre CPU y CP
● Generación del encabezado del telegrama específico de Modbus/TCP durante la
transmisión
● Comprobación del encabezado del telegrama específico de Modbus/TCP durante la
recepción
● Comprobación de la existencia de las áreas de datos a las que accede el cliente

7258

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
● Generación de telegramas de excepción cuando aparece un error (solo cuando S7 es
servidor)
Exception Code Significado
1

No se soporta el código de función enviado.

2

Se ha producido un acceso a una dirección inexistente o no admitida.

3

Se ha introducido una longitud no válida para este código de función.

● Transferencia de datos desde el DB parametrizado o hacia él
● Vigilancia del tiempo de recepción de datos
● Comprobación de licencia
La instrucción MODBUSCP puede emplearse tanto para S7-300 como para S7-400.

Funcionamiento de la instrucción
Inicialización
La instrucción MODBUSCP se inicializa con un flanco ascendente en la entrada "Init".
● Los parámetros de inicialización deben estar asignados de acuerdo con la configuración de
la instalación.
● Se comprueba la coherencia de los parámetros de inicialización, que luego se aplican en
el DB de instancia.
● Los parámetros de tiempo de ejecución no se evalúan en el arranque.
● Se comprueba la coherencia de los datos procedentes del bloque de datos de parámetros.
Si se detecta un flanco ascendente en el parámetro Init, se ejecutan las acciones antes
mencionadas. Si la comprobación finaliza sin errores, Init se restablece e Init_Error e
Init_Status indican 0.
Si se han producido errores durante la comprobación, se indica en las salidas Init_Error e
Init_Status. Mientras haya presente un error de Init, no es posible la comunicación Modbus/
TCP a través de este bloque. Antes hay que solucionar el error de Init.
Funcionamiento cíclico
En modo cíclico, la instrucción MODBUSCP se llama en el OB1 o en un OB de alarma cíclica.
● Las funciones del bloque se activan mediante los parámetros de tiempo de ejecución.
● Mientras haya una orden en curso, no se evalúan las modificaciones de los parámetros de
tiempo de ejecución.
● Los parámetros de inicialización no se evalúan mientras no se ejecute una inicialización.

Programación del PLC
Manual de programación y manejo, 11/2019

7259

Instrucciones
4.2 Instrucciones
Comportamiento en caso de error de programación OB121
Si la instrucción Modbus/TCP para esta CPU aún no tiene licencia, se llama OB121.
ADVERTENCIA
STOP de la CPU si falta OB121
En caso de que falte OB121, la CPU pasa al estado operativo STOP y pueden aparecer
estados imprevistos de la instalación.
Antes de poner en funcionamiento la instalación, debe asegurarse de que OB121 esté
presente.
Desconexión de la comunicación por parte del interlocutor de comunicación
Si el interlocutor de la comunicación desconecta la conexión TCP, por motivos de las
propiedades del sistema en el modo de operación "S7 es servidor", la siguiente recepción no
será posible hasta al cabo de 1 segundo.
En el modo de operación "S7 es cliente" no se podrán enviar datos hasta al cabo de 150 ms.
Este tiempo de retardo se implementa mediante la instrucción.

Inicio de la orden con "S7 es cliente" o activación de la instrucción con "S7 es servidor"
Los parámetros de salida son indicadores dinámicos y, por tanto, solo están disponibles
durante 1 ciclo de la CPU. Para poderlos procesar posteriormente o visualizarlos en la tabla de
observación, se deben copiar en otras áreas de memoria.
S7 es cliente: inicio de la orden
Mediante un cambio de flanco positivo en la entrada de disparo ENQ_ENR se inicia una orden.
En función de los parámetros de entrada UNIT, DATA_TYPE, START_ADDRESS, LENGTH y
WRITE_READ, se genera un telegrama de orden Modbus/TCP y se transmite a la estación
interlocutora a través de la conexión TCP/IP. El cliente espera a una respuesta del servidor
durante el tiempo parametrizado MONITOR.
Si se rebasa el tiempo (no hay respuesta del servidor) la orden activada termina con error. Se
puede iniciar una nueva orden.
Tras recibirse el telegrama de respuesta se realiza una comprobación de coherencia. Si el
resultado de dicha comprobación es positivo, se llevan a cabo las acciones necesarias y la
orden termina sin error; se activa la salida DONE_NDR. Si se detectan errores durante la
verificación, la orden termina con error, se activa el bit ERROR y se indica un número de error
en STATUS.
S7 es servidor: Activación de la instrucción
Mediante un nivel positivo en la entrada de disparo ENQ_ENR, la instrucción está lista para
recibir un telegrama de orden del cliente. El servidor se comporta pasivamente y espera un
telegrama del cliente.
Si el servidor recibe un telegrama de orden, este comprueba el telegrama recibido. Una vez
superada la comprobación, el servidor envía un telegrama de respuesta. El servidor señala el
final del intercambio de telegramas mediante el bit DONE_NDR = TRUE. En ese momento, se
visualiza la función ejecutada en las salidas UNIT, DATA_TYPE, START_ADDRESS,
LENGTH y WRITE_READ.

7260

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Un telegrama de solicitud erróneo da lugar a un mensaje de error. Se activa el bit ERROR, se
indica el número de error en STATUS y no se responde a la orden del cliente.
Transferencia de datos CPU – CP
La transmisión de datos entre CP y CPU se efectúa con los bloques estándar AG_SEND y
AG_RECV o bien AG_LSEND y AG_LRECV.
Si el usuario activa una orden (S7 es servidor) o recibe un telegrama del cliente (S7 es
servidor), el FB llama el bloque estándar para el CP en la secuencia y cantidad necesarias.
Si el CP recibe un telegrama, primero se hace una lectura de 6 bytes con un AG_(L)RECV.
Estos 6 bytes contienen la longitud del resto del telegrama. A continuación, se efectúa una
segunda llamada de AG_(L)RECV con la longitud restante. La evaluación de los datos de
usuario recibidos se efectúa después de la recepción completa.

Parámetros
Los parámetros de la instrucción MODBUSCP se dividen en dos grupos:
● Parámetros de inicialización
Los parámetros de inicialización solo se evalúan y se adoptan en el DB de instancia si Init
= TRUE. Los parámetros de inicialización se identifican en la tabla con "Sí" en la columna
"Init".
La modificación de los parámetros de inicialización durante el funcionamiento no tiene
ningún efecto. Después de modificar estos parámetros, p. ej., en el modo Test, el DB de
instancia debe reinicializarse con Init = TRUE.
● Parámetros del tiempo de ejecución
Los parámetros del tiempo de ejecución pueden modificarse en el funcionamiento cíclico.
En el modo de operación "S7 es cliente", sin embargo, no es conveniente modificar los
parámetros de entrada mientras haya una orden en curso. Con las preparativos para la
siguiente orden y las modificaciones de parámetros asociadas, debe esperarse hasta que
la orden anterior haya finalizado con DONE_NDR o ERROR.
En el modo de operación "S7 es servidor" solo pueden evaluarse los parámetros de salida
con DONE_NDR activado.
Los parámetros de salida son indicadores dinámicos y, por tanto, solo están disponibles
durante 1 ciclo de la CPU. Para poderlos procesar posteriormente o verlos en la tabla de
variables, se deben copiar en otras áreas de memoria.
En las áreas de valores para los distintos parámetros también deben tenerse en cuenta, las
limitaciones específicas de la CPU, si las hay.
Parámetros

Decl.

Tipo

Descripción

Rango de valo‐
res

Init

id (Página 7270)

IN

WORD

ID de conexión del editor "Dispositivos y redes"

De 1 a 64

Sí

db_param (Pági‐
na 7270)

IN

BLOCK_DB

Número del DB de parámetros

Depende de la
CPU

Sí

REG_KEY_DB
(Página 7263)

IN

BLOCK_DB

Bloque de datos con la clave de registro para la licencia Depende de la
CPU

No

TIME

Tiempo de vigilancia para la recepción de datos del in‐
terlocutor
El tiempo mínimo ajustable es 20 ms

No

MONITOR (Pági‐ IN
na 7277)

Programación del PLC
Manual de programación y manejo, 11/2019

T#20ms hasta
T#+24d20h31
m23s647ms

7261

Instrucciones
4.2 Instrucciones
Parámetros

Decl.

Tipo

Descripción

Rango de valo‐
res

Init

ENQ_ENR (Pági‐ IN
na 7277)

BOOL

S7 es cliente: Inicio de la orden con flanco positivo
S7 es servidor: Listo para recepción con nivel positivo

TRUE/FALSE

No

LICENSED

OUT

BOOL

Estado de licencia del bloque
El bloque tiene licencia
El bloque no tiene licencia

BUSY

OUT

BOOL

Estado de ejecución de las funciones AG_(L)SEND o
AG_(L)RECV
En ejecución
No en ejecución

DONE_NDR

OUT

BOOL

S7 es cliente: TRUE: la orden activada ha terminado sin
error
S7 es servidor: TRUE: se ejecutó y se respondió a la
solicitud del cliente

TRUE/FALSE

No

ERROR (Pági‐
na 7271)

OUT

BOOL

Se ha producido un fallo
No se ha producido ningún fallo

TRUE
FALSE

No

STATUS (Pági‐
na 7271)

OUT

WORD

Número de error

De 0 a FFFF

No

STATUS_FUNC
(Página 7271)

OUT

STRING[8]

Nombre de la función que ha causado el error en STA‐
TUS

Character

No

IDENT_CODE
(Página 7263)

OUT

STRING[18]

Identificación para la licencia
Solicite la licencia con esta cadena de identificación.

Character

No

Init_Error (Pági‐
na 7271)

OUT

BOOL

TRUE: se ha producido un error al inicializar.

TRUE/FALSE

No

Init_Status (Pági‐ OUT
na 7271)

WORD

Estado de la inicialización

De 0 a FFFF

No

UNIT (Pági‐
na 7275)

IN/O
UT

BYTE

Unit Identifier (INPUT en la función CLIENT, OUTPUT
en la función SERVER)

De 0 a 255

No

DATA_TYPE
(Página 7275)

IN/O
UT

BYTE

Tipo de datos por procesar (INPUT en la función
CLIENT, OUTPUT en la función SERVER)

TRUE
FALSE
TRUE
FALSE

No

No

Coils

1

Inputs

2

Holding Register

3

Input Register

4

START_AD‐
DRESS (Pági‐
na 7275)

IN/O
UT

WORD

Dirección inicial MODBUS (INPUT en la función
CLIENT, OUTPUT en la función SERVER)

De 0 a 65535

LENGTH (Pági‐
na 7275)

IN/O
UT

WORD

Número de valores por procesar (INPUT en la función
CLIENT, OUTPUT en la función SERVER)

7262

No

No

No

Coils: Función de lectura

De 1 a 2000

Coils: Función de escritura

De 1 a 1968

Inputs: Función de lectura

De 1 a 2000

Holding Register: Función de lectura

De 1 a 125

Holding Register: Función de escritura

De 1 a 123

Input Register: Función de lectura

De 1 a 125

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Parámetros

Decl.

Tipo

Descripción

Rango de valo‐
res

Init

WRITE_READ
(Página 7275)

IN/O
UT

BOOL

INPUT en la función CLIENT, OUTPUT en la función
SERVER
Acceso de escritura o lectura

TRUE/FALSE

No

Init (Pági‐
na 7270)

IN/O
UT

BOOL

Inicialización en caso de flanco ascendente

TRUE/FALSE

No

Encontrará más información al respecto en Siemens Industry Online Support, en la FAQ con
el ID de artículo: 75312612 (https://support.industry.siemens.com/cs/ww/es/view/75312612)

Consulte también
Llamada de la instrucción MODBUSCP (Página 7251)

Concesión de licencia con los parámetros IDENT_CODE y REG_KEY
Descripción
Se debe obtener una licencia para la instrucción MODBUSCP en cada CPU por separado. La
licencia se concede en 2 pasos:
● lectura del IDENT_CODE y
● introducción del código de validación REG_KEY (clave del Registro).
Para ello, el OB121 debe estar presente en la CPU.
Para la lectura del IDENT_CODE proceda de la manera siguiente:
1. Parametrice la instrucción MODBUSCP de acuerdo con sus requisitos en un OB cíclico.
Cargue el programa en la CPU y póngala en RUN.
2. Abra el DB de instancia de la instrucción Modbus y haga clic en el botón "Observar todos".

Programación del PLC
Manual de programación y manejo, 11/2019

7263

Instrucciones
4.2 Instrucciones
3. En la salida IDENT_CODE se visualiza una cadena de caracteres de 18 dígitos.

Figura 4-62

7264

Modbus/TCP CP: IDENT_CODE en el DB

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
4. Copie este string mediante copiar/pegar desde el bloque de datos al formulario
SOFTWARE REGISTRATION FORM. Este formulario se encuentra en el CD de
instalación.
Introduzca el n.º de licencia del embalaje del producto en el formulario.

Programación del PLC
Manual de programación y manejo, 11/2019

7265

Instrucciones
4.2 Instrucciones

7266

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Figura 4-63

Modbus/TCP CP: IDENT_CODE y formulario de licencia

5. Envíe el formulario mediante una Service Request (solicitud de servicio) al Customer
Support (https://support.industry.siemens.com/my/ww/en/requests/#createRequest).
Luego recibirá el código de validación para la CPU.
El código de validación REG_KEY se debe indicar en cada instrucción MODBUSCP. La clave
REG_KEY debe guardarse en un bloque de datos global a través del cual todas las
instrucciones MODBUSCP recibirán el código de validación necesario.
Para la introducción del código de validación REG_KEY proceda del modo siguiente:
● Mediante "Agregar nuevo bloque…" inserte un bloque de datos global nuevo con un
nombre simbólico unívoco, p. ej. "DB_Licencia".
● Defina un parámetro REG_KEY con el tipo de datos STRING[17] en este bloque.

Figura 4-64

REG_KEY en DB

● Copie el código de validación de 17 dígitos determinado mediante Copiar/Pegar en la
columna 'Valor de arranque'.
● Introduzca el nombre "DB_Licencia" en el OB cíclico, en el parámetro REG_KEY_DB de la
instrucción MODBUSCP.
● Cargue los bloques modificados en la CPU. La introducción del código de validación se
puede realizar durante el tiempo de ejecución, no es necesario pasar de STOP -> RUN.
La comunicación Modbus/TCP a través de la instrucción MODBUSCP ahora tiene licencia
para esta CPU; el bit de salida LICENSED es TRUE.
Falta la concesión de licencia o esta es errónea
Si no se introdujo ningún código de validación o si este es incorrecto, el SF-LED (en S7-300)
o INTF-LED (en S7-400) de la CPU parpadea y se realiza cíclicamente una entrada en el búfer
de diagnóstico relativa a la falta de licencia. El número de error por falta de licencia es
W#16#A090.

Programación del PLC
Manual de programación y manejo, 11/2019

7267

Instrucciones
4.2 Instrucciones

Figura 4-65

Búfer de diagnóstico con A090

ADVERTENCIA
En caso de que el OB121 falte en el controlador, la CPU pasa al estado STOP.

En caso de que falte el código de validación o este sea incorrecto, se procesa la comunicación
Modbus/TCP; sin embargo, en la salida STATUS se muestra constantemente W#16#A090
"No existe ninguna licencia válida". El bit de salida LICENSED es FALSE.

Mapeo de direcciones
Interpretación de las direcciones MODBUS/TCP
El modelo de datos MODBUS contiene las siguientes áreas:
● Coils
● Inputs
● Holding Register
● Input Register
En algunos sistemas, como los PLC MODICON, la distinción de estas áreas de memoria se
realiza mediante la dirección de registro o la dirección de bit. Así, por ejemplo, el Holding
Register con Offset 0 se denomina Register 40001 (tipo de memoria 4xxxx, Reference 0001).

7268

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Siempre da lugar a confusión porque, en algunos manuales, se describe y se hace referencia
a la dirección de registro del Application Layer y, en otros, a la dirección de registro/dirección
de bit transmitida realmente en el protocolo.
La instrucción MODBUSCP utiliza, en sus parámetros start_x, end_x y START_ADDRESS, la
dirección Modbus/TCP realmente transmitida. Por tanto, con cada código de función se
pueden transferir direcciones de registro/direcciones de bits de 0000H a FFFFH.

Ejemplo
Las direcciones Modbus se pueden indicar en formato decimal o hexadecimal en el DB de
parámetros.
Parámetros

Notación decimal

Notación hexadeci‐
mal

Significado

data_type_1

1

B#16#1

Coils

db_1

10

W#16#A

DB 10

start_1

640

W#16#280

Dirección inicial: 640

end_1

1250

W#16#4E2

Dirección final:

data_type_2

3

B#16#3

Holding Register

db_2

11

W#16#B

DB 11

start_2

0

W#16#0

Dirección inicial: 0

end_2

499

W#16#1F3

Dirección final:

data_type_3

3

B#16#3

Holding Register

db_3

12

W#16#C

DB 12

start_3

720

W#16#2D0

Dirección inicial: 720

end_3

900

W#16#384

Dirección final:

1250

499

900

En la siguiente figura se muestra una comparativa de las áreas de memoria SIMATIC con la
partición de memoria orientada a registro y a bit de los dispositivos Modbus/TCP. Se hace
referencia a la parametrización mencionada anteriormente.
En el dispositivo Modbus
Las direcciones Modbus resaltadas en negro afectan al Data Link Layer, mientras que las
grises afectan al Application Layer.
En SIMATIC
Las direcciones SIMATIC representadas en la columna "Offset" son el Offset en el DB. Los
números de registro Modbus se indican entre corchetes.

Programación del PLC
Manual de programación y manejo, 11/2019

7269

Instrucciones
4.2 Instrucciones

Figura 4-66

Modbus/TCP: Mapeo de direcciones

Parámetros id, db_param e Init
Descripción
id
Para cada conexión configurada en STEP 7 (editor "Dispositivos y redes"), se asigna una ID
de conexión. La ID de conexión describe de forma unívoca la conexión entre la CPU y el
interlocutor a través del CP. Esta ID de conexión se configura en el bloque de parámetros de
conexión que contiene el bloque de datos de parámetros. Esta ID debe introducirse aquí.
El rango de valores de este parámetro es de 1 a 64.
db_param
El parámetro db_param indica el número del bloque de datos de parámetros, en el cual se
encuentra el tipo de datos PLC MB_CP_PARAM. En este bloque de datos de parámetros se
guardan los parámetros específicos de conexión y de Modbus que son necesarios para la
comunicación entre la CPU y el interlocutor.

7270

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El rango de valores de este parámetro depende de la CPU. El número de DB 0 no se admite
ya que se reserva para el sistema. El número de DB se introduce en texto explícito con el
formato "DBxy".
Si se deben realizar varias conexiones, el bloque de datos de parámetros puede contener los
parámetros necesarios de todas las conexiones de forma secuencial. También es posible
crear un bloque de datos de parámetros aparte para cada conexión.
Init
El bloque Modbus se inicializa con un flanco ascendente en el parámetro Init. La inicialización
solo puede ejecutarse si no hay peticiones en curso. Esta condición debe garantizarse
programando ENQ_ENR = FALSE y BUSY = FALSE.
Nota
Al inicializar se interrumpen y restablecen las conexiones configuradas.

Consulte también
Bloque de datos de parámetros (Página 7254)
Descripción MODBUSCP (Página 7258)

Parámetros ERROR, STATUS, STATUS_FUNC e Init_Status
Evaluación de errores
La instrucción MODBUSCP dispone de 3 salidas de estado para el diagnóstico de errores:
STATUS, STATUS_FUNC e Init_Status.
ERROR
Si se activa esta salida, significa que se ha detectado un error.
En el modo de operación "S7 es cliente" la petición activada ha finalizado con errores. El
número de error correspondiente se muestra en la salida STATUS.
En el modo de operación "S7 es servidor" se ha detectado un error en un telegrama de solicitud
del cliente o al enviar el telegrama de respuesta. El número de error correspondiente se
muestra en la salida STATUS.
STATUS
La salida STATUS muestra el número de error si ERROR está activado. Se sigue mostrando
información de estado en esta salida.
Las instrucciones MODBUSCP, MB_CPCLI y MB_CPSRV utilizan los bloques estándar
SFC20, SFC24, SFC51 y SFC52, así como AG_SEND/AG_LSEND y AG_RECV/AG_LRECV.
Los mensajes de error de estas instrucciones se transmiten sin modificar a STATUS.
STATUS_FUNC
En este parámetro se muestra el nombre de la función que ha ocasionado el error.

Programación del PLC
Manual de programación y manejo, 11/2019

7271

Instrucciones
4.2 Instrucciones
Init_Status
En la salida Init_Status se emiten mensajes de error e información de estado durante la
inicialización.
Más adelante encontrará un listado de los mensajes de error específicos de las instrucciones.
Parámetro STATUS en STATUS_FUNC = "MODBUSCP" y parámetro Init_Status
Status (Hex) Texto del evento

Solución

A001

El bloque de datos de parámetros es demasiado corto.

Corrija la longitud del DB de parámetros.

A002

El parámetro end_x es menor que el start_x.

Corrija los datos en start_x y end_x.

A003

Un DB en el que se deben mapear direcciones MODBUS es dema‐
siado corto.
Longitud mínima:
en registros:
(end_x - start_x + 1 ) * 2 + 2
- en valores de bit:
(end_x - start_x ) / 8 + 3
otras causas posibles:
• S7 es cliente: parámetros de llamada incorrectos
• S7 es servidor: rango de direcciones incorrecto en el telegrama
de solicitud del cliente. El CP responde con un telegrama de ex‐
cepción.

Amplíe el DB.
S7 es cliente:
Corrija los parámetros de petición
START_ ADDRESS o LENGTH.
S7 es servidor:
Cambie la solicitud del cliente.

A004

Solo S7 es cliente:
Se ha indicado una combinación inadmisible de DATA_TYPE y
WRITE_READ.

Corrija los parámetros de llamada. Solo
se pueden escribir los tipos de datos 1 y
3.

A005

S7 es cliente:
Se ha indicado un valor inadmisible en el parámetro LENGTH.
S7 es servidor:
El número de registros/bits en el telegrama de solicitud es inadmi‐
sible. El CP responde con un telegrama de excepción.

S7 es cliente:
Corrija el parámetro LENGTH.
S7 es servidor:
Modifique el número en el telegrama de
solicitud.

Rangos de valores:
Lectura de coils/inputs

De 1 a 2000

Escritura de coils

De 1 a 1968

Lectura del registro

De 1 a 125

Escritura de Holding Register

De 1 a 123

A006

El área indicada mediante DATA_TYPE, START_ADDRESS y
LENGTH no existe en data_type_1 hasta data_type_8.
S7 es servidor:
El CP responde con un telegrama de excepción.

S7 es cliente: Corrija la combinación de
la parametrización DATA_TYPE,
START_ ADDRESS y LENGTH.
S7 es servidor: Modifique la solicitud del
cliente o corrija la parametrización en
data_type_x.

A007

S7 es cliente: Se ha parametrizado un tiempo de vigilancia no válido
en MONITOR. Se debe introducir un valor >= 20 ms.

Corrija la parametrización.

A008

El AG_RECV activado no notifica ninguna recepción, p. ej., interlo‐ Verifique los ajustes y, dado el caso, los
cutor no listo, en el tiempo de vigilancia parametrizado MONITOR. mensajes de error del interlocutor. Veri‐
La conexión se interrumpe y se establece de nuevo.
fique si el interlocutor puede necesitar
un identificador UNIT determinado.

7272

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Status (Hex) Texto del evento

Solución

A009

S7 es cliente: El Transaction Identifier TI recibido es distinto del
enviado.
La conexión se interrumpe y se establece de nuevo.

Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.

A00A

S7 es cliente: La UNIT recibida es distinta de la enviada.
La conexión se interrumpe y se establece de nuevo.

A00B

S7 es cliente: El código de función que se ha recibido es distinto del
enviado.
S7 es servidor: Se ha recibido un código de función no válido. El CP
responde con un telegrama de excepción.

S7 es cliente:
Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.
S7 es servidor:
Modifique la solicitud del cliente. La ins‐
trucción MODBUSCP procesa los códi‐
gos de función 1, 2, 3, 4, 5, 6, 15 y 16.

A00C

El número de bytes recibido no se corresponde con el número de
bits/de registros.
S7 es servidor: El CP envía un telegrama de excepción.
La conexión se interrumpe y se establece de nuevo.

Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.

A00D

Solo con S7 es cliente: La dirección de registro/bit o el número de
registros/bits del telegrama de respuesta es diferente al del tele‐
grama de solicitud.

A00E

La indicación de longitud del encabezado de telegrama específico Compruebe los datos del interlocutor
de Modbus no coincide con el número de registros/bits o el número con ayuda de un registro de telegramas.
de bytes indicados del telegrama. La instrucción rechaza los datos.
La conexión se interrumpe y se establece de nuevo.

A00F

Se ha recibido un Protocol Identifier distinto de 0.
La conexión se interrumpe y se establece de nuevo.

A010

En los parámetros de db_1 a db_8 se ha asignado un número de DB Corrija la parametrización en db_x.
por duplicado.

A011

En el parámetro de entrada DATA_TYPE se ha indicado un valor
inadmisible (los valores admitidos son 1, 2, 3 y 4).

Corrija los parámetros de llamada.

A012

Las áreas parametrizadas data_type_1 y data_type_2 se solapan.

A013

Las áreas parametrizadas data_type_1 y data_type_3 se solapan.

A014

Las áreas parametrizadas data_type_1 y data_type_4 se solapan.

A015

Las áreas parametrizadas data_type_1 y data_type_5 se solapan.

Corrija la parametrización.
Las áreas de datos no deben disponer
de ningún área común de direcciones
de registro.

A016

Las áreas parametrizadas data_type_1 y data_type_6 se solapan.

A017

Las áreas parametrizadas data_type_1 y data_type_7 se solapan.

A018

Las áreas parametrizadas data_type_1 y data_type_8 se solapan.

A019

Uno de los parámetros db_x se ha ajustado a 0, aunque el da‐
ta_type_x pertinente está parametrizado con > 0. El número de DB0
no se puede utilizar, ya que se reserva para el sistema.

A01A

Longitud incorrecta en el encabezado: Se admiten de 3 a 253 bytes. Compruebe los datos del interlocutor
La conexión se interrumpe y se establece de nuevo.
con ayuda de un registro de telegramas.

A01B

S7 es servidor y código de función 5:
Se ha recibido un estado no válido para Coil.
Se envía un telegrama de excepción.

A01E

Se han recibido datos no válidos que no se han podido asignar.
La conexión se interrumpe y se establece de nuevo.

A01F

La instrucción MODBUSCP está en un estado operativo no permi‐ Póngase en contacto con el Product
tido.
Support.

Programación del PLC
Manual de programación y manejo, 11/2019

Corrija la parametrización en db_x a > 0.
Si utiliza FB recopilador de datos, com‐
pruebe la parametrización en CFC.

Controle el mensaje de error del interlo‐
cutor. Dado el caso, compruebe los da‐
tos con un registro de telegramas.

7273

Instrucciones
4.2 Instrucciones
Status (Hex) Texto del evento

Solución

A023

Las áreas parametrizadas data_type_2 y data_type_3 se solapan.

A024

Las áreas parametrizadas data_type_2 y data_type_4 se solapan.

A025

Las áreas parametrizadas data_type_2 y data_type_5 se solapan.

A026

Las áreas parametrizadas data_type_2 y data_type_6 se solapan.

Corrija la parametrización.
Las áreas de datos no deben disponer
de ningún área común de direcciones
de registro.

A027

Las áreas parametrizadas data_type_2 y data_type_7 se solapan.

A028

Las áreas parametrizadas data_type_2 y data_type_8 se solapan.

A034

Las áreas parametrizadas data_type_3 y data_type_4 se solapan.

A035

Las áreas parametrizadas data_type_3 y data_type_5 se solapan.

A036

Las áreas parametrizadas data_type_3 y data_type_6 se solapan.

A037

Las áreas parametrizadas data_type_3 y data_type_7 se solapan.

A038

Las áreas parametrizadas data_type_3 y data_type_8 se solapan.

A045

Las áreas parametrizadas data_type_4 y data_type_5 se solapan.

A046

Las áreas parametrizadas data_type_4 y data_type_6 se solapan.

A047

Las áreas parametrizadas data_type_4 y data_type_7 se solapan.

A048

Las áreas parametrizadas data_type_4 y data_type_8 se solapan.

A056

Las áreas parametrizadas data_type_5 y data_type_6 se solapan.

A057

Las áreas parametrizadas data_type_5 y data_type_7 se solapan.

A058

Las áreas parametrizadas data_type_5 y data_type_8 se solapan.

A067

Las áreas parametrizadas data_type_6 y data_type_7 se solapan.

A068

Las áreas parametrizadas data_type_6 y data_type_8 se solapan.

A078

Las áreas parametrizadas data_type_7 y data_type_8 se solapan.

A079

La ID de conexión indicada en el parámetro id no se encuentra en
el DB de parámetros.

A07A

Se ha indicado un valor inadmisible en el parámetro id (rango de
valores de 1 a 64).

A07B

La ID indicada está duplicada en el DB de parámetros.

A07C

En el parámetro data_type_x se ha indicado un valor inadmisible
(los valores admitidos van de 0 a 4).

A07D

El parámetro data_type_1 no contiene ninguna entrada. El área de
parámetros "_1" es el área inicial y se debe parametrizar.

A07E

En db_x se ha indicado el número del DB de instancia de la ins‐
trucción MODBUSCP.

A080

El bloque Modbus no se ha inicializado todavía.

A081

Compruebe los datos del interlocutor
Solo con S7 es cliente y código de función 5:
Los datos del telegrama de respuesta no son el eco de la solicitud. con ayuda de un registro de telegramas.

A082

Solo con S7 es cliente y código de función 6:
El valor de registro recibido es distinto del enviado.

7274

Corrija la parametrización en la entrada
id.

Corrija la parametrización en el DB de
parámetros.
Corrija la parametrización en el DB de
parámetros.

Después de transferir el IDB a la CPU se
debe inicializar el bloque Modbus con
Init = TRUE. Compruebe si se ha produ‐
cido un error durante la inicialización.

Compruebe los datos del interlocutor
con ayuda de un registro de telegramas.

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Status (Hex) Texto del evento
A083

Solución

S7 es cliente: se ha lanzado una petición mientras la petición ante‐ No lance una nueva petición hasta que
rior aún estaba en curso. No se ejecuta la petición. Es una informa‐ la petición anterior haya finalizado con
ción de estado. El bit ERROR no está activado.
DONE_ NDR = TRUE o ERROR =
Se ha intentado inicializar el bloque durante una petición en curso o TRUE.
mientras ENQ_ENR estaba activa.

Espere a que finalicen todas las peticio‐
nes en curso antes de inicializar. Ajuste
ENQ_ENR = FALSE.

A085

Debido a un acceso de escritura no permitido ha aparecido un error
interno durante la comprobación de la licencia.

Compruebe si en el programa S7 hay
algún acceso de escritura no permitido
al DB de licencia. No está permitido mo‐
dificar la estructura de REG_KEY. Dirí‐
jase al Product Support si es necesario.

A086

Se ha intentado escribir en un bloque de datos protegido contra
escritura.

Quite la protección contra escritura o
utilice otro DB.

A090

La instrucción MODBUSCP aún no tiene licencia para esta CPU.
Esta es una información de estado. El bit ERROR no está activado.
La comunicación MODBUS también funciona sin licencia.

Consulte el código de identificación pa‐
ra esta CPU en la salida IDENT_CODE
y solicite con él el código de validación.
Consulte el capítulo "Concesión de li‐
cencia (Página 7263)".

A091

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‐ El interlocutor no soporta la función so‐
ma de excepción con código de excepción 1.
licitada.

A092

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‐ Corrija LENGTH o START_ADDRESS
en la llamada de FB.
ma de excepción con código de excepción 2.
Se ha producido un acceso a una dirección inexistente/no admitida
en el interlocutor.

A093

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‐ El interlocutor no puede procesar el te‐
ma de excepción con código de excepción 3.
legrama recibido (p. ej., no soporta la
longitud solicitada).

A094

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‐ El interlocutor se encuentra en un esta‐
ma de excepción con código de excepción 4.
do en que no es capaz de procesar el
telegrama recibido.

A095

Solo con S7 es cliente: Como respuesta se ha recibido un telegra‐ Compruebe los mensajes de error del
ma de excepción con código de excepción desconocido.
interlocutor y, dado el caso, verifique los
datos con un registro de telegramas.

Consulte también
Descripción MODBUSCP (Página 7258)

Parámetros DONE_NDR, DATA_TYPE, START_ADDRESS, LENGTH, WRITE_READ y UNIT
Descripción
En el modo de operación "S7 es cliente" se trata de parámetros de entrada, mientras que en
el modo de operación "S7 es servidor" son parámetros de salida.
DATA_TYPE

Programación del PLC
Manual de programación y manejo, 11/2019

7275

Instrucciones
4.2 Instrucciones
El parámetro DATA_TYPE indica qué tipo de datos Modbus/TCP se procesa con el telegrama
actual. Se admiten los valores siguientes:
Coils
Inputs
Holding Register
Input Register

B#16#1
B#16#2
B#16#3
B#16#4

Los distintos tipos de datos mantienen una relación directa con los códigos de función
utilizados.
Tipo de datos

DATA_TYPE

Función

Longitud

single_write

Código de fun‐
ción

Coils

1

leer

cualquiera

irrelevante

1

Coils

1

escribir

1

TRUE

5

Coils

1

escribir

1

FALSE

15

Coils

1

escribir

>1

irrelevante

15

Inputs

2

leer

cualquiera

irrelevante

2

Holding Register

3

leer

cualquiera

irrelevante

3

Holding Register

3

escribir

1

TRUE

6

Holding Register

3

escribir

1

FALSE

16

Holding Register

3

escribir

>1

irrelevante

16

Input Register

4

leer

cualquiera

irrelevante

4

START_ADDRESS
El parámetro START_ADDRESS determina la primera dirección Modbus/TCP que se lee o se
escribe.
LENGTH
El parámetro LENGTH determina el número de valores Modbus/TCP que se leen o se escriben.
En las funciones de lectura, para Holding e Input Register es posible un máximo de 125
registros por telegrama. Para Coils e Inputs es posible un máximo de 2000 bits. En las
funciones de escritura, para Holding Register el número máximo es de 123 registros y para
Coils, de 1968 bits. Los registros o valores de bit procesados con un telegrama de solicitud
deben encontrarse dentro de un DB.
WRITE_READ
Este parámetro define si se debe ejecutar una función de lectura o escritura. Si la entrada/
salida tiene el valor FALSE, se trata de una función de lectura. El valor TRUE define una
función de escritura.
Solo se pueden escribir Holding Register y Coils. Input Register e Inputs únicamente se
pueden leer.
UNIT
En la función "S7 es cliente" el parámetro UNIT es un parámetro de entrada. Esta entrada se
debe ajustar de acuerdo con los requisitos. La instrucción aplica este valor al telegrama de
solicitud y lo verifica al recibir la respuesta.

7276

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El parámetro UNIT se utiliza típicamente en convertidores de protocolo para direccionar
esclavos serie que se esconden detrás de una dirección IP común.
La mayoría de dispositivos pueden responder a UNIT = 1.
En la función "S7 es servidor" el parámetro UNIT es un parámetro de salida. La instrucción
aplica este valor del telegrama de solicitud a la respuesta. La salida se activa cuando la
petición finaliza con un valor recibido.
DONE_NDR
En el modo de operación "S7 es cliente" la petición activada ha terminado sin errores. En una
función de lectura, los datos de respuesta del servidor ya se han introducido en el bloque de
datos; en una función de escritura, el servidor ha recibido la respuesta al telegrama de
solicitud.
En el modo de operación "S7 es servidor" la salida muestra que el intercambio de telegramas
con el cliente ha finalizado sin errores. En los parámetros DATA_TYPE, START_ADDRESS,
LENGTH, WRITE_READ y UNIT se muestran los parámetros de petición del cliente. Estas
salidas solo son válidas mientras DONE_NDR esté activado.

Consulte también
Descripción MODBUSCP (Página 7258)

Parámetros ENQ_ENR y MONITOR
Descripción
ENQ_ENR
Modo de operación "S7 es cliente":
Con un flanco ascendente en ENQ_ENR se inicia la transferencia de datos. Con los valores de
los parámetros de entrada DATA_TYPE,START_ADDRESS, LENGTH, WRITE_READ y UNIT
se genera el telegrama de solicitud. Solo se puede enviar un telegrama nuevo si el telegrama
anterior ha finalizado con DONE_NDR o ERROR.
Modo de operación "S7 es servidor":
La instrucción se activa con un nivel positivo en la entrada ENQ_ENR. Pueden recibirse
telegramas del cliente.
En caso de una entrada ENQ_ENR no activada y una conexión establecida, se rechazarán los
datos recibidos.
MONITOR
El tiempo de vigilancia MONITOR vigila la entrada de datos del interlocutor. El tiempo de
vigilancia se indica en el formato de hora T#... Se recomienda un tiempo de vigilancia de aprox.
1,5 s.
En el modo de operación "S7 es cliente", con el tiempo MONITOR el servidor vigila la entrada
de la totalidad del telegrama de respuesta. En caso de sobrepasar el tiempo de vigilancia, la
petición activada finalizará con error. El tiempo comienza después de finalizar la transmisión
del telegrama de solicitud y termina después de recibir los datos completamente.
En el modo de operación "S7 es servidor", con el tiempo MONITOR se vigila la entrada de la
segunda parte del telegrama. Si se rebasa el tiempo de vigilancia, se notifica un error. El tiempo

Programación del PLC
Manual de programación y manejo, 11/2019

7277

Instrucciones
4.2 Instrucciones
comienza después de recibir el encabezado del telegrama Modbus/TCP específico y termina
después de finalizar la recepción del telegrama de solicitud.

Consulte también
Descripción MODBUSCP (Página 7258)

MODBUSCP V1
Información general
Generalidades
La instrucción MODBUSCP es un producto de software para los procesadores de
comunicaciones CP 343-1 y CP 443-1.
Con la instrucción se establece una comunicación entre un CP 443-1 o CP 343-1 y un
interlocutor que soporta el protocolo Modbus/TCP.
Las conexiones TCP/IP vía CP son conexiones estáticas que no se desconectan durante el
funcionamiento correcto.
La configuración de conexiones de STEP 7 solo permite utilizar, con la pila de TCP del CP, un
número de puerto determinado una única vez. Determinados tipos de CP pueden mantener y
manejar paralelamente conexiones a varios clientes a través del puerto 502 local.
En el capítulo "Uso de conexiones en el puerto 502 (Página 7286) " se explican los detalles
técnicos al respecto.
La transferencia de datos se gestiona según elprincipio de cliente-servidor.
SIMATIC S7 puede operar como cliente o como servidor durante la transferencia.

Instrucciones paso a paso
1. Configuración del CP como servidor (Página 7282) o cliente (Página 7279).
2. Llamada de la instrucción MODBUSCP en los OB necesarios.
– Consulte Puesta en marcha (Página 7284)
3. Parametrización del DB de parámetros de acuerdo con los requisitos (ID, cliente/servidor,
registro Modbus, áreas de DB, etc.).
– Consulte Bloque de datos de parámetros (Página 7287)
4. Parametrización del bloque Modbus para la inicialización y el tiempo de ejecución.
– Consulte Funcionamiento de la instrucción (Página 7292)
5. Carga del programa de usuario en la CPU y concesión de licencia del bloque Modbus para
esta CPU.
– Consulte Concesión de licencia (Página 7297).

7278

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Puesta en marcha
Configuración del CP como cliente Modbus/TCP
Requisitos
● El editor "Dispositivos y redes" está abierto.
● El hardware siguiente está presente en la "Vista de dispositivos":
– S7 300/400, por ejemplo, 315-2 DP o 414-2 DP
– Procesador de comunicaciones CP 343-1/443-1

Parametrización del CP
1. Seleccione el CP.
2. Añada una subred en la ventana de inspección, bajo "Propiedades > General > Direcciones
Ethernet" de la interfaz PROFINET del CP.
3. Introduzca la dirección IP y la máscara de subred.

Agregar conexión TCP
1. En la vista de redes, haga clic en "Conexiones".
2. Seleccione el tipo de conexión "Conexión TCP".
3. En el menú contextual de la CPU, elija el comando "Agregar nueva conexión".
4. Seleccione el interlocutor de conexión "Sin especificar".

Programación del PLC
Manual de programación y manejo, 11/2019

7279

Instrucciones
4.2 Instrucciones
5. Seleccione el módulo de comunicación como interfaz local.
6. Active la función "Establecer conexión activa".
7. Haga clic en "Agregar" y cierre el cuadro de diálogo.

7280

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parametrización de la conexión TCP
1. En la ventana de inspección, bajo "Propiedades > General > General", introduzca la
dirección IP del interlocutor.

2. En "Propiedades > General > ID local", introduzca la ID local que parametriza para la
conexión Modbus/TCP en el bloque "MODBUSCP".
También necesita el valor del parámetro "LADDR" para la parametrización del bloque
"MODBUSCP", consulte Bloque de datos de parámetros (Página 7287).

3. En "Propiedades > General > Detalles de dirección", indique como puerto interlocutor
"502".
Acepte el valor predeterminado para el puerto local del CP, por ejemplo, 2000.

Programación del PLC
Manual de programación y manejo, 11/2019

7281

Instrucciones
4.2 Instrucciones

Configurar el CP como servidor Modbus/TCP
Requisitos
● El editor "Dispositivos y redes" está abierto.
● El hardware siguiente está presente en la "Vista de dispositivos":
– S7 300/400, por ejemplo, 315-2 DP o 414-2 DP
– Procesador de comunicaciones CP 343-1/443-1

Parametrización del CP
1. Seleccione el CP.
2. Añada una subred en la ventana de inspección, bajo "Propiedades > General > Direcciones
Ethernet" de la interfaz PROFINET del CP.
3. Introduzca la dirección IP y la máscara de subred.

7282

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Agregar conexión TCP
1. En la vista de redes, haga clic en "Conexiones".
2. Seleccione el tipo de conexión "Conexión TCP".
3. En el menú contextual de la CPU, elija el comando "Agregar nueva conexión".
4. Seleccione el interlocutor de conexión "Sin especificar".
5. Seleccione el módulo de comunicación como interfaz local.
6. Desactive la función "Establecer una conexión activa".
7. Haga clic en "Agregar" y cierre el cuadro de diálogo.

Programación del PLC
Manual de programación y manejo, 11/2019

7283

Instrucciones
4.2 Instrucciones

Parametrización de la conexión TCP
1. En la ventana de inspección, bajo "Propiedades > General > ID local", introduzca la ID local
que parametrice para la conexión Modbus/TCP en el bloque "MODBUSCP".
También necesita el valor del parámetro "LADDR" para la parametrización del bloque
"MODBUSCP", consulte Bloque de datos de parámetros (Página 7287).

2. En "Propiedades > General > Detalles de dirección", indique como puerto local "502".

Consulte también
Uso de conexiones en el puerto 502 (Página 7286)
Bloques add-on para la comunicación Modbus/TCP (http://
support.automation.siemens.com/WW/view/es/62830463)

Llamada de la instrucción MODBUSCP
Requisitos y principios básicos
La instrucción MODBUSCP se puede utilizar a partir de STEP7 V14 (TIA Portal).
La instrucción MODBUSCP se ha creado tomando como base la Modbus Application Protocol
Specification V1.1b3, April 26, 2012 ; , consulte Página de inicio de Modbus (http://
www.modbus.org).

7284

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Llamada de la instrucción
La instrucción MODBUSCP se debe incorporar a 2 OBs para que el programa se ejecute
correctamente:
● al OB100 de arranque y
● a un OB cíclico (OB1 o a un OB controlado por tiempo, p. ej. OB35)
Al hacerlo, debe utilizarse el mismo bloque de datos de instancia. No se permite la llamada
simultánea de la instrucción MODBUSCP en el OB1 y en un OB controlado por tiempo (p. ej.,
OB35). El OB121 debe estar presente en la CPU. Para más información al respecto, consulte
Concesión de licencia (Página 7297).

Inserción del bloque Modbus
Abra el bloque "COMPLETE RESTART [OB100]". En caso de que no se encuentre entre los
bloques de programa, insértelo con "Agregar nuevo bloque > Bloque de organización > Startup
> COMPLETE RESTART [OB 100]".
La instrucción MODBUSCP está ubicada en la Task Card, paleta y carpeta "Instrucciones>
Comunicación > Otros". Abra allí la carpeta "MODBUS TCP" y arrastre la instrucción
MODBUSCP al bloque OB100.
En "Bloques de sistema > Recursos de programa", junto a MODBUSCP (FB75), se visualizan
ahora las instrucciones subordinadas MB_CPCLI (FB76) y MB_CPSRV (FB77). Estas
instrucciones subordinadas no se pueden llamar adicionalmente en un OB. Se siguen
visualizando las instrucciones de comunicación AG_(L)SEND (FC5/FC50), AG_(L)RECV
(FC6/FC60) y AG_CNTRL (FC10) llamadas internamente.
Abra el bloque "Main [OB1]" o un bloque cíclico y arrastre la instrucción MODBUSCP [FB75]
al OB. Como bloque de datos de instancia seleccione el bloque de datos MODBUSCP_DB de
la llamada del OB100. No se debe crear ningún nuevo bloque de datos de instancia.

Versiones de los bloques AG
Si en V14 utiliza los bloques migrados, se utilizarán las siguientes versiones:
● Uso de un S7-300:
– AG_SEND

V4.2

– AG_RECV

V4.7

– AG_CNTRL

V1.4

● Uso de un S7-400:
– AG_LSEND

V3.1

– AG_LRECV

V3.1

– AG_CNTRL

V1.0

Programación del PLC
Manual de programación y manejo, 11/2019

7285

Instrucciones
4.2 Instrucciones
Si en V14 utiliza los bloques integrados, necesitará las siguientes versiones en la librería
"Simatic NET CP":
● Uso de un S7-300:
– AG_SEND

V1.2

– AG_RECV

V1.2

– AG_CNTRL

V1.1

● Uso de un S7-400:
– AG_LSEND

V1.1

– AG_LRECV

V1.1

– AG_CNTRL

V1.1

Uso de conexiones en el puerto 502
Algunos procesadores de comunicaciones pueden multiplexar las conexiones TCP. Al
hacerlo, pueden conectarse varios clientes Modbus/TCP en el puerto 502 del CP. El CP opera
como servidor Modbus/TCP.
Nota
En caso de usar versiones anteriores del firmware, tenga en cuenta que solo se configura una
conexión, independientemente de cuántos clientes tengan acceso al CP como servidor.
Con los nuevos CP o las nuevas versiones de software pueden configurarse varias conexiones
para el puerto 502.
Encontrará información al respecto en los datos del CP y del firmware o siguiendo el enlace:
SIMATIC Modbus/TCP (https://support.industry.siemens.com/cs/de/en/view/104946406)

Requisitos
Para poder utilizar esta función, en la parametrización de la conexión deben efectuarse los
siguientes ajustes:
● CP es servidor
● Puerto 502 como puerto local
● Conexión TCP sin especificar en "Dispositivos y redes"
● Establecimiento de conexión pasivo

Número de conexiones
El CP puede comunicarse mediante el puerto 502 con un máximo de 4 clientes a la vez.

7286

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Visualización del estado de la conexión
El estado de la conexión puede visualizarse tanto en el editor "Dispositivos y redes" de la
ventana de inspección, bajo "Diagnóstico > Información del dispositivo", como en el
diagnóstico especial del CP.
Puesto que en el editor "Dispositivos y redes" solo hay configurada una conexión, la indicación
muestra el estado de todas las conexiones TCP de los distintos clientes.
Si no hay ningún cliente que haya establecido una conexión, aparece la indicapassción
"Establecimiento de conexión pasiva". En cuanto un cliente haya establecido una conexión, se
mostrará "Conexión establecida". No puede determinarse cuántos clientes están conectados
actualmente con el CP.

Comportamiento en caso de fallo
En determinados casos de fallo, el CP tiene que interrumpir y establecer de nuevo la conexión
para volver al estado básico. De esta acción se encarga la instrucción MODBUSCP. Al hacerlo
se deshacen todas las conexiones existentes a través el puerto 502.

Sugerencias para el programa de usuario
Si hay varias conexiones a través del puerto 502, en el programa de usuario no es evidente qué
cliente ha enviado la petición de Modbus/TCP actual. Si los clientes utilizan distintos números
UNIT, puede hacerse distinción con los medios propios del programa.

Consulte también
Configurar el CP como servidor Modbus/TCP (Página 7282)

Comportamiento en arranque del CP 343-1 y el CP 443-1
El arranque del CP se divide en las siguientes fases:
● Inicialización (conexión del CP)
En cuanto hay tensión en el CP, se prepara el firmware del CP para el funcionamiento
después de ejecutar un programa de test del hardware.
● Parametrización
Durante la parametrización el CP recibe los parámetros de módulo asignados al slot actual.
El procesador de comunicaciones ahora está operativo.

Bloque de datos de parámetros
Parametrización de la comunicación Modbus
Para la comunicación a través de un CP 343 y un CP 443 es necesario configurar las
conexiones en el editor "Dispositivos y redes".
Pueden configurarse y establecerse simultáneamente varias conexiones con diferentes
interlocutores de comunicación. El número de conexiones que pueden establecerse
simultáneamente varía en función de la CPU utilizada y del CP empleado.

Programación del PLC
Manual de programación y manejo, 11/2019

7287

Instrucciones
4.2 Instrucciones
Bloque de datos de parámetros
Los datos necesarios para la asignación de las conexiones y el procesamiento de los
telegramas Modbus/TCP se definen en el tipo de datos PLC MB_CP_PARAM. Este tipo de
datos PLC contiene una estructura para los datos específicos de las conexiones y los
parámetros Modbus. Cada instancia de la instrucción "MODBUSCP" necesita una conexión
unívoca. Por tanto, establezca una conexión propia con cada interlocutor de comunicación en
el editor "Dispositivos y redes" para cada instancia de la instrucción.
Para cada una de estas conexiones se necesita una instancia del tipo de datos PLC en un
bloque de datos, en la que se definen los datos de conexión y los parámetros Modbus. Para
cada conexión adicional, el bloque de datos se puede ampliar o se puede crear un bloque de
datos nuevo.
En el bloque de datos de parámetros pueden encontrarse los datos de configuración de todas
las conexiones. También es posible crear un bloque de datos de parámetros aparte para cada
conexión. Este o estos bloques de datos solo están previstos para los parámetros de conexión
y Modbus, por lo que en ellos no se pueden guardar otros parámetros.
Nota
Si en una estación hay varios CP y a través de ellos se configuran conexiones Modbus/TPC,
respectivamente, no pueden guardarse conexiones con la misma ID en el mismo bloque de
datos de parámetros. En este caso, debe crearse un bloque de datos de parámetros por cada
CP.
Cada parámetro empieza con el prefijo "ID_x_", donde x es el número de la ID de conexión. En
esta ayuda en pantalla se omite este prefijo para una mayor claridad.

7288

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Figura 4-67

MODBUS_PARAM_CP

Programación del PLC
Manual de programación y manejo, 11/2019

7289

Instrucciones
4.2 Instrucciones
Estructura
'LUHFFLµQ

1RPEUH



&RQH[LµQ3DU£PHWURVGHFRQH[LµQ



&RQH[LµQ3DU£PHWURV0RGEXV



&RQH[LµQ3DU£PHWURVGHFRQH[LµQ



&RQH[LµQ3DU£PHWURV0RGEXV


 L
 L


&RQH[LµQL3DU£PHWURVGHFRQH[LµQ
&RQH[LµQL3DU£PHWURV0RGEXV

● Parámetros de conexión
En el primer bloque se definen los parámetros específicos de la conexión "id" y "laddr". Con
estos parámetros puede asignarse la conexión configurada en el editor "Dispositivos y
redes".
● Parámetros Modbus/TCP
En los parámetros Modbus/TCP se guardan los datos necesarios para el modo de
operación y la referencia de direcciones, por ejemplo, el modo de operación del S7 como
servidor Modbus/TCP o como cliente Modbus/TCP, las direcciones del registro Modbus/
TCP y los números de DB en los que se mapean los datos. La estructura de datos de los
parámetros Modbus/TCP se debe respetar obligatoriamente para que sea posible el
procesamiento sin errores.
Posibilidades de configuración
Existen dos opciones para llevar a cabo la configuración de los parámetros Modbus/TCP y de
conexión.
1. Opción:
Cree un bloque de datos global nuevo y ábralo. Agregue un parámetro y seleccione el tipo
de datos MB_CP_PARAM para dicho parámetro. En caso de que este tipo de datos no se
muestre en la lista desplegable, introdúzcalo manualmente.
Esta opción permite insertar varias instancias en un bloque de datos.
2. Opción:
Cree un bloque de datos nuevo mediante "Agregar nuevo bloque" y
seleccione MB_CP_PARAM como "Tipo". El bloque de datos nuevo se abre con la
estructura Modbus y de conexión insertada.
Este bloque de datos está protegido contra escritura. No se pueden agregar más
parámetros. Es posible editar los parámetros existentes.
Modificación de los valores
Los valores del bloque de datos de parámetros no se pueden modificar durante el tiempo de
ejecución. Tras modificar los parámetros, se debe rearrancar la CPU con STOP -> RUN.

7290

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Parámetros de conexión
Los dos primeros parámetros del bloque son parámetros de conexión que se emplean
internamente en la instrucción MODBUSCP en las llamadas de AG_SEND/AG_RECV o
AG_LSEND/AG_LRECV.
Parámetros

Descripción

id

Para cada conexión configurada en el TIA Portal (editor "Dispositivos y redes"), se asigna una ID de cone‐
xión. La ID de conexión describe de forma unívoca la conexión entre la CPU y el interlocutor a través del CP.
Aquí debe introducirse el número de la configuración de la conexión. El rango de valores de este parámetro
es de 1 a 64.

laddr

El parámetro "laddr" es la dirección inicial del CP procedente de la "Vista de dispositivos" (dirección E). Aquí
debe introducirse el valor configurado. El rango de valores de este parámetro depende de la CPU. Los
parámetros "id" y "laddr" pueden consultarse en la máscara "Propiedades > General > ID local" de la
conexión TCP.

Parámetros Modbus/TCP
Con el resto de parámetros se determinan el modo de operación de la comunicación Modbus/
TCP y el mapeo de las direcciones Modbus/TCP en las direcciones SIMATIC. Pueden
parametrizarse hasta 8 áreas de datos. Para ello, se debe definir, al menos, la primera de estas
áreas de datos; las 7 restantes son opcionales.
Parámetros

Descripción

server_client

Este parámetro distingue entre modo de cliente y modo de servidor. Si la entrada es TRUE, se trabaja en el
modo de operación "S7 es servidor". El ajuste FALSE selecciona el modo de operación "S7 es cliente".

single_write

En el modo de operación "S7 es cliente", con el parámetro "single_write" = TRUE en las peticiones de
escritura de longitud 1, se utilizan los códigos de función 5 y 6. Si "single_write" = FALSE, en todas las
peticiones de escritura se utilizan los códigos de función 15 y 16.

data_type_x

Con el parámetro "data_type_x" se indica qué tipos de datos Modbus/TCP se mapean en este DB. Si se
introduce el valor 0 en "data_type_x", no se utilizará el área de datos correspondiente.
Código

Tipo de datos

Ancho de datos

0

Área no utilizada

–

1

Coils

Bit

2

Inputs

Bit

3

Holding Register

Word

4

Input Register

Word

Programación del PLC
Manual de programación y manejo, 11/2019

7291

Instrucciones
4.2 Instrucciones
Parámetros

Descripción

db_x

El parámetro "db_x" especifica el bloque de datos en que se mapean los registros Modbus/TCP o valores
de bit definidos seguidamente. Si se utiliza un bloque de datos global, el número de DB 0 no está permitido,
ya que se reserva para el sistema. Si se utiliza un bloque DataCollector en CFC, debe introducirse el número
DB 0.
Número DB de 1 a 65535 (de W#16#0001 a W#16#FFFF)

start_x, end_x

Con "start_x" se indica la primera dirección Modbus/TPC que se mapea en la palabra de datos 0 del DB. El
parámetro "start_x" define la dirección de la última dirección Modbus/TCP.
● Al acceder a registros, el número de la palabra de datos del DB S7 en que se introduce la última dirección
Modbus/TCP se calcula según la fórmula siguiente:
Número DBW = (end_x – start_x) ∗ 2
● En accesos de bits, el número del byte de datos del DB S7 en que se introduce la última dirección
Modbus/TCP se calcula según la fórmula siguiente:
Número DBB = (end_x – start_x) / 8
Las áreas de datos definidas no deben solaparse. El parámetro "end_x" no puede ser menor que "start_x".
En caso de fallo, el arranque del FB termina con error. Si ambos valores coinciden, se asigna 1 dirección
Modbus/TCP (1 registro o 1 valor de bit).
En "Mapeo de direcciones (Página 7300)" hay un ejemplo del mapeo de las direcciones Modbus/TCP en las
áreas de memoria de S7.

Descripción MODBUSCP
Descripción
La instrucción MODBUSCP permite establecer una comunicación entre un CP 443-1 o CP
343-1 y un interlocutor que soporte el protocolo Modbus/TCP. Se soportan los códigos de
función 1, 2, 3, 4, 5, 6, 15 y 16.
Según la parametrización, la instrucción puede operar como cliente o como servidor. También
es posible operar simultáneamente un CP como cliente y como servidor. Para ello son
necesarias dos conexiones configuradas en el editor "Dispositivos y redes" y dos llamadas de
la instrucción.
Por parte de la librería no hay ningún límite para el número máximo de bloques Modbus/TCP
funcionando paralelamente. Sin embargo, sí hay un número máximo posible de llamadas de
función de PLC operando simultáneamente, que depende de la CPU y del CP. En el manual
de la CPU, en "Datos técnicos > Comunicación" figura el número máximo de llamadas de PLC.
En el manual del CP se indica cuántos AG_SEND/AG_RECV o AG_LSEND/AG_LRECV
puede procesar paralelamente este CP.
Tareas de los bloques
● Llamada de las funciones estándar para la transmisión de datos entre CPU y CP
● Generación del encabezado del telegrama específico de Modbus/TCP durante la
transmisión
● Comprobación del encabezado del telegrama específico de Modbus/TCP durante la
recepción
● Comprobación de la existencia de las áreas de datos a las que accede el cliente

7292

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
● Generación de telegramas de excepción cuando aparece un error (solo cuando S7 es
servidor)
Exception Code Significado
1

No se soporta el código de función enviado.

2

Se ha producido un acceso a una dirección inexistente o no admitida.

3

Se ha introducido una longitud no válida para este código de función.

● Transferencia de datos desde el DB parametrizado o hacia él
● Vigilancia del tiempo de recepción de datos
● Comprobación de licencia
La instrucción MODBUSCP puede emplearse tanto para S7-300 como para S7-400.

Funcionamiento de la instrucción
Comportamiento en arranque de la instrucción
La instrucción MODBUSCP debe llamarse una vez en OB100 obligatoriamente.
● Los parámetros de inicialización deben estar asignados de acuerdo con la configuración de
la instalación.
● Se comprueba la coherencia de los parámetros de inicialización, que luego se aplican en
el DB de instancia.
● Los parámetros del tiempo de ejecución no se evalúan en el arranque.
Funcionamiento cíclico de la instrucción
En modo cíclico, la instrucción MODBUSCP se llama en el OB1 o en un OB de alarma cíclica.
● Las funciones del bloque se activan mediante los parámetros del tiempo de ejecución.
● Mientras haya una petición en curso no se evalúan las modificaciones de los parámetros
del tiempo de ejecución.
● Los parámetros de inicialización no se evalúan.
Rearranque durante la puesta en marcha
Durante la puesta en marcha, puede resultar muy difícil rearrancar repetidamente la CPU tras
modificar los parámetros de inicialización. Mediante el ajuste manual del parámetro "Init_Start"
existente en la sección estática, se puede ejecutar la sección del programa para rearranque del
bloque Modbus. Durante la inicialización manual no puede haber ninguna petición en curso.
Para la inicialización correcta, todos los parámetros de inicialización se deben parametrizar en
el OB cíclico.

Programación del PLC
Manual de programación y manejo, 11/2019

7293

Instrucciones
4.2 Instrucciones
Comportamiento en caso de error de programación OB121
Si la instrucción Modbus/TCP para esta CPU aún no tiene licencia, se llama OB121.
ADVERTENCIA
STOP de la CPU si falta OB121
En caso de que falte OB121, la CPU pasa al estado operativo STOP y pueden aparecer
estados imprevistos de la instalación.
Antes de poner en funcionamiento la instalación, debe asegurarse de que OB121 esté
presente.
Desconexión de la comunicación por parte del interlocutor de comunicación
Si el interlocutor de la comunicación desconecta la conexión TCP, por motivos de las
propiedades del sistema en el modo de operación "S7 es servidor", la siguiente recepción no
será posible hasta al cabo de 1 segundo.
En el modo de operación "S7 es cliente" no se podrán enviar datos hasta al cabo de 150 ms.
Este tiempo de retardo se implementa mediante la instrucción.

Lanzamiento de petición con "S7 es cliente" o activación de la instrucción con "S7 es servidor"
Los parámetros de salida son indicadores dinámicos y, por tanto, solo están disponibles
durante 1 ciclo de la CPU. Para poderlos procesar posteriormente o visualizarlos en la tabla de
observación, se deben copiar en otras áreas de memoria.
S7 es cliente: lanzamiento de la petición
Mediante un cambio de flanco positivo en la entrada de disparo ENQ_ENR se inicia una
petición. En función de los parámetros de entrada UNIT, DATA_TYPE, START_ADDRESS,
LENGTH y WRITE_READ, se genera un telegrama de petición Modbus/TCP y se envía a la
estación interlocutora a través de la conexión TCP/IP. El cliente espera a una respuesta del
servidor durante el tiempo parametrizado MONITOR.
Si se rebasa el tiempo (no hay respuesta del servidor) la petición activada termina con error.
Se puede iniciar una nueva petición.
Tras recibirse el telegrama de respuesta se realiza una comprobación de coherencia. Si el
resultado de dicha comprobación es positivo, se llevan a cabo las acciones necesarias y la
petición termina sin error; se activa la salida DONE_NDR. Si se detectan errores durante la
verificación, la petición termina con error, se activa el bit ERROR y se indica un número de error
en STATUS.
S7 es servidor: Activación de la instrucción
Mediante un nivel positivo en la entrada de disparo ENQ_ENR, la instrucción está lista para
recibir un telegrama de petición del cliente. El servidor se comporta pasivamente y espera a un
telegrama del cliente.
Si el servidor recibe un telegrama de petición, este comprueba el telegrama recibido. Una vez
superada la comprobación, el servidor envía un telegrama de respuesta. El servidor señala el
final del intercambio de telegramas mediante el bit DONE_NDR = TRUE. En ese momento, se
visualiza la función ejecutada en las salidas UNIT, DATA_TYPE, START_ADDRESS,
LENGTH y WRITE_READ.

7294

Programación del PLC
Manual de programación y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Un telegrama de petición erróneo da lugar a un mensaje de error. Se activa el bit ERROR, se
indica el número de error en STATUS y no se responde a la petición del cliente.
Transferencia de datos CPU – CP
La transmisión de datos entre CP y CPU se efectúa con los bloques estándar AG_SEND y
AG_RECV o bien AG_LSEND y AG_LRECV.
Si el usuario activa una petición (S7 es servidor) o recibe un telegrama del cliente (S7 es
servidor), el FB llama el bloque estándar para el CP en la secuencia y cantidad necesarias.
Si el CP recibe un telegrama, primero se hace una lectura de 6 bytes con un AG_(L)RECV.
Estos 6 bytes contienen la longi