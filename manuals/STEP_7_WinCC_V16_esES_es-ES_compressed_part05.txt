arga en ACU 1

RET_VAL:= #Error

//Guardar el valor de retorno en #Error

L

#Error

L

0

==I

964

//Llamada de la instrucci√≥n "REPL_VAL"

//Valor de retorno de la instrucci√≥n "REPL_VAL"
//Si es igual que 0 (no se ha producido ning√∫n error),

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
AWL

Descripci√≥n

BEB

//entonces finaliza el bloque

STOP:
CALL

"STP"

//Llamada de la instrucci√≥n "STP": La CPU pasa al estado operativo STOP.

Eventos
Eventos e ID del evento
Evento
Dentro de SIMATIC S7, todos los eventos est√°n numerados. Esto permite asignar a un evento
un texto de aviso.

ID de evento
Cada evento tiene asignada una ID de evento. La ID de evento tiene la siguiente estructura:
Bit:

     

&ODVHGHHYHQWR

Figura 1-30









,GHQWLILFDGRUHV













1¬ºPHURGHHYHQWR

Estructura de la ID de evento

Clase de evento
Las clases de evento se clasifican como sigue:
N√∫mero

Clase de evento

1

Eventos de OB est√°ndar

2

Eventos de errores s√≠ncronos

3

Eventos de errores as√≠ncronos

4

Transiciones de estado operativo

5

Evento de procesamiento de estado operativo

6

Eventos de comunicaci√≥n

7

Eventos para sistemas de seguridad y de alta disponibilidad

8

Datos de diagn√≥stico normalizados en m√≥dulos

9

Eventos de usuario predefinidos

A, B

Eventos de libre definici√≥n

C, D, E

Reservado

F

Eventos para m√≥dulos no centrales (p. ej. CP, FM)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

965

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Identificador
El identificador permite distinguir los eventos en funci√≥n del tipo al que pertenecen. Significado
de los cuatro bits de identificaci√≥n:
N√∫mero de bit en la ID de evento Significado
8

= 0: Evento saliente
= 1: Evento entrante

9

= 1: Entrada en el b√∫fer de diagn√≥stico

10

= 1: Error interno

11

= 1: Error externo

Clase de evento 1 - Eventos de OB est√°ndar
Descripci√≥n de las IDs de evento
ID de evento

Evento

W#16#1381

Solicitud de rearranque completo (en caliente) manual

W#16#1382

Solicitud de rearranque completo (en caliente) autom√°tica

W#16#1383

Solicitud de rearranque manual

W#16#1384

Solicitud de rearranque autom√°tica

W#16#1385

Solicitud de arranque en fr√≠o manual

W#16#1386

Solicitud de arranque en fr√≠o autom√°tica

W#16#1387

CPU maestra: Solicitud de arranque en fr√≠o manual

W#16#1388

CPU maestra: Solicitud de arranque en fr√≠o autom√°tica

W#16#138A

CPU maestra: Solicitud de rearranque completo (en caliente) manual

W#16#138B

CPU maestra: Solicitud de rearranque completo (en caliente) autom√°tica

W#16#138C

CPU de reserva: Solicitud de arranque manual

W#16#138D

CPU de reserva: Solicitud de arranque autom√°tica

Clase de evento 2 - Eventos de error s√≠ncronos
Descripci√≥n de las IDs de evento

966

ID de evento

Evento

OB

W#16#2521

BCD - Error de conversi√≥n

OB 121

W#16#2522

Error de longitud de √°rea durante lectura

OB 121

W#16#2523

Error de longitud de √°rea durante escritura

OB 121

W#16#2524

Error de √°rea durante lectura

OB 121

W#16#2525

Error de √°rea durante escritura

OB 121

W#16#2526

Error de n√∫mero de temporizador

OB 121

W#16#2527

Error de n√∫mero de contador

OB 121

W#16#2528

Error de alineaci√≥n durante lectura

OB 121

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

OB

W#16#2529

Error de alineaci√≥n durante escritura

OB 121

W#16#2530

Error de escritura al acceder al DB

OB 121

W#16#2531

Error de escritura al acceder al DI

OB 121

W#16#2532

Error de n√∫mero de bloque al abrir un DB

OB 121

W#16#2533

Error de n√∫mero de bloque al abrir un DI

OB 121

W#16#2534

Error de n√∫mero de bloque al llamar la FC

OB 121

W#16#2535

Error de n√∫mero de bloque al llamar el FB

OB 121

W#16#253A

DB no cargado

OB 121

W#16#253C

FC no cargada

OB 121

W#16#253D

SFC no cargada

OB 121

W#16#253E

FB no cargado

OB 121

W#16#253F

SFB no cargado

OB 121

W#16#2942

Error de acceso a periferia en lectura

OB 122

W#16#2943

Error de acceso a periferia en escritura

OB 122

Clase de evento 3 - Eventos de error as√≠ncronos
Descripci√≥n de las ID de evento
ID de evento

Evento

OB

W#16#3501

Rebase por exceso del tiempo de ciclo

OB 80

W#16#3502

Error de solicitud en interfaz de usuario (OB o FRB)

OB 80

W#16#3505

Alarma(s) horaria(s) expiradas debido a salto de hora

OB 80

W#16#3506

Alarma(s) horaria(s) expiradas al reanudar con RUN
despu√©s de PARADA

OB 80

W#16#3507

Un error m√∫ltiple de solicitud de OB ha causado un des‚Äê OB 80
bordamiento interno del b√∫fer

W#16#3508

Error de tiempo en alarma de sincronismo

OB 80

W#16#3509

P√©rdida de alarmas por sobrecarga de alarmas

OB 80

W#16#350A

Reanudaci√≥n en RUN despu√©s de CiR

OB 80

W#16#350B

Error de tiempo en alarma de sincronismo tecnol√≥gica

OB 80

W#16#3921/3821

BATTF: Fallo de al menos una bater√≠a de respaldo en el
aparato central/ eliminado

OB 81

Nota: El evento entrante se produce √∫nicamente en ca‚Äê
so de fallo de una de las bater√≠as (si se usan bater√≠as de
respaldo redundantes). Si posteriormente falla tambi√©n
la otra bater√≠a, el evento no vuelve a producirse.
W#16#3922/3822

BAF: Fallo de la tensi√≥n de respaldo en el aparato cen‚Äê OB 81
tral/ eliminado

W#16#3923/3823

Fallo de la alimentaci√≥n de 24 V en el aparato central/
eliminado

W#16#3925/3825

BATTF: Fallo de al menos una bater√≠a de respaldo en un OB 81
aparato central redundante/ eliminado

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

OB 81

967

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

968

ID de evento

Evento

W#16#3926/3826

BAF: Fallo de la tensi√≥n de respaldo en un aparato cen‚Äê OB 81
tral redundante/ eliminado

OB

W#16#3927/3827

Fallo de la alimentaci√≥n de 24 V en un aparato central
redundante/ eliminado

OB 81

W#16#3931/3831

BATTF: Fallo de al menos una bater√≠a de respaldo en al
menos un aparato de ampliaci√≥n/ eliminado

OB 81

W#16#3932/3832

BAF: Fallo de la tensi√≥n de respaldo en al menos un
aparato de ampliaci√≥n/ eliminado

OB 81

W#16#3933/3833

Fallo de la alimentaci√≥n de 24 V en al menos un aparato
de ampliaci√≥n/ eliminado

OB 81

W#16#3942

Alarma de diagn√≥stico (m√≥dulo/subm√≥dulo averiado o
mantenimiento necesario o ambos)

OB 82

W#16#3842

Alarma de diagn√≥stico (m√≥dulo/subm√≥dulo en buen es‚Äê OB 82
tado)

W#16#3951

M√≥dulo PROFINET IO desenchufado

OB 83

W#16#3954

Subm√≥dulo/m√≥dulo PROFINET IO desenchufado

OB 83

W#16#3854

Subm√≥dulo/m√≥dulo PROFINET IO enchufado y coinci‚Äê
dente con el subm√≥dulo/m√≥dulo parametrizado

OB 83

W#16#3855

Subm√≥dulo/m√≥dulo PROFINET IO enchufado, pero no
coincidente con el subm√≥dulo/m√≥dulo parametrizado

OB 83

W#16#3856

Subm√≥dulo/m√≥dulo PROFINET IO enchufado, pero
error en parametrizaci√≥n del m√≥dulo

OB 83

W#16#3857

Subm√≥dulo/m√≥dulo PROFINET IO insertado, pero con
fallo o mantenimiento

OB 83

W#16#3858

Subm√≥dulo PROFINET IO, error de acceso eliminado

OB 83

W#16#3861

M√≥dulo/m√≥dulo de interfaz enchufado, tipo de m√≥dulo
correcto

OB 83

W#16#3961

M√≥dulo/m√≥dulo de interfaz desenchufado o no accesible OB 83

W#16#3863

M√≥dulo/m√≥dulo de interfaz enchufado, pero tipo de m√≥‚Äê OB 83
dulo
incorrecto

W#16#3864

M√≥dulo/m√≥dulo de interfaz enchufado, pero defectuoso OB 83
(identificador de m√≥dulo ilegible)

W#16#3865

M√≥dulo enchufado, pero error en parametrizaci√≥n del
m√≥dulo

OB 83

W#16#3866

M√≥dulo de nuevo accesible, error de tensi√≥n de carga
eliminado

OB 83

W#16#3966

M√≥dulo no accesible, error de tensi√≥n de carga

OB 83

W#16#3367

Inicio reparametrizaci√≥n de un m√≥dulo

OB 83

W#16#3267

Fin reparametrizaci√≥n de un m√≥dulo

OB 83

W#16#3968

Reparametrizaci√≥n de un m√≥dulo finalizada con errores OB 83

W#16#3571

Excesiva profundidad de anidamiento de niveles de pa‚Äê OB 88
r√©ntesis

W#16#3572

Excesiva profundidad de anidamiento de Master Con‚Äê
trol Relais

OB 88

W#16#3573

Excesiva profundidad de anidamiento con errores s√≠n‚Äê
cronos

OB 88

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

OB

W#16#3574

Excesiva profundidad de anidamiento de llamadas de
bloque (pila U)

OB 88

W#16#3575

Excesiva profundidad de anidamiento de llamadas de
bloque (pila B)

OB 88

W#16#3576

Error al asignar datos locales

OB 88

W#16#3578

Instrucci√≥n desconocida

OB 88

W#16#357A

Instrucci√≥n de salto con destino fuera del m√≥dulo

OB 88

W#16#3981

Error de interfaz, entrante

-

W#16#3881

Error de interfaz, saliente

-

W#16#3582

Error de memoria detectado por el sistema operativo y
eliminado

OB 84

W#16#3583

Acumulaci√≥n de errores de memoria detectados y co‚Äê
rregidos

OB 84

W#16#3585

Error en el sistema operativo del PC (solo con controla‚Äê OB 84
dores Win AC)

W#16#3986

Rendimiento de un acoplamiento H-Sync, disminuido

W#16#3587

Error de memoria multibit, detectado y corregido

OB 84

W#16#35A1

Interfaz de usuario (OB o FRB) no existente

OB 85

W#16#35A2

OB no cargado (iniciado por SFC o por el sistema ope‚Äê OB 85
rativo en funci√≥n de la configuraci√≥n)

W#16#35A3

Error al acceder a un m√≥dulo a trav√©s del sistema ope‚Äê OB 85
rativo

W#16#35A4

DB interfaz PROFInet, no accesible

OB 85

W#16#34A4

DB interfaz PROFInet, de nuevo accesible

OB 85

W#16#39B1

Error de acceso a periferia en actualizaci√≥n de memoria
imagen de proceso de las entradas

OB 85

W#16#39B2

Error de acceso a periferia durante transferencia de la
memoria imagen de proceso a los m√≥dulos de salida

OB 85

W#16#39B3/38B3

Error de acceso a periferia en actualizaci√≥n de memoria
imagen de proceso de las entradas

OB 85

W#16#39B4/38B4

Error de acceso a periferia en la actualizaci√≥n de la me‚Äê OB 85
moria imagen de proceso de las salidas

W#16#38C1

Retorno del aparato de ampliaci√≥n (de 1 a 21), saliente OB 86

W#16#39C1

Fallo del aparato de ampliaci√≥n (de 1 a 21), entrante

OB 86

W#16#38C2

Retorno del aparato de ampliaci√≥n con diferencias entre
configuraci√≥n te√≥rica y real

OB 86

W#16#39C3

Periferia descentralizada: Fallo del sistema maestro,
entrante

OB 86

W#16#39C4

Periferia descentralizada: Fallo de estaci√≥n, entrante

OB 86

W#16#38C4

Periferia descentralizada: Fallo de estaci√≥n, saliente

OB 86

W#16#38C5

Periferia descentralizada: Retorno de estaci√≥n con fallos OB 86

W#16#38C6

Retorno del aparato de ampliaci√≥n, pero error en para‚Äê
metrizaci√≥n del m√≥dulo

OB 86

W#16#38C7

DP: Retorno de la estaci√≥n, pero error en parametriza‚Äê
ci√≥n del m√≥dulo

OB 86

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

OB 84

969

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

OB

W#16#38C8

DP: Retorno de la estaci√≥n con diferencias entre confi‚Äê
guraci√≥n te√≥rica y real

OB 86

W#16#39CA

Fallo de sistema de PROFINET IO

OB 86

W#16#39CB

Fallo de estaci√≥n PROFINET IO

OB 86

W#16#38CB

Retorno de estaci√≥n PROFINET IO

OB 86

W#16#38CC

Recuperaci√≥n de estaci√≥n PROFINET IO con fallo o
mantenimiento

OB 86

W#16#39CD

Retorno de estaci√≥n PROFINET IO, pero la configura‚Äê
ci√≥n te√≥rica difiere de la configuraci√≥n real

OB 86

W#16#39CE

Retorno de estaci√≥n PROFINET IO, pero error en la pa‚Äê OB 86
rametrizaci√≥n del m√≥dulo

W#16#33CF/32CF

Fallo/recuperaci√≥n de un dispositivo PROFINET IO de‚Äê OB 86
bido a desactivaci√≥n/activaci√≥n mediante la instrucci√≥n
D_ACT_DP

W#16#39F8/38F8

Fallo/recuperaci√≥n de una parte de los subm√≥dulos de
un I-Device PROFINET

W#16#38F9

Recuperaci√≥n de una parte de los subm√≥dulos de un I- OB 86
Device PROFINET con diferencias en la configuraci√≥n
de dispositivos

W#16#35D2

No es posible enviar las entradas de diagn√≥stico en este
momento

OB 87

W#16#35D3

No se pueden enviar los telegramas de sincronizaci√≥n

OB 87

W#16#35D4

Salto de hora no admisible debido a sincronizaci√≥n ho‚Äê OB 87
raria

W#16#35D5

Error al adoptar el tiempo de sincronizaci√≥n

OB 87

W#16#35E1

Identificaci√≥n de telegrama err√≥nea con GD

OB 87

W#16#35E2

No se puede registrar en el DB el estado de paquete GD OB 87

W#16#35E3

Error de longitud de telegrama con GD

W#16#35E4

Recibido n√∫mero de paquete GD no admisible

OB 87

W#16#35E5

Error al acceder al DB con instrucciones de comunica‚Äê
ci√≥n para conexiones S7 configuradas

OB 87

W#16#35E6

No se puede registrar en el DB el estado global de GD

OB 87

OB 86

OB 87

Clase de evento 4 - Eventos de parada y otras transiciones de estado operativo
Descripci√≥n de las IDs de evento

970

ID de evento

Evento

W#16#4300

POWER-ON respaldado

W#16#4301

Transici√≥n de estado operativo de STOP a ARRANQUE

W#16#4302

Transici√≥n de estado operativo de ARRANQUE a RUN

W#16#4303

STOP por accionamiento del interruptor de parada

W#16#4304

STOP por accionamiento de STOP en la programadora o mediante la instrucci√≥n
STOP

W#16#4305

PARADA: Punto de parada alcanzado

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#4306

PARADA: Punto de parada abandonado

W#16#4307

Iniciar borrado total por intervenci√≥n en PG

W#16#4308

Iniciar borrado total mediante accionamiento de interruptor

W#16#4309

Iniciar borrado total autom√°ticamente (POWER-ON no respaldado)

W#16#430A

PARADA abandonada, transici√≥n a STOP

W#16#430D

STOP por otra CPU en caso de multiprocesamiento

W#16#430E

Borrado total ejecutado

W#16#430F

STOP del m√≥dulo mediante STOP de una CPU

W#16#4510

STOP debido a violaci√≥n del rango de fechas de la CPU

W#16#4318

Inicio del proceso CiR

W#16#4319

Proceso CiR finalizado

W#16#4520

AVER√çA: STOP no accesible

W#16#4521

AVER√çA: Fallo del procesador de ejecuci√≥n de comandos

W#16#4522

AVER√çA: Fallo del bloque de reloj

W#16#4523

AVER√çA: Fallo del generador de impulsos de reloj

W#16#4524

AVER√çA: Fallo de la actualizaci√≥n de la c√©lula de tiempo

W#16#4525

AVER√çA: Fallo de sincronizaci√≥n en caso de multiprocesamiento

W#16#4926

AVER√çA: Fallo de la vigilancia de tiempo en accesos a periferia

W#16#4527

AVER√çA: Fallo de la vigilancia de acceso a la periferia

W#16#4528

AVER√çA: Fallo de la vigilancia de tiempo de ciclo

W#16#4530

AVER√çA: Error del test de memoria en la memoria interna

W#16#4931

STOP o AVER√çA: Error del test de memoria en la memoria del m√≥dulo

W#16#4532

AVER√çA: Fallo de recursos b√°sicos

W#16#4933

Error de suma de verificaci√≥n

W#16#4934

AVER√çA: No existe memoria

W#16#4935

AVER√çA: Interrupci√≥n debido a watchdog/processor exceptions

W#16#4536

AVER√çA: Selector de modo, averiado

W#16#4540

STOP: La ampliaci√≥n de la memoria de trabajo interna presenta lagunas. La pri‚Äê
mera ampliaci√≥n de memoria es demasiado peque√±a o no existe.

W#16#4541

STOP debido al sistema de ejecuci√≥n de las clases de prioridad

W#16#4542

STOP debido al sistema de administraci√≥n de objetos

W#16#4543

STOP debido a test y puesta en servicio

W#16#4544

STOP debido al sistema de diagn√≥stico

W#16#4545

STOP debido al sistema de comunicaci√≥n

W#16#4546

STOP debido a la administraci√≥n de memoria de la CPU

W#16#4547

STOP debido a la administraci√≥n de la memoria imagen de proceso

W#16#4548

STOP debido a la administraci√≥n de la periferia

W#16#4949

STOP debido a alarma de proceso prolongada

W#16#454A

STOP debido a configuraci√≥n: Al arrancar la CPU hab√≠a un OB cargado que se
hab√≠a desmarcado en la configuraci√≥n.

W#16#494D

STOP debido a errores de periferia

W#16#494E

STOP debido a fallo de red

W#16#494F

STOP debido a error de configuraci√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

971

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

972

ID de evento

Evento

W#16#4550

AVER√çA: Error interno del sistema

W#16#4555

No es posible el rearranque porque se ha excedido el l√≠mite del tiempo de vigilancia

W#16#4556

STOP: Solicitud de borrado total debido a comunicaci√≥n/incoherencia de datos

W#16#4357

Tiempo de vigilancia del m√≥dulo, iniciado

W#16#4358

Todos los m√≥dulos est√°n listos para funcionar

W#16#4959

No todos los m√≥dulos est√°n listos para funcionar

W#16#4562

STOP debido a error de programaci√≥n (OB no cargado o no posible)

W#16#4563

STOP debido a error de acceso a periferia (OB no cargado o no posible)

W#16#4567

STOP debido a evento H

W#16#4568

STOP debido a error de tiempo (OB no cargado o no posible)

W#16#456A

STOP debido a alarma de diagn√≥stico (OB no cargado o no posible)

W#16#456B

STOP debido a extracci√≥n/inserci√≥n (OB no cargado o no posible)

W#16#456C

STOP debido a error de hardware de la CPU (OB no cargado o no posible)

W#16#456D

STOP debido a error de ejecuci√≥n del programa (OB no cargado o no posible)

W#16#456E

STOP debido a error de comunicaci√≥n (OB no cargado o no posible)

W#16#456F

STOP debido a fallo del rack (OB no cargado o no posible)

W#16#4570

STOP debido a interrupci√≥n del procesamiento (OB no cargado o no posible)

W#16#4571

STOP debido a error de pila de par√©ntesis

W#16#4572

STOP debido a error de pila del Master Control Relais

W#16#4573

STOP debido a rebase de la profundidad de anidamiento en errores s√≠ncronos

W#16#4574

STOP debido a anidamiento excesivo de la pila U en la pila de clases de prioridad

W#16#4575

STOP debido a anidamiento excesivo de la pila B en la pila de clases de prioridad

W#16#4576

STOP debido a error al asignar datos locales

W#16#4578

STOP debido a Opcode desconocido

W#16#457A

STOP debido a error de longitud de c√≥digo

W#16#457B

STOP debido a DB no cargado en periferia integrada

W#16#497C

STOP debido a tecnolog√≠a integrada

W#16#457D

Solicitud de borrado total porque se ha modificado la versi√≥n de la interfaz interna
para la tecnolog√≠a integrada

W#16#457F

STOP debido a comando STOP

W#16#4580

STOP: Contenido del b√∫fer de respaldo, incoherente (no hay transici√≥n a RUN)

W#16#4590

STOP debido a sobrecarga de las funciones internas

W#16#49A0

STOP debido a error de parametrizaci√≥n o diferencia inadmisible entre configura‚Äê
ci√≥n te√≥rica y real: Arranque bloqueado

W#16#49A1

STOP debido a error de parametrizaci√≥n: Solicitud de borrado total

W#16#49A2

STOP debido a error al reparametrizar: Arranque bloqueado

W#16#49A3

STOP debido a error al reparametrizar: Solicitud de borrado total

W#16#49A4

STOP: Incoherencia de los datos de configuraci√≥n

W#16#49A5

STOP: Periferia descentralizada: Incoherencias en la informaci√≥n de configura‚Äê
ci√≥n cargada

W#16#49A6

STOP: Periferia descentralizada: Informaci√≥n de configuraci√≥n no v√°lida

W#16#49A7

STOP: Periferia descentralizada: No existe la informaci√≥n de configuraci√≥n

W#16#49A8

STOP: Visualizaci√≥n de errores de la interfaz para la periferia descentralizada

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#43B0

Actualizaci√≥n o copia de seguridad del firmware, finalizada correctamente

W#16#49B1

Datos err√≥neos de actualizaci√≥n del firmware

W#16#49B2

Actualizaci√≥n de firmware: La versi√≥n del hardware no concuerda con el firmware

W#16#49B3

Actualizaci√≥n de firmware: El tipo de m√≥dulo no concuerda con el firmware

W#16#43B4

Error al efectuar copia de seguridad del firmware

W#16#43B6

Interrupci√≥n de la actualizaci√≥n del firmware por m√≥dulos redundantes

W#16#43D0

Rechazo de ACOPLAR debido a violaci√≥n de las reglas de coordinaci√≥n.

W#16#43D1

Interrupci√≥n de la secuencia ACOPLAR/SINCRONIZAR

W#16#49D2

STOP de la CPU de reserva debido a STOP de la CPU maestra durante el aco‚Äê
plamiento

W#16#43D3

STOP de una CPU de reserva

W#16#49D4

STOP de un maestro porque la CPU interlocutora tambi√©n es maestra (error de
acoplamiento)

W#16#43D5

Rechazo de ACOPLAR debido a que la capacidad de memoria del AS parcial es
distinta

W#16#43D6

Rechazo de ACOPLAR debido a que el programa de sistema del AS parcial es
distinto

W#16#43D7

Rechazo de ACOPLAR debido a cambio de la configuraci√≥n

W#16#49D8

STOP/Modo de b√∫squeda de errores/AVER√çA: Error de hardware detectado de‚Äê
bido a otro error

W#16#49D9

STOP debido a error del m√≥dulo de sincronizaci√≥n

W#16#49DA

STOP debido a error de sincronizaci√≥n entre CPUs H

W#16#43DC

Interrupci√≥n al acoplar con conmutaci√≥n

W#16#43DD

Rechazo de ACOPLAR debido a funciones de test u otras funciones online en
curso

W#16#43DE

Interrupci√≥n del proceso de sincronizaci√≥n debido al rebase de un tiempo de vigi‚Äê
lancia despu√©s de n intentos, nuevo intento de sincronizaci√≥n iniciado

W#16#43DF

Interrupci√≥n definitiva del proceso de sincronizaci√≥n debido al rebase de un tiempo
de vigilancia despu√©s del n√∫mero m√°ximo de intentos, se requiere nueva inter‚Äê
venci√≥n

W#16#43E0

Cambio de Modo "Individual" a Acoplar

W#16#43E1

Cambio de Acoplar a Sincronizar

W#16#43E2

Cambio de estado del sistema de Sincronizar a Redundante

W#16#43E3

CPU maestra: Cambio de estado del sistema de Redundante a modo "Individual"

W#16#43E4

CPU de reserva: Cambio de estado del sistema de Redundante a B√öSQUEDA DE
ERRORES

W#16#43E5

CPU de reserva: Cambio de B√öSQUEDA DE ERRORES a Acoplar o STOP

W#16#43E6

Interrupci√≥n de Acoplar de la CPU de reserva

W#16#43E7

Interrupci√≥n de Sincronizar de la CPU de reserva

W#16#43E8

CPU de reserva: Cambio de Acoplar a Arranque

W#16#43E9

CPU de reserva: Cambio de Arranque a Sincronizar

W#16#43F1

Conmutaci√≥n de reserva a maestro

W#16#43F2

Acoplamiento de CPUs H incompatibles, bloqueado por el programa de sistema

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

973

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#42F3

Error de suma de verificaci√≥n detectado por el sistema operativo y eliminado

W#16#43F4

CPU de reserva: Bloqueo de Acoplar/Sincronizar mediante la instrucci√≥n H_CTRL
en la CPU maestra

Clase de evento 5 - Eventos de procesamiento de estado operativo
Descripci√≥n de las IDs de evento

974

ID de evento

Evento

W#16#530D

Nueva informaci√≥n de arranque en el estado operativo STOP

W#16#510F

En WinLC se ha producido un problema que ha provocado un STOP o una
aver√≠a de la CPU.

W#16#5311

Arranque a pesar de falta de aviso de fin del/de los m√≥dulo(s)

W#16#5545

Inicio de la reparametrizaci√≥n en el marco de una modificaci√≥n de la instala‚Äê
ci√≥n durante el funcionamiento

W#16#5445

Fin de la reparametrizaci√≥n en el marco de una modificaci√≥n de la instalaci√≥n
durante el funcionamiento

W#16#5961

Error de parametrizaci√≥n

W#16#5962

Error de parametrizaci√≥n con impedimento para el arranque

W#16#5963

Error de parametrizaci√≥n con solicitud de borrado total

W#16#5966

Error de parametrizaci√≥n al conmutar

W#16#5967

Error de parametrizaci√≥n: Datos de configuraci√≥n desconocidos

W#16#5968/5868

Direcci√≥n de emergencia de una interfaz Ethernet, activada/desactivada

W#16#5969

Error de parametrizaci√≥n con impedimento para el arranque

W#16#596A

PROFINET IO: La direcci√≥n IP de un dispositivo IO ya existe

W#16#596B

La direcci√≥n IP de una interfaz Ethernet ya existe

W#16#596C

El nombre de una interfaz Ethernet ya existe

W#16#596D

La configuraci√≥n de red existente no concuerda con los requisitos del sistema
o la configuraci√≥n.

W#16#5371

Periferia descentralizada: Fin de la sincronizaci√≥n con un maestro DP

W#16#5979/5879

Aviso de diagn√≥stico de la interfaz DP: LED EXTF apagado/encendido

W#16#597C

Fallo o aplazamiento del comando Global Control de DP

W#16#5380

Entradas de b√∫fer de diagn√≥stico de eventos de alarma y as√≠ncronos, blo‚Äê
queadas

W#16#5581

Faltan una o varias licencias del software runtime.

W#16#5481

Todas las licencias del software runtime est√°n completas nuevamente.

W#16#558A

Diferencia entre las referencias de la CPU configurada y la insertada

W#16#558B

Diferencia entre la versi√≥n de firmware de la CPU configurada y la insertada

W#16#5966

Error de parametrizaci√≥n al conmutar

W#16#597C

Fallo o aplazamiento del comando Global Control de DP

W#16#5395

Periferia descentralizada: Reset de un maestro DP

W#16#5598

Inicio de una incoherencia potencial con sistemas maestros DP debido a CiR

W#16#5498

Fin de una incoherencia potencial con sistemas maestros DP debido a CiR

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#59A0

Alarma en la CPU no asignable

W#16#59A1

Error de configuraci√≥n de la tecnolog√≠a integrada

W#16#53A2

Firmware de tecnolog√≠a, cargado correctamente

W#16#59A3

Error al cargar la tecnolog√≠a integrada

W#16#53A4

Fallo al cargar el DB de tecnolog√≠a

W#16#55A5

Conflicto de versiones de la interfaz interna con la tecnolog√≠a integrada

W#16#55A6

Se ha excedido el n√∫mero m√°ximo de objetos tecnol√≥gicos.

W#16#55A7

Ya existe un DB de tecnolog√≠a de este tipo.

W#16#53FF

Reset al estado de suministro

Clase de evento 6 ‚Äì Eventos de comunicaci√≥n
Descripci√≥n de las IDs de evento
ID de evento

Evento

W#16#6500

Referencia de conexi√≥n (ID) a m√≥dulo, duplicada

W#16#6501

Recursos de conexi√≥n insuficientes

W#16#6502

Error en la descripci√≥n de la conexi√≥n

W#16#6905/6805

Problema de recursos en conexiones configuradas de modo pemanente/ eli‚Äê
minado

W#16#6510

Detectado error de estructura de CFB en el DB de instancia en evaluaci√≥n
EPROM

W#16#6514

N√∫mero de paquete GD en el m√≥dulo, duplicado

W#16#6515

Indicaci√≥n de longitud incoherente en la informaci√≥n de configuraci√≥n de GD

W#16#6316

Error de interfaz al arrancar el AS

W#16#6521

No existe m√≥dulo ni memoria interna

W#16#6522

M√≥dulo no admisible: Se debe cambiar el m√≥dulo y efectuar un borrado total

W#16#6523

Solicitud de borrado total por error al acceder al m√≥dulo

W#16#6524

Solicitud de borrado total por error en encabezado de bloque

W#16#6526

Solicitud de borrado total debido a cambio de memoria

W#16#6527

Se ha cambiado la memoria y no es posible el rearranque

W#16#6528

Funci√≥n de handling de objeto en STOP/PARADA, no es posible el rearranque

W#16#6529

No es posible el arranque durante la funci√≥n "Cargar programa de usuario"

W#16#652A

No es posible el arranque porque el bloque est√° duplicado en la memoria de
usuario

W#16#652B

No es posible el arranque porque la longitud del bloque es excesiva para el
m√≥dulo: Se debe cambiar el m√≥dulo

W#16#652C

No es posible el arranque porque hay un OB no v√°lido en el m√≥dulo

W#16#6532

No es posible el arranque porque hay informaci√≥n de configuraci√≥n no v√°lida
en el m√≥dulo

W#16#6533

Solicitud de borrado total por contenido de m√≥dulo no v√°lido

W#16#6534

No es posible el arranque: Bloque repetido varias veces en el m√≥dulo

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

975

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#6535

No es posible el arranque: Memoria insuficiente para recibir el bloque desde
el m√≥dulo

W#16#6536

No es posible el arranque: El m√≥dulo contiene un n√∫mero de bloque no v√°lido

W#16#6537

No es posible el arranque: El m√≥dulo contiene un bloque de longitud no v√°lida

W#16#6538

Datos locales o identificador de la protecci√≥n contra escritura (con DB) de un
bloque para CPU no v√°lidos

W#16#6539

Comando no v√°lido en el bloque (detectado por compilador)

W#16#653A

Solicitud de borrado total, porque los datos locales del OB en el m√≥dulo son
demasiado cortos

W#16#6543

No es posible el arranque: Tipo de bloque no v√°lido

W#16#6544

No es posible el arranque: Atributo "relevante para la ejecuci√≥n" no v√°lido

W#16#6545

Lenguaje de creaci√≥n no v√°lido

W#16#6546

Alcanzado el n√∫mero m√°ximo de bloques de un tipo de bloques

W#16#6547

Error al parametrizar m√≥dulos (no a trav√©s de bus P, sino interrupci√≥n de
descarga)

W#16#6548

Error de plausibilidad en verificaci√≥n de bloque

W#16#6549

Error de estructura en el bloque

W#16#6550

Un bloque presenta un error de verificaci√≥n (CRC)

W#16#6551

Un bloque no presenta ning√∫n valor de verificaci√≥n (CRC)

W#16#6353

Actualizaci√≥n del firmware: Inicio de la descarga del firmware a trav√©s de la red

W#16#6253

Actualizaci√≥n del firmware: Fin de la descarga del firmware a trav√©s de la red

W#16#6560

SCAN-Overflow

W#16#6981

Error de interfaz, entrante

W#16#6881

Error de interfaz, saliente

W#16#6390

Se ha formateado una Micro Memory Card

Clase de evento 8 - Eventos de diagn√≥stico para m√≥dulos
Descripci√≥n de las IDs de evento

976

ID de evento

Evento

Tipo de m√≥dulo

W#16#8x00

M√≥dulo averiado/correcto

Todos

W#16#8x01

Error interno

W#16#8x02

Error externo

W#16#8x03

Existe error de canal

W#16#8x04

Falta tensi√≥n auxiliar externa

W#16#8x05

Falta conector frontal

W#16#8x06

Falta parametrizaci√≥n

W#16#8x07

Par√°metro err√≥neo en m√≥dulo

W#16#8x30

M√≥dulo de usuario err√≥neo o no existe

W#16#8x31

Fallo de comunicaci√≥n

W#16#8x32

Estado operativo RUN/STOP (STOP: entrante,
RUN: saliente)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#8x33

La vigilancia de tiempo ha reaccionado (watchdog)

W#16#8x34

Fallo de la tensi√≥n de alimentaci√≥n interna del m√≥‚Äê
dulo

W#16#8x35

Bater√≠a BATTF agotada

W#16#8x36

Fallo de todo el respaldo

W#16#8x40

Fallo de aparato de ampliaci√≥n

W#16#8x41

Fallo de procesador

W#16#8x42

Error de EPROM

W#16#8x43

Error de RAM

W#16#8x44

Error de ADU/DAU

W#16#8x45

Actuaci√≥n fusible

W#16#8x46

Alarma de proceso perdida

W#16#8x50

Error de configuraci√≥n/parametrizaci√≥n

W#16#8x51

Error de modo com√∫n (Common Mode)

W#16#8x52

Cortocircuito P

W#16#8x53

Cortocircuito M

W#16#8x54

Rotura de hilo

W#16#8x55

Error en canal de referencia

W#16#8x56

Rebase por defecto del rango de medici√≥n

W#16#8x57

Rebase por exceso del rango de medici√≥n

W#16#8x60

Error de configuraci√≥n/parametrizaci√≥n

W#16#8x61

Error s√≠ncrono (error modo com√∫n)

W#16#8x62

Cortocircuito P

W#16#8x63

Cortocircuito M

W#16#8x64

Rotura de hilo

W#16#8x66

Falta tensi√≥n de carga

W#16#8x70

Error de configuraci√≥n/parametrizaci√≥n

W#16#8x71

Defecto a masa

W#16#8x72

Cortocircuito P (sensor)

W#16#8x73

Cortocircuito M

W#16#8x74

Rotura de hilo

W#16#8x75

Falta alimentaci√≥n del sensor

W#16#8x80

Error de configuraci√≥n/parametrizaci√≥n

W#16#8x81

Defecto a masa

W#16#8x82

Cortocircuito P

W#16#8x83

Cortocircuito M

W#16#8x84

Rotura de hilo

W#16#8x85

Actuaci√≥n fusible

W#16#8x86

Falta tensi√≥n de carga

W#16#8x87

Sobretemperatura

W#16#8xB0

Contador FM: Se√±al A defectuosa

W#16#8xB1

Contador FM: Se√±al B defectuosa

W#16#8xB2

Contador FM: Se√±al N defectuosa

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Tipo de m√≥dulo

Entrada anal√≥gica

Salida anal√≥gica

Entrada digital

Salida digital

FM

977

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#8xB3

Contador FM: Se ha transferido un valor err√≥neo en‚Äê
tre los canales

Tipo de m√≥dulo

W#16#8xB4

Contador FM: Alimentaci√≥n de sensor de 5,2 V de‚Äê
fectuosa

W#16#8xB5

Contador FM: Alimentaci√≥n de sensor de 24 V de‚Äê
fectuosa

Clase de evento 9 - Eventos de usuario est√°ndar
Descripci√≥n de las IDs de evento

978

ID de evento

Evento

W#16#9001

Modo de operaci√≥n autom√°tico

W#16#9101

Modo de operaci√≥n manual

W#16#9x02

ABRIR/CERRAR, CONECTAR/DESCONECTAR

W#16#9x03

Habilitaci√≥n de comando manual

W#16#9x04

Comando de protecci√≥n de grupo (ABRIR/CERRAR)

W#16#9x05

Habilitaci√≥n de proceso

W#16#9x06

Comando de protecci√≥n de sistema

W#16#9x07

La vigilancia de valor real ha reaccionado

W#16#9x08

La vigilancia de magnitud manipulada ha reaccionado

W#16#9x09

Desviaci√≥n de regulaci√≥n superior a lo admisible

W#16#9x0A

Error de posici√≥n final

W#16#9x0B

Error en tiempo de ejecuci√≥n

W#16#9x0C

Error de ejecuci√≥n de comando (control secuencial)

W#16#9x0D

Estado operativo en marcha > ABRIR

W#16#9x0E

Estado operativo en marcha > CERRAR

W#16#9x0F

Bloqueo de comandos

W#16#9x11

Estado de proceso ABRIR/CONECTADO

W#16#9x12

Estado de proceso CERRAR/DESCONECTADO

W#16#9x13

Estado de proceso Posici√≥n intermedia

W#16#9x14

Estado de proceso CONECTADO mediante autom√°tico

W#16#9x15

Estado de proceso CONECTADO mediante manual

W#16#9x16

Estado de proceso CONECTADO mediante comando de protecci√≥n

W#16#9x17

Estado de proceso DESCONECTADO mediante autom√°tico

W#16#9x18

Estado de proceso DESCONECTADO mediante manual

W#16#9x19

Estado de proceso DESCONECTADO mediante comando de protecci√≥n

W#16#9x21

Fallo de funci√≥n durante la aproximaci√≥n

W#16#9x22

Fallo de funci√≥n durante la retirada

W#16#9x31

Elemento activo (DE/WE) Posici√≥n final ABRIR

W#16#9x32

Elemento activo (DE/WE) Posici√≥n final No ABRIR

W#16#9x33

Elemento activo (DE/WE) Posici√≥n final CERRAR

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ID de evento

Evento

W#16#9x34

Elemento activo (DE/WE) Posici√≥n final No CERRAR

W#16#9x41

Estado no permitido, tiempo de tolerancia transcurrido

W#16#9x42

Estado no permitido, tiempo de tolerancia no transcurrido

W#16#9x43

Error de bloqueo, tiempo de tolerancia = 0

W#16#9x44

Error de bloqueo, tiempo de tolerancia > 0

W#16#9x45

Respuesta no ocurrida

W#16#9x46

Posici√≥n final abandonada de modo no admisible, tiempo de tolerancia = 0

W#16#9x47

Posici√≥n final abandonada de modo no admisible, tiempo de tolerancia > 0

W#16#9x50

L√≠mite superior rango de se√±ales OSF

W#16#9x51

L√≠mite superior rango de medici√≥n OMF

W#16#9x52

L√≠mite inferior rango de se√±ales USF

W#16#9x53

L√≠mite inferior rango de medici√≥n UMF

W#16#9x54

L√≠mite superior de alarma OOG

W#16#9x55

L√≠mite inferior de advertencia OG

W#16#9x56

L√≠mite superior de tolerancia OT

W#16#9x57

L√≠mite inferior de tolerancia UT

W#16#9x58

L√≠mite inferior de advertencia UG

W#16#9x59

L√≠mite inferior de alarma UUG

W#16#9x60

GRAPH 7 Etapa entrante/saliente

W#16#9x61

GRAPH 7 Error de bloqueo

W#16#9x62

GRAPH 7 Error de ejecuci√≥n

W#16#9x63

GRAPH 7 Error detectado

W#16#9x64

GRAPH 7 Error acusado

W#16#9x70

Tendencia excedida en sentido positivo

W#16#9x71

Tendencia excedida en sentido negativo

W#16#9x72

Respuesta no ocurrida

W#16#9x73

Posici√≥n final abandonada de modo no admisible

W#16#9x80

L√≠mite excedido, tiempo de tolerancia = 0

W#16#9x81

L√≠mite excedido, tiempo de tolerancia > 0

W#16#9x82

L√≠mite inferior no alcanzado, tiempo de tolerancia = 0

W#16#9x83

L√≠mite inferior no alcanzado, tiempo de tolerancia > 0

W#16#9x84

Gradiente rebasado por exceso, tiempo de tolerancia = 0

W#16#9x85

Gradiente rebasado por exceso, tiempo de tolerancia > 0

W#16#9x86

Gradiente inferior rebasado por defecto, tiempo de tolerancia = 0

W#16#9x87

Gradiente inferior rebasado por defecto, tiempo de tolerancia > 0

W#16#9190/9090

Error de parametrizaci√≥n del usuario, entrante/saliente

W#16#91F0

Desbordamiento

W#16#91F1

Rebase por defecto

W#16#91F2

Divisi√≥n por 0

W#16#91F3

Operaci√≥n aritm√©tica no admisible

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

979

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Clases de evento A y B - Eventos libres de usuario
Descripci√≥n de las IDs de evento
ID de evento

Evento

W#16#Axyz

Eventos de libre disposici√≥n

W#16#Bxyz

Eventos de libre disposici√≥n

Clases de evento reservadas
Reservado
Clases de evento reservadas para posteriores ampliaciones:
‚óè C
‚óè D
‚óè E
‚óè F reservada para m√≥dulos no centrales (p. ej. CP, FM)

Denominaci√≥n simb√≥lica y num√©rica de las instrucciones
Descripci√≥n
Las instrucciones de la Task Card se componen de funciones (FC), bloques de funci√≥n (FB),
funciones de sistema (SFC) y bloques de funci√≥n de sistema (SFB) que est√°n identificados
internamente por medio de n√∫meros.
Las tablas siguientes muestran las correspondencias entre la denominaci√≥n num√©rica y la
simb√≥lica.

Bloques de funci√≥n (FBs)
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FB 2

S_RCV

FB 3

S_SEND

FB 4

S_VSTAT

FB 5

S_VSET

FB 6

S_XON

FB 7

S_RTS

FB 8
FB 8

980

S_V24
(1)

USEND_S

FB 9 (1)

URCV_S

FB 14 (1)

GET_S

FB 15 (1)

PUT_S

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FB 40 (1)

FTP_CMD

FB 46

PG_DIAL

FB 47

AS_DIAL

FB 48

SMS_SEND

FB 49

AS_MAIL

FB 52 (1)

PNIO_RW_REC

FB 53

PE_DS3_Write_ET200S

FB 54

(1)

FB 55
FB 56

PNIO_ALARM
IP_CONFIG

(1)

LOGICAL_TRIGGER

FB 60

SET_SW

FB 61

SET_SW_S

FB 62

TIMESTMP

FB 80

LEAD_LAG

FB 81

DCAT

FB 81

S_MODB

FB 82

MCAT

FB 83

IMC

FB 84

SMC

FB 85

DRUM

FB 86

PACK

FB 210

FW_TCP

FB 220
FB 450

FW_IOT
(2)

RED_IN_MGP

FB 451 (2)

RED_OUT_MGP

FB 452 (2)

RED_DIAG_MGP

FB 453

RED_STATUS_MGP

(2)

FB 815

PE_Start_End_Pause

FB 816

PE_CMD

FB 817 (1)

PE_I_DEV

(1)

en el S7-300

(2)

en el S7-400

(3)

no en el WinAC

(4)

en el S7-400, no en el WinAC

(5)

en el WinAC

Funciones (FCs)
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FC 0

(1)

PE_Error_RSP

FC 1

(1)

PE_Start_RSP

FC 1 (1)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

DP_SEND

981

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FC 2

CONCAT

FC 2

(1)

PE_End_RSP

FC 2

(1)

DP_RECV

FC 3 (1)

PE_List_Modes_RSP

FC 3

DP_DIAG

(1)

FC 4

DELETE

FC 4

(1)

PE_Get_Mode_RSP

FC 4

(1)

DP_CTRL

FC 5 (1)

PE_PEM_Status_RSP

FC 5

AG_SEND

(1)

FC 6 (1)

PE_Identify_RSP

FC 6

AG_RECV

(1)

FC 7

Asi_3422

FC 7

(1)

PE_Measurement_List_RSP

FC 7

(1)

AG_LOCK

FC 8 (1)

PE_Measurement_Value_RSP

FC 8

AG_UNLOCK

(1)

FC 10 (1)

AG_CNTRL

FC 11

FIND

FC 11

982

(1)

PNIO_SEND

FC 12 (1)

PNIO_RECV

FC 17

INSERT

FC 17

S_USST

FC 18

S_USSR

FC 19

S_USSI

FC 20

LEFT

FC 21

LEN

FC 22

LIMIT

FC 25

MAX

FC 26

MID

FC 27

MIN

FC 31

REPLACE

FC 32

RIGHT

FC 36

ENCO

FC 36

SEL

FC 37

DECO

FC 60

LOC_TIME

FC 61

BT_LT

FC 62

LT_BT

FC 62 (1)

C_CNTRL

FC 63

S_LTINT

FC 74 (3)

I_ABORT

FC 80

TONR

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FC 82

RSET

FC 83

SET

FC 84

ATT

FC 85

FIFO

FC 86

TBL_FIND

FC 87

LIFO

FC 88

TBL

FC 89

TBL_WRD

FC 90

WSR

FC 91

WRD_TBL

FC 92

SHRB

FC 93

SEG

FC 98

BCDPL

FC 99

BITSUM

FC 100

RSETI

FC 101

SETI

FC 102

DEV

FC 103

CDT

FC 104

TBL_TBL

FC 105

SCALE

FC 106
FC 450

UNSCALE
(2)

FC 451 (2)
(1)

en el S7-300

(2)

en el S7-400

(3)

no en el WinAC

(4)

en el S7-400, no en el WinAC

(5)

en el WinAC

RED_INIT_MGP
RED_DEPA_MGP

Bloques de funci√≥n de sistema (SFBs)
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SFB 0

CTU

SFB 1

CTD

SFB 2

CTUD

SFB 3

TP

SFB 4

TON

SFB 5
SFB 16

TOF
(4)

PRINT

SFB 19 (2)

START

SFB 20

STOP

(2)

SFB 21 (4)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

RESUME

983

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SFB 22 (2)

STATUS

SFB 23

(2)

USTATUS

SFB 29

(1)

HS_COUNT_300C

SFB 30 (1)

FREQ_MES_300C

SFB 31

NOTIFY_8P

(2)

SFB 32

DRUM_X

SFB 33

(2)

SFB 34

(2)

ALARM_8

SFB 35 (2)

ALARM_8P

SFB 36 (2)

NOTIFY_8P

SFB 37 (2)

AR_SEND

SFB 38

HSC_A_B_300C

(1)

SFB 39 (1)

POS_300C

SFB 44

(1)

ANALOG_300C

SFB 46

(1)

DIGITAL_300C

SFB 47 (1)
SFB 48

(1)

COUNT_300C
FREQUENC_300C

SFB 49 (1)

PULSE_300C

SFB 52

RDREC

SFB 53

WRREC

SFB 54
SFB 60

984

ALARM

RALRM
(1)

SEND_PTP_300C

SFB 61 (1)

RCV_PTP_300C

SFB 62

RES_RCVB_300C

(1)

SFB 63 (1)

SEND_RK_300C

SFB 64

(1)

FETCH_RK_300C

SFB 65

(1)

SERVE_RK_300C

SFB 73

RCVREC

SFB 74

PRVREC

SFB 75

SALRM

SFB 81

RD_DPAR

SFB 104

IP_CONF

SFB 65001 (5)

CREA_COM

SFB 65002 (5)

EXEC_COM

SFB 65002 (5)

ASYN_COM

(1)

en el S7-300

(2)

en el S7-400

(3)

no en el WinAC

(4)

en el S7-400, no en el WinAC

(5)

en el WinAC

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Funciones de sistema (SFCs)
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SFC 2

SET_RTM

SFC 3

CTRL_RTM

SFC 4

READ_RTM

SFC 5
SFC 7

GADR_LGC
(3)

DP_PRAL

SFC 9 (2)

EN_MSG

SFC 10

DIS_MSG

(2)

SFC 11

DPSYC_FR

SFC 12

D_ACT_DP

SFC 13

DPNRM_DG

SFC 14

DPRD_DAT

SFC 17

ALARM_SQ

SFC 18

ALARM_S

SFC 19

ALARM_SC

SFC 20

BLKMOV

SFC 21

FILL

SFC 22

CREAT_DB

SFC 23

DEL_DB

SFC 24

TEST_DB

SFC 26 (2)

UPDAT_PI

SFC 27 (2)

UPDAT_PO

SFC 28

SET_TINT

SFC 29

CAN_TINT

SFC 30

ACT_TINT

SFC 31

QRY_TINT

SFC 32

SRT_DINT

SFC 33

CAN_DINT

SFC 34
SFC 35

QRY_DINT
(4)

MP_ALM

SFC 36

MSK_FLT

SFC 37

DMSK_FLT

SFC 38

READ_ERR

SFC 39

DIS_IRT

SFC 40

EN_IRT

SFC 41

DIS_AIRT

SFC 42

EN_AIRT

SFC 43

RE_TRIGR

SFC 44

REPL_VAL

SFC 46

STP

SFC 47
SFC 48

WAIT
(4)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

SNC_RTCB

985

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SFC 49

LGC_GADR

SFC 50

RD_LGADR

SFC 51

RDSYSST

SFC 52
SFC 54

WR_USMSG
(2)

WR_PARM

SFC 56

WR_DPARM

SFC 57

PARM_MOD

SFC 58

WR_REC

SFC 59

RD_REC

SFC 60 (4)

GD_SND

SFC 61

GD_RCV

(4)

SFC 62 (2)

CONTROL

SFC 64

TIME_TCK

SFC 64

RD_SINFO

SFC 65 (3)

X_SEND

SFC 66

(3)

X_RCV

SFC 67 (3)

X_GET

SFC 68

(3)

X_PUT

SFC 69

(3)

X_ABORT

SFC 70

GEO_LOG

SFC 71

LOG_GEO

SFC 72 (3)

I_GET

SFC 73

I_PUT

(3)

SFC 75
SFC 78

SET_ADDR
(2)

OB_RT

SFC 79

SETP

SFC 80

RESETP

SFC 81

UBLKMOV

SFC 82 (1) (6)

CREA_DBL

SFC 83

(1) (6)

READ_DBL

SFC 84

(1) (6)

WRIT_DBL

SFC 85 (6)
SFC 87

CREA_DB

(2)

C_DIAG

SFC 90 (4)

H_CTRL

SFC 99

WWW

SFC 100 (2)

SET_CLKS

SFC 101

RTM

SFC 102

986

RD_DPARM

SFC 55

(1)

RD_DPARA

SFC 103 (3)

DP_TOPOL

SFC 104 (2)

CIR

SFC 105

READ_SI

SFC 106

DEL_SI

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.2

Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SFC 107

ALARM_DQ

SFC 108

ALARM_D

SFC 109

PROTECT

SFC 112

PN_IN

SFC 113

PN_OUT

SFC 114

PN_DP

SFC 126

SYNC_PI

SFC 127

SYNC_PO

SFC 154

DPWR_DAT

(1)

en el S7-300

(2)

en el S7-400

(3)

no en el WinAC

(4)

en el S7-400, no en el WinAC

(5)

en el WinAC

Funcionamiento de las CPU S7-1500

Estados operativos
Principios b√°sicos de los estados operativos de CPUs S7
Introducci√≥n
Los estados operativos describen el estado de la CPU. Existen los estados operativos
siguientes:
‚óè ARRANQUE
‚óè RUN
‚óè STOP
‚óè PARADA
En estos estados operativos, la CPU es apta para la comunicaci√≥n, p. ej. a trav√©s de la interfaz
PN/IE.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

987

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Otros estados operativos
Si la CPU no est√° lista para funcionar, est√° en uno de los dos estados operativos siguientes:
‚óè Sin tensi√≥n, es decir, la tensi√≥n de red est√° desconectada.
‚óè Aver√≠a, es decir, se ha producido un fallo interno.
Si el estado "Defectuoso" es provocado por un error de firmware, se se√±alizar√° con los
LEDs de estado de la CPU (v√©ase la descripci√≥n de la CPU en los manuales de producto).
Para determinar la causa, proceda del siguiente modo:
‚Äì Desconecte y vuelva a conectar el interruptor de red.
‚Äì Lea el b√∫fer de diagn√≥stico cuando la CPU arranque y env√≠e los datos al Customer
Support para que los analicen.
Si la CPU no arranca, c√°mbiela.

Transiciones de estado operativo
Sinopsis
La figura siguiente muestra los estados operativos y las transiciones de CPUs S7-1500:
3$5$'$


5('
21







6723





$55$148(






581



La tabla siguiente muestra las condiciones en las que cambian los estados operativos:
N.¬∫

‚ë†

Transici√≥n de estado operativo Condiciones
POWER ON ‚Üí ARRANQUE

Una vez conectada, la CPU pasa al estado operativo "ARRANQUE" si:
‚óè est√° ajustado el tipo de arranque "Arranque en caliente" y
‚óè la configuraci√≥n de hardware y los bloques de programa son coherentes.

‚ë°

‚ë¢

La memoria no remanente se borra y en el contenido de los DBs no remanentes se
restablecen los valores iniciales de la memoria de carga. La memoria remanente y
el contenido de los DBs remanentes se conservan.
POWER ON ‚Üí STOP

Si se ajusta el tipo de arranque "Sin arranque", la CPU pasa al estado operativo
"STOP" despu√©s de conectar la tensi√≥n de alimentaci√≥n.
La memoria no remanente se borra y en el contenido de los DBs no remanentes se
restablecen los valores iniciales de la memoria de carga. La memoria remanente y
el contenido de los DBs remanentes se conservan.

STOP ‚Üí ARRANQUE

La CPU pasa al estado operativo "ARRANQUE" si:
‚óè la CPU se pone a "RUN" desde la programadora y
‚óè la configuraci√≥n de hardware y los bloques de programa son coherentes.

988

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
N.¬∫

‚ë£

Transici√≥n de estado operativo Condiciones
ARRANQUE ‚Üí STOP

La CPU pasa al estado operativo "STOP" en los casos siguientes:
‚óè Durante el arranque se detecta un error.
‚óè La CPU se pone a "STOP" desde la programadora.

‚ë§
‚ë•

‚óè Se procesa un comando STOP en el OB de arranque.
ARRANQUE ‚Üí RUN

Si el arranque es correcto, la CPU pasa a "RUN".

RUN ‚Üí STOP

La CPU pasa al estado operativo "STOP" en los casos siguientes:
‚óè Se detecta un error que impide seguir trabajando.
‚óè La CPU se pone a "STOP" desde la programadora.
‚óè Se procesa un comando STOP en el programa de usuario.

‚ë¶
‚ëß

ARRANQUE ‚Üí PARADA

Punto de parada alcanzado en el programa de arranque.

PARADA ‚Üí ARRANQUE

‚ë®
‚ë©
‚ë™

Punto de parada abandonado en el programa de arranque, se pone en "RUN" desde
la programadora.

RUN ‚Üí PARADA

Punto de parada alcanzado.

PARADA ‚Üí RUN

Punto de parada abandonado, se pone en "RUN" desde la programadora.

PARADA ‚Üí STOP

Manejo mediante interruptor/display o se pone en "STOP" desde la programadora.

Consulte tambi√©n
Estado operativo "RUN" (P√°gina 993)
Estado operativo "STOP" (P√°gina 993)
Estado operativo "PARADA" (pausa) (P√°gina 994)

Estado operativo "ARRANQUE"
Principios b√°sicos del estado operativo "ARRANQUE"
Funci√≥n
Antes de que la CPU empiece a procesar el programa de usuario c√≠clico despu√©s de la
conexi√≥n, se procesa un programa de arranque.
En dicho programa se definen determinadas variables de inicializaci√≥n para el programa
c√≠clico programando de forma adecuada los OBs de arranque. El n√∫mero de OBs de arranque
no est√° prescrito. Es posible no programar ning√∫n OB de arranque, programar solo uno o bien
varios.

Parametrizaci√≥n del comportamiento de arranque
Existe la posibilidad de determinar si la CPU debe permanecer en estado operativo "STOP" o
bien si debe realizarse un rearranque normal. Asimismo, en el grupo "Arranque" de las
propiedades de la CPU se parametriza el comportamiento durante el arranque ("RUN" o
estado operativo anterior).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

989

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Particularidades
Tenga en cuenta los puntos siguientes para el estado operativo "ARRANQUE":
‚óè Las salidas de los m√≥dulos est√°n bloqueadas.
‚óè La memoria imagen de proceso est√° inicializada.
‚óè La memoria imagen de proceso no se actualiza.
‚Äì Para leer el estado actual de las entradas durante el "ARRANQUE", existe la posibilidad
de acceder a las entradas mediante un acceso directo a la periferia.
‚Äì Para inicializar las salidas durante el ARRANQUE, es posible escribir valores mediante
la memoria imagen de proceso o mediante acceso directo a la periferia. Los valores se
emiten en las salidas en la transici√≥n al estado operativo "RUN".
‚óè Las marcas no remanentes, los temporizadores y contadores est√°n inicializados.
‚óè Las variables no remanentes en bloques de datos est√°n inicializadas.
‚óè En el arranque no se ejecuta ninguna vigilancia del tiempo de ciclo.
‚óè Los OBs de arranque se procesan. Independientemente del tipo de arranque seleccionado
se procesan todos los OBs de arranque programados.
Los siguientes OBs pueden iniciarse durante el arranque en caso de producirse un evento
correspondiente:
‚Äì OB 82: alarma de diagn√≥stico
‚Äì OB 83: extracci√≥n/inserci√≥n de m√≥dulos
‚Äì OB 86: error de rack
‚Äì OB 121: error de programaci√≥n (solo con tratamiento de errores global)
‚Äì OB 122: error de acceso a la periferia (solo con tratamiento de errores global)
Todos los dem√°s OBs no se pueden iniciar hasta que se realice la transici√≥n al estado
operativo "RUN".

Rearranque (en caliente)
Funci√≥n
Con el rearranque (en caliente) se borran todas las marcas no remanentes y se restablecen los
valores iniciales de la memoria de carga para todos los contenidos de DB no remanentes. Las
marcas remanentes y contenidos remanentes de DBs se conservan.
El procesamiento del programa empieza con el primer OB de arranque.

990

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Lanzar un rearranque (en caliente)
En los casos siguientes es posible realizar un "Rearranque (en caliente)" desde un comando
de men√∫ de la programadora:
‚óè La CPU est√° en estado operativo "STOP".
‚óè Despu√©s del borrado total
‚óè Despu√©s de cargar un programa coherente y una configuraci√≥n hardware coherente en
estado operativo "STOP" de la CPU.
En caso de "Conexi√≥n (POWER ON)" se lanza un "Rearranque (en caliente)" si se ha
parametrizado el comportamiento de arranque del siguiente modo:
‚óè Tipo de arranque "Arranque en caliente - RUN" (independientemente del estado operativo
de la CPU antes de la desconexi√≥n (POWER OFF)).
‚óè "Arranque en caliente - modo de operaci√≥n antes de desconexi√≥n (POWER OFF)" (en
funci√≥n del estado operativo de la CPU antes de la desconexi√≥n (POWER OFF). La CPU
deb√≠a estar previamente en RUN.)

Actividades de arranque
Resumen
La tabla siguiente muestra qu√© actividades realiza la CPU durante el arranque:
Actividades en el orden de procesamiento

en caso de rearranque (en caliente)

Borrar marcas no remanentes

s√≠

Borrar todas las marcas

no

Borrar la memoria imagen de proceso de las salidas

s√≠

Procesamiento de los OB de arranque

s√≠

Actualizar la memoria imagen de proceso de las entradas

s√≠

Habilitar las salidas tras transici√≥n de estado operativo a "RUN"

s√≠

Proceso
La figura siguiente muestra las actividades de la CPU en los estados operativos "STOP",
"ARRANQUE" y "RUN".
El estado de las salidas de la periferia en el primer ciclo del programa de usuario se puede
definir con las medidas siguientes:
‚óè Utilizar m√≥dulos de salida parametrizables para aplicar valores sustitutivos o mantener el
√∫ltimo valor.
‚óè Preasignar las salidas en los OB de arranque.
Durante el arranque, todos los eventos de alarma se colocan en una cola de espera y se
procesan posteriormente en estado operativo RUN. En estado operativo RUN es posible
procesar alarmas de proceso en cualquier momento.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

991

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
6723
$55$148(
,QLFLDOL]DUPHPRULDLPDJHQ
GHSURFHVRGHODVHQWUDGDV
%ORTXHDUVDOLGDVGH
SHULIHULD
'HVDFWLYDUPDQWHQHU
¬ºOWLPRYDORURDSOLFDUYDORU
VXVWLWXWLYR
(MHFXWDU2%VGHDUUDQTXH
7UDQVIHULUODVHQWUDGDVGH
SHULIHULDDODPHPRULDLPDJHQ
GHSURFHVRGHODVHQWUDGDV
+DELOLWDUVDOLGDVGH
SHULIHULD
581
(PLWLUPHPRULDLPDJHQGH
SURFHVRGHODVVDOLGDV
7UDQVIHULUODVHQWUDGDVGH
SHULIHULDDODPHPRULDLPDJHQ
GHSURFHVRGHODVHQWUDGDV
(MHFXWDU2%VF¬ØFOLFRV
$FWLYLGDGHVGHOVLVWHPD
RSHUDWLYR FRPXQLFDFL¬µQ
DXWRWHVWHWF

Particularidades del arranque
Comportamiento si la configuraci√≥n te√≥rica difiere de la real
La configuraci√≥n te√≥rica se representa mediante la configuraci√≥n cargada en la CPU. La
configuraci√≥n real es la que existe realmente en el sistema de automatizaci√≥n.
Si la configuraci√≥n te√≥rica difiere de la real, el par√°metro "Compatibilidad hardware soportada"
ser√° el que determine el comportamiento de la CPU.

Cancelaci√≥n de un arranque
Si durante el arranque se producen errores, este se cancela y la CPU vuelve a "STOP".
Un arranque no se realiza o se cancela en las condiciones siguientes:
‚óè Si no se ha insertado ninguna SIMATIC Memory Card o no es v√°lida.
‚óè Si no hay ninguna configuraci√≥n hardware cargada.

992

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estado operativo "RUN"
Funci√≥n
En estado operativo "RUN" se procesa el programa c√≠clico, controlado por tiempo y por
alarmas. Las direcciones que se encuentren en la memoria imagen de proceso "Actualizaci√≥n
autom√°tica" se actualizar√°n autom√°ticamente en cada ciclo del programa:
‚óè Se emite la memoria imagen de proceso de las salidas.
‚óè Se lee la memoria imagen de proceso de las entradas.
‚óè Se procesa el programa de usuario.
El intercambio activo de datos entre CPUs S7-1200 a trav√©s de la Open User Communication
solo es posible en estado operativo "RUN".

Procesamiento del programa de usuario
Una vez que la CPU ha le√≠do las entradas, el programa c√≠clico se procesa a partir de la primera
instrucci√≥n y hasta la √∫ltima instrucci√≥n.
Si se ha parametrizado un tiempo m√≠nimo de ciclo, la CPU termina el ciclo una vez transcurrido
el tiempo m√≠nimo de ciclo aunque la ejecuci√≥n del programa de usuario haya requerido menos
tiempo.
Para garantizar que el programa c√≠clico se ejecute en un tiempo determinado, se ajusta un
tiempo de vigilancia del ciclo que se puede adaptar en funci√≥n de las necesidades. Si la
ejecuci√≥n del programa c√≠clico no ha terminado en ese tiempo, el sistema reacciona con un
error de tiempo.
Otros eventos, p. ej. las alarmas de proceso o las alarmas de diagn√≥stico, pueden interrumpir
el flujo del programa y prolongar el tiempo de ciclo.

Consulte tambi√©n
Transiciones de estado operativo (P√°gina 988)

Estado operativo "STOP"
Funci√≥n
En estado operativo "STOP" no se procesa el programa de usuario. Todas las salidas se
desactivan o reaccionan del modo parametrizado: devuelven el valor sustitutivo parametrizado
o mantienen el √∫ltimo valor emitido, con lo que el proceso controlado pasa a un estado
operativo seguro.
La CPU comprueba los puntos siguientes:
‚óè Si la CPU se rige por los valores predeterminados o si hay juegos de par√°metros
‚óè Si se cumplen las condiciones marco para el comportamiento de arranque programado

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

993

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Transiciones de estado operativo (P√°gina 988)

Estado operativo "PARADA" (pausa)
Funci√≥n
El estado operativo "PARADA" se alcanza con un punto de parada (punto de interrupci√≥n) en
un bloque que se prueba paso a paso en modo de etapa individual. La funci√≥n de prueba Modo
de etapa individual est√° disponible en los lenguajes de programaci√≥n AWL y SCL.
En el estado operativo "PARADA" no se dispara ning√∫n evento; el programa de usuario no se
ejecuta.
Todas las salidas est√°n desactivadas o reaccionan del modo parametrizado: las salidas
devuelven el valor sustitutivo parametrizado o mantienen el √∫ltimo valor emitido, con lo que el
proceso controlado pasa a un estado operativo seguro.
Los temporizadores o los tiempos de vigilancia se detienen. Los temporizadores para eventos
controlados por tiempo se paran.
En estado de PARADA, los OB de alarma de proceso no se inician por causas de alarma
externas (p. ej., entrada de alarma de proceso).
La hora del sistema sigue funcionando.
En la transici√≥n de desconexi√≥n (POWER OFF) a conexi√≥n (POWER ON) durante el estado de
PARADA, la CPU pasa al estado operativo STOP y permanece en ese estado. En este caso,
la CPU no ejecuta ning√∫n arranque autom√°tico.
El tiempo de vigilancia del ciclo se detiene cuando el programa de usuario alcanza un punto de
parada. Cuando se abandona de nuevo el punto de parada, vuelve a iniciarse el tiempo de
vigilancia.
Los fallos que en el estado operativo RUN provocan un STOP de la CPU, tambi√©n provocan
un STOP en el estado operativo PARADA.

Consulte tambi√©n
Transiciones de estado operativo (P√°gina 988)

Principios b√°sicos del borrado total
Funci√≥n
El borrado total de la CPU solo es posible en estado operativo "STOP".
En el borrado total, la CPU pasa a una especie de "estado original". Esto significa que:
‚óè Si existe una conexi√≥n online entre la programadora o el PC y la CPU, se deshar√°.
‚óè Tanto el contenido de la memoria de trabajo como los datos remanentes y no remanentes
se borran.

994

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè El b√∫fer de diagn√≥stico, la hora y la direcci√≥n IP se conservan.
‚óè A continuaci√≥n, la CPU se inicializa con los datos de proyecto cargados (configuraci√≥n
hardware, bloques l√≥gicos y de datos, peticiones de forzado permanente). Estos datos se
copian de la memoria de carga a la memoria de trabajo.
Resultado:
‚Äì Si en la configuraci√≥n hardware se ha ajustado una direcci√≥n IP (opci√≥n "Ajustar
direcci√≥n IP en el proyecto"), esta direcci√≥n IP es v√°lida despu√©s del borrado total.
‚Äì Los bloques de datos ya no tienen valores actuales, sino sus valores iniciales
configurados.
‚Äì Las peticiones de forzado permanente siguen activas.

√Åreas de memoria
Informaci√≥n importante sobre las SIMATIC Memory Cards
Funcionamiento de la SIMATIC Memory Card
La SIMATIC Memory Card para un S7-1500 es una tarjeta de memoria SD compatible con el
sistema operativo Windows y preformateada por Siemens para el programa de usuario de la
CPU.

ATENCI√ìN
Formateado de la SIMATIC Memory Card
S√≥lo se pueden borrar archivos y carpetas. Si se formatea la SIMATIC Memory Card con
recursos de Windows, p. ej. con un lector de tarjetas de uso com√∫n, la SIMATIC Memory Card
quedar√° inutilizada como medio de almacenamiento para una CPU S7.

Configurar el tipo de tarjeta
La SIMATIC Memory Card se puede utilizar como tarjeta de programa o como tarjeta de
actualizaci√≥n de firmware.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

995

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para configurar el tipo de tarjeta, inserte la SIMATIC Memory Card en el lector de tarjetas de
la programadora y seleccione la carpeta "Lector de tarjetas/memoria USB" del √°rbol del
proyecto. En las propiedades de la Memory Card marcada se puede establecer el tipo de
tarjeta:
‚óè Programa
Una tarjeta de programa sirve como memoria de carga externa para la CPU. Contiene el
programa de usuario completo para la CPU. El programa de usuario se transfiere a la
memoria de trabajo y se ejecuta aqu√≠. Si se extrae la SIMATIC Memory Card que contiene
el programa de usuario, ya no quedar√° ning√∫n programa.
Directorio: SIMATIC.S7S
‚óè Firmware Card
En una SIMATIC Memory Card se puede guardar firmware para m√≥dulos S7-1500. Por este
motivo, es posible realizar una actualizaci√≥n de firmware mediante una SIMATIC Memory
Card especialmente dise√±ada para ello.
Directorio: FWUPDATE.S7S

Carpetas y archivos en la SIMATIC Memory Card
En la SIMATIC Memory Card se pueden encontrar las carpetas y archivos siguientes:
Carpeta

Descripci√≥n

FWUPDATE.S7S

Archivos de actualizaci√≥n de firmware para CPU y m√≥dulos de periferia

SIMATIC.S7S

Programa de usuario, es decir, todos los bloques (OB, FC, FB, DB) y
bloques de sistema, datos de proyecto de la CPU

SIMATIC.HMI

Datos relevantes para HMI

DataLogs

Archivos DataLog

Recipes

Archivos de recetas

UserFiles

Datos de usuario

Backups

Archivos para realizar copias de seguridad y restaurar a trav√©s del
display

Al cargar el dispositivo como estaci√≥n nueva, el contenido de las carpetas "DataLogs",
"Recipes" y "UserFiles" se carga tambi√©n en el proyecto STEP 7 (a partir de TIA Portal V15.1).
Encontrar√° los archivos en la ruta del proyecto, en "AdditionalFiles/MemoryCards/<Name of
the PLC>". Encontrar√° m√°s informaci√≥n sobre DataLogs y archivos de recetas en el cap√≠tulo
"Recetas y Data Logging".
En la SIMATIC Memory Card encontrar√° la siguiente estructura de datos:
Tipo de archivo

996

Descripci√≥n

S7_JOB.S7S

Archivo de tareas

SIMATIC.HMI\Backup\*.psb

Archivos de backup de paneles

SIMATICHMI_Ba‚Äê
ckups_DMS.bin

Archivo protegido (necesario para el uso de archivos de backup de
paneles en STEP 7)

__LOG__

Archivo de sistema protegido (necesario para utilizar la tarjeta)

crdinfo.bin

Archivo de sistema protegido (necesario para utilizar la tarjeta)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tipo de archivo

Descripci√≥n

DUMP.S7S

Archivo de datos de servicio

*.pdf, *.txt, *.csv, ...

Otros archivos con distintos formatos, que pueden guardarse tambi√©n
en carpetas de la SIMATIC Memory Card
Al cargar el dispositivo como estaci√≥n nueva, estos archivos solo se
depositar√°n en el proyecto STEP 7 si se han guardado en una carpeta
de nombre "UserFiles".

Transferir objetos del proyecto a la SIMATIC Memory Card
Si la SIMATIC Memory Card est√° insertada en la programadora o en un lector de tarjetas
externo, se pueden copiar en ella los siguientes objetos desde el √°rbol del proyecto:
‚óè Bloques individuales (posibilidad de selecci√≥n m√∫ltiple)
En este caso, se ofrece una transferencia coherente, es decir, se tiene en cuenta la
interdependencia de los bloques entre s√≠ debida a las llamadas.
‚óè PLC
En este caso, todos los objetos relevantes para la ejecuci√≥n, como los bloques y la
configuraci√≥n hardware, entre otros, se transfieren a la SIMATIC Memory Card, al igual que
durante el proceso de carga.
La transferencia puede realizarse arrastrando y soltando los objetos, o con el comando "Lector
de tarjetas/memoria USB > Escribir en Memory Card" del men√∫ "Proyecto".

Guardar datos de usuario en la SIMATIC Memory Card
Los datos de usuario, p. ej. archivos PDF de documentaci√≥n del proyecto, se transfieren a la
SIMATIC Memory Card creando manualmente en la Memory Card una carpeta de nombre
"UserFiles" y guardando en esa carpeta los archivos. Al cargar el dispositivo como estaci√≥n
nueva, los archivos de esta carpeta (*.pdf, *.txt, *.csv, ...) son los √∫nicos que se cargar√°n
tambi√©n en el proyecto STEP 7. La carpeta "UserFiles" puede utilizarse, p. ej. para restaurar
cuando ha habido un fallo de la Memory Card o de la CPU.
Una vez cargada la Memory Card, la carpeta "UserFiles", con los archivos que contiene, se
guarda en el √°rbol del proyecto en el directorio "AdditionalFiles > MemoryCards > [Nombre de
la CPU]".
Si la carpeta "[Nombre de la CPU]" ya existe, p. ej. al realizar una nueva carga de la Memory
Card, la carpeta del √°rbol del proyecto se sobrescribir√° con los datos de la Memory Card.

Transferir objetos de la SIMATIC Memory Card al proyecto
Los objetos se transfieren seleccionando el s√≠mbolo de la SIMATIC Memory Card en el √°rbol
del proyecto y arrastr√°ndolo a una CPU del proyecto con la funci√≥n Drag&Drop. El contenido
de la SIMATIC Memory Card se debe corresponder con el tipo de CPU del √°rbol del proyecto.
Si ya hab√≠a bloques, estos se borran antes de la transferencia.

Actualizar firmware con una SIMATIC Memory Card
Los archivos de firmware m√°s recientes pueden adquirirse en Internet, a trav√©s de las p√°ginas
del "Service & Support":

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

997

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
http://support.automation.siemens.com
Guarde los archivos de firmware en el disco duro e inserte la SIMATIC Memory Card en el
lector de tarjetas de su programadora.
Para guardar el archivo en la SIMATIC Memory Card, seleccione en el √°rbol del proyecto la
Memory Card en la carpeta "Lector de tarjetas/memoria USB". Seleccione el men√∫ contextual
"Lector de tarjetas/memoria USB > Crear actualizaci√≥n de firmware en Memory Card".
A continuaci√≥n, siga las instrucciones del portal Service & Support o del manual de sistema
S7-1500 para actualizar el firmware.
Con la actualizaci√≥n del firmware, el m√≥dulo, bien sea una CPU o un m√≥dulo de periferia,
obtiene una nueva versi√≥n de firmware. Si ha utilizado el m√≥dulo en el proyecto, el m√≥dulo ya
configurado se debe actualizar mediante un cambio de m√≥dulo offline con el m√≥dulo que
contiene la nueva versi√≥n del firmware, y despu√©s adaptar y cargar el programa y la
configuraci√≥n.

Diagnosticar la manipulaci√≥n de SIMATIC Memory Cards
Cuando una CPU no estado en funcionamiento temporalmente, no puede excluirse la
posibilidad de que la SIMATIC Memory Card haya sido manipulada. Es posible que el
programa no funcione igual que antes de la puesta fuera de servicio.
Las CPU S7-1500 con firmware 2.0 y superior tienen la capacidad de diagnosticar las
manipulaciones siguientes y de introducir los eventos como eventos de seguridad en el b√∫fer
de diagn√≥stico durante el arranque:
‚óè El proyecto de la SIMATIC Memory Card ha cambiado (la SIMATIC Memory Card es la
misma)
‚óè La SIMATIC Memory Card se ha cambiado por otra

Vida √∫til de las SIMATIC Memory Cards
La vida √∫til de las SIMATIC Memory Cards es limitada y depende, entre otras cosas, de los
siguientes factores:
‚óè Capacidad de la SIMATIC Memory Card
‚óè Frecuencia de escritura
‚óè Cantidad de datos que se escribe en la SIMATIC Memory Card.
Las operaciones de escritura o borrado, en especial procedimientos de escritura/borrado
c√≠clicos a trav√©s del programa de usuario en la SIMATIC Memory Card acortan su vida √∫til.
La ejecuci√≥n c√≠clica de las instrucciones "CREATE_DB" (con ATTRIB "Crear DB en la memoria
de carga"), "DataLogWrite", "RecipeExport", "RecipeImport" y el ajuste de la zona horaria
"SET_TIMEZONE" reducen la vida √∫til de la tarjeta de memoria en funci√≥n del n√∫mero de
operaciones de escritura y de los datos.
Adem√°s de las operaciones de escritura/borrado, tambi√©n la escritura o el borrado de una gran
cantidad de datos influye negativamente en la vida √∫til de la SIMATIC Memory Card.
Encontrar√° una descripci√≥n de c√≥mo estimar la vida √∫til de las SIMATIC Memory Cards de las
CPU S7-1500, CPU ET 200SP y CPU ET 200Pro en el siguiente art√≠culo:

998

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
SIMATIC S7-1500 Estructura y uso de la memoria de la CPU (https://
support.industry.siemens.com/cs/ww/es/view/59193101)
En cuanto a las CPU de S7-1200 encontrar√° informaci√≥n en el siguiente art√≠culo:
Sistema de automatizaci√≥n S7-1200 SIMATIC S7 (https://
support.industry.siemens.com/cs/ww/es/view/109478121)
Existe la posibilidad de parametrizar un porcentaje de vida √∫til en las propiedades de la CPU,
de modo que la CPU genere una alarma de diagn√≥stico y una entrada en el b√∫fer de
diagn√≥stico (evento de mantenimiento) una vez alcanzado el porcentaje parametrizado de la
vida √∫til. De ese modo resta suficiente tiempo para sustituir la SIMATIC Memory Card antes de
que quede inutilizada por alcanzar el n√∫mero m√°ximo de accesos de escritura.
Con la instrucci√≥n "GetSMCinfo" se lee informaci√≥n sobre la SIMATIC Memory Card insertada.
La informaci√≥n le√≠da se selecciona mediante el par√°metro "Mode", p. ej.:
‚óè Mode = 2: Porcentaje consumido hasta el momento de la vida √∫til
‚óè Mode = 3: Porcentaje parametrizado de vida √∫til tras cuyo transcurso la CPU registra un
evento de mantenimiento en el b√∫fer de diagn√≥stico y enciende el LED de mantenimiento.

Peticiones de forzado permanente en la SIMATIC Memory Card
Tenga en cuenta que cualquier petici√≥n de forzado permanente almacenada en la SIMATIC
Memory Card se ejecutar√° en cada CPU en la que se inserte esta SIMATIC Memory Card. Si
no desea que esto suceda, finalice la petici√≥n de forzado permanente antes de insertar la
SIMATIC Memory Card en otra CPU.

Consulte tambi√©n
Informaci√≥n importante sobre avisos de grupo en caso de eventos de seguridad (P√°gina 1073)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

999

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Åreas de memoria de la CPU
√Åreas de memoria de la CPU S7-1500
La figura siguiente muestra las √°reas de memoria de la CPU y la memoria de carga de la
SIMATIC Memory Card. Adem√°s de en la memoria de carga, en la SIMATIC Memory Card se
pueden encontrar otros datos como, p. ej., recetas, Data Logs o backups de HMI.

0HPRULDGHWUDEDMRSDUDF¬µGLJR
‡≤µ%ORTXHVO¬µJLFRV )&)%2%

0HPRULDGHWUDEDMRSDUDGDWRV
‡≤µ%ORTXHVGHGDWRVJOREDOHV
‡≤µ%ORTXHVGHGDWRVGHLQVWDQFLD
‡≤µ2EMHWRVWHFQRO¬µJLFRV

0HPRULDGHFDUJD

HQ6,0$7,&0HPRU\&DUG

‡≤µ%ORTXHVO¬µJLFRV )&)%2%
‡≤µ%ORTXHVGHGDWRV '%
‡≤µ&RQILJXUDFL¬µQGHKDUGZDUH

0HPRULDUHPDQHQWH

3DUWHVGH
‡≤µ%ORTXHVGHGDWRVJOREDOHV
‡≤µ%ORTXHVGHGDWRVGHLQVWDQFLD
‡≤µ2EMHWRVWHFQRO¬µJLFRV
‡≤µ0DUFDVWHPSRUL]DGRUHVFRQWDGRUHV

2WUDV¬£UHDVGHPHPRULD
‡≤µ0DUFDVWHPSRUL]DGRUHVFRQWDGRUHV
‡≤µ'DWRVORFDOHVWHPSRUDOHV
‡≤µ0HPRULDVLPDJHQGHSURFHVR (6

Memoria de carga
La memoria de carga es una memoria no vol√°til que contiene el c√≥digo del programa, los
bloques de datos y la configuraci√≥n del hardware. Al cargar estos objetos en la CPU, primero
se guardan en la memoria de carga. Esta memoria se encuentra en la SIMATIC Memory Card.
Para el funcionamiento de la CPU es imprescindible insertar una SIMATIC Memory Card.

Memoria de trabajo
La memoria de trabajo es una memoria vol√°til que contiene los bloques l√≥gicos y de datos. La
memoria de trabajo est√° integrada en la CPU y no se puede ampliar.

1000

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La memoria de trabajo de S7-1500 se divide en dos √°reas:
‚óè Memoria de trabajo de c√≥digo para partes relevantes para la ejecuci√≥n del c√≥digo del
programa.
‚óè Memoria de trabajo de datos para partes relevantes para la ejecuci√≥n de bloques de datos
y objetos tecnol√≥gicos. En las transiciones del estado operativo POWER ON ‚Üí Arranque y
STOP ‚Üí Arranque se inicializan variables de bloques de datos globales, bloques de datos
de instancia y objetos tecnol√≥gicos con sus valores de arranque. Las variables remanentes
obtienen sus valores actuales guardados en la memoria remanente.

Memoria remanente
La memoria remanente es una memoria no vol√°til que sirve para guardar copia de una cantidad
limitada de datos en caso de un fallo de alimentaci√≥n. En la memoria remanente se guardan
las variables definidas como remanentes y tambi√©n √°reas de operandos.
Dichos datos se conservan incluso despu√©s de una desconexi√≥n o un fallo de tensi√≥n. Todas
las variables restantes se pierden, y se restablecen sus valores de arranque en las transiciones
del estado operativo de Arranque a POWER ON y de Arranque a STOP.
El contenido de la memoria remanente se borra con las siguientes acciones:
‚óè Borrado total
‚óè Restablecimiento de la configuraci√≥n de f√°brica
En la memoria remanente se guardan tambi√©n determinadas variables de los objetos
tecnol√≥gicos. Estas no se borran con el borrado total.

Otras √°reas de memoria
Adem√°s de las √°reas de memoria descritas para el programa de usuario y los datos, la CPU
dispone de otras √°reas de memoria.
Entre estas √°reas cabe mencionar las siguientes √°reas relevantes para la ejecuci√≥n:
‚óè Marcas, temporizadores, contadores
‚óè Datos locales temporales
‚óè Memorias imagen de proceso
La capacidad de las distintas √°reas espec√≠ficas de la CPU se indica en los datos t√©cnicos de
la CPU.

Informaci√≥n sobre √°reas de memoria
La informaci√≥n sobre las √°reas de memoria de su S7-1500 CPU se puede consultar offline y
online.
Offline:
al crear o modificar un programa puede determinar si este ser√° demasiado grande para una
CPU concreta. La informaci√≥n se encuentra, p. ej., en "Informaci√≥n del programa" del √°rbol del
proyecto. La ficha "Carga de la memoria" ofrece informaci√≥n sobre la capacidad total de las
√°reas de memoria y sobre el espacio que ya est√° ocupado. En este punto tambi√©n encontrar√°
informaci√≥n acerca de las entradas y salidas ocupadas.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1001

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En la S7-1500 puede determinar la capacidad total de la memoria de carga (informaci√≥n del
programa; el campo Memoria de carga - Total es una lista desplegable para seleccionar la
capacidad de la memoria de carga).
Online:
Inicie "Online y diagn√≥stico" en el √°rbol del proyecto. La funci√≥n "Memoria" ofrece informaci√≥n
sobre el espacio lleno de todas las memorias de las CPU.
Encontrar√° m√°s informaci√≥n sobre la carga de la memoria de la CPU utilizada en las fichas
"Plano de ocupaci√≥n" y "Estructura de llamadas" de la informaci√≥n del programa, as√≠ como en
la tabla de variables PLC.

Consulte tambi√©n
Mostrar el nivel de llenado de todos los tipos de memoria de una CPU (P√°gina 3622)

√Åreas de memoria remanentes
Introducci√≥n
Las CPUs S7-1500 incorporan una memoria remanente para almacenar datos remanentes en
POWER OFF. La capacidad de la memoria remanente est√° documentada en los datos
t√©cnicos de la CPU.
La carga de la memoria remanente de la CPU configurada se puede consultar offline en
"Informaci√≥n del programa > Carga de la memoria" del √°rbol del proyecto y online en "Online
y diagn√≥stico > Diagn√≥stico > Memoria" del √°rbol del proyecto.
Si define los datos como remanentes, su contenido se conserva tras un fallo de la alimentaci√≥n,
al arrancar la CPU y al cargar un programa modificado.
Los siguientes datos u objetos pueden definirse como remanentes:
‚óè Marcas, temporizadores, contadores
‚óè Variables de bloques de datos globales
‚óè Variables de bloques de datos de instancia de un bloque de funci√≥n
Determinadas variables de los objetos tecnol√≥gicos son siempre remanentes como, p. ej.,
valores de ajuste de enc√≥ders absolutos.

Marcas, temporizadores, contadores
El n√∫mero de marcas, temporizadores y contadores remanentes se puede definir en la tabla de
variables PLC a trav√©s del bot√≥n "Remanencia".

1002

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Variables de un bloque de datos global
En un bloque de datos global se pueden definir como remanentes algunas o todas las variables
del bloque en funci√≥n del ajuste del acceso:
‚óè Acceso optimizado al bloque activado: La remanencia se puede ajustar para cada variable
individual.
‚óè Acceso optimizado al bloque desactivado: el ajuste de remanencia es v√°lido para todas las
variables del bloque de datos, es decir, o todas las variables son remanentes o no lo es
ninguna.

Variables de un bloque de datos de instancia (bloque de funci√≥n)
Las variables del bloque de datos de instancia de un bloque de funci√≥n se pueden definir como
remanentes. En funci√≥n del acceso al bloque de datos de instancia, la remanencia puede
definirse para variables individuales o conjuntamente para todas las variables del bloque:
‚óè Acceso optimizado al bloque activado: puede definir variables individuales como
remanentes tanto en la interfaz del bloque de funci√≥n como tambi√©n en el bloque de datos
de instancia asignado.
‚óè Acceso optimizado al bloque desactivado: puede definir conjuntamente la remanencia para
todas las variables en el bloque de datos de instancia.

Generaci√≥n de un bloque de datos en el programa de usuario
Con la instrucci√≥n "Create_DB" se puede crear un bloque de datos. En funci√≥n de la selecci√≥n
del par√°metro ATTRIB, el bloque de datos generado tiene la propiedad "remanente" o "no
remanente". Aqu√≠ no se permite ajustar la remanencia para variables individuales.

Variables de objetos tecnol√≥gicos
Determinadas variables de los objetos tecnol√≥gicos son siempre remanentes como, p. ej.,
valores de ajuste de enc√≥ders absolutos. STEP 7 administra autom√°ticamente la remanencia
de objetos tecnol√≥gicos, de manera que no haga falta configurar ninguna remanencia. Estas
variables est√°n protegidas contra un borrado total y s√≥lo pueden borrarse restableciendo la
configuraci√≥n de f√°brica.

Sugerencia: detectar la p√©rdida de remanencia en el OB de arranque y en OB de ciclo
En el caso siguiente, todas las variables (marcas, temporizadores, contadores y contenidos de
DB) de un programa de usuario pierden su remanencia:
1. Cuando se inserta la SIMATIC Memory Card con proyecto (programa de usuario) en el
lector de tarjetas de la programadora.
2. Cuando se modifica el tama√±o de bloques de datos en el proyecto correspondiente o se
agregan bloques de datos con variables remanentes.
3. Cuando se transfiere de nuevo el proyecto modificado a la SIMATIC Memory Card en el
lector de tarjetas.
4. Cuando se arranca la CPU con el proyecto modificado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1003

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Debido al cambio offline, todas las variables (marcas, temporizadores, contadores y
contenidos de DB) pierden su remanencia. Despu√©s de la transici√≥n STOP-RUN, las variables
presentan sus valores de arranque.
Para reaccionar a una p√©rdida de remanencia en el programa de usuario, eval√∫e las siguientes
variables locales de la informaci√≥n de arranque:
‚óè OB de arranque: LostRetentive (verdadero en caso de p√©rdida de remanencia)
‚óè OB de ciclo: Remanence (verdadero si hay datos remanentes disponibles)

Consulte tambi√©n
Uso del √°rea de datos remanente ampliada con PS 60W 24/48/60VDC HF (P√°gina 1249)

Resumen del comportamiento remanente
Comportamiento remanente de los objetos de memoria
Adem√°s de las √°reas de memoria que se han descrito existen otros objetos con
comportamiento remanente, p. ej., el b√∫fer de diagn√≥stico. Estos objetos no ocupan memoria
remanente.
La tabla siguiente explica el comportamiento remanente de los objetos de memoria
‚óè en las transiciones de estado operativo STOP ‚Üí Arranque y POWER OFF ‚Üí Arranque
‚óè en las funciones Borrado total y Restablecer configuraci√≥n de f√°brica, que afectan a la
memoria
Tabla 1-85

Comportamiento remanente de los objetos de memoria ("x" = se conserva el contenido; "-" = se inicializa el
contenido)

Objeto de memoria

Transiciones de estado operativo
STOP ‚Üí ARRAN‚Äê
QUE

Borrado total

Restablecimiento
de la configuraci√≥n
de f√°brica

POWER OFF ‚Üí
ARRANQUE

Valores actuales de los bloques de
datos, bloques de datos de instancia

Ajustable en las propiedades del DB.

-

-

Marcas, temporizadores y contado‚Äê
res, configurables como remanentes

x

x

-

-

Marcas, temporizadores y contado‚Äê
res, configurables como no remanen‚Äê
tes

-

-

-

x

-

Determinadas variables remanentes
de objetos tecnol√≥gicos
(p. ej. valores de ajuste de enc√≥ders
absolutos)

x

Entradas del b√∫fer de diagn√≥stico
(√°rea remanente)

x

x

x

-

Entradas del b√∫fer de diagn√≥stico
(√°rea no remanente)

x

-

-

-

1004

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Objeto de memoria

Transiciones de estado operativo
STOP ‚Üí ARRAN‚Äê
QUE

Borrado total

POWER OFF ‚Üí
ARRANQUE

Restablecimiento
de la configuraci√≥n
de f√°brica

Contador de horas de funcionamiento x

x

x

-

Hora

x

x

-

x

B√∫fer de diagn√≥stico
En las CPUs S7-1500, una parte del b√∫fer de diagn√≥stico es remanente. Las entradas m√°s
actuales del b√∫fer de diagn√≥stico se conservan tras un fallo de la alimentaci√≥n y est√°n
protegidas contra un borrado total. La parte remanente del b√∫fer de diagn√≥stico solo puede
borrarse restableciendo la configuraci√≥n de f√°brica. El n√∫mero de las entradas remanentes del
b√∫fer de diagn√≥stico depende de la CPU. Las entradas contenidas en el b√∫fer de diagn√≥stico
no requieren ninguna memoria remanente.

Contador de horas de funcionamiento
El contador de horas de funcionamiento de las CPUs S7-1500 es remanente y est√° protegido
contra un borrado total. Restableciendo la configuraci√≥n de f√°brica se pone a cero.

Hora
La hora de las CPUs S7-1500 es remanente y est√° protegida contra un borrado total.
Restableciendo la configuraci√≥n de f√°brica se pone la hora a 01.01.2012 00:00:00.

Comportamiento de memorizaci√≥n al cargar modificaciones de software
Introducci√≥n
La CPU S7-1500 ofrece la posibilidad de cargar modificaciones de software en STOP y en
RUN de la CPU sin que la carga afecte a los valores actuales de las variables ya cargadas.
Cargue en STEP 7 las modificaciones del software en "Cargar en dispositivo > Software (s√≥lo
cambios)".

Efectos de las modificaciones de software en variables PLC
Puede cargar las siguientes modificaciones de software sin que se vean afectados los valores
actuales de las variables ya cargadas:
‚óè Modificaci√≥n de nombres
‚óè Modificaci√≥n de comentarios
‚óè Ampliaci√≥n con nuevas variables
‚óè Borrado de variables
‚óè Modificaci√≥n de los ajustes de remanencia para marcas, temporizadores y contadores.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1005

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Al cargar las siguientes modificaciones de software, se ven afectados los valores actuales:
‚óè Modificaci√≥n de tipos de datos
‚óè Modificaci√≥n de direcciones

Efectos de modificaciones de software en bloques de datos con reserva de memoria
Si utiliza la reserva de memoria para bloques de datos (atributo "Acceso optimizado al bloque"
y bot√≥n "Cargar sin reinicializar" activado), puede cargar las siguientes modificaciones de
software sin que se reinicialicen los valores actuales de variables ya cargadas:
‚óè Modificaci√≥n de valores de arranque
‚óè Modificaci√≥n de comentarios
‚óè Ampliaci√≥n con nuevas variables
Para cargar las siguientes modificaciones de software, desactive el bot√≥n "Cargar sin
reinicializar". En la siguiente carga se reinicializan todos los valores actuales del bloque de
datos:
‚óè Modificaci√≥n de nombres
‚óè Modificaci√≥n de tipos de datos
‚óè Modificaci√≥n de ajustes de remanencia
‚óè Borrado de variables
‚óè Modificaci√≥n de ajustes de la reserva de memoria

Efectos de modificaciones de software en bloques de datos sin reserva de memoria
Si no utiliza reserva de memoria, puede cargar las siguientes modificaciones de software sin
que se reinicialicen los valores actuales de variables ya cargadas:
‚óè Modificaci√≥n de valores de arranque
‚óè Modificaci√≥n de comentarios
Al cargar las siguientes modificaciones de software, se reinicializan todos los valores actuales
del bloque de datos:
‚óè Modificaci√≥n del nombre
‚óè Modificaci√≥n de tipos de datos
‚óè Modificaci√≥n de ajustes de remanencia
‚óè Ampliaci√≥n con nuevas variables
‚óè Borrado de variables

1006

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reserva de memoria de bloques de datos
Cada bloque de funci√≥n o de datos con el atributo "Acceso optimizado al bloque" activado
contiene por ajuste predeterminado una reserva de memoria que puede utilizarse para
posteriores modificaciones de interfaz. La reserva de memoria no se utiliza inicialmente. Si
despu√©s de compilar y cargar el bloque comprueba que quiere recargar modificaciones de la
interfaz, debe activar la reserva de memoria. Todas las variables que declare posteriormente
se colocan en la reserva de memoria. Al realizar la carga, las nuevas variables se inicializan
con sus valores de arranque, mientras que las variables que ya se han cargado no se
reinicializan.
El ajuste de la reserva de memoria se encuentra en "Cargar sin reinicializar" de las
propiedades del bloque de datos.

Memoria requerida al cargar modificaciones de software en RUN
Para el desarrollo coherente y at√≥mico de todo el proceso de carga, la CPU necesita espacio
suficiente en la SIMATIC Memory Card. Los archivos que se ven afectados por la carga de
cambios de software en la CPU no se borran hasta que se han creado los archivos nuevos. Por
este motivo, la SIMATIC Memory Card necesita tener libre el espacio correspondiente a la
memoria requerida por todos los objetos del programa.
Encontrar√° informaci√≥n y consejos para manejar cambios de software en el manual
"Estructura y utilizaci√≥n de la memoria de la CPU".

√Åreas de datos de periferia
Acceso a las direcciones de periferia
Direcciones de periferia
Cuando se inserta un m√≥dulo en la vista de dispositivos, sus datos de usuario se encuentran
de forma est√°ndar en la memoria imagen de proceso de la CPU S7-1500. La CPU acepta
autom√°ticamente el intercambio de datos entre el m√≥dulo y el √°rea de memoria imagen de
proceso al actualizarse esta √∫ltima.
Si el programa debe acceder al m√≥dulo directamente y no a trav√©s de la memoria imagen de
proceso, la direcci√≥n de periferia se debe completar con ":P".

En cualquier caso, el acceso directo a la periferia no ofrece un mejor rendimiento de las CPUs
S7-1500, por lo que normalmente deber√° direccionar la periferia a trav√©s de memorias imagen
de proceso o memorias imagen parciales de proceso.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1007

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Direcci√≥n inicial de un m√≥dulo
Definici√≥n
La direcci√≥n inicial es la direcci√≥n de byte m√°s baja de un m√≥dulo. Representa la direcci√≥n
inicial del √°rea de datos de usuario del m√≥dulo.

Configurar las direcciones iniciales de los m√≥dulos
La asignaci√≥n entre las direcciones utilizadas en el programa de usuario y los m√≥dulos se
realiza mediante configuraci√≥n de los m√≥dulos.
Las direcciones iniciales asignadas autom√°ticamente al colocar los m√≥dulos se modifican en
las propiedades del m√≥dulo (√°rea "Direcciones E/S...").
Tambi√©n existe la posibilidad de ajustar si las direcciones estar√°n en la memoria imagen de
proceso o en qu√© memoria imagen parcial de proceso.
Adem√°s de la memoria imagen parcial de proceso, puede seleccionar tambi√©n el bloque de
organizaci√≥n al que est√° asignada la memoria imagen parcial de proceso. A excepci√≥n de los
OB de alarma de sincronismo, al llamar al OB asignado se actualiza la memoria imagen parcial
de proceso correspondiente. Inmediatamente antes del arranque de OB se actualiza la
memoria imagen parcial de proceso de las entradas, e inmediatamente despu√©s de finalizar el
OB se transfiere la memoria imagen parcial de proceso de las salidas a los m√≥dulos.
Seleccione la memoria imagen de proceso "Actualizaci√≥n autom√°tica" si la memoria imagen de
proceso en la que se encuentran las direcciones del m√≥dulo debe actualizarse
autom√°ticamente en el punto de control del ciclo.

Evaluaci√≥n del estado de valor
Introducci√≥n
La informaci√≥n de calidad (QI, Quality Information) aporta informaci√≥n de diagn√≥stico sobre los
canales de la periferia que se ponen a disposici√≥n del programa de usuario a trav√©s de la
memoria imagen de proceso de las entradas (IPE). La informaci√≥n de calidad se transfiere de
manera s√≠ncrona con los datos de usuario.
Cada bit de la informaci√≥n de calidad est√° asignado a un canal y proporciona informaci√≥n sobre
la validez del valor (0 = el valor es err√≥neo).
Por ejemplo, si existe una rotura de hilo en una entrada digital, la se√±al de los datos de usuario
es l√≥gicamente "0". Debido al diagn√≥stico de rotura de hilo, el m√≥dulo pone el bit
correspondiente tambi√©n a 0 en la informaci√≥n de calidad, lo que significa que existe la
posibilidad de determinar que el valor no es v√°lido consultando la informaci√≥n de calidad.
La asignaci√≥n de los bytes de la informaci√≥n de calidad en la memoria imagen de proceso de
las entradas depende del m√≥dulo utilizado. Encontrar√° informaci√≥n detallada en el manual de
producto del respectivo m√≥dulo de periferia.
Resumen: causas posibles de una informaci√≥n de calidad = 0:
‚óè La tensi√≥n de alimentaci√≥n L+ en los bornes falta o no es suficiente
‚óè Se ha desactivado un canal

1008

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Las salidas est√°n inactivas (p. ej. CPU en STOP)
‚óè Un canal de salida utiliza funciones tecnol√≥gicas (HSC, PWM o PTO), v√©ase a continuaci√≥n

Activar la informaci√≥n de calidad
Active la casilla de verificaci√≥n "Informaci√≥n de calidad" en las propiedades del m√≥dulo de
periferia si desea evaluar la informaci√≥n de calidad del canal. Activando la informaci√≥n de
calidad se reservan direcciones adicionales en la memoria imagen de proceso de las entradas
(IPE) para la informaci√≥n de calidad. En los m√≥dulos de entrada, STEP 7 reserva direcciones
de entrada a continuaci√≥n de los datos de usuario, mientras que en los m√≥dulos de salida se
reservan las siguientes direcciones de entrada libres.

Particularidades de los m√≥dulos con MSI/MSO
Requisitos:
‚óè Archivo GSD para m√≥dulos de periferia con MSI/MSO
‚óè El dispositivo IO soporta MSI/MSO (p. ej. IM 155-5 PN ST a partir de la versi√≥n de firmware
V2.0.0)
En los m√≥dulos aptos para diagn√≥stico para los que se ha configurado Shared Input interna del
m√≥dulo (MSI) o Shared Output interna del m√≥dulo (MSO), la informaci√≥n de calidad tiene el
significado siguiente:
MSI:
En el subm√≥dulo 1 (= subm√≥dulo base), la informaci√≥n de calidad 0 indica que el valor es
err√≥neo.
En los subm√≥dulos 2 a 4 (= subm√≥dulo MSI), la informaci√≥n de calidad 0 indica que el valor es
err√≥neo o que el subm√≥dulo base todav√≠a no est√° parametrizado (no listo para funcionar).
MSO:
En el subm√≥dulo 1 (= subm√≥dulo base), la informaci√≥n de calidad 1 indica que el valor de salida
especificado por el programa de usuario es realmente el que se obtiene en el borne del
m√≥dulo.
Causas posibles para una informaci√≥n de calidad = 0:
‚óè El valor es err√≥neo porque falta tensi√≥n de alimentaci√≥n, por ejemplo.
‚óè El controlador IO del subm√≥dulo base est√° en estado STOP.
En los subm√≥dulos 2 a 4 (= subm√≥dulos MSO), la informaci√≥n de calidad 1 indica que el valor
de salida especificado por el programa de usuario es realmente el que se obtiene en el borne
del m√≥dulo.
Causas posibles para una informaci√≥n de calidad = 0:
‚óè El valor es err√≥neo porque falta tensi√≥n de alimentaci√≥n, por ejemplo.
‚óè El controlador IO del subm√≥dulo base est√° en estado STOP.
‚óè El subm√≥dulo base todav√≠a no est√° configurado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1009

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comportamiento de la informaci√≥n de calidad en canales de salida para funciones tecnol√≥gicas de CPU
compactas, como por ejemplo CPU 1511C-1 PN
La CPU 1511C-1 PN soporta la informaci√≥n de calidad (QI) para los canales de la periferia
anal√≥gica y digital integrada.
No se soporta la informaci√≥n de calidad de los canales de salida utilizados para las funciones
tecnol√≥gicas (HSC, PWM o PTO).
Por ese motivo los bits QI en los canales de salida para funciones tecnol√≥gicas siempre
devuelven la informaci√≥n de calidad 0 ("Bad"). Es irrelevante si el valor de salida es err√≥neo o
no.

Consulte tambi√©n
OBs de ciclo (P√°gina 1097)
Ejemplo de evaluaci√≥n del estado de valor (P√°gina 1010)
Diagn√≥stico del sistema (http://support.automation.siemens.com/WW/view/es/68052815)
Shared Input/Shared Output interna del m√≥dulo (MSI/MSO) (http://
support.automation.siemens.com/WW/view/es/68052815)

Ejemplo de evaluaci√≥n del estado de valor
El m√≥dulo DI 32x24VDC HF de S7-1500 puede configurarse en STEP 7 (vista de dispositivos)
para diferentes √°mbitos de aplicaci√≥n. En funci√≥n de la configuraci√≥n se asignan direcciones
adicionales/diferentes en la memoria imagen de proceso de las entradas.
En este ejemplo se muestran diferentes configuraciones con la respectiva informaci√≥n de
calidad parametrizada y se describen las repercusiones en la asignaci√≥n de direcciones.

Opciones de configuraci√≥n de DI 32x24VDC HF
Son posibles las configuraciones siguientes:
‚óè 1 x 32 canales sin informaci√≥n de calidad
‚óè 1 x 32 canales con informaci√≥n de calidad
‚óè 4 x 8 canales sin informaci√≥n de calidad
‚óè 4 x 8 canales con informaci√≥n de calidad
‚óè 1 x 32 canales con informaci√≥n de calidad para Shared Input interna del m√≥dulo (MSI) con
hasta 4 subm√≥dulos
En las configuraciones con informaci√≥n de calidad, cada canal tiene asignado un bit adicional
para la informaci√≥n de calidad. El bit de informaci√≥n de calidad indica si el valor digital le√≠do es
v√°lido. (0 = el valor es err√≥neo).

1010

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Årea de direcciones en la configuraci√≥n como DI 32x24VDC HF de 32 canales con informaci√≥n de
calidad
Al principio se conserva la configuraci√≥n DI predeterminada (32 canales; ni divisi√≥n en
subm√≥dulos ni configuraci√≥n de Shared Input interna del m√≥dulo (MSI)), pero debe activarse
la informaci√≥n de calidad.
‚óè Active la casilla de verificaci√≥n "Habilitar informaci√≥n de calidad" en el √°rea "Configuraci√≥n
DI" de las propiedades del m√≥dulo (ventana de inspecci√≥n).
La siguiente figura muestra la asignaci√≥n del √°rea de direcciones en la configuraci√≥n como
m√≥dulo de 32 canales con informaci√≥n de calidad. La direcci√≥n inicial del m√≥dulo puede
asignarse libremente. Las direcciones de los canales se derivan de dicha direcci√≥n inicial.
Ejemplo: direcci√≥n inicial 2 (byte de entrada 2), direcci√≥n final 9 (byte de entrada 9).
STEP 7 reserva autom√°ticamente las direcciones para los valores de entrada (4 bytes) y las
direcciones siguientes para la informaci√≥n de calidad (tambi√©n 4 bytes), con lo que se obtiene
la siguiente asignaci√≥n de direcciones:
$VLJQDFL¬µQHQODPHPRULDLPDJHQGHSURFHVRGHODVHQWUDGDV ,3(
       
(%
(%
(%













9DORUGHHQWUDGD
&DQDOHVD HQWUDGDV&+D&+
&DQDOHVD HQWUDGDV&+D&+
&DQDOHVD HQWUDGDV&+D&+
&DQDOHVD HQWUDGDV&+D&+

(%

4,
       
(%
(%
(%













(VWDGRGHYDORU

&DQDOHVD HVWDGRVGHYDORU4,D4,
&DQDOHVD HVWDGRVGHYDORU4,D4,

(%

&DQDOHVD HVWDGRVGHYDORU4,D4,
&DQDOHVD HVWDGRVGHYDORU4,D4,

4, HOYDORUOH¬ØGRHQHOFDQDOHVHUU¬µQHR

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1011

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Årea de direcciones en la configuraci√≥n como DI 32x24VDC HF de 4 x 8 canales con informaci√≥n de
calidad
La configuraci√≥n DI debe adaptarse de manera que los 32 canales del m√≥dulo DI 32x24VDC
HF del S7-1500 puedan dividirse en cuatro subm√≥dulos de 8 canales cada uno. Estos
subm√≥dulos pueden asignarse a diferentes controladores IO si el m√≥dulo se utiliza en un
Shared Device. En ese caso, la informaci√≥n de calidad tambi√©n debe estar activada.
‚óè Seleccione la configuraci√≥n de subm√≥dulo "4 subm√≥dulos con 8 entradas digitales" en el
√°rea "Configuraci√≥n DI" de las propiedades del m√≥dulo (ventana de inspecci√≥n).
‚óè Active la casilla de verificaci√≥n "Habilitar informaci√≥n de calidad".
En la navegaci√≥n local de la ventana de inspecci√≥n aparecen los 4 subm√≥dulos con nombres
propios (p. ej. DI 32x24VDC BA_1)
A diferencia de la configuraci√≥n como m√≥dulo de 1 x 32 canales, cada uno de los cuatro
subm√≥dulos posee una direcci√≥n inicial que se puede asignar libremente.
Ejemplo: las direcciones iniciales se asignan del modo siguiente:
‚óè 1. subm√≥dulo: 10
‚óè 2. subm√≥dulo: 20
‚óè 3. subm√≥dulo: 30
‚óè 4. subm√≥dulo: 40
STEP 7 reserva autom√°ticamente un byte para la informaci√≥n de calidad de cada subm√≥dulo.
El byte para la informaci√≥n de calidad tiene la direcci√≥n "Direcci√≥n inicial + 1", con lo que se
obtiene la siguiente asignaci√≥n de direcciones:
$VLJQDFL¬µQHQODPHPRULDLPDJHQGHSURFHVRGHODVHQWUDGDV ,3(
       
(%
(%
(%













       
(%

(%
(%

&DQDOHVD HQWUDGDV&+D&+
&DQDOHVD HQWUDGDV&+D&+

(%

(%

9DORUGHHQWUDGD











|VXEP¬µGXOR

&DQDOHVD HQWUDGDV&+D&+

HUVXEP¬µGXOR

&DQDOHVD HQWUDGDV&+D&+

|VXEP¬µGXOR

4, (VWDGRGHYDORU
&DQDOHVD HVWDGRVGHYDORU4,D4,



HUVXEP¬µGXOR

&DQDOHVD HVWDGRVGHYDORU4,D4,

HUVXEP¬µGXOR
|VXEP¬µGXOR

&DQDOHVD HVWDGRVGHYDORU4,D4,

HUVXEP¬µGXOR

&DQDOHVD HVWDGRVGHYDORU4,D4,

|VXEP¬µGXOR

4, HOYDORUOH¬ØGRHQHOFDQDOHVHUU¬µQHR

1012

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Årea de direcciones en la configuraci√≥n como DI 32x24VDC HF de 1 x 32 canales con MSI y informaci√≥n
de calidad
La configuraci√≥n mostrada utiliza la funci√≥n "Shared Input interna del m√≥dulo (MSI)". Esta
funci√≥n permite la lectura simult√°nea de los valores de entrada por distintos controladores IO
(CPU) si el m√≥dulo se utiliza en un Shared Device (ET 200MP).
En la configuraci√≥n del m√≥dulo de 1 x 32 canales con Shared Input interna del m√≥dulo (MSI),
los canales 0 a 31 del m√≥dulo se copian en hasta 4 subm√≥dulos. Por lo tanto, los canales 0 a
31 tienen valores de entrada id√©nticos en los distintos subm√≥dulos. Estos subm√≥dulos pueden
asignarse a hasta cuatro controladores IO si el m√≥dulo se utiliza en un Shared Device. Cada
controlador IO puede tener acceso de lectura a los mismos canales ("escucha").
El n√∫mero de subm√≥dulos disponibles (= copias de las entradas) depende del m√≥dulo de
interfaz utilizado. Lea las indicaciones respectivas del manual de producto que corresponda al
m√≥dulo de interfaz.
‚óè Active en el √°rea "Configuraci√≥n DI" de las propiedades del m√≥dulo (ventana de inspecci√≥n)
las siguientes opciones:
‚Äì En "Divisi√≥n del m√≥dulo": ninguna
‚Äì En "Copias del m√≥dulo": una copia adicional de las entradas
Este ajuste provoca que un controlador IO adicional pueda leer las entradas del m√≥dulo.
La informaci√≥n de calidad est√° habilitada autom√°ticamente en configuraciones MSI (no
modificable). El motivo de este ajuste es que un controlador IO "que escucha" del Shared
Device puede determinar mediante la informaci√≥n de calidad si el m√≥dulo ya est√° operativo y
ofrece valores v√°lidos.
En lo sucesivo, los subm√≥dulos que surgen de los ajustes descritos anteriormente reciben los
siguientes nombres:
‚óè Subm√≥dulo base: se trata del subm√≥dulo que se asigna al controlador IO que realiza la
parametrizaci√≥n. Solo el controlador IO que realiza la parametrizaci√≥n tiene acceso a
diagn√≥sticos del m√≥dulo y recibe alarmas de proceso.
‚óè Subm√≥dulo MSI: se trata del subm√≥dulo asignado a un controlador IO "que escucha". El
controlador IO que escucha no tiene acceso a diagn√≥sticos del m√≥dulo y √∫nicamente recibe
informaci√≥n sobre la validez de los valores de entrada por medio de la informaci√≥n de
calidad.
Informaci√≥n de calidad (Quality Information, QI)
El significado de la informaci√≥n de calidad depende del subm√≥dulo en cuesti√≥n.
En el subm√≥dulo 1 (= subm√≥dulo base), la informaci√≥n de calidad 0 indica que el valor es
err√≥neo.
En los subm√≥dulos 2 a 4 (= subm√≥dulos MSI o copia de las entradas), la informaci√≥n de calidad
0 indica que el valor es err√≥neo o que el subm√≥dulo base todav√≠a no est√° parametrizado (no
operativo).
Ejemplo: el m√≥dulo DI 32x24VDC HF est√° configurado como se ha descrito anteriormente (una
copia adicional de las entradas). Se obtienen un subm√≥dulo base y un subm√≥dulo MSI.
En este ejemplo, el subm√≥dulo base recibe la direcci√≥n inicial 10; el subm√≥dulo MSI, la
direcci√≥n inicial 100. La direcci√≥n del subm√≥dulo MSI no es relevante para el controlador IO,
pues en el transcurso de la configuraci√≥n del Shared Device este subm√≥dulo se asignar√° a otro

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1013

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
controlador IO y, por lo tanto, desaparecer√° del √°rea de direcciones del controlador IO que
realiza la parametrizaci√≥n.
La siguiente figura muestra la asignaci√≥n del √°rea de direcciones con los subm√≥dulos 1 y 2 y
la informaci√≥n de calidad. Al principio, todos los subm√≥dulos est√°n asignados al controlador IO.
$VLJQDFL¬µQHQODPHPRULDLPDJHQGHSURFHVRGHODVHQWUDGDV ,3( SDUDORVVXEP¬µGXORV\
       
(%
(%
(%
(%
(%

&DQDOHVD HQWUDGDV&+D&+












       


(%









(%

(%
(%

(%











       

&DQDOHVD HVWDGRVGHYDORU4,D4,

&DQDOHVD HVWDGRVGHYDORU4,D4,
&DQDOHVD HVWDGRVGHYDORU4,D4,

9DORUGHHQWUDGD|VXEP¬µGXOR VXEP¬µGXOR06, 

&DQDOHVD HQWUDGDV&+D&+
&DQDOHVD HQWUDGDV&+D&+
&DQDOHVD HQWUDGDV&+D&+

&DQDOHVD HVWDGRVGHYDORU4,D4,



(%

(%

&DQDOHVD HQWUDGDV&+D&+

&DQDOHVD HQWUDGDV&+D&+




(%

&DQDOHVD HQWUDGDV&+D&+

&DQDOHVD HVWDGRVGHYDORU4,D4,

       

(%

&DQDOHVD HQWUDGDV&+D&+



(%
(%

9DORUGHHQWUDGDHUVXEP¬µGXOR VXEP¬µGXOREDVH 

&DQDOHVD HVWDGRVGHYDORU4,D4,








&DQDOHVD HVWDGRVGHYDORU4,D4,
&DQDOHVD HVWDGRVGHYDORU4,D4,

4, HOYDORUOH¬ØGRHQHOFDQDOHVHUU¬µQHR VXEP¬µGXOREDVH RELHQHOP¬µGXORWRGDY¬ØDQRHVW¬£RSHUDWLYR
VXEP¬µGXOR06,

Informaci√≥n adicional
Encontrar√° informaci√≥n adicional y un ejemplo de programaci√≥n para evaluar la informaci√≥n de
calidad aqu√≠ (http://support.automation.siemens.com/WW/view/es/59192926).

1014

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Evaluaci√≥n del estado de valor (P√°gina 1008)

Principios b√°sicos del procesamiento del programa
Denominaciones inglesas de los tipos de OB
Denominaci√≥n inglesa de los tipos de OB
Al crear un OB en el cuadro de di√°logo "Agregar nuevo bloque", por motivos t√©cnicos los tipos
de OB solo pueden indicarse en ingl√©s, con independencia del idioma ajustado para la interfaz
de usuario. Para facilitar su manejo, en la tabla siguiente se muestran junto a los t√©rminos
ingleses las denominaciones en el idioma ajustado para la interfaz de usuario.
Denominaci√≥n inglesa del tipo de OB en el cuadro de di√°logo
"Agregar nuevo bloque".

Denominaci√≥n en el sistema de informaci√≥n

Program cycle

OB de ciclo, OB de ejecuci√≥n c√≠clica del programa, programa
c√≠clico

Startup

OB de arranque

Time delay interrupt

OB de alarma de retardo

Cyclic interrupt

OB de alarma c√≠clica

Hardware interrupt

OB de alarma de proceso

Time error interrupt

OB de error de tiempo

Diagnostic error interrupt

OB de alarma de diagn√≥stico

Pull or plug of modules

OB de enchufe/desenchufe

Rack or station failure

OB de fallo del rack

Programming error

OB de error de programaci√≥n

IO access error

OB de error de acceso a la periferia

Time of day

OB de alarma horaria

CPU redundancy error

OB de error de redundancia de CPU

MC-Interpolator

OB MC-Interpolator

MC-Servo

OB MC-Servo

MC-PreServo

OB MC-PreServo

MC-PostServo

OB MC-PostServo

MC-LookAhead

OB MC-LookAhead

MC-Transformation

OB MC-Transformation

Synchronous cycle

OB de alarma de sincronismo

Status

OB de alarma de estado

Update

OB de alarma de actualizaci√≥n

Profile

OB para la alarma espec√≠fica del fabricante o perfil

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1015

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Eventos y OBs
Eventos de arranque de OB
Un evento de arranque de OB provoca esta reacci√≥n despu√©s de aparecer:
‚óè Si el evento procede de una fuente de eventos a la que se ha asignado un OB, se inicia la
ejecuci√≥n de este OB. Esto significa que el evento se pone en la lista de espera que
corresponde seg√∫n su prioridad.
‚óè Si el evento procede de una fuente de eventos a la que no se ha asignado ning√∫n OB, se
ejecuta la reacci√≥n del sistema predeterminada.
Nota
Algunas fuentes de eventos est√°n disponibles tambi√©n sin su configuraci√≥n, p. ej. arranque,
enchufe/desenchufe.
La siguiente tabla muestra un resumen de los eventos de arranque de OB junto con los valores
posibles para la prioridad de OB, los n√∫meros de OB posibles, la reacci√≥n del sistema
predeterminada y la cantidad de OB. Est√° ordenada por la prioridad predeterminada de los OB.
La prioridad 1 es la m√°s baja.
Tipos de fuentes de eventos Prioridades posibles (priori‚Äê
dad predeterminada)

N√∫meros de OB
posibles

Reacci√≥n del sistema Cantidad de
predeterminada
OB soportados

Arranque

1

100, >= 123

Ignorar

100

Programa c√≠clico

1

1, >= 123

Ignorar

100

Alarma horaria

de 2 a 24 (2)

de 10 a 17, >= 123

no v√°lido

20

Alarma de estado

de 2 a 24 (4)

55

Ignorar

1

Alarma de actualizaci√≥n

de 2 a 24 (4)

56

Ignorar

1

Alarma espec√≠fica del fabri‚Äê
cante o del perfil

de 2 a 24 (4)

57

Ignorar

1

Alarma de retardo

de 2 a 24 (3)

de 20 a 23, >= 123

no v√°lido

20

Alarma c√≠clica

de 2 a 24 (de 8 a 17, en fun‚Äê de 30 a 38, >= 123
ci√≥n del tiempo de ciclo)

no v√°lido

20

Alarma de proceso

de 2 a 26 (16)

de 40 a 47, >= 123

Ignorar

50

Alarma de sincronismo

de 16 a 26 (21)

de 61 a 64, >= 123

Ignorar

20 (uno por in‚Äê
terfaz is√≥crona)

Error de redundancia de
CPU (solo en CPU R/H)

de 2 a 26 (26)

72

Ignorar

1

MC-Interpolator

de 16 a 25 (24)

92

no v√°lido

1

MC-Servo

de 17 a 26 (26)

91

no v√°lido

1

MC-PreServo

Equivale a MC-Servo

67

no v√°lido

1

MC-PostServo

Equivale a MC-Servo

95

no v√°lido

1

MC-LookAhead

de 14 a 16 (15)

97

no v√°lido

1

MC-Transformation

de 17 a 25 (25)

98

no v√°lido

1

Error de tiempo 1)

22

80

Ignorar

1

Tiempo de vigilancia del ci‚Äê
clo excedido una vez
Alarma de diagn√≥stico

1016

STOP
de 2 a 26 (5)

82

Ignorar

1

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tipos de fuentes de eventos Prioridades posibles (priori‚Äê
dad predeterminada)

N√∫meros de OB
posibles

Reacci√≥n del sistema Cantidad de
predeterminada
OB soportados

Enchufe/desenchufe de m√≥‚Äê de 2 a 26 (6)
dulos

83

Ignorar

1

Fallo de rack

de 2 a 26 (6)

86

Ignorar

1

Error de programaci√≥n (solo
con tratamiento de errores
global)

de 2 a 26 (7)

121

STOP

1

Error de acceso a la periferia
(solo con tratamiento de
errores global)

de 2 a 26 (7)

122

Ignorar

1

1)

¬øC√≥mo se comporta un sistema R/H cuando se excede el tiempo de ciclo? V√©ase el manual de sistema "Sistema
redundante S7-1500R/H"

Asignaci√≥n entre fuente del evento y OB
El lugar donde se configura la asignaci√≥n entre OB y fuente del evento depende del tipo de OB:
‚óè En las alarmas de proceso y las alarmas de sincronismo, la asignaci√≥n se realiza durante
la configuraci√≥n hardware o al crear el OB.
‚óè En la alarma de MC-Servo y la alarma MC-Interpolator, STEP 7 asigna autom√°ticamente
los OB 91/92 en cuanto se agrega un objeto tecnol√≥gico "S7-1500 Motion Control".
‚óè En los dem√°s tipos de OB, la asignaci√≥n se realiza al crear el OB, dado el caso, despu√©s
de que se haya configurado la fuente del evento.
Una asignaci√≥n ya realizada puede modificarse en las alarmas de proceso con las
instrucciones ATTACH y DETACH en el tiempo de ejecuci√≥n. En este caso no se modifica la
asignaci√≥n configurada, sino solo la asignaci√≥n realmente efectiva. La asignaci√≥n configurada
es efectiva despu√©s de cargar y en cada arranque.
Las alarmas de proceso que no tienen asignado ning√∫n OB (porque est√°n as√≠ configuradas o
despu√©s de llamar la instrucci√≥n DETACH) se ignoran. La verificaci√≥n de si un OB est√°
asignado a un evento no tiene lugar cuando aparece el respectivo evento, sino cuando la
alarma de proceso debe procesarse realmente.

Prioridad de OB y comportamiento de ejecuci√≥n
Las CPU S7-1500 soportan desde la prioridad 1 (m√°s baja) hasta la 26 (m√°s alta). Un OB
obtiene la prioridad de su evento de arranque.
Los OB se procesan atendiendo meramente a la prioridad. Esto significa que si existen varias
solicitudes de OB al mismo tiempo, en primer lugar se procesar√° aquel OB con la prioridad m√°s
alta. Si se produce un evento con una prioridad m√°s alta que la del OB actualmente activo, este
OB se cancela. Los eventos con la misma prioridad se procesan en el orden de aparici√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1017

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comportamiento de sobrecarga de la CPU
Principio del comportamiento de sobrecarga de la CPU
La ejecuci√≥n del programa de usuario en las CPUs S7-1500 se basa en eventos de distinta
prioridad. Un evento inicia la ejecuci√≥n de un OB. Los OBs se procesan atendiendo meramente
a la prioridad. Esto significa que si existen varias solicitudes de OB al mismo tiempo, en primer
lugar se procesar√° aquel OB con la prioridad m√°s alta. Si se produce un evento con una
prioridad m√°s alta que la del OB actualmente activo, este OB se cancela. Los eventos con la
misma prioridad se procesan en el orden de aparici√≥n.
Para los escenarios de eventos que se contemplan a continuaci√≥n, los requisitos son que se
haya asignado un OB a cada fuente de evento y que estos OBs tengan la misma prioridad. El
segundo requisito sirve √∫nicamente para simplificar la representaci√≥n.
Cuando se produce un evento, se inicia la ejecuci√≥n del respectivo OB. Esto significa que se
pone en la lista de espera que corresponde seg√∫n su prioridad. Dependiendo de la prioridad
de OB y de la carga actual del procesador, generalmente se produce un retardo en la ejecuci√≥n
del OB. De ah√≠ que el mismo evento pueda volverse a presentar una o varias veces antes de
que se haya procesado el OB que corresponde al evento anterior. La CPU maneja este tipo de
situaciones de la siguiente manera: el sistema operativo clasifica los eventos en la lista de
espera que corresponde a su prioridad atendiendo al orden de su aparici√≥n.
Se puede limitar el n√∫mero de eventos pendientes que se encadenan desde una misma fuente
con el fin de controlar situaciones de sobrecarga temporales. Una vez se alcanza el n√∫mero
m√°ximo de eventos de arranque pendientes, p. ej. de un OB de alarma c√≠clica concreto, el
siguiente evento se rechaza.
La sobrecarga se produce cuando aparecen m√°s eventos procedentes de una misma fuente
de los pueden procesarse.
En los siguientes apartados se ofrece informaci√≥n m√°s detallada.

Recuperaci√≥n y rechazo de eventos del mismo tipo
El t√©rmino "eventos del mismo tipo" debe entenderse en lo sucesivo como los eventos
procedentes de una fuente, como p. ej., los eventos del arrancador para un determinado OB
de alarma c√≠clica.
Con el par√°metro OB "N√∫mero de eventos en cola" se determina el n√∫mero de eventos del
mismo tipo que el sistema operativo pone en la correspondiente lista de espera y que, por
tanto, corrige. As√≠, por ejemplo, si este par√°metro tiene el valor 1, se guarda un evento en la
memoria intermedia.
Nota
Muchas veces se prefiere no corregir eventos c√≠clicos, ya que esto puede derivar en una
sobrecarga en el caso de OBs de igual prioridad o prioridad inferior. Por tanto, normalmente es
m√°s conveniente rechazar eventos correspondientes y reaccionar a la situaci√≥n de sobrecarga
en el siguiente procesamiento regular de OB. Un valor bajo del par√°metro "N√∫mero de eventos
en cola" contribuye a no complicar una situaci√≥n de sobrecarga, sino a atenuarla.
En este caso, por ejemplo, si se alcanza en la lista de espera el n√∫mero m√°ximo de eventos de
arranque para un OB de alarma c√≠clica, cada nuevo evento de arranque simplemente se

1018

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
cuenta y, a continuaci√≥n, se rechaza. En el siguiente procesamiento regular de OB se informa
del n√∫mero de los eventos de arranque rechazados en el par√°metro de entrada "event_count"
(en la informaci√≥n de arranque optimizada). Entonces se puede reaccionar apropiadamente a
la situaci√≥n de sobrecarga. A continuaci√≥n, la CPU pone a cero el contador de eventos
perdidos.
A modo de ejemplo, si la CPU rechaza por primera vez un evento de arranque de un OB de
alarma c√≠clica, su posterior comportamiento depende del par√°metro OB "Entrada en el b√∫fer
de diagn√≥stico al desbordarse los eventos": Si la casilla de verificaci√≥n est√° activada, la CPU
registra una vez el evento DW#16#0002:3507 en el b√∫fer de diagn√≥stico para la situaci√≥n de
sobrecarga en esta fuente de eventos. Las siguientes entradas del b√∫fer de diagn√≥stico sobre
el evento DW#16#0002:3507 que se refieran a esta fuente de eventos se suprimir√°n hasta que
est√©n corregidos todos los eventos procedentes de esta fuente.

Mecanismo de valores umbrales para la solicitud del OB de error de tiempo
Con el par√°metro OB "Habilitar error de tiempo" ("Enable time error") se determina si para
eventos del mismo tipo se debe llamar al OB de error de tiempo cuando existe una determinada
sobrecarga.
En caso afirmativo (casilla de verificaci√≥n activada), con el par√°metro OB "Umbral de eventos
para error de tiempo" se define a qu√© n√∫mero de eventos del mismo tipo incluidos en la lista de
espera debe llamarse al OB de error de tiempo. As√≠, por ejemplo, si este par√°metro tiene el
valor 1, cuando se produce el segundo evento, el evento DW#16#0002:3502 se registra una
vez en el b√∫fer de diagn√≥stico y se solicita el OB de error de tiempo. Las siguientes entradas
del b√∫fer de diagn√≥stico sobre el evento DW#16#0002:3502 que se refieran a esta fuente de
eventos se suprimir√°n hasta que est√©n corregidos todos los eventos procedentes de esta
fuente.
De esta manera tiene la posibilidad de programar una reacci√≥n en caso de sobrecarga mucho
antes de alcanzar el l√≠mite de eventos del mismo tipo y de rechazar eventos.
Para el par√°metro "Umbral de eventos para error de tiempo" rige el siguiente rango de valores:
1 <= "Umbral de eventos para error de tiempo" <= "N√∫mero de eventos en cola"

Ejemplo de un evento de alarma de proceso
El ejemplo de un m√≥dulo que origina una alarma de proceso describe el funcionamiento de la
ejecuci√≥n del programa orientado a eventos en la CPU S7-1500.
Los eventos de proceso son eventos que lanza la periferia (p. ej. una entrada digital) y que
provocan la llamada de un OB asignado en la CPU S7-1500. Por ello, los OBs asignados a un
evento de proceso se denominan OBs de alarma de proceso.

Procedimiento
Para configurar una alarma de proceso, proceda del siguiente modo:
1. Configure una S7-1500 con CPU y con un m√≥dulo apto para alarmas de proceso, p. ej. DI
16x24VDC HF.
2. Seleccione el m√≥dulo apto para alarmas de proceso y despl√°cese por la navegaci√≥n local
al √°rea "Entradas > Canal 0".
3. Active la opci√≥n "Activar detecci√≥n de flanco ascendente".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Introduzca un nombre que describa el evento.
5. En caso necesario, modifique la prioridad del evento.
En las variables PLC (ficha "Constantes del sistema") se crea para el evento una constante
del sistema del tipo de datos Event_HwInt.

6. Haga clic sobre la lista desplegable "Alarma de proceso" para crear un nuevo OB de alarma
de proceso. En caso de que ya exista un OB de alarma de proceso, se puede seleccionar.

1020

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. Haga clic sobre el bot√≥n "Agregar objeto" para crear un nuevo OB de alarma de proceso.

8. En el di√°logo de selecci√≥n se puede decidir si el editor de programaci√≥n debe arrancar
inmediatamente con el OB de alarma de proceso abierto (opci√≥n "Agregar nuevo y abrir").

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1021

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Propiedades de OB de alarma de proceso
En las propiedades del OB de alarma de proceso se puede encontrar, para cada evento que
dispara alarma, la informaci√≥n correspondiente sobre el evento de arranque:

1022

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Programa de OB de alarma de proceso
En el programa de usuario se puede utilizar la informaci√≥n de arranque del OB de alarma de
proceso para identificar y evaluar el evento de alarma de proceso.

Consulte tambi√©n
Parametrizar OBs de alarma de proceso (P√°gina 1134)
OBs de alarma de proceso (P√°gina 1108)
Informaci√≥n importante sobre identificadores de hardware (P√°gina 1264)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1023

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustar el comportamiento operativo
Propiedades de la CPU
Resumen de las propiedades de la CPU
Sinopsis
La tabla siguiente muestra las propiedades de la CPU en s√≠ntesis:
Grupo

Propiedades

Descripci√≥n

General

Informaci√≥n del proyecto

Informaci√≥n general que describe la CPU enchufada. Es posible
modificar todos los datos excepto el n√∫mero de slot.

Informaci√≥n del cat√°logo

√önicamente informaci√≥n legible del cat√°logo de hardware para
esta CPU.

Identificaci√≥n y mantenimiento

Para guardar informaci√≥n espec√≠fica de la aplicaci√≥n, como el
nombre de la instalaci√≥n y el lugar de instalaci√≥n.

Sumas de verificaci√≥n

Para comprobar la identidad e integridad de los programas PLC.
Durante la compilaci√≥n, los bloques de la carpeta de bloques y
las listas de textos se marcan autom√°ticamente con sumas de
verificaci√≥n un√≠vocas. Es posible determinar f√°cilmente si el pro‚Äê
grama que se est√° ejecutando en la CPU es el mismo que se
hab√≠a cargado hace tiempo o si ha cambiado entretanto. Para
leer la suma de verificaci√≥n en tiempo de ejecuci√≥n en el progra‚Äê
ma se dispone de la instrucci√≥n "GetChecksum".
V√©ase: Comparaci√≥n de programas PLC a partir de las sumas de
verificaci√≥n

1024

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Interfaz PROFINET

General

Nombre y comentario de la interfaz PROFINET. El nombre est√°
limitado a 110 caracteres.

Direcciones Ethernet

Selecci√≥n de si la interfaz PROFINET est√° conectada en red. Si
ya se han creado subredes en el proyecto, estar√°n disponibles
para su selecci√≥n en la lista desplegable. En caso contrario, es
posible crear una subred nueva con el bot√≥n "Agregar nueva
subred".
El protocolo IP incluye datos sobre la direcci√≥n IP, la m√°scara de
subred y el uso de un router IP en la subred. Si se utiliza un router
IP, es imprescindible indicar la direcci√≥n IP del mismo.
V√©ase: Asignaci√≥n de direcciones y nombres para dispositivos
PROFINET (P√°gina 3119)

Sincronizaci√≥n horaria

Ajustes de la sincronizaci√≥n horaria en formato de hora NTP.
NTP (network time protocol) es un procedimiento general para
sincronizar relojes de sistema en redes locales y globales.
Con el procedimiento NTP, la interfaz de la CPU env√≠a regular‚Äê
mente consultas de hora (en modo cliente) al servidor NTP de la
subred (LAN) cuyas direcciones deben parametrizarse aqu√≠. So‚Äê
bre la base de las respuestas del servidor, se determina la hora
m√°s exacta y fiable y se sincroniza. La ventaja de este procedi‚Äê
miento es la posibilidad de sincronizar la hora m√°s all√° de los
l√≠mites de la subred. La precisi√≥n depende de la calidad del ser‚Äê
vidor NTP utilizado.

Modo de operaci√≥n

Selecci√≥n del modo de operaci√≥n de la CPU como controlador IO
o dispositivo IO, incluyendo los ajustes necesarios en cada caso.
Como dispositivo IO (I-device) debe asignarse un controlador IO
y especificar si la interfaz PROFINET ser√° parametrizar√° por el
controlador IO de nivel superior o por el controlador IO local.
Asimismo, para la funci√≥n de dispositivo IO puede activarse el
arranque optimizado, siempre que el controlador IO de nivel su‚Äê
perior soporte dicha funci√≥n. Si se ha parametrizado la CPU co‚Äê
mo dispositivo IO, se muestra la tabla para configurar las √°reas
de transferencia.
V√©ase: Configurar un I-device

Opciones avanzadas

Nombre, comentario y otras opciones de ajuste de la interfaz
Ethernet y los puertos. Se trata, por ejemplo, de los siguientes
ajustes:
‚óè Opciones de interfaz, como la reacci√≥n del programa de
usuario en caso de errores de comunicaci√≥n, si es posible la
sustituci√≥n de dispositivos sin medio de almacenamiento
extra√≠ble o la puesta en servicio autom√°tica, ajustes relativos
al modo LLDP conforme a IEEE (PROFINET V2.3) o intervalo
de tiempo para el env√≠o de Keep Alives para conexiones.
‚óè Ajustes de redundancia de medios, como la funci√≥n de
redundancia de medios (cliente, administrador (auto) o no es
dispositivo del anillo de redundancia de medios),
visualizaci√≥n de los puertos del anillo o si se generan alarmas
de diagn√≥stico en caso de errores de redundancia. El bot√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1025

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n
"Ajustes del dominio" enlazado a los ajustes de dominio de la
subred conectada (dominio MRP y dominio Sync).
‚óè Ajustes en tiempo real, como tiempo de ciclo de emisi√≥n y
propiedades de sincronizaci√≥n, cada uno con un bot√≥n
"Ajustes del dominio" enlazado con los ajustes de dominio de
la subred conectada (dominio MRP y dominio Sync). En el
dominio Sync se ajusta el tiempo de ciclo de emisi√≥n para
sistemas IO is√≥cronos y se determinan las clases RT (RT e
IRT) as√≠ como las funciones de sincronizaci√≥n para IRT.
‚óè Puertos: para los puertos se ajusta la interconexi√≥n con
dispositivos vecinos (alternativamente: desde la vista
topol√≥gica), si fuera necesario. Se requieren interconexiones
de puerto para aplicaciones is√≥cronas (IRT) as√≠ como para la
puesta en servicio autom√°tica (opci√≥n "Sustituci√≥n de
dispositivos sin medio de almacenamiento extra√≠ble"
activada).
Adem√°s, se ajustan opciones de puerto, como p. ej. si el
puerto se utiliza (los puertos no utilizados pueden
bloquearse). Tambi√©n se incluyen en las opciones de puerto
los ajustes de la conexi√≥n (velocidad de transferencia/d√∫plex)
con las opciones de vigilancia y autonegotiation. Asimismo,
en los puertos se ajustan l√≠mites para el fin del registro de
dispositivos accesibles, el fin de la detecci√≥n de topolog√≠a y el
fin del dominio Sync.
V√©ase:
Ajustar tiempo de ciclo de emisi√≥n (P√°gina 3148)
Interconectar puertos (P√°gina 3146)
Definici√≥n de opciones de puerto (P√°gina 3153)
Informaci√≥n importante sobre la redundancia de medios
Introducci√≥n: Isochronous Realtime Ethernet
Activar la sustituci√≥n de dispositivo sin medio de almacenamiento
extra√≠ble (P√°gina 3160)

Acceso al servidor web

1026

Permite el acceso a la funci√≥n del servidor web.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Interfaz PROFIBUS

General

Nombre y comentario de la interfaz PROFIBUS. El nombre est√°
limitado a 110 caracteres.

Direcci√≥n PROFIBUS

Selecci√≥n de si la interfaz PROFIBUS est√° conectada en red. Si
ya se han creado subredes en el proyecto, estar√°n disponibles
para su selecci√≥n en la lista desplegable. En caso contrario, es
posible crear una subred nueva con el bot√≥n "Agregar nueva
subred".
Se asigna la direcci√≥n PROFIBUS y se muestra la direcci√≥n m√°s
alta y la velocidad de transferencia.

Modo de operaci√≥n

Selecci√≥n del modo de operaci√≥n de la CPU como maestro DP o
esclavo DP. Se puede asignar un maestro DP a un esclavo DP y
parametrizar aqu√≠ la comunicaci√≥n de esclavo I.

Sincronizaci√≥n horaria

La hora puede sincronizarse. Se puede especificar la fuente ho‚Äê
raria y la frecuencia de la sincronizaci√≥n.

SYNC/FREEZE

El maestro DP puede enviar los comandos de control SYNC y/o
FREEZE a un grupo de esclavos DP para sincronizar los escla‚Äê
vos DP. Para ello es necesario asignar los esclavos DP a los
grupos SYNC/FREEZE.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1027

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Arranque

Arranque tras conexi√≥n

Ajuste del comportamiento de arranque tras una transici√≥n de
desconexi√≥n (POWER OFF)/conexi√≥n (POWER ON).
V√©ase: Principios b√°sicos del estado operativo "ARRANQUE"
(P√°gina 989)

Comparaci√≥n de configuraciones
te√≥rica y real

Define el comportamiento de arranque de la CPU en caso de que
la configuraci√≥n real de la estaci√≥n S7-1500 no se corresponda
con la configuraci√≥n te√≥rica:
‚óè Arranque de la CPU solo con compatibilidad
‚óè Arranque de la CPU aunque haya diferencias
Con el ajuste "Arranque de la CPU solo con compatibilidad" debe
haber un m√≥dulo en un slot configurado que sea compatible con
el m√≥dulo configurado.
Compatible significa que el m√≥dulo existente concuerde en n√∫‚Äê
mero de entradas y salidas as√≠ como en las caracter√≠sticas el√©c‚Äê
tricas y funcionales. Un m√≥dulo compatible debe poder reempla‚Äê
zar por completo a un m√≥dulo configurado; podr√° hacer m√°s co‚Äê
sas, pero no menos.
Ejemplo del ajuste "Arranque de la CPU solo con compatibilidad":
Una CPU puede ser un sustituto compatible de una CPU del
mismo tipo con una versi√≥n de firmware inferior.
Un m√≥dulo de entrada con 32 entradas digitales puede ser un
sustituto compatible de un m√≥dulo de se√±ales con 16 entradas
digitales. La CPU arranca si est√° enchufado el m√≥dulo configu‚Äê
rado o un m√≥dulo compatible. Si hay enchufado un m√≥dulo no
compatible, la CPU no arranca.
Ejemplo del ajuste "Arranque de la CPU aunque haya diferen‚Äê
cias":
En lugar de un m√≥dulo de entradas digitales configurado se en‚Äê
chufa un m√≥dulo de salidas anal√≥gicas o bien el slot se deja
vac√≠o. La CPU arranca aunque las entradas configuradas no es‚Äê
t√©n accesibles.
Tenga en cuenta que en este caso el programa de usuario no
funcionar√° correctamente, por lo que deben tomarse las medidas
adecuadas.
Nota: Para m√≥dulos S7-1500 y ET 200SP es posible ajustar in‚Äê
dividualmente para cada slot la comparaci√≥n entre m√≥dulo te√≥ri‚Äê
co y real. El ajuste predeterminado es "De CPU" (es decir, para el
slot rige el ajuste de la CPU). Para m√≥dulos de periferia de otras
familias rige por lo general el ajuste de la CPU (no puede modi‚Äê
ficarse).

Tiempo de parametrizaci√≥n

Determina el intervalo de tiempo m√°ximo (ajuste predetermina‚Äê
do: 60000 ms) en el que la periferia centralizada y descentraliza‚Äê
da debe estar operativa. La CPU suministra a los m√≥dulos CM y
CP tensi√≥n y par√°metros de comunicaci√≥n durante el arranque.
El tiempo de parametrizaci√≥n limita el periodo durante el cual los
m√≥dulos E/S conectados a CM o CP deben estar operativos.
Si la periferia centralizada y descentralizada no est√° operativa
dentro del tiempo de parametrizaci√≥n, el comportamiento de
arranque de la CPU depende del ajuste del par√°metro "Compa‚Äê
tibilidad hardware soportada".

1028

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Reloj

-

Definici√≥n para la sincronizaci√≥n de la hora a trav√©s del bus de
fondo. Las posibilidades de ajuste dependen de la CPU.
‚óè Como esclavo: el reloj es sincronizado por otro reloj.
‚óè Como maestro: el reloj sincroniza otros relojes.
‚óè Ninguno: no se realiza ninguna sincronizaci√≥n.
Los intervalos de tiempo para la sincronizaci√≥n pueden seleccio‚Äê
narse.
V√©ase: AUTOHOTSPOT

Ciclo

Tiempo de ciclo m√°ximo (tiempo
de vigilancia del ciclo) y m√≠nimo

Definici√≥n de un tiempo de ciclo m√°ximo (tiempo de vigilancia del
ciclo) y de un tiempo de ciclo m√≠nimo fijo.
Si el tiempo de ciclo rebasa el m√°ximo, la CPU llama el bloque de
organizaci√≥n OB 80 "Error de tiempo". Si el OB 80 no existe, la
CPU pasa al estado operativo STOP.
Si un ciclo rebasa dos veces el tiempo de ciclo m√°ximo, la CPU
pasa al estado operativo STOP aunque exista el OB 80.
Causas de un rebase de tiempo:
‚óè Procesos de comunicaci√≥n
‚óè Acumulaci√≥n de eventos de alarma
‚óè Error en el programa de la CPU.
Si el tiempo de ciclo es m√°s corto que el tiempo de ciclo m√≠nimo
introducido, la CPU espera hasta alcanzar el tiempo de ciclo m√≠‚Äê
nimo. En este tiempo adicional de procesamiento del programa,
la CPU procesa el OB 90 (OB de fondo) si est√° cargado.
V√©ase: Tiempo de ciclo y tiempo de ciclo m√°ximo (tiempo de
vigilancia del ciclo) (P√°gina 1036)

Carga por comunica‚Äê
ci√≥n

Carga de ciclo por comunicaci√≥n Controla hasta cierto punto la duraci√≥n de los procesos de co‚Äê
municaci√≥n que tambi√©n prolongan el tiempo de ciclo. Los pro‚Äê
cesos de comunicaci√≥n pueden ser, p. ej.: transferencia de datos
a otra CPU o carga de bloques (lanzada v√≠a PC).

Marcas de sistema y
marcas de ciclo

Bits de marcas de sistema y bits
de marcas de ciclo

V√©ase: Carga de ciclo por comunicaci√≥n (P√°gina 1037)
Activar byte para las funciones de marcas de sistema y activar un
byte para las funciones de marcas de ciclo (para ello, cada bit se
activa y desactiva en una frecuencia predeterminada).
Las marcas de sistema se utilizan en las consultas siguientes:
‚óè ¬øEl ciclo actual es el primer ciclo despu√©s de desconexi√≥n y
conexi√≥n (POWER OFF/ON)?
‚óè ¬øHan cambiado los estados de diagn√≥stico respecto del ciclo
anterior? As√≠, por ejemplo, el bit en cuesti√≥n tiene el valor 1
durante un ciclo tras un aviso de diagn√≥stico entrante o
saliente.
‚óè Consulta en "1" (high)
‚óè Consulta en "0" (low)
Las marcas de ciclo cambian peri√≥dicamente de valor, en inter‚Äê
valos definidos.
V√©ase: Uso de marcas de sistema (P√°gina 1063)
V√©ase: Uso de marcas de ciclo (P√°gina 1064)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1029

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

SIMATIC Memory
Card

-

Activa el diagn√≥stico para la vida √∫til de la SIMATIC Memory
Card.

Diagn√≥stico del siste‚Äê General
ma

El diagn√≥stico del sistema es la captaci√≥n, valoraci√≥n y notifica‚Äê
ci√≥n de un fallo dentro del sistema de automatizaci√≥n.
Ejemplos de errores:
‚óè Fallo en el programa de la CPU
‚óè Fallo de m√≥dulos
‚óè Rotura de cables de sensores y actuadores
Para determinar el diagn√≥stico del sistema existen textos de avi‚Äê
so predefinidos. Estos textos de aviso pueden modificarse seg√∫n
sea necesario e incluso a√±adirse nuevos. Los ajustes se guardan
con el proyecto y no repercuten en los componentes implicados
hasta compilar y cargar la configuraci√≥n del hardware. Para el
S7-1500, el diagn√≥stico de sistema est√° activado autom√°tica‚Äê
mente (no puede desactivarse).

Avisos de PLC

General
Administraci√≥n central de avisos
en el PLC

Activa la administraci√≥n central de avisos en la CPU. Un aviso se
compone por completo en la CPU y a continuaci√≥n se env√≠a al
dispositivo HMI. Ventaja: Los textos de aviso no necesitan car‚Äê
garse en los dispositivos HMI.
V√©ase: Administraci√≥n central de avisos en la CPU (P√°gina 1046)

1030

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Servidor web

General

Activa y configura la funci√≥n del servidor web.
V√©ase: AUTOHOTSPOT

Actualizaci√≥n autom√°tica

Env√≠a peri√≥dicamente la p√°gina web solicitada con los datos ac‚Äê
tuales de la CPU al navegador web. La duraci√≥n de los per√≠odos
se introduce en "Intervalo de actualizaci√≥n". La actualizaci√≥n au‚Äê
tom√°tica solo se puede activar cuando el servidor web est√° acti‚Äê
vado.
V√©ase: AUTOHOTSPOT

Administraci√≥n de usuarios

Aqu√≠ se introducen nombres de usuario con sus derechos de
acceso.
‚óè Cualquiera: usuario predefinido, cuyos derechos de acceso
se asignan desde una lista desplegable. El usuario
"Cualquiera" no necesita iniciar la sesi√≥n introduciendo una
contrase√±a en un acceso web.
‚óè User#: nombre editable de un usuario al que se asignan
derechos de acceso y la contrase√±a correspondiente.
Cuando se hace clic en una fila debajo de "Cualquiera", se
muestra un nombre predeterminado, que se puede cambiar.
Se pueden asignar distintos derechos de acceso a cualquier
usuario a trav√©s de una lista desplegable.
Hay derechos de acceso que est√°n acoplados entre s√≠. Ejemplo:
Si activa el derecho de acceso "Actualizar el firmware", se acti‚Äê
var√°n autom√°ticamente los derechos de acceso "Cambiar esta‚Äê
do operativo" y "...consultar diagn√≥stico". Estos derechos son
necesarios para poder ejecutar una actualizaci√≥n de firmware
desde el servidor web.
V√©ase: AUTOHOTSPOT

Seguridad inform√°tica (Security)

Permite utilizar un certificado para la identificaci√≥n del servidor.

Tablas de observaci√≥n

Permite crear tablas de observaci√≥n y define el acceso a las mis‚Äê
mas.

P√°ginas web definidas por el
usuario

Permite acceder a p√°ginas web de libre configuraci√≥n de la CPU
con un navegador web.
V√©ase: Crear y cargar p√°ginas de usuario (P√°gina 1471)

P√°gina de acceso

Permite seleccionar la p√°gina de acceso.

Vista general de las interfaces

Representaci√≥n en forma de tabla de todos los m√≥dulos con sus
interfaces Ethernet para la funcionalidad de servidor web de este
dispositivo.
Aqu√≠ se permite o no el acceso al servidor web desde la interfaz
correspondiente para cada interfaz Ethernet del dispositivo
(CPU, CP o CM).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1031

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Display

General

El display permanece oscuro en el modo de espera y vuelve a
activarse en cuanto se pulsa una tecla del display. El modo de
espera tambi√©n puede modificarse en el men√∫ del display.
En el modo de ahorro de energ√≠a, la pantalla muestra la informa‚Äê
ci√≥n con una reducci√≥n del brillo. En cuanto se pulsa una tecla del
display, el modo de ahorro de energ√≠a finaliza. El modo de ahorro
de energ√≠a tambi√©n puede modificarse en el men√∫ del display.
Idioma del display: el idioma cambia directamente despu√©s de
cargar la configuraci√≥n hardware con el idioma est√°ndar ajusta‚Äê
do. El idioma tambi√©n puede modificarse en el men√∫ del display.

Multiling√ºismo

Actualizaci√≥n autom√°tica

Entrada del intervalo de tiempo en el que se actualiza el conte‚Äê
nido del display.

Contrase√±a

Ajuste si se permite o se impide el acceso de escritura desde el
display de la CPU. Si ha activado el acceso de escritura, puede
activar adem√°s la protecci√≥n del display. En tal caso, el display
estar√° protegido por una contrase√±a parametrizable. Puede ajus‚Äê
tarse el tiempo que transcurrir√° hasta la desconexi√≥n autom√°tica
tras introducir la contrase√±a en el display.

Tablas de observaci√≥n

Pueden seleccionarse las tablas de observaci√≥n configuradas.
Durante el funcionamiento las tablas de observaci√≥n selecciona‚Äê
das pueden utilizarse en el display.

Logotipo personalizado

Puede seleccionarse un logotipo personalizado y cargarse en la
CPU con la configuraci√≥n hardware.

-

Si desea utilizar traducciones de textos del proyecto para el ser‚Äê
vidor web o el display de la CPU, aqu√≠ debe asignar el idioma de
proyecto deseado a los idiomas para el servidor web y el display
de la CPU, respectivamente (el n√∫mero depende de la CPU). De
este modo se definen los idiomas del proyecto que se mostrar√°n
al acceder al servidor web o en el display de la CPU.
Ejemplo: Se asigna al idioma "alem√°n" del servidor web o del
display de la CPU el idioma de proyecto "Alem√°n (Luxemburgo)"
seleccion√°ndolo en la lista desplegable. Para poder seleccionar
el idioma del proyecto en la lista desplegable, este debe estar
activado en "Idiomas y recursos > Idiomas del proyecto" en el
√°rbol del proyecto.
V√©ase: Multiling√ºismo (P√°gina 1040)

Hora

Hora local y horario de verano

Selecci√≥n de la zona horaria en la que se utiliza la CPU y ajuste
del horario de verano y de invierno.
Consulte tambi√©n:
Determinar y ajustar la hora de una CPU (P√°gina 3634)
Ajustar y leer la hora (P√°gina 1061)

1032

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Protecci√≥n y seguri‚Äê
dad

Nivel de acceso

Ajuste de la protecci√≥n contra lectura o escritura y de la contra‚Äê
se√±a de acceso a la CPU.
V√©ase: Posibilidades de ajuste de la protecci√≥n (P√°gina 1065)
V√©ase: Parametrizaci√≥n de niveles de acceso (P√°gina 1069)

Mecanismos de conexi√≥n

Activaci√≥n del acceso a trav√©s de una comunicaci√≥n PUT/GET.

Administrador de certificados

Activar los ajustes globales de seguridad para el administrador
de certificados y administrar los certificados para el dispositivo.

Evento de seguridad

Activaci√≥n de avisos de grupo en caso de eventos de seguridad
y definici√≥n de un per√≠odo de vigilancia (intervalo).
V√©ase: Agrupar eventos de seguridad (P√°gina 1073)

OPC UA

General

Muestra el nombre de la aplicaci√≥n OPC UA. Se utiliza para el
servidor OPC UA en la CPU.

Servidor

Activaci√≥n y configuraci√≥n del servidor OPC UA. Adem√°s de la
configuraci√≥n general para la asignaci√≥n de n√∫meros de puerto,
intervalo de env√≠o e intervalo de muestreo, se pueden configurar
aqu√≠ los ajustes de seguridad y exportar a un archivo XML las
variables PLC/DB disponibles en el √°rea de direcciones OPC UA.
En los ajustes de seguridad se dispone de las siguientes posibi‚Äê
lidades:
‚óè Canal seguro (secure channel): selecci√≥n entre el uso de los
ajustes globales de seguridad o el uso del administrador local
de certificados espec√≠fico de la CPU con funcionalidad
limitada. Aqu√≠ se puede generar o seleccionar el certificado
de servidor, activar la Security Policy adecuada y administrar
la lista de clientes de confianza.
‚óè Autenticaci√≥n de usuario: crear o seleccionar nuevos
usuarios y definir las opciones de autenticaci√≥n.

Fuente de alimenta‚Äê
ci√≥n del sistema

Cliente

Activaci√≥n del cliente OPC UA para esta CPU.

General

Indica que la CPU est√° conectada con la fuente de alimentaci√≥n.
Por tanto, esta potencia de la CPU repercute positivamente en el
balance de potencia.

Balance de suministro y consumo En el balance de suministro y consumo se compara la potencia
proporcionada por la CPU y los m√≥dulos de alimentaci√≥n con la
necesidad de potencia de los m√≥dulos de se√±ales. En el caso de
un balance de potencia negativo, que significa que existe una
necesidad de potencia mayor que la potencia que pueden pro‚Äê
porcionar la CPU y los m√≥dulos de alimentaci√≥n, se hace saber
en la tabla.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1033

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Configuraci√≥n avan‚Äê
zada

Configuraci√≥n DNS

Configuraci√≥n de la direcci√≥n de servidor DNS.
Si la CPU o un interlocutor debe ser accesible a trav√©s del nom‚Äê
bre de host (FQDN) puede ser necesario un servidor DNS.
V√©ase: Configuraci√≥n DNS (P√°gina 3369)

IP Forwarding

Activar IPv4 Forwarding para todas las interfaces PROFINET de
esta CPU.
Si IP Forwarding est√° activado, la CPU puede reenviar los pa‚Äê
quetes de datos IP recibidos, cuya direcci√≥n de destino no coin‚Äê
cida con la direcci√≥n IP propia, a otra subred IP conectada a
trav√©s de otra interfaz PROFINET.
V√©ase: IP-Forwarding (P√°gina 88)

Acceso al PLC mediante un m√≥‚Äê
dulo de comunicaci√≥n

Asignaci√≥n de un m√≥dulo de comunicaci√≥n adecuado para acti‚Äê
var la interfaz virtual W1 (p. ej., CP 1543-1 con firmware V2.2 o
superior). A trav√©s de la interfaz virtual W1 es posible acceder
mediante el CP a aplicaciones de la CPU basadas en IP.
Los ajustes del cortafuegos en el m√≥dulo de comunicaci√≥n no se
modifican autom√°ticamente despu√©s de la activaci√≥n del acceso.
Si el cortafuegos est√° activado, el usuario debe habilitar el uso de
la interfaz virtual W1 en la configuraci√≥n del cortafuegos del m√≥‚Äê
dulo de comunicaci√≥n.
V√©ase: Interfaz virtual para aplicaciones basadas en IP (P√°gi‚Äê
na 96)

Control de configuraci√≥n

Activaci√≥n del control de configuraci√≥n. Ello permite cambiar la
configuraci√≥n en el programa de usuario hasta cierto punto.
V√©ase: Control de configuraci√≥n (P√°gina 1278)

Modo is√≥crono

Configure aqu√≠ de forma centralizada el modo is√≥crono para to‚Äê
dos los m√≥dulos enchufados. Para ello, en la vista detallada pue‚Äê
de activar o desactivar el modo is√≥crono de m√≥dulos concretos.
Los m√≥dulos que no soportan el modo is√≥crono parametrizable
se muestran atenuados en la vista general.
V√©ase: Configuraci√≥n del modo is√≥crono para periferia centrali‚Äê
zada en S7-1500 (P√°gina 1092)

Recursos de cone‚Äê
xi√≥n

-

Ofrece una vista general de los recursos reservados y din√°micos
asignados para las conexiones de la CPU. En la vista online se
muestran tambi√©n los recursos actualmente en uso.
V√©ase: Recursos de conexi√≥n y tipo de comunicaci√≥n (P√°gi‚Äê
na 182)

1034

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Sin√≥ptico de direccio‚Äê nes

Descripci√≥n
Representaci√≥n en forma de tabla de todas las direcciones utili‚Äê
zadas en la CPU para las entradas y salidas integradas as√≠ como
para los m√≥dulos enchufados. Las direcciones que no utiliza nin‚Äê
g√∫n m√≥dulo se representan como hueco.
Es posible filtrar la vista por
‚óè Direcciones de entrada
‚óè Direcciones de salida
‚óè Huecos en las direcciones

Licencias Runtime

Aplicaciones de la CPU que re‚Äê
quieren una licencia RT, p. ej.
OPC UA, ProDiag, Energy Suite

Seleccione aqu√≠ el n√∫mero de licencias utilizadas en funci√≥n de la
aplicaci√≥n de la CPU.
Estas licencias tienen que comprarse para poder usarse.
Excepci√≥n: Si estas aplicaciones de la CPU se utilizan en un
contexto de simulaciones con PLCSim Advanced, no es necesa‚Äê
rio comprar las licencias. En este caso solo hay que seleccionar
el n√∫mero de licencias necesarias.
Ejemplo para seleccionar licencias: Ajustar licencias ProDiag

Consulte tambi√©n
Informaci√≥n importante sobre identificadores de hardware (P√°gina 1264)
Asignar el nombre de dispositivo y la direcci√≥n IP (P√°gina 3121)
Configuraci√≥n de la CPU en el display (P√°gina 1035)
Reglas para CPU con varias interfaces PROFINET (P√°gina 1048)
LLDP conforme a IEEE (P√°gina 1052)

Configuraci√≥n de la CPU en el display
Las CPUs S7-1500 presentan un display con teclas de manejo. El display puede utilizarse para
consultar informaci√≥n de estado relativa a los m√≥dulos configurados, para fines de diagn√≥stico
y tambi√©n para adaptar algunos ajustes de la configuraci√≥n de la CPU.

Ejemplo: ajustes de la direcci√≥n IP y del nombre de dispositivo PROFINET en el display
Si desea asignar los par√°metros de la direcci√≥n IP (direcci√≥n IP, m√°scara de subred as√≠ como
ajustes del router) en el display, en el proyecto correspondiente para la interfaz PROFINET de
la CPU debe seleccionar la siguiente opci√≥n:
‚óè Ajustar direcci√≥n IP en el dispositivo
La misma pauta se aplica a los nombres de dispositivos PROFINET: si desea asignar los
nombres de dispositivos PROFINET en el display, en el proyecto correspondiente para la
interfaz PROFINET de la CPU debe seleccionar la siguiente opci√≥n:
‚óè Ajustar el nombre de dispositivo PROFINET en el dispositivo

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1035

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tiempo de ciclo y tiempo de ciclo m√°ximo (tiempo de vigilancia del ciclo)
Funci√≥n
El tiempo de ciclo es el tiempo que necesita el sistema operativo para el procesamiento c√≠clico
del programa y para todas las partes del programa que interrumpen dicho ciclo. El
procesamiento del programa se interrumpe debido a:
‚óè Errores de tiempo y errores 2xMaxCycleTime
‚óè Actividades del sistema, p. ej. actualizaci√≥n de la memoria imagen de proceso
Por consiguiente, el tiempo de ciclo (TC) no es igual en todos los ciclos.
La figura siguiente muestra un ejemplo de tiempos de ciclo diferentes (TC1 ‚â† TC2) para CPUs
S7-1500:
'LVWLQWRVWLHPSRVGHFLFORHQODV&38V6
&LFORDFWXDO

6LJXLHQWHFLFOR

7]

6LJXLHQWHFLFOR

7]

2%

$FWXDOL]DFL¬µQ
GHOD,36

$FWXDOL]DFL¬µQGH2%
OD,3(

2% 2% $FWXDOL]DFL¬µQ $FWXDOL]DFL¬µQ
GHOD,3(
GHOD,36

2% 2% $FWXDOL]DFL¬µQGH
OD,36

,3(PHPRULDLPDJHQGHSURFHVRGHODVHQWUDGDV
,36PHPRULDLPDJHQGHSURFHVRGHODVVDOLGDV

En el ciclo actual, el OB c√≠clico utilizado (p. ej. el OB 1) es interrumpido por un error de tiempo
(p. ej. el OB 80). A continuaci√≥n del OB c√≠clico se procesa el siguiente OB del ciclo, el 201.

Tiempo de ciclo m√°ximo (tiempo de vigilancia del ciclo)
El sistema operativo vigila si el tiempo de ejecuci√≥n del programa c√≠clico alcanza un l√≠mite
superior configurable, el tiempo de ciclo m√°ximo. Dicho tiempo de vigilancia se reinicia
llamando la instrucci√≥n RE_TRIGR en cualquier punto del programa.
Si el programa c√≠clico excede el tiempo de ciclo m√°ximo, el sistema operativo intenta arrancar
el OB de error de tiempo (p. ej., OB 80). Si el OB no existe, la CPU pasa al estado operativo
STOP.
Adem√°s de vigilar el tiempo de ejecuci√≥n para asegurar que no se excede el tiempo de
vigilancia del ciclo, tambi√©n se garantiza el mantenimiento de un tiempo de ciclo m√≠nimo. Para
ello, el sistema operativo retarda el inicio de un ciclo nuevo hasta que se ha alcanzado el
tiempo de ciclo m√≠nimo. Durante este tiempo de espera se procesan eventos nuevos y
servicios del sistema operativo.

1036

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si el tiempo de vigilancia del ciclo se excede por segunda vez, p. ej., mientras se procesa el OB
de error de tiempo (error 2xMaxCycleTime), la CPU pasa al estado operativo STOP.

Carga de ciclo por comunicaci√≥n
Funci√≥n
El tiempo de ciclo de la CPU se prolonga debido a procesos de comunicaci√≥n. Dichos procesos
de comunicaci√≥n incluyen, p. ej.:
‚óè Transferencia de datos a otra CPU
‚óè Carga de bloques lanzada por una programadora
‚óè Determinadas funciones de Motion Control (puesta en servicio de objetos tecnol√≥gicos,
reinicio de objetos tecnol√≥gicos e interpolaci√≥n de perfiles de leva)
Adem√°s de los procesos de comunicaci√≥n, las funciones de test tambi√©n prolongan el tiempo
de ciclo.
La duraci√≥n de los procesos de comunicaci√≥n se influencia con el par√°metro de la CPU "Carga
de ciclo por comunicaci√≥n".

Funcionamiento del par√°metro
En el par√°metro "Carga de ciclo por comunicaci√≥n" se indica el porcentaje de capacidad de
procesamiento de la CPU que debe estar disponible para los procesos de comunicaci√≥n.
Si la comunicaci√≥n no requiere esta capacidad de procesamiento, esta queda a disposici√≥n del
procesamiento del programa.
Nota
¬øQu√© repercusiones puede tener la especificaci√≥n de un tiempo de ciclo m√≠nimo?
Si se ha especificado un tiempo de ciclo m√≠nimo y el programa de usuario no lo necesita todo,
el tiempo restante puede utilizarse nuevamente para procesos de comunicaci√≥n. Esto puede
provocar que los procesos de comunicaci√≥n ocupen una proporci√≥n mayor de la capacidad de
procesamiento de la CPU que la especificada con el par√°metro de CPU "Carga del ciclo por
comunicaci√≥n".
Para el arranque y la ejecuci√≥n de los OB en funci√≥n de sus clases de prioridad se aplica lo
siguiente:
‚óè El arranque de los OB de clases de prioridad inferiores a 15 puede retardarse por la
comunicaci√≥n e interrumpirse su ejecuci√≥n.
‚óè El arranque de los OB de clase de prioridad 15 puede retardarse por la comunicaci√≥n, pero
no se interrumpe su ejecuci√≥n.
‚óè El arranque de los OB de clases de prioridad superiores a 15 no puede retardarse por la
comunicaci√≥n ni puede interrumpirse su ejecuci√≥n.
Esto significa que influyen en un posible retardo y en la posible interrupci√≥n del OB por la
comunicaci√≥n como consecuencia de la asignaci√≥n de la prioridad de un evento o de un OB.
Esto repercute tambi√©n en los bloques que son llamados por el OB. Si de este modo se hace

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1037

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
que amplias secciones del programa no puedan interrumpirse para minimizar los tiempos de
ciclo, se retardan las funciones online de STEP 7.

Repercusi√≥n en el tiempo de ciclo real
El uso del par√°metro "Carga de ciclo por comunicaci√≥n" prolonga el tiempo de ciclo del bloque
de organizaci√≥n c√≠clico (p. ej. OB 1) en un factor que se calcula seg√∫n la f√≥rmula siguiente:

&DUJDGHFLFORSRUFRPXQLFDFL¬µQ

La f√≥rmula no tiene en cuenta la influencia de eventos as√≠ncronos, como alarmas de proceso
o c√≠clicas, en el tiempo de ciclo.
Si el tiempo de ciclo se prolonga debido a procesos de comunicaci√≥n, tambi√©n es posible que
se produzcan m√°s eventos as√≠ncronos dentro del tiempo de ciclo del bloque de organizaci√≥n
c√≠clico. Esto todav√≠a prolonga m√°s el ciclo. La prolongaci√≥n depende de cu√°ntos eventos
aparezcan y de cu√°nto dure su procesamiento.

Ejemplo 1 - no hay eventos as√≠ncronos adicionales:
Si se ajusta el par√°metro "Carga de ciclo por comunicaci√≥n" al 50 %, el tiempo de ciclo del
bloque de organizaci√≥n c√≠clico puede duplicarse.

Ejemplo 2 - hay eventos as√≠ncronos adicionales:
Con un tiempo de ciclo puro de 500 ms, el tiempo de ciclo real puede ascender hasta 1000 ms
debido a una carga por comunicaci√≥n del 50 %, siempre que la CPU tenga suficientes
peticiones de comunicaci√≥n para procesar.
2% PV

2%GHFRPXQLFDFL¬µQ


WPV





Si en un tiempo de ciclo neto de 500 ms se procesa una alarma c√≠clica cada 100 ms (clase de
prioridad inferior a 15) con un tiempo de procesamiento de 20 ms, el tiempo de ciclo sin carga
por comunicaci√≥n prolongar√≠a el ciclo en un total de 5 * 20 ms = 100 ms, es decir, el tiempo de
ciclo real ser√≠a en principio de 600 ms. Ahora bien, la prolongaci√≥n del tiempo de ciclo por las
alarmas c√≠clicas ejecutadas provocar√≠a alarmas c√≠clicas adicionales cuyo procesamiento
prolongar√≠a a su vez el tiempo de ciclo. Con dos alarmas c√≠clicas ejecutadas adicionalmente
dentro del ciclo, el tiempo de ciclo resultante es de 640 ms.

1038

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
2% PV

2%2% DUUDQTXHFDGDPVGXUDFL¬µQPV


WPV














Dado que la comunicaci√≥n al 50 % de su carga prolonga tanto el programa c√≠clico como
tambi√©n la alarma c√≠clica y puesto que debido a esta prolongaci√≥n se ejecutan m√°s alarmas
c√≠clicas, con un tiempo de ciclo neto de 500 ms y las alarmas c√≠clicas que se agregan cada
100 ms con un tiempo de procesamiento neto de 20 ms cada una, el tiempo de ciclo resultante
ser√≠a de 1680 ms. Este valor se calcula del siguiente modo:
‚óè Tiempo de procesamiento del OB1 (500 ms) con 50 % de carga por comunicaci√≥n =
1000 ms
‚óè Alarma c√≠clica individual OB30 (20 ms) con 50 % de carga por comunicaci√≥n = 40 ms
Puesto que cada 100 ms se procesa una alarma c√≠clica OB30 (con 50 % de carga por
comunicaci√≥n) de 40 ms, para el OB1 queda un tiempo de procesamiento de 60 ms cada
100 ms, de los cuales 30 ms se utilizan para la comunicaci√≥n, con lo que de cada segmento de
tiempo de 100 ms quedan tan solo 30 ms para el procesamiento del OB1 propiamente dicho:
‚óè Tiempo disponible para el procesamiento del OB1 con porcentaje de comunicaci√≥n en un
segmento de tiempo de 100 ms = 60 ms
‚óè N√∫mero de segmentos de tiempo necesarios para el procesamiento del OB1 = 1000 ms /
60 ms = 16,666
As√≠ pues, para el procesamiento del OB1 con un 50 % de carga por comunicaci√≥n se necesitan
16 segmentos de tiempo completos de 100 ms cada uno (tiempo total 1600 ms, de los cuales,
para el OB1 con comunicaci√≥n, 16 * 60 ms = 960 ms). Para el procesamiento del OB1 con
comunicaci√≥n se requieren 40 ms m√°s de tiempo restante, pero el nuevo segmento de tiempo
iniciado empieza con otra llamada del OB30 (con porcentaje de comunicaci√≥n = 40 ms). De
este modo, el OB30 se llama en total 17 veces (17 * 40 ms = 680 ms), con lo que, junto con el
tiempo de procesamiento total del OB1, resulta en una duraci√≥n del ciclo de 1680 ms en total.
2%2%

2%2%GHFRPXQLFDFL¬µQ


WPV



Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019









1039

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El ejemplo demuestra que, con una carga considerable de eventos as√≠ncronos en el programa
de usuario, la prolongaci√≥n del tiempo de ciclo debido a la carga por comunicaci√≥n puede ser
bastante mayor que la indicada en la f√≥rmula anterior.
Nota
Tenga en cuenta las indicaciones siguientes:
‚óè Verifique las repercusiones de un cambio de valor del par√°metro "Carga de ciclo por
comunicaci√≥n" en el funcionamiento de la instalaci√≥n.
‚óè La carga por comunicaci√≥n debe tenerse en cuenta al ajustar el tiempo de ciclo m√≠nimo,
puesto que de lo contrario se pueden producir errores de tiempo.

Recomendaciones
‚óè Aumente el valor solo si la CPU se utiliza principalmente para fines de comunicaci√≥n y el
programa de usuario es de duraci√≥n no cr√≠tica.
‚óè En todos los dem√°s casos, el valor solo deber√≠a reducirse.
‚óè Si los OBs de alarma no pueden interrumpirse debido a la comunicaci√≥n, ajuste su prioridad
a un valor superior a 15.

Multiling√ºismo
Cuando se configura una CPU se generan textos de diferentes categor√≠as, p. ej.
‚óè nombres de objeto (nombres de bloques, m√≥dulos, variables...)
‚óè comentarios (para bloques, segmentos, tablas de observaci√≥n...)
‚óè Textos de aviso y textos de diagn√≥stico
Los textos vienen preparados ya por el sistema (p. ej. textos del b√∫fer de diagn√≥stico) o bien
se crean durante la configuraci√≥n (p. ej. avisos).
Dependiendo del elemento concreto, los textos estar√°n en un solo idioma o podr√°n traducirse
a otros idiomas y as√≠ estar disponibles en varios idiomas en el proyecto. Los textos del proyecto
pueden mantenerse en todos los idiomas que est√°n disponibles para su selecci√≥n en el √°rbol
del proyecto (Idiomas y recursos > Textos del proyecto).
V√©ase: Principios b√°sicos de los textos del proyecto.
Los textos generados durante la configuraci√≥n pueden cargarse en la CPU. Debido a que los
recursos son limitados (p. ej. memoria de carga) solo puede cargarse un n√∫mero limitado de
idiomas.
La siguiente descripci√≥n muestra la utilidad de los textos multiling√ºes en la CPU, los textos que
se han cargado y c√≥mo se determinan los idiomas en los que se cargan los textos en la CPU.
Asimismo, se explica la influencia de la asignaci√≥n de idiomas que se parametriza en las
propiedades de la CPU (multiling√ºismo) y c√≥mo afecta este ajuste al funcionamiento.

1040

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Utilidad de los textos del proyecto en varios idiomas
Si usted es, por ejemplo, la persona que crea el proyecto, introducir√° los textos, como
comentarios y avisos, en su lengua materna. Para un cliente de equipamiento original (cliente
OEM) deber√° traducir los textos al idioma del cliente OEM, p. ej. ingl√©s, adem√°s del idioma del
cliente final. Entonces cargar√° un m√°ximo de tres idiomas en la CPU.
Los clientes tienen la ventaja de que los textos en cuesti√≥n, p. ej. comentarios y avisos, est√°n
disponibles en sus respectivas lenguas maternas, aunque el proyecto STEP 7 no est√©
disponible en la programadora o el PC. Cuando se carga el dispositivo como estaci√≥n nueva
se cargan tambi√©n los idiomas y se puede analizar y adaptar el proyecto localmente.
Otra ventaja es que determinados textos multiling√ºes tambi√©n est√°n a disposici√≥n de un
usuario sin STEP 7:
Al seleccionar el idioma del servidor web o del display de la CPU se ven los avisos, las entradas
del b√∫fer de diagn√≥stico y los avisos de estado del m√≥dulo en el idioma ajustado, por ejemplo.
La visualizaci√≥n de textos en varios idiomas en dispositivos HMI tambi√©n es posible. En el visor
de gr√°ficos y de c√≥digo se pueden visualizar p. ej. comentarios de variables y de etapas en los
idiomas cargados.

Requisitos
‚óè Los idiomas de proyecto asignables deben estar activados
‚óè Los textos correspondientes (traducciones) deben estar en el proyecto.
Encontrar√° la selecci√≥n de idiomas de proyecto en el √°rbol de proyecto en "Idiomas y
recursos".

Ajustar los idiomas disponibles para display de la CPU y servidor web
Encontrar√° los ajustes del multiling√ºismo en los par√°metros de la CPU: Aqu√≠ se ajusta lo
siguiente:
‚óè Los idiomas del proyecto que est√°n asignados a los idiomas del display de la CPU/del
servidor web
‚óè Los idiomas del proyecto que se cargan realmente en la CPU

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1041

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Proceda del siguiente modo:
1. Con la CPU seleccionada, vaya en la ventana de inspecci√≥n hasta el √°rea "Multiling√ºismo"
("Propiedades > General > Multiling√ºismo").
En esta √°rea hay una tabla en la que se asignan los idiomas: En la columna izquierda
pueden seleccionarse los idiomas del proyecto. En la columna derecha se muestran todos
los idiomas que pueden seleccionarse en el display de la CPU y para el servidor web.
2. Asigne un idioma de proyecto a cada uno de los idiomas del display de la CPU/del servidor
web.
Al realizar la asignaci√≥n, se mostrar√°n los idiomas del proyecto disponibles para los idiomas
que no existen en la CPU (como sustitutos).
Tenga en cuenta que los ajustes del idioma solo afectan a los textos que se cargan a partir
de la configuraci√≥n. Tanto el servidor web como el display de la CPU disponen de muchos
m√°s idiomas de interfaz de usuario, de modo que los textos est√°ticos del navegador web y
del display de la CPU pueden visualizarse en muchos m√°s idiomas.

Nota
El n√∫mero de idiomas cargables est√° limitado espec√≠ficamente para la CPU. Si, por
ejemplo, es posible tener dos idiomas, asigne en la columna "Idiomas del display de la CPU/
del servidor web" el correspondiente idioma del proyecto a su lengua materna. En el resto
de filas, asigne a los idiomas del display de la CPU/del servidor web en todos los casos el
mismo idioma de sustituci√≥n.

Ejemplo
Idiomas del proyecto existentes en STEP 7 (PG): ingl√©s, franc√©s, alem√°n, italiano.
Debido a la asignaci√≥n en el √°rea "Multiling√ºismo" de los par√°metros de la CPU, en el pr√≥ximo
proceso de carga se cargar√°n los siguientes idiomas del proyecto:
alem√°n, ingl√©s.
El idioma del proyecto "alem√°n" est√° ajustado de forma autom√°tica cuando el idioma del
display es alem√°n. El idioma del proyecto "ingl√©s" se muestra cuando est√° ajustado cualquier
otro idioma europeo en el display.
Los dem√°s idiomas del display no tienen asignado ning√∫n idioma.

1042

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el display solo es posible seleccionar el idioma para el display; debido a la asignaci√≥n de
idiomas procedente de la configuraci√≥n, con el idioma del display se ajusta autom√°ticamente
el idioma del proyecto asignado:
‚óè Si para el display se selecciona el idioma ingl√©s, el idioma del proyecto ser√° ingl√©s.
‚óè Si para el display se selecciona el idioma franc√©s, el idioma del proyecto tambi√©n ser√°
ingl√©s.
‚óè Si para el display se selecciona el idioma chino, no se seleccionan textos del proyecto.

¬øQu√© textos del proyecto se cargan con los idiomas seleccionados?
Los textos siguientes se cargan en la CPU junto con los datos de proyecto en los idiomas
seleccionados y tambi√©n son utilizados por el servidor web/el display de la CPU:
‚óè Textos del b√∫fer de diagn√≥stico (no modificables)
‚óè Textos de estado para el estado del m√≥dulo (no modificables)
‚óè Textos de aviso con las correspondientes listas de textos
‚óè Comentarios de variables y etapas para Graph y PLC Code Viewer
‚óè Comentarios de las tablas de observaci√≥n
Los textos siguientes tambi√©n se cargan en la CPU junto con los idiomas del proyecto en los
idiomas seleccionados, pero no son utilizados por el servidor web/el display de la CPU:
‚óè Comentarios de las tablas de variables (para variables y constantes)
‚óè Comentarios de bloques de datos globales
Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1043

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Comentarios de elementos en interfaces de bloque de FB, FC, DB y UDT
‚óè T√≠tulos de segmentos en bloques escritos en KOP, FUP o AWL
‚óè Comentarios de bloques
‚óè Comentarios de segmentos
‚óè Comentarios de elementos KOP y FUP
La figura siguiente muestra de nuevo la relaci√≥n entre los textos del proyecto multiling√ºes y el
espacio necesario en una SIMATIC Memory Card.
3UR\HFWRGH67(3
7H[WRVGHOSUR\HFWRHQYDULRVLGLRPDV
7H[WRVGHOSUR\HFWRHQYDULRVLGLRPDV
SDUDVHUYLGRUZHE\GLVSOD\GHOD&38

&386
0HPRU\&DUG
GH'(
HQ86
7H[WRVGHO
SUR\HFWRHQ
YDULRVLGLRPDV

DSUR[0%
SRULGLRPD
HVSHF¬ØILFRGHOD
&38

Particularidades: Comentarios de m√≥dulos
Los comentarios de m√≥dulos se cargan en un solo idioma.
Para la carga de comentarios de m√≥dulos se aplica lo siguiente:
‚óè Requisitos: En los ajustes del proyecto (Opciones > Ajustes, √°rea "Configuraci√≥n
hardware") debe estar activada la opci√≥n "Descargar comentario del m√≥dulo" (ajuste
predeterminado).
‚óè Los comentarios de m√≥dulos se cargan en el idioma ajustado como idioma de edici√≥n. Los
idiomas de edici√≥n se cambian "Idiomas y recursos > Idiomas del proyecto".

Particularidades: Textos del b√∫fer de diagn√≥stico y textos de estado para el estado del m√≥dulo
Los textos predefinidos para las entradas del b√∫fer de diagn√≥stico no est√°n disponibles en
todos los idiomas que pueden seleccionarse en STEP 7 como idiomas del proyecto en Idiomas
y recursos. Por consiguiente, a la hora de asignar el idioma del proyecto al idioma para el
servidor web/display de la CPU se carga en la CPU el idioma "m√°s pr√≥ximo".
Ejemplo: Los textos citados anteriormente existen, entre otros, en alem√°n; solo hay una
variante de idioma para alem√°n. Si se ha seleccionado alem√°n (Luxemburgo) o alem√°n
(Austria) como idioma del proyecto, se carga siempre el mismo idioma alem√°n.

Agregar o quitar idiomas - Consecuencias para la carga en la CPU
Si el n√∫mero de idiomas del proyecto para el display de la CPU/el servidor web ha cambiado,
se requiere el estado operativo STOP para la carga.
En este caso, STEP 7 lleva a cabo una carga completa (HW y SW).

1044

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Esto es as√≠ independientemente de los objetos que se hayan seleccionado para la carga:
Tambi√©n la carga de bloques, que normalmente se realiza en RUN, requiere un STOP de la
CPU cuando el n√∫mero de idiomas para el display de la CPU/servidor web ha cambiado desde
la √∫ltima carga.
Aunque se desmarque de nuevo un idioma del proyecto agregado, ser√° necesario un STOP de
la CPU para la carga. Solo si la selecci√≥n de un idioma del proyecto adicional se deshace
mediante el comando "Deshacer" del men√∫ "Edici√≥n" y no se ha cambiado nada m√°s que
requiera un STOP, ser√° posible cargar la CPU en RUN.
B√°sicamente se aplica lo siguiente:
Antes de cada carga, STEP 7 comprueba si el n√∫mero de idiomas para el display de la CPU/
servidor web ha cambiado. Si el n√∫mero ha cambiado (se han seleccionado m√°s o menos
idiomas desde la √∫ltima carga), se requiere un STOP de la CPU.

Particularidades a la hora de cargar el dispositivo como estaci√≥n nueva (hardware y software)
Si se ha establecido una conexi√≥n online con un dispositivo y dicho dispositivo (CPU con todos
los m√≥dulos asignados) se carga en el proyecto, rigen las reglas siguientes:
‚óè Los idiomas del proyecto se actualizan, es decir, si en el dispositivo hay idiomas del
proyecto adicionales, seguir√°n estando en el proyecto despu√©s de la carga (activados en
"Idiomas y recursos" del √°rbol del proyecto). Los textos offline y online est√°n sincronizados
despu√©s de la carga, es decir, el estado de los textos en el proyecto equivale al del
dispositivo.
‚óè Los idiomas del proyecto que ya existen en el proyecto se mantienen invariables despu√©s
de la carga; no se borra ning√∫n idioma del proyecto.
‚óè Las asignaciones "Idioma del proyecto - Idiomas del display de la CPU/del servidor web"
(multiling√ºismo) en el proyecto equivalen despu√©s de la carga a las asignaciones que se
han cargado en la CPU. Si se vuelve a realizar una carga en el dispositivo se cargan los
mismos idiomas que ya existen en la CPU.

Particularidades al cargar del dispositivo (software)
Si se carga software al proyecto desde una CPU, p. ej. bloques individuales o todo el programa,
rigen las reglas siguientes:
‚óè Los idiomas del proyecto se actualizan, es decir, si en el dispositivo hay idiomas del
proyecto adicionales, seguir√°n estando en el proyecto despu√©s de la carga (activados en
"Idiomas y recursos" del √°rbol del proyecto). Los textos offline y online de los componentes
cargados est√°n sincronizados despu√©s de la carga, es decir, el estado de los textos en el
proyecto equivale al del dispositivo.
‚óè Las asignaciones "Idioma del proyecto - Idiomas del display de la CPU/del servidor web"
(multiling√ºismo) en el proyecto se mantienen, es decir, no cambian aunque en el bloque
cargado se haya utilizado un idioma del proyecto nuevo, por ejemplo.
Tenga en cuenta que, en este caso (idioma nuevo solo disponible en la CPU accesible
online), ser√° necesario adaptar los ajustes de "Multiling√ºismo" en las propiedades de la
CPU, en caso de que el nuevo idioma tambi√©n tenga que cargarse en la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1045

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Existe el peligro de que las traducciones ya existentes en el proyecto se borren al cargar del
dispositivo, concretamente en la situaci√≥n siguiente:
‚Äì Un idioma existe offline (p. ej. en un bloque del proyecto)
‚Äì Dicho idioma no existe online
En este caso, durante la carga del dispositivo se pierde el idioma que existe online.
‚óè Team Engineering: Los ajustes del multiling√ºismo solo deben modificarse en el proyecto
maestro.

Particularidades del Team Engineering (puesta en marcha com√∫n)
En caso de puesta en marcha com√∫n, existe la posibilidad de detectar que faltan traducciones
desde el cuadro de di√°logo de sincronizaci√≥n.

Detectar la ausencia de idiomas en la comparaci√≥n online/offline
En la comparaci√≥n online/offline (editor de comparaci√≥n) se detectan diferencias entre los
idiomas del proyecto existentes para los objetos siguientes:
‚óè Bloques
‚óè Tablas de variables
Las diferencias entre los idiomas del proyecto existentes para avisos y listas de textos no se
tienen en cuenta en el editor de comparaci√≥n.
En caso de que en la comparaci√≥n tambi√©n se incluyan bloques con protecci√≥n de know-how:
Para la comparaci√≥n no es necesario introducir contrase√±as para estos bloques.
Para la comparaci√≥n se utilizan:
‚óè Online: los idiomas que realmente existen en la CPU
‚óè Offline: los idiomas que se han seleccionado en el √°rea "Multiling√ºismo" de la tabla "Idiomas
del proyecto asignados" y, por tanto, tambi√©n se tomar√°n en consideraci√≥n durante la carga
en la CPU. No son los idiomas en los que se encuentran realmente los comentarios de los
bloques, por ejemplo.
La comparaci√≥n offline/offline compara los idiomas del proyecto activados en cada caso.

Consulte tambi√©n
Resumen de las propiedades de la CPU (P√°gina 1024)

Administraci√≥n central de avisos en CPU
Las CPU S7-1500 a partir de la versi√≥n de firmware V2.0 soportan la administraci√≥n central de
avisos.
Encontrar√° el par√°metro de CPU "Administraci√≥n central de avisos en el PLC" en "Avisos PLC
> General".
Ajuste predeterminado: La administraci√≥n central de avisos est√° activada.

1046

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Efecto del par√°metro de CPU "Administraci√≥n central de avisos"
Si la administraci√≥n central de avisos est√° activada, la CPU transmite al dispositivo HMI todo
el texto del aviso, que puede constar de varias entradas de una lista de textos. La CPU se
encarga de recomponer todo el texto del aviso. En cuanto se produce el evento disparador de
un aviso, la CPU env√≠a al dispositivo HMI todo el texto del aviso con los posibles valores
asociados a trav√©s de la conexi√≥n HMI configurada.
La administraci√≥n central de avisos activada evita tener que cargar los textos de los
dispositivos HMI conectados.
Si la administraci√≥n central de avisos no est√° activada, los textos tienen que cargarse al
dispositivo HMI con el sistema de ingenier√≠a (WinCC) para que la visualizaci√≥n de los textos de
aviso est√© operativa durante el funcionamiento. Si se produce el evento disparador de un
aviso, la CPU solo env√≠a informaci√≥n rudimentaria sobre el dispositivo HMI (p. ej. ID del aviso,
versi√≥n del aviso y valores asociados). De la administraci√≥n de avisos se encarga el dispositivo
HMI: compone y prepara el texto del aviso completo a partir de los datos cargados y los
transmitidos. Para esta tarea no se requiere capacidad de procesamiento de la CPU.
Cada cambio en los textos de aviso exige una nueva carga en los dispositivos HMI conectados.

Indicaciones y reglas para la administraci√≥n central de avisos
‚óè Versi√≥n necesaria del runtime de HMI: a partir de V14
‚óè CPU necesaria: S7-1500 con versi√≥n de firmware 2.0 o superior (tambi√©n CPU S7-1500SP,
CPU S7-1500Pro y controlador por software S7-1500).
‚óè Avisos para los cuales es posible la administraci√≥n central Avisos del controlador
(diagn√≥stico de sistema, diagn√≥stico de proceso, avisos de programa).
‚óè En la configuraci√≥n runtime del dispositivo HMI (secci√≥n "Avisos del controlador" del √°rea
"Avisos") debe estar activada la "Actualizaci√≥n autom√°tica".
‚óè Los textos modificados que se cargan en la CPU no afectan a los textos de aviso que ya se
han transferido al dispositivo HMI. El texto de aviso actualizado no se visualiza hasta que
se produce un nuevo evento disparador.
‚óè Para los avisos visualizados en el dispositivo HMI en la vista de avisos o el b√∫fer de avisos
se aplica lo siguiente:
‚Äì Los idiomas en los que debe visualizarse el aviso en el dispositivo HMI tienen que
cargarse en la CPU (m√°x. 3 idiomas, consulte Multiling√ºe (P√°gina 1040)).
‚Äì Los idiomas del dispositivo HMI deben ser los mismos cargados previamente en la CPU
De lo contrario, durante el funcionamiento el dispositivo HMI solo muestra que faltan
textos de aviso. Con m√°s de 3 idiomas hay que cargar el dispositivo HMI con los textos
(la administraci√≥n central de avisos no es posible).
‚óè Para los avisos visualizados en el fichero de alarmas se aplica lo siguiente:
‚Äì El fichero de alarmas contiene avisos en un solo idioma. Este idioma se ajusta al
configurar el dispositivo HMI en "Ficheros > General > Idioma de archivaci√≥n". El idioma
de archivado tambi√©n debe ser uno de los idiomas cargados en la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1047

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Indicaci√≥n de errores
Si se produce un error se muestra un texto como el siguiente : #ID de lista de textos, ID de texto
(p. ej. #123, 456)
Ejemplo: Se ha olvidado una entrada (Range) en la lista de textos utilizada. En tal caso el
primer n√∫mero es la ID de la lista de textos (la columna con el ajuste predeterminado est√° en
gris, pero puede visualizarse). El segundo n√∫mero indica el valor para el que falta la entrada.
ID de lista de textos = 123, valor = 456.
Si Range se define sin texto no se origina ning√∫n error.

Consulte tambi√©n
Resumen de las propiedades de la CPU (P√°gina 1024)

CPU con varias interfaces PROFINET
Reglas para CPU con varias interfaces PROFINET
Dentro de la familia de las CPU S7-1500 existen CPU con dos o tres interfaces PROFINET,
p. ej. CPU 1516-3 PN/DP.
Una interfaz PROFINET puede utilizarse para la comunicaci√≥n PROFINET IO, mientras que
las otras se utilizan, p. ej., para la comunicaci√≥n con una red de orden superior (Backbone,
Router, Internet) o para la comunicaci√≥n con otra m√°quina o con otra celda de automatizaci√≥n.
Tenga en cuenta que algunos ajustes solo pueden modificarse en la interfaz X1 y leerse en la
otra interfaz (p. ej. X2). Consulte el apartado siguiente.

CPU con firmware V2.0 o superior y varias interfaces PN IO
Los m√≥dulos centrales a partir de CPU 1515 con versi√≥n de firmware V2.0 o superior ofrecen
sendas interfaces PROFINET con funcionalidad IO:
‚óè Existe la posibilidad de que dos sistemas PROFINET IO funcionen independientemente
entre s√≠, puesto que cada una de las interfaces PN IO puede funcionar como controlador IO.
‚óè La interfaz PROFINET X1 soporta las clases de tiempo real IRT y RT, y la interfaz
PROFINET X2 la clase de tiempo real RT.

1048

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Ambas interfaces PROFINET soportan la funci√≥n I-device.
‚óè La segunda o la tercera interfaz PROFINET presenta restricciones respecto a la primera
interfaz PROFINET (X1):
‚Äì No es posible establecer estructuras de anillo redundantes
‚Äì No es posible IRT (RT es posible en la interfaz PROFINET X2, pero la selecci√≥n de
tiempos de ciclo de emisi√≥n y el n√∫mero de dispositivos IO conectables est√°n
restringidos)
En los manuales de producto de las correspondientes CPU se describen detalles sobre la
capacidad de las distintas interfaces.
A continuaci√≥n se muestra con un ejemplo c√≥mo dos CPU manejan sus correspondientes
redes de m√°quinas en la interfaz PROFINET X1. El manejo de redes de m√°quinas tambi√©n
funciona con tiempo real is√≥crono (IRT).
Las interfaces PROFINET X2 est√°n conectadas a efectos de coordinaci√≥n a una red de la
instalaci√≥n que es independiente de la red de la m√°quina local: varias "sub_machines" est√°n
acopladas a una "main_machine" a trav√©s de la funcionalidad I-device.








0DLQB0DFKLQH

‚ë†
‚ë°
‚ë¢
‚ë£



6XEB0DFKLQH

Red de la instalaci√≥n
La CPU es controlador IO en la red de la instalaci√≥n (interfaz X2), y simult√°neamente controlador
IO en la red de la m√°quina (interfaz X1). La red de la m√°quina puede funcionar con IRT.
La CPU es I-device en la red de la instalaci√≥n (interfaz X2) y simult√°neamente controlador IO en
la red de la m√°quina (interfaz X1).
Red de la m√°quina

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1049

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas
Para una CPU S7-1500 con varias interfaces PROFINET rige lo siguiente:
‚óè En las CPU con varias interfaces PROFINET, a partir de la versi√≥n de firmware V2.0 la
segunda interfaz PROFINET (X2) tambi√©n soporta la funcionalidad IO con la clase de
tiempo real RT y, por tanto, las funciones de controlador IO y de dispositivo IO.
Adem√°s, la segunda y todas las dem√°s interfaces PROFINET (p. ej. X2) soportan la
comunicaci√≥n HMI, la comunicaci√≥n con el sistema de configuraci√≥n, la comunicaci√≥n con
una red de nivel superior (Backbone, Router, Internet) y la comunicaci√≥n con otra m√°quina
o c√©lula de automatizaci√≥n. Adem√°s de soporta: enviar topolog√≠a con el protocolo LLDP,
gestionar MIB del LLDP, responder y gestionar peticiones SNMP, adem√°s de la funci√≥n
"Dispositivos accesibles" (protocolo DCP).
‚óè Para las CPU con una versi√≥n de firmware < V2.0 rige lo siguiente: La segunda y todas las
dem√°s interfaces PROFINET (p. ej. X2) no soportan la funcionalidad IO, es decir, ninguna
funci√≥n de controlador IO/dispositivo IO. Se soportan la comunicaci√≥n HMI, la
comunicaci√≥n con el sistema de configuraci√≥n, la comunicaci√≥n con una red de nivel
superior (Backbone, Router, Internet) y la comunicaci√≥n con otra m√°quina o c√©lula de
automatizaci√≥n. Adem√°s de soporta: enviar topolog√≠a con el protocolo LLDP, gestionar MIB
del LLDP, responder y gestionar peticiones SNMP, adem√°s de la funci√≥n "Dispositivos
accesibles" (protocolo DCP).
‚óè Las subredes IP de todas las interfaces deben ser diferentes. Es decir, la direcci√≥n IP de
todas las interfaces debe diferir en el componente de subred.
La comunicaci√≥n a trav√©s de varias interfaces PROFINET solo resulta ventajosa si las
interfaces se encuentran en distintas subredes IP.
La m√°scara de subred, que tambi√©n se configura al asignar las direcciones IP, tambi√©n
determina si las subredes IP de ambas interfaces son distintas o no.
Si la CPU direcciona un dispositivo Ethernet, determina, bas√°ndose en las reglas descritas
en RFC 4632, la interfaz a trav√©s de la que se enviar√°n o recibir√°n los paquetes de datos
correspondientes.
Ejemplo: Ambas direcciones IP se encuentran en diferentes subredes
‚Äì M√°scara de subred de dos interfaces: 255.255.255.0
‚Äì Direcci√≥n IP de la primera interfaz: 192.168.0.10
‚Äì Direcci√≥n IP de la segunda interfaz: 192.168.1.10
Ejemplo negativo: Ambas direcciones IP se encuentran en la misma subred
‚Äì M√°scara de subred de dos interfaces: 255.255.0.0
‚Äì Direcci√≥n IP de la primera interfaz: 192.168.0.10
‚Äì Direcci√≥n IP de la segunda interfaz: 192.168.1.10
‚óè Las interfaces pueden estar conectadas a la misma red f√≠sica (una red f√≠sica con dos
subredes l√≥gicas, es decir, con dos redes IPv4).
‚óè Como m√°ximo puede estar activo un router. La direcci√≥n IP del router debe encontrarse en
la subred IP de la interfaz PROFINET en que est√° configurado el router.
‚óè Cuando el nombre de dispositivo se asigna autom√°ticamente, adem√°s del nombre del
dispositivo (CPU) se utiliza el nombre de la interfaz. Ejemplo: plc_1.profinet interface_1

1050

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Sincronizaci√≥n horaria: la activaci√≥n de la sincronizaci√≥n y los ajustes para el servidor NTP
solo son posibles en la interfaz PROFINET X1. Los ajustes se aplican a la interfaz X2 y a
las dem√°s interfaces (all√≠ son de solo lectura).
‚óè Opci√≥n Keep Alive: para la activaci√≥n de la opci√≥n avanzada "Enviar Keep Alives para
conexiones ..." se aplican las mismas pautas que para la sincronizaci√≥n horaria: posibilidad
de activar solo en la interfaz X1 y de leer solo en la interfaz X2 y dem√°s interfaces.

Establecer una conexi√≥n online
Si desea acceder online con PG/PC equipado con STEP 7 a una CPU con dos o tres interfaces
PROFINET, ejecute en segundo plano las siguientes actividades:
‚óè Al establecer la conexi√≥n online, STEP 7 comprueba si una de las interfaces PROFINET
conectadas con la subred S7 se encuentra en la misma subred IP que la propia direcci√≥n
IP (= direcci√≥n IP del acceso online de PG/PC) y pasa al estado online a trav√©s de esta
direcci√≥n IP / interfaz PROFINET.
‚óè En caso de que ninguna de las interfaces PROFINET se encuentre en la misma subred IP,
STEP 7 pasa a online a trav√©s de las interfaces PROFINET para las que est√° configurado
un router.
‚óè Si no se cumplen los requisitos, STEP 7 emite un mensaje con la opci√≥n de cambiar la
direcci√≥n de subred IP de la interfaz PG/PC para que la programadora se encuentre en la
misma subred IP.

Consulte tambi√©n
IP Forwarding (P√°gina 88)
Interfaz virtual para aplicaciones basadas en IP (P√°gina 96)

Limitaci√≥n del flujo de datos en la red
Limitar el flujo de datos en la red para interfaces PROFINET
La funci√≥n "Limitar el flujo de datos en la red" limita a un valor m√°ximo la carga de red de la
comunicaci√≥n Ethernet est√°ndar que fluye de la interfaz a la red. La comunicaci√≥n c√≠clica en
tiempo real (RT/IRT) no se ve afectada.
En un topolog√≠a en l√≠nea, una comunicaci√≥n Ethernet est√°ndar puede provocar r√°pidamente
cargas de red cr√≠ticas. Los dispositivos de una topolog√≠a en l√≠nea deber√≠a soportar la "limitaci√≥n
del flujo de datos en la red".
Los dispositivos que aportan mucha "comunicaci√≥n Ethernet est√°ndar" a la red no deber√≠an
colocarse en una topolog√≠a en l√≠nea, sino directamente detr√°s de un switch.
Dependiendo de la interfaz, es posible activar o desactivar la funci√≥n "Limitar el flujo de datos
en la red". Si la interfaz X1 de una CPU S7-1500 se utiliza como controlador IO o como
dispositivo IO, la funci√≥n "Limitar el flujo de datos en la red" siempre est√° activada. Si la interfaz
X1 de una CPU S7-1500 no se utiliza como controlador IO o como I-device, dicha funci√≥n
puede activarse o desactivarse. Para otras interfaces siempre es posible activar o desactivar
la funci√≥n "Limitar el flujo de datos en la red".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1051

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Uso de la limitaci√≥n del flujo de datos en la red
‚óè Reparto justo del ancho de banda restante:
En redes PROFINET, la comunicaci√≥n c√≠clica y no c√≠clica comparten la misma red. Esto
hace que para la comunicaci√≥n no c√≠clica quede √∫nicamente un ancho de banda limitado.
La limitaci√≥n del flujo de datos garantiza que el ancho de banda restante para la
comunicaci√≥n no c√≠clica se reparta equitativamente entre los dispositivos de la red. La
limitaci√≥n del flujo de datos no soluciona problemas de sobrecarga globales en la red, pero
impide que un solo dispositivo ocupe todo el ancho de banda.
‚óè Filtrar picos en el flujo de datos:
La limitaci√≥n del flujo de datos filtra picos de carga de datos no c√≠clicos (p. ej, de Open User
Communication, accesos del servidor web).
‚óè Delimitar problemas en el flujo de datos:
Los dispositivos tienen prohibido aportar una carga de red excesiva a una red PROFINET.
Cuando las aplicaciones de un dispositivo generan un exceso de datos, no se reenv√≠an a
la red PROFINET. Las repercusiones negativas (p. ej. p√©rdida de datos, interrupci√≥n de la
comunicaci√≥n) quedan restringidas al dispositivo y sus interlocutores. Los dem√°s
dispositivos no se ven afectados.

Ajustar la limitaci√≥n del flujo de datos en la red para una CPU
Para ajustar la limitaci√≥n del flujo de datos en la red, proceda del siguiente modo:
1. Seleccione la interfaz de la CPU en la vista de redes de STEP 7.
2. En la ventana de inspecci√≥n, navegue hasta "Propiedades" > "General" > "Opciones
avanzadas" > "Opciones de interfaz n".
3. Active o desactive la casilla de verificaci√≥n "Limitar el flujo de datos en la red".

LLDP conforme a IEEE
LLDP son las siglas del protocolo no propietario "Link Layer Discovery Protocol", que se define
en la norma IEEE-802.1AB.
Con LLDP, los dispositivos Ethernet env√≠an informaci√≥n propia en intervalos regulares a los
dispositivos vecinos. Los dispositivos vecinos guardan la informaci√≥n.
Las herramientas SNMP leen estos datos y elaboran la topolog√≠a de la red a partir de los
mismos (SNMP son las siglas en ingl√©s de "Simple Network Management Protocol").

1052

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

LLDP e IEC 61158
La norma de bus de campo IEC 61158 V2.2, abreviada "IEC V2.2", traslada LLDP a
dispositivos con una interfaz PROFINET. De este modo, las herramientas SNMP detectan la
topolog√≠a de redes Ethernet que tienen conectados dispositivos con una interfaz PROFINET.
Los dispositivos con varias interfaces PROFINET requieren una versi√≥n m√°s reciente de esta
norma, la IEC V2.3. De este modo, las herramientas de Siemens y de otros fabricantes
detectan todas las interfaces de un dispositivo con varias interfaces PROFINET.
Todas las interfaces PROFINET conectadas en red deben estar ajustadas al mismo modo (ya
sea IEC V2.3 o IEC V2.2).
Si todos los dispositivos de la subred PROFINET se configuran en un mismo proyecto, STEP
7 ajusta autom√°ticamente el modo correcto y no es necesario ocuparse de m√°s ajustes. A
continuaci√≥n se explican las reglas en funci√≥n de las cuales STEP 7 lleva a cabo los ajustes de
modo autom√°tico y se indica en qu√© casos debe ajustarse el modo manualmente.

¬øC√≥mo se sabe qu√© modo soporta una interfaz PROFINET?
Para saber qu√© modo soporta una interfaz PROFINET, consulte las propiedades de la interfaz
en la vista de dispositivos (con el dispositivo seleccionado) o en la vista de redes (con la
interfaz seleccionada). En el apartado "Interfaz PROFINET > Opciones avanzadas" aparece la
opci√≥n "Utilizar modo IEC V2.2 LLDP".
‚óè Si la opci√≥n "Utilizar modo IEC V2.2 LLDP" est√° activada y no puede modificarse, la interfaz
PROFINET soporta √∫nicamente el modo V2.2.
‚óè Si la opci√≥n "Utilizar modo IEC V2.2 LLDP" est√° desactivada y puede modificarse, la
interfaz PROFINET soporta el modo V2.2 y tambi√©n el V2.3.

Ajuste autom√°tico de las interfaces PROFINET
STEP 7 ajusta el modo de las interfaces PROFINET de acuerdo con las reglas siguientes:
‚óè Si los dispositivos soportan el modo IEC V2.3, STEP 7 ajusta de forma unitaria al modo IEC
V2.3 todas las interfaces PROFINET conectadas a la subred.
‚óè Si un dispositivo solo soporta el modo IEC V2.2, STEP 7 ajustar√° al modo IEC V2.2 todas
las interfaces PROFINET conectadas a la subred.

Ejemplo 1: Ajuste autom√°tico
En este ejemplo se cre√≥ un I-device en el proyecto 1 y, seguidamente, se insert√≥ en el proyecto
2 como archivo GSD (dos proyectos).
En el proyecto 1 hay un dispositivo (3) que solo soporta el modo V2.2. Por este motivo, STEP
7 ajust√≥ todas las interfaces PROFINET de este proyecto al modo V2.2 y anot√≥ este ajuste en
el archivo GSD.
Seguidamente se export√≥ el proyecto de I-device a un archivo GSD (2) y se insert√≥ en el
proyecto 2. Debido a la entrada en el archivo GSD, STEP 7 puso autom√°ticamente todas las
interfaces PROFINET del proyecto 2 al modo V2.2.
En este ejemplo, el controlador IO de nivel superior parametriza el sistema IO subordinado (1).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1053

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las herramientas SNMP de este ejemplo detectan √∫nicamente una interfaz por dispositivo.
Las herramientas de Siemens detectan todas las interfaces PROFINET.

1054

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
'LVSRVLWLYR,2

3UR\HFWR

&RQWURODGRU,2
,(&9
,QWHUID]31

,(&9
,QWHUID]31

31
;

31
;
6LVWHPD,2$
31
;
,(&9
,QWHUID]31

,'HYLFH

*6'
31
;





,(&9
,QWHUID]31

'LVSRVLWLYR,2$

,'HYLFH

,(&9
,QWHUID]31

,(&9
,QWHUID]31
&RQWURODGRU,2
31
;

31
;

31
;
6LVWHPD,2%

31
;



3UR\HFWR

‚ë†
‚ë°
‚ë¢

,(&9
,QWHUID]31

'LVSRVLWLYR,2%

El controlador IO de nivel superior parametriza la interfaz PROFINET del I-Device en el sistema
IO A.
El archivo GSD PROFINET especifica que solo se soporta el modo IEC V2.2
Los dispositivos con modo IEC V2.2 fuerzan el modo IEC V2.2 en todas las interfaces PROFI‚Äê
NET del proyecto 1.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1055

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajuste manual de las interfaces PROFINET
El ajuste manual de una interfaz PROFINET es necesario en los siguientes casos:
‚óè Se desea configurar una instalaci√≥n en dos o m√°s proyectos. En uno de los proyectos
(proyecto 1) se utiliza un dispositivo que solo soporta el modo V2.2. En otro de los proyectos
(proyecto 2) se utilizan √∫nicamente dispositivos con el modo V2.3. En tal caso, debe
ajustarse manualmente al modo V2.2 uno de los dispositivos del proyecto 2.
‚óè Se utilizan dos proyectos. El primer proyecto contiene un I-Device. El segundo proyecto
contiene un sistema IO de nivel superior al que se conecta el I-Device. Este caso se
describe con m√°s detalle a continuaci√≥n.

Ajustar manualmente el modo IEC
Cuando se dan las condiciones siguientes es necesario ajustar manualmente una interfaz
PROFINET al modo IEC V2.2:
‚óè Se configura un I-device y se exporta el proyecto como archivo GSD.
‚óè Se utiliza el archivo GSD en otro proyecto.
‚óè Se inserta el I-device en un sistema IO de nivel superior.
‚óè El proyecto con el I-Device utiliza √∫nicamente dispositivos que soportan el modo V2.3. Este
modo se ajusta autom√°ticamente.
‚óè En el sistema IO de nivel superior hay un dispositivo que solo soporta la norma IEC V2.2.
Para forzar al modo V2.2 la interfaz PROFINET de un dispositivo conectado al sistema IO
subordinado, haga lo siguiente.
1. Abra el proyecto de I-Device en STEP 7.
2. Seleccione cualquier dispositivo.
3. En el apartado "Opciones de interfaz", active la opci√≥n "Utilizar modo IEC V2.2 LLDP".
A continuaci√≥n, genere de nuevo el archivo GSD. Utilice en el sistema IO de nivel superior el
nuevo archivo GSD.
Cargue en la CPU del I-Device la nueva configuraci√≥n del I-Device.

Ejemplo 2: Ajustar manualmente el modo IEC
Proyecto 1: En el proyecto se ha creado un I-Device.
Todas las interfaces PROFINET soportan el modo V2.3.
Por este motivo, STEP 7 no ha cambiado el modo de las interfaces PROFINET y ha anotado
el modo V2.3 en el archivo GSD (2).
Proyecto 2: Se inserta el I-Device del proyecto 1 (archivo GSD).
Uno de los dispositivos solo soporta el modo V2.2.
Por ello, STEP 7 ajusta todas las interfaces PROFINET de este proyecto al modo V2.2.

1056

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Las interfaces PROFINET de los proyectos 1 y 2 est√°n configuradas de distinta manera.
Por ello es necesario volver a abrir el proyecto del I-Device (proyecto 1) en STEP 7 y ajustar
manualmente una interfaz PROFINET al modo V2.2.
Para ajustar al modo V2.2 la interfaz PROFINET de un dispositivo conectado al sistema IO
subordinado, haga lo siguiente.
1. Abra el proyecto de I-Device en STEP 7.
2. Seleccione cualquier dispositivo.
3. En el apartado "Opciones de interfaz", active la opci√≥n "Utilizar modo IEC V2.2 LLDP".
A continuaci√≥n genere un nuevo archivo GSD. Inserte el nuevo archivo GSD en el sistema IO
de nivel superior (proyecto 2).
Vuelva a cargar el proyecto en la CPU del I-Device.
Las herramientas SNMP de este ejemplo detectan √∫nicamente una interfaz por dispositivo.
Las herramientas de Siemens detectan todas las interfaces PROFINET.
Si no se cambia el ajuste de la interfaz PROFINET, cada interfaz env√≠a un aviso de diagn√≥stico
en tiempo de ejecuci√≥n (durante el funcionamiento).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1057

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
'LVSRVLWLYR,2

3UR\HFWR

&RQWURODGRU,2
,(&9
,QWHUID]31

,(&9
,QWHUID]31

31
;



31
;

6LVWHPD,2$

31
;
,(&9
,QWHUID]31

,'HYLFH

*6'
31
;





,(&9

,'HYLFH

,QWHUID]31
'LVSRVLWLYR,2$

,(&9
,QWHUID]31

,(&9
,QWHUID]31
&RQWURODGRU,2
31
;

31
;

31
;
6LVWHPD,2%

31
;
,(&9
,QWHUID]31

3UR\HFWR

‚ë†
‚ë°
‚ë¢

1058

'LVSRVLWLYR,2%

Las interfaces PROFINET del I-Device est√°n configuradas de distinta manera (la del sistema IO
A, para el modo V2.2, y la del sistema IO B, para el modo V2.3).
El archivo GSD especifica que el I-Device soporta el modo IEC V2.3.
El dispositivo IO 2 solo soporta el modo V2.2. Por ello, STEP 7 ajusta a este modo todas las
dem√°s interfaces PROFINET del proyecto 2 (incluida la interfaz PROFINET del I-Device del
sistema IO A).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo 3: Ajustar manualmente el modo IEC
Este ejemplo es bastante similar al ejemplo 2.
La √∫nica diferencia es que en el I-Device est√° guardada la configuraci√≥n de las interfaces
PROFINET (no se realiza la parametrizaci√≥n mediante el controlador IO de nivel superior como
en el ejemplo 2).
en el sistema IO A, las interfaces PROFINET est√°n ajustadas de distinta manera (I-Device para
V2.3, controlador IO para V2.2, el dispositivo IO 2 soporta solo V2.2).
Por ello es necesario ajustar una interfaz PROFINET del sistema IO B al modo V2.2
Para ajustar al modo V2.2 la interfaz PROFINET de un dispositivo conectado al sistema IO
subordinado, haga lo siguiente.
1. Abra el proyecto de I-Device en STEP 7.
2. Seleccione cualquier dispositivo.
3. En el apartado "Opciones de interfaz", active la opci√≥n "Utilizar modo IEC V2.2 LLDP".
Seguidamente, vuelva a generar el archivo GSD y utilice el nuevo archivo.
Cargue en la CPU del I-Device la nueva configuraci√≥n del I-Device.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1059

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
'LVSRVLWLYR,2

3UR\HFWR

&RQWURODGRU,2
,(&9
,QWHUID]31

,(&9
,QWHUID]31

31
;

31
;
6LVWHPD,2$
31
;



,(&9
,QWHUID]31


,'HYLFH

*6'
31
;



,(&9
,'HYLFH

,QWHUID]31
'LVSRVLWLYR,2$

,(&9
,QWHUID]31

,(&9
,QWHUID]31
&RQWURODGRU,2
31
;

31
;

31
;
6LVWHPD,2%

31
;



3UR\HFWR

‚ë†
‚ë°

1060

,(&9
,QWHUID]31

'LVSRVLWLYR,2%

en el sistema IO A, las interfaces PROFINET est√°n ajustadas de distinta manera (I-Device para
V2.3, controlador IO para V2.2, el dispositivo IO 2 soporta solo V2.2).
en el I-Device est√° guardada la configuraci√≥n de las interfaces PROFINET (no se realiza la
parametrizaci√≥n mediante el controlador IO de nivel superior).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

‚ë¢
‚ë£

En el archivo GSD se especifica que est√° ajustado el modo IEC V2.3.
Todos los dispositivos est√°n ajustados autom√°ticamente al modo V2.3. Por ello es necesario
ajustar manualmente al modo V2.2 una interfaz PROFINET en el proyecto 1.

Funciones de reloj
Principios b√°sicos de las funciones de reloj
Todas las CPUs S7-1500 disponen de un reloj interno. El respaldo permite visualizar la hora
correcta en caso de interrupci√≥n de la fuente de alimentaci√≥n durante un m√°ximo de 10 horas.

Formato de hora
El reloj muestra siempre la hora con una resoluci√≥n de 1 milisegundo y la fecha con el d√≠a de
la semana. Se tiene en cuenta el cambio de hora provocado por el horario de verano.

Consulte tambi√©n
Ajustar y leer la hora (P√°gina 1061)

Ajustar y leer la hora
Ajuste y lectura de la hora con instrucciones
La hora y la fecha del reloj de la CPU se pueden ajustar, iniciar y leer en el programa de usuario
por medio de las instrucciones siguientes:
‚óè Ajustar la hora: "WR_SYS_T"
‚óè Leer la hora "RD_SYS_T"
‚óè Leer la hora local "RD_LOC_T"
‚óè Escribir la hora local "WR_LOC_T"

Ajuste manual
Tambi√©n es posible leer y ajustar la hora manualmente en la vista online y de diagn√≥stico, en
"Funciones > Ajustar hora".

Procedimiento de sincronizaci√≥n horaria SIMATIC
Referencia
Parametrizaci√≥n de las propiedades de la interfaz en el grupo de par√°metros "Propiedades >
General > Interfaz DP > Sincronizaci√≥n horaria".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1061

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento SIMATIC
Con el procedimiento SIMATIC, la hora se ajusta utilizando mensajes horarios MMS (MMS ‚Äë
Manufacturing Message Specification). Los mensajes horarios MMS proceden de un emisor
de hora SIMATIC o de una CPU configurada como reloj maestro.
En un CP, los mensajes horarios pueden ser recibidos por la CPU local o bien v√≠a LAN. Existe
la posibilidad de ajustar si el CP debe reenviar la hora recibida.
En comparaci√≥n con un procedimiento NTP, el procedimiento SIMATIC es m√°s preciso.

Par√°metros del reloj
Mediante los par√°metros del reloj se ajusta lo siguiente:
‚óè Tipo de sincronizaci√≥n
Si est√° configurado el tipo de sincronizaci√≥n "Como maestro", se puede elegir el intervalo
de tiempo para la sincronizaci√≥n autom√°tica.
Si en una red hay m√°s de un m√≥dulo con reloj, hay que determinar qu√© CPU actuar√° como
maestra y cu√°l como esclava para la sincronizaci√≥n del reloj. S√≥lo puede haber un reloj
maestro.
‚óè Intervalo de tiempo
El intervalo de tiempo define el espacio de tiempo entre las consultas de hora.

Instrucciones para la sincronizaci√≥n de la hora
Para garantizar que la hora coincida en todos los m√≥dulos de la red, el programa de sistema
sincroniza los relojes esclavos a intervalos regulares parametrizables. Con la instrucci√≥n
"SNC_RTCB" se puede enviar la fecha y hora del reloj maestro al reloj esclavo,
independientemente del intervalo de tiempo parametrizado.

Sincronizaci√≥n horaria en el procedimiento NTP
Referencia
Parametrizaci√≥n de las propiedades de la interfaz en el grupo de par√°metros "Propiedades >
General > Interfaz PROFINET > Sincronizaci√≥n horaria". Est√° seleccionada la opci√≥n "Activar
sincronizaci√≥n horaria v√≠a servidor NTP".

Procedimiento NTP (NTP: Network Time Protocol)
Con el procedimiento NTP, el dispositivo env√≠a regularmente consultas de hora (en modo
cliente) al servidor NTP de la subred (LAN). Sobre la base de las respuestas de los servidores
se determina la hora m√°s exacta y fiable y se sincroniza la hora de la estaci√≥n.
La ventaja de este procedimiento es la posibilidad de sincronizar la hora m√°s all√° de los l√≠mites
de la subred.
Deben configurarse las direcciones IP de hasta cuatro servidores NTP. El intervalo de
actualizaci√≥n define el espacio de tiempo entre las consultas de hora (en segundos). El rango
de valores del intervalo est√° entre 10 segundos y un d√≠a.

1062

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el procedimiento NTP se transfiere generalmente la hora UTC (Universal Time
Coordinated), que equivale a la hora GMT (Greenwich Mean Time).

Par√°metros de la sincronizaci√≥n horaria en el procedimiento NTP
Mediante los par√°metros del reloj se ajusta lo siguiente:
‚óè Activar sincronizaci√≥n horaria v√≠a servidor NTP
Active esta casilla de verificaci√≥n si hay que sincronizar el reloj interno con el procedimiento
de sincronizaci√≥n NTP.
‚óè Servidor 1-4
Deben configurarse las direcciones IP de hasta cuatro servidores NTP.
‚óè Intervalo de actualizaci√≥n
El intervalo de actualizaci√≥n define el espacio de tiempo entre las consultas de hora.

Uso de marcas de sistema
Marcas de sistema
Una marca de sistema es una marca con valores definidos.
En la parametrizaci√≥n de la marca de sistema se determina el byte de marcas de la CPU que
se convertir√° en el byte de marcas de sistema.

Uso
Las marcas de sistema pueden utilizarse en el programa de usuario, p. ej. para ejecutar partes
del programa s√≥lo en el primer ciclo tras el arranque o para evaluar el diagn√≥stico al cambiar
el estado del mismo. Dos marcas de sistema son permanentemente 1 o 0.

Bits del byte de marcas de sistema
La tabla siguiente explica el significado de las marcas de sistema:
Bit del byte de
7
marcas de siste‚Äê
ma

6

5

4

3

2

1

0

Significado

Reserva‚Äê
do (=0)

Reserva‚Äê
do (=0)

Reserva‚Äê
do (=0)

=0

=1

=1 al cam‚Äê
biar el es‚Äê
tado del
diagn√≥sti‚Äê
co

=1 durante el
arranque y
en el primer
ciclo tras el
arranque, en
el resto de
casos, 0

Reservado
(=0)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1063

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Bit de marcas de sistema 1
Tras modificar una informaci√≥n de diagn√≥stico, el bit para cambiar el estado de diagn√≥stico
tiene el valor 1 durante un ciclo. Si, por ejemplo, la CPU recibe el diagn√≥stico "Cortocircuito en
canal 2" de un m√≥dulo, el bit permanece activo durante un ciclo. Cuando el aviso de
diagn√≥stico desaparece tras solucionar el cortocircuito en el canal, el bit vuelve a estar activo
durante un ciclo.
Nota
El byte de marcas seleccionado no puede emplearse para almacenar datos en la memoria
intermedia.

Uso de marcas de ciclo
Marcas de ciclo
Una marca de ciclo es una marca que modifica peri√≥dicamente su estado binario en una
relaci√≥n 1:1 entre impulso y pausa.
En la parametrizaci√≥n de la marca de ciclo se determina el byte de marcas de la CPU que se
convertir√° en el byte de marcas de ciclo.

Uso
Las marcas de ciclo se utilizan en el programa de usuario, p. ej., para controlar indicadores
luminosos con una luz intermitente o lanzar procesos peri√≥dicos, como la adquisici√≥n de un
valor real.

Frecuencias posibles
Cada bit del byte de marcas de ciclo tiene asignada una frecuencia. La tabla siguiente muestra
la asignaci√≥n:
Bit del byte de
marcas de ciclo

7

6

5

4

3

2

1

0

Duraci√≥n del pe‚Äê
r√≠odo (s)

2,0

1,6

1,0

0,8

0,5

0,4

0,2

0,1

Frecuencia (Hz)

0,5

0,625

1

1,25

2

2,5

5

10

1064

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Las marcas de ciclo se ejecutan de forma as√≠ncrona al ciclo de la CPU, es decir, en ciclos
largos es posible que el estado de la marca de ciclo cambie varias veces.
El byte de marcas seleccionado no puede emplearse para almacenar datos en la memoria
intermedia.

Protecci√≥n
Posibilidades de ajuste de la protecci√≥n
Niveles de acceso
A continuaci√≥n se explica c√≥mo utilizar los diferentes niveles de acceso de las CPU S7-1500.
Las CPU S7-1500 ofrecen diferentes niveles de acceso para restringir el uso de determinadas
funciones.
Los niveles de acceso individuales, as√≠ como las contrase√±as correspondientes, se definen en
las propiedades de objeto de la CPU. El nivel de acceso se parametriza en una tabla.

Las marcas de verificaci√≥n verdes de las columnas de la derecha del respectivo nivel de
acceso indican qu√© operaciones son posibles como m√°ximo sin conocer la contrase√±a de este
nivel de acceso.
Para utilizar las funciones de campos no marcados en la columna "Acceso" es necesario
introducir una contrase√±a:
Ejemplo:
Ajuste el nivel de acceso "Acceso de lectura". En la tabla se ve que durante el funcionamiento
no es posible un acceso de escritura sin introducir una contrase√±a.
Tambi√©n se ve que para la funci√≥n "Escribir" se requiere un acceso completo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1065

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Esto significa que los usuarios que utilicen durante el funcionamiento una funci√≥n que requiera
acceso de escritura deber√°n introducir la contrase√±a de acceso completo.
ATENCI√ìN
La configuraci√≥n de un nivel de acceso no sustituye la protecci√≥n de know how
La parametrizaci√≥n de niveles de acceso ofrece una excelente protecci√≥n contra
modificaciones no autorizadas de la CPU, gracias a la limitaci√≥n de los derechos de carga en
la CPU. En cualquier caso, los bloques de la Memory Card no est√°n protegidos contra
escritura o lectura. Para proteger el c√≥digo de los bloques de la Memory Card se utiliza la
protecci√≥n de know-how.

Comportamiento predeterminado
El nivel de acceso predeterminado es "Acceso completo (sin protecci√≥n)". Todo usuario puede
leer y modificar la configuraci√≥n hardware y los bloques. No hay ninguna contrase√±a
parametrizada y tampoco se necesita para el acceso online.

Los distintos niveles de acceso
A continuaci√≥n encontrar√° la explicaci√≥n de los niveles de acceso existentes as√≠ como de las
funciones posibles en cada nivel de acceso.
‚óè Acceso completo (sin protecci√≥n):
la configuraci√≥n hardware y los bloques pueden ser le√≠dos y modificados por cualquier
persona.
‚óè Acceso de lectura para bloques F (solo para CPU F):
los bloques F del programa de seguridad no pueden modificarse sin legitimaci√≥n mediante
la contrase√±a de este nivel de acceso u otro superior.
Encontrar√° m√°s informaci√≥n al respecto en el manual de programaci√≥n y manejo SIMATIC

Safety - Configurar y programar.

‚óè Acceso de lectura:
solo es posible el acceso de lectura a la configuraci√≥n hardware y a los bloques, es decir,
puede cargar la configuraci√≥n hardware y los bloques en la programadora. Adem√°s,
tambi√©n es posible el acceso a HMI y a los datos de diagn√≥stico, la visualizaci√≥n de
resultados comparados online/offline, el ajuste de la hora y el cambio del estado operativo
(RUN/STOP).
No es posible cargar en la CPU ning√∫n m√≥dulo ni ninguna configuraci√≥n hardware.
Adem√°s, no son posibles las funciones de test ni las actualizaciones de firmware.

1066

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Acceso HMI:
Solo son posibles el acceso a HMI y el acceso a datos de diagn√≥stico.
Ejemplo: Con el nivel de acceso se puede tener acceso online a HMI y visualizar los iconos
de diagn√≥stico para los estados de los objetos.
Es posible leer y escribir variables mediante un dispositivo HMI.
En este nivel de acceso, los bloques y la configuraci√≥n hardware no se pueden ni cargar en
la CPU ni cargar desde la CPU en la programadora.
Adem√°s, tampoco es posible: funciones de test, cambio del estado operativo (RUN/STOP),
actualizaci√≥n de firmware ni visualizaci√≥n de resultados de comparaci√≥n online/offline.
‚óè Sin acceso (protecci√≥n completa):
solo es posible leer datos de identificaci√≥n, p. ej. mediante "Dispositivos accesibles".
No se tiene acceso ni de lectura ni de escritura a la configuraci√≥n hardware y los bloques.
Tampoco es posible el acceso HMI. La funci√≥n de servidor para la comunicaci√≥n PUT/GET
est√° desactivada en este nivel de acceso (no puede modificarse).
La legitimaci√≥n con una contrase√±a parametrizada proporciona acceso en funci√≥n del nivel
de protecci√≥n correspondiente.

Comportamiento de las funciones con diferentes niveles de acceso
En la tabla siguiente se describen las funciones online que pueden realizarse en los diferentes
niveles de protecci√≥n.
Funci√≥n

Acceso comple‚Äê Acceso de
to
lectura

Acceso HMI

Sin acceso

Identificaci√≥n del dispositivo, p.
ej. mediante Dispositivos accesi‚Äê
bles

S√≠

S√≠

S√≠

S√≠

Asignaci√≥n de una direcci√≥n de
emergencia (Emergency IP)

S√≠

S√≠

S√≠

S√≠

Visor de diagn√≥stico HMI

S√≠

S√≠

S√≠

No

Observar variables (M, I, Q, con‚Äê
tenidos de DB) mediante un dis‚Äê
positivo HMI

S√≠

S√≠

S√≠

No

Forzar variables (M, I, Q, conteni‚Äê S√≠
dos de DB) mediante un disposi‚Äê
tivo HMI

S√≠

S√≠

No

Visor de diagn√≥stico (p. ej. infor‚Äê
maci√≥n de dispositivos, visor de
conexiones, visor de avisos, b√∫‚Äê
fer de diagn√≥stico)

S√≠

S√≠

S√≠

No

Leer estad√≠sticas del tiempo de
ciclo (Online y diagn√≥stico)

S√≠

S√≠

S√≠

No

Leer informaci√≥n de la configura‚Äê S√≠
ci√≥n hardware (Online y diagn√≥s‚Äê
tico)

S√≠

S√≠

No

Leer la hora

S√≠

S√≠

S√≠

No

Ejecutar funciones online dentro
de la configuraci√≥n hardware
(Online y diagn√≥stico)

S√≠

S√≠

S√≠

No

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1067

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Acusar avisos

S√≠

S√≠

S√≠

No

Recibir avisos

S√≠

S√≠

S√≠

No

Habilitar/bloquear avisos

S√≠

S√≠

No

No

Leer variables mediante funci√≥n
de test (STEP 7, tabla de varia‚Äê
bles o tabla de observaci√≥n)

S√≠

S√≠

No

No

Solicitar un cambio de estado
operativo online (RUN/STOP/
arranque en caliente)

S√≠

S√≠

No

No

Cargar bloques de datos, blo‚Äê
ques l√≥gicos y configuraci√≥n
hardware en la PG/el PC

S√≠

S√≠

No

No

Ajustar la hora

S√≠

S√≠

No

No

Visualizar resultados de compa‚Äê
raci√≥n online/offline

S√≠

S√≠

No*

No

Borrar bloques de datos, bloques
l√≥gicos y configuraci√≥n hardware
de la CPU

S√≠

No

No

No

Cargar diferentes bloques de da‚Äê S√≠
tos, bloques l√≥gicos y configura‚Äê
ci√≥n hardware en la CPU

No

No

No

Cargar el programa de PLC en el
dispositivo e inicializar

S√≠

No

No

No

Actualizar el firmware de CPU o
m√≥dulos de periferia

S√≠

No

No

No

S√≠
Forzar variables mediante fun‚Äê
ci√≥n de test (STEP 7, tabla de ob‚Äê
servaci√≥n)

No

No

No

Leer variables en el estado del
programa

S√≠

No

No

No

Editar bloques online

S√≠

No

No

No

Forzar salidas en estado operati‚Äê S√≠
vo STOP

No

No

No

* a partir de STEP 7 V14 el nivel de acceso "Acceso HMI" no es suficiente para visualizar resultados de
comparaci√≥n online/offline, como se visualizan, p. ej., para bloques, tipos de datos PLC o variables PLC
al acceder online con el proyecto. Para visualizar resultados de comparaci√≥n online/offline es preciso
tener derecho de lectura. Motivo: STEP 7 establece la igualdad o desigualdad de datos online/offline
bas√°ndose en una comparaci√≥n de las sumas de verificaci√≥n para software y listas de textos. Leer estas
sumas de verificaci√≥n exige el nivel de acceso "Acceso de lectura".

Comportamiento de un m√≥dulo protegido por contrase√±a durante el funcionamiento
La protecci√≥n de la CPU ser√° efectiva una vez que los ajustes se hayan cargado en la CPU.
Antes de ejecutar una funci√≥n online se comprueban los permisos y, si existe protecci√≥n por
contrase√±a, se pide que se introduzca la contrase√±a.
Acceder online con una CPU protegida por contrase√±a

1068

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Acceder online con una CPU protegida por contrase√±a presupone disponer de STEP 7 V14
con derecho de lectura. Por ello, al acceder online es necesario introducir la contrase√±a para
el acceso de lectura o, si no se ha parametrizado contrase√±a para ello, introducir la contrase√±a
para acceso completo.
Si con una CPU completamente protegida solo se dispone de una contrase√±a para acceso
HMI, interrumpa la consulta de la contrase√±a para acceso de lectura. A continuaci√≥n se le
requerir√° que introduzca la contrase√±a para el acceso HMI. En cualquier caso, la autorizaci√≥n
para acceso HMI no es suficiente para la comparaci√≥n online/offline, para la que se requiere
autorizaci√≥n con acceso de lectura.
Ejemplos:
‚óè Un m√≥dulo se ha parametrizado con acceso de lectura y se desea ejecutar la funci√≥n de test
"Forzar variable". Puesto que para ello se requiere un acceso de escritura de una funci√≥n
de test, para ejecutar la funci√≥n hay que introducir la contrase√±a parametrizada (contrase√±a
para el acceso completo).
‚óè Un m√≥dulo se ha parametrizado con acceso HMI y se desea acceder online a este m√≥dulo
con STEP 7. Puesto que los datos con los que STEP 7 determina la igualdad entre los
objetos online y offline (suma de verificaci√≥n) exigen acceso de lectura, al acceder online
se requiere introducir la contrase√±a para el acceso de lectura. Aunque se cierre el cuadro
de di√°logo de entrada de la contrase√±a, se establecer√° la conexi√≥n online con el m√≥dulo.
En cualquier caso, en una comparaci√≥n online/offline solo se muestran signos de
interrogaci√≥n en la columna de iconos de comparaci√≥n.
Las funciones protegidas por contrase√±a solo pueden ejecutarse desde una programadora o
un PC en un momento dado. No se permite el acceso desde otra programadora o PC.
El permiso de acceso a los datos protegidos tiene validez mientras dure la conexi√≥n online.
Cuando se restablece la conexi√≥n online despu√©s de una interrupci√≥n, no es necesario volver
a introducir los datos de acceso. Para suprimir manualmente el permiso de acceso, haga clic
en "Online > Borrar derechos de acceso".
Todo nivel de acceso permite, incluso sin introducir una contrase√±a, el acceso ilimitado a
determinadas funciones como, p. ej., la identificaci√≥n mediante la funci√≥n "Dispositivos
accesibles".
El acceso a una CPU S7-1500 protegida con contrase√±a puede limitarse localmente en el
display. La restricci√≥n solo es efectiva si el selector de modo est√° en RUN.

Consulte tambi√©n
Bloquear el acceso online a la CPU mediante el display (P√°gina 1076)
Restricci√≥n de los servicios de comunicaci√≥n (P√°gina 1072)
Parametrizaci√≥n de niveles de acceso (P√°gina 1069)

Parametrizaci√≥n de niveles de acceso
A continuaci√≥n se explica c√≥mo parametrizar un nivel de acceso e introducir una contrase√±a
para una CPU S7-1500.
En una CPU S7-1500 es posible introducir varias contrase√±as y, por tanto, establecer
diferentes derechos de acceso para distintos grupos de usuarios.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1069

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las contrase√±as se introducen en una tabla, de modo que cada una tiene asignado
exactamente un nivel de acceso.
En la columna "Nivel de acceso" se describen los efectos de la contrase√±a.

Ejemplo
Para una CPU est√°ndar (es decir, no una CPU F) se elige el nivel de acceso "Sin acceso
(protecci√≥n completa)" y se introduce una contrase√±a propia para cada nivel de acceso situado
encima en la tabla.
Para los usuarios que no conocen ninguna de las contrase√±as, la CPU est√° completamente
protegida. Ni siquiera son posibles accesos HMI.
Para los usuarios que conocen una de las contrase√±as parametrizadas, el efecto depende de
la fila de la tabla en la que se encuentre la contrase√±a:
‚óè El efecto de la contrase√±a de la fila 1 (Acceso completo (sin protecci√≥n)) es como si la CPU
no estuviera protegida. Los usuarios que conocen esta contrase√±a tienen un acceso
ilimitado a la CPU.
‚óè El efecto de la contrase√±a de la fila 2 (Acceso de lectura) es como si la CPU estuviera
protegida contra escritura. A pesar de conocer esta contrase√±a, los usuarios solo tienen
acceso de lectura a la CPU.
‚óè La contrase√±a de la fila 3 (acceso HMI) tiene un efecto equivalente a una protecci√≥n contra
escritura y lectura de la CPU. Los usuarios que conocen esta contrase√±a pueden acceder
solo a HMI.

Procedimiento
Para parametrizar los niveles de acceso de una CPU S7-1500 proceda del siguiente modo:
1. Abra las propiedades del m√≥dulo en la ventana de inspecci√≥n.
2. Abra la entrada "Protecci√≥n" en la navegaci√≥n local.
En la ventana de inspecci√≥n se muestra una tabla con los niveles de acceso posibles.

3. Seleccione el nivel de acceso deseado en la primera columna de la tabla. Las marcas de
verificaci√≥n verdes de las columnas de la derecha del respectivo nivel de protecci√≥n indican
qu√© operaciones son posibles sin introducir la contrase√±a.

1070

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Si ha seleccionado un nivel de acceso distinto a "Acceso completo":
En la columna "Contrase√±a", asigne una contrase√±a para el acceso completo en la primera
fila (acceso completo).
Repita la contrase√±a elegida en la columna "Confirmaci√≥n" con objeto de evitar entradas
err√≥neas.
Aseg√∫rese de que la contrase√±a sea lo suficientemente segura, es decir, que no tenga un
patr√≥n reconocible por una m√°quina.
La entrada de una contrase√±a en la primera fila "Acceso completo (sin protecci√≥n)" es
obligatoria y permite a la persona que conoce la contrase√±a acceder de forma ilimitada a la
CPU, independientemente del nivel de protecci√≥n seleccionado.
5. Asigne otras contrase√±as a otros niveles de acceso seg√∫n requiera, siempre que el nivel de
acceso seleccionado lo permita.
6. Cargue la configuraci√≥n hardware para que el nivel de acceso se haga efectivo.

Resultado
La configuraci√≥n hardware y los bloques est√°n protegidos contra los accesos online no
autorizados conforme al nivel de acceso configurado. Si una operaci√≥n no se puede ejecutar
sin contrase√±a debido al nivel de acceso parametrizado, se muestra un cuadro de di√°logo para
introducir una contrase√±a.

Consulte tambi√©n
Posibilidades de ajuste de la protecci√≥n (P√°gina 1065)

Aceptar contrase√±a al sustituir m√≥dulos
Si se asigna un nivel de protecci√≥n que exige introducir una contrase√±a, la CPU transforma
dicha entrada mediante un algoritmo especial y guarda, simplificando, una suma de
verificaci√≥n especial de dicha contrase√±a.
STEP 7 nunca guarda la contrase√±a como tal, ni en la CPU se deposita ninguna contrase√±a de
forma que sea reconstruible, de modo que en caso de p√©rdida de la contrase√±a siempre hay
que cargar una configuraci√≥n de CPU nueva; v√©ase el apartado siguiente.
El algoritmo para formar o cifrar la suma de verificaci√≥n a partir de la contrase√±a se perfecciona
permanentemente para ofrecer la mayor protecci√≥n posible contra accesos no autorizados. Lo
anterior no repercute sobre el procedimiento de configuraci√≥n, a excepci√≥n de la sustituci√≥n de
m√≥dulos: dependiendo de la versi√≥n del firmware de las CPU involucradas (CPU que cambiar
y CPU de sustituci√≥n), se le presentar√° informaci√≥n que le ofrecer√° una actualizaci√≥n a un
algoritmo actual o que le solicitar√° asignar contrase√±as nuevas, puesto que la CPU de
sustituci√≥n no puede aceptar la configuraci√≥n de contrase√±a existente.
Si la CPU que cambiar y la CPU de sustituci√≥n tienen id√©ntico comportamiento respecto al
algoritmo utilizado, no es necesaria ninguna acci√≥n; la configuraci√≥n de contrase√±as se acepta
como los restantes ajustes de par√°metros.
Algo similar se aplica a los usuarios configurados del servidor web de la CPU: si se crean
usuarios con derechos espec√≠ficos es necesario configurar una contrase√±a para cada usuario.
Al sustituir m√≥dulos tambi√©n se informar√° cuando los algoritmos no sean compatibles y, en su
caso, ser√° necesario crear nuevos usuarios con sus respectivas contrase√±as.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1071

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Olvido de contrase√±a; cargar nueva configuraci√≥n de CPU
Si no posee contrase√±a de protecci√≥n de la CPU no es posible la conexi√≥n online para cargar
la CPU con una configuraci√≥n nueva (con contrase√±a nueva).
En este caso, para cargar una configuraci√≥n nueva (con asignaci√≥n de contrase√±a nueva),
proceda del siguiente modo:
1. Inserte la SIMATIC Memory Card en el lector de tarjetas de su programadora.
2. En el √°rbol del proyecto arrastre mediante Drag & Drop la carpeta de la CPU con la
configuraci√≥n nueva hasta el icono de la SIMATIC Memory Card en el lector de tarjetas.
3. En el siguiente cuadro de di√°logo de carga confirme que se sobrescribir√° la configuraci√≥n
y el programa de la configuraci√≥n de CPU existente con protecci√≥n por contrase√±a.

Comportamiento de una CPU protegida por contrase√±a al sustituir m√≥dulos
‚óè Se va a sustituir una CPU S7-1500 (firmware < 2.0) por una S7-1500 (firmware ‚â• 2.0):
Se le informa de que hay disponible un algoritmo m√°s actual para el cifrado de contrase√±as.
Existe la posibilidad de utilizar el algoritmo nuevo haciendo clic sobre el bot√≥n que se
propone o, por razones de compatibilidad, de conservar el algoritmo anterior.
‚óè Se va a sustituir una CPU S7-1500 (firmware ‚â• 2.0) por una S7-1500 (firmware < 2.0):
Se le informa de que se perder√°n las contrase√±as anteriores y de que es necesario
configurar contrase√±as nuevas.

Comportamiento de una CPU con usuarios de servidor web configurados durante la sustituci√≥n de
m√≥dulos
Para crear diferentes usuarios con sus correspondientes derechos es necesario configurar
una contrase√±a para cada usuario. Para la sustituci√≥n de m√≥dulos se aplican
correspondientemente reglas similares a las aplicadas a una CPU protegida por contrase√±a:
‚óè Se va a sustituir una CPU S7-1500 (firmware < 2.0) por una S7-1500 (firmware ‚â• 2.0):
Se le informa de que hay disponible un algoritmo m√°s actual para el cifrado de contrase√±as.
Existe la posibilidad de utilizar el algoritmo nuevo haciendo clic sobre el bot√≥n que se
propone o, por razones de compatibilidad, de conservar el algoritmo anterior.
‚óè Se va a sustituir una CPU S7-1500 (V1.7 ‚â§ firmware ‚â§ 1.8) por una S7-1500 (firmware ‚â§
1.6), o
‚óè Se va a sustituir una CPU S7-1500 (firmware ‚â• 2.0) por una S7-1500 (firmware < 2.0):
Se le informa de que se borrar√°n todos los usuarios configurados y de que en los derechos
de usuario est√°ndar se repondr√° el usuario "Cualquiera".
En este caso es necesario crear de nuevo los usuarios con sus derechos y contrase√±as.

Restricci√≥n de los servicios de comunicaci√≥n
Introducci√≥n
La CPU puede ser el servidor de una serie de servicios de comunicaci√≥n, es decir, que sin
necesidad de configurar y programar conexiones para la CPU, otros dispositivos de
comunicaci√≥n pueden acceder a los datos de la CPU.

1072

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Con ello se prescinde de la posibilidad para la CPU local como servidor de controlar la
comunicaci√≥n con los clientes.
Si este tipo de comunicaci√≥n durante el funcionamiento est√° autorizado o no para la CPU local,
se determina mediante el par√°metro "Mecanismos de conexi√≥n" en el √°rea "Protecci√≥n" de los
par√°metros de la CPU.

Permitir acceso v√≠a comunicaci√≥n PUT/GET del interlocutor remoto
En el ajuste predeterminado, la opci√≥n "Permitir acceso v√≠a comunicaci√≥n PUT/GET del
interlocutor remoto (...)" est√° desactivada. En este caso, el acceso de lectura y de escritura a
los datos de la CPU solo ser√° posible a trav√©s de conexiones de comunicaci√≥n que requieren
una configuraci√≥n o programaci√≥n tanto para la CPU local como para el interlocutor de
comunicaci√≥n. Todav√≠a son posibles, p. ej., los accesos a trav√©s de instrucciones BSEND/
BRCV.
Las conexiones para las que la CPU local es solo servidor (es decir, cuando para la CPU local
no hay una configuraci√≥n/programaci√≥n de la comunicaci√≥n con el interlocutor) no son
posibles durante el funcionamiento de la CPU; p. ej.
‚óè en accesos PUT/GET, FETCH/WRITE o por FTP a trav√©s de m√≥dulos de comunicaciones
‚óè en accesos PUT/GET de otras CPU S7
‚óè en accesos HMI que se realizan a trav√©s de la comunicaci√≥n PUT/GET
Si se desea permitir el acceso del cliente a los datos de la CPU, es decir, si no se desea
restringir los servicios de comunicaci√≥n de la CPU, se debe activar la opci√≥n "Permitir acceso
v√≠a comunicaci√≥n PUT/GET del interlocutor remoto".

Avisos de grupo en caso de eventos de seguridad
Informaci√≥n importante sobre avisos de grupo en caso de eventos de seguridad
Eventos de seguridad en el b√∫fer de diagn√≥stico
La CPU deposita informaci√≥n sobre procedimientos y eventos importantes en el b√∫fer de
diagn√≥stico.
Los siguientes eventos de seguridad (tipos de eventos) originan en cada caso una entrada en
el b√∫fer de diagn√≥stico del S7-1500:
‚óè Pasar a online, con contrase√±a correcta o err√≥nea
‚óè Detecci√≥n de datos de comunicaci√≥n manipulados
‚óè Detecci√≥n de datos manipulados en la Memory Card
‚óè Detecci√≥n de archivo de actualizaci√≥n de firmware manipulado
‚óè Carga de un nivel de protecci√≥n (protecci√≥n de acceso) modificado en la CPU
‚óè Restricci√≥n o habilitaci√≥n de la legitimaci√≥n por contrase√±a (mediante instrucci√≥n o display
de la CPU)
‚óè Acceso online denegado por rebase del n√∫mero de accesos simult√°neos posibles

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1073

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Rebase del tiempo de inactividad en una conexi√≥n online existente
‚óè Inicio de sesi√≥n en el servidor web con contrase√±a correcta o err√≥nea
‚óè Creaci√≥n de una copia de seguridad de la CPU (Backup)
‚óè Restauraci√≥n de la configuraci√≥n de la CPU (Restore)
‚óè Durante el arranque:
‚Äì El proyecto de la SIMATIC Memory Card ha cambiado (la SIMATIC Memory Card es la
misma)
‚Äì La SIMATIC Memory Card ha sido reemplazada

Aviso de grupo para eventos de seguridad
Para evitar que el b√∫fer de diagn√≥stico reciba una avalancha de eventos de seguridad
id√©nticos, a partir de STEP 7 V13 Service Pack 1 existe la posibilidad de parametrizar que
dichos eventos se introduzcan en el b√∫fer de diagn√≥stico como un aviso de grupo. En este
caso, para cada intervalo (per√≠odo de vigilancia) la CPU genera uno solo aviso de grupo por
tipo de evento.
Ejemplo: ataques Brute-Force
En caso de ataques Brute-Force, los atacantes intentan obtener acceso a la CPU probando
sistem√°ticamente muchas de las posibles combinaciones de contrase√±as. Esto hace que la
CPU reciba muchos intentos de inicio de sesi√≥n en unos pocos segundos con lo que la
avalancha de entradas individuales en el b√∫fer de diagn√≥stico provoca la p√©rdida de
informaci√≥n de diagn√≥stico importante. Este problema lo solucionan los avisos de grupo.
Funcionamiento con avisos de grupo
La CPU registra de inmediato los tres primeros eventos de un mismo tipo en el b√∫fer de
diagn√≥stico. Todos los eventos de seguridad siguientes del mismo tipo los ignora.
Al final del per√≠odo de vigilancia (intervalo), la CPU genera un aviso de grupo en el que registra
el tipo de evento y la frecuencia del mismo durante el intervalo que ha finalizado.
Si estos eventos de seguridad tambi√©n aparecen en los intervalos siguientes, la CPU genera
√∫nicamente un aviso de grupo para cada intervalo siguiente.
En el b√∫fer de diagn√≥stico, un ataque deja el patr√≥n siguiente: tres avisos individuales seguidos
de una serie de avisos de grupo. Esta serie puede constar de dos, tres o m√°s avisos de grupo,
en funci√≥n del tiempo de vigilancia seleccionado y de la duraci√≥n del ataque.
Puesto que los avisos del b√∫fer de diagn√≥stico tienen un sello de tiempo, es posible determinar
la duraci√≥n del ataque.

1074

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones






‚ë†
‚ë°
‚ë¢

‚ë£

Eventos de seguridad de un tipo, por ejemplo intentos de inicio de sesi√≥n con contrase√±a inco‚Äê
rrecta.
Intervalo (per√≠odo de vigilancia): Cuando se produce por primera vez (o se repite) un evento de
seguridad de un mismo tipo, se inicia (o reinicia) el tiempo de vigilancia.
Avisos individuales: los tres primeros eventos de seguridad de un mismo tipo se registran de
inmediato en el b√∫fer de diagn√≥stico. A partir del cuarto evento de seguridad del mismo tipo, la
CPU ya solo genera avisos de grupo.
Si tras una pausa de un intervalo como m√≠nimo se vuelve a producir un evento de seguridad de
este tipo, la CPU registra un aviso individual en el b√∫fer de diagn√≥stico y vuelve a iniciar el
per√≠odo de vigilancia.
Avisos de grupo: tras tres eventos de seguridad, la CPU genera √∫nicamente un aviso de grupo
como resumen de todos los dem√°s eventos de seguridad que se producen en este intervalo. Si
estos eventos de seguridad tambi√©n aparecen en los intervalos siguientes, la CPU genera
√∫nicamente un aviso de grupo para cada intervalo siguiente.

Consulte tambi√©n
Configurar un aviso de grupo en caso de eventos de seguridad (P√°gina 1075)
Informaci√≥n importante sobre las SIMATIC Memory Cards (P√°gina 995)

Configurar un aviso de grupo en caso de eventos de seguridad
Requisitos
‚óè STEP 7 a partir de V13 Service Pack 1
‚óè CPU S7-1500 con firmware V1.7 o superior

Procedimiento
Para configurar avisos de grupo para eventos de seguridad, proceda del siguiente modo:
1. Haga clic en el s√≠mbolo de la CPU en la vista de redes.
Las propiedades de la CPU se visualizan en la ventana de inspecci√≥n.
2. Navegue hasta el √°rea "Protecci√≥n" > "Evento de seguridad".
3. Haga clic en "Evento de seguridad inform√°tica".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1075

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Active la opci√≥n "Agrupar eventos de seguridad inform√°tica en caso de gran cantidad de
mensajes" para activar avisos de grupo para eventos de seguridad.
5. Ajuste la duraci√≥n de un intervalo (per√≠odo de vigilancia); el ajuste predeterminado es 20
segundos.

Consulte tambi√©n
Informaci√≥n importante sobre avisos de grupo en caso de eventos de seguridad (P√°gina 1073)

Bloquear el acceso online a la CPU mediante el display
En el display de una CPU S7-1500 puede bloquear el acceso a una CPU protegida con
contrase√±a (bloqueo local).
El bloqueo de acceso s√≥lo tiene efecto si el selector de modo est√° en RUN.
El bloqueo de acceso funciona independientemente de la protecci√≥n por contrase√±a, es decir,
si alguien accede a la CPU a trav√©s de una programadora conectada y ha introducido la
contrase√±a correcta, el acceso a la CPU sigue sin estar permitido.
El bloqueo de acceso es ajustable para cada nivel de protecci√≥n independientemente en el
display, lo que significa que, p. ej., el acceso de lectura est√° permitido localmente, pero el
acceso de escritura no est√° permitido localmente.
Adicionalmente se puede parametrizar una contrase√±a para el display en las propiedades de
la CPU, de forma que la protecci√≥n de acceso local cuente con una contrase√±a local.

Procedimiento
Para ajustar la protecci√≥n de acceso local para una CPU S7-1500 en el display, proceda del
siguiente modo:
1. Seleccione en el display el men√∫ Ajustes > Protecci√≥n.
2. Confirme la elecci√≥n con "OK" y ajuste para cada nivel de protecci√≥n si el acceso en RUN
est√° permitido o no:
Permitir: el acceso a la CPU es posible mediante la introducci√≥n de la contrase√±a.
Bloquear en RUN: si el selector de modo est√° en RUN, no puede registrarse ning√∫n usuario
m√°s con los derechos de este nivel de protecci√≥n en la CPU, aunque conozca la
contrase√±a. En STOP, el acceso es posible mediante la introducci√≥n de la contrase√±a.

Consulte tambi√©n
Posibilidades de ajuste de la protecci√≥n (P√°gina 1065)

1076

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Security (seguridad inform√°tica)
Posibilidades de ajuste para funciones de seguridad
Introducci√≥n
Para una transmisi√≥n de datos segura entre dos dispositivos, los certificados digitales
desempe√±an un papel importante. Al utilizar certificados digitales, un cliente solo puede
establecer una conexi√≥n segura con un servidor si el servidor acepta el certificado digital del
cliente, lo clasifica como certificado de confianza y conf√≠a en √©l. Asimismo, el cliente debe
comprobar el certificado del servidor y confiar en √©l.
Las CPU S7-1500 con firmware V2.0 o superior soportan el uso de certificados.

Administrador de certificados espec√≠fico del dispositivo y para todo el proyecto
Con el administrador local de certificados espec√≠fico de la CPU se pueden crear y administrar
certificados para el dispositivo en cuesti√≥n que, a continuaci√≥n, pueden ser utilizados por los
objetos siguientes:
‚óè Servidor OPC UA del dispositivo
‚óè Servidor web del dispositivo
‚óè Cualquier otra caracter√≠stica de sistema que necesite certificados y est√© referenciada con
una ID de certificado (en el TIA Portal V14 son sOUC y TMAIL).
Nota
Cada certificado en el administrador de certificados recibe una ID para garantizar una
referencia un√≠voca en determinados SDT. El administrador de certificados asigna la ID de
certificado cuando se crea o importa un certificado. La ID de certificado es un√≠voca en el
proyecto y no puede modificarse.
Los certificados del administrador local de certificados espec√≠fico de la CPU solo hacen
referencia al dispositivo. Si desea utilizar certificados en todo el proyecto, debe activar el
administrador global de certificados de seguridad en el dispositivo.
En el administrador global de certificados de seguridad puede utilizar funciones adicionales
para administrar sus certificados:
‚óè Importar certificados y entidades emisoras nuevas.
‚óè Exportar los certificados y entidades emisoras utilizados en el proyecto.
‚óè Renovar certificados y entidades emisoras caducados.
‚óè Sustituir entidades emisoras ya existentes.
‚óè Agregar certificados y entidades emisoras de confianza.
‚óè Borrar certificados importados manualmente.
Los ajustes globales de seguridad solo son visibles si han sido activados en el proyecto al
menos para un dispositivo. A tal fin, en el administrador local de certificados (espec√≠fico de la
CPU) est√° disponible la casilla de verificaci√≥n "Utilizar ajustes globales de seguridad para el
administrador de certificados". La encontrar√° en las propiedades generales de un dispositivo

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1077

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
con funciones de seguridad, concretamente en la secci√≥n "Protecci√≥n y seguridad >
Administrador de certificados" de la ventana de inspecci√≥n. En funci√≥n de este ajuste, se utiliza
√∫nicamente o bien el administrador local de certificados espec√≠fico de la CPU con
funcionalidad limitada o el administrador global de certificados de seguridad.
ATENCI√ìN
Si activa el administrador global de certificados de seguridad para el proyecto, se pierde el
contenido del administrador local de certificados espec√≠fico de la CPU:
‚óè Las claves privadas no se podr√°n restablecer.
‚óè Exporte sus certificados si desea seguir utiliz√°ndolos en el administrador global de
certificados de seguridad.
‚óè Actualice su configuraci√≥n o su programa, ya que las ID de los certificados pueden
cambiar.
Una vez activado el administrador global de certificados de seguridad, el administrador local
de certificados espec√≠fico de la CPU act√∫a como una memoria intermedia de los certificados
globales espec√≠ficos de la CPU. Si se crea un certificado nuevo en el administrador local de
certificados espec√≠fico de la CPU, este se introduce en el administrador global de certificados
de seguridad. Los certificados depositados en el administrador global de certificados de
seguridad tambi√©n se pueden seleccionar en el administrador local de certificados espec√≠fico
de la CPU como certificado para la CPU.

Consulte tambi√©n
Certificados para el servidor web (P√°gina 1084)
Certificados para servidor OPC UA (P√°gina 1085)
Administrador local de certificados espec√≠fico de la CPU (P√°gina 1078)
Principios b√°sicos de secure communication (P√°gina 744)

Administrador local de certificados espec√≠fico de la CPU
Introducci√≥n
El administrador local de certificados espec√≠fico de la CPU permite utilizar certificados para el
servidor OPC UA y el servidor web sin tener acceso al administrador global de certificados de
seguridad.

Funciones del administrador local de certificados
El administrador local de certificados espec√≠fico de la CPU tiene, en comparaci√≥n con el
administrador global de certificados de seguridad, solo una funcionalidad limitada. A trav√©s del
administrador local de certificados solo se pueden crear, asignar, exportar o borrar certificados.

1078

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Encontrar√° los ajustes del administrador local de certificados espec√≠fico de la CPU en las
propiedades generales del dispositivo, concretamente en la secci√≥n "Protecci√≥n y seguridad >
Administrador de certificados" de la ventana de inspecci√≥n:
‚óè Opci√≥n para activar el administrador global de certificados
‚óè Tabla de certificados de dispositivo: Visualizaci√≥n y administraci√≥n de certificados que se
utilizan, p. ej., para secure OUC (servidor TLS / cliente TLS), el servidor web y el servidor
OPC UA del dispositivo.
‚óè Tabla de certificados de los dispositivos del interlocutor: Visualizaci√≥n de los certificados
que se han asignado como usuario o cliente de confianza.

Certificados de dispositivo
Los certificados de dispositivo son v√°lidos para el dispositivo y sus respectivos componentes.
Los certificados aqu√≠ indicados se han creado, p. ej., tambi√©n para el servidor web o para OPC
UA y se indican aqu√≠. Aqu√≠ tambi√©n se pueden crear certificados con los ajustes para el servidor
web o para OPC UA, con la particularidad de que tienen que utilizarse en la ubicaci√≥n
correspondiente.
Cuando se crea un certificado nuevo, en el cuadro de di√°logo correspondiente para el
dispositivo se introducen de forma predeterminada los siguientes valores:
‚óè Titular del certificado: <Nombre de la CPU>/TLS. El juego de caracteres est√° limitado para
cumplir las especificaciones de ASN.1.
‚óè Tipo de firma: sha256RSA o sha1RSA, en funci√≥n de la pol√≠tica de seguridad utilizada.
‚óè Vigencia: en los dos campos de vigencia se introducen el principio y el fin de la vigencia, en
funci√≥n de la hora del sistema.
‚óè Finalidad: TLS. Las extensiones "KeyUsage" y "ExtendedKeyUsage" para certificados del
est√°ndar X.509 V3 se insertan adecuadamente para OPC UA.
‚óè Nombre alternativo del titular del certificado (SAN): Direcci√≥n IP de las interfaces utilizadas.
Es posible sobrescribir los valores predeterminados con valores propios.

Certificados de los dispositivos del interlocutor
Para los certificados de los dispositivos del interlocutor puede seleccionar certificados de
dispositivo del administrador local de certificados. Los certificados de dispositivo se utilizan sin
su clave. Para conseguir una comunicaci√≥n segura en el proyecto, tambi√©n puede seleccionar
los certificados de otras CPU u otros CP. Los certificados de otras CPU u otros CP se cargan
en la CPU sin clave privada. Siempre que la cadena de certificados est√© disponible a trav√©s del
administrador global de certificados, la cadena de certificados pertenecientes a una CPU o un
CP no se interrumpir√° y la entidad emisora correspondiente y los certificados intermedios
permanecer√°n asignados a la CPU o al CP.
Si se borra un certificado en la tabla de certificados de los dispositivos del interlocutor, solo se
borrar√° el v√≠nculo del certificado al administrador global de certificados. Es decir, el certificado
ya no est√° disponible para el dispositivo pero sigue existiendo en el administrador global de
certificados. En caso necesario, en el dispositivo se puede acceder nuevamente al certificado
seleccion√°ndolo en la tabla como certificado nuevo desde el administrador global de
certificados. Si desea borrar el certificado en todo el proyecto, debe hacerlo a desde el men√∫
contextual del administrador global de certificados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1079

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Posibilidades de ajuste para funciones de seguridad (P√°gina 1077)
Crear certificados (P√°gina 1080)
Asignar certificados (P√°gina 1082)
Exportar certificados (P√°gina 1082)
Borrar certificados (P√°gina 1083)
Administrador de certificados de seguridad global (P√°gina 764)

Crear certificados
Introducci√≥n
Existe la posibilidad de crear un certificado nuevo para un dispositivo. Si se crea un certificado
nuevo estando desactivado el administrador global de certificados de seguridad, el certificado
solo es v√°lido para dicho dispositivo. Si se utiliza exclusivamente el administrador local de
certificados espec√≠fico de la CPU, solo se pueden crear certificados autofirmados.
Tambi√©n es posible crear certificados nuevos directamente en el servidor web o en OPC UA.

Requisitos
El dispositivo debe disponer de funciones de seguridad con administrador de certificados. Esto
rige para las CPU S7-1500 con firmware V2.0 o superior.

Procedimiento
Para crear un certificado nuevo, proceda del siguiente modo:
1. En la ventana de inspecci√≥n, navegue hasta "Protecci√≥n y seguridad > Administrador de
certificados" en las propiedades generales del dispositivo.
2. Haga clic en "Agregar" en la tabla de certificados. En la tabla se inserta una nueva fila.
3. Haga clic en la nueva fila. Se abre la selecci√≥n de nuevos certificados.
4. Haga clic en el bot√≥n "Agregar". Se abre el cuadro de di√°logo correspondiente, en el que
pueden introducirse los datos del nuevo certificado.
5. Seleccione c√≥mo debe firmarse el nuevo certificado:
‚Äì Autofirmado: Si desea emitir la firma usted mismo.
‚Äì Firmado por una entidad emisora (CA): Seleccione una entidad emisora de la lista
desplegable.

1080

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
6. Introduzca los par√°metros para el certificado:
‚Äì Titular del certificado: El titular del certificado es el dispositivo para el que rige el
certificado.
‚Äì V√°lido desde: El certificado es v√°lido a partir de la fecha mencionada.
‚Äì V√°lido hasta: El certificado ya no es v√°lido despu√©s de la fecha mencionada.
‚Äì Finalidad: En los certificados digitales del est√°ndar X.509 V3 , este valor se introduce en
las extensiones "KeyUsage" y "ExtendedKeyUsage".
‚Äì Nombre alternativo del titular del certificado (SAN).
7. Si hace clic en "Aceptar", el certificado nuevo se crea y se inserta en la tabla.
Nota
Certificados autofirmados
Junto con un certificado autofirmado se crea a la vez un cifrado para el recorrido, pero con ello
el receptor de un mensaje no tiene una confirmaci√≥n de si el emisor mencionado es realmente
el aut√©ntico emisor. Un mensaje firmado por una entidad emisora permite a un receptor
identificar como "aut√©ntico" a un emisor. Sin embargo, es posible crear un certificado
autofirmado para el dispositivo si a√∫n tiene que esperar a que llegue el certificado firmado de
una entidad emisora. Una vez recibido el certificado "oficial" por parte de la entidad emisora
(CA), a trav√©s del administrador global de certificados de seguridad en el √°rbol del proyecto
puede reemplazar el certificado autofirmado utilizado provisionalmente o bien renovarlo
especificando la entidad emisora. Por supuesto, tambi√©n puede conservar un certificado
autofirmado en el proyecto y abstenerse de utilizar un certificado CA "oficial".

Resultado
Se crea un certificado nuevo para el dispositivo. En las CPU S7-1500 se indica
autom√°ticamente "TLS" como finalidad. Esto sucede cuando se emite un certificado nuevo
autofirmado o cuando a trav√©s del administrador global de certificados de seguridad activado
se emite un certificado EE de la entidad emisora de certificados ra√≠z del TIA Portal.

ID de certificado
Cada certificado en el administrador de certificados recibe una ID. Esta ID se utiliza en los
siguientes casos para identificar los certificados:
‚óè Certificado de servidor OPC UA
‚óè Lista de los clientes OPC UA de confianza
‚óè Lista de los usuarios OPC UA de confianza
‚óè Certificado de servidor web
‚óè Instrucciones secure OUC
El administrador de certificados asigna la ID de certificado cuando se crea o importa un
certificado. Las ID de certificado son necesarias para poder asignar los certificados de forma
un√≠voca a determinados tipos de datos de sistema, por ejemplo a SDT TCON_IP_v4_Sec. La
ID de certificado es un√≠voca en el proyecto y no puede modificarse.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1081

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Administrador local de certificados espec√≠fico de la CPU (P√°gina 1078)

Asignar certificados
Introducci√≥n
En la ventana de inspecci√≥n es posible asignar certificados disponibles a las CPU y a los CP.

Requisitos
El dispositivo debe disponer de funciones de seguridad con administrador de certificados. Esto
rige para las CPU S7-1500 con firmware V2.0 o superior.

Procedimiento
Para asignar un certificado disponible a un dispositivo, proceda del siguiente modo:
1. En la ventana de inspecci√≥n, navegue hasta "Protecci√≥n y seguridad > Administrador de
certificados" en las propiedades generales del dispositivo.
2. Haga clic en "Agregar" en la tabla de certificados. En la tabla se inserta una nueva fila.
3. Haga clic en la nueva fila. Se abre la selecci√≥n de nuevos certificados.
4. Seleccione un certificado disponible. Si solo est√° activado el administrador local de
certificados espec√≠fico de la CPU, no podr√° ver los certificados globales disponibles. Los
certificados globales disponibles solo se pueden ver y seleccionar si est√° activado el
administrador global de certificados.
5. Haga clic en la marca de verificaci√≥n verde para introducir la selecci√≥n en la tabla de
certificados.

Resultado
Se ha asignado al dispositivo el certificado seleccionado.

Consulte tambi√©n
Administrador local de certificados espec√≠fico de la CPU (P√°gina 1078)

Exportar certificados
Introducci√≥n
A trav√©s del administrador de certificados del dispositivo se pueden exportar certificados
disponibles.

1082

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos
El dispositivo debe disponer de funciones de seguridad con administrador de certificados. Esto
rige para las CPU S7-1500 con firmware V2.0 o superior.

Procedimiento
Para exportar un certificado, proceda del siguiente modo:
1. En la ventana de inspecci√≥n, navegue hasta "Protecci√≥n y seguridad > Administrador de
certificados" en las propiedades generales del dispositivo.
2. Abra el men√∫ contextual haciendo clic con el bot√≥n derecho del rat√≥n en la fila que contiene
el certificado que desea exportar.
3. Haga clic en "Exportar certificado".
4. Exporte el certificado en uno de los formatos de archivo seleccionables: CER, DER.
Las claves privadas no pueden exportarse porque est√°n cifradas asim√©tricamente y no se
pueden restablecer.

Resultado
El certificado seleccionado se ha exportado y ahora puede utilizarse de forma segura o en
otros proyectos.

Consulte tambi√©n
Administrador local de certificados espec√≠fico de la CPU (P√°gina 1078)

Borrar certificados
Introducci√≥n
A trav√©s del administrador de certificados del dispositivo es posible borrar certificados
disponibles.

Requisitos
El dispositivo debe disponer de funciones de seguridad con administrador de certificados. Esto
rige para las CPU S7-1500 con firmware V2.0 o superior.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1083

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento
Para borrar un certificado, proceda del siguiente modo:
1. En la ventana de inspecci√≥n, navegue hasta "Protecci√≥n y seguridad > Administrador de
certificados" en las propiedades generales del dispositivo.
2. Abra el men√∫ contextual haciendo clic con el bot√≥n derecho del rat√≥n en la fila que contiene
el certificado que desea borrar.
3. Haga clic en "Borrar certificado".

Resultado
El certificado seleccionado se ha borrado del dispositivo. Si el administrador global de
certificados de seguridad est√° activado, el certificado sigue existiendo en el proyecto, aunque
no se utiliza m√°s para el dispositivo.

Consulte tambi√©n
Administrador local de certificados espec√≠fico de la CPU (P√°gina 1078)

Certificados para el servidor web
Introducci√≥n
En "Servidor web > Seguridad del servidor" de la ventana de inspecci√≥n es posible crear o
asignar un certificado de servidor para el servidor web.

Certificados de servidor web locales
Si se crean certificados de servidor web de forma local sin utilizar los ajustes globales de
seguridad para el administrador de certificados, rigen las restricciones siguientes:
‚óè El certificado solo es v√°lido para la CPU configurada y no est√° disponible para todo el
proyecto.
‚óè Se crean exclusivamente certificados autofirmados. Los certificados autofirmados no est√°n
integrados en una "Public Key Infrastructure" (PKI) y no pueden firmar otros certificados.
‚óè Las claves privadas del certificado no pueden exportarse.
‚óè Importar y renovar certificados solo es posible en los ajustes globales de seguridad para el
administrador de certificados.

Ajustes predeterminados para certificados de servidor web
Cuando se crea un certificado nuevo, en el cuadro de di√°logo correspondiente de un servidor
web se introducen de forma predeterminada los siguientes valores:
‚óè Titular del certificado: <Nombre de la CPU>/servidor web. El juego de caracteres est√°
limitado para cumplir las especificaciones de ASN.1.
‚óè Tipo de firma: sha256RSA o sha1RSA, en funci√≥n de la pol√≠tica de seguridad utilizada.

1084

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Vigencia: en los dos campos de vigencia se introducen el principio y el fin de la vigencia, en
funci√≥n de la hora del sistema.
‚óè Finalidad: Servidor web. Las extensiones "KeyUsage" y "ExtendedKeyUsage" para
certificados del est√°ndar X.509 V3 se insertan adecuadamente para el servidor web.
‚óè Nombre alternativo del titular del certificado (SAN): Direcci√≥n IP de las interfaces utilizadas
de la CPU y del CP.
Es posible sobrescribir los valores predeterminados con valores propios.
ATENCI√ìN
SAN con direcciones IP reservadas
Si el nombre alternativo del titular del certificado contiene una o m√°s direcciones IP
reservadas, el certificado no cumple con los requisitos de la directiva "Baseline Requirements
Certificate Policy for the Issuance and Management of Publicly-Trusted Certificates". Esto
puede generar incompatibilidades con algunos navegadores web.
Para cumplir los requisitos de esta directiva, las direcciones IP del nombre alternativo del
titular del certificado deben reemplazarse por nombres de dominio. Esto exige la existencia
de un servidor DNS en la red que resuelva las direcciones IP de los dispositivos.

Consulte tambi√©n
Posibilidades de ajuste para funciones de seguridad (P√°gina 1077)
Ejemplo: HTTP over TLS (P√°gina 761)

Certificados para servidor OPC UA
Introducci√≥n
En "OPC UA > Servidor > Security" de la ventana de inspecci√≥n es posible crear o asignar un
certificado de servidor para OPC UA .

Certificados de servidor locales para OPC UA
Si se crean certificados de servidor para OPC UA de forma local sin utilizar los ajustes globales
de seguridad para el administrador de certificados, rigen las restricciones siguientes:
‚óè El certificado solo es v√°lido para la CPU configurada y no est√° disponible para todo el
proyecto.
‚óè Se crean exclusivamente certificados autofirmados. Los certificados autofirmados no est√°n
integrados en una "Public Key Infrastructure" (PKI) y no pueden firmar otros certificados.
‚óè Las claves privadas del certificado no pueden exportarse.
‚óè Importar y renovar certificados solo es posible en los ajustes globales de seguridad para el
administrador de certificados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1085

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustes predeterminados para certificados de servidor
Cuando se crea un certificado nuevo, en el cuadro de di√°logo correspondiente de OPC UA se
introducen de forma predeterminada los siguientes valores:
‚óè Titular del certificado: <Nombre de la CPU>/OPCUA. El juego de caracteres est√° limitado
para cumplir las especificaciones de ASN.1.
‚óè Tipo de firma: sha256RSA o sha1RSA, en funci√≥n de la pol√≠tica de seguridad utilizada.
‚óè Vigencia: en los dos campos de vigencia se introducen el principio y el fin de la vigencia, en
funci√≥n de la hora del sistema.
‚óè Finalidad: OPC UA. Las extensiones "KeyUsage" y "ExtendedKeyUsage" para certificados
del est√°ndar X.509 V3 se insertan adecuadamente para OPC UA.
‚óè Nombre alternativo del titular del certificado (SAN): Direcci√≥n IP de las interfaces utilizadas
y la URI del servidor OPC UA.
Es posible sobrescribir los valores predeterminados con valores propios.

Consulte tambi√©n
Posibilidades de ajuste para funciones de seguridad (P√°gina 1077)

Test, puesta en servicio y routing
Test, puesta en servicio y routing
Active la casilla de verificaci√≥n si desea realizar con frecuencia funciones de programadora
necesarias para la puesta en marcha y el test, por ejemplo, utilizando esta interfaz.
Si se activa la opci√≥n "Test, puesta en servicio y routing", la interfaz se convertir√° en el
dispositivo activo en PROFIBUS (es decir, la interfaz participa en la rotaci√≥n del token de
PROFIBUS). En este caso ser√°n posibles las funciones siguientes:
‚óè Programar (p. ej. cargar)
‚óè Probar (estado/forzar)
‚óè Routing S7 (esclavo I como transici√≥n de red)
El tiempo de ciclo puede prolongarse. En aplicaciones cr√≠ticas y si no se necesitan el routing
S7 ni la funcionalidad de cliente para la comunicaci√≥n, no deber√≠a activarse esta opci√≥n.
Si la casilla de verificaci√≥n "Test, puesta en servicio y routing" no est√° activada, la interfaz solo
trabaja como servidor de servicios de comunicaci√≥n.
La funcionalidad de servidor significa que solo el interlocutor (p. ej. PG, OP o sistema de
automatizaci√≥n) puede iniciar la comunicaci√≥n. Las particularidades siguientes deben tenerse
en cuenta si la opci√≥n "Test, puesta en servicio y routing" no est√° activada:
‚óè No es posible el routing S7
‚óè La programaci√≥n y el test son posibles pero lentamente (sin prolongaci√≥n del tiempo de
ciclo)

1086

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Desactivar SNMP
El protocolo de gesti√≥n de red SNMP (Simple Network Management Protocol) es un protocolo
que utilizan diferentes servicios y herramientas para detectar y diagnosticar la topolog√≠a de
red. SNMP usa el protocolo de transporte UDP. SNMP conoce dos componentes de red, el
administrador SNMP y el cliente SNMP. El administrador SNMP vigila los nodos de la red. Los
clientes SNMP recopilan en los diversos nodos de red diversa informaci√≥n espec√≠fica de la red
y la depositan de forma estructurada en la MIB (Management Information Base). Estos datos
permiten a diferentes servicios y herramientas ejecutar un diagn√≥stico detallado de la red.
En determinadas ocasiones puede ser aconsejable desactivar SNMP. Ejemplos:
‚óè Las normas de seguridad de la red no permiten utilizar SNMP.
‚óè Se utiliza una soluci√≥n SNMP propia, p. ej. por medio de instrucciones de comunicaci√≥n
propias.
Si se desactiva SNMP para un dispositivo ya no estar√°n disponibles algunas posibilidades de
diagn√≥stico para la topolog√≠a de red (p. ej. mediante la herramienta PRONETA o mediante el
servidor web de la CPU).

Requisitos
‚óè CPU S7-1200 V4.1 o superior
‚óè CPU S7-1500 V1.8 o superior

Desactivar SNMP
Para desactivar SNMP proceda del siguiente modo:
1. Cree en STEP 7 un bloque de datos que contenga la estructura del juego de datos F003H.
La tabla siguiente muestra la estructura del juego de datos F003H.
Byte

Elemento

Codificaci√≥n

Explicaci√≥n

0-1

BlockID

F003H

Encabezado

2-3

BlockLength

8

4

Version

01H

La longitud del juego de datos
se cuenta a partir del byte 4
"Versi√≥n".

5

Subversion

00H

6-7

Reservado

-

-

8-11

Controlador SNMP

Desactivaci√≥n/activaci√≥n
de SNMP

Si desea desactivar SNMP, in‚Äê
troduzca el valor 0.
Si desea activar SNMP, intro‚Äê
duzca el valor 1.

2. Transfiera el juego de datos F003H del OB de arranque (OB100) a la CPU con la instrucci√≥n
WRREC (escribir juego de datos). Utilice como ID de hardware una interfaz integrada de la
CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1087

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Desactivar SNMP: ejemplo para una CPU 1516-3 PN/DP
Introducci√≥n
Puesto que las normas de seguridad de la red no permiten SNMP, para una CPU 1516-3 PN/
DP debe desactivarse SNMP.

Requisitos
‚óè CPU 1516‚Äë3 PN/DP con versi√≥n de firmware V2.0
‚óè STEP 7 V14

1088

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Desactivar SNMP
Para desactivar SNMP para la CPU 1516-3 PN/DP, proceda del siguiente modo:
1. Cree un bloque de datos que contenga la estructura del juego de datos B071H. La figura
siguiente muestra el bloque de datos "Deactivate SNMP". Adem√°s del juego de datos
B071H, el bloque de datos "Deactivate SNMP" contiene otras variables que se utilizan para
transferir el juego de datos. La variable "snmp_deactivate" sirve para lanzar la petici√≥n de
WRREC. Deposite esta variable en el √°rea de memoria remanente para que el valor
tambi√©n est√© disponible en el OB de arranque (OB100).

2. Transfiera el juego de datos B071H del OB de arranque (OB100) a la CPU 1516-3 PN/DP
con la instrucci√≥n WRREC (escribir juego de datos). En el siguiente c√≥digo del programa,
el juego de datos B071H se transfiere con la instrucci√≥n WRREC en un bucle REPEAT
UNTIL.
ORGANIZATION_BLOCK "Startup"
TITLE = "Complete Restart"
{ S7_Optimized_Access := 'TRUE' }
VERSION : 0.1
BEGIN
REPEAT
"WRREC_DB_1"
(REQ := "Deactivate
SNMP".snmp_deactivate,
//Transfer data record
INDEX:=16#b071,
//Data record number for SNMP deactivation
ID:="Local~PROFINET_interface_1",
//any integrated PROFINET Interface
DONE => "Deactivate SNMP".snmp_done,
ERROR => "Deactivate SNMP".snmp_error,
STATUS => "Deactivate SNMP".snmp_status,
RECORD := "Deactivate
SNMP".snmp_record)
//Data record
UNTIL "Deactivate SNMP".snmp_done OR "Deactivate SNMP".snmp_error
END_REPEAT;
END_ORGANIZATION_BLOCK

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1089

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Activar de nuevo SNMP
Si los cambios son peque√±os, es posible utilizar el c√≥digo del programa usado anteriormente
para activar SNMP. En el programa de usuario asigne el valor "1" a la variable "Deactivate
SNMP".snmp_record.SNMPControl:
"Deactivate SNMP".snmp_record.SNMPControl := 1;
En el siguiente arranque de la CPU se activar√° de nuevo SNMP.

Desactivar SNMP: ejemplo completo del programa
Introducci√≥n
El ejemplo es v√°lido para S7-1500 y S7-1200.
Para incorporar el c√≥digo del programa al proyecto, proceda del siguiente modo:
1. Copie todo el c√≥digo del programa en el portapapeles.
2. Abra un editor de textos (p. ej. "Editor").
3. Inserte el contenido del portapapeles en el editor de textos con el comando Ctrl+V. Guarde
el documento como archivo scl, p. ej. SNMP_DEACT.scl.
4. Abra el proyecto en STEP 7.
5. Importe el archivo scl como fuente externa.
6. Cree el OB de arranque y los bloques de datos.
7. Haga clic con el bot√≥n derecho del rat√≥n en el archivo scl y elija "Generar bloque a partir de
fuente" en el men√∫ contextual.

Ejemplo de programa con llamada de WRREC en el OB 100
DATA_BLOCK "Deactivate_SNMP"
{ S7_Optimized_Access := 'TRUE' }
VERSION : 0.1
NON_RETAIN
VAR
snmp_deactivate : Bool;
snmp_record : Struct
BlockID : UInt;
BlockLength : UInt;
"Version" : USInt;
Subversion : USInt;
Reserved : UInt;
SNMPControl : UDInt;
END_STRUCT;
snmp_done : Bool;
snmp_error : Bool;
snmp_Status : DWord;
END_VAR
BEGIN
snmp_deactivate := true;

1090

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
snmp_record.BlockID := 16#f003;
snmp_record.BlockLength := 8;
snmp_record."Version" := 1;
END_DATA_BLOCK
ORGANIZATION_BLOCK "Startup"
TITLE = "Complete Restart"
{ S7_Optimized_Access := 'TRUE' }
VERSION : 0.1
BEGIN
REPEAT
"WRREC_DB_1"(REQ := "Deactivate_SNMP".snmp_deactivate,
ID := "Local~PROFINET-Schnittstelle_1",
INDEX := 16#b071,
DONE => "Deactivate_SNMP".snmp_done,
ERROR => "Deactivate_SNMP".snmp_error,
STATUS => "Deactivate_SNMP".snmp_Status,
RECORD := "Deactivate_SNMP".snmp_record);
UNTIL "Deactivate_SNMP".snmp_done OR "Deactivate_SNMP".snmp_error
END_REPEAT;
END_ORGANIZATION_BLOCK
DATA_BLOCK "WRREC_DB_1"
{OriginalPartName := 'WRREC';
VersionGUID := 'bc169451-58cd-44a3-855b-3f78cc0623c8';
S7_Optimized_Access := 'TRUE' }
AUTHOR : SIMATIC
FAMILY : DP
NAME : WRREC
VERSION : 1.0
NON_RETAIN
WRREC
BEGIN
END_DATA_BLOCK

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1091

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Modo is√≥crono (central)
Configuraci√≥n del modo is√≥crono para periferia centralizada en S7-1500
Al configurar el modo is√≥crono de un m√≥dulo enchufado centralmente en una estaci√≥n
S7-1500, p. ej. un m√≥dulo de entradas anal√≥gicas, en principio debe procederse igual que al
configurar un m√≥dulo enchufado de forma descentralizada:
‚óè En las propiedades de los m√≥dulos de periferia debe activarse el modo is√≥crono, asignarse
las direcciones del m√≥dulo a una memoria imagen parcial de proceso y asignarse dicha
memoria imagen parcial de proceso al OB de alarma de sincronismo.
‚óè En las propiedades del OB de alarma de sincronismo se modifican el ciclo de aplicaci√≥n y
el tiempo de retardo (recomendaci√≥n: dejar el ajuste autom√°tico).
‚óè En las propiedades de la CPU tambi√©n se debe activar el modo is√≥crono y cambiar los
ajustes del tiempo de ciclo de emisi√≥n y los valores Ti/To.
La novedad es que puede seleccionarse un modo de sincronizaci√≥n: aqu√≠ se configura si la
CPU debe utilizar un tiempo de ciclo de emisi√≥n local o si el tiempo de ciclo de emisi√≥n para
los m√≥dulos enchufados centralmente debe sincronizarse con el tiempo de ciclo de emisi√≥n
de la interfaz PROFINET X1. En este √∫ltimo caso siempre es determinante el tiempo de
ciclo de emisi√≥n de la interfaz PROFINET.

Requisitos
‚óè CPU S7-1500 con firmware V2.6 o superior (sin CPU compactas y sin CPU S7-1500R/H)
‚óè STEP 7 (TIA Portal) V15.1 o superior
‚óè M√≥dulos is√≥cronos enchufados centralmente
‚óè No debe haber sistemas PROFINET IO y PROFIBUS DP en procesadores de
comunicaciones (CP) o m√≥dulos de comunicaci√≥n (CM) enchufados centralmente
‚óè No debe haber procesadores de comunicaciones (CP) o m√≥dulos de comunicaci√≥n (CM)
como I-sevices o I-slaves en la configuraci√≥n centralizada

Procedimiento b√°sico
Configuraci√≥n de la periferia y el OB de alarma de sincronismo
Para configurar una conexi√≥n is√≥crona de la periferia y el programa de usuario, proceda del
siguiente modo:
1. Seleccione la CPU S7-1500 en la vista de redes de STEP 7.
2. Si se ha actualizado el firmware de la CPU S7-1500 desde una versi√≥n anterior, debe
actualizarse la descripci√≥n del m√≥dulo:
‚Äì Abra las "Propiedades" de los m√≥dulos.
‚Äì Haga clic en el bot√≥n "Actualizar descripci√≥n del m√≥dulo" de la ficha "General >
Informaci√≥n del cat√°logo".
3. Cambie a la vista de dispositivos.
4. Inserte un m√≥dulo de periferia que pueda funcionar en modo is√≥crono (p. ej., AI 8 x U/I HS).

1092

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. En la ventana de inspecci√≥n del m√≥dulo de periferia seleccionado, vaya a la secci√≥n
"Direcciones E/S".
6. En la secci√≥n "Direcciones E/S" realice los ajustes siguientes:
‚Äì Active la opci√≥n "Modo is√≥crono".
‚Äì Seleccione una memoria imagen parcial de proceso, p. ej. Memoria imagen parcial de
proceso 1.
‚Äì Haga clic en la lista desplegable "Bloque de organizaci√≥n" y despu√©s haga clic en el
bot√≥n "Agregar objeto" o seleccione un OB existente. Se abre un cuadro de di√°logo para
seleccionar los bloques de organizaci√≥n.
‚Äì Seleccione el OB "Synchronous Cycle". Confirme la selecci√≥n con "OK".
Si hay asignaci√≥n autom√°tica de n√∫meros, se genera y se abre el OB 61. En la ventana
de inspecci√≥n est√° seleccionado el apartado "Modo is√≥crono", con lo que puede
proceder a configurar el ciclo de aplicaci√≥n y el tiempo de retardo y a programar el OB
en la parte de instrucciones.
7. Si la instalaci√≥n is√≥crona solo funciona con un tiempo de ciclo de emisi√≥n determinado
(p. ej., 1 ms) debido a los m√≥dulos empleados, pero los valores de proceso deben
muestrearse m√°s r√°pido, debe utilizarse la funci√≥n Oversampling. En los m√≥dulos que
soportan esta funci√≥n, realice un muestreo de los valores de proceso para los canales, p.
ej. de un m√≥dulo de entradas anal√≥gicas, en intervalos m√°s breves.
8. Inserte los m√≥dulos de periferia que necesite en la vista de dispositivos. Adapte la
configuraci√≥n y los ajustes is√≥cronos.
Configuraci√≥n de la CPU
1. Seleccione la CPU en la vista de dispositivos de STEP 7 para comprobar los ajustes del
modo is√≥crono.
2. En la ventana de inspecci√≥n de la CPU seleccionada, vaya a la secci√≥n "Configuraci√≥n
avanzada > Modo is√≥crono".
3. En la secci√≥n "Modo is√≥crono para m√≥dulos locales" compruebe lo siguiente:
‚Äì Si el modo is√≥crono est√° seleccionado
‚Äì Si el tipo de sincronizaci√≥n seleccionado es "Ciclo de emisi√≥n local", en caso de que el
modo is√≥crono solo deba aplicarse a los m√≥dulos enchufados centralmente
Si el tipo de sincronizaci√≥n seleccionado es "Utilizar ciclo de emisi√≥n de la interfaz
PROFINET", en caso de que el tiempo de ciclo de emisi√≥n de los m√≥dulos enchufados
centralmente deba sincronizarse con el tiempo de ciclo de emisi√≥n de la interfaz
PROFINET X1.
Si es necesario, se pueden adaptar el tiempo de ciclo de emisi√≥n y los tiempos Ti/To a la
lectura/emisi√≥n is√≥crona de datos.
4. En la secci√≥n "Vista detallada" se muestran todos los m√≥dulos de la configuraci√≥n que
admiten el modo is√≥crono. De acuerdo con ello, seleccione o deseleccione el modo
is√≥crono para los m√≥dulos deseados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1093

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Configuraci√≥n del modo is√≥crono tras actualizar el firmware
Si despu√©s de actualizar un proyecto y el firmware de la CPU S7-1500 a la √∫ltima versi√≥n no
es posible configurar el modo is√≥crono de los m√≥dulos centralizados, actualice la descripci√≥n
de los diferentes m√≥dulos. Para ello, abra las "Propiedades" de los m√≥dulos y haga clic en el
bot√≥n "Actualizar descripci√≥n del m√≥dulo" de la ficha "General > Informaci√≥n del cat√°logo".
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Modificar o actualizar un componente de hardware
(P√°gina 62)".

Consulte tambi√©n
Resumen de las propiedades de la CPU (P√°gina 1024)

Secuencia temporal de la sincronizaci√≥n en una configuraci√≥n centralizada
Desde la lectura de los datos de entrada hasta la emisi√≥n de los datos de salida
A continuaci√≥n se explica el principio del proceso de ejecuci√≥n de todos los componentes
involucrados en la sincronizaci√≥n:

‚ë† Detecci√≥n del valor medido en el proceso
‚ë° Lectura is√≥crona de los valores medidos (datos de entrada) por la periferia centralizada
‚ë¢ Transporte de los datos de entrada a la CPU
‚ë£ Procesamiento posterior de los datos de entrada en la aplicaci√≥n is√≥crona de la CPU (OB

6x)

‚ë§ Transporte de los datos de salida a la periferia centralizada
‚ë• Emisi√≥n is√≥crona de los datos de salida

1094

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

79

&38



$SOLFDFL¬µQ


7UDQVSRUWHGHORVGDWRVGHHQWUDGDDOD&38

%XVGHIRQGR

7UDQVSRUWHGHORVGDWRVGHVDOLGD
DOP¬µGXORGHSHULIHULD




0¬µGXORGHSHULIHULD

7,

72

7B'&



3URFHVR

3URFHVR

Para que todos los datos de entrada est√©n listos para el transporte a la CPU la pr√≥xima vez que
empiece el ciclo, el ciclo de lectura de la periferia empieza anticipadamente con un tiempo de
preprocesamiento Ti. Ti es el "flash" para las entradas. A continuaci√≥n se leen todas las
entradas sincronizadas. Ti es necesario para compensar la conversi√≥n anal√≥gica-digital y
similares. El tiempo de preprocesamiento Ti puede ser configurado por STEP 7 o por el usuario.
Haga que STEP 7 determine autom√°ticamente el tiempo de preprocesamiento Ti. Con la
configuraci√≥n predeterminada, STEP 7 asegura que se ajuste un Ti m√≠nimo com√∫n.
El bus de fondo transporta los datos de entrada a la CPU. La aplicaci√≥n se inicia de forma
sincronizada con el ciclo. Es decir, el OB de alarma de sincronismo se llama pasado un tiempo
de retardo parametrizable TV. El programa de usuario en el OB de alarma de sincronismo
determina la reacci√≥n del proceso y prepara los datos de salida a tiempo para el comienzo del
pr√≥ximo ciclo de datos. La longitud del ciclo de datos (tiempo de ciclo de emisi√≥n) siempre es
configurada por el usuario.
Dentro del tiempo To, los datos:
‚óè se transportan al m√≥dulo de periferia a trav√©s del bus de fondo
‚óè se procesan en el m√≥dulo de periferia, p. ej., se convierten a un valor anal√≥gico
Una vez transcurrido To, se env√≠an los datos al proceso.
El tiempo To puede ser configurado por STEP 7 o por el usuario. Haga que STEP 7 determine
autom√°ticamente el tiempo de preprocesamiento To. STEP 7 calcula autom√°ticamente el To
com√∫n m√≠nimo posible.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1095

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Bloques de organizaci√≥n
Informaci√≥n de arranque del OB
Estructura de la informaci√≥n de arranque del OB
Al parametrizar las propiedades de un OB para CPU S7-1500, se define tambi√©n la estructura
de la informaci√≥n de arranque del OB:
‚óè Como en las CPU S7-300 y S7-400
‚óè Informaci√≥n de arranque optimizada

Informaci√≥n de arranque del OB como en las CPU S7-300 y S7-400
La informaci√≥n de arranque del OB forma parte de los datos locales y tiene la misma estructura
que en las CPU S7-300 y S7-400.

Informaci√≥n de arranque optimizada
La informaci√≥n de arranque optimizada es un juego de variables de entrada.
Solamente proporciona la informaci√≥n necesaria para identificar el evento de arranque del OB.
En los distintos OB, la informaci√≥n que sea id√©ntica en cuanto a sem√°ntica se mostrar√° bajo
el mismo nombre de variable dentro de la informaci√≥n de arranque optimizada.

Descripci√≥n de todos los tipos de bloques de organizaci√≥n
OBs de arranque
Descripci√≥n
El sistema operativo llama una sola vez a cada OB de arranque al conmutar del estado "STOP"
a "RUN". Si existen varios OB de arranque, se llaman de acuerdo con el orden de sus n√∫meros
de OB, empezando con el OB que tiene el n√∫mero m√°s bajo.
El conjunto de todos los OB de arranque se denomina programa de arranque.
En el programa de arranque se pueden realizar ajustes predeterminados para su programa
c√≠clico.
Aqu√≠, todos los valores de la memoria imagen de proceso de las entradas tienen el valor cero.
La ejecuci√≥n del programa de usuario no est√° limitada en el tiempo. No es posible utilizar
bloques de organizaci√≥n controlados por tiempo ni por alarmas.
Una vez que el programa de arranque se ha procesado completamente, el sistema operativo
lee la memoria imagen de proceso de las entradas e inicia el programa c√≠clico.

1096

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la informaci√≥n de arranque
Un OB de arranque tiene la siguiente informaci√≥n de arranque:
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì OB_NUMBR=B#16#FF, si el n√∫mero de OB es > 254
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

LostRetentive

BOOL

=TRUE, si se han perdido los contenidos de las √°reas de datos rema‚Äê
nentes

LostRTC

BOOL

=TRUE, si se ha perdido la hora del reloj en tiempo real

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OBs de ciclo
Descripci√≥n
La base principal del programa de usuario es el programa c√≠clico. Sus partes de programa
correspondientes se procesan c√≠clicamente: cuando finaliza su procesamiento, el sistema
operativo lo vuelve a comenzar.
El programa c√≠clico presenta uno o varios OB de ciclo. Estos OB tienen la prioridad 1, es decir,
la prioridad m√°s baja de todos los OB. Por tanto, los eventos de cualquier otra clase de
prioridad pueden interrumpir el programa c√≠clico.
Si ha creado varios OB de ciclo, estos se llaman uno tras otro en el orden correspondiente a
su n√∫mero de OB. El OB de ciclo con el menor n√∫mero de OB se llama primero.
Los siguientes eventos inician el programa c√≠clico:
‚óè Fin del procesamiento del arranque
‚óè Fin del procesamiento de la ejecuci√≥n anterior del programa c√≠clico
Una vez finalizado el programa c√≠clico, el sistema operativo actualiza las memorias imagen de
proceso como sigue:
1. Escribe los valores de la memoria imagen de proceso de las salidas en los m√≥dulos de
salidas.
2. Lee las entradas de los m√≥dulos de entradas y las transfiere a la memoria imagen de
proceso de las entradas.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1097

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Vigilancia del tiempo de ciclo
Por tiempo de ciclo se entiende el tiempo de ejecuci√≥n del programa c√≠clico m√°s el tiempo de
ejecuci√≥n de todas las partes de programa conectadas de los OB de mayor prioridad. Por
tanto, si ha creado varios OB de ciclo, cada uno de ellos contribuye al tiempo de ciclo.
El sistema operativo vigila si el tiempo de ciclo permanece por debajo del tiempo de ciclo
m√°ximo parametrizado. En caso de que el tiempo de ciclo exceda el tiempo de ciclo m√°ximo,
se llama al OB 80 (evento de arranque W#16#0002:3501). Esto puede evitarse iniciando de
nuevo la vigilancia de tiempo en el punto adecuado del programa, es decir, llamando la
instrucci√≥n RE_TRIGR. Si el tiempo de ciclo m√°ximo se excede una segunda vez dentro de un
ciclo (sin reiniciar la vigilancia de tiempo), la CPU pasa a STOP (evento W#16#0002:3500).

Tiempo de ciclo m√≠nimo
Adem√°s de vigilar el tiempo de ciclo m√°ximo, tambi√©n se garantiza el mantenimiento de un
tiempo de ciclo m√≠nimo. Para ello, el sistema operativo retarda el inicio de un ciclo nuevo hasta
que se ha alcanzado el tiempo de ciclo m√≠nimo.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì SCAN_1=B#16#01 para la primera llamada y B#16#03 para las otras llamadas
‚Äì OB_NUMBR=B#16#FF, si el n√∫mero de OB es > 254
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de datos

Initial_Call

BOOL

Significado
=TRUE en la primera llamada de este OB con:
‚óè Transici√≥n de STOP o PARADA a RUN
‚óè Tras recargar

Remanence

BOOL

=TRUE si existen datos remanentes

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Evaluaci√≥n del estado de valor (P√°gina 1008)
Informaci√≥n de arranque del OB (P√°gina 1096)

1098

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OBs de alarma horaria
Descripci√≥n
Las CPU S7-1500 disponen de OB de alarma horaria que pueden iniciarse como sigue:
‚óè Una sola vez a una hora determinada (fecha con hora)
‚óè Peri√≥dicamente (aqu√≠ son posibles los intervalos de tiempo siguientes: cada minuto, cada
hora, cada d√≠a, cada semana, cada mes, a finales de mes, cada a√±o)

Inicio de un OB de alarma horaria
Para que la CPU pueda iniciar un OB de alarma horaria se deben cumplir los siguientes
requisitos:
‚óè La alarma horaria correspondiente debe haberse ajustado y activado previamente. (Por
ajuste de una alarma horaria se entiende la especificaci√≥n de su hora de inicio y la duraci√≥n
del per√≠odo).
‚óè El OB de alarma horaria debe estar cargado en la CPU.
Para ajustar una alarma horaria y activarla, tiene las siguientes tres opciones:
‚óè Ajustar y activar la alarma horaria con STEP 7.
‚óè Ajustar la alarma horaria con STEP 7 y activarla llamando la instrucci√≥n ACT_TINT desde
el programa.
‚óè Ajustar la alarma horaria llamando la instrucci√≥n SET_TINTL y activarla llamando la
instrucci√≥n ACT_TINT cada vez desde el programa.

Reglas para alarmas horarias
‚óè Si se ajusta una alarma horaria en la que el OB correspondiente debe ejecutarse una √∫nica
vez, la hora de inicio no podr√° encontrarse en el pasado (referido al reloj en tiempo real de
la CPU).
‚óè Si se ajusta una alarma horaria en la que el OB correspondiente debe ejecutarse de forma
peri√≥dica, pero que tiene la hora de inicio en el pasado, el OB de alarma horaria se ejecutar√°
seg√∫n la hora actual cuando venza la siguiente hora.
‚óè La fecha de las alarmas horarias peri√≥dicas debe corresponder a una fecha real. As√≠, por
ejemplo, la repetici√≥n mensual de un OB de alarma horaria con fecha de inicio 31.1. no ser√≠a
posible. En tal caso, el OB solo se iniciar√≠a en los meses que tuvieran 31 d√≠as.
‚óè Una alarma horaria que se activa durante el arranque no se ejecutar√° hasta que finalice el
arranque.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1099

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Un arranque borra todas las alarmas horarias que se han ajustado y activado por medio de
instrucci√≥n en el programa de usuario.
‚óè En la transici√≥n de PARADA a RUN, el sistema operativo comprueba si existen alarmas
horarias expiradas. En caso afirmativo, llama al OB de error de tiempo. Si se ha
seleccionado la misma informaci√≥n de arranque para este OB que para las CPU S7-300 y
S7-400, el sistema operativo registra de 10 a 17 para los OB (y solo para estos) si las
alarmas horarias han pasado. Una vez finalizado el procesamiento del OB 80 se recupera
el primer OB que haya fallado.

Comportamiento de las alarmas horarias al adelantar o retrasar la hora
El comportamiento de las alarmas horarias depende de la diferencia de tiempo con que se
adelanta o retrasa la hora. Esto se explica m√°s detalladamente en la siguiente tabla:
Cambio de hora

Repercusi√≥n en la alarma horaria

< 20 s

‚óè Al adelantar el reloj: se recupera cualquier alarma horaria
que se haya saltado. La variable de informaci√≥n de
arranque CaughtUp se activa. No se llama a OB 80.
‚óè Al retrasar el reloj: las alarmas horarias que ya se hab√≠an
ejecutado en el intervalo de la hora retrasada o que
estaban activas no se repiten.

> > = 20 s

‚óè Al adelantar el reloj: si se hab√≠an saltado una o varias
alarmas horarias, se llama a OB 80. La informaci√≥n de
arranque proporciona para cada prioridad la informaci√≥n
cuando se ha saltado m√≠nimo una alarma horaria. Si no se
borra la alarma horaria en el OB 80, se recupera la
primera alarma horaria que se haya saltado y se activa la
variable de informaci√≥n de arranque "CaughtUp".
‚óè Al retrasar el reloj: se repiten las alarmas horarias
situadas en el intervalo de la hora retrasada. Si la
correcci√≥n de tiempo es mayor que el periodo de una
alarma horaria, el sistema operativo calcula la hora de la
primera alarma que debe repetirse. Cuando se repite una
alarma horaria, la variable de informaci√≥n de arranque
"SecondTime" est√° activa.

1100

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Cambio de hora

Repercusi√≥n en la alarma horaria

Cambio del horario de invierno al horario de verano y vice‚Äê
versa

El cambio repercute √∫nicamente cuando se utiliza la hora
local.
‚óè Cuando se cambia del horario de invierno al de verano, se
recuperan las alarmas horarias que se hayan saltado y se
activa la variable de informaci√≥n de arranque
"CaughtUp". No se llama al OB 80.
‚óè Cuando se cambia del horario de verano al de invierno,
las alarmas horarias situadas en el intervalo de la hora
retrasada se repiten. Cuando se repite una alarma
horaria, la variable de informaci√≥n de arranque
"SecondTime" est√° activa.

Cambio de la zona horaria (provoca el cambio de la hora local) La hora de inicio de las alarmas horarias activas vuelve a
calcularse.
‚óè Cuando se cambia la hora local, se recuperan las alarmas
horarias que se hayan saltado y se activa la variable de
informaci√≥n de arranque "CaughtUp". No se llama al
OB 80.
‚óè Si se retrasa la hora local, las alarmas horarias que ya se
han ejecutado se repiten seg√∫n sea necesario. Cuando
se repite una alarma horaria, la variable de informaci√≥n de
arranque "SecondTime" est√° activa.

Vigilancia de tiempo
La vigilancia de tiempo por parte del sistema operativo puede provocar los siguientes eventos
al trabajar con alarmas horarias:
‚óè W#16#0002:3504
La hora se ha adelantado debido al cambio de horario de invierno/verano. Con ello se
puede haber saltado la hora de inicio de algunas alarmas horarias. Se llama el OB 80.
‚óè W#16#0002:3505
La hora se ha retrasado. Con ello se puede haber saltado la hora de inicio de algunas
alarmas horarias. Se llama el OB 80.
‚óè W#16#0002:3507
Desbordamiento del b√∫fer para eventos de arranque de OB. Se realiza una entrada en el
b√∫fer de diagn√≥stico.
‚óè W#16#0002:3502
El n√∫mero de eventos de arranque de OB pendientes supera un l√≠mite predeterminado. Se
llama el OB 80.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1101

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì STRT_INF=B#16#1F, si el n√∫mero de OB es > 122
‚Äì OB_NUMBR=B#16#FF, si el n√∫mero de OB es > 254
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

CaughtUp

BOOL

=TRUE, si se ha ejecutado un OB a posteriori por haberse adelantado
la hora

SecondTime

BOOL

=TRUE, si se ha llamado a un OB por segunda vez debido al retraso
de la hora. Nota: SecondTime se activa una √∫nica vez con la hora
retrasada.

Consulte tambi√©n
Parametrizar OB de alarma horaria (P√°gina 1131)
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de alarma de estado
Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB de alarma de estado cuando recibe una
alarma de este tipo. Esto puede suceder cuando un m√≥dulo de un esclavo cambia de estado
operativo, p. ej., de "RUN" a "STOP". Puede obtenerse m√°s informaci√≥n sobre los eventos que
originan una alarma de estado en la documentaci√≥n del fabricante del esclavo o dispositivo.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada:

1102

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre

Tipo de datos

Significado

LADDR

HW_IO

Identificador de hardware del componente que ha disparado la alarma

Slot

UINT

N√∫mero de slot del componente causante de la alarma

Specifier

WORD

Especificador de alarma del telegrama de alarma:
‚óè PROFIBUS:
‚Äì

Bits 0 a 1: Alarm-Specifier

‚Äì

Bit 2: Add_Ack

‚Äì

Bits 3 a 7: n.¬∫ de sec.

‚Äì

Bits 8 a 15: reservados

‚óè Central y PNIO:
‚Äì

Bits 0 a 10: n√∫mero de secuencia (rango de valores de 0 a 2047)

‚Äì

Bits 11 a 15: 0

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de alarma de actualizaci√≥n
Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB de alarma de actualizaci√≥n cuando recibe
una alarma de este tipo. Esto puede suceder cuando se han modificado par√°metros en un slot
de un esclavo o dispositivo. Puede obtenerse m√°s informaci√≥n sobre los eventos que originan
una alarma de actualizaci√≥n en la documentaci√≥n del fabricante del esclavo o dispositivo.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1103

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre

Tipo de datos

Significado

LADDR

HW_IO

Identificador de hardware del componente que ha disparado la alarma

Slot

UINT

N√∫mero de slot del componente causante de la alarma

Specifier

WORD

Especificador de alarma del telegrama de alarma:
‚óè PROFIBUS:
‚Äì

Bits 0 a 1: Alarm-Specifier

‚Äì

Bit 2: Add_Ack

‚Äì

Bits 3 a 7: n.¬∫ de sec.

‚Äì

Bits 8 a 15: reservados

‚óè Central y PNIO:
‚Äì

Bits 0 a 10: n√∫mero de secuencia (rango de valores de 0 a 2047)

‚Äì

Bits 11 a 15: 0

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB para la alarma espec√≠fica del fabricante o perfil
Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB57 cuando recibe una alarma espec√≠fica
del fabricante o del perfil. Puede obtenerse m√°s informaci√≥n sobre los eventos que originan
una alarma de este tipo en la documentaci√≥n del fabricante del esclavo o dispositivo.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì STRT_INF=B#16#67
‚óè Informaci√≥n de arranque optimizada:

1104

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre

Tipo de datos

Significado

LADDR

HW_IO

Identificador de hardware del componente que ha disparado la alarma

Slot

UINT

N√∫mero de slot del componente causante de la alarma

Specifier

WORD

Especificador de alarma del telegrama de alarma:
‚óè PROFIBUS:
‚Äì

Bits 0 a 1: Alarm-Specifier

‚Äì

Bit 2: Add_Ack

‚Äì

Bits 3 a 7: n.¬∫ de sec.

‚Äì

Bits 8 a 15: reservados

‚óè Central y PNIO:
‚Äì

Bits 0 a 10: n√∫mero de secuencia (rango de valores de 0 a 2047)

‚Äì

Bits 11 a 15: 0

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de alarma de retardo
Descripci√≥n
El sistema operativo llama a un OB de alarma de retardo al cabo de un tiempo de retardo
parametrizable. El tiempo de retardo comienza a transcurrir con la llamada de la instrucci√≥n
"SRT_DINT" (es el arranque de la alarma de retardo correspondiente).
Para que el sistema operativo pueda llamar a un OB de alarma de retardo, deben cumplirse los
siguientes requisitos:
‚óè La alarma de retardo debe haber sido activada llamando a la instrucci√≥n "SRT_DINT".
‚óè El OB de alarma de retardo no debe haber sido desactivado mediante configuraci√≥n.
El OB de alarma de retardo debe estar presente en la CPU.

Influir en las alarmas de retardo con instrucciones
Se puede anular una alarma de retardo ya arrancada, cuyo OB de alarma de retardo todav√≠a
no haya sido llamado por el sistema operativo, con la instrucci√≥n "CAN_DINT", o volver a
arrancarla con la instrucci√≥n "SRT_DINT" (y, de este modo, asignarle otro tiempo de retardo).
Asimismo, la instrucci√≥n "QRY_DINT" permite consultar el estado actual de una alarma de
retardo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1105

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las alarmas de retardo se pueden inhibir y habilitar con las instrucciones "DIS_AIRT" y
"EN_AIRT", respectivamente.
Nota
Si tras ejecutar "SRT_DINT", inhibe esta alarma con "DIS_AIRT", no se seguir√° procesando
hasta habilitarla con "EN_AIRT", por lo que el tiempo de retardo se prolongar√° de forma
correspondiente.

Llamada de OB de error en relaci√≥n con OB de alarma de retardo
Si transcurre el tiempo de retardo de una alarma de retardo antes de que finalice el
procesamiento del OB de alarma de retardo correspondiente, el sistema operativo genera un
error de tiempo (llamada del OB80).

Procesamiento de alarmas de retardo seg√∫n el estado operativo
La llamada de "SRT_DINT" y, con ello, el transcurso del tiempo de retardo pueden producirse
tanto en el arranque como en RUN. En cambio, los OB de alarma de retardo solo se procesan
en el estado operativo RUN. Por este motivo, cuando el arranque de una alarma de retardo se
produce en un OB de arranque y el tiempo de retardo ya ha transcurrido antes de que la CPU
est√© en RUN, la llamada del OB de alarma de retardo correspondiente se retrasa hasta que la
CPU est√© en RUN.
El arranque en fr√≠o y el arranque en caliente borran cualquier evento de arranque de un OB de
alarma de retardo.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì STRT_INF=B#16#2F, si el n√∫mero de OB es > 122
‚Äì OB_NUMBR=B#16#FF, si el n√∫mero de OB es > 254
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de datos

Significado

Sign

WORD

Identificador de usuario: par√°metro de entrada SIGN de la llamada de la
instrucci√≥n "SRT_DINT"

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

1106

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OBs de alarma c√≠clica
Descripci√≥n
Con ayuda del OB de alarma c√≠clica, se pueden arrancar partes del programa en intervalos
equidistantes.
Los momentos de arranque de un OB de alarma c√≠clica resultan del siguiente modo de su
intervalo y su desfase:
Momentos de arranque = n * intervalo + desfase (n = 0, 1, 2...)
‚óè El intervalo es el tiempo que transcurre entre dos llamadas. Es un m√∫ltiplo entero del ciclo
b√°sico de 1 ¬µs.
‚óè El desfase es el intervalo de tiempo en el que se desplazan los momentos de arranque
respecto a los m√∫ltiplos del intervalo.
Un desfase puede ser √∫til al utilizar varios OB de alarma c√≠clica. Si sus intervalos tienen
m√∫ltiplos comunes, se puede utilizar un desfase para evitar que los momentos de arranque
coincidan.

Ejemplo de utilizaci√≥n de un desfase
En su programa se utilizan dos OB de alarma c√≠clica: uno con un intervalo de 20 ms y otro con
un intervalo de 100 ms. Para garantizar que, para los m√∫ltiplos enteros de 100 ms, estos dos
OB no sean llamados de forma simult√°nea se utiliza un desfase.

Llamada de OB de error en relaci√≥n con OB de alarma c√≠clica
El tiempo de ejecuci√≥n de un OB de alarma c√≠clica debe ser muy inferior a su intervalo. De lo
contrario, puede ocurrir que el intervalo de una alarma c√≠clica transcurra sin que se haya
procesado el OB de alarma c√≠clica correspondiente. En ese caso, el sistema operativo genera
un error de tiempo (llamada del OB80). A continuaci√≥n, se reactiva o se rechaza la alarma
c√≠clica que ha causado el error. Solo puede reactivarse un OB de alarma c√≠clica para cada
prioridad.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì STRT_INF=B#16#3F, si el n√∫mero de OB es > 122 y el desfase y el tiempo de ciclo se
indican en ms
‚Äì OB_NUMBR=B#16#FF, si el n√∫mero de OB es > 254
‚óè Informaci√≥n de arranque optimizada

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1107

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre

Tipo de da‚Äê
tos

Significado

Initial_Call

BOOL

=TRUE en la primera llamada de este OB
‚óè En la transici√≥n de STOP o PARADA a RUN
‚óè Tras recargar

Event_count

INT

N√∫mero de eventos de arranque rechazados desde el √∫ltimo arranque
de este OB

Consulte tambi√©n
Parametrizar OB de alarma c√≠clica (P√°gina 1132)
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OBs de alarma de proceso
Descripci√≥n
Los OB de alarma de proceso le ayudan a reaccionar a los eventos de los m√≥dulos aptos para
alarmas de proceso que disparan una de estas alarmas. Mediante la configuraci√≥n se
establece de qu√© eventos se trata.
Nota
Utilizaci√≥n de alarmas de proceso
Utilice alarmas de proceso, cuando sea posible, s√≥lo para reaccionar a eventos espor√°dicos
de m√≥dulos aptos para alarmas de proceso.
No tiene sentido utilizar alarmas de proceso para reaccionar a eventos que se repiten con
frecuencia o con mucha frecuencia, ya que en circunstancias desfavorables puede generar
errores de tiempo en la CPU.
Solo se puede asociar un √∫nico OB de alarma de proceso a cada evento que dispara una de
estas alarmas. En cambio, a un OB de alarma de proceso se le pueden asignar varios eventos
(en un caso extremo, todos los eventos de un m√≥dulo que disparan alarmas de proceso).
En los m√≥dulos S7-1500, cada canal puede disparar alarmas de proceso individuales (p. ej.,
una entrada digital en caso de flanco ascendente).

Funcionamiento de un OB de alarma de proceso
Cuando un m√≥dulo o subm√≥dulo dispara una alarma de proceso, el sistema operativo
determina el evento y el OB de alarma de proceso correspondientes. Si el OB que est√° activo
en ese momento tiene una prioridad inferior a este OB de alarma de proceso, se arranca el OB
de alarma de proceso. En caso contrario, el OB de alarma de proceso se pone en la lista de
espera que corresponde seg√∫n su prioridad. La alarma de proceso se acusa tras finalizar la
ejecuci√≥n del OB de alarma de proceso correspondiente.

1108

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si desde que se identifica hasta que se acusa una alarma de proceso se presenta nuevamente
un evento de proceso en el mismo m√≥dulo o subm√≥dulo, se aplicar√° lo siguiente:
‚óè Si el evento se presenta en el canal que ha disparado la alarma de proceso actual, la alarma
se perder√°. En este canal solo se podr√° disparar una nueva alarma de proceso tras haberse
acusado la alarma de proceso actual.
‚óè Si el evento se presenta en un canal diferente, se disparar√° una alarma de proceso.
Para la periferia descentralizada puede haber limitaciones adicionales, p. ej., que un m√≥dulo
o subm√≥dulo solo pueda disparar una alarma de una categor√≠a concreta hasta que se acuse
la alarma actual.
Los OB de alarma de proceso solo se llaman en el estado operativo RUN de la CPU.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400: las variables USI, IChannel y EventType (significado
expuesto en la Informaci√≥n de arranque optimizada) se copian tras "OB40_POINT_ADDR".
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì STRT_INF=B#16#41
‚Äì OB_NUMBR=B#16#FF, si el n√∫mero de OB es > 254
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

LADDR

HW_IO

Identificador de hardware del m√≥dulo que dispara la alarma de proceso

USI

WORD

Identificador para ampliaciones futuras (irrelevante para el usuario)

IChannel

USINT

N√∫mero del canal que dispara la alarma de proceso

EventType

BYTE

Identificador del tipo de evento al que pertenece el evento que ha
disparado la alarma (p. ej. flanco ascendente)
Este identificador se indica en la descripci√≥n del m√≥dulo correspon‚Äê
diente.

PointAddr
(a partir de la
versi√≥n V14.0
del TIA Portal)

DWORD

‚óè En m√≥dulos digitales: mapa de bits con las entradas del m√≥dulo
que han disparado la alarma de proceso.
La asignaci√≥n de un determinado bit de Point_Addr a un canal
espec√≠fico del m√≥dulo se puede consultar en la descripci√≥n del
m√≥dulo correspondiente.
‚óè

En m√≥dulos anal√≥gicos: mapa de bits que indica qu√© canal ha
rebasado qu√© l√≠mite.
La estructura exacta puede consultarse en la descripci√≥n del
m√≥dulo.

‚óè En CP o IM: estado de alarma del m√≥dulo (no relevante para el
usuario)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1109

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
USI tiene el valor 0xFFFF
Si el m√≥dulo en cuesti√≥n se ha configurado en HW Config con medios GSDML, USI tendr√° el
valor 0xFFFF. En este caso, IChannel y EventType no tienen valores v√°lidos. Para determinar
el evento que disparar√° la alarma, proceda del siguiente modo:
Utilice la estructura de la informaci√≥n de arranque como en las CPU S7-300 y S7-400.
O utilice la informaci√≥n de arranque optimizada y llame la instrucci√≥n RALRM en el OB de
alarma de proceso.

Abrir, compilar y cargar OB de alarma de proceso
Dado que la informaci√≥n de arranque optimizado de los OB de alarma de proceso contiene una
variable adicional a partir de la versi√≥n 14.0 del TIA Portal, se pueden dar constelaciones en
las que ya no sea posible abrir, compilar y cargar los OB de alarma de proceso en la CPU.
Estas constelaciones se relacionan a continuaci√≥n:
‚óè En el sistema de ingenier√≠a se copia un OB de alarma de proceso con interfaz nueva en una
CPU S7-1500 con versi√≥n de firmware < V2.0 o en una CPU S7-1200. Despu√©s de eso el
OB ya no podr√° abrirse, compilarse ni cargarse.
‚óè En el sistema de ingenier√≠a una CPU S7-1500 con versi√≥n de firmware >= V2.0, que
contiene un OB de alarma de proceso con interfaz nueva se sustituye por una CPU S7-1500
con versi√≥n de firmware < V2.0. Despu√©s de eso el OB ya no podr√° abrirse, compilarse ni
cargarse.
Por contra, con las siguientes constelaciones no habr√° ning√∫n problema para abrir, compilar
y cargar:
‚óè En el sistema de ingenier√≠a se copia un OB de alarma de proceso con interfaz antigua en
una CPU S7-1500 con versi√≥n de firmware >= V2.0. El OB de alarma de proceso conserva
la interfaz antigua.
‚óè En el sistema de ingenier√≠a una CPU S7-1500 con versi√≥n de firmware < V2.0, que contiene
un OB de alarma de proceso con interfaz antigua se sustituye por una CPU S7-1500 con
versi√≥n de firmware >= V2.0. El OB de alarma de proceso conserva la interfaz antigua.

Consulte tambi√©n
Parametrizar OBs de alarma de proceso (P√°gina 1134)
Eventos y OBs (P√°gina 1016)
Ejemplo de un evento de alarma de proceso (P√°gina 1019)
Informaci√≥n importante sobre identificadores de hardware (P√°gina 1264)
Informaci√≥n de arranque del OB (P√°gina 1096)

1110

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OB de alarma de sincronismo
Descripci√≥n
Los OB de alarma de sincronismo permiten arrancar partes del programa de modo is√≥crono al
ciclo DP o al tiempo de ciclo de emisi√≥n PN.
La memoria imagen parcial de proceso de las entradas y la correspondiente memoria imagen
parcial de proceso de las salidas se actualizan llamando a las instrucciones SYNC_PI y
SYNC_PO en el OB de alarma de sincronismo.
PRECAUCI√ìN
Accesos directos
En los accesos directos, evite acceder a √°reas de la periferia que tengan asignadas memorias
imagen parcial de proceso vinculadas a OB de alarma de sincronismo.
Nota
Efecto del par√°metro OB "Entrada en el b√∫fer de diagn√≥stico al desbordarse los eventos"
La activaci√≥n de la casilla de verificaci√≥n "Entrada en el b√∫fer de diagn√≥stico al desbordarse los
eventos" no tiene efecto en los par√°metros OB hasta que no se hayan cargado las propiedades
de OB en la CPU y esta haya efectuado despu√©s una transici√≥n de STOP a RUN.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
A diferencia de la asignaci√≥n para la informaci√≥n de arranque en las CPU S7-300 y S7-400
se aplica lo siguiente:
‚Äì STRT_INF=B#16#6F, si el n√∫mero de OB es > 122
‚Äì OB_NUMBR=B#16#FF, si el n√∫mero de OB es > 254
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

Initial_Call

BOOL

=TRUE en la primera llamada de este OB durante la transici√≥n de
STOP a RUN

PIP_Input

BOOL

TRUE: la respectiva memoria imagen de proceso de las entradas
est√° actualizada
Nota: En CPU S7-1500 esta variable siempre tiene el valor FALSE,
ya que la actualizaci√≥n de la memoria imagen parcial del proceso de
las entradas debe producirse mediante llamada de la instrucci√≥n
SYNC_PI.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1111

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Nombre

Tipo de da‚Äê
tos

Significado

PIP_Output

BOOL

TRUE: la memoria imagen de proceso correspondiente de las sali‚Äê
das se transfiri√≥ a tiempo a las salidas tras el √∫ltimo ciclo
Nota: En CPU S7-1500 esta variable siempre tiene el valor FALSE,
ya que la actualizaci√≥n de la memoria imagen parcial del proceso de
las salidas debe producirse mediante llamada de la instrucci√≥n
SYNC_PO.

IO_System

USINT

N√∫mero del sistema de periferia descentralizada que ha disparado
la alarma

Event_Count

INT

‚óè = n: n√∫mero de ciclos perdidos
‚óè = -1: Se ha perdido un n√∫mero desconocido de ciclos (p. ej.
porque el ciclo ha cambiado).

SyncCycleTime

LTIME

Tiempo de ciclo calculado

Consulte tambi√©n
Parametrizar OB de alarma de sincronismo (P√°gina 1134)
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de error de tiempo
Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB de error de tiempo si se produce uno de
los siguientes errores:
‚óè Primer rebase por exceso del tiempo de ciclo dentro de un ciclo
Nota
Si el tiempo de ciclo se rebasa por exceso dos veces en un mismo ciclo, la CPU pasa al
estado STOP. Esto puede evitarse llamando la instrucci√≥n "RE_TRIGR" en el punto
adecuado.
‚óè El n√∫mero de peticiones solicitadas por un OB que no han terminado de procesarse ha
alcanzado el l√≠mite de advertencia configurado. (En los programas migrados este l√≠mite de
advertencia est√° ajustado a 1.)
Si ha configurado el l√≠mite de advertencia a 1, significa lo siguiente: Si se produce un evento
de arranque, p. ej. para un OB de alarma c√≠clica, antes de que finalice el procesamiento
anterior de ese mismo OB, el sistema operativo llama el OB80.
Esto se aplica a todos los eventos cuyo OB puede causar un error de tiempo.
‚óè Alarma horaria expirada al reanudar en RUN despu√©s de que la CPU estuviera, p. ej., en
PARADA.
‚óè Alarma horaria omitida debido a un adelanto de la hora de m√°s de 20 s (tambi√©n en el
cambio de horario de invierno a verano)

1112

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada
Nombre

Tipo de da‚Äê
tos

Significado

Fault_ID

BYTE

C√≥digo de error. Valores posibles:
‚óè B#16#01: rebase por exceso del tiempo de ciclo
‚óè B#16#02: el OB solicitado todav√≠a est√° proces√°ndose.
‚óè B#16#05: alarma horaria expirada debido a salto de hora
‚óè B#16#06: alarma horaria expirada al reanudar en RUN despu√©s de
PARADA
‚óè B#16#07: rebase por exceso del b√∫fer de solicitud de OB para la
clase de prioridad actual
‚óè B#16#08: error de tiempo en alarma de sincronismo
‚óè B#16#09: p√©rdida de alarma por sobrecarga de alarmas
‚óè B#16#0B: error de tiempo en alarma de sincronismo tecnol√≥gica
‚óè B#16#0C: (solo en CPU S7-1500 R/H) tiempo de ciclo excedido por
segunda vez

Csg_OBnr

OB_ANY

N√∫mero del OB que se estaba procesando cuando se produjo el error de
tiempo

Csg_Prio

UINT

Prioridad del OB que se estaba procesando cuando se produjo el error
de tiempo

Nota
Csg_OBnr=0 y Csg_Prio=0
Si Csg_OBnr y Csg_Prio (o bien OB80_ERR_EV_CLASS y OB80_ERR_EV_NUM, si ha
seleccionado la estructura de las CPU S7-300 y S7-400 como estructura de la informaci√≥n de
arranque ) tienen ambos el valor cero, significa que la CPU estaba realizando actividades en
segundo plano cuando ocurri√≥ el error de tiempo.

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1113

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OB de alarma de diagn√≥stico
Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB de alarma de diagn√≥stico en los siguientes
casos:
‚óè Un m√≥dulo S7-1500 diagnosticable detecta una modificaci√≥n de su estado de diagn√≥stico
y env√≠a a la CPU una solicitud de alarma de diagn√≥stico.
‚óè Un m√≥dulo diagnosticable S7-300 o S7-400 en el que se ha habilitado la alarma de
diagn√≥stico detecta una modificaci√≥n de su estado de diagn√≥stico y env√≠a a la CPU una
solicitud de alarma de diagn√≥stico.
‚óè Se produce un evento a ra√≠z de un error en la fuente de alimentaci√≥n o el respaldo por
bater√≠a.
Nota
Un evento de este tipo en las CPU S7-300 y S7-400 causa la llamada del OB de error de
fuente de alimentaci√≥n.
‚óè El sistema operativo ha detectado errores de memoria.
Nota
Un evento de este tipo en las CPU S7-300 y S7-400 causa la llamada del OB de error de
hardware en CPU.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada:

1114

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre

Tipo de datos

Significado

IO_state

WORD

Estado del objeto de hardware:
‚óè Bit 0: bueno
‚óè Bit 1: desactivado
‚óè Bit 2: mantenimiento necesario
‚óè Bit 3: mantenimiento solicitado
‚óè Bit 4: error
‚óè Bit 5: no accesible
‚óè Bit 6: cualificado
‚óè Bit 7: no disponible
‚óè Bits de 8 a 14: reservado (siempre "0")
‚óè Bit 15: error de red / hardware
Si el bit 4 = 1 o el bit 5 = 1:
‚Äì

Bit 15 = 0: error de red

‚Äì

Bit 15 = 1: error de hardware

LADDR

HW_ANY

Identificador de hardware del objeto de hardware que ha disparado la
alarma de diagn√≥stico

Canal

UINT

N√∫mero de canal

MultiError

BOOL

=TRUE, si existe m√°s de un error

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de cambio de m√≥dulo
Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB de cambio de m√≥dulo al insertar o extraer
un m√≥dulo o subm√≥dulo de la periferia descentralizada configurado y no desactivado.
Nota
El enchufe o desenchufe de un m√≥dulo central provoca que la CPU pase a STOP, con
excepci√≥n de las CPU 1510SP-1 PN y 1512SP-1 PN.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1115

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre

Tipo de da‚Äê
tos

Significado

LADDR

HW_IO

Identificador de hardware del m√≥dulo o subm√≥dulo afectado

Event_Class

BYTE

‚óè B#16#38: (sub)m√≥dulo insertado
‚óè B#16#39: (sub)m√≥dulo extra√≠do o no responde

Fault_ID

BYTE

C√≥digo de error (valores posibles: B#16#51, B#16#54, B#16#55,
B#16#56, B#16#57, B#16#58, B#16#61, B#16#63, B#16#64, B#16#65,
B#16#66)

La tabla siguiente muestra cu√°l es el evento que ha provocado el arranque del OB de cambio
de m√≥dulo.
ev_class

fault_id

B#16# ...

B#16# ...

Significado

39

51

m√≥dulo IO desenchufado

39

54

subm√≥dulo IO desenchufado

38

54

subm√≥dulo IO enchufado y coincide con el subm√≥dulo parametrizado

38

55

subm√≥dulo IO enchufado, pero no coincide con el subm√≥dulo parame‚Äê
trizado

38

56

subm√≥dulo IO enchufado, pero error en parametrizaci√≥n del m√≥dulo

38

57

subm√≥dulo o m√≥dulo IO enchufado, pero con fallo o mantenimiento

38

58

subm√≥dulo IO, error de acceso eliminado

39

61

m√≥dulo desenchufado o no responde

38

61

m√≥dulo enchufado

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de fallo de rack
Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB86 en los siguientes casos:
‚óè Se detecta el fallo de un sistema maestro DP o un sistema PROFINET IO (tanto con evento
entrante como con evento saliente).
‚óè Se detecta el fallo de un esclavo DP o un dispositivo IO (tanto con evento entrante como con
evento saliente).
‚óè Se detecta el fallo de una parte de los subm√≥dulos de un I-Device PROFINET.

1116

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada:
Tipo de datos

Nombre

Significado

LADDR

HW_Device

Identificador de hardware del objeto de hardware defectuoso

Event_Class

BYTE

‚óè B#16#38: evento saliente
‚óè B#16#39: evento entrante

Fault_ID

BYTE

C√≥digo de error (valores posibles: B#16#C3, B#16#C4,
B#16#C9, B#16#CA, B#16#CB, B#16#CC, B#16#CD,
B#16#CE, B#16#CF, B#16#F8, B#16#F9)

La tabla siguiente muestra cu√°l es el evento que ha provocado el arranque del OB86.
ev_class

fault_id

Significado

B#16# ...

B#16# ...

39

C3

Fallo de un sistema maestro DP

39/38

C4

Fallo/retorno de un esclavo DP

39

CA

Fallo de un sistema PROFINET IO

39/38

CB

Fallo/retorno de un dispositivo PROFINET IO

38

CC

Retorno de un dispositivo PROFINET IO con fallo o mantenimiento

38

CD

Retorno de un dispositivo PROFINET IO, pero la configuraci√≥n te√≥rica difiere
de la configuraci√≥n real

38

CE

Retorno de un dispositivo PROFINET IO, pero error en la parametrizaci√≥n del
m√≥dulo

39/38

F8

Fallo/retorno de una parte de los subm√≥dulos de un I-Device PROFINET

38

F9

Retorno de una parte de los subm√≥dulos de un I-Device PROFINET con
diferencias en la configuraci√≥n de dispositivos

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de error de programaci√≥n
Requisito para la llamada del OB de error de programaci√≥n
Para que la CPU S7-1500 pueda llamar al OB de error de programaci√≥n es imprescindible que
se haya configurado el tratamiento de errores global.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1117

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB de error de programaci√≥n si se produce
un error de este tipo durante el procesamiento de una instrucci√≥n del programa de usuario. El
OB de error de programaci√≥n se procesa con la prioridad que se haya configurado.
Nota
Si se ha configurado el tratamiento de errores local, cuando se produzca un error de
programaci√≥n se aplicar√° el tratamiento de errores programado en el bloque correspondiente.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de datos

BlockNr

UINT

N√∫mero del bloque en el que se ha producido el error de programaci√≥n

Reaction

USINT

‚óè 0: ignorar error

Significado

‚óè 1: reemplazar valor incorrecto
‚óè 2: saltar comando
‚óè 3: Tratamiento de errores programado, disparado p. ej. por un
acceso a campo con √≠ndice inadmisible o por un error en la
transferencia de valores de par√°metro de un FC o FB
Fault_ID

BYTE

C√≥digo de error (valores posibles: B#16#00, B#16#03, B#16#04,
B#16#05, B#16#20, B#16#21, B#16#22, B#16#23, B#16#24,
B#16#25, B#16#26, B#16#27, B#16#28, B#16#29, B#16#2C,
B#16#30, B#16#31, B#16#32, B#16#33, B#16#34, B#16#35,
B#16#38, B#16#39, B#16#3A, B#16#3B, B#16#3C, B#16#3D,
B#16#3E, B#16#3F, B#16#50, B#16#51, B#16#75, B#16#76,
B#16#A1, B#16#A2)

BlockType

USINT

Tipo de bloque en el que se ha producido el error:
‚óè OB: 1
‚óè FC: 2
‚óè FB: 3
‚óè SFC: 4
‚óè SFB: 5
‚óè DB: 6

1118

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Nombre

Tipo de datos

Significado

Area

USINT

√Årea en la que se ha producido el acceso incorrecto:
‚óè Datos locales: B#16#40 a 4E, 86, 87, 8E, 8F, C0 a CE
‚óè Memoria imagen de proceso de las entradas: B#16#01
‚óè Memoria imagen de proceso de las salidas: B#16#02
‚óè DB de tecnolog√≠a: B#16#04
‚óè E: B#16#81
‚óè A: B#16#82
‚óè M: B#16#83
‚óè DB: B#16#84, 85, 8A, 8B

DBNr

Block_DB

DB-Nr, si AREA = DB o DI

Csg_OBNr

OB_ANY

N.¬∫ de OB (121)

Csg_Prio

USINT

Prioridad de OB

Width

USINT

Tipo de acceso en el que se ha producido el error:
‚óè Bit:
‚Äì

B#16#00 con acceso al √°rea de memoria est√°ndar

‚Äì

B#16#01 con acceso al √°rea de memoria optimizada

‚óè Byte: B#16#01
‚óè Word: B#16#02
‚óè DWord: B#16#03
‚óè LWord: B#16#04

La tabla siguiente explica el significado del c√≥digo de error:
fault_ID

Significado

B#16# ...
00

Superada la profundidad de anidamiento m√°xima de las llamadas de bloque

03

Ha utilizado un puntero NULL para direccionar un operando.

04

Instrucci√≥n desconocida

05

Instrucci√≥n de parada

20

El string direccionado tiene una indicaci√≥n de longitud err√≥nea.

21

Error de conversi√≥n BCD

22

Error de longitud de √°rea durante lectura

23

Error de longitud de √°rea durante escritura

24

Error de √°rea durante lectura

25

Error de √°rea durante escritura

26

Error en el n.¬∫ del temporizador

27

Error en el n.¬∫ del contador

28

Acceso de lectura a un byte, palabra o palabra doble con un puntero cuya direcci√≥n
de bit es diferente de cero

29

Acceso de escritura a un byte, palabra o palabra doble con un puntero cuya direcci√≥n
de bit es diferente de cero

2C

Ha utilizado un puntero NULL para direccionar un operando.

30

Acceso de escritura a un DB global protegido contra escritura

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1119

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
fault_ID

Significado

B#16# ...
31

Acceso de escritura a un DB de instancia protegido contra escritura

32

N√∫mero err√≥neo de DB al acceder a un DB global

33

N√∫mero err√≥neo de DB al acceder a un DB de instancia

34

Error de n√∫meros en la llamada FC

35

Error de n√∫meros en la llamada FB

38

El bloque de datos con seguridad de tipos no est√° cargado.

39

El bloque de datos no est√° definido con seguridad de tipos.

3A

Acceso a un DB no cargado; el n√∫mero de DB est√° dentro del rango admisible

3B

El DB no existe

3C

Acceso a una FC no cargada; el n√∫mero de FC est√° dentro del rango admisible

3D

Acceso a una SFC no cargada; el n√∫mero de la SFC est√° dentro del rango admisible

3E

Acceso a un FB no cargado; el n√∫mero de FB est√° dentro del rango admisible

3F

Acceso a un SFB no presente; el n√∫mero de SFB est√° dentro del rango admisible

50

El bloque de datos con seguridad de tipos no est√° cargado.

51

El bloque de datos no est√° definido con seguridad de tipos.

75

Se ha superado la profundidad m√°xima de anidamiento para llamadas de bloque.

76

Se ha superado el m√°ximo de datos locales disponibles.

A1

Acceso de escritura a una variable protegida contra escritura

A2

Acceso a una variable que contiene un valor num√©rico no v√°lido

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB de error de acceso a la periferia
Requisito para la llamada del OB de error de acceso a la periferia
Para que la CPU S7-1500 pueda llamar al OB de error de acceso a la periferia es
imprescindible que se haya configurado el tratamiento de errores global.

1120

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Descripci√≥n
El sistema operativo de la CPU S7-1500 llama al OB de error de acceso a la periferia si se
produce un error en el acceso directo a los datos de la periferia durante el procesamiento de
una instrucci√≥n del programa de usuario. Es el caso, p. ej., de un error de lectura en el acceso
directo a datos de un m√≥dulo de entrada. El OB de error de acceso a la periferia se procesa con
la prioridad que se haya configurado.
Nota
Si se ha configurado el tratamiento de errores local, cuando se produzca un error de acceso a
la periferia se aplicar√° el tratamiento de errores programado en el bloque correspondiente.

Estructura de la informaci√≥n de arranque
‚óè Como en las CPU S7-300 y S7-400
Consulte AUTOHOTSPOT
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de datos

Significado

BlockNr

UINT

N√∫mero del bloque en el que se ha producido el error de acceso a la
periferia

Reaction

USINT

0: ignorar error, 1: reemplazar valor incorrecto, 2: saltar comando

Fault_ID

BYTE

C√≥digo de error:
‚óè B#16#42: error de acceso a la periferia, lectura
‚óè B#16#43: error de acceso a la periferia, escritura

BlockType

USINT

Tipo de bloque en el que se ha producido el error:
‚óè OB: 1
‚óè FC: 2
‚óè FB: 3
‚óè SFC: 4
‚óè SFB: 5
‚óè DB: 6

Area

USINT

Identificador del √°rea en la que se ha producido el acceso incorrecto:
‚óè B#16#01: acceso directo a la entrada
‚óè B#16#02: acceso directo a la salida
‚óè B#16#81: acceso a la memoria imagen de proceso de las entradas
‚óè B#16#82: acceso a la memoria imagen de proceso de las salidas

DBNr

Block_DB

no relevante para el usuario

Csg_OBNr

OB_ANY

N√∫mero del OB que provoca el error de acceso a periferia

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1121

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Nombre

Tipo de datos

Significado

Csg_Prio

USINT

Prioridad del OB que provoca el error de acceso a periferia

Width

USINT

Tipo de acceso en el que se ha producido el error:
‚óè Bit: B#16#00
‚óè Byte: B#16#01
‚óè Word: B#16#02
‚óè DWord: B#16#03
‚óè LWord: B#16#04

Consulte tambi√©n
Eventos y OBs (P√°gina 1016)
Informaci√≥n de arranque del OB (P√°gina 1096)

OB ProDiag
Descripci√≥n
En ProDiag se asigna un bloque de funci√≥n ProDiag a cada supervisi√≥n configurada. No
obstante, las supervisiones de un FB ProDiag solo se activan cuando son llamadas. La
llamada puede realizarse en el bloque de organizaci√≥n ProDiag o en cualquier otro lugar del
programa:
‚óè Si se llama expl√≠citamente un FB ProDiag en el programa, no se llamar√° en el OB ProDiag.
Si se llaman expl√≠citamente todos los FB ProDiag en el programa, no se crear√° ning√∫n OB
ProDiag.
‚óè Si no desea encargarse de la llamada de uno o varios FB ProDiag y no los llama en ning√∫n
lugar del programa, se detectar√° al compilar el proyecto. En tal caso se crear√°
autom√°ticamente un OB ProDiag, dentro del cual se llamar√°n los mencionados FB ProDiag.
Si no se llama expl√≠citamente ning√∫n FB ProDiag del proyecto en el programa, se llamar√°n
todos los FB ProDiag en el OB ProDiag.
Nota
Crear un OB ProDiag
El OB ProDiag es el √∫nico bloque de organizaci√≥n que se crea autom√°ticamente.
La informaci√≥n sobre los FB ProDiag que se llamar√°n en el OB ProDiag puede leerse utilizando
las referencias cruzadas.

1122

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Motion Control OBs
MC-servo OB
Description
When you create a technology object for S7-1500 Motion Control, the organization block
MC‚ÄëServo [OB91] for processing the technology objects is created automatically. The Motion
Control functionality of the technology objects creates its own execution level and is called in
the SIMATIC S7‚Äë1500 execution system according to the application cycle.
The MC‚ÄëServo [OB91] is write-protected. The contents cannot be changed.
The position control algorithms of all technology objects configured for Motion Control on the
CPU are calculated within the MC‚ÄëServo [OB91].
You can set the application cycle and the priority of the organization block in accordance with
your requirements for control quality and system load.

Application cycle
You can set the application cycle in which the MC‚ÄëServo [OB91] is called in the properties of the
organization block:
‚óè Synchronous to the BUS
The MC‚ÄëServo [OB91] is called synchronously with a bus system. You set the send clock in
the properties of the selected bus system. You can select the following bus systems:
‚Äì PROFIBUS DP
‚Äì PROFINET IO
‚Äì Local bus system (as of V4.0 or FW version ‚â• 2.6)
‚Äì X142 interface (only SIMATIC Drive Controller)
‚óè You cannot call the MC‚ÄëServo [OB91] synchronously with a bus system that is connected
to the CPU via a communications processor / communications module (CP / CM).
‚óè Cyclical
The MC‚ÄëServo [OB91] is called cyclically with the specified application cycle.
The selected application cycle must be long enough to allow all the technology objects for
motion control to be processed in one cycle. If the application cycle is not observed, overflows
occur. The CPU switches to STOP mode in the case of an overflow of the MC‚ÄëServo [OB91].

Clock reduction (CPU V1.5 and higher)
You can reduce the application cycle of the MC‚ÄëServo [OB91] relative to the send clock of an
isochronous PROFINET IO system. You can set an integer multiple of the send clock as the
factor. Values up to 14 times the send clock (maximum 32 ms) are possible for the application
cycle.
If you call an isochronous mode interrupt OB and the MC‚ÄëServo [OB91] synchronously with the
same PROFINET IO system, you must set the same application cycle for both organization
blocks.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1123

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Assigning the MC-Servo OB parameters (P√°gina 1124)
MC-PreServo OB (P√°gina 1125)
MC-PostServo OB (P√°gina 1126)
MC-interpolator OB (P√°gina 1127)
MC-Transformation OB (P√°gina 1128)

Assigning the MC-Servo OB parameters
Procedure for setting the parameters
To assign the parameters of an MC‚ÄëServo [OB91], follow these steps:
1. Open the "Properties" dialog associated with the MC‚ÄëServo [OB91] in question.
2. Click on the "Cycle time " group in the area navigation.

Overview of the parameters that can be set
In the "Cycle time" group, select how the MC‚ÄëServo [OB91] will be called in the execution
system of the SIMATIC S7-1500:
‚óè Cyclical
‚óè Synchronous to the bus
You can set the following parameters according to the option selected:
‚óè Application cycle
‚óè Distributed I/O
‚óè Factor

"Cyclical" option
The MC‚ÄëServo [OB91] is called cyclically with the specified application cycle.
You set the cycle in which the MC‚ÄëServo [OB91] is called in the "Application cycle" field.

"Synchronous to the bus" option
The MC‚ÄëServo [OB91] is called synchronously with a bus system. You set the send clock in the
properties of the selected bus system.

1124

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
The following parameters are available for the "Synchronous to the bus" option:
‚óè Synchronous to the BUS
In the drop-down list, select the bus system to which the MC‚ÄëServo [OB91] will be called
isochronously. You can select the following bus systems:
‚Äì PROFIBUS DP
‚Äì PROFINET IO
‚Äì Local bus system (as of V4.0 or FW version ‚â• 2.6)
‚Äì X142 interface (only SIMATIC Drive Controller)
You cannot call the MC‚ÄëServo [OB91] synchronously with a bus system that is connected
to the CPU via a communications processor/communications module (CP/CM).
‚óè Send clock (ms)
The send clock or DP cycle that is set in the selected PROFINET IO system or DP master
system is displayed in this field.
‚óè Factor
You can reduce the application cycle of the MC‚ÄëServo [OB91] relative to the send clock of
an isochronous PROFINET IO system. You set an integer multiple of the send clock in the
"Factor" field. Values up to 14 times the send clock (maximum 32 ms) are possible for the
application cycle.
‚óè Application cycle (ms)
An application cycle that results from the send clock and the specified factor is displayed in
this field.

Consulte tambi√©n
MC-servo OB (P√°gina 1123)

MC-PreServo OB
Description
The organization block MC‚ÄëPreServo [OB67] can be programmed and is called in the
application cycle configured at the MC‚ÄëServo [OB91]. The MC‚ÄëPreServo [OB67] is called
directly before the MC‚ÄëServo [OB91].
Via the organization block, you can read out the configured application cycle (information in ¬µs).

Structure of the start information
Optimized start information:
Name

Data
type

Meaning

Initial_Call

BOOL

TRUE

In the first call of this OB during transition from STOP to RUN

PIP_Input

BOOL

TRUE

The associated process image input is up-to-date.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1125

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Name

Data
type

Meaning

PIP_Output

BOOL

TRUE

The associated process image output was transferred to the
outputs in time after the last cycle.

IO_System

USINT

Number of the distributed I/O system triggering the interrupt

Event_Count

INT

n

Number of lost cycles

-1

An unknown number of cycles has been lost, e.g. because
the cycle has changed.
The MC‚ÄëServo [OB91] is called synchronously with a bus
system.

Synchronous

BOOL

TRUE

CycleTime

UDINT

Display of the application cycle configured for the MC‚ÄëServo [OB91] in
ns

Consulte tambi√©n
MC-servo OB (P√°gina 1123)

MC-PostServo OB
Description
The organization block MC‚ÄëPostServo [OB95] can be programmed and is called in the
application cycle configured at the MC‚ÄëServo [OB91] (P√°gina 1123). The
MC‚ÄëPostServo [OB95] is called directly after the MC‚ÄëServo [OB91].
Via the organization block, you can read out the configured application cycle (information in ¬µs).

Structure of the start information
Optimized start information:

1126

Name

Data
type

Meaning

Initial_Call

BOOL

TRUE

In the first call of this OB during transition from STOP to RUN

PIP_Input

BOOL

TRUE

The associated process image input is up-to-date.

PIP_Output

BOOL

TRUE

The associated process image output was transferred to the
outputs in time after the last cycle.

IO_System

USINT

Number of the distributed I/O system triggering the interrupt

Event_Count

INT

n

Number of lost cycles

-1

An unknown number of cycles has been lost, e.g. because
the cycle has changed.
The MC‚ÄëServo [OB91] is called synchronously with a bus
system.

Synchronous

BOOL

TRUE

CycleTime

UDINT

Display of the application cycle configured for the MC‚ÄëServo [OB91] in
ns

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

MC-interpolator OB
Description
When you create a technology object for S7‚Äë1500 Motion Control, the organization block
MC‚ÄëInterpolator [OB92] for processing the technology objects is created automatically. The
Motion Control functionality of the technology objects creates its own execution level and is
called in the SIMATIC S7‚Äë1500 execution system according to the MC‚ÄëServo [OB91]
(P√°gina 1123) application cycle.
The MC‚ÄëInterpolator [OB92] is write-protected. The contents cannot be changed.
The evaluation of the Motion Control instructions as well as the monitoring and the setpoint
generation for all technology objects configured on the CPU (Motion Control) is performed
within the MC‚ÄëInterpolator [OB92].
The MC‚ÄëInterpolator [OB92] is called at the end of processing of the MC‚ÄëServo [OB91]. The
clock ratio between MC‚ÄëInterpolator [OB92] and MC‚ÄëServo [OB91] is always 1:1.

Process response
You must select the application cycle of the MC‚ÄëServo [OB91] long enough to allow all the
technology objects for Motion Control to be processed in one application cycle. If the
application cycle is not observed, overflows occur. Note the following response to overflows:
‚óè The CPU tolerates a maximum of three consecutive overflows of MC‚ÄëInterpolator [OB92].
‚óè The execution of an MC‚ÄëInterpolator [OB92] may only be interrupted by an
MC‚ÄëServo [OB91] call.
If more overflows or interruptions occur, the CPU switches to STOP mode.

Consulte tambi√©n
Assigning the MC-Servo OB parameters (P√°gina 1124)
MC-Transformation OB (P√°gina 1128)

MC-PreInterpolator-OB
Description
The organization block MC‚ÄëPreInterpolator [OB68] can be programmed and is called in the
application cycle configured at the MC‚ÄëInterpolator [OB92] (P√°gina 1127). The
MC‚ÄëPreInterpolator [OB68] is called directly before the MC‚ÄëInterpolator [OB92].
Via the organization block, you can read out the configured application cycle.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1127

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Structure of the start information
Optimized start information:
Name

Data
type

Meaning

Initial_Call

BOOL

TRUE

In the first call of this OB after the CPU is switched on

PIP_Input

BOOL

TRUE

The associated process image input is up-to-date.

PIP_Output

BOOL

TRUE

The associated process image output was transferred to the
outputs in time after the last cycle.

IO_System

USINT

Number of the distributed I/O system triggering the interrupt

Event_Count

INT

n

Number of lost cycles

-1

An unknown number of cycles has been lost, e.g. because
the cycle has changed.

Reduction

UINT

Reduction ratio of MC‚ÄëInterpolator [OB92] to MC‚ÄëServo [OB91]

CycleTime

UDINT

Display of the application cycle configured for the MC‚ÄëInterpola‚Äê
tor [OB92] in ns

MC-Transformation OB
Description
You program the user transformation of the Cartesian coordinates and the axis-specific
setpoints for the user-defined kinematics in the organization block MC‚ÄëTransformation [OB98].
This programming includes the transformation of the positions and the dynamic values
(velocity, acceleration, jerk).
When you add the MC‚ÄëTransformation [OB98] in the TIA Portal, the data block
"TransformationParameter" is automatically created under "Program blocks > System blocks
> Program resources". In the properties of the organization block, the
MC‚ÄëTransformation [OB98] indicates the number of the data block "TransformationParameter"
under "General > Transformation".
In the user program, supply the input parameters of the MC‚ÄëTransformation [OB98] with the
required start information. You write the axis-specific parameters or the Cartesian parameters
in the "TransformationParameter" data block. The MC‚ÄëTransformation [OB98] is called with this
start information in the execution system of the CPU.
Nota
Only one MC‚ÄëTransformation [OB98] per CPU
You program all required user transformations in an organization block
MC‚ÄëTransformation [OB98]. If you require multiple transformations or multiple instances of a
transformation, you need to identify the transformations or the instances in your user program.

Block call and priority
The MC‚ÄëTransformation [OB98] is called according to the configured priority in the execution
system of the CPU.

1128

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
You configure the priority of the MC‚ÄëTransformation [OB98] in the properties of the organization
block under "General > Attributes > Priority". For the priority you can set values from 17 to 25
(default setting 25):
‚óè The priority of MC‚ÄëTransformation [OB98] must be at least one level lower than the priority
of MC‚ÄëServo [OB91].
‚óè The priority of MC‚ÄëTransformation [OB98] must be at least one level higher than the priority
of MC‚ÄëInterpolator [OB92].

Parameter
The following table shows the parameters of the "MC‚ÄëTransformation [OB98]":
Parameter

Declara‚Äê
tion

Data
type

Default
value

KinematicsObject

INPUT

DB_ANY -

Kinematics technology object for which the MC‚ÄëTransforma‚Äê
tion [OB98] calculates the transformation when called.

ExecutionContext

INPUT

DINT

Processing context of the MC‚ÄëTransformation [OB98]

-

Description

0

MOTION_EXECUTION
Calculation of the axis setpoints in the motion execu‚Äê
tion in the interpolator. The calculated values are ne‚Äê
cessary for the current motion control. Torque precon‚Äê
trol values can be calculated and preset.

1

NON_MOTION_EXECUTION
Calculation of axis setpoints from IPO task and other
OBs are possible. The transformation is necessary for
the motion planning.

TransformationType

INPUT

DINT

-

Calculation called for
0

Forward transformation
Calculation of the Cartesian parameters from the axis
positions

1

Inverse transformation
Calculation of the axis-specific parameters from the
Cartesian parameters

TransformationParame‚Äê
ters

InOut

VA‚Äê
RIANT

-

Pointer to the data block "TransformationParameter"

FunctionResult

OUTPUT

DINT

-

Return value of the MC‚ÄëTransformation [OB98] to the kine‚Äê
matics technology object
0
<0

Calculation performed and parameters output
Error during calculation
If an error occurs during the calculation, the kinematics
technology object stops the motion. The kinematics
technology object outputs a technology alarm with the
error ID as an accompany value and deletes the job
sequence.

If an error occurs during the calculation, the kinematics tech‚Äê
nology object stops the motion. The kinematics technology
object outputs a technology alarm with the error ID as an ac‚Äê
company value and deletes the job sequence.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1129

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
MC-servo OB (P√°gina 1123)
MC-interpolator OB (P√°gina 1127)

MC-LookAhead OB
Description
When you create a kinematics technology object as of V5.0 for S7-1500T Motion Control, the
organization block MC‚ÄëLookAhead [OB97] is created automatically.
The movement preparation of the kinematics technology object is calculated in the
MC‚ÄëLookAhead [OB97] organization block.
The MC‚ÄëLookAhead [OB97] is write-protected. The contents cannot be changed.
Nota
Only one MC‚ÄëLookAhead [OB97] per CPU
The movements of all kinematics of a CPU are prepared in an MC‚ÄëLookAhead [OB97]
organization block. The MC‚ÄëLookAhead [OB97] can only be created once.
All jobs of the job sequence are prepared in advance within the MC‚ÄëLookAhead [OB97]. In this
way, less time is required for movement preparation in the MC‚ÄëInterpolator [OB92] organization
block and you can set a shorter application cycle of the MC‚ÄëServo [OB91] organization block.

Block call and priority
The MC‚ÄëLookAhead [OB97] is not called cyclically according to the configured priority in the
execution system of the CPU.
You configure the priority of the MC‚ÄëLookAhead [OB97] in the properties of the organization
block under "General > Attributes > Priority". You can set values from 14 to 16 (default setting
15) for the priority. The priority of MC‚ÄëLookAhead [OB97] must be lower than the priority of
MC‚ÄëInterpolator [OB92].

Cycle load
You can configure the maximum cycle load for the MC‚ÄëLookAhead [OB97].
You configure the maximum cycle load of the MC‚ÄëLookAhead [OB97] in the properties of the
organization block under "General > Cycle load > Maximum cycle load". You can set values
from 1% to 40% (default setting 20%) for the maximum cycle load.
Select the cycle load of the MC‚ÄëLookAhead [OB97] in such a way that the CPU can process all
technology objects for Motion Control in one application cycle.

1130

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Process response
If the application cycle is not observed, overflows occur. Note the following response to
overflows:
‚óè The CPU tolerates a maximum of three consecutive overflows of MC‚ÄëInterpolator [OB92].
‚óè The execution of an MC‚ÄëInterpolator [OB92] may only be interrupted by an
MC‚ÄëServo [OB91] call.
If more overflows or interruptions occur, the CPU switches to STOP mode.
You can find more information on the process response in the section "AUTOHOTSPOT".

Ajuste de par√°metros de bloques de organizaci√≥n
Parametrizar OB de alarma horaria
Procedimiento para configurar los par√°metros
Para ajustar los par√°metros de un OB de alarma horaria, proceda del siguiente modo:
1. Abra el di√°logo "Propiedades" del OB de alarma horaria en cuesti√≥n.
2. Haga clic en el grupo "Alarma horaria" de la navegaci√≥n local.

Resumen de los par√°metros ajustables
Se pueden configurar los par√°metros siguientes:
‚óè Ejecuci√≥n
‚óè Fecha de inicio y hora
‚óè Botones de opci√≥n "Hora local" y "Hora del sistema"

Par√°metro "Ejecuci√≥n"
La lista desplegable "Ejecuci√≥n" permite indicar con qu√© periodicidad debe ejecutarse el OB de
alarma horaria. Los intervalos se basan en los ajustes de "Fecha de inicio" y "Hora".
Est√°n disponibles los siguientes valores de "Ejecuci√≥n":
‚óè nunca
‚óè una sola vez
‚óè una vez por minuto
‚óè una vez por hora
‚óè una vez al d√≠a
‚óè una vez por semana
‚óè una vez al mes

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1131

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè una vez al a√±o
‚óè a final de mes
Nota
En el valor "a final de mes", el valor indicado bajo "Fecha de inicio" es irrelevante.

Par√°metros "Fecha de inicio" y "Hora"
Permiten establecer en qu√© momento debe ejecutarse el OB de alarma horaria por primera vez.
Ejemplo: Fecha de inicio = 05.01.2013, hora =11:16
En funci√≥n del valor del par√°metro "Ejecuci√≥n", la CPU genera otras alarmas horarias
peri√≥dicas. La hora de inicio se refiere, seg√∫n la configuraci√≥n, bien a la hora local, bien al
tiempo universal coordinado UTC.
Nota
Si se configura el par√°metro "Ejecuci√≥n" como "mensual", los d√≠as 29, 30 y 31 no se pueden
seleccionar como fecha de inicio. Si el OB de alarma horaria debe iniciarse a final de mes,
seleccione en su lugar "a final de mes" en el par√°metro "Ejecuci√≥n".

"Hora local" u "Hora del sistema"
Permite definir a qu√© hora hace referencia la hora de inicio del OB de alarma horaria:
‚óè "Hora local": la hora de inicio se refiere a la zona horaria configurada en la CPU.
‚óè "Hora del sistema": la hora de inicio se refiere al tiempo universal coordinado UTC
(Universal Time Coordinated).

Consulte tambi√©n
OBs de alarma horaria (P√°gina 1099)

Parametrizar OB de alarma c√≠clica
Procedimiento para configurar los par√°metros
Para ajustar los par√°metros de un OB de alarma c√≠clica, proceda del siguiente modo:
1. Abra el di√°logo "Propiedades" del OB de alarma c√≠clica en cuesti√≥n.
2. Haga clic en el grupo "Alarma c√≠clica" de la navegaci√≥n local.

1132

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Resumen de los par√°metros configurables en el grupo "Alarma c√≠clica"
En el grupo "Alarma c√≠clica" pueden configurarse los siguientes par√°metros:
‚óè Tiempo de ciclo
‚óè Desfase

Par√°metro "Tiempo de ciclo"
El par√°metro "Tiempo de ciclo" permite configurar el intervalo de tiempo entre dos llamadas del
OB de alarma c√≠clica. Es un m√∫ltiplo entero de 1 ¬µs.

Par√°metro "Desfase"
Permite configurar el √∫nico intervalo de tiempo en el que se desplazan los tiempos de arranque
respecto a los m√∫ltiplos del tiempo de ciclo.
Un desfase puede ser √∫til al utilizar varios OB de alarma c√≠clica. Si sus tiempos de ciclo tienen
m√∫ltiplos comunes, se puede utilizar un desfase para evitar que los momentos de arranque
coincidan.

Prioridad del OB de alarma c√≠clica
Al agregar un nuevo OB de alarma c√≠clica a un proyecto, indique su tiempo de ciclo. Al hacerlo,
la prioridad del OB de alarma c√≠clica se predetermina de acuerdo con la siguiente tabla.
Tiempo de ciclo

Prioridad predeterminada

0,25 ms <= tiempo de ciclo <= 2 ms

17

2 ms < tiempo de ciclo <= 5 ms

16

5 ms < tiempo de ciclo <= 10 ms

14

10 ms < tiempo de ciclo <= 100 ms

13

100 ms < tiempo de ciclo <= 200 ms

12

200 ms < tiempo de ciclo <= 500 ms

11

500 ms < tiempo de ciclo <= 1000 ms

10

1000 ms < tiempo de ciclo <= 2000 ms

9

Tiempo de ciclo > 2000 ms

8

La prioridad predeterminada puede modificarse como sigue:
1. Abra el di√°logo "Propiedades" del OB de alarma c√≠clica en cuesti√≥n.
2. Haga clic en el grupo "Atributos" de la navegaci√≥n local.
3. Introduzca el valor que desee en el √°rea "Prioridad" del campo de entrada "Prioridad".

Consulte tambi√©n
OBs de alarma c√≠clica (P√°gina 1107)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1133

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Parametrizar OBs de alarma de proceso
Procedimiento para configurar los eventos de arranque de un OB de alarma de proceso
Cada evento de arranque de un OB de alarma de proceso debe configurarse en las
propiedades del m√≥dulo correspondiente. Proceda del siguiente modo:
1. Abra el di√°logo "Propiedades" del m√≥dulo correspondiente.
2. En la navegaci√≥n local, haga clic en el canal que deba poder disparar una alarma de
proceso.
3. Marque las casillas de verificaci√≥n cuyos eventos deban disparar una alarma de proceso.
Si es necesario, defina los l√≠mites correspondientes.
4. Introduzca un nombre de evento, p. ej., "Flanco ascendente 0".
5. Seleccione en la lista desplegable "Alarma de proceso" un OB de alarma de proceso ya
existente o cree uno nuevo.
6. Si es necesario, indique la prioridad del OB de alarma de proceso.
Para aquellos eventos que se identifican claramente por el nombre, se crea autom√°ticamente
una constante de sistema del tipo de datos "Event_HwInt". Esta se muestra en la tabla de
variables est√°ndar en la ficha "Constantes del sistema".

Resumen de los eventos de arranque de un OB de alarma de proceso
Para visualizar los eventos de arranque configurados actualmente para un OB de alarma de
proceso, proceda del siguiente modo:
1. Abra el di√°logo "Propiedades" del OB de alarma de proceso en cuesti√≥n.
2. Haga clic en el grupo "Eventos de arranque" de la navegaci√≥n local.

Consulte tambi√©n
OBs de alarma de proceso (P√°gina 1108)
Ejemplo de un evento de alarma de proceso (P√°gina 1019)

Parametrizar OB de alarma de sincronismo
Procedimiento para configurar los par√°metros
Para ajustar los par√°metros de un OB de alarma de sincronismo, proceda del siguiente modo:
1. Abra el di√°logo "Propiedades" del OB de alarma de sincronismo en cuesti√≥n.
2. Haga clic en el grupo "Modo is√≥crono" de la navegaci√≥n local.

1134

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Resumen de los par√°metros ajustables
Se pueden configurar los par√°metros siguientes:
‚óè Ciclo de aplicaci√≥n
‚óè Ajuste autom√°tico
‚óè Tiempo de retardo

Par√°metro "Ciclo de aplicaci√≥n"
‚óè En PROFINET: m√∫ltiplo entero (valores posibles: 1, ... 14) del tiempo de ciclo de emisi√≥n
‚óè En PROFIBUS DP: Ciclo DP

Casilla de verificaci√≥n "Ajuste autom√°tico"
‚óè Si la casilla de verificaci√≥n est√° desactivada, se puede definir el tiempo de retardo de forma
manual.
‚óè Si la casilla de verificaci√≥n est√° activada, el tiempo de retardo se calcula autom√°ticamente.
El campo de entrada correspondiente aparece sombreado.

Par√°metro "Tiempo de retardo"
Nota
El par√°metro "Tiempo de retardo" s√≥lo puede definirse si la casilla de verificaci√≥n "Ajuste
autom√°tico" est√° desactivada.
El tiempo de retardo es el intervalo de tiempo que transcurre entre el tiempo de ciclo de emisi√≥n
o el telegrama Global Control y el arranque del OB de alarma de sincronismo. Durante este
tiempo, el controlador PROFINET IO o el maestro DP ejecutan en intercambio de datos c√≠clico
con los dispositivos IO o los esclavos DP.
Si el tiempo de retardo es igual a cero, el OB de alarma de sincronismo se arranca con el
tiempo de ciclo de emisi√≥n o el telegrama Global Control. En este caso es muy probable que
un acceso a la periferia is√≥crona a trav√©s de la instrucci√≥n avanzada "SYNC_PI" al principio del
OB no resulte, ya que los datos de la periferia a√∫n no est√°n disponibles.
Si el tiempo de retardo es mayor que el valor est√°ndar, se "regalar√°" tiempo de ejecuci√≥n del
OB, ya que el acceso a la periferia is√≥crona ya ser√≠a posible antes.

Resumen de los par√°metros mostrados
Se muestran los siguientes par√°metros:
‚óè Periferia descentralizada
‚óè Memoria imagen parcial de proceso

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1135

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

"Periferia descentralizada"
Aqu√≠ se indica el sistema PROFINET IO o el sistema maestro DP cuyos dispositivos IO o
esclavos DP est√°n asignados al OB de alarma de sincronismo.
La definici√≥n de un sistema PROFINET IO o un sistema maestro DP se realiza durante la
asignaci√≥n entre la memoria imagen parcial de proceso y el OB de alarma de sincronismo.

"Memoria imagen parcial de proceso"
Aqu√≠ se muestra la memoria imagen parcial de proceso asignada al OB de alarma de
sincronismo. Esta asignaci√≥n se realiz√≥ durante la configuraci√≥n de hardware.

Consulte tambi√©n
OB de alarma de sincronismo (P√°gina 1111)

Informaci√≥n importante sobre las versiones de firmware de la CPU y las versiones de STEP 7
A continuaci√≥n se detalla informaci√≥n relacionada con la compatibilidad de versiones de
firmware de la CPU y su dependencia de diferentes versiones de STEP 7.
Es posible programar una CPU con firmware nuevo (p. ej. firmware V1.7, que puede
configurarse a partir de STEP 7 V13 SP1) con una versi√≥n de STEP 7 que no sea actual (p. ej.
STEP 7 V12, que solo conoce el firmware V1.0). En este caso, la funcionalidad de la CPU con
versi√≥n de firmware V1.7 est√° limitada a la funcionalidad de la versi√≥n de firmware V1.0.
Las CPU S7-1500 son compatibles con versiones directamente anteriores.
Las CPU S7-1500 son compatibles con CPU S7-1500T comparables. Ejemplo: Una CPU 1511
es compatible con una CPU 1511T.
En el sentido inverso, la compatibilidad solo existe si no se utilizan funciones de Motion Control
avanzadas.

Ejemplos de compatibilidad con versiones anteriores
‚óè La CPU 1516 V2.0 es compatible con todas las versiones de firmware de la CPU 1516.
La CPU 1516 V2.0 se suministra con una referencia nueva, pero es absolutamente
compatible con las CPU predecesoras que tienen una referencia distinta. No hay que tener
en cuenta nada.
‚óè La CPU 1516 V1.7 es compatible con las CPU 1516 V1.6, V1.5, V1.1 y V1.0, pero no con
todas las dem√°s CPU S7-1500, p. ej. con la CPU 1518-4PN/DP.
‚óè La CPU 1513 V1.5 es compatible con las CPU 1513 V1.1 y V1.0, pero no con todas las
dem√°s CPU S7-1500.

1136

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè La CPU 1511 V1.0 no es compatible con las dem√°s CPU S7-1500.
‚óè La CPU 1518F V1.7 es compatible con la CPU 1518F V1.6.
Nota
Compatibilidad de CPU F
Las versiones de CPU F no son compatibles con las CPU no F. As√≠, p. ej., la CPU 1516F
V1.6 no es compatible con la CPU 1516 V1.5, y al rev√©s tampoco.

1.4.1.3

Funcionamiento de las CPU S7-1500R/H

Funcionamiento del sistema redundante S7-1500R/H
Particularidades del sistema redundante S7-1500R/H
Los sistemas de automatizaci√≥n redundantes se emplean para obtener una mayor
disponibilidad. En los sistemas de alta disponibilidad, el funcionamiento en paralelo de dos
sistemas reduce la probabilidad de que ocurran ca√≠das de producci√≥n. En comparaci√≥n con el
sistema de automatizaci√≥n S7-1500, el sistema redundante S7-1500R/H presenta, por
ejemplo, las siguientes particularidades:
‚óè En el sistema redundante S7-1500R/H existen dos CPU, es decir, son redundantes. Si una
de las dos CPU falla, la otra asume el control del proceso en el punto en que se hab√≠a
interrumpido. El fallo de una CPU no influye en el proceso que se controla. Para garantizar
el traspaso del control del proceso, la CPU que est√° controlando el proceso (CPU primaria)
se sincroniza a trav√©s de una conexi√≥n de sincronizaci√≥n redundante (conexi√≥n
redundante) con la CPU que no est√° controlando el proceso (CPU de reserva).
Encontrar√° informaci√≥n sobre la configuraci√≥n del sistema S7-1500R/H en el cap√≠tulo
"Configuraci√≥n del sistema redundante S7-1500R/H (P√°gina 1139)".
‚óè En un sistema S7-1500R/H la periferia est√° conectada a las CPU a trav√©s de un anillo
PROFINET, y est√° configurada como anillo de redundancia de medios.
Encontrar√° m√°s informaci√≥n sobre la configuraci√≥n de un anillo de redundancia de medios
en el cap√≠tulo "Configurar redundancia de medios (P√°gina 3231)".
‚óè En sistemas S7-1500R/H hay estados operativos y estados del sistema nuevos.
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Estados operativos y estados del sistema
(P√°gina 1149)".
‚óè Para las CPU S7-1500R/H existen instrucciones y bloques de organizaci√≥n (OB)
especiales.
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Principios b√°sicos de la ejecuci√≥n del programa
(P√°gina 1156)".
‚óè Los datos del proyecto pueden cargarse en la CPU primaria o en la CPU de reserva.
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Cargar una CPU S7-1500R/H (P√°gina 1160)".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1137

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Adem√°s de las direcciones IP de dispositivo, los sistemas redundantes soportan una
direcci√≥n IP de sistema.
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Comunicaci√≥n con el sistema R/H
(P√°gina 1164)".
‚óè Para el sistema redundante S7-1500R/H existen nuevas posibilidades de diagn√≥stico.
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Diagn√≥stico del sistema redundante S7-1500R/
H (P√°gina 1175)".
Encontrar√° la documentaci√≥n √≠ntegra del sistema redundante S7-1500R/H en el manual de
sistema Sistema redundante S7-1500R/H y en los documentos enlazados.

Restricciones y particularidades (hardware)
Al utilizar el sistema redundante S7-1500R/H existen restricciones de hardware en
comparaci√≥n con el sistema de automatizaci√≥n S7-1500. A continuaci√≥n se indican a t√≠tulo de
ejemplo algunas restricciones:
‚óè La configuraci√≥n hardware del sistema redundante S7-1500R/H no soporta periferia
centralizada ni m√≥dulos de comunicaci√≥n centrales.
Excepciones: fuente de alimentaci√≥n de carga (PM), fuente de alimentaci√≥n del sistema
(PS)
‚óè El sistema redundante S7-1500R/H no soporta m√≥dulos de seguridad.
‚óè tiempos de ciclo y tiempos de reacci√≥n m√°s largos
Encontrar√° un resumen completo de las restricciones del sistema redundante S7-1500R/H en
comparaci√≥n con el sistema de automatizaci√≥n S7-1500 en el cap√≠tulo "Planificaci√≥n de uso >
Restricciones" del manual de sistema "Sistema redundante S7-1500R/H"

Restricciones y particularidades (software)
Al utilizar el sistema redundante S7-1500R/H existen restricciones de software en
comparaci√≥n con el sistema de automatizaci√≥n S7-1500. A continuaci√≥n se indican a t√≠tulo de
ejemplo algunas restricciones:
‚óè Determinadas instrucciones no se soportan o tienen restricciones.
‚óè Datos locales temporales de las funciones (FC): En las CPU S7-1500R/H, la inicializaci√≥n
por parte del sistema con un acceso est√°ndar es igual que con un acceso optimizado;
consulte la descripci√≥n de la inicializaci√≥n por parte del sistema con acceso optimizado en
AUTOHOTSPOT.
‚óè No se soportan IRT, MRPD.
‚óè No se soporta sincronismo.
Encontrar√° un resumen completo de las restricciones del sistema redundante S7-1500R/H en
comparaci√≥n con el sistema de automatizaci√≥n S7-1500 en el cap√≠tulo "Planificaci√≥n de uso >
Restricciones" del manual de sistema "Sistema redundante S7-1500R/H"

1138

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Restricciones en la comunicaci√≥n
‚óè Comunicaci√≥n PG:
‚Äì No se puede acceder online a ambas CPU simult√°neamente. Se puede acceder o bien
a la CPU primaria o bien a la CPU de reserva.
‚Äì No es posible cargar objetos (p. ej. bloques) en modo redundante (estado RUNRedundant); no es posible ni "cargar en dispositivo" ni "cargar de dispositivo". Adem√°s,
en este estado del sistema tampoco es posible trabajar con instant√°neas para variables
de un bloque de datos.
‚Äì No se soporta la funci√≥n "Carga del dispositivo como estaci√≥n nueva"
‚óè Open User Communication:
‚Äì No se permiten conexiones configuradas
‚Äì Secure Open User Communication:
No se soporta, ya que en las CPU S7-1500R/H no es posible administrar certificados: Si
se ha activado Secure OUC, el programa de usuario se podr√° compilar y cargar pero no
se podr√°n agregar certificados a las CPU S7-1500R/H.
Debido a la ausencia de una administraci√≥n de certificados, las conexiones por correo
electr√≥nico solo son "non-secure" (es decir, la instrucci√≥n TMAIL_C solo puede utilizarse
hasta V4.1 inclusive).
‚Äì No se permiten conexiones FDL
‚Äì No es posible establecer la conexi√≥n (instrucci√≥n TCON) con un DB de descripci√≥n de
la conexi√≥n con una estructura conforme a TCON_Param
‚óè No se permite OPC UA
‚óè No se permite comunicaci√≥n S7 como cliente
‚óè No se permite servidor web
‚óè No se permite routing S7 entre la interfaz PROFINET X1 y la interfaz PROFINET X2 de las
CPU
‚óè Las CPU S7-1500R/H no soportan m√≥dulos de comunicaci√≥n centralizados

Consulte tambi√©n
Direcciones IP de sistema (P√°gina 1164)

Configuraci√≥n del sistema redundante S7-1500R/H
Creaci√≥n de CPU R/H
Es posible instalar diversas variantes del sistema redundante S7-1500R/H. En todas las
variantes de instalaci√≥n es imprescindible un anillo PROFINET.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1139

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En las variantes de instalaci√≥n del sistema S7-1500R/H existe redundancia en los
componentes siguientes:
‚óè En las CPU R/H
‚óè Interfaces de sincronizaci√≥n
‚óè Red en el anillo PROFINET
Este cap√≠tulo describe una posible variante de instalaci√≥n. Encontrar√° una descripci√≥n de otras
variantes de instalaci√≥n en el cap√≠tulo "Variantes de instalaci√≥n" del manual de sistema
"Sistema redundante S7-1500R/H"

Creaci√≥n de CPU R/H
En la vista de redes se selecciona una CPU R/H del cat√°logo de hardware y se crea junto con
un rack. Los m√≥dulos deseados se arrastran del cat√°logo de hardware al dispositivo y se
ordenan autom√°ticamente en el rack.
Para seleccionar una CPU R/H del cat√°logo de hardware, proceda del siguiente modo:
1. En el cat√°logo de hardware, navegue hasta la carpeta que contiene las CPU R/H deseadas.
2. Abra la carpeta con el tipo de CPU R/H que busca. Aparecer√°n todas las referencias del tipo
de CPU R/H seleccionado.
3. Haga clic en la referencia de una CPU R/H para obtener informaci√≥n acerca de la CPU R/
H seleccionada en la paleta "Informaci√≥n".
4. En la lista desplegable "Versi√≥n" ajuste la versi√≥n de firmware adecuada de la CPU R/H.
5. Cree la CPU R/H y un rack. Para ello existen las posibilidades siguientes:
‚Äì Arrastre la CPU R/H desde el cat√°logo de hardware hasta la vista de redes con la funci√≥n
Drag & Drop.
‚Äì Haga doble clic en la entrada de la CPU R/H del cat√°logo de hardware.

Representaci√≥n en la vista de redes
STEP 7 crea autom√°ticamente las dos CPU R/H del sistema redundante. STEP 7 representa
gr√°ficamente las dos CPU R/H en la vista de redes:

1140

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Representaci√≥n en el √°rbol del proyecto
En el √°rbol del proyecto, STEP 7 representa ambas CPU R/H del sistema redundante mediante
un √°rbol propio. El √°rbol contiene todos los componentes y editores del proyecto.
Todo sistema redundante del proyecto tiene una carpeta
propia con su nombre interno del proyecto. Debajo de esa
carpeta se encuentran la configuraci√≥n de dispositivos y las
posibilidades de diagn√≥stico que afectan al conjunto del sis‚Äê
tema.
Para cada una de las dos CPU del sistema redundante del
proyecto hay una carpeta propia con su nombre interno del
proyecto.
La CPU que est√° representada m√°s arriba en el √°rbol del
proyecto tiene ID de redundancia "1". Debajo de la CPU
est√°n representadas sus propiedades.
Adem√°s, aqu√≠ se encuentran otras propiedades del sistema
redundante, el programa de usuario y otras partes del pro‚Äê
yecto relevantes para el sistema.
En la carpeta "Periferia descentralizada" encontrar√° enla‚Äê
ces a los dispositivos de periferia descentralizada asigna‚Äê
dos a la CPU.

La CPU que est√° representada m√°s abajo en el √°rbol del
proyecto tiene ID de redundancia "2". Debajo de la CPU
est√°n representadas sus propiedades.

En la carpeta "Dispositivos no agrupados" se re√∫nen todos
los dispositivos de la periferia descentralizada del proyecto.

Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Funcionamiento y estructura del √°rbol del
proyecto" del sistema de informaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1141

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

ID de redundancia y direcciones IP
Cada CPU del sistema redundante tiene una ID de redundancia. La ID de redundancia permite
asignar a la CPU real de la estructura un √°rbol del proyecto en STEP 7. La CPU situada m√°s
arriba en el √°rbol (en este ejemplo: PLC_1) es siempre la CPU con ID de redundancia "1". La
CPU situada abajo (en este ejemplo: PLC_2) tiene ID de redundancia "2".
&RQILJXUDFL¬µQUHDO,'VGHUHGXQGDQFLDSHM

¬ÉUEROGHOSUR\HFWRHQ67(3

&38VXSHULRU 
VLHPSUH,'GH
UHGXQGDQFLD

&38LQIHULRU 
VLHPSUH,'GH
UHGXQGDQFLD

,'GHUHGXQGDQFLD

,'GHUHGXQGDQFLD

$VLJQDFL¬µQ

$VLJQDFL¬µQ

Si una CPU dispone de una configuraci√≥n hardware v√°lida y se modifica su ID de redundancia,
tambi√©n cambiar√°n el nombre y las direcciones IP de esa CPU. Encontrar√° m√°s informaci√≥n
en el cap√≠tulo "ID de redundancia" del manual de sistema "Sistema redundante S7-1500R/H".

Configurar las CPU R/H
Asignaci√≥n de direcci√≥n IP
STEP 7 asigna autom√°ticamente una direcci√≥n IP a cada interfaz PROFINET de una CPU.
Tambi√©n es posible asignar manualmente las direcciones IP, p. ej. en caso de conflicto.
Las direcciones IP para la interfaz PROFINET X1 de las CPU deben estar en la misma subred.
La direcci√≥n IP se muestra en las propiedades de la CPU, en el √°rea "Interfaz PROFINET [X1]"
del apartado "Protocolo IP".

1142

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Asignaci√≥n de la direcci√≥n IP de sistema
Adem√°s de las direcciones IP de dispositivo de las CPU, para el sistema redundante
S7‚Äë1500R/H se pueden asignar direcciones IP de sistema; para cada interfaz PROFINET se
puede asignar una direcci√≥n IP de sistema para la comunicaci√≥n conmutada, adem√°s de la
direcci√≥n IP "normal" (de dispositivo).
La direcci√≥n IP de sistema se utiliza para la comunicaci√≥n con otros dispositivos (p. ej.
dispositivos HMI, CPU, PG/PC). Los dispositivos se comunican a trav√©s de la direcci√≥n IP de
sistema siempre con la CPU primaria del sistema redundante. De este modo se garantiza, p. ej.
que tras un fallo de la CPU primaria en funcionamiento redundante, el interlocutor puede
comunicar con la nueva CPU primaria (anteriormente CPU de reserva) en el estado de sistema
RUN-Solo.
Para activar p. ej. la direcci√≥n IP de sistema para las interfaces PROFINET X1 de las dos CPU,
proceda del siguiente modo:
1. Seleccione una CPU en la vista de redes. Seleccione la ficha "Propiedades" en la ventana
de inspecci√≥n.
2. Seleccione el √°rea "Interfaz PROFINET [X1]", y en el √°rbol de √°rea seleccione el apartado
"Direcci√≥n IP del sistema para la comunicaci√≥n conmutada".
3. Aseg√∫rese de que para la interfaz X1 est√° activada la casilla de verificaci√≥n "Active la
direcci√≥n IP del sistema para la comunicaci√≥n conmutada". Aplique o asigne la direcci√≥n IP
de sistema en el campo "Direcci√≥n IP".
La m√°scara de subred no puede modificarse y se corresponde con la m√°scara de subred
del protocolo IP.
4. Aplique, o a continuaci√≥n asigne a la direcci√≥n IP de sistema una direcci√≥n MAC virtual.
La direcci√≥n MAC virtual tiene seis bytes de longitud. La asignaci√≥n de bytes es
hexadecimal.
Nota
Direcci√≥n MAC virtual
Aseg√∫rese de que todas las direcciones MAC depositadas en los dominios Broadcast de
Ethernet son un√≠vocas. Esto se aplica ante todo a instalaciones con dispositivos externos
compuestos por VRRP y sistemas redundantes que se configuran mediante varios
proyectos STEP 7.
5. La otra CPU aplica la configuraci√≥n autom√°ticamente.

Encontrar√° m√°s informaci√≥n sobre la direcci√≥n IP de sistema en el manual de funciones
"Comunicaci√≥n".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1143

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajuste del tiempo de vigilancia del ciclo
STEP 7 asigna valores est√°ndar al tiempo m√≠nimo de ciclo y al tiempo m√°ximo de ciclo.
Los valores predeterminados se muestran en las propiedades de la CPU, en el √°rea "Ciclo".
Nota
Ajuste del mayor tiempo de ciclo posible
Seleccione los mayores tiempos de ciclo m√≠nimo y m√°ximo que sea posible y que permita el
proceso.
‚óè El tiempo de sincronizaci√≥n en curso de las dos CPU en funcionamiento redundante se
incluye en el tiempo de ciclo.
‚óè En la transici√≥n entre los estados del sistema SYNCUP ‚Üí RUN-Redundant puede
producirse un aumento temporal del tiempo de ciclo.
Si el proceso es controlado solo por una CPU (estado del sistema RUN-Solo), el tiempo de
ciclo es sustancialmente m√°s corto que en funcionamiento redundante.

Creaci√≥n de dispositivos IO para sistemas R/H
Para aprovechar al m√°ximo las ventajas de un sistema R/H redundante, se deben utilizar
dispositivos IO con redundancia de sistema S2 e interconectarlos de forma correspondiente.
Tambi√©n es posible usar dispositivos IO est√°ndar, pero entonces solo se pueden utilizar de
forma limitada las posibilidades del sistema R/H como dispositivo S1 conmutado
("redundancia de sistema S1").

Conceptos de redundancia
En el contexto de redundancia se deben conocer los siguientes t√©rminos y su significado:
‚óè NAP = Network Access Point (punto de acceso de red).
Se denomina NAP a la interfaz PN de un dispositivo IO. En las funciones de redundancia
de PROFINET S1/S2 y R1/R2, la letra hace referencia al n√∫mero de NAP utilizadas. Si se
usa una NAP para el dispositivo IO, la denominaci√≥n es S = Single NAP (NAP √∫nica). Si se
usan dos NAP, la denominaci√≥n es R = Redundant NAPs (NAP redundantes).
‚óè AR = Application Relation (relaci√≥n de aplicaci√≥n).
Se denomina AR a una relaci√≥n de comunicaci√≥n entre un controlador IO y un dispositivo
IO. Si un dispositivo IO est√° conectado a un controlador IO, existe una AR. Si en un sistema
redundante con una CPU primaria y una CPU de reserva existe una relaci√≥n de
comunicaci√≥n con cada uno de los controladores IO, hay dos AR.

1144

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè S1 = Redundancia de sistema con una NAP √∫nica (single) y 1 AR.
El nodo PROFINET del dispositivo IO admite una relaci√≥n de comunicaci√≥n con el sistema
R/H a trav√©s de un solo punto de acceso de red. Todos los dispositivos IO est√°ndar admiten
S1. Aqu√≠ no se trata de una redundancia de sistema real: si la CPU primaria falla, se
interrumpe brevemente la comunicaci√≥n PROFINET hasta que la anteriormente CPU de
reserva reanuda el servicio como nueva CPU primaria.
‚óè S2 = Redundancia de sistema con una NAP √∫nica (single) y 2 AR.
El nodo PROFINET del dispositivo IO admite dos relaciones de comunicaci√≥n con el
sistema R/H a trav√©s de un solo punto de acceso de red. Solo los dispositivos IO con
capacidad S2 admiten la redundancia de sistema S2: si la CPU primaria falla, la
anteriormente CPU de reserva contin√∫a la comunicaci√≥n PROFINET sin interrupciones.

Redundancia de sistema S2
Los dispositivos IO con redundancia de sistema S2 permiten el intercambio de datos de
proceso sin interrupciones con el sistema redundante S7-1500R/H en caso de que falle una
CPU.
Un dispositivo IO con redundancia de sistema S2 admite relaciones de aplicaci√≥n
redundantes, denominadas AR de redundancia de sistema. En un sistema redundante, un
dispositivo IO con redundancia del sistema S2 tiene una AR de redundancia del sistema para
cada una de las dos CPU (controladores IO). Esto significa que un dispositivo IO soporta
simult√°neamente AR de 2 controladores IO (con respecto a los mismos m√≥dulos).
Una AR de redundancia de sistema puede ser una AR primaria o una AR de reserva. Un
dispositivo IO activa los datos de la AR primaria en las salidas. Los datos de la AR de reserva
simplemente se guardan.
‚óè Comportamiento en el estado del sistema RUN-Redundant:
Ambas CPU son controladores IO. La comunicaci√≥n PROFINET se ejecuta
simult√°neamente en las dos AR de redundancia de sistema, entre una de las CPU
(controlador IO) y el dispositivo IO en cada caso. Si falla la CPU primaria, la CPU de reserva
se convierte en CPU primaria y conmuta tambi√©n la AR de reserva a AR primaria. Los datos
de dicha AR se activan en las salidas.
‚óè Comportamiento en el estado del sistema RUN-Solo:
Solo la CPU primaria es un controlador IO. La comunicaci√≥n PROFINET se ejecuta en la
AR primaria, entre la CPU primaria y el dispositivo IO. Entre la CPU de reserva y el
dispositivo IO no hay AR.
Para configurar un dispositivo IO conectado con redundancia de sistema en STEP 7, debe
asignarse un dispositivo IO con redundancia del sistema S2 a las dos CPU del sistema
redundante S7-1500R/H.

Dispositivo S1 conmutado
A partir de la versi√≥n de firmware V2.8, el sistema redundante S7-1500R/H soporta la funci√≥n
de dispositivo S1 conmutado.
La funci√≥n "Dispositivo S1 conmutado" de la CPU permite utilizar dispositivos IO est√°ndar en
el sistema redundante S7-1500R/H. De este modo tambi√©n es posible utilizar configuraciones
PROFINET IO existentes en el sistema redundante S7-1500R/H. Los dispositivos IO est√°ndar
siempre est√°n asignados a las dos CPU del sistema redundante S7-1500R/H. A diferencia del

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1145

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
dispositivo IO con redundancia del sistema S2, el dispositivo IO est√°ndar solo admite una AR.
La AR siempre se establece con la CPU primaria del sistema redundante S7-1500R/H.
‚óè Comportamiento en el estado del sistema RUN-Redundant:
La comunicaci√≥n PROFINET se ejecuta en la AR entre la CPU primaria (controlador IO) y
el dispositivo IO est√°ndar. Entre la CPU de reserva y el dispositivo IO est√°ndar no hay
ninguna AR.
Si falla la CPU primaria o pasa a STOP, el sistema redundante S7-1500R/H se comporta
del modo siguiente:
‚Äì La AR entre la CPU primaria y el dispositivo IO est√°ndar se interrumpe.
‚Äì La que hasta ahora era la CPU de reserva se convierte en la nueva CPU primaria.
‚Äì El sistema redundante S7-1500R/H no tiene temporalmente acceso a las entradas ni
control sobre las salidas del dispositivo IO est√°ndar. En este tiempo se aplica el
comportamiento de valores sustitutivos parametrizado para los m√≥dulos del dispositivo
IO est√°ndar.
‚Äì La nueva CPU primaria establece una AR con el dispositivo IO est√°ndar.
‚Äì En cuanto la nueva CPU primaria configure la AR, el sistema redundante S7-1500R/H
volver√° a tener acceso a las entradas y a controlar las salidas del dispositivo IO est√°ndar.
‚óè Comportamiento en el estado del sistema RUN-Solo:
Solo la CPU primaria es un controlador IO. La comunicaci√≥n PROFINET se ejecuta en la
AR entre la CPU primaria (controlador IO) y el dispositivo IO est√°ndar. No hay ninguna AR
entre la CPU de reserva y el dispositivo IO est√°ndar.
Para configurar en STEP 7 un dispositivo IO conectado con la funci√≥n "Dispositivo S1
conmutado", debe asignarse un dispositivo IO est√°ndar a las dos CPU del sistema redundante
S7-1500R/H.

Creaci√≥n y asignaci√≥n de dispositivos IO con redundancia de sistema S2
Agregue dispositivos IO con redundancia de sistema S2 a la configuraci√≥n de CPU R/H. Para
ello haga lo siguiente:
1. Busque dispositivos IO con redundancia de sistema S2 en el cat√°logo de hardware, en
Periferia descentralizada, o bien
haga clic en la referencia del dispositivo IO en el cat√°logo para buscar dispositivos IO con
una indicaci√≥n sobre redundancia de sistema S2 en la paleta "Informaci√≥n".
2. En la lista desplegable "Versi√≥n", ajuste la versi√≥n de firmware adecuada del dispositivo IO
si es necesario.
3. Arrastre el dispositivo IO desde el cat√°logo de hardware hasta la vista de redes con la
funci√≥n Drag & Drop, o bien
haga doble clic en la entrada del dispositivo IO del cat√°logo de hardware.
4. Arrastre los m√≥dulos deseados a los slots correspondientes del dispositivo IO.
Si es necesario, agregue otros dispositivos IO.

1146

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Para asignar dispositivos IO al sistema redundante S7-1500R/H, conecte cada dispositivo
IO a cada CPU:
‚Äì Mediante la funci√≥n Drag & Drop, trace una l√≠nea entre la interfaz PROFINET del
dispositivo IO y la interfaz PROFINET X1 de la CPU izquierda.
‚Äì Mediante la funci√≥n de Drag & Drop, trace una l√≠nea entre la interfaz PROFINET del
dispositivo IO y la interfaz PROFINET X1 de la CPU derecha.
6. Si es necesario, asigne otros dispositivos IO a las dos CPU.
Los dispositivos IO se conectar√°n al sistema S7‚Äë1500R/H con redundancia en todo el
sistema.

Configuraci√≥n del router en sistemas R/H
Si se utilizan routers en sistemas RH, se debe asegurar que la configuraci√≥n del router en las
CPU y en los dispositivos IO sea coherente. Para evitar errores en la comprobaci√≥n de
coherencia de las direcciones de router, no se deben mezclar las siguientes posibilidades de
configuraci√≥n:
‚óè Si en un dispositivo IO asignado est√° activado el ajuste de interfaz "Sincronizar los ajustes
del router con el controlador IO", en el sistema S7-1500R/H, tanto en la CPU primaria como
en la de reserva, debe estar activado el uso del router y estar ajustada la misma direcci√≥n
de router en "Interfaz PROFINET > Direcciones Ethernet > Protocolo IP".
‚óè Si en el sistema S7-1500R/H, tanto en la CPU primaria como en la de reserva, est√° activado
el uso del router, pero est√°n ajustadas direcciones de router distintas en "Interfaz
PROFINET > Direcciones Ethernet > Protocolo IP", en el dispositivo IO debe estar
desactivado el ajuste de interfaz "Sincronizar los ajustes del router con el controlador IO".
A continuaci√≥n se describe una configuraci√≥n incoherente de un sistema R/H:
‚óè La CPU primaria tiene configurado el router A.
‚óè La CPU de reserva tiene configurado el router B.
‚óè El dispositivo IO tiene configurado "Sincronizar los ajustes del router con el controlador IO".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1147

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5RXWHU$

3ULPDU\&38

5RXWHU%

%DFNXS&38

5+6\VWHP

,2'HYLFH
,36XEQHW$

,36XEQHW5+

,36XEQHW5+

352),1(7

Figura 1-31

,36XEQHW%

Ejemplo de configuraci√≥n: routers en sistemas R/H

1. Al arrancar la CPU primaria, se establece la relaci√≥n de comunicaci√≥n primaria con el
dispositivo IO, a trav√©s de la cual la CPU primaria transfiere tambi√©n la direcci√≥n del router
A.
2. Al arrancar la CPU de reserva, se establece la relaci√≥n de comunicaci√≥n de reserva con el
dispositivo IO, a trav√©s de la cual la CPU de reserva transfiere la direcci√≥n del router B.
Se produce un error de coherencia en el dispositivo IO, puesto que ya ha recibido la direcci√≥n
del router A, que es distinta de la del router B. Esto impide que se establezca la relaci√≥n de
comunicaci√≥n de reserva. El dispositivo IO no se comporta como un dispositivo S2 y, si fallara
la CPU primaria, en caso de redundancia el intercambio de datos IO c√≠clico no se desarrollar√≠a
sin interrupciones.

Crear configuraci√≥n de anillo MRP
Ajustar la funci√≥n MRP de las CPU R/H
Al crear en STEP 7 un sistema redundante S7-1500R/H, STEP 7 asigna autom√°ticamente la
funci√≥n MRP "Manager (auto)" a las interfaces PROFINET X1 de las dos CPU.

1148

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Definir funciones MRP para otras estaciones del anillo
Para definir la redundancia de medios para otras estaciones del anillo, proceda del siguiente
modo:
1. Seleccione en la vista de redes de STEP 7 la interfaz PROFINET X1 de una de las dos CPU
del sistema redundante S7-1500R/H.
2. En la ventana de inspecci√≥n, navegue hasta "Propiedades" > "General" > "Opciones
avanzadas" > "Redundancia de medios".

3. Haga clic en el bot√≥n "Ajustes del dominio".
STEP 7 muestra en la ventana de inspecci√≥n las propiedades del dominio MRP en el que
se encuentra la interfaz PROFINET X1 de la CPU.
4. En la columna "Funci√≥n MRP" de la tabla "Dispositivos" asigne la funci√≥n MRP "Cliente" a
todas las dem√°s estaciones del anillo.

Parametrizaci√≥n de estaciones fuera del proyecto STEP 7
Para las estaciones del anillo que no est√©n en STEP 7, ajuste la funci√≥n MRP "Cliente".
Por ejemplo, para un switch ajuste la funci√≥n MRP "Cliente" a trav√©s de la interfaz web del
switch

Estados operativos y estados del sistema
Resumen
Las CPU S7-1500R/H disponen de los mismos estados operativos que las CPU S7-1500
Standard y de otros estados operativos adicionales.
Los estados del sistema son la imagen de un estado resultante de los estados operativos de
ambas CPU en el sistema redundante.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1149

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Estados operativos y estados del sistema" en el
manual de sistema "Sistema redundante S7-1500R/H".

Estados operativos
Los estados operativos describen el comportamiento de una CPU independiente en un
momento determinado. Conocer los estados operativos de las CPU es √∫til para programar el
arranque, para realizar tests y para el diagn√≥stico. Los LED de estado situados en la cara
frontal y en el display de la CPU indican el estado operativo actual.
Las CPU S7-1500R/H disponen de los mismos estados operativos que las CPU S7-1500
Standard, STOP, ARRANQUE y RUN. Para funcionar como sistema redundante, una de las
dos CPU puede adoptar otro estado operativo, SYNCUP, para la sincronizaci√≥n de los dos
sistemas parciales. Para sistemas redundantes, el estado operativo RUN se divide en RUN,
RUN-Syncup y RUN-Redundant.

Estados del sistema
Los estados del sistema permiten evaluar directamente el comportamiento de un sistema
redundante. Son el resultado de la combinaci√≥n de los estados operativos de cada una de las
CPU.

Sinopsis de los estados operativos y de los estados del sistema
La figura siguiente muestra los estados operativos posibles de las CPU y los estados de
sistema resultantes.
Por norma general, ambas CPU tienen los mismos derechos, de modo que cada una de ellas
puede ser tanto la CPU primaria como la de reserva. La CPU que se ha conmutado primero de
STOP a RUN se convierte en la CPU primaria.

1150

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

(VWDGRVRSHUDWLYRV
&38SULPDULD

(VWDGRVGHOVLVWHPD

(VWDGRVRSHUDWLYRV
&38GHUHVHUYD

5815HGXQGDQW

5815HGXQGDQW

5815HGXQGDQW


5816\QFXS


6<1&83


581


6<1&83





5816ROR


$55$148(




6723

6723

$55$148(

6723

En la tabla siguiente encontrar√° una sinopsis del arranque del sistema redundante y de c√≥mo
pasa por los diferentes estados operativos y de sistema. La siguiente situaci√≥n de partida y los
pasos realizados son un ejemplo.
Los estados operativos y del sistema se describen al detalle en los pr√≥ximos cap√≠tulos.
Tabla 1-86

Arranque del sistema redundante

N.¬∫ en la fi‚Äê CPU primaria
gura

Estado del sistema

CPU de reserva

Situaci√≥n de partida: Ambas CPU se encuentran en estado operativo STOP. El selector de modo tambi√©n se encuentra en
la posici√≥n STOP.
1.er paso: Cambie el selector de modo de la CPU que ser√° la CPU primaria de STOP a RUN.

‚ë†

‚ë°

La CPU cambia a ARRANQUE y
ejecuta el OB de arranque 100 y,
dado el caso, otros OB de arran‚Äê
que.

STOP ‚Üí ARRANQUE

La CPU permanece en STOP.

Una vez que el ARRANQUE ha
finalizado correctamente, la CPU
cambia a RUN.

ARRANQUE ‚Üí RUN-Solo

La CPU permanece en STOP.

La CPU funciona en RUN como
cualquier CPU est√°ndar y ejecuta
el programa de usuario.
2.¬∫ paso: Cambie el selector de modo de la CPU de reserva de STOP a RUN.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1151

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
N.¬∫ en la fi‚Äê CPU primaria
gura

‚ë¢

‚ë£

RUN ‚Üí RUN-Syncup

Estado del sistema

CPU de reserva

RUN-Solo ‚Üí SYNCUP

STOP ‚Üí SYNCUP

Ambos programas de usuario se sincronizan para el funcionamiento redundante. La CPU primaria copia los
contenidos de las memorias de carga y trabajo en la CPU de reserva. La CPU de reserva recupera la ejecuci√≥n
del programa de usuario de la CPU primaria. Una vez que la sincronizaci√≥n se ha completado correctamente,
ambas CPU contienen contenidos id√©nticos en las memorias.
RUN-Syncup ‚Üí RUN-Redundant

SYNCUP ‚Üí RUN-Redundant

SYNCUP ‚Üí RUN-Redundant

Despu√©s de SYNCUP ambas CPU pasan al estado operativo RUN-Redundant. Ambas CPU procesan sincr√≥‚Äê
nicamente el programa de usuario.

Estado operativo ARRANQUE
Ejecuci√≥n del arranque (solo en la CPU primaria)
El ARRANQUE solo se ejecuta en la CPU primaria.
La CPU se comporta en el ARRANQUE exactamente igual que una CPU S7-1500 est√°ndar.

Comportamiento
Antes de que la CPU empiece a ejecutar el programa de usuario c√≠clico, se procesa un
programa de arranque.
En el ARRANQUE, la CPU compara la configuraci√≥n de la periferia existente con la
configuraci√≥n hardware creada con STEP 7.
En el programa de arranque se pueden definir las variables de inicializaci√≥n para el programa
c√≠clico programando los OB de arranque de forma adecuada. Es posible no programar ning√∫n
OB de arranque, programar s√≥lo uno o bien varios.

Particularidades
‚óè Todas las salidas est√°n desactivadas o reaccionan del modo parametrizado para el m√≥dulo
en cuesti√≥n: Devuelven el valor sustitutivo parametrizado o mantienen el √∫ltimo valor
emitido, con lo que el proceso controlado pasa a un estado operativo seguro.
‚óè La memoria imagen del proceso est√° inicializada.
‚óè La memoria imagen del proceso no se actualiza.
Para leer el estado actual de las entradas en el ARRANQUE, se puede acceder a las
entradas mediante acceso directo a periferia.
Para inicializar las salidas en el ARRANQUE, se pueden escribir los valores a trav√©s de la
memoria imagen del proceso o mediante acceso directo a periferia. Los valores se
transmiten a las salidas en la transici√≥n al estado operativo RUN.
‚óè La CPU arranca siempre en caliente.
‚Äì Si los datos se definen como remanentes, su contenido se conserva al arrancar el
programa tras STOP o si se produce un corte de alimentaci√≥n.
‚Äì Las marcas, los temporizadores y los contadores no remanentes est√°n inicializados.
‚Äì Las variables no remanentes en bloques de datos est√°n inicializadas.

1152

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè En el ARRANQUE no se vigila el tiempo de ciclo.
‚óè La CPU ejecuta los OB de arranque por el orden num√©rico de estos. La CPU ejecuta todos
los OB de arranque programados independientemente del modo de arranque seleccionado
(consulte la figura inferior "Ajuste del comportamiento en arranque").
‚óè Si se produce un evento, la CPU puede iniciar los siguientes OB en el arranque:
‚Äì OB 82: Alarma de diagn√≥stico
‚Äì OB 83: Enchufe/desenchufe de m√≥dulos
‚Äì OB 86: Fallo de rack
‚Äì OB 121: Error de programaci√≥n (solo con tratamiento de errores global)
‚Äì OB 122: Error de acceso a la periferia (solo con tratamiento de errores global)
La CPU no podr√° iniciar los restantes OB hasta que no cambie al estado operativo RUN.

Consulte tambi√©n
Resumen (P√°gina 1149)

Estado operativo STOP
Comportamiento
En el estado operativo STOP las CPU del sistema redundante se comportan exactamente
igual que las CPU S7-1500 est√°ndar.
En estado operativo STOP la CPU no ejecuta el programa de usuario.
Si ambas CPU est√°n en estado operativo STOP, todas las salidas est√°n desactivadas o
reaccionan de la forma parametrizada para el m√≥dulo correspondiente: Devuelven el valor
sustitutivo parametrizado o mantienen el √∫ltimo valor emitido, con lo que el proceso controlado
se mantiene en un estado operativo seguro.

Particularidades
En estado operativo STOP, la CPU de reserva no establece ninguna conexi√≥n con los
dispositivos IO.
En estado operativo STOP, la CPU primaria establece conexiones con los dispositivos IO. La
CPU primaria activa la direcci√≥n IP de sistema en estado operativo STOP, siempre que la
direcci√≥n IP de sistema se haya configurado.
Si ambas CPU se encuentran en estado operativo STOP y carga una configuraci√≥n en una
CPU, deber√° observar los siguientes puntos:
‚óè Primero hay que arrancar la CPU en la que ha cargado la configuraci√≥n, para que se
convierta en o siga siendo CPU primaria
‚óè Al cargar en la CPU primaria, en el estado operativo STOP tambi√©n los dispositivos IO
conectados se parametrizan conforme a la configuraci√≥n hardware cargada.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1153

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Resumen (P√°gina 1149)

Estado operativo SYNCUP
Comportamiento
En el estado operativo SYNCUP el sistema operativo sincroniza la CPU de reserva con la CPU
primaria. La CPU primaria est√° en estado operativo RUN-Syncup y controla el proceso.
A diferencia de la CPU primaria, la CPU de reserva no recorre el estado operativo ARRANQUE.
Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Estado del sistema SYNCUP (P√°gina 1156)".

Consulte tambi√©n
Resumen (P√°gina 1149)

Estados operativos RUN
Estados operativos RUN
La CPU primaria recorre varios estados operativos hasta alcanzar el estado del sistema RUNRedundant:
‚óè RUN
‚óè RUN-Syncup
‚óè RUN-Redundant
De estos estados operativos, la CPU de reserva solo conoce el estado operativo RUNRedundant.

Estado operativo RUN
En el estado operativo RUN la CPU primaria se comporta igual que una CPU S7-1500
Standard. Ejecuta por s√≠ sola el procesamiento del programa c√≠clico, controlado por tiempo y
por alarmas.
Las direcciones que se encuentren en la memoria imagen de proceso "Actualizaci√≥n
autom√°tica" se actualizar√°n autom√°ticamente en cada ciclo del programa. Encontrar√° m√°s
informaci√≥n en el cap√≠tulo "Memoria imagen de proceso y memoria imagen parcial de proceso"
del manual de sistema "Sistema redundante S7-1500R/H".
Una vez que la CPU ha escrito las salidas y ha le√≠do las entradas, el programa c√≠clico se
ejecuta desde la primera instrucci√≥n hasta la √∫ltima. Los eventos con mayor prioridad, como
p. ej. alarmas de proceso, alarmas de diagn√≥stico y comunicaci√≥n, pueden interrumpir el flujo
c√≠clico del programa y alargar el tiempo de ciclo.

1154

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si se ha parametrizado un tiempo m√≠nimo de ciclo, la CPU termina el ciclo una vez transcurrido
el tiempo m√≠nimo de ciclo aunque la ejecuci√≥n del programa de usuario haya requerido menos
tiempo.
El sistema operativo vigila si el tiempo de ejecuci√≥n del programa c√≠clico alcanza un l√≠mite
superior configurable, el tiempo de ciclo m√°ximo. Dicho tiempo de vigilancia se reinicia
llamando la instrucci√≥n RE_TRIGR en cualquier punto del programa.
Si el programa c√≠clico excede el tiempo de vigilancia del ciclo, en caso necesario arranca el OB
de error de tiempo (OB 80). Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Eventos de arranque"
del manual de sistema "Sistema redundante S7-1500R/H".

Particularidades en el estado operativo RUN
En funcionamiento no redundante las CPU son independientes entre s√≠. Pueden tener
proyectos distintos.

Estado operativo RUN-Syncup
En el estado operativo RUN-Syncup la CPU de reserva se sincroniza con la CPU primaria. En
la CPU de reserva se ejecuta simult√°neamente SYNCUP, que influye provisionalmente sobre
la CPU primaria (p. ej. retardo de servicios as√≠ncronos, prolongaci√≥n del tiempo de ciclo
mediante reuni√≥n de los contenidos de las memorias de carga). Encontrar√° m√°s informaci√≥n
en el cap√≠tulo "Estado del sistema SYNCUP" del manual de sistema "Sistema redundante
S7-1500R/H".
El sistema operativo sincroniza coherentemente el contenido de la memoria de trabajo de la
CPU primaria en un punto de control del ciclo. Durante la sincronizaci√≥n, el ciclo de programa
en la CPU primaria se prolonga en funci√≥n de la cantidad de datos que se sincronizan,
adicionalmente a otros tiempos de ciclo de la aplicaci√≥n.

Estado operativo RUN-Redundant
En el estado operativo RUN-Redundant, ambas CPU procesan s√≠ncronamente el programa de
usuario.
En el estado operativo RUN-Redundant no es posible cargar objetos (p. ej. bloques) en modo
redundante; no es posible "cargar en dispositivo" ni "cargar de dispositivo". Adem√°s, en este
estado del sistema tampoco es posible trabajar con instant√°neas para variables de un bloque
de datos.

Consulte tambi√©n
Resumen (P√°gina 1149)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1155

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estado del sistema SYNCUP
Estado del sistema SYNCUP
En el estado del sistema SYNCUP el sistema operativo sincroniza los programas de usuario
de las dos CPU para el funcionamiento redundante. En el estado de sistema SYNCUP el
sistema operativo sincroniza la CPU de reserva con la CPU primaria. La CPU de reserva est√°
en estado operativo SYNCUP; la CPU primaria est√° en estado operativo RUN-Syncup y
controla el proceso. Con el estado del sistema SYNCUP, el sistema redundante pasa del
estado del sistema RUN-Solo a RUN-Redundant. Despu√©s, ambas CPU procesan
sincr√≥nicamente el mismo programa de usuario. Si en funcionamiento redundante falla la CPU
primaria, la CPU de reserva se hace cargo del control del proceso en el punto en que se ha
interrumpido, actuando como nueva CPU primaria.

Propiedades
‚óè Una conexi√≥n online existente entre la CPU primaria y la programadora/PC al iniciarse el
estado del sistema SYNCUP se interrumpe durante el SYNCUP. No se restablece
autom√°ticamente una vez finalizado el SYNCUP.
‚óè Si se llaman las instrucciones RDREC y WRREC durante el estado del sistema SYNCUP,
siempre se devuelven los c√≥digos de error 0x7001 y 0x7002. Tampoco se devuelve otro
c√≥digo de error en caso de error, por ejemplo cuando no existen el origen o el destino del
juego de datos. En este caso, el c√≥digo de error correcto no se devuelve hasta que ha
finalizado el SYNCUP.
Si se llaman las instrucciones RDREC y WRREC durante el estado del sistema SYNCUP,
no se inicia ninguna orden del juego de datos. La orden del juego de datos no se inicia hasta
que se vuelve a llamar la instrucci√≥n una vez finalizado el SYNCUP. Por este motivo se
recomienda llamar siempre RDREC y WRREC de forma c√≠clica.
Encontrar√° otras propiedades y repercusiones del SYNCUP sobre el programa de usuario en
el cap√≠tulo "Estado del sistema SYNCUP" del manual de sistema "SIMATIC S7-1500R/H".

Consulte tambi√©n
Resumen (P√°gina 1149)

Principios b√°sicos de la ejecuci√≥n del programa
Programaci√≥n de las CPU S7-1500R/H
Programa de usuario para el sistema redundante S7-1500R/H
Para dise√±ar y programar el programa de usuario para el sistema redundante S7-1500R/H se
aplican las mismas reglas que para el sistema de automatizaci√≥n S7-1500.
En funcionamiento redundante los programas de usuario depositados en ambas CPU son
id√©nticos. Las dos CPU procesan el programa de usuario con sincronizaci√≥n de eventos.

1156

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Respecto al procesamiento del programa de usuario el sistema redundante S7-1500R/H se
comporta igual que el sistema de automatizaci√≥n S7-1500. La sincronizaci√≥n est√° integrada en
el sistema operativo y se ejecuta de manera autom√°tica y oculta entre la CPU primaria y la CPU
de reserva.

Instrucciones y bloques espec√≠ficos para el sistema redundante S7‚Äë1500R/H
Para el sistema redundante S7‚Äë1500R/H se dispone de instrucciones y OB espec√≠ficos.
Con la instrucci√≥n "RH_CTRL" se influye en los procesos en los sistemas R/H. Con la versi√≥n
de firmware V2.6 se bloquea el estado de sistema SYNCUP o se habilita de nuevo el estado
de sistema SYNCUP. El objetivo es que el estado de sistema SYNCUP solo pueda permitirse
cuando sea necesario en unas pocas fases cr√≠ticas del proceso (v√©ase el cap√≠tulo "Bloquear/
habilitar estado del sistema SYNCUP con la instrucci√≥n RH_COTRL" en el manual de sistema
"Sistema redundante S7-1500R/H").
Con la instrucci√≥n "RH_GetPrimaryID" se lee en el programa de usuario cu√°l de las dos CPU
es actualmente la CPU primaria. Encontrar√° m√°s informaci√≥n en el cap√≠tulo "Determinar la
CPU primaria con la instrucci√≥n 'RH_GetPrimaryID'" en el manual de sistema Sistema
redundante S7-1500R/H.
Adem√°s de los OB de la CPU S7‚Äë1500 se dispone del OB 72. El OB 72 permite p. ej. manejar
errores de redundancia.

Particularidades de la ejecuci√≥n del programa
‚óè Se crea el programa de usuario para el sistema redundante S7-1500R/H en la CPU
superior (p. ej. PLC_1) en el √°rbol del proyecto de STEP 7.
‚óè El sistema redundante S7-1500R/H no soporta algunas instrucciones de las CPU S7-1500.
Las instrucciones que no son compatibles con el sistema redundante S7-1500R/H pueden
verse en gris en STEP 7 en la Task Card "Instrucciones".
Las instrucciones que no son compatibles con el c√≥digo de programa se muestran en rojo
en STEP 7. Si se compila el c√≥digo de programa con instrucciones no compatibles, STEP 7
proporciona el correspondiente mensaje de error.
Encontrar√° las instrucciones que no son compatibles en el cap√≠tulo "Principios b√°sicos de
la ejecuci√≥n del programa > Restricciones" en el manual de sistema "Sistema redundante
S7-1500R/H".
‚óè En instrucciones con el par√°metro de bloque "LADDR", este par√°metro le permite
determinar cu√°l de las dos CPU es el destino de la instrucci√≥n.
Ejemplo: Para leer los datos I&M de la CPU con ID de redundancia 1, hay que indicar en el
par√°metro de bloque "LADDR" de la instrucci√≥n Get_IM_Data el identificador HW 65149 (o
la constante de sistema "Local1").
‚óè Comportamiento de las instrucciones as√≠ncronas
‚Äì Por lo general, las instrucciones as√≠ncronas retardan el proceso del SYNCUP hasta el
fin de su ejecuci√≥n.
‚Äì

Cuando se inicia una instrucci√≥n as√≠ncrona mientras se est√° ejecutando el SYNCUP, se
pone en estado de espera. En este estado operativo la instrucci√≥n espera hasta que
finaliza el proceso del SYNCUP. Una vez finalizado el proceso del SYNCUP, la
instrucci√≥n as√≠ncrona pasa al estado activo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1157

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Comportamiento del sistema redundante S7-1500R/H en caso de rebases del tiempo
m√°ximo de ciclo, si no se ha creado ning√∫n OB de error de tiempo
La primera vez que se rebasa el tiempo m√°ximo de ciclo en los estados del sistema RUNRedundant y SYNCUP se produce una p√©rdida de redundancia: la CPU primaria pasa al
estado operativo RUN y la CPU de reserva al estado operativo STOP.
La segunda vez que se rebasa el tiempo de ciclo dentro de un mismo ciclo, la CPU primaria
pasa al estado operativo STOP.
Encontrar√° m√°s detalles en el cap√≠tulo "Principios b√°sicos de la ejecuci√≥n del programa" del
manual de sistema S7-1500R/H.
‚óè Comportamiento del sistema redundante S7-1500R/H en caso de rebases del tiempo
m√°ximo de ciclo, si se ha creado un OB de error de tiempo
La primera vez que se rebasa el tiempo m√°ximo de ciclo en los estados del sistema RUNRedundant y SYNCUP, el sistema R/H permanece en su estado del sistema; se llama el OB
80 y se inicializa el tiempo de ciclo.
La segunda vez que se rebasa el tiempo de ciclo en un mismo ciclo del programa se
produce una p√©rdida de redundancia: la CPU primaria pasa al estado operativo RUN y la
CPU de reserva al estado operativo STOP. se llama el OB 80 y se inicializa el tiempo de
ciclo.
La tercera vez que se rebasa el tiempo de ciclo en un mismo ciclo del programa, la CPU
primaria pasa al estado operativo STOP.
Encontrar√° m√°s detalles en el cap√≠tulo "Principios b√°sicos de la ejecuci√≥n del programa" del
manual de sistema S7-1500R/H.

Consulte tambi√©n
Bloques de organizaci√≥n (P√°gina 1158)

Bloques de organizaci√≥n
OB de error de redundancia en CPU
Descripci√≥n
El sistema operativo de cada CPU de un sistema R/H llama el OB de error de redundancia en
CPU (OB72) cuando se presenta uno de los eventos siguientes:
‚óè P√©rdida de redundancia por fallo de una CPU
‚óè P√©rdida de redundancia por paso de una CPU al estado operativo STOP (disparada por el
usuario o por el sistema)
‚óè El sistema R/H ha adoptado el estado del sistema RUN-Redundant.

1158

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la informaci√≥n de arranque
Un OB de error de redundancia en CPU tiene la siguiente informaci√≥n de arranque:
‚óè Como en las CPU S7-400:
Variable

Tipo de datos

Descripci√≥n

OB72_EV_CLASS

BYTE

Clase de evento e identificadores:
‚óè

OB72_FLT_ID

BYTE

B#16#73: evento entrante

C√≥digo de error
Valores posibles:
‚óè B#16#01: p√©rdida de redundancia por fallo de
una CPU
‚óè B#16#02: p√©rdida de redundancia por transici√≥n
de una CPU al estado operativo STOP
‚óè B#16#03: el sistema R/H ha adoptado el estado
del sistema RUN-Redundant.

OB72_PRIORITY

BYTE

Clase de prioridad

OB72_OB_NUMBER

BYTE

N√∫mero de OB (72)

OB72_RESERVED_1

WORD

‚óè High byte: B#16#00
‚óè Low byte: reservado

OB72_INFO_1

WORD

W#16#0000

OB72_INFO_2

WORD

W#16#0000

OB72_INFO_3

WORD

W#16#0000

OB72_DATE_TIME

DATE_AND_TIME Fecha y hora en las que se solicit√≥ el OB

‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de datos

Significado

LADDR

HW_ANY

Identificador de hardware del objeto de
hardware defectuoso

Event_Class

BYTE

Id√©ntico a la variable OB72_EV_CLASS
de la tabla anterior

Fault_ID

BYTE

Id√©ntico a la variable OB72_FLT_ID de la
tabla anterior

Eventos de arranque del OB72
OB72_EV_CLASS o Event_Class

OB72_FLT_ID o Fault_ID

Evento de arranque

B#16#73

B#16#01

P√©rdida de redundancia por fallo de una CPU

B#16#73

B#16#02

P√©rdida de redundancia por transici√≥n de una CPU al es‚Äê
tado operativo STOP

B#16#73

B#16#03

El sistema R/H ha adoptado el estado del sistema RUNRedundant.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1159

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Cargar una CPU S7-1500R/H
Cargar datos de proyecto en las CPU
Los datos de proyecto se pueden cargar a las CPU del sistema S7-1500R/H desde una
programadora o un PC o bien un dispositivo HMI utilizando una conexi√≥n online. Los datos de
proyecto pueden cargarse en la CPU primaria o bien en la CPU de reserva, pero el acceso
simult√°neo a ambas CPU no es posible.
En el ajuste predeterminado, los datos de proyecto se cargan en la CPU primaria.
Seguidamente, en el estado del sistema SYNCUP se copian los datos de proyecto de la CPU
primaria en la CPU de reserva.
Los datos de proyecto tambi√©n pueden cargarse en la CPU de reserva. Esto se hace cuando
la CPU de reserva debe pasar a ser la CPU primaria al realizar un rearranque completo.
Los datos de proyecto completos (todos los datos de configuraci√≥n y el programa de usuario
completo) solo pueden cargarse en una CPU en el estado operativo STOP.
En el estado del sistema RUN-Solo tambi√©n es posible cargar el programa de usuario en una
CPU primaria en estado operativo RUN. Durante la carga la CPU primaria sigue manteniendo
el control del proceso y la instalaci√≥n no se para.

Consulte tambi√©n
Cargar datos de proyecto en la CPU primaria (P√°gina 1160)
Arrancar la CPU primaria despu√©s de la carga (P√°gina 1161)
Cargar datos de proyecto en la CPU de reserva (P√°gina 1162)
Cargar el programa de usuario en la CPU primaria (P√°gina 1163)

Cargar datos de proyecto en la CPU primaria
En el ajuste predeterminado, los datos de proyecto se cargan en la CPU primaria. Para cargar
los datos de proyecto completos (todos los datos de configuraci√≥n y el programa de usuario
completo) es necesario que la CPU se encuentre en el estado operativo STOP. Seguidamente,
en el estado del sistema SYNCUP se copian los datos de proyecto de la CPU primaria en la
CPU de reserva.

Requisitos
‚óè Se han asignado las direcciones IP.
‚óè La CPU primaria se encuentra en el estado operativo STOP.

Procedimiento
Para cargar datos de proyecto en la CPU primaria, proceda del siguiente modo:
1. Seleccione el sistema S7-1500R/H en el √°rbol del proyecto.
2. Abra el men√∫ contextual con el bot√≥n derecho del rat√≥n.

1160

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Elija el comando "Cargar en dispositivo > Hardware y software (solo cambios)" del men√∫
contextual.
Se abre el cuadro de di√°logo "Carga avanzada".
4. Seleccione la subred en la lista desplegable "Tipo de interfaz PG/PC".
5. Seleccione el adaptador en la lista desplegable "Interfaz PG/PC".
6. En la lista desplegable "Conexi√≥n con interfaz/subred", seleccione la interfaz con la que
existe una conexi√≥n desde la programadora/el PC.
Otra posibilidad consiste en seleccionar la entrada "Probar todas las interfaces".
7. Haga clic en el bot√≥n "Iniciar b√∫squeda".
La tabla "Seleccionar dispositivo de destino" muestra las CPU del sistema S7-1500R/H con
sus roles. La CPU primaria est√° seleccionada por defecto.
8. Haga clic en el bot√≥n "Cargar".

Resultado
Si fuera necesario, antes de la carga se compilar√°n los datos de proyecto.
El cuadro de di√°logo "Resultados de la operaci√≥n de carga" muestra los resultados de la
operaci√≥n de carga.

Arrancar la CPU primaria despu√©s de la carga
Despu√©s de cargar los datos de proyecto arranque la CPU primaria.

Requisitos
‚óè Se han cargado datos de proyecto coherentes y compilados correctamente.
‚óè El selector de modo de la CPU primaria est√° en RUN.

Procedimiento
ADVERTENCIA
Arranque de la CPU primaria con un programa de usuario con errores
Antes de arrancar la CPU primaria aseg√∫rese de que si hubiera errores en el programa de
usuario estos no pueden causar da√±os materiales ni personales ni provocar situaciones
peligrosas.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1161

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para arrancar la CPU primaria despu√©s de la carga, proceda del siguiente modo:
1. En el cuadro de di√°logo "Resultados de la operaci√≥n de carga", seleccione la entrada
"Arrancar m√≥dulo" de la columna "Acci√≥n".
2. Haga clic en el bot√≥n "Finalizar".
la CPU primaria pasa al estado operativo RUN.
3. Ponga la CPU de reserva al estado operativo RUN.
Nota
Cambio de rol al cargar
Vigile que no se produzca un cambio de rol entre la CPU primaria y la de reserva justo antes,
durante o despu√©s de la carga.
En la operaci√≥n de carga puede producirse un cambio de roles si durante la carga la CPU
primaria falla (corte de corriente o defecto de hardware) o est√° en el estado operativo STOP
y se da una de las siguientes condiciones:
‚óè En ese instante se pone la CPU de reserva al estado operativo RUN.
‚óè En ese instante la CPU de reserva pasa a POWER ON y el comportamiento de arranque
se ha parametrizado en STEP 7 de tal forma que la CPU pase autom√°ticamente al
estado operativo RUN tras POWER ON.
En caso de un cambio de rol, la nueva CPU primaria arranca con los datos de proyecto
antiguos. Los datos de proyecto nuevos de la CPU que ahora es de reserva se
sobrescribir√°n con los datos de proyecto antiguos cuando se produzca la sincronizaci√≥n de
las dos CPU para el funcionamiento redundante.

Resultado
Una vez finalizado correctamente el SYNCUP, el sistema S7-1500R/H cambia al
funcionamiento redundante.

Cargar datos de proyecto en la CPU de reserva
En el ajuste predeterminado, los datos de proyecto se cargan en la CPU primaria. Tambi√©n es
posible cargar los datos de proyecto en la CPU de reserva. Esto se hace cuando la CPU de
reserva debe pasar a ser la CPU primaria con sus datos de proyecto al realizar un rearranque
completo.
Durante la carga de los datos de proyecto la CPU primaria contin√∫a controlando el proceso.
Despu√©s de la carga hay que poner la CPU primaria al estado operativo STOP y la CPU de
reserva al estado operativo RUN. De ese modo la CPU que hasta entonces era la de reserva
se convierte en la nueva CPU primaria.
Nota
Cargar en la CPU de reserva
Si el proyecto utiliza datos remanentes, es posible que la CPU arranque con datos anticuados.

1162

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos
La CPU de reserva se encuentra en el estado operativo STOP.

Cargar datos de proyecto en la CPU de reserva
Para cargar datos de proyecto en la CPU de reserva, proceda del siguiente modo:
1. En el √°rbol del proyecto, seleccione el sistema S7-1500R/H con el bot√≥n derecho del rat√≥n.
2. En "Cargar en la CPU de reserva" elija el comando de men√∫ "Hardware y software (solo
cambios)".
Ahora, en el cuadro de di√°logo "Carga avanzada" est√° seleccionada la CPU de reserva en
lugar de la CPU primaria.
3. Seleccione la subred en la lista desplegable "Tipo de interfaz PG/PC".
4. Seleccione el adaptador en la lista desplegable "Interfaz PG/PC".
5. En la lista desplegable "Conexi√≥n con interfaz/subred", seleccione la interfaz con la que
existe una conexi√≥n desde la programadora/el PC.
6. Otra posibilidad consiste en seleccionar la entrada "Probar todas las interfaces".
7. Haga clic en el bot√≥n "Iniciar b√∫squeda".
La tabla "Seleccionar dispositivo de destino" muestra las CPU del sistema S7-1500R/H con
sus roles. La CPU de reserva est√° seleccionada por defecto.
8. Haga clic en el bot√≥n "Cargar".
El cuadro de di√°logo "Resultados de la operaci√≥n de carga" muestra los resultados de la
operaci√≥n de carga.

Cambiar entre la CPU primaria y la CPU de reserva
Despu√©s de cargar los datos de proyecto en la CPU de reserva, cambie las CPU de modo que
la CPU de reserva se convierta en la nueva CPU primaria. Para ello, proceda del siguiente
modo:
1. Ponga la CPU primaria en el estado operativo STOP.
2. Ponga la CPU de reserva al estado operativo RUN.
La CPU que hasta ahora era de reserva se convierte en la nueva CPU primaria y controla
ella sola el proceso en el estado del sistema RUN-Solo.

Resultado
Tras el SYNCUP el sistema S7-1500R/H regresa al estado del sistema RUN-Redundant con
el programa de usuario modificado.

Cargar el programa de usuario en la CPU primaria
El programa de usuario se puede cargar en una CPU en el estado operativo RUN. Durante la
carga la CPU primaria sigue manteniendo el control del proceso y la instalaci√≥n no se para.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1163

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos
La CPU primaria se encuentra en el estado operativo RUN.

Procedimiento
Para cargar un programa de usuario modificado en la CPU primaria, proceda del siguiente
modo:
1. Ponga la CPU de reserva al estado operativo STOP.
El sistema S7-1500R/H pasa del estado del sistema RUN-Redundant al estado del sistema
RUN-Solo.
2. Cargue el programa de usuario modificado en la CPU primaria con "Cargar en dispositivo
> Software (solo cambios)".
La CPU primaria sigue controlando el proceso.
3. Ponga la CPU de reserva al estado operativo RUN.

Resultado
La CPU primaria permanece en estado operativo RUN y sincroniza el programa de usuario
modificado en la CPU de reserva durante el SYNCUP.
El sistema S7-1500R/H regresa al estado del sistema RUN-Redundant con el programa de
usuario modificado.

Comunicaci√≥n con el sistema R/H
Direcciones IP de sistema
Encontrar√° informaci√≥n sobre las restricciones del sistema R/H en cuanto a las funciones de
comunicaci√≥n en Funcionamiento del sistema redundante S7-1500R/H (P√°gina 1137).
Las explicaciones siguientes describen las posibilidades de mantener la comunicaci√≥n con el
sistema R/H aunque falle la CPU que controla el proceso, por ejemplo.

Las direcciones IP de sistema del sistema redundante S7‚Äë1500R/H
Adem√°s de las direcciones IP "normales" de las interfaces PROFINET, el sistema redundante
S7‚Äë1500R/H tambi√©n soporta direcciones IP de sistema.
Las direcciones IP de sistema se utilizan para la comunicaci√≥n con otros dispositivos (p. ej.
dispositivos HMI, CPU, PG/PC). Estos dispositivos se comunican a trav√©s de la direcci√≥n IP de
sistema siempre con la CPU primaria del sistema redundante. De este modo se garantiza,
p. ej., que tras un fallo de la CPU primaria en funcionamiento redundante, el interlocutor pueda
comunicarse con la nueva CPU primaria (anteriormente la CPU de reserva) en el estado de
sistema RUN-Solo.
Para diferenciar entre direcci√≥n IP "normal" y "de sistema", la direcci√≥n IP normal se denomina
"direcci√≥n IP de dispositivo" (solo en el contexto de los sistemas R/H).

1164

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Existen las siguientes direcciones IP de sistema:
‚óè Direcci√≥n IP de sistema para las interfaces PROFINET X1 de ambas CPU (direcci√≥n IP de
sistema X1)
‚óè Direcci√≥n IP de sistema para las interfaces PROFINET X2 de ambas CPU (direcci√≥n IP de
sistema X2)
A cada direcci√≥n IP de sistema le corresponde una direcci√≥n MAC virtual.

Ventajas de las direcciones IP de sistema respecto a las direcciones IP de dispositivo
‚óè El interlocutor se comunica de forma selectiva con la CPU primaria.
‚óè La comunicaci√≥n del sistema redundante S7‚Äë1500R/H a trav√©s de una direcci√≥n IP de
sistema contin√∫a funcionando en caso de que falle la CPU primaria (conmutaci√≥n de
primaria a reserva).

Casos de aplicaci√≥n
Las direcciones IP de sistema se utilizan para las siguientes aplicaciones:
‚óè Comunicaci√≥n HMI con el sistema redundante S7-1500R/H: Con un HMI se controla y
observa el proceso ejecutado en el sistema redundante S7‚Äë1500R/H.
‚óè Open User Communication con el sistema redundante S7-1500R/H:
‚Äì Otra CPU o una aplicaci√≥n de un PC accede a datos del sistema redundante S7‚Äë1500R/
H.
‚Äì El sistema redundante S7‚Äë1500R/H accede a otro dispositivo.
Son posibles TCP, UDP y conexiones ISO‚Äëon‚ÄëTCP.

Requisitos
‚óè El interlocutor y las interfaces PROFINET de ambas CPU se encuentran en la misma
subred.
‚óè El interlocutor est√° conectado a ambas CPU a trav√©s de la misma interfaz en cada caso (p.
ej. X2).
‚óè La direcci√≥n IP de sistema est√° activada.

Comunicaci√≥n a trav√©s de la direcci√≥n IP de sistema X2
Si las CPU del sistema redundante S7‚Äë1500R/H tienen dos interfaces PROFINET, utilice
preferentemente la interfaz PROFINET X2 para la comunicaci√≥n con otros dispositivos.
La siguiente figura muestra una configuraci√≥n en la que los interlocutores est√°n conectados a
las CPU del sistema redundante S7‚Äë1500R/H a trav√©s de las interfaces PROFINET X2.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1165

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
&38

+0,

3&

,QGXVWULDO(WKHUQHW






'LUHFFL¬µQ,3GHVLVWHPD;
5&38
3ULPDU\

;

;

5&38
%DFNXS

;

,2'HYLFH

‚ë†
‚ë°
‚ë¢

1166

;
352),1(7,2

Open User Communication entre otra CPU y el sistema redundante S7-1500R/H
Comunicaci√≥n HMI con el sistema redundante S7-1500R/H
Open User Communication entre el sistema redundante S7-1500R/H y un PC

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comunicaci√≥n a trav√©s de la direcci√≥n IP de sistema X1
La siguiente figura muestra una configuraci√≥n en la que los interlocutores est√°n conectados al
anillo PROFINET del sistema redundante S7‚Äë1500R/H a trav√©s de un switch. El anillo
PROFINET conecta los interlocutores con cada una de las interfaces PROFINET X1 de ambas
CPU.
Dado que la CPU 1513R solo tiene una interfaz PROFINET, la conexi√≥n a trav√©s del anillo
PROFINET es la √∫nica posibilidad de comunicar a trav√©s de la direcci√≥n IP de sistema X1.
&38

+0,

3&

,QGXVWULDO(WKHUQHW






'LUHFFL¬µQ,3GHVLVWHPD;
5&38
3ULPDU\

5&38
%DFNXS

;

6ZLWFK

‚ë†
‚ë°
‚ë¢

;

,2'HYLFH

Open User Communication entre el sistema redundante S7-1500R/H y otra CPU
Comunicaci√≥n HMI con el sistema redundante S7-1500R/H
Open User Communication entre el sistema redundante S7-1500R/H y un PC

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1167

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comunicaci√≥n a trav√©s de las direcciones IP de sistema X1 y X2
Si las CPU del sistema redundante S7-1500R/H tienen dos interfaces PROFINET (X1 y X2),
podr√° utilizar las direcciones IP de sistema correspondientes para ambas interfaces
PROFINET. Los dispositivos PROFINET que est√°n conectados a las interfaces X1 de las CPU
se comunican a trav√©s de la direcci√≥n IP de sistema X1. Los dispositivos PROFINET que est√°n
conectados a las interfaces X2 de las CPU se comunican a trav√©s de la direcci√≥n IP de sistema
X2.
&38

+0,

3&

,QGXVWULDO(WKHUQHW






'LUHFFL¬µQ,3GHVLVWHPD;
5&38
3ULPDU\

;

5&38
%DFNXS

;

;

;

'LUHFFL¬µQ,3GHVLVWHPD;
352),1(7,2

+0,

,2'HYLFH

6ZLWFK

‚ë†
‚ë°
‚ë¢

Open User Communication entre el sistema redundante S7-1500R/H y otra CPU.
Comunicaci√≥n HMI con el sistema redundante S7-1500R/H
Open User Communication entre el sistema redundante S7-1500R/H y un PC

Activaci√≥n de direcciones IP de sistema
Si las CPU del sistema redundante S7‚Äë1500R/H tienen dos interfaces PROFINET (X1 y X2),
podr√° activar una direcci√≥n IP de sistema para ambas interfaces PROFINET. A continuaci√≥n
se describe c√≥mo activar la direcci√≥n IP de sistema para la interfaz X1.

1168

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para activar la direcci√≥n IP de sistema para el sistema redundante S7‚Äë1500R/H, proceda del
siguiente modo:
1. Seleccione la interfaz X1 de una de las CPU en la vista de redes de STEP 7.
2. En la ventana de inspecci√≥n, navegue hasta "Propiedades" > "General" > "Direcciones
Ethernet" al √°rea "Direcci√≥n IP del sistema para la comunicaci√≥n conmutada".
3. Active la casilla de verificaci√≥n "Active la direcci√≥n IP del sistema para la comunicaci√≥n
conmutada".
STEP 7 genera autom√°ticamente una direcci√≥n IP de sistema.
4. En caso necesario, modifique la direcci√≥n IP de sistema.
5. En caso necesario, modifique la direcci√≥n MAC virtual. Para ello, en "Direcci√≥n MAC virtual"
active un valor un√≠voco en toda la subred (dominio Ethernet Broadcast) para el √∫ltimo byte
(rango de valores 01H hasta FFH).
Nota
Univocidad de la direcci√≥n MAC virtual
Para la direcci√≥n IP de sistema y para la direcci√≥n MAC virtual correspondiente, el sistema
redundante S7‚Äë1500R/H utiliza el Virtual Router Redundancy Protocol VRRP.
Si utiliza otros dispositivos con VRRP, p. ej. switches, aseg√∫rese de que las direcciones
MAC son un√≠vocas dentro de un mismo dominio Ethernet‚ÄëBroadcast.

Consulte tambi√©n
Comportamiento de las conexiones en una transici√≥n de primaria a reserva (P√°gina 1175)

Configuraci√≥n de la conexi√≥n HMI a trav√©s de la direcci√≥n IP de sistema
Requisitos
‚óè El sistema redundante S7-1500R/H, p. ej. CPU 1513R‚Äë1PN est√° ubicado en la vista de
redes
‚óè La direcci√≥n IP de sistema est√° activada
‚óè El dispositivo HMI con interfaz PROFINET est√° ubicado en la vista de redes

Procedimiento
Para configurar una conexi√≥n HMI con un sistema redundante S7‚Äë1500R/H, proceda del
siguiente modo:
1. Seleccione una interfaz PROFINET del dispositivo HMI en la vista de redes de STEP 7.
2. Mediante la funci√≥n de arrastrar y colocar, trace una l√≠nea entre la interfaz PROFINET del
dispositivo HMI y una interfaz PROFINET del sistema redundante S7‚Äë1500R/H.
El dispositivo HMI y el sistema redundante S7‚Äë1500R/H est√°n conectados en red entre s√≠.
3. Haga clic en el s√≠mbolo "Conexiones" de la barra de herramientas. De esta forma se activa
el modo de conexi√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1169

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Mediante la funci√≥n de arrastrar y colocar, trace una l√≠nea entre el dispositivo HMI y una
CPU del sistema redundante S7‚Äë1500R/H.
Se abre la lista "Interlocutores".
5. Seleccione el sistema redundante S7‚Äë1500R/H en la lista "Interlocutores".
Resultado: Ha configurado una conexi√≥n HMI entre el dispositivo HMI y el sistema redundante
S7‚Äë1500R/H. La conexi√≥n HMI utiliza la direcci√≥n IP de sistema.

Cambio de la conexi√≥n HMI a la direcci√≥n IP de dispositivo
Para cambiar la conexi√≥n HMI de forma fija a la CPU seleccionada, desactive la casilla de
verificaci√≥n "Utilice la direcci√≥n IP del sistema para la comunicaci√≥n conmutada" en las
propiedades de la conexi√≥n HMI. La conexi√≥n HMI utiliza entonces la direcci√≥n IP de
dispositivo de la interfaz PROFINET. Si esa CPU falla, la conexi√≥n HMI con ella fallar√° de forma
constante.
Nota
Configuraci√≥n autom√°tica de una conexi√≥n HMI
Si arrastra una variable mediante la funci√≥n de arrastrar y colocar desde el sistema redundante
S7‚Äë1500R/H a una imagen HMI o a la tabla de variables HMI, STEP 7 configurar√°
autom√°ticamente una conexi√≥n HMI. Esta conexi√≥n HMI se establece de forma est√°ndar entre
la interfaz PROFINET del dispositivo HMI y la interfaz PROFINET X1 de la CPU con ID de
redundancia ID 1. La conexi√≥n utiliza la direcci√≥n IP de dispositivo de la interfaz PROFINET X1.
En las propiedades de la conexi√≥n HMI es posible cambiar la conexi√≥n HMI a una direcci√≥n IP
de sistema.

1170

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuraci√≥n de Open User Communication a trav√©s de la direcci√≥n IP de sistema
El sistema redundante S7‚Äë1500R/H puede comunicarse con otros dispositivos a trav√©s de
Open User Communication.
‚óè Las conexiones se configuran en el programa de usuario, p. ej. con la instrucci√≥n
"TSEND_C".
Nota
El sistema redundante S7‚Äë1500R/H no soporta las conexiones configuradas.
‚óè Las conexiones se pueden configurar a trav√©s de las direcciones IP de dispositivo o las
direcciones IP de sistema de las interfaces PROFINET.
‚Äì Si configura la conexi√≥n a trav√©s de una direcci√≥n IP de sistema, la comunicaci√≥n
siempre se desarrollar√° a trav√©s de la CPU primaria.
Recomendaci√≥n: Para la Open User Communication utilice siempre una direcci√≥n IP de
sistema.
‚Äì En el modo redundante, el sistema redundante puede establecer y deshacer
conexiones y transmitir y recibir datos a trav√©s de cada una de las direcciones IP de
dispositivo.
Si configura la conexi√≥n a trav√©s de una direcci√≥n IP de dispositivo, la comunicaci√≥n se
desarrollar√° a trav√©s de la CPU correspondiente. Si la CPU falla, fallar√° toda la
comunicaci√≥n a trav√©s de las direcciones IP de dispositivo de esa CPU.

Protocolos /tipos de conexi√≥n compatibles
Adem√°s del protocolo TCP explicado abajo a modo de ejemplo (configurado para las
instrucciones TSEND_C y TRCV_C en la parametrizaci√≥n de conexiones), tambi√©n es posible
utilizar los protocolos ISO-on-TCP, UDP y Modbus TCP con los correspondientes tipos de
datos de sistema e instrucciones; consulte la tabla.
El tipo de datos del sistema TCON_Param no se soporta.
Protocolo

Tipo de datos de sistema

Instrucciones

TCP

‚óè TCON_IP_v4

Establecer la conexi√≥n y transmitir/recibir da‚Äê
tos mediante:

‚óè TCON_QDN
‚óè TCON_IP_v4_SEC*
‚óè TCON_QDN_SEC*
ISO-on-TCP

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

‚óè TCON_IP_RFC

‚óè TSEND_C/TRCV_C o
‚óè TCON, TSEND/TRCV o
‚óè TCON, TUSEND/TURCV
(posibilidad de deshacer la conexi√≥n
mediante TDISCON)

1171

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Protocolo

Tipo de datos de sistema

Instrucciones

UDP

‚óè TCON_IP_v4

Establecer la conexi√≥n y transmitir/recibir da‚Äê
tos mediante:

‚óè TCON_IP_QDN
‚óè TADDR_Param
‚óè TADDR_SEND_QDN
‚óè TADDR_RCV_IP
‚óè TCON_QDN_SEC*

‚óè TSEND_C/TRCV_C
‚óè TUSEND/TURCV/TRCV
(posibilidad de deshacer la conexi√≥n
mediante TDISCON)

‚óè TCON_IP_v4_SEC*
Modbus TCP

‚óè TCON_IP_v4

‚óè MB_CLIENT

‚óè TCON_QDN

‚óè MB_SERVER

‚óè TCON_IP_v4_SEC*
‚óè TCON_QDN_SEC*

* El sistema redundante S7‚Äë1500R/H a√∫n no soporta la Secure Open User Communication. Si
utiliza los tipos de datos del sistema TCON_IP_v4_SEC o TCON_QDN_SEC en el sistema
redundante S7‚Äë1500R/H, el par√°metro ActivateSecureConn deber√° tener el valor FALSE. Con
ello los par√°metros de seguridad siguientes pasan a ser irrelevantes. En tal caso es posible
crear una conexi√≥n TCP o UDP no segura.

Ejemplo: Configuraci√≥n de la conexi√≥n a trav√©s de la direcci√≥n IP de sistema
A continuaci√≥n se describe c√≥mo configurar una conexi√≥n del sistema redundante S7‚Äë1500R/
H con otra CPU a trav√©s de la direcci√≥n IP de sistema.
‚óè En el programa de usuario del sistema redundante S7‚Äë1500R/H la conexi√≥n se configura
con la instrucci√≥n TSEND_C.
‚óè En el programa de usuario de la CPU interlocutora se crea la instrucci√≥n TRCV_C
correspondiente.
El procedimiento se describe a partir del ejemplo de una conexi√≥n TCP entre el sistema
redundante S7‚Äë1500R/H y una CPU 1516‚Äë3 PN/DP.

Requisitos
‚óè Interlocutor local: Sistema redundante S7‚Äë1500R con dos CPU 1513‚Äë1 PN
La direcci√≥n IP de sistema de la interfaz PROFINET X1 est√° activada.
‚óè Interlocutor remoto: CPU 1516‚Äë3 PN/DP
‚óè Las interfaces PROFINET X1 de las CPU 1513R y la interfaz PROFINET X2 de la CPU
1516‚Äë3 PN/DP se encuentran en la misma subred.

Configuraci√≥n de una conexi√≥n TCP en el sistema redundante S7‚Äë1500R/H (transmisi√≥n)
Para configurar una conexi√≥n TCP con otra CPU, proceda del siguiente modo:
1. Cree una instrucci√≥n "TSEND_C" en el programa de usuario.
2. Seleccione la instrucci√≥n "TSEND_C".

1172

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Vaya a la ventana de inspecci√≥n y navegue a "Propiedades" > "Configuraci√≥n" >
"Par√°metros de la conexi√≥n".
En el lado izquierdo ver√° el sistema redundante S7‚Äë1500R/H como punto final local de la
conexi√≥n:
‚Äì "Interfaz:": la interfaz X1 est√° ajustada por defecto.
‚Äì "Subred:": si la interfaz X1 est√° asignada a una subred S7, STEP 7 mostrar√° el nombre
de la subred S7.
‚Äì La opci√≥n "Utilizar direcci√≥n IP del sistema" est√° activada.
4. En "Interlocutor", en "Punto final:", seleccione la CPU 1516‚Äë3 PN/DP como interlocutor.
5. En "Interlocutor", en "Interfaz:", seleccione la interfaz PROFINET X2 de la CPU 1516‚Äë3 PN/
DP.
6. En "Local", en "Datos de conexi√≥n", seleccione el ajuste "<Nuevo>".
STEP 7 crea un bloque de datos para los datos de la conexi√≥n en el programa de usuario
del sistema redundante S7‚Äë1500R/H.
7. En "Interlocutor", en "Tipo de conexi√≥n:" seleccione el ajuste "TCP".
STEP 7 crea un bloque de datos para los datos de la conexi√≥n en el programa de usuario
de la otra CPU.

Configuraci√≥n de una conexi√≥n TCP en el interlocutor CPU 1516 (recepci√≥n)
En el programa de usuario de la CPU 1516‚Äë3PN/DP, cree una instrucci√≥n TRCV_C y
parametr√≠cela en concordancia con el interlocutor.

Configuraci√≥n de la conexi√≥n a trav√©s de la direcci√≥n IP de dispositivo
Para configurar una conexi√≥n OUC a trav√©s de una direcci√≥n IP de dispositivo de una de las
dos CPU:
1. Seleccione una interfaz PROFINET adecuada del sistema redundante S7‚Äë1500R/H.
2. Desactive la opci√≥n "Utilizar direcci√≥n del sistema H".

Recursos de conexi√≥n del sistema redundante S7-1500R/H
N√∫mero m√°ximo de recursos de conexi√≥n del sistema redundante S7-1500R/H
El sistema redundante S7-1500R/H soporta un n√∫mero m√°ximo de recursos de conexi√≥n.
La CPU utilizada determina el n√∫mero m√°ximo de recursos para una estaci√≥n S7‚Äë1500R/H:
‚óè CPU 1513R: m√°x. 88 recursos de conexi√≥n
‚óè CPU 1515R: m√°x. 108 recursos de conexi√≥n
‚óè CPU 1517H: m√°x. 160 recursos de conexi√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1173

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Asignaci√≥n de los recursos de conexi√≥n
Las conexiones de comunicaci√≥n ocupan recursos de conexi√≥n en el sistema redundante
S7‚Äë1500R/H.
Cada una de las conexiones de comunicaci√≥n con el sistema redundante S7‚Äë1500R/H ocupa
recursos de conexi√≥n en la estaci√≥n S7‚Äë1500R/H.
Dependiendo de la direcci√≥n IP utilizada, la conexi√≥n de comunicaci√≥n tambi√©n ocupa
recursos en una o ambas CPU del sistema redundante S7‚Äë1500R/H.
La tabla siguiente indica en qu√© CPU ocupa recursos una conexi√≥n de comunicaci√≥n en
funci√≥n de la direcci√≥n IP utilizada.
Conexiones a trav√©s de...

Recursos de conexi√≥n de la
estaci√≥n

Recursos de conexi√≥n CPU
con ID de redundancia ID 1

Recursos de conexi√≥n CPU
con ID de redundancia ID 2

una direcci√≥n IP de sistema

X

X

X

una direcci√≥n IP de dispositi‚Äê
vo de la CPU con ID de re‚Äê
dundancia ID 1

X

X

-

una direcci√≥n IP de dispositi‚Äê
vo de la CPU con ID de re‚Äê
dundancia ID 2

X

-

X

Visualizaci√≥n de los recursos de conexi√≥n ocupados en STEP 7
Requisitos: Conexi√≥n online con el sistema redundante S7-1500R/H
Los recursos de conexi√≥n figuran en la ventana de inspecci√≥n, en las propiedades de las CPU.
STEP 7 siempre muestra los recursos de conexi√≥n de la CPU seleccionada y de la estaci√≥n
S7‚Äë1500R/H.

1174

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comportamiento de las conexiones con Syncup
Comportamiento de las conexiones de comunicaci√≥n a trav√©s de la direcci√≥n IP de sistema en el estado
del sistema SYNCUP
‚óè Las conexiones HMI, PG, y S7 se cierran temporalmente. Durante un breve intervalo
durante el SYNCUP no es posible establecer conexiones con el sistema redundante
S7‚Äë1500R/H.
‚óè Todas las conexiones de Open User Communication se interrumpen:
‚Äì Las conexiones que las CPU del sistema redundante han establecido como activas, se
vuelven a establecer despu√©s de SYNCUP.
‚Äì Despu√©s de SYNCUP el sistema redundante S7‚Äë1500R/H vuelve a establecer puntos
finales para el establecimiento pasivo de conexiones.
‚óè La ejecuci√≥n en curso de instancias de las instrucciones TSEND y TRCV se detiene. El
par√°metro de bloque STATUS devuelve 80C4H (error temporal de comunicaci√≥n).

Comportamiento de las conexiones en una transici√≥n de primaria a reserva
Comportamiento de las conexiones de comunicaci√≥n a trav√©s de la direcci√≥n IP de sistema durante una
transici√≥n de primaria a reserva
‚óè Las instancias en ejecuci√≥n de las instrucciones TSEND y TRCV se detienen y devuelven
el estado 80C4H (error temporal de comunicaci√≥n).
‚óè La CPU primaria vuelve a establecer las conexiones que el sistema redundante S7‚Äë1500R/
H hab√≠a establecido correctamente de forma activa.
‚óè La nueva CPU primaria vuelve a establecer puntos finales para el establecimiento de
conexiones pasivo.

Consulte tambi√©n
Direcciones IP de sistema (P√°gina 1164)

Diagn√≥stico del sistema redundante S7-1500R/H
Obtener visi√≥n general del estado actual del sistema R/H
Introducci√≥n
El √°rbol del proyecto le proporciona una visi√≥n general del estado actual del sistema R/H.
En los apartados siguientes se explica c√≥mo obtener la informaci√≥n siguiente a partir de los
iconos mostrados:
‚óè el estado actual del sistema R/H
‚óè los estados operativos actuales de las CPU del sistema R/H

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1175

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè las funciones actuales de las CPU del sistema R/H
‚óè con cu√°l de las dos CPU existe actualmente una conexi√≥n online.
Encontrar√° informaci√≥n sobre los estados del sistema R/H y sobre los estados operativos y las
funciones de las CPU de un sistema R/H en el manual de sistema "Sistema redundante
S7-1500R/H".

Determinar el estado actual del sistema R/H
El estado actual del sistema en el que se encuentra el sistema R/H puede leerse en los dos
iconos cuadrados superpuestos que se encuentran en la parte derecha del icono de la carpeta
del sistema R/H
La tabla siguiente contiene los posibles iconos de carpeta y su significado.

Icono de carpeta del sistema R/H

Estado del sistema R/H
STOP
RUN-Solo
RUN-Redundant

Nota
Icono de carpeta y funciones de la CPU
De los iconos de carpeta correspondientes a los estados del sistema RUN-Solo y RUNRedundant no es posible determinar las funciones de cada una de las CPU.

Determinar los estados operativos actuales de las CPU del sistema R/H
El estado operativo actual que tiene una CPU del sistema R/H puede verse en el icono
superpuesto que se encuentra en la parte superior derecha del icono de la carpeta de dicha
CPU.
La tabla siguiente contiene a t√≠tulo de ejemplo para la CPU primaria los iconos de carpeta que
son posibles y su significado.
Icono de carpeta de la CPU primaria

Estado operativo de la CPU primaria
ARRANQUE
STOP
RUN

1176

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Interdependencia entre la indicaci√≥n de estado operativo de una CPU y la conexi√≥n online
existente
En los estados del sistema STOP y RUN-Solo √∫nicamente es posible determinar el estado
operativo actual de la CPU con la que existe una conexi√≥n online actual.
La CPU con la que no existe una conexi√≥n online actual no tiene ning√∫n icono superpuesto a
la derecha de su icono de carpeta.
Si una CPU no tiene ninguna conexi√≥n online actual con la PG o el PC, se representa en la
pen√∫ltima columna de la fila de la CPU con el icono siguiente:

"Online mediante interlocutor": la otra CPU del sistema R/H est√° conectada online con la PG/
el PC.

Determinar las funciones actuales de las CPU del sistema R/H
La funci√≥n actual que tiene una CPU en el sistema R/H puede verse en el icono superpuesto
que se encuentra en la parte inferior derecha del icono de carpeta de dicha CPU. Consta de las
letras "P" o "B":
‚óè "P" significa que en el sistema R/H la CPU es la CPU primaria.
‚óè "B" significa que en el sistema R/H la CPU es la CPU de reserva.

Determinar con cu√°l de las dos CPU existe actualmente una conexi√≥n online
‚óè En los estados del sistema STOP y RUN-Solo, para la CPU con la que no existe una
conexi√≥n online actual, en la pen√∫ltima columna de la fila de la CPU se representa el icono
siguiente:
"Online mediante interlocutor": la otra CPU del sistema R/H est√° conectada online con la
PG/el PC.

Esto permite saber que existe una conexi√≥n online con la otra CPU.

‚óè En el estado del sistema RUN-Redundant no se muestra el icono "Online mediante
interlocutor". Es innecesario, porque en el estado RUN-Redundant cada una de las CPU
conoce toda la informaci√≥n de estado de la otra CPU.

Ampliaciones de la vista Online y diagn√≥stico para el sistema R/H
Sinopsis
Hay tres vistas Online y diagn√≥stico:
‚óè una para el sistema S7-1500R/H
‚óè una para cada una de las dos CPU del sistema S7-1500R/H

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1177

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Vista Online y diagn√≥stico del sistema S7-1500R/H
Esta vista Online y diagn√≥stico se ha introducido como novedad para el sistema R/H.
Consta de los elementos siguientes:
‚óè Grupo "Accesos online" con el √°rea "Accesos online"
‚óè Grupo "Diagn√≥stico" con el √°rea "Diagn√≥stico"
En "Accesos online" hay las siguientes ampliaciones con respecto a la vista Online y
diagn√≥stico de una CPU est√°ndar:
‚óè En caso de que exista una conexi√≥n online entre la PG/el PC y una de las dos CPU, en
"Estado" se indica adem√°s cu√°l es la funci√≥n que la CPU conectada online tiene en el
sistema R/H:
‚Äì indicaci√≥n "Online (v√≠a CPU primaria)", en caso de que la CPU conectada online sea la
CPU primaria
‚Äì Indicaci√≥n "Online (v√≠a CPU de reserva)", en caso de que la CPU conectada online sea
la CPU de reserva
‚óè "Informaci√≥n" proporciona informaci√≥n general sobre el sistema R/H e informaci√≥n sobre
con cu√°l de las CPU se establece una conexi√≥n online en funcionamiento online.
"Diagn√≥stico" proporciona una visi√≥n general del estado actual del sistema R/H. Se visualizan:
‚óè el estado del sistema R/H
‚óè el estado de emparejamiento de ambas CPU
‚óè los estados operativos de la CPU primaria y la CPU de reserva
‚óè los nombres de la CPU primaria y la CPU de reserva (predeterminados o asignados por el
usuario). Esto permite conocer cu√°l es la CPU primaria y cu√°l la CPU secundaria.

Vistas Online y diagn√≥stico de las dos CPU del sistema S7-1500R/H
Primero va a tratarse la interdependencia entre la visualizaci√≥n y el estado del sistema:
‚óè En el estado del sistema RUN-Redundant se muestran datos de diagn√≥stico tanto en la
vista Online y diagn√≥stico de la CPU primaria como en la vista Online y diagn√≥stico de la
CPU de reserva, con independencia de cu√°l sea la CPU con la que existe la conexi√≥n online.
‚óè En todos los dem√°s estados del sistema solo se muestran datos de diagn√≥stico en la vista
Online y diagn√≥stico de la CPU conectada online.
La vista Online y diagn√≥stico de una CPU del sistema R/H es casi id√©ntica a la representaci√≥n
de las CPU est√°ndar. La √∫nica diferencia se encuentra en el grupo "Accesos online": Ah√≠, en
caso de que exista una conexi√≥n online, en "Estado" se indica adem√°s cu√°l es la funci√≥n que
la CPU tiene en el sistema R/H: CPU primaria o CPU de reserva.

1178

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Interdependencia entre las indicaciones de diagn√≥stico en el √°rbol del proyecto y en la vista Online y
diagn√≥stico
Introducci√≥n
Los diagn√≥sticos que se muestran en el √°rbol del proyecto y en la vista Online y diagn√≥stico
dependen de los factores siguientes:
‚óè La funci√≥n que tenga la CPU que est√° conectada online con la PG/PC: CPU primaria (en la
tabla siguiente abreviada con "P") o CPU de reserva (en la tabla siguiente abreviada con
"B").
‚óè El estado del sistema que tenga el sistema R/H.

Descripci√≥n detallada de las interdependencias
Si existe una conexi√≥n online de la PG/el PC con la CPU primaria, se aplica lo siguiente:

Estado del sistema R/H (y estados operativos de las CPU)

Posibles diagn√≥sticos / indicaciones de diagn√≥stico

STOP (P=STOP, B=STOP)

‚óè El diagn√≥stico de la CPU primaria es posible.
‚óè El diagn√≥stico de la CPU de reserva no es posible.
‚óè El diagn√≥stico de la periferia descentralizada no es
posible.

RUN-Solo (P=RUN, B=STOP)

‚óè El diagn√≥stico de la CPU primaria es posible.
‚óè El diagn√≥stico de la CPU de reserva no es posible.
‚óè El diagn√≥stico de la periferia descentralizada es posible.

RUN-Redundant (P=RUN-Redundant, B=RUN-Redundant)

‚óè El diagn√≥stico de la CPU primaria es posible.
‚óè El diagn√≥stico de la CPU de reserva es posible.
‚óè El diagn√≥stico de la periferia descentralizada es posible.

Si existe una conexi√≥n online de la PG/el PC con la CPU de reserva, se aplica lo siguiente:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1179

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estado del sistema R/H (y estados operativos de las CPU)

Posibles diagn√≥sticos / indicaciones de diagn√≥stico

STOP (P=STOP, B=STOP)

‚óè El diagn√≥stico de la CPU primaria no es posible.
‚óè El diagn√≥stico de la CPU de reserva es posible.
‚óè El diagn√≥stico de la periferia descentralizada no es
posible.

RUN-Solo (P=RUN, B=STOP)

‚óè El diagn√≥stico de la CPU primaria no es posible.
‚óè El diagn√≥stico de la CPU de reserva es posible.
‚óè El diagn√≥stico de la periferia descentralizada no es
posible.

RUN-Redundant (P=RUN-Redundant, B=RUN-Redundant)

‚óè El diagn√≥stico de la CPU primaria es posible.
‚óè El diagn√≥stico de la CPU de reserva es posible.
‚óè El diagn√≥stico de la periferia descentralizada es posible.

Resumen
Las interdependencias descritas en detalle pueden resumirse en las reglas siguientes:
‚óè En los estados del sistema STOP y RUN-Solo √∫nicamente es posible diagnosticar la CPU
con la que existe una conexi√≥n online.
‚óè En el estado del sistema RUN-Redundant pueden diagnosticarse las dos CPU,
independientemente de con cu√°l de las CPU exista una conexi√≥n online.
‚óè En el estado del sistema STOP no puede diagnosticarse la periferia descentralizada.
‚óè En el estado del sistema RUN-Solo, la periferia descentralizada solo puede diagnosticarse
si existe una conexi√≥n online con la CPU primaria.
‚óè En el estado del sistema RUN-Redundant, la periferia descentralizada puede
diagnosticarse siempre, independientemente de con cu√°l de las CPU exista una conexi√≥n
online.

Ampliaciones de la Task Card "Herramientas online" para el sistema R/H
Sinopsis
La Task Card "Herramientas online" muestra informaci√≥n del sistema S7-1500R/H si existe
conexi√≥n online con una de las dos CPU.
Consta de las paletas siguientes:
‚óè Panel de mando del sistema R/H
‚óè Un panel de mando de CPU para ambas CPU
‚óè Tiempo de ciclo
‚óè Memoria

1180

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Panel de mando del sistema R/H
La paleta "Panel de mando del sistema R/H" proporciona una visi√≥n general del estado actual
del sistema R/H. Se muestra la siguiente informaci√≥n:
‚óè el nombre del sistema R/H
‚óè los estados actuales de los LED de la CPU primaria
‚óè el estado del sistema R/H
‚óè los nombres y los estados operativos de la CPU primaria y la CPU de reserva
Al hacer clic en el bot√≥n "STOP Sistema R/H", el efecto depende del estado actual del sistema:
‚óè En los estados del sistema RUN-Redundant y RUN-Solo, al hacer clic se aplica el estado
del sistema STOP.
‚óè En los dem√°s estados del sistema este bot√≥n aparece con fondo gris.
El bot√≥n "RUN Sistema R/H" est√° actualmente con fondo gris, y por tanto no funciona.

Panel de mando de CPU para las dos CPU
Cada una de las dos CPU del sistema R/H tiene su propio panel de mando de CPU.
Primero se muestra el panel de mando de la CPU que tiene la ID de redundancia 1
(corresponde a la CPU superior del √°rbol del proyecto), y despu√©s la CPU que tiene la ID de
redundancia 2 (corresponde a la CPU inferior del √°rbol del proyecto).
En el panel de mando de cada una de las CPU se muestra lo siguiente:
‚óè el nombre de la CPU y su funci√≥n en el sistema R/H (CPU primaria o CPU de reserva)
‚óè los estados actuales de los LED de la CPU
‚óè la posici√≥n del selector de modo de la CPU
Los botones "RUN" y "STOP" permiten cambiar el estado operativo de la CPU.
Nota
Conmutaci√≥n del estado operativo
Una conmutaci√≥n del estado operativo de la CPU mediante los botones "RUN" y "STOP"
conlleva un cambio en el estado del sistema.
Con el bot√≥n "MRES" se ejecuta el borrado total de la CPU.
Con respecto al panel de mando de una CPU est√°ndar hay la siguiente ampliaci√≥n: Detr√°s del
nombre de la CPU se indica adicionalmente la funci√≥n de la CPU en el sistema R/H (CPU
primaria o de reserva).

Tiempo de ciclo
La paleta "Tiempo de ciclo" corresponde a la paleta hom√≥nima en las CPU est√°ndar. Muestra
los valores de la CPU con la que existe una conexi√≥n online actual.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1181

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La ampliaci√≥n respecto a una CPU est√°ndar consiste √∫nicamente en que en la parte superior
de la paleta, detr√°s de "Tiempo de ciclo", se indica entre corchetes la funci√≥n de la CPU que
est√° conectada online: "primaria" o "de reserva".

Memoria
La paleta "Memoria" corresponde a la paleta hom√≥nima de las CPU est√°ndar. Muestra los
valores de la CPU con la que existe una conexi√≥n online actual.
La ampliaci√≥n respecto a una CPU est√°ndar consiste √∫nicamente en que en la parte superior
de la paleta, detr√°s de "Memoria", se indica entre corchetes la funci√≥n de la CPU que est√°
conectada online: "primaria" o "de reserva".

Diagn√≥stico de conexiones en el sistema R/H
Visualizaci√≥n de los recursos de conexi√≥n de una conexi√≥n que utiliza la direcci√≥n IP del sistema R/H
Las conexiones con un sistema R/H que usan su direcci√≥n IP del sistema se comportan
respecto a los recursos de conexi√≥n ocupados de manera distinta a las conexiones est√°ndar
con exactamente una CPU del sistema R/H: las conexiones a trav√©s de la direcci√≥n IP del
sistema ocupan recursos en cada una de las dos CPU y en la estaci√≥n R/H.
De manera similar se comporta la visualizaci√≥n de los recursos de conexi√≥n ("Diagn√≥stico" >
"Informaci√≥n de la conexi√≥n" de la ventana de inspecci√≥n, grupo "Recursos de conexi√≥n").
Encontrar√° m√°s informaci√≥n en el manual de funciones "Comunicaci√≥n".

Funciones de comparaci√≥n de un sistema R/H
Con un sistema R/H puede realizarse una comparaci√≥n offline/offline y una comparaci√≥n
offline/online.
A continuaci√≥n se describen las particularidades de la comparaci√≥n en relaci√≥n con los
sistemas R/H.

Comparaci√≥n offline/offline (software)
En un sistema R/H solo es posible utilizar una CPU R/H para la comparaci√≥n (software) con
otra CPU.
La comparaci√≥n offline/offline se realiza b√°sicamente igual que la comparaci√≥n offline/offline
con CPU est√°ndar.
Puesto que solo se muestran los objetos software de la CPU R/H con ID de redundancia "1"
(CPU superior en el √°rbol del proyecto), solo es posible emplear esta CPU para una
comparaci√≥n.
Si se arrastra el s√≠mbolo del sistema R/H (ambas CPU) desde el √°rbol del proyecto hasta el
editor de comparaci√≥n para comparar el software, STEP 7 elegir√° autom√°ticamente la CPU
con ID de redundancia "1".
Una comparaci√≥n offline/offline (software) de las dos CPU R/H (comparaci√≥n de la CPU
primaria con la CPU de reserva) no es posible.

1182

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comparaci√≥n offline/offline (hardware)
Existe la posibilidad de comparar el hardware de dos CPU S7.
Ejemplos:
‚óè Comparaci√≥n de dos sistemas R/H completos:
Coloque las estaciones R/H correspondientes en el editor de comparaci√≥n con la funci√≥n de
arrastrar y colocar. Se compara la estructura hardware de las dos estaciones, incluidos los
m√≥dulos locales y la periferia descentralizada.
‚óè Comparaci√≥n de las dos CPU del mismo sistema R/H
‚óè Comparaci√≥n de la primera o segunda CPU de dos sistemas R/H
‚óè Una CPU cualquiera de un sistema R/H con otra CPU S7-1500 cualquiera
No es posible comparar una CPU R/H con sistemas de PC, por ejemplo (distinto montaje).

Comparaci√≥n offline/online
La comparaci√≥n offline/online se realiza b√°sicamente igual que la comparaci√≥n offline/online
con CPU est√°ndar:
Como punto de partida para esta comparaci√≥n existe la posibilidad de marcar la estaci√≥n R/H
o una o ambas CPU de la estaci√≥n R/H en el √°rbol del proyecto y seleccionar a continuaci√≥n
el comando "Comparar > Offline/online" del men√∫ contextual. STEP 7 compara con la CPU
online que tiene la funci√≥n "Primaria".
Para la comparaci√≥n offline/online con la CPU de reserva no existe un comando de men√∫
propio. Si desea comparar una CPU offline/el sistema R/H con la CPU de reserva como
dispositivo de destino, primero deber√° establecer una conexi√≥n online con la CPU de reserva
con el comando "Conexi√≥n online con la CPU de reserva" del men√∫ contextual y seguidamente
iniciar la comparaci√≥n offline/online.
El sistema R/H est√° offline
Si las dos CPU R/H del sistema est√°n offline, la comparaci√≥n del sistema R/H se inicia con la
CPU primaria.
Por consiguiente, STEP 7 establece una conexi√≥n con la CPU primaria. Si todav√≠a no se ha
ajustado ninguna ruta online, se abre el cuadro de di√°logo para establecer la conexi√≥n online
y se propone como dispositivo de destino la CPU primaria. Despu√©s de confirmar el cuadro de
di√°logo (bot√≥n "Conectar") se abre el editor de comparaci√≥n y muestra las diferencias entre los
bloques offline y online de la CPU primaria.
El sistema R/H est√° online
Si una de las dos CPU R/H est√° online, STEP 7 emplea para la comparaci√≥n offline/online el
dispositivo de destino con el que se ha establecido la conexi√≥n online.

¬øD√≥nde puede encontrarse m√°s informaci√≥n?
Encontrar√° m√°s informaci√≥n sobre el diagn√≥stico del sistema redundante S7-1500R/H en el
manual de funciones "Diagn√≥stico".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1183

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.4

Principle of operation of SIMATIC Drive Controllers

Functionality of the SIMATIC Drive Controller
SIMATIC Drive Controller
The SIMATIC Drive Controller is a drive-based controller in the SIMATIC S7-1500 range.
A SIMATIC Drive Controller combines the following functionalities in a SINAMICS S120
Booksize Compact housing:
‚óè Fail-safe SIMATIC S7-1500 technology CPU with integrated technology I/Os
‚óè SINAMICS S120 drive control
The two components are referred to as "CPU" and "SINAMICS Integrated" in this
documentation.
The integrated SINAMICS S120 drive control is based on a CU320-2 Control Unit. It can control
‚óè a maximum of 6 servo drives,
‚óè a maximum of 6 drives with vector control, or
‚óè a maximum of 12 drives with U/f control
Fail-safe technology CPUs are available in two performance classes. Safety Integrated on the
CPU side and drive side allows use in fail-safe applications.
The SIMATIC Drive Controller supports PROFINET and PROFIBUS DP communication.

Drive Controller-specific hardware properties
As a component of the SINAMICS S120 drive system, the configuration conditions and rules of
SINAMICS S120 apply to the SIMATIC Drive Controller.

Drive Controller-specific properties of the CPU
The SIMATIC Drive Controller is optimized for automation solutions with motion control in
which SINAMICS S120 high-performance converters are used.
With its extensive field bus interfaces, the SIMATIC Drive Controller is ideal for modular
machine concepts.
Service functions
The SIMATIC Drive Controller does not have an integrated display. You can alternatively run
service functions over the integrated Web server, for example. You can save the service data
to the SIMATIC memory card using the FUNCT button.
S7-1500 I/O
The SIMATIC Drive Controller has no S7-1500 backplane bus. You can connect S7-1500 I/O
modules using the ET 200MP distributed I/O system. Note that CM/CP communication
modules for PROFINET/PROFIBUS in particular cannot be used in the ET 200MP distributed
I/O system. Only communication modules for point-to-point connection (CM PtP) can be used.

1184

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Alternatively, other I/O systems are available for installation in the control cabinet (e.g. ET
200SP) or for cabinet-free installation (e.g. ET 200pro, ET 200AL and ET 200eco PN).
Time-based IO
The function blocks for the use of time-based IO (TIO instructions) are not supported by the
digital inputs/outputs of the X142 interface. Recommendation: Use the measuring input, output
cam or cam track technology objects for the timer DI/DQ.
Device replacement
The SIMATIC Drive Controller supports replacement of the SIMATIC Drive Controller CPU with
the modular SIMATIC S7-1500 CPUs. Replacement with controllers of other designs (e.g. ET
200SP, ET 200pro) is not possible.

Drive Controller-specific properties of SINAMICS Integrated
The drive control integrated in the SIMATIC Drive Controller supports only functions that are
relevant in the control context (i.e. functional subset of SINAMICS S120 CU320-2 functions).
For example, the Drive Control Chart (DCC) and basic positioner (EPOS) functions are not
supported by SINAMICS Integrated.
A complete overview of the functional subset compared with the S7-1500 automation system
can be found in the S7-1500 Drive Controller system manual.
Device replacement
An exchange of devices between SINAMICS Integrated and SINAMICS S120 CU320-2 is not
possible.
Copying and pasting of individual drive objects from SINAMICS Integrated to SINAMICS S120
CU320-2 (and vice versa) is not possible with V16.

PROFINET, PROFIBUS, PROFIdrive Integrated
Interfaces for PROFINET and PROFIBUS DP communication are integrated in the SIMATIC
Drive Controller. The following communication options are available for your automation task:
Tabla 1-87

SIMATIC Drive Controller communication options

Communication option

PN

DP

PG communication for commissioning, testing and diagnostics

X

X

HMI communication for operator control and monitoring

X

X

Data exchange with TCP/IP, UDP, ISO-on-TCP, ISO protocol

X

-

Data exchange via OPC UA as server

X

-

Data exchange via OPC UA as client

X

-

Direct data exchange between IO controllers

X

-

Communication via Modbus TCP

X

-

Communication via UDP Multicast

X

-

Sending process messages via e-mail

X

-

S7 communication

X

X

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1185

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
PN

DP

S7 routing

Communication option

X

X

Web server of the CPU

X

-

SNMP (Simple Network Management Protocol)

X

-

Time-of-day synchronization

X

X

Coupling with the clock pulse system of the technology I/Os X142 and with
SINAMICS Integrated

X

-

Data exchange via HTTP(S), for example for diagnostics

The SIMATIC Drive Controller also has two USB interfaces 3.0. These do not currently have an
assigned function.

PROFIdrive Integrated
Communication between CPU and SINAMICS Integrated is based on PROFIdrive
mechanisms. The communication services used for this are based on PROFIBUS DP and are
processed over an internal, high-performance interface that allows cycle times as low as
250 Œºs.

Configuring
Configuration of the SIMATIC Drive Controller
By configuring, parameterizing and connecting the individual hardware components, you
communicate the preset configuration and the functionality of the CPU and the integrated
SINAMICS Integrated drive unit to the SIMATIC Drive Controller. You perform the steps
needed for this in the device and network views in the TIA Portal and in SINAMICS Startdrive
(SINAMICS Integrated).
The complete configuration of the SIMATIC Drive Controller is described in the SIMATIC Drive
Controller system manual. The following sections focus on the most important steps and the
specifics of configuring in the TIA Portal:
Configuration procedure (P√°gina 1186)
Configuration of digital inputs/outputs (X142) (P√°gina 1192)
Configuring the digital inputs and digital inputs/outputs (X122/X132) (P√°gina 1218)
Configuring the clock system (P√°gina 1220)

Configuration procedure
Proceed as follows to create a new project in the TIA Portal and add a SIMATIC Drive Controller:

Creating a project
1. Start TIA Portal.
2. Select the action "Start" > "Create new project" in the portal view.
3. Assign a name for the new project under "Project name".

1186

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Set the storage location with the "..." button.
5. If required, enter comments in the Comment field.
6. Click the "Create" button to create the project.
You have created the project and are currently in the portal view. To continue with the
configuration, switch to the project view.

Adding a SIMATIC Drive Controller to the project
1. Select "Add new device" in the project tree.
2. In the "Add new device" dialog, select the device version you are using under "Controller"
> "SIMATIC Drive Controller" and the firmware version of the device under "Version".
3. You use the "Open device view" checkbox to specify whether the hardware configuration
view is to be opened once the device has been created. Keep the checkbox selected if you
want to configure the CPU next.
4. Click OK to confirm the new device.
You have added the SIMATIC Drive Controller to the project and can now continue with
configuration, parameter assignment and programming.

Display of the SIMATIC Drive Controller
When you add a SIMATIC Drive Controller to the project, by default:
‚óè A "Drive Controller_a" group is generated
‚óè Two devices are added to the group, for example:
‚Äì PLC_b [CPU 1504D TF] and
‚Äì Integrated_c [S120, CPU 150xD]

Figura 1-32

SIMATIC Drive Controller in the project tree, device collapsed

SINAMICS Integrated is only created if Startdrive is installed. Both devices have already been
joined in a network over the PROFIdrive Integrated_d subnet.
The respective instance numbers (a, b, c, d) are assigned by STEP 7 depending on the objects
already present in the project.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1187

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-33

SIMATIC Drive Controller network view

CPU (e.g. PLC_1) and integrated drive control (e.g. Integrated_1) are modeled as separate
devices. You can also move the devices as required to other groups and delete the "Drive
Controller" group. You can also add other devices to the "Drive Controller" group, for example
a CU320-2 PN, if you require more than six servo drives.
Nota
Adding SIMATIC Drive Controller directly to group
You can add the SIMATIC Drive Controller directly to a group folder in the project tree even if
the group folder is a subfolder:
1. Select the required group.
2. Go to the menu bar or shortcut menu and select "Add" > "Device".

Creation options
The CPU and SINAMICS Integrated are by default created in a shared group folder in the
project tree.
To change this behavior, activate or deactivate the relevant options for the SIMATIC Drive
Controller under "Settings" -> "Hardware configuration" -> "Device-specific settings".

Figura 1-34

1188

Creation options for creating a SIMATIC Drive Controller

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
The table below sets out the benefits of configuration with or without grouping.
Tabla 1-88

Guide to grouping

With "Drive Controller" grouping

Without grouping or user-specific grouping

‚óè Actions apply to all devices in a group, for
example

‚óè Greater flexibility in project structure in the
project tree, for example

‚Äì

Go online

‚Äì

by machine/plant modules

‚Äì

Load to/from device

‚Äì

by CPUs and drives, in separate groups

‚Äì

Copy

‚óè You can add additional devices to the group as
required, for example
‚Äì

with CU320-2

‚Äì

with I/O system

If you want to create the SIMATIC Drive Controller without the integrated drive, deselect the
"Including SINAMICS Integrated" option.
Deselecting this option can, for example, be useful in the following cases:
‚óè You are copying a previously configured SINAMICS Integrated drive control from another
project.
‚óè The project is to be processed by another user without SINAMICS Startdrive.
‚óè SINAMICS Integrated is not to be configured until later.
‚óè SINAMICS Integrated is not being used, for example, because another drive system is
being used.

"Drive Controller" group
For the "Drive Controller" group, you have a range of functions to choose from in the menu bar,
toolbar and shortcut menu. With "Go online", for example, you can go online with all devices in
the group.
The functionality supported by a given device depends on the device and state. For example,
the function "Download to device" is supported by the SINAMICS Integrated but not by the CPU
when there is an active online connection. The "Load preview" dialog provides relevant
information and suggestions for actions for loading.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1189

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-35

Load preview

Subsequently configuring SINAMICS Integrated
Requirements: STEP 7 Professional and SINAMICS Startdrive are installed.
Proceed as follows if your project only contains the CPU of a SIMATIC Drive Controller and you
want to configure the missing SINAMICS Integrated.
1. Select "Add new device" in the project tree.
2. In the "Add new device" dialog, go to "Drives" > "Drives & starters" > "SINAMICS drives" >
"SINAMICS S120 Integrated for SIMATIC" and select SINAMICS Integrated, and select the
firmware version of the device under "Version".
3. Click OK to confirm.
Result: SINAMICS Integrated has been added to the project tree and can be networked with the
CPU.

Subsequently configuring a CPU
Requirements: STEP 7 Professional and SINAMICS Startdrive are installed.

1190

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Proceed as follows if your project only contains a SINAMICS Integrated of a SIMATIC Drive
Controller and you want to configure the missing CPU.
1. To ensure that only the CPU (without SINAMICS Integrated) is created, deselect the
"Including SINAMICS Integrated" option under "Settings" > "Hardware configuration" >
"Device-specific settings". Also deselect the "With Drive Controller group folder" option if
you do not want a group folder to be created. Alternatively, you will need to delete the
components you do not require.
2. Select "Add new device" in the project tree.
3. In the "Add new device" dialog, select the relevant device version under "Controller" >
"SIMATIC Drive Controller" and the firmware version of the device under "Version".
4. Click OK to confirm.
Result: The CPU has been added to the project tree and can be connected to the SINAMICS
Integrated .

Replacing devices in STEP 7
The following section explains how to replace a SIMATIC S7-1500 CPU with a SIMATIC Drive
Controller in an existing project or vice versa.
1. Select the device to be replaced in the project tree and right-click to open the shortcut menu.
2. Select the "Replace device..." option
3. Select the module you want to use in the right-hand column. The "Compatibility information"
section indicates whether the devices to be replaced are compatible and whether or not and,
if so, which configurations will be lost in the process.
4. Click "OK" to confirm.
When replacing devices, remember that the SIMATIC Drive Controller consists of two
networked devices ‚Äì a CPU and a SINAMICS Integrated.

Replacing a modular SIMATIC S7-1500 CPU with a SIMATIC Drive Controller (CPU)
If you replace a modular SIMATIC S7-1500 CPU with a SIMATIC Drive Controller, the
configurations at the integrated PROFINET interfaces and at the integrated PROFIBUS
interface are retained. In other words, the interfaces are mapped to an interface of the same
type.
Configurations of the onboard I/O of S7-1500 compact CPUs are not applied. Please also note
the compatibility information in the device replacement dialog.
The centralized I/O in the S7-1500 automation system is moved to the "unplugged modules"
area. If required, copy the I/O to a distributed I/O ET 200MP system before device replacement.
A connected SINAMICS S120 CU320-2 remains connected ‚Äì it is not swapped out for a
SINAMICS Integrated. If you require a SINAMICS Integrated, you need to create it manually.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1191

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Replacing a SIMATIC Drive Controller (CPU) with a modular SIMATIC S7-1500 CPU
For the device replacement, PROFIdrive Integrated is removed and SINAMICS Integrated
remains as a non-networked device in the project. You can connect SINAMICS Integrated to a
SIMATIC Drive Controller CPU again at a later time.
If you no longer need SINAMICS Integrated, manually delete it from the configuration.
Configurations at interface X142 are not applied.
Nota
Device replacement with other CPU classes (for example ET 200SP CPUs or ET 200pro
CPUs) is not possible.

Replacing SINAMICS Integrated with SINAMICS S120 CU320-2 and vice versa
Device replacement is currently not supported

Configuration of digital inputs/outputs (X142)
You configure the required digital input/outputs and operating modes over interface X142.

Overview of supported operating modes
You can configure the following operating modes for the individual channels of the X142
interface:
Tabla 1-89

Overview of operating modes

Operating mo‚Äê
de of X142 I/
Os
(8 channels)

Functionality

Use with technology
objects (TOs)

Use via I/O area (wit‚Äê
hout TO)

Isochronous
mode

DI

Digital input

‚óè Hardware limit
switch for
positioning and
synchronous axes

No OB restrictions

Optional

‚óè Output cam

No OB restrictions

Optional

‚óè Input delay (1 ¬µs/125 ¬µs)
‚óè Hardware interrupt (optional)
Hardware interrupt at rising and/or falling
edge
DQ

Digital output

‚óè Cam track
Timer DI

Acquisition of the switching time of a digital Measuring input
input signal with up to two edges per ap‚Äê (OB 91 required)
plication cycle (e.g. for use as measure‚Äê
ment sensing input)

OB 91/OB 6x
required

Required

Timer DQ

Precisely timed output of a digital output
‚óè Output cam (OB 91 OB 91/OB 6x
required
signal with up to two edges per application
required)
cycle (e.g. for use as an output cam output)
‚óè Cam track (OB 91
required)

Required

1192

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Operating mo‚Äê
de of X142 I/
Os
(8 channels)

Functionality

Use with technology
objects (TOs)

Use via I/O area (wit‚Äê
hout TO)

Isochronous
mode

Oversampling
DI

Acquisition of 32 states of a digital input
signal at equal intervals per application
cycle

---

OB 91/OB 6x
required

Required

Oversampling
DQ

Output of 32 states of a digital output sig‚Äê --nal at equal intervals per application cycle

OB 91/OB 6x
required

Required

Event/period
duration mea‚Äê
surement

Measurement of number of edges and pe‚Äê --riod duration (e.g. for simple speed mea‚Äê
surement with hole mask and light barrier)

OB 91/OB 6x
required

Required

Pulse width
modulation
PWM

Output of a configurable pulse-pause ratio
with a configurable frequency

No OB restrictions

Optional

---

Procedure
1. Select the Device configuration entry in the project tree under the CPU. The device view
opens.
2. In the device view, click the DI/DQ 8x24VDC [X142] interface. You can now edit the
configurable properties under Properties in the Inspector window.
You can find an overview of all channels and your selected settings under Channel parameters.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1193

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-36

Channel parameters

To configure your selected channels, click on the arrow beside the channel number.

Configuring the DI operating mode
DI operating mode
1. Select the operating mode DI for the required channel at interface X142.

1194

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-37

DI operating mode

Inversion
You can invert the 24 V signal to adjust it to your process. By default, the signal is not inverted.
Input delay
To suppress faults, you can set an input delay of 1 ¬µs or 125 ¬µs for the input filter of the digital
inputs. Changes to the signal are only detected if they are constantly pending for longer than
the set input delay time.
Hardware interrupts
In the Hardware interrupts section, you can assign a hardware interrupt to a rising and/or falling
edge.

Further information
You can find more information on the DI operating mode in Assignment of the control interface
(P√°gina 1215) and Assignment of the feedback interface (P√°gina 1216).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1195

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuring the DQ operating mode
DQ operating mode
1. Select the DQ operating mode for the required channel at interface X142.

Figura 1-38

DQ operating mode

Inversion
You can invert the 24 V signal to adjust it to your process. By default, the signal is not inverted.
High-speed output
If you select the high-speed output option, the digital output is switched alternately to 24 V DC
and ground. Allows for extremely steep edges (output delay in the 1 Œºs range).

Further information
You can find more information on the DQ operating mode in Assignment of the control interface
(P√°gina 1215) and Assignment of the feedback interface (P√°gina 1216).

Configuring Timer DI operating mode
Timer DI
Timer DI operating mode allows you to acquire the switching time of up to two edges per
application cycle (for example OB 91, OB 6x), for example for use as a measuring output.
‚óè Select the Timer DI operating mode for the required channel.

1196

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-39

Operating mode: Timer DI

Inversion
You can invert the 24 V signal to adjust it to your process. By default, the signal is not inverted.
Input delay
To suppress faults, you can set an input delay of 1 ¬µs or 125 ¬µs for the input filter of the digital
inputs. Changes to the signal are only detected if they are constantly pending for longer than
the set input delay time.
To allow signals pending very briefly to be detected with timer DI (for example level of 100 ¬µs),
set an input delay of 1 ¬µs.

Assigning the measuring input technology object
The measuring input technology object must always be assigned to another technology object
whose position is evaluated by the measuring input.
You can assign the measuring input technology object to the following technology objects:
‚óè Synchronous axis
‚óè Positioning axis
‚óè External encoder
You can assign the measuring input technology object precisely one axis or one external
encoder.
You can assign multiple measuring input technology objects to one axis or one external
encoder.

Configuring the measuring input technology object
‚óè Select the configuration of the measuring input in the Technology objects folder in the
project tree.
‚óè Configure the basic properties of the technology object in the Basic parameters
configuration window.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1197

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-40

Basic parameters

Name
‚óè Define the name of the measuring input in this field. The technology object is listed under
this name in the project tree. The tags of the measuring input can be used in the user
program under this name.
Assigned axis or external encoder
STEP 7 displays the axis or external encoder assigned to the measuring input. You can use the
link to directly access the basic parameters of the higher-level technology object.
Unit of measurement
The unit of measure shown for the position of the measuring input corresponds to the unit of
measure of the higher-level technology object.
Hardware interface
‚óè In the Hardware interface configuration window, assign the a measuring input type Timer DI
and the selected channel to the technology object.

1198

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-41

Hardware interface

Measuring input type: Measuring using Timer DI
‚óè Select a measurement input for a measurement using a Timer DI. The selection box
displays all channels that have been configured correctly.
Nota
Extending the configuration limits
A maximum of eight timer DI can be configured at the X142 interface. If the timer DI at X142 are
not sufficient for your needs, you can configure a further eight measuring inputs at interface
X122/X132. You can also extend the configuration limits using time-based I/O modules:
‚óè ET 200SP distributed I/O system: TM Timer DIDQ 10x24V
‚óè ET 200MP distributed I/O system: TM Timer DIDQ 16x24V
You can find more information on these systems in AUTOHOTSPOT.
Nota
Unsupported instructions for X142
The function blocks for the use of time-based IO (TIO instructions) are not supported by the
X142 interface.
Recommendation: Use the measuring input technology object for timer DI.
Adjustment for measuring range activation time
‚óè To adjust the activation time defined in the system, enter an additional activation time in the
Extended parameters configuration window.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1199

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Lost Edge Counter (LEC)
Timer DI support Lost Edge Counter. If more than two edges to be detected occur within one
position control cycle, a measured value cannot be evaluated for the other edges to be
detected. The LEC records the number of edges lost.
Which lost edges are recorded in the LEC depends on the mode set in the Motion Control
instruction. For example, if you only want to measure rising edges, the LEC only records the
rising edges not measured. The LEC can count and display a maximum of seven lost edges.
The number of lost edges is displayed in the function block and in the technology data block.

Further information
You can find additional information on the following topics in the S7-1500T Motion Control
function manuals (https://support.industry.siemens.com/cs/ww/en/view/109751049):
‚óè Measuring input type: Timer DI
‚óè Measuring input type: SINAMICS (central measuring input)
‚óè Measuring input type: PROFIdrive telegram (drive or external encoder)
‚óè Lost Edge Counter (LEC)

Configuring Timer DQ operating mode
Timer DQ
Timer DQ operating mode allows you to output up to two edges per application cycle (for
example OB 91, OB 6x) at a specific time, for example, for use as a cam output.
1. Select the Timer DQ operating mode for the required channel.

Figura 1-42

Mode of operation: Timer DQ

Inversion
You can invert the 24 V signal to adjust it to your process. By default, the signal is not inverted.

1200

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
High-speed output
If you select the high-speed output option, the digital output is switched alternately to 24 V DC
and ground.
Advantages of the high-speed output:
‚óè Extremely steep edges (output delay in the 1 Œºs range)
‚óè Extremely high switching frequencies
‚óè Maximum switching precision, for example, for use as a cam output

Assigning the output cam technology object
The output cam technology object must always be assigned to another technology object
whose position is evaluated.
You can assign the output cam technology object to the following technology objects:
‚óè Synchronous axis
‚óè Positioning axis
‚óè External encoder
You can assign exactly one axis or one external encoder to the output cam.
You can assign multiple output cams to one axis or one external encoder.

Configuring the output cam technology object
1. Select the configuration of the output cam in the Technology objects folder in the project tree.
2. Configure the basic properties of the technology object in the Basic parameters
configuration window.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1201

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-43

Basic parameters

Name
1. Define the name of the output cam in this field. The technology object is listed under this
name in the project tree. The tags of the output cam can be used in the user program under
this name.
Assigned axis or external encoder
STEP 7 displays the axis or external encoder assigned to the output cam. You can use the link
to directly access the basic parameters of the higher-level technology object.
Output cam type
1. Select an output cam type on the basis of the required switching behavior:
‚óè Position-based cam (position-dependent switch-on/switch-off)
‚óè Time-based cam (position-dependent switch-on and position-independent or timedependent switch-off)

1202

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Output cam reference
1. In this selection, configure whether the switching points of the output cams are to reference
the actual position or the position setpoint.
Unit of measurement
The unit of measurement shown for the position of the output cam corresponds to the unit of
measurement of the higher-level technology object.
When a time-based cam is selected as the output cam type, the unit of measurement for the
switch-on duration and other times is also indicated. The unit of measurement for output cams
is always ms.
Hardware interface
Select the type of cam output in the Hardware interface configuration window.

Figura 1-44

Hardware interface

1. Select whether you want to output the switching signals generated at the digital output.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1203

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Activate output
Select one of the following two output options for outputting the cam track:
‚Äì Output via Timer DQ
For output by Timer DQ, select a cam output in the Output field. The selection box
displays all channels that have been configured correctly.
Nota
Extending the configuration limits
A maximum of eight timer DQ can be configured at the X142 interface. If the Timer DQ
at X142 are not sufficient for your needs, you can increase the configuration limits with
time-based IO modules:
‚óè ET 200SP distributed I/O system: TM Timer DIDQ 10x24V
‚óè ET 200MP distributed I/O system: TM Timer DIDQ 16x24V
You can find more information on these systems in AUTOHOTSPOT.
Nota
Unsupported instructions for the X142 interface
The function blocks for the use of time-based IO (TIO instructions) are not supported by
the X142 interface.
Recommendation: For the timer DQ, use the output cam or cam track technology object.
‚Äì Output by digital output module
For output by a digital output module, select a digital output in the Output field. Only the
digital outputs with previously defined PLC tags are displayed for selection.
Nota
Output via the X122, X132 or X142 interface
Also use the "Output by digital output module" setting in the following cases:
‚óè The output occurs at the X142 interface by a DQ instead of a Timer DQ.
‚óè The output occurs by a digital output of the X122 or X132 interface (configured
telegram 39x required)
In both cases you must define a PLC tag for the respective I/O address.
Output deactivated
When output is deactivated, the cam track is evaluated only in the software.

1204

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Extended parameters > Activation time

Figura 1-45

Activation time

The specified output cam type is indicated at the top of the Activation time configuration window.
1. For a time shift of the switch-on and switch-off times of the output cams, enter an activation
time and a deactivation time.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1205

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Extended parameters Parameter > Hysteresis

Figura 1-46

Hysteresis

1. To prevent unwanted changes in the switching state of the output cams of a cam track, enter
a hysteresis value.
When using output cams that reference the actual position, it is advisable to enter a hysteresis
value (> 0.0).

Cam track technology object
In addition to the output cam technology object already described, the cam track technology
object is also available.
You can find a detailed description of how to configure the cam track technology object in the
S7-1500T Motion Control function manuals (https://support.industry.siemens.com/cs/ww/en/
view/109751049).

1206

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuring Oversampling DI operating mode
Oversampling DI
The Oversampling DI function detects 32 signal states of a given digital input at equal intervals
per application cycle (for example OB 91, OB 6x). The 32 states are returned together as a 32bit value in the feedback interface. The value is read in synchronously to Ti (actual value
acquisition).
Nota
Isochronous mode
Oversampling requires isochronous mode.
The figure below is an example of Oversampling DI4:

7L

7L

7$33

',

                               
                               

06%

/6%

TAPP

Application cycle

MSB

Most significant bit

LSB
Figura 1-47

Least significant bit
Oversampling DI

Configuring Oversampling DI
1. Select the Oversampling DI operating mode for the required channel.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1207

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Figura 1-48

Oversampling DI

Nota
Extending the configuration limits
A maximum of eight oversampling DI can be configured at the X142 interface. If the
Oversampling DI at X142 are not sufficient for your needs, you can increase the configuration
limits with time-based IO modules, for example:
‚óè ET 200SP distributed I/O system: TM Timer DIDQ 10x24V
‚óè ET 200MP distributed I/O system: TM Timer DIDQ 16x24V
You can find more information on these systems in AUTOHOTSPOT.
Inversion
You can invert the 24 V signal to adjust it to your process. By default, the signal is not inverted.
Input delay
To suppress faults, you can set an input delay of 1 ¬µs or 125 ¬µs for the input filter of the digital
inputs. Changes to the signal are only detected if they are constantly pending for longer than
the set input delay time.
To allow signals pending very briefly to be detected by oversampling DI (for example level of
100 ¬µs), set an input delay of 1 ¬µs.

Further information
You can find more information on the Oversampling DI operating mode in Assignment of the
control interface (P√°gina 1215) and Assignment of the feedback interface (P√°gina 1216).

Configuring Oversampling DQ operating mode
Oversampling DQ
The Oversampling DQ function outputs 32 signal states at equal intervals per application cycle
(for example OB 91, OB 6x). Up to 32 edges are therefore possible per application cycle at a
given digital output. The 32 states are set over the control interface. The output occurs
synchronously with time TO (setpoint transfer).
Nota
Isochronous mode
Oversampling requires isochronous mode.
The image below is an example of oversampling of DQ5:

1208

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7R

7R

7$33

'4

                               
                               

06%

/6%

TAPP

Application cycle

MSB

Most significant bit

LSB
Figura 1-49

Least significant bit
Oversampling DQ

Nota
Output frequency with the Oversampling function
The combination of application cycle and the 32-bit string output must not result in an output
frequency that exceeds the maximum switching frequency for the digital outputs.

Configuring an oversampling DQ
1. Select the operating mode Oversampling DQ for the required channel.

Figura 1-50

Oversampling DQ

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1209

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Extending the configuration limits
A maximum of eight oversampling DQ can be configured at the inputs/outputs of the X142
interface. If the oversampling DQ at X142 are not sufficient for your needs, you can increase
the configuration limits with time-based IO modules, for example:
‚óè ET 200SP distributed I/O system: TM Timer DIDQ 10x24V
‚óè ET 200MP distributed I/O system: TM Timer DIDQ 16x24V
You can find more information on these systems in AUTOHOTSPOT.
Inversion
You can invert the 24 V signal to adjust it to the process. By default, the signal is not inverted.
High-speed output
If you select the high-speed output option, the digital output is switched alternately to 24 V DC
and ground. Allows for extremely steep edges (output delay in the 1 Œºs range).
To allow signals pending very briefly to be output by oversampling DQ (for example level of
0.1 ms), you must operate the output as a high-speed output.

Further information
You can find more information on the Oversampling DQ operating mode in Assignment of the
control interface (P√°gina 1215) and Assignment of the feedback interface (P√°gina 1216).

Configuring event/period measurement operating mode
Event/period duration measurement
Event counter
You use event measurement (16-bit value) to measure the number of rising edges per
application cycle over the feedback interface.
The event counter is a rotary counter.
‚óè An event counter overflow is not displayed.
‚óè The exact value must be calculated on the basis of the difference.
Period measurement
You use the period duration measurement (32-bit value) to measure the number of increments
of 41.67 ns between the last two rising edges received in the application cycle over the
feedback interface.

1210

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Period = 41.67 ns ‚Ä¢ number of increments
Nota
Isochronous mode
Event/period measurement requires isochronous mode.
1. Select the the required channel for the Event/period measurement operating mode.

Figura 1-51

Event/period duration measurement

Inversion
You can invert the 24 V signal to adjust it to your process. By default, the signal is not inverted.
Input delay
To suppress faults, you can set an input delay of 1 ¬µs or 125 ¬µs for the input filter of the digital
inputs. Changes to the signal are only detected if they are constantly pending for longer than
the set input delay time.
To allow signals pending very briefly to be detected at high counting frequencies, you need to
set an input delay of 1 ¬µs.

Further information
You can find more information on the Event/period measurement operating mode
in Assignment of the control interface (P√°gina 1215) and Assignment of the feedback interface
(P√°gina 1216).

Configuring Pulse width modulation (PWM) operating mode
Areas of application
You can use pulse width modulation (PWM) to generate periodic pulses with a constant rated
voltage and a variable pulse duration.
Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1211

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Possible applications for pulse width modulation (PWM):
‚óè Control of proportional valves and directional valves
‚Äì Energy savings as a result of a reduction in holding current or for controlling the valve
position
‚óè Heating control, for example, via an external additional power unit

Principle of operation
With pulse width modulation, a signal with defined time period and variable pulse duration is
output at the digital output. You use pulse width modulation to vary the mean value of the output
voltage. This allows you to control the load current or the power in line with the connected load.
The pulse duration can be between 0 (no pulse, always off) and full-scale deflection (no pulse,
always on).

‡Ω∞
‡Ω±

‚ë†
‚ë°

‡Ω±

Period
Pulse duration

Pulse width modulation (PWM) is based on the specification of a base frequency of 1, 2, 4, 8
or 16 kHz. You can alter the base frequency in terms of period and pulse-pause ratio over the
control interface (32-bit value). The bit pattern is shown in each base period. The base period
is defined on the basis of the base frequency. A "0" is LOW and a "1" is HIGH.

Examples
Base frequency: 1 kHz ‚Üí Base period: 1 ms
1111 0000 0000 0000 1111 0000 0000 0000
Time period: 500 ¬µs; 375 ¬µs LOW; 125 ¬µs HIGH

1212

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
bPV

1111 0 0 0 0 | 0 0 0 0 0 0 0 0 | 1111 0 0 0 0 | 0 0 0 0 0 0 0 0
bELWV

Figura 1-52

Pulse width modulation

Base frequency: 1 kHz
1111 1111 1111 1111 0000 0000 0000 0000
Time period: 1 ms; 500 ¬µs LOW; 500 ¬µs HIGH
1111 1111 0000 0000 0000 0000 0000 0000
Time period: 1 ms; 750 ¬µs LOW; 250 ¬µs HIGH
1111 0000 1111 0000 1111 0000 1111 0000
Time period: 250 ¬µs; 125 ¬µs LOW; 125 ¬µs HIGH
Base frequency: 2 kHz
1010 1010 1010 1010 1010 1010 1010 1010
Time period: 31.25 ¬µs; 15.625 ¬µs LOW; 15.625 ¬µs HIGH

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1213

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuring Pulse width modulation (PWM) operating mode
To configure PWM operating mode, first define the required base frequency of pulse width
modulation. You can configure the base frequency as 1, 2, 4, 8 or 16 kHz. The selected base
frequency then applies to all channels of interface X142.

Figura 1-53

Base frequency of pulse width modulation

Now select the channels for PWM operating mode. If you want to configure very short pulses,
enable the high-speed output function.

Figura 1-54

Pulse width modulation channel

The selected digital output is switched with the selected base frequency and the switching
pattern from the control interface.
Inversion
You can invert the 24 V signal to adjust it to your process. By default, the signal is not inverted.

1214

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
High-speed output
If you select the high-speed output option, the digital output is switched alternately to 24 V DC
and ground. Allows for extremely steep edges (output delay in the 1 Œºs range).
To allow signals pending very briefly to be output with pulse width modulation (for example,
level duration of 0.1 ms), you must operate the output as a high-speed output.

Further information
You can find more information on the Event/period measurement operating mode
in Assignment of the control interface (P√°gina 1215) and Assignment of the feedback interface
(P√°gina 1216).

Assignment of the control interface
Control interface
The user program uses the control interface to influence the behavior of the technology inputs
and technology outputs at interface X142.
The following table shows the control interface assignment:
Tabla 1-90

Assignment of the control interface

Offset from
start address

Parameter

Meaning

Byte 0

SET_DQ (DQ0 to DQ7)

Set DQ (DQ0 to DQ7)

Byte 1 to 3

Reserved

Must not be used

Byte 4 to 7

TEC_OUT (DQ0)

Timer DQ:
Byte 0, 1: OFF TIME (output time stamp for DQ reset)
Byte 2, 3: ON TIME (output time stamp for setting DQ)
Oversampling DQ:
Byte 0 to 3: 32 states for oversampling
Pulse width modulation (PWM):
Byte 0 to 3: PWM bit pattern

Byte 8 to 11

TEC_OUT (DQ1)

Byte 12 to 15

TEC_OUT (DQ2)

Byte 16 to 19

TEC_OUT (DQ3)

Byte 20 to 23

TEC_OUT (DQ4)

Byte 24 to 27

TEC_OUT (DQ5)

Byte 28 to 31

TEC_OUT (DQ6)

Byte 32 to 35

TEC_OUT (DQ7)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

See Byte 4 to 7

1215

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Offset from
start address

Parameter

Meaning

Byte 36

SEL (DI0, DI1)

SEL DI1

Bit 5 to 7: Edge selection for time stamp acquisition DI1
001 Rising edges only
010 Falling edges only
011 Rising and falling edges
(in order of occurrence)
101 First rising, then falling edge
110 First falling, then rising edge
000, 100, 111 reserved
Bit 4: Cyclical time stamp acquisition for DI1

SEL DI0
Byte 37

SEL (DI2, DI3)

Byte 38

SEL (DI4, DI5)

Byte 39

SEL (DI6, DI7)

Byte 40, 41

STW

Bit 0 to 3: see SEL DI1

See byte 36

MSL

Bit 12 to 15: Sign of life counter (master sign of life)

---

Bit 1 to 11: Reserved; bits must be set to 0

SYN

Bit 0: Synchronization of X142 interface with the user program

Assignment of the feedback interface
Feedback interface
The user program receives current values and status information from the X142 interface
technology I/Os over the feedback interface.
The following table shows the feedback interface assignment:
Tabla 1-91
Offset from
start address

Assignment of the feedback interface
Parameter

Meaning

Byte 0

STS_DI (DI0 to DI7)

State DI (DI0 to DI7)

Byte 1 to 3

Reserved

Must not be used

Byte 4 to 7

TEC_IN (DI0)

Timer DI:
Byte 0, 1: 2nd TIME/OFF TIME (second input time stamp)
Byte 2, 3: 1st TIME/ON TIME (first input time stamp)
Oversampling DI:
Byte 0 to 3: Oversampling value
Event/period duration mea‚Äê
surement

Event measurement:
Byte 0, 1: Reserved
Byte 2, 3: Counter value

Byte 8 to 11

TEC_IN_EXT (DI0)

Time period measurement:
Byte 0 to 3: Measured time period

1216

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Offset from
start address

Parameter

Meaning

Byte 12 to 15

TEC_IN (DI1)

See byte 4 to 11

Byte 16 to 19

TEC_IN_EXT (DI1)

Byte 20 to 23

TEC_IN (DI2)

Byte 24 to 27

TEC_IN_EXT (DI2)

Byte 28 to 31

TEC_IN (DI3)

Byte 32 to 35

TEC_IN_EXT (DI3)

Byte 36 to 39

TEC_IN (DI4)

Byte 40 to 43

TEC_IN_EXT (DI4)

Byte 44 to 47

TEC_IN (DI5)

Byte 48 to 51

TEC_IN_EXT (DI5)

Byte 52 to 55

TEC_IN (DI6)

Byte 56 to 59

TEC_IN_EXT (DI6)

Byte 60 to 63

TEC_IN (DI7)

Byte 64 to 67

TEC_IN_EXT (DI7)

Byte 68

LEC (DI0, DI1)

Bit 4 to 6: Lost Edge Counter for DI1
Bit 0 to 2: Lost Edge Counter for DI0
Bit 3, 7: Reserved (must not be used)

Byte 69

LEC (DI2, DI3)

Bit 4 to 6: Lost Edge Counter for DI3
Bit 0 to 2: Lost Edge Counter for DI2
Bit 3, 7: Reserved (must not be used)

Byte 70

LEC (DI4, DI5)

Bit 4 to 6: Lost Edge Counter for DI5
Bit 0 to 2: Lost Edge Counter for DI4
Bit 3, 7: Reserved (must not be used)

Byte 71

LEC (DI6, DI6)

Bit 4 to 6: Lost Edge Counter for DI7
Bit 0 to 2: Lost Edge Counter for DI6
Bit 3, 7: Reserved (must not be used)

Byte 72

Reserved

Must not be used

Byte 73

Layout property

Specific value

Byte 74, 75

ZSW

SSL

Bit 12 to 15: Sign of life counter (slave sign of life)

---

Bit 10, 11: Reserved (must not be used)

SYNC

Bit 8: X142 interface is synchronized with user program

Channel address

Bit 4 to 7 and 9: Number of the respective DI or DQ

Channel mode

Bit 0 to 3: Operating mode of the respective DI or DQ

Substitute value behavior
If the CPU is in STOP, the digital outputs (irrespective of any inversion set) return "0" (LOW
level) as a substitute value.

Reading back the terminal state
STS_DI (offset byte 0 of the feedback interface) represents the logical channel status, taking
account of any inversion configured.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1217

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Digital inputs
With digital inputs (DI, Timer DI, oversampling DI, event/period measurement), the value
corresponds to the logical state of the digital input.
Digital outputs
With digital outputs (DQ, Timer DQ, oversampling DQ, pulse width modulation PWM), the value
corresponds to the actual terminal state of the digital output. If the terminal state deviates from
the controlled state, there may be an output driver short-circuit or defect.

Nota
STS_DI
Signals are only reliably acquired over STS_DI if the level is significantly longer than the input
delay + acquisition cycle of the digital inputs/outputs (X142).
Example: If you operate the digital inputs/outputs (X142) as isochronous to the MC Servo in a
cycle of 2 ms and a set input delay of 125 ¬µs, the level duration must be > 2.125 ms.

Configuring the digital inputs and digital inputs/outputs (X122/X132)
The digital inputs and digital inputs/outputs (X122/X132) are mainly assigned to SINAMICS
Integrated. Through configuration (frames 39x), you can, however, also use the digital inputs
and digital inputs/outputs (X122/X132) for the CPU. The following applies:
‚óè A digital output is always only available exclusively to SINAMICS Integrated or to the CPU.
‚óè If you use a digital input for the CPU, you can also interconnect the digital input at the drive
end.
You can configure the digital inputs and digital inputs/outputs (X122/X132) channel by channel.
To do so, go to the function view in the project tree under "Automatic speed control" >
"Parameter assignment" and set the configuration under "Inputs/outputs".
Bidirectional inputs/outputs are configured in the following configuration mask.

1218

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-55

Bidirectional inputs/outputs

You can assign the SINAMICS digital inputs and digital inputs/outputs (X122/X132) using
frame 39x of the PU. The status information of the digital inputs and digital outputs is then
transferred at the PROFIdrive PZD sampling rate (p2048). The inputs/outputs are also sampled
in the configured sampling time for the digital inputs and digital inputs/outputs (p0799). The
application of the output values and return of the input values are therefore subject to dead
times and jitter.

Figura 1-56

Configuration of frame 393 for automatic speed control

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1219

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
You can find further information on the various different frame types in AUTOHOTSPOT.
Nota
Interface X142
If you have particularly strict requirements for the digital input/outputs, use the digital input/
outputs at interface X142. The digital inputs/outputs can be operated in isochronous mode and
allow very short response times.

Configuring the clock system
Overview of isochronous mode
Introduction
The SIMATIC Drive Controller supports isochronous mode for the following clock systems:
‚óè PROFINET IO interface X150
‚óè PROFIBUS DP interface X126
‚óè Technology I/Os X142
‚óè SINAMICS Integrated with PROFIdrive Integrated (always isochronous)
You can operate the clock systems separately or coupled on an isochronous basis.
Exception: Isochronous coupling of the PROFIBUS DP interface is not possible.

Independent isochronous mode
If you want to operate the clock systems separately in isochronous mode, configure a cycle time
for each clock system and assign the clock systems to different process images, for example:
‚óè SINAMICS Integrated ‚Üí PIP OB Servo [OB 91]
‚óè PROFIBUS DP interface X126 ‚Üí PIP 1 of isochronous mode interrupt OB [OB 6x]
The clock systems are in this case not isochronous to each other.
Nota
You cannot operate the X142 technology I/Os in isochronous mode separately from SINAMICS
Integrated.
If you want to operate technology I/Os X142 and SINAMICS Integrated in isochronous mode
simultaneously, always set coupled isochronous mode.

Coupled isochronous mode
In coupled isochronous mode, the relevant clock systems use a shared system clock.

1220

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
The leading clock system provides its own system clock to the other clock systems.
The following table shows the possible combinations for coupled isochronous mode on the
SIMATIC Drive Controller. The leading clock system for each combination is indicated.
Tabla 1-92

1

Possible combinations for coupled isochronous mode

PROFINET IO interface X150

Technology I/Os X142
(local send clock)

SINAMICS Integrated
(PROFIdrive Integrated)

PROFIBUS DP interface
X126

X (leading)

X

X

-

X (leading)

-

X

-

X (leading)

X

-

1

-

-

X (leading)

X

-

SINAMICS Integrated is not configured.

You configure coupled isochronous mode in STEP 7; see Setting the clock system
(P√°gina 1232).
Nota
Isochronous coupling of the PROFIBUS interface with other clock systems is not possible.
If you want to expand the drive configuration limits with distributed drive systems, connect those
distributed drive systems over the PROFINET IO interface X150. Only the PROFINET IO
interface X150 can be connected isochronously alongside the MC Servo to the clock system of
SINAMICS Integrated and the X142 technology I/Os.

Configuring drives with SINAMICS Integrated isochronously
Requirements
‚óè STEP 7 , V16 or higher
‚óè SINAMICS Startdrive , V16 or higher

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1221

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedure
1. Add a SIMATIC Drive Controller to your project.
The network view displays the components of a SIMATIC Drive Controller: SIMATIC
S7-1500 CPU and SINAMICS Integrated, networked through PROFIdrive Integrated.

Figura 1-57

SIMATIC Drive Controller in the network view

2. Open the device view of SINAMICS Integrated. Configure the SINAMICS S120 drive
system with its drive objects.
You can find the relevant details in the SINAMICS S120 with Startdrive commissioning
manual (https://support.industry.siemens.com/cs/ww/en/view/109763294).

1222

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-58

Configuring the SINAMICS S120 drive system

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1223

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Select the drive control in the SINAMICS Integrated device view.
Check the default PROFIdrive telegrams In the properties, under "Integrated_1" >
"Telegram configuration" in the "General" tab. Make changes if required.
The following default settings are made automatically:
‚Äì Automatic speed control: Frame 393
‚Äì Supply: Frame 370
‚Äì Drive axes: Frame 105

Figura 1-59

Configuring PROFIdrive frames

4. Create the axis technology objects. You create the axis technology objects under
"Technology objects > Add new object" in the project tree.

1224

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Assign the configured drives to the axis technology objects.
‚Äì Open the configuration of the technology object.
‚Äì Navigate to "Hardware interface" > "Drive".
‚Äì Select the "PROFIdrive" entry from the "Drive type" drop-down list.
‚Äì Select the "Antrieb" entry from the "Data connection" drop-down list.
‚Äì Select a SINAMICS Integrated drive axis from the "Drive" list.
Only drives for which a suitable PROFIdrive frame has been configured are available for
selection in the "Drive" list. You can find which PROFIdrive frames are supported by the
SINAMICS Integrated in the S7‚Äë1500T Motion Control function manuals (https://
support.industry.siemens.com/cs/ww/en/view/109751049).

Figura 1-60

Assigning drives to the technology objects

The technology object is connected to the drive. When the drives are assigned to the axis
technology objects, the following takes place:
‚Äì MC-Servo is created (if not already present)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1225

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚Äì The TPA OB Servo is entered as the process image for all PROFIdrive telegrams
6. Once you have configured all axis technology objects, switch back to the drive configuration
if necessary. You can use the "Device configuration" button.

Figura 1-61

"Device configuration" button

Nota
With SINAMICS Integrated, all frames must be operated in isochronous mode on OB Servo
(OB 91) or isochronous mode interrupt OB (OB 6x). STEP 7 checks compliance with this
rule when compiling the SIMATIC Drive Controller.
Exception: If you insert a SIMATIC Drive Controller in your project from the module catalog,
"--- (none)" is entered as the organization block for the drive control. If you do not configure
any other drive objects, you can also compile and download to the device without
isochronous mode.

Figura 1-62

1226

Configuring telegrams as isochronous

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Setting the clock system
You have configured SINAMICS Integrated as isochronous. Next, set the clock system.
Make the following settings in accordance with whether you are operating SINAMICS
Integrated in independent or coupled isochronous mode:
‚óè For independent isochronous mode:
‚Äì Set the required cycle time.
‚Äì Assign the "MC Servo" OB the clock system of SINAMICS Integrated.
‚óè For coupled isochronous mode:
‚Äì Assign the clock system of SINAMICS Integrated the leading clock system.
You can find details of how to assign the leading clock system in Setting the clock system
(P√°gina 1232).

Configuring technology I/Os (X142) as isochronous
Requirements
‚óè STEP 7, V16 or higher
‚óè SIMATIC Drive Controller has been configured.
‚óè At least one axis technology object has been created at the CPU of the SIMATIC Drive
Controller.
See for example Configuring drives with SINAMICS Integrated isochronously
(P√°gina 1221).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1227

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedure
1. Open the device view of the CPU.
2. Configure the operating modes of the technology I/Os in the CPU properties under
"General" > "DI/DQ 8x24VDC[X142]" > "Channel parameters", for example, a timer DQ for
later use as a cam output for channel 0.

Figura 1-63

Setting the operating mode for technology I/O X142

3. In the project tree under the axis technology object, add an output cam technology object
under "Output cam" > "Add new output cam".
4. Open the configuration of the output cam.
5. Under "Hardware interface", select the "Activate output" checkbox and the option "Output
over Timer DQ".

1228

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
6. Assign the configured output under "Output".

Figura 1-64

Assigning a channel to the output cam

7. Use the "Device configuration" button to switch back to the CPU settings and check the
settings under "DI/DQ 8x24VDC [X142]" > "I/O addresses".
The following settings must be configured for the input and output addresses:
‚Äì "Isochronous mode" is enabled.
‚Äì The organization block "MC Servo" is selected.
‚Äì The process image "OB Servo PIP" is selected.

Automatic settings
Isochronous mode is mandatory for certain operating modes of the X142 technology I/O
channels.
As soon as you set one of the following operating modes for a technology I/O channel, STEP
7 automatically selects the option "isochronous mode".
‚óè Timer DI
‚óè Timer DQ
‚óè Oversampling DI
‚óè Oversampling DQ
‚óè Event/period measurement
If you assign an output cam, cam track or measuring input technology object to an X142 I/O,
STEP 7 automatically sets the process image "OB Servo PIP".
In all other cases, you set the process image manually. If isochronous mode is mandatory for
at least one technology I/O, you must set the process image of the "MC Servo" OB (OB91) or
an isochronous mode interrupt OB (OB6x).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1229

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Setting the clock system
You have configured the technology I/Os as isochronous. Next, set the clock system.
Make the following settings in accordance with whether you are operating the X142 technology
I/Os in independent or coupled isochronous mode:
‚óè For independent isochronous mode or if the X142 technology I/Os are the leading clock
system
‚Äì Set the required cycle time.
‚Äì Assign the "MC Servo" OB the clock system of the technology I/Os.
Nota
You cannot operate the X142 technology I/Os in isochronous mode separately from
SINAMICS Integrated. If you want to operate X142 technology I/Os and SINAMICS
Integrated in isochronous mode simultaneously, always set coupled isochronous mode.
‚óè For coupled isochronous mode:
‚Äì Assign the leading clock system to the clock system of the technology I/Os.
You can find details of how to assign the leading clock system in Setting the clock system
(P√°gina 1232).

Configuring additional drives on PROFINET (X150) as isochronous
Requirement
‚óè STEP 7, V16 or higher
‚óè SINAMICS Startdrive, V16 or higher
You can import drives that are not integrated in the TIA Portal via Startdrive using GSD files
(generic station description). To do so, install the drive in the "Options" menu as a device
description file (GSD).

Adding a drive and frame to the device configuration
1. Add the required drive system in the network view, for example, SINAMICS S120
CU320-2 PN.
2. Open the device view of the drive system and configure the drive objects.
You can find the relevant details in the SINAMICS S120 with Startdrive commissioning
manual (https://support.industry.siemens.com/cs/ww/en/view/109763294).
3. Open the network view. Assign the drive system to the PROFINET interface [X150] of the
CPU.
4. Open the topology view. Interconnect the port of the drive system as in the real configuration
with the port of the CPU.
5. Configure the PROFIdrive frames for the drive axes, for example, frame 105.

1230

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
If you use a PROFINET IO drive system other than SINAMICS S120, adding and configuring
may differ from the description in certain respects. The frame is automatically preassigned in
line with the drive system.

Activating isochronous mode in the device configuration
You can operate PROFINET drives in isochronous or non-isochronous mode. Isochronous
mode, however, increases the quality of the position control of the drive and is therefore
recommended for drives such as SINAMICS S120.
Proceed as follows to activate isochronous mode for the drive:
1. Select the device view of the drive system.
2. In the properties window, select the tab "PROFINET Interface [X150]" > "Advanced options"
> "Isochronous mode".
3. Select the "Isochronous mode" check box.
4. In the properties window, select the tab "PROFINET Interface [150]" > "Advanced options"
> "Real-time settings" > "Synchronization".
5. Select "IRT" as the RT class.
Nota
If you have configured a PROFIdrive frame at the drive that requires isochronous mode,
STEP 7 automatically sets "Isochronous mode" and the RT class "IRT".

Configuring the PLC as sync master and setting the send clock
1. Select the device view of the CPU.
2. In the properties window, select the tab "PROFINET interface [X150]" > "Advanced options"
> "Real-time settings" > "Synchronization".
3. Select "IRT" as the RT class if it has not already been set automatically.
4. Select "Sync master" from the "Synchronization role" drop-down list.
5. Click the "Domain settings" button.
6. Set the required send clock.

Selecting the drive in the configuration of the technology object
1. Add a new axis technology object.
2. Open the configuration "Hardware interface" > "Drive".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1231

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Select the "PROFIdrive" entry from the "Drive type" drop-down list.
4. Select a drive axis of the PROFINET drive unit from the "Drive" list.
Only drives for which you have configured a suitable PROFIdrive frame are available for
selection. You can find out which PROFIdrive frames are supported by the SIMATIC Drive
Controller in the S7‚Äë1500T Motion Control function manuals (https://
support.industry.siemens.com/cs/ww/en/view/109751049).
Using the "Device configuration" button, you can switch to the drive device view, for
example, to configure drives or set other PROFIdrive frames (for example 39x frame for the
X122/X132 IOs of a CU320‚Äë2).

Setting the clock system
You have configured an external drive as isochronous on PROFINET using the example of the
SINAMICS S120 CU320‚Äë2 PN. Next, set the clock system.
‚óè Choose between independent and coupled isochronous mode.
‚óè Set the required send clock.
‚óè Assign the "MC Servo" OB the clock system of the PROFINET interface X150.
You can find more information in Setting the clock system (P√°gina 1232).

Configuring the PROFIBUS interface as isochronous
You can find out how to configure isochronous mode for distributed I/O on the PROFIBUS DP
in the Isochronous Mode (https://support.industry.siemens.com/cs/ww/en/view/109755401)
function manual.
Nota
Isochronous coupling of the PROFIBUS interface with other clock systems is not possible.
If you want to expand the drive configuration limits with distributed drive systems, connect those
distributed drive systems over the PROFINET IO interface X150. Only the PROFINET IO
interface X150 can be connected isochronously alongside the MC Servo to the clock system of
SINAMICS Integrated and the X142 technology I/Os.

Setting the clock system
The SIMATIC Drive Controller supports isochronous mode for the following clock systems:
‚óè PROFINET IO interface X150
‚óè PROFIBUS DP interface X126
‚óè Technology I/Os X142
‚óè With PROFIdrive Integrated
You can operate the clock systems separately or coupled on an isochronous basis. Exception:
Isochronous coupling of the PROFIBUS DP interface is not possible. You can find information
on the combinations in which you can couple the clock systems in Overview of isochronous
mode (P√°gina 1220).

1232

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
You make the required settings in the relevant clock systems.
Once you have set and, if necessary, coupled the clock systems, you need to couple the OB
servo with the clock system in which you wish to operate the drives / that is the leading clock
system.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1233

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

SINAMICS Integrated clock system
Proceed as follows to set the clock system of the SINAMICS Integrated:
1. Switch to the network view.
2. Click on PROFIdrive Integrated in the network view.
3. Make the settings for the SINAMICS Integrated under "Constant bus cycle time".
The SINAMICS Integrated is always isochronous (option is always selected).

Figura 1-65

SINAMICS Integrated (PROFIdrive Integrated) clock system

Adjust other settings if required ‚Äì for example times Ti/To for reading in/outputting data in
isochronous mode.

1234

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tabla 1-93

Setting options for "Cycle time" in the SINAMICS Integrated clock system

Setting options

Note

Manual

With these settings, you operate the SINAMICS Integrated as an independent
clock system.

Automatic minimum
Use local send clock [X142]

With this setting, you operate the SINAMICS Integrated in isochronous mode
coupled with the clock system of the X142 technology I/Os.
Use this setting if you want to use the technology I/Os isochronously with the OB
servo, for example, for measuring input or output cam applications.
Please note the following:
‚óè You cannot operate the X142 technology I/Os in isochronous mode
separately from SINAMICS Integrated.
‚óè If you want to operate X142 technology I/Os and SINAMICS Integrated in
isochronous mode simultaneously, always set coupled isochronous mode.
Consistency checks ensure that the setting is correct.

Send clock of the PROFINET interface
[X150]

With this setting, you operate SINAMICS Integrated in isochronous mode cou‚Äê
pled with PROFINET interface X150. SINAMICS Integrated uses the system
clock of PROFINET interface X150.
Use this setting if you need to operate the SIMATIC Drive Controller in isochro‚Äê
nous mode at PROFINET IO interface X150, for example, for the connection of
drives or for synchronous operation across PLC.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1235

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

X142 technology I/Os clock system
Proceed as follows to set the clock system of the X142 technology I/Os:
1. In the device view of STEP 7, select the CPU of the SIMATIC Drive Controller.
2. Navigate to "Advanced configuration" > "Isochronous mode" in the properties of the CPU.
3. Select the required settings from the "Source of send clock" drop-down list in the
"Isochronous mode for local modules" section.

Figura 1-66

1236

Technology I/O clock system

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tabla 1-94

Setting options for "Source of send clock" in the clock system of the technology I/Os

Setting options

Note

Local send clock

With this setting, you operate the X142 technology
I/Os as an independent clock system, or as the
leading clock system if you couple the clock
system of the SINAMICS Integrated.

Using the send clock of the PROFINET interface
[X150]

With this setting, you operate X142 technology
I/Os in isochronous mode coupled with PROFI‚Äê
NET interface X150. The X142 technology I/Os
use the system clock of PROFINET interface
X150.

PROFINET IO interface X150 clock system
Proceed as follows to set the clock system of PROFINET interface X150:
1. Select the PROFINET IO system in the network view of STEP 7.
2. Make the settings for the send clock, etc. under "PROFINET subnet" > "Domain
management" > "Sync domains".
In coupled isochronous mode with other clock systems, the clock system of the PROFINET
interface is always leading.
You can find additional information on configuring isochronous mode on PROFINET IO in the
Isochronous mode (https://support.industry.siemens.com/cs/ww/en/view/109755401) function
manual.

PROFIBUS interface X126 clock system
You must follow the rules below during configuration if you want to operate the PROFIBUS DP
interface in isochronous mode:
Tabla 1-95

Rules for configuring isochronous mode for PROFIBUS DP interface

If ...

The configured cycle time of the PROFIBUS DP interface
must...

A SINAMICS Integrated is configured

Be equal to or an integer multiple of the configured cycle
time of the SINAMICS Integrated (PROFIdrive Integrated)

The X142 technology I/Os are operated in
isochronous mode

Be equal to or an integer multiple of the configured cycle
time of the X142 technology I/Os

The clock system of the PROFINET IO
interface is coupled with one of the two
clock systems.

Be equal to or an integer multiple of the configured cycle
time of the PROFINET IO interface

Consistency checks ensure that the setting is correct.
Proceed as follows to set the clock system of the PROFIBUS interface:
1. Select the DP master system in the network view of STEP 7.
2. Make the settings for the DP cycle under "Constant bus cycle time".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1237

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Isochronous coupling of the PROFIBUS interface with other clock systems is not possible.
If you want to expand the drive configuration limits with distributed drive systems, connect those
distributed drive systems over the PROFINET IO interface X150. Only the PROFINET IO
interface X150 can be connected isochronously alongside the MC Servo to the clock system of
SINAMICS Integrated and the X142 technology I/Os.

Synchronizing MC Servo with clock system
Proceed as follows to synchronize the MC Servo with a clock system:
1. Open the "Program blocks" folder in the project tree.
2. Select the "MC Servo" organization block.
3. Select the "Properties" command in the shortcut menu.
4. Select the "Cycle time" entry in the area navigation.
5. The option "Synchronous to the bus" must be selected in the dialog box.
6. In the "Source of send clock" drop-down list, select the clock system to be synchronized with
the OB MC‚ÄëServo.

Figura 1-67

1238

Synchronizing MC Servo with clock system

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tabla 1-96

Setting options for synchronization with a clock system

Setting options1)

Note

PROFIdrive system (1)

With this setting, you synchronize MC Servo with
the clock system of SINAMICS Integrated.

PROFINET IO system (100)

With this setting, you synchronize MC Servo with
PROFINET interface X150.

PLC_1 (0)

With this setting, you synchronize MC Servo with
the clock system of technology I/Os X142.

DP master system (2)

With this setting, you synchronize MC Servo with
PROFIBUS interface X126.

1)

The designations may vary depending on the names assigned.

For coupled isochronous mode, you must always select the leading clock system.

Setting the application cycle
The application cycle of MC Servo is derived from the send clock and a configurable factor. The
adjustable factors depend on the coupled clock system.

I/O - Properties - X142
You can configure the following operating modes for the individual channels of the X142
interface:

Tabla 1-97

Overview of operating modes

Operating
Functionality
mode of
X142 I/Os
(8 channels)

Use with techno‚Äê
Use via I/O area
logy objects (TOs) (without TO)

DI

‚óè Hardware limit
switch for
positioning
and
synchronous
axes

No OB restric‚Äê
tions

Optional

‚óè Output cam

Optional

‚óè Cam track

No OB restric‚Äê
tions

Measuring input
(OB 91 required)

OB 91/OB 6x
required

Required

Digital input
‚óè Input delay (1 ¬µs/125 ¬µs)
‚óè Hardware interrupt (optional)
Hardware interrupt at rising and/or
falling edge

DQ
Timer DI

Digital output
Acquisition of the switching time of
a digital input signal with up to two
edges per application cycle (e.g.
for use as measurement sensing
input)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Isochro‚Äê
nous mode

1239

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.5

Operating
Functionality
mode of
X142 I/Os
(8 channels)

Use with techno‚Äê
Use via I/O area
logy objects (TOs) (without TO)

Timer DQ

Precisely timed output of a digital
output signal with up to two edges
per application cycle (e.g. for use
as an output cam output)

‚óè Output cam
(OB 91
required)

Oversam‚Äê
pling DI

Acquisition of 32 states of a digital
input signal at equal intervals per
application cycle

Isochro‚Äê
nous mode

OB 91/OB 6x
required

Required

---

OB 91/OB 6x
required

Required

Oversam‚Äê
pling DQ

Output of 32 states of a digital out‚Äê --put signal at equal intervals per ap‚Äê
plication cycle

OB 91/OB 6x
required

Required

Event/
period dura‚Äê
tion measu‚Äê
rement

Measurement of number of edges --and period duration (e.g. for simple
speed measurement with hole
mask and light barrier)

OB 91/OB 6x
required

Required

Pulse width
modulation
PWM

--Output of a configurable pulsepause ratio with a configurable fre‚Äê
quency

No OB restric‚Äê
tions

Optional

‚óè Cam track
(OB 91
required)

Configuraci√≥n de m√≥dulos centrales
En los siguientes cap√≠tulos se explica c√≥mo configurar los m√≥dulos centrales. Adem√°s se
incluye informaci√≥n sobre el direccionamiento de m√≥dulos.

Sinopsis de la configuraci√≥n de m√≥dulos centrales
Paso

Descripci√≥n

1

Seleccione un m√≥dulo central (P√°gina 1252).

2

Defina las propiedades del m√≥dulo. (P√°gina 1255).

3

Defina las direcciones de entrada y salida (P√°gina 1262).

Consulte tambi√©n
Direccionamiento de m√≥dulos (P√°gina 1262)
Direccionamiento de m√≥dulos (P√°gina 1261)
Reglas para m√≥dulos (P√°gina 1241)
Reglas para m√≥dulos (P√°gina 1242)
Introducci√≥n a la configuraci√≥n de hardware (P√°gina 40)

1240

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.6

Reglas para m√≥dulos

Introducci√≥n
En los m√≥dulos S7-300 existen reglas espec√≠ficas para los slots.
Al seleccionar un m√≥dulo del cat√°logo de hardware en la vista de dispositivos, en el rack se
marcan todos los slots posibles para el m√≥dulo seleccionado. Los m√≥dulos solo pueden
arrastrarse a los slots seleccionados.
Si se inserta, desplaza o sustituye un m√≥dulo, tambi√©n se aplican las reglas para los slots.

Reglas para los slots en los S7-300
Adem√°s de a las reglas generales de slots, el S7-300 est√° sujeto a las siguientes reglas
adicionales:
‚óè Pueden utilizarse hasta 4 racks.
Rack 0:
‚Äì Slot 1: s√≥lo fuente de alimentaci√≥n (p. ej., 6ES7 307-...) o vac√≠o
‚Äì Slot 2: s√≥lo m√≥dulo central (p. ej., 6ES7 314-...)
‚Äì Slot 3: m√≥dulo de interfaz (p. ej., 6ES7 360-.../365-...) o vac√≠o
‚Äì Slots 4 a 11: M√≥dulos de se√±al o funci√≥n, procesadores de comunicaci√≥n o vac√≠o
Racks 1 a 3:
‚Äì Slot 1: s√≥lo m√≥dulo de fuente de alimentaci√≥n (p. ej., 6ES7 307-...) o vac√≠o
‚Äì Slot 2: vac√≠o
‚Äì Slot 3: m√≥dulo de interfaz (p. ej., 6ES7 361-.../365-...)
‚Äì Slots 4 a 11: M√≥dulos de se√±al o funci√≥n, procesadores de comunicaci√≥n (dependiendo
del m√≥dulo de interfaz utilizado) o vac√≠o
‚óè En el rack 3 no podr√° utilizar el slot 11 si se est√° usando una CPU con periferia integrada.
‚óè Los m√≥dulos deben sucederse sin dejar huecos.
Nota
En el S7-300, el slot 3 est√° reservado para el m√≥dulo de interfaz. Si se utiliza un rack
individual no se ocupar√° este slot, ya que no es necesario insertar ning√∫n m√≥dulo de
interfaz. ¬°En la estructura real no deber√° haber ning√∫n hueco, ya que de lo contrario se
interrumpir√≠a el bus de fondo!
El modelo ET 200M con bus de fondo activo s√≠ puede presentar huecos en la ocupaci√≥n.

Reglas especiales para el m√≥dulo comod√≠n DM 370 Dummy
El m√≥dulo comod√≠n DM 370 Dummy (6ES7 370-0AA01-0AA0) puede insertarse en lugar de un
posterior m√≥dulo instalable.
El DM 370 Dummy reserva un √°rea de direcci√≥n de 1 byte para un m√≥dulo en un esclavo
modular DP (p. ej., para un m√≥dulo digital E/S).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1241

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Rack: Reglas generales para los slots (P√°gina 48)

1.4.1.7

Reglas para m√≥dulos

Introducci√≥n
En los m√≥dulos S7-400 existen reglas espec√≠ficas para los slots. Las reglas para la disposici√≥n
de m√≥dulos en un rack del S7-400 dependen del tipo de rack utilizado.
Al seleccionar un m√≥dulo del cat√°logo de hardware en la vista de dispositivos, en el rack se
marcan todos los slots posibles para el m√≥dulo seleccionado. Los m√≥dulos solo pueden
arrastrarse a los slots seleccionados.
Si se inserta, desplaza o sustituye un m√≥dulo, tambi√©n se aplican las reglas para los slots.

Reglas de slots del S7-400 para rack central
Adem√°s de a las reglas generales de slots, el S7-400 est√° sujeto a las siguientes reglas
adicionales para m√≥dulos en un rack central:
‚óè Insertar los m√≥dulos de fuente de alimentaci√≥n √∫nicamente en el slot 1 (excepci√≥n: m√≥dulos
de fuente de alimentaci√≥n redundantes)
‚óè Insertar un m√°ximo de 6 m√≥dulos de interfaz (IM de transmisi√≥n), de los cuales transferir√°n
energ√≠a hasta 2 de ellos.
‚óè Acoplar un m√°ximo de 21 racks de expansi√≥n a trav√©s de m√≥dulos de interfaz al rack central
‚óè Acoplar un m√°ximo de 1 rack de expansi√≥n con transferencia de energ√≠a a una interfaz del
IM de transmisi√≥n (IM 460-1 con IM 461-1)
‚óè utilizar un m√°ximo de 4 racks de expansi√≥n sin transferencia de energ√≠a (IM 460-0 con IM
461-0 o IM 460-3 con 461-3)

Reglas de slots del S7-400 para racks de expansi√≥n
Adem√°s de a las reglas generales de slots, el S7-400 est√° sujeto a las siguientes reglas
adicionales para m√≥dulos en racks de expansi√≥n:
‚óè Insertar los m√≥dulos de fuente de alimentaci√≥n √∫nicamente en el slot 1 (excepci√≥n: m√≥dulos
de fuente de alimentaci√≥n redundantes)
‚óè Insertar el m√≥dulo de interfaz (IM de recepci√≥n) √∫nicamente en el slot externo derecho (slot
9 o 18)
‚óè Insertar los m√≥dulos de bus K √∫nicamente en un rack cuyo n√∫mero no sea superior a 6 (de
lo contrario no podr√° activarse)

Reglas especiales para los m√≥dulos de fuente de alimentaci√≥n redundantes
Los m√≥dulos de fuente de alimentaci√≥n redundantes pueden insertarse dos veces en un rack.
Para saber si un m√≥dulo de fuente de alimentaci√≥n es o no redundante, puede leer la Task
Card "Cat√°logo de hardware" en la paleta "Informaci√≥n".

1242

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Deber√°n tenerse en cuenta las siguientes reglas:
‚óè La inserci√≥n de m√≥dulos de alimentaci√≥n redundantes s√≥lo ser√° posible en los racks
previstos para ello (reconocible en el texto de informaci√≥n de la Task Card "Cat√°logo de
hardware").
‚óè Los m√≥dulos de alimentaci√≥n redundantes deben insertarse en el slot 1 y siguientes (¬°no
dejar huecos!).
‚óè En un mismo rack no podr√°n insertarse m√≥dulos de alimentaci√≥n redundantes y no
redundantes (no es posible un "Funcionamiento mixto").

Consulte tambi√©n
Rack: Reglas generales para los slots (P√°gina 48)

1.4.1.8

Reglas para m√≥dulos

Utilizaci√≥n de m√≥dulos S7-1500
Introducci√≥n
Las CPUs del sistema de automatizaci√≥n S7‚Äë1500 son controladores modulares para
soluciones de sistema de rendimiento medio y alto en la automatizaci√≥n de procesos discretos
y continuos.

Campo de aplicaci√≥n
El sistema de automatizaci√≥n S7‚Äë1500 est√° concebido como soluci√≥n de sistema en la
automatizaci√≥n de procesos y de la fabricaci√≥n. El sistema de automatizaci√≥n S7‚Äë1500 es
universal y constituye la soluci√≥n √≥ptima para aplicaciones con estructuras centralizadas y
descentralizadas.
Su estructura escalable permite adaptar in situ y con precisi√≥n la estructura del controlador a
las necesidades concretas.
El sistema de automatizaci√≥n S7‚Äë1500 est√° homologado para el tipo de protecci√≥n IP20 y para
el montaje en un armario el√©ctrico.

Estructura
El sistema de automatizaci√≥n S7‚Äë1500 se monta en un perfil de soporte y puede estar
compuesto de un m√°ximo de 32 m√≥dulos. Los m√≥dulos se conectan entre s√≠ mediante un
conector de bus. La alimentaci√≥n el√©ctrica se realiza mediante el bus de fondo; la propia CPU
tambi√©n puede alimentar varios m√≥dulos. Si los m√≥dulos consumen m√°s corriente de la que
puede proporcionar la CPU, es posible conectar hasta tres fuentes de alimentaci√≥n
adicionales.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1243

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Dise√±o compacto
El sistema de automatizaci√≥n S7-1500 est√° disponible adem√°s en un dise√±o compacto. La
CPU est√° equipada con entradas y salidas integradas.
Las CPU compactas pueden ampliarse con todos los m√≥dulos del sistema de automatizaci√≥n
S7-1500. La capacidad total es de 32 m√≥dulos, con la CPU y los m√≥dulos integrados en ella
(consulte los manuales de producto CPU 1511C-1 PN (http://
support.automation.siemens.com/WW/view/es/109478675)y CPU 1512C-1 PN (http://
support.automation.siemens.com/WW/view/es/109478676)).

Consulte tambi√©n
Reglas para los slots en m√≥dulos S7-1500 (P√°gina 1244)
Estructura de una estaci√≥n S7-1500 (P√°gina 1245)
Equilibrado de potencia (P√°gina 1247)
Comprobaci√≥n del equilibrio de potencia (P√°gina 1248)

Reglas para los slots en m√≥dulos S7-1500
En los m√≥dulos S7-1500 existen reglas espec√≠ficas para los slots. Al seleccionar un m√≥dulo del
cat√°logo de hardware en la vista de dispositivos, en el rack se marcan todos los slots posibles
para el m√≥dulo seleccionado. Los m√≥dulos solo pueden arrastrarse a los slots seleccionados.
Las reglas se aplican a los slots siempre que se inserte, se desplace o se cambie un m√≥dulo.

Reglas para los slots en S7-1500
Para S7-1500 se aplican las siguientes reglas de slots:
‚óè Adem√°s de la CPU es posible conectar a un rack hasta 31 m√≥dulos.
‚óè Se pueden enchufar como m√°ximo tres m√≥dulos de alimentaci√≥n. Junto con la CPU, estas
fuentes alimentan todos los dispositivos colocados a continuaci√≥n en el rack. El n√∫mero
m√≠nimo de fuentes de alimentaci√≥n necesario depende de la potencia consumida por cada
m√≥dulo.
‚Äì A la izquierda de la CPU (slot 0) se puede enchufar un m√≥dulo de alimentaci√≥n de carga
PM o un m√≥dulo de alimentaci√≥n del sistema PS.
‚Äì A la derecha de la CPU (slots 2 a 31) se pueden enchufar hasta dos m√≥dulos de
alimentaci√≥n del sistema est√°ndar (PS) adicionales.
Nota
Segmentos de potencia
Un m√≥dulo de alimentaci√≥n y los m√≥dulos alimentados por √©l constituyen un segmento de
potencia. Un m√≥dulo de alimentaci√≥n proporciona corriente siempre a los m√≥dulos que est√°n
instalados a su derecha. En el siguiente m√≥dulo de alimentaci√≥n termina el segmento de
potencia y comienza un nuevo segmento de potencia para el siguiente m√≥dulo de alimentaci√≥n
y para los m√≥dulos instalados a su derecha. Los m√≥dulos instalados a su izquierda son
alimentados por el m√≥dulo de alimentaci√≥n precedente o por la CPU.

1244

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Equilibrado de potencia (P√°gina 1247)
Estructura de una estaci√≥n S7-1500 (P√°gina 1245)
Uso del √°rea de datos remanente ampliada con PS 60W 24/48/60VDC HF (P√°gina 1249)

Estructura de una estaci√≥n S7-1500
Se dispone de diversos m√≥dulos de periferia para ampliar cada una de las CPUs S7-1500.
Adem√°s de los m√≥dulos de entradas y salidas digitales es posible utilizar m√≥dulos de
tecnolog√≠a, de comunicaci√≥n y especiales. A pesar de la gran capacidad de las CPU S7-1500,
si la estructura de hardware es muy amplia, existen l√≠mites relativos al n√∫mero de m√≥dulos de
periferia y de sistemas I/O configurados en funci√≥n de las CPU utilizadas. Por tanto, en la
configuraci√≥n hay que tener en cuenta los l√≠mites descritos en la hoja de datos t√©cnicos de la
CPU correspondiente.

Configuraci√≥n m√°xima de una estaci√≥n
Al compilar la configuraci√≥n de hardware se comprueba si se han sobrepasado los l√≠mites
m√°ximos de configuraci√≥n de una estaci√≥n. Sin embargo, para la configuraci√≥n de una
estaci√≥n S7-1500 se recomienda tener en cuenta las restricciones de cantidades que puedan
existir. Al crear la configuraci√≥n de hardware, compruebe sobre todo los criterios siguientes,
consultando los datos t√©cnicos de los dispositivos:
‚óè N√∫mero m√°ximo de m√≥dulos de comunicaciones para PROFINET, PROFIBUS e Industrial
ETHERNET y para procesadores de comunicaciones
Por ejemplo, en una S7-1513 (6ES7 513-1AL00-0AB0) son seis unidades.
‚óè N√∫mero m√°ximo de sistemas PROFINET IO y de sistemas PROFIBUS DP
descentralizados
Los sistemas IO conectados mediante un dispositivo I no se tienen en cuenta para calcular
el n√∫mero m√°ximo. En tal caso se aplican las reglas para la configuraci√≥n m√°xima del
dispositivo I.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1245

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè N√∫mero m√°ximo de unidades de periferia descentralizada (dispositivos IO y esclavos DP)
Se cuentan todas las unidades de periferia descentralizada que est√°n asignadas a la CPU,
independientemente de la interfaz a la que est√©n conectadas (interfaz integrada o interfaz
de los CPs/CMs). La CPU solo se incluye en el recuento de unidades de periferia si est√°
configurada como I-Device.
Si el sistema PROFINET IO tiene conectados I-Devices, no se cuentan los dispositivos IO
que est√°n en el sistema PROFINET IO subordinado de un I-Device.
‚óè N√∫mero m√°ximo de m√≥dulos/subm√≥dulos
El n√∫mero m√°ximo de m√≥dulos insertables es muy elevado y pocas veces se alcanza en las
estructuras de hardware habituales de un sistema de automatizaci√≥n S7-1500.
Cuando se utilizan muchos m√≥dulos con subm√≥dulos en instalaciones muy grandes, existe
la posibilidad de que se sobrepasen los recursos disponibles para m√≥dulos/subm√≥dulos.
Los m√≥dulos de periferia sencillos que no tienen subm√≥dulos ocupan un recurso.
Los m√≥dulos complejos pueden tener varios subm√≥dulos y ocupan un recurso para cada
subm√≥dulo. Adem√°s, un m√≥dulo con subm√≥dulos ocupa otro recurso adicional (que
representa el m√≥dulo completo).
Ejemplo:
un m√≥dulo de interfaz IM 155-5PNHF ocupa cinco recursos, repartidos del siguiente modo:
dos recursos para los dos puertos de la interfaz PROFINET, un recurso para la interfaz de
la interfaz PROFINET y un recurso para el subm√≥dulo que contiene los par√°metros del
m√≥dulo de interfaz. Tal como se ha explicado anteriormente, hay que agregar un recurso
m√°s, pues se trata de un m√≥dulo con subm√≥dulos.

Ejemplo
Las figuras siguientes muestran ejemplos de configuraci√≥n hardware y explican la manera de
contar descrita anteriormente:

Figura 1-68

En esta figura, PLC_1 est√° configurado como controlador IO. IO-Device_1 y PLC_2 son dispositivos del sistema
IO de PLC_1. IO-Device_2 est√° conectado a la misma red, pero no forma parte del sistema IO. Por tanto, el
sistema IO de PLC_1 cuenta como dos dispositivos.

Figura 1-69

La segunda figura muestra que PLC_2 es un dispositivo I en el sistema IO de PLC_1, pero que al mismo tiempo
es un controlador IO. A trav√©s del m√≥dulo de comunicaci√≥n se establece un sistema IO subordinado, al que est√°
conectado IO-Device_2. En total, para PLC_2 se cuentan dos dispositivos.

1246

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-70

En la tercera figura hay otro sistema IO asignado a PLC_2. PLC_2 dispone ahora de dos sistemas IO en total,
uno en la interfaz interna y otro en el m√≥dulo de comunicaci√≥n. En el sistema IO nuevo se ha agregado otro
dispositivo. En total, con esta configuraci√≥n hardware se cuentan tres dispositivos para PLC_2: un I-Device
(PLC_2 est√° asignado a PLC_1) y dos dispositivos IO (asignados a PLC_2).

Consulte tambi√©n
Reglas para los slots en m√≥dulos S7-1500 (P√°gina 1244)
Equilibrado de potencia (P√°gina 1247)

Equilibrado de potencia
Introducci√≥n
Todos los m√≥dulos de periferia toman la potencia necesaria para activar su electr√≥nica del bus
de fondo. El bus de fondo se alimenta desde el m√≥dulo central, y en caso necesario, de fuentes
de alimentaci√≥n adicionales.

Comprobaci√≥n del equilibrio de potencia durante la configuraci√≥n
Para la comprobaci√≥n del equilibrio de potencia se cuenta con el apoyo de STEP 7. En una
tabla se muestran todos los m√≥dulos de periferia enchufados con el consumo el√©ctrico m√°ximo
de cada uno de ellos. El consumo el√©ctrico se compara con los m√≥dulos de alimentaci√≥n del
sistema enchufados. De esta manera se sabe si se dispone de alimentaci√≥n suficiente para
todos los m√≥dulos.
Se accede a la tabla en la ventana de inspecci√≥n, en el √°rea "Fuente de alimentaci√≥n del
sistema", despu√©s de seleccionar la CPU correspondiente y elegir la ficha "Propiedades".
Adem√°s, durante la configuraci√≥n se comprueba si se dispone de suministro el√©ctrico
suficiente. Si los m√≥dulos de periferia consumen m√°s potencia de la que entra en el bus de
fondo, las filas correspondientes de la tabla se marcan en rojo y se emite una advertencia al
respecto despu√©s de compilar la configuraci√≥n hardware.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1247

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comprobaci√≥n del equilibrio de potencia por la CPU
La CPU comprueba durante el funcionamiento si se cumple el equilibrio de potencia:
‚óè en cada conexi√≥n (POWER ON)
‚óè cada vez que cambia la estructura de hardware
Si la CPU detecta una sobrecarga del bus de fondo, desconecta todos los m√≥dulos de periferia
alimentados desde la CPU o desde la fuente de alimentaci√≥n y registra un mensaje en el b√∫fer
de diagn√≥stico. La CPU no arranca mientras el equilibrio de potencia sea negativo.

Causas de sobrecarga
La sobrecarga puede deberse a que la estructura de hardware no es congruente con la
configuraci√≥n. Por ejemplo, porque no est√°n enchufadas o conectadas las fuentes de
alimentaci√≥n necesarias para el funcionamiento, o porque se han enchufado m√°s m√≥dulos de
los configurados.

Consulte tambi√©n
Comprobaci√≥n del equilibrio de potencia (P√°gina 1248)
Reglas para los slots en m√≥dulos S7-1500 (P√°gina 1244)
Estructura de una estaci√≥n S7-1500 (P√°gina 1245)

Comprobaci√≥n del equilibrio de potencia
Durante la configuraci√≥n de una estaci√≥n se puede ir comprobando si se dispone de potencia
suficiente para todos los m√≥dulos de periferia. Para hacerlo, indique previamente si la CPU
recibe alimentaci√≥n de tensi√≥n.

Procedimiento
Para activar la fuente de alimentaci√≥n de la CPU y evaluar el equilibrio de potencia, proceda
del siguiente modo:
1. Seleccione la CPU S7-1500, p. ej. en la vista de redes.
2. Abra la ficha "Propiedades" de la ventana de inspecci√≥n.
Se muestran las propiedades de la CPU.
3. Seleccione la entrada "Fuente de alimentaci√≥n del sistema" en la navegaci√≥n local.
4. Si la CPU recibe tensi√≥n el√©ctrica, active la opci√≥n "Conexi√≥n a tensi√≥n de alimentaci√≥n L+".
Dicha opci√≥n est√° activada por defecto. De este modo, el consumo de potencia de la CPU
se incluye en el equilibrio de potencia.
5. En la tabla "Equilibrado de potencia" compruebe si el equilibrio de potencia es positivo. Si
es negativo, los m√≥dulos que no reciben alimentaci√≥n suficiente estar√°n marcados en rojo.

Consulte tambi√©n
Equilibrado de potencia (P√°gina 1247)

1248

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Uso del √°rea de datos remanente ampliada con PS 60W 24/48/60VDC HF
Si se utiliza la alimentaci√≥n del sistema PS 60W 24/48/60VDC HF, se ofrece la posibilidad de
utilizar el √°rea de datos remanente ampliada para una CPU S7-1500.
La alimentaci√≥n del sistema PS 60W 24/48/60VDC HF debe emplearse para procesos que
requieran una gran cantidad de datos remanentes para seguir funcionando sin problemas tras
un fallo de red.
Los valores de la remanencia ampliada dependen de la CPU utilizada. Encontrar√° los valores
en los datos t√©cnicos de los manuales de producto de las CPU y en las correspondientes
informaciones del producto.
Enlace a la informaci√≥n del producto:
https://support.industry.siemens.com/cs/ww/es/view/68052815 (https://
support.industry.siemens.com/cs/ww/it/view/68052815)

Requisitos
Requisitos para el uso de la alimentaci√≥n del sistema PS 60W 24/48/60VDC HF para utilizar
el √°rea de datos remanente ampliada:
‚óè CPU S7-1500 con versi√≥n de firmware V2.1 o superior
‚óè Versi√≥n de HW compatible de la CPU S7-1500
En las siguientes CPU no es posible utilizar el √°rea de datos remanente ampliada hasta la
versi√≥n HW FS03 o superior:
‚Äì CPU 1517-3 PN/DP, CPU 1517F-3 PN/DP
‚Äì CPU 1518-4 PN/DP, CPU 1518F-4 PN/DP
En la siguiente CPU no es posible utilizar el √°rea de datos remanente ampliada hasta la
versi√≥n HW FS02 o superior :
‚Äì CPU 1518F-4 PN/DP ODK
Las CPU citadas no permiten cargar el programa de usuario (software) cuando se utiliza el
√°rea de datos remanente ampliada.
Soluci√≥n: Utilice una CPU de la versi√≥n HW adecuada.
‚óè STEP 7 a partir de V14 Service Pack 1

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1249

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas para configurar un S7-1500 con PS 60W 24/48/60VDC HF
‚óè La fuente de alimentaci√≥n del sistema PS 60W 24/48/60VDC HF solo puede enchufarse a
la izquierda de la CPU (slot 0).
En una configuraci√≥n descentralizada de un ET 200MP, esta alimentaci√≥n del sistema solo
puede enchufarse a la izquierda del m√≥dulo de interfaz. Cuando se usa de forma
descentralizada, la alimentaci√≥n no ampl√≠a el √°rea de datos remanente de la CPU.
Cuando se colocan los m√≥dulos, STEP 7 resalta los slots admisibles con un marco azul
para impedir que se cometan errores de configuraci√≥n.
La figura muestra, a la izquierda del slot 0, el slot 100 para una fuente de alimentaci√≥n de
carga (PM). Este slot solo se ve cuando la CPU enchufada tiene una versi√≥n de firmware
2.1 o superior.

‚óè A la derecha de la CPU o a la derecha de un m√≥dulo de interfaz (ET 200MP) no puede
enchufarse ninguna alimentaci√≥n del sistema PS 60W 24/48/60VDC HF. Si se necesitan
m√°s fuentes de alimentaci√≥n del sistema para aumentar la potencia del bus de fondo, utilice
una fuente de alimentaci√≥n del sistema est√°ndar a partir del slot 2.

1250

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Si se utiliza una PS 60W 24/48/60VDC HF, la alimentaci√≥n de 24V de la CPU no se incluir√°
en el balance de suministro y consumo. Por este motivo, la tensi√≥n de alimentaci√≥n de
24 V DC no deber√≠a conectarse a la CPU. Por este motivo, el par√°metro de CPU "Fuente
de alimentaci√≥n del sistema" debe estar ajustado a la opci√≥n "Sin conexi√≥n a tensi√≥n de
alimentaci√≥n L+".

‚óè El par√°metro "Comparaci√≥n de m√≥dulos te√≥rico y real" debe estar puesto al valor "Arranque
de la CPU solo con compatibilidad".
Motivo: la remanencia de toda la memoria de trabajo (datos) de la CPU solo queda
garantizada si se ha enchufado una PS 60W 24/48/60VDC HF.
Cuando se enchufa la PS 60W 24/48/60VDC HF, STEP 7 ajusta autom√°ticamente este
valor para el slot.

STEP 7 comprueba las reglas citadas anteriormente al compilar y cargar el programa de
usuario en la CPU.

Sustituci√≥n
La fuente de alimentaci√≥n del sistema PS 60W 24/48/60VDC HF puede emplearse como
repuesto de una PS 60W 24/48/60VDC (PS est√°ndar) configurada en el slot 0. En este caso
no se aprovecha el √°rea de datos remanente ampliada.
En cambio, una PS est√°ndar no puede emplearse como repuesto de una PS 60W
24/48/60VDC HF configurada.

Ausencia de diagn√≥sticos de la fuente de alimentaci√≥n del sistema PS 60W 24/48/60VDC HF
En caso de desconexi√≥n (POWER OFF), lo m√°s importante es guardar los datos remanentes
ampliados. En este caso, la CPU con FW V2.1 y superior ya no emite los siguientes
diagn√≥sticos de la PS 60W 24/48/60VDC HF:
‚óè Fallo de alimentaci√≥n el√©ctrica
‚óè Posici√≥n de interruptor Off

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1251

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
√Åreas de memoria remanentes (P√°gina 1002)
Reglas para los slots en m√≥dulos S7-1500 (P√°gina 1244)

1.4.1.9

Seleccionar m√≥dulos centrales

Introducci√≥n
En la vista de redes se selecciona una CPU del cat√°logo de hardware y se crea junto con un
rack. Los m√≥dulos deseados se arrastran del cat√°logo de hardware al dispositivo y se ordenan
autom√°ticamente en el rack.

Selecci√≥n de los componentes en el cat√°logo de hardware
En el cat√°logo de hardware, todos los componentes se visualizan en forma de carpeta. Al abrir
dicha carpeta, aparecen las diferentes versiones de los componentes de hardware
seleccionados junto con sus respectivas referencias.
Aqu√≠ se muestra a modo de ejemplo c√≥mo crear una CPU con un rack en la vista de redes.

Requisitos
‚óè El cat√°logo de hardware est√° abierto.
‚óè Se encuentra en la vista de redes.

Procedimiento
Para seleccionar una CPU del cat√°logo de hardware, proceda del siguiente modo:
1. En el cat√°logo de hardware, navegue hasta la carpeta que contiene las CPUs deseadas.
2. Abra la carpeta con el tipo de CPU que busca. Aparecer√°n todas las referencias del tipo de
CPU seleccionado.

1252

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Haga clic en la referencia de una CPU para obtener informaci√≥n acerca de la CPU
seleccionada en la paleta "Informaci√≥n".

4. En la lista desplegable "Versi√≥n" ajuste la versi√≥n de firmware adecuada en su CPU.
5. Cree la CPU y un rack. Para ello existen las posibilidades siguientes:
‚Äì Arrastre la CPU desde el cat√°logo de hardware hasta la vista de redes con la funci√≥n
Drag & Drop.
‚Äì Haga doble clic en la entrada de la CPU del cat√°logo de hardware.

Consulte tambi√©n
Agregar un dispositivo a la configuraci√≥n de hardware (P√°gina 41)
Rack: Enchufar m√≥dulo (P√°gina 49)
Rack: Principios b√°sicos (P√°gina 47)
Examinar el cat√°logo de hardware (P√°gina 32)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1253

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.10

Seleccionar m√≥dulos de seguridad

Introducci√≥n
Los sistemas de automatizaci√≥n de seguridad (sistemas F) sirven para controlar procesos con
un estado seguro que se alcanza inmediatamente por desconexi√≥n. Los sistemas F controlan
procesos cuya desconexi√≥n inmediata no supone ning√∫n peligro ni para las personas ni para
el medio ambiente.

Selecci√≥n de los componentes F en el cat√°logo de hardware
En el cat√°logo de hardware, todos los componentes se visualizan en forma de carpetas. Los
componentes de hardware de seguridad se muestran con s√≠mbolos amarillos en el cat√°logo de
hardware, al contrario que los componentes que no son de seguridad, que se muestran en
color azul.
La figura siguiente muestra extractos del cat√°logo de hardware con dos CPUs y dos m√≥dulos
de salidas digitales, unos en versi√≥n normal (azules) y otros en versi√≥n F (amarillos):

El color ayuda a identificar f√°cil y r√°pidamente los componentes F dentro del cat√°logo de
hardware.

Visualizaci√≥n de los componentes F en el editor de hardware y redes
Si se utilizan dispositivos de seguridad y dispositivos "normales" en las vistas gr√°ficas del
editor de hardware y redes, es posible reconocer f√°cilmente los primeros por su identificaci√≥n
amarilla.
La figura siguiente muestra dos CPUs. La CPU F est√° marcada en amarillo:

En la vista de dispositivos tambi√©n es posible distinguir los m√≥dulos de seguridad en racks o
dispositivos gracias a su identificaci√≥n amarilla. Puesto que los m√≥dulos no aptos para redes
no aparecen en la vista de redes ni en la vista topol√≥gica, los dispositivos con componentes F
no aptos para redes se muestran con un s√≠mbolo especial en la vista de redes y en la vista
topol√≥gica.

1254

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La figura siguiente muestra una CPU "normal" y una CPU F en la vista de redes, y ambas
disponen de componentes F:

La identificaci√≥n crom√°tica de los dispositivos y m√≥dulos de seguridad permite identificar
r√°pidamente los componentes F incluso en las vistas gr√°ficas del editor de hardware y redes.

1.4.1.11

Modificar las propiedades de los m√≥dulos centrales
Cada componente de hardware (m√≥dulo, interfaz o m√≥dulo de interfaz) tiene una serie de
propiedades predeterminadas; p. ej., los m√≥dulos de entradas anal√≥gicas tienen tipos y √°reas
de medici√≥n predeterminados.

Propiedades de los m√≥dulos centrales
Para el comportamiento del sistema son muy importantes las propiedades de las CPUs. Una
CPU permite ajustar, p. ej.:
‚óè Comportamiento de arranque
‚óè √Åreas de datos locales
‚óè Prioridades de alarma
‚óè √Åreas de memoria
‚óè Comportamiento remanente
‚óè Marcas de ciclo
‚óè Nivel de protecci√≥n
‚óè Contrase√±a
Las posibilidades de entrada indican qu√© puede ajustarse y con qu√© rangos de valores. Los
campos no editables est√°n atenuados o no aparecen en la ventana de propiedades.
En las propiedades de una interfaz puede, p. ej., parametrizarse una interfaz MPI integrada o
una interfaz PROFIBUS DP y conectarla con una subred existente.

Requisitos
Los componentes de hardware cuyas propiedades deben modificarse se han dispuesto en un
rack.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1255

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento
Para modificar las propiedades y los par√°metros de los componentes de hardware, proceda
del siguiente modo:
1. En la vista de dispositivos o de redes seleccione el componente de hardware que desee
editar.
Tambi√©n podr√° seleccionar piezas individuales de un componente hardware, como p. ej.:
‚Äì Interfaz
‚Äì Entrada
‚Äì Salida
2. Edite los ajustes del objeto seleccionado:
‚Äì En la vista general de dispositivos se editan las direcciones y los nombres.
‚Äì En la ventana de inspecci√≥n existen otras posibilidades de ajuste adicionales.
No es necesario confirmar las entradas, los valores modificados se aplican inmediatamente.

Otras posibilidades de parametrizaci√≥n
Para los sistemas de automatizaci√≥n del S7-300/400 tiene adem√°s la posibilidad de, p. ej.,
ajustar par√°metros en el programa del usuario en m√≥dulos anal√≥gicos. Para este objetivo
acceda, en el programa del usuario, a las funciones de sistema WR_PARM (SFC 55),
DR_DPARM (SFC 56) y PARM_MOD (SFC 57). Sin embargo, estos ajustes se perder√≠an en
un arranque o reinicio (en caliente).

Informaci√≥n adicional
Para m√°s informaci√≥n sobre las funciones est√°ndar y de sistema del S7-300/400 tenga en
cuenta el manual de referencia de software de sistema del S7-300/400.

Consulte tambi√©n
Editar las propiedades y los par√°metros (P√°gina 63)

1.4.1.12

Acoplamiento de racks

Introducci√≥n
Dependiendo del dispositivo utilizado, en algunas CPUs S7-300 existe la posibilidad de
acoplar racks a trav√©s de m√≥dulos de interfaz.

1256

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Acoplamiento de racks
Para acoplar un rack a trav√©s de m√≥dulos de interfaz deber√° arrastrarse otro rack desde el
cat√°logo de hardware, en la vista de dispositivos. A continuaci√≥n se insertar√° un m√≥dulo
emisor en el rack central y un m√≥dulo receptor en el rack nuevo. Autom√°ticamente se
arrastrar√° un acoplamiento entre el m√≥dulo emisor y el receptor.

En el S7-300 pueden acoplarse hasta cuatro racks. Los m√≥dulos de interfaz deben insertarse
siempre en el slot 3.
Nota
Si su configuraci√≥n no dispone de ampliaciones el slot 3 se marcar√° siempre como vac√≠o,
incluso aunque en la realidad est√© directamente conectado el m√≥dulo del slot 4 a la CPU, no
habiendo as√≠ ning√∫n hueco.
Utilice los siguientes m√≥dulos de interfaz:
‚óè Para la ampliaci√≥n de un √∫nico rack:
Rack 0 y 1: IM 365
‚óè Para la ampliaci√≥n de hasta 3 racks:
Rack 0: IM 360
Racks 1 a 3: IM 361
Si prefiere un acoplamiento manual, borre en primer lugar la l√≠nea de uni√≥n que representa el
acoplamiento. A continuaci√≥n, manteniendo pulsado el bot√≥n del rat√≥n, arrastre una nueva
l√≠nea de uni√≥n entre las interfaces del m√≥dulo emisor y el receptor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1257

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Rack ampliable
Dependiendo del dispositivo utilizado, en algunas CPU (p. ej., IM 151-1) existen racks
ampliables cuyos grupos de slots podr√° abrir a trav√©s del s√≠mbolo de flecha situado encima del
slot ampliable. Si est√°n cerrados, se muestran el primer y √∫ltimo n√∫mero de slot del grupo.
La siguiente imagen muestra un sector de un rack ampliable:

No es posible cerrar los grupos de slots con m√≥dulos ya insertados. Por este motivo tampoco
puede cerrarse el primer grupo de slots con el dispositivo. Cuando esto sucede podr√°
detectarlo por el tono gris que adquiere el s√≠mbolo de flecha.

Consulte tambi√©n
Rack: Principios b√°sicos (P√°gina 47)

1.4.1.13

Acoplamiento de racks

Ampliar un rack central con racks de ampliaci√≥n
Configuraci√≥n de racks de ampliaci√≥n en el SIMATIC 400
En el SIMATIC 400 se dispone de posibilidades de ampliaci√≥n m√°s complejas gracias a los
diversos racks y m√≥dulos de interfaz.
Todos los racks de ampliaci√≥n que est√°n conectados a una interfaz del IM emisor del rack
central forman una l√≠nea.
La figura siguiente muestra tres racks de ampliaci√≥n conectados a una interfaz del IM
transmisor, respectivamente.

1258

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas para acoplar racks de ampliaci√≥n
Acoplar racks de ampliaci√≥n
En caso de acoplar racks de ampliaci√≥n (SIMATIC 400) a una interfaz del m√≥dulo de interfaz
(IM emisor) del rack central, las propiedades siguientes deben coincidir tanto en el IM emisor
como en el receptor:
‚óè transferencia de intensidad (con/sin)
‚óè tipo de acoplamiento (centralizado/descentralizado)
‚óè transmisi√≥n del bus K (con/sin transmisi√≥n de alarmas)

Reglas para slots del S7-400 para racks de ampliaci√≥n
Adem√°s de a las reglas generales para slots, el S7-400 est√° sujeto a las siguientes reglas
adicionales para m√≥dulos en racks de ampliaci√≥n:
‚óè Insertar los m√≥dulos de alimentaci√≥n en el slot 1
‚óè Insertar el m√≥dulo de interfaz (IM de recepci√≥n) en el slot externo derecho (slot 9 o slot 18)
‚óè Insertar los m√≥dulos de bus K √∫nicamente en un rack de ampliaci√≥n cuyo n√∫mero no sea
superior a 6 (de lo contrario no es posible acceder a √©l)

Disposici√≥n del rack de ampliaci√≥n
Procedimiento general
Para disponer los racks de ampliaci√≥n y realizar conexiones entre los m√≥dulos de interfaz de
los racks, proceda del siguiente modo:
1. Seleccione un rack de CPU (p. ej., CPU 417) del "Cat√°logo de hardware".
2. Utilizando la funci√≥n Drag&Drop, arrastre el controlador hasta la vista de dispositivos.
3. Asigne m√≥dulos al rack del controlador (p. ej., fuente de alimentaci√≥n e IM 460).
4. Seleccione racks de ampliaci√≥n adecuados (p. ej., ER1) del "Cat√°logo de hardware".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1259

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Utilizando la funci√≥n Drag&Drop, arrastre sucesivamente los racks de ampliaci√≥n hasta la
vista de dispositivos.
6. Asigne m√≥dulos a cada rack (p. ej., fuente de alimentaci√≥n o IM 461).
Importante: los m√≥dulos de interfaz deben estar enchufados en todos los racks para poder
acoplar los racks entre s√≠.
7. Conecte la interfaz del IM emisor con la del IM receptor del rack deseado.
Seguidamente, la asignaci√≥n entre los racks se muestra con l√≠neas de conexi√≥n.
La figura siguiente muestra la conexi√≥n por parejas de los racks de ampliaci√≥n a una interfaz
del IM transmisor a trav√©s de un IM receptor.

1260

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.14

Direccionar m√≥dulos

Direccionamiento de m√≥dulos
Introducci√≥n
En las columnas Direcci√≥n I y Direcci√≥n Q de la vista general de dispositivos se ven las
direcciones o √°reas de direcciones de los m√≥dulos.
Las direcciones de entrada y salida se asignan autom√°ticamente al insertar m√≥dulos en el
rack. La direcci√≥n del primer canal representa la direcci√≥n inicial de un m√≥dulo. Las direcciones
de los dem√°s canales se derivan de dicha direcci√≥n inicial. La direcci√≥n final se deriva de la
longitud de direcci√≥n espec√≠fica del m√≥dulo.

Particularidad: Direcciones de entrada con asterisco (*)
En la vista de dispositivos se marcan con un (*) determinadas direcciones del √°rea de la
direcci√≥n de entrada. En este caso se trata de direcciones de diagn√≥stico, p. ej., de m√≥dulos
de interfaz que no direccionan ning√∫n dato de usuario, sino que son necesarios para el
diagn√≥stico del sistema.

Diferenciaci√≥n entre direcciones de nodos y direcciones de periferia
En la asignaci√≥n de direcciones se diferencia entre las direcciones de nodos y de periferia
(direcciones de entrada y salida):
‚óè Las direcciones de nodos son direcciones de m√≥dulos programables (direcciones MPI,
PROFIBUS e Industrial Ethernet). Se requieren para direccionar los distintos dispositivos
de una subred, p. ej. para cargar un programa de usuario en una CPU.
‚óè Las direcciones de periferia se necesitan para leer entradas y activar salidas en el
programa de usuario.

Particularidad: Direcciones MPI de FM y CP (S7-300)
Los CPs y FMs con direcci√≥n MPI propia, esta viene predeterminada por STEP 7.
Las direcciones MPI se pueden modificar (en la ventana de inspecci√≥n, a trav√©s de
"Propiedades > Interfaz MPI").
En el caso de los CPs y FMs sin direcci√≥n MPI, la CPU direcciona estos m√≥dulos a trav√©s del
bus K mediante el n√∫mero de rack y el n√∫mero de slot.

Consulte tambi√©n
Definir las direcciones de entrada y salida (P√°gina 1262)
Asignar direcciones a una ubicaci√≥n del programa (P√°gina 1276)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1261

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Direccionamiento de m√≥dulos
Introducci√≥n
En las columnas Direcci√≥n I y Direcci√≥n Q de la vista general de dispositivos se ven las
direcciones o √°reas de direcciones de los m√≥dulos. Al lado hay otras direcciones que se
explican a continuaci√≥n.

Direcci√≥n E/S (direcci√≥n de periferia)
Las direcciones E/S (de entrada y salida) se necesitan para leer entradas y activar salidas en
el programa de usuario.
Las direcciones de entrada y salida se asignan autom√°ticamente al insertar m√≥dulos en el
rack. La direcci√≥n del primer canal representa la direcci√≥n inicial de un m√≥dulo. Las direcciones
de los dem√°s canales se derivan de dicha direcci√≥n inicial. La direcci√≥n inicial se deriva de la
longitud de direcci√≥n espec√≠fica del m√≥dulo.

Direcci√≥n de dispositivo (p. ej. direcci√≥n Ethernet)
Las direcciones de dispositivos son direcciones de m√≥dulos programables (direcciones
Industrial Ethernet). Se requieren para direccionar los distintos dispositivos de una subred, p.
ej. para cargar un programa de usuario en una CPU.

ID de hardware para la identificaci√≥n de m√≥dulos y subm√≥dulos
Adem√°s de las direcciones E y S, se asigna autom√°ticamente un identificador de hardware (ID
HW) que se utiliza para direccionar e identificar el m√≥dulo. Tambi√©n los subm√≥dulos (unidades
de un m√≥dulo), como un contador integrado, obtienen una ID HW. La ID HW consiste en un
n√∫mero entero y es emitida por el sistema junto con avisos de diagn√≥stico con el fin de localizar
el m√≥dulo o subm√≥dulo defectuoso. La ID HW se utiliza tambi√©n para una serie de
instrucciones para direccionar el m√≥dulo correspondiente. No es posible modificar la ID HW.

Consulte tambi√©n
Informaci√≥n importante sobre identificadores de hardware (P√°gina 1264)
Ventana de inspecci√≥n (P√°gina 24)

Definir las direcciones de entrada y salida
Las direcciones de entrada y salida est√°n predeterminadas de forma autom√°tica, aunque
posteriormente podr√° modificar dicho direccionamiento.

1262

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos
‚óè Se encuentra en la vista de dispositivos.
‚óè El m√≥dulo es un esclavo DP compacto o est√° enchufado en alguno de los objetos
siguientes:
‚Äì Rack central
‚Äì Rack de ampliaci√≥n
‚Äì Esclavo DP
‚óè La CPU permite la asignaci√≥n libre de direcciones.

Procedimiento
Para modificar el √°rea de direcciones predeterminada, proceda del siguiente modo:
1. En la vista de dispositivos, haga clic en el m√≥dulo cuya direcci√≥n inicial desea ajustar.
2. Haga clic en "Direcciones E/S", dentro de "Propiedades", en la ventana de inspecci√≥n.
3. Introduzca la direcci√≥n inicial deseada en "Direcci√≥n inicial".
4. Pulse <Intro> o haga clic en cualquier otro objeto para aplicar el valor modificado.
Si ha introducido una direcci√≥n no v√°lida aparecer√° un aviso en el que podr√° bien aceptar la
direcci√≥n propuesta o bien introducir una.
Nota
Tambi√©n existe la posibilidad de modificar las direcciones directamente en la vista de
dispositivos. Cuando no es posible realizar una norma de direccionamiento por parte de la
CPU, las direcciones se representar√°n en color gris.
En los m√≥dulos dentro de un segmento de bus local formados por un FM (S7-300) o FM
especiales (S7-400), asigne adem√°s otra direcci√≥n inicial. Adem√°s de la direcci√≥n inicial para
la CPU, el m√≥dulo tiene tambi√©n una direcci√≥n inicial para el FM. En este caso, en la vista de
dispositivos siempre se muestra la direcci√≥n inicial desde el punto de vista del FM.

Consulte tambi√©n
Editar las propiedades y los par√°metros (P√°gina 63)

Informaci√≥n importante sobre las direcciones de diagn√≥stico
Introducci√≥n
Las direcciones de diagn√≥stico sirven para direccionar componentes que no tienen datos de
usuario propios, como m√≥dulos de interfaz o puertos.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1263

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Direcciones de entrada como direcciones de diagn√≥stico
Para direccionar componentes que no tienen datos de usuario propios deben utilizarse
direcciones de diagn√≥stico. Durante la configuraci√≥n, STEP 7 asigna autom√°ticamente a los
componentes una direcci√≥n de entrada "desde arriba", es decir, empezando por la direcci√≥n E
m√°s alta y bajando. Esta direcci√≥n E se denomina direcci√≥n de diagn√≥stico.
La direcci√≥n de entrada no sirve para leer valores de entrada (valores de proceso). La direcci√≥n
de diagn√≥stico sirve, por ejemplo, para direccionar componentes en las instrucciones
"DPNRM_DG" o "RDREC"

Ejemplos
Para leer el juego de datos de diagn√≥stico de un esclavo DP, con la instrucci√≥n "DPNRM_DG"
(par√°metro "LADDR") debe utilizarse la direcci√≥n de diagn√≥stico del m√≥dulo de interfaz de
dicho esclavo DP.
Para leer el juego de datos que contiene las relaciones de vecindad de un puerto, con la
instrucci√≥n "RDREC" debe utilizarse la direcci√≥n de diagn√≥stico de dicho puerto (par√°metro
"ID").

Direccionamiento de los m√≥dulos de entrada y salida
Para direccionar un m√≥dulo de entrada, con las instrucciones "RDREC" o "WRREC" debe
utilizarse la direcci√≥n inicial. Si un m√≥dulo de entrada tiene asignadas las direcciones 5 y 6, la
5 es la direcci√≥n inicial. Ponga el par√°metro "ID" al valor "DW#16#0005".
Para direccionar un m√≥dulo de salida, con las instrucciones "RDREC" o "WRREC" tambi√©n
debe utilizarse la direcci√≥n inicial. Ponga el par√°metro "ID" al valor "DW#16#8005" para la
direcci√≥n inicial 5. En un m√≥dulo de salida tiene que activarse el bit 15 (valor "1"). Por este
motivo, en la direcci√≥n inicial 5 resulta el valor de DW#16#8005 para el par√°metro "ID".
Para direccionar un m√≥dulo mixto (m√≥dulo de entradas y salidas), en el par√°metro "ID" debe
introducirse la menor de las dos direcciones iniciales. Si las √°reas de entradas y salidas tienen
la misma direcci√≥n inicial debe utilizarse el identificador de una direcci√≥n de entrada (bit 15 de
la direcci√≥n no activado, "0").

Consulte tambi√©n
Leer datos topol√≥gicos de un sistema PROFINET (http://
support.automation.siemens.com/WW/view/es/38566021)

Informaci√≥n importante sobre identificadores de hardware
Introducci√≥n
Todos los objetos de hardware, p. ej., un m√≥dulo, una interfaz, un puerto de un m√≥dulo o √°reas
de transferencia de I-devices, tienen un identificador de hardware asignado autom√°ticamente
por STEP 7 al configurar un componente de hardware.
En S7-1500 y S7-1200, estos identificadores de hardware tienen la misma funci√≥n que las
direcciones de diagn√≥stico de componentes hardware sin datos de usuario, o que las

1264

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
direcciones iniciales de objetos hardware con datos de usuario (en S7-300/400). En caso de
modificar direcciones E/S, sus identificadores de hardware se mantienen igual. En caso de
modificaci√≥n de las direcciones E/S, no hay que adaptar las instrucciones que direccionan a
trav√©s de un identificador de hardware.

Identificadores de hardware en la ficha "Constantes de sistema" de la ventana de inspecci√≥n
Si se selecciona un objeto de hardware en la vista de dispositivos y se elige la ficha
"Constantes de sistema" en la ventana de inspecci√≥n, se muestran todos los identificadores de
hardware del objeto como constantes del sistema, con nombre y tipo.
Los nombres de los identificadores de hardware tienen estructura jer√°rquica. Constan de un
m√°ximo de cuatro niveles jer√°rquicos, cada uno de ellos separado por un signo "‚àº". De esta
forma, mediante el nombre es posible reconocer la "ruta" del m√≥dulo de hardware implicado.
La indicaci√≥n de identificadores de hardware depende del objeto que se haya seleccionado en
la vista gr√°fica. Si se selecciona un dispositivo completo en la vista de redes o dispositivos, en
las constantes de sistema se muestran todos los identificadores hardware de todos los objetos
del dispositivo correspondiente (m√≥dulos, interfaces, puertos, etc.). Si solo se selecciona un
m√≥dulo o un puerto concretos, en las constantes de sistema se muestra solo el identificador
hardware del objeto seleccionado.

Ejemplo
La constante de sistema de nombre "Local~DI_16x24VDC_HF_1" designa el identificador de
hardware del m√≥dulo de entradas digitales de nombre "DI_16x24VDC_HF_1" en la CPU local
("Local"). El nombre del m√≥dulo digital coincide con el nombre editable en las propiedades del
componente (ventana de inspecci√≥n). Si se selecciona √∫nicamente ese modulo, se mostrar√°
solo el identificador hardware de dicho m√≥dulo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1265

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Para facilitar la identificaci√≥n de objetos de hardware, al configurar el hardware as√≠gneles
nombres que resulten "explicativos". Es conveniente que los nombres hagan patente la parte
de instalaci√≥n o la estaci√≥n a la que pertenece el objeto.

Identificadores de hardware en las constantes de sistema de la tabla de variables PLC
STEP 7 rellena entradas en las variables PLC (ficha "Constantes de sistema") para cada
componente de hardware configurado. Dichas entradas son de solo lectura. Junto con el
n√∫mero entero se indica un nombre y un tipo de datos de hardware.
Ejemplo:

Identificadores de hardware al programar
Si en una instrucci√≥n se direcciona un componente de hardware, p. ej. con el par√°metro de
entrada "ID" o "LADDR", al hacer doble clic en este par√°metro de entrada se muestra una lista
de todos los componentes de hardware seleccionables.
En la informaci√≥n de arranque sobre, por ejemplo, los OB de alarma de proceso, podr√°
identificar el m√≥dulo que dispara alarmas por su identificador de hardware.

Informaci√≥n adicional
Puede consultar informaci√≥n para convertir informaci√≥n de direcciones (direcciones E/S, slot,
identificador de hardware) aqu√≠.

1266

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
OBs de alarma de proceso (P√°gina 1108)
Ejemplo de un evento de alarma de proceso (P√°gina 1019)
Ejemplos de uso de identificadores de hardware (P√°gina 1267)
Ventana de inspecci√≥n (P√°gina 24)

Ejemplos de uso de identificadores de hardware
Los identificadores de hardware se utilizan para direccionar objetos de hardware como, p. ej.,
m√≥dulos, subm√≥dulos o dispositivos. Dependiendo de la instrucci√≥n, los identificadores de
hardware tienen diferentes tipos de datos de hardware. El tipo de datos de hardware admisible
aparece, para todos los componentes configurados, en la tabla de variables est√°ndar, ficha
"Constantes de sistema".
A continuaci√≥n se explican los identificadores de hardware que deben utilizarse para algunas
instrucciones seleccionadas.
Nota
Informaci√≥n sobre el respectivo identificador de hardware
Para toda instrucci√≥n avanzada que direccione objetos de hardware, el objeto de hardware
que debe utilizarse se indica en la ayuda. La ayuda correspondiente a la instrucci√≥n
seleccionada se abre mediante la tecla <F1>.

Recomendaci√≥n
En el editor de programas se puede introducir el nombre del objeto de hardware o el
identificador num√©rico de hardware de dicho objeto.
Recomendaci√≥n: Asigne nombres explicativos a los objetos de hardware, p. ej. a los m√≥dulos.
Consulte el nombre y el identificador de hardware en la ficha "Constantes de sistema" de la
vista de dispositivos e introd√∫zcalos en el editor de programaci√≥n utilizando la instrucci√≥n
correspondiente. Una vez haya asignado un nombre explicativo, lo encontrar√° f√°cilmente en la
lista desplegable para seleccionar el identificador de hardware en el par√°metro de bloque "ID".

Otro modo de introducir el identificador de hardware
Si lo desea, puede arrastrar el identificador de hardware mediante Drag & Drop desde la tabla
de variables al par√°metro de bloque "ID".
Ventaja: el tipo de datos hardware es comprobado por el editor de programas y, dado el caso,
rechazado, si se ha seleccionado un objeto de hardware no admitido.
En caso de introducci√≥n num√©rica no se puede comprobar.
Si, p. ej., el objeto de hardware admisible es un dispositivo IO, marque en la vista de redes el
dispositivo IO completo y lea el identificador de hardware en "Propiedades" (ficha "General"),
en la ventana de inspecci√≥n. Si en este caso no se selecciona el dispositivo IO, sino el m√≥dulo
de interfaz del dispositivo IO, el identificador de hardware visible en la ventana de inspecci√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1267

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
no ser√≠a admisible para esta instrucci√≥n. En caso de introducirse num√©ricamente el
identificador de hardware durante la programaci√≥n, este error pasa desapercibido.

Ejemplo de introducci√≥n de un identificador de hardware
En la tabla de variables est√°ndar, ficha "Constantes de sistema", figura p. ej. el siguiente
nombre de m√≥dulo:
myModule[AI]
1. Abra el editor de programaci√≥n
2. Abra la tabla de variables est√°ndar (carpeta "Variables PLC".)
3. Coloque las ventanas del editor de programaci√≥n y de la tabla de variables est√°ndar una
junto a otra.
Para ello, haga clic en el bot√≥n "Dividir √°rea del editor verticalmente" de la barra de
herramientas.

4. Arrastre "myModule[AI]" desde la ficha "Constantes de sistema" hasta el campo "ID" o
"LADDR" de la instrucci√≥n en cuesti√≥n como se muestra en la figura inferior.

Ejemplos de direccionamiento con identificador de hardware
Instrucci√≥n avanzada D_ACT_DP: Desactivar/activar esclavo DP o dispositivo PROFINET IO.
El tipo de dato de hardware es Hw_DpSlave o Hw_Device. Los objetos de hardware admisibles
para el par√°metro de entrada "LADDR" son esclavos DP o dispositivos IO.

1268

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Instrucci√≥n avanzada DPSYC_FR: Sincronizar/congelar esclavos DP.
El tipo de dato de hardware es Hw_Interface. El objeto de hardware admisible para el
par√°metro de entrada "LADDR" es la interfaz de maestro DP.

Instrucci√≥n avanzada RDREC: Leer registro.
El tipo de dato de hardware es Hw_SubModule. Los objetos de hardware admisibles para el
par√°metro de entrada "ID" son m√≥dulos o subm√≥dulos cuyo juego de datos debe leerse.
Este tipo de datos hardware se utilizar√° tambi√©n con la instrucci√≥n avanzada DPRD_DAT.

Instrucci√≥n avanzada WRREC: escribir registro. La instrucci√≥n se utiliza, p. ej., para escribir
juegos de datos en un m√≥dulo o subm√≥dulo.
El tipo de dato de hardware es tambi√©n Hw_SubModule. Los objetos de hardware admisibles
para el par√°metro de entrada "ID" son m√≥dulos o subm√≥dulos a los que debe transferirse el
juego de datos.
Este tipo de datos hardware se utiliza tambi√©n con la instrucci√≥n avanzada DPWR_DAT.
Notas:
‚óè En caso de que un m√≥dulo de periferia est√© dividido en varios subm√≥dulos (p. ej. 1 x 8 AI
=> 8 x 1AI), debe utilizarse el identificador de hardware de un subm√≥dulo. En este caso no
debe emplearse el identificador de hardware del m√≥dulo.
‚óè En los m√≥dulos de interfaz de una unidad de periferia descentralizada a los que debe
transferirse un juego de datos para el control de configuraci√≥n (configuraci√≥n futura), debe
utilizarse el identificador de hardware del m√≥dulo de cabecera [Head]; v√©ase la figura.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1269

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Instrucci√≥n avanzada Station_Info: leer informaci√≥n de un dispositivo IO.
El tipo de dato de hardware es Hw_Device. El objeto de hardware admisible para el par√°metro
de entrada "ID" es un dispositivo IO.

Informaci√≥n adicional
Puede consultar m√°s informaci√≥n para convertir informaci√≥n de direcciones (direcciones E/S,
slot, identificador de hardware) aqu√≠.

Consulte tambi√©n
Informaci√≥n importante sobre identificadores de hardware (P√°gina 1264)

Direcciones de entrada y salida en la vista de direcciones
Introducci√≥n
En la vista de direcciones podr√°n mostrarse, en forma de tabla, las direcciones de entrada y
salida actualmente utilizadas. El sin√≥ptico de direcciones se encuentra en "Propiedades" de la
CPU, dentro de la ventana de inspecci√≥n.

1270

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la vista de direcciones
Podr√° ajustar qu√© objetos deber√°n mostrarse en la vista de direcciones a trav√©s de distintas
casillas opcionales:
‚óè Entradas: Visualizaci√≥n de direcciones de entrada
‚óè Salidas: Visualizaci√≥n de direcciones de salida
‚óè Huecos en las direcciones: Visualizaci√≥n de √°reas libres de direcci√≥n
‚óè Slot: Visualizaci√≥n del n√∫mero de slot
Normalmente, en la vista de direcciones se muestra la siguiente informaci√≥n:
Encabezado de la tabla

Significado

Tipo

Indica si el √°rea de direcciones es de entrada o salida.

Direc. de

Direcci√≥n inicial del √°rea de direcciones.

Direc. hasta

Direcci√≥n final del √°rea de direcciones.

M√≥dulo

M√≥dulo desde el que se utilizar√° el √°rea de direcciones.

IPP

N.¬∫ de la memoria imagen parcial de proceso Indica si el OB c√≠clico est√° en
la memoria imagen parcial de proceso.

OB

Bloque de organizaci√≥n asignado.

DP

N√∫mero de sistema maestro. De esta forma puede determinarse qu√© es‚Äê
clavos est√°n asignados a un maestro. El valor entre par√©ntesis indica la
direcci√≥n PROFIBUS del componente de hardware.

PN

N√∫mero del sistema IO. El valor entre par√©ntesis representa el n√∫mero de
dispositivo del componente de hardware.

Rack

N√∫mero del rack donde se encuentra insertado el componente hardware.

Slot

N√∫mero del slot donde se encuentra insertado el componente hardware en
el rack.

Asignar memoria imagen de proceso/memoria imagen parcial de proceso
Introducci√≥n
Si existen direcciones de entrada y de salida en una memoria imagen de proceso, en
S7-300/400 es posible que se encuentre en la memoria imagen de proceso OB1 (MIP OB1) o
en una memoria imagen parcial de proceso (IPP).
Una memoria imagen de proceso ofrece la ventaja de que durante el procesamiento c√≠clico del
programa puede accederse a una imagen coherente de las se√±ales de proceso. En
S7-300/400 se puede elegir entre "MIP OB1" y "IPP 1" hasta "IPP 15".
Toda direcci√≥n de entrada o salida asignada con STEP 7 a una memoria imagen parcial de
proceso desaparece de la memoria imagen de proceso OB1 de las entradas y salidas. Solo es
posible preseleccionar una vez las direcciones de entrada o salida a trav√©s de la memoria
imagen de proceso OB1 y de todas las memorias imagen parciales de proceso.
La memoria imagen parcial de proceso se define al asignar direcciones (qu√© direcciones de
entrada o salida de los m√≥dulos se llevan a cada memoria imagen parcial de proceso). La
memoria imagen parcial de proceso la actualiza el usuario con ayuda de instrucciones, o el
sistema autom√°ticamente mediante acoplamiento a un OB. Excepci√≥n: El sistema no actualiza

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1271

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
las memorias imagen parciales de proceso de los OB de alarma de sincronismo aunque est√©n
acopladas a un OB (OB 61 a OB 64).
Toda memoria imagen parcial de proceso puede actualizarse en el programa de usuario con
instrucciones especiales. Utilice "UPDAT_PI" (SFC 26) para la memoria imagen parcial de
proceso de entradas y "UPDAT_PO" (SFC 27) para la memoria imagen parcial de proceso de
salidas.
Parametrice el acoplamiento de una memoria imagen parcial de proceso a un OB en las
propiedades de la CPU (√°rea "Alarmas").
Nota
Esta opci√≥n s√≥lo puede activarse en m√≥dulos con entradas y salidas. Adem√°s, la CPU debe
ser compatible con memorias imagen parciales de proceso. El n√∫mero de las memorias
imagen parciales de proceso disponibles tambi√©n depende de la CPU.

Requisitos
‚óè Se encuentra en la vista de dispositivos.
‚óè El m√≥dulo es un esclavo DP compacto o est√° enchufado en alguno de los objetos
siguientes:
‚Äì rack central
‚Äì rack de ampliaci√≥n
‚Äì esclavo DP
‚óè La CPU permite la asignaci√≥n libre de direcciones.

Procedimiento
Para modificar el √°rea de la memoria imagen de proceso predeterminada, proceda del
siguiente modo:
1. En la vista de dispositivos seleccione el m√≥dulo cuya direcci√≥n inicial desea ajustar.
2. Haga clic en "Direcciones E/S", dentro de "Propiedades", en la ventana de inspecci√≥n.
3. En "Memoria imagen de proceso" seleccione la memoria imagen de proceso que desee.

1272

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Si en el campo "Memoria imagen de proceso" es visible la entrada "- - -" (no modificable),
significa que no hay ninguna memoria imagen de proceso disponible para el √°rea de
direcciones indicada.
‚óè En los m√≥dulos de entradas y salidas digitales seleccione una direcci√≥n inicial menor.
‚óè En caso de que deba direccionarse un m√≥dulo anal√≥gico a trav√©s de una memoria imagen
de proceso, seleccione tambi√©n una direcci√≥n inicial menor. La CPU deber√° soportar un
desplazamiento de la direcci√≥n inicial en el √°rea de direcciones para memorias imagen de
proceso.
‚óè Si la CPU tiene un tama√±o parametrizable de la memoria imagen de proceso, se puede
aumentar dicha memoria imagen (propiedades c√≠clicas de la CPU) para que la direcci√≥n
indicada vuelva a encontrarse en la memoria imagen de proceso. El par√°metro se llama
"Tama√±o de la memoria imagen de proceso ...".

Asignar memoria imagen de proceso/memoria imagen parcial de proceso
Introducci√≥n
Una memoria imagen de proceso ofrece la ventaja de que durante el procesamiento c√≠clico del
programa puede accederse a una imagen coherente de las se√±ales de proceso. En S7-1500
se puede elegir entre "Actualizaci√≥n autom√°tica" y "IPP 1" hasta "IPP 31".

Asignaci√≥n de direcciones al √°rea de memoria imagen de proceso de actualizaci√≥n autom√°tica
La memoria imagen de proceso se define al asignar direcciones (ventana de inspecci√≥n, √°rea
"Direcciones E/S"). Si las direcciones de un m√≥dulo deben estar en un √°rea de memoria
imagen de proceso que el sistema actualice autom√°ticamente en cada ciclo del programa, se
deber√° seleccionar el siguiente ajuste:

Comp√°rese: En los m√≥dulos S7-300/400, este ajuste se llama "imagen de proceso OB1".
Si las direcciones no deben estar en ning√∫n √°rea de memoria imagen de proceso, entonces
seleccione "Ninguna" como memoria imagen de proceso.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1273

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Asignar una direcci√≥n a una memoria imagen parcial de proceso
La memoria imagen parcial de proceso se define al asignar direcciones (ventana de
inspecci√≥n, √°rea "Direcciones I/Q"). La memoria imagen parcial de proceso la actualiza el
usuario con ayuda de instrucciones, o el sistema autom√°ticamente mediante acoplamiento a
un OB.

Acoplar la memoria imagen parcial de proceso a un OB
En la secci√≥n "Direcciones E/S" de un m√≥dulo tambi√©n se acopla la memoria imagen parcial de
proceso a un OB (par√°metro "Bloque de organizaci√≥n").
Para otros OB (p. ej. del tipo "Cyclic Interrupt", alarma c√≠clica) se asigna autom√°ticamente la
siguiente memoria imagen parcial de proceso que est√© libre, que puede ser modificada por el
usuario. Tras el arranque del OB, el sistema actualiza la memoria imagen parcial de proceso
asignada para las entradas. Al final del OB, el sistema escribe en las salidas de periferia las
salidas de la memoria imagen parcial de proceso asignada. Las memorias imagen parcial de
proceso est√°n excluidas de la actualizaci√≥n autom√°tica.
Ejemplo de acoplamiento de la memoria imagen parcial de proceso 2 (IPP 2) a una alarma
c√≠clica:

Excepci√≥n: El sistema no actualiza las memorias imagen parciales de proceso de los OB de
alarma de sincronismo aunque est√©n acopladas a un OB (OB 61 a OB 64).
La memoria imagen (parcial) de proceso asignada se muestra en las propiedades del OB
asignado (no modificable).

Actualizar una memoria imagen parcial de proceso en el programa de usuario
Toda memoria imagen parcial de proceso puede actualizarse en el programa de usuario con
instrucciones especiales. Utilice "UPDAT_PI" para la memoria imagen parcial de proceso de
las entradas y "UPDAT_PO" para la memoria imagen parcial de proceso de las salidas.

Requisitos
‚óè Se encuentra en la vista de dispositivos.
‚óè El m√≥dulo o el subm√≥dulo tiene direcciones I/Q.

1274

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento
Para modificar el √°rea de la memoria imagen de proceso predeterminada, proceda del
siguiente modo:
1. En la vista de dispositivos, seleccione el m√≥dulo cuya direcci√≥n inicial desee ajustar.
2. Haga clic en el √°rea "Direcciones E/S", dentro de "Propiedades", en la ventana de
inspecci√≥n.
3. En "Memoria imagen de proceso" seleccione la memoria imagen de proceso que desee.

Utilizaci√≥n de memorias imagen parcial de proceso en instrucciones
Introducci√≥n
Las instrucciones "UPDAT_PI", para actualizar entradas de la memoria imagen parcial de
proceso, y "UPDAT_PO", para visualizar sus salidas en salidas de periferia, utilizan el
par√°metro de entrada "PART" para introducir la memoria imagen parcial de proceso.
A continuaci√≥n se muestra la forma de definir una constante de usuario para una memoria
imagen parcial de proceso y c√≥mo utilizarla como entrada en el programa de usuario. Si se
utilizan diversas memorias imagen parciales de proceso para configurar la periferia, los
s√≠mbolos facilitan la programaci√≥n.

Requisitos
Se ha configurado la estructura de periferia, se han asignado direcciones y memorias imagen
parciales de proceso y se han creado los bloques necesarios.
Para este ejemplo se ha seleccionado el lenguaje de programaci√≥n KOP.

Procedimiento
Proceda del siguiente modo:
1. Abra la tabla de variables e introduzca constantes del tipo de datos "PIP" (Process image
part) en la ficha "Constantes de usuario". Asigne un nombre a cada memoria imagen parcial
de proceso utilizada, y si es necesario, tambi√©n un comentario.

2. Abra el editor de programas (p. ej. haciendo doble clic en un OB en el √°rbol del proyecto).
3. Arrastre la instrucci√≥n UPDAT_PI al segmento con Drag & Drop.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1275

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Haga doble clic en el par√°metro de entrada PART para abrir la selecci√≥n de variables.
En la selecci√≥n de variables solo pueden seleccionarse constantes de la memoria imagen
parcial de proceso.
5. Seleccione la memoria imagen parcial de proceso que desee.

Asignar direcciones a una ubicaci√≥n del programa
Es posible asignar direcciones desde los canales E/S de los m√≥dulos directamente a las
ubicaciones del programa o a una tabla de variables.

Requisitos
‚óè Est√° abierta la vista de dispositivos del editor de hardware y redes.
‚óè El factor de zoom en la vista de dispositivos debe ser del 200 % como m√≠nimo para que se
vean los diferentes canales E/S.
‚óè Est√°n abiertas la ventana de instrucciones del editor de programaci√≥n o una tabla de
variables.

Procedimiento
Para asignar canales E/S de m√≥dulos a las ubicaciones del programa o a una tabla de
variables, proceda del siguiente modo:
1. En la vista de dispositivos, navegue hasta el m√≥dulo que tenga el canal E/S deseado.
2. Manteniendo pulsado el bot√≥n del rat√≥n, arrastre la direcci√≥n E/S deseada hasta la
ubicaci√≥n correspondiente del bloque o hasta la tabla de variables.
La direcci√≥n del m√≥dulo se asignar√° a la ubicaci√≥n del programa, o se introducir√° como
variable en la tabla de variables.
Nota
La variable para una entrada o salida de un bloque tambi√©n puede arrastrarse hasta la entrada
o la salida de un m√≥dulo para relacionar l√≥gicamente la variable con el canal E/S del m√≥dulo.

1276

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones







‚ë†
‚ë°
‚ë¢

La ubicaci√≥n de un bloque se ha arrastrado hasta un canal E/S.
El nombre de un canal E/S se ha arrastrado hasta una ubicaci√≥n del programa.
Manteniendo pulsado el bot√≥n del rat√≥n, arrastre desde el nombre del canal E/S hasta la entrada
de un bloque.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1277

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.15

Conceptos de automatizaci√≥n flexibles

Control de configuraci√≥n (configuraci√≥n futura) para dispositivos
Control de configuraci√≥n (configuraci√≥n futura) centralizada en S7-1500
Informaci√≥n importante sobre el control de configuraci√≥n (configuraci√≥n futura)
Principio de funcionamiento
El control de configuraci√≥n permite configurar la estructura de un controlador (en este caso:
instalaci√≥n centralizada de un S7-1500) y utilizar variantes (opciones) que difieran de esta
configuraci√≥n.
‚óè En un proyecto maestro con una configuraci√≥n m√°xima (maestro de estaci√≥n) est√°n
configurados todos los m√≥dulos necesarios en una serie de partes de instalaci√≥n o
m√°quinas semejantes.
‚óè En el programa de usuario del proyecto maestro hay previstas diversas opciones de
estaci√≥n para diversas partes de instalaci√≥n o m√°quinas, as√≠ como una opci√≥n de estaci√≥n
seleccionada. Una opci√≥n de estaci√≥n utiliza, p. ej., solo una parte de los m√≥dulos
configurados, y dichos m√≥dulos se insertan en orden diferente.
‚óè Un usuario selecciona in situ una opci√≥n de estaci√≥n para una instalaci√≥n concreta. No es
necesario que modifique el proyecto ni que cargue una configuraci√≥n modificada.

1278

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
0DHVWURGHHVWDFL¬µQ

2SFL¬µQGHHVWDFL¬µQ

2SFL¬µQGHHVWDFL¬µQ

2SFL¬µQGHHVWDFL¬µQ

Mediante un juego de datos de control (programado por el usuario) en el programa de
arranque, se notifica a la CPU los m√≥dulos que faltan en la configuraci√≥n real en comparaci√≥n
con la configuraci√≥n o bien los m√≥dulos que se encuentran en un slot distinto al previsto en la
configuraci√≥n. El control de configuraci√≥n no afecta a la parametrizaci√≥n de los m√≥dulos.
El control de configuraci√≥n permite variar la instalaci√≥n centralizada de forma flexible siempre
que la configuraci√≥n real derive de la configuraci√≥n m√°xima prevista.
A continuaci√≥n se describe la manera de activar el control de configuraci√≥n (parametrizaci√≥n
de CPU) y la estructura que debe tener el juego de datos necesario.

Requisitos
‚óè STEP 7 Professional versi√≥n V13 o superior
‚óè CPU S7-15XX versi√≥n de firmware 1.5 o superior Los m√≥dulos que admiten la funci√≥n
"Control de configuraci√≥n" tambi√©n tienen la entrada "Control de configuraci√≥n" en la
descripci√≥n (texto informativo) del cat√°logo de hardware.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1279

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Recomendaci√≥n: Antes de cargar otro programa con un juego de datos de control
modificado, restablezca la configuraci√≥n de f√°brica. Con esta medida se evitan estados
incoherentes que podr√≠an producirse debido a la existencia de un juego de datos de control
incompatible.
‚óè El par√°metro de arranque "Comparaci√≥n de configuraci√≥n te√≥rica y real" est√° ajustado a
"Arranque de la CPU aunque haya diferencias" (ajuste predeterminado).

1280

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Pasos necesarios
1. Active en la configuraci√≥n de la CPU el par√°metro "Permitir la reconfiguraci√≥n del
dispositivo en el programa de usuario" (secci√≥n "Control de configuraci√≥n").

2. Cree un juego de datos de control (p. ej. en un bloque de datos) de acuerdo con la
configuraci√≥n actual siguiendo el patr√≥n de juego de datos de control descrito m√°s abajo.
El juego de datos de control tiene el n√∫mero 196. Tenga en cuenta que primero debe crear
un tipo de datos PLC que contenga la estructura del juego de datos de control y que el
bloque de datos se base en ese tipo de datos PLC.

3. Transfiera el juego de datos de control del programa de arranque a la CPU.
El control de configuraci√≥n de los m√≥dulos enchufados de forma centralizada solo act√∫a
cuando el estado operativo de la CPU cambia de STOP a RUN. Llame la instrucci√≥n
avanzada WRREC (escribir registro) en el OB de arranque y transfiera el juego de datos de
control creado a la CPU, ver apartado siguiente.
Si en el OB de arranque no se transfiere ning√∫n juego de datos de control v√°lido, el
controlador no estar√° operativo. En este caso, la CPU interrumpe el arranque y vuelve al
estado "STOP".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1281

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Transferencia del juego de datos de control en el programa de arranque
La CPU ejecuta la instrucci√≥n WRREC para transferir el juego de datos de control de modo
as√≠ncrono. Por ello es necesario llamar varias veces WRREC en un bucle en el OB de
arranque, hasta que los par√°metros de salida "BUSY" o "DONE" indiquen que se ha transferido
el juego de datos.
Sugerencia: para programar el bucle utilice el lenguaje de programaci√≥n SCL con la instrucci√≥n
REPEAT ... UNTIL.
REPEAT
"WRREC_DB"(REQ := "start_config_control",
ID := 33,
INDEX := 196,
LEN := "conf_LEN",
DONE => "conf_DONE",
BUSY => "conf_BUSY",
ERROR => "conf_ERROR",
RECORD := "ConfDB".ConfigControl,
STATUS => "conf_STATUS");
UNTIL NOT "conf_BUSY"
END_REPEAT;
A continuaci√≥n se explican los distintos par√°metros de bloque que deben recibir determinados
valores en el contexto del control de configuraci√≥n. Para m√°s informaci√≥n sobre los par√°metros
de bloque restantes, consulte tambi√©n WRREC:
Par√°metro

Explicaci√≥n

ID

Identificador de hardware; es siempre 33 (decimal) con control de configuraci√≥n para
m√≥dulos dispuestos de manera centralizada.

INDEX

N√∫mero del juego de datos; es siempre 196 (decimal) con control de configuraci√≥n para
m√≥dulos dispuestos de manera centralizada.

RECORD

Juego de datos de control que tiene que transferirse.
Para m√°s informaci√≥n sobre la estructura del juego de datos de control, consulte el
apartado "Juego de datos de control".
Sugerencia: el par√°metro de bloque "RECORD" de la instrucci√≥n WRREC (versi√≥n
V1.1 o superior) es del tipo de datos "VARIANT", por lo que exige una variable con tipo
de datos. Si deposita el juego de datos de control en un bloque de datos, l√≥gicamente
el propio bloque debe tener tambi√©n un tipo de datos. El bloque de datos creado no
puede ser del tipo "DB global", sino que debe derivar de un tipo de datos de usuario.
Proceda del siguiente modo:
1. Primero cree un tipo de datos PLC (tipo de datos de usuario) nuevo con la estructura
del juego de datos de control y ll√°melo, p. ej., "ConfDB".
2. Cree un bloque de datos nuevo. Para ese bloque de datos seleccione el tipo de
datos de usuario que acaba de crear, p. ej., "ConfDB".

1282

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En los lenguajes de programaci√≥n gr√°ficos convierta el bucle con ayuda de instrucciones de
control de programa.
Ejemplo en FUP: Se programa un bucle con la instrucci√≥n LABEL (Etiqueta) y con la
instrucci√≥n JMP (Saltar si RLO = 1).

Disposici√≥n de los m√≥dulos
La siguiente tabla muestra la asignaci√≥n de los n√∫meros de slot:
Slot

M√≥dulos

Observaci√≥n

0

M√≥dulo de alimentaci√≥n (opcional)

Slot a la izquierda de la CPU

1

CPU

El slot 1 es siempre la CPU

2 - 31

M√≥dulos de periferia / m√≥dulos de alimen‚Äê Slots a la derecha de la CPU
taci√≥n del sistema, seg√∫n la variante de
configuraci√≥n

Juego de datos de control
Para el control de configuraci√≥n se define un juego de datos de control 196 que contiene una
asignaci√≥n de slots.
Byte

Elemento

Codificaci√≥n

Explicaci√≥n

0

Longitud del bloque

4 + n√∫mero de slots

Header

1

Block-ID

196

2

Version

4 (para periferia centraliza‚Äê
da)

3

Subversion

0

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1283

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Byte

Elemento

Codificaci√≥n

Explicaci√≥n

4

Asignaci√≥n de slot 0 confi‚Äê
gurado

Slot 0 real

Elemento de control

5

Asignaci√≥n de slot 1 confi‚Äê
gurado

Slot 1 real

6

Asignaci√≥n de slot 2 confi‚Äê
gurado

Slot real o 16#FF

7

Asignaci√≥n de slot 3 confi‚Äê
gurado

Slot real o 16#FF

...

...

...

4 + (n.¬∫ m√°x. slot)

Asignaci√≥n del m√°ximo slot Slot real o 16#FF
configurado

(siempre 1, ya que la CPU
siempre ocupa el slot 1)

Describe en cada ele‚Äê
mento qu√© slot real del
dispositivo est√° asig‚Äê
nado al slot configura‚Äê
do. La estructura de
un elemento de con‚Äê
trol se describe en el
apartado siguiente.

Estructura de un elemento de control
Un elemento de control recibe informaci√≥n sobre qu√© m√≥dulo est√° enchufado en qu√© slot.
Los n√∫meros de byte representan los slots configurados en orden ascendente (ver m√°s arriba):
‚óè el byte 4 representa el slot 0 configurado
‚óè el byte 5 representa el slot 1 configurado
‚óè el byte 6 representa el slot 2 configurado
‚óè etc.
El valor que hay que asignar al byte correspondiente se obtiene aplicando la regla siguiente:
‚óè Si el m√≥dulo existe en la configuraci√≥n real, introduzca el n√∫mero de slot real del m√≥dulo.
‚Äì Ejemplo 1: el m√≥dulo del slot 2 configurado se encuentra en el slot 2.
En el byte 6 (= slot 2 configurado) introduzca el valor 2 (= slot real).
‚Äì Ejemplo 2: el m√≥dulo del slot 3 configurado se encuentra en el slot 2.
En el byte 7 (= slot 3 configurado) introduzca el valor 2 (= slot real).
‚óè Si el m√≥dulo no existe en la configuraci√≥n real, en el byte correspondiente al slot
configurado introduzca 16#FF (255).

Reglas
Tenga en cuenta las siguientes reglas:
‚óè Si se ha activado el control de configuraci√≥n, la CPU no estar√° operativa sin juego de datos
de control. Si en el OB de arranque no se transfiere ning√∫n juego de datos de control v√°lido,
la CPU interrumpe el arranque y vuelve al estado "STOP". En ese caso no se inicializa la
periferia centralizada. La causa del estado operativo "STOP" se introduce en el b√∫fer de
diagn√≥stico.
‚óè Para direccionar la instrucci√≥n WRREC, utilice el identificador de hardware 33 (decimal,
para el par√°metro de bloque ID) para escribir el juego de datos de control.

1284

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè El juego de datos de control se almacena de forma remanente en la CPU, de modo que si
la configuraci√≥n no var√≠a, no es necesario escribir de nuevo el juego de datos de control 196
al volver a arrancar. Antes de la puesta en marcha se recomienda efectuar un borrado total
de la CPU a fin de borrar cualquier juego de datos de control que pueda haber.
‚óè La CPU ignora las entradas de slots en el juego de datos de control que no est√°n en la
configuraci√≥n te√≥rica configurada.
‚óè El juego de datos de control puede acortarse. Deben estar incluidas las entradas hasta el
√∫ltimo slot de la configuraci√≥n te√≥rica actual.
‚óè Cada slot real no debe figurar m√°s de una vez en el juego de datos de control.
‚óè Un slot real solamente puede asignarse a un slot configurado.
‚óè Uso de CP/CM:
‚Äì En relaci√≥n con el control de configuraci√≥n, los CP/CM punto a punto se comportan igual
que m√≥dulos digitales y m√≥dulos anal√≥gicos (sin restricciones).
‚Äì CPU con versi√≥n de firmware V1.7 o superior:
Si en la configuraci√≥n centralizada hay enchufados CP/CM, es decir, p. ej., un CM
1542-5 (maestro DP o esclavo DP), el control de configuraci√≥n no puede influir sobre
dichos CM/CP. Por ello es necesario dejar esos m√≥dulos en los slots configurados e
introducir en el juego de datos de control sus n√∫meros de slot configurados ("slot real =
slot configurado"). Se dispone de la m√°xima flexibilidad si los CM/CP se enchufan
inmediatamente a la derecha de la CPU.
‚Äì CPU con versi√≥n de firmware V1.6 o inferior:
En general los CM y CP no pueden utilizarse para el control de configuraci√≥n.
‚óè Los m√≥dulos de alimentaci√≥n del sistema (PS) tambi√©n pueden estar sujetos al control de
configuraci√≥n. Para ello, tenga en cuenta las indicaciones del manual de sistema S7-1500
(http://support.automation.siemens.com/WW/view/es/59191792). Recomendamos
prescindir de la reconfiguraci√≥n, en especial para un m√≥dulo de alimentaci√≥n del sistema
(PS) en el slot 0.
Nota
Configuraci√≥n modificada
La escritura de un juego de datos de control con una configuraci√≥n modificada provoca
autom√°ticamente un nuevo arranque con la nueva configuraci√≥n.
Con esta reacci√≥n se borra el juego de datos 196 original guardado de forma remanente y
se guarda de forma remanente el nuevo juego de datos 196.

Comportamiento durante el funcionamiento
Repercusi√≥n de la discrepancia entre la configuraci√≥n prevista y la configuraci√≥n real:
‚óè Para la visualizaci√≥n online y la visualizaci√≥n en el b√∫fer de diagn√≥stico (m√≥dulo en buen
estado o m√≥dulo defectuoso) se utiliza siempre la configuraci√≥n hardware, no la
configuraci√≥n real diferente de esta.
Ejemplo: un m√≥dulo proporciona un diagn√≥stico. Este m√≥dulo est√° configurado para el slot
4, pero est√° enchufado realmente en el slot 3 (m√≥dulo no presente; ver ejemplo en el
cap√≠tulo siguiente). En la vista online se muestra un slot 4 configurado como err√≥neo; en la
estructura real, el m√≥dulo del slot 3 se√±aliza un error mediante un indicador LED.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1285

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si en el juego de datos de control se han registrado m√≥dulos como no presentes, el sistema de
automatizaci√≥n se comportar√° de la siguiente manera:
‚óè Los m√≥dulos marcados como no presentes en el juego de datos de control no notifican
ning√∫n diagn√≥stico; su estado siempre es OK. La informaci√≥n de calidad es OK.
‚óè Acceso directo de escritura a las salidas o acceso de escritura a la memoria imagen de
proceso de las salidas no presentes: sin efecto; no se notifica ning√∫n error de acceso.
‚óè Acceso directo de lectura a las entradas o acceso de lectura a la memoria imagen de
proceso de las entradas no presentes: se proporciona el valor "0"; no se notifica ning√∫n
error de acceso.
‚óè Escribir juego de datos en m√≥dulo no presente: sin efecto; no se notifica ning√∫n error.
‚óè Leer juego de datos de m√≥dulo no presente: se notifica un error, ya que no se puede
devolver ning√∫n juego de datos v√°lido.

Mensajes de error
Al escribir el juego de datos de control, en caso de fallo se devuelven los siguientes mensajes
de error:
Tabla 1-98

Mensajes de error

C√≥digo de error

Significado

16#80B1

Longitud no permitida; la indicaci√≥n de longitud del juego de datos
196 no es correcta.

16#80B5

Control de configuraci√≥n no parametrizado.

16#80E2

El juego de datos se ha transferido en un contexto de OB err√≥neo.
El juego de datos debe transferirse en el programa de arranque.

16#80B8

Error de par√°metros; el m√≥dulo notifica par√°metros no v√°lidos.

Informaci√≥n adicional y ejemplos
Aqu√≠ encontrar√° una librer√≠a de los juegos de datos y otros ejemplos de aplicaci√≥n: Plantillas
para los juegos de datos (http://support.automation.siemens.com/WW/view/es/29430270)

Consulte tambi√©n
Informaci√≥n importante sobre el control de configuraci√≥n (configuraci√≥n futura) (P√°gina 1638)
Manual de sistema S7-1500 (http://support.automation.siemens.com/WW/view/es/59191792)

Ejemplo de un control de la configuraci√≥n
A continuaci√≥n se programa una configuraci√≥n compuesta por una fuente de alimentaci√≥n del
sistema, una CPU y 3 m√≥dulos de periferia.
El m√≥dulo del slot 3 no est√° presente en el primer nivel de configuraci√≥n y el control de la
configuraci√≥n lo "oculta".

1286

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el segundo nivel de configuraci√≥n, el m√≥dulo ocultado anteriormente se coloca en el √∫ltimo
slot. El slot agregado se notifica a la CPU a trav√©s de un registro de control modificado.

Configuraci√≥n real con m√≥dulo ausente
La configuraci√≥n programada incluye todos los m√≥dulos que pueden estar presentes en una
configuraci√≥n final.
El m√≥dulo insertado en el slot 3 en la configuraci√≥n programada falta en la configuraci√≥n real.
Por este motivo, el slot 3 debe codificarse en el registro de datos con "FF H" (= no presente) de
forma correspondiente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1287

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones













‚ë†

El m√≥dulo falta en la configuraci√≥n real

Configuraci√≥n real con m√≥dulo agregado a posteriori
El m√≥dulo presente en la configuraci√≥n programada en el slot 3 se "adjunta al final" en la
configuraci√≥n real; queda insertado como √∫ltimo m√≥dulo en el slot 4.
El registro de control se adapta de forma correspondiente.

1288

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones



Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019









1289

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Juego de datos de control para una CPU ET 200SP
Asignaci√≥n de slots
La tabla siguiente muestra los slots de una CPU ET 200SP disponibles para los diferentes
m√≥dulos:
Tabla 1-99

Asignaci√≥n de slots

M√≥dulos

Slots posibles

Observaci√≥n

CPU

1

El slot 1 es siempre la CPU

M√≥dulos de periferia

2 - 65

Despu√©s de la CPU

M√≥dulo de servidor

2 - 66

El m√≥dulo de servidor cierra la configuraci√≥n de la estaci√≥n
ET 200SP despu√©s de la CPU o del √∫ltimo m√≥dulo de periferia.

Juego de datos de control
Para el control de configuraci√≥n en una CPU ET 200SP se define un juego de datos de control
196 V2.0 que contiene una asignaci√≥n de slots. El slot m√°ximo se corresponde aqu√≠ con el slot
del m√≥dulo de servidor.
La tabla siguiente muestra la estructura del juego de datos de control con explicaciones de los
diferentes elementos.
Tabla 1-100 Control de configuraci√≥n: estructura del juego de datos de control 196
Byte

Elemento

Codificaci√≥n

Explicaci√≥n

0

Longitud del bloque

4 + (n√∫mero de slots √ó 2)

Header

1

Block-ID

196

2

Version

2

3

Version

0

1290

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Byte

Elemento

Codificaci√≥n

Explicaci√≥n

4

Slot 1 de la estaci√≥n maes‚Äê
tra

Asignaci√≥n de slot 1 en la
opci√≥n de estaci√≥n

Elemento de control

(siempre 1, ya que la CPU
siempre ocupa el slot 1)

Contiene informaci√≥n sobre qu√© m√≥dulo
est√° enchufado en qu√© slot.

El valor que hay que asignar al byte co‚Äê
rrespondiente se obtiene aplicando la reg‚Äê
Slot 2 de la estaci√≥n maes‚Äê Asignaci√≥n de slot en la op‚Äê la siguiente:
‚óè Si el m√≥dulo existe en la opci√≥n de
tra
ci√≥n de estaci√≥n
estaci√≥n, introduzca el n√∫mero de slot
Funci√≥n adicional para el slot 2
del m√≥dulo.
Slot 3 de la estaci√≥n maes‚Äê Asignaci√≥n de slot en la op‚Äê
‚óè Si el m√≥dulo existe como slot vac√≠o
tra
ci√≥n de estaci√≥n
(con tapa de BU), introduzca el
Funci√≥n adicional para el slot 3
n√∫mero de slot del m√≥dulo + 128.
:
:
(Ejemplo: m√≥dulo como slot vac√≠o en
Slot del m√≥dulo de servidor Asignaci√≥n de slot y m√≥dulo
el slot 3: introduzca 131 en el elemento
de servidor en la opci√≥n de
de control)
estaci√≥n*
‚óè Si el m√≥dulo no existe en la opci√≥n de
Funci√≥n adicional para el slot del m√≥dulo de servidor
estaci√≥n, introduzca 0.

5

Funci√≥n adicional para el slot 1

6
7
8
9
:
4 + ((slot m√°x 1) √ó 2)
4 + ((slot m√°x. 1) √ó 2) + 1

Funci√≥n adicional
Contiene informaci√≥n acerca de si se abre
un nuevo grupo de potencial en la opci√≥n
de estaci√≥n, cambiando una BaseUnit os‚Äê
cura por una BaseUnit clara.
‚óè Si se sustituye una BaseUnit oscura
por una BaseUnit clara, introduzca 1
como funci√≥n adicional.
‚óè Si se incorpora la BaseUnit de la
estaci√≥n maestra, introduzca 0 como
funci√≥n adicional.

* El m√≥dulo de servidor debe estar presente en la opci√≥n de estaci√≥n y no debe estar marcado como slot vac√≠o (tapa de BU).

Librer√≠a de bloques "OH_S71x00_Library"
En Internet puede descargarse la librer√≠a de bloques OH_S71x00_Library (https://
support.industry.siemens.com/cs/#document/29430270?lc=es-WW). La librer√≠a de bloques
contiene tipos de datos con la estructura de los juegos de datos de control para el sistema de
periferia descentralizada ET 200SP. Con estos tipos de datos podr√° llevar a cabo con poco
esfuerzo el control de configuraci√≥n para su soluci√≥n de automatizaci√≥n flexible.

Consulte tambi√©n
Manual de sistema ET 200SP (https://support.industry.siemens.com/cs/ww/es/view/
58649293)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1291

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Control de configuraci√≥n (configuraci√≥n futura) para sistemas IO
Uso de proyectos de maquinaria de serie
El uso de proyectos de maquinaria de serie es conveniente en los siguientes casos:
‚óè La soluci√≥n de automatizaci√≥n (m√°quina) se utiliza varias veces en las instalaciones de los
clientes.
‚óè La m√°quina se utiliza en diferentes instalaciones de distintos clientes.

Variabilidad en la estructura por el control de configuraci√≥n de dispositivos IO
Se obtiene una flexibilidad adicional para una instalaci√≥n o una m√°quina configurando
dispositivos IO opcionales y configurando puertos que se preparan para una interconexi√≥n
mediante el programa de usuario.
A trav√©s del programa de usuario es posible incluir en la configuraci√≥n dispositivos IO
opcionales sin necesidad de cargar de nuevo el proyecto. Mediante el programa de usuario
tambi√©n es posible interconectar los puertos de dispositivos IO y, por tanto, adaptar la
secuencia de dispositivos IO, controlando as√≠ la configuraci√≥n necesaria en cada caso (sin
sistema de ingenier√≠a).

Ventajas de los proyectos de maquinaria de serie
‚óè Un proyecto gestionado de forma centralizada (configuraci√≥n y programa) puede cargarse
sin cambios en diferentes m√°quinas del mismo tipo.
‚óè Localmente solo se requieren algunas adaptaciones sencillas para integrar la m√°quina en
una infraestructura de red existente.
‚óè Las m√°quinas de estructura modular se pueden adaptar f√°cilmente a diferentes
aplicaciones; para ello, a trav√©s del control de configuraci√≥n se comunica al sistema
PROFINET IO qu√© caracter√≠sticas tiene la estructura real actual del sistema IO.

Informaci√≥n adicional
Encontrar√° informaci√≥n detallada sobre proyectos de maquinaria de serie aqu√≠ y en el manual
PROFINET con STEP 7 (http://support.automation.siemens.com/WW/view/es/49948856).

1292

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.1.16

Uso de la comunicaci√≥n OPC UA

Informaci√≥n importante sobre OPC UA
OPC UA e Industria 4.0
Est√°ndar unificado para el intercambio de informaci√≥n y de datos
Denominamos Industrie 4.0 al uso, evaluaci√≥n y an√°lisis intensivos de numerosos datos
procedentes de la producci√≥n en sistemas TI del nivel de empresa. Industria 4.0 har√° aumentar
el intercambio de datos entre los niveles de producci√≥n y de empresa. Sin embargo, para
garantizar su √©xito ser√° necesario un est√°ndar unificado de intercambio de informaci√≥n y de
datos.
La OPC cl√°sica solo funciona en sistemas operativos Windows. Para sortear esta limitaci√≥n,
OPC Foundation desarroll√≥ el est√°ndar OPC UA (OPC Unified Architecture).
El est√°ndar OPC UA resulta id√≥neo para el intercambio de datos entre distintos niveles gracias
a su independencia respecto de sistemas operativos, su m√©todo de transferencia seguro y la
descripci√≥n sem√°ntica de los datos. De este modo, tambi√©n es posible transmitir datos de
m√°quinas (variables reguladas, valores medidos o par√°metros).
Un elemento importante de este concepto es que, para la transferencia de datos cr√≠tica en el
tiempo y a pie de m√°quina, la comunicaci√≥n OPC UA puede tener lugar en paralelo a la
comunicaci√≥n en tiempo real.
OPC UA se caracteriza por una gran escalabilidad, lo que permite el intercambio continuo de
informaci√≥n entre sensores, controladores y sistemas MES o ERP.
OPC UA no solo proporciona datos, sino tambi√©n informaci√≥n sobre ellos (p.ej. tipos de datos,
tipos de objetos), lo que permite interpretar de manera automatizada los datos a los que se
accede.

Propiedades generales de OPC UA
OPC UA y PROFINET
OPC UA y PROFINET pueden utilizarse conjuntamente. Ambos protocolos utilizan la misma
infraestructura de red.

Independencia del sistema operativo
El est√°ndar OPC UA no est√° ligado a ninguna plataforma y utiliza un protocolo binario
optimizado basado en TCP para aplicaciones de alto rendimiento.
OPC UA puede utilizarse, por ejemplo, con Windows, Linux, Mac OS X, un sistema operativo
en tiempo real o un sistema operativo para m√≥vil (Android o iOS).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1293

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Independencia de cualquier capa de transporte
OPC UA soporta en la actualidad los siguientes mecanismos de transporte y protocolos:
‚óè Transferencia de mensajes en flujo binario directamente a trav√©s de TCP/IP.
‚óè Transferencia de mensajes con XML a trav√©s de TCP/IP y HTTP. Este mecanismo de
transporte solo permite una transferencia lenta, por lo que apenas se utiliza. Las CPU
S7-1500 no soportan este mecanismo de transporte.
Todas las aplicaciones OPC UA soportan el intercambio de datos binario (prescrito por la
especificaci√≥n OPC UA) .

Principio cliente-servidor sencillo
Un servidor OPC UA proporciona mucha informaci√≥n dentro de una red, p. ej. en relaci√≥n con
la CPU, el propio servidor OPC UA, los datos y los tipos de datos. El cliente OPC UA consulta
dicha informaci√≥n.

Implementaci√≥n en diferentes lenguajes de programaci√≥n
OPC Foundation ha implementado el est√°ndar OPC UA en varios lenguajes de programaci√≥n:
Hay disponibles pilas para .NET, ANSI C, y Java; ya no se realiza mantenimiento de las pilas
para ANSI C y Java.
La OPC Foundation proporciona la pila para .NET, as√≠ como algunos programas de ejemplo,
como software Open Source. Consulte Github (https://github.com/opcfoundation).
Algunas empresas ofrecen Software Development Kits (SDK). Estos paquetes de desarrollo
contienen las pilas de la OPC Foundation y otras funciones que facilitan el desarrollo de
soluciones.
Ventajas del uso de SDK:
‚óè Asistencia por parte del proveedor
‚óè Software probado
‚óè Documentaci√≥n detallada
‚óè Condiciones de licencia claras (importante para la venta posterior de soluciones)

Escalabilidad
OPC UA puede utilizarse para dispositivos de diferentes gamas:
‚óè Sensores
‚óè Sistemas embebidos
‚óè Controladores
‚óè Sistemas de PC
‚óè Tel√©fonos inteligentes
‚óè Servidores en los que se ejecutan aplicaciones MES o ERP.

1294

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La gama de los dispositivos se diferencia por medio de perfiles. Los diferentes perfiles OPC UA
ofrecen la posibilidad de escalar OPC UA tanto para dispositivos muy peque√±os y sencillos
como para dispositivos muy potentes.
Un perfil OPC UA describe las funciones y los servicios que deben soportar el servidor y el
cliente. Adem√°s, opcionalmente pueden realizarse otras funciones o servicios no exigidos por
el perfil.
Los perfiles OPC UA se diferencian de los perfiles PROFINET; estos √∫ltimos especifican
propiedades y comportamientos adicionales para dispositivos y sistemas de diferentes
fabricantes, en el sentido de una interfaz de software universal.
Nano Embedded Device 2017 Server Profile
Para los dispositivos m√°s peque√±os con funcionalidad muy restringida existe el "Nano
Embedded Device 2017 Server Profile" de la OPC Foundation. Este perfil tiene la misma
funcionalidad que "Core Server Facet" y define el protocolo TCP OPC UA binario como el perfil
de transporte necesario. El perfil permite conexiones sin seguridad UA, no permite
suscripciones ni llamadas de m√©todos. La compatibilidad con objetos y variables de
diagn√≥stico es opcional para este perfil.
Otros perfiles se basan en el "Nano Embedded Device 2017 Server Profile", exigen m√°s
recursos y ofrecen m√°s funcionalidad.
Micro Embedded Device 2017 Server Profile
Este perfil ofrece una funcionalidad limitada, exige un m√≠nimo de dos conexiones paralelas,
adem√°s de suscripciones y monitorizaci√≥n de datos, pero no proporciona seguridad UA ni
llamadas de m√©todos.
‚óè Los Basic Controller S7-1200 soportan el "Micro Embedded Device 2017 Server Profile";
adem√°s el S7-1200 soporta seguridad UA.
Embedded 2017 UA Server Profile
Este perfil fue desarrollado para dispositivos con m√°s de 50 MB de memoria de trabajo y un
procesador m√°s potente. Se basa en el perfil Micro Embedded Device Server. Adicionalmente,
requiere seguridad UA y llamadas de m√©todos.
Asimismo, los servidores deben poner a disposici√≥n el modelo de tipo que utilizan (tipos de
datos, tipos de referencias, tipos de variables, ...).
‚óè Los Advanced Controller S7-1500 soportan el "Embedded 2017 UA Server Profile".
Los perfiles Standard y Global Discovery
La "OPC UA Specification Part 7" define otros perfiles:
‚óè el "Standard 2017 UA Server Profile", que es adecuado para los servidores OPC UA
basados en PC
‚óè dos perfiles globales, "Global Discovery Server 2017 Profile" y "Global Discovery and
Certificate Management 2017 Server Profile", que cubren los modelos de informaci√≥n y
servicio necesarios de un servidor Global Discovery

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1295

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Concepto de tipo/instancia
OPC UA presenta un modelo de informaci√≥n orientado a objetos y completamente entrelazado
(full-meshed-network) para espacios de nombres, incluidos los metadatos para describir
objetos. Referenciando las instancias entre s√≠, incluyendo sus tipos, puede generarse
cualquier estructura de objetos. Puesto que los servidores revelan su sistema de instancias y
tipos, los clientes pueden navegar por esta red y obtener toda la informaci√≥n que necesitan.
Durante el tiempo de ejecuci√≥n est√°n disponibles tanto las instancias como sus definiciones de
tipos.
Los procedimientos o conceptos sobre c√≥mo manejar las referencias a tipos se optimizan a lo
largo del tiempo. Estas optimizaciones llevan a nuevas versiones de la especificaci√≥n OPC UA
(p. ej. V1.03 => V1.04).

Mapeo de las variables PLC
La informaci√≥n del servidor OPC UA (p. ej. las variables PLC) est√° modelada en forma de
nodos (nodes) unidos entre s√≠ mediante referencias. El servidor indica la sem√°ntica en el
espacio de direcciones, la cual puede ser registrada por los clientes (durante la navegaci√≥n).
Esto hace posible navegar con un cliente OPC UA de nodo en nodo y saber qu√© contenidos
pueden leerse, observarse o escribirse.

Mecanismos de seguridad integrados
OPC UA utiliza mecanismos de seguridad a distintos niveles:
‚óè El establecimiento de conexiones seguras entre un servidor OPC UA y un cliente OPC UA
solo es posible si el cliente y el servidor pueden iniciar sesi√≥n mediante certificados X.509v3 y reconocen mutuamente los certificados (seguridad a nivel de aplicaci√≥n). Son posibles
diferentes directivas de seguridad, incluso una conexi√≥n no segura entre servidor y cliente
(Security Policy: "Ninguna seguridad")
‚óè Para que el usuario pueda tener acceso autorizado (autenticaci√≥n), un servidor puede
exigirle b√°sicamente la siguiente informaci√≥n:
- un certificado de usuario (no configurable en STEP 7)
- nombre de usuario y contrase√±a
- ninguna legitimaci√≥n del usuario
Los mecanismos de seguridad son opcionales y configurables.

Consulte tambi√©n
OPC Foundation (https://opcfoundation.org)

OPC UA con CPU S7-1200/S7-1500
En OPC UA, un sistema act√∫a como servidor proporcionando la informaci√≥n disponible a otros
sistemas (clientes).
Los clientes OPC UA tienen, p.ej. acceso de lectura y escritura a datos de un servidor OPC UA.
Los clientes OPC UA llaman a m√©todos en el servidor OPC UA.
Existe la posibilidad de acceder online con un cliente a dichos datos, o tambi√©n, p. ej., a
informaci√≥n sobre el rendimiento y el diagn√≥stico. En el lenguaje utilizado con OPC UA esta

1296

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
funci√≥n se denomina "Browsen". Con la funci√≥n "Subscription" se prescinde de la lectura
regular de una variable; el cliente es informado por el servidor de los cambios de valor.
Un sistema puede ser cliente y servidor al mismo tiempo.

Servidor OPC UA de la CPU S7-1500
Las CPU S7-1500 a partir de la versi√≥n de firmware V2.0 cuentan con un servidor OPC UA.
En los siguientes cap√≠tulos se describe c√≥mo configurar el servidor OPC UA de la CPU
S7-1500 y proporcionar as√≠ datos y m√©todos a los clientes OPC UA, de modo que estos puedan
acceder en lectura y escritura a las variables PLC y llamar m√©todos del servidor.
Adem√°s, los cap√≠tulos siguientes muestran c√≥mo integrar las especificaciones Companion al
espacio de direcciones del servidor OPC UA.

Servidor OPC UA de la CPU S7-1200
Las CPU S7-1200 a partir del firmware V4.4 cuentan con un servidor OPC UA.
En principio, el servidor OPC UA se configura exactamente igual que en una CPU S7-1500,
pero las funciones y los recursos disponibles est√°n limitados por el perfil "Micro Embedded
Device 2017 Server Profile". Por ello, al contrario que en una CPU S7-1500, las siguientes
funciones no est√°n disponibles:
‚óè M√©todos de servidor
‚óè Tipos de datos estructurados (estructuras y arrays)
‚óè Registered Read y Registered Write
Encontrar√° m√°s informaci√≥n aqu√≠.

Cliente OPC UA de la CPU S7-1500
Las CPU S7-1500 a partir de la versi√≥n de firmware 2.6 cuentan tambi√©n con un cliente OPC
UA.
Los cap√≠tulos siguientes explican c√≥mo crear con instrucciones estandarizadas (bloques de
funci√≥n PLCopen) un programa de usuario que, como cliente OPC UA, proporcione las
siguientes funciones:
‚óè Lectura de datos de un servidor OPC UA
‚óè Escritura de datos en un servidor OPC UA
‚óè Llamada a m√©todos de un servidor OPC UA
STEP 7 (TIA Portal) ayuda a crear programas de usuario con un editor para interfaces de
cliente y una parametrizaci√≥n para conexiones OPC UA.
Las instrucciones OPC UA para una CPU S7-1500 que act√∫a de cliente se describen
detalladamente en la ayuda de las instrucciones (Instrucciones > Comunicaci√≥n > OPC UA).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1297

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Cliente OPC UA con fines de prueba
Para explicar el manejo de los clientes OPC UA, la siguiente descripci√≥n utiliza distintos
clientes OPC UA:
‚óè "UaExpert" de Unified Automation. Un cliente extenso que puede utilizarse de forma
gratuita:
Enlace para descargar UaExpert. (https://www.unified-automation.com/downloads/opc-uaclients.html)
‚óè "UA Sample Client" de OPC Foundation. Este cliente est√° disponible de forma gratuita para
usuarios que est√°n registrados en OPC Foundation :
Enlace para descargar el cliente de ejemplo de la OPC Foundation (https://
opcfoundation.org).

Ejemplo de aplicaci√≥n en el Industry Online Support
El Siemens Industry Online Support pone a disposici√≥n un ejemplo de aplicaci√≥n gratuito con
una API cliente para distintos casos de uso. Las funciones de esta interfaz permiten crear
clientes OPC UA propios para cada caso de uso en particular. Para facilitar el uso de la API le
ofrecemos una clase .NET-Helper superior.
La API de cliente se basa en la pila .NET OPC UA de la OPC Foundation.
El ejemplo de aplicaci√≥n muestra a modo de ejemplo c√≥mo se establecen las conexiones entre
servidor y cliente. El ejemplo describe tambi√©n la lectura y escritura de variables PLC.
Enlace para descarga: Cliente OPC UA .NET para el servidor OPC UA SIMATIC S7-1500
(http://support.automation.siemens.com/WW/view/es/109737901)

Acceso a aplicaciones OPC UA
A continuaci√≥n se describen las posibilidades de acceso que tiene una CPU S7-1500 con una
aplicaci√≥n OPC UA (cliente o servidor) a trav√©s de un CP de la misma estaci√≥n. Adem√°s se
muestra c√≥mo pueden combinarse esas posibilidades de acceso con la funci√≥n "IP
Forwarding" para poder acceder a dispositivos de otra subred IP a trav√©s de una estaci√≥n
S7-1500.
Se accede a todos los ajustes desde las propiedades de la CPU, √°rea "Configuraci√≥n
avanzada" de la ventana de inspecci√≥n.
La opci√≥n de acceder a la aplicaci√≥n OPC UA en la CPU a trav√©s de una interfaz CP est√° ligada
a los requisitos siguientes:
‚óè CPU S7-1500 (excepto S7-1500R/H) con versi√≥n de firmware V2.8 o superior
‚óè CP 1543-1 con versi√≥n de firmware V2.2 o superior

Principio: interfaz para acceso mediante m√≥dulo de comunicaci√≥n
Para poder acceder a una aplicaci√≥n de la CPU, como OPC UA, a trav√©s de una interfaz del
CP es necesario configurar una interfaz virtual (W1). A trav√©s de los par√°metros de direcci√≥n
IP de esta interfaz virtual puede accederse a aplicaciones basadas en IP.
El principio se representa en la siguiente figura.

1298

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1

2
CP 1543-1

S7-1500

4

5

4

3

PROFINET / Industrial Ethernet

PROFINET / Industrial Ethernet
IP subnet

IP subnet

Drives

‚ë†
‚ë°
‚ë¢
‚ë£
‚ë§

ET 200SP

Drives

S7-1500

PG/PC

CPU S7-1500 a partir de FW V2.8 (p. ej. CPU 1515-2 PN)
CP 1543-1 (a partir de FW V2.2)
Interfaz virtual (W1)
Conversi√≥n de protocolo PROFINET / Industrial Ethernet a bus de fondo o bus de fondo a PROFINET / Industrial
Ethernet
Bus de fondo

Ejemplo: Acceso de clientes OPC UA al servidor OPC UA de la CPU
Para que un cliente OPC UA acceda al servidor OPC UA de la CPU se dispone de las
siguientes interfaces de la estaci√≥n S7-1500:
‚óè las interfaces PROFINET locales de la CPU S7-1500
‚óè la interfaz Ethernet de un CP 1543-1 (con versi√≥n de firmware V2.2 o superior)
La figura siguiente muestra una posible configuraci√≥n de ejemplo: La CPU tambi√©n podr√≠a
adoptar la funci√≥n de cliente OPC UA y el dispositivo de la subred del CP la funci√≥n de servidor
OPC UA.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1299

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OPC UA Server

PROFINET / Industrial Ethernet

PROFINET / Industrial Ethernet
IP subnet

IP subnet

OPC UA Client

1300

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo: Acceso de clientes OPC UA a servidores OPC UA a trav√©s de la CPU S7-1500 con IP
Forwarding activado
El cliente OPC UA y el servidor OPC UA tambi√©n pueden conectarse entre s√≠ a trav√©s de una
CPU S7-1500 que opera como IP Forwarder. Esta posibilidad de configuraci√≥n permite una
ampliaci√≥n flexible de las instalaciones existentes.

S7-1500

CP 1543-1

PROFINET / Industrial Ethernet

PROFINET / Industrial Ethernet
IP subnet

IP subnet

OPC UA Server

OPC UA Client

Informaci√≥n adicional
Encontrar√° informaci√≥n adicional sobre las posibilidades de acceso a trav√©s de la interfaz
virtual y de IP Forwarding en los siguientes apartados:
‚óè Interfaz virtual para aplicaciones basadas en IP (P√°gina 96)
‚óè IP Forwarding (P√°gina 88)

Direccionamiento de nodos
Los nodos (nodes) son los elementos b√°sicos de OPC UA, equiparables a los objetos de la
programaci√≥n orientada a objetos. Los nodos se utilizan, por ejemplo, para los datos √∫tiles
(variables) u otros metadatos. Con los nodos se modela un espacio de direcciones OPC UA,
que tambi√©n contiene un modelo de tipo con definiciones de tipo.

ID de nodo (NodeId)
Los nodos del espacio de direcciones OPC UA se definen un√≠vocamente con un NodeId (Node
Identifier).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1301

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El NodeId est√° compuesto por un identificador, un tipo de identificador y un √≠ndice de espacio
de nombres. Los espacios de nombres se utilizan para evitar conflictos de nombres.
OPC Foundation ha definido una serie de nodos que dan informaci√≥n sobre el correspondiente
servidor OPC UA. Esos nodos pueden encontrarse en el espacio de nombres de la OPC
Foundation y tienen el √≠ndice 0.
Adem√°s, la OPC Foundation ha definido tipos de datos y de variables.

Espacio de nombres (Namespace)
Adem√°s del espacio de nombres de la OPC Foundation descrito anteriormente, el espacio de
nombres es relevante para acceder a los datos de la CPU: todas las variables y m√©todos de un
servidor OPC UA S7‚Äë1500 est√°n en el espacio de nombres (Namespace) de la interfaz de
servidor est√°ndar "http://www.siemens.com/simatic-s7-opcua".
El √≠ndice predeterminado para este espacio de nombres es 3. El √≠ndice puede cambiar si se
agregan nuevos espacios de nombres en el servidor o se elimina alguno de los existentes. Por
ello es necesario que el cliente OPC UA consulte el √≠ndice actual del espacio de nombres
(p. ej., "http://www.siemens.com/simatic-s7-opcua") en el servidor antes de leer o escribir sus
valores.
La figura siguiente muestra un resultado de ejemplo de una consulta de ese tipo.

Identifier
El Identifier es el nombre de la variable PLC entre comillas. Las comillas son el √∫nico signo que
no est√° permitido en STEP 7 dentro de un nombre. Mediante las comillas se evitan conflictos
de nombres.
En el ejemplo siguiente se lee el valor de la variable "StartTimer":

El Identifier puede constar de varios componentes. En ese caso, los distintos componentes
van separados por un punto.
En el ejemplo siguiente se lee el bloque de datos Array "MyDB" completo. En este bloque de
datos se encuentra un array con diez valores enteros. Los diez valores deben leerse
simult√°neamente. Por ello se ha introducido "0:9" como Array Range.

1302

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de NodeIds, identificadores y espacios de nombres
La figura siguiente aclara la relaci√≥n entre NodeIds, identificadores y espacios de nombre: no
supone ning√∫n problema el hecho de que dos nodos tengan el mismo identificador, pero
formen parte de espacios de nombres distintos.
STEP 7 (TIA Portal) permite importar f√°cilmente espacios de nombre a trav√©s de una interfaz
de servidor.
,'GHQRGRXWLOL]DGRVHQODLQWHUID]GHO
WLSR(VSHFLILFDFL¬µQFRPSDQLRQ
1RGH,G
(VSDFLRVGHQRPEUHV
1DPHVSDFH,QGH[\1DPHVSDFH


KWWSRSFIRXQGDWLRQRUJ8$



XUQ0\&RPSXWHU0\&RPSDQ\0\6HUYHU



XUQ0\&RPSDQ\8D6HUYHU0RGHO



XUQ0\&RPSDQ\8D6HUYHU0RGHO

1DPHVSDFH,QGH[



,GHQWLILHU7\SH

VWULQJ

,GHQWLILHU

0\7HPSHUDWXUH

1RGH,G
1DPHVSDFH,QGH[



,GHQWLILHU7\SH

VWULQJ

,GHQWLILHU

0\7HPSHUDWXUH

Variables PLC en el espacio de direcciones del servidor OPC UA
La figura siguiente muestra d√≥nde se encuentran las variables PLC del ejemplo en el espacio
de direcciones del servidor OPC UA (parte de UA Client):
El bloque de datos "MyDB" es un bloque de datos global. Por ello el bloque de datos se
encuentra debajo del nodo "DataBlocksGlobal". "StartTimer" es una variable de marcas y por
ello se representa debajo del nodo "Memory".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1303

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

M√©todos en el espacio de direcciones del servidor OPC UA
Si se implementa un m√©todo mediante el programa de usuario, tendr√° el aspecto siguiente en
el espacio de direcciones del servidor OPC UA
(v√©ase AUTOHOTSPOT):

1304

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n importante sobre clientes OPC UA
Principios b√°sicos de los clientes OPC UA
Los clientes OPC UA son programas que efect√∫an lo siguiente:
‚óè Acceso a informaci√≥n de un servidor OPC UA (p. ej. una CPU S7-1500): de lectura/
navegaci√≥n, de escritura, suscripciones
‚óè Hacen que el servidor OPC UA ejecute m√©todos
Sin embargo, los clientes OPC UA solo pueden acceder a datos que est√°n habilitados para tal
fin (consulte "Administrar derechos de escritura y lectura (P√°gina 1331)").
Para establecer una conexi√≥n con un servidor OPC UA se necesita el punto final del servidor
(consulte "Puntos finales de los servidores OPC UA (P√°gina 1327)").

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1305

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Leer informaci√≥n del servidor OPC UA
Si existe una conexi√≥n con un punto final del servidor, es posible utilizar la funci√≥n de
navegaci√≥n del cliente: se navega desde un punto inicial definido (desde el nodo ra√≠z "Root")
por el √°rea de direcciones del servidor.
De este modo se obtienen, entre otras, la informaci√≥n siguiente:
‚óè Las variables PLC habilitadas, los bloques de datos y los componentes de bloque de datos
‚óè El √≠ndice de espacio de nombres y los identificadores de estas variables PLC, bloques de
datos y componentes de DB
‚óè Los tipos de datos de las variables PLC y de los componentes de DB
‚óè El n√∫mero de componentes en arrays (necesario para leer y escribir arrays)
Adem√°s se obtiene informaci√≥n sobre el propio servidor OPC UA e informaci√≥n sobre el
S7-1500 conforme al est√°ndar "OPC UA for Devices" de OPC Foundation, por ejemplo, el
n√∫mero de serie, la versi√≥n del firmware.

Leer datos del servidor y escribir datos en el servidor
Ya conoce el √≠ndice del espacio de nombres, el identificador y el tipo de datos de las variables
PLC. De este modo pueden leerse selectivamente tanto variables PLC y componentes de DB
individuales como matrices y estructuras completas.
Encontrar√° ejemplos de lectura de variables booleanas y bloques de datos Array en
Direccionamiento de nodos (P√°gina 1301).
Encontrar√° las reglas de acceso a estructuras aqu√≠ (P√°gina 1439).
Con la informaci√≥n obtenida navegando por el √°rea de direcciones del servidor (√≠ndice,
identificador y tipo de datos), tambi√©n puede transferir valores a S7-1500 con el cliente OPC
UA. El siguiente ejemplo sobrescribe los tres primeros valores del bloque de datos Array
"MyDB".

En "Array Range" se indica qu√© componentes del array se desea sobrescribir. El c√≥digo de
estado "Good" indica que se han podido transferir los valores correctamente. Sin embargo,
solo es posible escribir los valores en el S7-1500 y no los sellos de tiempo de dichos valores.
Los sellos de tiempo solo pueden leerse.

1306

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Acceso m√°s r√°pido mediante registro
Registered Read/Write es adecuado para el acceso repetido y optimizado a datos con el
m√°ximo rendimiento. Al registrar nodos de variables, el servidor OPC UA crea un Identifier
num√©rico (NodeId num√©rico) que remite directamente al nodo registrado. Con peticiones de
lectura o escritura del cliente a este Identifier num√©rico, el servidor no debe desagrupar
ninguna cadena de caracteres como Identifier y puede acceder de manera optimizada a la
variable exigida.
Este Identifier es v√°lido exclusivamente para la sesi√≥n actual y debe solicitarse nuevamente en
caso de que se deshaga/pierda la sesi√≥n.
En el ejemplo siguiente se ha registrado primero la variable "StartTimer" en en servidor. A
continuaci√≥n se utiliza la funci√≥n r√°pida "RegisteredWrite" para activar el valor.

Esta misma l√≥gica puede aplicarse tambi√©n con la funci√≥n "RegisteredRead", lo cual es
aconsejable en especial para los datos que se leen de modo reiterativo. Sin embargo, tenga en
cuenta que, seg√∫n la aplicaci√≥n, puede ser m√°s aconsejable usar una Subscription.
Recomendaci√≥n: Lo m√°s recomendable es efectuar registros en el programa de arranque del
cliente OPC UA, ya que el registro ocupa tiempo.
Recuerde que en las propiedades de la CPU S7-1500 es posible ajustar el n√∫mero m√°ximo de
nodos registrados y que los clientes deben tener en cuenta dicho n√∫mero; consulte Ajustes
generales del servidor OPC UA (P√°gina 1345).

Suscripci√≥n
Con la funci√≥n "Subscription", solo se transmitir√°n las variables para las que un cliente OPC UA
se haya registrado en el servidor OPC UA. El servidor OPC UA enviar√° un mensaje al cliente
OPC UA para estas variables registradas (elementos vigilados = monitored Items) √∫nicamente
si se ha modificado un valor. Gracias a la vigilancia de estas variables, no es necesario enviar
consultas continuamente desde el cliente OPC UA (Polling), lo que reduce la carga de la red.
Para utilizar esta funci√≥n, hay que crear una Subscription. Para ello, especifique en el cliente
UA el intervalo de transmisi√≥n ("Publishing Interval") y haga clic en el bot√≥n "Create". El
intervalo de transmisi√≥n es el intervalo de tiempo durante el cual el servidor env√≠a valores
nuevos al cliente mediante un mensaje (data change notification).
En el siguiente ejemplo se ha creado una suscripci√≥n: En este caso, el cliente recibe cada 50
milisegundos un mensaje con los valores nuevos (intervalo de transmisi√≥n 50 ms).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1307

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Protecci√≥n del servidor contra sobrecarga
Con el par√°metro "M√≠nimo intervalo de env√≠o" puede configurarse el servidor OPC UA de la
CPU S7-1500 de manera que no utilice los intervalos de env√≠o extremadamente cortos que
solicita el cliente; consulte Ajustes del servidor para suscripciones (P√°gina 1346).
Ejemplo: Un cliente desea funcionar como se ha descrito anteriormente con un intervalo de
transmisi√≥n de 50 ms. Sin embargo, un intervalo de env√≠o tan corto provocar√≠a una elevada
carga en la red y en el servidor. Por ello, ajuste un "M√≠nimo intervalo de env√≠o" de 1000 ms en
el servidor. De este modo, los clientes que en su suscripci√≥n exigen intervalos de transmisi√≥n
menores se "frenan" hasta 1000 ms, y el servidor queda protegido contra sobrecarga.
El muestreo y env√≠o (Sampling & Publishing) dentro del marco de una suscripci√≥n son
procesos de comunicaci√≥n que, igual que otros procesos de comunicaci√≥n (comunicaci√≥n
TCP/UDP/servidor web, etc.), son procesados con la prioridad 15 por la CPU. Los OB de
mayor prioridad interrumpen la comunicaci√≥n. Si se ajustan unos intervalos demasiado cortos
para el muestreo y el env√≠o, este ajuste provocar√° una carga de comunicaci√≥n elevada. Por
ello, seleccione intervalos lo m√°s altos posible pero que sean suficientes para la aplicaci√≥n.
Encontrar√° informaci√≥n sobre la coherencia de variables en Coherencia de variables de CPU
(P√°gina 1337).

Vigilancia de variables PLC
Una vez creada la Subscription, informe al servidor sobre qu√© variables debe vigilar con esta.
En el ejemplo siguiente se ha agregado la variable "Voltage" a la suscripci√≥n.

La variable "Voltage" contiene p. ej. el valor de una magnitud de tensi√≥n capturada por una
CPU S7-1500.
El intervalo de muestreo ("Sampling Interval") contiene un valor negativo (-1). De ese modo se
determina que el ajuste predeterminado del servidor OPC UA se utilice para el intervalo de
muestreo. El ajuste predeterminado est√° determinado por el intervalo de env√≠o ("Publishing

1308

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Interval") de la suscripci√≥n. Para ajustar el intervalo de muestreo m√≠nimo posible, seleccione
el valor "0".
Aqu√≠ en el ejemplo, la longitud de la cola est√° ajustada a "1": Se lee un solo valor,
respectivamente, a intervalos de 50 milisegundos desde la CPU y a continuaci√≥n se env√≠a al
cliente OPC UA si el valor ha cambiado.
En el ejemplo, el par√°metro "Deadband" es "0,1": Los cambios de valor deben ser al menos de
0,1 voltios para que el servidor env√≠e el valor nuevo al cliente. El servidor no env√≠a cambios de
valor m√°s peque√±os que el indicado. Este par√°metro permite, por ejemplo, suprimir el ruido:
peque√±as variaciones de una magnitud de proceso que se consideran insignificantes.

Mapeado de tipos de datos
Tipos de datos SIMATIC y OPC UA
Los tipos de datos SIMATIC no siempre coinciden con los tipos de datos OPC UA.
Las CPU S7-1500 proporcionan al propio servidor OPC UA variables SIMATIC (con tipos de
datos SIMATIC) como tipos de datos OPC UA. As√≠, los clientes OPC UA pueden acceder a
trav√©s de la interfaz del servidor a esas variables con tipos de datos OPC UA.
Un cliente puede leer en dicha variable el atributo "DataType" y reconstruir en SIMATIC el tipo
de datos original.
Ejemplo
Una variable tiene el tipo de datos SIMATIC "COUNTER". En la tabla se lee COUNTER ‚Üí
UInt16. Ahora se sabe que no es necesario recodificar; el valor COUNTER recorre la l√≠nea
como tipo de datos UInt16.
El cliente reconoce por el atributo "DataType" que la variable es en realidad del tipo de datos
SIMATIC "COUNTER". Entonces el cliente reconstruye el tipo de datos.
Tabla 1-101 Tipos de datos SIMATIC y OPC UA
Tipo de datos SIMATIC

Tipo de datos OPC UA

BOOL

Boolean

BYTE

BYTE
‚Üí Byte

WORD

WORD
‚Üí UInt16

DWORD

DWORD
‚Üí UInt32

LWORD

LWORD
‚Üí UInt64

SINT

SByte

INT

Int16

DINT

Int32

LINT

Int64

USINT

Byte

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1309

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tipo de datos SIMATIC

Tipo de datos OPC UA

UINT

UInt16

UDINT

UInt32

ULINT

UInt64

REAL

Float

LREAL

Double

S5TIME

S5TIME
‚Üí UInt16

TIME

TIME
‚Üí Int32

LTIME

LTIME
‚Üí Int64

DATE

DATE
‚Üí UInt16

TIME_OF_DAY (TOD)

TOD
‚Üí UInt32

LTIME_OF_DAY (LTOD)

LTOD
‚Üí UInt64

DATE_AND_TIME (DT)

DT
‚Üí Byte[8]

LDT

DateTime

DTL

mapeado como estructura

Particularidad: solo es posible escribir completa‚Äê
mente la estructura con un cliente OPC UA. En
modo de lectura es posible acceder a elementos
concretos de esta estructura (p. ej. en "YEAR")
CHAR

CHAR
‚Üí Byte

WCHAR

WCHAR
‚Üí UInt16

STRING

STRING

(p√°gina de c√≥digos 1252 o Windows-1252)

‚Üí String

WSTRING

String

(UCS-2; Universal Coded Character Set)
TIMER

TIMER
‚Üí UInt16

COUNTER

COUNTER
‚Üí UInt16

1310

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Matrices
Una orden de lectura o escritura en OPC UA es siempre un acceso matricial, es decir,
b√°sicamente provisto de √≠ndice y longitud. Una variable individual es un caso particular de
matriz (√≠ndice 0 y longitud 1). En la l√≠nea, el tipo de datos se env√≠a varias veces
consecutivamente. En las variables el atributo "DataType" apunta al tipo de datos b√°sico. De
los atributos "ValueRank" y "ArrayDimensions" se deduce si se trata de una matriz y cu√°l es su
tama√±o.

Tipos de datos basados en arrays
Existen tipos de datos SIMATIC en los que un valor OPC UA se refleja en un array de bytes.
Un array de este tipo de datos se refleja entonces en un array bidimensional.
Ejemplo: El tipo de datos SIMATIC DATE_AND_TIME (DT) se mapea en un array de 8 bytes
(byte[8]); consulte la tabla anterior. Si define un array del tipo de datos SIMATIC
DATE_AND_TIME (DT), contar√° como array bidimensional.
Este hecho afecta, p. ej., al uso de tipos de datos de sistema como
OPC_UA_NodeAdditionalInfo y OPC_UA_NodeAdditionalInfoExt:
Para los tipos de datos arriba descritos debe utilizar el tipo de datos de sistema
OPC_UA_NodeAdditionalInfoExt para arrays multidimensionales en lugar de
OPC_UA_NodeAdditionalInfo.

Estructuras
Las estructuras se transfieren como ExtensionObject. El servidor del S7-1500 utiliza la
representaci√≥n binaria para transferir el ExtensionObjects a trav√©s de la l√≠nea, y los diversos
elementos de la estructura se encuentran uno detr√°s del otro. Delante se encuentra el NodeId
del tipo de datos, que sirve para que un cliente averig√ºe la organizaci√≥n de la estructura.
Para ello, en el caso de la especificaci√≥n OPC UA con versi√≥n V1.03 o inferior, un cliente debe
leer, descodificar e interpretar el DataTypeDictionary completo (salvo que lo haya aprendido
antes offline mediante una importaci√≥n XML).
A partir de la versi√≥n V1.04 de OPC UA existe el atributo DataTypeDescription, que se puede
leer e interpretar con m√°s facilidad y rapidez. Un cliente determina la organizaci√≥n de la
estructura una sola vez, antes o durante el primer acceso, y despu√©s utiliza dicha informaci√≥n
mientras dure la sesi√≥n.

Tipos de datos SIMATIC especiales
El cliente OPC UA no soporta los tipos de datos SIMATIC que no aparecen en la tabla superior,
ni los que no se pueden definir como elementos de una estructura o de un tipo de datos PLC.
Son, por ejemplo, los punteros "ANY" o "POINTER", el bloque de funci√≥n "Block_FB", la
funci√≥n "Block_FC" o el tipo de datos de hardware "REMOTE".
Si se selecciona un tipo de datos no soportado se emite un mensaje de error.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1311

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n adicional
Encontrar√° informaci√≥n m√°s detallada sobre el mapeo de los tipos de datos b√°sicos, y tambi√©n
sobre las matrices y estructuras, en la especificaci√≥n de OPC UA Part 6, "Mappings" (v√©ase
"OPC UA BINARY").

Seguridad en OPC UA
Ajustes de seguridad
Afrontar riesgos
OPC UA permite el intercambio de datos entre sistemas diferentes, tanto en los niveles de
proceso y producci√≥n como con sistemas del nivel de control y a nivel empresarial.
Esta posibilidad entra√±a tambi√©n riesgos de seguridad. Por ello, OPC UA ofrece una serie de
mecanismos de seguridad:
‚óè verificaci√≥n de la identidad de servidores y clientes OPC UA;
‚óè verificaci√≥n de la identidad de los usuarios;
‚óè Intercambio de datos firmado/cifrado entre servidores y clientes OPC UA.
Los ajustes de seguridad solo deben soslayarse en casos fundados:
‚óè Durante la puesta en marcha
‚óè En proyectos aislados sin conexi√≥n v√≠a Ethernet con el exterior
Si, p. ej., en el "UA Sample Client" de la OPC Foundation se selecciona el punto final "None",
el programa emite una advertencia clara:

Al compilar el proyecto, STEP 7 comprueba adem√°s si se han tenido en cuenta las
posibilidades de ajuste para la protecci√≥n y advierte sobre los posibles riesgos. Ello incluye

1312

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
tambi√©n una Security Policy OPC UA con el ajuste "Ninguna seguridad", lo que equivale al
punto final "None".
Nota
Desactivar directivas de seguridad (Security Policies) no deseadas
Si en la configuraci√≥n del canal de seguridad del servidor OPC UA del S7-1500 se han activado
todas las directivas de seguridad y, por tanto, tambi√©n el punto final "None" (Ninguna
seguridad), tambi√©n es posible un tr√°fico de datos no seguro entre el servidor y el cliente (sin
firmar ni cifrar). El servidor OPC UA de la CPU S7-1500 env√≠a incluso con "None" (Ninguna
seguridad) su certificado p√∫blico al cliente. Y algunos clientes verifican este certificado. Sin
embargo, el cliente no est√° obligado a enviar un certificado al servidor. Es posible que la
identidad del cliente permanezca desconocida. En tal caso todos los clientes OPC UA pueden
conectarse al servidor, con independencia de todos los ajustes de seguridad que sigan.
En la configuraci√≥n del servidor OPC UA tenga en cuenta que solo est√°n activadas las
directivas de seguridad compatibles con el concepto de protecci√≥n para la m√°quina o
instalaci√≥n. Es necesario desactivar todas las dem√°s directivas de seguridad.
Recomendaci√≥n: Utilice el ajuste "Basic256Sha256 - firmar y cifrar", con el que el servidor solo
acepta certificados Sha256. Las directivas de seguridad "Basic128Rsa15" y "Basic256" est√°n
desactivadas por defecto y no deben utilizarse como punto final. Seleccione los puntos finales
con una Security Policy superior.

Otras reglas de seguridad
‚óè Utilice el punto final "None" solo en casos excepcionales.
‚óè Utilice la "Autenticaci√≥n de hu√©sped" del usuario solo en casos excepcionales.
‚óè Permita el acceso a variables PLC y componentes de DB a trav√©s de OPC UA solo si es
realmente necesario.
‚óè En la configuraci√≥n del cliente OPC US del S7-1500 utilice las listas de clientes de
confianza para permitir el acceso √∫nicamente a determinados clientes.

Certificados seg√∫n X.509 de la UIT
En OPC UA hay integrados mecanismos de seguridad en varias capas. Los certificados
digitales desempe√±an un papel importante. Un cliente OPC UA solo puede establecer una
conexi√≥n segura con un servidor OPC UA si el servidor acepta el certificado digital del cliente
y lo clasifica como certificado de confianza.
Consulte el cap√≠tulo Manejo de certificados de cliente y de servidor (P√°gina 1348).
Adem√°s, el cliente tambi√©n debe comprobar el certificado del servidor y confiar en √©l. Servidor
y cliente deben identificarse y demostrar que son realmente quienes afirman ser: Deben probar
su identidad. La autenticaci√≥n rec√≠proca de cliente y servidor impide, por ejemplo, ataques
mediante "man in the middle".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1313

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ataques por un "man in the middle"
Entre el servidor y el cliente podr√≠a encontrarse un "man in the middle", un programa que
intercepta la comunicaci√≥n entre el servidor y el cliente y afirma ser el cliente o el servidor, con
lo cual puede obtener informaci√≥n importante sobre el programa S7 o activar valores en la CPU
y, por tanto, atacar una m√°quina o instalaci√≥n.
En OPC UA se emplean certificados digitales acordes con el est√°ndar X.509 de la Uni√≥n
Internacional de Telecomunicaciones (UIT).
Dichos certificados permiten demostrar (autenticar) la identidad de un programa, un equipo o
una organizaci√≥n.

Certificados X.509
Un certificado X.509 contiene, entre otras, la informaci√≥n siguiente:
‚óè N√∫mero de versi√≥n del certificado
‚óè N√∫mero de serie del certificado
‚óè Informaci√≥n sobre el algoritmo utilizado por la entidad emisora para firmar el certificado
‚óè Nombre de la entidad emisora
‚óè Inicio y final de la validez del certificado
‚óè Nombre del programa, de la persona o de la organizaci√≥n para el que la entidad emisora ha
firmado el certificado
‚óè La clave p√∫blica del programa, la persona o la organizaci√≥n
Por tanto, un certificado X.509 relaciona una identidad (nombre de un programa, una persona
o una organizaci√≥n) con la clave p√∫blica del programa, la persona o la organizaci√≥n.
Comprobaci√≥n al establecer la conexi√≥n
Al establecer la conexi√≥n entre el cliente y el servidor, los dispositivos comprueban toda la
informaci√≥n del certificado necesaria para determinar la integridad, p. ej. firma, validez o
nombre de aplicaci√≥n (URN), y, a partir de la versi√≥n de firmware V2.5 (solo en esta versi√≥n),
tambi√©n las direcciones IP del cliente en el certificado de cliente.
Nota
Adem√°s, al establecer la conexi√≥n se comprueba el periodo de validez especificado en el
certificado. Por ello es necesario que la hora de la CPU est√© ajustada y que la fecha y la hora
est√©n comprendidas dentro del periodo de validez, ya que de lo contrario no habr√°
comunicaci√≥n.

Firma y cifrado
Para poder supervisar si un certificado ha sido manipulado, los certificados se firman.

1314

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Existen distintos procedimientos:
‚óè Dentro de TIA Portal se pueden generar y firmar certificados. Si el proyecto est√° protegido
y se inicia sesi√≥n como usuario con derecho de funci√≥n para cambiar un ajuste de
seguridad, podr√°n utilizarse tambi√©n los ajustes globales de seguridad. Los ajustes
globales de seguridad permiten acceder al administrador de certificados, y por tanto
tambi√©n a la entidad emisora (CA) de TIA Portal.
‚óè Existen otras posibilidades para generar y firmar certificados. En TIA Portal se pueden
importar certificados al administrador global de certificados.
‚Äì Dirigirse a una entidad emisora (CA) para que firme el certificado.
En este caso la entidad emisora comprueba la identidad del solicitante y firma el
certificado con la clave privada de la entidad emisora. Para ello, transmita un CSR
(Certificate Signing Request) a la entidad emisora.
‚Äì El propio usuario crea un certificado y lo firma.
Para ello utilice, por ejemplo, el programa "Opc.Ua.CertificateGenerator" de la OPC
Foundation. Tambi√©n puede utilizar OpenSSL.
Encontrar√° informaci√≥n m√°s detallada en Autogeneraci√≥n de parejas de claves PKI y de
certificados (P√°gina 1318).

Excurso: tipos de certificados
‚óè Certificado autofirmado:
Cualquier dispositivo genera su propio certificado y lo firma. Ejemplos de aplicaciones:
configuraci√≥n est√°tica con n√∫mero limitado de interlocutores de comunicaci√≥n.
De un certificado autofirmado no pueden derivarse certificados nuevos. Sin embargo, es
necesario cargar en la CPU (debe estar en STOP) todos los certificados autofirmados de
los interlocutores.
‚óè Certificado CA:
Todos los certificados son generados y firmados por una entidad emisora. Ejemplos de
aplicaciones: instalaciones que crecen din√°micamente
Solo es necesario cargar en la CPU el certificado de la entidad emisora. La entidad emisora
puede generar nuevos certificados (es posible agregar interlocutores sin que la CPU est√©
en STOP).

Firma
La firma permite verificar la integridad y el origen de un mensaje, como se describe a
continuaci√≥n.
En la firma, lo primero que hace el emisor es formar un valor hash a partir del texto expl√≠cito
(mensaje expl√≠cito). Despu√©s, el emisor cifra el valor hash con su clave privada y finalmente
transfiere al receptor el texto expl√≠cito junto con el valor hash cifrado. Para comprobar la firma,
el receptor necesita la clave p√∫blica del emisor (est√° incluida en el certificado X.509 del
emisor). Con la clave p√∫blica del emisor, el receptor descifra el valor hash recibido. Despu√©s,
el receptor forma su propio valor hash a partir del texto expl√≠cito recibido (el procedimiento hash

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1315

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
est√° incluido en el certificado del emisor). A continuaci√≥n, el receptor compara ambos valores
hash:
‚óè Si los dos valores hash son id√©nticos, entonces el texto expl√≠cito ha llegado al destinatario
sin alteraciones y sin haber sido manipulado.
‚óè Si los dos valores hash no se corresponden, entonces el texto expl√≠cito recibido por el
destinatario no es id√©ntico al enviado. El texto expl√≠cito ha sido manipulado o ha sido
falsificado durante la transferencia.

Cifrado
El cifrado de datos permite evitar que personas no autorizadas conozcan el contenido. Los
certificados X.509 no se cifran, son p√∫blicos y accesibles a cualquiera.
En el cifrado, el emisor cifra el mensaje expl√≠cito utilizando la clave p√∫blica del receptor. Para
ello, el emisor necesita el certificado X.509 del receptor, puesto que contiene la clave p√∫blica
del receptor. El receptor descifra el mensaje utilizando su clave privada. El receptor es el √∫nico
que puede descifrar el mensaje. Es el √∫nico que posee la clave privada. Por ello no est√°
permitido transmitir la clave privada.

Secure Channel (canal seguro)
OPC UA utiliza las claves privadas y p√∫blicas de cliente y servidor para establecer una
conexi√≥n segura, el canal seguro (secure channel). Una vez establecida la conexi√≥n segura,
cliente y servidor generan una clave interna que solo ellos conocen y que ambos utilizan para
firmar y cifrar mensajes. Este procedimiento sim√©trico (una clave com√∫n) es mucho m√°s r√°pido
que un procedimiento asim√©trico (claves privada y p√∫blica).

Consulte tambi√©n
Crear certificados autofirmados (P√°gina 1317)
Certificados en OPC UA (P√°gina 1317)
Uso de certificados con TIA Portal (https://support.industry.siemens.com/cs/ww/es/view/
109769068)

1316

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Certificados en OPC UA
Uso de certificados X.509 en OPC UA
Para establecer una conexi√≥n entre cliente y servidor, OPC UA utiliza diferentes tipos de
certificados X.509:
‚óè Certificados de aplicaci√≥n OPC UA
Estos certificados X.509 identifican la instancia de software, la instalaci√≥n correspondiente
de un software de cliente o de servidor. En el atributo "Organisation Name" se introduce el
nombre de la empresa que utiliza el software.
Nota
El servidor OPC UA del S7-1500 utiliza certificados de aplicaci√≥n incluso con el ajuste de
seguridad "None" (Ninguna seguridad). De este modo se garantiza la compatibilidad con
OPC UA V1.1 y versiones anteriores.
‚óè Certificados de software OPC UA
Este certificado X.509 identifica una versi√≥n concreta del software de cliente o servidor.
Estos certificados contienen atributos que describen qu√© pruebas ha superado la versi√≥n
de software en la certificaci√≥n realizada por OPC Foundation (o el laboratorio de prueba
reconocido). En el atributo "Organisation Name" se introduce el nombre de la empresa que
ha desarrollado el software (o que lo distribuye).
Nota
En STEP 7 no se soportan certificados de software.
‚óè Certificados de usuario OPC UA
Este certificado X.509 identifica al usuario concreto que, por ejemplo, solicita datos de
proceso del servidor OPC UA de una CPU S7-1500. Este certificado no es obligatorio si el
usuario puede demostrar que tiene autorizaci√≥n mediante una contrase√±a o si se ha
configurado un acceso an√≥nimo.
Nota
En STEP 7 no se soportan certificados de usuario.
Estos certificados son certificados de entidad final (end-entity): Identifican, por ejemplo, una
entidad, una persona, una organizaci√≥n, una empresa, una instancia (instalaci√≥n) de un
software.

Crear certificados autofirmados
Utilizar el generador de certificados del cliente
Muchas aplicaciones de cliente OPC UA o SDK est√°n integradas en una aplicaci√≥n de ejemplo
que permite generar certificados para el cliente desde esta aplicaci√≥n.
Encontrar√° la descripci√≥n general de la generaci√≥n de certificados en el contexto relativo a la
descripci√≥n de la aplicaci√≥n de cliente OPC UA.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1317

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Ejemplo de cliente del Online Support
Durante el primer arranque del programa, el cliente OPC UA .NET para el servidor SIMATIC
S7-1500 OPC UA (https://support.industry.siemens.com/cs/ww/es/view/109737901) genera
un certificado de software autofirmado de la aplicaci√≥n de cliente en el Windows Certificate
Store. La documentaci√≥n relativa a este ejemplo describe c√≥mo trabajar con estos certificados.

Utilizar el generador de certificados de TIA Portal
Si se utiliza un cliente OPC UA que no genere ning√∫n certificado de cliente, se podr√°n crear
certificados autofirmados con STEP 7.
Para ello, proceda del siguiente modo:
1. En las propiedades de la CPU, en "Protecci√≥n y seguridad > Administrador de certificados
> Certificados de dispositivo", haga doble clic en "<Agregar nuevo>".
2. Haga clic en "Agregar".
3. En el cuadro de di√°logo "Generar nuevo certificado", seleccione en "Finalidad de uso" la
opci√≥n "Cliente OPC UA".
4. Haga clic en "Aceptar".
En la columna "Nombre alternativo del solicitante" (Subject Alternative Name), STEP 7
introduce autom√°ticamente la URI del certificado creado. Por ejemplo, al crear el certificado
mediante programaci√≥n a trav√©s de la pila .NET de OPC Foundation, el campo se llama
"ApplicationUri", mientras que en otras herramientas de creaci√≥n de certificados puede tener
otro nombre.

Consulte tambi√©n
Tratamiento de los certificados de cliente de la CPU S7-1500 (P√°gina 1444)

Autogeneraci√≥n de parejas de claves PKI y de certificados
Este cap√≠tulo solo es relevante cuando se quiere utilizar un cliente OPC UA que no es capaz
de generar por s√≠ mismo una pareja de claves PKI y un certificado de cliente. En tal caso, se
crea con OpenSSL una clave privada y una p√∫blica, se genera un certificado X.509 y se
autofirma el certificado.

Utilizar OpenSSL
OpenSSL es una herramienta para Transport Layer Security, que puede utilizarse para
generar certificados. Tambi√©n es posible utilizar otras herramientas, p. ej. XCA, un software de
administraci√≥n de claves con interfaz gr√°fica para tener una mejor visi√≥n de los certificados
emitidos.
Para trabajar con OpenSSL en Windows, proceda del modo siguiente:
1. Instale OpenSSL en Windows. Si se utiliza una versi√≥n del sistema operativo de 64 bits,
instale OpenSSL, por ejemplo, en el directorio "C:\OpenSSL-Win64". Puede descargar
OpenSSL-Win64 de distintos proveedores de software de c√≥digo abierto.
2. Cree un directorio, por ejemplo "C:\demo".

1318

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Abra la l√≠nea de comando (s√≠mbolo del sistema). Para ello, haga clic en "Start" y, en el
campo de b√∫squeda, introduzca "cmd" o "S√≠mbolo del sistema". En la lista de resultados,
haga clic con el bot√≥n derecho del rat√≥n en "cmd.exe" o "S√≠mbolo del sistema" y ejecute el
programa como administrador. Windows abrir√° el s√≠mbolo del sistema.
4. Vaya al directorio "C:\demo". Para ello, introduzca el comando siguiente: "cd C:\demo".
5. Active las variables de entorno siguientes:
‚Äì set RANDFILE=c:\demo\.rnd
‚Äì set OPENSSL_CONF=C:\OpenSSL-Win64\bin\openssl.cfg
La figura siguiente muestra la l√≠nea de comando con los comandos:

6. Inicie OpenSSL. Si OpenSSL se hab√≠a instalado en el directorio C:\OpenSSL-Win64 ,
introduzca: C:\OpenSSL-Win64\bin\openssl.exe. La figura siguiente muestra la l√≠nea de
comando con el comando:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1319

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. Genere una clave privada. Guarde la clave en el archivo "myKey.key". En este ejemplo la
clave tiene 1024 bits de longitud; para aumentar la seguridad de RSA, en la pr√°ctica utilice
2048 bits. Introduzca el comando siguiente: "genrsa -out myKey.key 2048" (en el ejemplo
"genrsa -out myKey.key 1024"). La figura siguiente muestra la l√≠nea de comando con el
comando y la respuesta de OpenSSL:

8. Genere una CSR (Certificate Signing Request), una petici√≥n de firma para un certificado.
Para ello, introduzca el comando siguiente: "req -new -key myKey.key -out myRequest.csr".
Mientras se ejecuta este comando, OpenSSL le preguntar√° datos de su certificado:
‚Äì Country Name: por ejemplo "DE" para Alemania, "FR" para Francia
‚Äì State or Province Name: p. ej. "Baviera"
‚Äì Location Name: p. ej. "Augsburgo"
‚Äì Organisation Name: Introduzca el nombre de su empresa.
‚Äì Organisational Unit Name: p. ej. "IT"
‚Äì Common Name: p. ej. "Cliente OPC UA de la m√°quina A"
‚Äì Email Address:
Nota
Nota para CPU S7-1500 como servidor con versi√≥n de firmware V2.5
En las CPU S7-1500 versi√≥n V2.5 (solo en esa versi√≥n), la direcci√≥n IP del programa de cliente
debe estar depositada en el campo "Nombre alternativo del firmante" (Subject Alternative
Name) del certificado creado; en caso contrario, la CPU no acepta el certificado.
sus datos se agregar√°n al certificado. La figura siguiente muestra la l√≠nea de comando con el
comando y la respuesta de OpenSSL:

El comando crea en el directorio C:\demo un archivo que contiene la Certificate Signing
Request (CSR); en el ejemplo, "myRequest.csr".

1320

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Uso de la CSR
Es posible utilizar una CSR de dos formas:
‚óè Enviando la CSR a una entidad emisora (CA): Para ello, siga las indicaciones de la
correspondiente entidad emisora. La entidad emisora (CA) comprueba sus datos y su
identidad (autenticaci√≥n) y firma el certificado con la clave privada de la entidad emisora.
Recibir√° el certificado X.509 firmado y lo podr√° utilizar, por ejemplo, para OPC UA, HTTPS
o Secure OUC (secure open user communication). Sus interlocutores comprueban
mediante la clave p√∫blica de la entidad emisora si su certificado ha sido realmente emitido
y firmado por dicha entidad (es decir, que sus datos han sido confirmados en el certificado
por la entidad emisora).
‚óè Autofirmando la CSR: Para ello, utilice su clave privada. Esta posibilidad se muestra en el
paso siguiente.

Autofirma de certificados
Para poder generar y firmar su propio certificado (certificado autofirmado) introduzca el
comando siguiente: "x509 -req -days 365 -in myRequest.csr -signkey myKey.key -out
myCertificate.crt".
La figura siguiente muestra la l√≠nea de comando con el comando y la respuesta de OpenSSL:

El comando crea un certificado X.509 con los atributos que se han transferido con la CSR (en
el ejemplo, "myRequest.csr"), p. ej. con una validez de un a√±o (-days 365). Adem√°s, el
comando firma el certificado con su clave privada (en el ejemplo, "myKey.key"). Los
interlocutores pueden comprobar mediante las claves p√∫blicas (contenidas en el certificado)
que usted realmente posee la clave privada perteneciente a esta clave p√∫blica. De este modo
se excluye la posibilidad de que la clave p√∫blica haya sido mal utilizada por un atacante.
En los certificados autofirmados el propio usuario certifica que los datos del certificado son
correctos. No hay ninguna entidad independiente que verifique los datos.

Consulte tambi√©n
Tratamiento de los certificados de cliente de la CPU S7-1500 (P√°gina 1444)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1321

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Transferencia segura de mensajes
Establecimiento de conexiones seguras en OPC UA
OPC UA utiliza conexiones seguras entre cliente y servidor. Para ello, OPC UA comprueba la
identidad de los interlocutores. Para autenticar a cliente y servidor, OPC UA utiliza certificados
acordes con X.509-V3 de la UIT (International Telecommunication Union). Excepci√≥n: Con la
Security Policy "Ninguna seguridad" no se establece una conexi√≥n segura.

Message Security Modus
OPC UA utiliza las siguientes directivas de seguridad (Security Policies) para la protecci√≥n de
mensajes:
‚óè Ninguna seguridad
Ning√∫n mensaje est√° protegido. Para utilizar esta directiva de seguridad (Security Policy),
establezca una conexi√≥n con un punto final None de un servidor.
‚óè Firma
Todos los mensajes se firman. De este modo se comprueba la integridad de los mensajes
recibidos. Se detectan las manipulaciones. Para utilizar esta Security Policy, establezca
una conexi√≥n con un punto final Sign de un servidor.
‚óè Firmar y cifrar
Todos los mensajes se firman y cifran. De este modo se comprueba la integridad de los
mensajes recibidos. Se detectan las manipulaciones. Adem√°s, ning√∫n atacante puede leer
el contenido del mensaje (protecci√≥n de la confidencialidad). Para utilizar esta directiva de
seguridad (Security Policy), establezca una conexi√≥n a un punto final "SignAndEncrypt" de
un servidor.
Las directivas de seguridad se denominan adicionalmente seg√∫n los algoritmos utilizados.
Ejemplo: "Basic256Sha256 - Firmar y cifrar" significa: Punto final protegido, soporta una serie
de algoritmos para hashing de 256 bits y cifrado de 256 bits.

Capas necesarias
La figura siguiente muestra las tres capas (capa de transporte, canal seguro y sesi√≥n) que son
necesarias siempre para establecer una conexi√≥n.
&OLHQWH23&8$
&DSDGHDSOLFDFL¬µQ
‡≤¶$XWRUL]DFL¬µQGHXVXDULR
‡≤¶$XWHQWLFDFL¬µQGHXVXDULR
&DSDGHFRPXQLFDFL¬µQ
‡≤¶&RQILGHQFLDOLGDG
‡≤¶,QWHJULGDG
‡≤¶$XWHQWLFDFL¬µQ$SS

6HUYLGRU23&8$
6HVVLRQ

6HFXUH&KDQQHO

&DSDGHDSOLFDFL¬µQ
‡≤¶$XWRUL]DFL¬µQGHXVXDULR
‡≤¶$XWHQWLFDFL¬µQGHXVXDULR
&DSDGHFRPXQLFDFL¬µQ
‡≤¶&RQILGHQFLDOLGDG
‡≤¶,QWHJULGDG
‡≤¶$XWHQWLFDFL¬µQ$SS

&DSDGHWUDQVSRUWH

1322

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Figura 1-71

Capas necesarias: capa de transporte, Secure Channel y Session

‚óè Capa de transporte:
Esta capa env√≠a y recibe mensajes. Para ello, OPC UA emplea un protocolo binario
optimizado basado en TCP. La capa de transporte es la base para el canal seguro
subsiguiente.
‚óè Secure Channel (canal seguro)
El canal seguro recibe de la capa de transporte los datos recibidos y los reenv√≠a a la sesi√≥n.
El canal seguro reenv√≠a a la capa de transporte los datos de sesi√≥n que deben enviarse.
En el modo de seguridad "Sign", el canal seguro firma los datos (mensajes) que se env√≠an.
Cuando se reciben mensajes, el canal seguro verifica la firma para detectar posibles
manipulaciones.
Con una Security Policy "SignAndEncrypt", el canal seguro firma y cifra los datos que se
env√≠an. Los datos recibidos los descifra el canal seguro. A continuaci√≥n el canal seguro
verifica la firma.
Con la Security Policy "Sin seguridad", los paquetes de mensajes pasan por el canal seguro
sin modificaciones (los mensajes se reciben y emiten en texto expl√≠cito).
‚óè Session
La sesi√≥n reenv√≠a los mensajes desde el canal seguro a la aplicaci√≥n, o recibe de la
aplicaci√≥n los mensajes que deben enviarse. La aplicaci√≥n utiliza los valores de proceso o
proporciona los valores.

Establecimiento del canal seguro
El canal seguro se establece del modo siguiente:
1. El servidor comienza a establecer el canal seguro cuando recibe una orden del cliente. Esta
petici√≥n est√° firmada o firmada y cifrada, o bien el mensaje se ha enviado en texto expl√≠cito
(modo de seguridad del punto final servidor seleccionado). Con "Firmar" y "Firmar y cifrar",
el cliente env√≠a un "secreto" (un n√∫mero aleatorio) junto con la petici√≥n (request).
2. El servidor valida el certificado del cliente (incluido sin cifrar en la petici√≥n) y comprueba la
identidad del cliente. Si el servidor conf√≠a en el certificado del cliente,
‚Äì descifra el mensaje y comprueba la firma ("Firmar y cifrar")
‚Äì o comprueba tan solo la firma ("Firmar")
‚Äì o deja el mensaje sin modificar ("Ninguna seguridad").
3. Despu√©s el servidor env√≠a una respuesta al cliente (protegida de igual forma que la
petici√≥n). En la respuesta se incluye el secreto del servidor. A partir del secreto de cliente
y servidor, ambos calculan una clave sim√©trica. De este modo se ha establecido el canal
seguro.
La clave sim√©trica se utiliza solo para firmar y cifrar mensajes (en lugar de las claves privadas
y p√∫blicas de cliente y servidor).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1323

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Establecimiento de la sesi√≥n
La sesi√≥n se establece del modo siguiente:
1. El cliente inicia el establecimiento de la sesi√≥n enviando una CreateSessionRequest al
servidor. Dicho mensaje incluye un Nonce, un n√∫mero aleatorio utilizado una sola vez. El
servidor debe firmar este n√∫mero aleatorio (Nonce) para demostrar que es el titular de la
clave privada. La clave privada corresponde al certificado utilizado por el servidor al
establecer el canal seguro. Este mensaje (al igual que todos los siguientes) est√° protegido
conforme a los ajustes de seguridad del punto final seleccionado del servidor (Security
Policies seleccionadas).
2. El servidor responde con la CreateSession Response. Este mensaje contiene la clave
p√∫blica del servidor y el Nonce firmado. El cliente comprueba el Nonce firmado.
3. Si el servidor ha superado la prueba, el cliente env√≠a al servidor una
SessionActivateRequest. Este mensaje contiene los datos que son necesarios para la
autenticaci√≥n del usuario:
‚Äì nombre de usuario y contrase√±a,
‚Äì el certificado X.509 del usuario (no soportado en STEP 7)
‚Äì o ning√∫n dato (si se ha configurado un acceso an√≥nimo).
4. Si el usuario dispone de los derechos necesarios, el servidor devuelve un mensaje al cliente
(ActivateSessionResponse). De este modo se activa la sesi√≥n.
La conexi√≥n segura entre el cliente y el servidor OPC UA est√° establecida.

Establecimiento de una conexi√≥n con bloques de funci√≥n PLCopen
La especificaci√≥n PLCopen ha definido una serie de bloques de funci√≥n IEC 61131 para
clientes OPC UA. La instrucci√≥n UA_Connect inicia tanto un canal seguro como una sesi√≥n
seg√∫n el patr√≥n descrito anteriormente.

Uso de la CPU S7-1500 como servidor OPC UA
Informaci√≥n importante sobre el servidor OPC UA de las CPU S7-1500
El servidor OPC UA de las CPU S7-1500
Las CPU S7-1500 con versi√≥n de firmware 2.0 o superior cuentan con un servidor OPC UA.
Adem√°s de las CPU S7-1500 est√°ndar, aqu√≠ tambi√©n se incluyen las variantes S7-1500F,
S7-1500T, S7-1500C, las CPU S7-1500pro, las CPU ET 200SP, el controlador por software
SIMATIC S7-1500 y PLCSIM Advanced.
Convenci√≥n: el t√©rmino "CPU S7-1500" incluye todas las variantes de CPU citadas arriba.

Principios b√°sicos del servidor OPC UA de la CPU S7-1500
Es posible acceder al servidor OPC UA de la CPU a trav√©s de todas las interfaces Ethernet
integradas de la CPU S7-1500.

1324

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
A trav√©s del CP es posible acceder directamente al servidor OPC UA de la CPU a trav√©s del
bus de fondo del sistema de automatizaci√≥n bajo las condiciones siguientes:
‚óè Configuraci√≥n con TIA Portal versi√≥n V16 o superior
‚óè CPU S7-1500 con versi√≥n de firmware 2.8 o superior y CP 1543-1 con versi√≥n de firmware
V2.2 o superior
Encontrar√° informaci√≥n sobre la configuraci√≥n en Acceso a aplicaciones OPC UA
(P√°gina 1298).
A trav√©s de CM no es posible acceder directamente al servidor OPC UA de la CPU por el bus
de fondo del sistema de automatizaci√≥n.
Para el acceso por clientes, el servidor guarda las variables PLC habilitadas y otra informaci√≥n
en forma de nodos (consulte AUTOHOTSPOT). Estos nodos est√°n conectados entre s√≠ y
forman una red. OPC UA define puntos de acceso a esa red (well-known nodes) que permiten
navegar hasta nodos subordinados.
Con un cliente OPC UA es posible leer, observar o escribir valores de variables del programa
del PLC, adem√°s de llamar m√©todos proporcionados por el servidor. A partir de la versi√≥n de
firmware 2.5 existe la posibilidad de implementar m√©todos; consulte Informaci√≥n importante
sobre m√©todos de servidor (P√°gina 1388).

Clases de nodos
Los servidores OPC UA proporcionan informaci√≥n en forma de nodos (nodes). Un nodo puede
ser, por ejemplo, un objeto, una variable, un m√©todo o una propiedad.
El siguiente ejemplo muestra el √°rea de direcciones del servidor OPC UA de una CPU S7-1500
(extracto del cliente OPC UA "UaExpert" de Unified Automation).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1325

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-72

Ejemplo del espacio de direcciones del servidor OPC UA de una CPU S7-1500

En la figura superior se ha seleccionado (sobre fondo gris) la variable "MyValue".
Esta variable se encuentra bajo el nodo "Memory", que pertenece a la clase de nodo "Object".
A su vez, "Memory" se encuentra bajo el nodo "PLC_1" (asimismo un Object).

Espacio de direcciones
Los nodos est√°n unidos entre s√≠ mediante referencias, por ejemplo mediante la referencia
"HasComponent", que refleja una relaci√≥n jer√°rquica entre un nodo y sus nodos subordinados.
Mediante sus referencias, los nodos componen una red que puede tener, por ejemplo, forma
de √°rbol.
Una red formada por nodos tambi√©n se denomina √°rea de direcciones. Partiendo de la ra√≠z se
accede a todos los nodos del √°rea de direcciones.

1326

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Puntos finales de los servidores OPC UA
Los puntos finales del servidor OPC UA definen el nivel de seguridad para una conexi√≥n.
Seg√∫n la finalidad de aplicaci√≥n o el nivel de seguridad deseado, en el punto final deben
realizarse los ajustes correspondientes a la conexi√≥n.

Distintos ajustes de seguridad
Antes de establecer una conexi√≥n segura los clientes OPC UA solicitan al servidor informaci√≥n
sobre qu√© ajustes de seguridad son necesarios para establecer conexiones. El servidor
devuelve una lista con todos los ajustes de seguridad (puntos finales) que ofrece.

Configuraci√≥n de puntos finales
Los puntos finales constan de los siguientes componentes:
‚óè Identificaci√≥n para OPC: "opc.tcp"
‚óè Direcci√≥n IP: 192.168.178.151 (en el ejemplo)
‚óè N√∫mero de puerto para OPC UA: 4840 (puerto est√°ndar)
El n√∫mero de puerto es configurable.
‚óè Ajuste de seguridad para mensajes (Message Security Modus): None, Sign,
SignAndEncrypt.
‚óè Procedimiento de cifrado y hash (Security Policy): None, Basic128Rsa15, Basic256,
Basic256Sha256 (en el ejemplo).
La figura siguiente muestra el programa "UA Sample Client" de OPC Foundation.
El cliente ha establecido una conexi√≥n segura con el servidor OPC UA de una CPU S7-1500,
con el punto final "opc.tcp://192.168.178.151:4840 - [SignAndEncrypt:
Basic256Sha256:Binary]". El punto final contiene los ajustes de seguridad
"SignAndEncrypt:Basic256Sha256".
Nota
Seleccionar un punto final con la mayor directiva de seguridad (Security Policy) posible
Seleccione para los puntos finales una directiva de seguridad (Security Policy) adecuada a la
aplicaci√≥n y desactive en el servidor OPC UA la directiva de seguridad menor.
Para los puntos finales m√°s seguros (Basic256Sha256) del servidor OPC UA de la CPU
S7-1500 se necesita un certificado Sha256.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1327

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Una conexi√≥n con un punto final del servidor solo se establece si el cliente OPC UA cumple los
ajustes de seguridad exigidos para el punto final.

Informaci√≥n proporcionada por el servidor OPC UA
Los servidores OPC UA proporcionan numerosa informaci√≥n:
‚óè Los valores de variables PLC y de componentes de DB a los que pueden acceder los
clientes.
‚óè Los tipos de datos de esas variables PLC y componentes de DB.
‚óè Datos sobre el propio servidor OPC UA y sobre la CPU.
Con ella, los clientes pueden hacerse una visi√≥n general y leer informaci√≥n espec√≠fica. No se
necesitan conocimientos previos sobre el programa PLC ni sobre los datos de la CPU. No es
necesario preguntar al desarrollador del programa PLC cu√°ndo deben leerse las variables
PLC. En el propio servidor est√°n guardados todos los datos necesarios (por ejemplo, los tipos
de datos de las variables PLC).

Visualizaci√≥n de la informaci√≥n del servidor OPC UA
Existen las siguientes posibilidades:
‚óè Online: Toda la informaci√≥n disponible se visualiza durante el tiempo de ejecuci√≥n del
servidor OPC UA. Para ello, navegue por el √°rea de direcciones del servidor.
‚óè Offline: Exporte un archivo XML basado en los esquemas XML de la OPC Foundation.
A partir de STEP 7 V15.1 se exportan conjuntamente los m√©todos de servidor (instancia de
FB que puede ser llamada por un cliente OPC UA) creados, consulte AUTOHOTSPOT.

1328

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Offline con la API Openness: En el programa se utiliza la API (Application Programming
Interface) del TIA Portal para ejecutar la funci√≥n de exportaci√≥n de todas las variables PLC
legibles por OPC UA. Para ello se necesita .NET Framework 4.0, v√©ase TIA Portal
Openness, Automatizaci√≥n de proyectos SIMATIC mediante scripts (https://
support.industry.siemens.com/cs/ww/es/view/109477163).
‚óè Si ya se conoce la sintaxis y el programa PLC puede accederse al servidor OPC UA sin
averiguaciones previas.

Comportamiento del servidor OPC UA durante el funcionamiento
El servidor OPC UA en funcionamiento
El servidor OPC UA de la CPU S7-1500 arranca cuando se activa el servidor y se carga el
proyecto en la CPU.
Aqu√≠ se describe c√≥mo activar el servidor OPC UA.
Reacci√≥n al estado operativo STOP de la CPU
Un servidor OPC UA permanece en funcionamiento aunque la CPU cambie al estado
operativo "STOP". Entonces el servidor OPC UA contin√∫a respondiendo a consultas de
clientes OPC UA.
Comportamiento concreto del servidor:
‚óè Cuando se consultan valores de variables PLC se obtienen los valores actuales antes de
que la CPU cambiara al estado operativo "STOP".
‚óè Si se escriben valores en el servidor OPC UA, el servidor OPC UA aplica dichos valores.
Pero la CPU no procesa los valores porque el programa de usuario no se ha ejecutado en
el estado operativo "STOP".
Sin embargo, un cliente OPC UA puede leer en el servidor OPC UA de la CPU los valores
escritos en el estado operativo STOP.
En el rearranque normal la CPU sobrescribe los valores escritos en el estado operativo
STOP con los valores de arranque de las variables PLC.
‚óè Cuando se llama a un m√©todo de servidor se recibe el mensaje de error 16#00AF_0000
(BadInvalidState), porque no se puede ejecutar el m√©todo de servidor (programa de
usuario).
‚óè En una transici√≥n de estado operativo (STOP > RUN o bien RUN > STOP) las conexiones
con el servidor OPC UA se mantienen. Excepci√≥n: se cargan datos relevantes para OPC
UA; consulte el apartado siguiente.

La carga de la CPU puede influir en el servidor OPC UA
Si se carga una CPU estando en funcionamiento un servidor OPC UA, es posible que deba
pararse y reiniciarse el servidor, seg√∫n cuales sean los objetos cargados. En este caso, las
conexiones activas se interrumpen y deben volver a establecerse una vez reiniciado el
servidor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1329

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El tiempo de reinicio depende especialmente de los par√°metros siguientes:
‚óè del volumen de la estructura de datos
‚óè del n√∫mero de variables visibles en el espacio de direcciones OPC UA
‚óè del ajuste de la definici√≥n de tipos de datos compatibles con versiones anteriores seg√∫n la
especificaci√≥n OPC UA hasta V1.03 (TypeDictionary activado)
‚óè Encontrar√° m√°s informaci√≥n sobre los ajustes de la carga por comunicaci√≥n y el tiempo
m√≠nimo de ciclo aqu√≠.
En las versiones de firmware de la CPU anteriores a V2.8, el servidor OPC UA se deten√≠a con
cada carga en la CPU y luego se reiniciaba.
A partir de la versi√≥n de firmware V2.8, el comportamiento del servidor OPC UA se optimiz√≥ del
siguiente modo:
‚óè Al cargar objetos con la CPU en estado operativo STOP, el servidor OPC UA se sigue
deteniendo y a continuaci√≥n se reinicia. En este caso, STEP 7 no muestra advertencia
alguna.
‚óè Al cargar objetos en estado operativo RUN de la CPU, el servidor OPC UA solo se detiene
si los objetos cargados son o podr√≠an ser relevantes para OPC UA. Tras una reinicializaci√≥n
causada por la modificaci√≥n de datos OPC UA, el servidor OPC UA reinicia.
Antes de que se carguen en la CPU objetos relevantes para OPC UA y se detenga el
servidor OPC UA, STEP 7 muestra una advertencia en el cuadro de di√°logo de vista
preliminar a la carga. En ese momento es posible decidir si un reinicio del servidor es
compatible con el proceso en curso o si es preferible cancelar la carga. Estas advertencias
solo se muestran si el servidor OPC UA est√° funcionando. Si el servidor OPC UA no est√°
activado, los datos OPC UA modificados no influyen en la operaci√≥n de carga.
Ejemplos
‚óè Debe agregarse un bloque l√≥gico m√°s al programa.
Esto no afecta ni a bloques de datos ni a entradas, salidas, marcas, temporizadores o
contadores.
Reacci√≥n al cargar: un servidor OPC UA que est√© funcionando no se interrumpe.
‚óè Debe cargarse un nuevo bloque de datos que se ha marcado como no relevante para OPC
UA.
Reacci√≥n al cargar: un servidor OPC UA que est√© funcionando no se interrumpe.
‚óè Debe sobrescribirse un bloque de datos.
Reacci√≥n al cargar: se muestra una advertencia indicando que el servidor reiniciar√°.
Aclaraci√≥n: STEP 7 no puede determinar si los cambios afectan a datos relevantes para
OPC UA o no.

1330

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Leer el estado operativo de la CPU a trav√©s del servidor OPC UA
El servidor OPC UA permite leer el estado operativo de la CPU, consulte la figura siguiente:

Adem√°s del estado operativo de la CPU, tambi√©n es posible leer, p. ej., informaci√≥n sobre el
manual (DeviceManual) o sobre la versi√≥n de firmware (HardwareRevision).

Configurar el acceso a variables PLC
Administrar derechos de escritura y lectura
Habilitar variables PLC y variables DB para OPC UA
Los clientes OPC UA pueden acceder a variables PLC y variables DB en modo de lectura y
escritura si las variables est√°n habilitadas para OPC UA (ajuste predeterminado). Las
variables habilitadas tienen activada la casilla de verificaci√≥n "Accesible desde HMI/OPC UA".
El ajuste predeterminado se puede cambiar en la configuraci√≥n de TIA Portal: comando
"Configuraci√≥n > Programaci√≥n de PLC > General" en el men√∫ "Opciones". En el √°rea "Interfaz
de bloque/Elementos de bloques de datos" encontrar√° las opciones correspondientes.
El ejemplo siguiente muestra un bloque de datos Array:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1331

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Los clientes OPC UA pueden leer todo el array en una sola operaci√≥n (consulte
Direccionamiento de nodos (P√°gina 1301)). En todos los componentes del array est√°n
activadas las casillas de verificaci√≥n "Accesible desde HMI/OPC UA" y "Escribible desde HMI/
OPC UA".
Resultado: los clientes OPC UA pueden leer estos componentes y escribir en ellos.

Suprimir derechos de escritura
Si desea proteger una variable contra accesos de escritura, desactive en dicha variable la
opci√≥n "Escribible desde HMI/OPC UA". De este modo se retira a los clientes OPC UA y a los
dispositivos HMI el derecho de escritura.
Resultado: los clientes OPC UA y los dispositivos HMI √∫nicamente tienen acceso de lectura.
Los clientes OPC UA no pueden asignar valores a esa variable, ni por tanto influir en la
ejecuci√≥n del programa S7.

Suprimir derechos de escritura y lectura
Para proteger una variable contra accesos de escritura y lectura, desactive en dicha variable
la opci√≥n "Accesible desde HMI/OPC UA" (marca de verificaci√≥n no activada). De este modo,
el servidor OPC UA elimina la variable de su √°rea de direcciones. Los clientes OPC UA ya no
ven esta variable de CPU.
Resultado: Los clientes OPC UA y los dispositivos HMI no pueden ni leer ni escribir la variable.

Derechos de escritura y lectura de estructuras
Si se retira el derecho de escritura o lectura a un componente de una estructura, ya no se podr√°
escribir ni leer la estructura o el bloque de datos como una unidad.
Si se retiran derechos de escritura y de lectura a componentes concretos de un tipo de datos
PLC (UDT) tambi√©n se les retiran de un bloque de datos basado en el UDT.

Visible en HMI Engineering
La opci√≥n "Visible en HMI Engineering" se refiere a herramientas de ingenier√≠a de Siemens. Si
se desactiva la opci√≥n "Visible en HMI Engineering" (marca de verificaci√≥n no activada), ya no
se podr√° configurar la variable en WinCC (TIA Portal).

1332

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La opci√≥n no tiene repercusi√≥n en OPC UA.

Reglas
‚óè No permita en STEP 7 accesos de lectura a variables PLC y variables de bloques de datos
m√°s que cuando sea necesario para la comunicaci√≥n con otros sistemas (controladores,
sistemas integrados, MES).
No deben habilitarse otras variables PLC.
‚óè Garantice accesos de escritura a trav√©s de OPC UA solo si los derechos de escritura son
realmente necesarios con determinadas variables PLC y variables de bloques de datos.
‚óè Si ha desactivado la opci√≥n "Accesible desde HMI/OPC UA" para todos los elementos de
un bloque de datos, en el espacio de direcciones del servidor OPC UA de la CPU S7-1500
este bloque de datos dejar√° de estar visible para un cliente OPC UA.
‚óè Tambi√©n es posible evitar centralizadamente el acceso a un bloque de datos completo
(consulte Administrar derechos de escritura y lectura para un DB completo (P√°gina 1333)).
Este ajuste prevalece sobre los ajustes de los componentes en el editor de DB.

Consulte tambi√©n
Coordinar derechos de escritura y lectura para variables de CPU (P√°gina 1335)

Administrar derechos de escritura y lectura para un DB completo
Ocultar DB o contenidos de DB para clientes OPC UA
Existe la posibilidad de impedir de manera sencilla que un cliente OPC UA acceda a un bloque
de datos completo.
De esta forma, los datos del respectivo DB, tambi√©n DB de instancia de bloques de funci√≥n, se
mantienen ocultos para los clientes OPC UA.
El ajuste predeterminado es que los bloques de datos de clientes OPC UA sean legibles y
escribibles. Este ajuste predeterminado se puede cambiar en la configuraci√≥n de TIA Portal:
comando "Configuraci√≥n > Programaci√≥n de PLC > General" en el men√∫ "Opciones". En el
√°rea "Ajuste predeterminado para bloques nuevos" encontrar√° la opci√≥n correspondiente.

Procedimiento
Para ocultar por completo un bloque de datos a los clientes OPC UA, o para protegerlo contra
accesos de escritura de clientes OPC UA, proceda del siguiente modo:
1. En el √°rbol del proyecto, seleccione el bloque de datos que desea proteger.
2. Seleccione el men√∫ contextual "Propiedades".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1333

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Seleccione el √°rea "Atributos".
4. Active o desactive la casilla de verificaci√≥n "DB accesible desde OPC UA" seg√∫n sus
necesidades.

Nota
Influencia sobre los ajustes en el editor de DB
Si se oculta un DB mediante el atributo DB aqu√≠ descrito, los ajustes de los componentes en
el editor de DB dejan de ser relevantes; ya no se podr√° acceder a componentes concretos ni
escribir en ellos.

Sugerencia: usar la vista general de todos los bloques de programa
Si se usan varios bloques de datos, es conveniente utilizar la vista detallada de la carpeta
"Bloques de programa" para conectar o desconectar selectivamente la accesibilidad OPC UA.
Proceda del siguiente modo:
1. Seleccione la carpeta "Bloques de programa" en el √°rbol del proyecto.
2. Active el comando "Vista general" en el men√∫ "Vista".
3. Seleccione la ficha "Detalles".
Se mostrar√° una vista general de los bloques con sus atributos.
4. Aseg√∫rese de que est√° activada la columna "Bloque de datos accesible a trav√©s de OPC
UA".
5. Active solo los bloques de datos a los que se va a acceder a trav√©s de OPC UA.

1334

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Coordinar derechos de escritura y lectura para variables de CPU
Definici√≥n de derechos de escritura y lectura en el modelo de informaci√≥n (XML OPC UA)
En el modelo de informaci√≥n OPC UA el acceso a las variables lo regula el atributo
"AccessLevel".
AccessLevel est√° definido bit a bit:
Bit 0 = CurrentRead y Bit 1 = CurrentWrite. El significado de las combinaciones de bits es el
siguiente:
‚óè AccessLevel = 0: ning√∫n acceso
‚óè AccessLevel = 1: read only
‚óè AccessLevel = 2: write only
‚óè AccessLevel = 3: read+write
Ejemplo de asignaci√≥n de derechos de escritura y lectura (read+write)

Definici√≥n de derechos de escritura y lectura en STEP 7
Al definir variables defina los derechos de acceso con las propiedades "Accesible desde HMI/
OPC UA‚Äú y "Escribible desde HMI/OPC UA".
Ejemplo de asignaci√≥n de derechos de escritura y lectura

Interacci√≥n de derechos de escritura y lectura
Si se ha importado una interfaz de servidor OPC UA y en este archivo XML OPC UA hay
activados atributos AccessLevel, los derechos de escritura y lectura resultantes derivan de la
siguiente regla: son efectivos los derechos de acceso m√°s limitados de ambas
configuraciones.
Ejemplo
‚óè AccessLevel = 1 (read only) en la interfaz del servidor OPC UA
‚óè Tanto "Accesible desde HMI/OPC UA‚Äú como "Escribible desde HMI/OPC UA" est√°n
activados en la tabla de variables PLC
Resultado: La variable solo se puede leer.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1335

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas
Si se requieren derechos de escritura:
‚óè AccessLevel = 2 o 3
‚óè "Escribible desde HMI/OPC UA" activado
Si se requieren derechos de lectura:
‚óè AccessLevel = 1 (AccessLevel: 3 tambi√©n es posible, pero induce a error. El ajuste sugiere
que un cliente OPC UA tiene derechos de escritura y de lectura)
‚óè "Accesible desde HMI/OPC UA‚Äú activado, "Escribible desde HMI/OPC UA" desactivado
Si no deben concederse ni derechos de lectura ni de escritura (ning√∫n acceso):
‚óè AccessLevel = 0
‚óè "Accesible desde HMI/OPC UA‚Äú desactivado
Para bloquear cualquier acceso debe cumplirse una de las dos condiciones. En tal caso
piense si la variable es realmente necesaria en la interfaz del servidor OPC UA.

Tabla de accesos
"Accesible desde HMI/OPC UA" debe estar activado para que sea posible el acceso v√≠a OPC
UA. "Escribible desde HMI/OPC UA" debe estar activado para que un cliente OPC UA pueda
escribir en una variable o en un elemento de DB.
En la tabla se consulta el derecho de acceso resultante.
Tabla 1-102 Tabla de accesos
OPC UA-XML

STEP 7 (TIA Portal) p. ej. tabla de variables

AccessLevel

Accesible desde HMI/
OPC UA

Escribible desde HMI/
OPC UA

Derecho de acceso re‚Äê
sultante

0

x

x

ning√∫n acceso

x

0

x

ning√∫n acceso

1

activado

x

read only

2

activado

desactivado

ning√∫n acceso

3

activado

desactivado

read only

2

activado

activado

write only

3

activado

activado

read+write

(x = don't care)

Consulte tambi√©n
Coherencia de variables de CPU (P√°gina 1337)
Administrar derechos de escritura y lectura (P√°gina 1331)

1336

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Coherencia de variables de CPU
El atributo "AccessLevelEx" ampl√≠a las propiedades de acceso
Adem√°s del atributo "AccessLevel" (v√©ase Coordinar derechos de escritura y lectura para
variables de CPU (P√°gina 1335)), a partir de la versi√≥n de firmware V2.6 el servidor OPC UA
de la CPU S7-1500 soporta tambi√©n el atributo "AccessLevelEx", que da los bits que se han
explicado para el acceso de lectura y de escritura e informaci√≥n adicional sobre la coherencia
de una variable OPC UA. El nuevo atributo se introdujo con la versi√≥n V1.04 de la
especificaci√≥n OPC (Part 3, Address Space Model).

Leer las propiedades de coherencia
En el modelo de informaci√≥n OPC UA del servidor OPC UA el acceso a las variables lo define
el atributo "AccessLevelEx".
AccessLevelEx est√° definido bit a bit; los bits relevantes aqu√≠ son los siguientes:
‚óè Bit 0 = CurrentRead
‚óè Bit 1 = CurrentWrite
‚óè Los bits 2 a 7 no son relevantes para el servidor OPC UA de una CPU S7-1500.
El significado de las combinaciones de bits se explica en el apartado sobre derechos de lectura
y escritura.
Adem√°s, para las propiedades de coherencia se agregan los bits siguientes:
‚óè Bit 8 = NonatomicRead; el bit est√° activado si la variable no puede leerse coherentemente.
Si las variables tienen coherencia de lectura, entonces bit 8 = 0.
‚óè Bit 9 = NonatomicWrite; el bit est√° activado si la variable no puede escribirse
coherentemente. Si las variables tienen coherencia de escritura, o si no se ha concedido
ning√∫n derecho de escritura, entonces bit 9 = 0.
Ejemplos
Una variable OPC UA (estructura) puede leerse y escribirse; pero es incoherente para accesos
de lectura y de escritura.
Esto implica: los bits 0, 1, 8 y 9 est√°n activados: AccessLevelEx = "771" (1+2+256+512).
Otra estructura es de solo lectura.
Esto implica: los bits 0 y 8 est√°n activados, el bit 1 y el bit 9 no est√°n activados: AccessLevelEx
= "257" (1+0+256+0).

Tratamiento del atributo en el servidor
El atributo "AccessLevelEx" solo est√° disponible en el servidor OPC UA. El atributo no existe
en un archivo Nodeset (archivo de exportaci√≥n XML).
Sin embargo, el atributo "AccessLevel" que se exporta tambi√©n registra la informaci√≥n de
"AccessLevelEx"; consulte el siguiente apartado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1337

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Exportaci√≥n
En la exportaci√≥n XML de la interfaz est√°ndar del servidor SIMATIC, el servidor activa el
atributo "AccessLevel", que en la especificaci√≥n V1.04, a diferencia de lo que ocurr√≠a en la
especificaci√≥n V1.03, se ha ampliado a 32 bits hasta el valor del atributo "AccessLevelEx".
Importaci√≥n
Al importar un archivo Nodeset (p. ej. de una exportaci√≥n de una interfaz de servidor), la CPU
S7-1500 activa el atributo "AccessLevelEx" si sabe que el tipo de datos importado es
coherente, v√©ase el apartado siguiente. El valor importado se ignora.

Coherencia de tipos de datos en la interfaz de servidor
La coherencia de variables (en el lenguaje usado en OPC UA: "atomicity") dentro de un ciclo
de programa de una CPU S7-1500 est√° garantizada en los nodos de la interfaz de servidor
para los tipos de datos siguientes:
‚óè BOOL, BYTE, WORD, DWORD, LWORD
‚óè SINT, INT, LINT, DINT, USINT, UINT, ULINT, UDINT
‚óè REAL, LREAL
‚óè DATE, LDT, TIME, LTIME, TIME_OF_DAY, LTIME_OF_DAY, S5TIME
‚óè CHAR, WCHAR
‚óè Tambi√©n son coherentes los tipos de datos de sistema o los tipos de datos hardware que
est√°n basados en los tipos de datos mencionados m√°s arriba.
Ejemplo: HW_ANY, derivado de UINT (UInt16).
Sugerencia: Al navegar en el espacio de direcciones de la CPU S7-1500 (p. ej. con el cliente
OPC UA UaExpert), encontrar√° los tipos de datos coherentes en Types > BaseDataType >
Enumeration/Number/String.
Las variables de los tipos de datos siguientes no son coherentes (en el lenguaje usado en OPC
UA: "nonatomic"):
‚óè En general las estructuras SIMATIC no son coherentes. Es decir, no son coherentes las
variables que, p. ej. son estructuras renombradas o que tienen un tipo de datos UDT.
‚óè Los tipos de datos de sistema como, p. ej., DTL, IEC_Counter, IEC_TIMER, etc. son tipos
de datos derivados de estructuras.
Sugerencia: Al navegar en el espacio de direcciones de la CPU S7-1500 (p. ej. con el cliente
OPC UA UaExpert), encontrar√° los tipos de datos que se basan en estructuras en Types >
BaseDataType > Structure.

Posibilidades de acceso a datos del servidor OPC UA
Alto rendimiento en funci√≥n del caso de aplicaci√≥n
OPC UA est√° concebido para la transferencia de un gran volumen de datos en corto tiempo.
Se puede incrementar notablemente el rendimiento si, en lugar de acceder a variables PLC
concretas, se leen y escriben arrays y estructuras completas.

1338

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El acceso m√°s r√°pido es a matrices. Por ello, para los clientes OPC UA deben agruparse los
datos en matrices.
Recomendaciones para que el cliente OPC UA acceda al servidor OPC UA
‚óè Para el acceso √∫nico u ocasional a los datos, utilice el acceso normal de lectura o escritura.
‚óè Para el acceso c√≠clico a unos pocos datos (aprox. cada 5 segundos como m√°ximo), utilice
suscripciones.
Optimice en el servidor OPC UA los ajustes para el m√≠nimo intervalo de env√≠o y el m√≠nimo
intervalo de muestreo.
‚óè Si se accede regularmente (con frecuencia) a determinadas variables, utilice las funciones
"RegisteredRead" y "RegisteredWrite".
Otorgue a la CPU m√°s carga de comunicaci√≥n aumentando el valor de "Carga del ciclo por
comunicaci√≥n". Aseg√∫rese de que la aplicaci√≥n contin√∫a funcionando correctamente con los
ajustes modificados.

Procedimiento para crear un DB Array
Existe la posibilidad de crear matrices, p. ej., en bloques de datos globales, en el bloque de
datos de instancia de un bloque de funci√≥n o como DB Array. A continuaci√≥n se explica c√≥mo
crear un DB Array.
Para crear un bloque de datos con una matriz (bloque de datos Array), proceda del siguiente
modo:
1. En el √°rbol del proyecto, seleccione la CPU con el servidor OPC UA.
2. Haga doble clic en "Bloques de programa".
3. Haga doble clic en "Agregar nuevo bloque".
4. Haga clic en el bot√≥n "Bloque de datos".
5. Asigne un nombre un√≠voco al bloque de datos o seleccione uno de los nombres que ya
existen.
6. Seleccione para "Tipo" la entrada "DB de Array" en la lista desplegable.
7. Seleccione en la lista desplegable para "Tipo de datos Array" el tipo de datos de los distintos
componentes de la matriz.
8. Introduzca el l√≠mite superior de la matriz en "L√≠mite de Array".
9. Haga clic en el bot√≥n "Aceptar".

Atributo MinimumSamplingInterval
Atributo MinimumSamplingInterval de variables
Adem√°s de "Value", "DataType" y "AccessLevel" tambi√©n se puede activar el atributo
"MinimumSamplingInterval" para una variable en el archivo XML que representa el espacio de
direcciones del servidor.
El atributo indica la rapidez con la que el servidor puede explorar el valor de la variable.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1339

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El servidor OPC UA de la CPU S7-1500 procesa los valores de MinimumSamplingInterval del
siguiente modo:
‚óè Los valores negativos y los valores por encima de 4294967 se ponen a -1, lo que significa
lo siguiente: La tasa de muestreo m√≠nima es indeterminada; el servidor no indica la rapidez
con la que puede explorar el valor de la variable.
‚óè Los decimales se redondean a tres.

Exportar un archivo XML OPC UA.
Crear archivo de exportaci√≥n OPC UA
La OPC Foundation ha especificado un formato est√°ndar basado en XML para describir
modelos de informaci√≥n. Con √©l es posible proporcionar previamente a un cliente el modelo de
informaci√≥n de un servidor OPC UA, o tambi√©n es posible cargar modelos de informaci√≥n en
un servidor OPC UA. Un archivo con este formato se denomina archivo Nodeset, dado que
describe un modelo de informaci√≥n como conjunto (set) de nodos (nodes).
STEP 7 (TIA Portal) exportar f√°cilmente el modelo de informaci√≥n est√°ndar SIMATIC de la
CPU S7-1500, actuando como servidor, en un archivo XML OPC UA (archivo nodeset);
incluyendo todas las variables y m√©todos del PLC que ha habilitado para OPC UA.
El archivo XML OPC UA se usa para configurar offline un cliente OPC UA. Dicho archivo tiene
una estructura conforme con la especificaci√≥n OPC UA y tiene como fin ejercer de interfaz
est√°ndar entre el SIMATIC y el servidor.
Para crear y exportar el archivo XML OPC UA, proceda del siguiente modo:
1. Seleccione la CPU. Para ello, haga clic en el icono de la CPU (p. ej., en la vista de redes).
2. Haga clic en las propiedades de la CPU en "General > OPC UA > Servidor > Exportar".
3. Haga clic en el bot√≥n "Exportar archivo XML OPC UA".
4. Seleccione el directorio en el que desea guardar el archivo de exportaci√≥n.
5. Elija un nuevo nombre para el archivo. O conserve el nombre que ya se hab√≠a introducido.
6. Haga clic en "Guardar".
Nota
A partir de STEP 7 (TIA Portal) V15.1, los m√©todos de servidor est√°n incluidos en el archivo de
exportaci√≥n OPC UA (Nodeset) junto con sus par√°metros de entrada y salida.

Exportar por separado todos los elementos de matriz
Si en las propiedades de la CPU "OPC UA > Servidor > Exportar" est√° activada la opci√≥n
"Exportar todos los elementos de matriz como nodos separados", el archivo XML OPC UA
contendr√° todos los elementos de matrices como elementos XML individuales. Adem√°s, en el
archivo XML cada una de las matrices propiamente dichas est√°n descritas en un elemento
XML.
El archivo XML puede ser muy extenso si la matriz contiene muchos elementos.

1340

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consejo
En la siguiente FAQ encontrar√° un convertidor que le permitir√° convertir el archivo de
exportaci√≥n al formato CSV. As√≠ obtendr√° una lista de las variables de la CPU accesibles para
OPC UA.
Encontrar√° las FAQ en Internet (https://support.industry.siemens.com/cs/ww/es/view/
109742903).

Configuraci√≥n de servidor OPC UA
Activar servidor OPC UA
Requisitos
‚óè Cuando se utilizan certificados para la comunicaci√≥n segura (p. ej., HTTPS, Secure OUC,
OPC UA), hay que asegurarse de que los m√≥dulos afectados tengan la hora y fecha
actuales. De lo contrario, los m√≥dulos considerar√°n los certificados utilizados no v√°lidos y
la comunicaci√≥n segura no funcionar√°.
‚óè Se ha adquirido una licencia Runtime para el uso de las funciones OPC UA;
consulte Licencias para OPC UA (P√°gina 1362).

Poner en funcionamiento el servidor OPC UA
En el ajuste b√°sico, el servidor OPC UA de la CPU no est√° habilitado por motivos de seguridad:
Los clientes OPC UA no tienen acceso de lectura ni de escritura a la CPU S7-1500.
Para activar el servidor OPC UA de la CPU, proceda del siguiente modo.
1. Seleccione la CPU. Para ello, haga clic en el icono de la CPU (p. ej., en la vista de redes).
2. Haga clic en las propiedades de la CPU en "OPC UA > Servidor".
3. Active el servidor OPC UA de la CPU.
4. Confirme las consignas de seguridad.
5. En las propiedades de la CPU seleccione el √°rea "Licencias Runtime" y ajuste la licencia
Runtime adquirida para el servidor OPC UA.
6. Compile el proyecto.
7. Cargue el proyecto en la CPU.
Se inicia el servidor OPC UA de la CPU.

Los ajustes contin√∫an guardados
Si ya se ha activado el servidor y se han realizado ajustes, estos no se perder√°n si se desactiva
el servidor. Los ajustes contin√∫an guardados y estar√°n de nuevo disponibles cuando se active
nuevamente el servidor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1341

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre de aplicaci√≥n
El nombre de aplicaci√≥n es el nombre de la aplicaci√≥n OPC UA y es v√°lido para el servidor y
el cliente. El nombre se visualiza en "OPC UA > General":
‚óè El ajuste predeterminado para el nombre de aplicaci√≥n es el siguiente:
"SIMATIC.S7-1500.OPC-UA.Application:PLC_1".
‚óè El ajuste predeterminado se compone de "SIMATIC.S7-1500.OPC-UA.Application:" y del
nombre de la CPU que se seleccion√≥ en "General > Informaci√≥n del producto > Nombre",
en este caso "PLC_1".
‚óè Este es el nombre de aplicaci√≥n con el que se identifica el servidor OPC UA frente a un
interlocutor (cliente OPC UA), p. ej. cuando un cliente OPC UA utiliza el servicio Discovery
para determinar los servidores accesibles.
‚óè El cliente OPC UA de la CPU utiliza el nombre de aplicaci√≥n visualizado al establecer la
conexi√≥n con un servidor OPC UA. Es decir, la CPU registra autom√°ticamente este nombre
de aplicaci√≥n como "ApplicationName" para la instrucci√≥n "OPC_UA_Connect" (variable
del tipo "OPC_UA_SessionConnectInfo" en el par√°metro "SessionConnectInfo" de la
instrucci√≥n "OPC_UA_Connect").
Por este motivo, al programar la instrucci√≥n "OPC_UA_Connect" debe asignarse un string
vac√≠o al "ApplicationName". El nombre de aplicaci√≥n permite identificar el cliente con sus
sesiones (SessionNames) para fines de diagn√≥stico, por ejemplo.
Tras activar el servidor, tambi√©n puede utilizar otro nombre descriptivo dentro de su proyecto
y que cumpla los requisitos vigentes en el proyecto como, p. ej., que sea un√≠voco en todo el
mundo.
El siguiente ejemplo procede de UaExpert:

Cambiar el nombre de aplicaci√≥n
Para cambiar el nombre de aplicaci√≥n, proceda del siguiente modo:
1. Seleccione la CPU. Para ello, haga clic en el icono de la CPU (p. ej., en la vista de redes).
2. Haga clic en las propiedades de la CPU en "OPC UA > General".
3. Introduzca un nombre descriptivo.
Tenga en cuenta que el nombre de la aplicaci√≥n tambi√©n est√° registrado en el certificado
(Subject Alternative Name) y que despu√©s de cambiar el nombre de la aplicaci√≥n podr√≠a tener
que crear de nuevo un certificado ya creado anteriormente.

1342

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Acceso al servidor OPC UA
Direcciones de servidores
Es posible acceder al servidor OPC UA de la CPU S7-1500 a trav√©s de todas las interfaces
PROFINET integradas de la CPU (a partir del firmware V2.0).
Mediante CP es posible acceder directamente al servidor OPC UA de la CPU a trav√©s del bus
de fondo del sistema de automatizaci√≥n, en las condiciones siguientes:
‚óè Configuraci√≥n con TIA Portal versi√≥n V16 o superior, CPU S7-1500 con versi√≥n de firmware
V2.8 o superior y CP 1543-1 con versi√≥n de firmware V2.2 o superior.
Encontrar√° informaci√≥n sobre la configuraci√≥n en Acceso a aplicaciones OPC UA
(P√°gina 1298).
A trav√©s de CM no es posible acceder directamente al servidor OPC UA de la CPU por el bus
de fondo del sistema de automatizaci√≥n.
En los controladores por software SIMATIC S7-1500 es posible acceder al servidor OPC UA
a trav√©s de las interfaces PROFINET asignadas al PLC por software.
En los siguientes ejemplos de aplicaci√≥n se describen otras posibilidades de acceso de
controladores por software: Conexi√≥n OPC UA interna y externa a trav√©s de la interfaz
Ethernet virtual del controlador por software a partir de V2.5 (https://
support.industry.siemens.com/cs/ww/es/view/109760541).
Ejemplo de URL (Uniform Resource Locator), a trav√©s de las cuales se pueden establecer
conexiones con el servidor OPC UA de la CPU:

Las URL tienen la siguiente estructura:
‚óè Identificador de protocolo "opc.tcp://"
‚óè Direcci√≥n IP
‚Äì 192.168.178.151
Direcci√≥n IP a trav√©s de la cual puede accederse al servidor OPC UA desde la subred
Ethernet 192.168.178.
‚Äì 192.168.1.1
Direcci√≥n IP a trav√©s de la cual puede accederse al servidor OPC UA desde la subred
Ethernet 192.168.1.
‚óè N√∫mero de puerto TCP
‚Äì Ajuste predeterminado: 4840 (puerto est√°ndar)
El n√∫mero de puerto puede cambiarse en "OPC UA > Servidor > Ajustes > Puerto".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1343

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Direcciones IP din√°micas
En el ejemplo siguiente a√∫n no est√° definida la direcci√≥n IP de la interfaz PROFINET [X2].

En la tabla aparece el comod√≠n "<dynamically>".
La direcci√≥n IP de esta interfaz PROFINET se activar√° posteriormente en el dispositivo, p. ej.
desde el display de la CPU.

Activar la interfaz est√°ndar del servidor SIMATIC
Si est√° activada la opci√≥n "Activar la interfaz est√°ndar del servidor SIMATIC", el servidor OPC
UA de la CPU proporcionar√° a los clientes las variables PLC y los m√©todos de servidor
habilitados, tal como se ha establecido en el espacio de nombres definido por SIEMENS.
Esta opci√≥n est√° activada en el ajuste predeterminado.
Deje activada la opci√≥n para que los clientes OPC UA tengan la posibilidad de conectarse
autom√°ticamente al servidor OPC UA de la CPU e intercambiar datos.
Si no se activa esta opci√≥n, la interfaz de servidor deber√° agregarse a trav√©s de la entrada
"Comunicaci√≥n OPC UA" en el √°rbol del proyecto. Entonces esa interfaz se utilizar√° como
interfaz de servidor OPC UA, v√©ase AUTOHOTSPOT.
Nota
La informaci√≥n general del dispositivo puede leerse incluso con la interfaz de servidor
SIMATIC est√°ndar desactivada
Aunque desactive la interfaz de servidor SIMATIC est√°ndar, los clientes OPC UA pueden leer
la informaci√≥n general del dispositivo a trav√©s del servidor OPC UA de la CPU.
Ejemplos de dicha informaci√≥n del dispositivo: DeviceManual, DeviceRevision, OrderNumber.
Sin embargo, en ese caso todos los objetos del programa de usuario permanecen invisibles
para los clientes.
Para impedir que tambi√©n esa informaci√≥n del dispositivo no sea invisible, desactive el servidor
OPC UA de la CPU.

1344

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustes generales del servidor OPC UA
Puerto TCP para OPC UA
De manera est√°ndar OPC UA utiliza el puerto TCP 4840. Sin embargo, tambi√©n se puede
seleccionar otro puerto. Son posibles las entradas de 1024 a 49151. Sin embargo, hay que
asegurarse de que no se produzcan conflictos con otras aplicaciones. Al establecer la
conexi√≥n, los clientes OPC UA deben utilizar el puerto seleccionado.
En el ejemplo siguiente se ha seleccionado el puerto 48400:

Ajustes para sesiones
‚óè Timeout m√°ximo para sesiones
En este campo se define cu√°l debe ser el m√°ximo intervalo de tiempo hasta que el servidor
OPC UA desconecte una sesi√≥n sin intercambio de datos.
El valor puede estar comprendido entre 1 y 600000 segundos.
‚óè N√∫mero m√°ximo de sesiones OPC UA
En este campo se define cu√°ntas sesiones como m√°ximo establecer√° y gestionar√°
simult√°neamente el servidor OPC UA de la CPU.
El n√∫mero m√°ximo de sesiones depende de la capacidad funcional de la CPU. Cada sesi√≥n
acapara recursos.

N√∫mero m√°ximo de nodos registrados
En este campo se define cu√°ntos nodos (nodes) como m√°ximo registrar√° el servidor OPC UA.
El n√∫mero m√°ximo de nodos registrados depende de la capacidad funcional de la CPU y se
muestra al configurar el contenido del campo (colocar el puntero del rat√≥n sobre el campo).
Cada registro acapara recursos.
Nota
No hay in mensaje de error al intentar registrar m√°s nodos que el n√∫mero m√°ximo configurado
de nodos registrables
Si un cliente pretende registrar en tiempo de ejecuci√≥n m√°s nodos del n√∫mero m√°ximo
configurado de nodos registrables, el servidor de la CPU S7-1500 registrar√° solo el n√∫mero
m√°ximo configurado. A partir del n√∫mero m√°ximo configurado de nodos registrables, el
servidor devuelve al cliente sin cambios las ID de nodo de string regulares, de manera que el
registro de dichos nodos hace que se pierda la ventaja de velocidad. El cliente no recibe ning√∫n
mensaje de error.
En la configuraci√≥n aseg√∫rese de disponer de una reserva suficiente; para ello, tenga en
cuenta el n√∫mero m√°ximo de nodos registrados (p. ej. consultando los datos t√©cnicos de la
CPU).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1345

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n adicional
Los puertos que utilizan los diferentes servicios para la transferencia de datos v√≠a TCP y UDP
y lo que debe tenerse en cuenta al utilizar routers y cortafuegos puede consultarse en FAQ
(https://support.industry.siemens.com/cs/ww/es/view/8970169).

Definiciones de tipos de datos compatibles con versiones anteriores seg√∫n la especificaci√≥n OPC UA ‚â§
V1.03
La especificaci√≥n OPC UA (<= V1.03) define mecanismos para poder leer definiciones de tipos
de datos, p. ej. para estructuras definidas por el usuario (UDT), en un servidor utilizando
TypeDictionaries.
En las propiedades del servidor OPC UA de la CPU se puede establecer que la CPU genere
o no genere esas definiciones de tipos de datos compatibles con versiones anteriores seg√∫n
la especificaci√≥n OPC UA ‚â§ V1.03 para la interfaz est√°ndar del servidor SIMATIC.
Debido a que los TypeDictionaries son complejos y dan lugar a archivos XML OPC UA
(interfaces de servidor) muy extensos que debe interpretar el cliente, se ha introducido una
soluci√≥n m√°s sencilla con la especificaci√≥n OPC UA V1.04 (atributo "DataTypeDefinition" en el
nodo DataType). Si el cliente soporta la especificaci√≥n OPC UA a partir de V1.04, desactive la
opci√≥n.
Ventajas de las definiciones de tipo de datos seg√∫n la especificaci√≥n OPC UA a partir de V1.04:
‚óè El servidor arranca m√°s r√°pido
‚óè La memoria se utiliza con mayor eficiencia
‚óè La funci√≥n "Examinar" reacciona con mayor rapidez

Ajustes del servidor para suscripciones
Suscripci√≥n en lugar de consulta c√≠clica
Una alternativa a la consulta c√≠clica de una variable PLC (polling) es la observaci√≥n del valor.
Para ello, utilice una Subscription (suscripci√≥n): el servidor informa al cliente cuando cambia el
valor de las variables PLC. Consulte "El cliente OPC UA".
Habitualmente un servidor supervisa muchos valores del PLC. Por ello el servidor env√≠a al
cliente a intervalos regulares mensajes (notificaciones) que contienen los nuevos valores de
las variables PLC.
Ventajas de las suscripciones:
‚óè El servidor arranca m√°s r√°pido
‚óè La memoria se utiliza eficientemente
¬øCon qu√© frecuencia env√≠a mensajes el servidor?
Al crear una Subscription, el cliente OPC UA indica el intervalo con el que desea recibir los
valores nuevos cuando cambien los valores. Para limitar la carga de comunicaci√≥n por OPC
UA, defina una distancia temporal m√≠nima para los mensajes. Para ello se utilizan los
par√°metros para el m√≠nimo intervalo de env√≠o y el m√≠nimo intervalo de muestreo.

1346

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

6XEVFULEHP\'%P\$UUD\

6HUYLGRU23&8$

,QWHUYDORGHPXHVWUHR ;

'%P\$UUD\


,QWHUYDORGHHQY¬ØR <PV

P\'%P\$UUD\ 

,QWHUYDORGHHQY¬ØR
,QWHUYDORGHPXHVWUHR

 '%

P\$UUD\


M√≠nimo intervalo de env√≠o
En "M√≠nimo intervalo de env√≠o" se ajusta el tiempo (intervalo) al cabo del cual, cuando cambie
un valor, el servidor enviar√° al cliente un mensaje con el nuevo valor.
En la figura siguiente se utiliza como "M√≠nimo intervalo de muestreo" el valor 250 ms. Como
"M√≠nimo intervalo de env√≠o" se ha registrado el valor 200 ms.

En el ejemplo, al producirse un cambio de valor el servidor OPC UA env√≠a un mensaje nuevo
cada 200 ms en caso de que el cliente OPC UA solicite una actualizaci√≥n.
Si el cliente OPC UA solicita una actualizaci√≥n cada 1000 ms, el servidor OPC UA solo enviar√°
un mensaje con los nuevos valores cada 1000 ms (un segundo).
Si el cliente OPC UA solicita una actualizaci√≥n cada 100 ms, el servidor la transferir√° a√∫n as√≠
solo cada 200 ms (m√≠nimo intervalo de env√≠o).

M√≠nimo intervalo de muestreo
En "M√≠nimo intervalo de muestreo" se define el tiempo (intervalo) al cabo del cual el servidor
OPC UA registra el valor de una variable de CPU y lo compara con el valor anterior para
detectar un cambio de valor.
Si se ha seleccionado un intervalo de muestreo menor que el intervalo de transmisi√≥n y un
cliente OPC UA solicita una velocidad de muestreo alta para determinadas variables PLC, por
cada intervalo de transmisi√≥n podr√°n producirse dos o m√°s valores.
En ese caso, el servidor OPC UA escribir√° los cambios de valores en la cola y enviar√° todos
los cambios de valores al cliente una vez transcurrido el intervalo de transmisi√≥n. Si se

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1347

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
producen m√°s cambios de valores en el intervalo de transmisi√≥n de los que caben en la cola,
el servidor OPC UA sobrescribir√° los valores m√°s antiguos (en funci√≥n de la "Discard Policy"
ajustada del cliente que se suscribe a los datos; en este caso la opci√≥n "Discard Oldest" debe
estar activada). Se enviar√°n al cliente los √∫ltimos valores.

N√∫mero m√°ximo de elementos vigilados (Monitored Items)
En este campo se define el n√∫mero m√°ximo de elementos que el servidor OPC UA de la CPU
vigilar√° simult√°neamente para detectar un cambio de valor.
La vigilancia acapara recursos. El n√∫mero m√°ximo de elementos vigilados depende de la CPU
utilizada.

Informaci√≥n adicional
Consulte informaci√≥n sobre los l√≠mites del sistema del servidor OPC UA de las CPU S7-1500
(firmware V2.0 y V2.1) relativa a suscripciones, intervalos de muestreo e intervalos de
transmisi√≥n en las FAQ (https://support.industry.siemens.com/cs/ww/es/view/109755846)
siguientes.
En caso de fallo al utilizar suscripciones, determinados c√≥digos de estado dan informaci√≥n
sobre los fallos producidos. Encontrar√° informaci√≥n sobre las causas y soluciones para los
c√≥digos de estado producidos en el cliente OPC UA en la lista de c√≥digos de error de la Ayuda
en pantalla de STEP 7 (TIA Portal) o en las FAQ (https://support.industry.siemens.com/cs/ww/
es/view/109755860) siguientes.

Consulte tambi√©n
Reglas para suscripciones (P√°gina 1454)
Diagnosticar suscripciones (P√°gina 1401)

Manejo de certificados de cliente y de servidor
Solo se produce una conexi√≥n segura entre un servidor OPC UA y un cliente OPC UA si el
servidor puede identificarse ante el cliente. Para ello se utiliza el certificado del servidor.

Certificado del servidor OPC UA
Si se ha activado el servidor OPC UA y se han confirmado las consignas de seguridad, STEP
7 crea autom√°ticamente el certificado para el servidor y lo guarda en el directorio local de
certificados de la CPU. Este directorio puede verse y administrarse con el administrador local
de certificados de la CPU (exportar o borrar certificados).
La figura siguiente muestra el administrador local de certificados de la CPU con el certificado
generado autom√°ticamente para el servidor OPC UA:

1348

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Alternativamente el usuario tambi√©n puede crear un certificado de servidor.
El certificado del servidor se transfiere desde el servidor al cliente en el momento de establecer
una conexi√≥n. El cliente comprueba el certificado.

El usuario del cliente decide si conf√≠a en el certificado del servidor
En el lado del cliente, el usuario debe decidir ahora si conf√≠a en el certificado de servidor. Si el
usuario conf√≠a en el certificado de servidor, el cliente lo guardar√° en el directorio que contiene
los certificados de servidor que le merecen confianza.
El ejemplo siguiente muestra un cuadro de di√°logo del cliente "UA Sample Client". Si el usuario
hace clic en el bot√≥n "S√≠", el cliente conf√≠a en el certificado del servidor:

¬øDe d√≥nde viene el certificado de un cliente?
Cliente del S7-1500
Si se utiliza el cliente OPC UA de una CPU S7-1500 (cliente OPC UA activado), para estos
clientes podr√°n crearse certificados con STEP 7 a partir de la versi√≥n V15:
1. En el "√Årbol del proyecto", seleccione la CPU que act√∫a de cliente.
2. Haga doble clic en "Configuraci√≥n de dispositivos".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1349

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. En las propiedades de la CPU haga clic en "Protecci√≥n y seguridad > Administrador de
certificados".
4. Haga doble clic en "<Agregar nuevo>" en la tabla "Certificados de dispositivo".
STEP 7 abre un cuadro de di√°logo.
5. Haga clic en el bot√≥n "Agregar".
6. En "Finalidad de uso", seleccione la entrada "Cliente OPC UA" de la lista.
Atenci√≥n:
En "Titular del certificado alternativo (SAN)" deben estar indicadas las direcciones IP con
las que se accede a la CPU en la instalaci√≥n.
Por tanto, es preciso configurar las interfaces IP de la CPU antes de crear un certificado de
cliente.
7. Haga clic en "Aceptar".
STEP 7 muestra el certificado de cliente en la tabla "Certificados de dispositivo".
8. Haga clic con el bot√≥n derecho del rat√≥n en esta fila y seleccione la entrada "Exportar
certificado" del men√∫ contextual.
9. Seleccione un directorio para guardar el certificado de cliente.
Clientes de otros fabricantes
Si utiliza clientes UA de fabricantes o de la OPC Foundation, durante la instalaci√≥n o la primera
llamada del programa se crea autom√°ticamente un certificado de cliente. Estos certificados
deben importarse a STEP 7 mediante el administrador global de certificados y utilizarse para
la respectiva CPU (como se muestra m√°s arriba).
Si el propio usuario programa un cliente OPC UA, puede generar certificados mediante
t√©cnicas de programaci√≥n, consulte "Certificado de instancia para el cliente". Tambi√©n es
posible generar certificados usando herramientas, por ejemplo OpenSSL o el generador de
certificados de la OPC Foundation:
‚óè Consulte c√≥mo proceder con OpenSSL aqu√≠: "Autogeneraci√≥n de parejas de claves PKI y
de certificados".
‚óè Consulte c√≥mo trabajar con el generador de certificados de la OPC Foundation aqu√≠: "Crear
certificados autofirmados".

Notificar al servidor certificados del cliente
Para poder establecer una conexi√≥n segura es necesario poner los certificados del cliente a
disposici√≥n del servidor.

1350

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para ello, proceda del siguiente modo:
1. Active la opci√≥n "Utilizar ajustes globales de seguridad para el administrador de
certificados" en el administrador local de certificados del servidor. De este modo est√°
disponible el administrador global de certificados.
Encontrar√° esta opci√≥n en las propiedades de la CPU que hace de servidor, en "Protecci√≥n
y seguridad > Administrador de certificados".
Si el proyecto a√∫n no est√° protegido, en "Ajustes de seguridad > Ajustes" del "√Årbol del
proyecto" de STEP 7 haga clic en el bot√≥n "Proteger este proyecto" e inicie sesi√≥n.
En el "√Årbol del proyecto" de STEP 7 aparece la entrada "Ajustes globales de seguridad" en
"Ajustes de seguridad".
2. Haga doble clic en "Ajustes globales de seguridad".
3. Haga doble clic en "Administrador de certificados".
STEP 7 abre el administrador global de certificados.
4. Haga clic en la ficha "Certificados de confianza".
5. Haga clic con el bot√≥n derecho del rat√≥n en un √°rea vac√≠a de la ficha (no en un certificado).
6. Elija la opci√≥n "Importar" del men√∫ contextual.
Se abre el cuadro de di√°logo para importar certificados.
7. Seleccione el certificado de cliente en el que debe confiar el servidor.
8. Haga clic en el bot√≥n "Abrir" para importar el certificado.
El certificado del cliente est√° ahora guardado en el administrador global de certificados.
Tome nota de la ID del certificado de cliente que acaba de importar.
9. A continuaci√≥n haga clic en la ficha "General" de las propiedades de la CPU que hace de
servidor.
10.Haga clic en el √°rea "OPC UA > Servidor > Seguridad > Secure Channel".
11.Despl√°cese hacia abajo en el cuadro de di√°logo "Secure Channel" (canal seguro) hasta la
secci√≥n "Clientes de confianza".
12.En la tabla, haga doble clic en la fila vac√≠a "<agregar nuevo>". En la fila se muestra un bot√≥n
con tres puntos.
13.Haga clic en dicho bot√≥n.
14.Seleccione el certificado de cliente que import√≥ previamente.
15.Haga clic en el bot√≥n con la marca de verificaci√≥n verde.
16.Compile el proyecto.
17.Cargue la configuraci√≥n en la CPU S7-1500.
Resultado:
El servidor ahora conf√≠a en el cliente. Si, adem√°s, el certificado de servidor se considera de
confianza, servidor y cliente podr√°n establecer una conexi√≥n segura.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1351

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Aceptar autom√°ticamente certificados de cliente
Si activa la opci√≥n "Aceptar autom√°ticamente certificados de cliente durante el tiempo de
ejecuci√≥n" (debajo de la lista "Clientes de confianza"), entonces el servidor aceptar√° todos los
certificados de cliente.
ATENCI√ìN
Ajuste tras la puesta en marcha
Para evitar riesgos de seguridad, vuelva a desactivar la opci√≥n "Aceptar autom√°ticamente los
certificados de cliente durante el tiempo de ejecuci√≥n" despu√©s de la puesta en marcha.

Configurar los ajustes de seguridad del servidor
La figura siguiente muestra los ajustes de seguridad disponibles del servidor para firmar y cifrar
mensajes.

1352

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el ajuste predeterminado se crea un certificado de servidor que utiliza la firma SHA256. Se
habilitan las siguientes directivas de seguridad:
‚óè Ning√∫n
punto final desprotegido
Nota
Desactivar directivas de seguridad (Security Policies) no deseadas
Si en la configuraci√≥n del Secure Channel (canal seguro) del servidor OPC UA del S7-1500
se han activado todas las directivas de seguridad (Security Policy) (ajuste predeterminado),
por tanto tambi√©n el punto final "Ninguna seguridad", tambi√©n es posible el tr√°fico de datos
no seguro entre el servidor y el cliente (sin firma ni cifrar). Con "Ninguna seguridad" la
identidad del cliente es desconocida. En tal caso todos los clientes OPC UA pueden
conectarse al servidor, con independencia de todos los ajustes de seguridad que sigan.
En la configuraci√≥n del servidor OPC UA tenga en cuenta que solo est√°n activadas las
directivas de seguridad compatibles con el concepto de protecci√≥n para la m√°quina o
instalaci√≥n. Es necesario desactivar todas las dem√°s directivas de seguridad.
Recomendaci√≥n: En la medida de lo posible, utilice el ajuste "Basic256Sha256".
‚óè Basic128Rsa15 - Firmar
Punto final protegido, permite una serie de algoritmos que utilizan el algoritmo de hash
RSA15 y el cifrado de 128 bits.
Este punto final asegura la integridad de los datos mediante firma.
‚óè Basic128Rsa15 - Firmar y cifrar
Punto final protegido, permite una serie de algoritmos que utilizan el algoritmo de hash
RSA15 y el cifrado de 128 bits.
Este punto final asegura la integridad y confidencialidad de los datos mediante firmar y
cifrar.
‚óè Basic256Rsa15 - Firma
Punto final protegido, permite una serie de algoritmos que utilizan el algoritmo de hash
RSA15 y el cifrado de 256 bits.
Este punto final asegura la integridad de los datos mediante firmar.
‚óè Basic256Rsa15 - Firma y cifrado
Punto final protegido, permite una serie de algoritmos que utilizan el algoritmo de hash
RSA15 y el cifrado de 256 bits.
Este punto final asegura la integridad y confidencialidad de los datos mediante firmar y
cifrar.
‚óè Basic256Sha256 - Firma
Punto final protegido, soporta una serie de algoritmos para hashing de 256 bits y cifrado de
256 bits.
Este punto final asegura la integridad de los datos mediante firma.
‚óè Basic256Sha256 - Firma y cifrado
Punto final protegido, soporta una serie de algoritmos para hashing de 256 bits y cifrado de
256 bits.
Este punto final asegura la integridad y confidencialidad de los datos mediante firma y
cifrado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1353

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para habilitar un ajuste de seguridad haga clic en la casilla de verificaci√≥n de la fila
correspondiente.
Nota
Si se utilizan los ajustes "Basic256Sha256 - Firma" y "Basic256Sha256 - Firma y cifrado", el
servidor OPC UA y los clientes OPC UA deben utilizar certificados firmados con "SHA256".
Con los ajustes "Basic256Sha256 - Firma" y "Basic256Sha256 - Firma y cifrado", la entidad
emisora de STEP 7 firma los certificados autom√°ticamente con "SHA256".

Security Policy "Ninguna seguridad" y autenticaci√≥n mediante nombre de usuario y contrase√±a
Se pueden configurar las combinaciones siguientes:
Security Policy = "Ninguna seguridad" y autenticaci√≥n mediante nombre de usuario y
contrase√±a.
‚óè El servidor OPC UA de S7-1500 soporta esta combinaci√≥n. Los clientes OPC UA pueden
conectarse y cifrar o no cifrar los datos de autenticaci√≥n.
‚óè El cliente OPC UA de la CPU S7-1500 tambi√©n soporta esta combinaci√≥n: pero en tiempo
de ejecuci√≥n solo se conecta si a trav√©s de la l√≠nea puede transferir los datos de
autenticaci√≥n cifrados.

Consulte tambi√©n
Crear certificados de servidor con STEP 7 (P√°gina 1354)

Crear certificados de servidor con STEP 7
La siguiente descripci√≥n muestra la forma de proceder para crear nuevos certificados con
STEP 7 y se aplica en principio para diversos usos de los certificados. Dependiendo del √°rea
de propiedades de la CPU desde la que se abra el siguiente cuadro de di√°logo, STEP 7 ya
ajusta la finalidad adecuada (en este caso, "Cliente y servidor OPC UA").
Recomendaci√≥n: Para poder utilizar todas las funciones de seguridad del servidor OPC UA,
utilice los ajustes globales de seguridad.
Los ajustes globales de seguridad se activan en las propiedades de la CPU, en el √°rea
"Protecci√≥n y seguridad > Administrador de certificados".

1354

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Personalizar los certificados del servidor
Al activar el servidor, STEP 7 crea autom√°ticamente un certificado para el servidor OPC UA del
S7-1500 (v√©ase "Activar servidor OPC UA (P√°gina 1341)"). Para los par√°metros del
certificado, STEP 7 utiliza valores predeterminados. Si desea modificar los par√°metros,
proceda del siguiente modo:
1. En las propiedades de la CPU, haga clic en el bot√≥n con tres puntos que figura en "General
> OPC UA > Servidor > Seguridad > Secure Channel > Certificado de servidor". Se abre un
cuadro de di√°logo que muestra los certificados locales existentes.
2. Haga clic en el bot√≥n "Agregar".
3. Se abre el cuadro de di√°logo para crear certificados nuevos (figura siguiente). Los valores
para un ejemplo ya est√°n introducidos:

4. Utilice otros par√°metros si fuera necesario debido a los requisitos de seguridad en su
empresa o por parte de su cliente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1355

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Explicaci√≥n de los campos de generaci√≥n de certificados
‚óè CA
Elija si el certificado debe autofirmarse o ser firmado por otro certificado CA disponible en
el TIA Portal. Los certificados se describen en "Certificados en OPC UA". Si desea crear un
certificado firmado por uno de los certificados CA del TIA Portal, el proyecto deber√° estar
protegido y previamente se deber√° haber iniciado sesi√≥n como usuario con los derechos de
funci√≥n requeridos. Encontrar√° m√°s informaci√≥n en "Principios b√°sicos de la administraci√≥n
de usuarios en el TIA Portal".
‚óè Titular del certificado
El ajuste predeterminado est√° formado por el nombre del proyecto y "\OPCUA-1". En el
ejemplo, el nombre del proyecto es "PLC1". En las propiedades de la CPU especifique el
nombre del proyecto en "General > Informaci√≥n del proyecto > Nombre". Conserve el ajuste
predeterminado o introduzca en "Titular del certificado" otro nombre para el servidor OPC
UA que sea m√°s descriptivo en el proyecto.
‚óè Firma
Seleccione aqu√≠ el procedimiento hash y de cifrado que debe utilizarse para firmar el
certificado de servidor. Est√°n disponibles las siguientes entradas:
‚Äì "sha1RSA",
‚Äì "sha256RSA".
‚óè V√°lido desde
Introduzca aqu√≠ la fecha y la hora que marcan el inicio del per√≠odo de validez del certificado
de servidor.
‚óè V√°lido hasta
Introduzca aqu√≠ la fecha y la hora que marcan el final del per√≠odo de validez del certificado
de servidor. Aseg√∫rese de que la validez del certificado no sea solo de un a√±o o pocos a√±os.
En este ejemplo el certificado tiene una validez de 30 a√±os. No obstante, por motivos de
seguridad deber√≠a renovar el certificado en intervalos mucho m√°s cortos. La prolongada
validez, sin embargo, le ofrece la posibilidad de elegir el instante adecuado para renovar el
certificado, por ejemplo, cuando sea necesario hacer mantenimiento a una instalaci√≥n.

1356

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Finalidad
El ajuste predeterminado es "Cliente y servidor OPC UA". Conserve este ajuste
predeterminado para el servidor OPC UA. El cuadro de di√°logo "Generar nuevo certificado"
puede llamarse desde varios puntos en STEP 7. Si, por ejemplo, se abre el cuadro de
di√°logo para el servidor web de la CPU, en "Finalidad de uso" se introduce "Servidor web".
En la lista desplegable correspondiente a la finalidad est√°n disponibles las opciones
siguientes:
‚Äì "Cliente OPC UA"
‚Äì "Cliente y servidor OPC UA"
‚Äì "Servidor OPC UA"
‚Äì "TLS"
‚Äì "Servidor web"
‚óè Nombre alternativo del titular del certificado (SAN)
En el ejemplo anterior est√° especificado: "URI:urn:SIMATIC.S7-1500.OPCUAServer:PLC1,IP:192.168.178.151,IP:192.168.1.1". Esta URI debe especificarse
correctamente, puesto que se comprobar√° compar√°ndola con la descripci√≥n transmitida de
la aplicaci√≥n.
Tambi√©n ser√≠a v√°lida la entrada siguiente: "IP: 192.168.178.151, IP: 192.168.1.1". Es
importante que aqu√≠ est√©n especificadas las direcciones IP que ofrecen acceso al servidor
OPC UA de la CPU.
Consulte "Acceso al servidor OPC UA (P√°gina 1343)".
De este modo, los clientes OPC UA verifican si realmente debe establecerse una conexi√≥n
con el servidor OPC UA del S7-1500, o si posiblemente un atacante est√° intentando enviar
valores manipulados al cliente OPC UA desde otro PC.

Autenticaci√≥n del usuario
Tipos de autenticaci√≥n del usuario
En el servidor OPC UA del S7-1500 puede ajustarse c√≥mo debe legitimarse un usuario del
cliente OPC UA si desea acceder al servidor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1357

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para ello, existen las siguientes posibilidades:
‚óè Autenticaci√≥n de hu√©sped
El usuario no tiene que demostrar que tiene autorizaci√≥n (acceso an√≥nimo). El servidor
OPC UA no comprueba el permiso del usuario del cliente.
Si desea utilizar este tipo de autenticaci√≥n del usuario, active la opci√≥n "Activar
autenticaci√≥n de hu√©sped" en "OPC UA > Servidor > Seguridad > Autenticaci√≥n de usuario".
Nota
Para aumentar la seguridad, el acceso al servidor OPC UA solo deber√≠a permitirse con
autenticaci√≥n de usuario.
‚óè Autenticaci√≥n mediante nombre de usuario y contrase√±a
El usuario tiene que demostrar que tiene autorizaci√≥n (acceso no an√≥nimo). El servidor
OPC UA comprueba si el usuario cliente est√° autorizado a acceder al servidor. Como
prueba sirven el nombre de usuario con la contrase√±a correcta.
Si desea utilizar este tipo de autenticaci√≥n del usuario, active la opci√≥n "Activar
autenticaci√≥n con nombre de usuario y contrase√±a" en "OPC UA > Servidor > Seguridad >
Autenticaci√≥n de usuario".
Desactive la autenticaci√≥n de invitados.
Introduzca los usuarios en la tabla "Administraci√≥n de usuarios".
Para ello, haga clic en cada caso en la entrada "<Agregar usuario>". Se crea un usuario con
un nombre asignado autom√°ticamente. Es posible editar el nombre de usuario e introducir
la contrase√±a correspondiente al nombre de usuario. Se puede introducir un m√°ximo de 21
usuarios.
‚óè Administraci√≥n de usuarios adicional desde la configuraci√≥n de seguridad del proyecto
La opci√≥n "Activar la administraci√≥n de usuarios adicional desde la configuraci√≥n de
seguridad del proyecto" se encuentra en los ajustes OPC UA generales (Propiedades de la
CPU: OPC UA > General). Si activa esta opci√≥n, la administraci√≥n de usuarios del proyecto
abierto se utilizar√° tambi√©n para la autenticaci√≥n de usuarios del servidor OPC UA: En OPC
UA ser√°n entonces v√°lidos los mismos nombres de usuario y contrase√±as que en el
proyecto actual.
Para activar la administraci√≥n de usuarios del proyecto, haga lo siguiente:
‚Äì En el "√Årbol del proyecto" haga clic en "Ajustes de seguridad > Ajustes".
‚Äì Haga clic en el bot√≥n "Proteger este proyecto".
‚Äì Introduzca su nombre de usuario y contrase√±a.
‚Äì Introduzca otros usuarios en "Ajustes de seguridad > Usuarios y funciones".
Si configura otro servidor OPC UA en su proyecto, active tambi√©n en el proyecto la opci√≥n
"Activar la administraci√≥n de usuarios adicional desde la configuraci√≥n de seguridad del
proyecto". De esta forma no ser√° necesario introducir de nuevo los nombres de usuario y
contrase√±as.

Consulte tambi√©n
Autenticaci√≥n del usuario (P√°gina 1447)
Usuarios y roles con derechos de funci√≥n OPC UA (P√°gina 1359)

1358

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Usuarios y roles con derechos de funci√≥n OPC UA
Las opciones siguientes para la autenticaci√≥n de usuarios recurren a ajustes centrales para
usuarios del proyecto.
‚óè En el servidor:
Al parametrizar las propiedades de la CPU (OPC UA > Servidor > Seguridad >
Autenticaci√≥n de usuarios). All√≠ es la opci√≥n "Activar la administraci√≥n de usuarios adicional
desde la configuraci√≥n de seguridad del proyecto"
‚óè En el cliente:
Al configurar la interfaz de cliente (ficha "Configuraci√≥n", √°rea "Seguridad"). All√≠ es la opci√≥n
"Usuario (TIA Portal - Ajustes de seguridad)"

Requisitos
Para poder editar los ajustes de seguridad, el proyecto debe estar protegido y se debe haber
iniciado sesi√≥n con derechos suficientes, p. ej., de administrador.

Ajustes en el √°rbol del proyecto > "Ajustes de seguridad"
En el proyecto protegido se accede a los ajustes centrales de usuarios y roles en el √°rbol del
proyecto, secci√≥n "Ajustes de seguridad". Aqu√≠ se definen centralizadamente usuarios con sus
nombres de usuario, contrase√±a y derechos de funciones. Estos ajustes pueden reutilizarse en
otro lugar.

Reutilizar los ajustes centrales de seguridad
Algunos ejemplos de lugares de reutilizaci√≥n son:
‚óè Selecci√≥n de usuarios para la autenticaci√≥n de usuarios en el servidor OPC UA
En este ajuste se notifica al servidor qu√© cliente (usuario) est√° autorizado a acceder al
servidor, y con qu√© nombre de usuario y qu√© contrase√±a.
‚óè Selecci√≥n de usuarios para la autenticaci√≥n como clientes de OPC UA
En este ajuste se comunica al cliente con qu√© nombre de usuario y qu√© contrase√±a se
autentica como cliente ante el servidor.
Los ajustes del cliente y del servidor deben coincidir: el nombre de usuario y la contrase√±a con
la que el cliente inicia sesi√≥n deben estar creados en el servidor y disponer de los permisos
correspondientes.

Derechos de funciones para servidor y cliente
Para los usuarios con funci√≥n de cliente y para los usuarios con funci√≥n de servidor en una
CPU S7-1500 deben estar activados tambi√©n los correspondientes derechos de funciones
para el cliente o para el servidor. No basta con depositar centralizadamente el nombre de
usuario y la contrase√±a.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1359

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Un ejemplo explica este tipo de administraci√≥n de derechos.
1. En la ficha "Funciones" de la secci√≥n "Ajustes de seguridad > Usuarios y roles" se define un
nuevo rol, p. ej. con el nombre "PLC-opcua-role-all-inclusive".
Sugerencia: Posiblemente la ficha quede oculta por una ventana de informaci√≥n ("A√∫n no
se ha comprobado el estado actual..."). En dicho caso, cierre antes la ventana de
informaci√≥n.
2. En la secci√≥n "Categor√≠as de derechos de funciones" despl√°cese hasta los derechos de
Runtime, despu√©s hasta los derechos de funciones de la CPU y seleccione la CPU cuyos
derechos de funciones desea configurar, p. ej., PLC_2.
3. En el √°rea "Derechos de funciones" encontrar√° los siguientes derechos de funciones:
‚Äì Acceso de servidor OPC UA
Este derecho act√∫a en el servidor OPC UA de la CPU S7-1500. Solo si est√°
seleccionada esta opci√≥n, un usuario del servidor de la CPU PLC_2 al que se le ha
asignado el rol "PLC-opcua-role-all-inclusive" tendr√° el derecho siguiente: para
establecer una sesi√≥n con el servidor desde el cliente fuerza la autenticaci√≥n con un
nombre de usuario definido centralmente (y cargado en la CPU) y las contrase√±as
correspondientes.
‚Äì Autenticaci√≥n de usuario del cliente OPC UA
Este derecho act√∫a en el cliente OPC UA de la CPU S7-1500 (en las instrucciones de
cliente). Solo si est√° seleccionada esta opci√≥n, el usuario del cliente de la CPU PLC_2
al que se le ha asignado el rol "PLC-opcua-role-all-inclusive" puede utilizar el nombre de
usuario y la contrase√±a correspondientes para autenticarse y establecer una sesi√≥n con
un servidor.

4. Es necesario asignar el rol "PLC-opcua-role-all-inclusive" a los usuarios correspondientes
(ficha "Usuarios" en el √°rea "Ajustes de seguridad" del √°rbol del proyecto).

Consulte tambi√©n
Autenticaci√≥n del usuario (P√°gina 1357)
Autenticaci√≥n del usuario (P√°gina 1447)

Ajustes de diagn√≥stico del servidor
Diagn√≥stico
El alcance de los diagn√≥sticos del servidor OPC UA puede determinarse en los ajustes de la
CPU.
Para cambiar el alcance del diagn√≥stico vaya al √°rea "OPC UA > Servidor > Diagn√≥stico".

1360

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajuste predeterminado
El ajuste predeterminado es un comportamiento de diagn√≥stico que permite obtener los
diagn√≥sticos principales sin aumentar significativamente la carga por comunicaci√≥n.
Los diagn√≥sticos para suscripciones se activan si el servidor OPC UA tambi√©n utiliza
suscripciones, y en tal caso solo en la fase de puesta en marcha.
Motivo: Muchos diagn√≥sticos generan una gran carga por comunicaci√≥n en la CPU y, en
determinadas circunstancias, desplazan a otros mensajes importantes. O bien, cuando hay
una gran cantidad de diagn√≥sticos, los avisos importantes quedan ocultos entre la masa de
avisos y pasan desapercibidos.

Informaci√≥n adicional
Encontrar√° m√°s informaci√≥n sobre el significado y el efecto de los ajustes mostrados m√°s
arriba aqu√≠.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1361

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Licencias para OPC UA
Licencias runtime
Para operar el servidor OPC UA de la CPU S7-1500 se requiere una licencia. El tipo de la
licencia requerida depende del rendimiento de la respectiva CPU. Se distinguen los siguientes
tipos de licencia:
‚óè SIMATIC OPC UA S7-1500 small (necesaria para CPU 1511, CPU 1512, CPU 1513, CPU
ET 200SP, CPU 1515SP PC)
‚óè SIMATIC OPC UA S7-1500 medium (necesaria para CPU 1515, CPU 1516, controlador por
software CPU 1507, CPU 1516pro-2PN)
‚óè SIMATIC OPC UA S7-1500 large (necesaria para CPU 1517, CPU 1518)
El tipo de licencia requerida se muestra en "Propiedades > General > Licencias runtime > OPC
UA > Tipo de licencia necesaria":

Para confirmar la compra de la licencia requerida, proceda del siguiente modo:
1. Haga clic en las propiedades de la CPU en "Licencias runtime > OPC UA".
2. Seleccione la licencia necesaria en la lista desplegable "Tipo de licencia adquirida".

Configuraci√≥n de la interfaz de servidor OPC UA
¬øQu√© es una interfaz de servidor?
Definici√≥n
Una interfaz de servidor agrupa en una unidad los nodos de un espacio de direcciones OPC
UA de una CPU, de manera que los clientes OPC UA obtienen una determinada vista de la
CPU.
Cada interfaz de servidor define uno o varios espacios de nombres en el servidor OPC UA de
la CPU.

1362

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
STEP 7 (TIA Portal) distingue entre los siguientes tipos de interfaces de servidor:
‚óè Especificaci√≥n companion
Para este tipo de interfaz de servidor se utiliza, p. ej., una especificaci√≥n companion que ha
creado un grupo de trabajo.
Por lo general, el grupo de trabajo se compone de miembros de la OPC Foundation y otra
organizaci√≥n industrial, los cuales han especificado juntos un modelo de informaci√≥n OPC
UA para una finalidad concreta (por ejemplo para el intercambio de datos con dispositivos
RFID o con m√°quinas de moldeo por inyecci√≥n).
Este modelo de informaci√≥n se ejecuta en forma de nodo OPC UA en el espacio de
direcciones de un servidor OPC UA. Los clientes OPC UA pueden acceder a estos nodos
OPC UA.
El tipo de interfaz de servidor "Especificaci√≥n companion" tambi√©n se puede utilizar, p. ej.,
para cargar modelos de informaci√≥n creados internamente en la empresa, p. ej., en SiOME.
Si en el proyecto se aplica una especificaci√≥n companion determinada, deben incorporarse
las especificaciones de esta especificaci√≥n companion en el proyecto como interfaz de
servidor.
Para interfaces de servidor del tipo "Especificaciones Companion" es posible importar
varios espacios de nombres que utilicen la especificaci√≥n Companion.
Encontrar√° m√°s informaci√≥n sobre las especificaciones Companion aqu√≠ (P√°gina 1380).
Encontrar√° m√°s informaci√≥n sobre SiOME aqu√≠ (https://
support.industry.siemens.com/cs/ww/es/view/109755133).
‚óè Interfaz de servidor definida por el usuario:
Para este tipo de interfaz de servidor, los nodos OPC UA de un servidor OPC UA se
agrupan en una unidad.
Para ello, ori√©ntese seg√∫n las especificaciones del proyecto o las necesidades de la
m√°quina o instalaci√≥n.
Encontrar√° m√°s informaci√≥n sobre la interfaz de servidor definida por el usuario aqu√≠
(P√°gina 1364).

M√°quina de moldeo por inyecci√≥n como ejemplo de especificaci√≥n Companion
En este ejemplo, una interfaz de servidor contiene los elementos siguientes:
‚óè Nodos OPC UA que se pueden leer con un cliente OPC UA para obtener informaci√≥n sobre
la m√°quina de inyecci√≥n (desde variables PLC con acceso de lectura),
‚óè Nodos OPC UA que se pueden escribir con un cliente OPC UA para transferir valores a la
m√°quina de inyecci√≥n (en variables PLC con acceso de escritura),
‚óè Nodos OPC UA que se pueden llamar con un cliente OPC UA para iniciar funciones de la
m√°quina de inyecci√≥n (mediante m√©todos de servidor).
Esta interfaz de servidor proporciona una vista estandarizada de una CPU que act√∫a como
controlador de una m√°quina de inyecci√≥n.
La especificaci√≥n Companion "Euromap" define para las m√°quinas de moldeo por inyecci√≥n
una serie de nodos OPC UA que pueden utilizarse como interfaz con el servidor.
Esta interfaz de servidor no incluye otros nodos OPC UA de la CPU. As√≠ se obtiene una mejor
visi√≥n de conjunto.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1363

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de interfaz de servidor definida por el usuario
Una CPU debe controlar la fabricaci√≥n de piezas. La producci√≥n empieza cuando llega una
orden de producci√≥n del sistema de control de procesos superior.
Las √≥rdenes de producci√≥n se transfieren a trav√©s de un m√©todo de servidor: Un sistema de
control de procesos transfiere la informaci√≥n sobre una pieza llamando el m√©todo de servidor
en la CPU. Este m√©todo de servidor tambi√©n inicia la producci√≥n.
El sistema de control de procesos, es decir, el cliente OPC UA conectado tan solo debe ver
este m√©todo de servidor. Para ello, cree una interfaz de servidor definida por el usuario en la
CPU y as√≠gnele el m√©todo de servidor. Se trata de habilitar esta interfaz de servidor solo para
clientes OPC UA y, con ello, limitar la vista de la CPU a esta funci√≥n.

Consulte tambi√©n
Utilizaci√≥n de especificaciones OPC UA Companion (P√°gina 1369)

Crear una interfaz de servidor personalizada
Introducci√≥n
La descripci√≥n parte del ejemplo siguiente:
Una valla de protecci√≥n rodea la c√©lula de fabricaci√≥n "Cell_1". La valla tiene la puerta
"Gate_1".
Una CPU S7-1500 controla toda la c√©lula de fabricaci√≥n y controla tambi√©n el acceso a trav√©s
de la Gate_1.
En la c√©lula de fabricaci√≥n, un robot embala medicamentos en cajas de cart√≥n y, a
continuaci√≥n, apila las cajas de cart√≥n en palets.
Unos veh√≠culos transportadores autopropulsados transportan los palets al almac√©n central
atravesando la Gate_1.
La CPU publica una interfaz de servidor a trav√©s de la cual los sistemas de transporte sin
conductor provocan la apertura de la Gate_1.
La interfaz de servidor contiene el m√©todo de servidor "smOpenGate" para abrir la puerta, as√≠
como la variable "Gate_1_State", que indica el estado de la puerta (abierta o cerrada).

Crear una interfaz de servidor personalizada
Para crear una interfaz de servidor, proceda del siguiente modo:
1. Seleccione la CPU que desea utilizar como servidor OPC UA y que ha configurado.
2. Haga clic en "Comunicaci√≥n OPC UA > Interfaces de servidor".

1364

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Haga doble clic en "Agregar nueva interfaz de servidor".
STEP 7 muestra el cuadro de di√°logo siguiente:

4. Cambie el nombre de la nueva interfaz de servidor para que sea descriptivo en el proyecto.
En el ejemplo, el nombre "Interfaz de servidor_1" propuesto por STEP 7 se cambia por
"Cell_1".
5. Haga clic en el bot√≥n "Interfaz de servidor" y despu√©s en "Aceptar".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1365

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
6. Para ello, haga clic en el tri√°ngulo situado delante de "Bloques de programa", en el √°rea
"Elementos OPC UA", para abrir la carpeta "Bloques de programa".
STEP 7 muestra la siguiente tabla para editar:

El editor est√° dividido en dos √°reas:
‚Äì Interfaz de servidor OPC UA
En la parte izquierda se encuentra el nodo ra√≠z de la interfaz de servidor "Cell_1".
Esta interfaz est√° vac√≠a de momento: Todav√≠a no se han agregado elementos OPC UA
a la interfaz de servidor.
‚Äì Elementos OPC UA
En la parte derecha se encuentran los elementos OPC UA.
Los elementos OPC UA son objetos que hasta ese momento se han creado en el
proyecto STEP 7 y que tienen la propiedad "Accesible desde HMI/OPC UA".
Los elementos OPC UA pueden agregarse a la nueva interfaz de servidor "Cell_1".
7. Arrastre los elementos OPC UA a la fila "<Agregar nuevo>" de la nueva interfaz de servidor
con la funci√≥n Drag&Drop.
Nota
En general se aplica lo siguiente: si deposita bloques de datos u objetos tecnol√≥gicos en el
√°rea izquierda de la tabla, STEP 7 (TIA Portal) genera un objeto en la interfaz de servidor.
Debajo estar√°n dispuestos los elementos de los bloques de datos como nodos propios.
Si deposita estructuras en el √°rea izquierda de la tabla, STEP 7 genera un nodo para la
estructura en su conjunto y nodos para cada elemento de la estructura.
Lo mismo ocurre con los arrays: tambi√©n en este caso, STEP 7 genera un nodo para el array
en su conjunto y nodos para cada elemento del array.
Si deposita un m√©todo en el √°rea izquierda de la tabla, STEP 7 genera un √∫nico nodo; los
argumentos del m√©todo insertado se muestran como informaci√≥n.
En el ejemplo, arrastre la variable "Gate_1_State" del √°rea derecha al √°rea izquierda, hasta
"<Agregar nuevo>".
Despu√©s, arrastre el m√©todo de servidor al √°rea izquierda.
Este m√©todo de servidor se encuentra dentro del bloque de datos "smOpenGate_DB [DB3"
en el √°rea derecha.
STEP 7 (TIA Portal) muestra el cuadro de di√°logo del siguiente modo:

1366

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Limitar la visi√≥n sobre el servidor OPC UA
Si se limita la selecci√≥n de elementos OPC UA se limitar√° la visi√≥n sobre el servidor OPC UA
y tambi√©n las posibilidades de los clientes OPC UA.
En la interfaz de servidor del ejemplo falta el bloque de datos "Robot_1", porque los veh√≠culos
transportadores no necesitan acceder a los m√©todos de servidor ni a las variables del robot.
En ese caso, conviene desactivar la interfaz est√°ndar del servidor (espacio de nombres
SIMATIC) en las propiedades OPC UA de la CPU S7-1500 para que los nodos filtrados no
est√©n accesibles de otro modo.

Tambi√©n es posible desactivar la visibilidad de cada una de las interfaces de servidor
parametrizadas en las propiedades de la interfaz de servidor e impedir as√≠ que la interfaz en
cuesti√≥n pueda ser utilizada por clientes durante el funcionamiento. Esta opci√≥n permite, por
ejemplo, definir varias interfaces de servidor de forma centralizada y cargar solo la interfaz de
servidor requerida.
Una interfaz de servidor que ya se ha definido una vez se puede copiar en otra CPU mediante
Drag&Drop en el √°rbol del proyecto.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1367

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n sobre la interfaz de servidor
El editor de la interfaz de servidor OPC UA est√° estructurado en forma de tabla y presenta la
informaci√≥n que se describe a continuaci√≥n:
Tenga en cuenta que inicialmente no se muestran todas las columnas. Lo que se muestra
puede determinarse haciendo clic con el bot√≥n derecho del rat√≥n en la fila de t√≠tulos de la tabla.
Si hay una fila seleccionada, los atributos OPC UA del nodo podr√°n mostrarse en la ventana
de inspecci√≥n (√°rea "Atributos OPC UA"), p. ej. la ID, la clase y el tipo de nodo, adem√°s de la
descripci√≥n.
‚óè BrowseName
En la parte superior se muestra el nombre, independiente del idioma, de la interfaz de
servidor personalizada (BrowseName). Dicho nombre se puede elegir libremente.
Debajo del nombre de la interfaz aparecen los nombres (BrowseNames) de los diferentes
nodos OPC UA que se han agregado a la interfaz de servidor.
En este cuadro de di√°logo no es posible modificar el nombre de un nodo OPC UA. Los
nombres provienen del proyecto STEP 7.
S√≠ que es posible borrar un nodo OPC UA de la tabla. Con ello, deja de formar parte de la
interfaz de servidor y de ser visible para clientes OPC UA.
‚óè DisplayName
Igual que BrowseName, aunque el nombre es traducible y se muestra en el idioma
correspondiente, si este est√° disponible.
‚óè ID de nodo
NodeId del nodo OPC UA, p. ej., http://Server-Node_1; i=1
‚óè Tipo de nodo
Tipo de nodo OPC UA, por ejemplo BOOL, BYTE, INT, etc.
Estos tipos de nodo han sido definidos por Siemens, no por la OPC Foundation. La OPC
Foundation utiliza, por ejemplo, el tipo de nodo Boolean para BOOL. BOOL deriva
directamente de Boolean.
El tipo de nodo indicado no puede modificarse en este cuadro de di√°logo. Si desea utilizar
un tipo de nodo distinto, deber√° modificar el tipo de variable PLC correspondiente en el
proyecto STEP 7.
‚óè Tipo de datos
Se indica el tipo de datos SIMATIC que se utiliza en el proyecto STEP 7, por ejemplo Bool,
Byte, Int, etc.
‚óè Nivel de acceso
‚Äì Si un nodo OPC UA es una variable (tipo UAVariable), puede ser de solo lectura (RD)
o de lectura y escritura (RD/WR).
‚Äì Si un nodo OPC UA es un m√©todo (tipo UAMethod), puede llamarse siempre.
‚óè Datos locales
Es el tipo de datos SIMATIC del bloque de datos de la CPU del que se lee el valor de un
nodo OPC UA (del tipo UAVariable) o al que se le asigna un valor.

1368

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comprobaci√≥n de coherencia
Es posible controlar la coherencia de la interfaz de servidor.
Al comprobar la coherencia, STEP 7 verifica si los nodos OPC UA de la interfaz de servidor
est√°n asignados a un elemento OPC UA adecuado (del mismo tipo de datos) o si el elemento
utilizado sigue existiendo en la CPU.
Para comprobar la coherencia de la interfaz de servidor, haga clic en el s√≠mbolo siguiente
situado en la barra de herramientas del editor de la interfaz de servidor OPC UA:

Exportaci√≥n de interfaz
Existe la posibilidad de exportar la interfaz del servidor OPC UA como archivo XML. Este
archivo XML contiene todas las definiciones de tipos de datos que referencia la interfaz de
servidor.
Para exportar la interfaz de servidor OPC UA, haga clic en el s√≠mbolo siguiente situado en la
barra de herramientas del editor de la interfaz de servidor OPC UA:

Consulte tambi√©n
Plantillas maestras para la comunicaci√≥n OPC UA (P√°gina 1456)

Utilizaci√≥n de especificaciones OPC UA Companion
Introducci√≥n
OPC UA puede utilizarse universalmente: el propio est√°ndar, p. ej., no se pronuncia sobre
c√≥mo debe llamarse a las variables PLC. Asimismo cada usuario (desarrollador de
aplicaciones) puede decidir libremente si programar y nombrar m√©todos de servidor que
puedan llamarse a trav√©s de OPC UA.
Modelado de informaci√≥n y estandarizaci√≥n para dispositivos y ramos
Para aplicaciones similares existe la posibilidad de estandarizar la interfaz del dispositivo o de
la m√°quina con el "kit OPC UA".
Muchos son los gremios y sectores que han impulsado la estandarizaci√≥n y elaborado
diferentes especificaciones Companion.
En estas especificaciones se define:
‚óè con qu√© objetos, m√©todos y variables debe describirse un dispositivo t√≠pico o una m√°quina
t√≠pica;
‚óè qu√© espacio de nombres est√° previsto para los objetos mencionados.
Las m√°quinas se estructuran t√≠picamente en unidades funcionales o tecnol√≥gicas que se
estandarizan.
Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1369

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las especificaciones Companion ofrecen a los operadores de m√°quinas e instalaciones la
ventaja de una interfaz unificada. Por ejemplo, todos los lectores RFID que cumplan la
especificaci√≥n AutoID pueden integrarse del mismo modo. Es decir, los clientes OPC UA
pueden responder de igual modo a todos los lectores RFID que cumplen la especificaci√≥n
AutoID, con independencia del fabricante de los lectores RFID.
Otro ejemplo de especificaci√≥n Companion en el √°mbito de las m√°quinas de moldeo por
inyecci√≥n es la especificaci√≥n Companion Euromap 77.
El cap√≠tulo siguiente describe, tomando como ejemplo Euromap 77, c√≥mo se aplica una
especificaci√≥n Companion en STEP 7 (TIA Portal) creando para ello variables PLC.

Ejemplo Euromap 77
Euromap 77 normaliza el intercambio de datos entre las m√°quinas de moldeo por inyecci√≥n y
el MES (Manufacturing Execution System) superior. Esto permite que el MES integre todas las
m√°quinas de moldeo por inyecci√≥n subyacentes.
La interfaz de datos unificada facilita la integraci√≥n de las m√°quinas de moldeo por inyecci√≥n
en una instalaci√≥n.

Uso de especificaciones Companion: Resumen
Euromap 77 se describe en el archivo XML de OPC UA
"Opc_Ua.EUROMAP77.NodeSet2.xml".
Nota
Euromap 77, Euromap 83 y OPC UA for Devices (DI)
Con la versi√≥n Candidate 2, parte de las definiciones de Euromap 77 se transfirieron a
Euromap 83. Por ello, tambi√©n es necesario importar la interfaz del servidor OPC UA de
Euromap 83.
"OPC UA for Devices" es un modelo de informaci√≥n de validez general para configurar
componentes hardware y software. El modelo de informaci√≥n tambi√©n sirve de base para otros
est√°ndares Companion, por lo que tambi√©n se importa.
Obtendr√° los archivos XML OPC UA aqu√≠:
Euromap77 (http://www.euromap.org/euromap77)
Euromap83 (http://www.euromap.org/euromap83)
OPC UA for Devices (https://opcfoundation.org/UA/schemas/DI/)
Estos archivos XML definen una interfaz OPC UA de una m√°quina de moldeo por inyecci√≥n
conforme con la Euromap 77.

1370

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Uso de Euromap 77: Resumen
Para utilizar Euromap 77, proceda del siguiente modo:
1. Con el programa SiOME cree un archivo XML, y cree en √©l una instancia del tipo
"IMM_MES_InterfaceType".
Proceda del modo descrito en el "Paso 1: Crear instancias en SiOME".
2. En STEP 7 (TIA Portal), cree variables PLC y m√©todos de servidor que equivalgan a la
instancia del tipo "IMM_MES_InterfaceType" (creado en el paso 1).
Proceda del modo descrito en el "Paso 2: Crear variables PLC en STEP 7".
Encontrar√° un ejemplo de nodos OPC UA y de las variables PLC correspondientes en el
cap√≠tulo "Crear una interfaz de servidor para la especificaci√≥n companion (P√°gina 1380)".
3. En STEP 7 (TIA Portal), agregue una nueva interfaz de servidor del tipo Especificaci√≥n
Companion e importe el archivo XML que ha creado en el paso 1.
Proceda del modo descrito en el cap√≠tulo "Crear una interfaz de servidor para la
especificaci√≥n companion (P√°gina 1380)".
4. Asigne a los nodos OPC UA de la nueva interfaz de servidor las variables PLC
correspondientes que ha creado en el paso 2.
Proceda del modo descrito en el cap√≠tulo "Crear una interfaz de servidor para la
especificaci√≥n companion (P√°gina 1380)".

Paso 1: Crear instancias en SiOME
A continuaci√≥n se describe c√≥mo utilizar el programa gratuito "SiOME", el "Siemens OPC UA
Modeling Editor".
SiOME permite crear un archivo XML OPC UA que describe una interfaz de servidor (un
modelo de informaci√≥n).
Encontrar√° el enlace de descarga y explicaciones sobre SiOME aqu√≠ (https://
support.industry.siemens.com/cs/ww/es/view/109755133).
Procedimiento en STEP 7
Para utilizar la nueva interfaz de servidor, importe la interfaz de servidor al proyecto STEP 7;
consulte el cap√≠tulo "Crear una interfaz de servidor para la especificaci√≥n companion
(P√°gina 1380)".
Si el proyecto est√° cargado en la CPU, la nueva interfaz de servidor estar√° disponible para
clientes OPC UA.
Procedimiento en SiOME 1.7.3
La descripci√≥n siguiente muestra los pasos que deben seguirse en SiOME 1.7.3.
Para utilizar Euromap 77, cree un archivo XML con una instancia de
"IMM_MES_InterfaceType".
Solo con la instanciaci√≥n del tipo de objeto se crear√° la variante (el modelo de informaci√≥n) de
la m√°quina concreta en el espacio de direcciones del servidor OPC UA.
El tipo de objeto "IMM_MES_InterfaceType" es el tipo de objeto ra√≠z de Euromap 77. "IMM"
significa "Injection Moulding Machine".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1371

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Proceda del siguiente modo:
1. Cargue los archivos "Opc_Ua.EUROMAP77.NodeSet2.xml" y
"Opc_Ua_EUROMAP83_NodeSet2.xml" desde el sitio web de Euromap (v√©ase m√°s
arriba).
2. Cargue el archivo "Opc.Ua.Di.NodeSet2.xml" desde el sitio web de la OPC Foundation.
El archivo "Opc.Ua.Di.NodeSet2.xml" contiene las definiciones de tipo que utiliza Euromap
77 .
3. Inicie SiOME.
4. Cree primero el espacio de nombres "http://opcfoundation.org/UA/DI/"
Para ello, haga clic en el bot√≥n "Import XML" del √°rea "Information model".

SiOME muestra el cuadro de di√°logo para abrir archivos.
5. Seleccione el archivo "Opc.Ua.Di.NodeSet2.xml" y haga clic en el bot√≥n "Abrir" para
importar el archivo.
Resultado: SiOME importa el archivo XML y muestra el espacio de nombres "http://
opcfoundation.org/UA/DI/" en el √°rea "Namespaces".
En SiOME, el espacio de nombres est√°ndar "http://opfoundation.org/UA/" siempre existe y
no es necesario importarlo.
6. A continuaci√≥n, importe el espacio de nombres "http://www.euromap.org/euromap83/".
Para ello haga de nuevo clic en el bot√≥n "Import XML" del √°rea "Information model".
Seleccione el archivo "Opc_Ua.EUROMAP83.NodeSet2.xml".
Resultado: SiOME importa el archivo XML y a continuaci√≥n, muestra tambi√©n el espacio de
nombres "http://www.euromap.org/euromap83/" en el √°rea "Namespaces".
7. A continuaci√≥n, importe el espacio de nombres "http://www.euromap.org/euromap77/".
Para ello haga de nuevo clic en el bot√≥n "Import XML" del √°rea "Information model".
Seleccione el archivo "Opc_Ua.EUROMAP77.NodeSet2.xml".
8. Cree un espacio de nombres propio para su proyecto.
Para ello, en el √°rea "Namespaces" haga clic con el bot√≥n derecho del rat√≥n en "OPC UA
Modelling Editor Project" o en "Namespaces" y seleccione "Add Namespace".
SiOME abre el cuadro de di√°logo "Add Namespace".
9. Introduzca el nombre de un espacio de nombres nuevo.
En el ejemplo se utiliza el espacio de nombres "YourCompany.org".
SiOME muestra ahora el nuevo espacio de nombres:

1372

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
10.Cree una instancia del tipo de objeto ra√≠z IMM_MES_InterfaceType de la especificaci√≥n
Companion Euromap 77.
Para ello, en el √°rea "Information model" haga clic con el bot√≥n derecho del rat√≥n en el
directorio "DeviceSet" y seleccione "Add Instance".
SiOME muestra el cuadro de di√°logo "Add Instance".
11.En "Name" inserte un nombre descriptivo para la nueva instancia.
En el ejemplo introduzca "IMM_Manufacturer_01234".
En "TypeDefinition" seleccione "IMM_MES_InterfaceType".
Este tipo de objeto es el tipo de objeto ra√≠z de Euromap 77: si crea una instancia de este tipo
de objeto, utilice Euromap 77 una vez en el espacio de direcciones de su servidor OPC UA.
12.Haga clic en "Aceptar".
SiOME muestra la nueva instancia "IMM_Manufacturer_01234" en el √°rea "Information
model" de "DeviceSet":

13.Cree una instancia del tipo de objeto "InjectionUnitType".
Para ello, en el √°rea "Information model" haga clic con el bot√≥n derecho del rat√≥n en el
directorio "InjectionUnits" y seleccione "Add Instance".
SiOME muestra el cuadro de di√°logo "Add Instance".
En "Name" inserte un nombre descriptivo para la instancia.
Introduzca "InjectionUnit_1" en el ejemplo.
En "TypeDefinition" seleccione "InjectionUnitType".
Haga clic en "Aceptar".
14.En el directorio "Moulds", cree una instancia nueva "Mould_1" del tipo de objeto
"MouldType".
15.En el directorio "PowerUnits", cree una instancia nueva "PowerUnit_1" del tipo de objeto
"PowerUnitType".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1373

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
16.Guarde el archivo XML.
Para ello, haga clic en el bot√≥n "Quick save" del √°rea "Information model":

17.Exporte el archivo XML.
Para ello, haga clic en el bot√≥n "Export XML" del √°rea "Information model".

SiOME muestra el cuadro de di√°logo "Export XML".
18.Deje todos los espacios de nombres activados y haga clic en "Aceptar".
SiOME muestra el cuadro de di√°logo "Guardar como".
19.Seleccione un nombre descriptivo y guarde el archivo exportado.
En el ejemplo, ponga el nombre "IMM_Manufacturer_01234" al archivo XML.
Resultado:
Se ha creado un archivo XML que utiliza una vez la especificaci√≥n Companion Euromap 77
(con una instancia).

Paso 2: Crear variables PLC en STEP 7 para la instancia Euromap 77
Para Euromap 77 deben crearse en el programa de usuario variables PLC y m√©todos de
servidor y asignarlos a la instancia del tipo "IMM_MES_InterfaceType".
Proceda del siguiente modo para crear variables PLC para la instancia del tipo
"IMM_MES_InterfaceType".
1. Cree un tipo de datos definido por el usuario (UDT).
La figura siguiente muestra como ejemplo el principio del tipo de datos definido por el
usuario "InjectionUnit".
Este tipo de datos tiene la misma estructura que "InjectionUnit" en el tipo
"IMM_MES_InterfaceType".
Aseg√∫rese de utilizar tipos de datos SIMATIC que sean compatibles con los tipos de datos
OPC UA (consulte m√°s abajo "Mapeo de los tipos de datos").

2. Agregue un nuevo bloque de datos global al proyecto STEP 7.
En el ejemplo, asigne el nombre "IMM_Manufacturer_01234" al bloque de datos, de modo
que haya una relaci√≥n entre la m√°quina de moldeo por inyecci√≥n del fabricante en cuesti√≥n
y el n√∫mero de serie.
3. Crea un elemento nuevo en este bloque de datos.
En el ejemplo, asigne a este elemento el nombre "InjectionUnit_1".
4. Asigne a este elemento el nuevo tipo de datos definido por el usuario "InjectionUnit".

1374

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Resultado
En el proyecto STEP 7 se ha creado una variable para Euromap 77 en el bloque de datos
"IMM_Manufacturer_01234".

Reglas para los archivos XML OPC UA
Importaci√≥n de archivos XML OPC UA exportados a una CPU S7-1500
Al importar interfaces de servidores que provengan de la exportaci√≥n XML OPC UA de un
S7-1500, tenga en cuenta la siguiente nota.
Nota
Importaci√≥n bloqueada para el espacio de nombres "http://www.siemens.com/simatic-s7opcua"
No es posible importar a una CPU S7-1500 una interfaz de servidor con espacio de nombres
"http://www.siemens.com/simatic-s7-opcua", puesto que dicho espacio de nombres est√°
reservado para las CPU S7-1500 (interfaz est√°ndar de servidor SIMATIC) y est√° bloqueado
para la importaci√≥n.
Si se desea importar una interfaz de servidor con el espacio de nombres "http://
www.siemens.com/simatic-s7-opcua", abra la interfaz de servidor que vaya a importarse
(archivo XML OPC UA) y modifique el espacio de nombres donde sea preciso. A continuaci√≥n
podr√° importarse el archivo modificado.

Integridad de los archivos XML OPC UA
Los archivos XML OPC UA representan el espacio de direcciones del servidor. Estos archivos,
una vez adaptados a la aplicaci√≥n, se importan como interfaz del servidor, p. ej. en el contexto
de las especificaciones de OPC UA Companion, se cargan con la configuraci√≥n hardware en
la CPU S7-1500 y se prueban.
ADVERTENCIA
No se comprueban los archivos XML OPC UA importados
Estos archivos XML OPC UA deben protegerse de manipulaciones no autorizadas, pues
STEP 7 no comprueba su integridad.
Recomendaci√≥n
Para minimizar riesgos en caso de ampliar o modificar el espacio de direcciones del servidor,
proceda del siguiente modo:
1. Proteja el proyecto (√°rbol del proyecto: Ajustes de seguridad > Ajustes).
2. Exporte la interfaz de servidor correspondiente antes de la ampliaci√≥n o modificaci√≥n.
3. Revise este archivo XML OPC UA.
4. Vuelva a importar el archivo como interfaz del servidor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1375

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tipos de datos para especificaciones companion
Mapeo de los tipos de datos
La tabla siguiente muestra el tipo de datos SIMATIC compatible con cada tipo de datos OPC
UA.
Los tipos de datos deben asignarse tal como se indica m√°s adelante (tipo de datos SIMATIC
- tipo de datos OPC UA). No se permiten otras asignaciones. STEP 7 no comprueba si se ha
observado esta regla y no impide asignaciones err√≥neas. El usuario es responsable de
seleccionar y asignar los tipos de datos de acuerdo con la regla.
Los tipos de datos listados tambi√©n se pueden utilizar, p. ej. como elementos de estructuras/
UDT para par√°metros de entrada y salida de m√©todos de servidor creados por el usuario
(UAMethod_InParameters y UAMethod_OutParameters).

Tabla 1-103 Mapeo de los tipos de datos
Tipo de datos SIMATIC

Tipo de datos OPC UA

BOOL

Boolean

SINT

SByte

INT

Int16

DINT

Int32

LINT

Int64

USINT

Byte

UINT

UInt16

UDINT

UInt32

ULINT

UInt64

REAL

Float

LREAL

Double

LDT

DateTime

WSTRING

String

DINT

Enumeration (Encoding Int32) y todos los tipos de datos
derivados

Se requiere un tipo de datos definido por
el usuario (UDT, user-defined data type)

UNION y todos los tipos de datos derivados

El tipo de datos definido por el usuario
debe crearse con el prefijo "Union_", p. ej.
"Union_MyDatatype", v√©ase el ejemplo
bajo la tabla.
El primer elemento (Selector) de este
UDT debe tener el tipo de datos "UDINT".

1376

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Se requiere un tipo de datos definido por el usuario para UNION
La figura siguiente muestra la variable "MyVariable", que tiene el tipo de datos
"Union_MyDatatype".
Este tipo de datos SIMATIC se corresponde con una variable OPC UA con tipo de datos
UNION.
La figura muestra un ejemplo de la declaraci√≥n: Con Selector = 1, la Union toma un ByteArray;
con Selector = 2 un WString.

Utilizar otros tipos de datos b√°sicos OPC UA
Adem√°s de los tipos de datos OPC UA indicados en el apartado "Mapeo de tipos de datos" y
sus correspondencias en SIMATIC, tambi√©n se pueden utilizar los siguientes tipos de datos
b√°sicos OPC UA:
‚óè OpcUa_NodeId
‚óè OpcUa_QualifiedName
‚óè OpcUa_Guid
‚óè OpcUa_LocalizedText
‚óè OpcUa_ByteString
‚óè OpcUa_XmlElement
Requisitos para el uso de los tipos de datos b√°sicos arriba indicados como variables en el
programa de usuario: Los tipos de datos b√°sicos deben existir como tipos de datos
compuestos y estructurados del mismo modo que los correspondientes tipos de datos b√°sicos
OPC UA.
‚óè OpcUa_NodeId y OpcUa_QualifiedName existen como tipo de datos del sistema, por lo que
tambi√©n se pueden utilizare para variables individuales o como elementos de una
estructura.
‚óè Para los restantes tipos de datos b√°sicos hay que crear un tipo de datos PLC conforme a
la especificaci√≥n OPC UA y, a continuaci√≥n, utilizarlo como elemento dentro de una
estructura para que los tipos de datos de los elementos puedan resolverse. A continuaci√≥n
se explica c√≥mo tiene que ser el tipo de datos PLC para cada tipo de datos b√°sico. Un
ejemplo de estructura de datos en la que se utiliza p. ej. el UDT "LocalizedText" es
"EUInformation". EUInformation contiene informaci√≥n sobre EngineeringUnits. Al final de
las descripciones de los tipos de datos PLC encontrar√° un ejemplo de aplicaci√≥n de la
estructura de datos EUInformation.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1377

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tipo de datos del sistema "OPC_UA_NodeId"
Consulte el significado de los par√°metros del tipo de datos b√°sico OPC UA "OpcUa_NodeId"
en la tabla siguiente. OPC_UA_NodeId se utiliza para identificar un nodo en el servidor OPC
UA.

Par√°metro

Tipo de datos S7

Significado

NamespaceIndex

UINT

√çndice del espacio de nombres del nodo en el servidor
OPC UA.
Un nodo puede ser, por ejemplo, una variable.

Identifier

WSTRING[254]

La denominaci√≥n del nodo (objeto o variable) depen‚Äê
de del tipo de identificador:
‚óè Identificador num√©rico: El nodo se designa con un
n√∫mero, por ejemplo "12345678".
‚óè Identificador de string: El nodo se designa con un
nombre, por ejemplo "MiVariable". Se distingue
entre may√∫sculas y min√∫sculas.

IdentifierType

UDINT

Tipo de identificador
‚óè 0: Identificador num√©rico
‚óè 1: identificador de string
‚óè 2: GUID
‚óè 3: Opaque

Tipo de datos del sistema "OPC_UA_QualifiedName"
Consulte en la tabla siguiente la estructura del tipo de datos del sistema
"OPC_UA_QualifiedName":
Nombre

Tipo de datos S7

Significado

NamespaceIndex

UINT

El √≠ndice del espacio de nombres del nombre.

Name

WSTRING[64]

Nombre del nodo o de la variable.

UDT "Guid"
Cree el siguiente tipo de datos PLC para el tipo de datos b√°sico "Guid". Los valores
predeterminados utilizados a modo de ejemplo tambi√©n se pueden ajustar de otro modo.

UDT "LocalizedText"
Cree el siguiente tipo de datos PLC para el tipo de datos b√°sico "LocalizedText":

1378

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

El EncodingByte indica los campos (Locale o Text) que hay:
EncodingByte

Significado

0

Los campos Locale y Text est√°n vac√≠os

1

El campo Locale tiene contenido, el campo Text est√° vac√≠o

2

El campo Locale est√° vac√≠o, el campo Text tiene contenido

3

Los campos Locale y Text tienen contenido

UDT "ByteString"
Cree el siguiente tipo de datos PLC para el tipo de datos b√°sico "ByteString"; en este caso se
ha seleccionado p. ej. una matriz ByteString de 12 elementos:

UDT "XmlElement"
Un XmlElement es un fragmento XML serializado (cadena UTF-8).
Cree el siguiente tipo de datos PLC para el tipo de datos b√°sico "XmlElement":

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1379

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Ejemplo: Estructura de EUInformation con el UDT "LocalizedText"

Crear una interfaz de servidor para la especificaci√≥n companion
Encontrar√° informaci√≥n b√°sica sobre las especificaciones companion en el cap√≠tulo
"Utilizaci√≥n de especificaciones OPC UA Companion (P√°gina 1369)". All√≠ se trata m√°s
detalladamente la utilidad de la especificaci√≥n companion Euromap 77 que proporciona un
modelo para m√°quinas de moldeo por inyecci√≥n.
Este est√°ndar companion permite a la CPU S7-1500 controlar, p. ej., una m√°quina de moldeo
por inyecci√≥n y asignar a un cliente OPC UA, p. ej., un sistema MES de nivel superior, una
interfaz para acceder a funciones y variables de la m√°quina de moldeo por inyecci√≥n.
Una interfaz de servidor OPC UA del tipo "Est√°ndar companion" limita el acceso de clientes
precisamente a las funciones y variables necesarias, p. ej., para sistemas de nivel superior
(sistemas MES).
A continuaci√≥n se describe c√≥mo crear en STEP 7 (TIA Portal) una interfaz de servidor que
contenga solo la especificaci√≥n companion Euromap 77.
Si se desea que los clientes OPC UA puedan acceder a otras variables o m√©todos adem√°s de
los necesarios para la gesti√≥n de una m√°quina de moldeo por inyecci√≥n, solo hay que crear
otra interfaz de servidor OPC UA. De esta forma se puede organizar claramente la
funcionalidad de la CPU como servidor OPC UA.

Crear una interfaz de servidor para una especificaci√≥n companion
Para crear con STEP 7 (TIA Portal) una interfaz de servidor para una especificaci√≥n
companion, proceda del siguiente modo:
1. Seleccione la CPU que desea utilizar como servidor OPC UA.
2. Haga clic en el √°rbol del proyecto en "Comunicaci√≥n OPC UA > Interfaces de servidor".
3. Haga doble clic en "Agregar nueva interfaz de servidor".
4. Haga clic en el bot√≥n "Especificaci√≥n companion" para seleccionar este tipo de interfaz de
servidor.
El cuadro de di√°logo contiene un nombre gen√©rico para la nueva interfaz de servidor, por
ejemplo "Interfaz de servidor_1".

1380

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Cambie el nombre de la nueva interfaz de servidor para que sea descriptivo en el proyecto.
El nombre debe tener la estructura siguiente de acuerdo con Euromap 77:
"IMM_<fabricante>_<n√∫mero de serie>".
En el ejemplo se utiliza el nombre "IMM_Manufacturer_01234".

6. En el campo "Importar archivo XML", seleccione un archivo XML en el que se describa un
modelo de informaci√≥n.
En el cap√≠tulo "Utilizaci√≥n de especificaciones OPC UA Companion (P√°gina 1369)" se
describe c√≥mo crear el archivo XML con la herramienta SiOME.
La siguiente figura muestra un fragmento del modelo de informaci√≥n:
"IMM_MANUFACTURER_0123456", una instancia (utilizaci√≥n) del tipo
"IMM_MES_InterfaceType" definido por Euromap 77 . "InjectionUnit_1" es una instancia del
tipo "InjectionUnitType" de Euromap 77.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1381

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. Haga clic en el bot√≥n "Aceptar".
STEP 7 (TIA Portal) importa el modelo de informaci√≥n que se describe en el archivo XML
seleccionado.
Se produce un error cuando en el archivo XML importado se utilizan definiciones de tipos
que todav√≠a no existen en STEP 7 (TIA Portal) y que tampoco est√°n incluidas en el archivo
XML importado.
En el ejemplo se importa un archivo XML que utiliza definiciones de tipos que est√°n
definidas en los siguientes espacios de nombres (Namespaces):
‚Äì http://opcfoundation.org/UA/DI/
‚Äì http://www.euromap.org/euromap83/
‚Äì http://www.euromap.org/euromap77/
Sugerencia: Los espacios de nombres que faltan se muestran en STEP 7 en el √°rea inferior
del editor de interfaces OPC UA (ficha "Propiedades").
Marque para ello la interfaz de servidor en el √°rbol del proyecto (aqu√≠:
IMM_Manufacturer_01234) y seleccione en la ventana de inspecci√≥n el √°rea "Espacios de
nombres". Los espacios de nombres que faltan est√°n marcados.
Si en el proyecto STEP 7 faltan uno o varios espacios de nombres, cree para cada espacio
de nombres una nueva interfaz de servidor del tipo "Espacio de nombres de referencia".
El cap√≠tulo "Crear una interfaz de servidor para el espacio de nombres de referencia
(P√°gina 1384)" muestra c√≥mo hacerlo.
Cuando est√°n presentes todos los espacios de nombres de referencia, STEP 7 muestra la
tabla sin errores:

8. Utilizando la funci√≥n Drag&Drop, arrastre elementos OPC UA del √°rea derecha de la tabla
al √°rea izquierda de la tabla (interfaz de servidor OPC UA), de modo que los distintos
elementos OPC UA (las variables PLC locales) est√©n asignados a los correspondientes
nodos OPC UA de Euromap 77.
La siguiente figura muestra un fragmento de la asignaci√≥n de datos locales (variables PLC)
a los nodos OPC UA de Euromap 77:

1382

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n sobre la interfaz de servidor
El editor para la configuraci√≥n de la interfaz de servidor OPC UA est√° estructurado en forma de
tabla y proporciona la informaci√≥n siguiente:
‚óè Nombre
En el ejemplo, el nodo superior (nodo ra√≠z) tiene el nombre "IMM_Manufacturer_01234".
Cuando un cliente busca en el espacio de direcciones del servidor, ese nodo es el
contenedor de todos los nodos subordinados. El BrowseName y el DisplayName de ese
nodo dependen del nombre que se haya asignado a la interfaz de servidor.
Aqu√≠ el nombre corresponde, p. ej., al conjunto de la m√°quina de moldeo por inyecci√≥n. Es
el nombre de la instancia utilizada de la especificaci√≥n companion Euromap 77. Seg√∫n la
especificaci√≥n companion, el nombre de instancia debe empezar por "IMM"; despu√©s sigue
el nombre del fabricante de la m√°quina de moldeo por inyecci√≥n y al final se agrega el
n√∫mero de serie de la m√°quina. Esto permite identificar un√≠vocamente una m√°quina.
Los nombres de los restantes nodos (subordinados) son definidos por la especificaci√≥n (en
el ejemplo anterior por Euromap 77). Estos nombres de nodos no pueden modificarse. De
este modo se obtiene una vista homog√©nea de todas las m√°quinas de inyecci√≥n que
cumplen la especificaci√≥n.
‚óè Tipo de nodo
Tipo de nodo OPC UA. El tipo est√° definido por la especificaci√≥n companion utilizada.
STEP 7 marca en la tabla un tipo de nodo en color en los siguientes casos:
‚Äì si en el archivo XML importado no hay ninguna definici√≥n o
‚Äì si el espacio de nombres en el que se ha definido el tipo no existe en STEP 7.
En este caso, cree una interfaz de servidor del tipo "Espacio de nombres de referencia"
para cada uno de los espacios de nombres que faltan.
Los espacios de nombres que faltan se encuentran en las propiedades de la interfaz de
servidor, en "Espacios de nombres".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1383

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Datos locales
STEP 7 muestra el bloque de datos que est√° asignado al nodo OPC UA: La CPU lee en ese
bloque de datos los valores de los nodos OPC UA.
Si un bloque de datos se muestra con fondo de color (p. ej., tras una prueba de coherencia)
significa que el bloque de datos indicado no existe en la CPU.
En tal caso, cree en la CPU (en el programa de usuario) el bloque de datos que falta y
as√≠gnele valores.
‚óè Tipo de datos
Es el tipo de datos SIMATIC de la variable PLC (p. ej., el elemento de un bloque de datos)
de la CPU del que se lee el valor de un nodo OPC UA (del tipo UAVariable) o al que se le
asigna un valor.

Comprobaci√≥n de coherencia
Existe la posibilidad de comprobar la coherencia de la interfaz de servidor.
Al hacerlo, STEP 7 (TIA Portal) comprueba si a los nodos OPC UA de la interfaz de servidor
se les han asignado variables PLC (bloques de datos) con tipos de datos SIMATIC
compatibles.
Para comprobar la coherencia de la interfaz de servidor, haga clic en el s√≠mbolo siguiente
situado en la barra de herramientas del editor de la interfaz de servidor OPC UA:

Exportaci√≥n de interfaz
Existe la posibilidad de exportar la interfaz del servidor OPC UA como archivo XML. Este
archivo XML contiene todas las definiciones de tipos de datos que referencia la interfaz de
servidor.
Para exportar la interfaz de servidor OPC UA, haga clic en el s√≠mbolo siguiente situado en la
barra de herramientas del editor de la interfaz de servidor OPC UA:

Crear una interfaz de servidor para el espacio de nombres de referencia
Especificaciones companion y espacios de nombres referenciados
En una especificaci√≥n companion se han definido una serie de tipos de objeto OPC UA
(adem√°s de otras definiciones). Estos tipos de objeto se han definido en cada caso en espacios
de nombres para que los nombres de los tipos de objeto (definiciones de tipo) sean un√≠vocos.
Para utilizar una especificaci√≥n companion en el proyecto, cree instancias de tipos de objeto
de dicha especificaci√≥n companion.
Para ello, las definiciones de objetos deben existir en su proyecto STEP 7. Si no es as√≠, tendr√°
que importar las definiciones de objetos. Para importar todas las definiciones de un espacio de

1384

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
nombres, cree en STEP 7 una interfaz de servidor del tipo "Espacio de nombres de referencia"
para cada espacio de nombres.

Ejemplo Euromap 77
Para la especificaci√≥n companion Euromap 77 se ha agregado una interfaz de servidor.
La interfaz de servidor utiliza tipos de objeto que est√°n definidos tanto en OPC UA DI como en
Euromap 83 y Euromap 77 en sus espacios de nombres correspondientes.
Por esta raz√≥n deben crearse en STEP 7, adem√°s de la interfaz de servidor Euromap 77 del
tipo "Especificaci√≥n companion", otras interfaces de servidor del tipo "Espacio de nombres de
referencia" para cada uno de los siguientes espacios de nombres:
‚óè http://opcfoundation.org/UA/DI/
‚óè http://www.euromap.org/euromap83/
‚óè http://www.euromap.org/euromap77/
La descripci√≥n siguiente muestra c√≥mo hacerlo.

Crear una interfaz de servidor para un espacio de nombres de referencia
Para crear una interfaz de servidor para un espacio de nombres, proceda del siguiente modo:
1. Seleccione la CPU que desea utilizar como servidor OPC UA.
2. Haga clic en "Comunicaci√≥n OPC UA > Interfaces de servidor".
3. Haga doble clic en "Agregar nueva interfaz de servidor".
STEP 7 (TIA Portal) muestra ahora el cuadro de di√°logo "Agregar nueva interfaz de
servidor".
El cuadro de di√°logo contiene un nombre gen√©rico para la nueva interfaz de servidor, por
ejemplo "Interfaz de servidor_1".
4. Asigne un nombre descriptivo a la nueva interfaz de servidor.
En el ejemplo, seleccione el nombre "Opc.Ua.Di" o un nombre similar que haga clara
referencia al espacio de nombres "http://opcfoundation.org/UA/DI/".
Este es el primer espacio de nombres que debe importarse. Contiene definiciones b√°sicas
(por ejemplo el UAObjectType "DeviceType").

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1385

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. En "Importar archivo XML", seleccione un archivo XML que contenga las definiciones del
espacio de nombres "http://opcfoundation.org/UA/DI/".
En el ejemplo, seleccione el archivo "Opc.Ua.Di.NodeSet2.xml". Este archivo puede
cargarse aqu√≠:
aqu√≠ (https://opcfoundation.org/UA/schemas/DI/)
La figura siguiente muestra el cuadro de di√°logo con las entradas:

6. Haga clic en el bot√≥n "Aceptar".
STEP 7 (TIA) genera la nueva interfaz de servidor.
La interfaz de servidor est√° ubicada en el √°rbol del proyecto de STEP 7 (TIA Portal), en
"Comunicaci√≥n OPC UA > Interfaces del servidor > Referencias al espacio de nombres".
Si una especificaci√≥n companion utiliza otros espacios de nombres, agregue una interfaz de
servidor nueva para cada espacio de nombres.
Agregar m√°s interfaces de servidor para Euromap 77
Para Euromap 77 se requieren los siguientes espacios de nombres adicionales:
‚óè http://www.euromap.org/euromap83/
‚óè http://www.euromap.org/euromap77/
Agregue primero una interfaz de servidor para el espacio de nombres "http://
www.euromap.org/euromap83/".
Este espacio de nombres contiene definiciones b√°sicas para Euromap 77, por lo que aqu√≠ se
necesita primero. Todas las definiciones de este espacio de nombres est√°n incluidas en el
archivo XML "Opc_Ua.EUROMAP83.NodeSet2.xml", que puede cargarse desde el sitio web
de Euromap (www.euromap.org/en/euromap83).
A continuaci√≥n, agregue una interfaz de servidor para el espacio de nombres "http://
www.euromap.org/euromap77". Todas las definiciones de este espacio de nombres est√°n
incluidas en el archivo XML "Opc_Ua.EUROMAP77.NodeSet2.xml", que puede cargarse
tambi√©n desde el sitio web de Euromap (www.euromap.org/en/euromap77).

1386

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Notas sobre capacidades al usar interfaces de servidores
Si se utilizan interfaces de servidores OPC UA, dependiendo de cu√°l sea la clase de capacidad
funcional de la CPU S7-1500 ser√° necesario tener en cuenta l√≠mites superiores para los
objetos siguientes:
‚óè N√∫mero de interfaces de servidor
‚óè N√∫mero de nodos OPC UA (nodes)
‚óè Cantidad de datos de los objetos de carga
‚óè Si se han implementado m√©todos: n√∫mero de m√©todos de servidor o n√∫mero de instancias
del m√©todo de servidor

Capacidades para interfaces de servidores OPC UA y m√©todos
En la tabla siguiente se indican las capacidades de las CPU S7-1500 que deben considerarse
al compilar y cargar una configuraci√≥n (encontrar√° los datos t√©cnicos de las CPU actualizados
diariamente en Internet (https://support.industry.siemens.com/cs/ww/es/ps/td)).
Si se sobrepasan las capacidades se confirma con un mensaje de error.
Tabla 1-104 Capacidades para interfaces de servidores OPC UA
Dato t√©cnico

CPU 1510SP (F)
CPU 1511 (C/F/T/TF)
CPU 1512C
CPU 1512SP (F)
CPU 1513 (F)

CPU 1505 (S/SP/SP F/
SP T/SP TF)

CPU 1507S (F)

CPU 1515 (F/T/TF)

CPU 1518 (F)

CPU 1515 SP PC (F/T/TF)

CPU 1517 (F/T/TF)

CPU 1516 (F/T/TF)

Uso de especificaciones Companion importadas (modelos de informaci√≥n)
N√∫mero m√°ximo de interfaces
de servidor OPC UA:

10

10

10

20

20

20

10

10

10

‚óè N√∫mero m√°ximo de nodos
OPC UA (nodes) en
interfaces de servidor
definidas por el usuario

1000

5000

30000

‚óè Tama√±o m√°ximo de
interfaces de servidores
OPC UA que pueden
cargarse

1024 KB

5120 KB

15 360 KB

‚óè tipo "Especificaci√≥n
companion"
‚óè tipo "Espacio de nombres
de referencia"
‚óè tipo "Interfaz de servidor"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1387

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Dato t√©cnico

CPU 1510SP (F)
CPU 1511 (C/F/T/TF)
CPU 1512C
CPU 1512SP (F)
CPU 1513 (F)

CPU 1505 (S/SP/SP F/
SP T/SP TF)

CPU 1507S (F)

CPU 1515 (F/T/TF)

CPU 1518 (F)

CPU 1515 SP PC (F/T/TF)

CPU 1517 (F/T/TF)

CPU 1516 (F/T/TF)

Puesta a disposici√≥n de m√©todos
N√∫mero m√°ximo de m√©todos
20
de servidor utilizables o n√∫me‚Äê
ro m√°ximo de instancias del
m√©todo de servidor (instruccio‚Äê
nes OPC_UA_ServerMethod‚Äê
Pre, OPC_UA_ServerMethod‚Äê
Post)

50

100

Proporcionar m√©todos en el servidor OPC UA
Informaci√≥n importante sobre m√©todos de servidor
Proporcionar el programa de usuario para m√©todos de servidor
En el servidor OPC UA de una CPU S7-1500 (a partir de la versi√≥n del firmware V2.5) existe
la posibilidad de proporcionar m√©todos mediante el programa de usuario. Estos m√©todos
pueden utilizarlos los clientes OPC UA, p. ej. para iniciar una orden de producci√≥n llamando el
m√©todo de la CPU S7-1500.
Los m√©todos OPC UA, una implementaci√≥n de "Remote Procedure Calls", ofrecen un
mecanismo eficaz para la interacci√≥n entre diferentes interlocutores. El mecanismo
proporciona tanto una confirmaci√≥n de la orden como valores de respuesta, lo que ahorra tener
que programar mecanismos de handshaking.
Con m√©todos OPC UA es posible, p. ej., una transferencia coherente sin bits de disparo o
handshake, o activar determinadas acciones en el controlador.
¬øC√≥mo funciona un m√©todo OPC UA?
Un m√©todo OPC UA funciona en principio como un bloque de funci√≥n con protecci√≥n de knowhow que es llamado por un cliente OPC UA externo en tiempo de ejecuci√≥n.
El cliente OPC UA solamente "ve" las entradas y salidas definidas. El interior del bloque de
funci√≥n, el m√©todo o el algoritmo permanecen ocultos para el cliente OPC UA externo. El
cliente OPC UA recibe una se√±al de respuesta de la correcta ejecuci√≥n y valores de respuesta
proporcionados por el bloque de funci√≥n (m√©todo). O bien un mensaje de error en caso de que
la ejecuci√≥n no sea correcta.
El programador tiene el pleno control y la total responsabilidad sobre el contexto del programa
en el que se ejecute el m√©todo OPC UA.

1388

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Reglas para la programaci√≥n de un m√©todo y comportamiento en tiempo de ejecuci√≥n
‚óè Aseg√∫rese de que los valores de respuesta devueltos con el m√©todo OPC UA son
coherentes con los valores de entrada proporcionados por el cliente OPC UA.
‚óè Tenga en cuenta las reglas de asignaci√≥n de nombres y de estructuraci√≥n de par√°metros,
as√≠ como los tipos de datos que pueden utilizarse (consulte la descripci√≥n de las
instrucciones del servidor OPC UA).
‚óè Comportamiento en tiempo de ejecuci√≥n: el servidor OPC UA acepta una llamada por
instancia. La instancia del m√©todo no podr√° ser llamada por otros clientes OPC UA hasta
que la llamada haya sido procesada por el programa de usuario o se haya producido un
timeout.
A continuaci√≥n va a mostrarse el procedimiento b√°sico para implementar un programa de
usuario como m√©todo de servidor.
Implementaci√≥n de un m√©todo de servidor
Un programa (bloque de funci√≥n) para implementar un m√©todo de servidor tiene la estructura
siguiente:
1. Consultar la llamada del m√©todo de servidor con OPC_UA-ServerMethodPre
En su programa de usuario (es decir, en su m√©todo de servidor) llame primero a la
instrucci√≥n "OPC_UA_ServerMethodPre".
Esta instrucci√≥n cumple las siguientes tareas:
‚Äì Con esta instrucci√≥n puede consultar en el servidor OPC UA de la CPU si su m√©todo de
servidor ha sido llamado por un cliente OPC UA.
‚Äì Si el m√©todo ha sido llamado y el m√©todo de servidor dispone de par√°metros de entrada,
su m√©todo de servidor obtendr√° ahora los par√°metros de entrada.
Los par√°metros de entrada del m√©todo de servidor proceden del cliente OPC UA
llamante.
2. Editar el m√©todo de servidor
En esta secci√≥n del m√©todo de servidor se pone a disposici√≥n el programa de usuario
propiamente dicho.
Aqu√≠ tiene las mismas posibilidades que en otros programas de usuario (por ejemplo, el
acceso a otros bloques de funci√≥n o a bloques de datos globales).
Si el m√©todo de servidor utiliza par√°metros de entrada, dispondr√° de los par√°metros de
entrada del m√©todo de servidor.
Esta secci√≥n del m√©todo de servidor solo debe ejecutarse si un cliente OPC UA ha llamado
al m√©todo de servidor.
Una vez ejecutado el m√©todo correctamente, active los par√°metros de salida del m√©todo de
servidor, siempre que el m√©todo de servidor tenga par√°metros de salida.
3. Responder al m√©todo de servidor con OPC_UA_ServerMethodPost
Para concluir el m√©todo de servidor, llame a la instrucci√≥n "OPC_UA_ServerMethodPost".
A trav√©s de los par√°metros informe a la instrucci√≥n "OPC_UA_ServerMethodPost" sobre si
se ha ejecutado o no el programa de usuario.
A trav√©s de los par√°metros correspondientes se informa al servidor OPC UA sobre si el
programa de usuario se ha ejecutado correctamente. El servidor OPC UA enviar√° al cliente
OPC UA los par√°metros de salida del m√©todo de servidor.
Llame a las instrucciones "OPC_UA_ServerMethodPre" y "OPC_UA_ServerMethodPost"
siempre por parejas, con independencia de que el programa de usuario se ejecute entre
ambas instrucciones o se contin√∫e en el ciclo siguiente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1389

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Encontrar√° un ejemplo de implementaci√≥n de un m√©todo de servidor en la Ayuda en pantalla
de STEP 7.

Integraci√≥n del m√©todo de servidor
El gr√°fico siguiente muestra c√≥mo un cliente OPC UA (A) llama al m√©todo de servidor "Cool":
La CPU ejecuta en el programa de usuario c√≠clico la instancia "Cool1" del m√©todo de servidor
"Cool" ‚ë•.
Primero, la CPU pregunta con la instrucci√≥n "OPC_UA_ServerMethodPre" ‚ë£ si un cliente
OPC UA ha llamado al m√©todo de servidor "Cool" ‚ë†.
‚óè Si no se ha llamado al m√©todo de servidor, la ejecuci√≥n del programa retorna directamente
al programa de usuario c√≠clico a trav√©s de ‚ë£ y ‚ë•. Tras "Cool1", la CPU contin√∫a el
programa de usuario c√≠clico.
‚óè Si se ha llamado al m√©todo de servidor, esta informaci√≥n retorna al m√©todo de servidor Cool
a trav√©s de ‚ë£. En el m√©todo de servidor "Cool" se ejecutan las funciones propiamente
dichas, consulte "<Funcionalidad de m√©todos>" en el gr√°fico.
A continuaci√≥n, el m√©todo de servidor comunica mediante la instrucci√≥n
"OPC_UA_ServerMethodPost" ‚ë§ del firmware (B) que la instrucci√≥n se ha ejecutado ‚ë¢.
El firmware devuelve dicha informaci√≥n a trav√©s de ‚ë° al cliente OPC UA llamante (A).
Tras "Cool1", la CPU contin√∫a el programa de usuario c√≠clico.

1390

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
6FRPRVHUYLGRU23&8$
23&8$
&OLHQW

)LUPZDUH
23&8$
6HUYHU







%

$

0¬´WRGR
)%&RRO

23&B8$B6HUYHU
0HWKRG3UH
&



23&B8$B6HUYHU
0HWKRG3RVW

&DOO
23&3UHB
,QVWDQFH
)XQFLRQDOLGDG
GHP¬´WRGRV!





&¬ØFOLFR
3URJUDPD
GHXVXDULR


&DOO
23&3RVWB
,QVWDQFH

'

A

&DOO
&RRO  

&DOO
&RRO  

Llamada del m√©todo de servidor y gesti√≥n de la informaci√≥n "Done" (m√©todo concluido)

‚ë†
‚ë°

Llamada as√≠ncrona al m√©todo de servidor

B

Espera a llamadas de cliente OPC UA, gesti√≥n de llamadas en cola de espera, retransmisi√≥n al cliente OPC UA de
informaci√≥n procedente del programa de usuario c√≠clico.

‚ë¢
C

‚ë£

Informaci√≥n "Done" as√≠ncrona del m√©todo llamado (m√©todo concluido)

Transferencia de datos del servidor OPC UA a la instancia del m√©todo del programa de usuario, y viceversa.
Comprobaci√≥n de si se ha llamado al m√©todo.
En caso afirmativo, hacer llegar los datos de entrada del servidor OPC UA a la instancia del m√©todo del programa
de usuario y responder a la instancia del m√©todo que se ha llamado al m√©todo ("called")
Llamada s√≠ncrona de la instrucci√≥n OPC_UA_ServerMethodPre como multinstancia, indicando el √°rea de memoria
para los datos de entrada del servidor OPC UA.
El Return-Value informa sobre si el m√©todo ha sido llamado por el cliente OPC UA.

‚ë§

Comprobaci√≥n sobre si el m√©todo ha concluido o contin√∫a activo ("busy").

D

Comprobaci√≥n sobre si se ha concluido el m√©todo.

‚ë•

En caso afirmativo, los datos de salida de la instancia del m√©todo se hacen llegar al servidor OPC UA y se responde
a la instancia que el m√©todo ha concluido. Se mantiene informado al servidor OPC UA.
Llamada del FB de m√©todo (aqu√≠: FB Cool) con la instancia y los par√°metros de proceso deseados.

Informaci√≥n sobre las instrucciones de servidor
Las instrucciones "OPC_UA_ServerMethodPre" y "OPC_UA_ServerMethodPost" se
describen detalladamente en la ayuda de las instrucciones > Comunicaci√≥n > OPC UA >
Servidor OPC UA.

Consulte tambi√©n
Condiciones de utilizaci√≥n de m√©todos de servidor (P√°gina 1392)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1391

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Condiciones de utilizaci√≥n de m√©todos de servidor
Tipos de datos permitidos
Si se proporcionan m√©todos de servidor, debe observarse la regla siguiente:
‚óè Los tipos de datos deben asignarse tal como se indica m√°s adelante (tipo de datos
SIMATIC - tipo de datos OPC UA). No se permiten otras asignaciones.
STEP 7 no comprueba si se ha observado esta regla y no impide asignaciones err√≥neas. El
usuario es responsable de seleccionar y asignar los tipos de datos de acuerdo con la regla.
Los tipos de datos listados tambi√©n se pueden utilizar, p. ej. como elementos de estructuras/
arrays/UDT para par√°metros de entrada y salida de m√©todos de servidor creados por el
usuario (UAMethod_InParameters y UAMethod_OutParameters).
Tipo de datos SIMATIC

Tipo de datos OPC UA

BOOL

Boolean

SINT

SByte

INT

Int16

DINT

Int32

LINT

Int64

USINT

Byte

UINT

UInt16

UDINT

UInt32

ULINT

UInt64

REAL

Float

LREAL

Double

LDT

DateTime

WSTRING

String

DINT

Enumeration (Encoding Int32) y todos los tipos de datos
derivados

Se requiere un tipo de datos definido por
el usuario (UDT, user-defined data type)

UNION y todos los tipos de datos derivados

El tipo de datos definido por el usuario
debe crearse con el prefijo "Union_", p. ej.
"Union_MyDatatype".
El primer elemento (Selector) de este
UDT debe tener el tipo de datos "UDINT".

1392

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

N√∫mero de m√©todos de servidor implementables y n√∫mero de argumentos
Si se implementan m√©todos de servidor a trav√©s del programa de usuario, el n√∫mero de
m√©todos utilizables estar√° limitado en funci√≥n del tipo de CPU; consulte la tabla siguiente
(encontrar√° los datos t√©cnicos de las CPU actualizados diariamente en Internet (https://
support.industry.siemens.com/cs/ww/es/ps/td)).
Dato t√©cnico

CPU 1510SP (F)
CPU 1511 (C/F/T/TF)
CPU 1512C
CPU 1512SP (F)
CPU 1513 (F)

CPU 1505 (S/SP/SP F/
SP T/SP TF)

CPU 1507S (F)

CPU 1515 (F/T/TF)

CPU 1518 (F)

CPU 1515 SP PC (F/T/TF)

CPU 1517 (F/T/TF)

CPU 1516 (F/T/TF)

N√∫mero m√°ximo de m√©todos
20
de servidor utilizables o n√∫me‚Äê
ro m√°ximo de instancias del
m√©todo de servidor (instruccio‚Äê
nes OPC_UA_ServerMethod‚Äê
Pre, OPC_UA_ServerMethod‚Äê
Post)

50

100

20

20

20

N√∫mero m√°ximo de argumen‚Äê
tos por m√©todo
(Puede configurarse y cargarse
en la CPU un n√∫mero de argu‚Äê
mentos mayor del indicado, pe‚Äê
ro en tal caso un cliente OPC
UA no podr√≠a llamar el m√©todo).

Mensaje de error en caso de rebase
Cuando se ha superado el n√∫mero m√°ximo de m√©todos de servidor, las instrucciones
OPC_UA_ServerMethodPre o OPC_UA_ServerMethodPost emiten el c√≥digo de error
0xB080_B000 (TooManyMethods).

Suministro de tipos de datos estructurados con matrices anidadas
Si un tipo de datos estructurado (Struct/UDT) contiene una matriz, el servidor OPC UA no
proporciona informaci√≥n sobre la longitud de dicha matriz.
Si se utiliza una estructura de este tipo, p. ej. como par√°metro de entrada o salida de un m√©todo
de servidor, hay que asegurarse de que la matriz anidada reciba la longitud correcta al llamar
el m√©todo.
Si no se respeta esta regla, el m√©todo fallar√° con el c√≥digo de error "BadInvalidArgument".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1393

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Uso de posibilidades de diagn√≥stico
Diagn√≥stico del servidor OPC UA
Diagn√≥stico online del servidor OPC UA
El servidor OPC UA de la CPU S7-1500 puede diagnosticarse online con clientes OPC UA
convencionales, como p. ej. UaExpert.
La informaci√≥n de diagn√≥stico se divide en las siguientes √°reas:
‚óè Diagn√≥stico de servidor
‚óè Diagn√≥stico de sesiones
‚óè Diagn√≥stico de suscripciones
En el √°rea de direcciones del servidor se encuentran, p. ej., los siguientes nodos con
informaci√≥n de diagn√≥stico:
‚óè ServerDiagnosticsSummary: resumen del diagn√≥stico de servidor
‚Äì CurrentSessionCount: n√∫mero de sesiones activas
‚Äì SecurityRejectedSessionCount: n√∫mero de sesiones rechazadas debido a que los
ajustes de seguridad de punto final entre cliente y servidor no concuerdan
‚óè SessionsDiagnosticsSummary: resumen del diagn√≥stico de sesiones
‚Äì ActualSessionTimeout: exceso de tiempo ajustado para la duraci√≥n de una sesi√≥n p. ej.
en caso de interrupci√≥n de la conexi√≥n
‚óè SubscriptionsDiagnosticsArray: array con un elemento por cada suscripci√≥n para la sesi√≥n
en cuesti√≥n

1394

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

El nodo SessionsDiagnosticsSummary muestra tambi√©n las propiedades de la aplicaci√≥n
cliente que accede al servidor dentro de la sesi√≥n.

Diagn√≥stico de la conexi√≥n entre cliente y servidor
Para diagnosticar el estado de la conexi√≥n durante el tiempo de ejecuci√≥n del programa en el
cliente utilice la siguiente instrucci√≥n:
OPC_UA_ConnectionGetStatus: Leer estado de la conexi√≥n.

Diagnosticar transiciones de estado del servidor
Informaci√≥n sobre el estado del servidor
A partir de la versi√≥n de firmware V2.8, las CPU S7-1500 pueden generar una entrada en el
b√∫fer de diagn√≥stico cada vez que cambie el estado del servidor OPC UA.
El b√∫fer de diagn√≥stico indica el nuevo estado.
Tambi√©n se indica la causa del cambio de estado, p. ej. carga en la CPU, transici√≥n de
desconexi√≥n - conexi√≥n, instrucci√≥n del programa de usuario o solicitud de servicio de un
interlocutor (cliente).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1395

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos
En las propiedades OPC UA de la CPU est√° activada la opci√≥n "Cambio de estado del servidor
OPC UA" (OPC UA > Servidor > Diagn√≥stico).
Nota
Cuando esta opci√≥n est√° activada, tras el arranque la CPU tambi√©n registra autom√°ticamente
en el b√∫fer de diagn√≥stico la menor directiva de seguridad ajustada.

Ejemplos
Si una operaci√≥n de carga hace que se apague el servidor OPC UA de la CPU y que se reinicie
a continuaci√≥n con una nueva configuraci√≥n v√°lida, el b√∫fer de diagn√≥stico indica el nuevo
estado del servidor en cada caso, p. ej. Shutdown => Starting => Running.
Si una operaci√≥n de carga hace que se apague el servidor OPC UA y este no puede reiniciar
debido a que el TypeDictionary es demasiado extenso, el b√∫fer de diagn√≥stico indica al final el
estado "Failed" (Shutdown => Starting => Failed).

Estados del servidor y transiciones de estado
3RZHURQ




6KXWGRZQ


‚ë†, ‚ë£
‚ë°

‚ë¢

1396

6WDUWLQJ

)DLOHG

5XQQLQJ



Conexi√≥n o carga en RUN cuando pueden verse afectados datos relevantes para OPC UA.
Carga de la configuraci√≥n hardware con el servidor OPC UA desactivado. El servidor per‚Äê
manece apagado.
Carga de la configuraci√≥n hardware con el servidor OPC UA activado y datos OPC UA
err√≥neos (p. ej. demasiadas estructuras, lo que provoca que el Typedictionary sea dema‚Äê
siado grande). En este caso, el servidor no puede arrancar (consulte ‚ë¢).
El servidor OPC UA no puede arrancar debido a datos err√≥neos, por ejemplo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Descripci√≥n de los estados del servidor
A continuaci√≥n se explican los diferentes estados que puede adoptar el servidor OPC UA.
Estados del servidor

Explicaci√≥n

Shutdown

Estado inicial
‚óè tras conexi√≥n
‚óè tras cargar la configuraci√≥n hardware con el servidor OPC UA activado o
desactivado
‚óè tras cargar datos relevantes para OPC UA

Starting

El espacio de direcciones OPC UA en el servidor se inicializa.

Running

Servidor OPC UA en funcionamiento (estado productivo normal para servi‚Äê
dores OPC UA).

Failed

Estado de error. El servidor OPC UA no puede arrancar debido a datos err√≥‚Äê
neos, por ejemplo.

Diagnosticar las transiciones de estado de la sesi√≥n
Informaci√≥n sobre el estado de la sesi√≥n
A partir de la versi√≥n de firmware V2.8, las CPU S7-1500 pueden generar una entrada en el
b√∫fer de diagn√≥stico cada vez que cambie el estado de una sesi√≥n OPC UA.
El b√∫fer de diagn√≥stico indica el nuevo estado. Tambi√©n se muestra la ID de sesi√≥n
correspondiente.

Requisitos
En las propiedades OPC UA de la CPU est√° activada la opci√≥n "Cambio de estado de sesi√≥n"
(OPC UA > Servidor > Diagn√≥stico).

Ejemplo
Al establecer la conexi√≥n, un cliente transfiere datos de autenticaci√≥n err√≥neos (p. ej. una
contrase√±a incorrecta). En el b√∫fer de diagn√≥stico se registra el nuevo estado de la sesi√≥n
"ActivationFailed" con la ID de sesi√≥n correspondiente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1397

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estados de sesi√≥n y transiciones de estado
&UHDWHG



$FWLYDWHG






$FWLYDWLRQ)DLOHG

‚ë†
‚ë°
‚ë¢
‚ë£

&ORVHG

7LPHG2XW

El cliente se conecta al servidor, inicio de sesi√≥n con datos de autenticaci√≥n correctos (creden‚Äê
ciales correctas).
El cliente cierra la conexi√≥n correctamente.
El cliente deja de enviar mensajes, la sesi√≥n finaliza con timeout.
El cliente se conecta al servidor, inicio de sesi√≥n con datos de autenticaci√≥n incorrectos.

Comprobar eventos de seguridad
Cuando la CPU diagnostica un evento de seguridad en el marco de la comunicaci√≥n OPC UA,
puede registrarlo en el b√∫fer de diagn√≥stico.

Requisitos
‚óè CPU S7-1500 con versi√≥n de firmware 2.8 o superior
‚óè La opci√≥n "Comprobar si hay eventos de seguridad inform√°tica" est√° activada (propiedades
de la CPU > OPC UA > Servidor > Diagn√≥stico)

Eventos de seguridad diagnosticados
Las CPU S7-1500 diagnostican los siguientes eventos de seguridad relevantes para OPC UA:
‚óè El certificado de cliente no es v√°lido (p. ej. sintaxis o sem√°ntica incorrectas, firma incorrecta,
la fecha actual no est√° dentro del per√≠odo de validez)
‚óè El inicio de sesi√≥n con nombre de usuario y contrase√±a ha fallado (est√° desactivado o los
datos son err√≥neos)
‚óè El cliente pretende utilizar una pol√≠tica de seguridad concreta o un modo de seguridad de
mensajes concreto; sin embargo, el servidor no soporta la pol√≠tica de seguridad o el modo
de seguridad exigidos
‚óè El cliente establece la conexi√≥n sin observar la especificaci√≥n (OPC UA Spec) (p. ej.
SecureChannelID/SessionID/Client Nonce inesperados)

Ejemplo
Si se intenta comprometer la comunicaci√≥n (p. ej., mediante Session-Hijacking, ataques Manin-the-Middle, etc.), el servidor lo detecta realizando una comprobaci√≥n.

1398

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Error en la solicitud de un cliente remoto
A partir de la versi√≥n de firmware V2.8, las CPU S7-1500 pueden generar una entrada en el
b√∫fer de diagn√≥stico con los eventos siguientes:
‚óè Solicitudes de cliente err√≥neas (uso incorrecto)
‚óè Se han producido errores de servicio
‚óè Se han rebasado por exceso los l√≠mites espec√≠ficos de la CPU para el servidor OPC UA

Ejemplo de solicitud de cliente err√≥nea
Se produce una solicitud err√≥nea, p. ej. cuando un cliente direcciona un nodo (variable) que no
existe o cuando se solicita un recurso que no existe.
En este caso, el servicio que ha provocado el error se registra en el b√∫fer de diagn√≥stico junto
con la ID de sesi√≥n correspondiente.

Error de servicio
Si es el propio servicio lo que falla, el servidor devuelve un error de servicio (ServiceFault). En
este caso se registra en el b√∫fer de diagn√≥stico el c√≥digo de estado (Bad...) y la ID de sesi√≥n
correspondiente.

Ejemplo de l√≠mites rebasados por exceso
Si una solicitud de servicio rebasa por exceso el l√≠mite espec√≠fico de la CPU, p. ej., n√∫mero de
sesiones, n√∫mero de elementos vigilados (Monitored Items), n√∫mero de suscripciones, etc.,
este diagn√≥stico se registra en el b√∫fer de diagn√≥stico. Junto con el aviso se indica el l√≠mite que
se ha rebasado por exceso.
Excepci√≥n: si se agrupan diagn√≥sticos y el aviso aparece con frecuencia, no se registra el
l√≠mite que ha causado el error. Solo se obtiene una indicaci√≥n general de que la capacidad
soportada se ha rebasado por exceso.

Entradas posibles para el servicio que ha causado el error
Seg√∫n sea la aplicaci√≥n de cliente utilizada, las solicitudes al servidor pueden dispararse de
forma distinta desde el punto de vista del usuario, por ejemplo, mediante una herramienta
online con interfaz de usuario gr√°fica o mediante instrucciones en el programa de un cliente.
OPC UA, con su arquitectura orientada al servicio, sigue un paradigma de solicitud-respuesta,
por lo que la aplicaci√≥n de cliente en cuesti√≥n convierte las solicitudes en las solicitudes de
servicio definidas en OPC UA.
Los nombres de estos servicios est√°n establecidos y agrupados de acuerdo con su uso;
consulte tambi√©n opcfoundation.org.
En caso de uso incorrecto, estos nombres de los servicios son precisamente los que se
reproducen en el b√∫fer de diagn√≥stico, junto con la ID de sesi√≥n correspondiente, como
servicio que ha causado el error.
A continuaci√≥n se enumeran los servicios posibles en OPC UA.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1399

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Discovery Service Set
FindServers
GetEndpoints
Session Service Set
CreateSession
ActivateSession
CloseSession
Cancel
View Service Set
Browse
BrowseNext
TranslateBrowsePathsToNodeIds
RegisterNodes
UnregisterNodes
Attribute Service Set
Write
Read
Method Service Set
Call
Monitored Item Service Set
CreateMonitoredItems
ModifyMonitoredItems
DeleteMonitoredItems
SetMonitoringMode
SetTriggering
Subscription Service Set
CreateSubscription
ModifySubscription
DeleteSubscriptions
Publish
Republish
SetPublishingMode

1400

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Diagnosticar suscripciones
Informaci√≥n sobre una suscripci√≥n
A partir de la versi√≥n de firmware V2.8, las CPU S7-1500 pueden generar una entrada en el
b√∫fer de diagn√≥stico cada vez que cambie el estado de una suscripci√≥n.
El b√∫fer de diagn√≥stico indica el nuevo estado; excepci√≥n: "KeepAlive".

Requisitos
En las propiedades OPC UA de la CPU est√° activada la opci√≥n "Subscriptions: cambio de
estado" (OPC UA > Servidor > Diagn√≥stico).

Ejemplo
Un cliente OPC UA est√° conectado a una CPU S7-1500 como servidor OPC UA y genera una
suscripci√≥n en el servidor.
Las opciones de diagn√≥stico para suscripciones est√°n activadas en las propiedades OPC UA
de la CPU.
En el b√∫fer de diagn√≥stico se registran sucesivamente los estados "Creating" y "Normal" con
la ID de suscripci√≥n correspondiente.

Estados de suscripci√≥n y transiciones de estado



&UHDWLQJ


1RUPDO


‚ë†
‚ë°
‚ë¢
‚ë£
‚ë§
‚ë•
‚ë¶


.HHS$OLYH

&ORVHG



/DWH

7LPHG2XW



La suscripci√≥n se genera y est√° activa a continuaci√≥n.
El cambio de estado no se registra en el b√∫fer de diagn√≥stico ya que, en funci√≥n del volumen de
datos, podr√≠an producirse demasiadas entradas en el b√∫fer de diagn√≥stico.
Consulte la explicaci√≥n en la tabla correspondiente a "Late"; p. ej. no hay solicitudes de env√≠o por
parte del cliente.
Se ha alcanzado el valor m√°ximo de KeepAlive.
Consulte la explicaci√≥n en la tabla correspondiente a "TimedOut".
Se ha alcanzado la vida √∫til m√°xima de la suscripci√≥n.
El cliente ha borrado la suscripci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1401

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Descripci√≥n de los estados de la suscripci√≥n
Una suscripci√≥n puede adoptar los estados siguientes en el servidor OPC UA:
Estado

Significado

Creating

El cliente ha solicitado una suscripci√≥n en el servidor y el servidor est√° creando la
suscripci√≥n.

Normal

La suscripci√≥n est√° creada en el servidor y est√° activa.

Closed

El cliente ha borrado la suscripci√≥n.

KeepAlive

Estado para cuando los elementos vigilados (monitored items) no cambian por un
tiempo prolongado. Estas transiciones de estado no se registran en el b√∫fer de
diagn√≥stico.

Late

El cliente ha generado una suscripci√≥n con intervalos de muestreo y env√≠o m√≠ni‚Äê
mos. La cantidad de elementos vigilados no se transmite al cliente durante este
tiempo.
El cliente deja de transmitir solicitudes de env√≠o (p. ej. debido a un fallo).

TimedOut

El cliente ha solicitado una suscripci√≥n.
El servidor solo puede manejar la suscripci√≥n (enviar Publish Response) si existen
suficientes solicitudes de env√≠o (Publish Requests) del cliente.
Si el cliente ya no env√≠a solicitudes de env√≠o, transcurrido un tiempo determinado
la suscripci√≥n pasa al estado "TimedOut".

Subscriptions: error en los tiempos de muestreo
A partir del firmware V2.5 de la CPU SIMATIC S7-1500, el servidor OPC UA puede transmitir
el c√≥digo de estado "GoodOverload" cuando se utilizan suscripciones en el caso de que
durante el muestreo de los elementos se produzca una sobrecarga de la CPU.
A partir del firmware V2.8 de la CPU SIMATIC S7-1500, el servidor OPC UA tambi√©n puede
registrar este evento en el b√∫fer de diagn√≥stico.

Requisitos
En las propiedades OPC UA de la CPU est√° activada la opci√≥n "Subscriptions: error en los
tiempos de muestreo" (OPC UA > Servidor > Diagn√≥stico).

1402

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Suscripci√≥n sin errores
En una suscripci√≥n OPC UA para diferentes elementos (p. ej. variables), el servidor OPC UA
de SIMATIC S7-1500 debe comprobar en intervalos especificados (intervalo de muestreo) si
el valor de los elementos ha cambiado. Esta comprobaci√≥n, denominada "sampling" o
muestreo, requiere cierto tiempo, que depende del n√∫mero y tipo de datos de los elementos.
Una vez finalizado el muestreo y cuando hay una petici√≥n de env√≠o (Publishing-Request), el
servidor env√≠a los elementos al cliente.

WVDPSOLQJ
6DPSOLQJ

WVDPSOLQJ
6DPSOLQJ

WVDPSOLQJ
6DPSOLQJ

7LPH

Suscripci√≥n con error
Cuando hay demasiados elementos en la cola de espera (queue), puede producirse una
sobrecarga de la pila de comunicaci√≥n, lo que se denomina "overload". Cuando esto sucede,
la CPU no puede comprobar todos los elementos en el intervalo de muestreo especificado, por
lo que debe omitir la pr√≥xima petici√≥n de muestreo.
En ese caso, la CPU env√≠a el c√≥digo de estado "GoodOverload" (0x002F0000) para cada
elemento, aunque los elementos no se han comprobado. El significado del c√≥digo de estado
conforme a IEC 61131-3 es: "Sampling has slowed down due to resource limitations".

WVDPSOLQJ

WVDPSOLQJ

WVDPSOLQJ
6DPSOLQJ

6DPSOLQJ


7LPH

‚ë†

La petici√≥n de muestreo se omite

Consulte tambi√©n FAQ 109763090.

Consulte tambi√©n
Ajustes del servidor para suscripciones (P√°gina 1346)
Significado del estado "GoodOverload" (https://support.industry.siemens.com/cs/ww/es/view/
109763090)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1403

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Agrupar diagn√≥sticos
Para evitar que el b√∫fer de diagn√≥stico reciba una avalancha de diagn√≥sticos OPC UA
id√©nticos, a partir de STEP 7 V16 se puede parametrizar que dichos diagn√≥sticos se
introduzcan en el b√∫fer de diagn√≥stico como un aviso de grupo. En este caso, para cada
intervalo (per√≠odo de vigilancia) la CPU genera un solo aviso de grupo por diagn√≥stico OPC UA.
En los siguientes apartados se explica qu√© diagn√≥sticos agrupa la CPU y c√≥mo se ejecuta el
proceso cuando el n√∫mero de avisos es elevado.

Requisitos
En las propiedades OPC UA de la CPU est√° activada la opci√≥n "Agrupar diagn√≥sticos cuando
haya un n√∫mero elevado de avisos" (OPC UA > Servidor > Diagn√≥stico, √°rea "Agrupar
diagn√≥sticos").

Ejemplo
Un cliente OPC UA "desborda" repetidas veces una CPU S7-1500 como servidor OPC UA con
una tasa de muestreo que el servidor no puede manejar (sobrecarga).
El ajuste "Agrupar diagn√≥sticos cuando haya un n√∫mero elevado de avisos" est√° activado.
En el b√∫fer de diagn√≥stico aparece para este diagn√≥stico el aviso de que no se ha podido
alcanzar la tasa de muestreo; este aviso va seguido del n√∫mero de eventos que han tenido
lugar en el intervalo configurado.

Diagn√≥sticos OPC UA que pueden agruparse
Cada uno de los diagn√≥sticos indicados a continuaci√≥n forman grupos propios (tipo). Con el
ajuste "Agrupar diagn√≥sticos cuando haya un n√∫mero elevado de avisos" se comprimen los
diagn√≥sticos de un mismo grupo:
‚óè Uso incorrecto de un servicio OPC UA
‚óè Error de servicio OPC UA
‚óè El estado de suscripci√≥n ha cambiado
‚óè No se ha podido alcanzar la tasa de muestreo (suscripciones, sobrecarga)
‚óè La comprobaci√≥n de seguridad OPC UA ha fallado
‚óè Capacidad del servidor OPC UA rebasada por exceso

Funcionamiento
La CPU registra de inmediato los tres primeros diagn√≥sticos de un grupo en el b√∫fer de
diagn√≥stico. Todos los diagn√≥sticos siguientes de ese mismo grupo los ignora.
Al final del per√≠odo de vigilancia (intervalo), la CPU genera un aviso de grupo en el que registra
el diagn√≥stico y la frecuencia del mismo durante el intervalo que ha finalizado. Si estos
diagn√≥sticos tambi√©n aparecen en los intervalos siguientes, la CPU genera √∫nicamente un
aviso de grupo para cada intervalo siguiente.

1404

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el b√∫fer de diagn√≥stico, una avalancha de diagn√≥sticos deja el patr√≥n siguiente: tres avisos
individuales seguidos de una serie de avisos de grupo. Dicha serie puede constar de dos, tres
o m√°s avisos de grupo, en funci√≥n del tiempo de vigilancia seleccionado y de la duraci√≥n de la
avalancha de diagn√≥sticos.






‚ë†
‚ë°
‚ë¢

‚ë£

Diagn√≥sticos de un grupo (un tipo), por ejemplo, "No se ha podido alcanzar la tasa de muestreo".
Intervalo (per√≠odo de vigilancia): cuando se produce por primera vez (o se repite) un diagn√≥stico,
se inicia (o reinicia) el tiempo de vigilancia.
Avisos individuales: los tres primeros diagn√≥sticos de un mismo grupo se registran de inmediato
en el b√∫fer de diagn√≥stico. A partir del cuarto diagn√≥stico, la CPU genera solamente avisos de
grupo. Si tras una pausa de un intervalo como m√≠nimo se vuelve a producir un diagn√≥stico de
este grupo, la CPU registra un aviso individual en el b√∫fer de diagn√≥stico y vuelve a iniciar el
per√≠odo de vigilancia.
Avisos de grupo: tras tres diagn√≥sticos, la CPU genera √∫nicamente un aviso de grupo como
resumen de todos los dem√°s diagn√≥sticos que se producen en este intervalo. Si estos diag‚Äê
n√≥sticos tambi√©n aparecen en los intervalos siguientes, la CPU genera √∫nicamente un aviso de
grupo para cada intervalo siguiente.

Utilizar la CPU S7-1200 como servidor OPC UA
Informaci√≥n importante sobre el servidor OPC UA de las CPU S7-1200
El servidor OPC UA de las CPU S7-1200
Las CPU S7-1200 a partir de la versi√≥n de firmware V4.4 cuentan con un servidor OPC UA.
Esto no solo afecta a las CPU S7-1200C est√°ndar, sino tambi√©n a las variantes S7-1200FC.
Convenci√≥n: el t√©rmino "CPU S7-1200" incluye todas las variantes de CPU citadas arriba.

Principios b√°sicos del servidor OPC UA de la CPU S7-1200
Se puede acceder al servidor OPC UA de la CPU a trav√©s de la interfaz PROFINET de la CPU
S7-1200.
Para el acceso por clientes, el servidor guarda las variables PLC habilitadas y otra informaci√≥n
en forma de nodos (consulte AUTOHOTSPOT). Estos nodos est√°n conectados entre s√≠ y
forman una red. OPC UA define puntos de acceso a esa red (well-known nodes), que permiten
navegar hasta nodos subordinados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1405

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Clases de nodos y espacio de direcciones
Los servidores OPC UA proporcionan informaci√≥n en forma de nodos (nodes). Un nodo puede
ser, por ejemplo, un objeto, una variable, un m√©todo o una propiedad.
Una red formada por nodos tambi√©n se denomina espacio de direcciones. Partiendo de la ra√≠z
se accede a todos los nodos del espacio de direcciones.
Los nodos est√°n unidos entre s√≠ mediante referencias, por ejemplo mediante la referencia
"HasComponent", que refleja una relaci√≥n jer√°rquica entre un nodo y sus nodos subordinados.
Mediante sus referencias, los nodos componen una red que puede tener, por ejemplo, forma
de √°rbol.
El siguiente ejemplo muestra el espacio de direcciones del servidor OPC UA de una CPU
S7-1200 (extracto del "UaExpert" de Unified Automation).

Figura 1-73

Ejemplo del espacio de direcciones del servidor OPC UA de una CPU S7-1200

En la figura superior se ha seleccionado la variable "MyValue" (sobre fondo gris).
Esta variable se encuentra bajo el nodo "Memory", que pertenece a la clase de nodo "Object".
A su vez, "Memory" se encuentra bajo el nodo "PLC_1" (asimismo un Object).

1406

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Acceso a aplicaciones OPC UA (P√°gina 1298)
Documentaci√≥n del sistema de automatizaci√≥n S7-1200 (https://
support.industry.siemens.com/cs/ww/es/ps/13685/man)

Puntos finales de los servidores OPC UA
Los puntos finales de los servidores OPC UA definen el nivel de seguridad de una conexi√≥n.
Seg√∫n la finalidad de aplicaci√≥n o el nivel de seguridad deseado, en el punto final deben
realizarse los ajustes correspondientes a la conexi√≥n.

Distintos ajustes de seguridad
Antes de establecer una conexi√≥n segura, los clientes OPC UA solicitan al servidor
informaci√≥n sobre qu√© ajustes de seguridad son necesarios para establecer conexiones. El
servidor devuelve una lista con todos los ajustes de seguridad (puntos finales) que ofrece.

Configuraci√≥n de puntos finales
Los puntos finales constan de los siguientes componentes:
‚óè Identificaci√≥n para OPC: "opc.tcp"
‚óè Direcci√≥n IP: 192.168.178.151 (en el ejemplo)
‚óè N√∫mero de puerto para OPC UA: 4840 (puerto est√°ndar)
El n√∫mero de puerto es configurable.
‚óè Ajuste de seguridad para mensajes (Message Security Modus): None, Sign,
SignAndEncrypt.
‚óè Procedimiento de cifrado y hash (Security Policy): None, Basic128Rsa15, Basic256,
Basic256Sha256 (en el ejemplo).
La figura siguiente muestra el programa "UA Sample Client" de la OPC Foundation.
El cliente ha establecido una conexi√≥n segura con el servidor OPC UA, con el punto final
"opc.tcp://192.168.178.151:4840 - [SignAndEncrypt: Basic256Sha256:Binary]". El punto final
contiene los ajustes de seguridad "SignAndEncrypt:Basic256Sha256".
Nota
Seleccionar un punto final con la mayor directiva de seguridad (Security Policy) posible
Seleccione para los puntos finales una directiva de seguridad adecuada a la aplicaci√≥n.
Desactive en el servidor OPC UA la directiva de seguridad menor.
Para los puntos finales m√°s seguros (Basic256Sha256) del servidor OPC UA de la CPU
S7-1200 se necesita un certificado Sha256.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1407

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Una conexi√≥n con un punto final del servidor solo se establece si el cliente OPC UA cumple los
ajustes de seguridad exigidos para el punto final.

Informaci√≥n proporcionada por el servidor OPC UA
Los servidores OPC UA proporcionan numerosa informaci√≥n:
‚óè Los valores de variables PLC y de componentes de DB a los que pueden acceder los
clientes.
‚óè Los tipos de datos de esas variables PLC y componentes de DB.
‚óè Datos sobre el propio servidor OPC UA y sobre la CPU.
Con ella, los clientes pueden hacerse una visi√≥n general y leer informaci√≥n espec√≠fica. No se
necesitan conocimientos previos sobre el programa del PLC ni sobre los datos de la CPU. No
es necesario preguntar al desarrollador del programa del PLC cu√°ndo deben leerse las
variables PLC. En el propio servidor est√°n guardados todos los datos necesarios (por ejemplo,
los tipos de datos de las variables PLC).

Visualizaci√≥n de la informaci√≥n del servidor OPC UA
Existen las siguientes posibilidades:
‚óè Online: toda la informaci√≥n disponible se visualiza durante el tiempo de ejecuci√≥n del
servidor OPC UA. Para ello, navegue por el espacio de direcciones del servidor.
‚óè Offline: las interfaces configuradas del servidor se exportan en forma de archivos XML
basados en los esquemas XML de la OPC Foundation.

1408

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Offline con la API Openness: En el programa se utiliza la API (Application Programming
Interface) de TIA Portal para llamar la funci√≥n de exportaci√≥n de todas las variables PLC
legibles por OPC UA. Para ello se necesita .NET Framework 4.0, v√©ase TIA Portal
Openness, Automatizaci√≥n de proyectos SIMATIC mediante scripts (https://
support.industry.siemens.com/cs/ww/en/view/109477163).
‚óè Si ya se conoce la sintaxis y el programa del PLC, puede accederse al servidor OPC UA sin
averiguaciones previas.

Comportamiento del servidor OPC UA durante el funcionamiento
El servidor OPC UA en funcionamiento
El servidor OPC UA de la CPU S7-1200 arranca cuando se activa el servidor y se carga el
proyecto en la CPU.
Reacci√≥n al estado operativo STOP de la CPU
Un servidor OPC UA activado permanece en funcionamiento aunque la CPU cambie al estado
operativo "STOP". Entonces, el servidor OPC UA contin√∫a respondiendo a consultas de
clientes OPC UA.
Comportamiento concreto del servidor:
‚óè Cuando se consultan valores de variables PLC se obtienen los valores que eran actuales
antes de que la CPU cambiara al estado operativo "STOP".
‚óè Si se escriben valores en el servidor OPC UA, este los aplica.
Pero la CPU no procesa los valores porque el programa de usuario no se ejecuta en el
estado operativo "STOP".
Sin embargo, un cliente OPC UA puede leer en el servidor OPC UA de la CPU los valores
escritos en el estado operativo STOP.
Cuando arranca de nuevo, la CPU sobrescribe los valores escritos en el estado operativo
STOP con los valores de arranque de las variables PLC.

Carga de la CPU con el servidor OPC UA en funcionamiento
Si se carga una CPU estando en funcionamiento un servidor OPC UA, es posible que deba
pararse y reiniciarse el servidor, seg√∫n cu√°les sean los objetos cargados. En ese caso, las
conexiones activas se interrumpen y deben volver a establecerse una vez reiniciado el
servidor.
El tiempo de reinicio depende especialmente de los par√°metros siguientes:
‚óè del volumen de la estructura de datos
‚óè del n√∫mero de variables visibles en el espacio de direcciones OPC UA
‚óè del ajuste de la definici√≥n de tipos de datos compatibles con versiones anteriores seg√∫n la
especificaci√≥n OPC UA hasta V1.03 (TypeDictionary activado)
‚óè de los ajustes de la carga por comunicaci√≥n y el tiempo m√≠nimo de ciclo

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1409

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Carga de objetos en estado operativo STOP de la CPU
El servidor OPC UA se detiene y a continuaci√≥n vuelve a arrancar. En ese caso, STEP 7 no
muestra advertencia alguna.
Carga de objetos en estado operativo RUN de la CPU
El servidor OPC UA solo se detiene si los objetos cargados son o podr√≠an ser relevantes para
OPC UA. Tras una reinicializaci√≥n causada por la modificaci√≥n de datos OPC UA, el servidor
OPC UA arranca de nuevo.
Antes de que se carguen en la CPU objetos relevantes para OPC UA y se detenga el servidor
OPC UA, STEP 7 muestra una advertencia en el cuadro de di√°logo de vista preliminar a la
carga. En ese momento es posible decidir si un reinicio del servidor es compatible con el
proceso en curso o si es preferible cancelar la carga. Estas advertencias solo se muestran si
el servidor OPC UA est√° funcionando. Si el servidor OPC UA no est√° activado, los datos OPC
UA modificados no influyen en la operaci√≥n de carga.
Ejemplos
‚óè Debe agregarse un bloque l√≥gico m√°s al programa.
Esto no afecta ni a bloques de datos ni a entradas, salidas, marcas, temporizadores o
contadores.
Reacci√≥n al cargar: un servidor OPC UA que est√© funcionando no se interrumpe.
‚óè Debe cargarse un nuevo bloque de datos que se ha marcado como no relevante para OPC
UA.
Reacci√≥n al cargar: un servidor OPC UA que est√© funcionando no se interrumpe.
‚óè Debe sobrescribirse un bloque de datos.
Reacci√≥n al cargar: se muestra una advertencia indicando que el servidor se reiniciar√°.
Aclaraci√≥n: STEP 7 no puede determinar si los cambios afectan a datos relevantes para
OPC UA o no.

Leer el estado operativo de la CPU a trav√©s del servidor OPC UA
El servidor OPC UA permite leer el estado operativo de la CPU; consulte la figura siguiente:

1410

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configurar el acceso a variables PLC
Administrar derechos de escritura y lectura
Habilitar variables PLC y variables DB para OPC UA
Los clientes OPC UA pueden acceder a variables PLC y variables DB en modo de lectura y
escritura si las variables est√°n habilitadas para OPC UA (ajuste predeterminado).
En "Accesible desde HMI/OPC UA", las variables habilitadas tienen activadas las casillas de
verificaci√≥n "Escribible desde HMI/OPC UA" y "Visible en HMI Engineering".

El ajuste predeterminado se puede cambiar en la configuraci√≥n de TIA Portal: comando
"Configuraci√≥n > Programaci√≥n de PLC > General" en el men√∫ "Opciones". En el √°rea "Interfaz
de bloque/Elementos de bloques de datos" encontrar√° las opciones correspondientes.

Suprimir derechos de escritura
Si desea proteger una variable contra accesos de escritura, desactive en dicha variable la
opci√≥n "Escribible desde HMI/OPC UA". De este modo se retira a los clientes OPC UA y a los
dispositivos HMI el derecho de escritura.
Resultado: los clientes OPC UA y los dispositivos HMI √∫nicamente tienen acceso de lectura.
Los clientes OPC UA no pueden asignar valores a esa variable, ni por tanto influir en la
ejecuci√≥n del programa S7.

Suprimir derechos de escritura y lectura
Para proteger una variable contra accesos de escritura y lectura, desactive en dicha variable
la opci√≥n "Accesible desde HMI/OPC UA" (marca de verificaci√≥n no activada). De este modo,
el servidor OPC UA elimina la variable de su espacio de direcciones. Los clientes OPC UA ya
no ven esta variable de CPU.
Resultado: los clientes OPC UA y los dispositivos HMI no pueden ni leer ni escribir la variable.

Visible en HMI Engineering
La opci√≥n "Visible en HMI Engineering" se refiere a herramientas de ingenier√≠a de Siemens. Si
se desactiva la opci√≥n "Visible en HMI Engineering" (marca de verificaci√≥n no activada), ya no
se podr√° configurar la variable en WinCC (TIA Portal).
La opci√≥n no tiene ninguna repercusi√≥n en OPC UA.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1411

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas
‚óè No permita en STEP 7 accesos de lectura a variables PLC y variables de bloques de datos
m√°s que cuando sea necesario para la comunicaci√≥n con otros sistemas (controladores,
sistemas integrados, MES).
No deben habilitarse otras variables PLC.
‚óè Garantice accesos de escritura a trav√©s de OPC UA solo si los derechos de escritura son
realmente necesarios con determinadas variables PLC y variables de bloques de datos.
‚óè Si ha desactivado la opci√≥n "Accesible desde HMI/OPC UA" para todos los elementos de
un bloque de datos, en el espacio de direcciones del servidor OPC UA de la CPU S7-1200
este bloque de datos dejar√° de estar visible para un cliente OPC UA.
‚óè Tambi√©n es posible evitar de forma centralizada el acceso a un bloque de datos completo,
como en las CPU S7-1500 (consulte Administrar derechos de escritura y lectura para un DB
completo (P√°gina 1333)). Este ajuste prevalece sobre los ajustes de los componentes en
el editor de DB.

Coordinar derechos de escritura y lectura para variables de CPU
Definici√≥n de derechos de escritura y lectura en el modelo de informaci√≥n (XML OPC UA)
En el modelo de informaci√≥n OPC UA el acceso a las variables est√° regulado por el atributo
"AccessLevel".
AccessLevel est√° definido bit a bit:
Bit 0 = CurrentRead y Bit 1 = CurrentWrite. El significado de las combinaciones de bits es el
siguiente:
‚óè AccessLevel = 0: ning√∫n acceso
‚óè AccessLevel = 1: read only:
‚óè AccessLevel = 2: write only
‚óè AccessLevel = 3: read+write
Ejemplo de asignaci√≥n de derechos de escritura y lectura (read+write)

Definici√≥n de derechos de escritura y lectura en STEP 7
Al definir variables defina los derechos de acceso con las propiedades "Accesible desde HMI/
OPC UA‚Äú y "Escribible desde HMI/OPC UA".

1412

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La interacci√≥n de los derechos de escritura y lectura se describe aqu√≠ (P√°gina 1335).

Atributo MinimumSamplingInterval
Muestreo de las variables
Adem√°s de "Value", "DataType" y "AccessLevel" tambi√©n se puede activar el atributo
"MinimumSamplingInterval" para una variable en el archivo XML que representa el espacio de
direcciones del servidor.
El atributo indica la rapidez con la que el servidor puede explorar el valor de la variable.
El valor puede ajustarse entre 100 ms y 10 s. El valor predeterminado es 1000 ms.
La frecuencia de muestreo est√° limitada al intervalo determinado por el cliente OPC UA.
El servidor OPC UA de la CPU S7-1200 procesa del siguiente modo los valores para
MinimumSamplingInterval:
‚óè Los valores negativos y los valores por encima de 4294967 se ponen a -1. Eso significa: la
tasa de muestreo m√≠nima es indeterminada; el servidor no indica la rapidez con la que se
explora el valor de la variable.
‚óè Los decimales se redondean a 3.

Configuraci√≥n del servidor OPC UA
Activar servidor OPC UA
Requisitos
‚óè Cuando se utilizan certificados para la comunicaci√≥n segura (p. ej., HTTPS, Secure OUC,
OPC UA), hay que asegurarse de que los m√≥dulos afectados tengan la fecha y hora
actuales. De lo contrario, los m√≥dulos considerar√°n los certificados utilizados no v√°lidos y
la comunicaci√≥n segura no funcionar√°.
‚óè Ha adquirido una licencia Runtime para el uso de las funciones OPC UA.

Puesta en marcha del servidor OPC UA
En el ajuste b√°sico, el servidor OPC UA de la CPU no est√° habilitado por motivos de seguridad:
Los clientes OPC UA no tienen acceso de lectura ni escritura a la CPU SIMATIC S7-1200.
Para activar el servidor OPC UA de la CPU, proceda del siguiente modo.
1. Seleccione la CPU. Para ello, haga clic en el icono de la CPU (p. ej., en la vista de redes).
2. Haga clic en las propiedades de la CPU en "OPC UA > Servidor".
3. Active el servidor OPC UA de la CPU.
4. Confirme las consignas de seguridad.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1413

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. En las propiedades de la CPU seleccione el √°rea "Licencias Runtime" y ajuste la licencia
Runtime adquirida para el servidor OPC UA.
6. Compile el proyecto.
7. Cargue el proyecto en la CPU.
Se inicia el servidor OPC UA de la CPU.

Los ajustes contin√∫an guardados
Si ya se ha activado el servidor y se han realizado ajustes, estos no se perder√°n si se desactiva
el servidor. Los ajustes contin√∫an guardados y estar√°n de nuevo disponibles cuando se active
nuevamente el servidor.

Nombre de aplicaci√≥n
El nombre de aplicaci√≥n es el nombre de la aplicaci√≥n OPC UA y es v√°lido, en principio, para
el servidor y el cliente de una CPU. En la actualidad, las CPU S7-1200 solo disponen de un
servidor OPC UA. El nombre se visualiza en "OPC UA > General":
‚óè El ajuste predeterminado para el nombre de aplicaci√≥n es el siguiente:
"SIMATIC.S7-1200.OPC-UA.Application:PLC_1".
‚óè El ajuste predeterminado se compone de "SIMATIC.S7-1200.OPC-UA.Application:" y el
nombre de la CPU, tal y como figura en "General > Informaci√≥n del producto > Nombre",
aqu√≠ "PLC_1".
‚óè Este es el nombre de aplicaci√≥n con el que se identifica el servidor OPC UA frente a un
interlocutor (cliente OPC UA), p. ej. cuando un cliente OPC UA utiliza el servicio Discovery
para determinar los servidores accesibles.
‚óè El cliente OPC UA de la CPU utiliza el nombre de aplicaci√≥n visualizado al establecer la
conexi√≥n con un servidor OPC UA. Es decir, la CPU registra autom√°ticamente este nombre
de aplicaci√≥n como "ApplicationName" para la instrucci√≥n "OPC_UA_Connect" (variable
del tipo "OPC_UA_SessionConnectInfo" en el par√°metro "SessionConnectInfo" de la
instrucci√≥n "OPC_UA_Connect").
Por este motivo, al programar la instrucci√≥n "OPC_UA_Connect" debe asignarse un string
vac√≠o al "ApplicationName". El nombre de aplicaci√≥n permite identificar el cliente con sus
sesiones (SessionNames) para fines de diagn√≥stico, por ejemplo.
Tras activar el servidor, tambi√©n puede utilizar otro nombre descriptivo dentro de su proyecto
y que cumpla los requisitos vigentes en el proyecto como, p. ej., que sea un√≠voco en todo el
mundo.

Cambiar el nombre de la aplicaci√≥n
Para cambiar el nombre de la aplicaci√≥n, proceda del siguiente modo:
1. Seleccione la CPU. Para ello, haga clic en el icono de la CPU (p. ej., en la vista de redes).
2. Haga clic en las propiedades de la CPU en "OPC UA > General".
3. Introduzca un nombre descriptivo.

1414

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tenga en cuenta que el nombre de la aplicaci√≥n tambi√©n est√° registrado en el certificado
(Subject Alternative Name) y que despu√©s de cambiar el nombre de la aplicaci√≥n podr√≠a tener
que crear de nuevo un certificado ya creado anteriormente.

Consulte tambi√©n
Licencias para OPC UA (P√°gina 1416)

Acceso al servidor OPC UA
Direcciones de servidores
Al servidor OPC UA de la CPU S7-1200 se accede a trav√©s de las interfaces PROFINET
integradas en la CPU (a partir del firmware V4.4).
Las direcciones del servidor se encuentran en el √°rea "OPC UA > Servidor > General" de los
par√°metros de la CPU e indican la direcci√≥n IP de la interfaz PROFINET en forma de URL
como sigue:
Ejemplo de una URL (Uniform Resource Locator), a trav√©s de la que pueden establecerse
conexiones con el servidor OPC UA de la CPU:
"opc.tcp://192.168.178.151:4840 "
La URL se compone de lo siguiente:
‚óè Identificador de protocolo "opc.tcp://"
‚óè Direcci√≥n IP
‚Äì 192.168.178.151
Direcci√≥n IP a trav√©s de la cual puede accederse al servidor OPC UA desde la subred
Ethernet 192.168.178.
‚óè N√∫mero de puerto TCP
‚Äì Ajuste predeterminado: 4840 (puerto est√°ndar)
El n√∫mero de puerto puede cambiarse en "OPC UA > Servidor > Ajustes > Puerto".

Direcciones IP din√°micas
Si todav√≠a no se ha definido la direcci√≥n IP de la interfaz PROFINET, aparece el comod√≠n
"<dynamically>" en el √°rea "Direcciones de servidor".
La direcci√≥n IP de esta interfaz PROFINET debe ajustarse posteriormente en el dispositivo.

Interfaz est√°ndar del servidor SIMATIC no disponible en el S7-1200
La opci√≥n "Activar la interfaz est√°ndar del servidor SIMATIC" no est√° disponible en el servidor
OPC UA de la CPU S7-1200.
Es preciso agregar interfaces de servidor en la entrada "Comunicaci√≥n OPC UA" del √°rbol del
proyecto. Estas interfaces de servidor permiten ver las variables habilitadas para OPC UA para
clientes OPC UA.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1415

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Otros ajustes de servidor OPC UA
Ajustes de servidor OPC UA
El servidor OPC UA de la CPU S7-1200 ofrece, en principio, los mismos ajustes que una CPU
S7-1500; tan solo hay algunas opciones determinadas que no est√°n disponibles en el servidor
OPC UA de la CPU S7-1200. Los rangos de valores est√°n limitados.
Encontrar√° m√°s informaci√≥n sobre los ajustes del servidor OPC UA aqu√≠:
Ajustes generales del servidor OPC UA (P√°gina 1345)
Ajustes del servidor para suscripciones (P√°gina 1346)
Manejo de certificados de cliente y de servidor (P√°gina 1348)
Crear certificados de servidor con STEP 7 (P√°gina 1354)
Autenticaci√≥n del usuario (P√°gina 1357)

Licencias para OPC UA
Licencias runtime
Para operar el servidor OPC UA de la CPU S7-1200 se requiere una licencia del tipo "Basic".
El tipo de licencia requerida se muestra en "Propiedades > General > Licencias runtime > OPC
UA > Tipo de licencia necesaria":

Para confirmar la compra de la licencia, proceda del siguiente modo:
1. Haga clic en las propiedades de la CPU en "Licencias runtime > OPC UA".
2. Seleccione la licencia necesaria en la lista desplegable "Tipo de licencia adquirida".

Configuraci√≥n de la interfaz de servidor OPC UA
¬øQu√© es una interfaz de servidor?
Definici√≥n
Una interfaz de servidor agrupa en una unidad los nodos de un espacio de direcciones OPC
UA de una CPU, de manera que los clientes OPC UA obtienen una determinada vista de la
CPU.
Cada interfaz de servidor define uno o varios espacios de nombres en el servidor OPC UA de
la CPU.

1416

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
STEP 7 (TIA Portal) distingue entre los siguientes tipos de interfaces de servidor:
‚óè Especificaci√≥n companion
Para este tipo de interfaz de servidor se utiliza, p. ej., una especificaci√≥n companion que ha
creado un grupo de trabajo.
Por lo general, el grupo de trabajo se compone de miembros de la OPC Foundation y otra
organizaci√≥n industrial, los cuales han especificado juntos un modelo de informaci√≥n OPC
UA para una finalidad concreta (por ejemplo para el intercambio de datos con dispositivos
RFID o con m√°quinas de moldeo por inyecci√≥n).
Este modelo de informaci√≥n se ejecuta en forma de nodo OPC UA en el espacio de
direcciones de un servidor OPC UA. Los clientes OPC UA pueden acceder a estos nodos
OPC UA.
El tipo de interfaz de servidor "Especificaci√≥n companion" tambi√©n se puede utilizar, p. ej.,
para cargar modelos de informaci√≥n creados internamente en la empresa, p. ej., en SiOME.
Si en el proyecto se aplica una especificaci√≥n companion determinada, deben incorporarse
las especificaciones de esta especificaci√≥n companion en el proyecto como interfaz de
servidor.
Para interfaces de servidor del tipo "Especificaciones Companion" es posible importar
varios espacios de nombres que utilicen la especificaci√≥n Companion.
‚óè Interfaz de servidor definida por el usuario:
Para este tipo de interfaz de servidor, los nodos OPC UA de un servidor OPC UA se
agrupan en una unidad.
Para ello, ori√©ntese seg√∫n las especificaciones del proyecto o las necesidades de la
m√°quina o instalaci√≥n.

M√°quina de moldeo por inyecci√≥n como ejemplo de especificaci√≥n Companion
Una interfaz de servidor de tipo "Especificaci√≥n Companion" contiene, por ejemplo, los
siguientes elementos:
‚óè Nodos OPC UA que se pueden leer con un cliente OPC UA para obtener informaci√≥n sobre
la m√°quina de inyecci√≥n (desde variables PLC con acceso de lectura),
‚óè Nodos OPC UA que se pueden escribir con un cliente OPC UA para transferir valores a la
m√°quina de inyecci√≥n (en variables PLC con acceso de escritura),
Esta interfaz de servidor proporciona una vista estandarizada de una CPU que act√∫a como
controlador de una m√°quina de inyecci√≥n.
La especificaci√≥n Companion "Euromap" define para las m√°quinas de moldeo por inyecci√≥n
una serie de nodos OPC UA que pueden utilizarse como interfaz con el servidor.
Esta interfaz de servidor no incluye otros nodos OPC UA de la CPU. As√≠ se obtiene una mejor
visi√≥n de conjunto.

Ejemplo de interfaz de servidor definida por el usuario
Una CPU debe controlar la fabricaci√≥n de piezas. La producci√≥n empieza cuando llega una
orden de producci√≥n del sistema de control de procesos superior.
Las √≥rdenes de producci√≥n se transfieren a trav√©s de un m√©todo de servidor: Un sistema de
control de procesos transfiere la informaci√≥n sobre una pieza llamando el m√©todo de servidor
en la CPU. Este m√©todo de servidor tambi√©n inicia la producci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1417

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El sistema de control de procesos, es decir, el cliente OPC UA conectado tan solo debe ver
este m√©todo de servidor. Para ello, cree una interfaz de servidor definida por el usuario en la
CPU y as√≠gnele el m√©todo de servidor. Se trata de habilitar esta interfaz de servidor solo para
clientes OPC UA y, con ello, limitar la vista de la CPU a esta funci√≥n.

M√°s informaci√≥n sobre el manejo de interfaces de servidor
La creaci√≥n, exportaci√≥n y carga de interfaces de servidor funcionan exactamente igual que en
las CPU S7-1500.
Hay que tener en cuenta las siguientes restricciones para las CPU S7-1200:
‚óè Las CPU S7-1200 no soportan ning√∫n m√©todo.
Cuando se intenta asignar un bloque de funci√≥n de la columna "Elementos OPC UA" a un
m√©todo en la interfaz del servidor OPC UA con la funci√≥n de arrastrar y colocar, no se
obtiene reacci√≥n.
‚óè Los tipos de datos estructurados como, por ejemplo, los tipos de datos OPC UA DateTime,
NodeId y QualifiedName, no se soportan.
Cuando se intenta asignar una variable de un tipo de datos estructurado de la columna
"Elementos OPC UA" a un elemento correspondiente de la interfaz del servidor, STEP 7
genera un error.
Copiar interfaces de servidor de una CPU S7-1500
Si ha creado interfaces de servidor para una CPU S7-1500, puede copiar estas interfaces de
servidor al √°rea "Comunicaci√≥n OPC UA" de una CPU S7-1200.
Si la interfaz de servidor contiene elementos no soportados, como se menciona m√°s arriba, la
compilaci√≥n de la configuraci√≥n o la prueba de coherencia se cancelar√°n con errores.

Consulte tambi√©n
Crear una interfaz de servidor personalizada (P√°gina 1364)
Utilizaci√≥n de especificaciones OPC UA Companion (P√°gina 1369)
Crear una interfaz de servidor para el espacio de nombres de referencia (P√°gina 1384)

Utilizar la CPU S7-1500 como cliente OPC UA
Sinopsis y requisitos
A partir de la versi√≥n V15.1, STEP 7 (TIA Portal) permite configurar y programar un cliente OPC
UA que puede leer variables PLC de un servidor OPC UA. Igualmente es posible transferir a
un servidor OPC UA nuevos valores para variables PLC. En el programa de usuario tambi√©n
se puede acceder a los m√©todos que proporciona un servidor OPC UA. Para ello se utilizan en
el programa de usuario las instrucciones para clientes OPC UA.
Las instrucciones del cliente OPC UA se basan en el est√°ndar "PLCopen OPC-UA Client for
IEC61131-3".

1418

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Especificaci√≥n PLCopen
Estas instrucciones estandarizadas permiten desarrollar funciones de cliente OPC UA en el
programa de usuario ejecutables en una CPU S7-1500.
Adem√°s, con un m√≠nimo de modificaciones es posible ejecutar este programa de usuario
incluso en controladores de otros fabricantes, siempre que dichos fabricantes tambi√©n hayan
implementado la especificaci√≥n OPC UA "PLCopen OPC-UA Client for IEC61131-3".

C√≥modos editores en STEP 7
La parametrizaci√≥n de las instrucciones para clientes OPC UA se puede realizar con el
c√≥modo editor Parametrizaci√≥n de la conexi√≥n (P√°gina 1341) disponible en el TIA Portal.
A partir de la versi√≥n 15.1, STEP 7 dispone asimismo de un Editor para interfaces de cliente
(P√°gina 1425).
En este cap√≠tulo se describe c√≥mo trabajar con estos editores.
Primero se explicar√° c√≥mo crear y configurar una interfaz nueva con el editor de interfaces, ya
que esta interfaz se necesitar√° para la posterior parametrizaci√≥n de la conexi√≥n.
Para que la descripci√≥n sea m√°s comprensible, utilizamos un ejemplo; ver Descripci√≥n del
ejemplo (P√°gina 1423).

Requisitos
‚óè Dispone de la licencia runtime necesaria para OPC UA y ha configurado la licencia en STEP
7 (propiedades de la CPU > Licencias runtime).
‚óè El cliente de la CPU S7-1500 est√° activado.
Para poder utilizar el cliente de la CPU S7-1500, debe activarlo:
1. En las propiedades de la CPU, seleccione el √°rea "OPC UA > Cliente".
2. Active la opci√≥n "Activar cliente OPC UA".
Si no activa el cliente, no se establecer√° ninguna conexi√≥n. Recibir√° el correspondiente
mensaje de error en las instrucciones, p. ej. en "OPC_UA_Connect".
Encontrar√° informaci√≥n sobre el nombre de aplicaci√≥n v√°lido tambi√©n para el servidor y el
cliente aqu√≠ (P√°gina 1341).

Sinopsis
Para utilizar el editor y la parametrizaci√≥n de conexiones, proceda del siguiente modo:
1. Cree primero una interfaz de cliente. Agregue a la interfaz los m√©todos y variables PLC a
los que desee acceder ("Primer paso (P√°gina 1425)").
2. Parametrice a continuaci√≥n la conexi√≥n al servidor OPC UA (Segundo paso (P√°gina 1440)).
3. Por √∫ltimo, utilice la conexi√≥n parametrizada en las instrucciones del cliente OPC UA
(Tercer paso (P√°gina 1448)).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1419

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n importante sobre las instrucciones de cliente
La CPU S7-1500 como cliente OPC UA le permite controlar la comunicaci√≥n para las
siguientes tareas con instrucciones del cliente OPC UA estandarizadas:
‚óè Leer/escribir variables del servidor OPC UA
‚óè Llamar m√©todos en el servidor OPC UA
Las instrucciones de uso opcional permiten determinar la siguiente informaci√≥n:
‚óè el estado de la conexi√≥n entre el cliente OPC UA y el servidor OPC UA
‚óè NodeIds de nodos si se conoce la jerarqu√≠a del espacio de direcciones

Ejecuci√≥n estandarizada de la comunicaci√≥n OPC UA
La ejecuci√≥n de la comunicaci√≥n y, por tanto, la secuencia de instrucciones sigue el patr√≥n que
muestra la figura siguiente.
Secuencia de ejecuci√≥n para la operaci√≥n de lectura o escritura





23&B8$B'LVFRQQHFW

23&B8$B&RQQHFW
23&B8$B1DPHVSDFH*HW,QGH[/LVW
23&B8$B1RGH*HW+DQGOH/LVW

23&B8$B5HDG/LVW
23&B8$B:ULWH/LVW

‚ë†
‚ë°
‚ë¢

23&B8$B1RGH5HOHDVH+DQGOH/LVW

Instrucciones para preparar las operaciones de lectura y escritura
Instrucciones de lectura y escritura
Instrucciones para "Clean-up" una vez ejecutadas las operaciones de lectura o escritura

Secuencia de ejecuci√≥n para la llamada de m√©todos en el servidor OPC UA





23&B8$B'LVFRQQHFW

23&B8$B&RQQHFW
23&B8$B1DPHVSDFH*HW,QGH[/LVW
23&B8$B0HWKRG*HW+DQGOH/LVW

‚ë†
‚ë°
‚ë¢

23&B8$B0HWKRG&DOO

23&B8$B0HWKRG5HOHDVH+DQGOH/LVW

Instrucciones para preparar las llamadas de m√©todos
Llamadas de m√©todos
Instrucciones para "Clean-up" una vez ejecutadas las llamadas de m√©todos

Instrucciones opcionales (lectura del estado de una conexi√≥n/lectura de NodeIds de nodos si
se conoce la jerarqu√≠a del espacio de direcciones)
‚óè OPC_UA_ConnectionGetStatus
‚óè OPC_UA_TranslatePathList

1420

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones



23&B8$B&RQQHFW

23&B8$B&RQQHFWLRQ*HW6WDWXV


23&B8$B'LVFRQQHFW

23&B8$B1DPHVSDFH*HW,QGH[/LVW
23&B8$B7UDQVODWLRQ3DWK/LVW
23&B8$B1RGH*HW+DQGOH/LVW

‚ë†
‚ë°
‚ë¢

23&B8$B5HDG/LVW
23&B8$B:ULWH/LVW

23&B8$B1RGH5HOHDVH+DQGOH/LVW

Instrucciones para preparar las operaciones de lectura y escritura con instrucci√≥n insertada para
consultar, por ejemplo, los NodeIds de los nodos del servidor OPC UA.
De forma paralela a otras instrucciones, se puede determinar el estado de la conexi√≥n existente
entre que se establece y se deshace la misma
Instrucciones para "Clean-up"

C√≥modos editores en STEP 7
Las instrucciones del cliente OPC UA se describen detalladamente en la secci√≥n de referencia
(Sistema de informaci√≥n de STEP 7). La parametrizaci√≥n de las instrucciones se puede
realizar con el c√≥modo editor Parametrizaci√≥n de la conexi√≥n (P√°gina 1440) disponible en el
TIA Portal.
Para el primer dise√±o de programa se recomienda empezar con la parametrizaci√≥n de la
conexi√≥n, utilizar otras instrucciones en caso necesario, y optimizar el programa
manualmente.

Informaci√≥n sobre las instrucciones de cliente
Las instrucciones de cliente se describen detalladamente en la ayuda de las instrucciones >
Comunicaci√≥n > OPC UA > Servidor OPC UA.

Ejemplo de aplicaci√≥n en el Online Support
En este ejemplo de aplicaci√≥n (https://support.industry.siemens.com/cs/ww/es/view/
109762770) se dispone de un bloque de usuario S7 "OpcUaClient" que agrupa las principales
funciones de las instrucciones OPC UA, acelera la implementaci√≥n y simplifica la
programaci√≥n. En el ejemplo act√∫a como servidor OPC UA un controlador S7-1500 con un
programa de simulaci√≥n sencillo para valores de proceso.
El bloque de usuario S7 realiza las funciones siguientes:
‚óè Establecer y deshacer la conexi√≥n con el servidor
‚óè Diagn√≥stico de la conexi√≥n y reconexi√≥n autom√°tica cuando se ha interrumpido la conexi√≥n
‚óè Registered Read
‚óè Registered Write
‚óè Registered Method Call

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1421

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

N√∫mero de instrucciones de cliente utilizables simult√°neamente
Instrucciones de cliente OPC UA utilizables simult√°neamente
Para la utilizaci√≥n simult√°nea de instrucciones del cliente OPC UA se aplican los l√≠mites
siguientes (encontrar√° los datos t√©cnicos de las CPU actualizados diariamente en Internet
(https://support.industry.siemens.com/cs/ww/es/ps/td)):
Tabla 1-105 Capacidades para instrucciones del cliente OPC UA
Instrucci√≥n OPC UA

N√∫mero m√°ximo para

N√∫mero m√°ximo para

N√∫mero m√°ximo para

CPU 1510SP (F)

CPU 1505 (S/SP/SP F/
SP T/SP TF)

CPU 1507S (F)

CPU 1515 (F/T/TF)

CPU 1518 (F)

CPU 1511 (C/F/T/TF)
CPU 1512C
CPU 1512SP (F)

CPU 1515 SP PC (F/T/TF)

CPU 1517 (F/T/TF)

CPU 1513 (F)

CPU 1516 (F/T/TF)

OPC_UA_Connect

4

10

40

OPC_UA_NamespaceGetIn‚Äê
dexList

4*

10*

40*

OPC_UA_NodeGetHandleList

4*

10*

40*

OPC_UA_MethodGetHandle‚Äê
List

4*

10*

40*

OPC_UA_TranslatePathList

4*

10*

40*

OPC_UA_ReadList

20 en total (m√°x. 5 por co‚Äê
nexi√≥n, v√©ase
OPC_UA_Connect)

50 en total (m√°x. 5 por co‚Äê
nexi√≥n, v√©ase
OPC_UA_Connect)

200 en total (m√°x. 5 por cone‚Äê
xi√≥n, v√©ase OPC_UA_Connect)

OPC_UA_WriteList

20 en total (m√°x. 5 por co‚Äê
nexi√≥n, v√©ase
OPC_UA_Connect)

50 en total (m√°x. 5 por co‚Äê
nexi√≥n, v√©ase
OPC_UA_Connect)

200 en total (m√°x. 5 por cone‚Äê
xi√≥n, v√©ase OPC_UA_Connect)

OPC_UA_MethodCall

20 en total (m√°x. 5 por co‚Äê
nexi√≥n, v√©ase
OPC_UA_Connect)

50 en total (m√°x. 5 por co‚Äê
nexi√≥n, v√©ase
OPC_UA_Connect)

200 en total (m√°x. 5 por cone‚Äê
xi√≥n, v√©ase OPC_UA_Connect)

OPC_UA_NodeReleaseHan‚Äê
dleList

4*

10*

40*

OPC_UA_MethodReleaseHan‚Äê 4*
dleList

10*

40*

OPC_UA_Disconnect

4*

10*

40*

OPC_UA_ConnectionGetSta‚Äê
tus

4*

10*

40*

* m√°x. 1 por conexi√≥n

N√∫mero m√°ximo de interfaces de cliente OPC UA utilizables
Al crear interfaces de cliente OPC UA con ayuda de la parametrizaci√≥n de conexiones, el
n√∫mero m√°ximo de interfaces de cliente est√° limitado a 40.
Para crear las interfaces de cliente OPC UA, haga doble clic en el icono "Agregar nueva
interfaz de cliente" de la secci√≥n "Comunicaci√≥n OPC UA" del √°rbol del proyecto.

1422

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El n√∫mero m√°ximo de interfaces de clientes OPC UA depende de si la CPU se utiliza
adicionalmente como servidor OPC UA.

Configuraci√≥n de ejemplo para OPC UA
En los cap√≠tulos siguientes se describe c√≥mo se utilizan el editor para interfaces de cliente y la
parametrizaci√≥n de conexiones.
La descripci√≥n parte de un ejemplo concreto: en la instalaci√≥n operan dos CPU S7-1500: Una
CPU es el cliente OPC UA y la otra, el servidor OPC UA.
Por supuesto, tambi√©n se pueden utilizar controladores, sensores o sistemas TI de otros
fabricantes como clientes o servidores OPC UA. El intercambio de datos entre sistemas
diferentes (interoperabilidad) es precisamente la gran ventaja de OPC UA.

Parametrizaci√≥n de la conexi√≥n con un ejemplo:
La instalaci√≥n fabrica piezas en bruto en una l√≠nea de producci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1423

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Se utilizan los siguientes controladores:
1. El controlador de la l√≠nea de producci√≥n es una CPU S7-1511.
En el ejemplo, el controlador se denomina "Productionline".
El servidor OPC UA del controlador est√° activado.
La CPU tiene en el ejemplo la direcci√≥n IP 192.168.1.1.
Esta CPU publica a trav√©s del servidor OPC UA los valores de las variables siguientes:
‚Äì NewProduct
La variable tiene el tipo de datos "Bool".
Si la variable tiene el valor TRUE, significa que la l√≠nea de producci√≥n ha mecanizado
una pieza en bruto.
La pieza en bruto est√° lista para ser recogida.
‚Äì ProductNumber
Esta variable contiene el n√∫mero de identificaci√≥n de la pieza en bruto.
La variable tiene el tipo de datos "Int".
‚Äì Temperatura
Esta variable contiene los valores de temperatura que se han registrado durante la
fabricaci√≥n de la pieza en bruto.
La variable es una matriz con elementos del tipo de datos "Real".
Esta CPU proporciona asimismo la siguiente variable que permite escritura:
‚Äì ProductionEnabled
La variable es activada por el cliente OPC UA.
La variable tiene el tipo de datos "Bool".
Si est√° activado el valor TRUE, la l√≠nea de producci√≥n est√° habilitada y puede fabricar
piezas en bruto.
Esta CPU proporciona asimismo el siguiente m√©todo a trav√©s del servidor OPC UA:
‚Äì OpenDoor.
Con √©l los clientes OPC UA pueden solicitar que se abra una puerta de acceso a la l√≠nea
de producci√≥n.
2. Una CPU S7-1516 controla la interacci√≥n con otras l√≠neas de producci√≥n.
En el ejemplo, esta CPU se denomina "Supervisor".
El cliente OPC UA de esa CPU est√° activado.
A trav√©s de OPC UA esta CPU puede leer las variables NewProduct y ProductNumber,
activar la variable ProductionEnabled y llamar el m√©todo OpenDoor.
Esta CPU tiene en el ejemplo la direcci√≥n IP 192.168.1.2.
La figura siguiente muestra el ejemplo en la vista de redes del TIA Portal:

1424

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Crear interfaces de cliente
A partir de la versi√≥n 15.1, el TIA Portal dispone de un editor para interfaces de cliente.
En una interfaz de cliente se agrupan todas las variables PLC que el usuario desea leer o
escribir de un servidor OPC UA.
La interfaz de cliente contiene asimismo todos los m√©todos que proporciona el servidor OPC
UA y a los que se puede llamar con el programa de usuario que act√∫a como cliente OPC UA.
Cuando se crea una interfaz de cliente, STEP 7 crea tambi√©n bloques de datos para la
parametrizaci√≥n de la conexi√≥n al servidor OPC UA, del que se leer√°n o en el que se escribir√°n
datos.
N√∫mero m√°ximo de interfaces de cliente
Se puede crear un m√°ximo de 40 interfaces de cliente.

Editor para interfaces de cliente
Para crear una interfaz de cliente, proceda del siguiente modo:
1. Seleccione la vista del proyecto en el TIA Portal.
2. En el √°rea "Dispositivos", seleccione la CPU que desea utilizar como cliente OPC UA.
3. Haga clic en "Comunicaci√≥n OPC UA > Interfaces de cliente".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1425

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Haga doble clic en "Agregar nueva interfaz de cliente".
STEP 7 crea una nueva interfaz de cliente y la muestra en el editor:

STEP 7 llama a la nueva interfaz "Interfaz de cliente_1". Si ya hay una "Interfaz de
cliente_1", la nueva interfaz pasa a denominarse "Interfaz de cliente_2", etc.
STEP 7 crea asimismo los siguientes bloques de datos:
‚Äì Interfaz de cliente_1_Configuration
El bloque de datos ya contiene todos los tipos de datos de sistema que se necesitan
para las instrucciones del cliente OPC UA.
Este bloque de datos se rellena al parametrizar la conexi√≥n al servidor OPC UA.
La conexi√≥n se parametriza en las propiedades de la interfaz de cliente,
v√©ase: Configuraci√≥n de ejemplo para OPC UA (P√°gina 1423).
‚Äì Interfaz de cliente_1_Data
Un bloque de datos para las variables PLC que se quieren leer o escribir de un servidor
OPC UA, as√≠ como m√©todos que se desea llamar en el servidor OPC UA.
Este bloque de datos puede utilizarlo en su programa de usuario.
El bloque de datos est√° vac√≠o actualmente.
5. Seleccione un nombre descriptivo para la nueva interfaz de cliente un nombre.
En el ejemplo se selecciona "Productionline".
En consecuencia, cambian tambi√©n los nombres de los respectivos bloques de datos a:
‚Äì Productionline_Data
‚Äì Productionline_Configuration
6. Para importar una interfaz de servidor OPC UA, haga clic en el bot√≥n "Importar interfaz" de
la parte superior derecha del editor.
Al hacerlo se importa un archivo XML que describe la interfaz de servidor de un servidor
OPC UA.
Alternativa: determinar online la interfaz de servidor de un servidor OPC UA conectado,
ver: Determinar online la interfaz de servidor (P√°gina 1434).

1426

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. STEP 7 muestra un cuadro de di√°logo en el que se selecciona un archivo XML.
Este archivo XML describe el espacio de direcciones de un servidor OPC UA.
El espacio de direcciones de un servidor OPC UA contiene todas las variables PLC y
m√©todos de servidor que publica un servidor OPC UA.
Los clientes OPC UA pueden acceder a este espacio de direcciones para:
- leer variables PLC
- escribir variables PLC
- llamar m√©todos de servidor
El espacio de direcciones de un servidor OPC UA puede estar dividido en una o varias
interfaces de servidor.
Para crear interfaces de servidor, consulte: Crear una interfaz de servidor para la
especificaci√≥n companion (P√°gina 1380).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1427

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
8. Cree una lista de lectura en esta interfaz de cliente.
Para ello, proceda del siguiente modo:
‚Äì Haga clic en la secci√≥n izquierda del editor, en "Agregar nueva lista de lectura"
STEP 7 agrega una nueva lista con el nombre "Read list_1".
En el ejemplo cambie el nombre por "ReadListProduct".
‚Äì A continuaci√≥n agregue a la nueva lista de lectura las variables PLC que desee leer del
servidor OPC UA.
En el ejemplo, a la lista de lectura "ReadListProduct" se han agregado las variables
"NewProduct" y "ProductNumber".
Seleccione la variable "NewProduct" en el campo derecho del editor ("Interfaz del
servidor OPC UA"). Mediante la funci√≥n de arrastrar y colocar, arrastre la variable
"NewProduct" hasta la lista de lectura "ReadProduct" en el campo central del editor.
Proceda de igual manera con la variable "ProductNumber".
La figura siguiente muestra el campo derecho del editor:

Alternativa:
Tambi√©n es posible crear una lista de lectura nueva seleccionando en el campo derecho del
editor ("Interfaz de servidor OPC UA") un nodo de tipo Object o Folder y arrastr√°ndolo luego
con la funci√≥n de arrastrar y colocar a "Agregar nueva lista de lectura" en el campo izquierdo
del editor. Entonces la nueva lista de lectura contiene todas las variables PLC del nodo
arrastrado.
En el ejemplo, seleccione el objeto "Data_for_OPC_UA_Clients", que contiene las variables
"NewProduct" y "ProductNumber". STEP 7 crea la nueva lista de lectura
"Data_for_OPC_UA_Clients". El objeto contiene adem√°s la variable "Temperature". Borre
la variable "Temperature" de la lista de lectura. No debe leerse en el ejemplo.
Cambie el nombre de la lista de lectura por "ReadListProduct".
La figura siguiente muestra el contenido de la lista de lectura:

1428

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Las listas de lectura y escritura no soportan todos los tipos de nodo
El cliente OPC UA de la CPU S7-1500 no soporta todos los tipos de datos OPC UA (tipos
de nodo) que pueden proporcionarse a trav√©s de una interfaz de servidor OPC UA. Si un
tipo de nodo no soportado se coloca en una lista de lectura o escritura, por ejemplo, aparece
un mensaje de error al respecto. En este caso, el nodo correspondiente no puede incluirse
en la lista de lectura o escritura.
Aqu√≠ se describen los tipos que se soportan: Mapeado de tipos de datos (P√°gina 1309)
9. Si desea asignar nuevos valores a las variables PLC, cree una lista de escritura en esta
interfaz de cliente.
Para ello, proceda del siguiente modo:
‚Äì Haga clic en la secci√≥n izquierda del editor, en "Agregar nueva lista de escritura".
STEP 7 agrega una nueva lista con el nombre "Write list_1".
En el ejemplo cambie el nombre por "WriteListStatus".
‚Äì A continuaci√≥n agregue a la nueva lista de escritura todas las variables del servidor OPC
UA a las que desee asignar nuevos valores.
En el ejemplo agregue a la lista de escritura "WriteListStatus" la variable
"ProductionEnabled".
Seleccione la variable en el campo derecho del editor ("Interfaz de servidor OPC UA").
Arrastre la variable con la funci√≥n de arrastrar y colocar hasta la lista de escritura en el
campo central del editor.
Alternativa:
Tambi√©n es posible crear una lista de escritura nueva seleccionando en el campo derecho
del editor ("Interfaz de servidor OPC UA") un nodo de tipo Object o Folder y arrastr√°ndolo
luego con la funci√≥n de arrastrar y colocar a "Agregar nueva lista de escritura" en el campo
izquierdo del editor.
Entonces la nueva lista de escritura contiene todas las variables del nodo.
En el ejemplo, seleccione el objeto "Data_from_OPC_UA_Clients", que contiene la variable
"ProductionEnabled". STEP 7 crea la nueva lista de
escritura"Data_from_OPC_UA_Clients". Cambie el nombre por "WriteListStatus".
La figura siguiente muestra el contenido de la lista de escritura:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1429

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
10.Si desea llamar un m√©todo de este servidor OPC UA, cree una lista de m√©todos nueva.
Para ello, proceda del siguiente modo:
‚Äì Haga clic en la secci√≥n izquierda del editor, en "Agregar nueva lista de m√©todos".
STEP 7 agrega una nueva lista con el nombre "Method list_1".
En el ejemplo cambie el nombre por "MethodListOpenDoor".
‚Äì A continuaci√≥n agregue a la nueva lista de m√©todos un m√©todo del servidor OPC UA.
En este ejemplo agregue el m√©todo "OpenDoor" a la lista de m√©todos
"MethodListOpenDoor".
Seleccione el m√©todo en el campo derecho del editor ("Interfaz de servidor OPC UA").
Arrastre el m√©todo con la funci√≥n de arrastrar y colocar hasta la lista de m√©todos en el
campo central del editor.
Alternativa:
Tambi√©n es posible crear una lista de m√©todos nueva seleccionando en el campo derecho
del editor ("Interfaz de servidor OPC UA") un m√©todo (nodo de tipo Object) y arrastr√°ndolo
luego con la funci√≥n de de arrastrar y colocar a "Agregar nueva lista de m√©todos" en el
campo izquierdo del editor. Entonces la nueva lista de m√©todos contiene el m√©todo del
nodo en cuesti√≥n.
La figura siguiente muestra el contenido de la lista de m√©todos:

Si se desea llamar otro m√©todo del servidor OPC UA, es necesario crear una lista de
m√©todos nueva. Cada lista de m√©todos contiene solo un m√©todo.
Consulte tambi√©n Informaci√≥n importante sobre m√©todos de servidor (P√°gina 1388).
11.Compile el proyecto.
Seleccione para ello el proyecto y luego, en la barra de herramientas, haga clic en el
siguiente s√≠mbolo:

STEP 7 compila el proyecto y actualiza los bloques de datos que pertenecen a la interfaz de
cliente "Productionline".

Nota
Al compilar, STEP 7 sobrescribe todos los datos contenidos en los bloques de datos
pertenecientes a la interfaz de cliente. Por ese motivo no se recomienda completar ni corregir
esos bloques de datos manualmente.

1430

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Nota
Cambiar el nombre de nodo (DisplayNames)
En las listas de lectura, de escritura y de m√©todos es posible cambiar el nombre de un nodo
mediante el men√∫ contextual. En el lenguaje usado en OPC UA se denomina "DisplayName".
Si se cambia el nombre del nodo en una lista de m√©todos y el nodo ya se est√° utilizando en un
bloque programado para la llamada al m√©todo "OPC_UA_MethodCall", al compilar el proyecto
se producir√°n errores de coherencia: Durante la compilaci√≥n se crear√°n de nuevo los UDT del
m√©todo, con el nombre cambiado. Entonces las referencias utilizadas en el programa ya no
coincidir√°n con el m√©todo.
Para solucionar los errores de coherencia es necesario deshacer el cambio de nombre del
m√©todo en la interfaz de cliente, o navegar hasta la llamada del m√©todo y all√≠ asignar de nuevo
los par√°metros pertinentes en "Propiedades > Par√°metros de bloque" (ficha "Configuraci√≥n").

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1431

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Bloques de datos de la interfaz de cliente
Los siguientes bloques de datos pertenecen a la interfaz de cliente "Productionline":
‚óè Productionline_Configuration
Bloque de datos para la configuraci√≥n
En el ejemplo, este bloque de datos se denomina "Productionline_Configuration".
El bloque de datos ya contiene todos los tipos de datos de sistema que se necesitan para
las instrucciones del cliente OPC UA.
El bloque de datos contiene asimismo valores predeterminados generales para
parametrizar la conexi√≥n a un servidor OPC UA.
Este bloque de datos se rellena cuando trabaje con la parametrizaci√≥n de la conexi√≥n.
‚óè Productionline_Data
Bloque de datos para las variables PLC que ha introducido en el editor de interfaces de
cliente.
En el ejemplo, este bloque de datos se denomina "Productionline_Data".
La figura siguiente muestra el bloque de datos.

El bloque de datos "Productionline_Data" se puede utilizar en el programa de usuario y
acceder a los valores le√≠dos de las variables PLC "NewProduct" y "ProductNumber". En la
secci√≥n siguiente se explica esta cuesti√≥n con un ejemplo.

Leer y escribir variables PLC de la interfaz de cliente
Ejemplo: leer el valor "ProductNumber"
En un programa SCL escriba, por ejemplo:

1432

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
#MyLocalVariable :=
"Productionline_Data".ReadListProduct.Variable.ProductNumber;
Con esto asignar√°, p. ej., a la variable local "#MyLocalVariable" el n√∫mero de la pieza en bruto
que se acaba de fabricar en la l√≠nea de producci√≥n.
Requisitos:
‚óè Existe una conexi√≥n al servidor OPC UA de la CPU que controla la l√≠nea de producci√≥n
‚óè El cliente OPC UA ha le√≠do los valores actuales
Debe comprobar, por tanto, si un valor le√≠do es v√°lido:
‚óè Compruebe si el valor de "Productionline_Data".ReadListProduct.NodeStatusList[1] es
igual a 0
‚óè Opcionalmente: Compruebe cu√°ndo ha le√≠do el servidor OPC UA ese valor. Este valor est√°
en "Productionline_Data".ReadProduct.TimeStamps[1]. Si no se solicita ning√∫n sello de
tiempo, la carga de comunicaci√≥n se reduce.
Ejemplo: escribir el valor "ProductEnabled"
Con el bloque de datos se transfieren al servidor OPC UA nuevos valores para las variables
PLC; en el ejemplo, para la variable "ProductionEnabled".
Con la siguiente asignaci√≥n habilita la l√≠nea de producci√≥n en la instalaci√≥n ejemplo:
"Productionline_Data".WriteListStatus.Variable.ProductionEnabled :=
TRUE;
La habilitaci√≥n, no obstante, solo ser√° correcta si se cumplen las siguientes condiciones:
‚óè Existe una conexi√≥n al servidor OPC UA de la CPU que controla la l√≠nea de producci√≥n
‚óè Los valores actuales se escriben a trav√©s del cliente OPC UA

Comprobaci√≥n de coherencia
Para terminar, compruebe la coherencia de la lista de lectura/escritura o de m√©todos.
1. Seleccione la lista que desea comprobar.
2. Haga clic en el bot√≥n "Comprobaci√≥n de coherencia" en el √°rea "Interfaz de cliente OPC
UA".
Si la asignaci√≥n de variables o m√©todos a los elementos correspondientes de la interfaz de
servidor ha transcurrido sin errores, se indica con una marca de verificaci√≥n verde.

Puede presuponerse que el intercambio de datos entre cliente y servidor, as√≠ como las
llamadas a m√©todos, funcionan sin problemas en tiempo de ejecuci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1433

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En caso de error, en la ventana de inspecci√≥n se muestra una lista. Desde esa lista puede
saltarse al error correspondiente.
En la comprobaci√≥n de coherencia STEP 7 comprueba:
‚óè si todos los elementos que se utilizan en la lista correspondiente est√°n tambi√©n en el
servidor
‚óè si los tipos de datos utilizados coinciden
‚óè en m√©todos: si coinciden el n√∫mero, el orden y los tipos de datos de los argumentos de los
m√©todos

Determinar online la interfaz de servidor
STEP 7 (TIA Portal) permite determinar online la interfaz de un servidor OPC UA. De este
modo puede averiguarse qu√© variables de un servidor OPC UA conectado pueden leerse o
activarse (escribirse) con clientes OPC UA. Adem√°s, puede averiguarse qu√© m√©todos de
servidor de los servidores OPC UA est√°n disponibles para clientes OPC UA.
Si se trabaja offline, la interfaz del servidor OPC UA puede crearse mediante un archivo XML
OPC UA. En el archivo XML OPC UA se describe el espacio de direcciones del servidor, ver:
Exportar un archivo XML OPC UA. (P√°gina 1340).

Determinar online las interfaces de servidor
Para determinar online una interfaz de servidor, proceda del siguiente modo:
1. En el √°rbol del proyecto de STEP 7 seleccione la CPU que est√© configurada como cliente
OPC UA (en el ejemplo Supervisor).
2. Seleccione la interfaz de cliente (en el ejemplo Comunicaci√≥n OPC UA > Interfaces de
cliente > ProductionLine).
Si a√∫n no se ha creado ninguna interfaz de cliente, haga doble clic en "Agregar nueva
interfaz de cliente".
3. Haga doble clic en la interfaz de cliente seleccionada.
El editor de interfaces de cliente mostrar√° lo siguiente:

4. En el campo izquierdo del editor haga clic en "Agregar nueva lista de lectura", "Agregar
nueva lista de escritura" o "Agregar nueva lista de m√©todos".

1434

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. En "Origen de los datos del servidor" del campo derecho del editor, seleccione la fuente de
datos "Online[]":
6. Haga clic en el bot√≥n "Accesos online".
STEP 7 muestra el cuadro de di√°logo "Conectar a servidor OPC UA":

Sugerencia: La primera vez que se establece una conexi√≥n online con un servidor OPC UA
debe utilizarse el bot√≥n "Accesos online". Cuando vuelva a establecer la conexi√≥n despu√©s
de que esta se haya desconectado, elija el bot√≥n "Conectar al servidor online", situado junto
al campo de selecci√≥n "Online".
En la parte superior derecha introduzca la direcci√≥n IP del servidor OPC UA cuya interfaz
desea determinar online.
7. Haga clic en el bot√≥n "Descubrir el servidor seleccionado".
STEP 7 establece una conexi√≥n con el servidor OPC UA y determina todos los ajustes de
seguridad (puntos finales del servidor) que proporciona el servidor.
STEP 7 muestra los puntos finales en una lista:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1435

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
8. Haga clic en el punto final que desee utilizar para la conexi√≥n de STEP 7 al servidor OPC
UA.
9. ¬øDesea utilizar una conexi√≥n segura?
‚Äì Si ha seleccionado un punto final seguro, en "Ubicaci√≥n del certificado" elija la entrada
"TIA Portal".
Y en "Certificado (cliente)" seleccione un certificado de cliente para el PC en el que se
est√° ejecutando STEP 7 (TIA Portal).
Si a√∫n no hay ning√∫n certificado de cliente en el PC, aqu√≠ podr√° generar uno en TIA
Portal.
Para crear un certificado para el PC, proceda del siguiente modo:
- Haga clic en el bot√≥n del campo de entrada "Certificado (cliente)".
- Haga clic en el bot√≥n "Agregar".
- En "Titular del certificado" indique "STEP 7 (TIA Portal)".
- En "Finalidad de uso", seleccione la entrada "Cliente OPC UA".
- En "Nombre alternativo del propietario del certificado (SAN)" indique en "Valor" la
direcci√≥n IP del PC en el que se est√° ejecutando STEP 7 (TIA Portal). Sobrescriba la
direcci√≥n IP que aparece.
- Si el PC utiliza una segunda direcci√≥n IP, ind√≠quela tambi√©n. Si el PC no utiliza una
segunda direcci√≥n IP, borre la segunda direcci√≥n IP que aparece registrada.
- Haga clic en el bot√≥n "Aceptar".
‚Äì Si no ha seleccionado un punto final seguro, deje el ajuste predeterminado ("Ninguno").
10.¬øC√≥mo desea iniciar sesi√≥n?
‚Äì Si desea iniciar sesi√≥n como invitado en el servidor OPC UA, acepte el ajuste
predeterminado de "Autenticaci√≥n de usuario".
‚Äì Si desea iniciar sesi√≥n con nombre de usuario y contrase√±a, seleccione "Nombre de
usuario y contrase√±a".
Utilice el nombre de usuario y la contrase√±a depositados al configurar el servidor OPC
UA, en las propiedades de la CPU, en "General > OPC UA > Servidor > Seguridad >
Autenticaci√≥n de usuario > Administraci√≥n de usuarios".
11.Haga clic en el bot√≥n "Conectar".
En una conexi√≥n segura aparece adem√°s un mensaje indic√°ndole que debe aceptar el
certificado de servidor para que la conexi√≥n segura pueda establecerse. La ventana del
mensaje contiene un enlace a trav√©s del cual puede visualizar los detalles adicionales
sobre el certificado de servidor.
Esta ventana est√°ndar de Windows solo proporciona informaci√≥n sobre el certificado de
servidor. Pero si se hace clic en el bot√≥n para la instalaci√≥n del certificado de servidor, este
no se guardar√° en la memoria de certificados de TIA Portal, de modo que en el siguiente
intento de conexi√≥n se solicitar√° de nuevo aceptar el certificado de servidor.
A continuaci√≥n STEP 7 establece una conexi√≥n con el servidor OPC UA y muestra de
nuevo el editor de interfaces de cliente.
STEP 7 muestra en el campo derecho del editor el nivel superior del espacio de direcciones
del servidor OPC UA:
12.Haga clic en el peque√±o tri√°ngulo negro que hay junto a "Objects".
STEP 7 mostrar√° tambi√©n el nivel situado por debajo de Objects.

1436

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
13.Haga clic en el peque√±o tri√°ngulo negro que hay junto a "Productionline".
STEP 7 mostrar√° tambi√©n el nivel situado por debajo de Productionline.
14.A continuaci√≥n abra otras carpetas subordinadas:

Consulte tambi√©n
Mapeado de tipos de datos (P√°gina 1309)
Crear interfaces de cliente (P√°gina 1425)

Uso de textos multiling√ºes
En el editor de interfaces de cliente, con los archivos XML OPC UA (modelos de informaci√≥n)
pueden importarse textos que se muestren en distintos idiomas. El multiling√ºismo es opcional:
cada nodo (Node) puede definirse de forma diferente seg√∫n los idiomas disponibles.
En el archivo XML existen los siguientes campos que pueden estar preparados para distintos
idiomas:
‚óè DisplayName
‚óè Description
Ejemplo de textos multiling√ºes en un archivo XML OPC UA
En el archivo XML representado, los campos Displayname y Description contienen tanto un
texto predeterminado "Default" como varios textos localizados.
‚óè El texto predeterminado es en cada caso la primera entrada sin informaci√≥n de localizaci√≥n
‚óè El texto localizado es el texto que aparece detr√°s de "Locale=" seguido de una abreviatura
de idioma; p. ej., "it-IT" para italiano

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1437

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Visualizaci√≥n de textos multiling√ºes
Al importar una interfaz de servidor, los textos multiling√ºes disponibles se guardar√°n
internamente y se cargar√°n con el proyecto en una CPU.
El editor de cliente muestra el texto del archivo XML OPC UA en las columnas "Nombre del
nodo" (que se corresponde con "DisplayName") y "Descripci√≥n" (que se corresponde con
"Description").
Los idiomas que se muestran para un nodo dependen de las siguientes reglas en cascada:
‚óè Si el nodo contiene texto en el idioma de edici√≥n que se est√° usando, el texto se mostrar√°
tambi√©n en el idioma de edici√≥n.
(Ajuste del idioma de edici√≥n: en el √°rbol del proyecto, seleccione el √°rea "Idiomas y
recursos > Idiomas del proyecto").
‚óè Si el nodo no contiene texto en el idioma de edici√≥n, pero se ha definido un texto
predeterminado (sin abreviatura de idioma), se mostrar√° el texto predeterminado.
‚óè Columna "Nombre del nodo": Si tampoco se ha definido un texto predeterminado, pero s√≠
un texto en cualquier otro idioma, se mostrar√° el texto de DisplayName en el primer idioma
disponible. Esta regla no se aplica para textos de la descripci√≥n.
‚óè Si no se cumple ninguna de las condiciones anteriores, no se mostrar√° ning√∫n texto.

Si cambia el idioma de edici√≥n, cambiar√° tambi√©n el texto multiling√ºe en la interfaz importada
conforme a las reglas descritas anteriormente.
Despu√©s, los nodos pueden importarse en las listas correspondientes (lista de lectura, lista de
escritura, lista de m√©todos) mediante arrastrar y soltar.
En las listas (lista de lectura, lista de escritura, lista de m√©todos) no es posible cambiar el
idioma.

1438

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Aplicaci√≥n del texto de descripci√≥n mostrado como comentario en los tipos de datos PLC
Al compilar el programa, STEP 7 crea autom√°ticamente tipos de datos PLC (UDT) para cada
lista de lectura, para cada lista de escritura y para las entradas o salidas de cada m√©todo. Estos
UDT tienen un elemento por cada nodo.
Los UDT aplican el texto de descripci√≥n como comentario de acuerdo con las reglas anteriores.
STEP 7 crea el comentario en un solo idioma, del mismo modo que los textos solo se pueden
mostrar en un idioma en la interfaz del servidor OPC UA.

Reglas de acceso a estructuras
A continuaci√≥n se explican las reglas de acceso a estructuras. Tenga en cuenta estas reglas
al leer y escribir valores de estructuras completas que est√©n disponibles en un servidor OPC
UA.

C√≥mo accede a estructuras el cliente de la CPU S7-1500
Para acceder de modo eficiente a estructuras en tiempo de ejecuci√≥n, el cliente OPC UA de la
CPU S7-1500 no utiliza ni TypeDictionaries ni atributos DataTypeDefinition ofrecidos por un
servidor para resolver dichas estructuras.
Por este motivo el cliente OPC UA tiene posibilidades limitadas de comprobar elementos de
estructuras en tiempo de ejecuci√≥n del programa de usuario en el cliente.

Reglas de acceso a estructuras
Si para configurar las listas de lectura y de escritura se utilizan interfaces de cliente
(parametrizaci√≥n de conexiones) y los tipos de datos PLC se asignan adecuadamente al
modelo de direcciones importado o determinado online del servidor, entonces los accesos de
lectura y escritura a estructuras funcionan sin problemas en tiempo de ejecuci√≥n.
Ello es debido a que la configuraci√≥n mediante interfaz de cliente se encarga autom√°ticamente
de que el orden y los tipos de datos de los elementos de las estructuras sean coherentes entre
s√≠ en el cliente y en el servidor.
Recomendaci√≥n: Actualice una CPU S7-1500 (como servidor) a la versi√≥n de firmware actual
(p. ej. V2.0 > V2.5.2 o superior).
El cliente OPC UA solo comprueba en tiempo de ejecuci√≥n la longitud total del valor
transferido; no es posible realizar comprobaciones m√°s detalladas.
Para la asignaci√≥n de estructuras OPC UA a variables PLC o variables DB se aplican las reglas
de mapeo (ver Mapeado de tipos de datos (P√°gina 1309)). No se soportan los tipos de datos
que no se han indicado (p. ej. ByteStrings OPC UA).
Ejemplo de una asignaci√≥n correcta de elementos de estructuras
En el archivo Nodeset (exportaci√≥n XML) importado la estructura est√° definida del modo
siguiente:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1439

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

La estructura representada en la lista de lectura coincide con el nodo correspondiente del
archivo Nodeset tanto en el orden como en los tipos de datos asignados.

Si se cambia la estructura en el servidor, p. ej. se intercambian varA y varB, y la lista de lectura
permanece igual en el cliente, la asignaci√≥n ya no ser√° correcta:
‚óè La longitud total de los datos permanece igual (solo ha cambiado el orden)
‚óè La organizaci√≥n de la estructura es distinta en el cliente y en el servidor
ADVERTENCIA
No hay mensaje de error cuando la organizaci√≥n de la estructura es distinta en el cliente y en
el servidor
Si las estructuras de cliente y servidor no coinciden, es posible que esta violaci√≥n de la regla
no genere ning√∫n mensaje ni al compilar ni en tiempo de ejecuci√≥n.
Aseg√∫rese de que las asignaciones configuradas para las estructuras no cambien durante el
tiempo de ejecuci√≥n. Si es necesario, configure de nuevo la asignaci√≥n en las listas de lectura
y de escritura.

Uso de la parametrizaci√≥n de la conexi√≥n
Crear y parametrizar conexiones
Con las instrucciones para clientes OPC UA se puede crear un programa de usuario que
intercambie datos con un servidor OPC UA. Para ello se requiere una serie de tipos de datos
de sistema.

1440

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
A partir de la versi√≥n 15.1, STEP 7 (TIA Portal) dispone de una parametrizaci√≥n de la conexi√≥n
para clientes OPC UA que facilita el trabajo con estos tipos de datos de sistema.
La parametrizaci√≥n de la conexi√≥n es una opci√≥n que se puede utilizar, pero no es obligatorio.
Los tipos de datos de sistema necesarios se pueden crear tambi√©n manualmente.
Para que la descripci√≥n sea m√°s comprensible, utilizamos un ejemplo; ver Descripci√≥n del
ejemplo (P√°gina 1423).

Abrir la parametrizaci√≥n de la conexi√≥n
Para parametrizar la conexi√≥n a un servidor OPC UA, proceda del siguiente modo:
1. En la secci√≥n "Comunicaci√≥n OPC UA" del √°rbol del proyecto, haga doble clic en la interfaz
de cliente que desee parametrizar.
Para la configuraci√≥n de ejemplo: Haga doble clic en la interfaz de cliente "Productionline":

En el cap√≠tulo "Creaci√≥n de una interfaz de cliente (P√°gina 1425)" se explica c√≥mo crear
una interfaz de cliente.
2. Haga clic en la ficha "Propiedades" (ventana de inspecci√≥n), si a√∫n no se ha abierto.
STEP 7 muestra la parametrizaci√≥n de la conexi√≥n para las instrucciones del cliente OPC
UA.
La ficha "General" est√° abierta.
3. Haga clic en la ficha "Configuraci√≥n" y configure la conexi√≥n con el servidor OPC UA.

Ajuste de los par√°metros de conexi√≥n
1. Seleccione un nombre representativo para la sesi√≥n. Seleccione para el ejemplo el nombre
"OPC UA Connection to Productionline".
2. En el campo "Direcci√≥n", introduzca la direcci√≥n IP del servidor OPC UA al que deba
conectarse el programa de usuario que funcione como cliente OPC UA. En la configuraci√≥n
de ejemplo, la CPU que controla la l√≠nea de producci√≥n tiene la direcci√≥n IP "192.168.1.1".
Desea establecer una conexi√≥n al servidor OPC UA de esa CPU, por lo que debe introducir
esta direcci√≥n IP en el campo "Direcci√≥n". En este caso, el servidor OPC UA utiliza el puerto
est√°ndar 4840.
Tambi√©n es posible introducir un nombre de DNS v√°lido en el campo "Direcci√≥n". La
longitud del nombre DNS est√° limitada a 242 caracteres.
Si la direcci√≥n no es v√°lida, se muestra el mensaje de error: "Introduzca una direcci√≥n
v√°lida".
Si la secuencia de los campos "Direcci√≥n", "Puerto" y "Ruta" ocupa m√°s de 254 caracteres,
tambi√©n se muestra un mensaje de error.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1441

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Introduzca una ruta del servidor OPC UA para limitar el acceso a dicha ruta. La indicaci√≥n
es opcional. Sin embargo, algunos servidores solo establecen una conexi√≥n si se ha
indicado una ruta de servidor.
Si se indica una ruta, esta se introduce autom√°ticamente en la entrada "ServerEndpointUrl"
del DB de configuraci√≥n para la interfaz de cliente. En ese caso, la entrada se compone de
los elementos "Prefijo de esquema OPC", "Direcci√≥n IP", "N√∫mero de puerto" y "Ruta de
servidor", p. ej.: "opc.tcp://192.168.0.10:4840/ejemplo/ruta".
La figura siguiente muestra la entrada de la direcci√≥n IP del servidor OPC UA:

4. Si el servidor OPC UA no utiliza el puerto est√°ndar 4840, tendr√° que insertar aqu√≠ el n√∫mero
de puerto.
Introduzca en el campo, por ejemplo, el n√∫mero 65535 si el servidor OPC UA con el que
desea establecer una conexi√≥n utiliza ese n√∫mero de puerto.
5. Aplique asimismo los ajustes predeterminados para "Timeout de sesi√≥n" (30 segundos) y
"Tiempo de vigilancia" (5 segundos).

Ajuste de los par√°metros de seguridad
1. En la secci√≥n "Seguridad", haga clic en la ficha "Configuraci√≥n".
En esta secci√≥n se encuentran todos los ajustes de seguridad para la conexi√≥n con el
servidor OPC UA.
Son posibles los siguientes ajustes:
√Årea "General"
Modo de seguridad:
En la lista desplegable, seleccione el modo de seguridad que debe cumplir la conexi√≥n al
servidor OPC UA.
Si el servidor no cumple el modo seleccionado, no se establecer√° ninguna sesi√≥n.

1442

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Se pueden elegir los siguientes ajustes:
‚óè Ninguna seguridad: ¬°conexi√≥n no segura!
‚óè Firmar: servidor y cliente OPC UA firman la transferencia de datos (todos los mensajes), de
esta forma de detectan posibles manipulaciones.
‚óè Firmar y cifrar: servidor y cliente OPC UA firman y cifran la transferencia de datos (todos los
mensajes).
Security Policy:
Ajuste las t√©cnicas de cifrado para la firma y cifrado de mensajes.
Son posibles los siguientes ajustes:
‚óè Ninguna seguridad
‚óè Basic128Rsa15
‚óè Basic256
‚óè Basic256Sha256
Si configura una conexi√≥n segura, deber√° tener en cuenta los siguientes puntos:
‚óè Una conexi√≥n segura precisa un certificado para el cliente.
‚óè Este certificado del cliente debe darse a conocer al servidor.
El procedimiento correspondiente se describe en el cap√≠tulo "Manejo de certificados de cliente
y de servidor (P√°gina 1348)", en "Certificado del cliente OPC UA".
√Årea "Certificado"
Certificado de cliente:
El certificado confirma la autenticidad del cliente OPC UA.
Para seleccionar un certificado, haga clic en el siguiente s√≠mbolo:

STEP 7 muestra una lista con certificados.
Seleccione el certificado que ha dado a conocer al servidor.
Haga clic en el s√≠mbolo con la marca de verificaci√≥n verde:

O genere un certificado nuevo. Para ello haga clic en el s√≠mbolo "Agregar".
Si crea un nuevo certificado, deber√° dar a conocer este nuevo certificado al servidor.
√Årea "Autenticaci√≥n de usuario"
En la autenticaci√≥n de usuario son posibles los siguientes ajustes:
‚óè Invitado
‚óè Nombre de usuario y contrase√±a
‚óè Usuario (TIA Portal - Ajustes de seguridad)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1443

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Encontrar√° m√°s informaci√≥n al respecto en Usuarios y roles con derechos de funci√≥n OPC UA
(P√°gina 1359).

Ajuste del idioma
Las variables UA de tipo String se pueden localizar en OPC UA; es decir, los textos (valores de
las variables UA) pueden estar en distintos idiomas en el servidor. Por ejemplo, para
DisplayName (nombre del nodo) y Description (descripci√≥n) puede haber textos localizados.
En el √°rea "Idiomas" de la ficha "Configuraci√≥n" puede condicionar el idioma de los textos que
devuelve el servidor de la siguiente forma:
En el √°rea "Idiomas", indique el orden de idiomas que el servidor transmitir√° al cliente cuando
se establezca la conexi√≥n.
El idioma o el ID local asociado a √©l ("abreviatura de idioma") que introduzca en la primera fila
ser√° el idioma preferido por el cliente.
‚óè Si el servidor puede suministrar la variable UA en el idioma deseado, esta se transmitir√° al
cliente.
‚óè Si el servidor no puede suministrar la variable UA en el idioma deseado, comprobar√° si
puede suministrar la variable UA en el idioma que haya introducido en la segunda fila
(primer idioma alternativo).
‚óè El servidor sigue procesando la lista de este modo. En caso de que no pueda suministrar
ni el idioma deseado ni ning√∫n idioma alternativo, suministrar√° el idioma predeterminado.

Consulte tambi√©n
Tratamiento de los certificados de cliente de la CPU S7-1500 (P√°gina 1444)

Tratamiento de los certificados de cliente de la CPU S7-1500
¬øDe d√≥nde proviene el certificado del cliente?
Si utiliza el cliente OPC UA de una CPU S7-1500 (cliente OPC UA activado), podr√° crear
certificados para estos clientes con STEP 7 a partir de la versi√≥n V15.1, tal como se describe
en los apartados siguientes.
Si utiliza clientes UA de fabricantes o de la OPC Foundation, durante la instalaci√≥n o la primera
llamada del programa se crea autom√°ticamente un certificado de cliente. Estos certificados
deben importarse a STEP 7 mediante el administrador global de certificados y utilizarse para
la CPU en cuesti√≥n.

1444

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si el propio usuario programa un cliente OPC UA, puede generar certificados mediante
t√©cnicas de programaci√≥n. Tambi√©n es posible generar certificados usando herramientas, por
ejemplo OpenSSL o el generador de certificados de la OPC Foundation:
‚óè Consulte c√≥mo proceder con OpenSSL aqu√≠: "Autogeneraci√≥n de parejas de claves PKI y
de certificados (P√°gina 1318)".
‚óè Consulte c√≥mo trabajar con el generador de certificados de la OPC Foundation aqu√≠: "Crear
certificados autofirmados (P√°gina 1317)".

Certificado del cliente OPC UA de la CPU S7-1500
Solo se produce una conexi√≥n segura entre el servidor OPC UA y un cliente OPC UA si el
servidor considera que el certificado del cliente es de confianza.
Para ello, el certificado del cliente debe darse a conocer al servidor.
Los apartados siguientes describen la forma de crear primero un certificado para el cliente
OPC UA de la CPU S7-1500 y ponerlo a disposici√≥n del servidor a continuaci√≥n.

1. Generar y exportar un certificado para el cliente
Para una conexi√≥n segura hay que crear un certificado de cliente y, si el servidor y el cliente se
encuentran en proyectos diferentes, exportarlo.
Si el cliente y el servidor se encuentran en el mismo proyecto, no es necesario exportar e
importar luego el certificado de cliente.
Requisitos
La interfaz IP de la CPU est√° configurada y hay una direcci√≥n IP.
Explicaci√≥n: En "Nombre alternativo del propietario del certificado (SAN)" se especifican las
direcciones IP con las que se accede a la CPU en la instalaci√≥n.
Crear un certificado de cliente OPC UA
La forma m√°s sencilla de generar un certificado de cliente para una CPU S7-1500 es
configurando una interfaz de cliente.
Para poder configurar la interfaz de cliente es necesario seleccionar o generar un certificado
de cliente; consulte Crear y parametrizar conexiones (P√°gina 1440).
Tambi√©n es posible crear el certificado de cliente del siguiente modo:
1. En el "√Årbol del proyecto", seleccione la CPU que act√∫a de cliente.
2. Haga doble clic en "Configuraci√≥n de dispositivos".
3. En las propiedades de la CPU haga clic en "Protecci√≥n y seguridad > Administrador de
certificados".
4. Haga doble clic en "<agregar nuevo>" en la tabla "Certificados de dispositivo".
STEP 7 abre un cuadro de di√°logo.
5. Haga clic en el bot√≥n "Agregar".
6. En "Finalidad de uso", seleccione la entrada "Cliente OPC UA" de la lista.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1445

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. Haga clic en "Aceptar".
STEP 7 muestra el certificado de cliente en la tabla "Certificados de dispositivo".
8. Si el servidor se encuentra en otro proyecto: Haga clic con el bot√≥n derecho del rat√≥n en
esta fila y elija el men√∫ contextual "Exportar certificado".
9. Seleccione un directorio para guardar el certificado de cliente.

2. Dar a conocer el certificado del cliente al servidor
Para poder establecer una conexi√≥n segura es necesario poner el certificado del cliente a
disposici√≥n del servidor.
Para ello, proceda del siguiente modo:
1. Si el cliente se ha configurado en otro proyecto y ha creado y exportado el certificado de
cliente en √©l:
‚Äì Active la opci√≥n "Utilizar ajustes globales de seguridad para el administrador de
certificados" en el administrador local de certificados del servidor. De este modo est√°
disponible el administrador global de certificados.
Encontrar√° esta opci√≥n en las propiedades de la CPU que hace de servidor, en
"Protecci√≥n y seguridad > Administrador de certificados".
‚Äì Si el proyecto a√∫n no est√° protegido, en "Ajustes de seguridad > Ajustes" del √°rbol del
proyecto de STEP 7 haga clic en el bot√≥n "Proteger este proyecto" e inicie sesi√≥n.
En el √°rbol del proyecto de STEP 7 aparece la entrada "Ajustes globales de seguridad"
en "Ajustes de seguridad".
‚Äì Haga doble clic en "Ajustes globales de seguridad".
‚Äì Haga doble clic en "Administrador de certificados".
STEP 7 abre el administrador global de certificados.
‚Äì Haga clic en la ficha "Certificados de dispositivo".
‚Äì Haga clic con el bot√≥n derecho del rat√≥n en un √°rea vac√≠a de la ficha (no en un
certificado).
‚Äì Elija el men√∫ contextual "Importar".
Se abre el cuadro de di√°logo para importar certificados.
‚Äì Seleccione el certificado de cliente en el que debe confiar el servidor.
‚Äì Haga clic en el bot√≥n "Abrir" para importar el certificado.
El certificado del cliente est√° ahora guardado en el administrador global de certificados.
Tome nota de la ID del certificado de cliente que acaba de importar.
2. A continuaci√≥n haga clic en la ficha "General" de las propiedades de la CPU que hace de
servidor.
3. Haga clic en el √°rea "OPC UA > Servidor > Seguridad > Secure Channel".
4. Despl√°cese hacia abajo en el cuadro de di√°logo "Secure Channel" (canal seguro) hasta la
secci√≥n "Clientes de confianza".
5. En la tabla, haga doble clic en la fila vac√≠a "<agregar nuevo>". En la fila se muestra un bot√≥n
con tres puntos.
6. Haga clic en dicho bot√≥n.

1446

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. Seleccione el certificado de cliente preparado.
8. Haga clic en el bot√≥n con la marca de verificaci√≥n verde.
9. Compile el proyecto.
10.Cargue la configuraci√≥n en la CPU S7-1500 (servidor).

Resultado
El servidor ahora conf√≠a en el cliente. Si, adem√°s, el certificado de servidor se considera de
confianza, servidor y cliente podr√°n establecer una conexi√≥n segura.

Autenticaci√≥n del usuario
En la interfaz de cliente OPC UA de S7-1500 puede ajustarse c√≥mo debe legitimarse un
usuario del cliente OPC UA que desee acceder al servidor. Para ello, en el √°rbol del proyecto
de la CPU S7-1500 deseada, debe seleccionarse la interfaz de cliente correspondiente en
"Comunicaci√≥n OPC UA > Interfaces de cliente" y el tipo de autenticaci√≥n del usuario en la
ventana de inspecci√≥n, en "Propiedades > Configuraci√≥n > Seguridad".

Tipos de autenticaci√≥n del usuario
Existen las siguientes opciones para la autenticaci√≥n del usuario:
‚óè Invitado
El usuario no tiene que demostrar que tiene permiso (acceso an√≥nimo). Con este fin, la
CPU crea una sesi√≥n an√≥nima para el usuario y el servidor OPC UA no comprueba el
permiso del usuario del cliente.
‚óè Nombre de usuario y contrase√±a
El usuario tiene que demostrar que tiene permiso (acceso no an√≥nimo). El servidor OPC UA
comprueba si el usuario cliente est√° autorizado a acceder al servidor. Como prueba sirven
el nombre de usuario con la contrase√±a correcta. Estas entradas no pueden ser verificadas
por la interfaz de cliente, por lo que en este caso todos los valores se aceptan como v√°lidos.
Nota
STEP 7 guarda el nombre de usuario y la contrase√±a sin cifrar en el bloque de datos o el
bloque de datos de instancia. Recomendaci√≥n: Utilice la autenticaci√≥n de usuario "Usuario
(TIA Portal - configuraci√≥n de seguridad)".
‚óè Usuario (TIA Portal - Ajustes de seguridad)
Para la autenticaci√≥n, puede introducir un nombre de usuario de la lista de usuarios
registrados en el proyecto. El nombre del usuario registrado en el proyecto actual puede
consultarse en la administraci√≥n de usuarios en el √°rbol del proyecto, en "Ajustes de
seguridad > Usuarios y funciones". Aqu√≠ tambi√©n existe la posibilidad de registrar otros
usuarios.
Tambi√©n puede introducir un nombre que no exista en la administraci√≥n de usuarios del
proyecto o dejar el campo vac√≠o. Esto es necesario cuando el nombre de usuario
correspondiente se reciba de otra fuente en tiempo de ejecuci√≥n, por ejemplo, de HMI o de
otro cliente OPC UA.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1447

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Security Policy "Ninguna seguridad" y autenticaci√≥n mediante nombre de usuario y contrase√±a
Se pueden configurar las combinaciones siguientes:
Security Policy = "Ninguna seguridad" y autenticaci√≥n mediante nombre de usuario y
contrase√±a.
‚óè El servidor OPC UA de S7-1500 soporta esta combinaci√≥n. Los clientes OPC UA pueden
conectarse y cifrar o no cifrar los datos de autenticaci√≥n.
‚óè El cliente OPC UA de la CPU S7-1500 tambi√©n soporta esta combinaci√≥n: pero en tiempo
de ejecuci√≥n solo se conecta si a trav√©s de la l√≠nea puede transferir los datos de
autenticaci√≥n cifrados.
Resultado: Con la configuraci√≥n siguiente no se puede establecer ninguna conexi√≥n en tiempo
de ejecuci√≥n:
‚óè S7-1500 como cliente OPC UA
‚óè Servidor OPC UA que con la Security Policy "Ninguna seguridad" (= "none") no soporta el
cifrado de los datos de autenticaci√≥n

Consulte tambi√©n
Usuarios y roles con derechos de funci√≥n OPC UA (P√°gina 1359)

Utilizar una conexi√≥n parametrizada
Introducci√≥n
Este cap√≠tulo describe c√≥mo utilizar una conexi√≥n parametrizada en las instrucciones OPC UA
(Tercer paso).

Requisitos
‚óè Se ha creado una interfaz de cliente y se han agregado variables y m√©todos PLC a esa
interfaz; ver ("Primer paso (P√°gina 1425)").
‚óè Se ha parametrizado una conexi√≥n a un servidor OPC UA (Segundo paso (P√°gina 1440)).

Sinopsis
Para leer datos de un servidor OPC UA o escribir datos en un servidor OPC UA, deben
utilizarse las siguientes instrucciones:
‚óè OPC_UA_Connect
‚óè OPC_UA_NamespaceGetIndexList
‚óè OPC_UA_NodeGetHandleList
‚óè OPC_UA_ReadList o bien OPC_UA_WriteList
‚óè OPC_UA_NodeReleaseHandleList
‚óè OPC_UA_Disconnect

1448

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Secuencia de las instrucciones OPC UA
La siguiente figura muestra la secuencia en la que se llama a las instrucciones OPC UA en un
programa de usuario para, con ellas, leer o escribir variables PLC:





23&B8$B'LVFRQQHFW

23&B8$B&RQQHFW
23&B8$B1DPHVSDFH*HW,QGH[/LVW
23&B8$B1RGH*HW+DQGOH/LVW

23&B8$B5HDG/LVW
23&B8$B:ULWH/LVW

‚ë†
‚ë°
‚ë¢

23&B8$B1RGH5HOHDVH+DQGOH/LVW

Instrucciones para preparar las operaciones de lectura y escritura
Instrucciones de lectura y escritura
Instrucciones para "Clean-up" una vez ejecutadas las operaciones de lectura o escritura
La instrucci√≥n "OPC_UA_NodeReleaseHandleList" se puede suprimir si inmediatamente des‚Äê
pu√©s se llama a "OPC_UA_Disconnect".

STEP 7 (TIA Portal) asigna autom√°ticamente valores a los par√°metros de estas instrucciones
si se utilizan una interfaz de cliente y una conexi√≥n parametrizada con un servidor OPC UA.
El procedimiento para ello se describe en el siguiente cap√≠tulo.

Utilizar una interfaz de cliente y una conexi√≥n parametrizada
Para utilizar una conexi√≥n OPC UA parametrizada, proceda del siguiente modo:
1. Abra su programa de usuario en el TIA Portal.
2. Arrastre la instrucci√≥n "UA_Connect" al editor de programas con Drag&Drop.
Encontrar√° la instrucci√≥n en "Instrucciones > Comunicaci√≥n > OPC UA" en el TIA Portal.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1449

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Seleccione una opci√≥n de llamada para la instrucci√≥n.
En el ejemplo se utiliza una multiinstancia.
STEP 7 representa la instrucci√≥n en el editor de programas.
El editor del lenguaje de programaci√≥n Diagrama de funciones (FUP) utiliza la siguiente
representaci√≥n:

El editor para el lenguaje de programaci√≥n Esquema de contactos (KOP) muestra la
instrucci√≥n de forma similar.
4. En el editor para FUP o KOP, haga clic en el s√≠mbolo de la caja de herramientas.
El s√≠mbolo se encuentra en el encabezado de la instrucci√≥n:

Si utiliza el editor para AWL o SCL: Haga clic en el peque√±o rect√°ngulo verde debajo del
primer car√°cter del nombre de la instancia:

En el ejemplo (P√°gina 1423) se utiliza "#OPC_UA_Connect_Instance" como nombre de la
instancia.
STEP 7 presenta ahora las propiedades de la instrucci√≥n en un cuadro de di√°logo propio.

1450

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. En "Client interface", seleccione la interfaz de cliente que desea utilizar para la instrucci√≥n.
En el ejemplo seleccionamos la interfaz de cliente "ProductionLine".
STEP 7 interconecta ahora la interfaz de cliente "ProductionLine" con los par√°metros de la
instrucci√≥n OPC_UA_Connect:

"ProductionLine" es la interfaz que utiliza el cliente OPC UA del ejemplo (P√°gina 1423) para
el intercambio de datos con el servidor OPC UA "ProductionLine".
6. Arrastre la instrucci√≥n "UA_NamespaceGetIndexList" al editor de programas con
Drag&Drop.
Encontrar√° la instrucci√≥n en "Instrucciones > Comunicaci√≥n > OPC UA" en el TIA Portal.
Seleccione la opci√≥n de llamada "Multiinstancia".
Haga clic en el s√≠mbolo de la caja de herramientas (KOP y FUP) o en la casilla de
verificaci√≥n verde debajo del nombre de la instancia (AWL y SCL) si el editor a√∫n no se ha
abierto.
Seleccione la interfaz de cliente que desea utilizar (en el ejemplo, "ProductionLine").
STEP 7 interconecta ahora autom√°ticamente todos los par√°metros de la instrucci√≥n
"OPC_UA_NamespaceGetIndexList":

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1451

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. Arrastre la instrucci√≥n "UA_NodeGetHandleList" al editor de programas con Drag&Drop.
Seleccione la opci√≥n de llamada "Multiinstancia".
Haga clic en el s√≠mbolo de la caja de herramientas (KOP y FUP) o en la casilla de
verificaci√≥n verde debajo del nombre de la instancia (AWL y SCL) si el editor a√∫n no se ha
abierto.
Seleccione la interfaz de cliente que desee utilizar. En el ejemplo se utiliza la interfaz de
cliente "ProductionLine".
En "Data access > Read/Writelist", seleccione la lista de lectura que desee utilizar (en el
ejemplo, la lista de lectura "Product").
STEP 7 interconecta ahora autom√°ticamente todos los par√°metros de la instrucci√≥n
"OPC_UA_NodeGetHandleList":

1452

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si desea escribir datos en un servidor OPC UA, seleccione la lista de escritura que desea
utilizar en "Data access > Read/Writelist" (en el ejemplo, la lista de escritura
"ProductionStatus").
8. Arrastre la instrucci√≥n "UA_ReadList" al editor de programas con Drag&Drop.
Seleccione la opci√≥n de llamada "Multiinstancia".
Haga clic en el s√≠mbolo de la caja de herramientas (KOP y FUP) o en la casilla de
verificaci√≥n verde debajo del nombre de la instancia (AWL y SCL) si el editor a√∫n no se ha
abierto.
Seleccione la interfaz de cliente que desee utilizar. En el ejemplo se utiliza la interfaz de
cliente "ProductionLine".
En "Data access > Readlist", seleccione la lista de lectura que desee utilizar (en el ejemplo,
la lista de lectura "Product").
STEP 7 interconecta ahora autom√°ticamente todos los par√°metros de la instrucci√≥n
"OPC_UA_ReadList":
Si desea escribir datos en un servidor OPC UA, utilice la instrucci√≥n "OPC_UA_Write" y en
"Data access > Writelist" seleccione la lista de variables que desee enviar al servidor (en el
ejemplo, la lista de escritura "ProductionStatus").
9. Si en su programa de usuario trabaja con distintas listas de lectura o de escritura que utiliza
de forma controlada por el programa, arrastre la instrucci√≥n "UA_NodeReleaseHandleList"
al editor de programas con Drag&Drop.
Seleccione la interfaz de cliente que desee utilizar.
Seleccione ahora una lista de lectura o de escritura para habilitarla: habilite solo listas de
lectura o escritura que no utilice frecuentemente, dado que el nuevo registro requiere
bastante tiempo.
Repita a continuaci√≥n los pasos a partir del paso 7 con la instrucci√≥n
"UA_NodeGetHandleList".
10.Arrastre la instrucci√≥n "UA_Disconnect" al editor de programas con Drag&Drop.
Seleccione la opci√≥n de llamada "Multiinstancia".
Haga clic en el s√≠mbolo de la caja de herramientas (KOP y FUP) o en la casilla de
verificaci√≥n verde debajo del nombre de la instancia (AWL y SCL) si el editor a√∫n no se ha
abierto.
Seleccione la interfaz de cliente que desee utilizar. En el ejemplo se utiliza la interfaz de
cliente "ProductionLine".
STEP 7 interconecta ahora autom√°ticamente todos los par√°metros de la instrucci√≥n
"OPC_UA_Disconnect":

Instrucciones permitidas
STEP 7 asigna autom√°ticamente valores a los par√°metros de las siguientes instrucciones si se
utilizan una interfaz de cliente y una conexi√≥n parametrizada con un servidor OPC UA.
‚óè OPC_UA_Connect
‚óè OPC_UA_NamespaceGetIndexList
‚óè OPC_UA_NodeGetHandleList
‚óè OPC_UA_MethodGetHandleList
‚óè OPC_UA_MethodReleaseHandleList
‚óè OPC_UA_ReadList
‚óè OPC_UA_WriteList

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1453

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè OPC_UA_MethodCall
‚óè OPC_UA_NodeReleaseHandleList
‚óè OPC_UA_Disconnect

Sugerencias y recomendaciones
Reglas para suscripciones
Las siguientes reglas rigen para suscripciones:
‚óè Agrupe las suscripciones en el cliente en funci√≥n de los diferentes intervalos de muestreo
y env√≠o y distribuya los elementos vigilados (variables) entre los grupos.
Ejemplo: Cree una suscripci√≥n para intervalos de env√≠o mayores (p. ej. 5 segundos) y una
suscripci√≥n para intervalos de env√≠o menores (p. ej. 0,1 segundos).
‚óè Desactive las suscripciones no necesarias.
Motivo: el modo de suscripci√≥n "Desactivado" reduce el consumo de recursos.
‚óè Tenga en cuenta el n√∫mero m√°ximo de elementos vigilados (Monitored Items) de
suscripciones para la CPU S7-1500 correspondiente.
Encontrar√° la informaci√≥n pertinente en los datos t√©cnicos de la CPU correspondiente; se
refiere a un intervalo de muestreo/env√≠o de 1 segundo.
Para m√°s informaci√≥n consulte la FAQ 109755846 (https://
support.industry.siemens.com/cs/es/es/view/109755846).
‚óè Seleccione los mismos intervalos de muestreo y env√≠o tanto para el cliente OPC UA como
para el servidor OPC UA.
‚óè Evite matrices y estructuras como elementos de suscripciones, siempre que el proceso lo
permita.
Motivo: si cambia aunque solo sea un valor de una matriz o estructura, se transfiere toda la
estructura, lo que genera una carga por comunicaci√≥n innecesaria.
‚óè Si ocasionalmente no se cumple la tasa de muestreo exigida, el servidor OPC UA de la CPU
S7-1500 env√≠a un acuse con el c√≥digo de error "GoodOverload" de acuerdo con la
especificaci√≥n OPC UA; consulte tambi√©n la ayuda del TIA Portal. Los distintos clientes
OPC UA tratan de distinto modo los c√≥digos de error "Good" que no sean "0". Tenga en
cuenta este comportamiento y reduzca la carga por comunicaci√≥n, si fuera necesario,
aplicando las medidas indicadas anteriormente.

Consulte tambi√©n
Ajustes del servidor para suscripciones (P√°gina 1346)

1454

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas para el programa de usuario
Programas de usuario para OPC UA
Las siguientes reglas rigen para programas de usuario:
‚óè Si la aplicaci√≥n lo permite y la carga por comunicaci√≥n es elevada, deber√≠a ajustarse un
tiempo m√≠nimo para OB c√≠clicos.
Ventajas:
‚Äì El tiempo de ciclo se mantiene b√°sicamente constante
‚Äì La CPU suele tener m√°s tiempo para tareas de comunicaci√≥n
Sugerencia: para analizar la carga de la CPU (p. ej. comunicaci√≥n) utilice la instrucci√≥n
"Runtime_Info"; modo 21 o modo 25 (consulte la ayuda del TIA Portal).
‚óè Reduzca el n√∫mero de variables o de bloques de datos accesibles desde OPC UA/HMI. En
el ajuste predeterminado, cuando se crean variables/DB/IDB, todas las variables son
accesibles desde OPC UA/HMI. Esta medida mejora el rendimiento al cargar en RUN.
Sugerencia: Gracias a la visualizaci√≥n detallada de los objetos en TIA Portal es posible
marcar f√°cilmente los bloques de datos que no son relevantes para OPC UA como "no
accesibles desde OPC UA".
‚óè Una transferencia coherente de datos que supere el l√≠mite de tipos de datos simples solo
es posible utilizando m√©todos OPC UA. Si se utilizan otras funciones OPC UA
(Subscriptions, Read/Write), la coherencia de datos debe asegurarse en toda la aplicaci√≥n.
‚óè Para accesos reiterativos de lectura y escritura a las mismas variables, OPC UA dispone
del servicio "RegisterNodes". Ese servicio permite preparar servidores para el acceso
optimizado a variables. La instrucci√≥n "OPC_UA_NodeGetHandleList" de S7-1500 como
cliente OPC UA llama este servicio impl√≠citamente para preparar el servidor para los
accesos optimizados (en el lenguaje de OPC UA "Registered Read/Write").

Abrir el visor de objetos detallado en el TIA Portal
Para abrir el visor de objetos detallado, proceda del siguiente modo:
1. Cambie al portal "Programaci√≥n de PLC" en la vista del portal.
2. Seleccione "Mostrar todos los objetos".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1455

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Cambie a la ficha "Detalles" en la ventana de selecci√≥n.
4. En la columna "DB accesible desde OPC UA", desactive la accesibilidad desde OPC UA
para diferentes objetos.

Plantillas maestras para la comunicaci√≥n OPC UA
Plantillas maestras para las interfaces OPC UA
Las interfaces de servidores OPC UA y clientes OPC UA que desee utilizar varias veces
pueden almacenarse en la librer√≠a del proyecto o en una librer√≠a global. Las plantillas maestras
de la librer√≠a del proyecto solo pueden utilizarse dentro del proyecto. Si se crea la plantilla
maestra en una librer√≠a global, puede utilizarse en diferentes proyectos.
Las CPU compatibles con OPC UA distinguen 3 tipos de interfaz del servidor OPC UA:
‚óè Interfaz de servidor normal
‚óè Interfaz de especificaci√≥n companion
‚óè Referencia al espacio de nombres
Al agregar la interfaz OPC UA en el √°rbol del proyecto, en "Comunicaci√≥n OPC UA" cada tipo
de interfaz recibe un s√≠mbolo propio. El mismo s√≠mbolo lo adopta tambi√©n la plantilla maestra.
Puede crear plantillas maestras individuales o una plantilla maestra con varias interfaces.

Generar varias plantillas maestras a partir de una selecci√≥n
Seleccione uno o m√°s elementos y cree plantillas maestras individuales a partir de estos.
1. Abra la librer√≠a en la Task Card "Librer√≠as".
2. Seleccione los elementos que desee.
3. Arrastre los elementos mediante Drag&Drop a la carpeta "Plantillas maestras" o a cualquier
subcarpeta de "Plantillas maestras".

1456

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Generar una plantilla maestra a partir de una selecci√≥n
Seleccione varios elementos y cree una plantilla maestra individual que contenga todos los
elementos seleccionados.
1. Copie en el portapapeles los elementos que desea crear como plantillas maestras.
2. En la librer√≠a, haga clic con el bot√≥n derecho del rat√≥n en la carpeta "Plantillas maestras" o
en cualquier subcarpeta.
3. Elija el comando "Insertar como plantilla maestra √∫nica" del men√∫ contextual.
Si se agregan a una plantilla maestra varias interfaces del servidor OPC UA o cliente OPC UA,
el t√≠tulo y el s√≠mbolo de la librer√≠a cambian en correspondencia.
En lugar del s√≠mbolo sencillo se muestra un s√≠mbolo con "+".

Consulte tambi√©n
Crear una interfaz de servidor personalizada (P√°gina 1364)

1.4.1.17

Configuraci√≥n del servidor web

Informaci√≥n importante sobre el servidor web
Introducci√≥n
El servidor web permite a los usuarios autorizados vigilar y administrar la CPU a trav√©s de una
red. Eso permite la evaluaci√≥n y el diagn√≥stico a grandes distancias. Para ello solo se necesita
un navegador web.
Los avisos y la informaci√≥n sobre el estado se muestran en p√°ginas HTML.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1457

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Navegador web
Para acceder a las p√°ginas HTML de la CPU se requiere un navegador web.
La informaci√≥n acerca de los navegadores web y las versiones con las que se ha probado el
servidor web se encuentra en los manuales correspondientes, que se indican m√°s abajo con
el enlace correspondiente.
Nota
Si accede al servidor web de la CPU a trav√©s de un procesador de comunicaciones (CP),
aseg√∫rese de que la cach√© (archivos temporales de Internet) est√© activada en su navegador.
En la configuraci√≥n de cach√© de su navegador, elija la opci√≥n "Autom√°tico".
Si el navegador tiene la cach√© desactivada o no tiene configurada la opci√≥n "Autom√°tico",
pueden prolongarse excesivamente los tiempos de acceso y la representaci√≥n puede quedar
incompleta.

Leer informaci√≥n sobre el servidor web
La informaci√≥n detallada a continuaci√≥n puede leerse de la CPU. La disponibilidad de las
respectivas p√°ginas web depende de la CPU y de su versi√≥n de firmware.
Documentaci√≥n del S7-300 (http://support.automation.siemens.com/WW/view/es/12996906)
Documentaci√≥n del S7-400 (http://support.automation.siemens.com/WW/view/es/44444467)
Documentaci√≥n del S7-1500 (http://support.automation.siemens.com/WW/view/es/59193560)
A continuaci√≥n encontrar√° una sinopsis de la informaci√≥n que se ofrece en las diferentes
p√°ginas del servidor web de la CPU S7-1500.

1458

Informaci√≥n

Descripci√≥n

P√°gina de inicio con informaci√≥n general de la
CPU

La p√°gina inicial ofrece informaci√≥n general de la
CPU, el nombre de la CPU, el tipo de CPU e in‚Äê
formaci√≥n b√°sica sobre el estado operativo actual.

Diagn√≥stico: Informaci√≥n de identificaci√≥n

Visualizaci√≥n de la informaci√≥n de identificaci√≥n
est√°tica como el n√∫mero de serie, la referencia y la
versi√≥n.

Diagn√≥stico: Memoria

Valores actuales de la capacidad de memoria usa‚Äê
da hasta el momento

Contenido del b√∫fer de diagn√≥stico

Visualizaci√≥n del contenido del b√∫fer de diagn√≥s‚Äê
tico con las entradas m√°s recientes en primer lu‚Äê
gar.

Estado del m√≥dulo

Visualizaci√≥n que muestra si los componentes de
una estaci√≥n funcionan correctamente, si p. ej.,
hay una petici√≥n de mantenimiento o si los com‚Äê
ponentes no son accesibles.

Actualizaci√≥n del firmware

En calidad de usuario con los derechos de acceso
adecuados dispone de la posibilidad de actualizar
el firmware de CPU, del display o de diferentes
m√≥dulos centralizados y descentralizados utilizan‚Äê
do un archivo de actualizaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Informaci√≥n

Descripci√≥n

Avisos

Visualizaci√≥n de mensajes de texto orientados a
un proyecto con filtro y posibilidad de clasificaci√≥n.

Informaci√≥n sobre la comunicaci√≥n

Visualizaci√≥n de las conexiones de comunicaci√≥n;
visualizaci√≥n de los recursos; par√°metros de inter‚Äê
faz y estad√≠stica de puertos.

Topolog√≠a

Visualizaci√≥n de la topolog√≠a con las vistas gr√°fica,
de estado y en forma de tabla para dispositivos
PROFINET conectados.

Estado de variables

Visualizaci√≥n del estado de operandos del progra‚Äê
ma de usuario para la observaci√≥n de los valores.
Sugerencia: Al salir de la p√°gina de estado de va‚Äê
riables no se guardan las entradas realizadas. Si
desea volver a observar m√°s adelante las mismas
variables introducidas, cree un marcador de la p√°‚Äê
gina "Estado de variables" en su navegador web.
De lo contrario, deber√° volver a introducir las va‚Äê
riables cuando vuelva a abrir la p√°gina.

Tablas de observaci√≥n

Visualizaci√≥n de las tablas de observaci√≥n gene‚Äê
radas con STEP 7 con la opci√≥n "Servidor web".

P√°ginas de usuario (en caso de que se hayan con‚Äê Las p√°ginas de usuario proporcionan una lista de
figurado y cargado p√°ginas web de ese tipo)
las p√°ginas web con aplicaciones web espec√≠ficas
del cliente.
Con la primera llamada de la instrucci√≥n "WWW"
en el programa de usuario se muestra el enlace a
la p√°gina de usuario en esta p√°gina web. Al hacer
clic en el enlace, la p√°gina de usuario se abre en
una ventana nueva.
Explorador de archivos

S7-1500: el explorador de archivos lista archivos y
directorios que se encuentran en la SIMATIC Me‚Äê
mory Card.
Seg√∫n del tipo que sean, los archivos pueden des‚Äê
cargarse, borrarse, renombrarse y cargarse.
Los directorios solo pueden crearse, borrarse o
renombrarse.
A los directorios "DataLogs" y "Backups" solo es
posible acceder en modo de lectura con el nave‚Äê
gador de archivos. Los archivos de sistema no se
muestran en el explorador de archivos, as√≠ que no
pueden modificarse ni borrarse.
Los archivos de sistema son el archivo de tareas y
todos los directorios especiales (incluyendo su
contenido) a los que se hace referencia en el ar‚Äê
chivo de tareas.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1459

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Informaci√≥n

Descripci√≥n

Data Logs

Visualizaci√≥n y consulta de los DataLogs genera‚Äê
dos con el programa de usuario.
Atenci√≥n:
Si se abren archivos DataLog grandes desde esta
p√°gina web, es posible que aumenten considera‚Äê
blemente los tiempos de ejecuci√≥n de las instruc‚Äê
ciones DataLog que procesan este archivo Data‚Äê
Log.
El tiempo de procesamiento de la clase de priori‚Äê
dad (OB en el que se llama la instrucci√≥n DataLog)
no aumenta, pero el par√°metro de salida BUSY
est√° activado mientras dura el procesamiento.

1460

Copia de seguridad online

S7-1500 (a partir del firmware V2.0): copia de se‚Äê
guridad y restauraci√≥n de la configuraci√≥n de la
CPU. Con los derechos de acceso correspondien‚Äê
tes se puede realizar una copia de seguridad de la
configuraci√≥n de una CPU. En caso necesario, la
configuraci√≥n en cuesti√≥n se puede restaurar pos‚Äê
teriormente. Puede crear tantas copias de seguri‚Äê
dad como desee para guardar diferentes configu‚Äê
raciones de una CPU.

Diagn√≥stico Motion

S7-1500 (a partir del firmware V2.0): Muestra el
estado, los errores, las alarmas tecnol√≥gicas y los
valores actuales de objetos tecnol√≥gicos (TOs), p.
ej. eje de velocidad (TO_SpeedAxis), eje de posi‚Äê
cionamiento (TO_PositioningAxis), eje sincroniza‚Äê
do (TO_SynchronousAxis), enc√≥der externo
(TO_ExternalEncoder), palpador de medida
(TO_MeasuringInput), leva (TO_OutputCam), pis‚Äê
ta de leva (TO_CamTrack). En la p√°gina web
"Diagn√≥stico Motion" encontrar√° informaci√≥n de‚Äê
tallada sobre los objetos tecnol√≥gicos configura‚Äê
dos en las vistas generales de diagn√≥stico y ser‚Äê
vicio.

Trace

Visualizaci√≥n de las mediciones guardadas en la
SIMATIC Memory Card.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Acceso web a la CPU mediante PG/PC
Para acceder al servidor web, proceda de la siguiente manera:
1. Conecte el cliente (la PG/el PC) con la CPU a trav√©s de la interfaz PROFINET.
Si no se accede a trav√©s de la interfaz PROFINET de la CPU, sino a trav√©s de la interfaz de
un CP (p. ej. CP 1543-1), las p√°ginas web tardan m√°s en generarse. En tal caso, aseg√∫rese
de que la configuraci√≥n de cach√© (archivos temporales de Internet) del navegador se
encuentre en modo "Autom√°tico".
2. Abra el navegador web.
En el campo "Direcci√≥n" del navegador web, introduzca la direcci√≥n IP de la CPU de la
manera siguiente: http://ww.xx.yy.zz (entrada a modo de ejemplo: http://192.168.3.141).
Se abre la p√°gina inicial de la CPU. A partir de la p√°gina de inicio puede navegar hasta el
resto de la informaci√≥n.
Si no aparece la p√°gina de inicio, aseg√∫rese de que se ha activado el servidor web en la
configuraci√≥n y que la configuraci√≥n ha sido cargada.

Acceso web a una CPU S7-300/400 a trav√©s de dispositivos HMI y dispositivos m√≥viles
El servidor web tambi√©n soporta el servicio de Windows desde un terminal, de modo que,
adem√°s de la programadora y el PC, tambi√©n pueden utilizarse soluciones Thin-Client con
dispositivos m√≥viles (p. ej. PDA, MOBIC T8) y estaciones locales robustas (p. ej. SIMATIC
MP370 con la opci√≥n ThinClient/MP) con Windows CE.
Para acceder al servidor web, proceda de la siguiente manera:
1. Conecte el cliente (dispositivo HMI, PDA) con la CPU a trav√©s de la interfaz PROFINET.
2. Abra el navegador web.
En el campo "Direcci√≥n" del navegador web, introduzca la direcci√≥n IP de la CPU de la
manera siguiente: http://ww.xx.yy.zz /basic (entrada a modo de ejemplo: http://
192.168.3.141/basic).
Se abre la p√°gina inicial de la CPU. Desde all√≠ podr√° acceder al resto de las informaciones.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1461

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para dispositivos HMI con el sistema operativo Windows CE, anterior a la V 5.x, la informaci√≥n
de la CPU se edita en un navegador dise√±ado especialmente para Windows CE. En este
navegador, la informaci√≥n se representa de forma simplificada.
Nota
SIMATIC Micro Memory Card en combinaci√≥n con el servidor web (S7-300)
Los datos de configuraci√≥n del servidor web se guardan en la SIMATIC Micro Memory Card.
Por este motivo se recomienda el uso de una SIMATIC Micro Memory Card de al menos
512 KB.
Tambi√©n puede utilizar el servidor web sin una SIMATIC Micro Memory Card insertada. Para
que funcione debe haber asignado una direcci√≥n IP a la CPU.
‚óè El contenido del b√∫fer de diagn√≥stico se visualiza en c√≥digo hexadecimal.
‚óè La p√°gina de inicio, la informaci√≥n sobre identificaci√≥n y comunicaci√≥n y el estado de las
variables se muestran en texto expl√≠cito.
‚óè Los indicadores siguientes permanecen vac√≠os:
‚Äì Topolog√≠a
‚Äì Avisos
‚Äì Estado del m√≥dulo
‚óè La actualizaci√≥n autom√°tica de la p√°gina tambi√©n est√° activada sin la SIMATIC Micro
Memory Card o sin configuraci√≥n.

Acceso web a una CPU S7-1500 a trav√©s de dispositivos HMI y dispositivos m√≥viles
Para dispositivos HMI con el sistema operativo Windows CE preinstalado, anterior a la V 5.x,
la informaci√≥n de la CPU se procesan en un navegador dise√±ado especialmente para
Windows CE. En este navegador, la informaci√≥n se representa de forma simplificada.
El servidor web ofrece p√°ginas web de complejidad reducida que puedan ser √∫tiles para
dispositivos con pantallas peque√±as y baja potencia de procesador.
Requisito para el acceso con dispositivos m√≥viles:
‚óè conexi√≥n WLAN para la CPU (WLAN Access Point, p. ej. SCALANCE W788-1RR o
SCALANCE W784-1)
‚óè servidor web activado en la CPU
‚óè Para el dispositivo m√≥vil, la WLAN debe estar activada y se debe haber establecido una
conexi√≥n con el punto de acceso.
Para un dispositivo m√≥vil, el procedimiento es id√©ntico al de otros dispositivos (programadora/
PC). Introduzca en el explorador la direcci√≥n IP de la interfaz de la CPU, descargue el
certificado e inst√°lelo a continuaci√≥n.

Seguridad
Para evitar riesgos, aseg√∫rese de emplear distintas t√©cnicas para dejar protegida la CPU (p.
ej. restringir el acceso a la red o usar firewalls).

1462

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El servidor web ofrece las funciones de seguridad siguientes:
‚óè Acceso a trav√©s del protocolo de transmisi√≥n seguro HTTPS
‚óè Permiso de usuario configurable mediante la lista de usuarios

Consulte tambi√©n
Condiciones previas para el acceso web (P√°gina 1463)

Lectura de datos de servicio
El servidor web de una CPU S7-1500 le ofrece la posibilidad de guardar los datos de servicio.
Estos contienen, junto con el contenido del b√∫fer de diagn√≥stico, otras muchas informaciones
sobre el estado interno de la CPU. Si ocurriese con la CPU un problema que no pudiera
solucionarse de otra forma, tiene la posibilidad de proporcionar los datos de servicio al equipo
de Service & Support.

Procedimiento
1. Introduzca la direcci√≥n siguiente en la barra de direcciones de su navegador web:
"http://<CPU IP address>/save_service_data.html", p. ej.
"http://192.168.3.141/save_service_data.html"
2. En su pantalla aparecer√° la vista de la p√°gina de datos de servicio con un bot√≥n para
guardarlos.

3. Guarde los datos de servicio localmente en su visualizador haciendo clic en "Save
ServiceData".

Resultado
Los datos se guardar√°n en un archivo .dmp con la siguiente convenci√≥n de nomenclatura:
"<MLFB><n√∫mero de serie><sello de tiempo>.dmp". Podr√° modificar posteriormente el
nombre del archivo si lo desea.

P√°ginas web est√°ndar
Condiciones previas para el acceso web
A continuaci√≥n se explicar√°n las condiciones para el acceso a las p√°ginas web est√°ndar de la
CPU as√≠ como las repercusiones la ausencia o presencia de informaci√≥n de configuraci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1463

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos
El servidor web tiene que estar abierto.
El servidor web se inicia al activarlo en el √°rea "Servidor web" de las propiedades de la CPU.
Considere lo siguiente:
‚óè Las p√°ginas web se transfieren a trav√©s de una conexi√≥n no segura que no est√° exenta del
peligro de ataques de terceros. Si desea transferir las p√°ginas web codificadas al
navegador, active la opci√≥n "Permitir el acceso s√≥lo v√≠a HTTPS" en las propiedades de la
CPU. Tenga en cuenta que la URL de la CPU comienza, en este caso, con https://.
‚óè El acceso v√≠a HTTPS s√≥lo funciona si se ha ajustado la hora en la CPU.
‚óè Para una mayor protecci√≥n de acceso, cree usuarios en el √°rea "Servidor web" de las
propiedades de la CPU.
‚óè La funcionalidad completa de las p√°ginas web relativas al estado del m√≥dulo, la topolog√≠a
y los avisos requiere en las CPU S7-300/400 la generaci√≥n y carga de los datos de
diagn√≥stico del sistema (Report System Error). Tras activar el servidor web aparece por
tanto la consulta sobre si se desea activar el diagn√≥stico del sistema. Se recomienda que
confirme la consulta con "S√≠".

Iniciar sesi√≥n
No es necesario iniciar sesi√≥n para poder acceder a las p√°ginas web est√°ndar. Para realizar
determinadas acciones como la modificaci√≥n del estado operativo de la CPU o para acceder
en escritura, debe haber un usuario registrado. Los campos de entrada para iniciar sesi√≥n son
los que se encuentran en la esquina superior izquierda de todas las p√°ginas web est√°ndar.

Cuando se inicia sesi√≥n como usuario deben introducirse el nombre de usuario y la
contrase√±a. El nombre de usuario y la contrase√±a se definen en las propiedades de la CPU, en
el √°rea "Servidor web".

Acceso web sin informaci√≥n de configuraci√≥n
Sin configuraci√≥n, s√≥lo se dispone de informaci√≥n b√°sica en las p√°ginas web est√°ndar. Esta
informaci√≥n est√° disponible en varios idiomas:
‚óè Las entradas del b√∫fer de diagn√≥stico no se mostrar√°n como texto expl√≠cito sin informaci√≥n
de configuraci√≥n, sino s√≥lo como c√≥digo hexadecimal.
‚óè En caso de que el servidor web de la CPU soporte tablas de variables (tablas de
observaci√≥n):
La p√°gina de las tablas de variables no muestra ninguna variable sin configuraci√≥n. El
estado de las variables puede consultarse siempre.

1464

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Acceso web con informaci√≥n de configuraci√≥n
En la informaci√≥n de configuraci√≥n, los textos del idioma del pa√≠s seleccionado contienen:
‚óè Textos para las entradas del b√∫fer de diagn√≥stico como texto breve o extenso
‚óè Para CPU S7-300/400: Textos de aviso. p. ej., bloques de aviso AlarmS/SQ, AlarmD/DQ
‚óè En caso de que se soporten las tablas variables (tablas de observaci√≥n): Tablas de
variables con los s√≠mbolos y comentarios contenidos
Los textos para las entradas del b√∫fer de diagn√≥stico y mensajes se mostrar√°n durante el
funcionamiento en el idioma ajustado en el navegador web.

Consulte tambi√©n
Ajustes para el funcionamiento (P√°gina 1465)

Ajustes para el funcionamiento
Ajustes para el funcionamiento
Para poder utilizar el servidor web de una CPU y para determinar el comportamiento del
servidor web, deber√° marcar la CPU en la vista de redes, de dispositivos o de topolog√≠a.
Realice los siguientes ajustes en la ventana de inspecci√≥n bajo "Propiedades > General >
Servidor web":
‚óè Activar el servidor web
‚óè Limitar el acceso a la web al protocolo seguro de transferencia de hipertexto (HTTPS)
‚óè Activar la actualizaci√≥n autom√°tica
‚óè Multiling√ºismo (configurar idiomas de proyecto para servidor web y display de la CPU)
‚óè Completar la lista de usuarios
‚óè Para CPU S7-300/400: Seleccionar los discriminadores de los avisos
Cada interfaz PROFINET de una CPU S7-1500, de un CP PROFINET o de un CM PROFINET
puede ser asimismo autorizada o bloqueada en el servidor web para el acceso "desde fuera".
Lo m√°s sencillo es que se administre este acceso centralmente en las propiedades de la CPU.
Para ello, haga clic en la ficha "Propiedades" de la ventana de inspecci√≥n en el √°rea "Servidor
web > Vista general de las interfaces" y active las interfaces a trav√©s de las que se permite el
acceso.

Consulte tambi√©n
Condiciones previas para el acceso web (P√°gina 1463)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1465

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Activar el servidor web
Activar el servidor web
En el ajuste b√°sico, el servidor web permanece desactivado. Para que la CPU muestre p√°ginas
web deber√°n activarse las correspondientes casillas opcionales.
Este ajuste se encuentra, dentro de la ventana de inspecci√≥n, en "Propiedades > General >
Servidor web"; casilla opcional "Activar el servidor web en este m√≥dulo".
Cuando se activa el servidor web aparece para las CPU S7-300/400 un mensaje de consulta
sobre si el diagn√≥stico de sistema (Report System Errors) debe o no activarse. Haga clic en
"S√≠" cuando deban generarse los bloques y textos necesarios para "Report System Errors", de
manera que los textos de aviso est√©n disponibles en el navegador web durante el
funcionamiento. En el caso de las CPU S7-1200/1500, el diagn√≥stico de sistema siempre est√°
activado (no puede desactivarse).
En las CPU S7-1500 con varias interfaces PROFINET o si se configuran CP con interfaces
PROFINET, deber√° activar adicionalmente las interfaces a trav√©s de las que se debe permitir
el acceso al servidor web. Este ajuste lo encontrar√° en "Propiedades > General > Servidor web
> Vista general de las interfaces".

Activar la actualizaci√≥n autom√°tica
Activar la actualizaci√≥n autom√°tica
Con la casilla opcional "Actualizaci√≥n autom√°tica" activada, las p√°ginas web se actualizar√°n
autom√°ticamente en el intervalo de tiempo establecido en "Intervalo de actualizaci√≥n". La
p√°gina web "Identificaci√≥n" est√° excluida de la actualizaci√≥n.
Para activar la actualizaci√≥n autom√°tica, proceda del siguiente modo:
1. En "Propiedades > General > Servidor web > Actualizaci√≥n autom√°tica", active la casilla de
verificaci√≥n "Activar actualizaci√≥n autom√°tica".
2. Indique el intervalo de actualizaci√≥n.
Nota
Tiempo de actualizaci√≥n
El intervalo de actualizaci√≥n ajustado es el tiempo de actualizaci√≥n m√°s corto. Un n√∫mero
mayor de datos o m√°s conexiones HTTP/HTTPS incrementa el tiempo de actualizaci√≥n.

1466

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustar el idioma para web
Ajustar el idioma para web
Para seleccionar el idioma de los textos dependientes del mismo que deban cargarse en la
CPU, proceda del siguiente modo:
1. En la ventana de inspecci√≥n, despl√°cese hasta el √°rea "Multiling√ºe".
2. Active los idiomas necesarios para la visualizaci√≥n en el navegador web en la primera
columna; el n√∫mero de idiomas seleccionable es espec√≠fico de la CPU.
3. Asigne a los idiomas del display/del servidor web el idioma de proyecto deseado en cada
caso.
Los idiomas de proyecto asignables deben estar activados y los textos correspondientes
(traducciones) deben estar en el proyecto. Podr√° encontrar la selecci√≥n del idioma del
proyecto en la navegaci√≥n del proyecto, m√°s concretamente en "Idiomas y recursos".
Mediante estas asignaciones los textos de visualizaci√≥n no disponibles en la CPU se
cargan en el idioma seleccionado (con c√≥digo de pa√≠s e idioma) al cargarlos en la CPU.

Nota
Si activa el servidor web y no asigna ning√∫n idioma, los avisos y la informaci√≥n de
diagn√≥stico se visualiza en c√≥digo hexadecimal.

Administraci√≥n de usuarios
Administraci√≥n de usuarios
La administraci√≥n de usuarios ofrece las siguientes posibilidades:
‚óè Crear usuarios
‚óè Establecer derechos de ejecuci√≥n
‚óè Asignar contrase√±as

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1467

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Con esta asignaci√≥n los usuarios disponen de las opciones asignadas de forma fija a los
derechos de ejecuci√≥n.
‚óè Si se ha configurado un usuario, tras registrarse con su contrase√±a, √©ste podr√° acceder a
las p√°ginas web conforme a sus derechos de acceso.
‚óè Dependiendo de la CPU y el firmware utilizados, se pueden asignar diferentes derechos de
usuario. Los derechos que su CPU no soporta no pueden seleccionarse.
‚óè En la lista de usuarios se ha incluido de forma predeterminada un usuario con el nombre
"Cualquiera" que posee derechos de acceso m√≠nimos: acceso en lectura a las p√°ginas Intro
y de inicio. El usuario "Cualquiera" se ha configurado sin asignaci√≥n de contrase√±a.
‚óè De manera predeterminada, un usuario no registrado acceder√° siempre al servidor web
como usuario "Cualquiera". Es irrelevante si se han configurado otros usuarios.
En cualquier caso, es posible asignar al usuario "Cualquiera" cualquier derecho de acceso
disponible en STEP 7. Dado que el usuario "Cualquiera" no tiene asignada ninguna
contrase√±a en STEP 7, mire bien qu√© derechos de acceso define para este usuario.
Algunos derechos, como por ejemplo la posibilidad de modificar el estado operativo,
podr√≠an provocar un riesgo para la seguridad.
Al asignar derechos relevantes para la seguridad se recomienda: configurar un usuario y
asignarle siempre una contrase√±a.

Recomendaciones para asignar contrase√±as
‚óè Cuando configure los usuarios, establezca contrase√±as seguras.
Una contrase√±a segura es aquella que, por ejemplo, solo se usa para una √∫nica aplicaci√≥n,
contiene m√°s de 8 caracteres y est√° formada por letras may√∫sculas y min√∫sculas,
caracteres especiales y cifras (?!+%$1234...).
‚óè No utilice secuencias de caracteres habituales del teclado del ordenador, ni palabras del
diccionario.
‚óè Cambie la contrase√±a con frecuencia. Siempre que sea posible, active la opci√≥n "Permitir
el acceso solo v√≠a HTTPS" en cuanto haya asignado al menos una contrase√±a a un usuario.

Seguridad del servidor
Para poder utilizar el protocolo de transferencia HTTPS, en las CPU SIMATIC S7-1500 a partir
del firmware V2.0 es necesario crear un certificado de servidor web y asignarlo a la CPU.
El certificado de servidor web tambi√©n es un requisito para la administraci√≥n de usuarios del
servidor web (protecci√≥n por contrase√±a).

Requisitos
Ha abierto las propiedades de la CPU (ventana de inspecci√≥n).

Procedimiento
Los ajustes para crear un certificado de servidor web se encuentran en las propiedades de la
CPU, en el √°rea "Servidor web > Security".

1468

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En esta √°rea puede crear y seleccionar certificados. A tal fin, se tiene en cuenta si se utiliza o
no el administrador de certificados en los ajustes globales de seguridad.
En "Consulte tambi√©n" encontrar√° informaci√≥n adicional sobre el procedimiento a seguir en lo
relativo al administrador de certificados.

Creaci√≥n de certificados de servidor web en funci√≥n de la versi√≥n de firmware de la CPU
En CPU SIMATIC S7‚Äë1500 con firmware V2.0 o superior tiene que crear usted mismo el
certificado para el servidor web de la CPU con STEP 7 y asignarlo al servidor web en las
propiedades de la CPU. El certificado se carga autom√°ticamente al cargar la configuraci√≥n
hardware en la CPU.
El propio proyecto STEP 7 tiene un certificado ra√≠z (CA, Certification Authority) con el que se
puede firmar el certificado de servidor web. Para ello es necesario iniciar sesi√≥n en el
administrador de certificados en los ajustes globales de seguridad.
Excepci√≥n:
Si actualiza el firmware de una CPU SIMATIC S7‚Äë1500 o ET 200SP con versi√≥n de firmware
< V2.0 a una versi√≥n de firmware ‚â• V2.0, la CPU autom√°ticamente genera y utiliza un
certificado de servidor v√°lido. Se aplica lo mismo para el recambio de piezas, en el que una
CPU m√°s nueva sustituye una CPU con versi√≥n de firmware < V2.0.
En estos casos STEP 7 no utiliza el certificado de servidor web.

Acceso solo v√≠a HTTPS
Acceso solo v√≠a HTTPS
El HTTPS sirve para el cifrado y la autenticaci√≥n de la comunicaci√≥n entre el navegador y el
servidor web.
Las p√°ginas web se transfieren de forma est√°ndar a trav√©s de una conexi√≥n no segura y no
est√°n protegidas frente a ataques de terceros. Si desea transferir al navegador p√°ginas web e
informaci√≥n de acceso exclusivamente de forma segura, active la opci√≥n "Permitir el acceso
s√≥lo v√≠a HTTPS" en las propiedades de la CPU. Aseg√∫rese de que la URL de la CPU comience
en este caso con "https://".
Atenci√≥n: Para utilizar el protocolo de transmisi√≥n seguro "HTTPS" se requiere un certificado
de servidor web v√°lido en la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1469

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos para el acceso v√≠a HTTPS
Para un acceso HTTPS correcto al servidor web de la CPU desde su navegador web se
requiere lo siguiente:
‚óè En la CPU debe estar ajustada la hora actual.
En general rige: Cuando se utiliza Secure Communication (p. ej. HTTPS, Secure OUC,
OPC UA), hay que asegurarse de que los m√≥dulos afectados tengan la hora y fecha
actuales. De lo contrario, los m√≥dulos considerar√°n los certificados utilizados no v√°lidos y
la comunicaci√≥n segura no funcionar√°.
‚óè La direcci√≥n IP de la CPU tiene que estar asignada.
‚óè En el navegador web debe estar instalado un certificado ra√≠z v√°lido ofrecido por la CPU.
Si el certificado no est√° instalado, se mostrar√° una advertencia con la recomendaci√≥n de no
usar la p√°gina. Para ver la p√°gina deber√° "Agregar una excepci√≥n" expl√≠citamente.
Puede descargarse un certificado ra√≠z (Certification Authority) v√°lido de la p√°gina web
"Introducci√≥n" del servidor web, en "Descargar certificado".
En la ayuda de su navegador web y en la FAQ (https://
support.industry.siemens.com/cs/ww/es/view/103528224) con la ID de art√≠culo 103528224
de la p√°gina de Internet de Service&Support encontrar√° la informaci√≥n necesaria para
instalar el certificado en su navegador web.
Nota
Para protegerse de manipulaciones desde el exterior, descargue el certificado exclusivamente
en un entorno con seguridad garantizada.
Para cada visualizador que desee utilizar debe instalarse el certificado de la entidad emisora
de certificados ra√≠z.

Ejemplo del acceso a p√°ginas web con el protocolo HTTPS
Para acceder a las p√°ginas web de la CPU con el protocolo HTTPS, introduzca la URL del
modo siguiente: https://ww.xx.yy.zz, siendo ww.xx.yy.zz la direcci√≥n IP de la CPU.
Ejemplo de entrada: https://192.168.3.141
Una conexi√≥n cifrada se distingue por el s√≠mbolo de la cerradura en la barra de estado de la
p√°gina web.

Protecci√≥n de acceso
La conexi√≥n cifrada creada con ayuda del certificado impide las escuchas o falsificaciones en
la comunicaci√≥n, pero no constituye una protecci√≥n de acceso. Por ello, proteja su CPU con la
configuraci√≥n correspondiente en la administraci√≥n de usuarios para evitar el acceso no
autorizado.

1470

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Clases de visualizaci√≥n de los mensajes
Clases de visualizaci√≥n de los mensajes
En el ajuste b√°sico, todas las clases de visualizaci√≥n de mensajes est√°n activadas. Los
mensajes de las clases seleccionadas se muestran durante el funcionamiento en la p√°gina
web "Avisos". Los mensajes de las clases no seleccionadas no aparecen como texto completo
sino en c√≥digo hexadecimal.
Para configurar las clases de visualizaci√≥n, proceda de la manera siguiente:
‚óè para "Report System Errors" vaya, en la ventana de inspecci√≥n, a "Propiedades > General
> Diagn√≥stico de sistema"
‚óè para mensajes relativos a los m√≥dulos en el editor de mensajes
Nota
Reducir la necesidad de memoria
Puede reducir la necesidad de memoria para la configuraci√≥n del servidor web
seleccionando √∫nicamente las clases de visualizaci√≥n de los mensajes que deban
utilizarse.

Crear y cargar p√°ginas de usuario
Informaci√≥n importante sobre p√°ginas de usuario
Concepto
El concepto de p√°ginas de usuario o p√°ginas web definidas por el usuario permite acceder con
un navegador web a las p√°ginas web de la CPU dise√±adas por el usuario. El servidor web de
la CPU pone a disposici√≥n esta funci√≥n.
Para configurar la apariencia y funcionalidad de las p√°ginas web definidas por el usuario no se
requieren herramientas especiales. Puede utilizarse CSS para adaptar el dise√±o de las
p√°ginas, Javascript para incluir contenido din√°mico o cualquier otro framwork que el usuario
desee para crear las p√°ginas web. El conjunto de archivos que procesa el servidor web
tambi√©n recibe el nombre de "aplicaci√≥n web".

Aplicaci√≥n web y programa de usuario
Utilizando un c√≥digo HTML especial en p√°ginas web definidas por el usuario (comandos
AWP), tambi√©n pueden transferirse datos al programa de usuario de la CPU a trav√©s de un
navegador web para su posterior procesamiento, as√≠ como visualizarse datos del √°rea de
operandos de la CPU en el navegador web.
Con instrucciones de script (p. ej. Javascript) puede optimizar sus p√°ginas web, p. ej. modificar
contenidos de forma din√°mica o validar entradas de usuario.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1471

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para sincronizar el programa de usuario y el servidor web, as√≠ como para la inicializaci√≥n, es
necesario llamar la instrucci√≥n WWW (SFC 99) del programa de usuario.
‚óè Si no hace falta que la aplicaci√≥n web y el programa de usuario interact√∫en, p. ej. si una
p√°gina web solo ofrece informaci√≥n est√°tica, solo es necesaria una inicializaci√≥n en el
programa de usuario.
‚óè Si se requiere un intercambio de datos sencillo entre las variables PLC y las variables de la
aplicaci√≥n web, p. ej. para mostrar el contenido de las variables PLC o para escribir un valor
en una variable PLC, deber√° tener en cuenta la sintaxis para la lectura y escritura de
variables. Asimismo, en el programa de usuario se requiere en este caso tan solo una
inicializaci√≥n, p. ej. en el OB de arranque.
‚óè Si se requiere una mayor interacci√≥n entre la aplicaci√≥n web y el programa de usuario,
deber√° manipular, adem√°s de la sincronizaci√≥n entre el servidor web y el programa de
usuario, la informaci√≥n de estado y de control del DB Web Control. Esto ser√° necesario,
p. ej., en el caso de entradas de usuario que se transfieran al servidor web a trav√©s del
navegador web para que la CPU las eval√∫e. A diferencia del intercambio de datos sencillo,
el programa de usuario influye directamente en el momento en el que se devuelve al
navegador web la p√°gina web solicitada. En este caso, es necesario que el usuario se
familiarice con el concepto de los fragmentos manuales y las estructuras del DB Web
Control.

Integraci√≥n de las fuentes HTML a trav√©s de TIA Portal
Los par√°metros para la integraci√≥n de las fuentes HTML en TIA Portal se encuentran en las
propiedades de la CPU en cuesti√≥n con servidor web:
Par√°metro

Significado

Directorio HTML Directorio de las fuentes HTML para la aplicaci√≥n web. Existe la posibilidad de introducir la ruta directa‚Äê
mente o navegar hasta el directorio utilizando el bot√≥n situado junto al campo de entrada.
Resulta conveniente integrar las p√°ginas web con rutas relativas. Para ello es necesario insertar el di‚Äê
rectorio en el que se guardan las fuentes HTML para la aplicaci√≥n web en el directorio de proyecto de
STEP 7, p. ej. en un directorio nuevo denominado "Webpages". Seguidamente, se indica como directorio
HTML el nombre de ruta relativa, en el ejemplo ".\Webpages".
Ventajas del uso de rutas relativas:
‚óè Las p√°ginas web personalizadas se archivan junto con el proyecto de STEP 7.
‚óè Las p√°ginas web se copian tambi√©n en la nueva ruta con el comando de men√∫ "Proyecto > Guardar
como...".
‚óè Al copiar el proyecto en otra ruta con el Explorador de Windows, no se adapta la ruta del directorio
HTML para generar nuevos DB web.
‚óè Si en un proyecto hay varios controladores que utilizan las mismas p√°ginas HTML, tambi√©n tendr√°n la
misma ruta de directorio HTML.
P√°gina HTML
predeterminada

Ruta a la p√°gina HTML predeterminada. Existe la posibilidad de introducir la ruta directamente o navegar
hasta la p√°gina HTML utilizando el bot√≥n situado junto al campo de entrada. La p√°gina HTML predeter‚Äê
minada es la p√°gina HTML que se debe abrir al iniciar la aplicaci√≥n web.

Nombre de apli‚Äê
caci√≥n

Nombre opcional para la aplicaci√≥n. Este nombre sirve para la posterior clasificaci√≥n o agrupaci√≥n de las
p√°ginas web. Si hay un nombre de aplicaci√≥n disponible, la URL se muestra en el formato siguiente: "http://
a.b.c.d/awp/<nombre de aplicaci√≥n>/<nombre de la p√°gina>.html"

1472

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Inicializaci√≥n
Las p√°ginas web definidas por el usuario se "comprimen" en bloques de datos para que la CPU
pueda procesarlas. Durante la configuraci√≥n, deben generarse los correspondientes bloques
de datos a partir de los datos de origen (archivos HTML, im√°genes, archivos Javascript, etc.)
para poder cargar la aplicaci√≥n web en la CPU. El DB Web Control (predeterminado: DB 333),
que contiene informaci√≥n de estado y de control, as√≠ como referencias a otros bloques de datos
con p√°ginas web cifradas, desempe√±a una funci√≥n particular. Los bloques de datos que
contienen las p√°ginas web encriptadas reciben el nombre de "DBs de fragmento".
Si los bloques de datos se han cargado en la CPU, esta no "sabe" que las p√°ginas web
definidas por el usuario que contiene est√°n cifradas. Con la instrucci√≥n "WWW" (SFC 99), p.
ej. en un OB de arranque, se le informa de qu√© DB es el DB Web Control. Tras esta
inicializaci√≥n, es posible acceder a las p√°ginas web definidas por el usuario desde un
navegador web.

Sincronizaci√≥n
Si el programa de usuario debe intercambiar datos o interactuar con las p√°ginas web definidas
por el usuario, deber√° utilizarse la instrucci√≥n WWW (SFC 99) en la parte c√≠clica del programa.
Ejemplos de interacci√≥n entre programa de usuario y p√°gina web:
‚óè Comprobar los datos recibidos
‚óè Recopilar y reenviar los datos para el navegador web solicitante
En este caso, la informaci√≥n de estado debe ser evaluable en el momento y la informaci√≥n de
control debe comunicarse al servidor web, p. ej., para habilitar una p√°gina web solicitada.

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)
Servidor web S7-1500 (http://support.automation.siemens.com/WW/view/es/59193560)

Sinopsis del procedimiento
B√°sico
En este cap√≠tulo se describe paso a paso el procedimiento b√°sico para crear, cargar y utilizar
p√°ginas web definidas para el usuario en la fase operativa.
El siguiente gr√°fico presenta el desarrollo para la creaci√≥n y visualizaci√≥n de p√°ginas web
definidas para el usuario de forma simplificada:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1473

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones







+70/
*,)



:::


‚ë†
‚ë°
‚ë¢

Programaci√≥n de una aplicaci√≥n web (si es necesario, utilizando herramientas adecuadas y, si
se da el caso, con los comandos AWP incluidos para p√°ginas din√°micas).
Una aplicaci√≥n web est√° formada por archivos de origen, p. ej., *.html, *.gif, *.js, ...
Con STEP 7:
‚óè Generar los bloques de datos (DB de control web y DB de fragmentos) a partir de archivos
de origen. Los DB contienen informaci√≥n meta y la aplicaci√≥n web completa incluyendo las
im√°genes y las partes din√°micas y est√°ticas de dicha aplicaci√≥n. Los DB se guardan dentro
de la navegaci√≥n del proyecto, en "Bloque de sistema".
‚óè Acceder a la instrucci√≥n "WWW" (SFC 99) en el programa de usuario. La instrucci√≥n inicia
el servidor web de la CPU para una aplicaci√≥n web.

‚ë£
‚ë§

‚óè De ser necesario, desprogramar la interacci√≥n ente el servidor web y el programa de usuario.
Cargar el bloque en la CPU.
Acceder a la p√°gina web desde el navegador. El acceso a las p√°ginas web de la CPU se realiza
introduciendo la direcci√≥n IP de la CPU.

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Crear p√°ginas web
Para crear p√°ginas web definidas por el usuario pueden utilizarse herramientas de dise√±o web
de distintos proveedores. B√°sicamente, las p√°ginas web deben programarse y dise√±arse
seg√∫n las convenciones del W3C (World Wide Web Consortium). En el servidor web de la CPU
no se comprueba si se cumplen los criterios del W3C.

1474

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas
‚óè La herramienta debe ofrecer la posibilidad de editar el c√≥digo HTML directamente para que
los comandos AWP puedan insertarse en la p√°gina HTML.
En la CPU s√≥lo se analizan sint√°cticamente los comandos AWP y, por ejemplo, se
sustituyen por valores del programa de usuario / memoria imagen de proceso de la CPU.
‚óè Los archivos que contienen comandos AWP deben estar codificados con UTF-8. Por esta
raz√≥n, ajuste el atributo charset a UTF-8 en los metadatos de la p√°gina HTML y guarde el
archivo codificado en UTF-8.
‚óè Los archivos que contienen comandos AWP no pueden contener la siguiente secuencia: ]]
‚óè Los archivos que contienen comandos AWP no pueden contener fuera de "Rangos de
lectura variables" (:=<Nombre de la variable>:) la siguiente secuencia: :=
Sugerencia: Sustituya el primer car√°cter de una secuencia prohibida por su c√≥digo de
car√°cter; para el car√°cter de dos puntos p. ej. &#58;.
Un peque√±o ejemplo de p√°gina web definida por el usuario pretende ilustrar la estructura
b√°sica.

Requisitos
‚óè La CPU debe disponer de un servidor web y √©ste debe estar activado.
‚óè El usuario debe haber iniciado sesi√≥n como "admin" para acceder en modo de escritura a
las variables PLC como usuario de p√°ginas web definidas por el usuario.
‚óè Para el ejemplo inferior, deben haberse definido variables PLC para las variables PLC que
deban mostrarse en la p√°gina web. Aqu√≠ se muestra el ejemplo de la primera variable PLC
utilizada "Tank_below_max".

Crear p√°ginas web definidas por el usuario
El siguiente c√≥digo para un ejemplo de p√°gina web lee valores de la memoria imagen de
proceso y los representa en una tabla.
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/
TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;
charset=utf-8">
<title>Mix</title>
</head>
<body>
<h1>Mix</h1>
<h2> Actual State </h2>
<table border="1">
<tr>
<th>Variable</th>
<th>State</th>
</tr>

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1475

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
<tr>
<td>Tank below max</td>
<td>:="Tank_below_max":</td>
</tr>
<tr>
<td>Tank above min</td>
<td>:="Tank_above_min":</td>
</tr>
</table>
</body>
</html>

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

P√°gina de usuario como p√°gina de inicio y recomendaciones sobre el tama√±o
Definici√≥n de una p√°gina de usuario como p√°gina de inicio
Definici√≥n de una p√°gina de usuario como p√°gina de inicio
Junto a la p√°gina Intro predeterminada, tambi√©n puede establecer la p√°gina de inicio de sus
p√°ginas de usuario como p√°gina de inicio del servidor web.

Requisitos
‚óè Ha configurado un usuario en STEP 7 que tiene asignado como m√≠nimo el derecho "...
Llamar p√°ginas de usuario".
‚óè La CPU est√° en estado operativo RUN.

Procedimiento
Para establecer las p√°ginas de usuario en STEP 7 como p√°gina de inicio del servidor web,
proceda de la siguiente forma:
1. Seleccione la CPU en la configuraci√≥n de dispositivos.
2. Abra los ajustes en la ventana de inspecci√≥n de la CPU, en "Propiedades > General >
Servidor web".
3. En el √°rea "P√°gina de acceso", en "Seleccionar p√°gina de acceso", seleccione la entrada
"AWP1".
Si introduce a continuaci√≥n la direcci√≥n IP de la CPU en el navegador, se establecer√°
autom√°ticamente una conexi√≥n con sus p√°ginas de usuario.
Si desea volver a acceder a las p√°ginas web de la CPU, enlace las p√°ginas web desde sus
p√°ginas de usuario; por ejemplo, mediante la URL "http://a.b.c.d./Portal/Portal.mwsl?

1476

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
PriNav=Start" o "https://a.b.c.d/Portal/Portal.mwsl?PriNav=Start". La indicaci√≥n "a.b.c.d"
representa a modo de ejemplo la direcci√≥n IP de la CPU configurada.
Ejemplo de enlace en HTML:
<a href="/Portal/Portal.mwsl?PriNav=Start">p√°ginas web SIMATIC</a>
Nota
Si establece su p√°gina de usuario como p√°gina de inicio del servidor web, se bloquear√°n todos
los accesos a las p√°ginas web de la CPU. Lo mismo se aplica a los marcadores guardados en
la CPU para las p√°ginas web de la CPU, as√≠ como la p√°gina de acceso a los datos de
mantenimiento.
Lectura de datos de mantenimiento
Si establece su p√°gina de usuario como p√°gina de inicio del servidor web, tambi√©n se
bloquear√° el acceso directo a la p√°gina web que contiene los datos de servicio.
Si en caso de reparaci√≥n desea poder leer los datos de mantenimiento mediante el servidor
web, enlace su p√°gina de datos de mantenimiento directamente desde su p√°gina de usuario.
Al igual que en las p√°ginas web de la CPU, la p√°gina de datos de mantenimiento se enlaza p.
ej. mediante la URL "http://a.b.c.d/save_service_data" o "https://a.b.c.d/save_service_data", la
indicaci√≥n "a.b.c.d" representa a modo de ejemplo la direcci√≥n IP de la CPU configurada.
Ejemplo de enlace en HTML:
<a href="/save_service_data">datos de mantenimiento</a>

Referencia
Encontrar√° m√°s informaci√≥n sobre el tema "p√°gina de usuario como p√°gina de inicio" en la
FAQ con la ID de art√≠culo 67184104 en la p√°gina de Internet del Service&Support (https://
support.industry.siemens.com/cs/ww/es/view/67184104).

Recomendaciones sobre el tama√±o de las p√°ginas web
Influencia del tama√±o de las p√°ginas web en la ocupaci√≥n de memoria y el rendimiento
Las p√°ginas HTML extensas, en especial las que contienen muchas im√°genes, requieren
mucho espacio de memoria de carga. Considere las siguientes sugerencias:
‚óè Para disponer de suficiente memoria de carga, seleccione una SIMATIC Memory Card con
suficiente capacidad de memoria.
‚óè Limite el volumen de datos de las p√°ginas HTML a 1 MB.
Si el volumen de datos de las p√°ginas HTML sobrepasa 1 MB, pueden verse afectados los
rendimientos, puesto que en la cach√© solo se guarda temporalmente 1 MB de datos.
‚óè Limite el tama√±o de un archivo de una p√°gina HTML a 512 KB.
Si un solo archivo de una p√°gina HTML sobrepasa los 512 KB, pueden aparecer problemas
al enviar un archivo desde el servidor web al navegador.
Visualice el tama√±o de los archivos en el explorador de archivos del directorio en el que se
encuentra la aplicaci√≥n web. De ser necesario y posible, reduzca el tama√±o de los archivos.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1477

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comandos AWP para controlar p√°ginas web
Utilizar comandos AWP en p√°ginas web
Con los comandos AWP (Automation Web Programming) se declara la interfaz entre sus
p√°ginas de usuario (aplicaci√≥n web, p. ej. una p√°gina HTML sencilla) y los datos de la CPU.
Para el desarrollo de p√°ginas de usuario o aplicaciones web solo existen las limitaciones que
especifican los navegadores web. Con el programa de usuario de la CPU se controla en uno
de los lenguajes de programaci√≥n de STEP 7 qu√© datos de la CPU deben mostrarse en el
navegador web del visitante y en qu√© momento.
Utilizando los comandos AWP, que se anotan en la p√°gina HTML, se acuerdan datos para la
interacci√≥n pretendida entre la aplicaci√≥n web y el programa de usuario.
Los comandos AWP se insertan en p√°ginas HTML como comentarios HTML con una sintaxis
especial. Los comandos AWP permiten aplicar las funciones siguientes:
‚óè leer variables PLC
‚óè escribir variables PLC
‚óè leer variables especiales
‚óè escribir variables especiales
‚óè definir los tipos Enum
‚óè asignar variables a los tipos Enum
‚óè definir fragmentos
‚óè importar fragmentos

Sintaxis de los comandos AWP
Un comando AWP empieza por "<!-- AWP_" y acaba por " -->". En los archivos de
Javascript, los comandos deben estar incluidos en comentarios de Javascript ("/*...*/").

Reglas de notaci√≥n para los nombres de variables PLC dentro de un comando AWP
Los comandos AWP "AWP_In_Variable" y "AWP_Out_Variable" contienen un atributo de
nombre y, de forma opcional, un atributo de uso. Estos atributos tienen asignado un nombre de
variable PLC a trav√©s del cual se escriben o leen variables PLC en el navegador. Para el uso
de nombres de variables PLC en c√≥digo HTML existen las siguientes reglas:
‚óè Las variables PLC deben indicarse entre comillas (" ... ").
‚óè En los comandos AWP, las variables PLC utilizadas deben indicarse, adem√°s de entre
comillas simples ('" ... "') o con una barra invertida (Backslash), con comillas enmascaradas
("\" ... \"").
‚óè Si el nombre de la variable PLC contiene el car√°cter \ (barra diagonal inversa) o *
(asterisco), este car√°cter debe identificarse con la secuencia de escape \\ como car√°cter
normal del nombre de la variable PLC. Encontrar√° ejemplos m√°s adelante.

1478

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Si el nombre de la variable PLC en el comando AWP se encuentra adicionalmente entre
comillas simples y dentro del nombre aparece la comilla simple ('), debe identificarse
asimismo con la secuencia de escape \' como car√°cter normal.
‚óè Si en el comando AWP se utiliza una direcci√≥n absoluta (entrada, salida, marca), deber√° ir
entre comillas simples.
Variable PLC

Variable PLC en c√≥digo HTML

"Velocity"

<!-- AWP_In_Variable Name='"Velocity"' -->
<!-- AWP_In_Variable Name="\"Velocity\"" -->

"abc\de"

<!-- AWP_In_Variable Name='"abc\\de"' -->

"abc'de"

<!-- AWP_In_Variable Name='"abc\'de"' -->

"abc'de"

<!-- AWP_In_Variable Name="abcde" Use'"abc\'de"' -->

"DB name".tag

<!-- AWP_In_Variable Name='"DB name".tag' -->

"Plc1".Data[1].typeDataStruct.value

<!-- AWP_In_Variable Name='"Plc1".Data[1].typeDataStruct.value' -->

-

<!-- AWP_Out_Variable Name=‚Äôflag1‚Äô Use='M0.0' -->

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Leer variables
Las p√°ginas web definidas por el usuario pueden leer variables PLC.
Cada variable PLC debe estar especificada con un nombre de variable PLC.
Estas variables Out (direcci√≥n de salida vista desde el controlador) se introducen en un lugar
cualquiera del texto HTML con la sintaxis que se describe a continuaci√≥n.

Sintaxis

:=<varname>:
Durante el funcionamiento, el servidor web sustituye estas referencias por los
correspondientes valores actuales de las variables PLC.
<varname> puede ser una variable PLC general sencilla, pero tambi√©n una ruta completa de
variables hacia un elemento de una estructura.

Reglas de notaci√≥n para los nombres de variables PLC
‚óè Las variables PLC en c√≥digo HTML deben ir entre comillas (") si han sido definidas en la
tabla de variables. En el caso de las variables de bloques de datos, el nombre del bloque
de datos debe ir entre comillas. Si se utilizan caracteres especiales en los elementos de
estructura del bloque de datos tales como, p. ej., el punto (.) o el espacio en blanco, esta
parte debe ir asimismo entre comillas.
‚óè No se utilizan las comillas para las direcciones absolutas de entradas, salidas o marcas.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1479

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Variable PLC

Variable PLC en c√≥digo HTML

"DB_name".var_name

:="DB_name".var_name:

"DB_name"."var.name"

:="DB_name"."var.name":

"memory"

:="memory":

-

:=I0.0:
:=Q0.0:
:=MW100:
:=%MW100:

"My_Data_Block".flag1

<!-- AWP_Out_Variable Name='flag1'
Use='"My_Data_Block".flag1' -->
...
:=flag1:

‚óè Si el nombre de variable PLC contiene los caracteres: (dos puntos) o \ (barra diagonal
inversa), estos caracteres deben identificarse con la secuencia de escape \: o \\ como
car√°cter normal del nombre de la variable PLC.
Variable PLC

Variable PLC en c√≥digo HTML

"abc:de"

:="abc\:de":

"abc\de"

:="abc\\de":

‚óè Caracteres especiales "<, &, >"
Si aparecen estos caracteres en el nombre de la variable (p. ej. "a<b"), pueden darse
problemas de representaci√≥n.
Evite expresiones tales como, p. ej. :="a<b": en la p√°gina HTML.
A fin de evitar problemas de representaci√≥n, utilice p. ej. un comando AWP con una
expresi√≥n Use siguiendo el patr√≥n que se muestra a continuaci√≥n. El atributo Use define la
variable PLC con los caracteres problem√°ticos, el atributo Name define el nombre sin
caracteres problem√°ticos, tal y como se utiliza en la p√°gina HTML.
Variable PLC
"a<b"

Variable PLC en c√≥digo HTML
<!-- AWP_Out_Variable Name='simplename'
Use='"a<b"' -->
...
:=simplename:

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Particularidades de las variables PLC del tipo String y Character
Lectura de variables del tipo String y Character
En adelante se utilizan estos tipos de comillas para fines explicativos: comillas simples ('),
comillas dobles (").

1480

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
A partir de la versi√≥n de firmware V1.6, al ejecutar la funci√≥n "Leer variables PLC", la CPU
emite variables del tipo String o Character al navegador entre comillas simples.
Ejemplo:
‚óè Variable String "Varname".MyString = ABC
‚óè La variable se lee en HTML mediante la funci√≥n :="Varname".MyString:
‚óè El servidor web emite la secuencia de caracteres 'ABC' al navegador

Uso de variables String o Character en expresiones
En la p√°gina HTML se utiliza una expresi√≥n en la que la secuencia de caracteres para leer una
variable est√° entre comillas, p. ej. en formularios.
Posible c√≥digo HTML utilizado:
<input type="text" name="appfield" value="myvalue">
Si en esta expresi√≥n se lee el valor visualizado para el atributo "value" desde una variable PLC,
el c√≥digo HTML tendr√° el aspecto siguiente:
<input type="text" name="appfield" value=":="Varname".MyString:">
La lectura de la variable PLC hace que el servidor web emita el valor 'ABC'. En HTML, el c√≥digo
se representa del siguiente modo:
<input type="text" name="appfield" value=" 'ABC' ">
Si en el c√≥digo HTML se han utilizado comillas simples en lugar de dobles para encerrar los
atributos, el servidor web devolver√° el contenido de la variable al navegador entre dos comillas
simples. Esto hace que el navegador no emita el contenido de la variable String o Character,
pues dos comillas simples seguidas forman una secuencia cerrada, respectivamente. Los
valores que deben leerse se encuentran entre estas dos secuencias y el navegador no los
emite.
Tenga en cuenta en particular que la secuencia de caracteres de las comillas dobles no es
id√©ntica a la de dos comillas simples, aunque a primera vista s√≠ lo parezca.
Nota
La adaptaci√≥n del c√≥digo no se realiza autom√°ticamente con la actualizaci√≥n a un firmware
V1.6 o superior.
Adapte su c√≥digo HTML si ha empleado comillas simples para encerrar los atributos en la
funci√≥n "Leer variables PLC".

&¬µGLJR+70/
6DOLGDHQHOQDYHJDGRUDWUDY¬´VGHOVHUYLGRUZHE
6HFXHQFLDVOH¬ØGDVUHDOPHQWH

YDOXH ' 9DUQDPH0\6WULQJ'!
YDOXH ' '$%&' '!
YDOXH ''$%&''!

6HFXHQFLD

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

6HFXHQFLD

1481

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Escribir variables
Las p√°ginas web definidas por el usuario pueden escribir datos en la CPU.
Para ello, se requiere un comando AWP que identifique la variable PLC que hay que escribir.
Adem√°s, cada variable PLC debe estar especificada con un nombre de variable PLC.
Las variables In (direcci√≥n de entrada vista desde el controlador) se activan en la p√°gina del
navegador. Esto puede efectuarse, por ejemplo, en los formularios.
El navegador activa las variables en el HTTP-Request ya sea en el encabezado de HTTP (por
cookie o m√©todo POST) o en la URL (m√©todo GET) y, a continuaci√≥n, el servidor web las
escribe en la correspondiente variable PLC.

Sintaxis
Para que las variables In puedan escribirse en la CPU, es necesario definirlas con una
instrucci√≥n AWP expl√≠cita:
<!-- AWP_In_Variable Name='"<Varname1>"' Name='"<Varname2>"'
Name='"<Varname3>"' -->
En una instrucci√≥n puede haber varias variables definidas (como puede verse arriba).
En el caso en que el nombre de la variable que utilice para la aplicaci√≥n web no sea id√©ntico
al nombre de la variable PLC, puede realizarse la asignaci√≥n a una variable PLC con el
par√°metro "Use".
<!-- AWP_In_Variable Name=‚Äô<Varname_Webapp>‚Äô Use=‚Äô<PLC_Varname>‚Äô

Ejemplo
El comando AWP "AWP_In_Variable" es imprescindible, especialmente para el tratamiento de
formularios.
<form method="post" action="/awp/appl/x.html">
<p>
<input name='"var1"' type="text">
<input value="set" name='"Button1"' type="submit">
</p>
</form>
En el formulario antes definido, se transmiten las variables "var1" y "Button1" por "post" al
servidor web. El usuario activa la variable "var1" en el campo del formulario. La variable
"Button1" tiene el valor fijo "set". Para que las variables "var1" y "Button1" puedan escribirse en
la CPU, debe incluirse la siguiente instrucci√≥n en el mismo fragmento:
<!-- AWP_In_Variable Name='"var1"' Name='"Button1"' -->
Puesto que las variables generales deben ir entre comillas, el nombre en el comando AWP
debe ir entre ap√≥strofes o entre comillas con una barra inversa (\").
<!-- AWP_In_Variable Name=‚Äô"Info".par1‚Äô -->

Condiciones para el acceso en escritura durante el funcionamiento
Para que un usuario pueda escribir en variables PLC desde una p√°gina web definida por el
usuario, debe cumplirse el siguiente requisito:
‚óè Se ha configurado un usuario y √©ste ha iniciado una sesi√≥n.

1482

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Esta regla es v√°lida en principio para todos los accesos en escritura de p√°ginas web a una
CPU.

Consulte tambi√©n
Administraci√≥n de usuarios (P√°gina 1467)
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Variables especiales
Las variables especiales son principalmente las variables HTTP que aparecen en las
definiciones del World Wide Web Consortium (W3C) . Tambi√©n se utilizan variables especiales
para las cookies y las variables de servidor.
Los comandos AWP para leer y escribir variables especiales s√≥lo se diferencian por los
par√°metros adicionales de los comandos AWP para leer y escribir variables normales.

Leer variable especial
El servidor web puede leer variables PLC y entregarlas a variables especiales en el
encabezado de respuesta HTTP. Puede p. ej. leer una URL para un desv√≠o a otra p√°gina web
y entregarla a la variable especial HEADER:Location sirvi√©ndose de la variable especial
HEADER:Location.
Pueden leerse las siguientes variables especiales:
Nombre

Descripci√≥n

COOKIE_VALUE:name

Valor de la cookie con el nombre: "name"

COOKIE_EXPIRES:name

Tiempo de ejecuci√≥n de la cookie con el nombre:
"name" en segundos (debe haberse activado con
antelaci√≥n).

HEADER:Status

C√≥digo de estado HTTP (si no se ha introducido
ning√∫n otro valor, se devolver√° el c√≥digo de esta‚Äê
do 302).

HEADER:Location

Ruta para la derivaci√≥n a otra p√°gina. El c√≥digo de
estado 302 debe estar activado.

HEADER:Retry-After

Tiempo durante el que previsiblemente el servicio
no estar√° disponible. El c√≥digo de estado 503 de‚Äê
be estar activado.

HEADER: ‚Ä¶

El resto de las variables de encabezado tambi√©n
puede transmitirse de este modo.

Con el comando AWP "AWP_Out_Variable" se determinan las variables PLC que deben
transferirse al navegador web en el encabezado de HTTP.
Estructura general:

<!-- AWP_Out_Variable Name="<Typ>:<Name>" [Use="<Varname>"] -->

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1483

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Descripci√≥n de par√°metros
‚óè Name: tipo y nombre de la variable especial
‚óè Use (par√°metro opcional): en caso de que el nombre de la variable especial no sea id√©ntico
al nombre de la variable PLC, puede realizarse la asignaci√≥n a una variable PLC con el
par√°metro "Use".
Ejemplo:

<!-- AWP_Out_Variable Name="COOKIE_VALUE:siemens" Use='"info".language' -->

Escribir una variable especial
En principio, el programa de usuario de la CPU puede evaluar todas las variables HTTP
escritas por el navegador web en el encabezado de HTTP. Ejemplos de tipos de variables:
Nombre

Descripci√≥n

HEADER:Accept-Language

Idioma aceptado o preferente

HEADER:Authorization

Prueba de autorizaci√≥n para un recurso solicitado

HEADER:Host

Host y puerto del recurso solicitado

HEADER:User-Agent

Informaci√≥n sobre el navegador

HEADER: ‚Ä¶

El resto de las variables de encabezado tambi√©n
puede transmitirse de este modo

SERVER:current_user_id

Indica si un usuario ha iniciado una sesi√≥n (cu‚Äê
rrent_user_id=0: ning√∫n usuario ha iniciado una
sesi√≥n)

SERVER:current_user_name

Nombre del usuario que ha iniciado la sesi√≥n

SERVER:GET

El m√©todo Request es GET

SERVER:POST

El m√©todo Request es POST

COOKIE_VALUE:name

Valor de la cookie con el nombre: "name"

Con el comando AWP "AWP_In_Variable" se determinan las variables especiales que deben
evaluarse en el programa de usuario de la CPU.
Estructura general:

<!-- AWP_In_Variable Name="<Typ>:<Name>" [Use="<Varname>"] -->

Descripci√≥n de par√°metros:
Name: tipo y nombre de la variable especial
Use (par√°metro opcional): en caso de que el nombre de la variable especial no sea id√©ntico al
nombre de la variable PLC, puede realizarse la asignaci√≥n a una variable PLC con el
par√°metro Use .

1484

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplos:
<!-- AWP_In_Variable Name="COOKIE_VALUE:siemens" Use='"info".language' -->

El nombre de la variable en el encabezado de HTTP se sustituye por el nombre de la variable
PLC indicado en Use . La cookie se escribe en la variable PLC "info".language .

<!-- AWP_In_Variable Name='COOKIE_VALUE:siemens' Use='"info".language' -->

El nombre de la variable en el encabezado de HTTP se sustituye por el nombre de la variable
PLC indicado en Use. La cookie se escribe en la variable PLC "info".language .

<!-- AWP_In_Variable Name='"COOKIE_VALUE:siemens"' -->

La variable del encabezado HTTP se escribe en la variable PLC del mismo nombre.

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Tipos de enumeraciones
Tipos de "enumerations" (Enums)
Con la ayuda de los Enums, los valores num√©ricos del programa del PLC pueden convertirse
en texto y viceversa. La asignaci√≥n de los valores num√©ricos tambi√©n puede realizarse para
m√°s de un idioma.

Crear Enums
Introduzca un comando AWP utilizando la siguiente sintaxis al principio del archivo HTML:
<!-- AWP_Enum_Def Name="<Nombre del tipo de Enum>"
Values='0:"<Text_1>", 1:"<Text_2>", ... , x:"<Text_x>"' -->
Para guardar, por ejemplo, valores alemanes como archivo HTML en la carpeta "de" del
directorio HTML:

<!-- AWP_Enum_Def Name="Enum1" Values='0:"an", 1:"aus", 2:"St√∂rung"' -->

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1485

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para guardar, por ejemplo, valores ingleses como archivo HTML en la carpeta "en" del
directorio HTML:

<!-- AWP_Enum_Def Name="Enum1" Values='0:"on", 1:"off", 2:"error"' -->

Asignar Enums
La asignaci√≥n de las variables del programa de usuario a cada uno de los textos Enum se
realiza con un comando AWP propio:

<!-- AWP_Enum_Ref Name="<VarName>" Enum="<EnumTypeName>" -->

<VarName> representa el nombre simb√≥lico del programa de usuario y <EnumTypeName>, el
nombre definido anteriormente del tipo Enum.
Nota
En todos los fragmentos en los que una variable PLC referencie textos Enum, esta variable
PLC debe asignarse junto con el correspondiente comando AWP al nombre del tipo de Enum.
Se debe tener en cuenta que entre una asignaci√≥n Enum y el uso de Enum no existe ning√∫n
comando AWP para importar fragmentos debido a que esta importaci√≥n hace que la
asignaci√≥n Enum se encuentre en otro fragmento que el uso de Enum.

Ejemplo
Se ha definido un tipo de Enum "estado" con los valores "0" y "1". "0" equivale a "off", mientras
que "1" equivale a "on":

<!-- AWP_Enum_Def Name="estado" Values='0:"off", 1:"on"' -->

El c√≥digo HTML de la p√°gina web que debe visualizarse contiene el siguiente c√≥digo:

<!-- AWP_Enum_Ref Name="estado operativo" Enum="estado" -->
:=estado operativo:

En funci√≥n del valor de la variable "estado operativo", ya no se muestra "0" √≥ "1" como
resultado, sino "off" u "on".

Uso simplificado de tipos de enumeraci√≥n
En las CPU S7-1200 a partir de la versi√≥n 4 del firmware es posible emplear enumeraciones
directamente en comandos AWP para leer y escribir variables PLC.

1486

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Cree enumeraciones como se ha descrito en el p√°rrafo anterior para poder utilizar los valores
con comandos AWP de lectura y escritura.

Crear Enums

<!-- AWP_Enum_Def Name="<Name des Enum Typs>" Values='0:"<Text_1>",
1:"<Text_2>", ... , x:"<Text_x>"' -->

Uso de Enums en comandos AWP de escritura y lectura

<!-- AWP_In_Variable Name='<Varname>' Enum="<EnumType>" -->
<!-- AWP_Out_Variable Name='<Varname>' Enum="<EnumType>" -->

Ejemplo de lectura de variables PLC

<!-- AWP_Enum_Def Name='AlarmEnum' Values='0:"No alarms", 1:"Tank is
full", 2:"Tank is empty"' --><!-- AWP_Out_Variable Name='"Alarm"'
Enum="AlarmEnum" -->...<p>The current value of "Alarm"
is :="Alarm":</p>
Si el valor de "Alarma" est√° en la CPU "2", en la p√°gina HTML se muestra el siguiente texto:
'The current value of "Alarm" is Tank is empty' porque la definici√≥n de Enum asigna al string
"Tank is empty" el valor num√©rico 2.

Ejemplo de escritura de variables PLC

<!-- AWP_Enum_Def Name='AlarmEnum' Values='0:"No alarms", 1:"Tank is
full", 2:"Tank is empty"' --><!-- AWP_In_Variable Name='"Alarm"'
Enum='AlarmEnum' -->...
<form method="POST">
<p><input type="hidden" name='"Alarm"' value="Tank is full" /></p>
<p><input type="submit" value='Set Tank is full' /></p>
</form>
Como la definici√≥n de Enum asigna al string "Tank is full" el valor num√©rico "1", el valor "1" se
escribe en la variable PLC"Alarm".

Utilizaci√≥n de matrices
El servidor web proporciona los comandos AWP AWP_Start_Array y AWP_End_Array para
acceder a todos los valores de una matriz.
Solo se soportan matrices unidimensionales.
No se soportan matrices multidimensionales del tipo array[x][y].

Sintaxis

<!-- AWP_Start_Array Name='"<DB name>".<array name>' -->
... Contenido del array, palabras clave empleadas: ArrayIndex y
value..
<!-- AWP_End_Array -->

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1487

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros
<Nombre>

Define el nombre de la matriz a cuyos elementos se desea acceder.
Se necesitan el nombre del DB y el nombre de la matriz seg√∫n la estructura de
bloques de datos definida en STEP 7.
El nombre debe estar entre comillas simples o dobles. El nombre del DB est√° entre
comillas dobles.

<ArrayIndex>

√çndice de un elemento de matriz

<value>

Valor de un elemento de matriz

Ejemplo
En este ejemplo, la CPU lee todos los elementos de la estructura "MyArray" en el bloque de
datos "DB_Name" y muestra el √≠ndice y los valores de las variables en la p√°gina web definida
por el usuario.

<!-- AWP_Start_Array Name='"DB_Name".MyArray' -->
√çndice: :=ArrayIndex: Valor: :=value:
<!-- AWP_End_Array -->
El c√≥digo que se muestra m√°s arriba genera las indicaciones siguientes:
√çndice: 1 Valor: 42
√çndice: 2 Valor: 43
√çndice: 3 Valor: 44

Representaci√≥n de arrays del tipo de datos Bool en S7-1500
La salida de arrays del tipo booleano se rellena siempre hasta los 8 bits completos siguientes.
Esta particularidad solo se presenta en arrays del tipo booleano.
Ejemplo:
"DB_1".bitArray es un array booleano de 5 elementos.
<!-- AWP_Start_Array Name='"DB_1".bitArray' -->
:=ArrayIndex: -> :=value:
<!-- AWP_End_Array -->
Salida:
0 -> valor de "DB_1".bitArray[0]
1 -> valor de "DB_1".bitArray[1]
2 -> valor de "DB_1".bitArray[2]

1488

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3 -> valor de "DB_1".bitArray[3]
4 -> valor de "DB_1".bitArray[4]
5 -> 0
6 -> 0
7 -> 0

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Utilizaci√≥n de estructuras
El servidor web proporciona los comandos AWP para acceder a estructuras y poder acceder
a los valores de una variable PLC del tipo de datos STRUCT.

Sintaxis

<!-- AWP_Start_Struct Name='"<DB name>".<struct name>' -->
... Contenido de la estructura ...
<!-- AWP_End_Struct -->

Par√°metros
<Nombre>

Define el nombre de la estructura a cuyos elementos se desea acceder.
Se necesitan el nombre del DB y el nombre de la estructura seg√∫n la estructura de
bloques de datos definida en STEP 7.
El nombre debe estar entre comillas simples o dobles. El nombre del DB est√° entre
comillas dobles.

Ejemplo
En este ejemplo, la CPU lee elementos de la estructura "MyStruct" en el bloque de datos
"DB_Name" y muestra el valor de la variable en la p√°gina web definida por el usuario.

<!-- AWP_Start_Struct Name='"DB_Name".MyStruct' -->
:=A:
:=B:
:=C:
<!-- AWP_End_Struct -->
El c√≥digo que se muestra m√°s arriba corresponde a los comandos siguientes:
Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1489

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
:="DB_Name".MyStruct.A:
:="DB_Name".MyStruct.B:
:="DB_Name".MyStruct.C:

Reglas para matrices y estructuras
Las matrices y las estructuras pueden estar interconectadas.

Reglas
Los comandos AWP_Start_Array y AWP_End_Array deben utilizarse por parejas. No pueden
solaparse.
Estructura admisible:
AWP_Start_Array
AWP_Start_Struct
AWP_End_Struct
AWP_End_Array
Estructura no admisible (solapamiento):
AWP_Start_Array
AWP_Start_Struct
AWP_End_Array
AWP_End_Struct

Definir fragmentos
Fragmentos
Se entiende por fragmentos cada una de las "unidades de significado" de una p√°gina web que
debe procesar la CPU.
Los fragmentos suelen ser p√°ginas enteras, aunque tambi√©n pueden ser elementos
individuales como archivos (p. ej. im√°genes) o documentos enteros.

Definir fragmentos
<!-- AWP_Start_Fragment Name="<Name>" [Type="<Type>"] [ID="<Id>"]
[Mode=<Mode>]-->

1490

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Con este comando se define el inicio de un fragmento. Un fragmento se extiende hasta el
principio del siguiente fragmento o hasta el final del archivo.
‚óè <Name> indica el nombre del fragmento.
El nombre debe comenzar con una letra [a-zA-Z] o un car√°cter de subrayado ( _ ). Tras este
primer car√°cter pueden aparecer letras, caracteres de subrayado o n√∫meros [0-9].
‚óè <Type> indica el tipo de fragmento.
‚Äì "manual" El programa de usuario se informa mediante el Request de un fragmento de
que es posible realizar cambios en la p√°gina web que debe devolverse con el programa
de usuario.
‚Äì "automatic" La p√°gina se edita autom√°ticamente (por defecto).
‚óè <id> para el fragmento puede predefinirse una ID num√©rica. Si no se especifica ninguna ID,
se asignar√° autom√°ticamente una ID al fragmento. En el caso de p√°ginas manuales
(<Type>=manual) puede accederse al fragmento en el programa de usuario de la CPU con
esta ID.
Nota
Es necesario establecer una ID baja, ya que la ID m√°s alta condiciona el tama√±o del DB
Web Control.
‚óè <Mode> Los fragmentos son compatibles con ambos modos: visible y hidden.
‚Äì "visible": el fragmento forma parte de la p√°gina web. Este modo est√° predeterminado y
puede omitirse.
‚Äì "hidden": el fragmento no forma parte de la p√°gina web, pero se guarda en el DB web y
est√° disponible para que el programa de usuario lo agregue a una p√°gina web solicitada.
Intercambiando los ID de fragmento (Variable del DB Web Control fragment_index) se
agrega un fragmento "oculto" a la p√°gina web solicitada.
Con el comando "AWP_Start_Fragment", el documento Input se divide completamente en
fragmentos. Por este motivo, no es necesario un "AWP_End_Fragment".
Sin un comando de inicio de fragmento, un archivo se reproduce como un fragmento cuyo
nombre se deriva del nombre del archivo. Si un archivo se descompone en varios fragmentos
(mediante "AWP_Start_Fragment"), el archivo debe empezar por el comando
"AWP_Start_Fragment".

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Importar fragmentos
Existe la posibilidad de declarar un fragmento en una p√°gina HTML e importar dicho fragmento
a otras p√°ginas web.

Ejemplo
El logotipo de un empresa debe mostrarse en todas las p√°ginas web de una aplicaci√≥n web.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1491

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El c√≥digo HTML para el fragmento que muestra el logotipo de la empresa s√≥lo existe una vez.
El fragmento puede importarse tantas veces y a tantos archivos HTML como sea necesario.

Sintaxis
<!-- AWP_Import_Fragment Name = "<name>"-->

‚óè <name> es el nombre del fragmento que se desea importar.

Ejemplo
C√≥digo HTML dentro de una p√°gina web que declara un fragmento:

<!-- AWP_Start_Fragment Name = "My_Company_Logo" -->
<p><img src = "compay_logo.jpg"></p>

Ejemplo
C√≥digo HTML dentro de otra p√°gina web que importa el fragmento declarado:

<!-- AWP_Import_Fragment Name = "My_Company_Logo" -->

Generar y cargar bloques de datos
Requisitos
‚óè Se han creado todos los archivos de origen necesarios (*.html, *.js, *.png...) para la
aplicaci√≥n web.
‚óè Los archivos de origen est√°n en una carpeta, pero s√≥lo los archivos de origen que son
necesarios para la aplicaci√≥n web. En esta carpeta no debe haber otros archivos.
Nota
Longitud de los nombres de archivos y variables
Si tiene una aplicaci√≥n web amplia, con muchos archivos y directorios, es posible que fracase
la generaci√≥n de los bloques de datos web. En este caso, la generaci√≥n se cancela con el
mensaje "Lista de textos desbordada...". La causa son limitaciones internas del tama√±o de la
informaci√≥n administrativa que se guardar√° en el bloque de datos web.
Soluci√≥n: utilice nombres de archivo y nombres de variable cortos.

1492

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento
Para generar bloques de datos a partir de los archivos de origen para las p√°ginas web
definidas por el usuario en STEP 7, proceda del siguiente modo:
1. Seleccione la CPU, p. ej. en la configuraci√≥n de dispositivos.
2. Seleccione las propiedades para las p√°ginas web definidas por el usuario "Propiedades >
General > Servidor web" de la ventana de inspecci√≥n.
3. Como "fuente HTML" debe seleccionarse la carpeta en la que se encuentran los archivos
de origen para la aplicaci√≥n web.
4. Como p√°gina de inicio HTML debe introducirse la p√°gina HTML que deba abrirse al iniciar
la aplicaci√≥n web.
5. Si es necesario, introduzca el nombre de una aplicaci√≥n.
6. Si es necesario, complemente la serie de extensiones de nombres de archivos como
"archivos con contenido din√°mico". S√≥lo deben introducirse las extensiones de nombres de
archivos que contengan comandos AWP.
7. El n√∫mero del DB Web Control y del inicio del DB de fragmento pueden conservarse si no
est√°n ocupados por el programa de usuario.
8. Haga clic en el bot√≥n "Generar" para generar DBs a partir de los archivos de origen.
Los bloques de datos generados se depositan en la carpeta "Bloques de sistema"
(subcarpeta "Servidor web") del √°rbol del proyecto.
9. En la vista de redes, seleccione la CPU que debe cargarse y elija el comando "Cargar en
dispositivo" en el men√∫ "Online" para cargar los bloques. Antes de la carga se iniciar√°
impl√≠citamente la compilaci√≥n de los bloques.
En caso de que se notifiquen fallos durante este proceso, deben solucionarse antes de
cargar la configuraci√≥n.

Estructura del programa del PLC
El programa de usuario debe llamar la instrucci√≥n " WWW" para que la aplicaci√≥n web, es
decir, las p√°ginas web definidas por el usuario, est√©n disponibles en las p√°ginas web est√°ndar
de la CPU y puedan abrirse.
El DB de Web Control generado a partir de los archivos de origen es el par√°metro de entrada
(CTRL_DB) para la instrucci√≥n "WWW". El DB de Web Control referencia el contenido de las
p√°ginas web definidas por el usuario que est√° codificado en los DBs de fragmento y contiene
informaci√≥n de estado y control.

Llamada de la instrucci√≥n "WWW" en el programa de arranque
Para evitar que el programa de usuario no influya en p√°ginas web solicitadas, basta con llamar
una sola vez la instrucci√≥n "WWW" en un OB de arranque. La instrucci√≥n inicializa la
comunicaci√≥n entre el servidor web y la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1493

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Llamada de la instrucci√≥n "WWW" en el programa c√≠clico
La llamada de la instrucci√≥n "WWW" tambi√©n puede producirse en un OB procesado
c√≠clicamente (p. ej. el OB 1). Esto ofrece la ventaja de que pueden aceptarse solicitudes del
servidor web en el programa de usuario. Para ello, deben utilizarse fragmentos manuales.
En este caso, hay que evaluar informaci√≥n del DB de Web Control para identificar la p√°gina
web solicitada o el fragmento solicitado. Por otra parte, es necesario activar un bit en el
programa de usuario para habilitar expl√≠citamente la p√°gina web que debe proporcionar el
servidor web despu√©s de procesar la solicitud de p√°gina web.
La estructura del DB de Web Control se describe en el siguiente apartado.

DB de Web Control
El DB de Web Control (por defecto, DB 333) es generado por STEP 7 y contiene informaci√≥n
sobre la estructura de las p√°ginas de usuario, el estado de la comunicaci√≥n y posibles errores
producidos.
Adem√°s del DB de Web Control, tambi√©n se crean los DBs de fragmento. Estos DBs de
fragmento (tambi√©n puede ser un solo DB de fragmento) se referencian en el DB de Web
Control. Los DBs de fragmento contienen las p√°ginas web y los datos de medios (p. ej.
im√°genes) codificados en fragmentos. El contenido de los DBs de fragmento no puede
modificarse con el programa de usuario. Se crean autom√°ticamente y s√≥lo sirven para la
gesti√≥n de datos.
A las variables de estado y control del DB de Web Control se accede de forma simb√≥lica.
A continuaci√≥n, se indican las variables del DB de Web Control necesarias para la evaluaci√≥n
de estado y el control de la interacci√≥n.
Pueden obtenerse dos tipos de informaci√≥n del DB de Web Control:
‚óè Informaci√≥n de estado general: informaci√≥n no vinculada a ninguna solicitud de p√°gina web
concreta (Request).
‚óè Informaci√≥n de estado y control de Request: informaci√≥n sobre Requests pendientes.

Informaci√≥n de estado general
"WEB-Control_DB".commandstate.init
"WEB-Control_DB".commandstate.deactivate
"WEB-Control_DB".commandstate.inititiali‚Äê
zing
"WEB-Control_DB".commandstate.error

Activa e inicializa la aplicaci√≥n web.
Desactiva la aplicaci√≥n web.
Se inicializa la aplicaci√≥n web (leer DB de
Web Control, etc.).
No se ha podido inicializar la aplicaci√≥n web.
El motivo est√° codificado in "WEB-Con‚Äê
trol_DB".commandstate.last_error .
"WEB-Control_DB".commandstate.deactiva‚Äê Se finaliza la aplicaci√≥n web.
ting
"WEB-Control_DB".commandstate.initialized Se ha inicializado la aplicaci√≥n web y √©sta ya
est√° lista.
"WEB-Control_DB".commandstate.last_error Tabla de valores de posibles errores (v√©ase
tabla siguiente).

1494

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Last_error

Descripci√≥n

1

El DB de fragmento es incoherente (no es compatible con el DB de Web Control).

2

Ya existe una aplicaci√≥n web con este nombre.

3

Problema de memoria al inicializar en el servidor web.

4

Los datos del DB de Web Control son incoherentes.

5

Un DB de fragmento no est√° disponible (no est√° cargado).

6

Un DB de fragmento no tiene identificaci√≥n AWP.

7

El fragmento Enum (contiene los textos e informaci√≥n para los tipos Enum) no est√°
disponible.

8

Una acci√≥n solicitada a trav√©s de las marcas de comando en el DB de Web Control
no est√° permitida en el estado actual.

9

La aplicaci√≥n web no est√° inicializada (si no se produce una nueva inicializaci√≥n tras
la desactivaci√≥n).

10

El servidor web est√° desactivado.

...

Se desactiva Last_error si la aplicaci√≥n web se ha inicializado correctamente.

Informaci√≥n de estado de Request
La informaci√≥n de estado de Request est√° vinculada a uno de los cuatro Requests posibles, x
= [1 ‚Ä¶ 4].
"WEB-Control_DB".requesttab[x].idle
"WEB-Control_DB".requesttab[x].waiting

"WEB-Control_DB".requesttab[x].sending
"WEB-Control_DB".requesttab[x].aborting

No hay que hacer nada.
El programa de usuario debe responder a un
Request de un fragmento manual e iniciar ex‚Äê
pl√≠citamente el procesamiento posterior en el
servidor web.
El servidor web est√° ocupado con el procesa‚Äê
miento de Requests/fragmentos.
El servidor web cierra la conexi√≥n TCP.

Informaci√≥n de control de Request
La informaci√≥n de control de Request est√° vinculada a uno de los cuatro Requests posibles, x
= [1 ‚Ä¶ 4].
"WEB-Control_DB".requesttab[x].continue
"WEB-Control_DB".requesttab[x].repeat
"WEB-Control_DB".requesttab[x].abort
"WEB-Control_DB".requesttab[x].finish

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Habilita el fragmento que se acaba de proce‚Äê
sar para su transmisi√≥n. Se inicia el procesa‚Äê
miento del siguiente fragmento.
Habilita el fragmento que se acaba de proce‚Äê
sar para su transmisi√≥n. A continuaci√≥n, el
fragmento se procesa de nuevo.
Cierra la conexi√≥n TCP.
Habilita el fragmento que se acaba de proce‚Äê
sar para su transmisi√≥n. Detiene el procesa‚Äê
miento posterior de fragmentos (finaliza el Re‚Äê
quest).

1495

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo:
La variable para el DB es la siguiente: "WEB-Control_DB". Con el bit "WEBControl_DB".commandstate.error del programa de usuario puede consultarse si se han
producido errores durante la inicializaci√≥n de la aplicaci√≥n web.
En caso de que se haya producido un error, √©ste puede analizarse con el valor de "WEBControl_DB".commandstate.last_error.

Interacci√≥n con el programa de usuario
Con la ayuda de los fragmentos manuales, se consigue que el programa de usuario reaccione
a las entradas del navegador de forma s√≠ncrona y pueda preparar la p√°gina web que se debe
devolver.

Tipo de fragmento
Para poder reaccionar directamente a los datos recibidos en el programa de usuario deber√°
utilizarse el tipo de fragmento "manual" para el fragmento que escribe los datos (para "P√°ginas
manuales"):
<!-- AWP_Start_Fragment Name="testfrag" ID="1" Type="manual" -->
La transmisi√≥n de los valores al servidor web de la CPU siempre se realiza del mismo modo en
las p√°ginas autom√°ticas y manuales:
Ejemplo:
<form method="POST" action="">
<p>
<input type="submit" value="Set new value">
<input type="text" name='"Velocity"' size="20">
</p>
</form>

Programa de usuario para fragmentos manuales
En el programa de usuario de la CPU debe accederse a la instrucci√≥n "WWW" (SFC 99) de
forma c√≠clica durante el uso de p√°ginas manuales.
Para poder reaccionar a los valores introducidos en el navegador ser√° necesario evaluar, en
el programa de usuario, el request que ajusta la p√°gina manual al servidor web. Para ello, el
DB de Web Control (p. ej. DB 333) debe analizarse c√≠clicamente por si tiene alg√∫n request
pendiente. En el apartado "requesttab" del DB de Web Control se encuentra la matriz que
gestiona cuatro requests. Cada elemento del array contiene, en una estructura, informaci√≥n
sobre el request en cuesti√≥n.

1496

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Un ejemplo simple de programa AWL muestra c√≥mo se comprobar√° mediante las variables del
DB de control web la existencia de requests pendientes.

A
JCN
L
L
JU
R2:
A
JCN
L
L
JU
R3:
A
JCN
L
L
JU
R4:
A
JCN
L
L
JU
NoRq: L
T
T
JU
PdRq: T
POP
T
Exit: BE

"WEB-Control_DB".requesttab[1].waiting
R2
"WEB-Control_DB".requesttab[1].fragment_index
1
PdRq
// request pending
"WEB-Control_DB".requesttab[2].waiting
R3
"WEB-Control_DB".requesttab[2].fragment_index
2
PdRq
// request pending
"WEB-Control_DB".requesttab[3].waiting
R4
"WEB-Control_DB".requesttab[3].fragment_index
3
PdRq
// request pending
"WEB-Control_DB".requesttab[4].waiting
NoRq
"WEB-Control_DB".requesttab[4].fragment_index
4
PdRq
// request pending
0
#frag_index
#req_index
Exit
#req_index
#frag_index

En el caso de que est√© activado un request, escribir√° el apartado de programa AWL la ID de
fragmento en la variable #frag_index , y el n√∫mero de request (√°rea de valor 1-4) en la
variable#req_index.
Con la informaci√≥n obtenida puede procesarse expresamente la informaci√≥n transferida en el
request en el programa AWL para cada ID de fragmento (p. ej., prueba de plausabilidad).
Cuando el procesamiento del request concluye mediante el programa AWL, deber√°
responderse a dicho request y restablecer la entrada en cuesti√≥n desde el "requesttab" del DB
de control web (p. ej., DB 333).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1497

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Un ejemplo simple de programa AWL para responder los requests:

SET

Con0:
Con1:
Con2:
Con3:
Con4:
Exit:

1498

L
JL
JU
JU
JU
JU
JU
JU
=
JU
=
JU
=
JU
=
JU
BE

#req_index
Con0
Con0
Con1
Con2
Con3
Con4
Exit
"WEB-Control_DB".requesttab[1].continue
Exit
"WEB-Control_DB".requesttab[2].continue
Exit
"WEB-Control_DB".requesttab[3].continue
Exit
"WEB-Control_DB".requesttab[4].continue
Exit

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Secuencia b√°sica de un request del navegador con interacci√≥n del programa de usuario
La figura siguiente muestra la secuencia b√°sica y simplificada de un request del navegador
web sobre los efectos en los contenidos del DB de Web Control y las acciones necesarias del
programa de usuario hasta la devoluci√≥n de la p√°gina web preparada (Response).

5HVSRQVH
:HEEURZVHU

5HTXHVW

3URJUDPDGHXVXDULR

'%GHFRQWUROGH
ZHE

6HUYLGRUZHE

&38
3UHSDUDUUHTXHVW

3UHSDUDUUHVSRQVH

'%ZDLWLQJ 758(

'%UHTFRQWLQXH 758(

$FWLYDYDULDEOHV,1
WDEODGHGDWRV

(VFULEHYDULDEOHV287
WDEODGHGDWRV

 ,GHQWLILFDU
S¬£JLQD UHTXHVW
VROLFLWDGD

 $QDOL]DU
SRUFHVDU
YDULDEOHV,1
HVWDEOHFHU
YDULDEOHV287

 +DELOLWDU
S¬£JLQDVROLFLWDGD

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1499

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Visualizaci√≥n de p√°ginas web definidas por el usuario en el navegador
Visualizar p√°ginas web en el navegador
Las p√°ginas web se abren desde las p√°ginas web est√°ndar del navegador web.
Las p√°ginas web est√°ndar disponen, adem√°s de los otros enlaces de la barra de navegaci√≥n,
de un enlace a las "P√°ginas de usuario".
Al hacer clic sobre el enlace "P√°ginas de usuario", el navegador web abre la p√°gina web que
se haya configurado como p√°gina de inicio HTML.

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Crear p√°ginas web en varios idiomas definidas para el usuario
Tiene la posibilidad de hacer que sus p√°ginas web definidas para el usuario est√©n disponibles
en distintos idiomas.

Requisitos
Las p√°ginas HTML dependientes de idioma deber√°n guardarse en una estructura de carpeta
que contenga las abreviaturas idiom√°ticas correspondientes:

Abreviatura idiom√°tica establecida
Est√°n establecidas las abreviaturas idiom√°ticas "de", "en", "fr", "es", "it" y "zh-CHS". No se
soportar√°n otras carpetas de idioma o carpetas nombradas de distinta forma.
De ser necesario, podr√° crear otras carpetas en la misma jerarqu√≠a de carpetas para otros
archivos; p. ej., una carpeta "img" para im√°genes y otra carpeta "script" para archivos
Javascript.

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

1500

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Cambio de idioma para p√°ginas web definidas por el usuario
Requisitos
Las p√°ginas HTML se encuentran en las carpetas de idioma predefinidas, p. ej., p√°ginas HTML
con texto en alem√°n en la carpeta "de", p√°ginas HTML con texto en ingl√©s en la carpeta "en",
etc.

Concepto del cambio de idioma
El cambio de idioma se basa en una cookie predefinida denominada
"siemens_automation_language". Si se activa el valor "de" en la cookie, el servidor web se
conectar√° a la p√°gina web de la carpeta "de" en la pr√≥xima solicitud o actualizaci√≥n de p√°gina
web.
De forma an√°loga, el servidor web se conecta a la p√°gina web de la carpeta "en" si la cookie
adopta el valor "en".

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Ejemplo de un cambio de idioma
El ejemplo est√° formado de la siguiente manera:
‚óè En las carpetas de idioma "de" y "en" encontrar√° los archivos HTML dependientes de
idioma de igual nombre, p. ej., "langswitch.html". Los textos que se van a mostrar dentro de
los dos archivos estar√°n, seg√∫n el nombre de la carpeta, en alem√°n o en ingl√©s.
‚óè Adem√°s existe una carpeta "script" en la estructura de carpetas en la que se encuentra el
archivo Javascript "lang.js". En este archivo se permutan funciones necesarias para el
cambio de idioma.

Estructura del archivo "langswitch.html" (carpeta "de")
En el encabezado del archivo se hayan establecidos los datos meta "Content-Language",
charset y ruta a los archivos Javascript.
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Cambio de idioma p√°gina alemana</title>
<script type="text/javascript" src="script/lang.js" ></script>
</head>
La selecci√≥n de idioma se realiza en el cuerpo (body) del archivo con ayuda del elemento
HTML "select". El elemento select dispone una lista de selecci√≥n y contiene las opciones "de",
con el nombre "Alem√°n", y "en", con el nombre "Ingl√©s"; "de" est√° preseleccionado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1501

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Con ayuda del gestor de evento (event-handler) "onchange" se acceder√° a la funci√≥n
"DoLocalLanguageChange(this)". El par√°metro "this" transfiere el objeto select con la opci√≥n
seleccionada a esta funci√≥n. En cada modificaci√≥n, "onchange" realiza la opci√≥n para acceder
a la funci√≥n.
<!-- Language Selection -->
<table>
<tr>
<td align="right" valign="top" nowrap>
<!-- change language immediately on change of the selection
-->
<select name="Language"
onchange="DoLocalLanguageChange(this)" size="1">
<option value="de" selected >Alem√°n</option>
<option value="en" >Ingl√©s</option>
</select>
</td>
</tr>
</table>
<!-- Language Selection End-->

Estructura del archivo "langswitch.html" (carpeta "en")
El encabezado del archivo HTML con texto en ingl√©s es an√°logo al archivo HTML con texto en
alem√°n.
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Language switching english page</title>
<script type="text/javascript" src="script/lang.js" ></script>
La selecci√≥n de idioma tambi√©n se realiza en el cuerpo (body) del archivo con ayuda del
elemento HTML "select". A diferencia del archivo HTML alem√°n, la opci√≥n de ingl√©s est√°
preseleccionada y el texto y las etiquetas tambi√©n est√°n en ingl√©s.
<!-- Language Selection -->
<table>
<tr>
<td align="right" valign="top" nowrap>
<!-- change language immediately on change of the selection
-->
<select name="Language"
onchange="DoLocalLanguageChange(this)" size="1">
<option value="de" >Alem√°n</option>
<option value="en" selected >Ingl√©s</option>
</select>
</td>
</tr>
</table>
<!-- Language Selection End-->

1502

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura del archivo "langs.js" (en la carpeta "script")
En el archivo Javascript se define la funci√≥n "DoLocalLanguageChange" que por su parte
accede a la funci√≥n "SetLangCookie" con el valor de selecci√≥n de idioma. SetLangCookie
re√∫ne el nombre y el valor de la cookie y la activa a trav√©s de la propiedad correspondiente
document.cookie. Para que el servidor web reaccione a la activaci√≥n de las cookies con la
visualizaci√≥n del idioma deseado, deber√° volver a cargarse la p√°gina web
(top.window.location.reload).
funci√≥n DoLocalLanguageChange(oSelect) {
SetLangCookie(oSelect.value);
top.window.location.reload();
}
funci√≥n SetLangCookie(value) {
var strval = "siemens_automation_language=";
// esta es la cookie por la que el servidor web
// detecta el idioma deseado
// el servidor web requiere este nombre
strval = strval + value;
strval = strval + "; path=/ ;";
// establece la ruta hacia la aplicaci√≥n, ya que de otra
forma
// la ruta se establecer√≠a hacia la p√°gina solicitante no
obtendr√≠a la cookie
/*
usar expiraci√≥n si esta cookie debe mantenerse m√°s tiempo
que la actual sesi√≥n del navegador
var now
= new Date();
var endttime = new Date(now.getTime() + expiration);
strval = strval + "; expires=" + endttime.toGMTString() +
";";
*/
document.cookie = strval;
}

Consulte tambi√©n
Informaci√≥n adicional y ejemplos de aplicaci√≥n (P√°gina 1504)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1503

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n adicional y ejemplos de aplicaci√≥n
Informaci√≥n y ejemplos para las p√°ginas definidas por el usuario
Encontrar√° ejemplos y explicaciones adicionales en el Siemens Industrie Online Support.
‚óè Encontrar√° el manual de funciones para el servidor web de una CPU S7-1500 aqu√≠ (http://
support.automation.siemens.com/WW/view/en/62046437?Datakey=47071380).
‚óè Encontrar√° un ejemplo del acceso al servidor web de un S7-1200 con un iPad y para la
integraci√≥n de la librer√≠a jQuery aqu√≠ (http://support.automation.siemens.com/WW/view/en/
62046437?Datakey=47071380).
‚óè Encontrar√° un ejemplo de aplicaci√≥n para crear una p√°gina web definida por el usuario aqu√≠
(http://support.automation.siemens.com/WW/view/es/58862931).
‚óè Encontrar√° una descripci√≥n de las opciones posibles para actualizar p√°ginas web definidas
por el usuario con c√≥digo HTML5 o JavaScript aqu√≠ (http://
support.automation.siemens.com/WW/view/es/62543256).
‚óè Encontrar√° un resumen sobre el tema Industrial Security aqu√≠ (http://
support.automation.siemens.com/WW/view/es/50203404).

Ejemplos sencillos para aplicaciones especiales
Para las diferentes funciones descritas anteriormente est√°n disponibles ejemplos
documentados con p√°ginas HTML de ejemplo y, en funci√≥n de la aplicaci√≥n, con el proyecto
TIA/programa de usuario correspondiente, consulte aqu√≠ (https://
support.industry.siemens.com/cs/ww/es/view/68011496).
Adem√°s de las descripciones b√°sicas y los proyectos, all√≠ encontrar√° tambi√©n ejemplos
sencillos para el servidor web de SIMATIC S7-1200/S7-1500.

Consulte tambi√©n
Servidor web S7-1500 (http://support.automation.siemens.com/WW/view/es/59193560)

Utilizar archivos fuente para p√°ginas de usuario del servidor web en STEP 7 (TIA Portal)
Cuando se migran proyectos de STEP 7, las fuentes para las p√°ginas de usuario del servidor
web, como p. ej., p√°ginas HTML y gr√°ficos, no se incorporan autom√°ticamente al nuevo
proyecto de TIA Portal.
Despu√©s de la migraci√≥n hay que integrar las fuentes de las p√°ginas de usuario al proyecto.
Proceda del siguiente modo:
1. Guarde los datos de origen en un directorio accesible desde TIA Portal.
2. Indique las rutas de los archivos fuente en "Servidor web > P√°ginas de usuario" de las
propiedades de la CPU.
3. A continuaci√≥n, compile la configuraci√≥n hardware.

1504

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.2

Configuraci√≥n de sistemas de automatizaci√≥n

1.4.2.1

Funcionamiento de CPUs S7-1200

Estados operativos
Principios b√°sicos de los estados operativos de CPUs S7
Introducci√≥n
Los estados operativos describen el comportamiento de la CPU. Existen los estados
operativos siguientes:
‚óè ARRANQUE
‚óè RUN
‚óè STOP
En estos estados operativos, la CPU es apta para la comunicaci√≥n, p. ej. a trav√©s de la interfaz
PN/IE.

Otros estados operativos
Si la CPU no est√° lista para funcionar, est√° en uno de los dos estados operativos siguientes:
‚óè Sin tensi√≥n, es decir, la tensi√≥n de red est√° desconectada.
‚óè Aver√≠a, es decir, se ha producido un fallo interno.
Si el estado "Aver√≠a" es provocado por un error de firmware, se se√±alizar√° con los LEDs de
estado de la CPU (v√©ase la descripci√≥n de la CPU). Para determinar la causa, proceda del
siguiente modo:
‚Äì Desconecte y vuelva a conectar el interruptor de red.
‚Äì Lea el b√∫fer de diagn√≥stico cuando la CPU arranque y env√≠e los datos al Customer
Support para que los analicen.
Si la CPU no arranca, c√°mbiela.

Consulte tambi√©n
Estado operativo "STOP" (P√°gina 1511)
Estado operativo "RUN" (P√°gina 1510)
Estado operativo "ARRANQUE" (P√°gina 1507)

Edi