
OUT => "Tag_Result"
)

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Par√°metro

Operando

Valor

MN

Tag_LowLimit

12000

IN

Tag_InputValue

8000

MX

Tag_HighLimit

16000

OUT

Tag_Result

12000

El valor del operando "Tag_InputValue" se compara con los valores de los operandos
"Tag_LowLimit" y "Tag_HighLimit". Puesto que el valor del operando "Tag_InputValue" es
menor que el valor l√≠mite inferior, el valor del operando "Tag_LowLimit" se copia en la salida
"Tag_Result".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

SQR: Calcular cuadrado
Descripci√≥n
La instrucci√≥n "Calcular cuadrado" permite elevar al cuadrado el valor del n√∫mero en coma
flotante del operando y escribir el resultado en la salida.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5725

Instrucciones
4.2 Instrucciones
Si el operando contiene un n√∫mero en coma flotante no v√°lido, el valor del resultado tampoco
ser√° v√°lido.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de entrada

<Resultado>

Output

N√∫meros en coma
flotante

I, Q, M, D, L, P

Cuadrado del valor de entra‚Äê
da

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := SQR("Tag_InValue")

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

5.0

Tag_OutValue

25.0

La instrucci√≥n eleva al cuadrado el valor del operando "Tag_InValue" e indica el resultado en
el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

SQRT: Calcular ra√≠z cuadrada
Descripci√≥n
La instrucci√≥n "Calcular ra√≠z cuadrada" permite extraer la ra√≠z cuadrada del valor de entrada y
guardar el resultado en el operando indicado. La instrucci√≥n da un resultado positivo si el valor
de entrada es mayor que cero. En los valores de entrada menores que cero, la instrucci√≥n
devuelve un n√∫mero en coma flotante no v√°lido. Si el valor del operando es "0", el resultado
tambi√©n es "0".

5726

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de entrada

<Resultado>

Output

N√∫meros en coma
flotante

I, Q, M, D, L

Ra√≠z cuadrada del valor de
entrada

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := SQRT("Tag_InValue")

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

25.0

Tag_OutValue

5.0

La instrucci√≥n extrae la ra√≠z cuadrada del valor del operando "Tag_InValue" e indica el
resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

LN: Calcular logaritmo natural
Descripci√≥n
La instrucci√≥n "Calcular logaritmo natural" permite calcular el logaritmo natural en base e (e =
2,718282) a partir del valor de entrada. La instrucci√≥n da un resultado positivo si el valor de
entrada es mayor que cero. En los valores de entrada menores que cero, la instrucci√≥n
devuelve un n√∫mero en coma flotante no v√°lido.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5727

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de entrada

<Resultado>

Output

N√∫meros en coma
flotante

I, Q, M, D, L, P

Logaritmo natural del valor
de entrada

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := LN("Tag_InValue")

La instrucci√≥n calcula el logaritmo natural del valor del operando "Tag_InValue" e indica el
resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

EXP: Calcular valor exponencial
Descripci√≥n
La instrucci√≥n "Calcular valor exponencial" permite calcular la potencia en base e (e =
2,718282) del valor del operando.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de entrada

<Resultado>

Output

N√∫meros en coma
flotante

I, Q, M, D, L, P

Valor exponencial del valor
de entrada

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

5728

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := EXP("Tag_InValue")

La instrucci√≥n calcula la potencia en base e del valor del operando "Tag_InValue" e indica el
resultado (eIN) en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

SIN: Calcular valor de seno
Descripci√≥n
La instrucci√≥n "Calcular valor de seno" permite calcular el seno del √°ngulo. El tama√±o del
√°ngulo se indica en radianes en el operando.
El valor del resultado no es v√°lido si el valor del operando no es un n√∫mero en coma flotante
v√°lido.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

REAL

I, Q, M, D, L, P o
constante

Tama√±o del √°ngulo en radia‚Äê
nes

<Resultado>

Output

REAL

I, Q, M, D, L, P

Seno del √°ngulo indicado

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := SIN("Tag_InValue")

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5729

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

+1.570796 (œÄ/2)

Tag_OutValue

1.0

La instrucci√≥n calcula el seno del √°ngulo indicado en el operando "Tag_InValue" e indica el
resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

COS: Calcular valor de coseno
Descripci√≥n
La instrucci√≥n "Calcular valor de coseno" permite calcular el coseno de un √°ngulo. El tama√±o
del √°ngulo se indica en radianes en el operando.
El valor del resultado no es v√°lido si el valor del operando no es un n√∫mero en coma flotante
v√°lido.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

REAL

I, Q, M, D, L, P o
constante

Tama√±o del √°ngulo en radia‚Äê
nes

<Resultado>

Output

REAL

I, Q, M, D, L, P

Coseno del √°ngulo indicado

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := COS("Tag_InValue")

5730

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

+1.570796 (œÄ/2)

Tag_OutValue

0

La instrucci√≥n calcula el coseno del √°ngulo indicado en el operando "Tag_InValue" e indica el
resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

TAN: Calcular valor de tangente
Descripci√≥n
La instrucci√≥n "Calcular valor de tangente" permite calcular la tangente de un √°ngulo. El
tama√±o del √°ngulo se indica en radianes en el operando.
El valor del resultado no es v√°lido si el valor del operando no es un n√∫mero en coma flotante
v√°lido.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

REAL

I, Q, M, D, L, P o
constante

Tama√±o del √°ngulo en radia‚Äê
nes

<Resultado>

Output

REAL

I, Q, M, D, L, P

Tangente del √°ngulo indicado

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := TAN("Tag_InValue")

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5731

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

+3.141593 (œÄ)

Tag_OutValue

0

La instrucci√≥n calcula la tangente del √°ngulo indicado en el operando "Tag_InValue" e indica
el resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

ASIN: Calcular valor de arcoseno
Descripci√≥n
La instrucci√≥n "Calcular valor de arcoseno" permite calcular a partir del valor de seno indicado
en el operando el tama√±o del √°ngulo que corresponde a este valor. En el operando solo se
pueden indicar n√∫meros en coma flotante v√°lidos, comprendidos en un rango de valores entre
-1 y +1. El tama√±o del √°ngulo calculado puede estar comprendido entre -œÄ/2 y +œÄ/2.
El valor del resultado no es v√°lido si se cumple una de las siguientes condiciones:
‚óè El valor del operando no es un n√∫mero en coma flotante v√°lido.
‚óè El valor del operando est√° fuera del rango de valores permitido (-1 hasta +1).

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

REAL

I, Q, M, D, L, P o
constante

Valor de seno

<Resultado>

Output

REAL

I, Q, M, D, L, P

Tama√±o del √°ngu‚Äê
lo en radianes

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := ASIN("Tag_InValue")

5732

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

1.0

Tag_OutValue

+1.570796 (œÄ/2)

La instrucci√≥n calcula el tama√±o del √°ngulo que corresponde al valor de seno del operando
"Tag_InValue". El resultado de la instrucci√≥n se deposita en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

ACOS: Calcular valor de arcocoseno
Descripci√≥n
La instrucci√≥n "Calcular valor de arcocoseno" permite calcular a partir del valor de coseno
indicado en el operando el tama√±o del √°ngulo que corresponde a este valor. En el operando
solo se pueden indicar n√∫meros en coma flotante v√°lidos, comprendidos en un rango de
valores entre -1 y +1. El tama√±o del √°ngulo calculado puede estar comprendido entre 0 y +œÄ.
El valor del resultado no es v√°lido si se cumple una de las siguientes condiciones:
‚óè El valor del operando no es un n√∫mero en coma flotante v√°lido.
‚óè El valor del operando est√° fuera del rango de valores permitido (-1 hasta +1).

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

REAL

I, Q, M, D, L, P o
constante

Valor de coseno

<Resultado>

Output

REAL

I, Q, M, D, L, P

Tama√±o del √°ngu‚Äê
lo en radianes

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := ACOS("Tag_InValue")

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5733

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

0

Tag_OutValue

+1.570796 (œÄ/2)

La instrucci√≥n calcula el tama√±o del √°ngulo que corresponde al valor de coseno del operando
"Tag_InValue". El resultado de la instrucci√≥n se deposita en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

ATAN: Calcular valor de arcotangente
Descripci√≥n
La instrucci√≥n "Calcular valor de arcotangente" permite calcular a partir del valor de tangente
indicado en el operando el tama√±o del √°ngulo que corresponde a este valor. En el operando
solo se pueden indicar n√∫meros en coma flotante v√°lidos (o -NaN/+NaN). El tama√±o del √°ngulo
calculado puede estar comprendido entre -œÄ/2 y +œÄ/2.
El valor de la salida OUT no es v√°lido si el valor de la entrada IN no es un n√∫mero en coma
flotante v√°lido.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de tangente

<Resultado>

Output

N√∫meros en coma
flotante

I, Q, M, D, L, P

Tama√±o del √°ngulo en radia‚Äê
nes

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := ATAN("Tag_InValue")

5734

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

1.0

Tag_OutValue

+0,785398 (œÄ/4)

La instrucci√≥n calcula el tama√±o del √°ngulo que equivale al valor de tangente del operando
"Tag_InValue". El resultado de la instrucci√≥n se deposita en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
N√∫meros en coma flotante no v√°lidos (P√°gina 263)
Principios b√°sicos de GRAPH (P√°gina 8191)

Transferencia
SWAP: Cambiar disposici√≥n
Descripci√≥n
Con la instrucci√≥n "Cambiar disposici√≥n" se modifica la disposici√≥n de los bytes del operando.
Dependiendo del tipo de datos utilizado, se puede cambiar el orden de los bytes en todo el
acumulador 1 o solamente en la palabra derecha del acumulador 1.
La siguiente figura muestra c√≥mo se cambian las posiciones de los bytes del operando del tipo
de datos DWORD:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5735

Instrucciones
4.2 Instrucciones


,1

 

 
 

 

 

 


 



 

 

 

 

 

 


 



 

 


 


 



 
 

 






287

 



 

 




 

 




 

 

 

 


 


 

 

 





Disposici√≥n de los bytes en la palabra derecha del acumulador 1
Para el tipo de datos WORD se cambia la disposici√≥n de los bytes en la palabra derecha del
acumulador 1.
La tabla siguiente muestra el contenido del acumulador 1 antes y despu√©s de ejecutar la
instrucci√≥n:
Estado

Bytes del acumulador 1

Antes de la ejecuci√≥n

Valor A

Valor B

Valor C

Valor D

Despu√©s de la ejecuci√≥n

Valor A

Valor B

Valor D

Valor C

El resultado de la instrucci√≥n se guarda en la palabra derecha del acumulador 1. Los bytes de
la palabra izquierda del acumulador 1 no se ven influidos por la instrucci√≥n y no cambian.

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

WORD, DWORD

I, Q, M, D, L o
constante

Operando cuyas posiciones
de bytes se cambian

<Resultado>

Output

WORD, DWORD

I, Q, M, D, L

Resultado

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

5736

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := "SWAPTag_InValue")

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

0000

1111

0000

1111

Tag_OutValue

0000

1111

1111

0000

Cambiar la disposici√≥n de los bytes en todo el acumulador 1:
Para el tipo de datos DWORD se modifica la disposici√≥n de los bytes en todo el acumulador 1.
La tabla siguiente muestra el contenido del acumulador 1 antes y despu√©s de ejecutar la
instrucci√≥n:
Estado

Bytes del acumulador 1

Antes de la ejecuci√≥n

Valor A

Valor B

Valor C

Valor D

Despu√©s de la ejecuci√≥n

Valor D

Valor C

Valor B

Valor A

El resultado de la instrucci√≥n se guarda en el acumulador 1. El contenido del acumulador 2 no
cambia.
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

1111

0000

0000

1111

0000

0000

1111

1111

Tag_OutValue

1111

1111

0000

0000

0000

1111

1111

0000

La disposici√≥n de los bytes en el operando "Tag_InValue" se guarda cambiada en el operando
"Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5737

Instrucciones
4.2 Instrucciones

BLKMOV: Copiar √°rea
Descripci√≥n
La instrucci√≥n "Copiar √°rea" copia los contenidos de un √°rea de memoria (√°rea de origen) en
un √°rea de memoria diferente (√°rea de destino). La operaci√≥n de copia se realiza por orden
ascendente de direcciones. Las √°reas de origen y destino se definen mediante punteros ANY.
Nota
En esta instrucci√≥n solo se pueden utilizar tipos de datos que sean v√°lidos en una CPU de la
serie S7-300/400.
La figura siguiente muestra el principio de la operaci√≥n de copia:

'%'%:

$

%

'%'%:

&

'

'%'%:

(

)

'%'%:

*

+

&RSLDU
/DFRSLDVHHIHFW¬ºDHQ
VHQWLGRDVFHQGHQWHGH
ODVGLUHFFLRQHV

0:

$

%

0:

&

'

0:

(

)

0:

*

+

¬ÉUHDGHPHPRULD

Coherencia de los datos de origen y destino
Tenga en cuenta que al ejecutar la instrucci√≥n "Copiar √°rea" no se modifican los datos de
origen. De lo contrario no est√° garantizada la coherencia de los datos de destino.

Posibilidad de interrupci√≥n
Mientras el √°rea de origen no forme parte de un bloque de datos que solo figura en la memoria
de carga, no hay limitaciones en cuanto a la profundidad de anidamiento.
Por el contrario, en caso de interrumpirse la ejecuci√≥n de BLKMOV, en la que se copia desde
un DB no relevante para la ejecuci√≥n, no puede anidarse m√°s la ejecuci√≥n de la BLKMOV.

5738

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

√Åreas de memoria
La instrucci√≥n "Copiar √°rea" permite copiar las siguientes √°reas de memoria:
‚óè √Åreas de un bloque de datos
‚óè Marcas
‚óè Memoria imagen de proceso de las entradas
‚óè Memoria imagen de proceso de las salidas
‚óè Bloques de datos no relevantes para la ejecuci√≥n

Reglas generales para copiar
Las √°reas de origen y destino no deben solaparse. Si las √°reas de origen y destino son de
diferente longitud, se copia solo hasta la longitud del √°rea m√°s peque√±a.
Si el √°rea de origen es m√°s peque√±a que el √°rea de destino, el √°rea de origen se copiar√° por
completo en el √°rea de destino. Los restantes bytes del √°rea de destino permanecen
inalterados.
Si el √°rea de destino es m√°s peque√±a que el √°rea de origen, se escribir√° en toda el √°rea de
destino. Los restantes bytes del √°rea de origen se ignoran.
Al copiar un √°rea del tipo de datos BOOL, la longitud indicada del √°rea debe ser un m√∫ltiplo de
8, pues de lo contrario no se ejecutar√° la instrucci√≥n.
Nota
Si el √°rea de origen o destino realmente existente es menor que el √°rea de origen o destino
indicada en el par√°metro SRCBLK o DSTBLK, el comportamiento depender√° del tipo de CPU:
‚óè Para las CPU S7-300 rige lo siguiente:
No se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error
W#16#837F. Este c√≥digo de error debe evaluarse en el programa de usuario.
‚óè Para las CPU V4 del S7-400 (V4, CPU H V4 y CPU H V4.5 se aplica lo siguiente:
No se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error
W#16#8122 o W#16#8323. Este c√≥digo de error debe evaluarse en el programa de usuario.
‚óè Para las restantes CPU S7-400 rige:
Se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error W#16#8122
o W#16#8323. Este c√≥digo de error debe evaluarse en el programa de usuario.

Reglas para copiar cadenas de caracteres
La instrucci√≥n "Copiar √°rea" permite copiar asimismo √°reas de origen y destino del tipo de
datos STRING. Si solo el √°rea de origen es del tipo de datos STRING, se copiar√°n los
caracteres realmente contenidos en la cadena de caracteres. La informaci√≥n sobre la longitud
real y m√°xima tambi√©n se escribe en el √°rea de destino. Si tanto el √°rea de origen como el √°rea
de destino son del tipo de datos STRING, la longitud actual de la cadena de caracteres en el
√°rea de destino se pone al n√∫mero de caracteres realmente copiados.
Si se desea copiar informaci√≥n sobre la longitud m√°xima y real de una cadena de caracteres,
las √°reas de los par√°metros SRCBLK y DSTBLK deben indicarse en bytes.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5739

Instrucciones
4.2 Instrucciones

Reglas para copiar bloques de datos no relevantes para la ejecuci√≥n
El √°rea de origen tambi√©n puede encontrarse en un bloque de datos no relevante para la
ejecuci√≥n en la memoria de carga. Los bloques de datos no relevantes para la ejecuci√≥n se
identifican con la palabra clave UNLINKED.
Si en la memoria de trabajo se copia un bloque de datos no relevante para la ejecuci√≥n con la
instrucci√≥n "Copiar √°rea" y, al mismo tiempo, este se vuelve a cargar p. ej. desde la
programadora, la ejecuci√≥n de la instrucci√≥n puede retardarse varios milisegundos. Esto
prolonga el ciclo del OB y puede activar la vigilancia del tiempo de ciclo.
Si un bloque de datos no relevante para la ejecuci√≥n se copia con la instrucci√≥n "Copiar √°rea"
y la operaci√≥n de copia se interrumpe, la instrucci√≥n no se podr√° seguir ejecutando.
Si en la CPU existe la instrucci√≥n "Leer de un bloque de datos de la memoria de carga", debe
utilizarse dicha instrucci√≥n para leer los bloques de datos no relevantes para la ejecuci√≥n en
la memoria de carga. Si se utiliza la instrucci√≥n "Copiar √°rea" se emite el error W#16#8092.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SRCBLK

Input

ANY

I, Q, M, D, L, P

Indicaci√≥n del √°rea de memo‚Äê
ria que se copia (√°rea de ori‚Äê
gen).

RET_VAL

Output

INT

I, Q, M, D, L, P

Informaci√≥n de error:
El par√°metro RET_VAL de‚Äê
vuelve un c√≥digo de error
cuando se produce un error
durante la ejecuci√≥n de la ins‚Äê
trucci√≥n.

DSTBLK

Output 1)

ANY

I, Q, M, D, L, P

Indicaci√≥n del √°rea de memo‚Äê
ria en la que se copia (√°rea
de destino).

1) El par√°metro DSTBLK se declara como Output, pero en la interfaz del bloque debe declararse como
InOut.

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

8092

El √°rea de origen o destino est√° solo en la memoria de carga.

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

5740

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL BLKMOV ANY
(SRCBLK := P#M100.0 BYTE 10
RET_VAL => "Tag_ErrorCode"
DSTBLK => P#DB1.DBX0.0 BYTE 10
)

La instrucci√≥n copia 10 bytes a partir de MB100 y los escribe en el DB1. Si ocurre un error
durante la operaci√≥n de copia, el respectivo c√≥digo de error se indica en la variable
"Tag_ErrorCode".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

UBLKMOV: Copiar √°rea sin interrupciones
Descripci√≥n
La instrucci√≥n "Copiar √°rea sin interrupciones" copia los contenidos de un √°rea de memoria
(√°rea de origen) en un √°rea de memoria diferente (√°rea de destino). La operaci√≥n de copia se
realiza por orden ascendente de direcciones. Las √°reas de origen y destino se definen
mediante punteros ANY.
La operaci√≥n de copia no debe ser interrumpida por otras actividades del sistema operativo.
Ello puede aumentar el tiempo de reacci√≥n a alarmas de la CPU durante la ejecuci√≥n de la
instrucci√≥n "Copiar √°rea sin interrupciones".
Nota
En esta instrucci√≥n solo se pueden utilizar tipos de datos que sean v√°lidos en una CPU de la
serie S7-300/400.

√Åreas de memoria
La instrucci√≥n "Copiar √°rea sin interrupciones" permite copiar las siguientes √°reas de memoria:
‚óè √Åreas de un bloque de datos
‚óè Marcas

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5741

Instrucciones
4.2 Instrucciones
‚óè Memoria imagen de proceso de las entradas
‚óè Memoria imagen de proceso de las salidas

Reglas generales para copiar
Al ejecutar la instrucci√≥n "Copiar √°rea sin interrupciones" no pueden solaparse las √°reas de
origen y destino. Si el √°rea de origen es m√°s peque√±a que el √°rea de destino, el √°rea de origen
se copiar√° por completo en el √°rea de destino. Los restantes bytes del √°rea de destino
permanecen inalterados.
Si el √°rea de destino es m√°s peque√±a que el √°rea de origen, se escribir√° en toda el √°rea de
destino. Los restantes bytes del √°rea de origen se ignoran.
Si un √°rea de origen o destino definida como par√°metro formal es menor que un √°rea de origen
o destino indicada en los par√°metros SRCBLK o DSTBLK, no se transferir√°n datos.
Al copiar un √°rea del tipo de datos BOOL, la longitud indicada del √°rea debe ser un m√∫ltiplo de
8, pues de lo contrario no se ejecutar√° la instrucci√≥n.
La instrucci√≥n "Copiar √°rea sin interrupciones" permite copiar 512 bytes como m√°ximo. A este
respecto deben tenerse en cuenta las limitaciones espec√≠ficas de la CPU.
Nota
Si el √°rea de origen o destino realmente existente es menor que el √°rea de origen o destino
indicada en el par√°metro SRCBLK o DSTBLK, el comportamiento depender√° del tipo de CPU:
‚óè Para las CPU S7-300 rige lo siguiente:
No se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error
W#16#837F. Este c√≥digo de error debe evaluarse en el programa de usuario.
‚óè Para las CPU V4 del S7-400 (V4, CPU H V4 y CPU H V4.5 se aplica lo siguiente:
No se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error
W#16#8122 o W#16#8323. Este c√≥digo de error debe evaluarse en el programa de usuario.
‚óè Para las restantes CPU S7-400 rige:
Se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error W#16#8122
o W#16#8323. Este c√≥digo de error debe evaluarse en el programa de usuario.

Reglas para copiar cadenas de caracteres
La instrucci√≥n "Copiar √°rea sin interrupciones" permite copiar asimismo √°reas de origen y
destino del tipo de datos STRING. Si solo el √°rea de origen es del tipo de datos STRING, se
copiar√°n los caracteres realmente contenidos en la cadena de caracteres. La informaci√≥n
sobre la longitud real y m√°xima no se escribe en el √°rea de destino. Si tanto el √°rea de origen
como el √°rea de destino son del tipo de datos STRING, la longitud actual de la cadena de
caracteres en el √°rea de destino se pone al n√∫mero de caracteres realmente copiados. Si se
copian √°reas del tipo de datos STRING, debe indicarse "1" como longitud del √°rea.

5742

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SRCBLK

Input

ANY

I, Q, M, D, L, P

Indicaci√≥n del √°rea de memo‚Äê
ria que se copia (√°rea de ori‚Äê
gen).

RET_VAL

Output

INT

I, Q, M, D, L, P

Informaci√≥n de error:
El par√°metro RET_VAL de‚Äê
vuelve un c√≥digo de error
cuando se produce un error
durante la ejecuci√≥n de la ins‚Äê
trucci√≥n.

DSTBLK

Output 1)

ANY

I, Q, M, D, L, P

Indicaci√≥n del √°rea de memo‚Äê
ria en la que se copia (√°rea
de destino).

1) El par√°metro DSTBLK se declara como Output, pero en la interfaz del bloque debe declararse como
InOut.

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

8091

El √°rea de origen o destino est√° solo en la memoria de carga.

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL UBLKMOV ANY
(SRCBLK := P#M100.0 BYTE 10
RET_VAL => "Tag_ErrorCode"
DSTBLK => P#DB1.DBX0.0 BYTE 10
)

La instrucci√≥n copia 10 bytes a partir de MB100 y los escribe en el DB1. Si ocurre un error
durante la operaci√≥n de copia, el respectivo c√≥digo de error se indica en la variable
"Tag_ErrorCode".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5743

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

FILL: Rellenar √°rea
Descripci√≥n
La instrucci√≥n "Rellenar √°rea" rellena un √°rea de memoria (√°rea de destino) con el contenido
de un √°rea de memoria diferente (√°rea de origen). La instrucci√≥n "Rellenar √°rea" copia el
contenido del √°rea de origen en el √°rea de destino hasta que el √°rea de destino quede escrita
por completo. La operaci√≥n de copia se realiza por orden ascendente de direcciones.
Las √°reas de origen y destino se definen mediante punteros ANY.
Nota
En esta instrucci√≥n solo se pueden utilizar tipos de datos que sean v√°lidos en una CPU de la
serie S7-300/400.
La figura siguiente muestra el principio de la operaci√≥n de copia:
),//

%9$/

$

%

0:

$

%

0:

&

'

0:

&

'

0:

(

)

0:

(

)

0:

*

+

0:

*

+

0:

$

%

0:

&

'

0:

(

)

0:

*

+

0:

$

%

0:

&

'

0:

%/.

Ejemplo: El contenido del √°rea MW100 a MW118 debe inicializarse con el contenido de las
palabras de marcas MW14 a MW20.

5744

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Coherencia de los datos de origen y destino
Tenga en cuenta que al ejecutar la instrucci√≥n "Rellenar √°rea" no se modifican los datos de
origen, pues de lo contrario no se podr√≠a garantizar la coherencia de los datos de destino.

√Åreas de memoria
La instrucci√≥n "Rellenar √°rea" permite copiar las siguientes √°reas de memoria:
‚óè √Åreas de un bloque de datos
‚óè Marcas
‚óè Memoria imagen de proceso de las entradas
‚óè Memoria imagen de proceso de las salidas

Reglas generales para copiar
Las √°reas de origen y destino no deben solaparse. Aunque el √°rea de destino que se debe
inicializar no sea m√∫ltiplo entero de la longitud del par√°metro de entrada BVAL, el √°rea de
destino se rellenar√° igualmente hasta el √∫ltimo byte.
Si el √°rea de destino que se debe preasignar es menor que el √°rea de origen, solo se copian
los datos que caben en el √°rea de destino.
Si el √°rea de destino o de origen disponible realmente es menor que el tama√±o del √°rea de
memoria parametrizada para el √°rea de origen o destino (par√°metros BVAL, BLK), los datos no
se transfieren.
Si el puntero ANY (origen o destino) es del tipo BOOL, la longitud indicada debe ser divisible
por 8. De lo contrario, la instrucci√≥n no se ejecutar√°.
Si el √°rea de destino es del tipo de datos STRING, la instrucci√≥n escribe la cadena de
caracteres completa, incluida la informaci√≥n de administraci√≥n.
Nota
Si el √°rea de origen o destino realmente existente es menor que el √°rea de origen o destino
indicada en el par√°metro BVAL o BLK, el comportamiento depender√° del tipo de CPU:
‚óè Para las CPU S7-300 rige lo siguiente:
No se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error
W#16#837F. Este c√≥digo de error debe evaluarse en el programa de usuario.
‚óè Para las CPU V4 del S7-400 (V4, CPU H V4 y CPU H V4.5 se aplica lo siguiente:
No se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error
W#16#8122 o W#16#8323. Este c√≥digo de error debe evaluarse en el programa de usuario.
‚óè Para las restantes CPU S7-400 rige:
Se transfieren datos. En el par√°metro RET_VAL se devuelve el c√≥digo de error W#16#8122
o W#16#8323. Este c√≥digo de error debe evaluarse en el programa de usuario.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5745

Instrucciones
4.2 Instrucciones

Reglas para copiar estructuras
Al indicar una estructura a modo de par√°metro de entrada, tenga en cuenta que la longitud de
una estructura se rige siempre por un n√∫mero entero de bytes. Si se declara una estructura con
un n√∫mero impar de bytes, esta estructura necesita un byte adicional de espacio en memoria.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

BVAL

Input

ANY

I, Q, M, D, L, P

Indicaci√≥n del √°rea de memo‚Äê
ria (√°rea de origen) con cuyo
contenido se rellena el √°rea
de destino en el par√°metro
BLK.

RET_VAL

Output

INT

I, Q, M, D, L, P

Informaci√≥n de error:
El par√°metro RET_VAL de‚Äê
vuelve un c√≥digo de error
cuando se produce un error
durante la ejecuci√≥n de la ins‚Äê
trucci√≥n.

BLK

Output 1)

ANY

I, Q, M, D, L, P

Indicaci√≥n del √°rea de memo‚Äê
ria que se rellena con el con‚Äê
tenido del √°rea de origen.

1) El par√°metro BLK se declara como Output, pero en la interfaz del bloque debe declararse como
InOut.

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

8092

El √°rea de origen o destino est√° solo en la memoria de carga.

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL FILL ANY
(BVAL := P#M14.0 WORD 4
RET_VAL => "Tag_ErrorCode"

5746

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
GRAPH
BLK => P#M100.0 WORD 10
)

La instrucci√≥n copia el √°rea de origen de MW14 a MW20 y rellena el √°rea de destino de MW100
a MW118 con el contenido de las 4 palabras contenidas en el √°rea de memoria del par√°metro
BVAL.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

Conversi√≥n
CONVERT: Convertir valor
Descripci√≥n
La instrucci√≥n "Convertir valor" lee el contenido del operando y lo convierte seg√∫n los tipos de
datos parametrizados.
Encontrar√° informaci√≥n relacionada con las conversiones posibles en el apartado "Conversi√≥n
expl√≠cita" de "Consulte tambi√©n".
El valor del resultado no es v√°lido si se producen errores durante la ejecuci√≥n, p. ej. un
desbordamiento.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

Enteros, n√∫meros
en coma flotante,
BCD16, BCD32

I, Q, M, D, L, P o
constante

Valor que se convierte

<Resultado

Output

Enteros, n√∫meros
en coma flotante,
BCD16, BCD32

I, Q, M, D, L, P

Resultado de la conversi√≥n

En las listas desplegables "???" puede seleccionar los tipos de datos de la instrucci√≥n.
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5747

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := INT_TO_DINT("Tag_InValue")

El contenido del operando "Tag_InValue" se lee y se convierte en un entero (32 bits). El
resultado se deposita en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

ROUND: Redondear n√∫mero
Descripci√≥n
La instrucci√≥n "Redondear n√∫mero" permite redondear el valor del operando al siguiente
n√∫mero entero. La instrucci√≥n interpreta el valor como n√∫mero en coma flotante y lo convierte
a un n√∫mero entero del tipo de datos DINT. Si el valor de entrada se encuentra entre un n√∫mero
par y uno impar, se selecciona el n√∫mero par.
El valor del resultado no es v√°lido si se producen errores durante la ejecuci√≥n, p. ej. un
desbordamiento.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de entrada que se re‚Äê
dondea

<Resultado>

Output

DINT

I, Q, M, D, L, P

Resultado del redondeo

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := ROUND("Tag_InValue")

5748

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

1.50000000

-1.50000000

Tag_OutValue

2

-2

El n√∫mero en coma flotante del operando "Tag_InValue" se redondea al siguiente n√∫mero
entero par y se indica en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

CEIL: Redondear un n√∫mero en coma flotante al siguiente entero superior
Descripci√≥n
La instrucci√≥n "Redondear un n√∫mero en coma flotante al siguiente entero superior" permite
redondear el valor del operando al siguiente n√∫mero entero superior. La instrucci√≥n interpreta
el valor como n√∫mero en coma flotante y lo convierte al siguiente n√∫mero entero superior. El
resultado de la instrucci√≥n puede ser mayor o igual al valor de entrada.
El valor del resultado no es v√°lido si se producen errores durante la ejecuci√≥n, p. ej. un
desbordamiento.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de entrada

<Resultado>

Output

Enteros, n√∫meros
en coma flotante

I, Q, M, D, L, P

Resultado con el siguiente
entero superior

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := CEIL("Tag_InValue")

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5749

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

0.50000000

-0.50000000

Tag_OutValue

1

0

El n√∫mero en coma flotante del operando "Tag_InValue" se redondea al siguiente n√∫mero
entero superior y se indica en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

FLOOR: Redondear un n√∫mero en coma flotante al siguiente entero inferior
Descripci√≥n
La instrucci√≥n "Redondear un n√∫mero en coma flotante al siguiente entero inferior" permite
redondear el valor del operando al siguiente n√∫mero entero inferior. La instrucci√≥n interpreta
el valor como n√∫mero en coma flotante y lo convierte al siguiente n√∫mero entero inferior. El
resultado de la instrucci√≥n puede ser menor o igual al valor de entrada.
El valor del resultado no es v√°lido si se producen errores durante la ejecuci√≥n, p. ej. un
desbordamiento.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L, P o
constante

Valor de entrada

<Resultado>

Output

Enteros, n√∫meros
en coma flotante

I, Q, M, D, L, P

Resultado con el siguiente
entero inferior

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := FLOOR("Tag_InValue")

5750

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

0.50000000

-0.50000000

Tag_OutValue

0

-1

El n√∫mero en coma flotante del operando "Tag_InValue" se redondea al siguiente n√∫mero
entero inferior y se indica en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

TRUNC: Truncar a entero
Descripci√≥n
La instrucci√≥n "Truncar a entero" permite generar un n√∫mero entero a partir del valor del
operando. El valor se interpreta como n√∫mero en coma flotante. La instrucci√≥n selecciona solo
la parte entera del n√∫mero en coma flotante y la indica sin decimales como resultado.
El valor del resultado no es v√°lido si se producen errores durante la ejecuci√≥n, p. ej. un
desbordamiento.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

N√∫meros en coma
flotante

I, Q, M, D, L o
constante

Valor de entrada

<Resultado>

Output

Enteros

I, Q, M, D, L

Parte entera del valor de en‚Äê
trada

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := TRUNC("Tag_InValue")

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5751

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

1.50000000

-1.50000000

Tag_OutValue

1

-1

La parte entera del n√∫mero en coma flotante del operando "Tag_InValue" se convierte en un
n√∫mero entero y se indica en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

SCALE: Escalar
Descripci√≥n
La instrucci√≥n "Escalar" convierte el entero del par√°metro IN en un n√∫mero en coma flotante
que se escala en unidades f√≠sicas entre un l√≠mite inferior y uno superior. Los l√≠mites inferior y
superior del rango de valores en el que se escala el valor de entrada se definen mediante los
par√°metros LO_LIM y HI_LIM. El resultado de la instrucci√≥n se devuelve en el par√°metro OUT.
La instrucci√≥n "Escalar" utiliza la siguiente ecuaci√≥n:
OUT = [((FLOAT (IN) ‚Äì K1)/(K2‚ÄìK1)) ‚àó (HI_LIM‚ÄìLO_LIM)] + LO_LIM
El estado l√≥gico del par√°metro BIPOLAR determina los valores de las constantes "K1" y "K2".
El par√°metro BIPOLAR puede tener los siguientes estados l√≥gicos:
‚óè Estado l√≥gico "1": se presupone que el valor del par√°metro IN es bipolar y est√° comprendido
en un rango de valores entre -27648 y 27648. En este caso, la constante "K1" tiene el valor
"-27648,0" y la constante "K2", el valor "+27648,0".
‚óè Estado l√≥gico "0": se presupone que el valor del par√°metro IN es unipolar y est√°
comprendido en un rango de valores entre 0 y 27648. En este caso, la constante "K1" tiene
el valor "0,0" y la constante "K2", el valor "+27648,0".
Si el valor del par√°metro IN es mayor que el de la constante "K2", el resultado de la instrucci√≥n
se pone al valor del l√≠mite superior (HI_LIM) y se emite un error.
Si el valor del par√°metro IN es menor que el de la constante "K1", el resultado de la instrucci√≥n
se pone al valor del l√≠mite inferior (LO_LIM) y se emite un error.
Si el l√≠mite inferior indicado es mayor que el l√≠mite superior (LO_LIM > HI_LIM), el resultado se
escala de forma inversamente proporcional al valor de entrada.

5752

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

INT

I, Q, M, D, L, P o
constante

Valor de entrada que se es‚Äê
cala

HI_LIM

Input

REAL

I, Q, M, D, L, P o
constante

Valor l√≠mite superior

LO_LIM

Input

REAL

I, Q, M, D, L, P o
constante

Valor l√≠mite inferior

BIPOLAR

Input

BOOL

I, Q, M, D, L o
constante

Indica si el valor del par√°me‚Äê
tro IN se interpreta como bi‚Äê
polar o unipolar. El par√°me‚Äê
tro puede adoptar los valores
siguientes:
1: Bipolar
0: Unipolar

OUT

Output

REAL

I, Q, M, D, L, P

Resultado de la instrucci√≥n

RET_VAL

Output

WORD

I, Q, M, D, L, P

Informaci√≥n de error

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

0008

El valor del par√°metro IN es mayor que el de la constante "K2" o menor que el de la
constante "K1".

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL SCALE
(IN := "Tag_InputValue"
HI_LIM := "Tag_HighLimit"
LO_LIM := "Tag_LowLimit"
BIPOLAR := "Tag_Bipolar"
RET_VAL => "Tag_ErrorCode"
OUT => "Tag_OutputValue"
)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5753

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra los valores de los distintos operandos antes de ejecutar la
instrucci√≥n:
Par√°metro

Operando

Valor

IN

Tag_InputValue

22

HI_LIM

Tag_HighLimit

100.0

LO_LIM

Tag_LowLimit

0.0

BIPOLAR

Tag_Bipolar

1

RET_VAL

Tag_ErrorCode

W#16#0000

OUT

Tag_OutputValue

0.0

La tabla siguiente muestra los valores de los distintos operandos despu√©s de ejecutar la
instrucci√≥n:
Par√°metro

Operando

Valor

IN

Tag_InputValue

22

HI_LIM

Tag_HighLimit

100.0

LO_LIM

Tag_LowLimit

0.0

BIPOLAR

Tag_Bipolar

1

RET_VAL

Tag_ErrorCode

W#16#0000

OUT

Tag_OutputValue

50.03978588

En el operando "Tag_InputValue" se indica el valor que debe convertirse y escalarse. El valor
l√≠mite superior y el inferior se definen mediante los operandos "Tag_HighLimit" y
"Tag_LowLimit". Con ayuda del operando "Tag_Bipolar" = TRUE se indica que el valor del
par√°metro IN debe interpretarse como bipolar. En el operando "Tag_OutputValue" se indica el
resultado de la instrucci√≥n.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

UNSCALE: Desescalar
Descripci√≥n
La instrucci√≥n "Desescalar" permite desescalar el n√∫mero en coma flotante del par√°metro IN
en unidades f√≠sicas comprendidas entre un l√≠mite inferior y uno superior y convertirlo en un
n√∫mero entero. Los l√≠mites inferior y superior del rango de valores en el que se desescala el
valor de entrada se definen mediante los par√°metros LO_LIM y HI_LIM. El resultado de la
instrucci√≥n se devuelve en el par√°metro OUT.
La instrucci√≥n "Desescalar" utiliza la siguiente ecuaci√≥n:
OUT = [ ((IN‚ÄìLO_LIM)/(HI_LIM‚ÄìLO_LIM)) ‚àó (K2‚ÄìK1) ] + K1

5754

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El estado l√≥gico del par√°metro BIPOLAR determina los valores de las constantes "K1" y "K2".
El par√°metro BIPOLAR puede tener los siguientes estados l√≥gicos:
‚óè Estado l√≥gico "1": se presupone que el valor del par√°metro IN es bipolar y est√° comprendido
en un rango de valores entre -27648 y 27648. En este caso, la constante "K1" tiene el valor
"-27648,0" y la constante "K2", el valor "+27648,0".
‚óè Estado l√≥gico "0": se presupone que el valor del par√°metro IN es unipolar y est√°
comprendido en un rango de valores entre 0 y 27648. En este caso, la constante "K1" tiene
el valor "0,0" y la constante "K2", el valor "+27648,0".
Si el valor del par√°metro IN no se encuentra dentro de los l√≠mites definidos por HI_LIM y
LO_LIM, se emite un error. El resultado se ajusta al l√≠mite m√°s pr√≥ximo.
Si el l√≠mite inferior indicado es mayor que el l√≠mite superior (LO_LIM > HI_LIM), el resultado se
escala de forma inversamente proporcional al valor de entrada.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

REAL

I, Q, M, D, L, P o
constante

Valor de entrada que se de‚Äê
sescala en un valor entero

HI_LIM

Input

REAL

I, Q, M, D, L, P o
constante

Valor l√≠mite superior

LO_LIM

Input

REAL

I, Q, M, D, L, P o
constante

Valor l√≠mite inferior

BIPOLAR

Input

BOOL

I, Q, M, D, L o
constante

Indica si el valor del par√°me‚Äê
tro IN se interpreta como bi‚Äê
polar o unipolar. El par√°me‚Äê
tro puede adoptar los valores
siguientes:
1: Bipolar
0: Unipolar

OUT

Output

INT

I, Q, M, D, L, P

Resultado de la instrucci√≥n

RET_VAL

Output

WORD

I, Q, M, D, L, P

Informaci√≥n de error

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

0008

El valor del par√°metro IN es mayor que el del l√≠mite superior (HI_LIM) o menor que el del
l√≠mite inferior (LO_LIM).

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n aqu√≠: Cambiar
formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5755

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL UNSCALE
(IN := "Tag_InputValue"
HI_LIM := "Tag_HighLimit"
LO_LIM := "Tag_LowLimit"
BIPOLAR := "Tag_Bipolar"
RET_VAL => "Tag_ErrorCode"
OUT => "Tag_OutputValue"
)

La tabla siguiente muestra los valores de los distintos operandos antes de ejecutar la
instrucci√≥n:
Par√°metro

Operando

Valor

IN

Tag_InputValue

50.03978588

HI_LIM

Tag_HighLimit

100.0

LO_LIM

Tag_LowLimit

0.0

BIPOLAR

Tag_Bipolar

1

RET_VAL

Tag_ErrorCode

W#16#0000

OUT

Tag_OutputValue

0.0

La tabla siguiente muestra los valores de los distintos operandos despu√©s de ejecutar la
instrucci√≥n:
Par√°metro

Operando

Valor

IN

Tag_InputValue

50.03978588

HI_LIM

Tag_HighLimit

100.0

LO_LIM

Tag_LowLimit

0.0

BIPOLAR

Tag_Bipolar

1

RET_VAL

Tag_ErrorCode

W#16#0000

OUT

Tag_OutputValue

22

En el operando "Tag_InputValue" se indica el valor que debe convertirse y desescalarse. El
valor l√≠mite superior y el inferior se definen mediante los operandos "Tag_HighLimit" y
"Tag_LowLimit". Con ayuda del operando "Tag_Bipolar" = TRUE se indica que el valor del
par√°metro IN debe interpretarse como bipolar. En el operando "Tag_OutputValue" se indica el
resultado de la instrucci√≥n.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Principios b√°sicos de GRAPH (P√°gina 8191)

5756

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Control del programa
Control del tiempo de ejecuci√≥n
COMPRESS: Comprimir la memoria de la CPU
Descripci√≥n
La instrucci√≥n "Comprimir la memoria de la CPU" permite comprimir la memoria de trabajo de
la CPU o la memoria de carga RAM. Los huecos creados por haber borrado o cargado bloques,
se rellenan juntando los bloques existentes.
Con la llamada de la instrucci√≥n "Comprimir la memoria de la CPU" se lanza el proceso de
compresi√≥n. El proceso de compresi√≥n se reparte entre varios ciclos del programa. La
vigilancia del proceso de compresi√≥n se realiza mediante los valores de los distintos
par√°metros. Si el par√°metro BUSY tiene el valor "1", significa que el proceso de compresi√≥n se
est√° ejecutando todav√≠a. El valor "1" del par√°metro DONE indica que ha finalizado el proceso
de compresi√≥n. La informaci√≥n de error puede consultarse en el par√°metro RET_VAL.
Si se est√° ejecutando un proceso de compresi√≥n lanzado externamente, la llamada de la
instrucci√≥n "Comprimir la memoria de la CPU" origina un error.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Output

INT

I, Q, M, D, L

Informaci√≥n de error:
El par√°metro RET_VAL de‚Äê
vuelve un c√≥digo de error
cuando se produce un error
durante la ejecuci√≥n de la ins‚Äê
trucci√≥n.

BUSY

Output

BOOL

I, Q, M, D, L

Informaci√≥n de si est√° activo
el proceso de compresi√≥n

DONE

Output

BOOL

I, Q, M, D, L

Informaci√≥n de si ha finaliza‚Äê
do el proceso de compresi√≥n

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5757

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error
El estado del proceso de compresi√≥n puede consultarse en los par√°metros BUSY y DO‚Äê
NE.

8091

Ya se est√° ejecutando un proceso de compresi√≥n lanzado externamente.

8092

La instrucci√≥n no se puede ejecutar porque se cumple una de las condiciones siguientes:
‚óè La funci√≥n "Borrar bloque" est√° activa.
‚óè Una funci√≥n de test y de puesta en servicio repercute sobre un bloque (p. ej. estado).
‚óè La funci√≥n "Copiar bloques" se ha activado por un impulso externo.
‚óè La CPU H se encuentra en un proceso de acoplamiento o actualizaci√≥n.

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

RE_TRIGR: Reiniciar tiempo de vigilancia del ciclo
Descripci√≥n
La instrucci√≥n "Reiniciar tiempo de vigilancia del ciclo" reinicia el tiempo de vigilancia del ciclo
de la CPU. El tiempo de vigilancia del ciclo se reinicia entonces con la duraci√≥n ajustada en la
configuraci√≥n de la CPU.
La instrucci√≥n "Reiniciar tiempo de vigilancia del ciclo" se puede llamar en todos los bloques
independientemente de la prioridad.
Si se llama la instrucci√≥n en un bloque de prioridad superior, p. ej. en una alarma de proceso
o una alarma de diagn√≥stico, la instrucci√≥n no se ejecuta.
La instrucci√≥n "Reiniciar tiempo de vigilancia del ciclo" se ejecuta correctamente en un espacio
de tiempo (10 veces el ciclo m√°ximo del programa), independientemente de la cantidad de
llamadas. Transcurrido ese tiempo, el ciclo del programa ya no puede prolongarse.

5758

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
La instrucci√≥n "Reiniciar tiempo de vigilancia del ciclo" no tiene par√°metros y no devuelve
informaci√≥n de error.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

STP: Finalizar programa
Descripci√≥n
La instrucci√≥n "Finalizar programa" conmuta la CPU al estado operativo STOP, con lo que se
finaliza la ejecuci√≥n del programa. Los efectos al conmutar de RUN a STOP dependen de la
configuraci√≥n de la CPU.

Par√°metros
La instrucci√≥n "Finalizar programa" no tiene par√°metros y no devuelve informaci√≥n de error.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

WAIT: Programar retardo
Descripci√≥n
La instrucci√≥n "Programar retardo" detiene la ejecuci√≥n del programa durante un periodo
parametrizado. El periodo se indica en microsegundos en el par√°metro WT.
Es posible programar tiempos de retardo de -32768 a 32767 microsegundos (Œºs). El tiempo de
retardo m√≠nimo depende de la CPU utilizada y equivale al tiempo de ejecuci√≥n de la instrucci√≥n.
La ejecuci√≥n de la instrucci√≥n puede verse interrumpida por eventos de prioridad superior y no
arrojar√° informaci√≥n de error.
V√°lido para CPU S7-300:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5759

Instrucciones
4.2 Instrucciones
En las CPU S7-300 (a excepci√≥n de S7-318), el tiempo de retardo programado con la
instrucci√≥n es un tiempo m√≠nimo. Se prolonga con el tiempo de ejecuci√≥n de las clases de
prioridad que intervienen y con las cargas del sistema.
Nota
Tiempo de retardo negativo
Si indica un tiempo de retardo negativo en el par√°metro WT, la salida de habilitaci√≥n ENO, o
el RLO y el bit BR arrojan el estado l√≥gico FALSE. Un tiempo de retardo negativo no afecta para
nada a la CPU. En KOP y FUP no se ejecutan las siguientes instrucciones vinculadas a la
salida de habilitaci√≥n ENO.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

WT

Input

INT

I, Q, M, D, L, P o
constante

Tiempo de retardo en micro‚Äê
segundos (Œºs)

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

PROTECT: Cambiar nivel de protecci√≥n
Descripci√≥n
La instrucci√≥n "Cambiar nivel de protecci√≥n" permite modificar el nivel de protecci√≥n "1"
configurado para la CPU.
El nivel de protecci√≥n "1" parametrizado con la opci√≥n activada "Eliminable por contrase√±a"
hace que sea necesario parametrizar una contrase√±a. Esta contrase√±a permite durante el
funcionamiento acceder en escritura a la CPU protegida contra escritura mediante la
instrucci√≥n "Cambiar nivel de protecci√≥n" (p. ej. cargar).
El nivel de protecci√≥n se especifica en el par√°metro MODE de la instrucci√≥n. El nivel de
protecci√≥n actual de la CPU se visualiza en la ventana de inspecci√≥n en "Propiedades >
Protecci√≥n".

5760

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra una explicaci√≥n de los niveles de protecci√≥n:
Nivel
de
pro‚Äê
tec‚Äê
ci√≥n

Explicaci√≥n

1

Se permiten todas las funciones de PG. En el caso que exista un bloqueo de la legitimaci√≥n de
la contrase√±a, este se elimina llamando la instrucci√≥n "Cambiar nivel de protecci√≥n".

2

‚óè El programa y la configuraci√≥n de la CPU no se pueden modificar. El programa contenido
en la CPU se puede leer.
‚óè Se permiten las funciones de control, observaci√≥n y comunicaci√≥n del proceso.
‚óè Se permiten todas las funciones de informaci√≥n.
‚óè Si conoce la contrase√±a v√°lida, podr√° desactivar la protecci√≥n contra escritura ajustada.
‚óè En el caso que exista un bloqueo de la legitimaci√≥n de la contrase√±a, este se elimina
llamando la instrucci√≥n "Cambiar nivel de protecci√≥n".

3

‚óè Aun conociendo la contrase√±a v√°lida, no podr√° desactivar la protecci√≥n contra lectura y
escritura ajustada.
‚óè Si al llamar la instrucci√≥n "Cambiar nivel de protecci√≥n" existe una conexi√≥n legitimada, la
llamada de la instrucci√≥n no tendr√° ning√∫n efecto en esta conexi√≥n.

Si se ha configurado el nivel de protecci√≥n "2" o "3" para la CPU, la llamada de la instrucci√≥n
"Cambiar nivel de protecci√≥n" no tiene efecto alguno.
El efecto del nivel de protecci√≥n "2" o "3" una vez ejecutada la instrucci√≥n "Cambiar nivel de
protecci√≥n" puede consultarse en la lista parcial SZL con la ID de SZL W#16#0232 y el √≠ndice
W#16#0004.
Nota
La instrucci√≥n "Cambiar nivel de protecci√≥n" permite ajustar un nivel de protecci√≥n m√°s bajo
que aquel ajustado con "Configurar hardware" de STEP 7. Supongamos que se ha configurado
el nivel de protecci√≥n 3 y a continuaci√≥n se llama la instrucci√≥n "Cambiar nivel de protecci√≥n"
con el par√°metro MODE = 12. Esto bloquear√° la legitimaci√≥n de la contrase√±a. Si la instrucci√≥n
se llama nuevamente con el par√°metro MODE = 0 o 1, el nivel de protecci√≥n 3 se mantiene y
ser√° posible desactivar la protecci√≥n de lectura y escritura introduciendo la contrase√±a v√°lida.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5761

Instrucciones
4.2 Instrucciones

Efectos de las transiciones de estado operativo en el nivel de protecci√≥n
La tabla siguiente muestra qu√© efectos tienen las transiciones de estado operativo en el nivel
de protecci√≥n ajustado con la instrucci√≥n "Cambiar nivel de protecci√≥n".
Acci√≥n

Efectos en el nivel de protecci√≥n

‚óè Selector de modo en STOP

El nivel de protecci√≥n se pone a "1". Se permiten
todas las funciones de PG.

‚óè Conexi√≥n (POWER ON) sin respaldo
‚óè Borrado total mediante el selector de modo
‚óè Cambios de configuraci√≥n y/o del programa en
el estado operativo STOP de la CPU S7-400

El sistema operativo pone el nivel de protecci√≥n a
"1". Se permiten todas las funciones de PG.

‚óè Arranque en fr√≠o
‚óè Rearranque (en caliente)

En caso necesario, llamando la instrucci√≥n "Cam‚Äê
biar nivel de protecci√≥n" en el programa es posible
ajustar el nivel de protecci√≥n en "2" o "3".

Conexi√≥n (POWER ON) respaldada

No cambia

Transici√≥n de estado operativo RUN/ARRANQUE/ No cambia
PARADA -> STOP (debida a la llamada de la ins‚Äê
trucci√≥n "Finalizar programa" (STP), a errores del
programa sin OB de error asociado o a una acci√≥n
del usuario).
S7-400: Rearranque por acci√≥n del usuario o au‚Äê
tom√°ticamente tras conexi√≥n (POWER ON)

No cambia

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

WORD

I, Q, M, D, L o
constante

Nivel de protecci√≥n
Valores posibles:
‚óè W#16#0000: Ajuste del
nivel de protecci√≥n "1"
‚óè W#16#0001: Ajuste del
nivel de protecci√≥n "2"
con legitimaci√≥n de la
contrase√±a
‚óè W#16#000C: Ajuste del
nivel de protecci√≥n "3" sin
legitimaci√≥n de la
contrase√±a
En el par√°metro MODE tam‚Äê
bi√©n se pueden indicar cons‚Äê
tantes.

RET_VAL

5762

Output

INT

I, Q, M, D, L

Si ocurre un error durante la
ejecuci√≥n, se emite una infor‚Äê
maci√≥n de error.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

La petici√≥n se ha ejecutado sin errores.

8090

Valor no admisible en el par√°metro MODE.

80C3

En este momento los recursos necesarios est√°n ocupados.

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

CiR: Controlar proceso CiR
Descripci√≥n
La instrucci√≥n "Controlar proceso CiR" permite influir en el proceso CiR en el programa de
usuario como se indica a continuaci√≥n:
‚óè Bloquear el proceso CiR. En este caso, se rechazar√° siempre la carga de una configuraci√≥n
modificada desde la programadora en la CPU. El bloqueo se aplica hasta que se
desbloquee con la instrucci√≥n "Controlar proceso CiR".
‚óè Bloqueo condicional del proceso CiR estableciendo un l√≠mite superior en el par√°metro
FRZ_TIME para el tiempo de sincronizaci√≥n CiR. En este caso, s√≥lo se permitir√° cargar una
configuraci√≥n modificada desde la programadora en la CPU si el tiempo de sincronizaci√≥n
CiR calculado en la CPU no excede el l√≠mite superior definido.
‚óè Desbloquear el proceso CiR. El l√≠mite superior del tiempo de sincronizaci√≥n CiR se
establece en el valor predeterminado de 1000 ms.
‚óè Determinar si el proceso CiR est√° o no habilitado. Si el proceso CiR est√° habilitado o lo est√°
condicionadamente, el l√≠mite superior actual del tiempo de sincronizaci√≥n CiR se indica en
el par√°metro A_FT de la instrucci√≥n.
Nota
Durante el tiempo de sincronizaci√≥n CiR, las salidas est√°n congeladas y las entradas no se
eval√∫an.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5763

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

BYTE

I, Q, M, D, L o
constante

ID de la petici√≥n
Los valores admisibles del
par√°metro MODE son:
‚óè 0: Funci√≥n de informaci√≥n
‚óè 1: Habilitar proceso CiR
‚óè 2: Bloquear proceso CiR
‚óè 3: Bloquear proceso CiR
de forma condicionada.
El l√≠mite superior del
tiempo de sincronizaci√≥n
CiR se define en
FRZ_TIME.

FRZ_TIME

Input

TIME

I, Q, M, D, L o
constante

L√≠mite superior del tiempo de
sincronizaci√≥n CiR en milise‚Äê
gundos.
Rango de valores admisible:
60 ... 2500 ms (valor prede‚Äê
terminado: 1000 ms)
El par√°metro FRZ_TIME s√≥lo
es relevante cuando el par√°‚Äê
metro MODE se establece
en el valor "3".

RET_VAL

Output

INT

I, Q, M, D, L

Informaci√≥n de error
Si el par√°metro MODE est√° a
"0", el par√°metro RET_VAL
indica si el proceso CiR est√°
habilitado o no.

A_FT

Output

TIME

I, Q, M, D, L

L√≠mite superior v√°lido actual‚Äê
mente del tiempo de sincro‚Äê
nizaci√≥n CiR

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

La petici√≥n se ha ejecutado sin errores.
Este c√≥digo de error s√≥lo se puede emitir si el par√°metro MODE est√° puesto al valor 1, 2
√≥ 3.

0001

El proceso CiR est√° habilitado.
Este c√≥digo de error s√≥lo se puede emitir si el par√°metro MODE est√° puesto al valor "0".

5764

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0002

El proceso CiR est√° bloqueado.
Este c√≥digo de error s√≥lo se puede emitir si el par√°metro MODE est√° puesto al valor "0".

0003

El proceso CiR est√° bloqueado de forma condicionada.

8001

La CPU no est√° lista para un proceso CiR. Se est√° utilizando una CPU H en el sistema H
(modo "Individual") o una CPU est√°ndar en modo multiprocesador.

8002

El valor del par√°metro MODE no es admisible.

8003

El valor del par√°metro FRZ_TIME no es admisible.

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

Este c√≥digo de error s√≥lo se puede emitir si el par√°metro MODE est√° puesto al valor "0".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
La instrucci√≥n "Controlar proceso CiR" permite programar p. ej. que no se lance ning√∫n
proceso CiR en periodos en los que se requiera la capacidad m√°xima de la CPU para el
procesamiento.
Para ello, debe llamarse la instrucci√≥n "Controlar proceso CiR" en el programa antes de
comenzar el periodo con una mayor actividad de procesos y ejecutarla con el valor "2"
(Bloquear proceso CiR) en el par√°metro MODE. Con ello se bloquea el proceso CiR.
Para volver a habilitar el proceso CiR tras finalizar el periodo de actividad aumentada del
proceso, la instrucci√≥n "Controlar proceso CiR" debe llamarse de nuevo y ejecutarse con el
valor "1" en el par√°metro MODE. De manera alternativa tambi√©n puede establecer el
par√°metro MODE en el valor "3" y bloquear as√≠ el proceso CiR.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5765

Instrucciones
4.2 Instrucciones

Operaciones l√≥gicas con palabras
NOT: Invertir
Descripci√≥n
La instrucci√≥n "Invertir" permite invertir el estado l√≥gico de los bits del operando. Al ejecutar la
instrucci√≥n, el valor del operando se combina con una operaci√≥n l√≥gica O-exclusiva utilizando
una plantilla hexadecimal (W#16#FFFF para n√∫meros de 16 bits o DW#16#FFFF FFFF para
n√∫meros de 32 bits). Esto invierte el estado l√≥gico de los distintos bits y lo devuelve como
resultado.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando>

Input

Secuencias de
bits, enteros

I, Q, M, D, L, P o
constante

Valor de entrada

<Resultado>

Output

Secuencias de
bits, enteros

I, Q, M, D, L, P

Complemento a 1 del valor
del operando

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"TagOut_Value" := NOT("TagIn_Value")

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

TagIn_Value

W#16#000F

TagOut_Value

W#16#FFF0

La instrucci√≥n invierte el estado l√≥gico de los distintos bits del operando "TagIn_Value" y
escribe el resultado en el operando "TagOut_Value".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

5766

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

DECO: Descodificar
Descripci√≥n
La instrucci√≥n "Descodificar" activa un bit predeterminado por el valor de entrada en el valor de
salida.
La instrucci√≥n "Descodificar" lee el valor de la entrada IN y activa el bit del par√°metro OUT cuya
posici√≥n de bit equivale al valor le√≠do. Los dem√°s bits del valor de salida se rellenan con ceros.
Si el valor de la entrada IN es mayor que 31, se ejecuta una instrucci√≥n modulo 32.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

WORD, INT

I, Q, M, D, L, P o
constante

Posici√≥n del bit que se activa
en el valor de salida.

OUT

Output

DWORD

I, Q, M, D, L, P

Valor de salida

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".
En la lista desplegable "???" puede seleccionar el tipo de datos de la instrucci√≥n.

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL DECO INT_DWORD
(IN := "Tag_Input"
OUT => "Tag_Output"
)

La figura siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
‡≤±7DJB,QSXW‡≤Ø




‡≤±7DJB2XWSXW‡≤Ø

 



 

La instrucci√≥n lee el n√∫mero de bit "3" del valor del operando "Tag_Input" de la entrada y activa
el tercer bit del valor del operando "Tag_Output" de la salida.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5767

Instrucciones
4.2 Instrucciones

ENCO: Codificar
Descripci√≥n
La instrucci√≥n "Codificar" permite leer el n√∫mero del bit menos significativo que est√° activado
en el valor de entrada y depositarlo en la salida OUT.
La instrucci√≥n "Codificar" selecciona el bit menos significativo del valor de la entrada IN y
escribe su n√∫mero de bit en la variable de la salida OUT. Si la entrada IN devuelve el valor
DW#16#00000001 o DW#16#00000000, se deposita el valor "0" en el par√°metro OUT.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

DWORD

I, Q, M, D, L, P o
constante

Valor de entrada

OUT

Output

INT

I, Q, M, D, L, P

Valor de salida

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL ENCO DWORD
(IN := "Tag_Input"
OUT => "Tag_Output"
)

La figura siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:


 



‡≤Ø7DJB,QSXW‡≤Ø  
‡≤Ø7DJB2XWSXW‡≤Ø 

La instrucci√≥n selecciona el bit menos significativo que est√° activado en la entrada "TagInput"
y escribe el bit "3" en la variable de la salida "Tag_Output".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

5768

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

SEL: Seleccionar
Descripci√≥n
La instrucci√≥n "Seleccionar" permite seleccionar, en funci√≥n de un interruptor (entrada G), una
de las entradas IN0 o IN1 y copiar su contenido en la salida OUT. Si la entrada G tiene el estado
l√≥gico "0", se copia el valor de la entrada IN0. Si la entrada G tiene el estado l√≥gico "1", se copia
el valor de la entrada IN1 en la salida OUT.
Para poder procesar la instrucci√≥n, las variables de todos los par√°metros deben ser del mismo
tipo de datos.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

G

Input

BOOL

I, Q, M, D, L, T, C

IN0

Input

I, Q, M, D, L, P
Secuencias de
bits, enteros, n√∫‚Äê
meros en coma flo‚Äê
tante, temporiza‚Äê
dores, CHAR,
TOD, DATE

Primer valor de entrada

IN1

Input

I, Q, M, D, L, P
Secuencias de
bits, enteros, n√∫‚Äê
meros en coma flo‚Äê
tante, temporiza‚Äê
dores, CHAR,
TOD, DATE

Segundo valor de entrada

OUT

Output

I, Q, M, D, L, P
Secuencias de
bits, enteros, n√∫‚Äê
meros en coma flo‚Äê
tante, temporiza‚Äê
dores, CHAR,
TOD, DATE

Resultado

Interruptor

En la lista desplegable "???" puede seleccionar el tipo de datos de la instrucci√≥n.
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL SEL INT
(G := "Tag_Input_G"
IN0 := "Tag_Input0"
IN1 := "Tag_Input1"
OUT => "Tag_Output"
)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5769

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Par√°metro

Operando

Valor

G

Tag_Input_G

0

1

IN0

Tag_Input0

W#16#0000

W#16#4C

IN1

Tag_Input1

W#16#FFFF

W#16#5E

OUT

Tag_Output

W#16#0000

W#16#5E

Dependiendo del estado l√≥gico de la entrada "Tag_Input_G", se selecciona el valor de la
entrada "Tag_Input0" o "Tag_Input1" y se copia en la salida "Tag_Output".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Desplazamiento y rotaci√≥n
SHR: Desplazar a la derecha
Descripci√≥n
Con la instrucci√≥n "Desplazar a la derecha", el contenido del operando 1 se mueve bit a bit
hacia la derecha. El operando 2 determina el n√∫mero de posiciones de bit que debe
desplazarse el valor indicado.
Cuando el valor del operando 2 es "0", se copia en valor del operando 1 en el resultado.
Si el valor del operando 2 es mayor que el n√∫mero de posiciones de bit disponibles, el valor del
operando 1 se desplaza hacia la derecha las posiciones de bit disponibles.
En los valores sin signo, se rellenan con ceros las posiciones de bits que quedan libres en el
√°rea izquierda del operando 1 al realizar el desplazamiento. Si el valor indicado lleva signo, las
posiciones libres se ocupan con el estado l√≥gico del bit de signo.
La figura siguiente muestra c√≥mo el contenido del operando 1 del tipo de datos INT se
desplaza cuatro posiciones de bit hacia la derecha:

5770

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones


2SHUDQGR















2SHUDQGR %LW
GHVLJQR

5HVXOWDGR








































G¬ØJLWRV

























(VWRVFXDWUR
ELWVVHSLHUGHQ

/DVSRVLFLRQHVGHELWOLEHUDGDV
VHUHOOHQDQFRQHOHVWDGRO¬µJLFR
GHOELWGHVLJQR

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operan‚Äê
do1>

Input

Secuencias de
bits, enteros

I, Q, M, D, L, P o
constante

Valor que se desplaza

<Operan‚Äê
do2>

Input

BYTE, WORD, INT I, Q, M, D, L, P o
constante

N√∫mero de posiciones de bit
que se desplaza el valor

<Resultado>

Output

Secuencias de
bits, enteros

Resultado de la instrucci√≥n

I, Q, M, D, L

En la lista desplegable "???" puede seleccionar el tipo de datos de la instrucci√≥n.
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := SHR_INT("Tag_InValue","Tag_Number")

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

0011 1111 1010 1111

Tag_Number

3

Tag_OutValue

0000 0111 1111 0101

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5771

Instrucciones
4.2 Instrucciones
El contenido del operando "Tag_InValue" se desplaza tres posiciones de bit hacia la derecha
y se indica como resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

SHL: Desplazar a la izquierda
Descripci√≥n
Con la instrucci√≥n "Desplazar a la izquierda", el contenido del operando 1 se mueve bit a bit
hacia la izquierda. El operando 2 determina el n√∫mero de posiciones de bit que debe
desplazarse el valor indicado.
Cuando el valor del operando 2 es "0", se copia en valor del operando 1 en el resultado.
Si el valor del operando 2 es mayor que el n√∫mero de posiciones de bit disponibles, el valor del
operando 1 se desplaza hacia la izquierda las posiciones de bit disponibles.
Las posiciones de bit que quedan libres en el √°rea derecha del operando 1 al realizar el
desplazamiento se rellenan con ceros.
La figura siguiente muestra c√≥mo el contenido del operando 1 del tipo de datos WORD se
desplaza seis posiciones de bit hacia la izquierda:


2SHUDQG







2SHUDQGR

5HVXOWDGR




























G¬ØJLWRV

     

(VWRVVHLV
ELWVVHSLHUGHQ

5772





































/DVSRVLFLRQHV
GHELWOLEHUDGDVVH
UHOOHQDQFRQFHURV

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operan‚Äê
do1>

Input

Secuencias de
bits, enteros

I, Q, M, D, L, P o
constante

Valor que se desplaza

<Operan‚Äê
do2>

Input

BYTE, WORD, INT I, Q, M, D, L, P o
constante

N√∫mero de posiciones de bit
que se desplaza el valor

<Resultado>

Output

Secuencias de
bits, enteros

Resultado de la instrucci√≥n

I, Q, M, D, L

En la lista desplegable "???" puede seleccionar el tipo de datos de la instrucci√≥n.
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := SHL_WORD("Tag_InValue","Tag_Number")

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

0011 1111 1010 1111

Tag_Number

4

Tag_OutValue

1111 1010 1111 0000

El contenido del operando "Tag_InValue" se desplaza cuatro posiciones de bit hacia la
izquierda y se indica como resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

ROR: Rotar a la derecha
Descripci√≥n
Con la instrucci√≥n "Rotar a la derecha", el contenido del operando 1 se rota bit a bit hacia la
derecha. El operando 2 determina el n√∫mero de posiciones de bit que debe rotarse el valor
indicado.
Cuando el valor del operando 2 es "0", se copia en valor del operando 1 en el resultado.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5773

Instrucciones
4.2 Instrucciones
Si el valor del operando 2 es mayor que el n√∫mero de posiciones de bit disponibles, el valor del
operando 1 se rota el n√∫mero indicado de posiciones de bit.
Los bits que quedan libres al realizar la rotaci√≥n se rellenan con los bits desplazados hacia
fuera.
La figura siguiente muestra c√≥mo el contenido de un operando del tipo de datos DWORD rota
tres posiciones hacia la derecha:


2SHUDQGR

 



       

2SHUDQGR

G¬ØJLWRV

5HVXOWDGR

       



(OHVWDGRO¬µJLFRGHORVWUHV
ELWVGHVSOD]DGRVVHLQWURGXFHHQODV
SRVLFLRQHVTXHKDQTXHGDGROLEUHV

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operan‚Äê
do1>

Input

BYTE, WORD,
DWORD, DINT

I, Q, M, D, L, P o
constante

Valor que se rota

<Operan‚Äê
do2>

Input

BYTE, WORD, INT I, Q, M, D, L, P o
constante

N√∫mero de posiciones de bit
que rota el valor

<Resultado>

Output

BYTE, WORD,
DWORD, DINT

Resultado de la instrucci√≥n

I, Q, M, D, L

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := ROR("Tag_InValue", "Tag_Number")

5774

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

1010 1010 0000 1111 0000 1111 0101 0101

Tag_Number

5

Tag_OutValue

1010 1101 0101 0000 0111 1000 0111 1010

El contenido del operando "Tag_InValue" se rota cinco posiciones de bit hacia la derecha y se
indica como resultado en el operando "Tag_OutValue".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

ROL: Rotar a la izquierda
Descripci√≥n
Con la instrucci√≥n "Rotar a la izquierda", el contenido del operando 1 se rota bit a bit hacia la
izquierda. El operando 2 determina el n√∫mero de posiciones de bit que debe rotarse el valor
indicado.
Cuando el valor del operando 2 es "0", se copia en valor del operando 1 en el resultado.
Si el valor del operando 2 es mayor que el n√∫mero de posiciones de bit disponibles, el valor del
operando 1 se rota el n√∫mero indicado de posiciones de bit.
Los bits que quedan libres al realizar la rotaci√≥n se rellenan con los bits desplazados hacia
fuera.
La figura siguiente muestra c√≥mo el contenido de un operando del tipo de datos DWORD rota
tres posiciones hacia la izquierda:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5775

Instrucciones
4.2 Instrucciones


2SHUDQGR

 

       

2SHUDQGR

5HVXOWDGR



G¬ØJLWRV



       
(OHVWDGRO¬µJLFRGHORVWUHV
ELWVGHVSOD]DGRVVHLQWURGXFHHQODV
SRVLFLRQHVTXHKDQTXHGDGROLEUHV

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operan‚Äê
do1>

Input

BYTE, WORD,
DWORD, DINT

I, Q, M, D, L, P o
constante

Valor que se rota

<Operan‚Äê
do2>

Input

BYTE, WORD, INT I, Q, M, D, L, P o
constante

N√∫mero de posiciones de bit
que rota el valor

<Resultado>

Output

BYTE, WORD,
DWORD, DINT

Resultado de la instrucci√≥n

I, Q, M, D, L

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
"Tag_OutValue" := ROL("Tag_InValue","Tag_Number")

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Operando

Valor

Tag_InValue

1111 0000 1010 1010 0000 1111 0000 1111

Tag_Number

5

Tag_OutValue

0001 0101 0100 0001 1110 0001 1111 1110

El contenido del operando "Tag_InValue" se rota cinco posiciones de bit hacia la izquierda y se
indica como resultado en el operando "Tag_OutValue".

5776

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Otras instrucciones
SET: Activar √°rea por bits
Descripci√≥n
La instrucci√≥n "Activar √°rea por bits" establece el estado l√≥gico de los bits en "1" en un √°rea
indicada. El punto inicial del √°rea se define mediante el puntero del par√°metro S_BIT. Si el
puntero se√±ala al √°rea de memoria de la periferia externa (P), no se ejecuta la instrucci√≥n. El
n√∫mero de bits que deben activarse en el √°rea indicada se determina en el par√°metro N de la
instrucci√≥n. Si el par√°metro N tiene el valor "0", la llamada de la instrucci√≥n no tendr√° efecto
alguno.
La instrucci√≥n se ejecuta s√≥lo si el bit MCR est√° a "1". Si el bit MCR tiene el estado l√≥gico "0",
no se modifican los bits en el √°rea indicada.
Nota
Par√°metro N
En el par√°metro N tambi√©n es posible interconectar un elemento de un bloque de datos.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

S_BIT

Input

POINTER

I, Q, M, D

Apunta al primer bit del √°rea
cuyos bits se activan
En el direccionamiento indi‚Äê
recto por registro inter√°rea,
el puntero debe indicarse en
formato de palabra doble.

N

Input

INT

I, Q, M, D, L, P o
constante

N√∫mero de bits que deben
activarse

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5777

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL SET
(S_BIT := P#M0.0
N := 10
)

La instrucci√≥n activa 10 bits en el √°rea de M0.0 a M1.2.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

SETP: Activar mapa de bits en el √°rea de periferia
Descripci√≥n
La instrucci√≥n "Activar mapa de bits en el √°rea de periferia" permite poner los bits de un √°rea
de periferia al estado l√≥gico "1". Paralelamente a los bits de periferia, tambi√©n se activan los
bits correspondientes en la memoria imagen de proceso de las salidas.
Los par√°metros N y SA sirven para definir el mapa de bits que debe activarse. Los bits del
mapa deben encontrarse en aquella parte del √°rea de periferia que tiene asignada una
memoria imagen de proceso.
Si no se ha conectado periferia para una parte del mapa de bits seleccionado, la instrucci√≥n
intentar√° activar el mapa de bits completo. En este caso se devuelve una informaci√≥n de error
en el par√°metro RET_VAL.
El √°rea de periferia se activa por bytes. Si el mapa de bits definido a trav√©s de los par√°metros
N y SA no empieza ni termina en un l√≠mite de byte, la llamada de la instrucci√≥n tendr√° el efecto
siguiente:
‚óè Los bits contenidos en el primer o √∫ltimo byte que debe transferirse y que no pertenecen al
mapa de bits definido, obtienen el valor del bit correspondiente en la memoria imagen de
proceso de las salidas.
ADVERTENCIA
Comportamiento no intencionado
El ajuste de los bits al valor del bit correspondiente en la memoria imagen de proceso de
las salidas puede ocasionar p. ej. el arranque accidental de motores o la desconexi√≥n de
sistemas de refrigeraci√≥n.
‚óè Los bits que pertenecen al mapa de bits definido se ponen al estado l√≥gico "1".
La instrucci√≥n "Activar mapa de bits en el √°rea de periferia" debe llamarse en un √°rea MCR.

5778

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La llamada de la instrucci√≥n "Activar mapa de bits en el √°rea de periferia" no tiene efecto alguno
si se cumple una de las condiciones siguientes:
‚óè El par√°metro N devuelve el valor "0"
‚óè El bit MCR tiene el estado l√≥gico "1".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

N

Input

INT

I, Q, M, D, L o
constante

N√∫mero de bits que deben
activarse.

RET_VAL

Output

INT

I, Q, M, D, L

Informaci√≥n de error

SA

Output

POINTER

P

Puntero hacia el primer bit
que debe activarse

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL SETP
(N := 8
RET_VAL => "Tag_Error"
SA => P#10.0
)

La instrucci√≥n activa 8 bits en el √°rea de periferia conforme a las salidas Q10.0 a Q10.7.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5779

Instrucciones
4.2 Instrucciones
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

SETI: Activar √°rea por bytes
Descripci√≥n
La instrucci√≥n "Activar √°rea por bytes" establece en "1" el estado l√≥gico de los bits en un √°rea
indicada de bytes. El punto inicial del √°rea se define en el par√°metro S_BYTE. El tama√±o del
√°rea se define indicando el n√∫mero de bits que deben activarse en el par√°metro N.
Nota
El valor del par√°metro N debe ser un m√∫ltiplo de 8 (p. ej. 8, 16, 24, etc.).
El puntero indicado en el par√°metro S_BYTE debe se√±alar al √°rea de memoria de la periferia
externa (P). Puesto que al √°rea de memoria "P" se accede en formato de byte, palabra y
palabra doble, el puntero del par√°metro S_BYTE debe se√±alar a un operando equivalente a un
valor l√≠mite de byte; por tanto, el n√∫mero de bit del puntero debe ser "0".
Nota
El estado l√≥gico de los bits correspondientes en la memoria imagen de proceso de las salidas
se pone a "0".
La llamada de la instrucci√≥n "Activar √°rea por bytes" no tiene efecto alguno si se cumple una
de las condiciones siguientes:
‚óè El puntero del par√°metro S_BYTE no se√±ala al √°rea de memoria de la periferia externa.
‚óè El puntero del par√°metro S_BYTE se√±ala a un operando que no equivale a ning√∫n valor
l√≠mite de byte.
‚óè El valor del par√°metro N no es un m√∫ltiplo de 8.
‚óè El bit MCR tiene el estado l√≥gico "0".

5780

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

S_BYTE

Input

POINTER

P o constante

Se√±ala al primer byte del
√°rea cuyos bits se activan.
En el direccionamiento indi‚Äê
recto por registro inter√°rea,
el puntero debe indicarse en
formato de palabra doble.

N

Input

INT

I, Q, M, D, L, P o
constante

Tama√±o del √°rea que debe
activarse
El √°rea se indica mediante el
n√∫mero de bits como m√∫ltiplo
de 8 (p. ej. 8, 16, 24, etc.).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL SETI
(S_BYTE := P#2.0
N := 16
)

La instrucci√≥n activa 2 bytes (16 bits) en el √°rea de P2.0 a P3.7.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

RESET: Desactivar √°rea por bits
Descripci√≥n
La instrucci√≥n "Desactivar √°rea por bits" establece el estado l√≥gico de los bits en "0" en un √°rea
indicada. El punto inicial del √°rea se define mediante el puntero del par√°metro S_BIT. Si el
puntero se√±ala al √°rea de memoria de la periferia externa, no se ejecuta la instrucci√≥n. El
n√∫mero de bits que deben desactivarse en el √°rea indicada se determina en el par√°metro N.
Si el par√°metro N tiene el valor "0", la llamada de la instrucci√≥n no tendr√° efecto alguno.
La instrucci√≥n se ejecuta s√≥lo si el bit MCR est√° a "1". Si el bit MCR tiene el estado l√≥gico "0",
no se modifican los bits en el √°rea indicada.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5781

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

S_BIT

Input

POINTER

I, Q, M, D

Se√±ala al primer bit del √°rea
cuyos bits se desactivan.
En el direccionamiento indi‚Äê
recto por registro inter√°rea,
el puntero debe indicarse en
formato de palabra doble.

N

Input

INT

I, Q, M, D, L, P o
constante

N√∫mero de bits que deben
desactivarse

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL RESET
(S_BIT := P#M0.0
N := 10
)

La instrucci√≥n desactiva 10 bits en el √°rea de M0.0 a M1.2.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

RESETP: Desactivar mapa de bits en el √°rea de periferia
Descripci√≥n
La instrucci√≥n "Desactivar mapa de bits en el √°rea de periferia" permite poner los bits de un
√°rea de periferia al estado l√≥gico "0". Simult√°neamente con los bits de periferia se desactivan
tambi√©n los bits correspondientes en la memoria imagen de proceso de las salidas.
Los par√°metros N y SA de la instrucci√≥n sirven para definir el mapa de bits que debe
desactivarse. Los bits del mapa deben encontrarse en aquella parte del √°rea de periferia que
tiene asignada una memoria imagen de proceso.
Si no hay periferia enchufada para una parte del mapa de bits seleccionado, la instrucci√≥n
intentar√° desactivar el mapa de bits completo. En este caso se devuelve una informaci√≥n de
error en el par√°metro RET_VAL.

5782

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El √°rea de periferia se inicializa por bytes. Si el mapa de bits definido a trav√©s de los par√°metros
N y SA no empieza ni termina en un l√≠mite de byte, la llamada de la instrucci√≥n tendr√° el efecto
siguiente:
‚óè Los bits contenidos en el primer o √∫ltimo byte que debe transferirse y que no pertenecen al
mapa de bits definido, obtienen el valor del bit correspondiente en la memoria imagen de
proceso de las salidas.
ADVERTENCIA
Comportamiento no intencionado
El ajuste de los bits al valor del bit correspondiente en la memoria imagen de proceso de
las salidas puede ocasionar p. ej. el arranque accidental de motores o la desconexi√≥n de
sistemas de refrigeraci√≥n.
‚óè Los bits que pertenecen al mapa de bits definido se restablecen al estado l√≥gico "0".
La instrucci√≥n "Desactivar mapa de bits en el √°rea de periferia" debe llamarse en un √°rea MCR.
La llamada de la instrucci√≥n "Desactivar mapa de bits en el √°rea de periferia" no tiene efecto
alguno si se cumple una de las condiciones siguientes:
‚óè El par√°metro N devuelve el valor "0"
‚óè El bit MCR tiene el estado l√≥gico "1".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

N

Input

INT

I, Q, M, D, L o
constante

N√∫mero de bits que deben
desactivarse

RET_VAL

Output

INT

I, Q, M, D, L

Informaci√≥n de error

SA

Output

POINTER

P

Puntero al primer bit que de‚Äê
be desactivarse

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5783

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL RESETP
(N := 8
RET_VAL => "Tag_Error"
SA => P#10.0
)

La instrucci√≥n desactiva 8 bits en el √°rea de periferia conforme a las salidas Q10.0 a Q10.7.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)
Cambiar formatos de visualizaci√≥n en el estado del programa (P√°gina 8529)
Principios b√°sicos de GRAPH (P√°gina 8191)

RESETI: Desactivar √°rea por bytes
Descripci√≥n
La instrucci√≥n "Desactivar √°rea por bytes" restablece el estado l√≥gico de los bits a "0" en un
√°rea de bytes indicada. El punto inicial del √°rea se define mediante el puntero del par√°metro
S_BYTE. El tama√±o del √°rea se define indicando el n√∫mero de bits que deben desactivarse en
el par√°metro N de la instrucci√≥n.
Nota
El valor del par√°metro N debe ser un m√∫ltiplo de 8 (p. ej. 8, 16, 24, etc.).
El puntero indicado en el par√°metro S_BYTE debe se√±alar al √°rea de memoria de la periferia
externa. Puesto que al √°rea de memoria "P" se accede en formato de byte, palabra y palabra
doble, el puntero del par√°metro S_BYTE debe se√±alar a un operando equivalente a un valor
l√≠mite de byte; por tanto, el n√∫mero de bit del puntero debe ser "0".
Nota
El estado l√≥gico de los bits correspondientes en la memoria imagen de proceso de las salidas
se pone a "0".

5784

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La llamada de la instrucci√≥n "Desactivar √°rea por bytes" no tiene efecto alguno si se cumple
una de las condiciones siguientes:
‚óè El puntero del par√°metro S_BYTE no se√±ala al √°rea de memoria de la periferia externa.
‚óè El puntero del par√°metro S_BYTE se√±ala a un operando que no equivale a ning√∫n valor
l√≠mite de byte.
‚óè El valor del par√°metro N no es un m√∫ltiplo de 8.
‚óè El bit MCR tiene el estado l√≥gico "0".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

S_BYTE

Input

POINTER

P o constante

Se√±ala al primer byte del
√°rea cuyos bits se desacti‚Äê
van.
En el direccionamiento indi‚Äê
recto por registro inter√°rea,
el puntero debe indicarse en
formato de palabra doble.

N

Input

INT

I, Q, M, D, L, P o
constante

Tama√±o del √°rea cuyos bits
se desactivan.
El √°rea se indica mediante el
n√∫mero de bits como m√∫ltiplo
de 8 (p. ej. 8, 16, 24, etc.).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL RESETI
(S_BYTE := P#2.0
N := 16
)

La instrucci√≥n desactiva 2 bytes (16 bits) en el √°rea de P2.0 a P3.7.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5785

Instrucciones
4.2 Instrucciones

REPL_VAL: Introducir valor sustitutivo
Descripci√≥n
La instrucci√≥n "Introducir valor sustitutivo" permite introducir un valor sustitutivo en el
acumulador 1 (ACU 1) desde un bloque de organizaci√≥n de error s√≠ncrono.
Nota
La instrucci√≥n "Introducir valor sustitutivo" s√≥lo se puede llamar desde bloques de organizaci√≥n
de error s√≠ncrono (OB 121, OB 122).
La instrucci√≥n "Introducir valor sustitutivo" se utiliza si ya no es posible leer ning√∫n valor de un
m√≥dulo. Tras cada acceso a dicho m√≥dulo se inicia el OB 122. Llamando la instrucci√≥n
"Introducir valor sustitutivo" es posible cargar un valor sustitutivo en el acumulador 1. La
ejecuci√≥n del programa se prosigue entonces con este valor sustitutivo. La informaci√≥n
necesaria para seleccionar el valor sustitutivo puede consultarse en las variables locales del
OB 122.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

VAL

Input

DWORD

I, Q, M, D, L o
constante

Valor sustitutivo

RET_VAL

Output

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Par√°metro RET_VAL
La tabla siguiente muestra el significado de los valores del par√°metro RET_VAL:
C√≥digo de Descripci√≥n
error*
(W#16#....)
0000

Ning√∫n error

8080

La instrucci√≥n no se ha llamado desde un OB de error s√≠ncrono.

8xyy

Encontrar√° m√°s informaci√≥n de error en "Consulte tambi√©n".

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

5786

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

DRUM: Materializar circuito secuencial sucesivo
Descripci√≥n
La instrucci√≥n "Materializar circuito secuencial sucesivo" ocupa los bits de salida programados
(OUT1 a OUT16) y la palabra de salida (OUT_WORD) con los valores programados del
par√°metro OUT_VAL del paso respectivo. El paso en cuesti√≥n debe cumplir las condiciones de
la m√°scara de habilitaci√≥n programada en el par√°metro S_MASK mientras la instrucci√≥n
permanece en dicho paso. La instrucci√≥n pasa al paso siguiente cuando el evento de √©ste es
verdadero y una vez transcurrido el tiempo programado para el paso actual, o bien cuando el
valor del par√°metro JOG cambia de "0" a "1". La instrucci√≥n se desactiva cuando el estado
l√≥gico del par√°metro RESET cambia a "1". Con ello, el paso actual se iguala al paso
predeterminado (DSP).
El tiempo de permanencia en un paso se calcula multiplicando la base de tiempo
predeterminada (DTBP) por el valor de contaje predeterminado (S_PRESET) para cada paso.
Al comienzo de un nuevo paso, este valor calculado se carga en el par√°metro DCC, que
contiene el tiempo restante para el paso actual. Por ejemplo, si el valor del par√°metro DTBP es
"2" y el valor predeterminado para el primer paso es "100" (100 ms), el par√°metro DCC
devolver√° el valor "200" (200 ms).
Un paso puede programarse con un valor de tiempo, con un evento o con ambos. Los pasos
programados con un bit de evento y el valor de tiempo "0" pasan al siguiente paso en cuanto
el estado l√≥gico del bit de evento es "1". Los pasos programados solo con un valor de tiempo
empiezan a contar el tiempo inmediatamente. Los pasos programados con un bit de evento y
un valor de tiempo mayor que "0" empiezan a contar el tiempo en cuanto el estado l√≥gico del
bit de evento es "1". Los bits de evento se inicializan con el estado l√≥gico "1".
Si el circuito secuencial sucesivo se encuentra en el √∫ltimo paso programado (LST_STEP) y ha
transcurrido el tiempo para dicho paso, el estado l√≥gico del par√°metro Q se pone a "1". De lo
contrario, se pone a "0". Si est√° activado el par√°metro Q, la instrucci√≥n permanece en el paso
hasta la desactivaci√≥n.
En la m√°scara configurable (S_MASK) es posible seleccionar los distintos bits de la palabra de
salida (OUT_WORD) y activar o desactivar los bits de salida (OUT1 a OUT16) mediante los
valores de salida (OUT_VAL). Si un bit de la m√°scara configurable tiene el estado l√≥gico "1",
el valor OUT_VAL activa o desactiva el bit correspondiente. Si el estado l√≥gico de un bit de la
m√°scara configurable es "0", no cambia el bit respectivo. Todos los bits de la m√°scara
configurable de todos los 16 pasos se inicializan con el estado l√≥gico "1".
El bit de salida del par√°metro OUT1 equivale al bit menos significativo de la palabra de salida
(OUT_WORD). El bit de salida del par√°metro OUT16 equivale al bit m√°s significativo de la
palabra de salida (OUT_WORD).
Al insertar la instrucci√≥n en el programa se abre autom√°ticamente el cuadro de di√°logo
"Opciones de llamada". El bloque de datos creado se encuentra en la carpeta "Recursos del

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5787

Instrucciones
4.2 Instrucciones
programa" del √°rbol del proyecto, en "Bloques de programa > Bloques de sistema". Encontrar√°
m√°s informaci√≥n al respecto en "Consulte tambi√©n".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RESET

Input

BOOL

I, Q, M, D, L

El estado l√≥gico "1" indica
una condici√≥n de desactiva‚Äê
ci√≥n.

JOG

Input

BOOL

I, Q, M, D, L

Si el estado l√≥gico cambia de
"0" a "1", la instrucci√≥n pasa
al siguiente paso.

DRUM_EN

Input

BOOL

I, Q, M, D, L

El estado l√≥gico "1" permite
que el circuito secuencial su‚Äê
cesivo siga contando seg√∫n
el evento y los criterios de
tiempo.

LST_STEP

Input

BYTE

I, Q, M, D, L o
constante

N√∫mero del √∫ltimo paso pro‚Äê
gramado.

EVENT(i),

Input

BOOL

I, Q, M, D, L

OUT(j),

Bit de evento (i);
El estado l√≥gico inicial es "1".

1 ‚â§ i ‚â§ 16
Output

BOOL

I, Q, M, D, L

Bit de salida (j)

Q

Output

BOOL

I, Q, M, D, L

El estado l√≥gico "1" indica
que ha transcurrido el tiempo
del √∫ltimo paso.

OUT_WORD

Output

WORD

I, Q, M, D, L, P

Direcci√≥n de palabra en la
que el circuito secuencial su‚Äê
cesivo escribe los valores de
salida.

ERR_CODE

Output

WORD

I, Q, M, D, L, P

Informaci√≥n de error

JOG_HIS

Static

BOOL

I, Q, M, D, L

Bit de evoluci√≥n del par√°me‚Äê
tro JOG

EOD

Static

BOOL

I, Q, M, D, L

El estado l√≥gico "1" indica
que ha transcurrido el tiempo
del √∫ltimo paso.

DSP

Static

BYTE

I, Q, M, D, L, P

Paso predeterminado del cir‚Äê
cuito secuencial sucesivo

DSC

Static

BYTE

I, Q, M, D, L, P

Paso actual del circuito se‚Äê
cuencial sucesivo

DCC

Static

DWORD

I, Q, M, D, L, P

Paso actual del circuito se‚Äê
cuencial sucesivo

DTBP

Static

WORD

I, Q, M, D, L, P

Base de tiempo predetermi‚Äê
nada del circuito secuencial
sucesivo

PrevTime

Static

TIME

I, Q, M, D, L o
constante

Hora de sistema anterior

1 ‚â§ j ‚â§ 16

5788

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

S_PRESET

Static

ARRAY[1..16] of
WORD

I, Q, M, D, L

Valor de contaje predetermi‚Äê
nado para cada paso [1 a 16];
1 ciclo de reloj = 1 ms.

OUT_VAL

Static

ARRAY[1..16,
0..15] of BOOL

I, Q, M, D, L

Valores de salida para cada
etapa [1 a 16, 0 a 15].

S_MASK

Static

ARRAY[1..16,
0..15] of BOOL

I, Q, M, D, L

M√°scara configurable para
cada etapa [1 a 16, 0 a 15].
Los estados l√≥gicos iniciales
son "1".

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Par√°metro ERR_CODE
La tabla siguiente muestra el significado de los valores del par√°metro ERR_CODE:
ERR_CO‚Äê
DE*

Explicaci√≥n

W#16#000
0

Ning√∫n error

W#16#000
B

El valor del par√°metro LST_STEP es menor que 1 o mayor que 16.

W#16#000
C

El valor del par√°metro DSC es menor que 1 o mayor que el valor del par√°metro
LST_STEP.

W#16#000
D

El valor del par√°metro DSP es menor que 1 o mayor que el valor de LST_STEP.

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
En el ejemplo siguiente, la instrucci√≥n pasa del paso 1 al paso 2. Los bits de salida (OUT1 a
OUT16) y la palabra de salida (OUT_WORD) se activan seg√∫n la m√°scara configurada para el
paso 2 y los valores del par√°metro OUT_VAL.
Nota
Los par√°metros est√°ticos pueden inicializarse en el bloque de datos.

GRAPH
CALL DRUM, "DRUM_DB"
(RESET := "Tag_Reset"
JOG := "Tag_Input_Jog"
DRUM_EN := "Tag_Input_Drum_EN"
LST_STEP := "Tag_Number_LastStep"
EVENTn := "MyTag_Event_n"

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5789

Instrucciones
4.2 Instrucciones
GRAPH
OUTn => "MyTag_Output_n"
Q => "Tag_Output_Q"
OUT_WORD => "Tag_OutputWord"
ERR_CODE => "Tag_ErrorCode"
)

Las tablas siguientes muestran el funcionamiento de la instrucci√≥n con valores concretos.

Antes de la ejecuci√≥n
En este ejemplo se utilizan los siguientes valores para asignar valores a los par√°metros de
entrada:
Par√°metro

Operando

Direcci√≥n

Valor

RESET

Tag_Reset

M0.0

FALSE

JOG

Tag_Input_JOG

M0.1

FALSE

DRUM_EN

Tag_Input_Drum_EN

M0.2

TRUE

LST_STEP

Tag_Number_LastStep

MB1

B#16#08

EVENT2

MyTag_Event_2

M20.0

FALSE

EVENT4

MyTag_Event_4

M20.1

FALSE

EVENT6

MyTag_Event_6

M20.2

FALSE

EVENT8

MyTag_Event_8

M20.3

FALSE

EVENT10

MyTag_Event_10

M20.4

FALSE

EVENT12

MyTag_Event_12

M20.5

FALSE

EVENT14

MyTag_Event_14

M20.6

FALSE

EVENT16

MyTag_Event_16

M20.7

FALSE

En el bloque de datos de instancia "DRUM_DB" de la instrucci√≥n se guardan los siguientes
valores:

5790

Par√°metro

Direcci√≥n

Valor

JOG_HIS

DBX12.0

FALSE

EOD

DBX12.1

FALSE

DSP

DBB13

W#16#0001

DSC

DBB14

W#16#0001

DCC

DBD16

DW#16#0000000A

DTBP

DBW20

W#16#0001

S_PRESET[1]

DBW26

W#16#0064

S_PRESET[2]

DBW28

W#16#00C8

OUT_VAL[1,0]

DBX58.0

TRUE

OUT_VAL[1,1]

DBX58.1

TRUE

OUT_VAL[1,2]

DBX58.2

TRUE

OUT_VAL[1,3]

DBX58.3

TRUE

OUT_VAL[1,4]

DBX58.4

TRUE

OUT_VAL[1,5]

DBX58.5

TRUE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Direcci√≥n

Valor

OUT_VAL[1,6]

DBX58.6

TRUE

OUT_VAL[1,7]

DBX58.7

TRUE

OUT_VAL[1,8]

DBX59.0

TRUE

OUT_VAL[1,9]

DBX59.1

TRUE

OUT_VAL[1,10]

DBX59.2

TRUE

OUT_VAL[1,11]

DBX59.3

TRUE

OUT_VAL[1,12]

DBX59.4

TRUE

OUT_VAL[1,13]

DBX59.5

TRUE

OUT_VAL[1,14]

DBX59.6

TRUE

OUT_VAL[1,15]

DBX59.7

TRUE

OUT_VAL[2,0]

DBX60.0

FALSE

OUT_VAL[2,1]

DBX60.1

FALSE

OUT_VAL[2,2]

DBX60.2

FALSE

OUT_VAL[2,3]

DBX60.3

FALSE

OUT_VAL[2,4]

DBX60.4

FALSE

OUT_VAL[2,5]

DBX60.5

FALSE

OUT_VAL[2,6]

DBX60.6

FALSE

OUT_VAL[2,7]

DBX60.7

FALSE

OUT_VAL[2,8]

DBX61.0

FALSE

OUT_VAL[2,9]

DBX61.1

FALSE

OUT_VAL[2,10]

DBX61.2

FALSE

OUT_VAL[2,11]

DBX61.3

FALSE

OUT_VAL[2,12]

DBX61.4

FALSE

OUT_VAL[2,13]

DBX61.5

FALSE

OUT_VAL[2,14]

DBX61.6

FALSE

OUT_VAL[2,15]

DBX61.7

FALSE

S_MASK[2,0]

DBX92.0

FALSE

S_MASK[2,1]

DBX92.1

TRUE

S_MASK[2,2]

DBX92.2

TRUE

S_MASK[2,3]

DBX92.3

TRUE

S_MASK[2,4]

DBX92.4

TRUE

S_MASK[2,5]

DBX92.5

FALSE

S_MASK[2,6]

DBX92.6

TRUE

S_MASK[2,7]

DBX92.7

TRUE

S_MASK[2,8]

DBX93.0

FALSE

S_MASK[2,9]

DBX93.1

FALSE

S_MASK[2,10]

DBX93.2

TRUE

S_MASK[2,11]

DBX93.3

TRUE

S_MASK[2,12]

DBX93.4

TRUE

S_MASK[2,13]

DBX93.5

TRUE

S_MASK[2,14]

DBX93.6

FALSE

S_MASK[2,15]

DBX93.7

TRUE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5791

Instrucciones
4.2 Instrucciones
Los par√°metros de salida tienen los valores siguientes antes de ejecutarse la instrucci√≥n:
Par√°metro

Operando

Direcci√≥n

Valor

Q

Tag_Output_Q

M6.0

FALSE

OUTWORD

Tag_OutputWord

MW8

W#16#FFFF

OUT1

MyTag_Output_1

M4.0

TRUE

OUT2

MyTag_Output_2

M4.1

TRUE

OUT3

MyTag_Output_3

M4.2

TRUE

OUT4

MyTag_Output_4

M4.3

TRUE

OUT5

MyTag_Output_5

M4.4

TRUE

OUT6

MyTag_Output_6

M4.5

TRUE

OUT7

MyTag_Output_7

M4.6

TRUE

OUT8

MyTag_Output_8

M4.7

TRUE

OUT9

MyTag_Output_9

M5.0

TRUE

OUT10

MyTag_Output_10

M5.1

TRUE

OUT11

MyTag_Output_11

M5.2

TRUE

OUT12

MyTag_Output_12

M5.3

TRUE

OUT13

MyTag_Output_13

M5.4

TRUE

OUT14

MyTag_Output_14

M5.5

TRUE

OUT15

MyTag_Output_15

M5.6

TRUE

OUT16

MyTag_Output_16

M5.7

TRUE

Despu√©s de la ejecuci√≥n
Una vez ejecutada la instrucci√≥n, los valores siguientes se escriben en los par√°metros de
salida:

5792

Par√°metro

Operando

Direcci√≥n

Valor

OUT1

MyTag_Output_1

M4.0

TRUE

OUT2

MyTag_Output_2

M4.1

FALSE

OUT3

MyTag_Output_3

M4.2

FALSE

OUT4

MyTag_Output_4

M4.3

FALSE

OUT5

MyTag_Output_5

M4.4

FALSE

OUT6

MyTag_Output_6

M4.5

TRUE

OUT7

MyTag_Output_7

M4.6

FALSE

OUT8

MyTag_Output_8

M4.7

FALSE

OUT9

MyTag_Output_9

M5.0

TRUE

OUT10

MyTag_Output_10

M5.1

TRUE

OUT11

MyTag_Output_11

M5.2

FALSE

OUT12

MyTag_Output_12

M5.3

FALSE

OUT13

MyTag_Output_13

M5.4

FALSE

OUT14

MyTag_Output_14

M5.5

FALSE

OUT15

MyTag_Output_15

M5.6

TRUE

OUT16

MyTag_Output_16

M5.7

FALSE

Q

Tag_Output_Q

M6.0

FALSE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Operando

Direcci√≥n

Valor

OUTWORD

Tag_OutputWord

MW8

W#16#4321

ERR_CODE

Tag_ErrorCode

MW10

W#16#0000

En el bloque de datos de instancia "DRUM_DB" de la instrucci√≥n se guardan los siguientes
valores:
Par√°metro

Direcci√≥n

Valor

JOG_HIS

DBX12.0

FALSE

EOD

DBX12.1

FALSE

DSC

DBB14

W#16#0002

DCC

DBD16

DW#16#000000C8

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

DRUM_X: Materializar circuito secuencial sucesivo
Descripci√≥n
La instrucci√≥n "Materializar circuito secuencial sucesivo" permite materializar un circuito
secuencial sucesivo con 16 pasos como m√°ximo. El n√∫mero del primer paso se define con el
par√°metro DSP. El n√∫mero del √∫ltimo paso se predetermina con el par√°metro LST_STEP.
En cada paso se escriben todos los 16 bits de salida OUT0 a OUT15 y el par√°metro de salida
OUT_WORD (que contiene los bits de salida). A un bit de salida se asigna bien sea el bit
correspondiente del campo predefinido OUT_VAL, o bien el bit de salida del paso anterior. El
valor que se asigne depender√° de la ocupaci√≥n de los bits de m√°scara en el par√°metro
S_MASK.
Nota
El ajuste predeterminado de los bits de m√°scara es 0. Para modificar el ajuste actual de uno
o varios bits de m√°scara, realice el cambio en el bloque de datos de instancia.
La instrucci√≥n "Materializar circuito secuencial sucesivo" pasa al siguiente paso cuando se
produce un flanco ascendente en el par√°metro JOG. Si la instrucci√≥n ya se encuentra en el
√∫ltimo paso y se produce un flanco ascendente en el par√°metro JOG, se activan las variables
Q y EOD. En este caso, el par√°metro DCC se pone al valor 0. La instrucci√≥n permanece en el
√∫ltimo paso hasta que el par√°metro RESET se pone al valor "1".
Adem√°s, tambi√©n se puede permitir la transici√≥n al paso siguiente en funci√≥n del tiempo. Para
ello se debe poner al valor "1" el par√°metro DRUM_EN. La transici√≥n al paso siguiente tiene
lugar si est√° activado el bit de evento (EVENTi) correspondiente al paso actual y si ha
transcurrido el tiempo predeterminado para el paso actual. El tiempo necesario para un paso

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5793

Instrucciones
4.2 Instrucciones
resulta de la multiplicaci√≥n de la base de tiempo (DTBP) por el factor de tiempo v√°lido para el
paso actual (S_PRESET).
Nota
El tiempo de ejecuci√≥n restante en el paso actual (DCC) se reduce √∫nicamente si est√° activado
el bit de evento correspondiente (EVENTi).
Al insertar la instrucci√≥n en el programa se abre autom√°ticamente el cuadro de di√°logo
"Opciones de llamada". El bloque de datos creado se encuentra en la carpeta "Recursos del
programa" del √°rbol del proyecto, en "Bloques de programa > Bloques de sistema". Encontrar√°
m√°s informaci√≥n al respecto en "Consulte tambi√©n".
Si, al llamar la instrucci√≥n, el par√°metro RESET tiene el valor "1", el circuito secuencial
sucesivo pasar√° al paso cuyo n√∫mero se ha asignado al par√°metro DSP.
Un paso puede programarse con un valor de tiempo, con un evento o con ambos. Los pasos
programados con un bit de evento y el valor de tiempo "0" pasan al siguiente paso en cuanto
el estado l√≥gico del bit de evento es "1". Los pasos programados solo con un valor de tiempo
empiezan a contar el tiempo inmediatamente. Los pasos programados con un bit de evento y
un valor de tiempo mayor que "0" empiezan a contar el tiempo en cuanto el estado l√≥gico del
bit de evento es "1".
El circuito secuencial sucesivo tambi√©n se puede conmutar en progresi√≥n en todo momento a
trav√©s del valor del par√°metro JOG.
En la primera llamada de la instrucci√≥n, el par√°metro RESET se debe poner a 1.
Si el circuito secuencial se encuentra en el √∫ltimo paso y ha transcurrido el tiempo de ejecuci√≥n
predefinido para este paso, se activan los par√°metros Q y EOD. La instrucci√≥n permanece en
el √∫ltimo paso hasta que el par√°metro RESET adopte el valor "1".
Esta instrucci√≥n se ejecuta solo en los estados operativos ARRANQUE y RUN.
El sistema operativo inicializa la instrucci√≥n "Materializar circuito secuencial sucesivo" cuando
se efect√∫a un arranque en fr√≠o. La instrucci√≥n no se inicializa en caso de un rearranque
completo (en caliente). Si la instrucci√≥n "Materializar circuito secuencial sucesivo" debe
inicializarse tras un rearranque completo (en caliente), es preciso llamarla en el OB 100 con el
valor "1" en el par√°metro RESET.

5794

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RESET

Input

BOOL

I, Q, M, D, L

El estado l√≥gico "1" desactiva
el circuito secuencial. En la
primera llamada de la instruc‚Äê
ci√≥n, el par√°metro RESET se
debe poner a "1".

JOG

Input

BOOL

I, Q, M, D, L

Un flanco de se√±al ascenden‚Äê
te (con respecto a la √∫ltima
llamada) provoca la transi‚Äê
ci√≥n al paso siguiente, siem‚Äê
pre que el circuito secuencial
no se encuentre a√∫n en el √∫l‚Äê
timo paso. La transici√≥n tiene
lugar independientemente
del valor asignado al par√°me‚Äê
tro DRUM_EN.

DRUM_EN

Input

BOOL

I, Q, M, D, L

Par√°metro de control que de‚Äê
termina si se puede realizar
una transici√≥n al paso si‚Äê
guiente en funci√≥n del tiem‚Äê
po. Si el valor es "1", es posi‚Äê
ble una transici√≥n en funci√≥n
del tiempo.

LST_STEP

Input

BYTE

I, Q, M, D, L o
constante

N√∫mero del √∫ltimo paso

EVENTi,

Los valores admisibles son 1
a 16.

Input

BOOL

I, Q, M, D, L

Bit de evento n.¬∫ i (pertenece
al paso i)

Output

BOOL

I, Q, M, D, L

Bit de salida n.¬∫ j (id√©ntico al
bit n.¬∫ j de OUT_WORD)

Q

Output

BOOL

I, Q, M, D, L

Par√°metro de estado que in‚Äê
dica si ha transcurrido el tiem‚Äê
po predefinido por el usuario
para la ejecuci√≥n del √∫ltimo
paso.

OUT_WORD

Output

WORD

I, Q, M, D, L, P

Bits de salida resumidos en
una variable

ERR_CODE

Output

WORD

I, Q, M, D, L, P

Informaci√≥n de error

JOG_HIS

Static

BOOL

I, Q, M, D, L

Irrelevante para el usuario
(par√°metro de entrada JOG
de la llamada anterior)

EOD

Static

BOOL

I, Q, M, D, L

Id√©ntico al par√°metro de sali‚Äê
da Q

DSP

Static

BYTE

I, Q, M, D, L, P o
constante

N√∫mero del primer paso

I, Q, M, D, L, P o
constante

N√∫mero del paso actual

1 ‚â§ i ‚â§ 16
OUTj,
0 ‚â§ j ‚â§ 15

DSC

Static

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

BYTE

Los valores admisibles son 1
a 16.

5795

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DCC

Static

DWORD

I, Q, M, D, L, P

Tiempo de ejecuci√≥n restan‚Äê
te del paso actual, indicado
en milisegundos (ms) (rele‚Äê
vante solo si DRUM_EN = 1 y
el bit de evento correspon‚Äê
diente = 1)

DTBP

Static

WORD

I, Q, M, D, L, P o
constante

Base de tiempo en milisegun‚Äê
dos (ms) v√°lida para todos
los pasos

PREV_TIME

Static

DWORD

I, Q, M, D, L o
constante

(Irrelevante para el usuario:
hora de sistema de la llama‚Äê
da anterior)

S_PRESET

Static

ARRAY of WORD

I, Q, M, D, L o
constante

Campo unidimensional con
los factores de tiempo para
cada paso.
Selecci√≥n recomendada de
√≠ndices: [1 a 16].
En este caso, S_PRESET [x]
contiene el factor de tiempo
del paso x.

OUT_VAL

Static

ARRAY of BOOL

I, Q, M, D, L

Campo bidimensional con
los valores que deben emitir‚Äê
se en cada paso, a no ser
que se hayan inhibido v√≠a
S_MASK.
Selecci√≥n recomendada de
√≠ndices: [1 a 16, 0 a 15]. En
este caso, OUT_VAL [x, y]
contiene el valor asignado al
bit de salida OUTy en el paso
x.

S_MASK

Static

ARRAY of BOOL

I, Q, M, D, L

Campo bidimensional con
los bits de m√°scara para ca‚Äê
da paso.
Selecci√≥n recomendada de
√≠ndices: [1 a 16, 0 a 15]. En
este caso, S_MASK [x, y]
contiene el bit de m√°scara
para el valor "y"-√©simo que
debe emitirse en el paso x.
Significado de los bits de
m√°scara:
‚óè 0: el valor
correspondiente del paso
anterior se asigna al
respectivo bit de salida.
‚óè 1: el valor
correspondiente de
OUT_VAL se asigna al
respectivo bit de salida.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

5796

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro ERR_CODE
La tabla siguiente muestra el significado de los valores del par√°metro ERR_CODE:
ERR_CO‚Äê
DE*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

8081

Valor no admisible en el par√°metro LST_STEP

8082

Valor no admisible en DSC

8083

Valor no admisible en DSP

8084

El producto DCC = DTBP * S_PRESET[DSC] excede el valor 2**31-1 (aprox. 24,86 d√≠as).

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
En el ejemplo siguiente, la instrucci√≥n pasa del paso 1 al paso 2. Los bits de salida (OUT0 a
OUT15) y la palabra de salida (OUT_WORD) se activan seg√∫n la m√°scara configurada para el
paso 2 y los valores del par√°metro OUT_VAL.
Nota
Los par√°metros est√°ticos pueden inicializarse en el bloque de datos.

GRAPH
CALL DRUM_X, "DRUM_X_DB"
(RESET := "Tag_Reset"
JOG := "Tag_Input_Jog"
DRUM_EN := "Tag_Input_Drum_EN"
LST_STEP := "Tag_Number_LastStep"
EVENTn := "MyTag_Event_n"
OUTn => "MyTag_Output_n"
Q => "Tag_Output_Q"
OUT_WORD => "Tag_OutputWord"
ERR_CODE => "Tag_ErrorCode"
)

Las tablas siguientes muestran el funcionamiento de la instrucci√≥n con valores concretos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5797

Instrucciones
4.2 Instrucciones

Antes de la ejecuci√≥n
En este ejemplo se utilizan los siguientes valores para asignar valores a los par√°metros de
entrada:
Par√°metro

Operando

Direcci√≥n

Valor

RESET

Tag_Reset

M0.0

FALSE

JOG

Tag_Input_JOG

M0.1

FALSE

DRUM_EN

Tag_Input_Drum_EN

M0.2

TRUE

LST_STEP

Tag_Number_LastStep

MB1

B#16#08

EVENT2

MyTag_Event_2

M20.0

FALSE

EVENT4

MyTag_Event_4

M20.1

FALSE

EVENT6

MyTag_Event_6

M20.2

FALSE

EVENT8

MyTag_Event_8

M20.3

FALSE

EVENT10

MyTag_Event_10

M20.4

FALSE

EVENT12

MyTag_Event_12

M20.5

FALSE

EVENT14

MyTag_Event_14

M20.6

FALSE

EVENT16

MyTag_Event_16

M20.7

FALSE

En el bloque de datos de instancia "DRUM_X_DB" de la instrucci√≥n se guardan los siguientes
valores:
Par√°metro

5798

Direcci√≥n

Valor

JOG_HIS

DBX12.0

FALSE

EOD

DBX12.1

FALSE

DSP

DBB13

W#16#0001

DSC

DBB14

W#16#0001

DCC

DBD16

DW#16#0000000A

DTBP

DBW20

W#16#0001

S_PRESET[1]

DBW26

W#16#0064

S_PRESET[2]

DBW28

W#16#00C8

OUT_VAL[1,0]

DBX58.0

TRUE

OUT_VAL[1,1]

DBX58.1

TRUE

OUT_VAL[1,2]

DBX58.2

TRUE

OUT_VAL[1,3]

DBX58.3

TRUE

OUT_VAL[1,4]

DBX58.4

TRUE

OUT_VAL[1,5]

DBX58.5

TRUE

OUT_VAL[1,6]

DBX58.6

TRUE

OUT_VAL[1,7]

DBX58.7

TRUE

OUT_VAL[1,8]

DBX59.0

TRUE

OUT_VAL[1,9]

DBX59.1

TRUE

OUT_VAL[1,10]

DBX59.2

TRUE

OUT_VAL[1,11]

DBX59.3

TRUE

OUT_VAL[1,12]

DBX59.4

TRUE

OUT_VAL[1,13]

DBX59.5

TRUE

OUT_VAL[1,14]

DBX59.6

TRUE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Direcci√≥n

Valor

OUT_VAL[1,15]

DBX59.7

TRUE

OUT_VAL[2,0]

DBX60.0

FALSE

OUT_VAL[2,1]

DBX60.1

FALSE

OUT_VAL[2,2]

DBX60.2

FALSE

OUT_VAL[2,3]

DBX60.3

FALSE

OUT_VAL[2,4]

DBX60.4

FALSE

OUT_VAL[2,5]

DBX60.5

FALSE

OUT_VAL[2,6]

DBX60.6

FALSE

OUT_VAL[2,7]

DBX60.7

FALSE

OUT_VAL[2,8]

DBX61.0

FALSE

OUT_VAL[2,9]

DBX61.1

FALSE

OUT_VAL[2,10]

DBX61.2

FALSE

OUT_VAL[2,11]

DBX61.3

FALSE

OUT_VAL[2,12]

DBX61.4

FALSE

OUT_VAL[2,13]

DBX61.5

FALSE

OUT_VAL[2,14]

DBX61.6

FALSE

OUT_VAL[2,15]

DBX61.7

FALSE

S_MASK[2,0]

DBX92.0

FALSE

S_MASK[2,1]

DBX92.1

TRUE

S_MASK[2,2]

DBX92.2

TRUE

S_MASK[2,3]

DBX92.3

TRUE

S_MASK[2,4]

DBX92.4

TRUE

S_MASK[2,5]

DBX92.5

FALSE

S_MASK[2,6]

DBX92.6

TRUE

S_MASK[2,7]

DBX92.7

TRUE

S_MASK[2,8]

DBX93.0

FALSE

S_MASK[2,9]

DBX93.1

FALSE

S_MASK[2,10]

DBX93.2

TRUE

S_MASK[2,11]

DBX93.3

TRUE

S_MASK[2,12]

DBX93.4

TRUE

S_MASK[2,13]

DBX93.5

TRUE

S_MASK[2,14]

DBX93.6

FALSE

S_MASK[2,15]

DBX93.7

TRUE

Los par√°metros de salida tienen los valores siguientes antes de ejecutarse la instrucci√≥n:
Par√°metro

Operando

Direcci√≥n

Valor

Q

Tag_Output_Q

M6.0

FALSE

OUTWORD

Tag_OutputWord

MW8

W#16#FFFF

OUT0

MyTag_Output_0

M4.0

TRUE

OUT1

MyTag_Output_1

M4.1

TRUE

OUT2

MyTag_Output_2

M4.2

TRUE

OUT3

MyTag_Output_3

M4.3

TRUE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5799

Instrucciones
4.2 Instrucciones
Par√°metro

Operando

Direcci√≥n

Valor

OUT4

MyTag_Output_4

M4.4

TRUE

OUT5

MyTag_Output_5

M4.5

TRUE

OUT6

MyTag_Output_6

M4.6

TRUE

OUT7

MyTag_Output_7

M4.7

TRUE

OUT8

MyTag_Output_8

M5.0

TRUE

OUT9

MyTag_Output_9

M5.1

TRUE

OUT10

MyTag_Output_10

M5.2

TRUE

OUT11

MyTag_Output_11

M5.3

TRUE

OUT12

MyTag_Output_12

M5.4

TRUE

OUT13

MyTag_Output_13

M5.5

TRUE

OUT14

MyTag_Output_14

M5.6

TRUE

OUT15

MyTag_Output_15

M5.7

TRUE

Despu√©s de la ejecuci√≥n
Una vez ejecutada la instrucci√≥n, los valores siguientes se escriben en los par√°metros de
salida:

5800

Par√°metro

Operando

Direcci√≥n

Valor

OUT0

MyTag_Output_0

M4.0

TRUE

OUT1

MyTag_Output_1

M4.1

FALSE

OUT2

MyTag_Output_2

M4.2

FALSE

OUT3

MyTag_Output_3

M4.3

FALSE

OUT4

MyTag_Output_4

M4.4

FALSE

OUT5

MyTag_Output_5

M4.5

TRUE

OUT6

MyTag_Output_6

M4.6

FALSE

OUT7

MyTag_Output_7

M4.7

FALSE

OUT8

MyTag_Output_8

M5.0

TRUE

OUT9

MyTag_Output_9

M5.1

TRUE

OUT10

MyTag_Output_10

M5.2

FALSE

OUT11

MyTag_Output_11

M5.3

FALSE

OUT12

MyTag_Output_12

M5.4

FALSE

OUT13

MyTag_Output_13

M5.5

FALSE

OUT14

MyTag_Output_14

M5.6

TRUE

OUT15

MyTag_Output_15

M5.7

FALSE

Q

Tag_Output_Q

M6.0

FALSE

OUTWORD

Tag_OutputWord

MW8

W#16#4321

ERR_CODE

Tag_ErrorCode

MW10

W#16#0000

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En el bloque de datos de instancia "DRUM_X_DB" de la instrucci√≥n se guardan los siguientes
valores:
Par√°metro

Direcci√≥n

Valor

JOG_HIS

DBX12.0

FALSE

EOD

DBX12.1

FALSE

DSC

DBB14

W#16#0002

DCC

DBD16

DW#16#000000C8

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

DCAT: Alarma de tiempo para control discreto
Descripci√≥n
La instrucci√≥n "Alarma de tiempo para control discreto" acumula el tiempo desde el instante en
el que el par√°metro CMD da la orden de abrir o cerrar. El tiempo se acumula hasta excederse
el tiempo predeterminado (PT) o hasta recibir la notificaci√≥n de que el dispositivo se ha cerrado
o abierto dentro del tiempo prescrito (O_FB o C_FB). Si se excede el tiempo predeterminado
antes de recibirse la notificaci√≥n de que se ha abierto o cerrado el dispositivo, se activa la
alarma correspondiente. Si el estado l√≥gico de la entrada de la orden cambia antes del tiempo
predeterminado, se reinicia el tiempo.
Al insertar la instrucci√≥n en el programa se abre autom√°ticamente el cuadro de di√°logo
"Opciones de llamada". El bloque de datos creado se encuentra en la carpeta "Recursos del
programa" del √°rbol del proyecto, en "Bloques de programa > Bloques de sistema". Encontrar√°
m√°s informaci√≥n al respecto en "Consulte tambi√©n".
La instrucci√≥n "Alarma de tiempo para control discreto" tiene las reacciones siguientes en las
condiciones de entrada:
‚óè Si el estado l√≥gico del par√°metro CMD cambia de "0" a "1", esto tiene los efectos siguientes
en los estados l√≥gicos de los par√°metros Q, CMD_HIS, ET, OA y CA:
‚Äì Los par√°metros Q y CMD_HIS se ponen a "1".
‚Äì Los par√°metros ET, OA y CA se ponen a "0".
‚óè Si el estado l√≥gico del par√°metro CMD cambia de "1" a "0", los par√°metros Q, ET, OA, CA
y CMD_HIS se ponen a "0".
‚óè Si los par√°metros CMD y CMD_HIS tienen el estado l√≥gico "1" y el par√°metro O_FB se pone
a "0", la diferencia de tiempo (ms) desde la √∫ltima ejecuci√≥n de la instrucci√≥n se suma al
valor del par√°metro ET. Si el valor del par√°metro ET excede el del par√°metro PT, el estado
l√≥gico del par√°metro OA se pone a "1". Si el valor del par√°metro ET no excede el del
par√°metro PT, el estado l√≥gico del par√°metro OA se pone a "0". El valor del par√°metro
CMD_HIS se pone al del par√°metro CMD.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5801

Instrucciones
4.2 Instrucciones
‚óè Si los estados l√≥gicos de los par√°metros CMD, CMD_HIS y O_FB est√°n a "1" y el par√°metro
C_FB devuelve el valor "0", el estado l√≥gico del par√°metro OA se pone a "0". El valor del
par√°metro ET se pone al del par√°metro PT. Si el estado l√≥gico del par√°metro O_FB cambia
a "0", se activa la alarma en la siguiente ejecuci√≥n de la instrucci√≥n. El valor del par√°metro
CMD_HIS se pone al del par√°metro CMD.
‚óè Si los par√°metros CMD, CMD_HIS y C_FB devuelven "0", la diferencia de tiempo (ms)
desde la √∫ltima ejecuci√≥n de la instrucci√≥n se suma al valor del par√°metro ET. Si el valor del
par√°metro ET excede el del par√°metro PT, el estado l√≥gico del par√°metro CA se pone a "1".
Si no se excede el valor del par√°metro PT, el par√°metro CA devuelve el estado l√≥gico "0".
El valor del par√°metro CMD_HIS se pone al del par√°metro CMD.
‚óè Si los par√°metros CMD, CMD_HIS y O_FB devuelven el estado l√≥gico "0" y el par√°metro
C_FB est√° a "1", el par√°metro CA se pone a "0". El valor del par√°metro ET se pone al del
par√°metro PT. Si el estado l√≥gico del par√°metro C_FB cambia a "0", se activa la alarma en
la siguiente ejecuci√≥n de la instrucci√≥n. El valor del par√°metro CMD_HIS se pone al del
par√°metro CMD.
‚óè Si los par√°metros O_FB y C_FB devuelven simult√°neamente el estado l√≥gico "1", los
estados l√≥gicos de ambas salidas de alarma se ponen a "1".
La instrucci√≥n "Alarma de tiempo para control discreto" no devuelve informaci√≥n de error.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

CMD

Input

BOOL

I, Q, M, D, L

El estado l√≥gico "0" da la or‚Äê
den de "Cerrar".
El estado l√≥gico "1" da la or‚Äê
den de "Abrir".

O_FB

Input

BOOL

I, Q, M, D, L

Entrada de realimentaci√≥n al
abrir

C_FB

Input

BOOL

I, Q, M, D, L

Entrada de realimentaci√≥n al
cerrar

Q

Output

BOOL

I, Q, M, D, L

Indica el estado del par√°me‚Äê
tro CMD

OA

Output

BOOL

I, Q, M, D, L

Salida de alarma al abrir

CA

Output

BOOL

I, Q, M, D, L

Salida de alarma al cerrar

ET

Static

DINT

I, Q, M, D, L

Tiempo actual transcurrido;
un ciclo de reloj = 1 ms

PT

Static

DINT

I, Q, M, D, L

Valor de tiempo predetermi‚Äê
nado; un ciclo de reloj = 1 ms

PREV_TIME

Static

DWORD

I, Q, M, D, L

Hora de sistema anterior

CMD_HIS

Static

BOOL

I, Q, M, D, L

Bit de evoluci√≥n de CMD

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

5802

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
En el ejemplo siguiente, el par√°metro CMD cambia de "0" a "1". Una vez ejecutada la
instrucci√≥n, el par√°metro Q se pone a "1" y las dos salidas de alarma OA y CA se ponen a "0".
El par√°metro CMD_HIS del bloque de datos de instancia se pone a "1" y el par√°metro ET se
pone a "0".
Nota
Los par√°metros est√°ticos pueden inicializarse en el bloque de datos.

GRAPH
CALL DCAT, "DCAT_DB"
(CMD := "Tag_Input_CMD"
O_FB := "Tag_Input_O_FB"
C_FB := "Tag_Input_C_FB"
Q => "Tag_Output_Q"
OA => "Tag_Output_OA"
CA => "Tag_Output_CA"
)

Las tablas siguientes muestran el funcionamiento de la instrucci√≥n con valores concretos.
Antes de la ejecuci√≥n
En este ejemplo se utilizan los siguientes valores para los par√°metros de entrada y salida:
Par√°metro

Operando

Valor

CMD

Tag_Input_CMD

TRUE

O_FB

Tag_Input_O_FB

FALSE

C_FB

Tag_Input_C_FB

FALSE

Q

Tag_Output_Q

FALSE

OA

Tag_Output_OA

FALSE

CA

Tag_Output_CA

FALSE

En el bloque de datos de instancia "DCAT_DB" de la instrucci√≥n se guardan los siguientes
valores:
Par√°metro

Direcci√≥n

Valor

ET

DBD4

L#12

PT

DBD8

L#222

CMD_HIS

DBX16.0

FALSE

Despu√©s de la ejecuci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5803

Instrucciones
4.2 Instrucciones
Una vez ejecutada la instrucci√≥n, los valores siguientes se escriben en los par√°metros de
salida:
Par√°metro

Operando

Valor

Q

Tag_Output_Q

TRUE

OA

Tag_Output_OA

FALSE

CA

Tag_Output_CA

FALSE

En el bloque de datos de instancia "DCAT_DB" de la instrucci√≥n se guardan los siguientes
valores:
Par√°metro

Direcci√≥n

Valor

ET

DBD4

L#0

CMD_HIS

DBX16.0

TRUE

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

MCAT: Alarma de tiempo para control del motor
Descripci√≥n
La instrucci√≥n "Alarma de tiempo para control del motor" acumula el tiempo desde el instante
en el que se activa una de las entradas de comando (abrir o cerrar). El tiempo se acumula hasta
que se excede el tiempo predeterminado o hasta que la entrada de realimentaci√≥n
correspondiente indica que el dispositivo ha ejecutado la operaci√≥n solicitada dentro del
tiempo prescrito. Si se excede el tiempo predeterminado antes de recibir respuesta, se dispara
la alarma correspondiente.
Al insertar la instrucci√≥n en el programa se abre autom√°ticamente el cuadro de di√°logo
"Opciones de llamada". El bloque de datos creado se encuentra en la carpeta "Recursos del
programa" del √°rbol del proyecto, en "Bloques de programa > Bloques de sistema". Encontrar√°
m√°s informaci√≥n al respecto en "Consulte tambi√©n".

Ejecuci√≥n de la instrucci√≥n "Alarma de tiempo para control del motor"
La tabla siguiente muestra las reacciones de la instrucci√≥n "Alarma de tiempo para control del
motor" a las distintas condiciones de entrada:
Par√°metros de entrada

Par√°metros de salida

ET

O_H
IS

C_H
IS

O_C
MD

C_C
MD

S_C
MD

O_F
B

C_F
B

OO

CO

OA

CA

ET

O_H
IS

C_HI Q
S

Estado

X

1

1

X

X

X

X

X

0

0

1

1

PT

0

0

0

Alarma

X

X

X

X

X

X

1

1

0

0

1

1

PT

0

0

0

Alarma

5804

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metros de entrada

Par√°metros de salida

X

X

X

X

X

1

X

X

0

0

0

0

X

0

0

1

Stop

X

X

X

1

1

X

X

X

0

0

0

0

X

0

0

1

Stop

X

0

X

1

0

0

X

X

1

0

0

0

0

1

0

1

Empezar a
abrir

<PT

1

0

X

0

0

0

X

1

0

0

0

INC

1

0

1

Abrir

X

1

0

X

0

0

1

0

0

0

0

0

PT

1

0

1

Abierto

>=
PT

1

0

X

0

0

0

X

0

0

1

0

PT

1

0

0

Abrir alarma

X

X

0

0

1

0

X

X

0

1

0

0

0

0

1

1

Empezar a
cerrar

< PT 0

1

0

X

0

X

0

0

1

0

0

INC

0

1

1

Cerrar

X

0

1

0

X

0

0

1

0

0

0

0

PT

0

1

1

Cerrado

>=
PT

0

1

0

X

0

X

0

0

0

0

1

PT

0

1

0

Cerrar alar‚Äê
ma

X

0

0

0

0

0

X

X

0

0

0

0

X

0

0

1

Parado

Leyenda:
INC

Sumar a ET la diferencia de tiempo (en ms) desde la √∫ltima ejecuci√≥n del FB

PT

PT se pone al mismo valor que ET

X

No aplicable

< PT

ET < PT

>= PT

ET >= PT

Si los par√°metros de entrada O_HIS y C_HIS tienen el estado l√≥gico "1", se ponen inmediatamente al estado l√≥gico "0". En
este caso se aplica la √∫ltima fila de la tabla mencionada m√°s arriba (X). Puesto que por este motivo no es posible comprobar
si los par√°metros de entrada O_HIS y C_HIS tienen el estado l√≥gico "1", en este caso se asigna el siguiente valor a los
par√°metros de salida:
OO = FALSE
CO = FALSE
OA = FALSE
CA = FALSE
ET = PT
Q = TRUE

La instrucci√≥n "Alarma de tiempo para control del motor" no devuelve informaci√≥n de error.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

O_CMD

Input

BOOL

I, Q, M, D, L

Entrada de la orden "Abrir"

C_CMD

Input

BOOL

I, Q, M, D, L

Entrada de la orden "Cerrar"

S_CMD

Input

BOOL

I, Q, M, D, L

Entrada de la orden "Parar"

O_FB

Input

BOOL

I, Q, M, D, L

Entrada de realimentaci√≥n al
abrir

C_FB

Input

BOOL

I, Q, M, D, L

Entrada de realimentaci√≥n al
cerrar

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5805

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OO

Output

BOOL

I, Q, M, D, L

Salida "Abrir"

CO

Output

BOOL

I, Q, M, D, L

Salida "Cerrar"

OA

Output

BOOL

I, Q, M, D, L

Salida de alarma al abrir

CA

Output

BOOL

I, Q, M, D, L

Salida de alarma al cerrar

Q

Output

BOOL

I, Q, M, D, L

El estado l√≥gico "0" indica
una condici√≥n de error.

ET

Static

DINT

I, Q, M, D, L

Tiempo actual transcurrido;
un ciclo de reloj = 1 ms

PT

Static

DINT

I, Q, M, D, L

Valor de tiempo predetermi‚Äê
nado; un ciclo de reloj = 1 ms

PREV_TIME

Static

DWORD

I, Q, M, D, L

Hora de sistema anterior

O_HIS

Static

BOOL

I, Q, M, D, L

Bit de evoluci√≥n "Abrir"

C_HIS

Static

BOOL

I, Q, M, D, L

Bit de evoluci√≥n "Cerrar"

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
Nota
Los par√°metros est√°ticos pueden inicializarse en el bloque de datos.

GRAPH
CALL MCAT, "MCAT_DB"
(O_CMD := "Tag_Input_O_CMD"
C_CMD := "Tag_Input_C_CMD"
S_CMD := "Tag_Input_S_CMD"
O_FB := "Tag_Input_O_FB"
C_FB := "Tag_Input_C_FB"
OO => "Tag_OutputOpen"
CO => "Tag_OutputClosed"
OA => "Tag_Output_OA"
CA => "Tag_Output_CA"
Q => "Tag_Output_Q"
)

Las tablas siguientes muestran el funcionamiento de la instrucci√≥n con valores concretos.
Antes de la ejecuci√≥n

5806

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En este ejemplo se utilizan los siguientes valores para los par√°metros de entrada y salida:
Par√°metro

Operando

Valor

O_CMD

Tag_Input_O_CMD

TRUE

C_CMD

Tag_Input_C_CMD

FALSE

S_CMD

Tag_Input_S_CMD

FALSE

O_FB

Tag_Input_O_FB

FALSE

C_FB

Tag_Input_C_FB

FALSE

OO

Tag_OutputOpen

FALSE

CO

Tag_OutputClosed

FALSE

OA

Tag_Output_OA

FALSE

CA

Tag_Output_CA

FALSE

Q

Tag_Output_Q

FALSE

En el bloque de datos de instancia "MCAT_DB" de la instrucci√≥n se guardan los siguientes
valores:
Par√°metro

Direcci√≥n

Valor

ET

DBD4

L#2

PT

DBD8

L#22

O_HIS

DBX16.0

TRUE

C_HIS

DBX16.1

FALSE

Despu√©s de la ejecuci√≥n
Una vez ejecutada la instrucci√≥n, los valores siguientes se escriben en los par√°metros de
salida:
Par√°metro

Operando

Valor

OO

Tag_OutputOpen

TRUE

CO

Tag_OutputClosed

FALSE

OA

Tag_Output_OA

FALSE

CA

Tag_Output_CA

FALSE

Q

Tag_Output_Q

TRUE

En el bloque de datos de instancia "MCAT_DB" de la instrucci√≥n se guardan los siguientes
valores:
Par√°metro

Direcci√≥n

Valor

ET

DBD4

L#0

O_HIS

DBX16.0

TRUE

CMD_HIS

DBX16.1

FALSE

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5807

Instrucciones
4.2 Instrucciones

IMC: Comparar bits de entrada con bits de una m√°scara
Descripci√≥n
La instrucci√≥n "Comparar bits de entrada con bits de una m√°scara" compara el estado l√≥gico
de hasta 16 bits de entrada programados (IN_BIT0 a IN_BIT15) con el bit correspondiente de
una m√°scara. Es posible programar como m√°ximo 16 pasos con m√°scaras. El valor del
par√°metro IN_BIT0 se compara con el valor de la m√°scara CMP_VAL[x,0], siendo "x" el
n√∫mero del paso. El n√∫mero del paso de la m√°scara utilizada para la comparaci√≥n se define en
el par√°metro CMP_STEP. De esta misma manera se comparan todos los valores
programados. Los bits de entrada no programados o los bits no programados de la m√°scara
tienen el estado l√≥gico predeterminado FALSE.
Si se encuentra una coincidencia al realizar la comparaci√≥n, el estado l√≥gico del par√°metro
OUT se pone a "1". De lo contrario, el par√°metro OUT se pone a "0".
Si el valor del par√°metro CMP_STEP es mayor que 15, no se ejecuta la instrucci√≥n. En el
par√°metro ERR_CODE se emite un mensaje de error.
Al insertar la instrucci√≥n en el programa se abre autom√°ticamente el cuadro de di√°logo
"Opciones de llamada". El bloque de datos creado se encuentra en la carpeta "Recursos del
programa" del √°rbol del proyecto, en "Bloques de programa > Bloques de sistema". Encontrar√°
m√°s informaci√≥n al respecto en "Consulte tambi√©n".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:

5808

Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

IN_BIT0

Input

BOOL

I, Q, M, D, L

El bit de entrada 0 se compara
con el bit 0 de la m√°scara.

IN_BIT1

Input

BOOL

I, Q, M, D, L

El bit de entrada 1 se compara
con el bit 1 de la m√°scara.

IN_BIT2

Input

BOOL

I, Q, M, D, L

El bit de entrada 2 se compara
con el bit 2 de la m√°scara.

IN_BIT3

Input

BOOL

I, Q, M, D, L

El bit de entrada 3 se compara
con el bit 3 de la m√°scara.

IN_BIT4

Input

BOOL

I, Q, M, D, L

El bit de entrada 4 se compara
con el bit 4 de la m√°scara.

IN_BIT5

Input

BOOL

I, Q, M, D, L

El bit de entrada 5 se compara
con el bit 5 de la m√°scara.

IN_BIT6

Input

BOOL

I, Q, M, D, L

El bit de entrada 6 se compara
con el bit 6 de la m√°scara.

IN_BIT7

Input

BOOL

I, Q, M, D, L

El bit de entrada 7 se compara
con el bit 7 de la m√°scara.

IN_BIT8

Input

BOOL

I, Q, M, D, L

El bit de entrada 8 se compara
con el bit 8 de la m√°scara.

IN_BIT9

Input

BOOL

I, Q, M, D, L

El bit de entrada 9 se compara
con el bit 9 de la m√°scara.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

IN_BIT10

Input

BOOL

I, Q, M, D, L

El bit de entrada 10 se compa‚Äê
ra con el bit 10 de la m√°scara.

IN_BIT11

Input

BOOL

I, Q, M, D, L

El bit de entrada 11 se compa‚Äê
ra con el bit 11 de la m√°scara.

IN_BIT12

Input

BOOL

I, Q, M, D, L

El bit de entrada 12 se compa‚Äê
ra con el bit 12 de la m√°scara.

IN_BIT13

Input

BOOL

I, Q, M, D, L

El bit de entrada 13 se compa‚Äê
ra con el bit 13 de la m√°scara.

IN_BIT14

Input

BOOL

I, Q, M, D, L

El bit de entrada 14 se compa‚Äê
ra con el bit 14 de la m√°scara.

IN_BIT15

Input

BOOL

I, Q, M, D, L

El bit de entrada 15 se compa‚Äê
ra con el bit 15 de la m√°scara.

CMP_STEP

Input

BYTE

I, Q, M, D, L, P o
constante

N√∫mero de paso de la m√°sca‚Äê
ra con la que se compara.

OUT

Output

BOOL

I, Q, M, D, L

El estado l√≥gico "1" indica que
se ha encontrado una coinci‚Äê
dencia.
El estado l√≥gico "0" indica que
no se ha encontrado ninguna
coincidencia.

ERR_CODE

Output

WORD

I, Q, M, D, L, P

Informaci√≥n de error

CMP_VAL

Static

ARRAY OF
BOOL

I, Q, M, D, L

M√°scaras de comparaci√≥n [0
a 15, 0 a 15]: El primer n√∫mero
del √≠ndice es el n√∫mero de la
etapa y, el segundo, el n√∫me‚Äê
ro de bit de la m√°scara.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Par√°metro ERR_CODE
La tabla siguiente muestra el significado de los valores del par√°metro ERR_CODE:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

000A

El valor del par√°metro CMP_STEP es mayor que 15.

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5809

Instrucciones
4.2 Instrucciones

SMC: Barrido de matriz
Descripci√≥n
La instrucci√≥n "Barrido de matriz" compara el estado l√≥gico de hasta 16 bits de entrada
programados (IN_BIT0 a IN_BIT15) con los bits correspondientes de las m√°scaras de
comparaci√≥n de cada paso. La ejecuci√≥n empieza por el paso 1 y contin√∫a hasta el √∫ltimo paso
programado (LAST) o hasta que se encuentre una correspondencia. El bit de entrada del
par√°metro IN_BIT0 se compara con el valor de la m√°scara CMP_VAL[x,0], siendo "x" el
n√∫mero de paso. De esta misma manera se comparan todos los valores programados. Si se
encuentra una correspondencia, el estado l√≥gico del par√°metro OUT se pone a "1" y el n√∫mero
de paso se escribe con la m√°scara correspondiente en el par√°metro OUT_STEP. Los bits de
entrada no programados o los bits no programados de la m√°scara tienen el estado l√≥gico
predeterminado FALSE. Si varios pasos tienen una m√°scara equivalente, se indica solo la
primera correspondencia encontrada en el par√°metro OUT_STEP. Si no se encuentra ninguna
correspondencia, el estado l√≥gico del par√°metro OUT se pone a "0". En este caso, el valor del
par√°metro OUT_STEP excede en "1" el valor del par√°metro LAST.
Al insertar la instrucci√≥n en el programa se abre autom√°ticamente el cuadro de di√°logo
"Opciones de llamada". El bloque de datos creado se encuentra en la carpeta "Recursos del
programa" del √°rbol del proyecto, en "Bloques de programa > Bloques de sistema". Encontrar√°
m√°s informaci√≥n al respecto en "Consulte tambi√©n".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:

5810

Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

IN_BIT0

Input

BOOL

I, Q, M, D, L

El bit de entrada 0 se compara
con el bit 0 de la m√°scara.

IN_BIT1

Input

BOOL

I, Q, M, D, L

El bit de entrada 1 se compara
con el bit 1 de la m√°scara.

IN_BIT2

Input

BOOL

I, Q, M, D, L

El bit de entrada 2 se compara
con el bit 2 de la m√°scara.

IN_BIT3

Input

BOOL

I, Q, M, D, L

El bit de entrada 3 se compara
con el bit 3 de la m√°scara.

IN_BIT4

Input

BOOL

I, Q, M, D, L

El bit de entrada 4 se compara
con el bit 4 de la m√°scara.

IN_BIT5

Input

BOOL

I, Q, M, D, L

El bit de entrada 5 se compara
con el bit 5 de la m√°scara.

IN_BIT6

Input

BOOL

I, Q, M, D, L

El bit de entrada 6 se compara
con el bit 6 de la m√°scara.

IN_BIT7

Input

BOOL

I, Q, M, D, L

El bit de entrada 7 se compara
con el bit 7 de la m√°scara.

IN_BIT8

Input

BOOL

I, Q, M, D, L

El bit de entrada 8 se compara
con el bit 8 de la m√°scara.

IN_BIT9

Input

BOOL

I, Q, M, D, L

El bit de entrada 9 se compara
con el bit 9 de la m√°scara.

IN_BIT10

Input

BOOL

I, Q, M, D, L

El bit de entrada 10 se compa‚Äê
ra con el bit 10 de la m√°scara.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

IN_BIT11

Input

BOOL

I, Q, M, D, L

El bit de entrada 11 se compa‚Äê
ra con el bit 11 de la m√°scara.

IN_BIT12

Input

BOOL

I, Q, M, D, L

El bit de entrada 12 se compa‚Äê
ra con el bit 12 de la m√°scara.

IN_BIT13

Input

BOOL

I, Q, M, D, L

El bit de entrada 13 se compa‚Äê
ra con el bit 13 de la m√°scara.

IN_BIT14

Input

BOOL

I, Q, M, D, L

El bit de entrada 14 se compa‚Äê
ra con el bit 14 de la m√°scara.

IN_BIT15

Input

BOOL

I, Q, M, D, L

El bit de entrada 15 se compa‚Äê
ra con el bit 15 de la m√°scara.

OUT

Output

BOOL

I, Q, M, D, L

El estado l√≥gico "1" indica que
se ha encontrado una corres‚Äê
pondencia.
El estado l√≥gico "0" indica que
no se ha encontrado ninguna
correspondencia.

ERR_CODE

Output

WORD

I, Q, M, D, L, P

Informaci√≥n de error

OUT_STEP

Output

BYTE

I, Q, M, D, L, P

Contiene el n√∫mero de paso
con la m√°scara correspon‚Äê
diente o el n√∫mero de paso
que excede en "1" el valor del
par√°metro LAST, si no se ha
encontrado ninguna corres‚Äê
pondencia.

LAST

Static

BYTE

I, Q, M, D, L, P

Indica el n√∫mero del √∫ltimo pa‚Äê
so en que se tiene que buscar
una m√°scara correspondiente.

CMP_VAL

Static

ARRAY of
WORD

I, Q, M, D, L

M√°scaras de comparaci√≥n [0
a 15, 0 a 15]: El primer n√∫mero
del √≠ndice es el n√∫mero de la
etapa y, el segundo, el n√∫me‚Äê
ro de bit de la m√°scara.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Par√°metro ERR_CODE
La tabla siguiente muestra el significado de los valores del par√°metro ERR_CODE:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

000E

El valor del par√°metro LAST es mayor que 15.

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5811

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

LEAD_LAG: Algoritmo Lead y Lag
Descripci√≥n
La instrucci√≥n "Algoritmo Lead y Lag" procesa se√±ales con una variable anal√≥gica. El valor de
la ganancia del par√°metro GAIN debe ser mayor que cero. El resultado de la instrucci√≥n
"Algoritmo Lead y Lag" se calcula con la siguiente ecuaci√≥n:
287

/*B7,0(
/'B7,0(6$03/(B7
/'B7,0(
,1*$,1
35(9B287*$,1
/*B7,0(6$03/(B7
/*B7,0(6$03/(B7
/*B7,0(6$03/(B7

35(9B,1

La instrucci√≥n "Algoritmo Lead y Lag" s√≥lo devuelve resultados relevantes cuando se ejecuta
en ciclos de programa fijos. Deben indicarse las mismas unidades en los par√°metros
LD_TIME, LG_TIME y SAMPLE_T. Si LG_TIME > 4 + SAMPLE_T, la instrucci√≥n se aproxima
a la siguiente funci√≥n:
OUT = GAIN * ((1 + LD_TIME * s) / (1 + LG_TIME * s)) * IN
Si el valor del par√°metro GAIN es menor o igual a cero, no se realiza el c√°lculo y el par√°metro
ERR_CODE devuelve una informaci√≥n de error.
La instrucci√≥n "Algoritmo Lead y Lag" puede utilizarse junto con bucles para la compensaci√≥n
en el control anticipativo. La instrucci√≥n comprende dos operaciones. La operaci√≥n "Lead"
desplaza la fase de la salida OUT, anticip√°ndose la salida a la entrada. En cambio, la operaci√≥n
"Lag" desplaza la salida, de manera que la salida sigue a la entrada. Puesto que la operaci√≥n
"Lag" equivale a una integraci√≥n, puede utilizarse para suprimir perturbaciones o como filtro
pasa bajo. La operaci√≥n "Lead" equivale a una acci√≥n diferencial, por lo que puede utilizarse
como un filtro de paso alto. La combinaci√≥n de ambas operaciones (Lead y Lag) hace que la
fase de salida siga a la entrada a bajas frecuencias y se le anticipe a altas frecuencias. Por este
motivo, la instrucci√≥n "Algoritmo Lead y Lag" puede utilizarse como si fuera un filtro de paso de
banda.
Al insertar la instrucci√≥n en el programa se abre autom√°ticamente el cuadro de di√°logo
"Opciones de llamada". El bloque de datos creado se encuentra en la carpeta "Recursos del
programa" del √°rbol del proyecto, en "Bloques de programa > Bloques de sistema". Encontrar√°
m√°s informaci√≥n al respecto en "Consulte tambi√©n".

5812

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

REAL

I, Q, M, D, L, P o
constante

Valor de entrada del tiempo
de muestreo actual (tiempo
de ciclo) que se procesa.

SAMPLE_T

Input

INT

I, Q, M, D, L, P o
constante

Tiempo de muestreo

OUT

Output

REAL

I, Q, M, D, L, P

Resultado de la instrucci√≥n

ERR_CODE

Output

WORD

I, Q, M, D, L, P

Informaci√≥n de error

LD_TIME

Static

REAL

I, Q, M, D, L, P o
constante

Tiempo de anticipaci√≥n en la
misma unidad que el tiempo
de muestreo

LG_TIME

Static

REAL

I, Q, M, D, L, P o
constante

Tiempo de seguimiento en la
misma unidad que el tiempo
de muestreo.

GAIN

Static

REAL

I, Q, M, D, L, P o
constante

Ganancia en % / % (relaci√≥n
del cambio en la salida con
respecto al cambio en la en‚Äê
trada como estado constan‚Äê
te).

PREV_IN

Static

REAL

I, Q, M, D, L, P o
constante

Entrada anterior

PREV_OUT

Static

REAL

I, Q, M, D, L, P o
constante

Salida anterior

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Par√°metro ERR_CODE
La tabla siguiente muestra el significado de los valores del par√°metro ERR_CODE:
C√≥digo de
error*
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

0009

El valor del par√°metro GAIN es menor o igual a cero.

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
Nota
Los par√°metros est√°ticos pueden inicializarse en el bloque de datos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5813

Instrucciones
4.2 Instrucciones

GRAPH
CALL LEAD_LAG, "LEAD_LAG_DB"
(IN := "Tag_Input"
SAMPLE_T := "Tag_Input_SAMPLE_T"
OUT => "Tag_Output_Result"
ERR_CODE => "Tag_ErrorCode"
)

Las tablas siguientes muestran el funcionamiento de la instrucci√≥n con valores concretos.
Antes de la ejecuci√≥n
En este ejemplo se utilizan los siguientes valores para los par√°metros de entrada:
Par√°metro

Operando

Valor

IN

Tag_Input

2.0

SAMPLE_T

Tag_Input_SAMPLE_T

10

En el bloque de datos de instancia "LEAD_LAG_DB" de la instrucci√≥n se guardan los
siguientes valores:
Par√°metro

Direcci√≥n

Valor

LD_TIME

DBD12

2.0

LG_TIME

DBD16

2.0

GAIN

DBD20

1.0

PREV_IN

DBD24

6.0

PREV_OUT

DBD28

6.0

Despu√©s de la ejecuci√≥n
Una vez ejecutada la instrucci√≥n, los valores siguientes se escriben en los par√°metros de
salida:
Par√°metro

Operando

Valor

OUT

Tag_Output_Result

2.0

En el bloque de datos de instancia "LEAD_LAD_DB" de la instrucci√≥n se guardan los
siguientes valores:
Par√°metro

Operando

Valor

PREV_IN

DBD24

2.0

PREV_OUT

DBD28

2.0

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

5814

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

TONR_X: Acumulador de tiempo
Descripci√≥n
La instrucci√≥n "Acumulador de tiempo" acumula valores de tiempo dentro de un periodo
definido con ayuda de la entrada PV. La instrucci√≥n se ejecuta cuando el estado l√≥gico de la
entrada de arranque TMR_EN cambia de "0" a "1". Simult√°neamente, el temporizador cuenta
el tiempo programado en la entrada PV. Mientras se ejecuta la instrucci√≥n, a√±ade el valor de
tiempo de la entrada DELTA_T al valor de tiempo de InOut ET.
Adem√°s, deben cumplirse las siguientes condiciones:
‚óè La entrada de arranque TMR_EN devuelve el estado l√≥gico "1".
‚óè El valor de tiempo de InOut ET es menor que el valor de tiempo del par√°metro PV.
‚óè La entrada RESET devuelve el estado l√≥gico "0".
La instrucci√≥n se interrumpe cuando el estado l√≥gico de la entrada de arranque TMR_EN
cambia de "1" a "0". En cuanto el estado l√≥gico cambia de nuevo a "1", la instrucci√≥n sigue
ejecut√°ndose.
La instrucci√≥n finaliza cuando el valor de tiempo de InOut ET alcanza el valor de tiempo de la
entrada PV. Entonces, la salida Q devuelve el estado l√≥gico "1".
Mientras la salida Q devuelva el estado l√≥gico "1", el valor de tiempo de InOut ET no se
modificar√°. El valor de tiempo y la salida Q vuelven a ponerse a "0" solo cuando la entrada
RESET se pone al estado l√≥gico "1".
Puesto que la instrucci√≥n "Acumulador de tiempo" utiliza el tiempo de ciclo (DELTA_T) del
√∫ltimo ciclo del bloque de organizaci√≥n (OB), la instrucci√≥n solo puede llamarse en bloques de
organizaci√≥n c√≠clicos.
Nota
El tiempo de ciclo del bloque de organizaci√≥n debe desplazarse desde la informaci√≥n de
arranque a la variable global del par√°metro DELTA_T.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

TMR_EN (Ti‚Äê
mer Enable)

Input

BOOL

I, Q, M, D, L

RESET

Input

BOOL

I, Q, M, D, L

Entrada de reset

PV (Preset
Value)

Input

DINT

I, Q, M, D, L, P o
constante

Tiempo m√°ximo de lectura
del tiempo

DELTA_T

Input

INT

I, Q, M, D, L o
constante

Tiempo de ciclo del bloque
de organizaci√≥n del ciclo an‚Äê
terior

Entrada de arranque
Arranca la instrucci√≥n y la
temporizaci√≥n predetermina‚Äê
da en la entrada PV

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5815

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

Q

Output

BOOL

I, Q, M, D, L

Salida que se establece al al‚Äê
canzar el valor de tiempo pre‚Äê
determinado

ET (Elapsed
Time)

InOut

DINT

I, Q, M, D, L

Valor de tiempo acumulado
(Valor de tiempo transcurrido
actualmente + valor de tiem‚Äê
po de la entrada DELTA_T)

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Cronograma de impulsos
La figura siguiente muestra el cronograma de impulsos de la instrucci√≥n "Acumulador de
tiempo":
705B(1

5(6(7

4

39

(7

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL TONR_X
(TMR_EN := "Tag_Start"
RESET := "Tag_Reset"
PV := 10
DELTA_T := 2

5816

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
GRAPH
Q => "Tag_Output"
ET := "Tag_Elapsed_Time"
)

En cada cambio del estado l√≥gico de "0" a "1" en la entrada TMR_EN, el tiempo de ciclo "2" de
la entrada DELTA_T se a√±ade al valor de tiempo actual de InOut ET, hasta que se alcanza el
valor de tiempo m√°ximo "10" de la entrada PV.

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

WSR: Guardar datos en el registro de desplazamiento
Descripci√≥n
La instrucci√≥n "Guardar datos en el registro de desplazamiento" permite escribir datos en un
registro de desplazamiento desde el origen indicado. Todo elemento del registro se desplaza
a la siguiente direcci√≥n. Los datos contenidos en la √∫ltima direcci√≥n del registro de
desplazamiento se pierden tras la operaci√≥n de desplazamiento.
Cada vez que la instrucci√≥n se ejecuta con el valor "0" en el par√°metro RESET, se leen datos
nuevos del origen (S_DATA) y se desplazan a la direcci√≥n inicial (START) del registro de
desplazamiento. El par√°metro LENGTH indica el n√∫mero de elementos que deben
desplazarse. El tipo de datos de los elementos se define en el par√°metro E_TYPE. Si se indica
un tipo de datos no admisible en el par√°metro E_TYPE, no se procesa la instrucci√≥n.
Si el par√°metro RESET est√° a "1" al ejecutarse la instrucci√≥n, se borra el registro. El par√°metro
Q se pone al estado l√≥gico "1" si el registro de desplazamiento est√° ocupado con ceros o si se
borra.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RESET

Input

BOOL

I, Q, M, D, L

Entrada de reset

S_DATA

Input

POINTER

I, Q, M, D

Apunta al elemento de origen
que se desplaza a la direc‚Äê
ci√≥n inicial (START).
En el direccionamiento indi‚Äê
recto por registro inter√°rea,
el puntero debe indicarse en
formato de palabra doble.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5817

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

START

Input

POINTER

I, Q, M, D

Apunta a la direcci√≥n inicial
del registro.
En el direccionamiento indi‚Äê
recto por registro inter√°rea,
el puntero debe indicarse en
formato de palabra doble.

LEN

Input

WORD

I, Q, M, D, L, P

N√∫mero de elementos que
deben desplazarse.

E_TYPE

Input

BYTE

I, Q, M, D, L, P

Indica el tipo de datos de los
elementos que deben despla‚Äê
zarse. Los siguientes tipos
de datos son admisibles:
‚óè W#16#04 = WORD
‚óè B#16#05 = INT
‚óè B#16#06 = DWORD
‚óè B#16#07 = DINT
‚óè B#16#08 = REAL

Q

Output

BOOL

Q, M, D, L,

Indica "0" si el par√°metro RE‚Äê
SET est√° activado (1) o si to‚Äê
dos los elementos que deben
desplazarse tienen el valor
"0".

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
En el ejemplo siguiente se desplazan cuatro elementos del tipo de datos WORD a partir de la
direcci√≥n indicada en el par√°metro START. Una vez desplazado el primer elemento del
registro a la siguiente direcci√≥n, la primera direcci√≥n se ocupar√° con los datos a los que se√±ala
el puntero en el par√°metro S_DATA. El valor del √∫ltimo elemento del registro se pierde
entonces.
GRAPH
CALL WSR
(RESET := "Tag_Input_Reset"
S_DATA := "Tag_Input_DataSource"
START := "Tag_Input_StartAddress"
LEN := "Tag_Input_Length"
E_TYPE := "Tag_Input_ElementType"
Q => "Tag_Output_Q"
)

Las tablas siguientes muestran el funcionamiento de la instrucci√≥n con valores concretos.
Antes de la ejecuci√≥n

5818

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En este ejemplo se utilizan los siguientes valores para los par√°metros de entrada y salida:
Par√°metro

Operando

Valor

RESET

Tag_Input_Reset

0

S_DATA

Tag_Input_DataSource

P#DB2.DBX6.0
DW0 = W#16#1111
DW2 = W#16#2222
DW4 = W#16#3333
DW6 = W#16#4444

START

Tag_Input_StartAddress

P#DB1.DBX0.0

LEN

Tag_Input_Length

W#16#04

E_TYPE

Tag_Input_ElementType

B#16#04

Q

Tag_Output_Q

1

DW6 = W#16#1234

Despu√©s de la ejecuci√≥n
Una vez ejecutada la instrucci√≥n, los valores siguientes se escriben en los par√°metros de
salida:
Par√°metro

Operando

Valor

RESET

Tag_Input_Reset

0

S_DATA

Tag_Input_DataSource

P#DB2.DBX6.0
DW0 = W#16#1234
DW2 = W#16#1111
DW4 = W#16#2222
DW6 = W#16#3333

START

Tag_Input_StartAddress

P#DB1.DBX0.0
DW6 = W#16#1234

LEN

Tag_Input_Length

W#16#04

E_TYPE

Tag_Input_ElementType

B#16#04

Q

Tag_Output_Q

1

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5819

Instrucciones
4.2 Instrucciones

SHRB: Desplazar bit al registro de desplazamiento
Descripci√≥n
La instrucci√≥n "Desplazar bit al registro de desplazamiento" permite escribir un bit en un
registro de desplazamiento desde el origen indicado (DATA). Cada vez que la instrucci√≥n se
ejecuta con el valor "0" en el par√°metro RESET, se leen datos nuevos del origen y se
desplazan a la direcci√≥n inicial (S_BIT) del registro de desplazamiento. Los restantes bits se
desplazan una posici√≥n. El bit de la √∫ltima direcci√≥n (S_BIT + N) se pierde tras el
desplazamiento. Si el par√°metro RESET est√° a "1" mientras se ejecuta la instrucci√≥n, las
direcciones del registro de desplazamiento se ponen a "0" y no se desplazan.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DATA

Input

BOOL

I, Q, M, D, L

Bit de origen

RESET

Input

BOOL

I, Q, M, D, L

Entrada de reset

S_BIT

Input

POINTER

I, Q, M, D

Apunta al primer bit del regis‚Äê
tro de desplazamiento.
En el direccionamiento indi‚Äê
recto por registro inter√°rea,
el puntero debe indicarse en
formato de palabra doble.

N

Input

WORD

I, Q, M, D, L, P

N√∫mero de bits que deben
desplazarse.

Ejemplo
En el ejemplo siguiente, el par√°metro N se pone al valor 14 ("E" en notaci√≥n hexadecimal), con
lo que 14 bits se desplazan a partir de la direcci√≥n indicada en el par√°metro S_BIT. Una vez
desplazados los bits, la primera direcci√≥n se ocupa con los datos del origen del par√°metro
DATA. El √∫ltimo valor de bit se pierde.
GRAPH
CALL SHRB
(DATA := "Tag_Input_Data"
RESET := "Tag_Input_Reset"
S_BIT := "Tag_Input_BitSource"
N := "Tag_Input_Number"
)

Las tablas siguientes muestran el funcionamiento de la instrucci√≥n con valores concretos.

5820

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Antes de la ejecuci√≥n
En este ejemplo se utilizan los siguientes valores para los par√°metros de entrada y salida:
Par√°metro

Operando

Valor

RESET

Tag_Input_Reset

0

DATA

Tag_Input_Data

0

S_BIT

Tag_Input_BitSource

P#DB1.DBX1.4

N

Tag_Input_Number

B#16#0E

Antes de ejecutarse la instrucci√≥n, los siguientes estados l√≥gicos est√°n almacenados en los 14
bits del registro:


























6B%,7







































Despu√©s de la ejecuci√≥n
Una vez ejecutada la instrucci√≥n, los siguientes estados l√≥gicos se almacenan en los 14 bits
del registro:


























6B%,7







































Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5821

Instrucciones
4.2 Instrucciones

SEG: Generar patr√≥n de bits para el display de 7 segmentos
Descripci√≥n
La instrucci√≥n "Generar patr√≥n de bits para el display de 7 segmentos" permite convertir cada
una de las cuatro cifras hexadecimales de la palabra de origen indicada (IN) en un patr√≥n de
bits equivalente para un display de 7 segmentos. El resultado de la instrucci√≥n se devuelve en
la palabra doble del par√°metro OUT.
Entre las cifras hexadecimales y la ocupaci√≥n de los 7 segmentos (a, b, c, d, e, f, g) existe la
siguiente relaci√≥n:
Cifra de en‚Äê
trada

Ocupaci√≥n de los
segmentos

Display

(binaria)

‚Äëgfedcba

0000

00111111

0

0001

00000110

1

0010

01011011

2

0011

01001111

3

0100

01100110

4

0101

01101101

5

0110

01111101

6

0111

00000111

7

1000

01111111

8

1001

01100111

9

1010

01110111

A

1011

01111100

B

1100

00111001

C

1101

01011110

D

1110

01111001

E

1111

01110001

F

Display de siete segmentos

(hexadecimal)
D
I

E
J

H

F
G

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

WORD

I, Q, M, D, L, P o
constante

Palabra de origen con cuatro
cifras hexadecimales

OUT

Output

DWORD

I, Q, M, D, L, P

Patr√≥n de bits para el display
de 7 segmentos

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

5822

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL SEG
(IN := "Tag_Input"
OUT => "Tag_Output"
)

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores de operandos
concretos:
Par√°metro

Operando

Valor

Hexadecimal

Binario

IN

Tag_Input

W#16#1234

0001 0010 0011 0100

OUT

Tag_Output

DW#16065B4F66

000 00110 0101 1011 0100
1111 0110 0110
Visualizaci√≥n: 1234

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

BCDCPL: Generar complemento a diez
Descripci√≥n
La instrucci√≥n "Generar complemento a diez" crea el complemento a diez de un n√∫mero BCD
de siete d√≠gitos que se indica en el par√°metro IN. La instrucci√≥n realiza el c√°lculo con la
siguiente f√≥rmula matem√°tica:
10000000 (como BCD)
‚Äì Valor BCD de 7 d√≠gitos
---------------------------------------Complemento a diez (como BCD)

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

DWORD

I, Q, M, D, L, P o
constante

N√∫mero BCD de 7 d√≠gitos

ERR_CODE

Output

DWORD

I, Q, M, D, L, P

Resultado de la instrucci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5823

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Consulte tambi√©n".

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL BCDCPL
(IN := "Tag_Input"
ERR_CODE => "Tag_Output"
)

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores concretos:
Par√°metro

Operando

Valor*

IN

Tag_Input

DW#16#01234567

ERR_CODE

Tag_Output

DW#16#08765433

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de la palabra de estado (P√°gina 184)
Principios b√°sicos de GRAPH (P√°gina 8191)

BITSUM: Contar n√∫mero de bits activados
Descripci√≥n
La instrucci√≥n "Contar n√∫mero de bits activados" cuenta el n√∫mero de bits de un operando que
est√°n puestos al estado l√≥gico "1". El operando cuyos bits se cuentan se especifica en el
par√°metro IN. El resultado de la instrucci√≥n se devuelve en el par√°metro RET_VAL.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n:

5824

Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

DWORD

I, Q, M, D, L, P o
constante

Operando cuyos bits activa‚Äê
dos se cuentan

RET_VAL

Output

INT

I, Q, M, D, L, P

N√∫mero de bits activados

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
El siguiente ejemplo muestra el funcionamiento de la instrucci√≥n:
GRAPH
CALL BITSUM
(IN := "Tag_Input"
RET_VAL => "Tag_Output"
)

La tabla siguiente muestra el funcionamiento de la instrucci√≥n con valores concretos:
Par√°metro

Operando

Valor*

IN

Tag_Input

DW#16#12345678

RET_VAL

Tag_Output

W#16#000D (13 bits)

*En el editor de programas, los c√≥digos de error se pueden representar como valores enteros o hexa‚Äê
decimales. Encontrar√° m√°s informaci√≥n sobre el cambio de los formatos de visualizaci√≥n en "Consulte
tambi√©n".

Consulte tambi√©n
Vista general de los tipos de datos v√°lidos (P√°gina 241)
Principios b√°sicos de GRAPH (P√°gina 8191)

Instrucciones KOP en GRAPH
Instrucciones KOP generales en GRAPH
Descripci√≥n
Para la programaci√≥n en GRAPH se dispone de diferentes instrucciones KOP.
La tabla siguiente ofrece una vista general de las instrucciones y su disponibilidad:
Instrucciones KOP

Instrucci√≥n
permanente

Transici√≥n/
Supervisi√≥n/
Interlock

General
Insertar segmento

x

Cuadro vac√≠o

x

x

Abrir rama

x

x

Cerrar rama

x

x

---| |---: Contacto normalmente abierto (P√°gina 4817)

x

x

---| |---: Contacto normalmente cerrado (P√°gina 4818)

x

x

--| NOT |--: Invertir RLO (P√°gina 4819)

x

x

---( )---: Asignaci√≥n (P√°gina 4820)

x

Operaciones l√≥gicas con bits

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5825

Instrucciones
4.2 Instrucciones
Instrucciones KOP

Instrucci√≥n
permanente

---( R )---: Desactivar salida (P√°gina 4821)

x

---( S )---: Activar salida (P√°gina 4822)

x

SR: Flipflop de activaci√≥n/desactivaci√≥n (P√°gina 4823)

x

RS: Flipflop de desactivaci√≥n/activaci√≥n (P√°gina 4824)

x

--|P|--: Consultar flanco de se√±al ascendente de un operando (P√°gina 4825)

x

--|N|--: Consultar flanco de se√±al descendente de un operando (P√°gina 4827)

x

P_TRIG: Consultar flanco de se√±al ascendente del RLO (P√°gina 4828)

x

N_TRIG: Consultar flanco de se√±al descendente del RLO (P√°gina 4829)

x

Transici√≥n/
Supervisi√≥n/
Interlock

Temporizadores
Temporizadores CEI
TP: Impulso (P√°gina 4831)

x

TON: Retardo al conectar (P√°gina 4833)

x

TOF: Retardo al desconectar (P√°gina 4835)

x

Temporizadores SIMATIC
S_PULSE: Parametrizar y arrancar temporizador como impulso (P√°gina 4837)

x

S_PEXT: Parametrizar y arrancar temporizador como impulso prolongado (P√°gina 4840)

x

S_ODT: Parametrizar y arrancar temporizador como retardo a la conexi√≥n (P√°gina 4843)

x

S_ODTS: Parametrizar y arrancar temporizador como retardo a la conexi√≥n con memoria
(P√°gina 4846)

x

S_OFFDT: Parametrizar y arrancar temporizador como retardo a la desconexi√≥n (P√°gi‚Äê
na 4848)

x

Contadores
Contadores CEI
CTU: Contador ascendente (P√°gina 4861)

x

CTD: Contador descendente (P√°gina 4863)

x

CTUD: Contador ascendente - descendente (P√°gina 4865)

x

Contadores SIMATIC
S_CU : Parametrizar e incrementar contador (P√°gina 4868)

x

S_CD : Parametrizar y decrementar contador (P√°gina 4870)

x

S_CUD : Parametrizar e incrementar/decrementar contador (P√°gina 4872)

x

Comparaci√≥n
CMP ==: Igual (P√°gina 4877)

x

x

CMP <>: Diferente (P√°gina 4878)

x

x

CMP >=: Mayor o igual (P√°gina 4880)

x

x

CMP <=: Menor o igual (P√°gina 4881)

x

x

CMP >: Mayor (P√°gina 4882)

x

x

CMP <: Menor (P√°gina 4883)

x

x

CMP>T: Superior al tiempo de activaci√≥n de la etapa (P√°gina 5828)

x

CMP>U: Superior al tiempo de activaci√≥n ininterrumpido de la etapa (P√°gina 5829)

x

Funciones matem√°ticas
ADD: Sumar (P√°gina 4885)

x

SUB: Restar (P√°gina 4886)

x

5826

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Instrucciones KOP

Instrucci√≥n
permanente

MUL: Multiplicar (P√°gina 4887)

x

DIV: Dividir (P√°gina 4889)

x

MOD: Obtener resto de divisi√≥n (P√°gina 4890)

x

NEG: Generar complemento a dos (P√°gina 4891)

x

ABS: Calcular valor absoluto (P√°gina 4892)

x

MIN: Determinar m√≠nimo (P√°gina 4893)

x

MAX: Determinar m√°ximo (P√°gina 4895)

x

LIMIT: Ajustar valor l√≠mite (P√°gina 4897)

x

SQR: Calcular cuadrado (P√°gina 4899)

x

SQRT: Calcular ra√≠z cuadrada (P√°gina 4900)

x

LN: Calcular logaritmo natural (P√°gina 4901)

x

EXP: Calcular valor exponencial (P√°gina 4902)

x

SIN: Calcular valor de seno (P√°gina 4904)

x

COS: Calcular valor de coseno (P√°gina 4905)

x

TAN: Calcular valor de tangente (P√°gina 4906)

x

ASIN: Calcular valor de arcoseno (P√°gina 4907)

x

ACOS: Calcular valor de arcocoseno (P√°gina 4909)

x

ATAN: Calcular valor de arcotangente (P√°gina 5597)

x

Transici√≥n/
Supervisi√≥n/
Interlock

Transferencia
MOVE: Copiar valor (P√°gina 4912)

x

BLKMOV: Copiar √°rea (P√°gina 4914)

x

UBLKMOV: Copiar √°rea sin interrupciones (P√°gina 4917)

x

FILL: Rellenar √°rea (P√°gina 4920)

x

Conversi√≥n
CONVERT: Convertir valor (P√°gina 4924)

x

ROUND: Redondear n√∫mero (P√°gina 4925)

x

CEIL: Redondear n√∫mero en coma flotante al siguiente entero superior (P√°gina 4926)

x

FLOOR: Redondear n√∫mero en coma flotante al siguiente entero inferior (P√°gina 4928)

x

TRUNC: Truncar a entero (P√°gina 4929)

x

SCALE: Escalar (P√°gina 4930)

x

UNSCALE: Desescalar (P√°gina 4933)

x

Control del programa
Control en runtime
RE_TRIGR: Reiniciar tiempo de vigilancia del ciclo (P√°gina 4942)

x

STP: Finalizar programa (P√°gina 4942)

x

WAIT: Programar retardo (P√°gina 4943)

x

PROTECT: Cambiar nivel de protecci√≥n (P√°gina 4944)

x

COMPRESS: Comprimir memoria CPU (S7-400) (P√°gina 4940)

x

CiR: Controlar proceso CiR (S7-400) (P√°gina 4946)

x

Operaciones l√≥gicas con palabras
AND: Operaci√≥n l√≥gica Y (P√°gina 4948)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

x

5827

Instrucciones
4.2 Instrucciones
Instrucciones KOP

Instrucci√≥n
permanente

OR: Operaci√≥n l√≥gica O (P√°gina 4950)

x

XOR: Operaci√≥n l√≥gica O-exclusiva (P√°gina 4951)

x

INV: Complemento a 1 (P√°gina 4953)

x

DECO: Descodificar (P√°gina 4954)

x

ENCO: Codificar (P√°gina 4955)

x

SEL: Seleccionar (P√°gina 4956)

x

Transici√≥n/
Supervisi√≥n/
Interlock

Desplazamiento y rotaci√≥n
SHR: Desplazar a la derecha (P√°gina 4958)

x

SHL: Desplazar a la izquierda (P√°gina 4960)

x

ROR: Rotar a la derecha (P√°gina 4962)

x

ROL: Rotar a la izquierda (P√°gina 4963)

x

Otras instrucciones
SET: Activar √°rea por bits (P√°gina 4979)

x

SETP: Activar mapa de bits en el √°rea de periferia (S7-400) (P√°gina 4980)

x

SETI: Activar √°rea por bytes (P√°gina 4983)

x

RESET: Desactivar √°rea por bits (P√°gina 4985)

x

RESETP: Desactivar mapa de bits en el √°rea de periferia (S7-400) (P√°gina 4986)

x

RESETI: Desactivar √°rea por bytes (P√°gina 4988)

x

REPL_VAL: Introducir valor sustitutivo (P√°gina 4990)

x

DRUM: Materializar circuito secuencial sucesivo (P√°gina 4991)

x

DRUM_X: Materializar circuito secuencial sucesivo (P√°gina 4997)

x

DCAT: Alarma de tiempo para control discreto (P√°gina 5005)

x

MCAT: Alarma de tiempo para control del motor (P√°gina 5009)

x

IMC: Comparar los bits de entrada con los bits de la m√°scara (P√°gina 5012)

x

SMC: Barrido de matriz (P√°gina 5015)

x

LEAD_LAG: Algoritmo Lead y Lag (P√°gina 5017)

x

TONR_X: Acumulador de tiempo (P√°gina 5021)

x

WSR: Guardar datos en el registro de desplazamiento (P√°gina 5023)

x

SHRB: Desplazar bit al registro de desplazamiento (P√°gina 5026)

x

SEG: Generar patr√≥n de bits para el display de 7 segmentos (P√°gina 5028)

x

BCDCPL: Generar complemento a diez (P√°gina 5030)

x

BITSUM: Contar n√∫mero de bits activados (P√°gina 5032)

x

CMP>T: Superior al tiempo de activaci√≥n de la etapa
Descripci√≥n
Con la instrucci√≥n "Superior al tiempo de activaci√≥n de la etapa" se vigila la duraci√≥n total de
una etapa en condiciones de supervisi√≥n. De esta manera se registra el tiempo de los posibles
eventos o errores.

5828

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En la condici√≥n programada se compara el tiempo de activaci√≥n en curso o el √∫ltimo de una
etapa (operando1) con un tiempo definido (operando2) en milisegundos. Si se cumple la
condici√≥n de la comparaci√≥n, la instrucci√≥n devuelve el resultado l√≥gico (RLO) "1". Si la
condici√≥n de la comparaci√≥n no se cumple, la instrucci√≥n devuelve el RLO "0".

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "Superior al tiempo de activaci√≥n
de la etapa":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando1>

Input

Enteros

I, Q, M, D, L o cons‚Äê Tiempo de activa‚Äê
tante
ci√≥n actual o √∫ltimo
de la etapa

<Operando2>

Input

DINT, TIME,
S5TIME

I, Q, M, D, L o cons‚Äê Tiempo con el que
tante
se compara

Ejemplo
El siguiente ejemplo muestra la instrucci√≥n en el segmento:
67(37
!
7,0(
706

Mientras el tiempo de activaci√≥n de #STEP1.T est√© por debajo de 100 ms, el RLO ser√° "0". En
cuanto el tiempo de activaci√≥n sobrepasa 100 ms, el RLO cambia a "1".

CMP>U: Superior al tiempo de activaci√≥n ininterrumpido de la etapa
Descripci√≥n
Con la instrucci√≥n "Superior al tiempo de activaci√≥n ininterrumpido de la etapa", se vigila la
duraci√≥n de una etapa, sin tener en cuenta las posibles aver√≠as, en condiciones de supervisi√≥n.
No se registra el tiempo de posibles eventos o fallos sino que se supervisa la duraci√≥n de la
mera etapa.
En la condici√≥n programada se compara todo el tiempo de activaci√≥n de la etapa (operando1)
con un tiempo definido (operando2) en milisegundos. Si se cumple la condici√≥n de la
comparaci√≥n, la instrucci√≥n devuelve el resultado l√≥gico (RLO) "1". Si la condici√≥n de la
comparaci√≥n no se cumple, la instrucci√≥n devuelve el RLO "0".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5829

Instrucciones
4.2 Instrucciones

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "Superior al tiempo de activaci√≥n
ininterrumpido de la etapa":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando1>

Input

Enteros

I, Q, M, D, L o cons‚Äê Tiempo de activa‚Äê
tante
ci√≥n actual o √∫ltimo
de la etapa sin con‚Äê
tar aver√≠as

<Operando2>

Input

DINT, TIME,
S5TIME

I, Q, M, D, L o cons‚Äê Tiempo con el que
tante
se compara

Ejemplo
El siguiente ejemplo muestra la instrucci√≥n en el segmento:
67(38
!
7,0(
706

Mientras el tiempo de activaci√≥n de #STEP1.U, sin tener en cuenta las posibles aver√≠as, est√©
por debajo de 100 ms, el RLO ser√° igual a "0". En cuanto el tiempo de activaci√≥n sobrepasa
100 ms, el RLO cambia a "1".

Instrucciones FUP en GRAPH
Instrucciones FUP generales en GRAPH
Descripci√≥n
Para la programaci√≥n en GRAPH se dispone de diferentes instrucciones FUP.
La tabla siguiente ofrece una vista general de las instrucciones y su disponibilidad:
Instrucci√≥n FUP

Operaci√≥n
permanente

Transici√≥n/ Su‚Äê
pervisi√≥n/ Inter‚Äê
lock

General
Nuevo segmento: Insertar segmento

x

Cuadro vac√≠o

x

x

Derivaci√≥n: Abrir rama

x

x

-|: Insertar entrada (P√°gina 5037)

x

x

-o|: Invertir RLO (P√°gina 5038)

x

x

&: Operaci√≥n l√≥gica Y (P√°gina 5033)

x

x

>=1: Operaci√≥n l√≥gica O (P√°gina 5034)

x

x

Operaciones l√≥gicas con bits

5830

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Instrucci√≥n FUP

Operaci√≥n
permanente

x: Operaci√≥n l√≥gica O-exclusiva (P√°gina 5035)

x

= : Asignaci√≥n (P√°gina 5039)

x

-(R): Desactivar salida (P√°gina 5040)

x

-(S): Activar salida (P√°gina 5041)

x

SR: Flipflop de activaci√≥n/desactivaci√≥n (P√°gina 5042)

x

RS: Flipflop de desactivaci√≥n/activaci√≥n (P√°gina 5043)

x

-|P|-: Consultar flanco de se√±al ascendente de un operando (P√°gina 5044)

x

-|N|-: Consultar flanco de se√±al descendente de un operando (P√°gina 5046)

x

P_TRIG: Consultar flanco de se√±al ascendente del RLO (P√°gina 5047)

x

N_TRIG: Consultar flanco de se√±al descendente del RLO (P√°gina 5048)

x

Transici√≥n/ Su‚Äê
pervisi√≥n/ Inter‚Äê
lock

Temporizadores
Temporizadores CEI
TP: Impulso (P√°gina 5050)

x

TON: Retardo al conectar (P√°gina 5052)

x

TOF: Retardo al desconectar (P√°gina 5054)

x

Temporizadores SIMATIC
S_PULSE: Parametrizar y arrancar temporizador como impulso (P√°gina 5056)

x

S_PEXT: Parametrizar y arrancar temporizador como impulso prolongado (P√°gina 5059) x
S_ODT: Parametrizar y arrancar temporizador como retardo a la conexi√≥n (P√°gina 5062)

x

S_ODTS: Parametrizar y arrancar temporizador como retardo a la conexi√≥n con memoria
(P√°gina 5065)

x

S_OFFDT: Parametrizar y arrancar temporizador como retardo a la desconexi√≥n (P√°gi‚Äê
na 5067)

x

Contadores
Contadores CEI
CTU: Contador ascendente (P√°gina 5080)

x

CTD: Contador descendente (P√°gina 5082)

x

CTUD: Contador ascendente - descendente (P√°gina 5084)

x

Contadores SIMATIC
S_CU : Parametrizar e incrementar contador (P√°gina 5087)

x

S_CD : Parametrizar y decrementar contador (P√°gina 5089)

x

S_CUD : Parametrizar e incrementar/decrementar contador (P√°gina 5090)

x

Comparaci√≥n
CMP ==: Igual (P√°gina 5096)

x

x

CMP <>: Diferente (P√°gina 5097)

x

x

CMP >=: Mayor o igual (P√°gina 5099)

x

x

CMP <=: Menor o igual (P√°gina 5100)

x

x

CMP >: Mayor (P√°gina 5101)

x

x

CMP <: Menor (P√°gina 5102)

x

x

CMP>T: Superior al tiempo de activaci√≥n de la etapa (P√°gina 5834)

x

CMP>U: Superior al tiempo de activaci√≥n ininterrumpido de la etapa (P√°gina 5834)

x

Funciones matem√°ticas

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5831

Instrucciones
4.2 Instrucciones
Instrucci√≥n FUP

Operaci√≥n
permanente

ADD: Sumar (P√°gina 5103)

x

SUB: Restar (P√°gina 5104)

x

MUL: Multiplicar (P√°gina 5106)

x

DIV: Dividir (P√°gina 5107)

x

MOD: Obtener resto de divisi√≥n (P√°gina 5108)

x

NEG: Generar complemento a dos (P√°gina 5109)

x

ABS: Calcular valor absoluto (P√°gina 5111)

x

MIN: Determinar m√≠nimo (P√°gina 5112)

x

MAX: Determinar m√°ximo (P√°gina 5114)

x

LIMIT: Ajustar valor l√≠mite (P√°gina 5116)

x

SQR: Calcular cuadrado (P√°gina 5118)

x

SQRT: Calcular ra√≠z cuadrada (P√°gina 5119)

x

LN: Calcular logaritmo natural (P√°gina 5120)

x

EXP: Calcular valor exponencial (P√°gina 5122)

x

SIN: Calcular valor de seno (P√°gina 5123)

x

COS: Calcular valor de coseno (P√°gina 5124)

x

TAN: Calcular valor de tangente (P√°gina 5126)

x

ASIN: Calcular valor de arcoseno (P√°gina 5127)

x

ACOS: Calcular valor de arcocoseno (P√°gina 5129)

x

ATAN: Calcular valor de arcotangente (P√°gina 5130)

x

Transici√≥n/ Su‚Äê
pervisi√≥n/ Inter‚Äê
lock

Transferencia
MOVE: Copiar valor (P√°gina 5132)

x

BLKMOV: Copiar √°rea (P√°gina 5134)

x

UBLKMOV: Copiar √°rea sin interrupciones (P√°gina 5137)

x

FILL: Rellenar √°rea (P√°gina 5140)

x

Conversi√≥n
CONVERT: Convertir valor (P√°gina 5144)

x

ROUND: Redondear n√∫mero (P√°gina 5145)

x

CEIL: Redondear n√∫mero en coma flotante al siguiente entero superior (P√°gina 5146)

x

FLOOR: Redondear n√∫mero en coma flotante al siguiente entero inferior (P√°gina 5148)

x

TRUNC: Truncar a entero (P√°gina 5149)

x

SCALE: Escalar (P√°gina 5150)

x

UNSCALE: Desescalar (P√°gina 5152)

x

Control del programa
Control en runtime
RE_TRIGR: Reiniciar tiempo de vigilancia del ciclo (P√°gina 5162)

x

STP: Finalizar programa (P√°gina 5162)

x

PROTECT: Cambiar nivel de protecci√≥n (P√°gina 5164)

x

WAIT: Programar retardo (P√°gina 5163)

x

COMPRESS: Comprimir memoria CPU (S7-400) (P√°gina 5160)

x

CiR: Controlar proceso CiR (S7-400) (P√°gina 5167)

x

5832

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Instrucci√≥n FUP

Operaci√≥n
permanente

Transici√≥n/ Su‚Äê
pervisi√≥n/ Inter‚Äê
lock

Operaciones l√≥gicas con palabras
AND: Operaci√≥n l√≥gica Y (P√°gina 5169)

x

OR: Operaci√≥n l√≥gica O (P√°gina 5171)

x

XOR: Operaci√≥n l√≥gica O-exclusiva (P√°gina 5172)

x

INV: Complemento a 1 (P√°gina 5174)

x

DECO: Descodificar (P√°gina 5175)

x

ENCO: Codificar (P√°gina 5176)

x

SEL: Seleccionar (P√°gina 5178)

x

Desplazamiento y rotaci√≥n
SHR: Desplazar a la derecha (P√°gina 5179)

x

SHL: Desplazar a la izquierda (P√°gina 5181)

x

ROR: Rotar a la derecha (P√°gina 5183)

x

ROL: Rotar a la izquierda (P√°gina 5185)

x

Otras instrucciones
SET: Activar √°rea por bits (P√°gina 5199)

x

SETP: Activar mapa de bits en el √°rea de periferia (S7-400) (P√°gina 5200)

x

SETI: Activar √°rea por bytes (P√°gina 5203)

x

RESET: Desactivar √°rea por bits (P√°gina 5205)

x

RESETP: Desactivar mapa de bits en el √°rea de periferia (S7-400) (P√°gina 5206)

x

RESETI: Desactivar √°rea por bytes (P√°gina 5208)

x

REPL_VAL: Introducir valor sustitutivo (P√°gina 5210)

x

DRUM: Materializar circuito secuencial sucesivo (P√°gina 5211)

x

DRUM_X: Materializar circuito secuencial sucesivo (P√°gina 5217)

x

DCAT: Alarma de tiempo para control discreto (P√°gina 5225)

x

MCAT: Alarma de tiempo para control del motor (P√°gina 5228)

x

IMC: Comparar los bits de entrada con los bits de la m√°scara (P√°gina 5232)

x

SMC: Barrido de matriz (P√°gina 5235)

x

LEAD_LAG: Algoritmo Lead y Lag (P√°gina 5237)

x

TONR_X: Acumulador de tiempo (P√°gina 5240)

x

WSR: Guardar datos en el registro de desplazamiento (P√°gina 5243)

x

SHRB: Desplazar bit al registro de desplazamiento (P√°gina 5245)

x

SEG: Generar patr√≥n de bits para el display de 7 segmentos (P√°gina 5250)

x

BCDCPL: Generar complemento a diez (P√°gina 5251)

x

BITSUM: Contar n√∫mero de bits activados (P√°gina 5253)

x

Consulte tambi√©n
JMP: Saltar si RLO = 1 (P√°gina 5155)
JMPN: Saltar si RLO = 0 (P√°gina 5156)
LABEL: Etiqueta (P√°gina 5157)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5833

Instrucciones
4.2 Instrucciones

CMP>T: Superior al tiempo de activaci√≥n de la etapa
Descripci√≥n
Con la instrucci√≥n "Superior al tiempo de activaci√≥n de la etapa" se vigila la duraci√≥n total de
una etapa en condiciones de supervisi√≥n. De esta manera se registra el tiempo de los posibles
eventos o errores.
En la condici√≥n programada se compara el tiempo de activaci√≥n en curso o el √∫ltimo de una
etapa (operando1) con un tiempo definido (operando2) en milisegundos. Si se cumple la
condici√≥n de la comparaci√≥n, la instrucci√≥n devuelve el resultado l√≥gico (RLO) "1". Si la
condici√≥n de la comparaci√≥n no se cumple, la instrucci√≥n devuelve el RLO "0".

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "Superior al tiempo de activaci√≥n
de la etapa":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando1>

Input

Enteros

I, Q, M, D, L o cons‚Äê Tiempo de activa‚Äê
tante
ci√≥n actual o √∫ltimo
de la etapa

<Operando2>

Input

DINT, TIME,
S5TIME

I, Q, M, D, L o cons‚Äê Tiempo con el que
tante
se compara

Ejemplo
El siguiente ejemplo muestra la instrucci√≥n en el segmento:
!
7LPH
67(37
706

,1
,1

Mientras el tiempo de activaci√≥n de #STEP1.T est√© por debajo de 100 ms, el RLO ser√° "0". En
cuanto el tiempo de activaci√≥n sobrepasa 100 ms, el RLO cambia a "1".

CMP>U: Superior al tiempo de activaci√≥n ininterrumpido de la etapa
Descripci√≥n
Con la instrucci√≥n "Superior al tiempo de activaci√≥n ininterrumpido de la etapa", se vigila la
duraci√≥n de una etapa, sin tener en cuenta las posibles aver√≠as, en condiciones de supervisi√≥n.
No se registra el tiempo de posibles eventos o fallos sino que se supervisa la duraci√≥n de la
mera etapa.
En la condici√≥n programada se compara todo el tiempo de activaci√≥n de una etapa
(operando1) con un tiempo definido (operando2) en milisegundos. Si se cumple la condici√≥n
de la comparaci√≥n, la instrucci√≥n devuelve el resultado l√≥gico (RLO) "1". Si la condici√≥n de la
comparaci√≥n no se cumple, la instrucci√≥n devuelve el RLO "0".

5834

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "Superior al tiempo de activaci√≥n
ininterrumpido de la etapa":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

<Operando1>

Input

Enteros

I, Q, M, D, L o cons‚Äê Tiempo de activa‚Äê
tante
ci√≥n actual o √∫ltimo
de la etapa sin con‚Äê
tar aver√≠as

<Operando2>

Input

DINT, TIME,
S5TIME

I, Q, M, D, L o cons‚Äê Tiempo con el que
tante
se compara

Ejemplo
El siguiente ejemplo muestra la instrucci√≥n en el segmento:
!
7LPH
67(38
706

,1
,1

Mientras el tiempo de activaci√≥n de #STEP1.U, sin tener en cuenta las posibles aver√≠as, est√©
por debajo de 100 ms, el RLO ser√° igual a "0". En cuanto el tiempo de activaci√≥n sobrepasa
100 ms, el RLO cambia a "1".

4.2.3

Instrucciones avanzadas

4.2.3.1

Fecha y hora

T_COMP: Comparar variables de tiempo
Descripci√≥n
Esta instrucci√≥n compara el contenido de dos variables del tipo de datos DT y devuelve el
resultado de la comparaci√≥n como valor de retorno en el par√°metro OUT. El par√°metro OUT
se pone a "1" una vez que se ha cumplido la condici√≥n de comparaci√≥n utilizada.
Existen las siguientes posibilidades de comparaci√≥n:
S√≠mbolo

Descripci√≥n

EQ

El valor de retorno tiene el estado l√≥gico "1" si los momentos son id√©nticos en el par√°metro IN1 y en el
par√°metro IN2.

NE

El valor de retorno tiene el estado l√≥gico "1" si los momentos no son id√©nticos en el par√°metro IN1 y en el
par√°metro IN2.

GE

El valor de retorno tiene el estado l√≥gico "1" si el momento del par√°metro IN1 es mayor (m√°s reciente) o igual
al del par√°metro IN2 .

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5835

Instrucciones
4.2 Instrucciones
S√≠mbolo

Descripci√≥n

LE

El valor de retorno tiene el estado l√≥gico "1" si el momento del par√°metro IN1 es menor (m√°s antiguo) o igual
al del par√°metro IN2.

GT

El valor de retorno tiene el estado l√≥gico "1" si el momento del par√°metro IN1 es mayor (m√°s reciente) que
el del par√°metro IN2.

LT

El valor de retorno tiene el estado l√≥gico "1" si el momento del par√°metro IN1 es menor (m√°s antiguo) que
el del par√°metro IN2 .

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "T_COMP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

DT

D, L

Valor que se va a comparar

IN2

Input

DT

D, L

Valor que se va a comparar

OUT

Output

BOOL

I, Q, M, D, L

Valor de retorno

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

T_CONV: Convertir y extraer tiempos
Descripci√≥n
La instrucci√≥n "T_CONV" convierte los tipos de datos DT (DATE_AND_TIME), S5TIME y TIME
en los tipos de datos DATE, INT, TOD (TIME_OF_DAY), TIME o S5TIME.

Par√°metros
El tipo de conversi√≥n se define seleccionando los tipos de datos en los cuadros de instrucci√≥n
de la entrada y la salida de la instrucci√≥n. El resultado de la conversi√≥n puede consultarse en
el par√°metro OUT.
La tabla siguiente muestra los par√°metros de la instrucci√≥n "T_CONV":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

DT, S5TIME, TI‚Äê
ME

I, Q, M, D, L

Valor que se va a convertir. El formato
de datos de la variable del par√°metro IN
debe coincidir con el tipo de datos selec‚Äê
cionado en el cuadro de instrucci√≥n.

OUT

Return

DATE, INT,
TOD, TIME,
S5TIME

I, Q, M, D, L

Resultado de la conversi√≥n. El formato
de datos de la variable del par√°metro
OUT debe coincidir con el tipo de datos
seleccionado en el cuadro de instruc‚Äê
ci√≥n.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

5836

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplos
Tabla 4-256 Conversi√≥n del formato de datos TIME al formato S5TIME
Par√°metro

Declaraci√≥n

Tipo de datos

Descripci√≥n

IN

Output

TIME

Variable de entrada en el formato de datos TIME.

OUT

Input

S5TIME

La funci√≥n convierte el formato de datos TIME al formato S5TIME.
Al convertir se efect√∫a un redondeo. Si el par√°metro de entrada es
mayor que el formato representable de S5TIME (mayor que TI‚Äê
ME#02:46:30.000), se devuelve como resultado S5TIME#999.3 y el
resultado binario BR se ajusta a "0".

Tabla 4-257 Extracci√≥n del d√≠a de la semana desde el formato DATE_AND_TIME
Par√°metro

Declaraci√≥n

Tipo de datos

Descripci√≥n

IN

Output

DT

Variable de entrada en el formato de datos DATE_AND_TIME.

OUT

Input

INT

La funci√≥n extrae el d√≠a de la semana desde el formato DA‚Äê
TE_AND_TIME (DT). El d√≠a de la semana se devuelve en el formato
de datos INTEGER:
1: Domingo
2: Lunes
3: Martes
4: Mi√©rcoles
5: Jueves
6: Viernes
7: S√°bado

T_ADD: Sumar tiempos
Descripci√≥n
Con la instrucci√≥n "T_ADD" se suma a un momento (formato DT) una duraci√≥n (formato TIME)
y se devuelve como resultado un nuevo momento (formato DT).
El momento DT del par√°metro IN1 debe encontrarse en el rango entre
DT#1990-01-01-00:00:00.000 y DT#2089-12-31-23:59:59.999. Esta instrucci√≥n no efect√∫a
ninguna comprobaci√≥n de entrada. Si el resultado de la suma no se encuentra dentro del rango
indicado arriba, se limita el resultado al valor correspondiente y el resultado binario BR se
ajusta a "0".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5837

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "T_ADD":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

DT

D, L

Fecha y hora en el formato DT (DA‚Äê
TE_AND_TIME).

IN2

Input

TIME

I, Q, M, D, L o constante

Duraci√≥n que se debe sumar en el
formato TIME.

OUT

Return

DT

D, L

Resultado de la suma en el formato
DT (DATE_AND_TIME).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

T_SUB: Restar tiempos
Descripci√≥n
Con la instrucci√≥n "T_SUB" se resta de un momento (formato DT) una duraci√≥n (formato TIME)
y se devuelve como resultado un nuevo momento (formato DT).
El momento DT del par√°metro IN1 debe encontrarse en el rango entre
DT#1990-01-01-00:00:00.000 y DT#2089-12-31-23:59:59.999. Esta instrucci√≥n no efect√∫a
ninguna comprobaci√≥n de entrada. Si el resultado de la resta no se encuentra dentro del rango
indicado arriba, se limita el resultado al valor correspondiente y el resultado binario BR se
ajusta a "0".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "T_SUB":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

DT

D, L

Fecha y hora en el formato DT (DA‚Äê
TE_AND_TIME).

IN2

Input

TIME

I, Q, M, D, L o constante Duraci√≥n que se debe restar en el formato
TIME.

OUT

Return

DT

D, L

Resultado de la resta en el formato DT
(DATE_AND_TIME).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

5838

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

T_DIFF: Diferencia de tiempo
Descripci√≥n
Con la instrucci√≥n "T_DIFF" se calcula la diferencia entre dos tiempos restando dos tiempos
con el formato DT. El tiempo de la entrada IN2 se resta del tiempo de la entrada IN1. El
resultado de la resta se devuelve en la salida OUT en el formato TIME :
‚óè Si el primer tiempo de la entrada es IN1 mayor (m√°s reciente) que el segundo tiempo en la
entrada IN2, el resultado en la salida OUT es positivo.
‚óè Si el primer tiempo de la entrada es IN1 menor (m√°s antiguo) que el segundo punto en la
entrada IN2, el resultado en la salida OUT es negativo.
Si el resultado de la resta se encuentra fuera del rango num√©rico de TIME, se limita el resultado
al valor correspondiente y el resultado binario BR se ajusta a "0".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "T_DIFF":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

DT

D, L

Minuendo

IN2

Input

DT

D, L

Sustraendo

OUT

Return

TIME

I, Q, M, D, L

Diferencia en el formato TIME.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

T_COMBINE: Combinar tiempos
Descripci√≥n
La instrucci√≥n "T_COMBINE" combina los formatos de datos DATE y TIME_OF_DAY (TOD) y
los convierte al formato DATE_AND_TIME (DT). La instrucci√≥n no notifica errores.
‚óè El valor de entrada DATE debe encontrarse entre DATE#1990-01-01 y DATE#2089-12-31
(no se comprueba).
‚óè En el valor de entrada IN2 se utiliza el tipo de datos TIME_OF_DAY .
‚óè En el valor de salida OUT se devuelve el formato de datos DATE_AND_TIME.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "T_COMBINE":
odParameter

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

DATE

D, L o constante

Variable de entrada en el formato DATE

IN2

Input

TOD

D, L o constante

Variable de entrada en el formato TOD

OUT

Return

DT

D, L

Valor de retorno en el formato DT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5839

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Funciones de reloj
WR_SYS_T: Ajustar la hora
Descripci√≥n
Al llamar "WR_SYS_T" se ajusta la hora y la fecha del reloj de la CPU. A partir de ese momento,
el reloj avanza desde la hora y fecha ajustadas. La informaci√≥n de fecha y hora se introduce
en el formato de datos DT en la entrada IN de la instrucci√≥n. Para convertir los formatos DATE
y TOD al formato de datos requerido DT se puede utilizar la instrucci√≥n "T_COMBINE
(P√°gina 5839)".
Si el reloj es un reloj maestro, al llamar la funci√≥n, la CPU inicia adicionalmente la
sincronizaci√≥n de la hora. Los intervalos de sincronizaci√≥n se definen en la configuraci√≥n. La
informaci√≥n de zona horaria local u horario de verano no se puede transferir con la instrucci√≥n
"WR_SYS_T".
En la salida RET_VAL se puede consultar si se han producido errores durante la ejecuci√≥n de
la instrucci√≥n.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WR_SYS_T":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

DT

D, L

Fecha y hora

RET_VAL

Return

INT

I, Q, M, D, L

Estado de la instrucci√≥n

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error
(W#16#....)

Descripci√≥n

0000

Ning√∫n error

8080

Error en la fecha

8081

A√±o no v√°lido

8082

Mes no v√°lido

8083

D√≠a no v√°lido

8084

Indicaci√≥n de horas no v√°lida

8085

Indicaci√≥n de minutos no v√°lida

8086

Indicaci√≥n de segundos no v√°lida

5840

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error
(W#16#....)

Descripci√≥n

8087

Indicaci√≥n de nanosegundos no v√°lida

80B0

Fallo del reloj en tiempo real

Ejemplo
La fecha y la hora deben introducirse con el tipo de datos DT . Ejemplo del 15 de enero de 2010,
10:30 h y 30 s: DT#2010-01-15-10:30:30. La hora solo se puede introducir con granularidad de
segundos. El d√≠a de la semana se calcula a partir de la fecha usando la instrucci√≥n
"WR_SYS_T".

Consulte tambi√©n
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

RD_SYS_T: Leer la hora
Descripci√≥n
La instrucci√≥n "RD_SYS_T" permite leer la fecha y hora actuales del reloj de la CPU. Los datos
le√≠dos se devuelven en formato DT en la salida OUT de la instrucci√≥n. El valor emitido no
contiene indicaciones respecto a la zona horaria local ni al horario de verano. En la salida
RET_VAL se puede consultar si se han producido errores durante la ejecuci√≥n de la
instrucci√≥n.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RD_SYS_T":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecu‚Äê
ci√≥n de la instrucci√≥n, el valor de respues‚Äê
ta contendr√° un c√≥digo de error.

OUT

Output

DT

D,L

Fecha y hora de la CPU

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error
(W#16#....)

Descripci√≥n

0000

Sin error

8222

El resultado se encuentra fuera del rango de valores admisible.

8223

El resultado no puede guardarse en el tipo de datos especificado.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5841

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

TIME_TCK: Leer hora del sistema
Descripci√≥n
Con la instrucci√≥n "TIME_TCK" se lee la hora del sistema de la CPU. La hora del sistema es
un contador de tiempo que contabiliza desde 0 a un m√°ximo de 2147483647 ms. En caso de
desbordamiento de la hora del sistema, se reinicia el recuento desde "0". El incremento de
tiempo y la exactitud de la hora del sistema es de 1 ms. El √∫nico factor que influye en la hora
del sistema son los estados operativos de la CPU. La hora del sistema se puede usar, por
ejemplo, para medir la duraci√≥n de procesos obteniendo la diferencia entre los resultados de
dos llamadas de "TIME_TCK". Esta instrucci√≥n no ofrece informaci√≥n de error.
La tabla siguiente resume los cambios que experimenta la hora del sistema en funci√≥n de los
estados operativos de la CPU.
Estado operativo

La hora del sistema ...

Arranque

... se actualiza de modo permanente.

RUN
STOP

... se detiene y mantiene el valor actual.

Rearranque (no con S7-300)

... contin√∫a avanzando a partir del valor que se guard√≥ al pasar
al estado STOP.

Rearranque completo (en caliente)

... se borra y vuelve a empezar desde "0".

Arranque en fr√≠o

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "TIME_TCK":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

TIME

I, Q, M, D, L

El par√°metro RET_VAL contiene la
hora del sistema le√≠da, en el rango de
0 a 231 -1 ms.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

5842

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

SET_CLKS: Ajustar la hora e inicializar el estado del reloj
Descripci√≥n
Con la instrucci√≥n "SET_CLKS" se ajusta la hora de la CPU y se inicializa el estado del reloj.
Nota
Active "SET_CLKS" solo si en su CPU no se sincroniza la hora. De lo contrario, en cada
sincronizaci√≥n se adoptar√° el estado del reloj maestro. Al hacerlo, el valor predefinido con
"SET_CLKS" se sobrescribe.
Nota
El estado actual de hora de la CPU se puede averiguar leyendo la ID de SZL W#16#0132 Index
W#16#0008 (P√°gina 6148) con la instrucci√≥n "RDSYSST (P√°gina 6116)".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SET_CLKS":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

BYTE

I, Q, M, D, L o constante Modo de operaci√≥n:
‚óè B#16#01: Ajustar la hora
‚óè B#16#02: Inicializar el estado del reloj
‚óè B#16#03: Ajustar la hora e inicializar el
estado del reloj

PDT

Input

DT

D, L

CORR

Input

INT

I, Q, M, D, L o constante Valor de correcci√≥n (en incrementos de 0,5
h)
Valores posibles: de ‚Äì24 a +26

Hora predefinida

SUMMER

Input

BOOL

I, Q, M, D, L

Identificaci√≥n del horario de verano/invier‚Äê
no:
‚óè 0 = Horario de invierno
‚óè 1 = Horario de verano

ANN_1

Input

BOOL

I, Q, M, D, L

Hora de aviso:
1: A la pr√≥xima hora en punto se cambiar√°
de horario de verano a horario de invierno
o viceversa.

RET_VAL

Return

INT

I, Q, M, D, L

C√≥digo de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5843

Instrucciones
4.2 Instrucciones

Par√°metro MODE
Con el par√°metro MODE puede definirse si se desea cambiar solo la hora, solo el estado de
la hora o ambos valores. Esto se explica en la siguiente tabla:
MODE

Significado

B#16#01

Ajustar la hora
Esta llamada equivale a la llamada de la instrucci√≥n "SET_CLK".
Los par√°metros de entrada CORR, SUMMER y ANN_1 no se eval√∫an.

B#16#02

Inicializar el estado del reloj
El par√°metro de entrada PDT no se eval√∫a. A partir de los restantes par√°metros de entrada se forman los
siguientes elementos del estado del reloj:
‚óè Valor de correcci√≥n, incluido el signo
‚óè Hora de aviso
‚óè Indicador del horario de verano/invierno
La resoluci√≥n de hora se ajusta de modo que coincida con la resoluci√≥n hora de la CPU. El bit de p√©rdida
de sincronizaci√≥n del estado del reloj adquiere el valor FALSE.
La hora no se modifica.

B#16#03

Ajustar la hora e inicializar el estado del reloj

Par√°metro RET_VAL
C√≥digo de error
(W#16#...)

Explicaci√≥n

0000

Ning√∫n error

8080

MODE fuera del rango de valores admisible

8081

CORR fuera del rango de valores admisible
(solo para MODE = B#16#02 o para MODE = B#16#03)

8082

PDT fuera del rango de valores admisible: Fecha y/u hora no admisibles

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

SNC_RTCB: Sincronizar relojes esclavos
Definici√≥n: Sincronizar relojes esclavos
Se entiende por sincronizaci√≥n de relojes esclavos la transferencia de la fecha y la hora desde
el reloj maestro de un segmento de bus (p. ej. bus K de S7-400, MPI, bus de fondo de S7) a
todos los relojes esclavos de ese mismo segmento de bus.

Descripci√≥n
Para garantizar que la hora coincida en todos los m√≥dulos de la red, el programa de sistema
sincroniza los relojes esclavos a intervalos regulares parametrizables.
Es posible realizar una sincronizaci√≥n, independientemente del intervalo de sincronizaci√≥n
parametrizado, llamando la instrucci√≥n "SNC_RTCB". En este punto, para todos los relojes

5844

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
esclavos presentes en un segmento de bus, la fecha y la hora se transfieren del reloj maestro
al reloj esclavo.
El requisito para una sincronizaci√≥n correcta es que "SNC_RTCB" se ejecute en una CPU cuyo
reloj en tiempo real haya sido parametrizado como reloj maestro para al menos un segmento
de bus.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SNC_RTCB":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la eje‚Äê
cuci√≥n de la instrucci√≥n, el valor de res‚Äê
puesta contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No se ha producido ning√∫n error durante la sincronizaci√≥n.

0001

El reloj presente no ha sido parametrizado como reloj maestro para ning√∫n segmento de bus.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5845

Instrucciones
4.2 Instrucciones

Librer√≠as est√°ndar adicionales
Manejo del contador de horas de funcionamiento
Contador de horas de funcionamiento
Introducci√≥n
Las CPUs disponen de un n√∫mero espec√≠fico de contadores de horas de funcionamiento (ver
datos t√©cnicos de las CPUs).
‚óè Si la CPU est√° provista de contadores de horas de funcionamiento de 16 bits, se pueden
usar las instrucciones "SET_RTM (P√°gina 5849)", "CTRL_RTM (P√°gina 5849)" y
"READ_RTM (P√°gina 5850)" para inicializar, arrancar, parar y leer los contadores.
‚óè Si la CPU est√° provista de contadores de horas de funcionamiento de 32 bits, se pueden
usar las instrucciones "RTM (P√°gina 5847)" para inicializar, arrancar, parar y leer los
contadores.
Nota
Las instrucciones "SET_RTM (P√°gina 5849)", "CTRL_RTM (P√°gina 5849)" y "READ_RTM
(P√°gina 5850)" tambi√©n se pueden utilizar con los contadores de horas de funcionamiento
de 32 bits. Sin embargo, en ese caso los contadores de horas de funcionamiento se
comportan como si fueran de 16 bits (rango de valores de 0 a 32767 horas).
Consulte tambi√©n: Registro del extracto de lista parcial con la ID de SZL W#16#0132 √çndice
W#16#000B (P√°gina 6150).

Aplicaci√≥n
Los contadores de horas de funcionamiento pueden utilizarse para las aplicaciones m√°s
diversas:
‚óè Calcular el tiempo de funcionamiento de la CPU
‚óè Calcular el tiempo de funcionamiento de recursos controlados.

Propiedades del contador de horas de funcionamiento
Al arrancarse, el contador de horas de funcionamiento siempre empieza a contar a partir del
√∫ltimo valor registrado. Si se desea usar otro valor inicial, debe especificarse expl√≠citamente
("SET_RTM (P√°gina 5849)" o "RTM (P√°gina 5847)" con MODE=4). Cuando la CPU pasa al
estado STOP o el usuario para el contador de horas de funcionamiento, la CPU "toma nota" del
valor actual del contador. Al efectuar un rearranque completo (en caliente) o un arranque en
fr√≠o de la CPU, es necesario volver a arrancar el contador de horas de funcionamiento
("CTRL_RTM (P√°gina 5849)" o "RTM (P√°gina 5847)" con MODE=1).
Despu√©s de actualizar el sistema operativo, o despu√©s de restablecer los valores de f√°brica de
la CPU, los contadores de horas de funcionamiento se inicializan al valor "0".

5846

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Rango de valores
‚óè CPU con contador de horas de funcionamiento de 16 bits: de 0 a 32 767 horas
‚óè CPU con contador de horas de funcionamiento de 32 bits: de 0 a (2 elevado a 31) -1 hora
= 2 147 483 647 horas

RTM: Contador de horas de funcionamiento
Descripci√≥n
Con la instrucci√≥n "RTM" se puede inicializar, arrancar, parar y leer un contador de horas de
funcionamiento de 32 bits de la CPU.
Si se desea leer todos los contadores de horas de funcionamiento de 32 bits de la CPU, debe
usarse la instrucci√≥n "RDSYSST (P√°gina 6116)" con los par√°metros SZL_ID=W#16#0132 y:
‚óè INDEX=W#16#000B (para los contadores de horas de funcionamiento de 0 a 7) o bien
‚óè INDEX=W#16#000C (para los contadores de horas de funcionamiento de 8 a 15).
Consulte tambi√©n: Registro del extracto de lista parcial con la ID de SZL W#16#0132 √çndice
W#16#000B (P√°gina 6150).

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RTM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

NR

Input

BYTE

I, Q, M, D, L o constan‚Äê N√∫mero del contador de horas de funciona‚Äê
te
miento
La numeraci√≥n empieza por 0.
Para conocer el n√∫mero de contadores de
horas de funcionamiento de su CPU, consul‚Äê
te los Datos t√©cnicos.

MODE

Input

BYTE

I, Q, M, D, L o constan‚Äê ID de la petici√≥n:
te
‚óè 0: Leer (tras ello, el estado se registra en
CQ y el valor actual en CV). Si el contador
de horas de funcionamiento cuenta
durante m√°s de (2 elevado a 31) - 1
horas, se detiene en el √∫ltimo valor
representable y devuelve el mensaje de
error "Desbordamiento".
‚óè 1: Arrancar (con el √∫ltimo valor registrado)
‚óè 2: Parar
‚óè 4: Inicializar (al valor especificado en PV)
‚óè 5: Inicializar (al valor especificado en PV)
y arrancar
‚óè 6: Inicializar (al valor especificado en PV)
y parar

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5847

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

PV

Input

DINT

I, Q, M, D, L o constan‚Äê Nuevo valor para el contador de horas de
te
funcionamiento

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el valor de respuesta con‚Äê
tendr√° un c√≥digo de error.

CQ

Output

BOOL

I, Q, M, D, L

Estado del contador de horas de funciona‚Äê
miento (1: en marcha)

CV

Output

DINT

I, Q, M, D, L

Valor actual del contador de horas de funcio‚Äê
namiento

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Compatibilidad con programas desarrollados para una CPU con contadores de horas de
funcionamiento de 16 bits
Las instrucciones "SET_RTM (P√°gina 5849)", "CTRL_RTM (P√°gina 5849)" y "READ_RTM
(P√°gina 5850)" tambi√©n se pueden utilizar con los contadores de horas de funcionamiento de
32 bits. Sin embargo, en ese caso los contadores de horas de funcionamiento de 32 bits se
comportan como si fueran de 16 bits (rango de valores de 0 a 32767 horas).
En el extracto de lista parcial con la ID SZL-ID W#16#0132 y el √≠ndice W#16#0008 , los
contadores de horas de funcionamiento de 32 bits de 0 a 7 aparecen como contadores de
horas de funcionamiento de 16 bits. Esto permite seguir utilizando los programas que han sido
desarrollados para una CPU con contadores de horas de funcionamiento de 16 bits, y que usan
el extracto de lista parcial con la ID SZL-ID W#16#0132 y el √≠ndice W#16#0008 .

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

Ning√∫n error

8080

N√∫mero err√≥neo del contador de horas de funcionamiento

8081

Se ha transmitido un valor negativo al par√°metro PV.

8082

Desbordamiento del contador de horas de funcionamiento

8091

El par√°metro de entrada MODE contiene un valor no permitido.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

5848

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

SET_RTM: Inicializar contador de horas de funcionamiento
Descripci√≥n
Esta instrucci√≥n permite ajustar un contador de horas de funcionamiento de la CPU a un valor
predefinido. Se puede configurar un n√∫mero de contadores de horas de funcionamiento
espec√≠fico para la CPU.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SET_RTM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

NR

Input

BYTE

I, Q, M, D, L o constante La entrada NR contiene el n√∫mero del con‚Äê
tador de horas de funcionamiento que se
desea ajustar.
La numeraci√≥n empieza por "0".
Para conocer el n√∫mero de contadores de
horas de funcionamiento de su CPU, con‚Äê
sulte los Datos t√©cnicos.

PV

Input

INT

I, Q, M, D, L o constante La entrada PV contiene el ajuste para el
contador de horas de funcionamiento.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el valor de respuesta con‚Äê
tendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error
(W#16#...)

Explicaci√≥n

0000

Sin error

8080

N√∫mero err√≥neo del contador de horas de funcionamiento

8081

Se ha transmitido un valor negativo al par√°metro PV.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

CTRL_RTM: Arrancar/parar el contador de horas de funcionamiento
Descripci√≥n
Esta instrucci√≥n permite arrancar o parar un contador de horas de funcionamiento.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5849

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CTRL_RTM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

NR

Input

BYTE

I, Q, M, D, L o constante La entrada NR contiene el n√∫mero del
contador de horas de funcionamiento
que se desea arrancar o parar.
La numeraci√≥n empieza por "0".
Para conocer el n√∫mero de contadores
de horas de funcionamiento de su
CPU, consulte los Datos t√©cnicos.

S

Input

BOOL

I, Q, M, D, L

La entrada S arranca o para el contador
de horas de funcionamiento.
‚óè Para parar el contador de horas de
funcionamiento debe ajustarse el
estado l√≥gico a "0".
‚óè Para arrancar el contador de horas
de funcionamiento debe ajustarse
el estado l√≥gico a "1".

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la eje‚Äê
cuci√≥n de la instrucci√≥n, el valor de res‚Äê
puesta contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

Ning√∫n error

8080

N√∫mero err√≥neo del contador de horas de funcionamiento

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

READ_RTM: Leer contador de horas de funcionamiento
Descripci√≥n
Esta instrucci√≥n permite leer un contador de horas de funcionamiento. La instrucci√≥n devuelve
como datos de salida el n√∫mero actual de horas de funcionamiento y el estado del contador,
es decir, "parado" o "contando".
Si el contador de horas de funcionamiento trabaja durante m√°s de 32767 horas, se parar√° al
llegar a 32767 y enviar√° el aviso de error "Desbordamiento".

5850

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "READ_RTM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

NR

Input

BYTE

I, Q, M, D, L, P o cons‚Äê
tante

La entrada NR contiene el n√∫mero del
contador de horas de funcionamiento
que se desea arrancar o parar.
La numeraci√≥n empieza por "0".
Para conocer el n√∫mero de contadores
de horas de funcionamiento de su
CPU, consulte los Datos t√©cnicos.

RET_VAL

Return

INT

I, Q, M, D, L, P

Si se produce un error durante la eje‚Äê
cuci√≥n de la instrucci√≥n, el valor de res‚Äê
puesta contendr√° un c√≥digo de error.

CQ

Output

BOOL

I, Q, M, D, L

La salida CQ indica si el contador de
horas de funcionamiento est√° en mar‚Äê
cha o detenido. El estado l√≥gico "0" in‚Äê
dica que el contador de horas de fun‚Äê
cionamiento est√° parado. El estado l√≥‚Äê
gico "1" indica que el contador de horas
de funcionamiento est√° en marcha.

CV

Output

INT

I, Q, M, D, L, P

La salida CV indica el valor actual del
contador de horas de funcionamiento.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

Sin errores

8080

N√∫mero err√≥neo del contador de horas de funcionamiento

8081

Desbordamiento del contador de horas de funcionamiento

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Hora local
LOC_TIME: Calcular hora local
Descripci√≥n
Esta instrucci√≥n lee la hora y el estado de la hora de la CPU, y calcula a partir de ellos la hora
local. Solo funciona con CPU S7-400. Esta instrucci√≥n puede llamarse en OBs de cualquier
clase de prioridad.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5851

Instrucciones
4.2 Instrucciones

Funcionamiento
"LOC_TIME" utiliza internamente la instrucci√≥n "RDSYSST (P√°gina 6116)" para leer la hora
del m√≥dulo, el valor de correcci√≥n con signo y el identificador de horario de verano del estado
actual de la hora de la CPU. Si se produce un error de "RDSYSST (P√°gina 6116)", se finaliza
el bloque. Las indicaciones de error se env√≠an a RET_VAL .
El valor de correcci√≥n es el n√∫mero de medias horas entre la hora base y la hora local. Adem√°s
se identifica como horario de verano o de invierno.
Si la CPU no posee un estado de hora v√°lido, "LOC_TIME" se finaliza con un error.
Una vez le√≠do correctamente el estado de la hora, la diferencia horaria obtenida a partir del
valor de correcci√≥n se suma a la hora del m√≥dulo y se devuelve en la salida LT .
La salida SUMMER obtiene el valor del bit de horario de verano/invierno a partir del estado de
la hora.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "LOC_TIME":
Par√°metro

Declaraci√≥n

Tipo de datos

Descripci√≥n

RET_VAL

Return

INT

C√≥digo de error

LT

Output

DATE_AND_TIME

Hora local (Local Time)

SUMMER

Output

BOOL

Identificador de horario de verano
‚óè 0: Invierno
‚óè 1: Verano

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros RET_VAL, LT y SUMMER
La tabla siguiente muestra los valores de salida y los errores de "LOC_TIME":
RET_VAL

LT

SUMMER

Descripci√≥n

0

Hora local

TRUE/FALSE

Instrucci√≥n ejecutada sin errores

1

Hora local

TRUE/FALSE

Sin errores, pero con salto de fecha

8xyy

DT#90-01-01-0:0:0

FALSE

C√≥digos de error generales de "RDSYSST (P√°gi‚Äê
na 6116)"

8091

DT#90-01-01-0:0:0

FALSE

Estado de la hora no presente

BT_LT: Calcular hora local a partir de la hora patr√≥n
Descripci√≥n
Esta instrucci√≥n calcula la hora local a partir de una hora patr√≥n establecida en la entrada.
La hora patr√≥n introducida en la entrada BT se convierte a la hora local con ayuda de los datos
almacenados en un bloque de datos (DB) y se devuelve en la salida LT .

5852

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El bloque de datos (DB) contiene el n√∫mero de unidades de 30 minutos en las que se
diferencian la hora patr√≥n y la hora local, as√≠ como la diferencia entre el horario de verano y el
de invierno, igualmente en unidades de 30 minutos.
Si al efectuar el c√°lculo se produce un desbordamiento de fecha, esto se se√±aliza mediante un
valor de retorno especial.
La instrucci√≥n "BT_LT" puede llamarse en OBs de cualquier clase de prioridad.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "BT_LT":
Par√°metro

Declaraci√≥n

Tipo de datos

Descripci√≥n

BT

Input

DATE_AND_TIME

Hora patr√≥n

WS_DAT

Input

BLOCK_DB

Informaci√≥n sobre la zona horaria y sobre la alternancia
entre horario de verano y de invierno (DB de reglas);
En el par√°metro WS_DAT debe usarse un puntero a un
bloque de datos del tipo "WS_RULES (P√°gina 5867)".

RET_VAL

Return

INT

C√≥digo de error

LT

Output

DATE_AND_TIME

Hora local

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Nota
Los par√°metros del tipo de datos BLOCK_DB solo se pueden reenviar a llamadas FB y no a
llamadas FC.

Par√°metros RET_VAL y LT
La tabla siguiente muestra los valores de salida de "BT_LT":
RET_VAL

LT

Descripci√≥n

0

Hora local

Instrucci√≥n ejecutada sin errores

1

Hora local

Sin errores, pero con salto de fecha

8082

DT#90-01-01-0:0:0

Datos no v√°lidos en el bloque de datos de reglas

LT_BT: Calcular hora patr√≥n a partir de la hora local
Descripci√≥n
La instrucci√≥n calcula la hora patr√≥n a partir de la hora local establecida en la entrada.
La hora local introducida en la entrada LT se convierte a la hora patr√≥n con ayuda de los datos
almacenados en un bloque de datos (DB) y se devuelve en la salida BT.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5853

Instrucciones
4.2 Instrucciones
El bloque de datos (DB) contiene el n√∫mero de unidades de 30 minutos en las que se
diferencian la hora patr√≥n y la hora local, as√≠ como la diferencia entre el horario de verano y el
de invierno, igualmente en unidades de 30 minutos. Si al efectuar el c√°lculo se produce un
desbordamiento de fecha, esto se se√±aliza mediante un valor de retorno especial.
Peculiaridades del cambio entre horario de verano e invierno:
‚óè Al pasar del horario de invierno al de verano, se adelanta en una hora la hora local. Esto
significa que la hora situada entre ambos horarios no se contabiliza.
Para acceder a un instante LT situado dentro de esa hora omitida, la instrucci√≥n "LT_BT"
"piensa" en t√©rminos de horario de verano. Esto se notifica con el valor de devoluci√≥n 4 √≥
5.
‚óè Al pasar del horario de verano al de invierno, se atrasa en una hora la hora local. Esto
significa que hay una hora que se contabiliza dos veces ("doble hora"). (En CE(S)T se
utiliza en ese caso la denominaci√≥n 2A y 2B).
En consecuencia, no es posible ubicar de manera un√≠voca con referencia a la hora patr√≥n
un momento LT situado dentro de esa hora.
"LT_BT" recibe como par√°metro de entrada un LT y debe decidir, antes de la conversi√≥n a
BT, si el valor se encuentra dentro del verano o el invierno. Si LT se encuentra dentro de la
doble hora, LT se interpreta como horario de invierno. Esto se notifica con el valor de
devoluci√≥n 2 √≥ 3.
La instrucci√≥n "LT_BT" puede llamarse en OBs de cualquier clase de prioridad.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "LT_BT":
Par√°metro

Declaraci√≥n

Tipo de datos

Descripci√≥n

LT

Input

DATE_AND_TIME

Hora local

WS_DAT

Input

BLOCK_DB

Informaci√≥n sobre la zona horaria y sobre la alternancia entre
horario de verano y de invierno (DB de reglas);
En el par√°metro WS_DAT debe usarse un puntero a un bloque
de datos del tipo "WS_RULES (P√°gina 5867)".

RET_VAL

Return

INT

C√≥digo de error

BT

Output

DATE_AND_TIME

Hora patr√≥n

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Los par√°metros del tipo de datos BLOCK_DB solo se pueden reenviar a llamadas FB y no a
llamadas FC.

5854

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros RET_VAL y BT
La tabla siguiente muestra los valores de salida de "LT_BT":
RET_VAL

BT

Descripci√≥n

0

Hora patr√≥n

Instrucci√≥n ejecutada sin errores

1

Hora patr√≥n

Sin errores, pero con salto de fecha

2

Hora patr√≥n

La LT de la entrada se encuentra dentro de la "doble hora".

3

Hora patr√≥n

Como 2, y salto de fecha adicional

4

Hora patr√≥n

La LT de la entrada se encuentra dentro de la "hora prohibida".

5

Hora patr√≥n

Como 4, y salto de fecha adicional

8082

DT#90-01-01-0:0:0

Datos no v√°lidos en el bloque de datos de reglas

S_LTINT: Alarma horaria hora local
Descripci√≥n
Esta instrucci√≥n ajusta la alarma horaria deseada en el momento especificado. Dicho
momento se especifica en hora local.
La hora local introducida en la entrada LT se convierte a la hora patr√≥n con ayuda de la regla
almacenada en un bloque de datos (DB).
El bloque de datos (DB) contiene el n√∫mero de unidades de 30 minutos en las que se
diferencian la hora patr√≥n y la hora local, as√≠ como la diferencia entre el horario de verano y el
de invierno, igualmente en unidades de 30 minutos. Con la hora patr√≥n calculada se
parametriza y activa el OB de alarma horaria. Si al efectuar el c√°lculo se produce un
desbordamiento de fecha, esto se se√±aliza mediante un valor de retorno especial.
Peculiaridades del cambio entre horario de verano e invierno:
‚óè Al pasar del horario de invierno al de verano, se adelanta en una hora la hora local. Esto
significa que la hora situada entre ambos horarios no se contabiliza.
Para acceder a un instante LT dentro de esa hora omitida, la instrucci√≥n "S_LTINT" calcula
en t√©rminos de horario de verano. Esto se notifica con el valor de devoluci√≥n (RET_VAL) 4
√≥ 5.
‚óè Al pasar del horario de verano al de invierno, se atrasa en una hora la hora local. Esto
significa que hay una hora que se contabiliza dos veces ("doble hora"). (En CE(S)T se
utiliza en ese caso la denominaci√≥n 2A y 2B).
En consecuencia, no es posible ubicar de manera un√≠voca con referencia a la hora patr√≥n
un momento LT situado dentro de esa hora. "S_LTINT" recibe como par√°metro de entrada
un LT y debe decidir, antes de la conversi√≥n a BT, si el valor se encuentra dentro del verano
o el invierno. Si LT se encuentra dentro de la doble hora, LT se interpreta como horario de
invierno. Esto se notifica con el valor de devoluci√≥n (RET_VAL) 2 √≥ 3.
La instrucci√≥n "S_LTINT" puede llamarse en OBs de cualquier clase de prioridad.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5855

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "S_LTINT":
Par√°metro

Declaraci√≥n

Tipo de datos

Descripci√≥n

OB_NR

Input

INT

N√∫mero del OB que se debe iniciar (adm. 10 ‚Äì 17)

SDT

Input

DATE_AND_TIME

Hora de inicio y hora en horario local

PERIOD

Input

WORD

Per√≠odo transcurrido desde el punto de salida SDT:

Consulte tambi√©n: "SET_TINT (P√°gina 6040)"
‚óè W#16#0000 = Una vez
‚óè W#16#0201 = Una vez por minuto
‚óè W#16#0401 = Una vez por hora
‚óè W#16#1001 = Una vez al d√≠a
‚óè W#16#1201 = Una vez por semana
‚óè W#16#1401 = Una vez al mes
‚óè W#16#1801 = Una vez al a√±o
‚óè W#16#2001 = A final de mes
WS_DAT

Input

BLOCK_DB

Informaci√≥n sobre la zona horaria y sobre la alternancia entre
horario de verano y de invierno (DB de reglas);
En el par√°metro WS_DAT debe usarse un puntero a un bloque
de datos del tipo "WS_RULES (P√°gina 5867)".

RET_VAL

Return

INT

C√≥digo de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Los par√°metros del tipo de datos BLOCK_DB solo se pueden reenviar a llamadas FB y no a
llamadas FC.

Par√°metro RET_VAL

5856

RET_VAL

Descripci√≥n

0

Instrucci√≥n ejecutada sin errores

1

Sin errores, pero con salto de fecha

2

La LT de la entrada se encontraba dentro de la "doble hora".

3

Como 2, y salto de fecha adicional

4

La LT de la entrada se encuentra dentro de la "hora prohibida".

5

Como 4, y salto de fecha adicional

8082

Datos no v√°lidos en el bloque de datos de reglas

8090

Par√°metro err√≥neo OB_NR

8091

Par√°metro err√≥neo SDT

8092

Par√°metro err√≥neo PERIOD

80A1

El momento inicial ajustado se encuentra en el pasado.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
RET_VAL

Descripci√≥n

80A2

El OB no est√° cargado

80A3

El OB no se puede iniciar

SET_SW: Ajustar horario de invierno/verano sin estado de reloj
Descripci√≥n
Esta instrucci√≥n permite alternar entre el horario de verano y el de invierno en las CPUs que
no disponen de estado de la hora. Para este fin, la instrucci√≥n "SET_SW" modifica el ajuste de
la hora de la CPU de acuerdo con el momento actual y las reglas de alternancia fijadas en el
DB de reglas.
"SET_SW" se llama en el bloque de organizaci√≥n OB1 y en un OB de alarma horaria una sola
vez con la misma instancia. En el OB de alarma horaria no se interconectan los par√°metros de
la instrucci√≥n "SET_SW". En la entrada WS_DAT se especifica el bloque de datos (DB) que
contiene las reglas para el inicio y el fin del horario de verano.
La figura siguiente muestra el cronograma en el que se basa el funcionamiento de "SET_SW":
$¬≥RDQWHULRU!

$¬≥RDFWXDO

6

6[

:[

K!





,19,(512

12

!$¬≥RVLJXLHQWH

:

K!





9(5$12

6¬è

12



,19,(512

6¬è

12

6HJPHQWRGH
WLHPSR
7HPSRUL]DGRU
$YLVR

Se definen cuatro tiempos de cambio (VP, V, IP, I). Su posici√≥n exacta se deriva de las reglas
almacenadas en el DB de reglas. Las horas de aviso se√±alizan el cambio de horario una hora
antes de que se produzca.
Con flanco positivo en la entrada REQ se inicializa y activa el cambio de horario de verano/
invierno. La alternancia definida mantiene su validez mientras se cumpla REQ = 1.
Para el cambio de horario, "SET_SW" parametriza y activa el OB de alarma horaria indicado
con el momento de cambio m√°s cercano en el modo "√∫nico". Tras ello, este OB de alarma
horaria asume el control. Cuando llega el momento, modifica la hora de la CPU conforme al
momento de ejecuci√≥n actual y se parametriza/activa de nuevo a s√≠ mismo usando en cada
caso el pr√≥ximo momento de cambio.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5857

Instrucciones
4.2 Instrucciones
Si la hora actual se encuentra en el apartado (3), el OB de alarma horaria se parametriza con
la hora de inicio IP (aviso de horario de invierno).
Con flanco negativo en la entrada REQ se desactiva el cambio de horario de verano/invierno.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SET_SW":
Par√°metros

Declaraci√≥n

Tipo de datos

Descripci√≥n

REQ

Input

BOOL

Control del cambio

WS_DAT

Input

BLOCK_DB

Informaci√≥n sobre la zona horaria y sobre la alternancia entre hora‚Äê
rio de verano y de invierno (DB de reglas);
En el par√°metro WS_DAT debe usarse un puntero a un bloque de
datos del tipo "WS_RULES (P√°gina 5867)".

OB_NR

Input

INT

N√∫mero de la alarma horaria que se debe utilizar

STATUS

Output

INT

C√≥digo de error

ISSUMMER

Output

BOOL

1 = Horario de verano

ANN_1

Output

BOOL

1 = Aviso de cambio

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Los par√°metros del tipo de datos BLOCK_DB solo se pueden reenviar a llamadas FB y no a
llamadas FC.

Par√°metro STATUS
STATUS

Significado

0

Ning√∫n error

8xyy

C√≥digos de error generales de "RDSYSST (P√°gina 6116)"

8082

Datos no v√°lidos en WS_DAT

8083

El n√∫mero de mes para el cambio al horario de invierno es mayor que el n√∫mero de mes para el cambio
al horario de verano, y la hora de aviso de invierno es anterior al verano, o
el n√∫mero de mes para el cambio al horario de invierno es menor que el n√∫mero de mes para el cambio
al horario de verano, y la hora de aviso de verano es anterior al invierno.

8090

OB_NR no admisible. (Solo se admiten las alarmas horarias: OB10 ‚Äì OB17, seg√∫n cada CPU)

80A2

OB_NR no admisible: El OB no est√° cargado en la CPU

80A3

No se puede iniciar el OB. Consulte tambi√©n: "QRY_TINT (P√°gina 6043)"

Campo de aplicaci√≥n
"SET_SW" puede usarse en las CPUs que no disponen de estado de la hora. Las CPUs con
estado de la hora utilizan "SET_SW_S (P√°gina 5859)".

5858

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

OBs invocantes
"SET_SW" debe llamarse con la misma instancia en los siguientes bloques de organizaci√≥n
(OBs):
‚óè OB1 (programa c√≠clico):
"SET_SW" eval√∫a la entrada REQ. Con flanco ascendente en REQ ajusta el momento
inicial de la alarma horaria indicada, en funci√≥n del momento actual, a la m√°s cercana de
las 4 horas de cambio posibles, y activa la alarma horaria con el identificador '√∫nico'. La
alarma horaria se dispara cuando se alcanza dicho momento.
‚óè OB1x (alarma horaria):
El OB1x se ha activado al alcanzarse un momento de cambio de hora. "SET_SW" ajusta la
hora de la CPU en funci√≥n de la hora actual (horario de verano), se parametriza al pr√≥ximo
momento de cambio de hora y lo activa. En el apartado (5) se ajusta al aviso de horario de
verano (SA) del a√±o siguiente.
"SET_SW" no debe instanciarse varias veces.
Las siguientes instrucciones permiten consultar, parametrizar, activar y borrar la alarma
horaria: "QRY_TINT (P√°gina 6043)", "SET_TINT (P√°gina 6040)", "ACT_TINT (P√°gina 6042)",
"CAN_TINT (P√°gina 6041)"

Nota
El cambio de hora de la CPU sin medidas adicionales, p. ej. a trav√©s de la programadora, con
"SET_SW" (REQ = 1) activo, solo se autoriza si la nueva hora ajustada no est√° situada m√°s all√°
de uno de los momentos de cambio de hora.
Si al ajustar el reloj se salta uno de los momentos de cambio de hora, antes del ajuste debe
desactivarse la alternancia entre horario de verano e invierno con REQ = 0 y, una vez realizada
la modificaci√≥n, volver a activarse con REQ = 1.
Por supuesto, al ajustar el reloj de la CPU en verano debe tenerse en cuenta tambi√©n la hora
del horario de verano.

SET_SW_S: Ajustar horario de verano/invierno sin estado de reloj
Descripci√≥n
Esta instrucci√≥n permite alternar entre el horario de verano y el de invierno en las CPUs que
disponen de estado de la hora. Para este fin, la instrucci√≥n "SET_SW_S" modifica el estado de
la hora de acuerdo con el momento actual y las reglas de alternancia fijadas en el DB de reglas.
"SET_SW_S" se llama en el OB1 y en un OB de alarma horaria una sola vez con la misma
instancia. En el OB de alarma horaria no se interconectan los par√°metros de la instrucci√≥n
"SET_SW_S". En la entrada WS_DAT se especifica el bloque de datos (DB) que contiene las
reglas para el inicio y el fin del horario de verano.
La figura siguiente muestra el cronograma en el que se basa el funcionamiento de
"SET_SW_S":

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5859

Instrucciones
4.2 Instrucciones

$¬≥RDQWHULRU!

$¬≥RDFWXDO

6

6[

!$¬≥RVLJXLHQWH

:[

K!





,19,(512

12

:

K!





9(5$12

6¬è

12



,19,(512

6¬è

12

6HJPHQWRGH
WLHPSR
7HPSRUL]DGRU
$YLVR

Se definen cuatro tiempos de cambio (VP, V, IP, I). Su posici√≥n exacta se deriva de las reglas
almacenadas en el DB de reglas. Las horas de aviso se√±alizan el cambio de horario 1 hora
antes de que se produzca
Con flanco positivo en la entrada REQ se inicializa y activa el cambio de horario de verano/
invierno. La alternancia definida mantiene su validez mientras se cumpla REQ = 1.
Para el cambio de horario, "SET_SW_S" parametriza y activa el OB de alarma horaria indicado
con el momento de cambio m√°s cercano en el modo "√∫nico". Tras ello, este OB de alarma
horaria asume el control. Cuando llega el momento, modifica la hora de la CPU conforme al
momento de ejecuci√≥n actual y se parametriza/activa de nuevo a s√≠ mismo usando en cada
caso el pr√≥ximo momento de cambio.
Ejemplo: Si la hora actual se encuentra en el rango (3), el OB de alarma horaria se parametriza
con la hora de inicio WA (aviso de horario de invierno).
Con flanco negativo en la entrada REQ se desactiva el cambio de horario de verano/invierno.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SET_SW_S":
Par√°metro

Declaraci√≥n

Tipo de datos

Descripci√≥n

REQ

Input

BOOL

Control del cambio

WS_DAT

Input

BLOCK_DB

Informaci√≥n sobre la zona horaria y sobre la alternancia entre
horario de verano y de invierno (DB de reglas);
En el par√°metro WS_DAT debe usarse un puntero a un bloque de
datos del tipo "WS_RULES (P√°gina 5867)".

OB_NR

Input

INT

N√∫mero de la alarma horaria que se debe utilizar

STATUS

Output

INT

C√≥digo de error

ISSUMMER

Output

BOOL

Es verano

ANN_1

Output

BOOL

Aviso de cambio

5860

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Los par√°metros del tipo de datos BLOCK_DB solo se pueden reenviar a llamadas FB y no a
llamadas FC.

Par√°metro STATUS
STATUS

Significado

0

Ning√∫n error

8xyy

C√≥digos de error generales de "RDSYSST (P√°gina 6116)"

8082

Datos no v√°lidos en WS_DAT

8083

El n√∫mero de mes para el cambio al horario de invierno es mayor que el n√∫mero de mes para el cambio
al horario de verano, y la hora de aviso de invierno es anterior al verano, o
el n√∫mero de mes para el cambio al horario de invierno es menor que el n√∫mero de mes para el cambio
al horario de verano, y la hora de aviso de verano es anterior al invierno.

8090

OB_NR no admisible. (Solo se admiten las alarmas horarias: OB10 ‚Äì OB17, seg√∫n cada CPU)

8091

Estado de la hora no v√°lido ("status_valid" en el estado de la hora ten√≠a el valor FALSE)

80A2

OB_NR no admisible: El OB no est√° cargado en la CPU

80A3

No se puede iniciar el OB. (ver "QRY_TINT (P√°gina 6043)")

Campo de aplicaci√≥n
"SET_SW_S" puede usarse en las CPUs que disponen de estado de la hora.

OBs invocantes
"SET_SW_S" debe llamarse con la misma instancia en los siguientes bloques de organizaci√≥n
(OBs):
‚óè OB1 (programa c√≠clico):
"SET_SW_S" eval√∫a la entrada REQ. Con flanco ascendente en REQ ajusta el momento
inicial de la alarma horaria indicada, en funci√≥n del momento actual, a la m√°s cercana de
las 4 horas de cambio posibles, y activa la alarma horaria con el identificador '√∫nico'. As√≠, la
alarma horaria se dispara cuando se alcanza dicho momento.
‚óè OB1x (alarma horaria):
El OB1x se ha activado al alcanzarse un momento de cambio de hora. "SET_SW_S" ajusta
la hora y el estado de hora de la CPU en funci√≥n de la hora actual, se parametriza al pr√≥ximo
momento de cambio de hora y lo activa. En el rango (5) se ajusta al aviso de horario de
verano del a√±o siguiente.
"SET_SW_S" no debe instanciarse varias veces.
Las siguientes instrucciones permiten consultar, parametrizar, activar y borrar la alarma
horaria: "QRY_TINT (P√°gina 6043)", "SET_TINT (P√°gina 6040)", "ACT_TINT (P√°gina 6042)",
"CAN_TINT (P√°gina 6041)"

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5861

Instrucciones
4.2 Instrucciones

Nota
El cambio de hora de la CPU sin medidas adicionales, p. ej. a trav√©s de la programadora, con
"SET_SW_S" (REQ = 1) activo, solo se autoriza si la nueva hora ajustada no est√° situada m√°s
all√° de uno de los momentos de cambio de hora.
Si al ajustar el reloj se salta uno de los momentos de cambio de hora, antes del ajuste debe
desactivarse la alternancia entre horario de verano e invierno con REQ = 0 y, una vez realizada
la modificaci√≥n, volver a activarse con REQ = 1 .
Al ajustar el reloj de la CPU y el estado de la hora es necesario activar el identificador de horario
de verano o el identificador de hora de aviso, dependiendo de si se desea ajustar el horario de
verano o el horario de invierno.

TIMESTMP: Transferir avisos con sello de tiempo
Descripci√≥n
Esta instrucci√≥n transfiere avisos con sello de tiempo de un IM153-2 a su DB de instancia. √âste
suministra los datos para el posterior procesamiento a cargo del programa de usuario.
‚óè IM153-2
IM153-2 detecta los cambios de las se√±ales binarias, les asigna un sello de tiempo y guarda
esta informaci√≥n en registros con un m√°ximo de 20 avisos. En el caso de determinados
eventos, emite avisos especiales. Cuando un registro est√° listo para ser recogido, IM153-2
dispara una alarma de proceso.
‚óè Llamada en el OB de alarma de proceso
"TIMESTMP" lee la informaci√≥n de arranque del OB de alarma de proceso y guarda la
informaci√≥n relativa al sello de tiempo para su posterior procesamiento en un b√∫fer circular.
"TIMESTMP" puede almacenar los datos de 17 alarmas de proceso como m√°ximo.
‚óè Llamada en el OB c√≠clico:
En el procesamiento c√≠clico, "TIMESTMP" lee el registro que se debe recoger con ayuda de
la instrucci√≥n "RD_REC (P√°gina 5922)" (Leer registro) y lo guarda en el b√∫fer de avisos
MESSAGE. Si deben recogerse varios registros, se lee primero el m√°s antiguo. Si el bit
TIMECONV est√° activado en la entrada, "TIMESTMP" convierte todos los sellos de tiempo
del formato ISP al formato DATE_AND_TIME (DT).
Si el par√°metro BUFRDY = TRUE est√° activado, el programa de usuario puede continuar
procesando los avisos del b√∫fer de avisos y transferirlos p. ej. a un receptor (equipo de
manejo y visualizaci√≥n, impresora). El n√∫mero de mensajes existentes se visualiza en el
par√°metro MSG_QTY. Despu√©s del procesamiento, el programa de usuario debe
desactivar el par√°metro BUFRDY con objeto de liberar el b√∫fer de avisos para otros avisos.
El par√°metro BUFNOTREAD muestra el n√∫mero de alarmas de proceso recibidas para las
que "TIMESTMP" no ha le√≠do a√∫n registros del IM153-2 . Con BUFNOTREAD = 15 , todos
los registros del IM153-2 est√°n llenos. Entonces el IM153-2 no detecta otros cambios de
se√±al. Cualquier otro registro que se genere en caso de un cambio de se√±al binaria por el
IM 153-2 se pierde. El par√°metro MSGLOST (p√©rdida de avisos) se pone a "1".

5862

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "TIMESTMP":
Par√°metros

Declaraci√≥n

Tipo de datos

Descripci√≥n

LADDR

Input

INT

Direcci√≥n l√≥gica (direcci√≥n de diagn√≥stico) del IM153-2

LADDR2

Input

INT

Direcci√≥n l√≥gica (direcci√≥n de diagn√≥stico) del slot 2 del
IM153-2

TIMECONV

Input

BOOL

1=convertir el sello de tiempo ISP al formato S7-DT

MSG_QTY

Output

INT

N√∫mero de avisos v√°lidos en el b√∫fer de avisos

BUFNOTREAD

Output

INT

N√∫mero de registros del IM153-2con alarmas pero no le√≠‚Äê
dos todav√≠a

READERR

Output

BOOL

1=Error al leer el IM153-2

READSTATUS

Output

INT

Valor de retorno de la instrucci√≥n "RD_REC (P√°gina 5922)"

BUFRDY

InOut

BOOL

1=B√∫fer de avisos listo

MSGLOST

InOut

BOOL

1=Avisos perdidos

MESSAGE

Static

ARRAY[1..20] OF
STRUCT

B√∫fer de avisos para un m√°ximo de 20 avisos del IM153-2

SLOT_NO

./.

BYTE

N√∫mero de slot/2=Aviso especial

CH_NO

./.

BYTE

N√∫mero de canal/ID del aviso especial

SIGNAL

./.

BYTE

Estado l√≥gico/caracter√≠stica del aviso especial

TIME1

./.

DWORD

Segundos a partir de 1900,0 (ISP)/a√±o, mes, d√≠a, hora (DT)

TIME2

./.

DWORD

Fracciones de segundo (ISP)/minuto, segundo, milisegun‚Äê
do, d√≠a de la semana (DT)

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5863

Instrucciones
4.2 Instrucciones

Configuraci√≥n hardware
La instrucci√≥n "TIMESTMP" puede utilizarse solo en configuraciones que soporten la
transmisi√≥n de la hora y el sellado de tiempo de se√±ales binarias. A saber:
‚óè CPUs
‚Äì CPU 4xx con CP443-5 para la transmisi√≥n de telegramas horarios (a partir de
6GK7443-5DX02-0XE0), o
‚Äì CPU 4xx con transmisi√≥n de telegramas horarios (p. ej. CPU416-2 DP a partir de la
versi√≥n de firmware 3.0)
‚óè Periferia descentralizada
‚Äì M√≥dulo de interfaz IM153-2 apto para redundancia con sellado de tiempo (a partir de
6ES7153-2AA02 versi√≥n de firmware V1.2.3 (versi√≥n 10))
O bien:
IM153-2 FO apto para redundancia con interfaz FO integrada (a partir de
6ES7153-2AB01 a partir de la versi√≥n de firmware V1.2.3 (versi√≥n 9))
‚Äì Entrada digital SM321 (6ES7321-7BH00-0AB0) con aislamiento galv√°nico 16 DI, 24 V
DC, alarma de proceso, diagn√≥stico
O bien:
Entrada digital SM321 (6ES7321-7TH00-0AB0) con aislamiento galv√°nico 16 DI, 24 V
DC, NAMUR, con funciones de control de procesos
El sello de tiempo s√≥lo se debe utilizar para se√±ales binarias seleccionadas e
importantes para la aplicaci√≥n. Debido a la carga del PROFIBUS-DP y del IM153-2, se
recomienda repartir estas se√±ales, en caso necesario, entre varios IM153-2 o entre
varias estaciones.

5864

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Configuraci√≥n de software
‚óè OBs invocantes
"TIMESTMP" debe llamarse con la misma instancia en los siguientes bloques de
organizaci√≥n (OBs), teniendo en cuenta que solo es posible transferir y recibir valores de
los par√°metros en el programa c√≠clico:
‚Äì OB1 (programa c√≠clico) o, como alternativa, un OB de alarma c√≠clica (OB30 a OB38)
‚Äì OB86 (fallo del rack)
‚Äì OB100 (arranque)
Si se utilizan otros OBs de arranque (OB 101, OB 102), "TIMESTMP" debe llamarse
tambi√©n en ellos.
‚Äì OB40 o, si es posible seleccionarlo en la configuraci√≥n de hardware, tambi√©n otro OB de
alarma de proceso (OB41 a OB47)
‚óè Direccionamiento
‚Äì Utilice para cada IM153-2 una instancia independiente de "TIMESTMP". Introduzca en
la entrada LADDR la direcci√≥n l√≥gica ajustada en la configuraci√≥n hardware (direcci√≥n
de diagn√≥stico) del IM153-2.
‚Äì Si el maestro DP se utiliza en el modo de operaci√≥n "Compatible con S7", introduzca en
la entrada LADDR2 el mismo valor que para LADDR. Si se utiliza el modo de operaci√≥n
"DPV1", introduzca en LADDR2 la direcci√≥n de diagn√≥stico del slot 2 del IM153-2.
‚Äì Si las direcciones se modifican durante el funcionamiento, "TIMESTMP" borra los datos
de alarma de proceso almacenados hasta entonces.

Tratamiento de errores
Si al leer un registro "TIMESTMP" ha detectado errores no eliminables, "TIMESTMP" ajusta el
par√°metro READERR a TRUE. Para el an√°lisis posterior se dispone del valor de retorno de la
instrucci√≥n WR_USMSG en el par√°metro READSTATUS . Dado que "TIMESTMP" lee tambi√©n
otro registro en el ciclo siguiente, READERR y READSTATUS solo son v√°lidos para un ciclo.
Por ello debe incluirse en el programa de usuario la correspondiente evaluaci√≥n.
Si se leen registros mientras el maestro DP est√° fuera de servicio, "TIMESTMP" emite el aviso
READERR = TRUE y READSTATUS =80B2h ("El slot configurado no est√° ocupado.")

Comportamiento de arranque IM153-2
En el arranque/rearranque/arranque en fr√≠o, IM153-2 vuelve a emitir las alarmas de proceso
para los registros que antes del arranque estaban ocupados pero todav√≠a no se han recogido.
IM153-2 registra los siguientes avisos en el primer registro libre:
‚óè Aviso especial "Inicio datos de arranque"
‚óè Cambios de se√±al ocurridos inmediatamente antes de un STOP de la CPU ("entrante" o
"saliente" seg√∫n el flanco parametrizado)
‚óè Estado l√≥gico actual de las se√±ales binarias que deben obtener un sello de tiempo
("entrante" o "saliente" seg√∫n el flanco parametrizado)
‚óè Aviso especial "Fin datos de arranque"

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5865

Instrucciones
4.2 Instrucciones

Comportamiento de arranque de TIMESTMP
Si "TIMESTMP" se llama en un OB de arranque (OB100, OB101, OB102), "TIMESTMP" borra
todos los datos de alarmas de proceso almacenados y restablece BUFRDY . Si se detectan
registros con alarmas pero todav√≠a no le√≠dos, "TIMESTMP" ajusta MSGLOST (p√©rdida de
aviso) a TRUE. El programa de usuario debe volver a restablecer MSGLOST .

Comportamiento de "TIMESTMP" en el OB86 (fallo de m√≥dulo)
Si se llama "TIMESTMP" en el OB86 y el evento procede del correspondiente IM153-2,
"TIMESTMP" reacciona igual que en el arranque. Esto es lo que sucede p. ej. en caso de fallo
y recuperaci√≥n del IM153-2 y recuperaci√≥n del maestro DP.

Redundancia
En los sistemas H con dos IM153-2, existe redundancia en cuanto al sellado de tiempo en los
siguientes casos:
‚óè La comunicaci√≥n entre los dos IM153-2 se efect√∫a mediante bus K.
‚óè La sincronizaci√≥n de los IM153-2 activos y pasivos ha finalizado correctamente.
Durante una conmutaci√≥n entre IM153-2 activos y pasivos, se ha interrumpido el sellado de
tiempo. Con el aviso especial "Conmutaci√≥n con redundancia inicio/fin" se muestra el per√≠odo
de interrupci√≥n.
Normalmente, el IM153-2 activo notifica al pasivo el estado actual de la periferia. Si esta
comunicaci√≥n no funciona, se emite el aviso especial "P√©rdida de informaci√≥n de redundancia
entrante". En cuanto se puede recuperar la comunicaci√≥n entre los IM153-2 activo y pasivo, se
emite el aviso especial "P√©rdida de informaci√≥n de redundancia saliente". No es posible
compensar a posteriori la p√©rdida, es decir: al pasar el IM153-2 al estado de fallo, se produce
una p√©rdida de aviso.

Estructura del b√∫fer de avisos
El b√∫fer de avisos contiene un registro del IM153-2. La interpretaci√≥n del sello de tiempo
depende del ajuste del par√°metro TIMECONV .

Formatos de tiempo de "TIMESTMP"
Si la entrada es TIMECONV = TRUE , todos los sellos de tiempo se guardan en el tipo de datos
DATE_AND_TIME (formato BCD):
La tabla siguiente muestra el formato del tipo de datos DATE_AND_TIME:
Bytes

Contenido

√Årea

0

A√±o

90 ‚Ä¶ 89

1

Mes

01 ... 12

Corresponde a 1990 ... 2089

5866

2

D√≠a

01 ... 31

3

Hora

00 ... 23

4

Minuto

00 ... 59

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Bytes

Contenido

√Årea

5

Segundo

00 ... 59

6

2 MSD (most significant decade) de ms

00 ... 99

7 (4 MSB)

LSD (least significant decade) de ms

0 ... 9

7 (4 LSB)

D√≠a de la semana

1 ... 7 (1 = domingo)

Si la entrada es TIMECONV = FALSE , todos los sellos de tiempo se guardan en el formato ISP
(2 palabras dobles):
La tabla siguiente muestra la distribuci√≥n de los bytes:
Bytes

Contenido

√Årea

0‚Ä¶3

Segundos a partir de 1.1.1900 0:00:00,000 h

Corresponde a
1.1.1900 ... 6.2.2036

4‚Ä¶7

Fracciones de segundo en m√∫ltiplos de 1/232 s

0 ‚Ä¶ <1

La conversi√≥n horaria es v√°lida dentro del rango de fechas comunes a los formatos horarios,
es decir, desde el 1-1-1990 hasta el 6-2-2036 (inclusive).

WS_RULES: DB de regla para convertir la hora base en hora local
Bloque de datos del tipo "WS_RULES"
Un bloque de datos del tipo "WS_RULES" tiene la siguiente estructura:
Nombre

Tipo de datos

Valor inicial

Descripci√≥n

// Conversi√≥n hora base<->Hora local y "Ajustar alarma seg√∫n hora local"
B2L

Struct
S

INT

2

// Diferencia hora base->hora local [30 m] en invierno, admisible -24 ...
+24.

T

INT

2

// Diferencia horario invierno y verano [30 m], admisible: 2

// Regla para: Horario invierno -> Horario verano. Valor predeterminado: √öltimo domingo de marzo, 2:00 h
W2S

Struct

// en HORARIO INVIERNO

M

BYTE

B#16#3

// Mes del cambio

W

BYTE

B#16#9

// n aparici√≥n del d√≠a de la semana (1=primera, 2=segunda,..,9=√∫ltima)

D

BYTE

B#16#1

// D√≠a de la semana (domingo = 1)

H

BYTE

B#16#2

// Hora

// Regla para: Horario verano -> Horario invierno. Valor predeterminado: √öltimo domingo de octubre, 3:00 h
S2W

// en HORARIO VERANO
M

BYTE

B#16#10

// Mes del cambio

W

BYTE

B#16#9

// n aparici√≥n del d√≠a de la semana (9 = √∫ltima)

D

BYTE

B#16#1

// D√≠a de la semana (domingo = 1)

H

BYTE

B#16#3

// Hora

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5867

Instrucciones
4.2 Instrucciones

Nota
Crear bloque de datos del tipo "WS_RULES"
Un bloque de datos del tipo "WS_RULES" se crea seleccionando como tipo "WS_RULES" al
crear un DB nuevo.
Nota
Todos los par√°metros que tienen el formato BYTE se interpretan como valores BCD (decimal
en c√≥digo binario). Para el horario de invierno debe indicarse W2S y para el de verano S2W.
En la UE est√° prescrita desde el a√±o 2002 la fijaci√≥n de los momentos de cambio entre horario
de verano e invierno mediante una regla.

4.2.3.2

String + Char

S_COMP: Comparar cadenas de caracteres
Descripci√≥n
Esta instrucci√≥n compara los contenidos de dos variables en el formato STRING y devuelve el
resultado de la comparaci√≥n como valor de retorno. Las variables que se deben comparar se
interconectan en las entradas IN1 y IN2 . A los par√°metros de entrada solo pueden
asign√°rseles variables definidas como simb√≥licas.
Seleccione la condici√≥n de comparaci√≥n mediante el cuadro de instrucci√≥n. Si se cumple la
condici√≥n de comparaci√≥n (p. ej. mayor o igual), el estado l√≥gico del par√°metro de salida OUT
se ajusta a "1".
Pueden usarse las siguientes condiciones de comparaci√≥n:
S√≠mbolo

Descripci√≥n

EQ

El valor de retorno tiene el estado l√≥gico "1" si la cadena de caracteres del par√°metro IN1 es igual que la del
par√°metro IN2 .

NE

El valor de retorno tiene el estado l√≥gico "1" si la cadena de caracteres del par√°metro IN1 es distinta a la del
par√°metro IN2 .

GT (1)

El valor de retorno tiene el estado l√≥gico "1" si la cadena de caracteres del par√°metro IN1 es mayor que la del
par√°metro IN2 .

LT (1)

El valor de retorno tiene el estado l√≥gico "1" si la cadena de caracteres del par√°metro IN1 es menor que la del
par√°metro IN2 .

GE (1)

El valor de retorno tiene el estado l√≥gico "1" si la cadena de caracteres del par√°metro IN1 es mayor o igual que
la del par√°metro IN2 .

LE (1)

El valor de retorno tiene el estado l√≥gico "1" si la cadena de caracteres del par√°metro IN1 es menor o igual que
la del par√°metro IN2 .

Los caracteres se comparan empezando por la izquierda seg√∫n su codificaci√≥n ASCII (p. ej. 'a' es mayor que 'A'). El primer
car√°cter diferente es el decisivo para el resultado de la comparaci√≥n. Si la parte izquierda de la cadena de caracteres m√°s
larga es id√©ntica a la cadena de caracteres m√°s corta, la cadena de caracteres m√°s larga se considera mayor.
(1)

5868

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "S_COMP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

STRING*

D, L

Variable de entrada en el formato
STRING

IN2

Input

STRING*

D, L

Variable de entrada en el formato
STRING

OUT

Output

BOOL

I, Q, M, D, L

Resultado de la comparaci√≥n

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

S_CONV: Convertir cadena de caracteres
Descripci√≥n
Esta instrucci√≥n permite convertir el valor de la entrada IN al formato de datos indicado en la
salida OUT. Mediante esta instrucci√≥n se convierten cadenas de caracteres en n√∫meros
enteros o en coma flotante, as√≠ como n√∫meros enteros o en coma flotante en cadenas de
caracteres.
Nota
Conversiones expl√≠citas en SCL
Encontrar√° m√°s informaci√≥n y particularidades espec√≠ficas de SCL para las conversiones
expl√≠citas aqu√≠:
‚óè Conversiones expl√≠citas (P√°gina 590)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5869

Instrucciones
4.2 Instrucciones

Convertir una cadena de caracteres en n√∫meros enteros o en coma flotante
Son posibles las siguientes conversiones de cadena de caracteres en n√∫meros enteros o en
coma flotante:
‚óè Convertir una cadena de caracteres en una variable en el formato INT. El primer car√°cter
de la cadena de caracteres puede ser un signo o una cifra, mientras que el resto deben ser
necesariamente cifras. Si la longitud de la cadena de caracteres es igual a cero o mayor que
6, o la cadena contiene caracteres no autorizados, la conversi√≥n no se realiza y el bit BR se
ajusta a "0". Si el resultado de la conversi√≥n se encuentra fuera del rango num√©rico INT, se
limita el resultado al valor correspondiente y el resultado binario BR se ajusta a "0".
‚óè Convertir una cadena de caracteres en una variable en el formato DINT. El primer car√°cter
de la cadena de caracteres puede ser un signo o una cifra, mientras que el resto deben ser
necesariamente cifras. Si la longitud de la cadena de caracteres es igual a cero o mayor que
11, o la cadena contiene caracteres no autorizados, la conversi√≥n no se realiza y el bit BR
se ajusta a "0". Si el resultado de la conversi√≥n se encuentra fuera del rango num√©rico
DINT, se limita el resultado al valor correspondiente y el resultado binario BR se ajusta a "0".
‚óè Convertir una cadena de caracteres en una variable en el formato REAL. La cadena de
caracteres debe tener el siguiente formato: ¬±v.nnnnnnnE¬±xx
‚Äì ¬± = signo
‚Äì v = 1 posici√≥n antes de la coma
‚Äì n = 7 posiciones despu√©s de la coma
‚Äì x = 2 posiciones de exponente
Si la longitud de la cadena de caracteres es menor que 14, o la cadena de caracteres tiene
un formato distinto al indicado arriba, la conversi√≥n no se realiza y el bit BR se ajusta a "0".
Si el resultado de la conversi√≥n se encuentra fuera del rango num√©rico REAL, se limita el
resultado al valor correspondiente y el resultado binario BR se ajusta a "0".

5870

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Convertir un n√∫mero entero o en coma flotante en una cadena de caracteres
Son posibles las siguientes conversiones de n√∫meros enteros o en coma flotante en cadenas
de caracteres:
‚óè Convertir una variable en el formato INT en una cadena de caracteres. La cadena de
caracteres se representa precedida de signo. Si la variable indicada en el par√°metro de
retorno es demasiado corta, la conversi√≥n no se realiza y el bit BR se ajusta a "0". Al
par√°metro de salida solo puede asign√°rsele una variable definida como simb√≥lica.
‚óè Convertir una variable en el formato DINT en una cadena de caracteres. La cadena de
caracteres se representa precedida de signo. Si la variable indicada en el par√°metro de
retorno es demasiado corta, la conversi√≥n no se realiza y el bit BR se ajusta a "0". Al
par√°metro de salida solo puede asign√°rsele una variable definida como simb√≥lica.
‚óè Convertir una variable en el formato REAL en una cadena de caracteres. La cadena de
caracteres se representa con 14 posiciones: ¬±v.nnnnnnnE¬±xx
‚Äì ¬± = signo
‚Äì v = 1 posici√≥n antes de la coma
‚Äì n = 7 posiciones despu√©s de la coma
‚Äì x = 2 posiciones de exponente
Si la variable indicada en el par√°metro de retorno es demasiado corta o el par√°metro IN no
contiene un n√∫mero en coma flotante v√°lido, la conversi√≥n no se realiza y el bit BR se ajusta
a "0". Al par√°metro de salida solo puede asign√°rsele una variable definida como simb√≥lica.

Par√°metros
Las tablas siguientes muestran los par√°metros de la instrucci√≥n "S_CONV":
Tabla 4-258 Par√°metros para convertir una cadena de caracteres en n√∫meros enteros o en coma flotante
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

STRING*

D, L

Valor que se va a convertir

OUT

Output

INT, DINT, REAL

I, Q, M, D, L

Resultado de la conversi√≥n.

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Tabla 4-259 Par√°metros para convertir un n√∫mero entero o en coma flotante en una cadena de caracteres
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

INT, DINT, REAL

I, Q, M, D, L o constante Valor que se va a convertir

OUT

Output

STRING*

D, L

Resultado de la conversi√≥n

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5871

Instrucciones
4.2 Instrucciones

ATH: Convertir cadena de caracteres ASCII en n√∫mero hexadecimal
Descripci√≥n
Esta instrucci√≥n permite convertir la cadena de caracteres ASCII indicada en la entrada IN en
un n√∫mero hexadecimal. El resultado de la conversi√≥n se deposita en la direcci√≥n especificada
en el par√°metro OUT .
‚óè El n√∫mero de caracteres ASCII que se deben convertir se define con el par√°metro N.
‚óè Como m√°ximo se pueden convertir 65 535 caracteres ASCII v√°lidos.
‚óè Solo pueden interpretarse las cifras de 0 a 9 y las letras may√∫sculas de A a F. Todos los
dem√°s caracteres se convierten en ceros.
Dado que un car√°cter ASCII requiere 8 bits y un n√∫mero hexadecimal solo 4, la palabra de
salida es la mitad de larga que la palabra de entrada. Despu√©s de la conversi√≥n, los caracteres
ASCII se ordenan a la salida en el mismo orden en el que se han le√≠do. Si se trata de un n√∫mero
impar de caracteres ASCII, el n√∫mero hexadecimal correspondiente al semibyte a la derecha
del √∫ltimo n√∫mero hexadecimal convertido se rellena con ceros.
Cuando se detecta un car√°cter ASCII no v√°lido, se convierte como "0" y en el par√°metro
RET_VAL se deposita un mensaje de error.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ATH":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

POINTER

D, L

Puntero a la direcci√≥n inicial de una cadena
de caracteres ASCII

N

Input

WORD

I, Q, M, D, L, P o cons‚Äê
tante

N√∫mero de caracteres ASCII que se deben
convertir

RET_VAL

Output

WORD

I, Q, M, D, L, P

Estado de la instrucci√≥n

OUT

Output

POINTER

I, Q, M, D, L

Puntero a la direcci√≥n del resultado

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#....)

5872

0000

Ning√∫n error

0007

Car√°cter no v√°lido

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
Con estado l√≥gico de la entrada I 0.0 = "1" (activado), se ejecuta la instrucci√≥n. El par√°metro
de entrada N = 5 indica que se deben convertir cinco caracteres ASCII. Los caracteres ASCII
se guardan en el bloque de datos 1, que empieza en la direcci√≥n indicada por el puntero IN:
DB1.DBX10.0. La cadena de caracteres se devuelve en la direcci√≥n indicada por el puntero
OUT: Inicio en DB2.DBX0.0 (bloque de datos 2). Al tratarse en este caso de un n√∫mero impar
de caracteres ASCII, la √∫ltima cifra hexadecimal contiene solo ceros en el semibyte derecho,
lo que da lugar al valor hexadecimal 0xC0.
Si la instrucci√≥n se ha ejecutado sin errores, RET_VAL se ajusta al valor W#16#0000.
La tabla siguiente muestra ejemplos de conversi√≥n de cadenas de caracteres ASCII en
n√∫meros hexadecimales.
IN

N

OUT

Estado BR

'0123'

4

16#0123

1

'123AFx1a23'

10

16#123AF01023

0

Tabla 4-260 La tabla siguiente muestra los caracteres ASCII y los correspondientes valores
hexadecimales.
Caracteres ASCII

Valor hexadecimal codificado en ASCII

N√∫mero hexadecimal

"0"

30

0

"1"

31

1

"2"

32

2

"3"

33

3

"4"

34

4

"5"

35

5

"6"

36

6

"7"

37

7

"8"

38

8

"9"

39

9

"A"

41

A

"B"

42

B

"C"

43

C

D

44

D

E

45

E

F

46

F

HTA: Convertir n√∫mero hexadecimal en cadena de caracteres ASCII
Descripci√≥n
Esta instrucci√≥n permite convertir el n√∫mero hexadecimal indicado en la entrada IN en una
cadena de caracteres ASCII. El resultado de la conversi√≥n se deposita en la direcci√≥n
especificada en el par√°metro OUT .

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5873

Instrucciones
4.2 Instrucciones
El n√∫mero de bytes hexadecimales que se deben convertir se define con el par√°metro N. Dado
que un car√°cter ASCII requiere 8 bits y un n√∫mero hexadecimal solo 4, el valor de salida es el
doble de largo que el valor de entrada. Cada semibyte del n√∫mero hexadecimal se convierte
en un car√°cter manteniendo el orden original.
En la cadena de caracteres ASCII pueden escribirse como m√°ximo 65635 caracteres. El
resultado de la conversi√≥n se representa con las cifras de 0 a 9 y las letras may√∫sculas de A
a F.
La instrucci√≥n no detecta condiciones de error.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "HTA":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

POINTER*

I, Q, M, D

Direcci√≥n inicial de la cifra hexadecimal

N

Input

WORD

I, Q, M, D, L, P o cons‚Äê
tante

N√∫mero de bytes hexadecimales que se
deben convertir

OUT

Output

POINTER*

D, L

Direcci√≥n en la que se guarda el resulta‚Äê
do.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Ejemplo
Con estado l√≥gico de la entrada I 0.0 = "1" (activado), se ejecuta la instrucci√≥n. El par√°metro
de entrada N = 3 indica que se deben convertir tres caracteres hexadecimales. Los bytes
hexadecimales se guardan en el bloque de datos 1, que empieza en la direcci√≥n indicada por
el puntero IN : DB1.DBX10.0. La cadena de caracteres se devuelve en la direcci√≥n indicada por
el puntero OUT : inicio en DB2.DBX0.0 (bloque de datos 2).
La tabla siguiente muestra ejemplos de conversi√≥n de n√∫meros hexadecimales en cadenas de
caracteres ASCII:
IN

N

OUT

Estado BR

W#16#0123

2

'0123'

1

16#123AF01023

4

'123AF010'

0

La tabla siguiente muestra los caracteres ASCII y los correspondientes valores hexadecimales:
N√∫mero hexadecimal

5874

Valor hexadecimal codificado en ASCII

Caracteres ASCII

0

30

"0"

1

31

"1"

2

32

"2"

3

33

"3"

4

34

"4"

5

35

"5"

6

36

"6"

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
N√∫mero hexadecimal

Valor hexadecimal codificado en ASCII

Caracteres ASCII

7

37

"7"

8

38

"8"

9

39

"9"

A

41

"A"

B

42

"B"

C

43

"C"

D

44

"D"

E

45

"E"

F

46

"F"

Otras instrucciones
LEN: Determinar la longitud de una cadena de caracteres
Descripci√≥n
Esta instrucci√≥n devuelve la longitud de una cadena de caracteres (n√∫mero de caracteres
v√°lidos) como valor de retorno.
Una variable STRING contiene dos longitudes:
‚óè La longitud m√°xima (se especifica entre corchetes en la definici√≥n de la variable)
‚óè La longitud actual (n√∫mero de caracteres v√°lidos en el momento actual)
La longitud actual es menor o igual a la longitud m√°xima. El n√∫mero de bytes ocupados por una
cadena de caracteres excede en 2 la longitud m√°xima. Una cadena vac√≠a ('') tiene la longitud
cero. La longitud m√°xima es de 254. La instrucci√≥n no notifica ning√∫n error.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "LEN":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

STRING*

D, L* *

Variable de entrada en el formato STRING;
al par√°metro de entrada solo puede asign√°r‚Äê
sele una variable definida como simb√≥lica.

OUT

Return

INT

I, Q, M, D, L

N√∫mero actual de caracteres

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).
** En SCL: tambi√©n es posible utilizar constantes.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5875

Instrucciones
4.2 Instrucciones

CONCAT: Concatenar
Descripci√≥n
Esta instrucci√≥n agrupa dos variables STRING en una sola cadena de caracteres. Si la cadena
de caracteres resultante es m√°s larga que la variable definida en el par√°metro de salida, se
limita la cadena resultante a la longitud m√°xima ajustada y el bit BR se ajusta a "0".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CONCAT": A los par√°metros solo
pueden asign√°rseles variables definidas como simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

STRING*

D, L

Variable de entrada en el formato
STRING

IN2

Input

STRING*

D, L

Variable de entrada en el formato
STRING

OUT

Return

STRING*

D, L

Cadena concatenada

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

LEFT: Leer los caracteres izquierdos de una cadena
Descripci√≥n
Esta instrucci√≥n devuelve los primeros L caracteres de una cadena de caracteres.
‚óè Si L es mayor que la longitud actual de la variable STRING, se devuelve el valor de entrada.
‚óè Si L = 0 y si el valor de entrada es una cadena vac√≠a, se devuelve una cadena vac√≠a.
‚óè Si L es negativo, se devuelve una cadena vac√≠a y el bit BR se ajusta a "0".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "LEFT". Al par√°metro IN y al valor
de retorno RET_VAL solo pueden asign√°rseles variables definidas como simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

STRING*

D, L

Variable de entrada en el formato
STRING

L

Input

INT

I, Q, M, D, L o constante

Longitud de la cadena de caracte‚Äê
res izquierda

5876

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OUT

Return

STRING*

D, L

Variable de salida en el formato
STRING

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

RIGHT: Leer los caracteres derechos de una cadena
Descripci√≥n
Esta instrucci√≥n devuelve los √∫ltimos L caracteres de una cadena de caracteres.
‚óè Si L es mayor que la longitud actual de la variable STRING, se devuelve el valor de entrada.
‚óè Si L es negativo, se devuelve una cadena vac√≠a y el resultado binario BR se ajusta a "0".
‚óè Si L = 0 y si el valor de entrada es una cadena vac√≠a, se devuelve una cadena vac√≠a.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RIGHT". Al par√°metro IN y al valor
de retorno RET_VAL solo pueden asign√°rseles variables definidas como simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

STRING*

D, L

Variable de entrada en el formato
STRING

L

Input

INT

I, Q, M, D, L o constante Longitud de la cadena de caracteres
derecha

OUT

Return

STRING*

D, L

Variable de salida en el formato
STRING

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5877

Instrucciones
4.2 Instrucciones

MID: Leer los caracteres centrales de una cadena
Descripci√≥n
Esta instrucci√≥n devuelve la parte central de una cadena de caracteres (L caracteres a partir
del car√°cter P incluido).
‚óè Si la suma de L y (P-1) supera la longitud actual de la variable STRING, se devuelve una
cadena de caracteres a partir del car√°cter P hasta el final del valor de entrada.
‚óè En todos los dem√°s casos (si P se encuentra fuera de la longitud actual, P y/o L es igual a
cero o negativo), se devuelve una cadena vac√≠a y el bit BR se ajusta a "0".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "MID". Al par√°metro IN y al valor
de retorno RET_VAL solo pueden asign√°rseles variables definidas como simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

STRING*

D, L

Variable de entrada en el formato
STRING

L

Input

INT

I, Q, M, D, L o constante Longitud de la cadena de caracteres cen‚Äê
tral

P

Input

INT

I, Q, M, D, L o constante Posici√≥n del primer car√°cter

OUT

Return

STRING*

D, L

Variable de salida en el formato STRING

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

DELETE: Borrar caracteres de una cadena
Descripci√≥n
Esta instrucci√≥n borra en una cadena de caracteres L caracteres a partir del car√°cter P
incluido).
‚óè Si L y/o P es igual a cero o P es mayor que la longitud actual de la cadena de caracteres de
entrada, se devuelve la cadena de caracteres de entrada.
‚óè Si la suma de L y P es mayor que la cadena de caracteres de entrada, se borra hasta el final
de la cadena de caracteres.
‚óè Si L y/o P son negativos, se devuelve una cadena vac√≠a y el bit BR se ajusta a "0".

5878

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DELETE". Al par√°metro de
entrada IN y al par√°metro de salida RET_VAL solo pueden asign√°rseles variables definidas
como simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN

Input

STRING*

D, L

Variable STRING en la que se efec‚Äê
t√∫a el borrado

L

Input

INT

I, Q, M, D, L o constante N√∫mero de caracteres que se van a
borrar

P

Input

INT

I, Q, M, D, L o constante Posici√≥n del primer car√°cter que se
va a borrar

OUT

Return

STRING*

D, L

Cadena de caracteres resultante

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

INSERT: Insertar caracteres en una cadena
Descripci√≥n
Esta instrucci√≥n inserta la cadena de caracteres del par√°metro IN2 en la cadena de caracteres
del par√°metro IN1 despu√©s del car√°cter P .
‚óè Si P es igual a cero, la segunda cadena de caracteres se inserta antes de la primera.
‚óè Si P es mayor que la longitud actual de la primera cadena de caracteres, la segunda cadena
de caracteres se inserta despu√©s de la primera.
‚óè Si P es negativo, se devuelve una cadena vac√≠a y el bit BR se ajusta a "0".
El bit BR tambi√©n se ajusta a "0" si la cadena de caracteres resultante es m√°s larga que la
variable especificada en el par√°metro de salida; en este caso, la cadena de caracteres
resultante se limita a la longitud m√°xima ajustada.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "INSERT". A los par√°metros de
entrada IN1 y IN2 y al par√°metro de salida solo pueden asign√°rseles variables definidas como
simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

STRING*

D, L

Variable STRING en la que se efect√∫a
la inserci√≥n

IN2

Input

STRING*

D, L

Variable STRING que se va a insertar

P

Input

INT

I, Q, M, D, L o constante Posici√≥n de inserci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5879

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OUT

Return

STRING*

D, L

Cadena de caracteres resultante

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

REPLACE: Reemplazar caracteres de una cadena
Descripci√≥n
Esta instrucci√≥n sustituye L caracteres de la primera cadena de caracteres (IN1) a partir del
car√°cter P (incluido) por la totalidad de la segunda cadena de caracteres (IN2).
‚óè Si L es igual a cero y P distinto de cero, se devuelve la primera cadena de caracteres.
‚óè Si L es igual a cero y P igual a cero, se coloca la segunda cadena de caracteres delante de
la primera.
‚óè Si L es distinto de cero y P igual a cero o uno, se sustituyen los caracteres a partir del primer
car√°cter.
‚óè Si P est√° fuera de la primera cadena de caracteres, la segunda cadena de caracteres se
coloca despu√©s de la primera.
‚óè Si L y/o P son negativos, se devuelve una cadena vac√≠a y el bit BR se ajusta a "0". El bit BR
tambi√©n se ajusta a "0" si la cadena de caracteres resultante es m√°s larga que la variable
especificada en el par√°metro de salida; en este caso, la cadena de caracteres resultante se
limita a la longitud m√°xima ajustada.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "REPLACE". A los par√°metros de
entrada IN1 y IN2 y al par√°metro de salida solo pueden asign√°rseles variables definidas como
simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

STRING*

D, L

Variable STRING en la que se efec‚Äê
t√∫a la sustituci√≥n

IN2

Input

STRING*

D, L

Variable STRING que se va a reem‚Äê
plazar

L

Input

INT

I, Q, M, D, L o constante N√∫mero de caracteres que se van a
reemplazar

P

Input

INT

I, Q, M, D, L o constante Posici√≥n del primer car√°cter reem‚Äê
plazado

OUT

Return

STRING*

D, L

Cadena de caracteres resultante

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

5880

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

FIND: Buscar caracteres en una cadena
Descripci√≥n
Esta instrucci√≥n devuelve la posici√≥n de la segunda cadena de caracteres (IN2) dentro de la
primera cadena de caracteres (IN1). La b√∫squeda se inicia por la izquierda. Se notifica la
primera aparici√≥n de la cadena de caracteres.
Si la segunda cadena de caracteres no existe dentro de la primera, se devuelve cero. La
instrucci√≥n no notifica errores.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "FIND". A los par√°metros de
entrada IN1 y IN2 solo pueden asign√°rseles variables definidas como simb√≥licas.
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN1

Input

STRING*

D, L

Variable STRING en la que se efect√∫a
la b√∫squeda

IN2

Input

STRING*

D, L

Variable STRING que se va a buscar

OUT

Return

INT

I, Q, M, D, L

Posici√≥n de la cadena de caracteres
encontrada

* Defina la longitud m√°xima de la cadena de caracteres si en la declaraci√≥n de la interfaz se utiliza el tipo de datos STRING
para una variable temporal (encontrar√° m√°s informaci√≥n en la descripci√≥n del tipo de datos).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

4.2.3.3

Memoria imagen de proceso

UPDAT_PI: Actualizar memoria imagen de proceso de las entradas
Descripci√≥n
Esta instrucci√≥n permite actualizar la memoria imagen de proceso del OB 1 (=memoria imagen
parcial de proceso 0) de las entradas o una memoria imagen parcial de proceso de las entradas
definida mediante configuraci√≥n.
Si se ha configurado como m√©todo de notificaci√≥n para la actualizaci√≥n de la memoria imagen
de proceso por el sistema la notificaci√≥n repetida de todos los errores de acceso a la periferia,
la actualizaci√≥n de la memoria imagen de proceso seleccionada se lleva a cabo de modo
continuo.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5881

Instrucciones
4.2 Instrucciones
De lo contrario, dicha actualizaci√≥n solo se efect√∫a cuando la memoria imagen parcial de
proceso seleccionada no es actualizada por el sistema, es decir,
‚óè si no se ha asignado esa memoria imagen parcial de proceso a ning√∫n OB de alarma,
o
‚óè si se ha seleccionado la memoria imagen parcial de proceso 0 y se ha desactivado (en la
configuraci√≥n) la actualizaci√≥n de la memoria imagen parcial de proceso del OB 1.
Nota
Las direcciones l√≥gicas que se han asignado en la configuraci√≥n a una memoria imagen
parcial de proceso de las entradas, no pertenecen ya a la memoria imagen de proceso del
OB 1 de las entradas.
Una memoria imagen parcial de proceso que se actualiza con "UPDAT_PI" no debe
actualizarse al mismo tiempo con la instrucci√≥n "SYNC_PI (P√°gina 5884)".
Si se ha asignado a un OB de alarma la actualizaci√≥n por el sistema de la memoria imagen de
proceso del OB 1 de las entradas y de la memoria imagen parcial de proceso de las entradas,
la actualizaci√≥n se realiza independientemente de las llamadas de "UPDAT_PI".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "UPDAT_PI":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PART

Input

BYTE

I, Q, M, D, L o constante N√∫mero de la memoria imagen parcial de
proceso de las entradas que se debe actua‚Äê
lizar. Rango m√°ximo de valores (el rango
depende de la CPU):
De 0 a 15 (0 significa memoria imagen de
proceso del OB 1, n para 1 < n < 15 significa
memoria imagen parcial de proceso n).

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

FLADDR

Output

WORD

I, Q, M, D, L

Direcci√≥n del primer byte que provoca erro‚Äê
res, en caso de que se haya producido un
error de acceso

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Valor no v√°lido en el par√°metro PART

8091

La memoria imagen parcial de proceso especificada todav√≠a no est√° definida o no se encuentra dentro del
√°rea de memoria imagen de proceso admisible de la CPU.

5882

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
8092

La memoria imagen parcial de proceso es actualizada por el sistema con un OB, y el usuario no ha
configurado para ello la notificaci√≥n repetida de todos los errores de acceso a la periferia. No se ha
realizado ninguna actualizaci√≥n con "UPDAT_PI".

80A0

Se ha detectado un error de acceso al acceder a la periferia.

8xyy

Informaci√≥n de error general, ver Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gi‚Äê
na 174)

Nota
Si se utiliza esta instrucci√≥n para memorias imagen parcial de proceso de esclavos DP
normalizados para los que se hayan definido √°reas de coherencia de m√°s de 32 bytes, tambi√©n
son posibles los c√≥digos de error de la instrucci√≥n "DPRD_DAT (P√°gina 5929)".

UPDAT_PO: Actualizar memoria imagen de proceso de las salidas
Descripci√≥n
Esta instrucci√≥n permite transferir a los m√≥dulos de salida los estados l√≥gicos de la memoria
imagen de proceso del OB 1 (=memoria imagen parcial de proceso 0) de las salidas o de una
memoria imagen parcial de proceso de las salidas definida mediante configuraci√≥n.
Si se ha definido un √°rea de coherencia para la memoria imagen parcial de proceso
seleccionada, los datos en cuesti√≥n se transfieren de modo coherente al m√≥dulo de periferia
correspondiente.
Nota
Las direcciones l√≥gicas que se han asignado mediante configuraci√≥n a una memoria imagen
parcial de proceso de las salidas, no pertenecen ya a la memoria imagen de proceso del OB 1
de las salidas.
Las salidas que se actualizan con "UPDAT_PO" no deben actualizarse al mismo tiempo con la
instrucci√≥n "SYNC_PO (P√°gina 5886)".
Si se ha asignado a un OB de alarma la transferencia a los m√≥dulos de salida de la memoria
imagen de proceso del OB 1 de las salidas y de la memoria imagen parcial de proceso de las
salidas, el sistema realiza la transferencia independientemente de las llamadas de
"UPDAT_PO".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5883

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "UPDAT_PO":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

PART

Input

BYTE

Descripci√≥n

I, Q, M, D, L o constante N√∫mero de la memoria imagen parcial de pro‚Äê
ceso de las salidas que se debe transferir.
Rango m√°ximo de valores (el rango depende
de la CPU): de 0 a 15.
(0 significa memoria imagen de proceso del
OB 1, n para 1 < n < 15 significa memoria ima‚Äê
gen parcial de proceso n).

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

FLADDR

Output

WORD

I, Q, M, D, L

Direcci√≥n del primer byte que provoca errores,
en caso de que se haya producido un error de
acceso

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Valor no v√°lido en el par√°metro PART

8091

La memoria imagen parcial de proceso especificada todav√≠a no est√° definida o no se encuentra dentro del
√°rea de memoria imagen de proceso admisible de la CPU.

80A0

Se ha detectado un error de acceso al acceder a la periferia.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Nota
Si se utiliza esta instrucci√≥n para memorias imagen parcial de proceso de esclavos DP
normalizados para los que se hayan definido √°reas de coherencia de m√°s de 32 bytes, tambi√©n
son posibles los c√≥digos de error de la instrucci√≥n "DPWR_DAT (P√°gina 5932)".

SYNC_PI: Sincronizar memoria imagen de proceso de las entradas
Descripci√≥n
La instrucci√≥n "SYNC_PI" permite actualizar de modo is√≥crono una memoria imagen parcial de
proceso de las entradas. Con esta instrucci√≥n, un programa de usuario vinculado a un ciclo DP
o a un ciclo de emisi√≥n PN puede actualizar los datos de entrada registrados de modo is√≥crono
y coherente en una memoria imagen parcial de proceso de las entradas.

5884

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Llamada
"SYNC_PI" puede interrumpirse, y solo puede llamarse en los OBs 61, 62, 63 y 64.
Nota
La llamada de la instrucci√≥n "SYNC_PI" en los OBs 61 a 64 solo est√° autorizada si en la
configuraci√≥n hardware se ha asignado la memoria imagen parcial de proceso en cuesti√≥n al
OB correspondiente.
Una memoria imagen parcial de proceso que se actualiza con "SYNC_PI" no puede
actualizarse al mismo tiempo con la instrucci√≥n "UPDAT_PI (P√°gina 5881)".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SYNC_PI":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê √Årea de memo‚Äê Rango de valo‚Äê
tos
ria
res

Descripci√≥n

PART

Input

BYTE

I, Q, M, D, L o
constante

de 1 a 30

N√∫mero de la memoria imagen parcial de
proceso de las entradas que se debe ac‚Äê
tualizar en modo is√≥crono.

RET_VAL

Return

INT

I, Q, M, D, L

-

Informaci√≥n de error

FLADDR

Output

WORD

I, Q, M, D, L

-

Direcci√≥n del primer byte que provoca erro‚Äê
res, en caso de que se haya producido un
error de acceso.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Clase de evento
c√≥digo de error

Explicaci√≥n

W#16#0001

Advertencia de coherencia. La actualizaci√≥n de la memoria imagen parcial de proceso se ha repartido
entre dos ciclos DP o PN. Sin embargo, los datos pertenecientes a un esclavo o un dispositivo IO se han
transferido de modo coherente.

W#16#8090

Valor no admisible en el par√°metro PART, o bien la actualizaci√≥n de la memoria imagen parcial de
proceso de las entradas indicada no est√° permitida en este OB. No se ha actualizado la memoria
imagen parcial de proceso de las entradas.

W#16#8091

La memoria imagen parcial de proceso especificada todav√≠a no est√° definida o no se encuentra dentro
del √°rea de memoria imagen de proceso admisible de la CPU. No se ha actualizado la memoria imagen
parcial de proceso de las entradas.

W#16#80A0

Durante la actualizaci√≥n se ha detectado un error de acceso. Las entradas afectadas se han ajustado
a "0".

W#16#80A1

El momento de actualizaci√≥n es posterior a la ventana de acceso admisible. No se ha actualizado la
memoria imagen parcial de proceso de las entradas.
El ciclo DP o PN es demasiado corto y no garantiza suficiente tiempo para procesar la instrucci√≥n. Por
ello deben incrementarse los tiempos TDP (tambi√©n conocidos como T_DC), Ti y To.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5885

Instrucciones
4.2 Instrucciones
Clase de evento
c√≥digo de error

Explicaci√≥n

W#16#80A2

Error de acceso con advertencia de coherencia
Durante la actualizaci√≥n de la memoria imagen parcial de proceso de las entradas se ha detectado un
error de acceso con advertencia de coherencia simult√°nea.
‚óè Los datos de las entradas err√≥neas no han sido le√≠dos todav√≠a por la periferia. En la memoria imagen
parcial de proceso de las entradas las entradas afectadas se ponen a cero.
‚óè La actualizaci√≥n de los datos de entrada no afectados por el error de acceso se ha distribuido entre
dos ciclos DP o PN.

W#16#80C1

El momento de actualizaci√≥n es anterior a la ventana de acceso admisible. No se ha actualizado la
memoria imagen parcial de proceso de las entradas.

W#16#8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Nota
Si se utiliza la instrucci√≥n "SYNC_PI" para memorias imagen parcial de proceso de esclavos
DP normalizados para los que se hayan definido √°reas de coherencia de m√°s de 32 bytes,
tambi√©n son posibles los c√≥digos de error de la instrucci√≥n "DPRD_DAT (P√°gina 5929)".

SYNC_PO: Sincronizar memoria imagen de proceso de las salidas
Descripci√≥n
La instrucci√≥n "SYNC_PO" permite actualizar de modo is√≥crono una memoria imagen parcial
de proceso de las salidas. Con esta instrucci√≥n, un programa de usuario vinculado a un ciclo
DP o a un ciclo de emisi√≥n PN puede transferir a la periferia de modo is√≥crono y coherente los
datos de salida calculados de una memoria imagen parcial de proceso de las salidas.

Llamada
"SYNC_PO" puede interrumpirse, y solo puede llamarse en los OBs 61, 62, 63 y 64.
Nota
La llamada de la instrucci√≥n "SYNC_PO" en los OBs 61 a 64 solo est√° autorizada si en la
configuraci√≥n hardware se ha asignado la memoria imagen parcial de proceso en cuesti√≥n al
OB correspondiente.
Una memoria imagen parcial de proceso que se actualiza con "SYNC_PO" no puede
actualizarse al mismo tiempo con la instrucci√≥n "UPDAT_PO (P√°gina 5883)".

5886

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SYNC_PO":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memo‚Äê Rango de valo‚Äê
ria
res

Descripci√≥n

PART

Input

BYTE

I, Q, M, D, L o
constante

de 1 a 30

N√∫mero de la memoria imagen parcial de
proceso de las salidas que se debe ac‚Äê
tualizar en modo is√≥crono.

RET_VAL

Return

INT

I, Q, M, D, L

-

Si se produce un error durante la ejecu‚Äê
ci√≥n de la instrucci√≥n, el valor de respues‚Äê
ta contendr√° un c√≥digo de error.

FLADDR

Output

WORD

I, Q, M, D, L

-

Direcci√≥n del primer byte que provoca
errores.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Clase de evento
c√≥digo de error

Explicaci√≥n

W#16#0001

Advertencia de coherencia. La actualizaci√≥n de la memoria imagen parcial de proceso se ha repartido
entre dos ciclos DP o PN. Sin embargo, los datos pertenecientes a un esclavo o un dispositivo IO se han
transferido de modo coherente.

W#16#8090

Valor no admisible en el par√°metro PART, o bien la actualizaci√≥n de la memoria imagen parcial de
proceso de las salidas indicada no est√° permitida en este OB. No se han transferido las salidas a la
periferia. La memoria imagen parcial de proceso de las salidas no se modifica.

W#16#8091

La memoria imagen parcial de proceso especificada todav√≠a no est√° definida o no se encuentra dentro
del √°rea de memoria imagen de proceso admisible de la CPU. No se han transferido las salidas a la
periferia. La memoria imagen parcial de proceso de las salidas no se modifica.

W#16#80A0

Durante la actualizaci√≥n de la memoria imagen parcial de proceso de las salidas se ha detectado un
error de acceso. No se han transferido las salidas err√≥neas a la periferia. En la memoria imagen parcial
de proceso de las salidas, √©stas no sufren modificaci√≥n alguna.

W#16#80A1

Error de acceso con advertencia de coherencia
Durante la actualizaci√≥n de la memoria imagen parcial de proceso de las salidas se ha detectado un
error de acceso con advertencia de coherencia simult√°nea.
‚óè No se han transferido los datos de las salidas err√≥neas a la periferia. En la memoria imagen parcial
de proceso de las salidas, las salidas afectadas no sufren modificaci√≥n alguna.
‚óè La actualizaci√≥n de los datos de salida no afectados por el error de acceso se ha distribuido entre
dos ciclos DP o PN.

W#16#80A2

El momento de actualizaci√≥n es posterior a la ventana de acceso admisible. No se han transferido las
salidas a la periferia. La memoria imagen parcial de proceso de las salidas no se modifica.

W#16#80C1

El momento de actualizaci√≥n es anterior a la ventana de acceso admisible. No se han transferido las
salidas a la periferia. La memoria imagen parcial de proceso de las salidas no se modifica.

W#16#8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5887

Instrucciones
4.2 Instrucciones

Nota
Si se utiliza la instrucci√≥n "SYNC_PO" para memorias imagen parcial de proceso de esclavos
DP normalizados para los que se hayan definido √°reas de coherencia de m√°s de 32 bytes,
tambi√©n son posibles los c√≥digos de error de la instrucci√≥n "DPWR_DAT (P√°gina 5932)".

4.2.3.4

Periferia descentralizada

RDREC: Leer registro
Descripci√≥n
Esta instrucci√≥n permite leer el registro con n√∫mero INDEX del componente direccionado con
ID . Puede tratarse de un m√≥dulo central o de un componente descentralizado (PROFIBUS DP
o PROFINET IO).
Con MLEN se indica el m√°ximo de bytes que se deben leer. Por ello debe escogerse un √°rea
de destino RECORD con una longitud de por lo menos MLEN bytes.
El valor TRUE del par√°metro de salida VALID indica que el registro se ha transferido
correctamente al √°rea de destino RECORD . En ese caso, el par√°metro de salida LEN contiene
la longitud en bytes de los datos le√≠dos.
Si se ha producido un error durante la transferencia del registro, se se√±aliza mediante el
par√°metro de salida ERROR . En ese caso, el par√°metro de salida STATUS contiene la
informaci√≥n de error.
Nota
Si un esclavo DPV1 est√° configurado mediante archivo GSD (a partir de la rev. 3 de GSD) y la
interfaz DP del maestro DP est√° ajustada como "Compatible con S7", los m√≥dulos de E/S no
pueden leer en el programa de usuario los registros con "RDREC". En este caso, el maestro
DP direcciona un slot incorrecto (slot configurado + 3).
Soluci√≥n: Conmutar la interfaz del maestro DP a "DPV1".
Nota
La interfaz de la instrucci√≥n "RDREC" es id√©ntica a la del FB "RDREC" definido en la norma
PROFIBUS and PROFINET Guideline Communication Function Blocks on PROFIBUS DP and
PROFINET IO.

Funcionamiento
"RDREC" es una instrucci√≥n as√≠ncrona, de modo que su ejecuci√≥n se extiende a lo largo de
varias llamadas. Para iniciar la transferencia del registro, debe llamarse RDREC con REQ = 1.

5888

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Mediante el par√°metro de salida BUSY y los dos bytes centrales del par√°metro de salida
STATUS , se muestra el estado de la petici√≥n. Los dos bytes centrales de STATUS
corresponden al par√°metro de salida RET_VAL de las instrucciones as√≠ncronas.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).
La transferencia del registro se puede dar por finalizada cuando el par√°metro de salida BUSY
ha adoptado el valor FALSE .
Mientras se est√© transfiriendo el registro no deber√° modificarse el √°rea de destino,
concretamente ni su longitud ni su contenido.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RDREC":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: realizar la transferencia del juego
de datos

ID

Input

DWORD

I, Q, M, D, L o constan‚Äê Direcci√≥n l√≥gica del esclavo DP o compo‚Äê
te
nente PROFINET IO (m√≥dulo)
‚óè En un m√≥dulo de salida debe activarse
el bit 15 (ejemplo de la direcci√≥n 5:
ID:=DW#16#8005).
‚óè Con un m√≥dulo mixto debe indicarse la
direcci√≥n m√°s baja de las dos.

INDEX

Input

INT

I, Q, M, D, L o constan‚Äê N√∫mero del juego de datos
te

MLEN

Input

INT

I, Q, M, D, L o constan‚Äê Longitud m√°xima en bytes de la informa‚Äê
te
ci√≥n de registro que se debe leer

VALID

Output

BOOL

I, Q, M, D, L

El nuevo registro se ha recibido y es v√°lido

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La lectura todav√≠a no ha finali‚Äê
zado.

ERROR

Output

BOOL

I, Q, M, D, L

ERROR = 1: se ha producido un error du‚Äê
rante la lectura.

STATUS

Output

DWORD

I, Q, M, D, L

Estado del bloque o informaci√≥n de error
Para la interpretaci√≥n del par√°metro STA‚Äê
TUS , ver el par√°metro STATUS (P√°gi‚Äê
na 5901).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5889

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LEN

Output

INT

I, Q, M, D, L

Longitud de la informaci√≥n del registro le√≠da

RECORD

InOut

ANY

I, Q, M, D, L

√Årea de destino para el registro le√≠do
Nota: Tenga en cuenta que en las CPU
S7-300, el par√°metro RECORD siempre
requiere que se especifiquen por completo
los par√°metros de DB (ej.:
P#DB13.DBX0.0 byte 100). En las CPU
S7-300 no est√° permitido omitir un n√∫mero
de DB expl√≠cito; de lo contrario se genera
un mensaje de error en el programa de
usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Si se utiliza la instrucci√≥n para leer un registro con PROFINET IO, los valores negativos de los
par√°metros INDEX, MLEN y LEN se interpretan como n√∫mero entero de 16 bits sin signo.

WRREC: Escribir registro
Descripci√≥n
Esta instrucci√≥n permite transferir el registro RECORD al componente direccionado con ID.
Puede tratarse de un m√≥dulo central o de un componente descentralizado (PROFIBUS DP o
PROFINET IO).
Con LEN (oculto) se indica la longitud en bytes del registro que se debe transferir. Por ello debe
escogerse un √°rea de origen RECORD con una longitud de por lo menos LEN bytes.
El valor TRUE del par√°metro de salida DONE indica que el registro se ha transferido
correctamente.
Si se ha producido un error durante la transferencia del registro, se se√±aliza mediante el
par√°metro de salida ERROR . En ese caso, el par√°metro de salida STATUS contiene la
informaci√≥n de error.
Nota
Si un esclavo DPV1 est√° configurado mediante archivo GSD (a partir de la rev. 3 de GSD) y la
interfaz DP del maestro DP est√° ajustada como "Compatible con S7", no se pueden escribir en
el programa de usuario registros con "WRREC" en los m√≥dulos de E/S. En este caso, el
maestro DP direcciona un slot incorrecto (slot configurado + 3).
Soluci√≥n: Conmutar la interfaz del maestro DP a "DPV1".

5890

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nota
La interfaz de la instrucci√≥n "WRREC" es id√©ntica a la del FB "WRREC" definido en la norma
PROFIBUS and PROFINET Guideline Communication Function Blocks on PROFIBUS DP and
PROFINET IO.

Funcionamiento
"WRREC" es una instrucci√≥n as√≠ncrona, de modo que su ejecuci√≥n se extiende a lo largo de
varias llamadas. Para iniciar la transferencia del registro, debe llamarse "WRREC" con
REQ = 1.
Mediante el par√°metro de salida BUSY y los dos bytes centrales del par√°metro de salida
STATUS , se muestra el estado de la petici√≥n. Los dos bytes centrales de STATUS
corresponden al par√°metro de salida RET_VAL de las instrucciones as√≠ncronas.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).
Aseg√∫rese de asignar siempre el mismo valor al par√°metro actual de RECORD en todas las
llamadas de "WRREC" pertenecientes a una misma petici√≥n. Lo mismo se aplica a los
par√°metros actuales de LEN.
La transferencia del registro se puede dar por finalizada cuando el par√°metro de salida BUSY
ha adoptado el valor FALSE .

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WRREC":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: realizar la transferencia del jue‚Äê
go de datos

ID

Input

DWORD

I, Q, M, D, L o constante Direcci√≥n l√≥gica del esclavo DP o compo‚Äê
nente PROFINET IO (m√≥dulo)
Para un m√≥dulo de salida, debe activarse
el bit 15 (ejemplo para la direcci√≥n 5:
ID:=DW#16#8005).
En un m√≥dulo mixto debe indicarse la me‚Äê
nor de las dos direcciones.

INDEX

Input

INT

I, Q, M, D, L o constante N√∫mero del juego de datos

LEN

Input

INT

I, Q, M, D, L o constante (oculto)
Longitud m√°xima en bytes del juego de
datos que se debe transferir

DONE

Output

BOOL

I, Q, M, D, L

Se ha transferido el juego de datos

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La escritura todav√≠a no ha fi‚Äê
nalizado.

ERROR

Output

BOOL

I, Q, M, D, L

ERROR = 1: Se ha producido un error du‚Äê
rante la escritura.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5891

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

STATUS

Output

DWORD

I, Q, M, D, L

Estado del bloque o informaci√≥n de error
Para la interpretaci√≥n del par√°metro STA‚Äê
TUS , ver el par√°metro STATUS (P√°gi‚Äê
na 5901).

RECORD

InOut

ANY

I, Q, M, D, L

Juego de datos
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro RECORD siempre
requiere que se especifiquen por comple‚Äê
to los par√°metros de DB (ej.:
P#DB13.DBX0.0 byte 100). En las CPU
S7-300 no est√° permitido omitir un n√∫me‚Äê
ro de DB expl√≠cito; de lo contrario se ge‚Äê
nera un mensaje de error en el programa
de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Si se utiliza la instrucci√≥n para escribir un registro con PROFINET IO, los valores negativos de
los par√°metros INDEX y LEN se interpretan como n√∫mero entero de 16 bits sin signo.

GETIO: Leer memoria imagen de proceso
Descripci√≥n
Con esta instrucci√≥n se leen de modo coherente todas las entradas de un esclavo DP
normalizado o un dispositivo PROFINET IO. Para ello, esta instrucci√≥n llama la instrucci√≥n
"DPRD_DAT (P√°gina 5929)". Si no se ha producido ning√∫n error durante la transferencia de
datos, los datos le√≠dos se registran en el √°rea de destino delimitada mediante INPUTS .
El √°rea de destino debe tener la misma longitud que se haya configurado para el componente
seleccionado.
En un esclavo DP normalizado con estructura modular o con varias IDs de DP, la llamada de
"GETIO" solo permite acceder cada vez a los datos de un solo componente o ID de DP en la
direcci√≥n configurada.

5892

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "GETIO":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ID

Input

DWORD

I, Q, M, D, L o constante ‚óè low word: Direcci√≥n l√≥gica del esclavo
DP o componente PROFINET IO
(m√≥dulo)

STATUS

Output

DWORD

I, Q, M, D, L

Contiene la informaci√≥n de error de
"DPRD_DAT (P√°gina 5929)" en la forma
DW#16#40xxxx00

LEN

Output

INT

I, Q, M, D, L

N√∫mero de datos le√≠dos, en bytes

INPUTS

InOut

ANY

I, Q, M, D

√Årea de destino para los datos le√≠dos. Debe
tener la misma longitud que se haya confi‚Äê
gurado para el esclavo DP o componente
PROFINET-IO seleccionado. Solo se admi‚Äê
te el tipo de datos BYTE .

‚óè high word: Irrelevante

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro STATUS
Consulte tambi√©n: DPRD_DAT: Leer datos coherentes de un esclavo DP normalizado
(P√°gina 5929).

SETIO: Transferir memoria imagen de proceso
Descripci√≥n
Con la instrucci√≥n "SETIO" se transfieren de modo coherente los datos del √°rea de origen
delimitada por OUTPUTS al esclavo DP normalizado o dispositivo PROFINET IO y, en su
caso, a la memoria imagen de proceso (concretamente si se ha configurado el √°rea de
direcciones en cuesti√≥n del esclavo DP normalizado como √°rea de coherencia en una memoria
imagen de proceso). "Para ello, SETIO llama la instrucci√≥n DPWR_DAT (P√°gina 5932)".
El √°rea de origen debe tener la misma longitud que se haya configurado para el componente
seleccionado.
En un esclavo DP normalizado con estructura modular o con varias IDs de DP, la llamada de
"SETIO" permite acceder a los datos de un solo componente o ID de DP.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5893

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SETIO":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

‚óè low word: Direcci√≥n l√≥gica del esclavo
DP o componente PROFINET IO
(m√≥dulo)

LEN

Input

INT

I, Q, M, D, L

Irrelevante

STATUS

Output

DWORD

I, Q, M, D, L

Contiene la informaci√≥n de error de
"DPWR_DAT (P√°gina 5932)" en la forma
DW#16#40xxxx00

OUTPUTS

InOut

ANY

I, Q, M, D

√Årea de origen para los datos que se de‚Äê
ben escribir. Debe tener la misma longi‚Äê
tud que se haya configurado para el es‚Äê
clavo DP o componente PROFINET-IO
seleccionado. Solo se admite el tipo de
datos BYTE.

‚óè high word: Irrelevante

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro STATUS
Consulte tambi√©n: DPWR_DAT: Escribir datos coherentes de un esclavo DP normalizado
(P√°gina 5932).

GETIO_PART: Leer √°rea de memoria imagen de proceso
Descripci√≥n
Con la instrucci√≥n "GETIO_PART" se lee de modo coherente una parte del √°rea de la memoria
imagen de proceso perteneciente a un esclavo DP normalizado o a un dispositivo PROFINET
IO. "Para ello, GETIO_PART llama la instrucci√≥n "UBLKMOV".
Nota
Al OB en el que se llame "GETIO_PART" debe asign√°rsele una memoria imagen parcial de
proceso de las entradas. Adem√°s, antes de la llamada de "GETIO_PART" es necesario incluir
el correspondiente esclavo DP normalizado o dispositivo PROFINET IO en esa memoria
imagen parcial de proceso de las entradas. Si la CPU no es capaz de trabajar con memorias
imagen parcial de proceso o se desea llamar "GETIO_PART" en el OB 1, antes de la llamada
de "GETIO_PART" debe incluirse el correspondiente esclavo DP normalizado o dispositivo
PROFINET IO en la memoria imagen de proceso de las entradas.

5894

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Con los par√°metros OFFSET y LEN se define la porci√≥n que se debe leer del √°rea de la
memoria imagen de proceso del componente direccionado mediante ID.
‚óè Si no se ha producido ning√∫n error durante la transferencia de datos, ERROR adquiere el
valor FALSE, y los datos le√≠dos se registran en el √°rea de destino delimitada mediante
INPUTS.
‚óè Si se ha producido alg√∫n error durante la transferencia de datos, ERROR adquiere el valor
TRUE, y STATUS recibe la informaci√≥n de error de "UBLKMOV".
‚óè Si el √°rea de destino (par√°metro INPUTS) es menor que LEN, se transfieren todos los bytes
que INPUTS pueda contener. ERROR adquiere el valor FALSE. Si el √°rea de destino es
mayor que LEN, se escriben los primeros LEN bytes del √°rea de destino. ERROR adquiere
el valor FALSE.
Nota
"GETIO_PART" no comprueba en la memoria imagen de proceso de las entradas los
l√≠mites entre los datos que pertenecen a los distintos componentes PROFIBUS-DP o
PROFINET-IO. Por eso el usuario debe asegurarse de que el √°rea de memoria imagen de
proceso definida mediante OFFSET y LEN pertenezca a un componente. La lectura de
varios componentes al mismo tiempo puede no ser compatible con sistemas futuros y
dificultar la migrabilidad a sistemas de otros fabricantes.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "GETIO_PART":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ID

Input

DWORD

I, Q, M, D, L o constan‚Äê ‚óè low word: Direcci√≥n l√≥gica del esclavo
te
DP o componente PROFINET IO
(m√≥dulo)

OFFSET

Input

INT

I, Q, M, D, L o constan‚Äê N√∫mero del primer byte que se debe leer
te
en la memoria imagen de proceso del
componente (valor m√°s peque√±o posible:
0)

LEN

Input

INT

I, Q, M, D o constante

N√∫mero de caracteres que se van a leer

STATUS

Output

DWORD

I, Q, M, D, L

Contiene la informaci√≥n de error de
"UBLKMOV" en la forma
DW#16#40xxxx00, si ERROR = TRUE.

‚óè high word: Irrelevante

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5895

Instrucciones
4.2 Instrucciones
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ERROR

Output

BOOL

I, Q, M, D, L

Visualizaci√≥n de error:
ERROR = TRUE, en caso de que se pro‚Äê
duzca un error al llamar "UBLKMOV".

INPUTS

InOut

ANY

I, Q, M, D

√Årea de destino para los datos le√≠dos:
‚óè Si el √°rea de destino es menor que
LEN, se transfieren todos los bytes
que INPUTS pueda contener.
ERROR adquiere el valor FALSE.
‚óè Si el √°rea de destino es mayor que
LEN, se escriben los primeros LEN
bytes del √°rea de destino. ERROR
adquiere el valor FALSE.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros STATUS y ERROR
V√©ase la instrucci√≥n "UBLKMOV".

SETIO_PART: Transferir √°rea de memoria imagen de proceso
Descripci√≥n
Con la instrucci√≥n "SETIO_PART" se transfieren de modo coherente los datos del √°rea de
origen delimitada por OUTPUTS a una parte del √°rea de memoria imagen de proceso
perteneciente a un esclavo DP normalizado o a un dispositivo PROFINET IO. "Para ello,
SETIO_PART llama la instrucci√≥n "UBLKMOV".
Nota
Debe asignarse una memoria imagen parcial de proceso de las salidas al OB en el que se
llama "SETIO_PART". Adem√°s, antes de la llamada de "SETIO_PART" es necesario incluir el
correspondiente esclavo DP normalizado o dispositivo PROFINET IO en esa memoria imagen
parcial de proceso de las entradas. Si la CPU no es capaz de trabajar con memorias imagen
parcial de proceso o se desea llamar "SETIO_PART" en el OB 1, antes de la llamada a
"SETIO_PART" debe incluirse el correspondiente esclavo DP normalizado o dispositivo
PROFINET IO en la memoria imagen de proceso de las salidas.

5896

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Con los par√°metros OFFSET y LEN se define la porci√≥n que se debe escribir del √°rea de la
memoria imagen de proceso del componente direccionado mediante ID.
‚óè Si no se ha producido ning√∫n error durante la transferencia de datos, ERROR adquiere el
valor FALSE.
‚óè Si se ha producido alg√∫n error durante la transferencia de datos, ERROR adquiere el valor
TRUE, y STATUS recibe la informaci√≥n de error de "UBLKMOV".
‚óè Si el √°rea de origen (par√°metro OUTPUTS) es menor que LEN, se transfieren todos los
bytes que OUTPUTS contiene. ERROR adquiere el valor FALSE. Si el √°rea de origen es
mayor que LEN, se transfieren los primerosLEN bytes de OUTPUTS. ERROR adquiere el
valor FALSE.
Nota
"SETIO_PART" no comprueba en la memoria imagen de proceso de las salidas los l√≠mites
entre los datos que pertenecen a los distintos componentes PROFIBUS-DP o PROFINETIO. Por eso el usuario debe asegurarse de que el √°rea de memoria imagen de proceso
definida mediante OFFSET y LEN pertenezca a un componente. La escritura de varios
componentes al mismo tiempo puede no ser compatible con sistemas futuros y dificultar la
migrabilidad a sistemas de otros fabricantes.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SETIO_PART":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ID

Input

DWORD

I, Q, M, D, L o constante ‚óè low word: Direcci√≥n l√≥gica del esclavo
DP o componente PROFINET IO
(m√≥dulo)

OFFSET

Input

INT

I, Q, M, D, L o constante N√∫mero del primer byte que se debe escribir
en la memoria imagen de proceso del com‚Äê
ponente (valor m√°s peque√±o posible: 0)

LEN

Input

INT

I, Q, M, D, L o constante N√∫mero de caracteres que se van a escribir

STATUS

Output

DWORD

I, Q, M, D, L

‚óè high word: Irrelevante

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Contiene la informaci√≥n de error de "UBLK‚Äê
MOV" en la forma DW#16#40xxxx00, si
ERROR = TRUE.

5897

Instrucciones
4.2 Instrucciones
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ERROR

Output

BOOL

I, Q, M, D, L

Visualizaci√≥n de error:
ERROR = TRUE, en caso de que se pro‚Äê
duzca un error al llamar UBLKMOV.

OUTPUTS

InOut

ANY

I, Q, M, D

√Årea de origen para los datos que se deben
escribir:
‚óè Si el √°rea de origen es menor que LEN,
se transfieren todos los bytes que
OUTPUTS contiene. ERROR adquiere
el valor FALSE.
‚óè Si el √°rea de origen es mayor que LEN,
se transfieren los primerosLEN bytes de
OUTPUTS. ERROR adquiere el valor
FALSE.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros STATUS y ERROR
V√©ase la instrucci√≥n "UBLKMOV".

RALRM: Recibir alarma
Descripci√≥n de RALRM
Descripci√≥n
La instrucci√≥n recibe una alarma, junto con la informaci√≥n correspondiente, desde un m√≥dulo
de periferia (configuraci√≥n centralizada) o desde un componente de un esclavo DP o un
dispositivo PROFINET IO, y proporciona dicha informaci√≥n a trav√©s de sus par√°metros de
salida.
Los par√°metros de salida ofrecen tanto la informaci√≥n de arranque del OB llamado como
informaci√≥n procedente del origen de la alarma.
Esta instrucci√≥n debe llamarse solo dentro del OB de alarma que el sistema operativo de la
CPU ha iniciado debido a la alarma procedente de la periferia que se debe investigar.
Nota
Si se llama la instrucci√≥n en un OB cuyo evento de arranque no es una alarma procedente de
la periferia, la instrucci√≥n ofrecer√° al usuario menos informaci√≥n en sus salidas.
Si llama la instrucci√≥n en distintos OBS, aseg√∫rese de utilizar distintos DBs de instancia. Si se
van a evaluar los datos resultantes de una llamada de "RALRM" fuera del OB de alarma
correspondiente, es necesario incluso utilizar un DB de instancia independiente por cada
evento de arranque de OB.

5898

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nota
La interfaz de la instrucci√≥n "RALRM" es id√©ntica a la del FB "RALRM" definido en la norma
PROFIBUS and PROFINET Guideline Communication Function Blocks on PROFIBUS DP and
PROFINET IO.

Llamada de "RALRM"
Esta instrucci√≥n se puede llamar en tres modos de operaci√≥n (MODE) distintos, que se
describen en la tabla siguiente.
MODE

RALRM ...

0

... muestra el componente causante de la alarma en el par√°metro de salida ID, y en el
par√°metro de salida NEW escribe TRUE.

1

... escribe en todos los par√°metros de salida, sea cual sea el componente causante de la
alarma.

2

... comprueba si el componente especificado en el par√°metro de entrada F_ID es el cau‚Äê
sante de la alarma.
‚óè En caso negativo, NEW adquiere el valor FALSE.
‚óè En caso afirmativo, NEW adquiere el valor TRUE, y se escriben todos los dem√°s
par√°metros de salida.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RALRM":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

MODE

Input

INT

I, Q, M, D, L o constante Modo de operaci√≥n

F_ID

Input

DWORD

I, Q, M, D, L o constante Direcci√≥n l√≥gica inicial del componente (m√≥‚Äê
dulo) del que se deben recibir alarmas

MLEN

Input

INT

I, Q, M, D, L o constante Longitud m√°xima en bytes de la informaci√≥n
de alarmas que se desea recibir

NEW

Output

BOOL

I, Q, M, D, L

Se ha recibido una nueva alarma.

STATUS (P√°gi‚Äê
na 5901)

Output

DWORD

I, Q, M, D, L

C√≥digo de error de la instrucci√≥n o del maes‚Äê
tro DP

ID

Output

DWORD

I, Q, M, D, L

Direcci√≥n l√≥gica inicial del componente (m√≥‚Äê
dulo) del que se ha recibido una alarma
El bit 15 contiene la identificaci√≥n de E/S: 0
si es una direcci√≥n de entrada y 1 si es de
salida.

LEN

Output

INT

I, Q, M, D, L

Longitud de la informaci√≥n de alarma recibi‚Äê
da

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Descripci√≥n

5899

Instrucciones
4.2 Instrucciones
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

TINFO (P√°gi‚Äê
na 5905)

InOut

ANY

I, Q, M, D, L

(task information)
√Årea de destino para la informaci√≥n de
arranque del OB y la informaci√≥n adminis‚Äê
trativa
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro TINFO siempre re‚Äê
quiere que se especifiquen por completo los
par√°metros de DB (ej.: P#DB13.DBX0.0
byte 100). En las CPU S7-300 no est√° per‚Äê
mitido omitir un n√∫mero de DB expl√≠cito; de
lo contrario se genera un mensaje de error
en el programa de usuario.

AINFO (P√°gi‚Äê
na 5908)

InOut

ANY

I, Q, M, D, L

(alarm information)
√Årea de destino para informaci√≥n de enca‚Äê
bezado e informaci√≥n adicional de alarma
Para AINFO debe reservarse una longitud
de por lo menos MLEN bytes.
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro AINFO siempre re‚Äê
quiere que se especifiquen por completo los
par√°metros de DB (ej.: P#DB13.DBX0.0
byte 100). En las CPU S7-300 no est√° per‚Äê
mitido omitir un n√∫mero de DB expl√≠cito; de
lo contrario se genera un mensaje de error
en el programa de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Si se escoge un √°rea de destino TINFO o AINFO demasiado corta, la instrucci√≥n no puede
registrar toda la informaci√≥n.
Consulte tambi√©n: √Årea de destino TINFO y AINFO (P√°gina 5916).

5900

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro STATUS
Estructura del par√°metro STATUS
El par√°metro de salida STATUS contiene informaci√≥n de error. Si se interpreta como
ARRAY[1...4] OF BYTE , la informaci√≥n de error presenta la siguiente estructura:
Elemento de cam‚Äê Nombre
po

Significado

STATUS[1]

‚óè B#16#00, si no hay ning√∫n error

Function_Num

‚óè ID de funci√≥n de DPV1-PDU: En caso de error se
devuelve B#16#80 (al leer juego de datos: B#16#DE, al
escribir juego de datos: B#16#DF). Si no se utiliza ning√∫n
elemento de protocolo DPV1: B#16#C0.
STATUS[2]

Error_Decode

Ubicaci√≥n de la identificaci√≥n de error

STATUS[3]

Error_Code_1

Identificaci√≥n de error

STATUS[4]

Error_Code_2

Extensi√≥n espec√≠fica del fabricante de la identificaci√≥n de
error

Elemento de campo STATUS[2]
STATUS[2] puede adoptar los siguientes valores:
Error_Decode
(B#16#...)

Origen

Significado

00 a 7F

CPU

Ning√∫n error ni advertencia

80

DPV1

Error seg√∫n IEC 61158-6

81 a 8F

CPU

B#16#8x indica un error en el x par√°metro de llamada de la ins‚Äê
trucci√≥n.

FE, FF

DP Profile

Error espec√≠fico de perfil

Elemento de campo STATUS[3]
STATUS[3] puede adoptar los siguientes valores:
Error_Decode
(B#16#...)

Error_Code_1
(B#16#...)

00

00

70

00

reserved, re‚Äê
ject

Primera llamada; no hay ninguna transferencia
de juego de datos activa

01

reserved, re‚Äê
ject

Primera llamada; transferencia de juego de da‚Äê
tos iniciada

02

reserved, re‚Äê
ject

Llamada intermedia; transferencia del juego de
datos ya iniciada

90

reserved,
pass

Direcci√≥n l√≥gica inicial no v√°lida

80

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Explicaci√≥n
seg√∫n DPV1

Significado
Ning√∫n error ni advertencia

5901

Instrucciones
4.2 Instrucciones
Error_Decode
(B#16#...)

5902

Error_Code_1
(B#16#...)

Explicaci√≥n
seg√∫n DPV1

Significado

92

reserved,
pass

Tipo no admisible en puntero ANY

93

reserved,
pass

El componente DP direccionado mediante ID o
F_ID no est√° configurado.

95

Error al leer la informaci√≥n adicional de alarma
(con periferia central o con periferia descentrali‚Äê
zada a trav√©s de interfaz DP externa, este error
se emite como "Error de grupo".)
Nota: Al acoplar y sincronizar puede suceder que
la informaci√≥n adicional de alarma no est√© dis‚Äê
ponible temporalmente.

96

La CPU maestra ha pasado a STOP. En ese mo‚Äê
mento se estaba procesando un OB. La instruc‚Äê
ci√≥n "RALRM (P√°gina 5898)" no puede devolver
la informaci√≥n de arranque del OB, la informa‚Äê
ci√≥n administrativa, la informaci√≥n de encabeza‚Äê
do ni la informaci√≥n adicional de alarma.
La informaci√≥n de arranque del OB se puede leer
con la instrucci√≥n "RD_SINFO (P√°gina 6114)".
Adem√°s, para los OBs 4x, 55, 56, 57, 82 y 83 es
posible leer en modo asincr√≥nico con la instruc‚Äê
ci√≥n "DPNRM_DG (P√°gina 5956)" el telegrama
de diagn√≥stico actual del esclavo DP en cuesti√≥n
(informaci√≥n de direcci√≥n extra√≠da de la informa‚Äê
ci√≥n de arranque del OB).

A0

read error

Respuesta negativa al leer el m√≥dulo

A1

write error

Respuesta negativa al escribir en el m√≥dulo

A2

module failure Error de protocolo DP con Layer 2 (p. ej. fallo de
esclavo o fallos de bus)

A3

reserved,
pass

Error general de comunicaci√≥n o dispositivo IO /
esclavo DP no accesible

A4

reserved,
pass

Fallo de comunicaci√≥n en el bus K

A5

reserved,
pass

‚Äì

A7

reserved,
pass

El esclavo DP o el m√≥dulo est√° ocupado en otra
tarea (error temporal)

A8

version con‚Äê
flict

El esclavo DP o el m√≥dulo notifica versiones no
concordantes

A9

feature not
supported

Funci√≥n no soportada por el esclavo DP o el m√≥‚Äê
dulo

AA a AF

user specific

El esclavo DP o el m√≥dulo notifica un error espe‚Äê
c√≠fico de fabricante en su aplicaci√≥n. Consulte la
documentaci√≥n del fabricante del esclavo DP o el
m√≥dulo.

B0

invalid index

El m√≥dulo no conoce el juego de datos
No se admiten n√∫meros de juego de datos ‚â• 256

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Error_Decode
(B#16#...)

Error_Code_1
(B#16#...)

Explicaci√≥n
seg√∫n DPV1

Significado

B1

write length
error

La indicaci√≥n de longitud en el par√°metro RE‚Äê
CORD es err√≥nea;
‚óè Con "RALRM (P√°gina 5898)": Error de
longitud en AINFO,
‚óè Con "RDREC (P√°gina 5888)" y "WRREC
(P√°gina 5890)": Error de longitud en MLEN

B2

invalid slot

‚óè El slot configurado no est√° ocupado.
‚óè Para PROFINET IO y PROFIBUS DP:
Dispositivo IO / esclavo DP no accesible

B3

type conflict

El tipo de m√≥dulo real no coincide con el tipo de
m√≥dulo configurado

B4

invalid area

El esclavo DP o el m√≥dulo notifica un acceso a un
√°rea no autorizada.

B5

state conflict

El esclavo DP o el m√≥dulo no est√° listo

B6

access denied El esclavo DP o el m√≥dulo deniega el acceso

B7

invalid range

El esclavo DP o el m√≥dulo notifica un √°rea no
autorizada en un par√°metro o un valor

B8

invalid para‚Äê
meter

El esclavo DP o el m√≥dulo notifica un par√°metro
no autorizado

B9

invalid type

El esclavo DP o el m√≥dulo notifica un tipo no au‚Äê
torizado
‚óè Con "RDREC (P√°gina 5888)": B√∫fer
demasiado peque√±o (no es posible leer
porciones)
‚óè Con "WRREC (P√°gina 5890)": B√∫fer
demasiado peque√±o (no es posible escribir
porciones)

BA a BF

user specific

El esclavo DP o el m√≥dulo notifica un error espe‚Äê
c√≠fico de fabricante en el acceso. Consulte la do‚Äê
cumentaci√≥n del fabricante del esclavo DP o el
m√≥dulo.
Nota sobre el valor B#16#BA: con PROFINET en
el sistema H se aplica lo siguiente: si se rechaza
una orden de juego de datos con el valor de re‚Äê
torno W#16#80BA, debe repetirse la orden.

C0

read constrain Con "WRREC (P√°gina 5890)": Los datos solo
conflict
pueden escribirse en el estado STOP de la CPU.
Nota: En consecuencia, el programa de usuario
no puede escribir. Solo es posible escribir datos
online con la PG/el PC.
Con "RDREC (P√°gina 5888)": El juego de datos
est√° cargado en el m√≥dulo, pero todav√≠a no exis‚Äê
ten datos o los datos solo pueden leerse en el
estado STOP de la CPU. Nota: Si los datos solo
pueden leerse en el estado STOP de la CPU, el
programa de usuario no puede evaluarlos. En tal
caso solo es posible leer los datos online con la
PG/el PC.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5903

Instrucciones
4.2 Instrucciones
Error_Decode
(B#16#...)

Error_Code_1
(B#16#...)

Explicaci√≥n
seg√∫n DPV1

Significado

C1

write cons‚Äê
train conflict

Los datos de la orden de escritura efectuada an‚Äê
teriormente en el m√≥dulo para el mismo juego de
datos no han sido procesados todav√≠a por el m√≥‚Äê
dulo.

C2

resource busy En este momento el m√≥dulo est√° procesando el
m√°ximo posible de peticiones para una CPU.

C3

resource una‚Äê
vailable

C4

En este momento los recursos necesarios est√°n
ocupados.
Error temporal interno. No se ha podido ejecutar
la orden.
Repita la orden. Si este error se produce a me‚Äê
nudo, compruebe si hay fuentes de perturbaci√≥n
en la instalaci√≥n.

C5

El esclavo DP o el m√≥dulo no est√° disponible.

C6

Transferencia del juego de datos cancelada de‚Äê
bido a una interrupci√≥n de la clase de prioridad

C7

Interrupci√≥n de la orden debido a rearranque
completo (en caliente) o arranque en fr√≠o del
maestro DP

C8 bis CF

El esclavo DP o el m√≥dulo notifica a sus recursos
un error espec√≠fico de fabricante. Consulte la do‚Äê
cumentaci√≥n del fabricante del esclavo DP o el
m√≥dulo.

Dx
8x (x = 1, ... 9, A,
B, C, D, E, F)

00 a FF

user specific

Espec√≠fico de esclavo DP. Ver descripci√≥n del
esclavo DP.
Error en el par√°metro de llamada y (y = 1, ...15)
‚óè Error_Code_1 = 00: Modo de operaci√≥n no
admisible
‚óè Para todos los dem√°s valores de
Error_Code_1, consulte tambi√©n: Evaluaci√≥n
de errores con el par√°metro de salida
RET_VAL (P√°gina 174)

FE, FF

00 bis FF

Error espec√≠fico de perfil

Elemento de campo STATUS[4]
STATUS[4] es transferido por el maestro DP a la CPU y a la instrucci√≥n en caso de error de
DPV1. Sin error de DPV1, el valor se ajusta a 0 con las siguientes excepciones para las
instrucciones "RDREC (P√°gina 5888)" y "WRREC (P√°gina 5890)":
‚óè STATUS[4] contiene la longitud del √°rea de destino extra√≠da de RECORD, en caso de que
LEN > longitud del √°rea de destino extra√≠da de RECORD
‚óè STATUS[4]=LEN, si la longitud real del juego de datos < LEN < longitud del √°rea de destino
extra√≠da de RECORD
‚óè STATUS[4]=0, si se debiera ajustar STATUS[4] > 255
Con PROFINET IO STATUS[4] contiene el valor 0.

5904

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro TINFO
Estructura de datos del √°rea de destino TINFO
Byte

Significado

de 0 a 19

Informaci√≥n de arranque del OB en el que se ha llamado actualmente "RALRM"

20 y 21

Direcci√≥n y descripci√≥n exacta: ver abajo

de 22 a 31

Informaci√≥n administrativa y descripci√≥n exacta: ver abajo

Estructura de la direcci√≥n (bytes 20 y 21)
La direcci√≥n contiene:
‚óè En caso de configuraci√≥n centralizada, el n√∫mero de rack (0-31).
%LW

     

























1¬ºPHURGHUDFN



‚óè En caso de estructura descentralizada con PROFIBUS DP
‚Äì La ID del sistema maestro DP (1-32)
‚Äì El n√∫mero de estaci√≥n (0-127).
%LW

     



















1¬ºPHURGHHVWDFL¬µQ

,'GHOVLVWHPDPDHVWUR'3

‚óè En caso de estructura descentralizada con PROFINET IO
‚Äì Las dos √∫ltimas posiciones de la ID del sistema PROFINET IO (0-15); para obtener la ID
del sistema PROFINET IO completa, sume 100 (decimal)
‚Äì El n√∫mero de estaci√≥n (0-2047).
%LW

     



Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

,'GHVLVWHPD,2





















1¬ºPHURGHHVWDFL¬µQ

5905

Instrucciones
4.2 Instrucciones

Estructura de la informaci√≥n administrativa, bytes 20 a 25
N√∫mero
Tipo de
de byte pa‚Äê datos
ra TINFO

Significado

20

Centrali‚Äê
zado:

0

Descen‚Äê
tralizado:

PROFIBUS DP: La ID del sistema maestro DP (valores posibles: de 1 a 32)

BYTE

PROFINET IO: ver arriba
21

BYTE

Centrali‚Äê
zado:

N√∫mero de rack (valores posibles: de 0 a 31)

Descen‚Äê
tralizado:

N√∫mero de la estaci√≥n DP (valores posibles: de 0 a 127)
PROFINET IO: ver arriba

22

BYTE

Centrali‚Äê
zado:

‚óè 0: Registro 0 o registro 1

Descen‚Äê
tralizado:

bits de 0 a 3:

Tipo de
esclavo

0000:
0001:
0010:
0011:
0100 ‚Äì 0111:
1000:
a partir de 1001:

‚óè bits de 4 a 7:

23

BYTE

Centrali‚Äê
zado:

‚óè 0

Descen‚Äê
tralizado:

‚óè bits de 0 a 3:

‚óè bits de 4 a 7:

5906

Tipo de
perfil

Tipo de informa‚Äê
ci√≥n de alarma

Versi√≥n de la es‚Äê
tructura

DP (estructura registro 0)
DPS7 (estructura registro 0 o re‚Äê
gistro 1)
DPS7 V1 (estructura registro 0 o
registro 1)
DPV1 (estructura seg√∫n est√°ndar
PROFIBUS DP)
reservado
PROFINET IO (estructura seg√∫n
est√°ndar PROFINET IO)
reservado
Reservado

0000:

Transparente, como siempre
con PROFINET IO
(la alarma procede de un m√≥‚Äê
dulo descentralizado configura‚Äê
do)

0001:

Representante
(alarma de un esclavo no
DPV1/un dispositivo no IO o de
un slot no configurado)

0010:

Generada
(alarma generada en la CPU)

a partir de
0011:

Reservado

0000:

Inicial

a partir de
0001:

Reservado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
N√∫mero
Tipo de
de byte pa‚Äê datos
ra TINFO

Significado

24

Centrali‚Äê
zado:

‚óè 0

Descen‚Äê
tralizado:

Flags de la interfaz de maestro PROFIBUS DP/interfaz de controlador PROFINET IO

25

BYTE

BYTE

Bit 0 = 0:

Alarma procedente de una interfaz integrada (PROFINET IO o
PROFIBUS DP)

Bit 0 = 1:

Alarma procedente de una interfaz externa (PROFINET IO o
PROFIBUS DP)

Bits de 1 a 7:

Reservado

Centrali‚Äê
zado:

‚óè 0

Descen‚Äê
tralizado:

Flags de la interfaz de esclavo PROFIBUS DP
EXT_DIAG_FLAG del telegrama de diagn√≥stico, o 0 si este bit no
est√° presente en la alarma.

‚óè Bit 0:

El bit es 1 si el esclavo DP tiene un fallo.
‚óè Bits de 1 a 7:

Reservado

Flags de la interfaz del controlador PROFINET IO
ARDiagnosisstate o 0, si no hay informaci√≥n en la alarma.

‚óè Bit 0:

El bit es 1 si el dispositivo IO tiene un fallo.
‚óè Bits de 1 a 7:

Reservado

Estructura de la informaci√≥n administrativa de los bytes 26 a 27 con PROFIBUS y con configuraci√≥n
centralizada
N√∫mero de byte
para TINFO

Tipo de da‚Äê
tos

Significado

26 y 27

WORD

Centralizado:

WORD

Descentraliza‚Äê N√∫mero de identificaci√≥n de PROFIBUS como identi‚Äê
do:
ficaci√≥n un√≠voca del esclavo PROFIBUS DP

28 y 29

WORD

0

(Pueden omitirse los bytes 28 y 29)

30 y 31

WORD

0

(Pueden omitirse los bytes 30 y 31)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

0

5907

Instrucciones
4.2 Instrucciones

Estructura de la informaci√≥n administrativa, bytes 26 a 31 con PROFINET IO
N√∫mero de byte
para TINFO

Tipo de da‚Äê
tos

Significado

26 y 27

WORD

Descentraliza‚Äê N√∫mero de identificaci√≥n del dispositivo PROFINET
do:
IO como identificaci√≥n un√≠voca del dispositivo

28 y 29

WORD

Descentraliza‚Äê Identificaci√≥n de fabricante
do:

30 y 31

WORD

Descentraliza‚Äê N√∫mero de identificaci√≥n de la instancia
do:

Par√°metro AINFO
Estructura de datos del √°rea de destino AINFO con alarmas de PROFIBUS DP o periferia centralizada
Encontrar√° los datos para PROFINET IO m√°s abajo.
Byte

Significado

de 0 a 3

Informaci√≥n de encabezado y descripci√≥n exacta: ver abajo

de 4 a 199

Informaci√≥n adicional de alarma: Datos sobre la alarma en cuesti√≥n:
Centralizado:

ARRAY[0] a ARRAY[195]

Descentralizado: ARRAY[0] a ARRAY[59]

Estructura de la informaci√≥n de encabezado con alarmas de PROFIBUS DP o periferia centralizada
Byte

Tipo de da‚Äê Significado
tos

0

BYTE

Longitud en bytes de la informaci√≥n de alarma recibida
Centralizado: de 4 a 224
Descentrali‚Äê
zado:

1

BYTE

Centralizado: Reservado
Descentrali‚Äê
zado:

2

5908

BYTE

de 4 a 63

Identificador del tipo de alarma
1:
2:
3:
4:
5:
6:
31

Alarma de diagn√≥stico
Alarma de proceso
Alarma de extracci√≥n
Alarma de inserci√≥n
Alarma de estado
Alarma de actualizaci√≥n
Fallo de un aparato de ampliaci√≥n, un siste‚Äê
ma maestro DP o una estaci√≥n DP

de 32 a 126:

Alarma espec√≠fica de fabricante

N√∫mero de slot del componente causante de la alarma

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Byte

Tipo de da‚Äê Significado
tos

3

BYTE

Centralizado: Reservado
Descentrali‚Äê
zado:

Specifier
Bits 0 y 1:

0: No hay m√°s informaci√≥n;
1: Evento entrante, slot con fallo
2: Evento saliente, slot ya sin fallo
3: Evento entrante, slot sigue con fallo

Bit 2:

Add_Ack

Bits de 3 a 7:

N√∫mero de secuencia

Estructura de datos del √°rea de destino AINFO con alarmas de PROFINET IO
Byte

Significado

de 0 a 25

Informaci√≥n de encabezado y descripci√≥n exacta: ver abajo

de 26 a 1431 Informaci√≥n adicional de alarma: Datos de diagn√≥stico normalizados sobre la alarma en
cuesti√≥n:
ARRAY[0] a ARRAY[1405]
Nota: La informaci√≥n adicional de alarma tambi√©n puede omitirse.

Estructura de la informaci√≥n de encabezado con alarmas de PROFINET IO
Byte

Tipo de datos

Significado

0y1

WORD

‚óè Bits de 0 a 7: Tipo de bloque

2y3

WORD

Longitud del bloque

4y5

WORD

Versi√≥n:

‚óè Bits de 8 a 15: Reservado

‚óè Bits de 0 a 7: low byte
‚óè Bits de 8 a 15: high byte

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5909

Instrucciones
4.2 Instrucciones
Byte

Tipo de datos

Significado

6y7

WORD

Identificador del tipo de alarma:
‚óè 1: Alarma de diagn√≥stico (entrante)
‚óè 2: Alarma de proceso
‚óè 3: Alarma de extracci√≥n
‚óè 4: Alarma de inserci√≥n
‚óè 5: Alarma de estado
‚óè 6: Alarma de actualizaci√≥n
‚óè 7: Alarma de redundancia
‚óè 8: Controlado por el Supervisor (Controlled_by_Supervisor)
‚óè 9: Habilitado por el Supervisor (Released_by_Supervisor)
‚óè 10: No se ha insertado el m√≥dulo configurado
‚óè 11: Retorno del subm√≥dulo
‚óè 12: Alarma de diagn√≥stico (saliente)
‚óè 13: Aviso de conexi√≥n para comunicaci√≥n directa
‚óè 14: Aviso de cambio de vecindario
‚óè 15: Aviso de sincronizaci√≥n de ciclo (desde el bus)
‚óè 16: Aviso de sincronizaci√≥n de ciclo (desde el dispositivo)
‚óè 17: Aviso de componente de red
‚óè 18: Aviso de sincronizaci√≥n de reloj (desde el bus)
‚óè de 19 a 31: Reservado
‚óè de 32 a 127: Alarma espec√≠fica de fabricante
‚óè de 128 a 65535: Reservado

5910

de 8 a 11

DWORD

API (Application Process Identifier)

de 12 a 13

WORD

N√∫mero de slot del componente que dispara la alarma (rango de valores
de 0 a 65535)

de 14 a 15

WORD

N√∫mero de slot de subm√≥dulo del componente que dispara la alarma
(rango de valores de 0 a 65535)

de 16 a 19

DWORD

Identificaci√≥n de m√≥dulo; informaci√≥n un√≠voca del origen de la alarma

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Byte

Tipo de datos

Significado

de 20 a 23

DWORD

Identificaci√≥n de subm√≥dulo; informaci√≥n un√≠voca del origen de la alarma

de 24 a 25

WORD

Alarm Specifier:
‚óè Bits de 0 a 10: N√∫mero de secuencia (rango de valores de 0 a 2047)
‚óè Bit 11: Diagn√≥stico de canal:
0: No hay ning√∫n diagn√≥stico de canal
1: Hay diagn√≥stico de canal
‚óè Bit 12: Estado de diagn√≥stico espec√≠fico de fabricante:
0: No hay ninguna informaci√≥n de estado espec√≠fica de fabricante
1: Hay informaci√≥n de estado espec√≠fica de fabricante
‚óè Bit 13: Estado del diagn√≥stico en el subm√≥dulo:
0: No hay informaci√≥n de estado, se han eliminado todos los errores
1: Hay por lo menos un diagn√≥stico de canal y/o una informaci√≥n de
estado
‚óè Bit 14: Reservado
‚óè Bit 15: Application Relationship Diagnosis State:
‚Äì

0: Ninguno de los m√≥dulos configurados dentro de esta AR
notifica un diagn√≥stico

‚Äì

1: Por lo menos uno de los m√≥dulos configurados dentro de esta
AR notifica un diagn√≥stico

Estructura de la informaci√≥n adicional de alarma con alarmas de PROFINET IO
La informaci√≥n adicional de alarma con PROFINET IO depende del especificador de formato.
Puede estar compuesta por varios bloques de datos con el mismo o distinto especificador de
formato. Son posibles los siguientes especificadores de formato:
‚óè W#16#0000 a W#16#7FFF: Diagn√≥stico espec√≠fico de fabricante
Byte

Tipo de da‚Äê Significado
tos

de 0 a 1

WORD

Identificaci√≥n de formato para la estructura de los datos que siguen como
informaci√≥n adicional de alarma:

de 2 a n

BYTE

Ver manual del fabricante.

W#16#0000 a W#16#7FFF: Diagn√≥stico espec√≠fico de fabricante

‚óè W#16#8000: Diagn√≥stico de canal
El diagn√≥stico de canal se emite en bloques de 6 bytes cada uno. La informaci√≥n adicional
de alarma (sin especificador de formato) se emite solo para los canales que presentan
fallos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5911

Instrucciones
4.2 Instrucciones

Byte

Tipo de da‚Äê Significado
tos

de 0 a 1

WORD

Identificaci√≥n de formato para la estructura de los datos que siguen como
informaci√≥n adicional de alarma:
W#16#8000: Diagn√≥stico de canal

de 2 a 3

WORD

N√∫mero de canal del componente que dispara la alarma (rango de valores de
0 a 65535):
‚óè W#16#0000 a W#16#7FFF: N√∫mero de canal del subm√≥dulo/m√≥dulo
‚óè W#16#8000: es el representante para todo el subm√≥dulo
‚óè W#16#8001 a W#16#FFFF: Reservado

4

BYTE

Bits de 0 a 2: Reservado
Bits de 3 a 4: Tipo de error:
‚óè 0: Reservado
‚óè 1: Error entrante
‚óè 2: Error saliente
‚óè 3: Error saliente, hay m√°s errores
Bits de 5 a 7: Tipo de canal:
‚óè 0: Reservado
‚óè 1: Canal de entrada
‚óè 2: Canal de salida
‚óè 3: Canal de entrada/salida

5912

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Byte

Tipo de da‚Äê Significado
tos

5

BYTE

Formato de datos:
‚óè B#16#00: Formato de datos libre
‚óè B#16#01: Bit
‚óè B#16#02: 2 bits
‚óè B#16#03: 4 bits
‚óè B#16#04: Byte
‚óè B#16#05: Palabra
‚óè B#16#06: Palabra doble
‚óè B#16#07: 2 palabras dobles
‚óè B#16#08 a B#16#FF: Reservado

de 6 a 7

WORD

Tipo de error:
‚óè W#16#0000: reservado
‚óè W#16#0001: Cortocircuito
‚óè W#16#0002: Subtensi√≥n
‚óè W#16#0003: Sobretensi√≥n
‚óè W#16#0004: Sobrecarga
‚óè W#16#0005: Sobretemperatura
‚óè W#16#0006: Rotura de hilo
‚óè W#16#0007: Rebase del l√≠mite superior
‚óè W#16#0008: Rebase del l√≠mite inferior
‚óè W#16#0009: Error
‚óè W#16#000A a W#16#000F: Reservado
‚óè W#16#0010 a W#16#001F: Espec√≠fico de fabricante
‚óè W#16#0020 a W#16#00FF: Reservado
‚óè W#16#0100 a W#16#7FFF: Espec√≠fico de fabricante
‚óè W#16#8000: Hay diagn√≥stico de dispositivo
‚óè W#16#8001 a W#16#FFFF: Reservado
No todos los canales soportan todos los tipos de error. Encontrar√° m√°s deta‚Äê
lles en la descripci√≥n de los datos de diagn√≥stico del dispositivo correspon‚Äê
diente.

Nota
La parte de "N√∫mero de canal" a "Tipo de error" puede aparecer entre 0 y n veces.

W#16#8001
W#16#8001: MULTIPLE (se transfieren distintos tipos de informaci√≥n de diagn√≥stico)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5913

Instrucciones
4.2 Instrucciones
En este caso, la informaci√≥n adicional de alarma se transfiere en estructura de bloque con
longitud variable.
Byte

Tipo de da‚Äê Significado
tos

de 0 a 1

WORD

Especificador de formato para la estructura de los datos que siguen como
informaci√≥n adicional de alarma:
W#16#8001: Diagn√≥stico espec√≠fico de fabricante y/o diagn√≥stico de canal

de 2 a 3

WORD

Tipo de bloque

de 4 a 5

WORD

Longitud del bloque

6

BYTE

Versi√≥n: high byte

7

BYTE

Versi√≥n: low byte

de 8 a 11 DWORD

API (solo si el low byte de la versi√≥n = 1)

de 12 a
13

WORD

N√∫mero de slot

de 14 a
15

WORD

N√∫mero de subslot

de 16 a
17

WORD

N√∫mero de canal

de 18 a
19

WORD

Propiedades de canal

de 20 a
21

WORD

Identificaci√≥n de formato:
‚óè W#16#0000 a W#16#7FFF: Diagn√≥stico espec√≠fico de fabricante
‚óè W#16#8000: Diagn√≥stico de canal
‚óè W#16#8002: Diagn√≥stico avanzado de canal
‚óè W#16#8003: Diagn√≥stico avanzado de canal graduado
‚óè W#16#8004 a W#16#80FF: Reservado

de 22 a n BYTE

Datos en funci√≥n del especificador de formato

Nota
La parte a partir de "Tipo de bloque" puede aparecer entre 1 y n veces.

W#16#8002
W#16#8002: Diagn√≥stico avanzado de canal

5914

Byte

Significado

de 0 a 1

Identificaci√≥n de formato W#16#8002

de 2 a 3

N√∫mero de canal

de 4 a 5

Propiedades de canal

de 6 a 7

Tipo de error

de 8 a 9

Valor adicional de error

de 10 a 13

Informaci√≥n adicional de error

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

W#16#8003
W#16#8003: Diagn√≥stico avanzado de canal graduado
Byte

Significado

de 0 a 1

Identificaci√≥n de formato W#16#8003

de 2 a 3

N√∫mero de canal

de 4 a 5

Propiedades de canal

de 6 a 7

Tipo de error

de 8 a 9

Valor de error adicional

de 10 a 13

Informaci√≥n adicional de error

de 14 a 17

Qualified Channel Qualifier

W#16#8100
W#16#8100: Informaci√≥n de mantenimiento
Byte

Significado

de 0 a 1

Identificaci√≥n de formato W#16#8100

de 2 a 3

Tipo de bloque

de 4 a 5

Longitud del bloque

de 6 a 7

Versi√≥n del bloque

de 8 a 9

Reservado

de 10 a 13

Estado de mantenimiento

Nota
Encontrar√° informaci√≥n m√°s detallada sobre la estructura de la informaci√≥n adicional de
alarma en el Manual de programaci√≥n SIMATIC PROFINET IO De PROFIBUS DP a
PROFINET IO y en la versi√≥n m√°s reciente de la norma IEC 61158-6-10-1.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5915

Instrucciones
4.2 Instrucciones

√Årea de destino TINFO y AINFO
√Årea de destino TINFO y AINFO
En funci√≥n del OB en el que se llame la instrucci√≥n "RALRM", se escribe solo parcialmente en
las √°reas de destino TINFO y AINFO. La tabla siguiente describe la informaci√≥n que se registra
en cada caso.
Tipo de alarma

OB

TINFO
Informaci√≥n
de estado de
OB

TINFO
Informaci√≥n ad‚Äê
ministrativa

AINFO
Informaci√≥n
de encabeza‚Äê
do

AINFO
Informaci√≥n de alarma adicional

Alarma de proceso

4x

S√≠

S√≠

S√≠

Centralizado:

No

Descentraliza‚Äê Igual que la proporcio‚Äê
do:
nada por el esclavo
PROFIBUS DP/dispo‚Äê
sitivo PROFINET IO
Alarma de estado

55

S√≠

S√≠

S√≠

S√≠

S√≠

Alarma de actualiza‚Äê
ci√≥n

56

S√≠

S√≠

S√≠

S√≠

S√≠

Alarma espec√≠fica de
fabricante

57

S√≠

S√≠

S√≠

S√≠

S√≠

Error de redundancia
de la periferia

70

S√≠

S√≠

No

No

No

Alarma de diagn√≥stico 82

S√≠

S√≠

S√≠

Centralizado:

Registro 1

Descentraliza‚Äê Igual que la proporcio‚Äê
do:
nada por el esclavo
PROFIBUS DP/dispo‚Äê
sitivo PROFINET IO
Alarma
de extracci√≥n/inser‚Äê
ci√≥n

83

S√≠

S√≠

S√≠

Centralizado:

No

Alarma de extracci√≥n
especial:

83

S√≠

S√≠

S√≠

Solo PROFINET IO

83

S√≠

S√≠

S√≠

Solo PROFINET IO

Se ha insertado un m√≥‚Äê 83
dulo no configurado

S√≠

S√≠

S√≠

Solo PROFINET IO

Fallo de rack/
fallo de estaci√≥n

S√≠

S√≠

No

No

S√≠

No

No

No

Descentraliza‚Äê Igual que la proporcio‚Äê
do:
nada por el esclavo
PROFIBUS DP/dispo‚Äê
sitivo PROFINET IO

Controlada por el su‚Äê
pervisor
Alarma de inserci√≥n
especial:
Habilitada por el super‚Äê
visor

86

... Todos los dem√°s OBs

5916

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

D_ACT_DP: Activar / desactivar esclavos DP
Descripci√≥n
La instrucci√≥n "D_ACT_DP" permite desactivar y volver a activar de forma selectiva esclavos
DP o dispositivos PROFINET IO configurados. Adem√°s es posible averiguar, para cada
esclavo DP o dispositivo PROFINET IO utilizado, si el componente en cuesti√≥n est√° activado
o desactivado en un determinado momento.
Si se desactiva con esta instrucci√≥n una gateway del tipo IE/PB Link PN IO, se desactivar√°n
tambi√©n todos los esclavos PROFIBUS DP conectados a ella. Estas desactivaciones se
notifican.
Esta instrucci√≥n no se puede usar en aparatos de campo PROFIBUS PA que est√©n
conectados mediante DP/PA Link a un sistema maestro DP.
Nota
Mientras est√©n activas una o varias peticiones "D_ACT_DP", no es posible cargar de la
programadora a la CPU ninguna configuraci√≥n modificada (en el marco de CiR).
Durante la carga de una configuraci√≥n modificada de la programadora a la CPU durante el
funcionamiento (CiR), la CPU rechaza la activaci√≥n de las peticiones "D_ACT_DP".
Para procesar una petici√≥n de desactivaci√≥n o activaci√≥n se requieren varios pasos por el
punto de control de ciclo. Por ello no es posible esperar la finalizaci√≥n de una petici√≥n de este
tipo dentro de un bucle programado.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "D_ACT_DP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control disparado por nivel
REQ=1:
Realizar activaci√≥n o desactivaci√≥n

MODE

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificador de petici√≥n
Valores posibles:
‚óè 0: Conocer si el
componente llamado est√° activado
o desactivado
‚óè 1: Activar esclavo DP o dispositivo
PROFINET IO
‚óè 2: Desactivar esclavo DP o dispositivo
PROFINET IO
‚óè 3: Activar esclavo DP o dispositivo
PROFINET IO y llamar el OB 86 una vez
cambiado el estado de activaci√≥n
‚óè 4: Desactivar esclavo DP o dispositivo
PROFINET IO y llamar el OB 86 una vez
cambiado el estado de activaci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5917

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Cualquier direcci√≥n l√≥gica del esclavo DP o el
dispositivo PROFINET IO. Si se trata de una
direcci√≥n de salida, debe estar activado el bit
m√°s significativo.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

Identificaci√≥n de componente activo:
‚óè BUSY=1: la petici√≥n todav√≠a est√° activa.
‚óè BUSY=0: la petici√≥n ha finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

La petici√≥n se ha ejecutado sin errores.

0001

El esclavo DP o dispositivo PROFINET IO est√° activado (este c√≥digo de error solo es posible con MO‚Äê
DE = 0.)

0002

El esclavo DP o dispositivo PROFINET IO est√° desactivado (este c√≥digo de error solo es posible con
MODE = 0.)

7000

Primera llamada con REQ= 0. La petici√≥n definida mediante LADDR no est√° activa; BUSY tiene el valor
"0".

7001

Primera llamada con REQ= 1. Se ha lanzado la petici√≥n definida mediante LADDR; BUSY tiene el valor
"1".

7002

Llamada intermedia (REQ irrelevante). La petici√≥n activada todav√≠a est√° proces√°ndose; BUSY tiene el
valor "1".

8090

‚óè No se ha configurado un m√≥dulo con la direcci√≥n especificada en LADDR.
‚óè Se est√° utilizando la CPU como esclavo I y se ha indicado en LADDR una direcci√≥n de este esclavo
I.

8092

El proceso de desactivaci√≥n en curso de un esclavo DP o un dispositivo PROFINET IO (MODE=2) no se
puede interrumpir activ√°ndolo (MODE=1). Active el componente en otro momento.

8093

No hay ning√∫n esclavo DP o dispositivo PROFINET IO asignado a la direcci√≥n indicada en LADDR (no hay
configuraci√≥n), o el par√°metro MODE es desconocido.

8094

Se ha intentado activar un dispositivo que podr√≠a ser interlocutor de un puerto de cambio de herramienta.
Sin embargo, en este momento hay otro dispositivo activado en ese puerto de cambio de herramienta. El
dispositivo activado permanece activado.

80A1

No se ha podido parametrizar el componente llamado. (Este c√≥digo de error solo es posible con MO‚Äê
DE = 1.)
Nota:
Esta informaci√≥n de error devuelve "D_ACT_DP" solo si este componente vuelve a fallar durante la pa‚Äê
rametrizaci√≥n del esclavo o dispositivo activado. Si solo ha fallado la parametrizaci√≥n de un √∫nico m√≥dulo,
"D_ACT_DP" devuelve la informaci√≥n de error W#16#0000.

5918

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
80A2

El esclavo DP llamado no responde (esta informaci√≥n de error no existe para dispositivos PROFINET IO.
En PROFINET no existe vigilancia de tiempo para este proceso.).

80A3

El maestro DP o controlador PROFINET IO afectado no soporta esta funci√≥n.

80A4

La CPU no soporta esta funci√≥n para maestros DP o controladores PROFINET IO externos.

80A6

Error de slot en el esclavo DP o dispositivo PROFINET IO; no se puede acceder a todos los datos √∫tiles
(este c√≥digo de error solo es posible con MODE=1.)
Nota:
"D_ACT_DP" devuelve esta informaci√≥n de error solo si el componente vuelve a fallar despu√©s de la
parametrizaci√≥n del componente activado y antes del final de "D_ACT_DP". Si solo hay un m√≥dulo no
disponible, "D_ACT_DP" devuelve la informaci√≥n de error W#16#0000.

80C1

"D_ACT_DP" se ha iniciado y se contin√∫a con otra direcci√≥n l√≥gica (este c√≥digo de error es posible con
MODE=1 y MODE=2).

80C3

‚óè Error temporal de recursos: En este momento la CPU est√° procesando el m√°ximo posible de
peticiones de activaci√≥n/desactivaci√≥n. (Este c√≥digo de error solo es posible con MODE = 1 y
MODE = 2.)
‚óè La CPU est√° recibiendo una configuraci√≥n modificada. Debido a ello, en este momento no es posible
desactivar ni activar esclavos DP o dispositivos PROFINET IO.

80C5

DP: Las peticiones todav√≠a no recogidas por el usuario se descartan en el rearranque.

80C6

PROFINET: Las peticiones todav√≠a no recogidas por el usuario se descartan en el rearranque.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Campo de aplicaci√≥n
Si en una de las CPU se configuran esclavos DP o dispositivos PROFINET IO que no existen
realmente o que actualmente no se necesitan, la CPU acceder√° de todos modos con
regularidad a dichos esclavos DP o dispositivos PROFINET IO. Una vez desactivados dichos
componentes, la CPU no vuelve a acceder a ellos. Con PROFIBUS DP, esto permite obtener
el ciclo de bus DP m√°s r√°pido posible, y evita adem√°s la aparici√≥n de los correspondientes
eventos de error.

Ejemplos
En la fabricaci√≥n de m√°quinas en serie, el fabricante dispone de una gran cantidad de opciones
de m√°quina. Sin embargo, cada m√°quina suministrada contiene una combinaci√≥n √∫nica de
opciones seleccionadas.
Todas las opciones de m√°quina posibles son configuradas por el fabricante como esclavos DP
o dispositivos PROFINET IO, a fin de poder crear y llevar un programa de usuario com√∫n para
todas las opciones posibles. Con "D_ACT_DP" es posible desactivar en el arranque de la
m√°quina todos los esclavos DP o dispositivos PROFINET IO que no est√©n presentes en la
configuraci√≥n real.
Algo similar sucede en el caso de las m√°quinas herramienta, que ofrecen una amplia gama de
herramientas pero solo utilizan unas pocas en cada momento concreto. En estos casos, las
herramientas se configuran como esclavos DP o dispositivos PROFINET IO. Con ayuda de
"D_ACT_DP", el programa de usuario activa las herramientas requeridas en cada momento y
desactiva las que no se van a utilizar hasta m√°s adelante.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5919

Instrucciones
4.2 Instrucciones

Funcionamiento
"D_ACT_DP" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se extiende a lo largo de
varias llamadas. Para iniciar la petici√≥n, debe llamarse "D_ACT_DP" con REQ=1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY .
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).

Identificaci√≥n de una petici√≥n
Si se ha lanzado una petici√≥n de desactivaci√≥n o activaci√≥n y se vuelve a llamar "D_ACT_DP"
antes de que finalice, el comportamiento posterior de la instrucci√≥n depende esencialmente de
si la nueva llamada corresponde a la misma petici√≥n. Si el par√°metro de entrada LADDR
coincide, la llamada se considera una llamada consecutiva.

Desactivar esclavos DP o dispositivos PROFINET IO
Si se desactiva un esclavo DP o un dispositivo PROFINET IO con "D_ACT_DP", sus salidas de
proceso se ajustan a los valores sustitutivos configurados, o a 0 (estado seguro). A partir de
entonces, el correspondiente maestro DP o controlador PROFINET IO no volver√° a llamar ese
componente. Los esclavos DP o dispositivos PROFINET IO desactivados no se identifican
como averiados o ausentes en los LEDs de error del maestro DP o controlador PROFINET IO
ni de la CPU.
La memoria imagen de proceso de las entradas de los esclavos DP o dispositivos PROFINET
IO desactivados se actualiza con 0, es decir, se act√∫a como si se tratase de esclavos DP o
dispositivos PROFINET IO averiados.
Si en el programa se accede mediante acceso directo a los datos √∫tiles de un esclavo DP o
dispositivo PROFINET IO desactivado anteriormente, se llama el OB de error de acceso a la
periferia (OB 122) y se guarda en el b√∫fer de diagn√≥stico el correspondiente evento de
arranque. Si mediante una instrucci√≥n (p. ej. "RD_REC (P√°gina 5922)") se accede a un esclavo
DP o dispositivo PROFINET IO desactivado, se recibe en RET_VAL la misma informaci√≥n de
error que con un esclavo DP o dispositivo PROFINET IO no disponible.
La desactivaci√≥n de un esclavo DP o un dispositivo PROFINET IO no ocasiona el arranque del
OB de error de ejecuci√≥n del programa (OB 85), aunque las entradas y salidas de √©ste
pertenezcan a la memoria imagen de proceso que debe actualizarse por el sistema. Tampoco
se realiza una entrada en el b√∫fer de diagn√≥stico.
Para que la desactivaci√≥n de un esclavo DP o dispositivo PROFINET IO d√© lugar al arranque
del OB de fallo del rack (OB 86) y a un registro en el b√∫fer de diagn√≥stico, debe ajustarse el
par√°metro MODE :
‚óè MODE = 2: no se arranca el OB 86 ni se realiza una entrada en el b√∫fer de diagn√≥stico
‚óè MODE = 4: se arranca el OB 86 y se realiza una entrada en el b√∫fer de diagn√≥stico
Si una estaci√≥n DP o PNIO falla despu√©s de haberla desactivado con "D_ACT_DP", el sistema
operativo no reconoce el fallo. En consecuencia, no se arranca el OB 86 ni se realiza un
registro en el b√∫fer de diagn√≥stico.
Para PROFIBUS DP se aplica lo siguiente: Si se desea desactivar un esclavo DP que participa
como emisor en la comunicaci√≥n directa, se recomienda desactivar en primer lugar los

5920

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
receptores que comparten los datos que el emisor env√≠a a su maestro DP. Una vez hecho esto
ya se puede desactivar el emisor.

Activar esclavos DP o dispositivos PROFINET IO
Si se vuelve a activar un esclavo DP o dispositivo PROFINET IO con "D_ACT_DP", este
componente es configurado y parametrizado por el correspondiente maestro DP o controlador
PROFINET IO (igual que cuando se recupera una estaci√≥n DP o PROFINET IO tras un fallo).
La activaci√≥n ha finalizado cuando el componente est√° ya en disposici√≥n de transferir datos
√∫tiles.
La activaci√≥n de un esclavo DP o un dispositivo PROFINET IO no ocasiona el arranque del OB
de error de ejecuci√≥n del programa (OB 85), aunque las entradas y salidas de √©ste
pertenezcan a la memoria imagen de proceso que debe actualizarse por el sistema. Tampoco
se realiza una entrada en el b√∫fer de diagn√≥stico.
Para que la desactivaci√≥n de un esclavo DP o dispositivo PROFINET IO d√© lugar al arranque
del OB de fallo del rack (OB 86) y a un registro en el b√∫fer de diagn√≥stico, debe ajustarse el
par√°metro MODE :
‚óè MODE = 1: no se arranca el OB 86 ni se realiza una entrada en el b√∫fer de diagn√≥stico
‚óè MODE = 3: se arranca el OB 86 y se realiza una entrada en el b√∫fer de diagn√≥stico
Si se intenta activar con "D_ACT_DP" un esclavo DP desactivado que ha sido desconectado
f√≠sicamente del bus DP, la instrucci√≥n env√≠a al cabo de aproximadamente un minuto el c√≥digo
de error W#16#80A2, y el esclavo DP permanece desactivado. Si en un momento posterior el
esclavo vuelve a estar conectado con el bus DP, es necesario activarlo de nuevo mediante
"D_ACT_DP".
Si se intenta activar un dispositivo PROFINET IO que est√° desconectado f√≠sicamente del bus
PN, "D_ACT_DP" permanece activa. A diferencia de lo que sucede con los esclavos DP, no se
produce una cancelaci√≥n autom√°tica una vez transcurrido un tiempo determinado. La petici√≥n
en curso debe interrumpirse manualmente.
Nota
La activaci√≥n de un esclavo DP o un dispositivo PROFINET IO puede tomar un tiempo
considerable. Para cancelar una petici√≥n de activaci√≥n en curso, debe iniciarse "D_ACT_DP"
con el mismo valor para LADDR y MODE = 2. Debe repetirse la llamada de "D_ACT_DP" con
MODE = 2 tantas veces como sea necesario hasta que se se√±alice, mediante RET_VAL = 0,
que se ha cancelado la petici√≥n de activaci√≥n.
Si se desea activar esclavos DP que participan en la comunicaci√≥n directa, se recomienda
activar primero los emisores y luego los receptores (oyentes).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5921

Instrucciones
4.2 Instrucciones

Arranque de la CPU
El sistema operativo de la CPU muestra distintos comportamientos en los distintos tipos de
arranque en relaci√≥n con los esclavos DP o dispositivos PROFINET IO:
‚óè En los tipos de arranque "arranque en fr√≠o" y "rearranque completo (en caliente)", los
esclavos o dispositivos desactivados se activan de nuevo autom√°ticamente.
‚Äì En el S7-400: La activaci√≥n de los esclavos DP o dispositivos PROFINET IO puede
requerir alg√∫n tiempo. La CPU arranca a pesar ello, y se producen errores de acceso a
la periferia hasta finalizar la activaci√≥n. La reacci√≥n de la CPU depende de la
parametrizaci√≥n (llamada del OB 85 en caso de errores de acceso a la periferia) y del
programa del OB 85. No es posible suprimir estos errores de acceso a la periferia.
‚Äì En el S7-300: La activaci√≥n de los esclavos DP o dispositivos PROFINET IO puede
requerir alg√∫n tiempo. En este caso, la CPU espera hasta que los esclavos DP o
dispositivos PROFINET IO hayan sido activados. El tiempo de espera m√°ximo para la
activaci√≥n de los esclavos DP o dispositivos PROFINET IO es de aprox. 1 minuto.
Dentro de ese tiempo no se producen errores de acceso a la periferia.
‚óè En el tipo de arranque "Rearranque", el estado de activaci√≥n de los esclavos o dispositivos
no se modifica: Los esclavos o dispositivos activados siguen activados, y los esclavos o
dispositivos desactivados siguen desactivados.
Despu√©s del arranque, la CPU intenta entrar en contacto c√≠clicamente con todos los esclavos
o dispositivos configurados y no desactivados, que no est√°n presentes o no son accesibles.
Nota
No se soporta la llamada de "D_ACT_DP" en los OBs de arranque.

Otras instrucciones
RD_REC: Leer registro de periferia
Descripci√≥n
Esta instrucci√≥n permite leer el registro con n√∫mero RECNUM del componente que se ha
direccionado. Para iniciar la lectura, debe ajustarse a "1" el par√°metro de entrada REQ . Si la
operaci√≥n de lectura se ha podido ejecutar de inmediato, la instrucci√≥n devuelve en el
par√°metro de salida BUSY el valor "0". Si BUSY tiene el valor "1", la operaci√≥n de lectura
todav√≠a no ha finalizado.

5922

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813). Una vez efectuada correctamente la transferencia
de datos, el registro le√≠do se guarda en el √°rea de destino delimitada mediante RECORD .
Nota
Si se lee un registro con n√∫mero mayor que 1 desde una FM o un CP adquiridos antes de
febrero de 1997 (en lo sucesivo denominados "m√≥dulos antiguos"), "RD_REC" se comporta de
un modo diferente que con un m√≥dulo nuevo. Este caso especial se describe en la secci√≥n
"Uso de FMs y CPs S7-300 antiguos con n.¬∫ de registro > 1" (ver abajo).
Si un esclavo DPV1 est√° configurado mediante archivo GSD (a partir de la rev. 3 de GSD) y la
interfaz DP del maestro DP est√° ajustada como "Compatible con S7", los m√≥dulos de E/S no
pueden leer en el programa de usuario los registros con "RD_REC". En este caso, el maestro
DP direcciona un slot incorrecto (slot configurado + 3).
Soluci√≥n: Conmutar la interfaz del maestro DP a "DPV1".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RD_REC":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: solicitud de lectura

IOID

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificador del √°rea de direcciones:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse la
identificaci√≥n de √°rea de la direcci√≥n m√°s baja. Si
se trata de las mismas direcciones, debe indicar‚Äê
se B#16#54.

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n l√≥gica del m√≥dulo. Con un m√≥dulo mix‚Äê
to debe indicarse la direcci√≥n m√°s baja de las
dos.

RECNUM

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de registro (valores admisibles: de 0 a
240)

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° un
c√≥digo de error. Adicionalmente: Longitud en
bytes del registro realmente transferido (valores
posibles: de +1 a +240), si el √°rea de destino es
mayor que el registro transferido y no se ha pro‚Äê
ducido ning√∫n error durante la transferencia.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5923

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La lectura todav√≠a no ha finalizado.

RECORD

Output

ANY

I, Q, M, D, L

√Årea de destino para el registro le√≠do. En caso de
procesamiento as√≠ncrono de "RD_REC", debe
comprobarse que los par√°metros actuales de
RECORD presenten la misma informaci√≥n de
longitud en todas las llamadas. Solo se admite el
tipo de datos BYTE .
Nota: Tenga en cuenta que en las CPUs S7-300,
el par√°metro RECORD siempre requiere que se
especifiquen por completo los par√°metros de DB
(ej.: P#DB13.DBX0.0 byte 100). En las CPUs
S7-300 no est√° permitido omitir un n√∫mero de DB
expl√≠cito; de lo contrario se genera un aviso de
error en el programa de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RECORD
Nota
Para asegurarse de que siempre se lea el registro completo, debe seleccionarse un √°rea de
destino con una longitud de 241 bytes. Si la transferencia de datos se realiza sin errores, la
longitud real del registro se puede leer en RET_VAL .

Uso de FMs y CPs S7-300 antiguos con n.¬∫ de registro > 1
Si se desea leer un registro con n√∫mero mayor que 1 con la instrucci√≥n "RD_REC" desde una
FM S7-300 antigua o un CP S7-300 antiguo, debe tenerse en cuenta lo siguiente:
‚óè Si el √°rea de destino es mayor que la longitud real del registro deseado, no se registran
datos en RECORD . En RET_VAL se escribe W#16#80B1.
‚óè Si el √°rea de destino es menor que la longitud real del registro deseado, la CPU leer√° tantos
bytes desde el principio del registro como se indique en la longitud especificada en
RECORD y los registrar√° en RECORD . En RET_VAL se escribe un "0".
‚óè Si la indicaci√≥n de longitud de RECORD es igual a la longitud real del registro deseado, la
CPU lee el registro en cuesti√≥n y lo guarda en RECORD ; RET_VAL se ajusta a "0".

5924

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
‚óè Si se ha producido un error durante la ejecuci√≥n de la funci√≥n, el valor de respuesta
contendr√° un c√≥digo de error.
‚óè Si no se ha producido ning√∫n error durante la transferencia, RET_VAL adquiere el valor
‚Äì 0 si se ha llenado el √°rea de destino completa con datos del registro seleccionado
(aunque el registro est√© incompleto).
‚Äì la longitud en bytes del registro realmente transferido (valores posibles: de +1 a +240),
si el √°rea de destino es mayor que el registro transferido.
Nota
Si se produce el error general W#16#8745, esto significa solo que durante la operaci√≥n
de escritura no ha sido posible acceder a por lo menos un byte. El registro se ha le√≠do
correctamente desde el m√≥dulo y escrito correctamente en el √°rea de memoria de E/S.
Dentro de la informaci√≥n de error "verdadera" (c√≥digos de error W#16#8xyz) de la tabla
siguiente, debe distinguirse entre dos casos:
‚óè Errores temporales (c√≥digos de error de W#16#80A2 a 80A4, 80Cx):
En este tipo de errores es posible que el error se elimine sin intervenci√≥n del usuario, es
decir, puede bastar con llamar de nuevo la instrucci√≥n (varias veces si es necesario).
Ejemplo de error temporal: En este momento los recursos necesarios est√°n ocupados
(W#16#80C3).
‚óè Errores permanentes (c√≥digos de error W#16#809x, 80A0, 80A1, 80Bx):
Los errores de este tipo no se pueden eliminar sin intervenci√≥n del usuario. Solo tiene
sentido volver a llamar la instrucci√≥n una vez que se haya eliminado el error. Ejemplo de
error permanente: Indicaci√≥n de longitud err√≥nea en RECORD (W#16#80B1).
Nota
Si se transfieren con "WR_REC (P√°gina 5927)" registros a un esclavo DPV1 o se leen
registros RD_REC desde un esclavo DPV1 que funciona en modo DPV1, el maestro DP
eval√∫a de la siguiente manera la informaci√≥n de error recibida desde el esclavo:
Si la informaci√≥n de error se encuentra en las √°reas de W#16#8000 a W#16#80FF o de
W#16#F000 a W#16#FFFF, el maestro DP reenv√≠a la informaci√≥n de error a la instrucci√≥n.
Si se encuentra fuera de estas √°reas, reenv√≠a a la instrucci√≥n el valor W#16#80A2 y
suspende el esclavo.
Encontrar√° la descripci√≥n de la informaci√≥n de error procedente de los esclavos DPV1 en
STATUS[3] Par√°metro STATUS (P√°gina 5901).

Par√°metros RET_VAL para WR_REC y RD_REC
C√≥digo de error
(W#16#...)

Explicaci√≥n

Restricci√≥n

0000

Sin error

-

7000

Primera llamada con REQ=0: No hay ninguna transferencia de datos
activa; BUSY tiene el valor 0.

-

7001

Primera llamada con REQ=1: Transferencia de datos lanzada; BUSY
tiene el valor 1.

Periferia descentralizada

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5925

Instrucciones
4.2 Instrucciones
C√≥digo de error
(W#16#...)

Explicaci√≥n

Restricci√≥n

7002

Llamada intermedia (REQ irrelevante): Transferencia de datos ya
activa; BUSY tiene el valor 1.

Periferia descentralizada

8090

La direcci√≥n base l√≥gica indicada no es v√°lida: No existe ninguna
asignaci√≥n en el SDB1/SDB2x, o no se trata de una direcci√≥n base.

-

8092

En la referencia ANY se ha indicado un tipo distinto a BYTE.

Solo con S7-400

8093

Esta instrucci√≥n no es v√°lida para el m√≥dulo seleccionado con
LADDR y IOID . (Se soportan los m√≥dulos S7-300 con S7-300, m√≥‚Äê
dulos S7-400 con S7-400, m√≥dulos S7-DP con S7-300 y S7-400.)

-

80A0

Acuse negativo al leer el m√≥dulo: M√≥dulo extra√≠do durante la opera‚Äê Solo con "RD_REC"
ci√≥n de lectura o m√≥dulo defectuoso

80A1

Acuse negativo al escribir en el m√≥dulo: M√≥dulo extra√≠do durante la
operaci√≥n de escritura o m√≥dulo defectuoso

Solo con "WR_REC (P√°gi‚Äê
na 5927)"

80A2

‚óè Error de protocolo DP con Layer 2 (p. ej. fallo de esclavo o fallos
de bus)

Periferia descentralizada

‚óè Con ET200S no es posible leer registros en el modo DPV0.
80A3

Error de protocolo de DP con User-Interface/User

Periferia descentralizada

80A4

Fallo de comunicaci√≥n en el bus K

El error se produce entre la CPU y
una interfaz DP externa

80B0

‚óè La instrucci√≥n no es posible para el tipo de m√≥dulo

-

‚óè El m√≥dulo no conoce este registro.
‚óè El n√∫mero de registro 241 no es admisible.
‚óè Con "WR_REC (P√°gina 5927)" no se permiten los registros 0 ni 1.
80B1

La indicaci√≥n de longitud en el par√°metro RECORD es err√≥nea.

‚óè Con "WR_REC
(P√°gina 5927)": Longitud
err√≥nea
‚óè Con "RD_REC" (posible solo si
se usan FMs S7-300 antiguas
o CPs S7-300
antiguos):Indicaci√≥n > longitud
registro
‚óè Con DPNRM_DG: Indicaci√≥n <
longitud de registro

80B2

El slot configurado no est√° ocupado.

-

80B3

El tipo de m√≥dulo real no coincide con el tipo de m√≥dulo configurado
en el SDB1

-

80B7

El esclavo DP o el m√≥dulo notifica un √°rea no autorizada en un pa‚Äê
r√°metro o un valor.

Solo con "RD_REC"

5926

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error
(W#16#...)

Explicaci√≥n

Restricci√≥n

80C0

Con "WR_REC (P√°gina 5927)": Los datos solo pueden escribirse en
el estado STOP de la CPU. Nota: En consecuencia, el programa de
usuario no puede escribir. Solo es posible escribir datos online con la
PG/el PC.

Con "WR_REC (P√°gina 5927)",
"RD_REC" o "DPNRM_DG (P√°gi‚Äê
na 5956)"

Con "RD_REC": El registro est√° cargado en el m√≥dulo, pero todav√≠a
no existen datos o los datos solo pueden leerse en el estado STOP de
la CPU. Nota: Si los datos solo pueden leerse en el estado STOP de
la CPU, el programa de usuario no puede evaluarlos. En tal caso solo
es posible leer los datos online con la PG/el PC.
Con "DPNRM_DG (P√°gina 5956)": No hay datos de diagn√≥stico.
80C1

Los datos de la petici√≥n de escritura efectuada anteriormente en el
m√≥dulo para el mismo registro no han sido procesados todav√≠a por el
m√≥dulo.

-

80C2

En este momento el m√≥dulo est√° procesando el m√°ximo posible de
peticiones para una CPU.

-

80C3

En este momento los recursos necesarios (memoria, etc.) est√°n ocu‚Äê pados.

80C4

Error temporal interno. No se ha podido ejecutar la petici√≥n.

-

Repita la petici√≥n. Si este error se produce a menudo, compruebe
posibles fallos de origen el√©ctrico en la configuraci√≥n.
80C5

La periferia descentralizada no est√° disponible.

Periferia descentralizada

80C6

La transferencia de registros se ha cancelado por una interrupci√≥n de
la clase de prioridad (rearranque o segundo plano)

Periferia descentralizada

8xyy

Informaci√≥n de error general

-

Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida
RET_VAL (P√°gina 174)

WR_REC: Escribir registro en periferia
Descripci√≥n
La instrucci√≥n "WR_REC" permite transferir el registro RECORD al m√≥dulo direccionado.
Para iniciar la escritura, debe ajustarse a "1" el par√°metro de entrada REQ. Si la operaci√≥n de
escritura se ha podido ejecutar de inmediato, la instrucci√≥n devuelve en el par√°metro de salida
BUSY el valor "0". Si BUSY tiene el valor "1", la operaci√≥n de escritura todav√≠a no ha finalizado.
Nota
Si un esclavo DPV1 est√° configurado mediante archivo GSD (a partir de la rev. 3 de GSD) y la
interfaz DP del maestro DP est√° ajustada como "Compatible con S7", no se pueden escribir en
el programa de usuario registros con "WR_REC" en los m√≥dulos de E/S. En este caso, el
maestro DP direcciona un slot incorrecto (slot configurado + 3).
Soluci√≥n: Conmutar la interfaz del maestro DP a "DPV1".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5927

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WR_REC":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: solicitud de escritura

IOID

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificador del √°rea de direcciones:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse la
identificaci√≥n de √°rea de la direcci√≥n m√°s baja. Si
se trata de las mismas direcciones, debe indicar‚Äê
se B#16#54.

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n l√≥gica del m√≥dulo. Con un m√≥dulo mix‚Äê
to debe indicarse la direcci√≥n m√°s baja de las
dos.

RECNUM

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de registro (valores admisibles: de 2 a
240)

RECORD

Input

ANY

I, Q, M, D, L

Registro. Solo se admite el tipo de datos BYTE.
Nota: Tenga en cuenta que en las CPUs S7-300,
el par√°metro RECORD siempre requiere que se
especifiquen por completo los par√°metros de DB
(ej.: P#DB13.DBX0.0 byte 100). En las CPUs
S7-300 no est√° permitido omitir un n√∫mero de DB
expl√≠cito; de lo contrario se genera un aviso de
error en el programa de usuario.

RET_VAL

Output

Return

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° un
c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY= 1: La escritura todav√≠a no ha finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RECORD
Los datos que se deben transferir se leen del par√°metro RECORD en la primera llamada. Si la
transferencia del registro dura m√°s que una llamada, en las llamadas consecutivas de la
instrucci√≥n (para la misma petici√≥n), el contenido del par√°metro RECORD ya no es relevante.

Par√°metro RET_VAL
Consulte tambi√©n: RD_REC: Leer registro de periferia (P√°gina 5922)
Nota
Si aparece el error general W#16#8544, esto solo significa que estaba bloqueado el acceso a
por lo menos un byte del √°rea de memoria de E/S que contiene el registro. Se ha proseguido
la transferencia de datos.

5928

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

DPRD_DAT: Leer datos coherentes de un esclavo DP normalizado
Descripci√≥n
Con la instrucci√≥n "DPRD_DAT" se leen datos coherentes de un esclavo DP normalizado o un
dispositivo PROFINET IO, teniendo en cuenta lo siguiente en cuanto a la longitud m√°xima:
‚óè La longitud m√°xima puede consultarse en la documentaci√≥n de la CPU.
‚óè Si no se ha producido ning√∫n error durante la transferencia de datos, los datos le√≠dos se
registran en el √°rea de destino delimitada mediante RECORD.
El √°rea de destino debe tener la misma longitud que se haya configurado para el m√≥dulo
seleccionado. En un esclavo DP normalizado con estructura modular o con varias IDs de DP,
la llamada a "DPRD_DAT" solo permite acceder cada vez a los datos de un solo m√≥dulo o ID
de DP en la direcci√≥n configurada.
Nota
Una CPU de las series S7-300/400 permite hasta 64 bytes de datos coherentes. Para las √°reas
de datos coherentes cuyo tama√±o supere los 4 bytes es necesario utilizar la instrucci√≥n
"DPRD_DAT". En caso de necesidad, esta instrucci√≥n tambi√©n se puede utilizar para un √°rea
de datos a partir de 1 byte. Si se produce un error de acceso, se notifica el c√≥digo de error
W#16#8090.
Nota
CPU S7-400 a partir de la versi√≥n de firmware V6.0
En las CPU S7-400 a partir de la versi√≥n de firmware V6.0 la llamada de DPRD_DAT se acepta
b√°sicamente para todas las direcciones. Es decir, que bajo su propia responsabilidad puede
acceder con DPRD_DAT a direcciones para las que no ha configurado ninguna coherencia
general.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5929

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DPRD_DAT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n inicial configurada del √°rea I del
m√≥dulo del que hay que leer.
Nota: La direcci√≥n se debe indicar en formato
hexadecimal; P. ej. la direcci√≥n inicial 100 sig‚Äê
nifica: LADDR:=W#16#64.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

RECORD

Output

ANY

I, Q, M, D, L

√Årea de destino para los datos √∫tiles le√≠dos.
Debe tener la misma longitud que la configu‚Äê
rada para el m√≥dulo seleccionado. Solo se
admite el tipo de datos BYTE.
Nota: Tenga en cuenta que en las CPU
S7-300, el par√°metro RECORD siempre re‚Äê
quiere que se especifiquen por completo los
par√°metros de DB (ej.: P#DB13.DBX0.0 byte
100). En las CPU S7-300 no est√° permitido
omitir un n√∫mero de DB expl√≠cito; de lo con‚Äê
trario se genera un aviso de error en el pro‚Äê
grama de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Nota
Si accede a esclavos DPV1, el maestro DP puede transferir la informaci√≥n de error de dichos
esclavos a la instrucci√≥n. Encontrar√° una descripci√≥n de esta informaci√≥n de error en
STATUS[3] Par√°metro STATUS (P√°gina 5901).

C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

‚óè No hay ning√∫n m√≥dulo configurado para la direcci√≥n base l√≥gica especificada.
‚óè No se ha tenido en cuenta la limitaci√≥n de longitud de los datos coherentes. (En las CPU S7-400 solo
hasta la versi√≥n de firmware V5.3 inclusive; a partir de la versi√≥n de firmware V6.0 esta causa
desaparece.)
‚óè En el par√°metro LADDR no se ha indicado la direcci√≥n de inicio en formato hexadecimal.

8092

En la referencia ANY se ha indicado un tipo distinto a BYTE.

8093

Para la direcci√≥n l√≥gica indicada en LADDR no existe ning√∫n m√≥dulo DP o dispositivo PROFINET IO del
que se puedan leer datos de modo coherente.

5930

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
80A0

Se ha detectado un error de acceso al acceder a la periferia

80B0

‚óè En las CPU S7-300 (todas las versiones de firmware) y CPU S7-400 hasta la versi√≥n de firmware V5.3
inclusive: Fallo de esclavo en interfaz DP externa
‚óè En las CPU S7-400 a partir de la versi√≥n de firmware V6.0: Fallo de esclavo o error de acceso a datos
incoherentes en la interconexi√≥n DP externa (el CP notifica a la CPU que se ha producido un error.)

80B1

La longitud del √°rea de destino especificada es distinta a la longitud de datos √∫tiles configurada.

80B2

Fallo del sistema con interfaz DP externa

80B3

Fallo del sistema con interfaz DP externa

80C0

Los datos todav√≠a no se han le√≠do del m√≥dulo

80C2

Fallo del sistema con interfaz DP externa

80Fx

Fallo del sistema con interfaz DP externa

87xy

Fallo del sistema con interfaz DP externa

808x

Fallo del sistema con interfaz DP externa

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Campo de aplicaci√≥n
"DPRD_DAT" es necesaria porque con los comandos de carga que acceden a la periferia o a
la memoria imagen de proceso de las entradas s√≥lo se puede leer un m√°ximo de cuatro bytes
de forma coherente.
Nota
Para leer datos coherentes tambi√©n puede usarse, en caso necesario, la memoria imagen de
proceso de las entradas.
‚óè Para saber si la CPU S7-300 permite esta funci√≥n, consulte la documentaci√≥n
correspondiente.
‚óè Todas las CPU S7-400 permiten esta funci√≥n.
PRECAUCI√ìN
Acceso a la periferia
Al utilizar "DPRD_DAT", evite acceder a √°reas de la periferia que tengan asignadas memorias
imagen parcial de proceso vinculadas a OB6x (alarmas de sincronismo).

Coherencia de datos
Consulte tambi√©n: Secci√≥n Coherencia de datos (P√°gina 6831).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5931

Instrucciones
4.2 Instrucciones

DPWR_DAT: Escribir datos coherentes de un esclavo DP normalizado
Descripci√≥n
Con esta instrucci√≥n se transfieren de modo coherente los datos de "RECORD " al esclavo DP
normalizado o dispositivo PROFINET IO y, en su caso, a la memoria imagen de proceso
(concretamente si se ha configurado el √°rea de direcciones en cuesti√≥n del esclavo DP
normalizado como √°rea de coherencia en una memoria imagen de proceso).
Para la longitud m√°xima de los datos que se deben transferir, se aplica lo siguiente: La longitud
m√°xima puede consultarse en la documentaci√≥n de la CPU. La transferencia de datos se
realiza de forma sincr√≥nica, es decir, con la finalizaci√≥n de la instrucci√≥n ha finalizado el
proceso de escritura.
El √°rea de origen debe tener la misma longitud que se haya configurado para el m√≥dulo
seleccionado. Con un esclavo DP normalizado con estructura modular solo es posible acceder
a un m√≥dulo del esclavo DP.
Nota
Una CPU de las series S7-1200/1500 soporta hasta 64 bytes de datos coherentes. Para las
√°reas de datos coherentes cuyo tama√±o supere los 4 bytes es necesario escribir los datos en
un m√≥dulo o un dispositivo utilizando la instrucci√≥n "DPWR_DAT". En caso de necesidad, esta
instrucci√≥n tambi√©n se puede utilizar para un √°rea de datos a partir de 1 byte. Si se produce un
error de acceso, se notifica el c√≥digo de error W#16#8090.
Nota
CPU S7-400 a partir de la versi√≥n de firmware V6.0
En las CPU S7-400 a partir de la versi√≥n de firmware V6.0 la llamada de DPWR_DAT se acepta
b√°sicamente para todas las direcciones. Es decir, que bajo su propia responsabilidad puede
acceder con DPWR_DAT a direcciones para las que no ha configurado ninguna coherencia
general.

5932

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DPWR_DAT":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

LADDR

Input

WORD

Descripci√≥n

I, Q, M, D, L o constante Direcci√≥n inicial configurada del √°rea MIPS del
m√≥dulo en el que hay que escribir.
Nota: La direcci√≥n se debe indicar en formato
hexadecimal; P. ej. la direcci√≥n inicial 100 sig‚Äê
nifica: LADDR:=W#16#64.

RECORD

Input

ANY

I, Q, M, D, L

√Årea de origen para los datos √∫tiles que se
deben escribir. Debe tener la misma longitud
que la configurada para el m√≥dulo selecciona‚Äê
do. Solo se admite el tipo de datos BYTE .
Nota: Tenga en cuenta que en las CPU
S7-300, el par√°metro RECORD siempre re‚Äê
quiere que se especifiquen por completo los
par√°metros de DB (ej.: P#DB13.DBX0.0 byte
100). En las CPU S7-300 no est√° permitido
omitir un n√∫mero de DB expl√≠cito; de lo contra‚Äê
rio se genera un mensaje de error en el pro‚Äê
grama de usuario.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Nota
Si accede a esclavos DPV1, el maestro DP puede transferir la informaci√≥n de error de dichos
esclavos a la instrucci√≥n. Encontrar√° una descripci√≥n de esta informaci√≥n de error en
STATUS[3] Par√°metro STATUS (P√°gina 5901).

C√≥digo de error
(W#16#...)

Explicaci√≥n

0000

No ha ocurrido ning√∫n error.

808x

Fallo del sistema con interfaz DP externa

8090

‚óè No hay ning√∫n m√≥dulo configurado para la direcci√≥n base l√≥gica especificada.
‚óè No se ha tenido en cuenta la limitaci√≥n de longitud de los datos coherentes. (En las CPU S7-400 solo
hasta la versi√≥n de firmware V5.3 inclusive; a partir de la versi√≥n de firmware V6.0 esta causa
desaparece.)
‚óè En el par√°metro LADDR no se ha indicado la direcci√≥n de inicio en formato hexadecimal.

8092

En la referencia ANY se ha indicado un tipo distinto a BYTE.

8093

Para la direcci√≥n l√≥gica indicada en LADDR no existe ning√∫n m√≥dulo DP ni dispositivo PROFINET IO en
el que se puedan escribir datos de modo coherente.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5933

Instrucciones
4.2 Instrucciones
C√≥digo de error
(W#16#...)

Explicaci√≥n

80A1

Se ha detectado un error de acceso al acceder a la periferia

80B0

‚óè En las CPU S7-300 (todas las versiones de firmware) y CPU S7-400 hasta la versi√≥n de firmware V5.3
inclusive: Fallo de esclavo en interfaz DP externa
‚óè En las CPU S7-400 a partir de la versi√≥n de firmware V6.0: Fallo de esclavo o error de acceso a datos
incoherentes en la interconexi√≥n DP externa (el CP notifica a la CPU que se ha producido un error.)

80B1

La longitud del √°rea de origen especificada es distinta a la longitud de datos √∫tiles configurada.

80B2

Fallo del sistema con interfaz DP externa

80B3

Fallo del sistema con interfaz DP externa

80C1

Los datos de la orden de escritura efectuada anteriormente en el m√≥dulo no han sido procesados todav√≠a
por el m√≥dulo.

80C2

Fallo del sistema con interfaz DP externa

80Fx

Fallo del sistema con interfaz DP externa

85xy

Fallo del sistema con interfaz DP externa

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Campo de aplicaci√≥n
"DPWR_DAT" es necesario porque con los comandos de transferencia que acceden a la
periferia o a la memoria imagen de proceso de las salidas solo se pueden escribir como
m√°ximo cuatro bytes coherentes.
Nota
Para escribir datos coherentes tambi√©n puede usarse, en caso necesario, la memoria imagen
de proceso de las salidas.
Para saber si la CPU S7-300 permite esta funci√≥n, consulte la documentaci√≥n correspondiente.
‚óè Todas las CPU S7-400 permiten esta funci√≥n.
‚óè Para escribir datos coherentes, no deben utilizarse al mismo tiempo ambas posibilidades:
Utilice o bien "DPWR_DAT" o bien la escritura a trav√©s de la memoria imagen de proceso
de las salidas.
PRECAUCI√ìN
Acceso a la periferia
Al utilizar "DPWR_DAT", evite acceder a √°reas de la periferia que tengan asignadas
memorias imagen parcial de proceso vinculadas a OB6x (alarmas de sincronismo).

Coherencia de datos
Consulte tambi√©n: Coherencia de datos (P√°gina 6831).

5934

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

iDevice / iSlave
RCVREC: Recibir registro
Descripci√≥n
Un I-Device puede recibir un registro desde un controlador superior. La recepci√≥n se efect√∫a
en el programa de aplicaci√≥n con la instrucci√≥n "RCVREC" (receive record).
La instrucci√≥n tiene los siguientes modos de operaci√≥n:
‚óè Comprobar si el I-Device ha recibido una solicitud para la recepci√≥n de un registro.
‚óè Preparar un registro en los par√°metros de salida.
‚óè Enviar una respuesta al controlador superior.
Para establecer cu√°l de estos modos de operaci√≥n debe ejecutar la instrucci√≥n, se usa el
par√°metro de entrada MODE (ver abajo).
El I-Device debe encontrarse en el estado operativo RUN o en el estado operativo
ARRANQUE.
Con MLEN se indica el m√°ximo de bytes que se deben recibir. Por ello debe escogerse un √°rea
de destino RECORDcon una longitud de por lo menos MLENbytes.
Cuando se ha recibido un registro (MODE=1 o MODE=2), en el par√°metro de salida NEW se
indica que el registro se ha guardado en RECORD. Aseg√∫rese de que RECORD tenga una
longitud suficiente. El par√°metro de salida LEN contiene la longitud real en bytes del registro
recibido.
Para la respuesta positiva al controlador superior, se deben ajustar CODE1 y CODE2 a cero.
Si se desea rechazar el registro recibido, debe enviarse con CODE1 el Error Code 1 y con
CODE2 el Error Code 2 de la respuesta negativa al controlador superior.
Nota
Si el I-Device ha recibido una solicitud de recepci√≥n de un registro, es necesario haber
reconocido la emisi√≥n de dicha solicitud dentro de un per√≠odo determinado. Una vez
reconocida la solicitud, debe haberse enviado al controlador superior una respuesta dentro del
mismo per√≠odo. De lo contrario, se produce en el I-Device un error de timeout, a consecuencia
del cual el sistema operativo del I-Device env√≠a una respuesta negativa al controlador superior.
Para conocer dicho per√≠odo, consulte los datos t√©cnicos de la CPU.
Cuando se produce un error, el par√°metro de salida STATUS contiene la informaci√≥n de error.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5935

Instrucciones
4.2 Instrucciones

Modos de operaci√≥n
El modo de operaci√≥n de la instrucci√≥n "RCVREC" se define mediante el par√°metro de entrada
MODE. Esto se explica en la siguiente tabla:
MODE
0

Significado
Comprobar si existe una solicitud para la recepci√≥n de un registro.
Si en el I-Device existe un registro procedente del controlador superior, la instrucci√≥n escribir√° solo en los par√°‚Äê
metros de salida NEW, SLOT, INDEX y LEN. Si se llama la instrucci√≥n varias veces consecutivas con MODE=0,
los par√°metros de salida se refieren siempre a la misma solicitud.

1

Recibir un registro para cualquier subslot del I-Device
Si en el I-Device existe un registro procedente del controlador superior para cualquier subslot del I-Device, la
instrucci√≥n escribe solo en los par√°metros de salida y transfiere el registro al par√°metro RECORD.

2

Recibir un registro para un determinado subslot del I-Device
Si en el I-Device existe un registro procedente del controlador superior para un determinado subslot del I-Device,
la instrucci√≥n escribe solo en los par√°metros de salida y transfiere el registro al par√°metro RECORD.

3

Enviar respuesta positiva al controlador superior
La instrucci√≥n comprueba la solicitud de recepci√≥n de registro procedente del controlador superior, acepta el
registro existente y env√≠a un acuse positivo al controlador superior.

4

Enviar respuesta negativa al controlador superior
La instrucci√≥n comprueba la solicitud de recepci√≥n de registro procedente del controlador superior, rechaza el
registro existente y env√≠a un acuse negativo al controlador superior. El motivo del rechazo puede indicarse en los
par√°metros de entrada CODE1 y CODE2.

Nota
Una vez llegado el registro (NEW=1), debe llamarse "RCVREC" dos veces m√°s para
garantizar que se procese por completo. Al hacerlo debe mantenerse el siguiente orden:
‚óè Primera llamada con MODE=1 o MODE=2
‚óè Segunda llamada con MODE=3 o MODE=4

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RCVREC":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Modo de operaci√≥n

F_ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Subslot en el √°rea de trasferencia del I-Device
para el registro que se debe recibir (relevante
solo para MODE=2). El high word debe ajus‚Äê
tarse siempre a cero.

MLEN

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Longitud m√°xima en bytes del registro que se
debe transferir.

CODE1

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Cero (para MODE=3) o Error Code 1 (para
MODE=4)

CODE2

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Cero (para MODE=3) o Error Code 2 (para
MODE=4)

5936

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

NEW

Output

BOOL

I, Q, M, D, L

‚óè MODE=0: Se ha recibido un registro nuevo
‚óè MODE=1 √≥ 2: El registro se ha transferido
en RECORD

STATUS

Output

DWORD

I, Q, M, D, L

Informaci√≥n de error

SLOT

Output

INT

I, Q, M, D, L

Id√©ntico a F_ID

SUBSLOT

Output

INT

I, Q, M, D, L

Id√©ntico a F_ID

INDEX

Output

INT

I, Q, M, D, L

N√∫mero del registro recibido

LEN

Output

INT

I, Q, M, D, L

Longitud del registro recibido

RECORD

InOut

ANY

I, Q, M, D, L

√Årea de destino para el registro recibido.
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro RECORD siempre re‚Äê
quiere que se especifiquen por completo los
par√°metros de DB (ej.: P#DB13.DBX0.0 Byte
100). En las CPUs S7-300 no est√° permitido
omitir un n√∫mero de DB expl√≠cito; de lo contra‚Äê
rio se genera un aviso de error en el programa
de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro STATUS
Para la interpretaci√≥n del par√°metro STATUS, v√©ase el cap√≠tulo: Par√°metro STATUS
(P√°gina 5901)

PRVREC: Proveer registro
Descripci√≥n
Un I-Device puede recibir desde un controlador superior la solicitud de preparar un registro. La
preparaci√≥n se efect√∫a en el programa de usuario con la instrucci√≥n "PRVREC" (provide
record).
La instrucci√≥n tiene los siguientes modos de operaci√≥n:
‚óè Comprobar si el I-Device ha recibido una solicitud para la preparaci√≥n de un registro.
‚óè Transferencia del registro solicitado al controlador superior.
‚óè Enviar una respuesta al controlador superior.
Para establecer cu√°l de estos modos de operaci√≥n debe ejecutar la instrucci√≥n, se usa el
par√°metro de entrada MODE (ver abajo).
El I-Device debe encontrarse en el estado operativo RUN o en el estado operativo
ARRANQUE.
Con LEN se indica el m√°ximo de bytes que debe tener el registro que se desea enviar. Por ello
debe escogerse un √°rea de destino RECORDcon una longitud de por lo menos LENbytes.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5937

Instrucciones
4.2 Instrucciones
Cuando existe una solicitud de preparaci√≥n de un registro (MODE=0), el par√°metro de salida
NEW se ajusta a TRUE.
Si se acepta la solicitud de preparaci√≥n de registro, para la respuesta positiva al controlador
superior debe escribirse en RECORD el registro solicitado, as√≠ como ajustar CODE1 y CODE2
a cero. Si se desea rechazar una solicitud de preparaci√≥n de registro, debe enviarse con
CODE1 el Error Code 1 y con CODE2 el Error Code 2 de la respuesta negativa al controlador
superior.
Nota
Si el I-Device ha recibido una solicitud de preparaci√≥n de un registro, es necesario haber
reconocido la emisi√≥n de dicha solicitud dentro de un per√≠odo determinado. Una vez
reconocida la solicitud, debe haberse enviado al controlador superior una respuesta dentro del
mismo per√≠odo. De lo contrario, se produce en el I-Device un error de timeout, a consecuencia
del cual el sistema operativo del I-Device env√≠a una respuesta negativa al controlador superior.
Para conocer dicho per√≠odo, consulte los datos t√©cnicos de la CPU.
Cuando se produce un error, el par√°metro de salida STATUS contiene la informaci√≥n de error.

Modos de operaci√≥n
El modo de operaci√≥n de la instrucci√≥n "PRVREC" se define mediante el par√°metro de entrada
MODE. Esto se explica en la siguiente tabla:
MODE

Significado

0

Comprobar si existe una solicitud de preparaci√≥n de un registro.
Si en el I-Device existe una solicitud de preparaci√≥n de registro procedente del controlador superior, la instrucci√≥n
escribir√° solo en los par√°metros de salida NEW, SLOT, INDEX y RLEN. Si se llama la instrucci√≥n varias veces
consecutivas con MODE=0, los par√°metros de salida se refieren siempre a la misma solicitud.

1

Recibir una solicitud de preparaci√≥n de registro para cualquier subslot del I-Device
Si en el I-Device existe una solicitud de ese tipo procedente del controlador superior para cualquier subslot del
I-Device, la instrucci√≥n escribe solo en los par√°metros de salida.

2

Recibir una solicitud de preparaci√≥n de registro para un determinado subslot del I-Device
Si en el I-Device existe una solicitud de ese tipo procedente del controlador superior para un determinado subslot
del I-Device, la instrucci√≥n escribe solo en los par√°metros de salida.

3

Preparar registro y enviar respuesta positiva al controlador superior
La instrucci√≥n comprueba la solicitud de preparaci√≥n de registro procedente del controlador superior, pone a
disposici√≥n el registro solicitado en RECORD y env√≠a un acuse positivo al controlador superior.

4

Enviar respuesta negativa al controlador superior
La instrucci√≥n comprueba la solicitud de preparaci√≥n de registro procedente del controlador superior, la rechaza
y env√≠a un acuse negativo al controlador superior. El motivo del rechazo puede indicarse en los par√°metros de
entrada CODE1 y CODE2.

5938

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
Una vez llegada la solicitud (NEW=1), debe llamarse la instrucci√≥n dos veces m√°s para
garantizar que se procese por completo. Al hacerlo debe mantenerse el siguiente orden:
‚óè Primera llamada con MODE=1 o MODE=2
‚óè Segunda llamada con MODE=3 o MODE=4

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PRVREC":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Modo de operaci√≥n

F_ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Subslot en el √°rea de trasferencia del I-Device
para el registro que se debe enviar (relevante
solo para MODE=2). El high word debe ajustarse
siempre a cero.

CODE1

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Cero (para MODE=3) o Error Code 1 (para MO‚Äê
DE=4)

CODE2

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Cero (para MODE=3) o Error Code 2 (para MO‚Äê
DE=4)

LEN

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Longitud m√°xima en bytes del registro que se
debe enviar.

NEW

Output

BOOL

I, Q, M, D, L

El controlador superior ha solicitado un nuevo
registro.

STATUS

Output

DWORD

I, Q, M, D, L

Informaci√≥n de error

SLOT

Output

INT

I, Q, M, D, L

Id√©ntico a F_ID

SUBSLOT

Output

INT

I, Q, M, D, L

Id√©ntico a F_ID

INDEX

Output

INT

I, Q, M, D, L

N√∫mero del registro que se debe enviar

RLEN

Output

INT

I, Q, M, D, L

Longitud del registro que se debe enviar

RECORD

InOut

ANY

I, Q, M, D, L

Registro preparado
Nota: Tenga en cuenta que en las CPUs S7-300,
el par√°metro RECORD siempre requiere que se
especifiquen por completo los par√°metros de DB
(ej.: P#DB13.DBX0.0 Byte 100). En las CPUs
S7-300 no est√° permitido omitir un n√∫mero de DB
expl√≠cito; de lo contrario se genera un aviso de
error en el programa de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro STATUS
Para la interpretaci√≥n del par√°metro STATUS, v√©ase el cap√≠tulo: Par√°metro STATUS
(P√°gina 5901)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5939

Instrucciones
4.2 Instrucciones

SALRM: Enviar alarma
Descripci√≥n de SALRM
Descripci√≥n
Esta instrucci√≥n permite enviar desde un programa de usuario de un esclavo inteligente una
alarma de un slot situado en el √°rea de transferencia (slot virtual) al maestro DP
correspondiente. Esto da lugar al inicio del OB correspondiente en el maestro DP.
Puede asignarse a la alarma informaci√≥n adicional espec√≠fica. Con esta instrucci√≥n puede
leerse en el maestro DP la informaci√≥n adicional completa.
La instrucci√≥n solo puede utilizarse en el modo compatible con S7.
‚óè DP: El maestro integra el esclavo I mediante el archivo GSD.
‚óè Compatible con S7: El esclavo I se vincula con el maestro mediante configuraci√≥n.
Nota
La interfaz de la instrucci√≥n "SALRM" es id√©ntica a la del FB "SALRM" definido en la norma
PROFIBUS and PROFINET Guideline Communication Function Blocks on PROFIBUS DP
and PROFINET IO.

Funcionamiento
La instrucci√≥n "SALRM" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se prolonga
a lo largo de varias llamadas. Para iniciar la transferencia de alarma, debe llamarse la
instrucci√≥n con REQ = 1.
La operaci√≥n de env√≠o permanece activa hasta que el maestro DP confirma o interrumpe el
procesamiento de la alarma.
Mediante el par√°metro de salida BUSY y los bytes 2 y 3 del par√°metro de salida STATUS se
muestra el estado de la petici√≥n. Los bytes 2 y 3 de STATUS corresponden al par√°metro de
salida RET_VAL de las instrucciones as√≠ncronas.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).
La transferencia de alarma se puede dar por finalizada cuando el par√°metro de salida BUSY
ha adoptado el valor FALSE .

Identificaci√≥n de la petici√≥n
Si se ha lanzado el env√≠o de una alarma al maestro DP con la instrucci√≥n "SALRM" y se vuelve
a llamar esta instrucci√≥n antes de que finalice la petici√≥n en curso, el comportamiento posterior
de la instrucci√≥n depende de si la nueva llamada corresponde a la misma petici√≥n.
Si los par√°metros ID y ATYPE coinciden con una petici√≥n todav√≠a no finalizada, la llamada se
considerar√° llamada consecutiva.

5940

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SALRM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: Realizar la transferencia de la alarma

ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Cualquier direcci√≥n l√≥gica del √°rea de transfe‚Äê
rencia al maestro DP (slots virtuales) (desde el
punto de vista del esclavo DP) excepto la di‚Äê
recci√≥n de diagn√≥stico de la estaci√≥n y la di‚Äê
recci√≥n l√≥gica del slot 2.
La informaci√≥n relevante se encuentra en la
palabra menos significativa. La palabra m√°s
significativa se ajusta a cero. El bit 15 contiene
la identificaci√≥n E/S: 0 si es una direcci√≥n de
entrada y 1 si es de salida.

ATYPE (P√°gi‚Äê
na 5944)

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Alarm Type
Identificaci√≥n del tipo de alarma. Valores posi‚Äê
bles:
‚óè 1: Alarma de diagn√≥stico
‚óè 2: Alarma de proceso

ASPEC (P√°gi‚Äê
na 5944)

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Alarm Specifier:
‚óè 0: No hay m√°s informaci√≥n
‚óè 1: Evento entrante, slot con fallo
‚óè 2: Evento saliente, slot ya sin fallo
‚óè 3: Evento entrante, slot sigue con fallo

LEN (P√°gi‚Äê
na 5945)

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Longitud en bytes de la informaci√≥n adicional
de alarma que se debe enviar
Mayor valor: 16

DONE

Output

BOOL

I, Q, M, D, L

DONE=1: Se ha transferido la alarma

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La transferencia de la alarma toda‚Äê
v√≠a no ha finalizado.

ERROR (P√°gi‚Äê
na 5946)

Output

BOOL

I, Q, M, D, L

ERROR = 1: Se ha producido un error.

STATUS (P√°gi‚Äê
na 5946)

Output

DWORD

I, Q, M, D, L

Informaci√≥n de error

AINFO (P√°gi‚Äê
na 5947)

InOut

ANY

I, Q, M, D, L

Alarm Info
√Årea de origen de la informaci√≥n adicional de
alarma
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro AINFO siempre requiere
que se especifiquen por completo los par√°me‚Äê
tros de DB (ej.: P#DB13.DBX0.0 byte 100). En
las CPU S7-300 no est√° permitido omitir un
n√∫mero de DB expl√≠cito; de lo contrario se ge‚Äê
nera un mensaje de error en el programa de
usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5941

Instrucciones
4.2 Instrucciones

Repercusi√≥n de la llamada a "SALRM" en la informaci√≥n de estado de m√≥dulo y el LED de error de grupo
(SF)
Como cualquier CPU, el esclavo inteligente guarda las propiedades de sus slots en la
informaci√≥n de estado de m√≥dulo.
Consulte tambi√©n: SZL-ID W#16#xy91: informaci√≥n de estado de m√≥dulo (P√°gina 6156).
Si, mediante "SALRM", se env√≠a una alarma de diagn√≥stico, el sistema operativo del esclavo
inteligente influye en la informaci√≥n de estado de m√≥dulo a nivel local de esclavo y en el LED
SF, en funci√≥n del bit 0 del byte 0 de AINFO (este bit se env√≠a a la informaci√≥n de estado con
el valor "M√≥dulo defectuoso".). Sin embargo, en el esclavo I no se efect√∫a ning√∫n registro en
el b√∫fer de diagn√≥stico, y no se inicia ning√∫n OB de alarma de diagn√≥stico.

5942

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Coherencia de la informaci√≥n de estado de m√≥dulo entre el maestro DP y el esclavo I
A continuaci√≥n se contemplan diversos escenarios y sus repercusiones en la informaci√≥n de
estado del m√≥dulo:
‚óè Recuperaci√≥n de estaci√≥n (provoca el inicio del OB 86 en el maestro DP y en el esclavo I)
Afecta a la informaci√≥n de estado de m√≥dulo tanto en el esclavo I como en el maestro S7
(se anula "M√≥dulo defectuoso"). Si, desde el punto de vista del usuario, despu√©s de la
recuperaci√≥n de la estaci√≥n se producen fallos en el esclavo I, estos fallos deben
comunicarse al maestro DP llamando "SALRM".
‚óè Transici√≥n de STOP a RUN del maestro DP (provoca el inicio del OB 82 en el esclavo I)
La informaci√≥n de estado del m√≥dulo en el esclavo I no se modifica. El maestro DP anula
el bit "Fallo del m√≥dulo" en la correspondiente informaci√≥n de estado de m√≥dulo.
Para garantizar la coherencia de la informaci√≥n de estado de m√≥dulo entre el maestro DP
y el esclavo I en el modo compatible con S7, se debe reaccionar del modo siguiente en el
esclavo I:
‚Äì Por cada slot virtual sin errores, debe enviarse al maestro DP una alarma de diagn√≥stico
saliente mediante "SALRM".
‚Äì Para cada slot virtual con errores, debe enviarse al maestro DP una alarma de
diagn√≥stico entrante mediante "SALRM".
‚óè Transici√≥n de STOP a RUN del esclavo I (provoca el inicio del OB 82 en el maestro DP)
La informaci√≥n de estado de m√≥dulo en el maestro DP permanece invariable, y la del
esclavo I se anula (se anula "M√≥dulo defectuoso".).
Para garantizar la coherencia de la informaci√≥n de estado de m√≥dulo entre el maestro DP
y el esclavo I, se debe reaccionar del modo siguiente en el esclavo I:
‚Äì Por cada slot virtual sin errores, debe enviarse al maestro DP una alarma de diagn√≥stico
saliente mediante "SALRM".
‚Äì Para cada slot virtual con errores, debe enviarse al maestro DP una alarma de
diagn√≥stico entrante mediante "SALRM".
Nota
Dado que "SALRM" funciona de modo as√≠ncrono, las llamadas a "SALRM" en los OBs
de arranque no se pueden finalizar, es decir, deben finalizarse en el programa c√≠clico.
Todas las diferencias mencionadas entre la informaci√≥n de estado de m√≥dulo en el
maestro y el esclavo I solo pueden producirse en los slots que tengan asignadas
alarmas de diagn√≥stico mediante "SALRM". Esto, a su vez. significa que las soluciones
descritas solo son necesarias para dicho tipo de slots.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5943

Instrucciones
4.2 Instrucciones

Par√°metro ATYPE
Par√°metro ATYPE
La tabla siguiente muestra, para cada uno de los valores admisibles de ATYPE , qu√© OB se
inicia en el respectivo maestro DP y en qu√© modo DP se admite la correspondiente alarma.
ATYPE

Significado en la
norma DPV1

OB correspondiente en el maestro DP S7 Modo DP
DP

Compatible con
S7

1

Alarma de diagn√≥s‚Äê OB de alarma de diagn√≥stico (OB82)
tico

‚Äì

S√≠

2

Alarma de proceso OBs de alarma de proceso (OBs de 40 a
47)

‚Äì

S√≠

Nota
La posibilidad de uso de los tipos de alarma puede limitarse desde el maestro DP adem√°s de
lo indicado en la tabla anterior.

Dependencia del tipo de alarma respecto al estado operativo de un maestro S7
En un esclavo en modo compatible con S7 (operaci√≥n en un maestro S7), solo pueden
enviarse alarmas de proceso y de diagn√≥stico cuando el correspondiente maestro DP se
encuentra en el estado operativo RUN (DP: Operate). Si el maestro DP se encuentra en el
estado operativo STOP (DP: Clear), la alarma se retiene y "SALRM" devuelve la informaci√≥n
de error W#16#80C8. La tarea de volver a enviar la alarma en un momento posterior
corresponde exclusivamente al usuario.

Par√°metros ASPEC
Par√°metro ASPEC
Este par√°metro muestra el estado de diagn√≥stico del slot virtual conforme a la norma. Por ello
solo es posible asignar a ASPEC un valor distinto de cero en caso de enviar una alarma de
diagn√≥stico.
Dado que en la informaci√≥n adicional de alarma de S7 de la alarma de diagn√≥stico (registro 0)
existe una informaci√≥n entrante/saliente (ver Datos de diagn√≥stico>Byte principal 0 bit 0), se
debe asignar el valor siguiente al bit 0 (fallo de m√≥dulo) del byte 0 de la informaci√≥n adicional
de alarma:

5944

ASPEC

Bit "M√≥dulo defectuoso" en AINFO (P√°gina 5947)

0

0

1

1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ASPEC

Bit "M√≥dulo defectuoso" en AINFO (P√°gina 5947)

2

0

3

1

Par√°metro LEN
Par√°metro LEN
En LEN se indica la longitud en bytes de la informaci√≥n adicional de alarma que se debe
transferir. El rango de valores m√°ximo admisible es de 0 a 16.
En la tabla siguiente se indica, para todos los tipos de alarma posibles, qu√© valores son
admisibles para LEN en los distintos modos de un esclavo inteligente.
Tipo de alarma

DP

Compatible con S7

Alarma de diagn√≥stico

‚Äì

de 4 a 16

Alarma de proceso

‚Äì

4

En la tabla siguiente se describe qu√© reacci√≥n muestra "SALRM" cuando se asigna a LEN un
valor distinto a la longitud de AINFO (P√°gina 5947)BYTE.
Valor de LEN

Comportamiento de "SALRM"

<= Indicaci√≥n de longitud de AINFO

"SALRM" env√≠a una alarma al maestro DP. Se transfieren a
la informaci√≥n adicional de alarma tantos bytes como se ha‚Äê
ya indicado en LEN.

Fuera del rango de valores admisible, p.
ej. < 0 o > 16

"SALRM" no env√≠a ninguna alarma.
Informaci√≥n de error: W#16#80B1, STATUS[4]=B#16#FF

> Indicaci√≥n de longitud de AINFO

"SALRM" env√≠a una alarma al maestro DP. Se transfieren a
la informaci√≥n adicional de alarma tantos bytes como se ha‚Äê
ya indicado en la indicaci√≥n de longitud de AINFO.
Informaci√≥n de error: W#16#00B1, STATUS[4]=Indicaci√≥n
de longitud de AINFO

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5945

Instrucciones
4.2 Instrucciones

Par√°metros STATUS y ERROR
Par√°metros STATUS y ERROR
El par√°metro de salida STATUScontiene informaci√≥n de error. Si se interpreta como
ARRAY[1 ... 4] OF BYTE, la informaci√≥n de error presenta la siguiente estructura:
Elemento de cam‚Äê Significado
po
STATUS[1]

‚óè B#16#00: Sin error
‚óè B#16#C0: Error detectado por el esclavo I

STATUS[2], STA‚Äê
TUS[3]

Equivale al par√°metro de salida RET_VAL de las instrucciones

STATUS[4]

B#16#00 a excepci√≥n de algunos conflictos de longitud entre LEN y la longitud
de AINFO (P√°gina 5947). Estas excepciones se recogen en la tabla siguiente.

En la tabla siguiente se indican todas las informaciones de error espec√≠ficas de "SALRM".
ERROR

STATUS[2,3]
(W#16# ...)

Explicaci√≥n

0

0000

La petici√≥n se ha ejecutado sin errores. Si LEN es < longitud de AIN‚Äê
FO, solo se han transferido LEN bytes de la informaci√≥n adicional de
alarma.

0

00B1

LEN > longitud de AINFO. La petici√≥n se ha ejecutado. La informaci√≥n
adicional de alarma especificada en AINFO se ha transferido. STA‚Äê
TUS[4] contiene la longitud de AINFO.

0

7000

Primera llamada con REQ=0 (ejecuci√≥n en vac√≠o). No se ha enviado
ninguna alarma. BUSY tiene el valor "0".

0

7001

Primera llamada con REQ=1. Se ha lanzado la petici√≥n.BUSY tiene el
valor "1".

0

7002

Llamada intermedia (REQ irrelevante). La alarma enviada no ha sido
confirmada todav√≠a por el maestro DP. BUSY tiene el valor "1".

1

8090

La direcci√≥n indicada en ID se encuentra fuera del √°rea de direcciones
admisible o no se ha configurado.

1

8091

‚óè Se ha bloqueado la alarma mediante configuraci√≥n.
‚óè La alarma no es admisible para este tipo de esclavo.

1

8092

Tipo de datos no admisible en AINFO (solo se admiten BYTE y
BLOCK-DB)

1

8093

ID pertenece a un slot virtual desde el que no es posible efectuar
solicitudes de alarma.

1

80B0

ASPEC
‚óè No corresponde al bit 0 del byte 0 de AINFO
‚óè Debe tener el valor 0 con el tipo de alarma utilizado
‚óè Se encuentra fuera del rango de valores admisible

5946

1

80B1

LEN se encuentra fuera del rango de valores admisible. STATUS[4]
contiene B#16#FF.

1

80B5

La llamada a "SALRM" en el maestro DP no es admisible.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
ERROR

STATUS[2,3]
(W#16# ...)

Explicaci√≥n

1

80C3

En este momento los recursos necesarios (memoria, etc.) est√°n ocu‚Äê
pados.

1

80C5

En este momento la periferia descentralizada no est√° disponible (p. ej.
fallo de estaci√≥n)

1

80C8

La funci√≥n no est√° autorizada en el estado operativo actual del maes‚Äê
tro DP (el maestro DP es un maestro S7 y se encuentra en el estado
operativo STOP).

Par√°metro AINFO
Par√°metro AINFO
El par√°metro AINFO es el √°rea de origen de la informaci√≥n adicional de alarma. Desde el punto
de vista del esclavo inteligente, esta √°rea se puede rellenar con cualquier valor. Sin embargo,
si se utiliza un maestro DP de la gama S7, la informaci√≥n adicional de alarma enviada con la
alarma debe ajustarse a las convenciones de S7.
Si se env√≠a una alarma de diagn√≥stico (ATYPE (P√°gina 5944) =1), el usuario es responsable
de asignar un valor adecuado al registro 0 y, en su caso, al registro 1.
La tabla siguiente ofrece una propuesta de asignaci√≥n conforme a S7. Se ha ajustado ya
anticipadamente el bit "M√≥dulo defectuoso" (ver arriba). La propuesta coincide con la
asignaci√≥n predeterminada (que se realiza despu√©s de POWER ON, despu√©s de una
transici√≥n STOP-RUN del esclavo inteligente o despu√©s de la recuperaci√≥n de una estaci√≥n),
excepto en el bit mencionado.
N√∫mero de regis‚Äê
tro

Asignaci√≥n

0

B#16#01, 0B, 00, 00

1

Con modo compatible con S7: Registro 0 + 12 bytes con cero

Informaci√≥n adicional
Consulte tambi√©n: Formato de los datos de diagn√≥stico (P√°gina 6065).

PROFIBUS
DP_PRAL: Disparar alarma de proceso del esclavo DP normalizado
Descripci√≥n
Esta instrucci√≥n permite disparar una alarma de proceso desde el programa de usuario de un
esclavo inteligente en el correspondiente maestro DP. Esto da lugar al inicio del OB 40 en el
maestro DP.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5947

Instrucciones
4.2 Instrucciones
Con el par√°metro de entrada AL_INFO puede identificarse la causa de la alarma de proceso
deseada. Esta identificaci√≥n de alarma se transfiere al maestro DP y puede evaluarse en el OB
40 (variable OB40_POINT_ADDR).
La alarma de proceso solicitada se define de modo un√≠voco mediante los par√°metros de
entrada IOID y LADDR . Por cada √°rea de direcciones configurada de la memoria de
transferencia, se puede disparar una y solo una alarma de programa en un momento
cualquiera.

Funcionamiento
"DP_PRAL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se prolonga a lo largo de
varias llamadas. Para iniciar la solicitud de alarma de proceso, debe llamarse "DP_PRAL" con
REQ=1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY .
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).
La petici√≥n finaliza cuando ha finalizado el procesamiento del OB 40 en el maestro DP.
Nota
Si se utiliza el esclavo DP como esclavo normalizado, la petici√≥n finaliza cuando el telegrama
de diagn√≥stico ha sido recogido por el maestro DP.

Identificaci√≥n de una petici√≥n
Los par√°metros de entrada IOID y LADDR definen una petici√≥n de manera un√≠voca.
Si se ha llamado la instrucci√≥n "DP_PRAL" en un esclavo DP y se ha vuelto a llamar la
instrucci√≥n antes de que el maestro DP haya confirmado la alarma de proceso solicitada, el
comportamiento posterior de la instrucci√≥n depende esencialmente de si la nueva llamada
corresponde a la misma petici√≥n. Si los par√°metros IOID y LADDR coinciden con una petici√≥n
todav√≠a no finalizada, la llamada se interpreta como llamada consecutiva independientemente
del valor del par√°metro AL_INFO , y en RET_VAL se registra el valor W#16#7002 .

5948

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DP_PRAL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ=1: Disparar alarma de proceso en el
maestro DP correspondiente

IOID

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificaci√≥n del √°rea de direcciones en la
memoria de transferencia (desde el punto de
vista del esclavo DP):
‚óè B#16#00: El bit15 de LADDR indica si se
trata de una direcci√≥n de entrada (bit15=0)
o de salida (bit15=1).
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse
la identificaci√≥n de √°rea de la direcci√≥n m√°s
baja. Si se trata de las mismas direcciones,
debe indicarse B#16#54.

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n de inicio del √°rea de direcciones en
la memoria de transferencia (desde el punto
de vista del esclavo DP). Si se trata de un √°rea
perteneciente a un m√≥dulo mixto, debe indi‚Äê
carse la menor de las dos direcciones.

AL_INFO

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Identificaci√≥n de alarma
Esta se asigna al OB 40 que debe iniciarse en
el maestro DP correspondiente (variable
OB40_POINT_ADDR).
Si se utiliza un esclavo inteligente con un
maestro externo, debe evaluarse el telegrama
de diagn√≥stico en el maestro.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY=1:
La alarma de proceso disparada no ha sido
confirmada todav√≠a por el maestro DP.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

La petici√≥n se ha ejecutado sin errores.

7000

Primera llamada con REQ=0. No hay ninguna solicitud de alarma de proceso activa; BUSY tiene el valor
"0".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5949

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
7001

Primera llamada con REQ=1. Se ha enviado una solicitud de alarma al maestro DP; BUSY tiene el valor
"1".

7002

Llamada intermedia (REQ irrelevante): La alarma disparada no ha sido confirmada todav√≠a por el maestro
DP; BUSY tiene el valor "1".

8090

La direcci√≥n de inicio del √°rea de direcciones en la memoria de transferencia es err√≥nea

8091

Alarma bloqueada mediante configuraci√≥n.

8093

Mediante el par de par√°metros IOID y LADDR se accede a un m√≥dulo desde el que no es posible solicitar
alarmas de proceso.

80B5

La llamada en el maestro DP no es admisible.

80C3

En este momento los recursos necesarios (memoria, etc.) est√°n ocupados.

80C5

En este momento la periferia descentralizada no est√° disponible (p. ej. fallo de estaci√≥n).

80C8

La funci√≥n no est√° autorizada en el actual estado operativo del maestro DP.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

DPSYC_FR: Sincronizar esclavos DP / Congelar entradas
Descripci√≥n
Esta instrucci√≥n permite sincronizar uno o varios grupos de esclavos DP.
Para ello debe enviarse a los grupos en cuesti√≥n uno de los siguientes comandos de control
o una combinaci√≥n de ellos:
‚óè SYNC (emisi√≥n y congelaci√≥n simult√°neas de estados de salida en los esclavos DP)
‚óè UNSYNC (anula el comando de control SYNC)
‚óè FREEZE (congelaci√≥n de estados de entrada en los esclavos DP y lectura de las entradas
congeladas)
‚óè UNFREEZE (anula el comando de control FREEZE)
Antes de enviar los comandos de control mencionados, deben haberse dividido en grupos,
mediante configuraci√≥n, los esclavos DP. Es necesario saber qu√© esclavo DP est√° asignado
a cada grupo y con qu√© n√∫mero, as√≠ como las caracter√≠sticas de cada uno de los grupos en lo
que respecta al comportamiento de SYNC/FREEZE.
Nota
Debe tenerse en cuenta que los comandos de control SYNC y FREEZE mantienen su validez
incluso en caso de rearranque completo o arranque en fr√≠o.
Tambi√©n debe tenerse en cuenta que en cada momento solo puede estar lanzada una petici√≥n
SYNC/UNSYNC y solo una petici√≥n FREEZE/UNFREEZE.

5950

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Funcionamiento
"DPSYC_FR" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se prolonga a lo largo
de varias llamadas. Para iniciar la petici√≥n, debe llamarse "DPSYC_FR" con REQ=1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).

Identificaci√≥n de una petici√≥n
Si se ha lanzado una petici√≥n SYNC/FREEZE y se ha vuelto a llamar "DPSYC_FR" antes de
que finalice, el comportamiento posterior de la instrucci√≥n depende esencialmente de si la
nueva llamada corresponde a la misma petici√≥n. Si los par√°metros de entrada LADDR,
GROUP y MODE coinciden entre s√≠, la llamada se considera una llamada consecutiva.

Escribir en salidas de m√≥dulos DP
La escritura en las salidas de los m√≥dulos DP se lanza mediante
‚óè Comandos de transferencia a la periferia DP,
‚óè La escritura de la memoria imagen de proceso de las salidas en los m√≥dulos (mediante el
sistema operativo al final del OB 1 o mediante llamada de la instrucci√≥n "UPDAT_PO
(P√°gina 5883)"),
‚óè La llamada de la instrucci√≥n "DPWR_DAT (P√°gina 5932)".
En el caso normal, el maestro DP transfiere los datos de salida c√≠clicamente (en el ciclo del bus
PROFIBUS DP) a las salidas de los esclavos DP.
Si se desea transferir a las salidas al proceso de manera exactamente simult√°nea
determinados datos de salida que pueden estar repartidos entre varios esclavos, debe
enviarse al maestro DP correspondiente el comando de control SYNC con ayuda de la
instrucci√≥n "DPSYC_FR".

¬øQu√© efecto produce SYNC?
Con el comando de control SYNC se ponen en modo de sincronizaci√≥n los esclavos DP de los
grupos especificados, es decir, el maestro DP transfiere los datos de salida actuales y ordena
a los esclavos DP implicados que congelen las salidas. En los siguientes telegramas de salida,
los esclavos DP guardan los datos de salida en un b√∫fer interno; el estado de las salidas
permanece invariable.
Despu√©s de cada comando de control SYNC, los esclavos DP de los grupos seleccionados
depositan los datos de salida de su b√∫fer interno en las salidas al proceso.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5951

Instrucciones
4.2 Instrucciones
Las salidas no se vuelven a actualizar c√≠clicamente hasta que el usuario env√≠a el comando de
control UNSYNC con ayuda de la instrucci√≥n "DPSYC_FR" .
Nota
Si, en el momento en que se env√≠a el comando de control, alg√∫n esclavo DP del grupo o grupos
seleccionados no se encuentra conectado a la red o presenta un fallo, dichos esclavos
tampoco pasan al modo SYNC. Este hecho no se notifica mediante el valor de retorno de la
instrucci√≥n.

Leer entradas de m√≥dulos DP
Se leen los datos de entrada de los m√≥dulos DP
‚óè Con comandos de carga a la periferia DP,
‚óè Al actualizar la memoria imagen de proceso de las entradas (mediante el sistema operativo
al final del OB 1 o mediante llamada de la instrucci√≥n "UPDAT_PI (P√°gina 5881)"),
‚óè Llamando la instrucci√≥n "DPRD_DAT (P√°gina 5929)".
En el caso normal, el maestro DP recibe estos datos de entrada c√≠clicamente (en el ciclo del
bus PROFIBUS DP) desde sus esclavos DP y los pone a disposici√≥n de la CPU.
Si se desea leer desde el proceso de manera exactamente simult√°nea determinados datos de
entrada que pueden estar repartidos entre varios esclavos, debe enviarse al maestro DP
correspondiente el comando de control FREEZE con ayuda de la instrucci√≥n "DPSYC_FR".

¬øQu√© efecto produce FREEZE?
Con el comando de control FREEZE se ponen en modo de congelaci√≥n los esclavos DP
afectados, es decir, el maestro DP ordena a los esclavos DP afectados que congelen el estado
actual de las entradas. A continuaci√≥n transfiere los datos congelados al √°rea de entrada de la
CPU.
Despu√©s de cada comando de control FREEZE, los esclavos DP vuelven a congelar el estado
de las entradas.
El maestro DP no vuelve a recibir c√≠clicamente el estado actual de las entradas hasta que el
usuario env√≠a el comando de control UNFREEZE con ayuda de la instrucci√≥n "DPSYC_FR".
Nota
Si, en el momento en que se env√≠a el comando de control, alg√∫n esclavo DP del grupo o grupos
seleccionados no se encuentra conectado a la red o presenta un fallo, dichos esclavos
tampoco pasan al modo Freeze. Este hecho no se notifica mediante el valor de retorno de la
instrucci√≥n.

Coherencia de datos
Debido al funcionamiento as√≠ncrono y a la posibilidad de interrupci√≥n por clases de prioridad
superiores, al utilizar la instrucci√≥n "DPSYC_FR" debe asegurarse que las memorias imagen
de proceso sean coherentes con las entradas y salidas reales de la periferia.

5952

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para garantizarlo, debe aplicarse una de las reglas de coherencia que se mencionan a
continuaci√≥n:
‚óè Defina memorias imagen parcial de proceso adecuadas (solo posible con S7-400) para las
salidas "SYNC" y las entradas "FREEZE". Llame la instrucci√≥n "UPDAT_PO (P√°gina 5883)"
inmediatamente antes de cada primera llamada de una petici√≥n SYNC. Llame la instrucci√≥n
"UPDAT_PI (P√°gina 5881)" inmediatamente despu√©s de cada √∫ltima llamada de una
petici√≥n FREEZE.
‚óè Alternativamente: Para las salidas afectadas por una petici√≥n SYNC, y para las entradas
afectadas por una petici√≥n FREEZE, utilice solo accesos directos a la periferia. Mientras
haya una petici√≥n SYNC en curso, no es posible escribir en las salidas afectadas, ni
tampoco leer las entradas afectadas mientras est√° en curso una petici√≥n FREEZE.

Uso de DPWR_DAT y DPRD_DAT
Si se utiliza la instrucci√≥n "DPWR_DAT (P√°gina 5932)", √©sta debe estar finalizada antes de que
se env√≠e una petici√≥n SYNC para las salidas en cuesti√≥n.
Si se utiliza la instrucci√≥n "DPRD_DAT (P√°gina 5929)", √©sta debe estar finalizada antes de que
se env√≠e una petici√≥n FREEZE para las entradas en cuesti√≥n.

Arranque y "DPSYC_FR"
El env√≠o de los comandos de control SYNC y FREEZE en los OBs de arranque es
responsabilidad exclusiva del usuario.
Si se desea que las salidas de uno o varios grupos empiecen a funcionar en el modo SYNC ya
desde el inicio del programa de usuario, deben inicializarse esas salidas en el arranque y
ejecutarse por completo la instrucci√≥n "DPSYC_FR" con el comando de control SYNC.
Si se desea que las entradas de uno o varios grupos empiecen a funcionar en el modo
FREEZE ya desde el inicio del programa de usuario, debe ejecutarse por completo para esas
entradas la instrucci√≥n "DPSYC_FR" con el comando de control FREEZE.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DPSYC_FR":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control disparado por nivelREQ=1:
Lanzar la petici√≥n SYNC/FREEZE

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n l√≥gica del maestro DP

GROUP

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Selecci√≥n de grupo
Bit 0 = 1: Grupo 1 seleccionado
Bit 1 = 1: Grupo 2 seleccionado
:
Bit 7 = 1: Grupo 8 seleccionado
Pueden seleccionarse varios grupos por petici√≥n.
El valor B#16#0 no est√° permitido.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5953

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

ID de la petici√≥n (codificaci√≥n seg√∫n EN 50 170 Vo‚Äê
lume 2, PROFIBUS)
Bit 0: Reservado (valor 0)
Bit 1: Reservado (valor 0)
Bit 2:
‚óè = 1: UNFREEZE se ejecuta
‚óè = 0: Sin significado
Bit 3:
‚óè = 1: FREEZE se ejecuta
‚óè = 0: Sin significado
Bit 4:
‚óè = 1: UNSYNC se ejecuta
‚óè = 0: Sin significado
Bit 5:
‚óè = 1: SYNC se ejecuta
‚óè = 0: Sin significado
Bit 6: Reservado (valor 0)
Bit 7: Reservado (valor 0)
Valores posibles:
‚óè Con una y solo una ID por petici√≥n:
‚Äì

B#16#04 (UNFREEZE)

‚Äì

B#16#08 (FREEZE)

‚Äì

B#16#10 (UNSYNC)

‚Äì

B#16#20 (SYNC)

‚óè Con varias IDs por petici√≥n:

RET_VAL

Return

INT

I, Q, M, D, L

‚Äì

B#16#14 (UNSYNC, UNFREEZE)

‚Äì

B#16#18 (UNSYNC, FREEZE)

‚Äì

B#16#24 (SYNC, UNFREEZE)

‚Äì

B#16#28 (SYNC, FREEZE)

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° un c√≥‚Äê
digo de error.
Despu√©s de cada pasada del bloque debe evaluar‚Äê
se RET_VAL .

BUSY

Output

BOOL

I, Q, M, D, L

BUSY=1:
La petici√≥n de SYNC/FREEZE todav√≠a no ha finali‚Äê
zado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

5954

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
Nota
Si accede a esclavos DPV1, el maestro DP puede transferir la informaci√≥n de error de dichos
esclavos a la instrucci√≥n. Encontrar√° una descripci√≥n de esta informaci√≥n de error en
STATUS[3], par√°metro STATUS (P√°gina 5901).

C√≥digo de
error
(W#16#...)

Explicaci√≥n

0000

La petici√≥n se ha ejecutado sin errores.

7000

Primera llamada con REQ=0. La petici√≥n definida mediante LADDR, GROUP y MODE no est√° activa; BUSY
tiene el valor "0".

7001

Primera llamada con REQ=1. La petici√≥n definida mediante LADDR, GROUP y MODE se ha lanzado; BUSY
tiene el valor 1.

7002

Llamada intermedia (REQ irrelevante). La petici√≥n SYNC/FREEZE activada todav√≠a est√° en curso; BUSY
tiene el valor 1.

8090

El m√≥dulo seleccionado mediante LADDR no es un maestro DP.

8093

Esta instrucci√≥n no es v√°lida para el m√≥dulo seleccionado con LADDR (configuraci√≥n o versi√≥n del maestro
DP).

8094

Par√°metros GROUP err√≥neos

8095

Par√°metros MODE err√≥neos

80B0

El grupo seleccionado mediante GROUP no est√° configurado.

80B1

El grupo seleccionado mediante GROUP no est√° asignado a esta CPU.

80B2

La petici√≥n SYNC especificada mediante MODE no est√° permitida en el grupo seleccionado mediante
GROUP.

80B3

La petici√≥n FREEZEespecificada mediante MODE no est√° autorizada en el grupo seleccionado mediante
GROUP .

80C2

Falta de recursos temporal del maestro DP: En este momento el maestro DP est√° procesando el m√°ximo
posible de peticiones para una CPU.

80C3

Esta petici√≥n SYNC/UNSYNCno se puede activar en este momento, ya que en cada momento determinado
solo puede estar lanzada una petici√≥n SYNC/UNSYNC. Compruebe el programa de usuario.

80C4

Esta petici√≥n FREEZE/UNFREEZEno se puede activar en este momento, ya que en cada momento deter‚Äê
minado solo puede estar lanzada una petici√≥n FREEZE/UNFREEZE. Compruebe el programa de usuario.

80C5

Cortocircuito en la proximidad inmediata de la interfaz DP

80C6

Interrupci√≥n de la petici√≥n debido a expulsi√≥n de la periferia por la CPU

80C7

Interrupci√≥n de la petici√≥n debido a rearranque completo (en caliente) o arranque en fr√≠o del maestro DP

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5955

Instrucciones
4.2 Instrucciones

DPNRM_DG: Leer datos de diagn√≥stico de un esclavo DP
Descripci√≥n
La instrucci√≥n "DPNRM_DG" lee los datos de diagn√≥stico actuales de un esclavo DP de la
forma establecida por EN 50 170 Volume 2, PROFIBUS. Los datos le√≠dos se introducen en el
√°rea de destino determinada por RECORD tras la correcta transferencia de los datos.
La estructura fundamental del diagn√≥stico de esclavo se recoge en la siguiente tabla, y la
informaci√≥n m√°s detallada, en los manuales de los esclavos DP.
Byte

Significado

0

Estado de estaci√≥n 1

1

Estado de estaci√≥n 2

2

Estado de estaci√≥n 3

3

N√∫mero de estaci√≥n maestra

4

Identificaci√≥n de fabricante (high byte)

5

Identificaci√≥n de fabricante (low byte)

6 ...

Otros diagn√≥sticos espec√≠ficos de esclavo

Funcionamiento
La lectura se realiza de forma as√≠ncrona, es decir, que se puede prolongar a lo largo de varias
llamadas. El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y
BUSY.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).

Llamada
Para iniciar la lectura, debe ajustarse a "1" el par√°metro de entrada REQ al llamar la instrucci√≥n.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DPNRM_DG":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: solicitud de lectura

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n de diagn√≥stico configurada del esclavo
DP
Nota: La direcci√≥n se debe indicar en formato
hexadecimal; p. ej. la direcci√≥n de diagn√≥stico
1022 significa: LADDR:=W#16#3FE.

RET_VAL

5956

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° un
c√≥digo de error. Si no aparece ning√∫n error, en
RET_VAL se especifica la longitud de los datos
realmente transferidos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RECORD

Output

ANY

I, Q, M, D, L

√Årea de destino para los datos de diagn√≥stico
le√≠dos. Solo se admite el tipo de datos BYTE . La
longitud m√≠nima del registro que se debe leer o
del √°rea de destino es de 6. La longitud m√°xima
del registro que se debe leer es de 240; en es‚Äê
clavos normalizados cuyo n√∫mero de datos de
diagn√≥stico normalizados sea superior a 240
bytes y tenga un m√°ximo de 244 bytes, los pri‚Äê
meros 240 bytes se transfieren al √°rea de destino
y el correspondiente bit de desbordamiento se
activa en los datos.
Nota: Tenga en cuenta que en las CPUs S7-300,
el par√°metro RECORD siempre requiere que se
especifiquen por completo los par√°metros de DB
(ej.: P#DB13.DBX0.0 byte 100). En las CPUs
S7-300 no est√° permitido omitir un n√∫mero de DB
expl√≠cito; de lo contrario se genera un aviso de
error en el programa de usuario.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY=1:
La lectura todav√≠a no ha finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Encontrar√° informaci√≥n sobre la conversi√≥n de tipos de datos en los distintos lenguajes de
programaci√≥n en "Sinopsis de la conversi√≥n de tipos de datos (P√°gina 366)".

Par√°metro RECORD
La CPU valora la longitud real de los datos de diagn√≥stico le√≠dos:
Si la indicaci√≥n de longitud de RECORD
‚óè es inferior al n√∫mero de datos proporcionados, los datos se rechazan y en RET_VAL se
deposita la correspondiente informaci√≥n de error.
‚óè

es superior o igual al n√∫mero de datos proporcionados, los datos se aceptan en el √°rea de
destino y en RET_VAL se deposita la longitud real como valor positivo.
Nota
Hay que asegurarse de que los par√°metros actuales de RECORD coincidan en todas las
llamadas pertenecientes a una petici√≥n.
Una petici√≥n est√° claramente establecida por el par√°metro de entrada LADDR.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5957

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
‚óè Si se ha producido un error durante la ejecuci√≥n de la funci√≥n, el valor de respuesta
contendr√° un c√≥digo de error,
‚óè Si durante la transferencia no se ha producido ning√∫n error, RET_VAL contiene la longitud
de los datos le√≠dos en bytes como n√∫mero positivo.
Nota
En un esclavo DP, el n√∫mero de datos le√≠dos depende de su estado de diagn√≥stico.
Para evaluar la informaci√≥n de error del par√°metro RET_VAL , v√©ase Evaluaci√≥n de errores
con el par√°metro de salida RET_VAL (P√°gina 174). All√≠ encontrar√° tambi√©n la informaci√≥n
general de error de las instrucciones. La informaci√≥n espec√≠fica de error "DPNRM_DG" es una
parte de la informaci√≥n de error de "RD_REC (P√°gina 5922)".

Esclavos normalizados con datos de diagn√≥stico de m√°s de 240 bytes
En esclavos normalizados con un n√∫mero de datos de diagn√≥stico normalizados entre 241 y
244 bytes, debe tenerse en cuenta los siguiente:
Si la indicaci√≥n de longitud de RECORD
‚óè es inferior a 240 bytes, los datos se rechazan y en RET_VAL se deposita la correspondiente
informaci√≥n de error.
‚óè es superior o igual a 240 bytes, los primeros 240 bytes de los datos de diagn√≥stico
normalizados se transfieren al √°rea de destino y en los datos se activa el correspondiente
bit de desbordamiento.

Recursos del sistema con S7-400
En S7-400, al llamar "DPNRM_DG" para una petici√≥n no procesada en ese momento, se
asignan los recursos (espacio de memoria) de la CPU. Es posible llamar "DPNRM_DG"
sucesivamente a intervalos breves para varios esclavos DP, siempre que no se rebase la
cantidad m√°xima de peticiones "DPNRM_DG" "simult√°neas" activas que la CPU es capaz de
procesar.
Si existen varias peticiones activas "simult√°neas", se garantiza que todas las peticiones se
ejecuten y que no se produzcan interferencias rec√≠procas.
En el momento en que se alcanza el l√≠mite de los recursos del sistema, se env√≠a una
notificaci√≥n mediante RET_VAL. En tal caso debe repetirse la petici√≥n.

Consulte tambi√©n
Sinopsis de la conversi√≥n de tipos de datos (P√°gina 366)

5958

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

DP_TOPOL: Determinar topolog√≠a para sistema maestro DP
Descripci√≥n
Esta instrucci√≥n permite lanzar la determinaci√≥n de topolog√≠a para un sistema maestro
seleccionado. Al llamar esta instrucci√≥n, se accede a todos los repetidores de diagn√≥stico
conectados a un sistema maestro DP.
Nota
La determinaci√≥n de topolog√≠a puede efectuarse en cada momento concreto solo para un
sistema maestro DP.
La determinaci√≥n de topolog√≠a es imprescindible para poder visualizar con detalle la ubicaci√≥n
de los eventuales errores de cable. Despu√©s del montaje del sistema maestro DP y de cada
modificaci√≥n de su estructura f√≠sica, debe efectuarse de nuevo la determinaci√≥n de topolog√≠a
con la instrucci√≥n "DP_TOPOL".
Se considera que se ha modificado la estructura f√≠sica cuando:
‚óè Se modifican longitudes de cables
‚óè Se a√±aden o eliminan estaciones o componentes con funci√≥n de repetidor
‚óè Se modifican direcciones de estaciones
Si un repetidor de diagn√≥stico notifica un error, "DP_TOPOL" escribe en las salidas DPR y
DPRI a lo largo de la duraci√≥n de un paso de "DP_TOPOL". Si varios repetidores de
diagn√≥stico del sistema maestro DP seleccionado notifican errores, "DP_TOPOL" env√≠a a DPR
y DPRI informaci√≥n acerca del primer repetidor de diagn√≥stico que ha notificado errores. La
informaci√≥n de diagn√≥stico completa se puede leer con la instrucci√≥n "DPNRM_DG
(P√°gina 5956)" o en la PG. Si ning√∫n repetidor de diagn√≥stico notifica errores, las salidas DPR
y DPRI adquieren el valor NULL.
Si, despu√©s de producirse un error, se desea volver a lanzar una determinaci√≥n de topolog√≠a,
en primer lugar debe restablecerse "DP_TOPOL". Para hacerlo, debe llamarse "DP_TOPOL"
con REQ=0 y R=1.

Funcionamiento
"DP_TOPOL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se prolonga a lo largo
de varias llamadas. Para iniciar la determinaci√≥n de topolog√≠a de bus, debe llamarse
"DP_TOPOL" con REQ=1 . Para interrumpir la operaci√≥n, debe llamarse "DP_TOPOL" con
R=1 .
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY .
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).
Nota
La determinaci√≥n de topolog√≠a puede durar varios minutos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5959

Instrucciones
4.2 Instrucciones

Identificaci√≥n de una petici√≥n
El par√°metro de entrada DP_ID define una petici√≥n de manera un√≠voca.
Si se ha llamado "DP_TOPOL" y se vuelve a llamar la misma instrucci√≥n antes de que finalice
la determinaci√≥n de topolog√≠a, el comportamiento posterior de la instrucci√≥n depende de si la
nueva llamada corresponde a la misma petici√≥n: Si el par√°metro DP_ID coincide con una
petici√≥n todav√≠a no finalizada, la llamada se interpreta como llamada consecutiva, y en
RET_VALse registra el valor W#16#7002. En cambio, si se trata de una petici√≥n diferente, la
CPU la rechaza.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DP_TOPOL":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ=1: Lanzar determinaci√≥n de topolog√≠a

R

Input

BOOL

I, Q, M, D, L

R=1: Interrumpir la determinaci√≥n de topolog√≠a

DP_ID

Input

INT

I, Q, M, D, L o cons‚Äê
tante

ID del sistema maestro DP cuya topolog√≠a se
debe determinar

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° un
c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY=1: La determinaci√≥n de topolog√≠a todav√≠a
no ha finalizado.

DPR

Output

BYTE

I, Q, M, D, L

Direcci√≥n PROFIBUS del repetidor de diagn√≥s‚Äê
tico que notifica errores

DPRI

Output

BYTE

I, Q, M, D, L

Segmento de medici√≥n del repetidor de diagn√≥s‚Äê
tico que notifica errores:
‚óè Bit 0 = 1: Fallos temporales en el segmento
DP2
‚óè Bit 1 = 1: Fallos permanentes en el segmento
DP2
‚óè Bit 4 = 1: Fallos temporales en el segmento
DP3
‚óè Bit 5 = 1: Fallos permanentes en el segmento
DP3

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

5960

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
Dentro de la informaci√≥n de error "verdadera" (c√≥digos de error W#16#8xyz) de la tabla
siguiente, debe distinguirse entre dos casos:
‚óè Errores temporales (c√≥digos de error de W#16#80A2 a 80A4, 80C3, 80C5):
En este tipo de errores es posible que el error se elimine sin intervenci√≥n del usuario, es
decir, puede bastar con llamar de nuevo "DP_TOPOL" (varias veces si es necesario).
Ejemplo de error temporal: En este momento los recursos necesarios est√°n ocupados
(W#16#80C3).
‚óè Errores permanentes (c√≥digos de error de W#16#8082, 80B0, 80B2):
Los errores de este tipo no se pueden eliminar sin intervenci√≥n del usuario. Solo tiene
sentido volver a llamar "DP_TOPOL" una vez que se haya eliminado el error. Ejemplo de
error permanente: El maestro DP o la CPU no soportan este servicio. (W#16#80B0).
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

La petici√≥n se ha ejecutado sin errores.

7000

Primera llamada con REQ=0. No se ha lanzado ninguna determinaci√≥n de topolog√≠a. BUSY tiene el valor
"0".

7001

Primera llamada con REQ=1. Se ha lanzado la petici√≥n de determinaci√≥n de topolog√≠a. BUSY tiene el valor
"1".

7002

Llamada intermedia (REQ irrelevante): La determinaci√≥n de topolog√≠a todav√≠a est√° proces√°ndose. BUSY
tiene el valor "1".

7010

Se ha intentado interrumpir la determinaci√≥n de topolog√≠a. Sin embargo, no hay ninguna petici√≥n en curso
con la DP_IDindicada. BUSY tiene el valor "0".

7011

Primera llamada con R=1. Se ha lanzado la interrupci√≥n de la determinaci√≥n de topolog√≠a; BUSY tiene el
valor "1".

7012

Llamada intermedia: La interrupci√≥n de la determinaci√≥n de topolog√≠a todav√≠a est√° proces√°ndose. BUSY
tiene el valor "1".

7013

√öltima llamada: Se ha interrumpido la determinaci√≥n de topolog√≠a. BUSY tiene el valor "0".

8082

No est√° configurado ning√∫n maestro DP con la DP_ID indicada.

80A2

Error en determinaci√≥n de topolog√≠a; encontrar√° informaci√≥n m√°s detallada en los par√°metros de salida
DPR y DPRI.

80A3

Error en determinaci√≥n de topolog√≠a: El tiempo de vigilancia ha finalizado (timeout).

80A4

Fallo de comunicaci√≥n en el bus K

80B0

El maestro DP o la CPU no soportan este servicio.

80B2

Error en determinaci√≥n de topolog√≠a: No se ha detectado ning√∫n repetidor de diagn√≥stico en el sistema
maestro DP seleccionado.

80C3

En este momento los recursos necesarios est√°n ocupados. Causa posible: Ha iniciado una segunda
determinaci√≥n de la topolog√≠a (no est√° permitido determinar m√°s de una topolog√≠a en un determinado
instante).

80C5

El sistema maestro DP no est√° disponible en este momento.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5961

Instrucciones
4.2 Instrucciones

ASi
ASi_3422: Controlar comportamiento del maestro ASi
Descripci√≥n
La instrucci√≥n "ASi_3422" se requiere para utilizar el modo de operaci√≥n "Modo de
funcionamiento avanzado" con el CP 342-2. El modo de funcionamiento avanzado permite
controlar por completo el comportamiento del maestro a trav√©s del programa de usuario. El
acceso a las entradas y salidas se realiza, como es habitual, en el modo de funcionamiento
est√°ndar del CP 342-2.
Las llamadas a comandos enviadas al CP342-2 se realizan desde el programa de usuario, a
trav√©s de la instrucci√≥n. Para ello es necesario especificar una llamada de comando en un
b√∫fer de transmisi√≥n e iniciar la petici√≥n.
La instrucci√≥n "ASi_3422" transfiere la llamada de comando al CP342-2. Al finalizar la petici√≥n,
se transfiere el estado de la petici√≥n y se ponen a disposici√≥n los posibles datos de respuesta
en un b√∫fer de recepci√≥n.

Llamada
La instrucci√≥n debe llamarse c√≠clicamente para cada CP342-2 existente. Por cada CP342-2
s√≥lo puede ejecutarse una petici√≥n simult√°neamente. Una petici√≥n en curso no puede
interrumpirse y no est√° sometida a vigilancia de tiempo por la instrucci√≥n. La instrucci√≥n
"ASi_3422" no se puede ejecutar con posibilidad de interrupci√≥n. Por ello las llamadas no se
pueden programar en niveles de ejecuci√≥n que se interrumpan rec√≠procamente (p. ej. con
llamada en el OB 1 y en el OB 35).
Defina el procesamiento del comando en el programa de usuario del modo siguiente:
1. En caso de rearranque del programa de usuario S7, debe llamarse "ASi_3422" una sola vez
con el valor de par√°metro STARTUP = TRUE.
2. En el programa de usuario, especifique la llamada del comando en un b√∫fer de transmisi√≥n.
Este b√∫fer de transmisi√≥n se transfiere con el par√°metro de llamada SEND.
Encontrar√° m√°s informaci√≥n sobre la interfaz de comandos del CP y los comandos del
esclavo AS-i en la documentaci√≥n de hardware del procesador de comunicaciones.
3. Seg√∫n el tipo de comando, se requiere un b√∫fer de respuesta. Este b√∫fer de respuesta se
transfiere con el par√°metro de llamada RECV. Con esta interfaz no se requiere el b√∫fer de
respuesta para informaci√≥n de estado.
4. Active la petici√≥n mediante el par√°metro ACT=1.
5. A continuaci√≥n, consulte los par√°metros DONE, ERROR y STATUS.

5962

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ASi_3422":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ACT

Input

BOOL

I, Q, M, D, L

La ejecuci√≥n del comando por la funci√≥n se
dispara por nivel, es decir, mientras ACT = 1,
se inicia la ejecuci√≥n del comando, en caso de
que no haya una llamada en ejecuci√≥n.

STARTUP

Input

BOOL

I, Q, M, D, L

Un arranque de la CPU se notifica a la instruc‚Äê
ci√≥n mediante STARTUP = 1. Despu√©s de la
primera ejecuci√≥n de la funci√≥n, el usuario de‚Äê
be desactivar STARTUP.

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n inicial de un m√≥dulo

SEND

Input

ANY

I, Q, M, D, L

La direcci√≥n inicial de un m√≥dulo, en m√≥dulos
de se√±al, se determina de acuerdo con los da‚Äê
tos sobre asignaci√≥n de direcci√≥n orientada a
slot.
B√∫fer de transmisi√≥n
El par√°metro remite a un √°rea de memoria en
la que el usuario debe especificar el comando,
p. ej.: P#DB20.DBX 20.0 Byte 10.

RECV

Input

ANY

I, Q, M, D, L

B√∫fer de recepci√≥n
Este b√∫fer solo es relevante para comandos
que devuelven datos de respuesta. El par√°me‚Äê
tro remite a un √°rea de memoria en la que se
guarda una respuesta al comando. La longitud
del √°rea de datos parametrizada aqu√≠ es irre‚Äê
levante, p. ej.: P#DB30.DBX 20.0 Byte 1

DONE

Output

BOOL

Q, M, D, L

Con DONE = 1 se se√±aliza "Petici√≥n finalizada
sin error".

ERROR

Output

BOOL

Q, M, D, L

Con ERROR = 1 se se√±aliza "Petici√≥n finaliza‚Äê
da con error".

STATUS

InOut

DWORD

M, D

1. Palabra: Estado de la petici√≥n/c√≥digo de
error (ver la tabla siguiente); con "Petici√≥n fi‚Äê
nalizada con error" se genera un c√≥digo de
error para obtener una descripci√≥n m√°s deta‚Äê
llada del error.
2. Palabra: Es utilizada por la instrucci√≥n para
fines internos y no puede modificarse.
Para llamadas de instrucci√≥n en diferentes di‚Äê
recciones l√≥gicas (LADDR) deben asignarse
diferentes palabras dobles para el par√°metro
STATUS.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro LADDR
La direcci√≥n de inicio de esta √°rea de memoria se determina mediante el slot del CP 342-2.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5963

Instrucciones
4.2 Instrucciones
El CP 342-2 ocupa 16 bytes de entrada y 16 bytes de salida en el √°rea de direcciones E/S del
aut√≥mata programable S7 (√°rea anal√≥gica del AS). De los 16 bytes del √°rea de direcciones del
CP 342-2 se asignan 31 x 4 bits para datos del esclavo AS-i. Los 4 bits restantes est√°n
reservados para aplicaciones posteriores.

Par√°metros DONE, ERRORy STATUS
Si durante el procesamiento de la funci√≥n se produce un error, adem√°s de la informaci√≥n ya
mencionada en ERROR y STATUS se adjunta un "0" en el bit BR. La consulta del bit BR se
realiza de modo distinto en los programas de usuario KOP y AWL:
‚óè KOP: Consulta a trav√©s del par√°metro de salida ENO
‚óè AWL: Consulta directa del bit BR
La tabla siguiente contiene las posibles indicaciones de la 1¬™ palabra de STATUS en funci√≥n
de DONE y ERROR.
DONE

ERROR

STATUS

Significado

0

0

8181

La petici√≥n est√° en curso.

1

0

0000

Petici√≥n finalizada sin error.

0

1

8090

Direcci√≥n no v√°lida en el par√°metro LADDR.

0

1

80A0

Acuse negativo al leer el m√≥dulo.

0

1

80A1

Acuse negativo al escribir en el m√≥dulo.

0

1

80B0

El m√≥dulo no conoce este registro.

0

1

80B1

La longitud del registro indicada es err√≥nea.

0

1

80C0

No se puede leer el registro.

0

1

80C1

El registro indicado est√° siendo procesado en este momento.

0

1

80C2

Hay un atasco de peticiones.

0

1

80C3

Recursos (memoria) ocupados.

0

1

80C4

Error de comunicaci√≥n

0

1

8182

Significado: Identificaci√≥n despu√©s de rearranque con STARTUP=TRUE (sin errores).

0

1

8184

Tipo de datos del operando formal RECV, no admisible.

0

1

8381

Direcci√≥n del esclavo err√≥nea

0

1

8382

Esclavo no activado (no en LAS).

0

1

8383

Error en AS-Interface

0

1

8384

Comando (en el estado del CP) no admisible.

0

1

8385

El esclavo 0 existe.

0

1

83A1

No se ha encontrado en la AS-Interface el esclavo cuya direcci√≥n se desea cambiar.

0

1

83A2

El esclavo 0 existe.

0

1

83A3

El esclavo con la nueva direcci√≥n ya existe en la AS-Interface.

0

1

83A4

No es posible borrar la direcci√≥n del esclavo.

0

1

83A5

No es posible ajustar la direcci√≥n del esclavo.

0

1

83A6

No es posible guardar de modo permanente la direcci√≥n del esclavo.

0

1

83F8

N√∫mero de petici√≥n desconocido.

0

1

83F9

Error de EEPROM

5964

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

ERROR

STATUS

Significado

0

1

8F22

Error de longitud de √°rea al leer un par√°metro.

8F23

Error de longitud de √°rea al escribir un par√°metro.
Este c√≥digo de error indica que un par√°metro se encuentra total o parcialmente fuera
del √°rea del operando o que la longitud de un mapa de bits en un par√°metro ANY no es
divisible por 8.

0

0

0

1

1

1

8F24

Error de √°rea al leer un par√°metro.

8F25

Error de √°rea al escribir un par√°metro. Este c√≥digo de error indica que un par√°metro se
encuentra en un √°rea que no es admisible para una funci√≥n del sistema.

8F28

Error de alineaci√≥n al leer un par√°metro.

8F29

Error de alineaci√≥n al escribir un par√°metro. Este c√≥digo de error indica que la refe‚Äê
rencia a un par√°metro es un operando cuya direcci√≥n de bit es distinta de "0".

8F30

El par√°metro se encuentra en el DB global protegido contra escritura.

8F31

El par√°metro se encuentra en el DB de instancia protegido contra escritura.
Este c√≥digo de error indica que un par√°metro se encuentra en un bloque de datos
protegido contra escritura.

0

1

8F32

El par√°metro contiene un n√∫mero de DB demasiado alto

0

1

8F3A

El par√°metro contiene el n√∫mero de un DB que no est√° cargado.

0

1

8F42

Se ha producido un error de acceso mientras el sistema intentaba leer un par√°metro del
√°rea de periferia de las entradas.

8F43

Se ha producido un error de acceso mientras el sistema intentaba escribir un par√°metro
en el √°rea de periferia de las salidas.

8F44

Este c√≥digo de error indica que se ha denegado el acceso de lectura a un par√°metro.

8F45

Este c√≥digo de error indica que se ha denegado el acceso de escritura a un par√°metro.

8F7F

Error interno

0
0

1
1

ASI_CTRL: controlar comportamiento del maestro ASi
Descripci√≥n ASI_CTRL
Descripci√≥n
La instrucci√≥n "ASI_CTRL" permite controlar el comportamiento del maestro AS-i a trav√©s del
programa de usuario del PLC. La instrucci√≥n procesa autom√°ticamente el protocolo del
comando y permite la parametrizaci√≥n de maestros AS-i SIMATIC as√≠ como la lectura de datos
de informaci√≥n. Las posibilidades disponibles y el funcionamiento de la interfaz de comandos
se describen en el manual del maestro AS-i.
Se soportan maestros AS-i con conexi√≥n centralizada y maestros AS-i descentralizados v√≠a
PROFIBUS DP. Tambi√©n son posibles combinaciones con PROFINET IO (ejemplo: IE/PB Link
PN IO).
La figura siguiente muestra esquem√°ticamente la funcionalidad de la instrucci√≥n "ASI_CTRL":

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5965

Instrucciones
4.2 Instrucciones
(VWDFL¬µQ6,0$7,&

0DHVWUR$6L

3URJUDPDGHXVXDULR
$6,B&75/
&RPDQGRGH

%¬ºIHUGHUHFHSFL¬µQ

Escribir
registro

Consultar
estado



Leer registro



Datos de respuesta

‚ë†
‚ë°
‚ë¢
‚ë£
‚ë§
‚ë•




STATUS

Interfaz de comandos

%¬ºIHUGHWUDQVPLVL¬µQ
N.¬∫ de comando /
Datos de petici√≥n

Inicio

'LUHFFL¬µQLQLFLDO0DHVWUR$6L



Ejecuci√≥n de
comando



Inicio del procesamiento en el par√°metro REQ.
El programa transmite al maestro AS-i el comando deseado mediante la instrucci√≥n
"RDREC".
El maestro AS-i ejecuta el comando.
El estado actual del maestro AS-i se deposita en el √°rea de entrada de datos bina‚Äê
rios (direcci√≥n base l√≥gica).
La instrucci√≥n "ASI_CTRL" consulta c√≠clicamente los 4 bits de estado y los eval√∫a.
Si ha terminado la ejecuci√≥n de comandos, la petici√≥n de comandos concluye me‚Äê
diante "RDREC". En el campo de datos de "RDREC" se encuentran, para cada
comando, los datos de respuesta del mismo u otra informaci√≥n de estado.

Dependencias entre versiones de instrucciones
La versi√≥n V1.3 de la instrucci√≥n "ASI_CTRL" exige la versi√≥n V1.1 de la instrucci√≥n "WRREC".
La versi√≥n V1.2 de la instrucci√≥n "ASI_CTRL" exige la versi√≥n V1.1 de la instrucci√≥n "WRREC".

Diferencias en la llamada de comandos con IE/AS-i Link y CPs o DP/AS-i Links
Existen diferencias sustanciales en el procedimiento de intercambio de comandos entre un
controlador y un maestro AS-i.
‚óè Con IE/AS-i Link (PROFINET) se utiliza la interfaz de juegos de datos. Los distintos
comandos son llamados por diferentes n√∫meros de juegos de datos mediante "Escribir
registro" (instrucci√≥n "WRREC") o "Leer registro" (instrucci√≥n "RDREC").
‚óè Los CPs S7-300 y DP/AS-i Links (PROFIBUS) utilizan la interfaz de comandos. Todos los
comandos son llamados por el n√∫mero de juego de datos 2 mediante una pareja de
instrucciones "Escribir registro" (instrucci√≥n "WRREC") y "Leer registro" (instrucci√≥n
"RDREC"). El tipo de comando lo define el contenido de datos al efectuarse la petici√≥n de
escritura.

5966

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Cambios respecto de la instrucci√≥n "ASi_3422"
La instrucci√≥n "ASI_CTRL" es una versi√≥n revisada de la instrucci√≥n "ASi_3422 (P√°gina 5962)"
y presenta mejoras de funcionalidad y compatibilidad. En concreto, se han efectuado las
modificaciones siguientes:
‚óè Para escribir y leer juegos de datos de diagn√≥stico, las instrucciones "WR_REC
(P√°gina 5927)" y "RD_REC (P√°gina 5922)" han sido sustituidas por las instrucciones
"RDREC (P√°gina 5888)" y "WRREC (P√°gina 5890)". Sus funciones son id√©nticas, pero
soportan la transferencia de datos v√≠a PROFINET IO.
‚óè El tipo de bloque de la instrucci√≥n ha cambiado de funci√≥n (FC) a bloque de funci√≥n (FB).
"ASI_CTRL" dispone de un bloque de datos de instancia y es apto para multiinstancia.
‚óè La denominaci√≥n de los par√°metros formales de "ASI_CTRL" es conforme con los bloques
de sistema SIMATIC. Desaparece el par√°metro de entrada STARTUP. La definici√≥n del
par√°metro STATUS se ha basado en las instrucciones "RDREC (P√°gina 5888)" y "WRREC
(P√°gina 5890)". Adem√°s, se han adaptado las identificaciones de estado para el par√°metro
DONE y para el par√°metro BUSY nuevo.

Funcionamiento de la instrucci√≥n "ASI_CTRL"
La instrucci√≥n "ASI_CTRL" es un bloque de funci√≥n as√≠ncrono, de modo que la ejecuci√≥n se
prolonga a lo largo de varias llamadas.
‚óè Una petici√≥n se inicia con REQ = TRUE.
‚óè Mediante los par√°metros de salida BUSY y los dos bytes centrales del par√°metro de salida
STATUS se muestra el estado de la petici√≥n.
‚óè Mientras se procesa la petici√≥n, est√° activado el par√°metro BUSY. En la primera llamada,
STATUS contiene el valor 00700100H. En todas las llamadas sucesivas pertenecientes a
esta petici√≥n, contiene el valor 00700200H. Al concluir la petici√≥n, el resultado se indica en
los par√°metros DONE o ERROR.
‚Äì Si no se ha producido ning√∫n error, se activa DONE. En peticiones con datos de
respuesta del maestro AS-i, dichos datos se ponen a disposici√≥n en el b√∫fer de
recepci√≥n indicado. En este caso, adem√°s, en el par√°metro STATUS se muestra la
cantidad de datos proporcionados en bytes. En peticiones sin datos de respuesta, en
STATUS se registra el valor 00000000H.
‚Äì Si durante el procesamiento de la petici√≥n se presenta un error, se activa ERROR. En
ese caso, el contenido del b√∫fer de recepci√≥n no es v√°lido. Para definir con m√°s
precisi√≥n el error ocurrido, en el par√°metro STATUS se registra un c√≥digo de error.

N√∫mero de llamadas de comandos
Si se utiliza la instrucci√≥n "ASI_CTRL" para efectuar la petici√≥n de comandos, no deben
emitirse simult√°neamente otros comandos al mismo maestro AS-i mediante "RDREC
(P√°gina 5888)" y "WRREC (P√°gina 5890)". Lo mismo se aplica a las llamadas m√∫ltiples de la
instrucci√≥n en el mismo maestro AS-i.
La instrucci√≥n "ASI_CTRL" no se puede ejecutar con posibilidad de interrupci√≥n. Por ello, las
llamadas no se pueden programar en niveles de ejecuci√≥n que se interrumpan rec√≠procamente
(p. ej. con llamada en el OB 1 y en el OB 35).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5967

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ASI_CTRL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Con REQ = TRUE se inicia una petici√≥n nueva
siempre que no se est√© ejecutando otra. No se
realiza ninguna evaluaci√≥n de flancos.

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n inicial del maestro AS-i en el √°rea de
direcciones S7 (direcci√≥n base l√≥gica). La di‚Äê
recci√≥n inicial se determina en la configuraci√≥n
de hardware al configurar el maestro.

SD

Input

ANY

I, Q, M, D, L

B√∫fer de transmisi√≥n
El par√°metro remite a un √°rea de memoria en
la que debe especificarse el comando (v√©ase
"Comandos AS-i (P√°gina 5970)").
Ejemplo: P#DB101.DBX 0.0 BYTE 223

RD

Input

ANY

I, Q, M, D, L

B√∫fer de recepci√≥n
Este b√∫fer solo es relevante para comandos
que devuelven datos de respuesta. El par√°me‚Äê
tro remite a un √°rea de memoria en la que se
guarda una respuesta al comando (v√©ase "Co‚Äê
mandos AS-i (P√°gina 5970)").
Ejemplo: P#DB102.DBX 224.0 BYTE 221

DONE

Output

BOOL

Q, M, D, L

DONE = TRUE: petici√≥n finalizada sin errores.

BUSY

Output

BOOL

Q, M, D, L

BUSY = TRUE: petici√≥n en procesamiento.

ERROR

Output

BOOL

Q, M, D, L

ERROR = TRUE: petici√≥n cancelada con erro‚Äê
res.

STATUS

Output

DWORD

M, D

Estado de la petici√≥n / C√≥digo de error
V√©ase la descripci√≥n de "Par√°metro STATUS".

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Par√°metros LADDR, SD y RD
Los par√°metros LADDR, SD y RD no pueden modificarse en ninguna ejecuci√≥n del bloque
mientras se procesa una petici√≥n; deben permanecer constantes.

Par√°metro STATUS
La tabla siguiente contiene las posibles indicaciones de STATUS en funci√≥n de DONE y
ERROR.
DONE

BUSY

ERROR

STATUS

Significado

0

0

0

00700000H Primera llamada con REQ = FALSE; no hay ninguna petici√≥n activa.

0

1

0

00700100H Primera llamada con REQ = TRUE; petici√≥n lanzada.

0

1

0

00700200H Llamada sucesiva (REQ es irrelevante); se sigue procesando la petici√≥n.

5968

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DONE

BUSY

ERROR

STATUS

1

0

0

00000000H Petici√≥n finalizada sin errores. Sin datos de respuesta.

Significado

1

0

0

0000xx00H Petici√≥n finalizada sin errores. N√∫mero de bytes xx de los datos de res‚Äê
puesta.

0

0

1

C0818400

0

0

1

Tipo de datos del operando formal RD no admisible.

H

0

0

1

C0818500
H

Error de comunicaci√≥n con el maestro AS-i (direcci√≥n configurada err√≥‚Äê
neamente en el par√°metro LADDR).

C0838100

Direcci√≥n err√≥nea del esclavo AS-i.

H

0

0

1

0

0

1

C0838200

Esclavo AS-i no activado (no en LAS).

H

0

0

1

C0838300
H

Error en AS-Interface (es posible que se haya ajustado un valor insufi‚Äê
ciente en el par√°metro SD).

C0838400

En el estado actual del maestro AS-i este comando no est√° permitido.

H

0

0

1

0

0

1

C0838500

Existe un esclavo AS-i con direcci√≥n "0".

H

0

0

1

C0838600
H

El esclavo AS-i tiene datos de configuraci√≥n no permitidos (E/S o c√≥di‚Äê
gos ID).

C083A100

El esclavo AS-i direccionado no se encuentra en el AS-Interface.

H

0

0

1

0

0

1

C083A200

Existe un esclavo AS-i con direcci√≥n "0".

H

C083A300

En el AS-Interface ya existe un esclavo AS-i con la direcci√≥n nueva.

H

0

0

1

C083A400

No es posible borrar la direcci√≥n del esclavo AS-i.

H

0

0

1

0

0

1

C083A500

No es posible establecer la direcci√≥n del esclavo AS-i.

H

C083A600

No es posible guardar permanentemente la direcci√≥n del esclavo AS-i.

H

0

0

1

C083A700

Error al leer el c√≥digo Extended ID1.

H

0

0

1

C083A800
H

La direcci√≥n de destino no es plausible (p. ej., se utiliza una direcci√≥n de
esclavo B para un esclavo est√°ndar).

0

0

1

C083B100

Se ha producido un error de longitud en la transferencia de string.

H

0

0

1

C083B200

Se ha producido un error de protocolo en la transferencia de string.

H

0

0

1

0

0

1

C083F800

Se desconoce el n√∫mero de petici√≥n o el par√°metro de la petici√≥n.

H

C083F900

El maestro AS-i ha detectado un error EEPROM.

H

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5969

Instrucciones
4.2 Instrucciones

Comandos AS-i
Descripci√≥n
La interfaz de comandos permite intercambiar datos de parametrizaci√≥n e informaci√≥n entre el
controlador y el maestro AS-i.
Con estos comandos:
‚óè se proporciona a la especificaci√≥n del maestro AS-i la funcionalidad completa del perfil de
maestro M4;
‚óè puede configurarse completamente el maestro AS-i desde el controlador.
Nota
Comandos AS-i soportados
En el manual del maestro AS-i correspondiente pueden consultarse los comandos AS-i
soportados y una descripci√≥n detallada de los mismos.

Estructura general del b√∫fer de transmisi√≥n
La tabla siguiente muestra la estructura general del b√∫fer de transmisi√≥n para comandos y
datos de peticiones. El √°rea para el n√∫mero de comando debe estar ocupada siempre. El
n√∫mero de bytes para los datos de la petici√≥n figura en la descripci√≥n de cada comando (v√©ase
la documentaci√≥n del maestro AS-i). En este caso, "q" equivale a la direcci√≥n inicial del b√∫fer
de transmisi√≥n.
Byte

Bit 7

Bit 6

Bit 5

Bit 4

Bit 3

Bit 2

Bit 1

Bit 0

Significado
q+0

N√∫mero del comando

q+1

Datos de la petici√≥n

q+2

Datos de la petici√≥n

q + ...

Datos de la petici√≥n

Estructura general del b√∫fer de recepci√≥n
La tabla siguiente muestra la estructura general del b√∫fer de recepci√≥n para los datos de
respuesta del comando. El n√∫mero de bytes para los datos de respuesta depende de cada
comando. Algunos comandos no devuelven datos de respuesta y, por tanto, necesitan la
especificaci√≥n de un b√∫fer de recepci√≥n virtual que no se rellene con datos. En este caso, "n"
equivale a la direcci√≥n inicial del b√∫fer de recepci√≥n.
Byte

Bit 7

Bit 6

Bit 5

Bit 4

Bit 3

Bit 2

Bit 1

Bit 0

Significado

5970

n+0

Datos de respuesta

n+1

Datos de respuesta

n+2

Datos de respuesta

n + ...

Datos de respuesta

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

ATENCI√ìN
Las √°reas de memoria pueden sobrescribirse
Si el b√∫fer de recepci√≥n de la instrucci√≥n "ASI_CTRL" es demasiado corto, pueden
sobrescribirse las √°reas de memoria colindantes. La longitud indicada en el puntero ANY del
par√°metro RD durante la llamada de la instrucci√≥n "ASI_CTRL" es irrelevante. La longitud
necesaria del b√∫fer de recepci√≥n debe consultarse en la descripci√≥n del comando.
Para los n√∫meros de comando 39H, 41H, 42H, 43H y 44H se aplica lo siguiente:
el b√∫fer de recepci√≥n debe tener 221 bytes de longitud (del byte 0 al byte 220) aun cuando el
comando devuelva menos datos. Dependiendo del comando, el maestro AS-i puede
sobrescribir con valores cero los bytes m√°s altos contenidos en el b√∫fer de recepci√≥n.

Comandos AS-i
La tabla siguiente muestra una selecci√≥n posible de comandos AS-i.
Nombre

Par√°metro

Retorno

Codificaci√≥n

Configurar_valor_de_par√°metro
(Set_Permanent_Parameter)

Direcci√≥n de esclavo, par√°‚Äê
metros

Leer_valor_de_par√°metro_configurado
(Get_Permanent_Parameter)

Direcci√≥n de esclavo

Par√°metros

01 H

Escribir_valor_de_par√°metro
(Write_Parameter)

Direcci√≥n de esclavo, par√°‚Äê
metros

Eco de par√°metro

02 H

Leer_valor_de_par√°metro
(Read_Parameter)

Direcci√≥n de esclavo

Valor del par√°metro

03 H

00 H

Configurar_valores_de_par√°metros_reales
(Store_Actual_Parameters)

04 H

Configurar_datos_de_configuraci√≥n

Direcci√≥n de esclavo, confi‚Äê
guraci√≥n

Leer_datos_de_configuraci√≥n_configurados

Direcci√≥n de esclavo

25 H
Datos de configuraci√≥n
configurados

Configurar_datos_de_configuraci√≥n_reales
(Store_Actual_Configuration)

26 H
07 H

Leer_datos_de_configuraci√≥n_reales

Direcci√≥n de esclavo

Configurar_LPS

LPS

Datos de configuraci√≥n
reales

28 H
29 H

Activar_modo_Offline

Modo

0A H

Seleccionar_autoprogramaci√≥n

Modo

0B H

Activar_modo

Modo

0C H

Cambiar_direcci√≥n_esclavo_AS‚Äìi
(Change_AS‚ÄìiSlave_Address)

Direcci√≥n1, direcci√≥n2

0D H

Leer_estado_esclavo_AS‚Äìi

Direcci√≥n de esclavo

Leer_listas_y_flags

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Registro de errores del
esclavo AS-i

0F H

LDS, LAS, LPS, flags

30 H

5971

Instrucciones
4.2 Instrucciones
Nombre

Par√°metro

Leer_configuraci√≥n_total

Retorno

Codificaci√≥n

Datos de configuraci√≥n
reales, par√°metros ac‚Äê
tuales, LAS, flags

39 H

Configurar_configuraci√≥n_total

Configuraci√≥n total

3A H

Escribir_lista_par√°metros

Lista de par√°metros

3C H

Leer_lista_eco_par√°metros
Escribir_petici√≥n_CTT2

Direcci√≥n de esclavo
string CTT2

Leer_identificador_versi√≥n

Lista de ecos de par√°‚Äê
metros

33 H

String CTT2

44 H

String de versi√≥n

14 H
17 H

Leer_ID_esclavo_AS‚Äìi

Direcci√≥n de esclavo

C√≥digo ID

Leer_Extended‚ÄìID1_esclavo_AS-i

Direcci√≥n de esclavo

C√≥digo Extended ID1

Escribir_Extended-ID1_esclavo_AS‚Äìi

C√≥digo Extended ID1

Leer_Extended‚ÄìID2_esclavo_AS-i

Direcci√≥n de esclavo

C√≥digo Extended ID2

38 H

Leer_ES_esclavo_AS‚Äìi

Direcci√≥n de esclavo

Configuraci√≥n E/S

18 H

Leer_lista_errores_periferia

37 H
3F H

LPF

3E H

Escribir_string_par√°metros_esclavo_AS‚Äìi

Direcci√≥n de esclavo, string
de par√°metros

40 H

Leer_string_par√°metros_esclavo_AS‚Äìi

Direcci√≥n de esclavo

String de par√°metros

41 H

Leer_string_ID_esclavo_AS‚Äìi

Direcci√≥n de esclavo

String ID

42 H

Leer_string_diagn√≥stico_esclavo_AS‚Äìi

Direcci√≥n de esclavo

String de diagn√≥stico

43 H

Leer_contador_errores_l√≠nea_AS‚Äìi

4A H

Leer_y_borrar_contador_errores_l√≠nea_AS‚Äìi

4B H

Leer_contador_errores_esclavo_AS‚Äìi

Direcci√≥n de esclavo

4C H

Leer_y_borrar_contador_errores_esclavo_AS‚Äìi

Direcci√≥n de esclavo

4D H

Comando adicional para el DP/ AS-i F-Link:
Estado_AS-i/Diag_esclavos_F

Estado / Diagn√≥stico
de todos los esclavos
ASIsafe

51 H

Nota
Nueva inicializaci√≥n de la interfaz de comandos del maestro AS-i
Otro comando no mencionado en la tabla es el comando 77 H. Con esta llamada se reinicializa
la interfaz de comandos del maestro AS-i. Si justo en este momento el maestro AS-i indicado
est√° ocupado con un comando, este se interrumpe.
A partir de la versi√≥n V2.1.20 de DP/AS-i LINK Advanced se ofrece el comando adicional 0E H.
Con esta llamada puede habilitarse o bloquearse la funci√≥n de vigilancia de contacto a tierra
de una l√≠nea.

5972

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

4.2.3.5

PROFIenergy

Descripci√≥n de PROFIenergy
PROFIenergy
PROFIenergy es un perfil de gesti√≥n energ√©tica con PROFINET independiente de cualquier
fabricante y cualquier dispositivo concreto. PROFIenergy permite desconectar los dispositivos
de forma coordinada y centralizada para reducir el consumo el√©ctrico durante pausas de
producci√≥n o durante interrupciones no planificadas.
3DXVD

&RQVXPRGHHQHUJ¬ØD

3DXVD

7LHPSR

Los dispositivos PROFINET o los m√≥dulos de potencia se desconectan mediante comandos
especiales en el programa de usuario del controlador PROFINET IO. No se requiere hardware
adicional. Los dispositivos PROFINET interpretan directamente los comandos PROFIenergy.

Controlador PROFIenergy (controlador PE)
El controlador PE es un PLC que activa o desactiva el estado de reposo de los dispositivos
subordinados. La desconexi√≥n o la reactivaci√≥n de componentes de producci√≥n concretos o
de l√≠neas de producci√≥n enteras se realiza mediante el programa de usuario. Los comandos (p.
ej. "Start_Pause" o "End_Pause") se emiten al dispositivo subordinado mediante las
instrucciones correspondientes (bloques de funci√≥n). Los comandos se env√≠an con el
protocolo de comunicaci√≥n PROFINET.

Unidad PROFIenergy (unidad PE)
La unidad PE recibe los comandos PROFIenergy del controlador PE y los aplica de forma
correspondiente (p. ej. devolviendo un valor medido o activando un modo de ahorro de
energ√≠a). La aplicaci√≥n de la unidad PE en un dispositivo apto para PROFIenergy depende del
tipo de dispositivo y del fabricante.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5973

Instrucciones
4.2 Instrucciones
Le unidad PE se puede aplicar, por ejemplo, del siguiente modo:
‚óè En el proxy de un m√≥dulo: los comandos PE son v√°lidos para el m√≥dulo direccionado,
respectivamente, y dado el caso, para m√≥dulos subordinados.
‚óè En el proxy de una tarjeta: los comandos PE son v√°lidos para distintos m√≥dulos dentro de
la tarjeta, respectivamente.
&RQWURODGRU3(

'LVSRVLWLYR352),1(7,2

&RQWURODGRU3(

0¬µGXORGHLQWHUID]
,0 FRPRXQLGDG3(

0¬µGXORFRPRXQLGDG3(
&RPDQGR3(

'LVSRVLWLYR352),1(7,2

&RPDQGR3(

‚óè En un m√≥dulo sin funcionalidad Proxy dentro de la red: en este caso, los comandos PE solo
son v√°lidos para el m√≥dulo correspondiente.

Instrucciones PROFIenergy
‚óè Instrucciones para controlador IO
‚Äì La manera m√°s sencilla de activar o desactivar el estado de reposo de los dispositivos
PROFINET es con la instrucci√≥n "PE_START_END (P√°gina 5975)" (comandos
PROFIenergy "Start_Pause" y "End_Pause"). mediante un flanco de se√±al ascendente
y descendente en la misma.
‚Äì La instrucci√≥n "PE_CMD (P√°gina 5979)" transfiere todos los comandos PROFIenergy,
incluidos "Start_Pause" y "End_Pause". Adem√°s, con otros comandos puede
consultarse el estado actual de los dispositivos PROFINET o su comportamiento
durante las pausas, por ejemplo.
‚Äì Con la instrucci√≥n "PE_DS3_Write_ET200S (P√°gina 5985)" se especifican los ajustes
para el comportamiento de conexi√≥n de un m√°ximo de 8 slots del ET 200S. Esta
instrucci√≥n no es una instrucci√≥n PROFIenergy pero complementa las funciones
PROFIenergy de un ET 200S.
‚óè Instrucci√≥n para iDevices
La instrucci√≥n "PE_I_DEV (P√°gina 6009)" permite ejecutar PROFIenergy tambi√©n en
iDevices. Esta instrucci√≥n recibe comandos PROFIenergy en el iDevice y los transfiere al
programa de usuario para ejecutarlos. Despu√©s de ejecutar el comando, el programa de
usuario llama otra vez a la instrucci√≥n "PE_I_DEV (P√°gina 6009)" para enviar acuse al
controlador IO. Para responder, se dispone para cada comando de un bloque auxiliar
espec√≠fico que proporciona a la instrucci√≥n "PE_I_DEV (P√°gina 6009)" los datos de
respuesta.

5974

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Comandos PROFIenergy (comandos PE)
El controlador PE env√≠a los comandos PE a la unidad PE. El comando PE puede ser un
comando de control para poner una unidad PE en un determinado modo de ahorro de energ√≠a,
o un comando para leer un estado o un valor medido:
‚óè Comandos PE para el control
PROFIenergy soporta dos comandos de control que pueden ejecutarse mediante la
instrucci√≥n "PE_Start_End (P√°gina 5975)" o mediante la instrucci√≥n "PE_CMD
(P√°gina 5979)":
‚Äì Start_Pause: Iniciar un modo de ahorro de energ√≠a adecuado (PE Energy-saving mode)
‚Äì End_Pause: Finalizar el modo de ahorro de energ√≠a (paso al modo
PE_ready_to_operate)
‚óè Comandos PE para leer un estado o un valor medido
Mediante los siguientes comandos de estado, el control puede leer con la instrucci√≥n
"PE_CMD (P√°gina 5979)" determinada informaci√≥n de estado:
‚Äì PE_Identify: determina qu√© comandos PE soporta la unidad PE.
‚Äì PEM_Status: determina cu√°l es el modo activo de una unidad PE en el momento actual
(p. ej. PE_ready_to_operate).
‚Äì Query_Modes: Muestra una sinopsis de todos los modos de ahorro de energ√≠a
soportados, incluida la informaci√≥n de tiempo y energ√≠a
‚Äì Query_Measurement: muestra los valores medidos de una unidad PE

Ejemplos de aplicaci√≥n
Pueden consultarse ejemplos de aplicaci√≥n de las instrucciones PROFIenergy en el art√≠culo
"PROFIenergy - Ahorrar energ√≠a con SIMATIC S7 (http://
support.automation.siemens.com/WW/view/es/41986454)" del Industry Online Support.

Consulte tambi√©n
Service & Support (http://support.automation.siemens.com/)

Controlador IO
PE_START_END: Iniciar y finalizar modo de ahorro de energ√≠a
Descripci√≥n
Con la instrucci√≥n "PE_START_END" se inicia y finaliza la pausa de ahorro de energ√≠a para la
unidad PE especificada (p. ej. el ET 200S).
La instrucci√≥n "PE_START_END" se emplea en el controlador PE preferentemente cuando en
los dispositivos PE asignados solo hay conectados aparatos de campo en los que no van a
leerse datos de energ√≠a. Para leer los datos de energ√≠a tambi√©n puede emplearse la
instrucci√≥n "PE_CMD (P√°gina 5979)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5975

Instrucciones
4.2 Instrucciones
Los modos de ahorro de energ√≠a se configuran en el programa de usuario del controlador PE.
Despu√©s de ejecutar "PE_START_END", la unidad PE responde notificando qu√© modo de
ahorro de energ√≠a se ha adoptado realmente y lo indica en el par√°metro PE_MODE_ID.

Peticiones de escritura y lectura de la instrucci√≥n "PE_START_END"
La instrucci√≥n "PE_START_END" env√≠a internamente mediante "WRREC (P√°gina 5890)" un
comando PROFIenergy en forma de petici√≥n de escritura a la unidad PE. A continuaci√≥n,
"PE_START_END" espera el acuse de la unidad PE. Para ello, cada 100 milisegundos se lee
el registro de acuse con la instrucci√≥n "RDREC (P√°gina 5888)". Mientras no se reciba acuse
de la entidad PE, la petici√≥n de lectura se repetir√° cada 100 milisegundos durante 10
segundos. Los datos de respuesta de la unidad PE tambi√©n se leen con la instrucci√≥n "RDREC
(P√°gina 5888)".
La figura siguiente muestra el diagrama de ejecuci√≥n de las peticiones de escritura y lectura:

&RQWURODGRU352),HQHUJ\

'LVSRVLWLYR352),HQHUJ\

3(B67$57B(1'3(B&0'

5(4 

3(B,B'(9

3HWLFL¬µQGHHVFULWXUD
1(: 
5HVSXHVWDGHHVFULWXUD
SRVLWLYR

3HWLFL¬µQGHOHFWXUD

PV

5HVSXHVWDGHOHFWXUD
QHJDWLYRUHFXUVRRFXSDGRR\DXWLOL]DGR

V

3HWLFL¬µQGHOHFWXUD

V

5HVSXHVWDGHOHFWXUD SRVLWLYR

7LHPSR

5976

7LHPSR

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PE_START_END":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

START

Input

BOOL

I, Q, M, D, L

Transmisi√≥n del comando PE "Start_Pause" a
la unidad PE con la direcci√≥n en el par√°metro
ID.

END

Input

BOOL

I, Q, M, D, L

Transmisi√≥n del comando PE "End_Pause" a
la unidad PE con la direcci√≥n en el par√°metro
ID.

ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n de la entidad PE (p. ej. ET 200S). La
direcci√≥n puede tomarse de la configuraci√≥n
de hardware.

PAUSE_TIME

Input

TIME

I, Q, M, D, L o cons‚Äê
tante

Duraci√≥n planificada de la pausa.
‚óè Rango:
T#1MS a T#24D20H31M23S647MS
‚óè Valor de arranque:
T#0MS

VALID

Output

BOOL

I, Q, M, D, L

Comando PE emitido correctamente.

BUSY

Output

BOOL

I, Q, M, D, L

A√∫n se est√° ejecutando el comando PE.

ERROR

Output

BOOL

I, Q, M, D, L

Se ha producido un error durante la ejecuci√≥n.
El mensaje de error se indica en el par√°metro
STATUS.

STATUS

Output

DWORD

I, Q, M, D, L

Estado de bloque o n√∫mero de error (v√©ase
"Par√°metro STATUS")

PE_MODE_ID

Output

BYTE

I, Q, M, D, L

N√∫mero de identificaci√≥n del modo de ahorro
de energ√≠a (nivel de ahorro de energ√≠a adop‚Äê
tado durante la pausa).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5977

Instrucciones
4.2 Instrucciones

Par√°metro PAUSE_TIME
Con el par√°metro PAUSE_TIME se predefine la duraci√≥n de la pausa de ahorro de energ√≠a
para la unidad PE. En la unidad PE se comprueba si la pausa predefinida tiene duraci√≥n
suficiente y si se puede aplicar. La duraci√≥n m√≠nima de pausa (Time_min_Pause) debe ser
mayor que la suma de los tiempos que el dispositivo necesita para cambiar al modo de ahorro
de energ√≠a (Time_to_Pause) y para volver al modo de operaci√≥n (Time_to_Operate).
3(BUHDG\B
WRBRSHUDWH

3(BHQHUJ\B
VDYLQJBPRGH

6WDUWB3DXVH

7LPHBWRB3DXVH

(QGB3DXVH

7LPHBPLQBOHQJWKBRIBVWD\

7LPHBWRB2SHUDWH

W

7LPHBPLQB3DXVH
En el ET 200S se comprueba si la pausa planificada es mayor o igual a la duraci√≥n m√≠nima de
pausa (PM-E_Pause_Min) depositada en el ET 200S. Esta es de 10 segundos. Si se utiliza una
pausa menor, los m√≥dulos de potencia (PM-E) del ET 200S permanecen conectados.
Una vez transcurrido el tiempo de pausa no se produce ning√∫n rearranque autom√°tico, sino
que el m√≥dulo permanece en estado OFF hasta que se emite el comando "END". De este
modo se evita una reconexi√≥n descoordinada, que podr√≠a provocar picos de carga indeseados.

Par√°metro STATUS
En el par√°metro de salida STATUS se muestra informaci√≥n de error. Si se interpreta como
ARRAY[1...4] of BYTE, la informaci√≥n de error tiene la estructura siguiente:
Elemento de cam‚Äê
po

Nombre

Significado

STATUS[1]

Function_Num

Causa del error
‚óè B#16#00: sin error
‚óè B#16#DE: error al leer el registro
‚óè B#16#DF: error al escribir el registro
‚óè B#16#C0: mensaje de error de la instrucci√≥n o de las instrucciones de
comunicaci√≥n "RDREC (P√°gina 5888)" y "WRREC (P√°gina 5890)" empleadas
internamente.

STATUS[2]

Error_Decode

Ubicaci√≥n de la identificaci√≥n de error
‚óè 80: error DPV1 seg√∫n la norma IEC 61158-6 o error espec√≠fico de instrucci√≥n
‚óè FE: perfil DP/PNIO; error espec√≠fico de PROFIenergy

5978

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Elemento de cam‚Äê
po

Nombre

Significado

STATUS[3]

Error_Code_1

Identificaci√≥n de error
‚óè Con Error_Decode = 80:
‚Äì

80: flancos ascendentes simult√°neos en los par√°metros de entrada START
y END.

‚Äì

81: conflicto de longitud en los par√°metros CMD_PARAM y
CMD_PARAM_LEN.

‚Äì

82-8F: otros mensajes de error (reservado)

‚óè Con Error_Decode = FE:

STATUS[4]

Error_Code_2

‚Äì

01: "Service Request ID" no v√°lido

‚Äì

02: "Request_Reference" err√≥neo

‚Äì

03: "Modifier" no v√°lido

‚Äì

04: "Data Structure Identifier RQ" no v√°lido

‚Äì

05: "Data Structure Identifier RS" no v√°lido

‚Äì

06: "PE energy-saving modes" no soportados

‚Äì

07: "Response" es demasiado largo (se ha rebasado la longitud m√°xima
transferible)

‚Äì

08: "Count" no v√°lido

‚Äì

50: no hay ning√∫n "energy mode" adecuado disponible.

‚Äì

51: el valor de tiempo indicado no se soporta.

‚Äì

52: "PE_Mode_ID" no admisible

Extensi√≥n espec√≠fica de fabricante de la identificaci√≥n de error

Nota
Mensajes de error de las instrucciones RDREC y WRREC
La instrucci√≥n "PE_START_END" utiliza para la comunicaci√≥n las instrucciones "WRREC
(P√°gina 5890)" y "RDREC (P√°gina 5888)". Los mensajes de error de estas instrucciones se
emiten correspondientemente en los elementos de campo STATUS[1] a STATUS[4].
Consulte el significado de los c√≥digos de error de las instrucciones "WRREC (P√°gina 5890)"
y "RDREC (P√°gina 5888)" en la descripci√≥n del par√°metro STATUS (P√°gina 5901)
correspondiente.

PE_CMD: Iniciar y finalizar modo de ahorro de energ√≠a / Leer informaci√≥n de estado
Descripci√≥n
La instrucci√≥n "PE_CMD" se emplea en el controlador PE e inicia o finaliza una pausa de
ahorro de energ√≠a en la unidad PE. Adem√°s, "PE_CMD" permite leer m√°s informaci√≥n y
valores medidos de energ√≠a de una unidad PE.
La instrucci√≥n puede emplearse preferentemente en controladores PE en cuyos dispositivos
PE correspondientes est√©n conectados aparatos de campo de los que deban leerse valores

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5979

Instrucciones
4.2 Instrucciones
medidos de energ√≠a. Si esto no fuera as√≠, para iniciar y finalizar las pausas tambi√©n puede
emplearse la instrucci√≥n "PE_START_END (P√°gina 5975)".

Transferencia de los comandos PROFIenergy (comandos PE)
La instrucci√≥n "PE_CMD" transfiere un comando PROFIenergy a una unidad PE.
La instrucci√≥n tambi√©n puede emplearse si en el futuro se ampl√≠a el perfil PROFIenergy con
otros comandos. Los comandos que pueden utilizarse de acuerdo con el perfil PROFIenergy
actual se listan en la descripci√≥n de los par√°metros CMD y CMD_MODIFIER (v√©ase tabla
"Par√°metros CMD y CMD_MODIFIER").
‚óè Los diferentes comandos PE que se transfieren a la unidad PE mediante la instrucci√≥n
tienen asignadas "Service_Request_IDs" definidas. Las Service_Request_IDs 01...05 y 16
se asignan en el par√°metro CMD.
‚óè Mediante el par√°metro CMD_MODIFIER se especifican los dos comandos PE 04
(Query_Modes) y 16 (Query_Measurement).
‚óè Para comandos PE concretos, en el par√°metro CMD_PARA se transfieren valores
adicionales (v√©ase la descripci√≥n de los distintos comandos PE). El par√°metro
CMD_PARA_LEN define la longitud de datos en el par√°metro CMD_PARA.
Los comandos se transfieren sin prueba de plausibilidad. Los datos de respuesta de la entidad
PE se depositan en el √°rea de datos RESPONSE_DATA direccionada por el puntero ANY (los
contenidos de los telegramas de respuesta figuran en las descripciones del respectivo
comando PE).

Peticiones de escritura y lectura de la instrucci√≥n "PE_CMD"
La instrucci√≥n "PE_CMD" env√≠a mediante "WRREC (P√°gina 5890)" un comando PROFIenergy
en forma de petici√≥n de escritura a la unidad PE. A continuaci√≥n, "PE_CMD" espera el acuse
de la unidad PE. Para ello, cada 100 milisegundos se lee el registro de acuse con la instrucci√≥n
"RDREC (P√°gina 5888)". Mientras no se reciba acuse de la unidad PE, la petici√≥n de lectura
se repite cada 100 milisegundos durante 10 segundos. Los datos de respuesta de la unidad PE
tambi√©n se leen con la instrucci√≥n "RDREC (P√°gina 5888)".
La figura siguiente muestra el diagrama de ejecuci√≥n de las peticiones de escritura y lectura:

5980

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
&RQWURODGRU352),HQHUJ\

'LVSRVLWLYR352),HQHUJ\

3(B67$57B(1'3(B&0'

5(4 

3(B,B'(9

3HWLFL¬µQGHHVFULWXUD
1(: 
5HVSXHVWDGHHVFULWXUD
SRVLWLYR

3HWLFL¬µQGHOHFWXUD

PV

5HVSXHVWDGHOHFWXUD
QHJDWLYRUHFXUVRRFXSDGRR\DXWLOL]DGR

V

3HWLFL¬µQGHOHFWXUD

V

5HVSXHVWDGHOHFWXUD SRVLWLYR

7LHPSR

7LHPSR

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PE_CMD":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Inicia la transmisi√≥n del comando PE con
flanco ascendente.

ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n de la unidad PE

CMD

Input

BYTE

Para los dispositivos PROFINET IO, la di‚Äê
recci√≥n puede tomarse de la configura‚Äê
ci√≥n hardware.

I, Q, M, D, L, P o cons‚Äê Service-Request-ID del comando PRO‚Äê
tante
FIenergy en funci√≥n del perfil PROFIe‚Äê
nergy (v√©ase "Par√°metros CMD y
CMD_MODIFIER").
Si se ampl√≠a el perfil PROFIenergy son
posibles otras Service-Request-IDs.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5981

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

CMD_MODIFIER

Input

BYTE

I, Q, M, D, L, P o cons‚Äê Subcomando PROFIenergy
tante
(solo con CMD=3 o CMD=16, v√©ase "Pa‚Äê
r√°metros CMD y CMD_MODIFIER")

Descripci√≥n

Si se ampl√≠a el perfil PROFIenergy son
posibles otros subcomandos.
CMD_PARA

Input

ANY

I, Q, M, D, L

Par√°metros de los comandos PE:
‚óè Get mode: PE_mode_ID
‚óè Get measurement values: List of
Measurement_Ids
Se registra el Service Data Request com‚Äê
pleto.

CMD_PARA_LEN

Input

INT

I, Q, M, D, L, P o cons‚Äê Longitud real de los par√°metros del co‚Äê
tante
mando (la instrucci√≥n comprueba si es <=
a la longitud en CMD_PARA).

RESPONSE_DATA

InOut

ANY

I, Q, M, D, L

Informaci√≥n PROFIenergy
Dependiendo del comando, telegrama de
respuesta completo, incluido encabezado
de bloque.
Nota: si el b√∫fer es demasiado peque√±o
solo se registra el n√∫mero de bytes, como
se indica en el puntero ANY.

VALID

Output

BOOL

I, Q, M, D, L

Comando emitido correctamente.

BUSY

Output

BOOL

I, Q, M, D, L

A√∫n se est√° ejecutando el comando.

ERROR

Output

BOOL

I, Q, M, D, L

Se ha producido un error durante la eje‚Äê
cuci√≥n.

STATUS

Output

DWORD

I, Q, M, D, L

Estado de bloque o n√∫mero de error (v√©a‚Äê
se "Par√°metro STATUS"):

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros CMD y CMD_MODIFIER
CMD

CMD_
MODIFIER

Comando PROFIenergy

Descripci√≥n

01

0

Start_Pause (P√°gina 5999)

Inicia el modo de ahorro de energ√≠a o cambia a otro modo de
ahorro de energ√≠a.

02

0

End_Pause (P√°gina 6000)

Sale del modo de ahorro de energ√≠a.

03

1

Query_Modes - List energy sa‚Äê Muestra los modos de ahorro de energ√≠a soportados.
ving Modes (P√°gina 6000)

2

Query_Modes - Get Mode (P√°‚Äê Muestra los atributos del modo de ahorro de energ√≠a activa‚Äê
do en el momento actual.
gina 6001)

04

0

PEM_Status (P√°gina 6003)

Consulta el estado del modo de ahorro de energ√≠a.

05

0

PE_Identify (P√°gina 6005)

Lectura del n√∫mero de comandos PE soportados y descrip‚Äê
ci√≥n de los mismos.

5982

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
CMD

CMD_
MODIFIER

Comando PROFIenergy

Descripci√≥n

16

1

Query_Measurement Get_Measurement_List (P√°gi‚Äê
na 6006)

Listado de los valores medidos soportados por la unidad PE.

2

Query_Measurement Get_Measurement_Values
(P√°gina 6008)

Muestra los valores medidos de la unidad PE.

Par√°metro STATUS
En el par√°metro de salida STATUS se muestra informaci√≥n de error. Si se interpreta como
ARRAY[1...4] of BYTE, la informaci√≥n de error tiene la estructura siguiente:
Elemento de cam‚Äê
po

Nombre

Significado

STATUS[1]

Function_Num

Causa del error
‚óè B#16#00: sin error
‚óè B#16#DE: error al leer el registro
‚óè B#16#DF: error al escribir el registro
‚óè B#16#C0: mensaje de error de las instrucciones de comunicaci√≥n "RDREC
(P√°gina 5888)" y "WRREC (P√°gina 5890)" empleadas internamente.

STATUS[2]

Error_Decode

Ubicaci√≥n de la identificaci√≥n de error
‚óè 80: error DPV1 seg√∫n la norma IEC 61158-6 o error espec√≠fico de instrucci√≥n
‚óè FE: perfil DP/PNIO; error espec√≠fico de PROFIenergy

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5983

Instrucciones
4.2 Instrucciones
Elemento de cam‚Äê
po

Nombre

Significado

STATUS[3]

Error_Code_1

Identificaci√≥n de error
‚óè Con Error_Decode = 80:
‚Äì

81: conflicto de longitud en los par√°metros CMD_PARA y
CMD_PARA_LEN o bien se ha excedido la longitud m√°xima del registro
(4095 bytes).

‚Äì

82-8F: otros mensajes de error (reservado)

‚óè Con Error_Decode = FE:

STATUS[4]

Error_Code_2

‚Äì

01: "Service Request ID" no v√°lido

‚Äì

02: "Request_Reference" err√≥neo

‚Äì

03: "Modifier" no v√°lido

‚Äì

04: "Data Structure Identifier RQ" no v√°lido

‚Äì

05: "Data Structure Identifier RS" no v√°lido

‚Äì

06: "PE energy-saving modes" no soportados

‚Äì

07: "Response" es demasiado largo (se ha rebasado la longitud m√°xima
transferible)

‚Äì

08: "Count" no v√°lido

‚Äì

50: no hay ning√∫n modo de ahorro de energ√≠a (energy mode) adecuado
disponible.

‚Äì

51: el valor de tiempo indicado no se soporta.

‚Äì

52: "PE_Mode_ID" no v√°lido

Extensi√≥n espec√≠fica de fabricante de la identificaci√≥n de error

Nota
Mensajes de error de las instrucciones RDREC y WRREC
Las instrucciones "PE_CMD" utilizan para la comunicaci√≥n las instrucciones "WRREC
(P√°gina 5890)" y "RDREC (P√°gina 5888)". Los mensajes de error de estas instrucciones se
emiten correspondientemente en los elementos de campo STATUS[1] a STATUS[4].
Consulte el significado de los c√≥digos de error de las instrucciones "WRREC (P√°gina 5890)"
y "RDREC (P√°gina 5888)" en la descripci√≥n del par√°metro STATUS (P√°gina 5901)
correspondiente.

5984

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

PE_DS3_Write_ET200S: Ajustar el modo de activaci√≥n de los m√≥dulos de potencia
Descripci√≥n
La instrucci√≥n "PE_DS3_Write_ET200S" env√≠a al ET 200S configuraciones b√°sicas sobre el
modo de activaci√≥n de los m√≥dulos de potencia. La instrucci√≥n "PE_DS3_Write_ET200S"
permite definir el modo de activaci√≥n de hasta 8 slots del ET 200S (p. ej. para m√≥dulos de
potencia).
Nota
Esta instrucci√≥n no forma parte del perfil PROFIenergy, sino que complementa funciones
espec√≠ficas de SIMATIC.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PE_DS3_Write_ET200S":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ENABLE

Input

BOOL

I, Q, M, D, L

Un flanco ascendente activa la transferencia
del registro. El registro debe transferirse de
nuevo despu√©s de desconectar y volver a co‚Äê
nectar la tensi√≥n.

ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n del ET 200S
La direcci√≥n puede tomarse de la configura‚Äê
ci√≥n de hardware.

SLOT_NO_X

Input

INT

I, Q, M, D, L, P o
constante

N√∫mero de slot del X.¬∫ m√≥dulo de potencia co‚Äê
nectable.

FUNC_X

Input

INT

I, Q, M, D, L, P o
constante

Funci√≥n del m√≥dulo en este slot. Mediante el
par√°metro FUNC_X se define el modo de acti‚Äê
vaci√≥n del PM-E (m√≥dulo de potencia del
ET 200S):
‚óè FALSE:
‚Äì

Con "PAUSE_START":
- no influye en el PM-E
- el PM-E contin√∫a conectado

‚Äì

Con "PAUSE_STOP":
- se reconecta el PM-E

‚óè TRUE:
‚Äì

Con "PAUSE_START":
- se desconecta el PM-E

‚Äì

Con "PAUSE_STOP":
- se reconecta el PM-E

BUSY

Output

BOOL

I, Q, M, D, L

La transferencia no ha finalizado todav√≠a.

DONE

Output

BOOL

I, Q, M, D, L

La transferencia ha finalizado sin errores.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5985

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ERROR

Output

BOOL

I, Q, M, D, L

Transferencia finalizada con error.

STATUS

Output

DWORD

I, Q, M, D, L, P

N√∫mero de error (v√©ase el par√°metro STATUS
de la instrucci√≥n "PE_Start_End (P√°gi‚Äê
na 5975)")

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

PE_WOL: Iniciar y finalizar modo de ahorro de energ√≠a mediante WakeOnLan
Descripci√≥n PE_WOL
Descripci√≥n
La instrucci√≥n "PE_WOL" env√≠a los comandos PROFIenergy "Start_Pause" y "End_Pause" a
varios dispositivos compatibles con PROFIenergy en sistemas PROFINET I/O.
La instrucci√≥n permite la coordinaci√≥n de varios dispositivos PE siempre que soporten la
funci√≥n "Wake on LAN" a trav√©s de una conexi√≥n UDP.
La instrucci√≥n "PE_WOL" solo puede ejecutarse en una CPU con interfaz Ethernet integrada.
Esta CPU debe ser capaz de cargar bloques de un tama√±o de aprox. 40 kB. El bloque no se
puede utilizar con sistemas PROFINET I/O si estos est√°n conectados a trav√©s de un CP
Ethernet.
La instrucci√≥n "PE_WOL" se ejecuta de forma as√≠ncrona.

Definici√≥n: Wake on LAN
La funcionalidad Wake On LAN permite que dispositivos de procesamiento de datos reanuden
el trabajo a partir de un estado pr√°cticamente de desconexi√≥n gracias a la recepci√≥n de un
paquete Ethernet especial.
Para que funcione este procedimiento, el dispositivo de procesamiento de datos debe disponer
de un controlador de red equipado para poder recibir un paquete de este tipo.
Este paquete (Magic Packet‚Ñ¢) tiene un formato especial. Contiene 15 veces la direcci√≥n MAC
del adaptador de red.

Selecci√≥n de los dispositivos
La selecci√≥n de los dispositivos se realiza a trav√©s del bloque de datos de usuario en el
par√°metro PENERGY. El DB de usuario representa la base de datos para el procesamiento de
varios dispositivos.
Antes de la inicializaci√≥n de "PE_WOL" se debe guardar en el DB de usuario la siguiente
informaci√≥n, como m√≠nimo:
‚óè ID del sistema PROFINET I/O
‚óè Datos de la conexi√≥n que se utiliza para "Wake On LAN"

5986

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
‚óè N√∫mero de puerto que se utiliza para "Wake On LAN"
‚óè Para cada dispositivo
‚Äì Tiempo de pausa (PauseTime)
‚Äì Conmutaci√≥n del dispositivo al PE_SLEEP_MODE (EnableSleep)
Con el par√°metro COM_RST se inicializa la instrucci√≥n "PE_WOL". Tras la inicializaci√≥n se
ejecutan las peticiones guardadas en el DB de usuario una tras otra.
El siguiente gr√°fico muestra a modo de ejemplo c√≥mo se transmite el comando PE
"Start_Pause" a varios dispositivos:

%ORTXHGHGDWRVGHXVXDULR

'%GHLQVWDQFLD

Dir. diag.

Bit de
inicio

Bit de fin

8081
8082

1
0

0
0

8081

8083
8048
...

1
1
...

0
0
...

8048

3(B:2/

Diag.
Adr.

8083

(1)

Paso 1: El usuario pone a "1" el bit "CmdStartPause" de los dispositivos que se van a desco‚Äê
nectar.

(2)

Paso 2: Las direcciones de diagn√≥stico de los dispositivos que se van a desconectar (CmdStart‚Äê
Pause = "1") se encadenan en la lista de espera.

(3)

Paso 3: El bit "CmdStartPause" se desactiva autom√°ticamente una vez encadenadas las peti‚Äê
ciones.

(4)

Paso 4: La instrucci√≥n "PE_WOL" procesa las peticiones en cuanto estas est√°n encadenadas.

A trav√©s de los par√°metros START y END se puede enviar un comando PROFIenergy
"CmdStartPause" o "CmdEndPause" para todos los dispositivos detectados en el sistema
PROFINET IO.
Con el par√°metro STATUS se indica el estado del procesamiento de la petici√≥n, as√≠ como
posibles errores durante su procesamiento.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5987

Instrucciones
4.2 Instrucciones

Manejo de la instrucci√≥n a trav√©s del DB de usuario
El manejo de la instrucci√≥n "PE_WOL" solo se puede realizar a trav√©s del DB de usuario. A este
respecto se aplica un procedimiento b√°sico:
1. Selecci√≥n del comando que se va a ejecutar para un dispositivo:
‚Äì START_PAUSE ("CmdStartPause" en el DB de usuario)
‚Äì ENDE_PAUSE ("CmdEndPause" en el DB de usuario)
‚Äì UPDATE_STATUS ("CmdUpdateStatus" en el DB de usuario)
2. Activaci√≥n del bit para la actualizaci√≥n ("Update" en el encabezado del DB de usuario)
Entre dos actualizaciones deber√≠a transcurrir como m√≠nimo un ciclo de CPU con un
"Update" = False, ya que de lo contrario no se puede garantizar la detecci√≥n de flancos.

Priorizaci√≥n de los comandos PE
El siguiente gr√°fico muestra la cronolog√≠a de los tres comandos posibles.

CmdStartPause
CmdEndPause

CmdUpdateStatus

Update

Estos se procesan uno tras otro, independientemente de si el comando previo se ha ejecutado
correctamente o ha finalizado con errores.
En caso de activaci√≥n simult√°nea de, p. ej., "CmdEndPause" y "CmdUpdateStatus" solo se
ejecutar√° un comando. Dentro del bloque existe una priorizaci√≥n:
‚óè El comando "CmdStartPause" tiene la m√°xima prioridad y siempre se ejecuta mientras est√©
seleccionado.
‚óè El comando "CmdEndPause" tiene la segunda m√°xima prioridad.
‚óè El comando "CmdUpdateStatus" tiene la m√≠nima prioridad.
Si se activan los tres comandos a la vez, los que no se ejecuten permanecen
preseleccionados. En ese caso, en el siguiente flanco ascendente se ejecutar√° el siguiente
comando que corresponda.

5988

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PE_WOL":
Par√°metro

Declaraci√≥n

Input
COM_RST
(P√°gina 5989)

Tipo de datos √Årea de memoria Descripci√≥n
BOOL

I, Q, M, D, L

Resetea el bloque y ejecuta una reinicializaci√≥n. Mien‚Äê
tras aqu√≠ est√© ajustado True, comienza la operaci√≥n
de inicializaci√≥n pero no se ejecuta hasta el final.
La inicializaci√≥n prosigue con el flanco descendente
y, una vez concluida esta, se pasa al modo de opera‚Äê
ci√≥n normal.

START (P√°gi‚Äê Input
na 5991)

BOOL

I, Q, M, D, L

Con un flanco ascendente se ejecuta un comando
PROFIenergy "CmdStartPause" para todos los dispo‚Äê
sitivos detectados que soporten esta funci√≥n.

END (P√°gi‚Äê
na 5992)

BOOL

I, Q, M, D, L

Con un flanco ascendente se ejecuta un comando
PROFIenergy "CmdEndPause" para todos los dispo‚Äê
sitivos detectados que soporten esta funci√≥n.

PENERGY
InOut
(P√°gina 5992)

ANY

D

Puntero hacia el DB de usuario que contiene la base
de datos para el procesamiento de varios dispositivos.

STATUS (P√°‚Äê
gina 5997)

DWORD

I, Q, M, D, L

N√∫mero de estado/error para el estado actual de la
instrucci√≥n (ver "Par√°metro STATUS").

Input

Output

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro COM_RST
Desarrollo de la rutina de inicializaci√≥n
Con el par√°metro COM_RST se arranca la inicializaci√≥n de la instrucci√≥n "PE_WOL".
El siguiente diagrama de flujo muestra la rutina de inicializaci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5989

Instrucciones
4.2 Instrucciones
INICIO

Clean Queue

Inicializar la lista de espera de
peticiones

Config Devices

Lectura de los dispositivos
configurados del sistema
PROFINET I/O

No. of
Devices
>0

S√≠
Dev. Diag.

Determinar las direcciones de
diagn√≥stico

Order ID

Lectura de la OrderID

Connection
setup

Configuraci√≥n de la conexi√≥n
WOL

PE_Identify

Identificaci√≥n de los comandos PE
soportados para cada dispositivo

No

DB de
usuario

FIN
(Error)

5990

FIN
(Inicializado)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro START
Desarrollo del comando CmdStartPause
El diagrama de flujo muestra las funciones utilizadas internamente y la interacci√≥n con un
dispositivo al ejecutar el comando CmdStartPause.

'%GHXVXDULR

'LVSRVLWLYR

&RQWURODGRU 3(B:2/
,1,&,2

/LVWDGHGLVSRVLWLYRV
FRQ
'LDJ,'
3DXVHB7LPH
:R/
6WDUWB3DXVHB%LW
‡≤π

,QIRUPDFL¬µQDGLFLRQDO
HQHO'%
7LPHBWRBRSHUDWH
7LPHBPLQB3DXVH
3(B0RGHB,'
‡≤π
:DNHB8SB0HWKRG
:DNHB8SB'DWDB/HQJW
:DNHB8SB'DWD
‡≤π

(QDEOH6OHHS 

6¬Ø

1R

6OHHS0RGH
¬Å6HOHFFLRQD
GR"

6¬Ø

1R

'LVSRVLWLYR
SUHSDUDQGR
UHVSXHVWD

5HVSXHVWD
7LPHBWRBRSHUDWH
7LPHBPLQB3DXVH
:DNHB8SB0HWKRG
‡≤π

*UDEDUUHVSXHVWD

3DXVHB7LPH
!
7LPHBPLQB
3DXVH

,QIRBVOHHSBPRGH

6¬Ø

6WDUWBVOHHSBPRGH
*UDEDUUHVSXHVWD

'LVSRVLWLYRHQ
3(B6/((3B02'(

1R
6WDUWB3DXVH
*UDEDUUHVSXHVWD

4XHU\6WDWXV

'LVSRVLWLYRHQ
(1(5*<B6$9,1*B
02'(

3(0B6WDWXV
5HVSXHVWD

'LVSRVLWLYRHQ
(1(5*<B6$9,1*B
02'(

),1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5991

Instrucciones
4.2 Instrucciones

Par√°metro END
Desarrollo del comando CmdEndPause
El diagrama de flujo muestra las funciones utilizadas internamente y la interacci√≥n con un
dispositivo al ejecutar el comando CmdEndPause.

'%GHXVXDULR

'LVSRVLWLYR

&RQWURODGRU 3(B:2/
,1,&,2

/LVWDGHGLVSRVLWLYRV
FRQ
'LDJ,'
3DXVHB7LPH
:R/
6WDUWB3DXVHB%LW
‡≤π

3(B0RGH
6OHHS0RGH

6¬Ø

0DJLF3DFNHW‡¥±
Y¬ØD7&20
'HIDXOW3RUW

1R

(QGB3DXVH
,QIRUPDFL¬µQDGLFLRQDO
HQHO'%

(QGB3DXVH

*UDEDUUHVSXHVWD

7LPHBWRBRSHUDWH
7LPHBPLQB3DXVH
3(B0RGHB,'
‡≤π
:DNHB8SB0HWKRG
:DNHB8SB'DWDB/HQJW
:DNHB8SB'DWD
‡≤π

'LVSRVLWLYRHQ
6OHHSBPRGH

:DLW772

3(0B6WDWXV

'LVSRVLWLYRHQ
(QHUJ\BVDYLQJBPRGH
B[

'LVSRVLWLYRHQ
5HDG\BWRBRSHUDWHBP
RGH

*UDEDUUHVSXHVWD

),1

Par√°metro PENERGY
Bloque de datos en el par√°metro PENERGY
El DB de usuario para la instrucci√≥n PROFIenergy "PE_WOL" constituye una base de datos
para el procesamiento de varios dispositivos.

5992

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El bloque de datos se divide generalmente en dos secciones. A saber:
‚óè Secci√≥n de encabezado 110 bytes (header)
‚óè Secci√≥n de dispositivos para un m√°ximo de 256 dispositivos de 100 bytes cada uno
(Device). Estos incluyen:
‚Äì Datos espec√≠ficos del dispositivo (Device)
‚Äì Datos espec√≠ficos de PROFIenergy (PE)
‚Äì Datos de procesamiento de petici√≥n (Task)
‚Äì Datos de usuario (UserData)
Las diferentes √°reas tienen un tama√±o determinado que es constante. En total suman un
tama√±o constante de 25.746 bytes para el bloque de datos.

Par√°metro de conexi√≥n "Connection"
La instrucci√≥n "PE_WOL" reserva un recurso de conexi√≥n del √°rea de "Open User
Communication". Este se utiliza como conexi√≥n UDP. Para ello, deben definirse los siguientes
par√°metros en el bloque de datos:
‚óè ID de conexi√≥n (par√°metro "Connection.id")
La ID de conexi√≥n es un n√∫mero entero entre 1 y 32. El ajuste est√°ndar es 31. Sirve para
identificar los recursos de comunicaci√≥n asignados por el firmware, como el b√∫fer de
transmisi√≥n y de recepci√≥n.
La ID de conexi√≥n debe ser un√≠voca en toda la CPU.
‚óè N√∫mero de puerto que se utiliza para la funci√≥n "Wake On LAN" (par√°metro
"Header.PortNo")
N√∫mero del puerto UDP a trav√©s del que se env√≠a un paquete "Wake On LAN". Estos
n√∫meros de puerto forman parte de los recursos de comunicaci√≥n identificados y puestos
a disposici√≥n en el firmware por la ID de conexi√≥n. El ajuste est√°ndar utilizado aqu√≠ para el
puerto de 2189 no est√° asignado actualmente por la IANA. El n√∫mero de puerto se
transfiere a la configuraci√≥n de conexi√≥n. Esto repercute en los par√°metros
"Connection.local_tsap_id[1]" y "Connection.rem_tsap_id[1]".
‚óè ID de interfaz (par√°metro "Connection.local_device_id")
La ID de interfaz tambi√©n forma parte de la descripci√≥n de la conexi√≥n. Esta ID identifica la
interfaz de la CPU que se debe utilizar para esta conexi√≥n. Se admiten varios valores.
No obstante, estos deben adaptarse a la CPU y la interfaz utilizadas:
‚Äì B#16#01 con CPU ET200S o WinAC RTX con interfaz Ethernet en subslot IF1
‚Äì B#16#02 con CPU 315(F)-2PN/DP o CPU 317(F)-2PN/DP
‚Äì B#16#03 con CPU 319(F)-2PN/DP
‚Äì B#16#05 con CPU 41x(F)-3PN/DP
‚Äì B#16#06 con WinAC RTX con interfaz Ethernet en subslot IF2
‚Äì B#16#0B con WinAC RTX con interfaz Ethernet en subslot IF3
‚Äì B#16#0F con WinAC RTX con interfaz Ethernet en subslot IF4

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5993

Instrucciones
4.2 Instrucciones

Estructura del bloque de datos
El bloque de datos tiene la siguiente estructura:
Nombre
Header
Update (1)

Tipo de datos

Offset

Comentario

STRUCT

-

Informaci√≥n de encabezado

BOOL

0.0

Se√±al que indica una modificaci√≥n en el √°rea de datos.
‚óè True = indica una modificaci√≥n por parte del usuario.
‚óè False = indica la aplicaci√≥n de las modificaciones.

Initialized

BOOL

0.1

Se√±al que indica el final de la inicializaci√≥n.
‚óè True = inicializaci√≥n finalizada.
‚óè False = indica que el bloque no se ha inicializado.

LinkUp

BOOL

0.2

Indica la configuraci√≥n correcta de la interfaz Ethernet.
‚óè True = interfaz lista para su uso.
‚óè False = interfaz a√∫n no configurada.

LinkDown

BOOL

0.3

Indica una interfaz sin configurar.
‚óè True = la interfaz no est√° configurada.
‚óè False = la interfaz est√° configurada o se est√°
configurando actualmente.

PROFINET_ID (1)

INT

2.0

ID del sistema PROFINET I/O

Reserved

ARRAY [1..37] OF
BYTE

4.0

Reservado

LastDeviceID

INT

42.0

Contiene la ID de dispositivo m√°s alta en este sistema
PROFINET I/O.

PortNo (1)

INT

44.0

N√∫mero de puerto que se utiliza para la funci√≥n "Wake On
LAN" (valor predeterminado = 2189).

Connection

STRUCT

-

Contiene la configuraci√≥n de la conexi√≥n "Wake on LAN".

5994

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre
block_length
id (1)
connection_type

(1)

active_est (1)

Tipo de datos

Offset

Comentario

WORD

46.0

Longitud de la estructura (siempre B#16#40).

WORD

48.0

ID de conexi√≥n

BYTE

50.0

Tipo de conexi√≥n (UDP = B#16#13)

BOOL

51.0

Establecimiento activo de la conexi√≥n (siempre pasivo con
UDP)

local_device_id (1)

BYTE

52.0

Contiene la ID de interfaz (dependiente de la CPU).

local_tsap_id_len (1)

BYTE

53.0

Contiene la longitud en bytes del puerto UDP propio/local.

rem_subnet_id_len (1)

BYTE

54.0

Sin utilizar (siempre B#16#00)

rem_staddr_len (1)

BYTE

55.0

Contiene la longitud de la direcci√≥n IP remota o B#16#00.

rem_tsap_id_len (1)

BYTE

56.0

Contiene la longitud en bytes del puerto UDP remoto.

next_staddr_len (1)

BYTE

57.0

Contiene la longitud de la direcci√≥n del router predetermi‚Äê
nado (no relevante).

local_tsap_id (1)

ARRAY[1..8] OF
INT

58.0

Contiene el n√∫mero de puerto propio/local.

rem_subnet_id (1)

ARRAY[1..6] OF
BYTE

74.0

Sin utilizar (siempre B#16#00)

rem_staddr (1)

ARRAY[1..6] OF
BYTE

80.0

Contiene la direcci√≥n IP remota.

rem_tsap_id (1)

ARRAY[1..8] OF
INT

86.0

Contiene el n√∫mero de puerto UDP remoto.

next_staddr (1)

ARRAY[1..6] OF
BYTE

102.0

Irrelevante

spare (1)

WORD

108.0

ARRAY[1..256]
OF STRUCT

110.0

Matriz de los dispositivos

STRUCT

110.0

Contiene datos de cada dispositivo.

DiagID

WORD

110.0

Direcci√≥n de diagn√≥stico del dispositivo. Es asignada por la
configuraci√≥n hardware.

InterfaceID

WORD

112.0

Direcci√≥n de diagn√≥stico de la interfaz del dispositivo. Es
asignada por la configuraci√≥n hardware.

MACAdr

ARRAY[1..6] OF
BYTE

114.0

Contiene la direcci√≥n MAC del dispositivo.

IPAdr

ARRAY[1..4] OF
BYTE

120.0

Contiene la direcci√≥n IP del dispositivo.

OrderID

STRUCT

124.0

Contiene la OrderID del dispositivo.

Device
Device

PE

MxLen

BYTE

Contiene la longitud m√°xima de la matriz.

ActLen

BYTE

Contiene la cantidad actual de datos en la matriz.

Data

ARRAY[1..20]
CHAR

Contiene los datos.

STRUCT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

146.0

Datos espec√≠ficos de PROFIenergy.

5995

Instrucciones
4.2 Instrucciones
Nombre
ModeID
Result

Tipo de datos

Offset

Comentario

BYTE

146.0

PE_MODE_ID conforme a especificaci√≥n PROFIenergy.

BYTE

147.0

PEErrorCode conforme a especificaci√≥n PROFIenergy.

(1)

TIME

148.0

Contiene el tiempo de pausa en ms.

TimeToPause

TIME

152.0

Contiene el tiempo que necesita el dispositivo para pasar al
modo de pausa.

TimeToOperate

TIME

156.0

Contiene el tiempo que necesita el dispositivo para pasar al
modo de operaci√≥n.

MinSleepTime

TIME

160.0

Contiene el tiempo m√≠nimo del dispositivo en
PE_SLEEP_MODE.

SleepToOperate

TIME

164.0

Contiene el tiempo que necesita el dispositivo para estar
listo para el servicio desde PE_SLEEP_MODE.

StatusOperate

BOOL

168.0

Indica el modo de operaci√≥n del dispositivo.

StatusPause

BOOL

168.1

Indica el modo de pausa del dispositivo.

StatusSleep

BOOL

168.2

Indica el PE_SLEEP_MODE del dispositivo.

StatusTransitOK

BOOL

168.3

Indica la transici√≥n de un estado de energ√≠a a otro.

StatusInTransit

BOOL

168.4

Indica una transici√≥n de estado actual.

StatusTransitNOK

BOOL

168.5

Indica que ha fallado el cambio de estado.

StatusError

BOOL

168.6

Indica un error con el dispositivo.

StatusRetryEx

BOOL

168.7

Indica la ejecuci√≥n incorrecta de un comando. No se inten‚Äê
ta ejecutar de nuevo este comando.

CmdStartPause (1)

BOOL

169.0

Posiciona un comando START_PAUSE para este disposi‚Äê
tivo en la lista de espera.

CmdEndPause (1)

BOOL

169.1

Posiciona un comando END_PAUSE para este dispositivo
en la lista de espera.

CmdUpdateStatus (1)

BOOL

169.2

Posiciona un comando PEM_STATUS para este dispositi‚Äê
vo en la lista de espera.

EnableSleep (1)

BOOL

169.3

Permite el PE_SLEEP_MODE para este dispositivo.

PauseTime

‚óè True = el dispositivo debe pasar a PE_SLEEP_MODE
si la pausa dura lo suficiente.
‚óè False = el dispositivo no debe pasar a
PE_SLEEP_MODE.
Services
UserData
Task

5996

(2)

WORD

170.0

Indica todos los servicios PROFIenergy soportados.

ARRAY[1..24] OF
BYTE

172.0

Datos definidos por el usuario

STRUCT

196.0

Procesamiento de la petici√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre

Tipo de datos

Offset

Comentario

Cmd

BYTE

196.0

Bits internos para el procesamiento de la petici√≥n

CmdJ

BYTE

197.0

Bits internos para el procesamiento de la petici√≥n

TimeStart

BOOL

198.0

Inicia un tiempo de retardo.

TimeStarted

BOOL

198.1

Acaba de iniciarse un tiempo de retardo.

TimeDone

BOOL

198.2

Indica la finalizaci√≥n del tiempo de retardo.

Done

BOOL

198.3

Indica que la petici√≥n est√° finaliz√°ndose.

DelayedCmd

BOOL

198.4

Indica que todav√≠a hay pendiente un comando retardado.

IsV1_0

BOOL

198.5

Indica que este dispositivo es un dispositivo Spec. V1.0.

IsWakeOnLAN

BOOL

198.6

Indica que este dispositivo se activa por "Wake On LAN".

RetryCount

BYTE

199.0

Contador de repeticiones de PE_COMMANDS

Duration

TIME

200.0

Contiene el valor de retardo en ms.

StartTime

TIME

204.0

Contiene el punto de inicio del tiempo de retardo.

MachineState

INT

208.0

Contiene el estado interno de la petici√≥n.

(1)

Ajuste por parte del usuario.

(2)

Uso libre para el usuario.

Par√°metro STATUS
Par√°metro STATUS
El valor de salida del par√°metro STATUS se divide en tres √°reas:
‚óè Bits 31 a 24: MESSAGE
‚óè Bits 23 a 16: LOCATION
‚óè Bits 15 a 0: INFORMATION
En las siguientes tablas se explica el significado de los diferentes c√≥digos de error de las tres
√°reas:
Tabla 4-261 Valores posibles de MESSAGE
C√≥digo de
error
(W#16#...)

Descripci√≥n

00

Ning√∫n error.

50

Instrucci√≥n inicializada.

51

Se determina la configuraci√≥n del sistema PROFINET I/O.

52

La instrucci√≥n no ha podido localizar dispositivos configurados en el sistema PROFINET I/O.

53

Se determinan las direcciones l√≥gicas de los dispositivos configurados.

54

Se lee la informaci√≥n de interfaz de los dispositivos.

55

Se determinan los datos I&M (solo registro 0) de los dispositivos configurados.

56

Se configura la interfaz PROFINET para el env√≠o de "Wake on LAN" MagicPaket‚Ñ¢ a trav√©s de UDP.

57

Se determina la compatibilidad PROFIenergy de los dispositivos conectados.

62

Detectada ID no v√°lida del sistema PROFINET I/O. El n√∫mero causante se indica en el campo INFORMA‚Äê
TION.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5997

Instrucciones
4.2 Instrucciones
C√≥digo de
error
(W#16#...)

Descripci√≥n

70

La instrucci√≥n se ha inicializado y procesa peticiones. El valor del campo INFORMATION indica el n√∫mero
de las peticiones activas actualmente.

80

La instrucci√≥n se ha desinicializado al procesar peticiones. Esto ocurre generalmente cuando vuelve a
cargarse el DB de instancia o bien el DB de usuario.

FF

Se ha producido un error desconocido.

Tabla 4-262 Valores posibles de LOCATION
C√≥digo de
error
(W#16#...)

Descripci√≥n

00

La instrucci√≥n no se ha inicializado o bien est√° inactiva.

70

La instrucci√≥n est√° esperando peticiones.

71

La instrucci√≥n introduce una petici√≥n en la lista de peticiones.

72

La instrucci√≥n prepara el env√≠o de una petici√≥n.

73

La instrucci√≥n env√≠a una petici√≥n a un dispositivo.

74

La instrucci√≥n espera la respuesta del dispositivo.

75

La instrucci√≥n eval√∫a la respuesta del dispositivo.

76

La instrucci√≥n elimina la petici√≥n de la lista de peticiones.

FF

Se ha producido un error desconocido.

Tabla 4-263 Valores posibles de INFORMATION
C√≥digo de
error
(W#16#...)

Descripci√≥n

0000

No hay informaci√≥n adicional disponible ni peticiones activas.

0001 -00FF

Actualmente se procesan 1 ‚Äì 255 peticiones.

8001

Error en el 1.er par√°metro

8002

Error en el 2.¬∫ par√°metro

8003

Error en el 3.er par√°metro

8004

Error en el 4.¬∫ par√°metro

8005

Error en el 5.¬∫ par√°metro. Este error se indica si no hay ninguna interconexi√≥n con el DB de usuario o bien
hay una no v√°lida.
Causas posibles:
‚óè El DB de usuario es demasiado peque√±o.
‚óè El DB de usuario est√° protegido contra escritura.
‚óè El DB de usuario no est√° disponible en la RAM.
‚óè El DB de usuario no es v√°lido para la CPU utilizada.

8100

5998

Se han intentado posicionar m√°s de las 256 peticiones posibles. Se trata de un error temporal que se
soluciona con la finalizaci√≥n de algunas peticiones. La petici√≥n que se ha intentado posicionar no ha sido
aceptada y debe volver a posicionarse.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de
error
(W#16#...)

Descripci√≥n

8200

Se ha intentado enviar un comando PROFIenergy no v√°lido o no soportado (PE_COMMAND).

84xx

Se ha producido un error de comunicaci√≥n. El n√∫mero del dispositivo que ha provocado el error se indica
en "xx".

85xx

El dispositivo xx ha notificado un error. El n√∫mero del dispositivo que ha provocado el error se indica en "xx".

8600

Actualmente no se soporta el m√©todo de WakeUp solicitado.

FFFF

Se ha producido un error desconocido.

Comandos PROFIenergy
Comando PE "Start_Pause"
Descripci√≥n
El comando PE "Start_Pause" inicia el modo de ahorro de energ√≠a. El comando Start_Pause
puede utilizarse para:
‚óè Conmutar la unidad PE desde el estado "Listo para el funcionamiento"
(PE_ready_to_operate) a un modo de ahorro de energ√≠a (PE_energy_saving_mode).
‚óè Conmutar la unidad PE de un modo de ahorro de energ√≠a a otro.
El consumo de energ√≠a puede aumentar o disminuir al cambiar el modo de ahorro de
energ√≠a.

Llamada del comando PE "Start_Pause"
La llamada del comando "Start_Pause" con la instrucci√≥n "PE_CMD (P√°gina 5979)" se realiza
con los par√°metros siguientes:
Par√°metros

Valor

Descripci√≥n

CMD

1

Llamada del comando PE "Start_Pause".

CMD_MODIFIER

0

Para el comando "Start_Pause" no hay m√°s especificaciones
respecto a la llamada.

CMD_PARA_LEN

4

Longitud del par√°metro CMD_PARA de 4 bytes.

CMD_PARA

ANY

Puntero ANY al valor correspondiente a "Pause_Time" (TIME).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

5999

Instrucciones
4.2 Instrucciones

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase instrucci√≥n "PE_CMD
(P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

PE_Mode_ID

de 1 a 255

BYTE

N√∫mero de identificaci√≥n del modo de aho‚Äê
rro de energ√≠a

Reservado

0

BYTE

-

Comando PE "End_Pause"
Descripci√≥n
El comando PE "End_Pause" finaliza el modo de ahorro de energ√≠a en la unidad PE.

Llamada al comando PE "End_Pause"
La llamada del comando "End_Pause" con la instrucci√≥n "PE_CMD (P√°gina 5979)" se realiza
con los par√°metros siguientes:
Par√°metros

Valor

Descripci√≥n

CMD

2

Llamada del comando PE "End_Pause".

CMD_MODIFIER

0

Para el comando "End_Pause" no hay m√°s especificaciones
respecto a la llamada.

CMD_PARA_LEN

0

Longitud del par√°metro CMD_PARA de 0 bytes.

CMD_PARA

irrelevante

-

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase "PE_CMD (P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

Time_to_operate

-

DWORD

Tiempo esperado para pasar al modo
"PE_ready_to_operate".

Comando PE "Query_modes" - "List_Energy_Saving_Modes"
Descripci√≥n
Con el comando PE "Query_modes" y el subcomando (Modifier) "List_Energy_Saving_Modes"
se indican todos los modos de ahorro de energ√≠a (PE_Mode_ID) soportados por la unidad PE.

6000

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
El resultado de la consulta se escribe en forma de telegrama de respuesta en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA.

Llamada del comando PE "Query_modes" - "List_Energy_Saving_Modes"
La llamada del comando "List_Energy_Saving_Modes" con la instrucci√≥n "PE_CMD
(P√°gina 5979)" se realiza con los par√°metros siguientes:
Par√°metro

Valor

Descripci√≥n

CMD

3

Llamada del comando PE "Query_modes".

CMD_MODIFIER

1

Especificaci√≥n de la llamada del comando: seleccionar el sub‚Äê
comando "List_Energy_Saving_Modes" para mostrar el n√∫me‚Äê
ro y los tipos de modos de ahorro de energ√≠a soportados.

CMD_PARA_LEN

0

Longitud del par√°metro CMD_PARA de 0 bytes.

CMD_PARA

irrelevante

-

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase "PE_CMD (P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

Number_of_PE_
Mode_IDs

1

BYTE

El n√∫mero de modos de ahorro de energ√≠a.

PE_Mode_IDs

-

Array [...] of
BYTE

Matriz con las IDs de los modos de ahorro
de energ√≠a soportados. El significado de las
distintas IDs depende de la unidad PE.

Comando PE "Query_modes" - "Get_Mode"
Descripci√≥n
Con el comando PE "Query_modes" y el subcomando (Modifier) "Get_Mode" se indican los
atributos para el modo de ahorro de energ√≠a activado actualmente.

Llamada del comando PE "Query_modes" - "Get_Mode"
La llamada del comando con la instrucci√≥n "PE_CMD" se realiza con los siguientes par√°metros:
Par√°metro

Valor

Descripci√≥n

CMD

3

Llamada del comando PE "Query_modes"

CMD_MODIFIER

2

Especificaci√≥n de la llamada del comando: seleccionar el subcomando "Get_Mode"
para mostrar el estado del modo activado en el momento actual.

CMD_PARA_LEN

1

Longitud del par√°metro CMD_PARA de 1 byte.

CMD_PARA

ANY

ANY -Puntero al valor correspondiente a PE_MODE_ID.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6001

Instrucciones
4.2 Instrucciones

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase "PE_CMD (P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

PE_Mode_ID

‚óè 0
Modo "PE_power_off"

BYTE

ID del modo de ahorro de energ√≠a activo
en el momento actual.

‚óè 1...254
Modo de ahorro de energ√≠a de la
unidad PE (espec√≠fico de
fabricante)
‚óè 255
Modo "PE_ready_to_operate"
PE_Mode_Attributes

Bit 0:

BYTE

‚óè = 0: Solo est√°n disponibles los
valores est√°ticos de consumo de
energ√≠a y de tiempo.
‚óè = 1: Est√°n disponibles los valores
din√°micos de consumo de energ√≠a
y de tiempo.
Bits de 1 a 7:
‚óè Reservado
Time_min_Pause 1

Diferencia de tiempo sin fecha

DWORD

Tiempo m√≠nimo de pausa para el modo
PE. El tiempo m√≠nimo de pausa es la suma
de los valores de los siguientes atributos:
‚óè Time_to_Pause
‚óè Time_to_operate
‚óè Time_min_length_of_stay
V√©ase la descripci√≥n de "Par√°metro PAU‚Äê
SE_TIME" de la instrucci√≥n
"PE_START_END: Iniciar y finalizar modo
de ahorro de energ√≠a (P√°gina 5975)".

Time_to_Pause 1

Diferencia de tiempo sin fecha

DWORD

Tiempo de desconexi√≥n: Tiempo transcu‚Äê
rrido desde la llamada del modo de ahorro
de energ√≠a hasta el inicio de este (tiempo
de transici√≥n de PE_ready_to_operate a
PE_energy_saving_mode). El tiempo de
desconexi√≥n depende de la unidad PE.

Time_to_operate 1

Diferencia de tiempo sin fecha

DWORD

Tiempo de conexi√≥n: Duraci√≥n de la tran‚Äê
sici√≥n del modo de ahorro de energ√≠a
(PE_energy_saving_mode) al modo de
disponibilidad (PE_ready_to_operate).
La duraci√≥n es calculada din√°micamente
por la unidad PE en el momento de la sa‚Äê
lida.

Time_min_length_
of_stay 1

6002

DWORD

Tiempo m√≠nimo durante el cual el modo de
ahorro de energ√≠a est√° activo en la unidad
PE.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Atributo

Tipo de datos

Descripci√≥n

Time_max_length_
of_stay 1

Valor

DWORD

Tiempo m√°ximo durante el cual el modo
de ahorro de energ√≠a est√° activo en la uni‚Äê
dad PE.

Mode_Power_
Consumption 2

REAL

Consumo de corriente de la unidad PE con
el modo de ahorro de energ√≠a activado.

Energy_
Consumption_
to_pause 2

REAL

Consumo de energ√≠a de la unidad PE du‚Äê
rante la transici√≥n del modo de disponibili‚Äê
dad (PE_ready_to_operate) al modo de
ahorro de energ√≠a (PE_energy_sa‚Äê
ving_mode)

Energy_
Consumption_
to_operate 2

REAL

Consumo de energ√≠a de la unidad PE du‚Äê
rante la transici√≥n del modo de ahorro de
energ√≠a (PE_energy_saving_mode) al mo‚Äê
do de disponibilidad (PE_ready_to_opera‚Äê
te)

Unidad: kW

Unidad: kWh

Unidad: kWh
1

Si la duraci√≥n es infinita, se devuelve el valor 0xFFFFFFFF. Si la duraci√≥n es cero, se devuelve "0".

2

Si los datos de energ√≠a y consumo de corriente de la unidad PE no est√°n definidos, se devuelve "0,0".

Comando PE "PEM_Status"
Descripci√≥n
Con el comando "PEM_Status" se consulta el estado de un modo de ahorro de energ√≠a
activado en el momento actual en una unidad PE.

Llamada al comando PE "PEM_Status"
La llamada del comando "PEM_Status" con la instrucci√≥n "PE_CMD" se realiza con los
par√°metros siguientes:
Par√°metros

Valor

Descripci√≥n

CMD

4

Llamada del comando PE "PEM_Status".

CMD_MODIFIER

0

Para el comando "PEM_Status" no hay m√°s especificaciones respecto a la
llamada.

CMD_PARA_LEN

0

Longitud del par√°metro CMD_PARA de 0 bytes.

CMD_PARA

irrelevante

-

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6003

Instrucciones
4.2 Instrucciones

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase "PE_CMD (P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

PE_Mode_ID_
Source

‚óè 0
Modo "PE_power_off"

BYTE

Modo en el que se encuentra la unidad PE
antes de emitirse un comando PE.

BYTE

Modo en el que se encuentra la unidad PE
despu√©s de ejecutarse un comando PE.

DWORD

Tiempo de conexi√≥n: Duraci√≥n de la tran‚Äê
sici√≥n del modo de ahorro de energ√≠a
(PE_energy_saving_mode) al modo de
disponibilidad (PE_ready_to_operate).

‚óè de 1 a 254
Modo de ahorro de energ√≠a de la
unidad PE (espec√≠fico de
fabricante)
‚óè 255
Modo "PE_ready_to_operate"
PE_Mode_ID_
Destination

‚óè 0
Modo "PE_power_off"
‚óè de 1 a 254
Modo de ahorro de energ√≠a de la
unidad PE (espec√≠fico de
fabricante)
‚óè 255
Modo "PE_ready_to_operate"

Time_to_operate

Diferencia de tiempo sin fecha.

La duraci√≥n es calculada din√°micamente
por la unidad PE en el momento de la sa‚Äê
lida.
Remaining_time_to_
destination

Diferencia de tiempo sin fecha.

DWORD

Tiempo restante para el paso al otro mo‚Äê
do.

Mode_Power_
Consumption

REAL

Consumo de corriente de la unidad PE
con el modo de ahorro de energ√≠a activa‚Äê
do.

Energy_
Consumption_
to_Destination

REAL

Consumo de energ√≠a para la transici√≥n
PE moment√°nea

Energy_
Consumption_
to_operate

REAL

Unidad: kW

Unidad: kWh
Consumo de energ√≠a de la unidad PE du‚Äê
rante la transici√≥n del modo de ahorro de
energ√≠a (PE_energy-saving mode) al mo‚Äê
do de disponibilidad (PE_ready_to_opera‚Äê
te)
Unidad: kWh

6004

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Comando PE "PE_Identify"
Descripci√≥n
Con el comando PE "PE_Identify" se leen el n√∫mero y la descripci√≥n de los comandos PE
soportados por la unidad PE. El tipo y la cantidad de comandos que se soporten dependen de
la unidad PE. Dado que el propio PE_Identify es un comando PE, en caso de respuesta
positiva del dispositivo PE se muestran por lo menos tres comandos PE soportados:
Start_Pause, End_Pause y PE_Identify.

Llamada al comando PE "PE_Identify"
La llamada del comando "PE_Identify" con la instrucci√≥n "PE_CMD (P√°gina 5979)" se realiza
con los par√°metros siguientes:
Par√°metros

Valor

Descripci√≥n

CMD

5

Llamada del comando "PE_Identify".

CMD_MODIFIER

0

Para el comando "PE_Identify" no hay m√°s especificaciones respecto a la
llamada.

CMD_PARA_LEN

0

Longitud del par√°metro CMD_PARA de 0 bytes.

CMD_PARA

irrelevante

-

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase "PE_CMD (P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

Count 1

6

BYTE

N√∫mero de comandos PROFIenergy soportados

Start_Pause

1

BYTE

Primer comando PE (Service_Request_ID) soportado

End_Pause

2

BYTE

...

Query_Modes

3

BYTE

...

PEM_Status

4

BYTE

...

PE_Identify

5

BYTE

...

Query_Measurement

16

BYTE

√öltimo comando PE (Service_Request_ID) soportado

El n√∫mero de comandos soportados es espec√≠fico del fabricante y depende de la unidad PE utilizada. Los valores indicados
son un ejemplo de telegrama de respuesta en caso de que se soporten 6 comandos PE.

1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6005

Instrucciones
4.2 Instrucciones

Comando PE "Query_Measurement" - "Get_Measurement_list"
Descripci√≥n
Con el comando PE "Query_Measurement" y el subcomando (Modifier)
"Get_measurement_list" se consultan los valores medidos que soporta la unidad PE. Los
valores medidos soportados se guardan en forma de lista en el bloque de datos referenciado
en el par√°metro RESPONSE_DATA.

Llamada del comando PE "Query_Measurement" - "Get_Measurement_list"
La llamada del comando con la instrucci√≥n "PE_CMD (P√°gina 5979)" se realiza con los
par√°metros siguientes:
Par√°metros

Valor

Descripci√≥n

CMD

16

Llamada del comando "Query_Measurement"

CMD_MODIFIER

1

Especificaci√≥n de la llamada del comando: seleccionar el subcomando "Get_Mea‚Äê
surement_List" para mostrar una lista de los valores medidos soportados.

CMD_PARA_LEN

0

Longitud del par√°metro CMD_PARA de 0 bytes.

CMD_PARA

irrelevante

-

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase "PE_CMD (P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

Count

-

BYTE

N√∫mero de Measurement-IDs

reserved

-

BYTE

Measurement_ID

-

WORD

Primer Measurement_ID soportado. El Measurement_ID es espec√≠‚Äê
fico de fabricante. Encontrar√° m√°s informaci√≥n en el manual de la
unidad PE en cuesti√≥n.

Accuracy_Domain

-

BYTE

Ver la tabla "Rangos de precisi√≥n".

Accuracy_Class

-

BYTE

Ver las tablas "Clases de precisi√≥n".

Range

-

REAL

Especifica el valor de fin de escala para el valor medido (solo con
rango de precisi√≥n 1). El atributo Range utiliza la misma unidad que
se haya definido con el atributo Measurement_ID (para cada Mea‚Äê
surement_ID se utiliza solo una unidad).

Measurement_ID

-

WORD

√öltimo Measurement_ID soportado

Accuracy_Domain

-

BYTE

Ver la tabla "Rangos de precisi√≥n".

Accuracy_Class

-

BYTE

Ver las tablas "Clases de precisi√≥n".

Range

-

REAL

Especifica el valor de fin de escala para el valor medido (solo con
rango de precisi√≥n 1). El atributo Range utiliza la misma unidad que
se haya definido con el atributo Measurement_ID (para cada Mea‚Äê
surement_ID se utiliza solo una unidad).

...

...

6006

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Rangos de precisi√≥n
Rango de precisi√≥n

Descripci√≥n

0

Reservado

1

La desviaci√≥n de precisi√≥n se expresa en porcentaje del valor de final de escala. El porcentaje de
desviaci√≥n posible se divide en clases de precisi√≥n (ver tabla: Clases de precisi√≥n de los rangos de
precisi√≥n 1 y 2).

2

La desviaci√≥n de precisi√≥n se expresa en porcentaje del valor medido real. El porcentaje de desvia‚Äê
ci√≥n posible se divide en clases de precisi√≥n (ver tabla: Clases de precisi√≥n de los rangos de precisi√≥n
1 y 2).

3

La precisi√≥n de medida se define seg√∫n la norma IEC 61557-12.
Las clases de potencia de funcionamiento para dispositivos de medici√≥n de potencia y supervisi√≥n
(PMD) sin sensores externos y las clases de potencia del sistema para PMD con sensores externos
est√°n codificadas conforme a la tabla "Clases de precisi√≥n del rango de precisi√≥n 3".

4

La precisi√≥n se expresa de acuerdo con la norma EN 50470-3, cap√≠tulo 8 (ver tambi√©n la tabla: Clases
de precisi√≥n del rango de precisi√≥n 4).

Clases de precisi√≥n
Tabla 4-264 Clases de precisi√≥n de los rangos de precisi√≥n 1 y 2
Clase de precisi√≥n
Significado

Clase de precisi√≥n
Significado

0

1

2

3

4

5

6

7

8

Reserva‚Äê
do

0,01%

0,02%

0,05%

0,1%

0,2%

0,5%

1%

1,5%

9

10

11

12

13

14

15

>15

2%

2,5%

3%

5%

10%

20%

>20%

No definido

Tabla 4-265 Clases de precisi√≥n del rango de precisi√≥n 3
Clase de precisi√≥n
Significado

Clase de precisi√≥n
Significado

0

1

2

3

4

5

6

7

8

Reserva‚Äê
do

0,02

0,05

0,1

0,2

0,5

1

1,5

2

9

10

11

12

13

14

>13

2,5

3

5

10

20

20%

No definido

Tabla 4-266 Clases de precisi√≥n del rango de precisi√≥n 4
Clase de precisi√≥n
Significado

0

1

2

3

4

5

6

>7

Reserva‚Äê
do

0,5

1,0

1,5

2,0

2,5

3,0

No definido

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6007

Instrucciones
4.2 Instrucciones

Comando PE "Query_Measurement" - "Get_Measurement_values"
Descripci√≥n
Con el comando PE "Query_Measurement" y el subcomando (Modifier)
"Get_measurement_values" se indican los valores medidos soportados por la unidad PE. Los
valores medidos se guardan en forma de lista en el bloque de datos referenciado en el
par√°metro RESPONSE_DATA.

Llamada del comando PE "Query_Measurement" - "Get_Measurement_values"
La llamada del comando con la instrucci√≥n "PE_CMD (P√°gina 5979)" se realiza con los
par√°metros siguientes:
Par√°metros

Valor

Descripci√≥n

CMD

16

Llamada del comando "Query_Measurement"

CMD_MODIFIER

2

Especificaci√≥n de la llamada del comando: Seleccionar el comando "Get_Measu‚Äê
rement_Values" para mostrar una lista de los valores medidos soportados.

CMD_PARA_LEN

0

En funci√≥n del n√∫mero de valores medidos. La longitud del par√°metro se obtiene
a partir del atributo count y la suma de las longitudes de los atributos de los valores
medidos transferidos.

CMD_PARA

ANY

Puntero ANY hacia la estructura de datos con listado de los valores medidos que
deben consultarse (v√©ase "Par√°metro CMD_PARA").

Par√°metro CMD_PARA
La estructura que se indica mediante el puntero ANY en el par√°metro CMD_PARA debe tener
la estructura siguiente:
Atributo

Valor

Tipo de datos

Descripci√≥n

Count

-

BYTE

N√∫mero de valores medidos (Measurement-IDs)

reserved

0

BYTE

Sin utilizar

Measurement_ID

-

WORD

Primer valor medido consultado

-

WORD

√öltimo valor medido consultado

...
Measurement_ID

Telegrama de respuesta (Service Data Response)
Los datos siguientes del telegrama de respuesta de la unidad PE se escriben en el bloque de
datos referenciado en el par√°metro RESPONSE_DATA (v√©ase "PE_CMD (P√°gina 5979)"):
Atributo

Valor

Tipo de datos

Descripci√≥n

Count

-

BYTE

N√∫mero de valores medidos (Measurement-IDs)

reserved

0

BYTE

Sin utilizar

Length_of_Structure

de 2 a 65535

WORD

Longitud de la estructura en bytes.

6008

1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Atributo

Valor

Measurement_Da‚Äê
ta_Structure_ID

1 = simple value BYTE

Tipo de datos

Descripci√≥n
Define la siguiente estructura.

Measurement_ID

de 0 a 65535

WORD

ID del valor medido soportado.

Status_of_
Measurement_Value

de 1 a 3

BYTE

Estado del valor medido:
‚óè 1: V√°lido
‚óè 2: No soportado
‚óè 3: No v√°lido

Transmission_Da‚Äê
ta_Type

-

REAL

End_of_demand

-

TOD

Sellado de tiempo opcional con el tipo de datos TimeOfDay.

Length_of_Structure

-

WORD

Longitud de la estructura en bytes.

Measurement_Da‚Äê
ta_Structure_ID

-

BYTE

Define la siguiente estructura.

Measurement_ID

-

WORD

ID del valor medido soportado.

Status_of_Measure‚Äê
ment_Value

-

BYTE

Estado del valor medido:

...

‚óè 1: V√°lido
‚óè 2: No soportado
‚óè 3: No v√°lido

Transmission_Da‚Äê
ta_Type

-

REAL

End_of_demand

-

TOD

Sellado de tiempo opcional con el tipo de datos TimeOfDay.

Si la longitud de datos de los valores medidos consultados supera el tama√±o de la PDU (Protocol Data Unit) del nivel de
protocolo, los datos se transfieren de modo incompleto y solo se devuelven los valores medidos soportados.
1

iDevice / iSlave
PE_I_DEV: Forzar comandos PROFIenergy en el iDevice
Descripci√≥n
La instrucci√≥n "PE_I_DEV" se utiliza para desarrollar el perfil PROFIenergy en el dispositivo IO
inteligente (iDevice). Las funciones que en un dispositivo IO normal compatible con
PROFIenergy, p. ej. el ET 200S, son realizadas por el firmware, en el iDevice son realizadas
por la instrucci√≥n "PE_I_DEV" y los bloques auxiliares correspondientes:
‚óè el programa de usuario del iDevice llama c√≠clicamente la instrucci√≥n "PE_I_DEV", que
recibe todos los comandos PROFIenergy;
‚óè la respuesta de PROFIenergy es generada por parametrizaci√≥n de un bloque auxiliar. La
reacci√≥n en la pausa puede programarse libremente. Los datos de respuesta deben
prepararse en 10 segundos, pues en caso contrario en el par√°metro STATUS de la
instrucci√≥n del controlador IO aparece "Stateconflict 0x80B5".
Para utilizar la instrucci√≥n no se requieren conocimientos expl√≠citos del est√°ndar
PROFIenergy.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6009

Instrucciones
4.2 Instrucciones

Bloques auxiliares PROFIenergy (bloques auxiliares PE)
Con los bloques auxiliares PE se genera el telegrama de respuesta. Para ello, indique los datos
de respuesta (en texto expl√≠cito) en los par√°metros de entrada del bloque correspondiente.
‚óè Para cada comando PROFIenergy hay un bloque auxiliar correspondiente a una respuesta
positiva:
‚Äì comando PE "Start_Pause": PE_Start_RSP (P√°gina 6014)
‚Äì comando PE "End_Pause": PE_End_RSP (P√°gina 6015)
‚Äì comando PE "Query_modes" - "List_Energy_Saving_Modes": PE_List_Modes_RSP
(P√°gina 6017)
‚Äì comando PE "Query_modes" - "Get_Mode": PE_Get_Mode_RSP (P√°gina 6018)
‚Äì comando PE "PEM_Status": PE_PEM_Status_RSP (P√°gina 6020)
‚Äì comando PE "PE_Identify": PE_Identify_RSP (P√°gina 6022)
‚Äì comando PE "Query_Measurement" "Get_Measurement_list": PE_Measurement_List_RSP (P√°gina 6023)
‚Äì comando PE "Query_Measurement" "Get_Measurement_values": PE_Measurement_Value_RSP (P√°gina 6024)
‚óè Con independencia del comando PROFIenergy utilizado, adem√°s hay un bloque auxiliar
com√∫n para una respuesta negativa (v√©ase PE_Error_RSP (P√°gina 6013)).

Interconexi√≥n de los bloques auxiliares
La instrucci√≥n "PE_I_DEV" y los bloques auxiliares est√°n adaptados mutuamente. Los
par√°metros se interconectan en parte de manera sencilla. El gr√°fico siguiente muestra qu√©
par√°metros deben interconectarse.

3(B,B'(9
,1,'

,13DU¬£PHWURV
HVSHF¬ØILFRVGH&0'

,15(6(7
(YDOXDFL¬µQ\
UHDFFL¬µQGHO
XVXDULR

%ORTXHDX[LOLDU3(

287&0'

8VXDULR

287&0'B02',),(5
,Q2XW&0'B3$5$

287(5525

287,1'(;

28767$786
,Q2XW$&7,9$7(

287(5525

8VXDULR

28767$786
,19$/,'
2871(:
,Q2XW'$7$B(5525563
287&0'
287&0'B02',),(5

,Q2XW9$/,'
,13(B,B'(9B1(:
,Q2XW'$7$B(5525563
,1&0'
,1&0'B02',),(5

,QWHUFRQH[L¬µQLPSUHVFLQGLEOH

6010

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PE_I_DEV":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RESET

Input

BOOL

I, Q, M, D, L

Resetea la instrucci√≥n.

ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n del iDevice
La direcci√≥n puede tomarse de la configura‚Äê
ci√≥n de hardware.

VALID

Input

BOOL

I, Q, M, D, L

Los datos de respuesta del controlador PRO‚Äê
FIenergy est√°n preparados y pueden enviarse.

CMD_PARA

Output

ANY

I, Q, M, D, L

Par√°metros de:
‚óè Get mode: PE_mode_ID
‚óè Get measurement values: lista de
Measurement_IDs (lista de IDs de las
variables que deben leerse; es posible leer
una sola variable o varias a la vez)
Longitud m√°xima: 234 bytes

DA‚Äê
TA_ERRORR
SP

InOut

ANY

I, Q, M, D, L

Puntero al √°rea de datos que contiene los da‚Äê
tos de acuse del controlador PROFIenergy.

INDEX

Output

INT

I, Q, M, D, L

N√∫mero del registro PROFIenergy (0x80A0 fi‚Äê
jo)

CMD

Output

INT

I, Q, M, D, L

Service-Request-ID del comando PROFIe‚Äê
nergy en funci√≥n del perfil PROFIenergy (v√©a‚Äê
se "Par√°metros CMD y CMD_MODIFIER").

Debe coincidir con el puntero utilizado en los
bloques auxiliares.

Si se ampl√≠a el perfil PROFIenergy son posi‚Äê
bles otros comandos PE (Service-RequestIDs).
CMD_
MODIFIER

Output

INT

I, Q, M, D, L

Subcomando PROFIenergy:
‚óè solo con CMD=3 o CMD=16, v√©ase
"Par√°metros CMD y CMD_MODIFIER";
‚óè en todos los dem√°s comandos: "0".
Si se ampl√≠a el perfil PROFIenergy son posi‚Äê
bles otros subcomandos.

NEW

Output

BOOL

I, Q, M, D, L

Nuevos datos disponibles para el controlador
PROFIenergy.

ERROR

Output

BOOL

I, Q, M, D, L

Comando finalizado con error.

STATUS

Output

DWORD

I, Q, M, D, L

Informaci√≥n de error (v√©ase "Par√°metro STA‚Äê
TUS")

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6011

Instrucciones
4.2 Instrucciones

Par√°metros CMD y CMD_MODIFIER
CMD

CMD_
MODIFIER

Comando PROFIenergy

Descripci√≥n

01

0

Start_Pause

Inicia el modo de ahorro de energ√≠a o cambia a otro modo de
ahorro de energ√≠a.

02

0

End_Pause

Sale del modo de ahorro de energ√≠a.

03

1

Query_Modes - List energy sa‚Äê Muestra los modos de ahorro de energ√≠a soportados.
ving Modes

2

Query_Modes - Get Mode

Muestra los atributos del modo de ahorro de energ√≠a activa‚Äê
do en el momento actual.

04

0

PEM_Status

Consulta el estado del modo de ahorro de energ√≠a.

05

0

PE_Identify

Lectura del n√∫mero de comandos PE soportados y descrip‚Äê
ci√≥n de los mismos.

16

1

Query_Measurement Get_Measurement_List

Listado de los valores medidos soportados por la unidad PE.

2

Query_Measurement Get_Measurement_Values

Muestra los valores medidos de la unidad PE.

Par√°metro STATUS
En el par√°metro de salida STATUS se muestra informaci√≥n de error. Si se interpreta como
ARRAY[1...4] of BYTE, la informaci√≥n de error tiene la estructura siguiente:
Elemento de cam‚Äê
po

Nombre

Significado

STATUS[1]

Function_Num

Causa del error
‚óè B#16#00: Ning√∫n error
‚óè B#16#DE: error al leer el registro
‚óè B#16#DF: error al escribir el registro
‚óè B#16#C0: mensaje de error de la instrucci√≥n "PE_I_DEV" o de las instrucciones
de comunicaci√≥n de uso interno "PRVREC" y "RCVREC".

STATUS[2]

Error_Decode

Ubicaci√≥n de la identificaci√≥n de error
‚óè 80: error DPV1 seg√∫n la norma IEC 61158-6 o error espec√≠fico de instrucci√≥n

STATUS[3]

Error_Code_1

Identificaci√≥n del error (con Error_Decode = 80):
‚óè B1: Write length error (error en la longitud de escritura o indicaci√≥n de longitud
insuficiente mediante el tipo de datos ANY).

STATUS[4]

6012

Error_Code_2

Con error PROFINET: salida del mensaje de error del controlador IO. Si no se ha
producido ning√∫n error PROFINET, el valor de STATUS[4] = "0".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Nota
Mensajes de error de las instrucciones "PRVREC" y "RCVREC"
La instrucci√≥n "PE_I_DEV" utiliza para la comunicaci√≥n las instrucciones "PRVREC
(P√°gina 5937)" y "RCVREC (P√°gina 5935)". Los mensajes de error de estas instrucciones se
emiten correspondientemente en los elementos de campo STATUS[1] a STATUS[4].
Encontrar√° el significado de los c√≥digos de error de las instrucciones "PRVREC" y "RCVREC"
en la descripci√≥n del par√°metro STATUS (P√°gina 5901) correspondiente.

Consulte tambi√©n
RDREC: Leer registro (P√°gina 5888)
WRREC: Escribir registro (P√°gina 5890)

M√≥dulos auxiliares de la instrucci√≥n PE_I_DEV
PE_Error_RSP: Generaci√≥n de respuesta negativa a comando
Descripci√≥n
El bloque auxiliar "PE_Error_RSP" (Response with failure) genera una respuesta negativa si el
comando solicitado no es soportado con car√°cter general o temporalmente. La respuesta se
genera con independencia del comando solicitado.

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_Error_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NEW

Input

BOOL

I, Q, M, D, L o cons‚Äê El par√°metro debe estar interconectado con el
tante
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar
se ejecuta solo si el par√°metro tiene el valor "1".

ERROR_CODE

Input

BYTE

I, Q, M, D, L o cons‚Äê N√∫mero de error
tante

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros
de entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n res‚Äê
tablece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro
NEW de la instrucci√≥n "PE_I_DEV (P√°gi‚Äê
na 6009)" se haya detectado un flanco ascen‚Äê
dente.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6013

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV
(P√°gina 6009)".
El bloque auxiliar activa el par√°metro cuando
los datos de respuesta del controlador PRO‚Äê
FIenergy est√°n preparados y pueden enviarse.

DATA_
ERRORRSP

InOut

ANY

D

ERROR

Output

BOOL

I, Q, M, D, L

Puntero hacia el √°rea de datos en la que se
guardan los datos de respuesta. El par√°metro
es id√©ntico al puntero de DATA_ERRORRSP
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)".
El √°rea de datos direccionada contiene el tele‚Äê
grama PROFIenergy completo.
Longitud m√≠nima: 244 bytes
‚óè "0": ning√∫n error
‚óè "1": con errores

STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p.
ej. √°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

PE_Start_RSP: Generar respuesta a comando para iniciar pausa
Descripci√≥n
El bloque auxiliar "PE_Start_RSP" (Iniciar pausa) genera la respuesta al comando
PE Start_Pause (P√°gina 5999). La instrucci√≥n devuelve el estado de ahorro de energ√≠a que
adopta el dispositivo (par√°metro PE_MODE_ID).
Si las reacciones a pausas de distinta duraci√≥n son diferentes, se puede indicar en la
notificaci√≥n mediante el estado de ahorro de energ√≠a adoptado (PE_Mode_ID = 1 para una
pausa corta, PE_Mode_ID = 2 para una pausa m√°s larga, etc.).

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_Start_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NE
W

Input

BOOL

I, Q, M, D, L o cons‚Äê El par√°metro debe estar interconectado con el
tante
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar
se ejecuta solo si el par√°metro tiene el valor "1".

CMD

Input

INT

I, Q, M, D, L o cons‚Äê Service-Request-ID del comando PROFIe‚Äê
tante
nergy
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

6014

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

PE_MODE_ID

Input

BYTE

I, Q, M, D, L o cons‚Äê Modo PE que adopta el proceso
tante

Descripci√≥n

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros
de entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n res‚Äê
tablece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro
NEW de la instrucci√≥n "PE_I_DEV (P√°gi‚Äê
na 6009)" se haya detectado un flanco ascen‚Äê
dente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV
(P√°gina 6009)".
El bloque auxiliar activa el par√°metro cuando
los datos de respuesta del controlador PRO‚Äê
FIenergy est√°n preparados y pueden enviarse.

DATA_
ERRORRSP

InOut

ANY

D

Puntero hacia el √°rea de datos en la que se
guardan los datos de respuesta. El par√°metro
es id√©ntico al puntero de DATA_ERRORRSP
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)".
El √°rea de datos direccionada contiene el tele‚Äê
grama PROFIenergy completo.
Longitud m√≠nima: 244 bytes

ERROR

Output

BOOL

I, Q, M, D, L

STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "1": con errores
‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p.
ej. √°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

PE_End_RSP: Generar respuesta a comando para final de pausa
Descripci√≥n
El bloque auxiliar "PE_End_RSP" genera la respuesta al comando PE End_Pause
(P√°gina 6000). Se devuelve como respuesta el tiempo necesario para cambiar del estado
operativo actual al estado operativo "Ready_To_Operate".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6015

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_End_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memo‚Äê
ria

Descripci√≥n

PE_I_DEV_NEW

Input

BOOL

I, Q, M, D, L o
constante

El par√°metro debe estar interconectado con el
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar
se ejecuta solo si el par√°metro tiene el valor "1".

CMD

Input

INT

I, Q, M, D, L o
constante

Service-Request-ID del comando PROFIe‚Äê
nergy
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

Time_to_Operate

Input

DWORD

I, Q, M, D, L o
constante

Tiempo para cambiar del estado operativo ac‚Äê
tual a "Ready_To_Operate".

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros
de entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n res‚Äê
tablece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro
NEW de la instrucci√≥n "PE_I_DEV (P√°gi‚Äê
na 6009)" se haya detectado un flanco ascen‚Äê
dente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV
(P√°gina 6009)".
El bloque auxiliar activa el par√°metro cuando
los datos de respuesta del controlador PRO‚Äê
FIenergy est√°n preparados y pueden enviarse.

DATA_
ERRORRSP

InOut

ANY

D

Puntero hacia el √°rea de datos en la que se
guardan los datos de respuesta. El par√°metro
es id√©ntico al puntero de DATA_ERRORRSP
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)".
El √°rea de datos direccionada contiene el tele‚Äê
grama PROFIenergy completo.
Longitud m√≠nima: 244 bytes

ERROR

Output

BOOL

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "1": con errores

STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p.
ej. √°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6016

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

PE_List_Modes_RSP: Generar respuesta con modos de ahorro de energ√≠a consultados
Descripci√≥n
El bloque auxiliar "PE_List_Modes_RSP" genera la respuesta al comando
PE List_Energy_Saving_Modes (P√°gina 6000). La respuesta generada contiene el n√∫mero de
los estados de ahorro de energ√≠a soportados y sus IDs.

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_List_Modes_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NEW

Input

BOOL

I, Q, M, D, L o cons‚Äê El par√°metro debe estar interconectado con el
tante
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar se
ejecuta solo si el par√°metro tiene el valor "1".

CMD

Input

INT

I, Q, M, D, L o cons‚Äê Service-Request-ID del comando PROFIenergy
tante
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

CMD_MODIFIER

Input

INT

I, Q, M, D, L o cons‚Äê Subcomando PROFIenergy (la evaluaci√≥n solo
tante
tiene lugar si CMD=3 o CMD=16). El par√°metro
debe estar interconectado con el par√°metro de
salida CMD_MODIFIER de la instrucci√≥n
"PE_I_DEV".

Number_of_PE_
Mode_IDs

Input

BYTE

I, Q, M, D, L o cons‚Äê N√∫mero de estados de ahorro de energ√≠a sopor‚Äê
tante
tados.
Valores permitidos: de 1 a 254

PE_MODE_ID

Input

ANY

I, Q, M, D, L

Se√±ala el √°rea en la que se guardan las IDs de
los estados de ahorro de energ√≠a soportados
(PE_Mode_ID).
√Årea permitida: de 1 a 254.

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros de
entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n resta‚Äê
blece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro NEW
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)" se
haya detectado un flanco ascendente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV (P√°‚Äê
gina 6009)".
El bloque auxiliar activa el par√°metro cuando los
datos de respuesta del controlador PROFIe‚Äê
nergy est√°n preparados y pueden enviarse.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6017

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DATA_
ERRORRSP

InOut

ANY

D

Puntero hacia el √°rea de datos en la que se guar‚Äê
dan los datos de respuesta. El par√°metro es
id√©ntico al puntero de DATA_ERRORRSP de la
instrucci√≥n "PE_I_DEV (P√°gina 6009)". El √°rea
de datos direccionada contiene el telegrama
PROFIenergy completo.

ERROR

Output

BOOL

I, Q, M, D, L

Longitud m√≠nima: 244 bytes
‚óè "0": ning√∫n error
‚óè "1": con errores
STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p. ej.
√°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

PE_Get_Mode_RSP: Generar respuesta con datos de energ√≠a consultados
Descripci√≥n
El bloque auxiliar "PE_Get_Mode_RSP" genera la respuesta al comando Get_Mode
(P√°gina 6001). La respuesta contiene los tiempos y los datos de potencia o de energ√≠a de cada
estado de ahorro de energ√≠a concreto.

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_Get_Mode_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NEW

Input

BOOL

I, Q, M, D, L o cons‚Äê El par√°metro debe estar interconectado con el
tante
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar
se ejecuta solo si el par√°metro tiene el valor "1".

CMD

Input

INT

I, Q, M, D, L o cons‚Äê Service-Request-ID del comando PROFIe‚Äê
tante
nergy
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

CMD_MODIFIER

Input

INT

I, Q, M, D, L o cons‚Äê Subcomando PROFIenergy (la evaluaci√≥n so‚Äê
tante
lo tiene lugar si CMD=3 o CMD=16). El par√°‚Äê
metro debe estar interconectado con el par√°‚Äê
metro de salida CMD_MODIFIER de la instruc‚Äê
ci√≥n "PE_I_DEV".

PE_Mode_ID

Input

BYTE

I, Q, M, D, L o cons‚Äê ID del modo de ahorro de energ√≠a activo en el
tante
momento actual.

PE_Mode_Attributes

Input

BYTE

I, Q, M, D, L o cons‚Äê Informaci√≥n adicional sobre el modo de ahorro
tante
de energ√≠a

6018

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Time_min_Pause

Input

DWORD

I, Q, M, D, L o cons‚Äê Duraci√≥n m√≠nima de pausa para este modo de
tante
ahorro de energ√≠a PE.

Descripci√≥n

Est√° formada por la suma de tres par√°metros:
‚óè Time_to_Pause
‚óè Time_to_operate
‚óè Time_min_length_of_stay
Time_to_Pause

Input

DWORD

I, Q, M, D, L o cons‚Äê Duraci√≥n desde el flanco en el par√°metro
tante
START (v√©ase "PE_I_DEV (P√°gina 6009)")
hasta que se alcanza el modo de ahorro de
energ√≠a PE solicitado.

Time_to_Operate

Input

DWORD

I, Q, M, D, L o cons‚Äê Tiempo de conexi√≥n m√°ximo hasta
tante
"PE_ready_to_operate". El par√°metro "Ti‚Äê
me_to_operate" puede utilizarse directamente
para los c√°lculos correspondientes. El valor
puede ser un valor m√°ximo est√°tico o bien pue‚Äê
de calcularlo din√°micamente la unidad PE.

Time_min_Lenght_
of_stay

Input

DWORD

I, Q, M, D, L o cons‚Äê Tiempo m√≠nimo durante el que la unidad PE
tante
debe permanecer en este modo PE.

Ti‚Äê
me_max_Lenght_of_
stay

Input

DWORD

I, Q, M, D, L o cons‚Äê Tiempo m√°ximo durante el que la unidad PE
tante
puede permanecer en este modo PE.

Mode_Power_
Consumption

Input

DWORD

I, Q, M, D, L o cons‚Äê Consumo de energ√≠a en el modo PE actual, en
tante
[kW].

Energy_Consum_
to_Pause

Input

DWORD

I, Q, M, D, L o cons‚Äê Consumo de energ√≠a desde
tante
"PE_ready_to_operate" hasta el modo PE ac‚Äê
tual, en [kWh].

Energy_Consum_
to_operate

Input

DWORD

I, Q, M, D, L o cons‚Äê Consumo de energ√≠a desde el modo PE actual
tante
hasta "PE_ready_to_operate", en [kWh].

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros
de entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n res‚Äê
tablece el par√°metro.
El par√°metro debe activarse en un tiempo de
10 segundos despu√©s de que en el par√°metro
NEW de la instrucci√≥n "PE_I_DEV (P√°gi‚Äê
na 6009)" se haya detectado un flanco ascen‚Äê
dente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV
(P√°gina 6009)".
El bloque auxiliar activa el par√°metro cuando
est√°n disponibles los datos de respuesta para
el controlador PROFIenergy y puedan enviar‚Äê
se.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DATA_
ERRORRSP

InOut

ANY

D

Puntero hacia el √°rea de datos en la que se
guardan los datos de respuesta. El par√°metro
es id√©ntico al puntero de DATA_ERRORRSP
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)". El
√°rea de datos direccionada contiene el telegra‚Äê
ma PROFIenergy completo.

ERROR

Output

BOOL

I, Q, M, D, L

‚óè "0": ning√∫n error

Longitud m√≠nima: 244 bytes
‚óè "1": Se han producido errores
STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p.
ej. √°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

PE_PEM_Status_RSP: Generar respuesta con estado PEM
Descripci√≥n
El bloque auxiliar "PE_PEM_Status_RSP" genera la respuesta al comando PEM_Status
(P√°gina 6003).

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_PEM_Status_RSP":
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NEW

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

El par√°metro debe estar interconectado con el
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar se
ejecuta solo si el par√°metro tiene el valor "1".

CMD

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Service-Request-ID del comando PROFIenergy
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

PE_MODE_ID_
Source

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Source y Destination para PEM_STATUS.

PE_MODE_ID_
Destination

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

‚óè 0x00: PE_POWER_OFF

Valores:
‚óè 0x01 ‚Äì 0xFE: espec√≠fico del fabricante
‚óè 0xFF: PE_READY_TO_OPERATE

6020

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de da‚Äê
tos

√Årea de memoria

Descripci√≥n

Time_to_Operate1

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Tiempo de conexi√≥n m√°ximo hasta
"PE_ready_to_operate".
"Time_to_operate" puede utilizarse directamente
para los c√°lculos correspondientes. El valor pue‚Äê
de ser un valor m√°ximo est√°tico o bien puede
calcularlo din√°micamente la unidad PE.

Remaining_time_
to_destination1

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Opcionalmente: tiempo restante hasta el modo
PE solicitado. Valor din√°mico o valor m√°ximo es‚Äê
t√°tico

Mode_Power_
Consumption2

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Consumo de energ√≠a en el modo PE actual, en
[kW].

Energy_
Consumption_
to_Destination2

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Consumo de energ√≠a hasta el modo PE solicita‚Äê
do, en [kW].

Energy_
Consumption_
to_operate2

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Consumo de energ√≠a desde el modo PE actual
hasta "PE_ready_to_operate", en [kWh].

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros de
entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n resta‚Äê
blece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro NEW
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)" se
haya detectado un flanco ascendente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV (P√°‚Äê
gina 6009)".
El bloque auxiliar activa el par√°metro cuando los
datos de respuesta del controlador PROFIe‚Äê
nergy est√°n preparados y pueden enviarse.

DATA_
ERRORRSP

InOut

ANY

D

ERROR

Output

BOOL

I, Q, M, D, L

Puntero hacia el √°rea de datos en la que se guar‚Äê
dan los datos de respuesta. El par√°metro es
id√©ntico al puntero de DATA_ERRORRSP de la
instrucci√≥n "PE_I_DEV (P√°gina 6009)". El √°rea
de datos direccionada contiene el telegrama
PROFIenergy completo.
Longitud m√≠nima: 244 bytes
‚óè "0": ning√∫n error
‚óè "1": con errores

STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p. ej.
√°rea err√≥nea

1

Si la duraci√≥n es ilimitada, puede indicarse el valor m√°ximo "0xFFFFFFFF". Si la duraci√≥n es "cero", puede utilizarse "0x00".

2

Si el consumo de energ√≠a no est√° definido, puede indicarse "0,0".

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6021

Instrucciones
4.2 Instrucciones

PE_Identify_RSP: Generar respuesta con comandos PROFIenergy soportados
Descripci√≥n
El bloque auxiliar "PE_Identify_RSP" genera la respuesta al comando PE_Identify
(P√°gina 6005). En la respuesta al comando se indican los comandos PROFIenergy que se
soportan. Tenga en cuenta que PE_IDENTIFY es en s√≠ mismo un comando PE y debe
indicarse correspondientemente en la respuesta.

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_Identify_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NE
W

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

El par√°metro debe estar interconectado con el
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar
se ejecuta solo si el par√°metro tiene el valor "1".

CMD

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Service-Request-ID del comando PROFIe‚Äê
nergy
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

Start_Pause

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

Un par√°metro para cada comando PROFIe‚Äê
nergy:

End_Pause

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

‚óè 0: este comando PE no se soporta

Query_Modes

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

PEM_Status

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

PE_Identify

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

Query_
Measurement

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

ACTIVATE

InOut

BOOL

I, Q, M, D, L

‚óè 1: este comando PE se soporta

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros
de entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n res‚Äê
tablece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro
NEW de la instrucci√≥n "PE_I_DEV (P√°gi‚Äê
na 6009)" se haya detectado un flanco ascen‚Äê
dente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV
(P√°gina 6009)".
El bloque auxiliar activa el par√°metro cuando
los datos de respuesta del controlador PRO‚Äê
FIenergy est√°n preparados y pueden enviarse.

6022

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DATA_
ERRORRSP

InOut

ANY

D

Puntero hacia el √°rea de datos en la que se
guardan los datos de respuesta. El par√°metro
es id√©ntico al puntero de DATA_ERRORRSP
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)".
El √°rea de datos direccionada contiene el tele‚Äê
grama PROFIenergy completo.

ERROR

Output

BOOL

I, Q, M, D, L

Longitud m√≠nima: 244 bytes
‚óè "0": ning√∫n error
‚óè "1": con errores
STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p.
ej. √°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

PE_Measurement_List_RSP: Generar respuesta con lista de valores medidos soportados
Descripci√≥n
El bloque auxiliar "PE_Measurement_List_RSP" genera la respuesta al
comando Get_measurement_list (P√°gina 6006). En la respuesta se indican los valores
medidos (Measurement-IDs) que se soportan.

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_Measurement_List_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NE
W

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

El par√°metro debe estar interconectado con el
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar
se ejecuta solo si el par√°metro tiene el valor
"1".

CMD

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Service-Request-ID del comando PROFIe‚Äê
nergy
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

CMD_MODI‚Äê
FIER

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Subcomando PROFIenergy (la evaluaci√≥n so‚Äê
lo tiene lugar si CMD=3 o CMD=16). El par√°‚Äê
metro debe estar interconectado con el par√°‚Äê
metro de salida CMD_MODIFIER de la instruc‚Äê
ci√≥n "PE_I_DEV".

Count

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de valores medidos soportados (Mea‚Äê
surement-IDs)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6023

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

Measurement_
List

Input

ANY

D

Puntero hacia la la matriz con las Measure‚Äê
ment_IDs soportadas.
Consulte la estructura de la matriz seg√∫n el
perfil PROFIenergy en: Comando PE
"Query_Measurement" - "Get_Measure‚Äê
ment_list" (P√°gina 6006)

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros
de entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n res‚Äê
tablece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro
NEW de la instrucci√≥n "PE_I_DEV (P√°gi‚Äê
na 6009)" se haya detectado un flanco ascen‚Äê
dente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV
(P√°gina 6009)".
El bloque auxiliar activa el par√°metro cuando
los datos de respuesta del controlador PRO‚Äê
FIenergy est√°n preparados y pueden enviarse.

DATA_
ERRORRSP

InOut

ANY

D

Puntero hacia el √°rea de datos en la que se
guardan los datos de respuesta. El par√°metro
es id√©ntico al puntero de DATA_ERRORRSP
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)".
El √°rea de datos direccionada contiene el tele‚Äê
grama PROFIenergy completo.
Longitud m√≠nima: 244 bytes

ERROR

Output

BOOL

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "1": con errores

STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p.
ej. √°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

PE_Measurement_Value_RSP: Generar respuesta con valores medidos solicitados
Descripci√≥n
El bloque auxiliar "PE_Measurement_Value_RSP" genera la respuesta al
comando Get_measurement_values (P√°gina 6008). En la respuesta se devuelven los valores
de los valores medidos solicitados.

6024

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros del bloque auxiliar "PE_Measurement_Value_RSP":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PE_I_DEV_NE
W

Input

BOOL

I, Q, M, D, L o cons‚Äê
tante

El par√°metro debe estar interconectado con el
par√°metro de salida NEW de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)". El bloque auxiliar se
ejecuta solo si el par√°metro tiene el valor "1".

CMD

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Service-Request-ID del comando PROFIenergy
El par√°metro debe estar interconectado con el
par√°metro de salida CMD de la instrucci√≥n
"PE_I_DEV (P√°gina 6009)".

CMD_MODI‚Äê
FIER

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Subcomando PROFIenergy (la evaluaci√≥n solo
tiene lugar si CMD=3 o CMD=16). El par√°metro
debe estar interconectado con el par√°metro de
salida CMD_MODIFIER de la instrucci√≥n
"PE_I_DEV".

Count

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de valores medidos (Measurement_Va‚Äê
lues).

Measure‚Äê
ment_Values

Input

ANY

D

Puntero hacia la matriz con los valores medidos
(Measurement_IDs).
Consulte la estructura de la matriz seg√∫n el perfil
PROFIenergy en Comando PE "Query_Measu‚Äê
rement" - "Get_Measurement_values" (P√°gi‚Äê
na 6008)

ACTIVATE

InOut

BOOL

I, Q, M, D, L

Con un flanco ascendente en la entrada ACTI‚Äê
VATE, esta instrucci√≥n copia los par√°metros de
entrada en el √°rea de datos DA‚Äê
TA_ERROR_RSP. Despu√©s la instrucci√≥n resta‚Äê
blece el par√°metro.
El par√°metro debe fijarse en un tiempo de 10
segundos despu√©s de que en el par√°metro NEW
de la instrucci√≥n "PE_I_DEV (P√°gina 6009)" se
haya detectado un flanco ascendente.

VALID

InOut

BOOL

I, Q, M, D, L

El par√°metro debe estar interconectado con la
entrada VALID de la instrucci√≥n "PE_I_DEV (P√°‚Äê
gina 6009)".
El bloque auxiliar activa el par√°metro cuando los
datos de respuesta del controlador PROFIe‚Äê
nergy est√°n preparados y pueden enviarse.

DATA_
ERRORRSP

InOut

ANY

D

Puntero hacia el √°rea de datos en la que se guar‚Äê
dan los datos de respuesta. El par√°metro es
id√©ntico al puntero de DATA_ERRORRSP de la
instrucci√≥n "PE_I_DEV (P√°gina 6009)". El √°rea
de datos direccionada contiene el telegrama
PROFIenergy completo.
Longitud m√≠nima: 244 bytes

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6025

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ERROR

Output

BOOL

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "1": con errores

STATUS

Output

WORD

I, Q, M, D, L

‚óè "0": ning√∫n error
‚óè "0x80B1": error en la indicaci√≥n de ANY, p. ej.
√°rea err√≥nea

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

4.2.3.6

Parametrizaci√≥n del m√≥dulo

Escribir y leer registros
Principio
Algunos m√≥dulos poseen un √°rea de datos del sistema a la que solo es posible acceder desde
el programa mediante escritura. Esta √°rea contiene registros con los n√∫meros de 0 a 240,
aunque no todos los m√≥dulos poseen todos los registros (ver la tabla siguiente).
Adem√°s, los m√≥dulos pueden poseer tambi√©n un √°rea de datos del sistema a la que solo es
posible acceder desde el programa mediante lectura. Esta √°rea contiene registros con los
n√∫meros de 0 a 240, aunque no todos los m√≥dulos poseen todos los registros.
Nota
Algunos m√≥dulos poseen ambas √°reas de datos del sistema. Se trata de √°reas distintas desde
el punto de vista f√≠sico, que solo tienen en com√∫n la divisi√≥n l√≥gica en registros.

6026

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

√Årea de datos del sistema solo accesible por escritura
La tabla siguiente muestra el formato del √°rea de datos del sistema solo accesible por
escritura. Indica el tama√±o que puede ocupar cada uno de los registros y con qu√© instrucciones
pueden escribirse.
N√∫mero de
registro

Contenido

Tama√±o

Restricci√≥n

Con acceso de escri‚Äê
tura mediante instruc‚Äê
ci√≥n

0

Par√°metros

Con S7-300:
de 2 a 14 bytes

Con acceso de es‚Äê
critura solo con
S7-400

WR_DPARM (P√°gi‚Äê
na 6037)

Con S7-300:

-

1

Par√°metros

de 2 a 14 bytes

de 2 a 127

Datos del usua‚Äê
rio

PARM_MOD (P√°gi‚Äê
na 6031)
WR_PARM (P√°gi‚Äê
na 6035)

(DS0 y DS1 ocupan
juntos exactamente
16 bytes)

WR_DPARM (P√°gi‚Äê
na 6037)

Cada uno ‚â§ 240 bytes -

WR_PARM (P√°gi‚Äê
na 6035)

PARM_MOD (P√°gi‚Äê
na 6031)

WR_DPARM (P√°gi‚Äê
na 6037)
PARM_MOD (P√°gi‚Äê
na 6031)
WR_REC (P√°gi‚Äê
na 5927)
de 128 a 240

Par√°metros

Cada uno ‚â§ 240 bytes -

WR_PARM (P√°gi‚Äê
na 6035)
WR_DPARM (P√°gi‚Äê
na 6037)
PARM_MOD (P√°gi‚Äê
na 6031)
WR_REC (P√°gi‚Äê
na 5927)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6027

Instrucciones
4.2 Instrucciones

√Årea de datos del sistema solo accesible por lectura
La tabla siguiente muestra el formato del √°rea de datos del sistema solo accesible por lectura.
Indica el tama√±o que pueden ocupar los distintos registros y con qu√© instrucciones pueden
leerse.
N√∫mero de
registro

Contenido

0

Datos de diagn√≥stico es‚Äê 4 bytes
pec√≠ficos de m√≥dulo (defi‚Äê
nidos de modo homog√©‚Äê
neo para el sistema)

RDSYSST (P√°gina 6116)
(SZL_ID00B1H)

Datos de diagn√≥stico es‚Äê
pec√≠ficos de canal

RDSYSST (P√°gina 6116)
(SZL_ID00B2H y
00B3H) RD_REC (P√°gina 5922)

1

(incl. registro 0)

Tama√±o

Con acceso de lectura median‚Äê
te instrucci√≥n

RD_REC (P√°gina 5922)

‚óè Con S7-300:
16 bytes
‚óè Con S7-400:
de 4 a 220 bytes

de 2 a 127

Datos del usuario

Cada uno ‚â§ 240 bytes

RD_REC (P√°gina 5922)

de 128 a 240

Datos de diagn√≥stico

Cada uno ‚â§ 240 bytes

RD_REC (P√°gina 5922)

Recursos del sistema
Si se lanzan consecutivamente varias transferencias de registro de funcionamiento as√≠ncrono,
se garantiza que todas las peticiones se ejecuten y que no se produzcan interferencias
rec√≠procas.
En el momento en que se alcanza el l√≠mite de los recursos del sistema, se env√≠a una
notificaci√≥n mediante RET_VAL. El estado de fallo temporal puede eliminarse repitiendo la
petici√≥n.
El n√∫mero m√°ximo de peticiones activas "simult√°neamente" para un mismo tipo de instrucci√≥n
depende de la CPU.

RD_DPAR: Leer registro de un m√≥dulo
Descripci√≥n
Esta instrucci√≥n permite leer el registro con n√∫mero INDEX del componente direccionado
desde los datos del sistema configurados. Puede tratarse de un m√≥dulo central o de un
componente descentralizado (PROFIBUS DP o PROFINET IO).
El valor TRUE del par√°metro de salida VALID indica que el registro se ha transferido
correctamente al √°rea de destino RECORD. En ese caso, el par√°metro de salida LEN contiene
la longitud en bytes de los datos le√≠dos.
Si se ha producido un error durante la transferencia del registro, se se√±aliza mediante el
par√°metro de salida ERROR . En ese caso, el par√°metro de salida STATUS contiene la
informaci√≥n de error.

6028

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Funcionamiento
La instrucci√≥n "RD_DPAR" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se
prolonga a lo largo de varias llamadas. Para iniciar la transferencia del registro, debe llamarse
"RD_DPAR" con REQ = 1.
Mediante el par√°metro de salida BUSY y los bytes 2 y 3 del par√°metro de salida STATUS se
muestra el estado de la petici√≥n. Los bytes 2 y 3 de STATUS corresponden al par√°metro de
salida RET_VAL de las instrucciones as√≠ncronas.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).
La transferencia del registro se puede dar por finalizada cuando el par√°metro de salida BUSY
ha adoptado el valor FALSE.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RD_DPAR":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: Solicitud de lectura

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Cualquier direcci√≥n l√≥gica del m√≥dulo
En el bit 15 se especifica si se trata de una
direcci√≥n de entrada (bit 15 = 0) o de salida
(bit 15 = 1).

INDEX

Input

INT

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de registro

VALID

Output

BOOL

I, Q, M, D, L

El nuevo registro se ha recibido y es v√°lido

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La petici√≥n todav√≠a no ha finalizado.

ERROR

Output

BOOL

I, Q, M, D, L

ERROR = 1: Se ha producido un error durante
la lectura.

STATUS

Output

DWORD

I, Q, M, D, L

‚óè Identificaci√≥n de llamada (bytes 2 y 3) o
c√≥digo de error
‚óè Byte 1: B#16#00, si no hay ning√∫n error.
De lo contrario, ID de funci√≥n de DPV1PDU: En caso de error al leer registros
B#16#DE, en caso de error al escribir
registros B#16#DF. Si no se utiliza ning√∫n
elemento de protocolo DPV1: B#16#C0.
‚óè Byte 4: Extensi√≥n espec√≠fica de fabricante
de la identificaci√≥n de error

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6029

Instrucciones
4.2 Instrucciones
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LEN

Output

INT

I, Q, M, D, L

Longitud de la informaci√≥n del registro le√≠da

RECORD

InOut

ANY

I, Q, M, D, L

√Årea de destino para el registro le√≠do
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro RECORD siempre re‚Äê
quiere que se especifiquen por completo los
par√°metros de DB (ej.: P#DB13.DBX0.0 byte
100). En las CPUs S7-300 no est√° permitido
omitir un n√∫mero de DB expl√≠cito; de lo contra‚Äê
rio se genera un aviso de error en el programa
de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros ERROR y STATUS
Consulte tambi√©n: PARM_MOD: Transferir registros de un m√≥dulo (P√°gina 6031).

RD_DPARA: Leer registro de un m√≥dulo de forma as√≠ncrona
Descripci√≥n
Esta instrucci√≥n permite leer el registro con n√∫mero RECNUM del m√≥dulo seleccionado desde
los datos del sistema configurados. El registro le√≠do se guarda en el √°rea de destino delimitada
mediante el par√°metro RECORD .

Funcionamiento
La instrucci√≥n "RD_DPARA" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se
prolonga a lo largo de varias llamadas. Para iniciar la petici√≥n, debe llamarse la instrucci√≥n con
REQ = 1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY .
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813).

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RD_DPARA":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: solicitud de lectura

LADDR

Input

WORD

I, Q, M, D, L o constan‚Äê Cualquier direcci√≥n l√≥gica del m√≥dulo. Si se
te
trata de una direcci√≥n de salida, debe estar
activado el bit m√°s significativo.

RECNUM

Input

BYTE

I, Q, M, D, L o constan‚Äê N√∫mero de registro (valores admisibles: de 0
te
a 240)

6030

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el valor de respuesta con‚Äê
tendr√° un c√≥digo de error.
Si no se han producido errores durante la
transferencia, deben distinguirse los siguien‚Äê
tes casos:
‚óè RET_VAL contiene la longitud en bytes
del registro realmente le√≠do, en caso de
que el √°rea de destino sea mayor que el
registro le√≠do.
‚óè RET_VAL contiene "0" en caso de que la
longitud del registro le√≠do sea igual a la
longitud del √°rea de destino.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La petici√≥n todav√≠a no ha finaliza‚Äê
do.

RECORD

Output

ANY

I, Q, M, D, L

√Årea de destino para el registro le√≠do. Solo se
admite el tipo de datos BYTE .
Nota: Tenga en cuenta que en las CPUs
S7-300, el par√°metro RECORD siempre re‚Äê
quiere que se especifiquen por completo los
par√°metros de DB (ej.: P#DB13.DBX0.0 byte
100). En las CPUs S7-300 no est√° permitido
omitir un n√∫mero de DB expl√≠cito; de lo con‚Äê
trario se genera un aviso de error en el pro‚Äê
grama de usuario.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Consulte tambi√©n: PARM_MOD: Transferir registros de un m√≥dulo (P√°gina 6031).

PARM_MOD: Transferir registros de un m√≥dulo
Descripci√≥n
Con la instrucci√≥n "PARM_MOD" se transfieren al m√≥dulo todos los registros que se hayan
configurado. A este respecto es indiferente que los registros sean est√°ticos o din√°micos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6031

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PARM_MOD":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ= 1: solicitud de escritura

IOID

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificador del √°rea de direcciones:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse
la identificaci√≥n de √°rea de la direcci√≥n m√°s
baja. Si las direcciones son id√©nticas, debe in‚Äê
dicarse B#16#54.

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n base l√≥gica del m√≥dulo. Con un m√≥‚Äê
dulo mixto debe indicarse la direcci√≥n m√°s ba‚Äê
ja de las dos.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: la escritura todav√≠a no ha finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Informaci√≥n de error
Dentro de la informaci√≥n de error "verdadera" (c√≥digos de error W#16#8xyz), debe distinguirse
entre dos casos:
‚óè Errores temporales (c√≥digos de error de W#16#80A2 a 80A4, 80Cx):
En este tipo de errores es posible que el error se elimine sin intervenci√≥n del usuario, es
decir, puede bastar con llamar de nuevo la instrucci√≥n (varias veces si es necesario).
Ejemplo de error temporal: En este momento los recursos necesarios est√°n ocupados
(W#16#80C3).
‚óè Errores permanentes (c√≥digos de error W#16#809x, 80A1, 80Bx, 80Dx):
Los errores de este tipo no se pueden eliminar sin intervenci√≥n del usuario. Solo tiene
sentido volver a llamar la instrucci√≥n una vez que se haya eliminado el error.
Ejemplo de error permanente: Longitud err√≥nea del registro que se debe transferir
(W#16#80B1).
Nota
Si, usando una de las instrucciones WR_PARM, WR_DPARM o PARM_MOD, se
transfieren registros a un esclavo DPV1 o este funciona en modo DPV1, el maestro DP
eval√∫a de la siguiente manera la informaci√≥n de error recibida desde el esclavo:
Si la informaci√≥n de error se encuentra en las √°reas de W#16#8000 a W#16#80FF o de
W#16#F000 a W#16#FFFF, el maestro DP reenv√≠a la informaci√≥n de error a la instrucci√≥n.
Si se encuentra fuera de estas √°reas, reenv√≠a a la instrucci√≥n el valor W#16#80A2 y
suspende el esclavo.

6032

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Indicaciones para las instrucciones "RD_DPARM (P√°gina 6034)", "WR_PARM (P√°gina 6035)",
"WR_DPARM (P√°gina 6037)" y "PARM_MOD"

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

Restricci√≥n

(W#16#...)
0000

Ning√∫n error

-

7000

Primera llamada con REQ=0: No hay ninguna transferencia de datos
activa; BUSY tiene el valor 0.

-

7001

Primera llamada con REQ=1: Transmisi√≥n de datos iniciada; BUSY
tiene el valor "1".

Periferia descentralizada

7002

Llamada intermedia (REQ irrelevante): Transmisi√≥n de datos activa;
BUSY tiene el valor "1".

Periferia descentralizada

8090

La direcci√≥n base l√≥gica indicada no es v√°lida: No existe ninguna
asignaci√≥n en el SDB1/SDB2x, o no se trata de una direcci√≥n base.

-

8092

En la referencia ANY se ha indicado un tipo distinto a BYTE .

Solo con S7-400
para RD_DPARM (P√°gina 6034)
y WR_PARM (P√°gina 6035)

8093

Esta instrucci√≥n no es v√°lida para el m√≥dulo seleccionado con LADDR
e IOID. (Se soportan los m√≥dulos S7-300 en los S7-300, m√≥dulos
S7-400 en los S7-400, m√≥dulos S7-DP en los S7-300 y S7-400.)

-

80A1

Acuse negativo al enviar el juego de datos al m√≥dulo (m√≥dulo desen‚Äê
chufado durante la transferencia o defectuoso)

1)

80A2

Error de protocolo DP con Layer 2, posible error de hardware o interfaz Periferia descentralizada 1)
en el esclavo DP

80A3

Error de protocolo DP con User-Interface/User

Periferia descentralizada 1)

80A4

Fallo de comunicaci√≥n en el bus K

El error se produce entre la CPU
y una interfaz DP externa 1)

80B0

Instrucci√≥n no posible con este tipo de m√≥dulo, o el m√≥dulo no conoce
el registro.

1)

80B1

La longitud del registro que se debe transferir es err√≥nea.
Con RD_DPARM (P√°gina 6034): La longitud del √°rea de destino deli‚Äê
mitada por RECORD es insuficiente.

80B2

El slot configurado no est√° ocupado.

1)

80B3

El tipo de m√≥dulo real no coincide con el tipo de m√≥dulo configurado
en el SDB1

1)

80C1

Los datos de la petici√≥n de escritura efectuada anteriormente en el
m√≥dulo para el mismo registro no han sido procesados todav√≠a por el
m√≥dulo.

1)

80C2

En este momento el m√≥dulo est√° procesando el m√°ximo posible de
peticiones para una CPU.

1)

80C3

En este momento los recursos necesarios (memoria, etc.) est√°n ocu‚Äê
pados.

80C4

Error temporal interno. No se ha podido ejecutar la petici√≥n.

1)

Repita la petici√≥n. Si este error se produce a menudo, compruebe si
hay fuentes de perturbaci√≥n en la instalaci√≥n.
80C5

Periferia descentralizada no disponible o desactivada.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Periferia descentralizada 1)

6033

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

Restricci√≥n

80C6

La transferencia de juegos de datos se ha cancelado por una inte‚Äê
rrupci√≥n de la clase de prioridad (rearranque o segundo plano)

Periferia descentralizada 1)

80D0

En el SDB correspondiente no hay ninguna entrada para el m√≥dulo.

-

80D1

Este n√∫mero de registro no est√° configurado en el correspondiente
SDB para el m√≥dulo (se descartan los n√∫meros >241).

-

80D2

M√≥dulo no parametrizable seg√∫n la identificaci√≥n del m√≥dulo.

-

(W#16#...)

80D3

No se puede acceder al SDB porque no est√° presente.

-

80D4

Error de estructura del SDB: El puntero interno del SDB se√±ala fuera
del SDB

Solo con S7-300

80D5

El juego de datos es est√°tico.

Solo con "WR_PARM (P√°gi‚Äê
na 6035)"

8xyy

Informaci√≥n de error general

-

Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida
RET_VAL (P√°gina 174)
1)

no existe con "RD_DPARM"

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

RD_DPARM: Leer registro de los datos de sistema configurados
Descripci√≥n
Esta instrucci√≥n permite leer el registro con n√∫mero RECNUMdel m√≥dulo direccionado desde
los datos del sistema configurados. El registro le√≠do se guarda en el √°rea de destino delimitada
mediante el par√°metro RECORD.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RD_DPARM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IOID

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificador del √°rea de direcciones:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse
la identificaci√≥n de √°rea de la direcci√≥n m√°s
baja. Si se trata de las mismas direcciones,
debe indicarse B#16#54.

LADDR

6034

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n base l√≥gica del m√≥dulo. Con un m√≥‚Äê
dulo mixto debe indicarse la direcci√≥n m√°s ba‚Äê
ja de las dos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RECNUM

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de registro (valores admisibles: de 0 a
240)

RET_VAL

Return

INT

I, Q, M, D, L

Longitud en bytes del registro le√≠do, si el regis‚Äê
tro le√≠do cabe en el √°rea de destino y no se ha
producido ning√∫n error durante la transferen‚Äê
cia.
Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

RECORD

Output

ANY

I, Q, M, D, L

√Årea de destino para el registro le√≠do. Solo se
admite el tipo de datos BYTE .

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Consulte tambi√©n: PARM_MOD: Transferir registros de un m√≥dulo (P√°gina 6031).

WR_PARM: Escribir registro de un m√≥dulo
Descripci√≥n
Esta instrucci√≥n permite transferir el registro RECORD al m√≥dulo direccionado. Los
par√°metros que se transfieren al m√≥dulo no sobrescriben los par√°metros creados mediante
configuraci√≥n.

Requisitos
El registro que se va a transferir no debe ser est√°tico. Para saber qu√© registros de un m√≥dulo
son est√°ticos, consulte la descripci√≥n del m√≥dulo.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WR_PARM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: Solicitud de escritura

IOID

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificador del √°rea de direcciones:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse la
identificaci√≥n de √°rea de la direcci√≥n m√°s baja. Si
se trata de las mismas direcciones, debe indicar‚Äê
se B#16#54.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6035

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n base l√≥gica del m√≥dulo. Con un m√≥du‚Äê
lo mixto debe indicarse la direcci√≥n m√°s baja de
las dos.

RECNUM

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de registro

RECORD

Input

ANY

I, Q, M, D, L

Registro
Nota: Tenga en cuenta que en las CPUs S7-300,
el par√°metro RECORD siempre requiere que se
especifiquen por completo los par√°metros de DB
(ej.: P#DB13.DBX0.0 byte 100). En las CPUs
S7-300 no est√° permitido omitir un n√∫mero de DB
expl√≠cito; de lo contrario se genera un aviso de
error en el programa de usuario.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° un
c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La escritura todav√≠a no ha finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RECORD
Los datos que se deben transferir se leen del par√°metro RECORD en la primera llamada. Si la
transferencia del registro dura m√°s que una llamada, en las llamadas consecutivas de la
instrucci√≥n (para la misma petici√≥n), el contenido del par√°metro RECORD ya no es relevante.

Par√°metro RET_VAL
Consulte tambi√©n: PARM_MOD: Transferir registros de un m√≥dulo (P√°gina 6031).
Nota
Solo con S7-400
Si aparece el error general W#16#8544, esto solo significa que estaba bloqueado el acceso a
por lo menos un byte del √°rea de memoria de E/S que contiene el registro. Se ha proseguido
la transferencia de datos.

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

6036

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

WR_DPARM: Transferir registro
Descripci√≥n
Esta instrucci√≥n permite transferir el registro con n√∫mero RECNUM desde los datos de
configuraci√≥n al m√≥dulo direccionado. A este respecto es indiferente que el registro sea
est√°tico o din√°mico.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WR_DPARM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: Solicitud de escritura

IOID

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Identificador del √°rea de direcciones:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indicarse
la identificaci√≥n de √°rea de la direcci√≥n m√°s
baja. Si se trata de las mismas direcciones,
debe indicarse B#16#54.

LADDR

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Direcci√≥n base l√≥gica del m√≥dulo. Con un m√≥‚Äê
dulo mixto debe indicarse la direcci√≥n m√°s ba‚Äê
ja de las dos.

RECNUM

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de registro

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La escritura todav√≠a no ha finaliza‚Äê
do.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Consulte tambi√©n: PARM_MOD: Transferir registros de un m√≥dulo (P√°gina 6031).

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6037

Instrucciones
4.2 Instrucciones

4.2.3.7

Alarmas

Alarma horaria
Usar las instrucciones SET_TINT, CAN_TINT, ACT_TINT, QRY_TINT
Definici√≥n
Una alarma horaria es el desencadenante de la llamada controlada por reloj de un OB de
alarma horaria.

Requisitos para la llamada
Para que el sistema operativo pueda llamar un OB de alarma horaria, deben cumplirse los
siguientes requisitos:
‚óè El OB de alarma horaria debe estar parametrizado (fecha y hora de inicio, ejecuci√≥n)
‚Äì Mediante configuraci√≥n o
‚Äì con la instrucci√≥n "SET_TINT (P√°gina 6040)" en el programa de usuario.
‚óè El OB de alarma horaria debe estar activado
‚Äì Mediante configuraci√≥n o
‚Äì con la instrucci√≥n "ACT_TINT (P√°gina 6042)" en el programa de usuario.
‚óè El OB de alarma horaria no debe haber sido desactivado mediante configuraci√≥n.
‚óè El OB de alarma horaria debe estar presente en la CPU.
‚óè Si el ajuste se realiza mediante la instrucci√≥n "ACT_TINT (P√°gina 6042)", la fecha y hora de
inicio, en caso de ejecuci√≥n √∫nica, no deben haber transcurrido; en caso de
ejecuci√≥n peri√≥dica, el OB de alarma horaria debe llamarse durante el pr√≥ximo periodo
transcurrido (momento de arranque + m√∫ltiplo de la duraci√≥n del periodo).
Nota
La alarma horaria puede parametrizarse con la herramienta de configuraci√≥n y activarse en
el programa de usuario ("ACT_TINT (P√°gina 6042)").

Finalidad de las instrucciones "SET_TINT", "CAN_TINT", "ACT_TINT" y "QRY_TINT"
Con estas instrucciones, las alarmas horarias se pueden
‚óè Ajustar ("SET_TINT (P√°gina 6040)")
‚óè Anular ("CAN_TINT (P√°gina 6041)")
‚óè Activar ("ACT_TINT (P√°gina 6042)")
‚óè Consultar ("QRY_TINT (P√°gina 6043)")

6038

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Repercusiones en la alarma horaria
La tabla siguiente muestra qu√© efectos producen las distintas situaciones en las alarmas
horarias.
Si ...

entonces ...

se cambia el ajuste de una alarma
horaria

Se anula autom√°ticamente la alarma horaria en curso.

(Llamada de "SET_TINT (P√°gi‚Äê
na 6040)"),
Se anula la alarma horaria
(Llamada de "CAN_TINT (P√°gi‚Äê
na 6041)"),

Se borran la fecha y hora de inicio. Por ello la alarma horaria
debe reajustarse antes de poder activarla.

El OB de alarma horaria no est√° pre‚Äê Se genera autom√°ticamente un error de clase de prioridad, es
sente en el momento de la llamada, decir, el sistema operativo llama el OB 85.
Si el OB 85 no est√° presente, la CPU pasa al estado operativo
STOP.
Se sincroniza el reloj o se adelanta la
hora

Si al adelantar la hora se salta la fecha u hora de inicio:
‚óè El sistema operativo llama el OB 80.1
‚óè A continuaci√≥n del OB 80 se llaman todos los OBs de
alarma horaria (una sola vez, sea cual sea el n√∫mero de
periodos saltados), en caso de que no hayan sido
manipulados en el OB 80.2
Si el OB 80 no est√° presente, la CPU pasa al estado operativo
STOP.

Se sincroniza el reloj o se atrasa la
hora

CPUs S7-400 y CPU 318:
Si se han llamado OBs de alarma horaria en el periodo atrasa‚Äê
do, no se llaman de nuevo al volver a recorrerse ese tiempo.
CPUs S7-300: Se ejecutan todos los OBs de alarma horaria
afectados.

1
En la informaci√≥n de evento de arranque del OB 80 se indica de forma cifrada qu√© OBs de alarma
horaria no se han podido llamar debido al adelanto de la hora. La hora indicada en la informaci√≥n de
evento de arranque equivale al tiempo adelantado.
2
La hora indicada en la informaci√≥n de evento de arranque del OB de alarma horaria recuperado
corresponde a la hora de inicio de la primera alarma horaria saltada.

Comportamiento en rearranque completo (en caliente) o arranque en fr√≠o
En caso de rearranque completo (en caliente) o arranque en fr√≠o, se borran todos los ajustes
de alarma horaria especificados en el programa de usuario mediante instrucciones. A partir de
entonces solo son efectivos los par√°metros ajustados por configuraci√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6039

Instrucciones
4.2 Instrucciones

Ejecuci√≥n del OB de alarma horaria
La tabla siguiente muestra los distintos efectos del par√°metro "Ejecuci√≥n". Este par√°metro se
ajusta mediante configuraci√≥n o con la instrucci√≥n "SET_TINT (P√°gina 6040)" (par√°metro de
entrada PERIOD).
Ejecuci√≥n del OB de alarma horaria

Reacci√≥n

Ninguna

El OB de alarma horaria no se ejecuta aunque est√© presente en
la CPU.

(Ajustable solo mediante configura‚Äê
ci√≥n)

En el programa de usuario es posible reparametrizar, es decir,
ajustar la alarma horaria ("SET_TINT (P√°gina 6040)").

Una sola vez

Despu√©s de la llamada al OB de alarma horaria, la alarma que‚Äê
da anulada y puede reajustarse y activarse.

Peri√≥dicamente

Si, en el momento de la activaci√≥n, la fecha y hora de inicio ya
han transcurrido, el OB de alarma horaria interrumpe el pro‚Äê
grama c√≠clico en el momento "Fecha/hora de inicio + m√∫ltiplo de
la duraci√≥n ajustada del periodo".

(Cada minuto, cada hora, cada d√≠a,
cada semana, cada mes, cada a√±o)

Puede suceder, aunque es muy infrecuente, que el OB de alar‚Äê
ma horaria todav√≠a est√© proces√°ndose cuando se produce la
siguiente llamada.
Consecuencia:
‚óè Error de tiempo (el sistema operativo llama el OB 80; si el
OB 80 no est√° presente, la CPU pasa al estado operativo
STOP)
‚óè Se corrige el OB de alarma horaria.

SET_TINT: Ajustar alarma horaria
Descripci√≥n
Esta instrucci√≥n permite ajustar la fecha y hora de arranque de los bloques de organizaci√≥n de
alarma horaria. Si al fijar la hora de inicio se indican segundos y milisegundos, la indicaci√≥n se
ignora y se sustituye por "0".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SET_TINT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OB_NR

Input

INT

I, Q, M, D, L o cons‚Äê
tante

N√∫mero del OB que se inicia en el momento
SDT + m√∫ltiplo de PERIOD (OB 10 a OB 17).

SDT

Input

DT

D, L

Si al fijar la fecha y hora de arranque se indican
segundos y milisegundos, la indicaci√≥n se ig‚Äê
nora y se sustituye por 0.
Si se desea fijar el arranque mensual de un OB
de alarma horaria, solo pueden usarse para la
fecha de inicio los d√≠as 1, 2, ... 28.

6040

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PERIOD

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Per√≠odo transcurrido desde el punto de salida
SDT :
‚óè W#16#0000 = Una vez
‚óè W#16#0201 = Una vez por minuto
‚óè W#16#0401 = Una vez por hora
‚óè W#16#1001 = Una vez al d√≠a
‚óè W#16#1201 = Una vez por semana
‚óè W#16#1401 = Una vez al mes
‚óè W#16#1801 = Una vez al a√±o
‚óè W#16#2001 = A final de mes

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el par√°metro actual de
RET_VAL contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Par√°metro err√≥neo OB_NR

8091

Par√°metro err√≥neo SDT

8092

Par√°metro err√≥neo PERIOD

80A1

El momento inicial ajustado se encuentra en el pasado. (Este c√≥digo de error solo aparece con PERIOD
= W#16#0000.)

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

CAN_TINT: Anular alarma horaria
Descripci√≥n
La instrucci√≥n permite borrar la fecha y hora de inicio de un bloque de organizaci√≥n de alarma
horaria. La alarma horaria se desactiva y el bloque de organizaci√≥n ya no se llama.
Para volver a utilizar la alarma horaria, vuelva a ajustar primero el momento de inicio
(instrucci√≥n "SET_TINT (P√°gina 6040)") y, despu√©s, active la alarma horaria (instrucci√≥n
"ACT_TINT (P√°gina 6042)").

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6041

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CAN_TINT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero del OB cuya fecha y hora de ini‚Äê
cio se deben borrar (OB 10 a OB 17).

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecu‚Äê
ci√≥n de la instrucci√≥n, el par√°metro actual
de RET_VAL contendr√° un c√≥digo de
error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Par√°metro err√≥neo OB_NR

80A0

No se ha establecido ninguna fecha/hora de inicio para el OB de alarma horaria correspondiente.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

ACT_TINT: Activar alarma horaria
Descripci√≥n
La instrucci√≥n permite activar un bloque de organizaci√≥n de alarma horaria.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ACT_TINT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero del OB que se debe activar
(OB 10 a OB 17).

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecu‚Äê
ci√≥n de la instrucci√≥n, el par√°metro actual
de RET_VAL contendr√° un c√≥digo de
error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6042

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Par√°metro err√≥neo OB_NR

80A0

No se ha ajustado ninguna fecha/hora de inicio para el OB de alarma horaria en cuesti√≥n.

80A1

El momento activado se encuentra en el pasado, y el error solo se produce si Ejecuci√≥n=una sola vez.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

QRY_TINT: Consultar estado de alarma horaria
Descripci√≥n
La instrucci√≥n muestra el estado de un bloque de organizaci√≥n de alarma horaria en el
par√°metro de salida STATUS .

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "QRY_TINT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero del OB cuyo estado se consulta
(OB 10 a OB 17).

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecu‚Äê
ci√≥n de la instrucci√≥n, el par√°metro actual
de RET_VAL contendr√° un c√≥digo de
error.

STATUS

Output

WORD

I, Q, M, D, L

Estado de la alarma horaria; v√©ase la si‚Äê
guiente tabla.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro STATUS
Nota
Si RET_VAL tiene un valor diferente de cero, no se puede evaluar STATUS.

Bit

Valor

Significado

0

0

En RUN.

1

Durante el arranque.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6043

Instrucciones
4.2 Instrucciones
Bit

Valor

Significado

1

0

La alarma horaria est√° habilitada.

1

La alarma horaria est√° bloqueada mediante "DIS_IRT (P√°gina 6059)".

0

La alarma horaria no est√° activada o ha expirado.

1

La alarma horaria est√° activada.

0

El OB con el n√∫mero de OB indicado en el par√°metro OB_NR no existe.

1

El OB con el n√∫mero de OB indicado en el par√°metro OB_NR existe.

2
4
Otros

Siempre "0"

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Par√°metro err√≥neo OB_NR

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Alarma de retardo
Usar alarmas de retardo
Definici√≥n
Despu√©s de llamar la instrucci√≥n "SRT_DINT (P√°gina 6046)", el sistema operativo genera una
alarma una vez transcurrido el tiempo de retardo parametrizado. A continuaci√≥n se llama el OB
de alarma de retardo parametrizado.

Requisitos para la llamada
Para que el sistema operativo pueda llamar un OB de alarma de retardo, deben cumplirse los
siguientes requisitos:
‚óè El OB de alarma de retardo debe haber sido activado mediante la instrucci√≥n "SRT_DINT
(P√°gina 6046)".
‚óè El OB de alarma de retardo no debe haber sido desactivado mediante configuraci√≥n.
‚óè El OB de alarma de retardo debe estar presente en la CPU.

6044

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Finalidad de las instrucciones "SRT_DINT", "CAN_DINT" y "QRY_DINT"
Con estas instrucciones, las alarmas de retardo se pueden
‚óè Iniciar ("SRT_DINT (P√°gina 6046)")
‚óè Anular ("CAN_DINT (P√°gina 6047)")
‚óè Consultar ("QRY_DINT (P√°gina 6047)").

Repercusiones en la alarma de retardo
La tabla siguiente muestra qu√© efectos producen las distintas situaciones en las alarmas de
retardo.
Si ...

y ...

Se inicia una alarma de re‚Äê La alarma de retardo ya se
tardo (llamada de
ha iniciado,
"SRT_DINT (P√°gina 6046)")
El OB de alarma de retardo
no est√° presente en el mo‚Äê
mento de la llamada,

entonces ...
Se sobrescribe la alarma de retardo; se
inicia de nuevo la alarma de retardo.
Se efect√∫a una entrada en el b√∫fer de
diagn√≥stico y la CPU contin√∫a funcionan‚Äê
do.

Se ha iniciado la alarma en La llamada al OB de alarma de retardo se
un OB de arranque y el tiem‚Äê pospone hasta que la CPU est√© en RUN.
po de retardo expira antes
de que la CPU est√© en RUN,
El tiempo de retardo ha
transcurrido

Un OB de alarma de retardo
iniciado anteriormente toda‚Äê
v√≠a est√° proces√°ndose,

El sistema operativo genera un error de
tiempo (llamada del OB 80; si el OB 80 no
est√° presente, la CPU contin√∫a funcio‚Äê
nando).

Comportamiento en rearranque completo (en caliente) o arranque en fr√≠o
En rearranque completo (en caliente) o arranque en fr√≠o, se borran todos los ajustes de alarma
de retardo especificados en el programa de usuario mediante instrucciones.

Inicio en un OB de arranque
Una alarma de retardo puede iniciarse en un OB de arranque. Para llamar el OB de alarma de
retardo deben cumplirse dos condiciones:
‚óè El tiempo de retardo ha expirado.
‚óè La CPU est√° en el estado operativo RUN.
Si el tiempo de retardo ha expirado y la CPU todav√≠a no se encuentra en el estado operativo
RUN, la llamada del OB de alarma de retardo se pospone hasta que la CPU se encuentre en
dicho estado operativo. Tras ello, el OB de alarma de retardo se llama antes de la primera
instrucci√≥n en el OB Main [OB 1].

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6045

Instrucciones
4.2 Instrucciones

SRT_DINT: Iniciar alarma de retardo
Descripci√≥n
Esta instrucci√≥n permite iniciar una alarma de retardo que, una vez transcurrido el retardo
parametrizado (par√°metro DTIME), llama un OB de alarma de retardo.
En el par√°metro SIGN se puede indicar un identificador espec√≠fico de usuario para se√±alizar el
inicio de la alarma de retardo. Los valores de DTIME y SIGN vuelven a aparecer en la
informaci√≥n de evento de arranque del OB indicado cuando este se ejecuta.
El tiempo transcurrido entre la llamada de la instrucci√≥n "SRT_DINT" y el inicio del OB de
alarma de retardo es como m√°ximo un milisegundo menor que el tiempo parametrizado,
siempre que la llamada no se retrase debido a eventos de interrupci√≥n.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SRT_DINT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero del OB que se inicia una vez trans‚Äê
currido un tiempo de retardo (OB 20 a
OB 23).

DTIME

Input

TIME

I, Q, M, D, L o constante Valor de tiempo del retardo (de 1 a 60000
ms)
Pueden implementarse tiempos mayores, p.
ej. utilizando un contador en un OB de alar‚Äê
ma de retardo.

SIGN

Input

WORD

I, Q, M, D, L o constante Identificaci√≥n que aparece en la informaci√≥n
de evento de arranque al llamar el OB de
alarma de retardo

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el par√°metro actual de
RET_VAL contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error
(W#16#...)

Descripci√≥n

0000

No ha ocurrido ning√∫n error.

8090

Par√°metro err√≥neo OB_NR

8091

Par√°metro err√≥neo DTIME

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

6046

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CAN_DINT: Anular alarma de retardo
Descripci√≥n
Esta instrucci√≥n permite anular una alarma de retardo iniciada (ver "SRT_DINT
(P√°gina 6046)"). En tal caso, no se llama el OB de alarma de retardo.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CAN_DINT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero del OB que se debe anular (OB 20
a OB 23).

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el par√°metro actual de
RET_VAL contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Par√°metro err√≥neo OB_NR

80A0

No se ha iniciado la alarma de retardo.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

QRY_DINT: Consultar estado de una alarma de retardo
Descripci√≥n
Esta instrucci√≥n permite consultar el estado de una alarma de retardo. Las alarmas de retardo
se administran con los bloques de organizaci√≥n OB 20 a OB 23.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6047

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "QRY_DINT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero del OB cuyo estado se desea co‚Äê
nocer (OB 20 a OB 23).

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el par√°metro actual de
RET_VAL contendr√° un c√≥digo de error.

STATUS

Output

WORD

I, Q, M, D, L

Estado de la alarma de retardo; v√©ase la si‚Äê
guiente tabla.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro STATUS
Nota
Si RET_VAL tiene un valor diferente de cero, no se puede evaluar STATUS.

Bit

Valor

Significado

0

0

En RUN.

1

Durante el arranque.

0

La alarma de retardo est√° habilitada.

1

La alarma de retardo est√° bloqueada mediante "DIS_IRT (P√°gina 6059)".

1
2
4

0

La alarma de retardo no est√° activada o ya ha caducado.

1

La alarma de retardo est√° activada.

0

El OB con el n√∫mero de OB indicado en el par√°metro OB_NR no existe.

1

Est√° cargado un OB con el n√∫mero de OB especificado en el par√°metro OB_NR.

Otros

Siempre "0"

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

Par√°metro err√≥neo OB_NR

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

6048

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Eventos de errores sincr√≥nicos
Enmascarar eventos de errores sincr√≥nicos
Introducci√≥n
Los eventos de errores sincr√≥nicos son eventos de error de programaci√≥n y acceso. Estos
eventos de error se producen cuando se emplean en la programaci√≥n √°reas o n√∫meros de
operando err√≥neos o direcciones err√≥neas. Enmascarar estos eventos de error significa lo
siguiente:
‚óè Los eventos de error enmascarados no desencadenan ning√∫n OB de error y no provocan
ninguna reacci√≥n sustitutiva.
‚óè La CPU "anota" en un registro de estado de eventos los errores enmascarados que se han
producido.
Para enmascarar errores se debe llamar la instrucci√≥n "MSK_FLT (P√°gina 6055)".
Desenmascarar eventos de error significa anular un enmascaramiento efectuado
anteriormente y borrar el bit correspondiente en el registro de estado de eventos de la clase de
prioridad actual. El enmascaramiento se anula
‚óè Llamando la instrucci√≥n "DMSK_FLT (P√°gina 6056)".
‚óè Cuando ha finalizado la clase de prioridad actual (solo con S7-400).
Si se produce un evento de error despu√©s de ser desenmascarado, el sistema operativo inicia
el correspondiente OB de error. Para la reacci√≥n a errores de programaci√≥n, debe
programarse el OB 121, y para la reacci√≥n a errores de acceso, el OB 122.
Los eventos de error enmascarados y detectados se pueden leer con la instrucci√≥n
"READ_ERR (P√°gina 6057)".
Nota
Independientemente de que est√©n enmascarados o desenmascarados, con S7-300
(exceptuando la CPU 318) los eventos de error se registran en el b√∫fer de diagn√≥stico y se
enciende el LED de error de grupo de la CPU.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6049

Instrucciones
4.2 Instrucciones

Tratamiento de errores en general
Cuando se producen errores de programaci√≥n o acceso en un programa de usuario, puede
reaccionarse ante ello de diferentes maneras:
‚óè Se puede programar un OB de error, que el sistema operativo llamar√° cuando se produzca
un evento de error relevante.
‚óè Se puede bloquear la llamada al OB de error por separado para cada clase de prioridad. En
tal caso, la CPU no pasa a STOP cuando se produce un error relevante en la clase de
prioridad bloqueada. La CPU guarda en un registro de estado de eventos los errores que
se producen. Sin embargo, esta entrada en el registro no permite saber cu√°ndo y cu√°ntas
veces se ha producido el error en cuesti√≥n.
(YHQWRGHHUURUV¬ØQFURQR

1R

¬Å(UURUHQPDVFDUDGR"

6¬Ø

/ODPDGDGHXQ2%GH
HUURU 6LHO2%GHHUURUQR
HVW¬£SURJUDPDGROD&38
SDVDD6723

%ORTXHRGHODOODPDGDGH
XQ2%GHHUURU 6LVH
SURGXFHXQHUURUOD&38
QRSDVDD6723

(QHO2%HVW¬£SURJUDPD
GDODUHDFFL¬µQGHVHDGD
DQWHXQHUURU

(QHOUHJLVWURGHHVWDGR
GHHYHQWRVVHLQWURGXFH
XQHYHQWRGHHUURU

M√°scara de error
Los eventos de errores sincr√≥nicos est√°n asignados a un determinado patr√≥n de bits,
la m√°scara de error. Esta m√°scara de error se reproduce tambi√©n en los par√°metros de entrada
y salida de las instrucciones "MSK_FLT (P√°gina 6055)", "DMSK_FLT (P√°gina 6056)" y
"READ_ERR (P√°gina 6057)".
En los eventos de errores sincr√≥nicos se distingue entre los errores de programaci√≥n y los de
acceso, que pueden enmascararse con dos m√°scaras de error distintas. Encontrar√° las
correspondientes m√°scaras de error en las siguientes im√°genes.

6050

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

M√°scara de error de programaci√≥n
La siguiente imagen muestra el patr√≥n de bits de la m√°scara de error para errores de
programaci√≥n. La m√°scara para errores de programaci√≥n se encuentra en los par√°metros
"PRGFLT_..." (ver a continuaci√≥n "Error de programaci√≥n, palabra menos significativa" o "Error
de programaci√≥n, palabra m√°s significativa").

3DODEUDPHQRV ; ; ; ; ; ;
VLJQLILFDWLYD

 1|GHELW

 

;
(UURUGHFRQYHUVL¬µQ%&'
(UURUGHORQJLWXGGH¬£UHDDOOHHU
(UURUGHORQJLWXGGH¬£UHDDOHVFULELU
(UURUGH¬£UHDDOOHHU
(UURUGH¬£UHDDOHVFULELU
(UURUGHQ¬ºPHURGHWHPSRUL]DGRU
(UURUGHQ¬ºPHURGHFRQWDGRU
(UURUGHDOLQHDFL¬µQDOOHHU
(UURUGHDOLQHDFL¬µQDOHVFULELU





3DODEUDP¬£V
VLJQLILFDWLYD

 1|GHELW

; ; ; ;

;

(UURUGHHVFULWXUDEORTXHGHGDWRV
(UURUGHGDWRVEORTXHGHGDWRVGHLQVWDQFLD
(UURUGHQ¬ºPHURGHEORTXH'%
(UURUGHQ¬ºPHURGHEORTXH',
(UURUGHQ¬ºPHURGHEORTXH)&
(UURUGHQ¬ºPHURGHEORTXH)%
'%QRFDUJDGR
)&QRFDUJDGR
6)&QRFDUJDGR
)%QRFDUJDGR
6)%QRFDUJDGR
/H\HQGD

; 1RUHOHYDQWH

Bits no relevantes
En la imagen superior, x significa para los ...
‚óè ... Par√°metros de entrada

para "MSK_FLT (P√°gina 6055)", "DMSK_FLT (P√°gi‚Äê
na 6056)", "READ_ERR (P√°gina 6057)"

= "0"

‚óè ... Par√°metros de salida

para "MSK_FLT (P√°gina 6055)", "DMSK_FLT (P√°gi‚Äê
na 6056)"

= "1" para S7-300

para "READ_ERR (P√°gina 6057)"

= "0"

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

= "0" para S7-400

6051

Instrucciones
4.2 Instrucciones

M√°scara de error de acceso para todas las CPUs
La siguiente imagen muestra el patr√≥n de bits de la m√°scara para errores de acceso (para
todas las CPUs). La m√°scara de errores de acceso se encuentra en los par√°metros
ACCFLT_...
En las tablas siguientes encontrar√° una explicaci√≥n de los errores de acceso (v√©anse a
continuaci√≥n).

 
3DODEUD
; ; ; ; ; ; ; ; ; ; ; ;
PHQRV
VLJQLILFDWLYD

 1|GHELW
; ;
(UURUGHDFFHVRDODSHULIHULDDOOHHU
(UURUGHDFFHVRDODSHULIHULDDOHVFULELU



 1|GHELW
3DODEUD
P¬£V
; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ;
VLJQLILFDWLYD

/H\HQGD

; LUUHOHYDQWH

Ejemplo
La siguiente imagen muestra el aspecto de la palabra menos significativa de la m√°scara para
errores de acceso con todos los errores enmascarados (para todas las CPUs).
‚óè Como par√°metro de entrada para "MSK_FLT (P√°gina 6055)"
‚óè Como par√°metro de salida para "MSK_FLT (P√°gina 6055)"
3DU¬£PHWUR
GHHQWUDGD



 

 1|GHELW

               
(UURUHVHQPDVFDUDGRV


3DU¬£PHWUR
GHVDOLGD

/H\HQGD

6052

 

 1|GHELW

; ; ; ; ; ; ; ; ; ; ; ;   ; ;
(UURUHVHQPDVFDUDGRV

;

1RUHOHYDQWH



1RHQPDVFDUDGRV



(QPDVFDUDGRV

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Error de programaci√≥n, palabra menos significativa
La tabla siguiente contiene los errores que est√°n asignados a la palabra menos significativa de
la m√°scara para errores de programaci√≥n. Los distintos errores se muestran emparejados con
sus posibles causas.
Posibles causas de errores de programaci√≥n, palabra menos significativa
Error

ID de evento
(W#16#...)

El error se produce ...

BCD - Error de conversi√≥n

2521

... Cuando el error que se debe convertir no es un n√∫‚Äê
mero BCD (p. ej. 5E8).

Error de longitud de √°rea
durante lectura

2522

... Cuando un operando direccionado no se encuentra
por completo dentro del √°rea de operandos posible.
Ejemplo: Debe leerse MW 320, aunque el √°rea de mar‚Äê
ca solo ocupa 256 bytes.

Error de longitud de √°rea
durante escritura

2523

... Cuando un operando direccionado no se encuentra
por completo dentro del √°rea de operandos posible.
Ejemplo: Debe escribirse un valor en MW 320, aunque
el √°rea de marca solo ocupa 256 bytes.

Error de √°rea durante lectu‚Äê 2524
ra

... Cuando, en un direccionamiento indirecto, abarcando
varias √°reas, se especifica una identificaci√≥n de √°rea
err√≥nea para el operando.
Ejemplo:
Correcto: LAR1 P#E 12.0
L W[AR1, P#0.0]
Err√≥neo: LAR1 P#12.0
L W[AR1, P#0.0] Con esta operaci√≥n
se notifica el error de √°rea.

Error de √°rea durante escri‚Äê 2525
tura

... Cuando, en un direccionamiento indirecto, abarcando
varias √°reas, se especifica una identificaci√≥n de √°rea
err√≥nea para el operando.
Ejemplo:
Correcto: LAR1 P#E 12.0
T W[AR1, P#0.0]
Err√≥neo: LAR1 P#12.0
T W[AR1, P#0.0] Con esta operaci√≥n
se notifica el error de √°rea.

Error de n√∫mero de tempo‚Äê
rizador

2526

Error de n√∫mero de conta‚Äê
dor

2527

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

... Cuando se accede a un temporizador no existente.
Ejemplo:SI T [MW 0] con MW 0 = 129; se solicita iniciar
el temporizador 129 aunque solo existen 128 tempori‚Äê
zadores.
... Cuando se accede a un contador no existente.
Ejemplo: ZV Z [MW 0] con MW 0 = 600; se accede al
contador 600, a pesar de que solo existen 512 contado‚Äê
res (CPU 416-1).

6053

Instrucciones
4.2 Instrucciones
Error

ID de evento
(W#16#...)

El error se produce ...

Error de alineaci√≥n durante
lectura

2528

... Cuando se direcciona un operando de byte, palabra o
palabra doble con una direcci√≥n de bit ‚â† 0.
Ejemplo: Correcto: LAR1 P#M12.0
L B[AR1, P#0.0]
Err√≥neo: LAR1 P#M12.4
L B[AR1, P#0.0]

Error de alineaci√≥n durante
escritura

2529

... Cuando se direcciona un operando de byte, palabra o
palabra doble con una direcci√≥n de bit ‚â† 0.
Ejemplo:
Correcto: LAR1 P#M12.0
T B[AR1, P#0.0]
Err√≥neo: LAR1 P#M12.4
T B[AR1, P#0.0]

Error de programaci√≥n, palabra m√°s significativa
La tabla siguiente contiene los errores que est√°n asignados a la palabra m√°s significativa de
la m√°scara para errores de programaci√≥n. Los distintos errores se muestran emparejados con
sus posibles causas.
Posibles causas de errores de programaci√≥n, palabra m√°s significativa

6054

Error

ID de evento
(W#16#...)

El error se produce ...

Error de escritura bloque de
datos

2530

... Cuando el bloque de datos en el que se escribe
est√° protegido contra escritura.

Error de datos bloque de da‚Äê
tos de instancia

2531

... Cuando el bloque de datos de instancia en el que
se escribe est√° protegido contra escritura.

Error de n√∫mero de bloque DB 2532

... Cuando se abre un bloque de datos cuyo n√∫mero
es mayor que el n√∫mero m√°ximo admisible.

Error de n√∫mero de bloque DI 2533

... Cuando se abre un bloque de datos de instancia
cuyo n√∫mero es mayor que el n√∫mero m√°ximo admi‚Äê
sible.

Error de n√∫meros de bloque
FC

2534

... Cuando se llama una funci√≥n cuyo n√∫mero es ma‚Äê
yor que el n√∫mero m√°ximo admisible.

Error de n√∫mero de bloque FB 2535

... Cuando se llama un bloque de funci√≥n cuyo n√∫me‚Äê
ro es mayor que el n√∫mero m√°ximo admisible.

DB no cargado

253A

... Cuando el bloque de datos que se desea abrir no
est√° cargado.

Instrucci√≥n no cargada

253C a 253F

... Cuando la instrucci√≥n que se desea llamar no est√°
cargada.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Error de acceso
La tabla siguiente contiene todos los errores que est√°n asignados a la m√°scara de errores para
errores de acceso (para todas las CPUs). Los distintos errores se muestran emparejados con
sus posibles causas.
Error

ID de evento
(W#16#...)

El error se produce ...

Error de acceso a la periferia
al leer

2942

... Cuando la direcci√≥n del √°rea de periferia no tiene
asignado ning√∫n m√≥dulo de se√±al.
O bien
... Cuando el acceso a dicha √°rea de periferia no se
acusa dentro del tiempo de vigilancia de m√≥dulo ajus‚Äê
tado (retardo de acuse).

Error de acceso a periferia al
escribir

2943

... Cuando la direcci√≥n del √°rea de periferia no tiene
asignado ning√∫n m√≥dulo de se√±al.
o
... Cuando el acceso a dicha √°rea de periferia no se
acusa dentro del tiempo de vigilancia de m√≥dulo ajus‚Äê
tado (retardo de acuse).

MSK_FLT: Enmascarar eventos de error s√≠ncrono
Descripci√≥n
Esta instrucci√≥n permite controlar la reacci√≥n de la CPU ante eventos de errores sincr√≥nicos.
Para ello se enmascaran los correspondientes eventos de errores sincr√≥nicos (para las
m√°scaras de error, ver Enmascarar eventos de errores sincr√≥nicos (P√°gina 6049)). Llamando
a "MSK_FLT" se enmascaran los eventos de errores sincr√≥nicos en la clase de prioridad actual.
Si en los par√°metros de entrada se ajustan a "1" algunos bits de las m√°scaras de errores
sincr√≥nicos, los otros bits, ya ajustados anteriormente, mantienen el valor "1". As√≠ se obtienen
nuevas m√°scaras de error que pueden leerse a trav√©s de los par√°metros de salida. Los
eventos de errores sincr√≥nicos enmascarados por el usuario no llaman ning√∫n OB, sino que
√∫nicamente se consignan en un registro de estado de eventos. El registro de estado de
eventos puede leerse con la instrucci√≥n "READ_ERR (P√°gina 6057)".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "MSK_FLT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

PRGFLT_SET_MASK

Input

DWORD

I, Q, M, D, L o constante Errores de programaci√≥n que de‚Äê
ben enmascararse

ACCFLT_SET_MASK

Input

DWORD

I, Q, M, D, L o constante Errores de acceso que deben en‚Äê
mascararse

RET_VAL

Return

INT

I, Q, M, D, L

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Descripci√≥n

Informaci√≥n de error

6055

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PRGFLT_MASKED

Output

DWORD

I, Q, M, D, L

Errores de programaci√≥n enmas‚Äê
carados

ACCFLT_MASKED

Output

DWORD

I, Q, M, D, L

Errores de acceso enmascarados

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

Ninguno de los errores estaba ya enmascarado.

0001

Por lo menos uno de los errores estaba ya enmascarado; pese a ello se enmascaran los otros errores.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

DMSK_FLT: Desenmascarar eventos de error s√≠ncrono
Descripci√≥n
Esta instrucci√≥n se utiliza para desenmascarar los eventos de error enmascarados con
"MSK_FLT (P√°gina 6055)". Para ello deben ajustarse a "1" en los par√°metros de entrada los
bits correspondientes de las m√°scaras de error. Llamando a "DMSK_FLT" se desenmascaran
los correspondientes eventos de errores sincr√≥nicos de la clase de prioridad actual. Al mismo
tiempo se borran las entradas consultadas en el registro de estado de eventos. Las nuevas
m√°scaras de error pueden leerse a trav√©s de los par√°metros de salida.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DMSK_FLT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PRGFLT_
RESET_MASK

Input

DWORD

I, Q, M, D, L o constante Errores de programaci√≥n que deben
desenmascararse

ACCFLT_
RESET_MASK

Input

DWORD

I, Q, M, D, L o constante Errores de acceso que deben desen‚Äê
mascararse

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

PRGFLT_
MASKED

Output

DWORD

I, Q, M, D, L

Errores de programaci√≥n todav√≠a en‚Äê
mascarados

ACCFLT_
MASKED

Output

DWORD

I, Q, M, D, L

Errores de acceso todav√≠a enmascara‚Äê
dos

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6056

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error
(W#16#...)

Descripci√≥n

0000

Se han desenmascarado todos los errores especificados.

0001

Por lo menos uno de los errores no estaba enmascarado; pese a ello se desenmascaran los otros
errores.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

READ_ERR: Leer registro de estado de eventos
Descripci√≥n
Esta instrucci√≥n permite leer el registro de estado de eventos. El registro de estado de eventos
tiene una estructura equivalente a la de las m√°scaras de errores de programaci√≥n y acceso
que pueden programarse como par√°metros de entrada con "MSK_FLT (P√°gina 6055)" y
"DMSK_FLT (P√°gina 6056)".
En los par√°metros de entrada se especifican los eventos de errores sincr√≥nicos que se desean
consultar en el registro de estado de eventos. Llamando "READ_ERR" se leen (y al mismo
tiempo se borran) las entradas deseadas del registro de estado de eventos.
En el registro de estado de eventos se puede averiguar cu√°les de los errores sincr√≥nicos
enmascarados se han producido al menos una vez en la clase de prioridad actual. Un bit
activado significa que el error sincr√≥nico correspondiente ha aparecido por lo menos una vez.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "READ_ERR":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

PRGFLT_QUERY

Input

DWORD

I, Q, M, D, L o constante Consulta de los errores de programa‚Äê
ci√≥n

ACCFLT_QUERY

Input

DWORD

I, Q, M, D, L o constante Consulta de los errores de acceso

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

PRGFLT_CLR

Output

DWORD

I, Q, M, D, L

Errores de programaci√≥n que se han
producido

ACCFLT_CLR

Output

DWORD

I, Q, M, D, L

Errores de acceso que se han produci‚Äê
do

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6057

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

Todos los errores consultados est√°n enmascarados.

0001

Por lo menos uno de los errores consultados no est√° enmascarado.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Eventos de errores as√≠ncronos
Retardar y bloquear alarmas y eventos de errores as√≠ncronos
Finalidad de las instrucciones "DIS_IRT", "EN_IRT", "DIS_AIRT", "EN_AIRT"
Estas instrucciones se utilizan para las siguientes acciones referentes al procesamiento de
alarmas y eventos de errores as√≠ncronos:
‚óè Bloquear su ejecuci√≥n en todos los ciclos siguientes de la CPU con "DIS_IRT
(P√°gina 6059)", o
‚óè Retardar clases de prioridad de mayor prioridad hasta el final del OB con "DIS_AIRT
(P√°gina 6059)"
‚óè Volver a habilitar la ejecuci√≥n con "EN_IRT (P√°gina 6061)" o "EN_AIRT (P√°gina 6063)".
El procesamiento de alarmas y eventos de errores as√≠ncronos se programa en el programa de
usuario. Para ello deben programarse los correspondientes OBs.

Ventaja de las instrucciones "DIS_AIRT" y "EN_AIRT"
Retardando eventos de alarma y de errores as√≠ncronos de mayor prioridad con la instrucci√≥n
"DIS_AIRT (P√°gina 6062)" y habilit√°ndolos con la instrucci√≥n "EN_AIRT (P√°gina 6063)" se
obtienen las siguientes ventajas para el usuario:
La CPU registra el n√∫mero de retardos de alarma. Un retardo de eventos de alarma o de
errores as√≠ncronos programado por el usuario no se puede eliminar llamando FC est√°ndar si
en dichos FC est√°ndar tambi√©n se bloquean y vuelven a habilitar eventos de alarma y de
errores as√≠ncronos.

Clases de alarma
Las alarmas se dividen en varias clases. La tabla siguiente contiene todas las clases de alarma
y los correspondientes OBs.

6058

Clase de alarma

OB

Alarmas horarias

De OB 10 a OB 17

Alarmas de retardo

De OB 20 a OB 23

Alarmas c√≠clicas

De OB 30 a OB 38

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Clase de alarma

OB

Alarmas de proceso

De OB 40 a OB 47

Alarmas para DPV1

OB 55 a OB 57

Alarma de multiprocesamiento

OB 60

Alarmas de error de redundan‚Äê
cia

OB 70, OB 72

Alarmas de error as√≠ncronas

OB 80 a OB 87 (ver abajo)

Alarmas de error sincr√≥nicas

OB 121, OB 122
(Para enmascarar o desenmascarar el procesamiento de las alar‚Äê
mas de error sincr√≥nicas, utilice las instrucciones "MSK_FLT (P√°gi‚Äê
na 6055)", "DMSK_FLT (P√°gina 6056)" y "READ_ERR (P√°gi‚Äê
na 6057)")

Eventos de errores as√≠ncronos
La tabla siguiente contiene todos los eventos de error as√≠ncronos ante los que se puede
reaccionar en el programa de usuario mediante un OB adecuado.
Eventos de errores as√≠ncronos

OB

Error de tiempo (p. ej. rebase del tiempo de ciclo)

OB 80

Error de fuente de alimentaci√≥n (p. ej. error de bater√≠a)

OB 81

Alarma de diagn√≥stico (p. ej. fusible defectuoso en un m√≥dulo de se√±al)

OB 82

Alarma de extracci√≥n/inserci√≥n

OB 83

Error de hardware en CPU (p. ej. error de interfaz)

OB 84

Error de ejecuci√≥n del programa

OB 85

Fallo del rack

OB 86

Error de comunicaci√≥n

OB 87

DIS_IRT: Bloquear evento de interrupci√≥n
Descripci√≥n
Esta instrucci√≥n permite bloquear el procesamiento de nuevos eventos de alarma y de errores
sincr√≥nicos. Bloquear significa que el sistema operativo de la CPU, al producirse un evento de
interrupci√≥n,
‚óè ni llama un OB de alarma o un OB de error as√≠ncrono,
‚óè ni desencadena la reacci√≥n definida en caso de que no haya ning√∫n OB de alarma ni ning√∫n
OB de error as√≠ncrono programado.
El bloqueo del procesamiento de eventos de alarma o de errores as√≠ncronos es v√°lido en todas
las clases de prioridad. El bloqueo solo puede eliminarse con la instrucci√≥n "EN_IRT
(P√°gina 6061)" o con un rearranque completo (en caliente) o un arranque en fr√≠o.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6059

Instrucciones
4.2 Instrucciones
El hecho de que el sistema operativo registre o no el evento de alarma o de errores as√≠ncronos
en el b√∫fer de diagn√≥stico depende del par√°metro de entrada MODE seleccionado.
Nota
Tenga en cuenta que al programar la instrucci√≥n "DIS_IRT" se descartan todas las alarmas
que se produzcan.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DIS_IRT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

BYTE

I, Q, M, D, L o constante Indica qu√© eventos de alarma y errores
as√≠ncronos se bloquean.

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero de OB

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecu‚Äê
ci√≥n de la instrucci√≥n, el valor de respues‚Äê
ta contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro MODE
MODE
(B#16#...)

Significado

00

Se bloquean todos los eventos de alarma y errores as√≠ncronos nuevos que se produzcan. (Los eventos de
errores sincr√≥nicos no se bloquean.) Asigne al par√°metro OB_NR el valor "0". Se siguen registrando los
eventos en el b√∫fer de diagn√≥stico.

01

Se bloquean todos los eventos nuevos que se produzcan de la clase de alarma indicada. Para identificar la
clase de alarma, haga lo siguiente:
‚óè Alarmas horarias: 10
‚óè Alarmas de retardo: 20
‚óè Alarmas c√≠clicas: 30
‚óè Alarmas de proceso: 40
‚óè Alarmas para DPV1: 50
‚óè Alarma de multiprocesamiento: 60
‚óè Alarmas de error de redundancia: 70
‚óè Alarmas de error as√≠ncronas: 80
Se siguen registrando los eventos en el b√∫fer de diagn√≥stico.

02

Se bloquean todos los eventos nuevos que se produzcan de la alarma indicada. Para identificar la alarma se
usa el n√∫mero de OB. Se siguen registrando los eventos en el b√∫fer de diagn√≥stico.

80

Todos los eventos de alarma y errores as√≠ncronos nuevos que se producen se bloquean y no se registran
en el b√∫fer de diagn√≥stico. Asigne al par√°metro OB_NR el valor "0". El sistema operativo registra el evento
W#16#5380 en el b√∫fer de diagn√≥stico.

6060

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
MODE
(B#16#...)

Significado

81

Todos los eventos nuevos que se producen de la clase de alarma indicada se bloquean y no se registran ya
en el b√∫fer de diagn√≥stico. El sistema operativo registra el evento W#16#5380 en el b√∫fer de diagn√≥stico.

82

Todos los eventos nuevos que se producen de la alarma indicada se bloquean y tampoco se registran ya en
el b√∫fer de diagn√≥stico. El sistema operativo registra el evento W#16#5380 en el b√∫fer de diagn√≥stico.

Par√°metro RET_VAL
C√≥digo de
error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

El par√°metro de entrada OB_NR contiene un valor no permitido.

8091

El par√°metro de entrada MODE contiene un valor no permitido.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

EN_IRT: Habilitar evento de interrupci√≥n
Descripci√≥n
La instrucci√≥n permite habilitar el procesamiento de nuevos eventos de alarma y errores
as√≠ncronos que se ha bloqueado anteriormente con la instrucci√≥n "DIS_IRT (P√°gina 6059)".
Habilitar significa que el sistema operativo de la CPU, al producirse un evento de interrupci√≥n,
‚óè lama un OB de alarma o un OB de error as√≠ncrono
o
‚óè dispara la reacci√≥n definida en caso de que no haya ning√∫n OB de alarma ni ning√∫n OB de
error as√≠ncrono programado.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "EN_IRT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

BYTE

I, Q, M, D, L o constante Indica qu√© eventos de alarma y errores
as√≠ncronos se habilitan (ver abajo).

OB_NR

Input

INT

I, Q, M, D, L o constante N√∫mero de OB

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la eje‚Äê
cuci√≥n de la instrucci√≥n, el valor de res‚Äê
puesta contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6061

Instrucciones
4.2 Instrucciones

Par√°metro MODE
MODE

Significado

0

Se habilitan todos los eventos de alarma y errores as√≠ncronos nuevos que se produzcan.

1

Se habilitan todos los eventos nuevos que se produzcan de la clase de alarma indicada. Para identificar la clase
de alarma, haga lo siguiente:
‚óè Alarmas horarias: 10
‚óè Alarmas de retardo: 20
‚óè Alarmas c√≠clicas: 30
‚óè Alarmas de proceso: 40
‚óè Alarmas para DPV1: 50
‚óè Alarma de multiprocesamiento: 60
‚óè Alarmas de error de redundancia: 70
‚óè Alarmas de error as√≠ncronas: 80

2

Se habilitan todos los eventos nuevos que se produzcan de la alarma indicada. Para identificar la alarma se usa
el n√∫mero de OB.

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

El par√°metro de entrada OB_NR contiene un valor no permitido.

8091

El par√°metro de entrada MODE contiene un valor no permitido.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

DIS_AIRT: Retardar tratamiento de eventos de alarma y errores as√≠ncronos de mayor prioridad
Descripci√≥n
Esta instrucci√≥n permite retardar el procesamiento de OBs de alarma y OBs de errores
as√≠ncronos cuya prioridad sea mayor que la del OB actual. La instrucci√≥n "DIS_AIRT" puede
llamarse varias veces en un OB. El sistema operativo cuenta las llamadas a la instrucci√≥n. El
retardo de procesamiento se aplica hasta que, usando la instrucci√≥n "EN_AIRT
(P√°gina 6063)", se eliminan todos los retardos de procesamiento de OBs de alarma y OBs de
errores as√≠ncronos definidos con "DIS_AIRT", o acaba de procesarse el OB actual.
Los eventos de alarma o de errores as√≠ncronos pendientes se procesan en cuanto se elimina
el retardo de procesamiento con la instrucci√≥n "EN_AIRT (P√°gina 6063)" o finaliza el
procesamiento del OB actual.

6062

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DIS_AIRT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

N√∫mero de retardos (= n√∫mero de llama‚Äê
das de DIS_AIRT)

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
La tabla siguiente contiene el valor de retorno de "DIS_AIRT", que se devuelve a trav√©s del
par√°metro RET_VAL .
Valor de retorno

Descripci√≥n

n

"Una vez finalizada la instrucci√≥n, n" muestra el n√∫mero de retardos de procesamiento, es decir, de
llamadas de "DIS_AIRT" (el procesamiento de alarmas vuelve a habilitarse cuando n = 0; ver "EN_AIRT
(P√°gina 6063)").

EN_AIRT: Habilitar tratamiento de eventos de alarma y errores as√≠ncronos de mayor prioridad
Descripci√≥n
La instrucci√≥n permite habilitar el procesamiento de eventos de alarma y errores as√≠ncronos de
mayor prioridad que se ha retardado anteriormente con la instrucci√≥n "DIS_IRT
(P√°gina 6062)". Para ello deben finalizarse uno por uno todos los retardos de procesamiento
con la instrucci√≥n "EN_AIRT".

Ejemplo
Si p. ej. se han retardado alarmas 5 veces con 5 llamadas de "DIS_AIRT (P√°gina 6062)", para
eliminar todos esos retardos deben usarse 5 llamadas a "EN_AIRT".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "EN_AIRT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

N√∫mero de retardos todav√≠a programa‚Äê
dos despu√©s de la ejecuci√≥n de
"EN_AIRT" o aviso de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6063

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
Para saber c√≥mo evaluar la informaci√≥n de error del par√°metro RET_VAL , consulte el
cap√≠tulo Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174). En ese
cap√≠tulo encontrar√° tambi√©n la informaci√≥n general de error de las instrucciones. La tabla
siguiente contiene el valor de retorno espec√≠fico de "EN_AIRT", o la informaci√≥n de error que
puede devolverse a trav√©s del par√°metro RET_VAL .
Valor de retorno y error

Descripci√≥n

n

"Una vez finalizada la instrucci√≥n, n" muestra el n√∫mero de retardos de procesamiento, es
decir, de llamadas de "EN_AIRT" (el procesamiento de alarmas vuelve a habilitarse cuando
n = 0).

W#16#8080

Aunque el procesamiento de la alarma ya se ha habilitado anteriormente, se ha llamado
"EN_AIRT".

Evento de multiprocesamiento
MP_ALM: Alarma de multiprocesamiento
Descripci√≥n
En el modo de multiprocesamiento, la llamada a esta instrucci√≥n dispara la alarma de
multiprocesamiento. Esto da lugar al inicio sincronizado del OB 60 en todas las CPUs
correspondientes. En el modo monoprocesador y en el funcionamiento en rack segmentado,
el OB 60 solo se inicia en la CPU en la que se ha llamado la instrucci√≥n.
Con el par√°metro de entrada JOB puede identificarse la causa de la alarma de
multiprocesamiento deseada. Esta identificaci√≥n de petici√≥n se transfiere a todas las CPUs
correspondientes y puede evaluarse en el OB de multiprocesamiento (OB 60).
Esta instrucci√≥n puede llamarse en cualquier punto del programa. Sin embargo, la llamada
solo tiene sentido en el estado operativo RUN, por lo que en el estado operativo ARRANQUE
est√° bloqueada. Esto se notifica mediante un valor de funci√≥n.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "MP_ALM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

JOB

Input

BYTE

I, Q, M, D, L o constante Identificador de petici√≥n
Valores posibles: de 1 a 15

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la eje‚Äê
cuci√≥n de la instrucci√≥n, el valor de res‚Äê
puesta contendr√° un c√≥digo de error.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6064

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

El par√°metro de entrada JOBcontiene un valor no permitido.

80A0

El procesamiento del OB 60 de la alarma de multiprocesamiento anterior todav√≠a no ha finalizado en la
CPU propia o en otra CPU.

80A1

Estado operativo err√≥neo (ARRANQUE en lugar de RUN)

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

4.2.3.8

Avisos

Formato de los datos de diagn√≥stico
Registros 0 y 1 de los datos del sistema
Los datos de diagn√≥stico de un m√≥dulo se encuentran en los registros 0 y 1 del √°rea de datos
del sistema (ver Escribir y leer registros (P√°gina 6026)):
‚óè El registro 0 contiene 4 bytes de datos de diagn√≥stico, que describen el estado actual de un
m√≥dulo de se√±al.
‚óè El registro 1 contiene
‚Äì los 4 bytes de datos de dispositivo que tambi√©n se encuentran en el registro 0, y
‚Äì los datos de diagn√≥stico espec√≠ficos de m√≥dulo.

Formato y contenido de los datos de diagn√≥stico
A continuaci√≥n se describen el formato y el contenido de los distintos bytes de los datos de
diagn√≥stico. Se aplica la siguiente regla general: Cuando se produce un error, el bit
correspondiente se ajusta a "1".
Byte

Bit

Significado

0

0

Fallo de m√≥dulo

1

Error interno

2

Error externo

3

Existe error de canal

4

Falta tensi√≥n auxiliar externa

5

Falta conector frontal

6

Falta parametrizaci√≥n

7

Par√°metros err√≥neos en el m√≥dulo

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Observaci√≥n

Registro
0y1

6065

Instrucciones
4.2 Instrucciones
Byte

Bit

Significado

Observaci√≥n

Registro

1

0

Clase de m√≥dulo

0101: M√≥dulo anal√≥gico

0y1

a

0000: CPU

3

1000: M√≥dulo de funci√≥n
1100: CP
1111: M√≥dulo digital
0011: Esclavo DP normalizado
1011: Esclavo I
0100: IM

2

4

Existe informaci√≥n de canal

5

Existe informaci√≥n de usuario

6

Alarma de diagn√≥stico de sustituto

7

Mantenimiento necesario (solo con PROFI‚Äê
NET IO)

0

M√≥dulo de memoria err√≥neo o ausente

1

Fallo de comunicaci√≥n

2

Estado operativo

0y1
0: RUN
1: STOP

3

6066

3

La vigilancia del tiempo de ciclo se ha dis‚Äê
parado

4

Fallo de la tensi√≥n de alimentaci√≥n interna
del m√≥dulo

5

Bater√≠a vac√≠a

6

Fallo de todo el respaldo

7

Mantenimiento solicitado (solo con PROFI‚Äê
NET IO)

0

Fallo de aparato de ampliaci√≥n

1

Fallo de procesador

2

Error de EPROM

3

Error de RAM

4

Error de ADU/DAU

5

Fallo de fusible

6

Alarma de proceso perdida

7

Reservado

0y1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Byte

Bit

Significado

Observaci√≥n

Registro

4

0

Tipo de canal

B#16#70: Entrada digital

1

a

B#16#72: Salida digital

6

B#16#71: Entrada anal√≥gica
B#16#73: Salida anal√≥gica
B#16#74: FM-POS
B#16#75: FM-REG
B#16#76: FM-ZAEHL
B#16#77: FM-TECHNO
B#16#78: FM-NCU
B#16#79: a
B#16#7D: reservado
B#16#7E: US300
B#16#7F: reservado

7

¬øExiste otro tipo de canal?

0: No

0

N√∫mero de bits de diagn√≥stico que un m√≥‚Äê
dulo devuelve por canal.

El n√∫mero de bits de diagn√≥stico por canal
se redondea a los l√≠mites de byte.

N√∫mero de canales del mismo tipo en un
m√≥dulo

Si en un m√≥dulo existen diferentes tipos de 1
canales, para cada tipo de canal se repite
la estructura a partir del byte 4 en el regis‚Äê
tro 1.
Primer byte del vector de error de canal (la 1
longitud del vector de error de canal se de‚Äê
fine en funci√≥n del n√∫mero de canal y se
redondea a los l√≠mites de byte.)

1: S√≠
5

a

1

7
6

0
a
7

7

...

0

Error de canal, canal 0/grupo de canales 0

1

Error de canal, canal 1/grupo de canales 1

2

Error de canal, canal 2/grupo de canales 2

3

Error de canal, canal 3/grupo de canales 3

4

Error de canal, canal 4/grupo de canales 4

5

Error de canal, canal 5/grupo de canales 5

6

Error de canal, canal 6/grupo de canales 6

7

Error de canal, canal 7/grupo de canales 7

-

Errores espec√≠ficos de canal (ver Formato
de los datos de diagn√≥stico espec√≠ficos de
canal (P√°gina 6067) ):

1

Formato de los datos de diagn√≥stico espec√≠ficos de canal
Errores espec√≠ficos de canal
A partir del byte que se encuentra justo a continuaci√≥n del vector de error de canal, se
muestran los errores espec√≠ficos de canal para cada canal del m√≥dulo. A continuaci√≥n se
muestra el formato del diagn√≥stico espec√≠fico de canal para los distintos tipos de canal. Para
la asignaci√≥n de bits se aplica la siguiente regla:
‚óè 1 = error
‚óè 0 = sin error

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6067

Instrucciones
4.2 Instrucciones

Canal de entrada anal√≥gica
Byte de diagn√≥stico para un canal de entrada anal√≥gica
Bit

Significado

Observaci√≥n

0

Error de configuraci√≥n/parame‚Äê Notificable mediante WR_USMSG (P√°gina 6100) y
trizaci√≥n
EVENTN = W#16#8x50

1

Error s√≠ncrono (error modo co‚Äê
m√∫n)

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x51

2

Cortocircuito P

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x52

3

Cortocircuito M

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x53

4

Rotura de hilo

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x54

5

Error en canal de referencia

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x55

6

Rebase por defecto del rango
de medici√≥n

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x56

7

Rebase por exceso del rango
de medici√≥n

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x57

Canal de salida anal√≥gica
Byte de diagn√≥stico para un canal de salida anal√≥gica

6068

Bit

Significado

0

Error de configuraci√≥n/parametri‚Äê Notificable mediante WR_USMSG (P√°gina 6100) y
zaci√≥n
EVENTN = W#16#8x60

Observaci√≥n

1

Error s√≠ncrono (error modo co‚Äê
m√∫n)

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x61

2

Cortocircuito P

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x62

3

Cortocircuito M

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x63

4

Rotura de hilo

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x64

5

0

Reservado

6

Falta tensi√≥n de carga

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x66

7

0

Reservado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Canal de entrada digital
Byte de diagn√≥stico para un canal de entrada digital
Bit

Significado

Observaci√≥n

0

Error de configuraci√≥n/parametri‚Äê Notificable mediante WR_USMSG (P√°gina 6100) y
zaci√≥n
EVENTN = W#16#8x70

1

Defecto a masa

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x71

2

Cortocircuito P (sensor)

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x72

3

Cortocircuito M

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x73

4

Rotura de hilo

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x74

5

Falta alimentaci√≥n del sensor

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x75

6

0

Reservado

7

0

Reservado

Canal de salida digital
Byte de diagn√≥stico para un canal de salida digital
Bit

Significado

Observaci√≥n

0

Error de configuraci√≥n/parametri‚Äê
zaci√≥n

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x80

1

Defecto a masa

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x81

2

Cortocircuito P

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x82

3

Cortocircuito M

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x83

4

Rotura de hilo

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x84

5

Actuaci√≥n fusible

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x85

6

Falta tensi√≥n de carga

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x86

7

Sobretemperatura

Notificable mediante WR_USMSG (P√°gina 6100) y
EVENTN = W#16#8x87

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6069

Instrucciones
4.2 Instrucciones

Instrucciones para generar avisos de PLC con DB de instancia
Introducci√≥n a la creaci√≥n de avisos de PLC con instrucciones
Instrucciones para generar avisos de bloque
Para generar un aviso de PLC, se debe llamar en el programa una de las siguientes
instrucciones:
‚óè "NOTIFY (P√°gina 6080)"
‚óè "NOTIFY_8P (P√°gina 6073)"
‚óè "ALARM (P√°gina 6083)"
‚óè "ALARM_8 (P√°gina 6075)"
‚óè "ALARM_8P (P√°gina 6077)"
Estas instrucciones tienen las siguientes caracter√≠sticas:
‚óè Con "NOTIFY (P√°gina 6080)" y "NOTIFY_8P (P√°gina 6073)", todo cambio de se√±al 0 -> 1
√≥ 1 > 0 detectado en la llamada da lugar al env√≠o de un aviso.
‚óè En el caso de "ALARM (P√°gina 6083)", "ALARM_8 (P√°gina 6075)" y "ALARM_8P
(P√°gina 6077)", si la notificaci√≥n controlada por confirmaci√≥n (acuse) est√° inactiva, todo
cambio de se√±al detectado en la llamada dar√° lugar a un aviso.
Sin embargo, si la notificaci√≥n controlada por confirmaci√≥n est√° activada, no todos los
cambios de se√±al detectados dar√°n lugar a un aviso (m√°s detalles abajo). En este caso, el
visor de avisos no mostrar√° el aviso enviado.
‚óè Despu√©s de la ejecuci√≥n del bloque, los valores asociados (entradas SD_i) se han le√≠do en
su totalidad y se han asociado al aviso (ver "Par√°metros de env√≠o y recepci√≥n"
en Par√°metros comunes de las instrucciones para la comunicaci√≥n S7 (P√°gina 6833)).
En lo referente a la coherencia respecto a clases de mayor prioridad, se aplica a los valores
asociados lo siguiente: Todo valor asociado SD_i es coherente en s√≠ mismo.
‚óè Con los par√°metros de estado DONE, ERROR y STATUS se vigila el estado de
procesamiento del bloque (ver "Par√°metros de estado" en Par√°metros comunes de las
instrucciones para la comunicaci√≥n S7 (P√°gina 6833)).
Nota
Los par√°metros ID y EV_ID solo se eval√∫an en la primera llamada del bloque (los
par√°metros actuales o los valores predefinidos de la instancia).

Registros de visualizadores
Para que las instrucciones para generar avisos de PLC env√≠en un aviso al detectar un cambio
de se√±al, es necesario que haya por lo menos un visualizador registrado para avisos de PLC.
Si no hay ninguno registrado, el par√°metro STATUS devuelve el valor "1".

6070

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Detecci√≥n de cambio de se√±al
Por cada instancia de una instrucci√≥n de aviso, est√° disponible una memoria de avisos con dos
2 espacios de memoria.
Inicialmente, esta memoria de avisos est√° vac√≠a. En cuanto la instrucci√≥n detecta un cambio
de se√±al en la entrada SIG o en una de las entradas SIG_1, ... SIG_8, se registra el cambio en
el primer espacio de memoria. Este espacio est√° ocupado hasta que se env√≠a el aviso
correspondiente.
El siguiente cambio de se√±al detectado en la entrada SIG o en una de las entradas SIG_1, ...
SIG_8 se registra en el segundo espacio de memoria. Si el primer espacio de memoria todav√≠a
est√° ocupado y se producen nuevos cambios de se√±al, se sobrescribe siempre el segundo
espacio de memoria.
Esta p√©rdida de avisos se notifica mediante los par√°metros de salida ERROR y STATUS
(ERROR=0, STATUS=11). Adem√°s, los dispositivos de visualizaci√≥n registrados reciben una
notificaci√≥n al respecto en cuanto puede enviarse el siguiente aviso.
Si el primer espacio de memoria queda libre, el segundo espacio de memoria se transfiere al
primero. De este modo, el segundo espacio de memoria vuelve a quedar libre.

Notificaci√≥n controlada por acuse
Para reducir el volumen de avisos en la instalaci√≥n, pueden usarse las instrucciones "ALARM
(P√°gina 6083)", "ALARM_8 (P√°gina 6075)" y "ALARM_8P (P√°gina 6077)", que soportan el
procedimiento de notificaci√≥n controlada por acuse.
En este procedimiento, despu√©s de generarse un aviso entrante (cambio de se√±al de 0 a 1)
para una se√±al, no se vuelven a generar avisos para la misma se√±al hasta que el usuario haya
acusado el primero en un visualizador. El siguiente aviso que se muestra en el visualizador
despu√©s del acuse es un aviso saliente (cambio de se√±al de 1 a 0). A continuaci√≥n se inicia de
nuevo el ciclo de aviso con un aviso entrante (cambio de se√±al de 0 a 1), que debe acusarse.
De este modo se pueden controlar a trav√©s del visualizador los avisos provocados por cambio
de se√±al (excepto el aviso saliente).
El procedimiento de notificaci√≥n (notificaci√≥n controlada por acuse activa o inactiva) para las
instrucciones "ALARM (P√°gina 6083)", "ALARM_8 (P√°gina 6075)" y "ALARM_8P
(P√°gina 6077)" se define para toda la CPU en la configuraci√≥n.
Para que la evaluaci√≥n de avisos sea uniforme dentro de una instalaci√≥n, en caso de utilizarse
el procedimiento de notificaci√≥n controlada por acuse, debe comprobarse que todos los
visualizadores soporten este procedimiento.
Nota
(Sobre el uso de visualizadores que no soportan la notificaci√≥n controlada por acuse.)
Si se ha activado en la CPU la notificaci√≥n controlada por acuse, la CPU env√≠a los avisos solo
a aquellos visualizadores que soportan este procedimiento. Por lo tanto, si no hay ning√∫n
visualizador que soporte la notificaci√≥n controlada por acuse, la CPU no env√≠a ning√∫n aviso.
Esto se notifica una sola vez con ERROR=1 y STATUS=1.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6071

Instrucciones
4.2 Instrucciones

Acuse de aviso con las instrucciones "ALARM", "ALARM_8" y "ALARM_8P"
Se aplica el concepto de confirmaci√≥n (acuse) centralizado, es decir, cuando se ha confirmado
un aviso en un visualizador, esta informaci√≥n de confirmaci√≥n se env√≠a en primer lugar a la
CPU que ha generado el aviso. Desde all√≠ se distribuye la informaci√≥n de acuse a todos los
visualizadores registrados al efecto.
Siempre se acusa una se√±al, y no un aviso individual. Si p. ej se han notificado varios flancos
ascendentes de una se√±al y se acusa el evento entrante, todos los eventos entrantes
anteriores con el mismo n√∫mero de aviso se consideran acusados.

Indicador de acuse
Las instrucciones "NOTIFY (P√°gina 6080)" y "NOTIFY_8P (P√°gina 6073)" no poseen indicador
de acuse. Con "ALARM (P√°gina 6083)" se puede conocer el estado de acuse a trav√©s de los
par√°metros de salida ACK_UP y ACK_DN, con "ALARM_8P (P√°gina 6077)" y "ALARM_8
(P√°gina 6075)", a trav√©s del par√°metro de salida ACK_STATE. Estas salidas se actualizan en
el momento de la llamada del bloque, en caso de que el par√°metro de control EN_R tenga el
valor "1".

Bloquear y habilitar avisos mediante instrucci√≥n o dispositivo de visualizaci√≥n
Puede ser √∫til suprimir avisos, p. ej. cuando se realizan modificaciones estructurales de la
instalaci√≥n. Por ello existe la posibilidad de bloquear y volver a habilitar avisos desde el
dispositivo de visualizaci√≥n o desde el programa. El bloqueo/habilitaci√≥n es v√°lido para todos
los dispositivos que se han registrado para el aviso en cuesti√≥n. Permanece vigente hasta que
se vuelve a habilitar el aviso correspondiente.
Si se han bloqueado avisos, esto se notifica a trav√©s de los par√°metros de salida ERROR y
STATUS (ERROR = 1, STATUS = 21).

Espacio requerido en memoria de trabajo por las instrucciones para generar avisos de bloque
Las instrucciones para generar avisos de PLC requieren, para funcionar sin problemas, un
b√∫fer de datos de comunicaci√≥n dependiente de los valores asociados en la memoria de
trabajo de la CPU (√°rea de c√≥digo). El espacio ocupado en la memoria se indica en la tabla
siguiente.

6072

Instrucci√≥n

Espacio en bytes requerido en la memoria de trabajo de la CPU

NOTIFY

200 + 2 * longitud de los valores asociados indicados en la primera llamada en
SD_1,...SD_10

NOTIFY_8P

200 + 2 * longitud de los valores asociados indicados en la primera llamada en
SD_1,...SD_10

ALARM

200 + 2 * longitud de los valores asociados indicados en la primera llamada en
SD_1,...SD_10

ALARM_8

100

ALARM_8P

200 + 2 * longitud de los valores asociados indicados en la primera llamada en
SD_1,...SD_10

AR_SEND

54

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

N√∫mero de datos transmisibles
El n√∫mero de datos transmisibles a trav√©s de los valores asociados SD_i de las instrucciones
"NOTIFY (P√°gina 6080)", "NOTIFY_8P (P√°gina 6073)", "ALARM (P√°gina 6083)" y
"ALARM_8P (P√°gina 6077)" no debe superar una determinada longitud m√°xima. Esta longitud
de datos m√°xima se calcula de la siguiente manera:
longmax =
m√≠n (pdu_local, pdu_remota) - dif - 4 * n√∫mero de par√°metros SD_i utilizados
Donde:
‚óè m√≠n (pdu_local, pdu_remota) es el valor m√≠nimo de los n√∫meros pdu_local y pdu_remota
‚óè pdu_local es la longitud m√°xima de los bloques de datos de la CPU propia (ver datos
t√©cnicos de la CPU utilizada)
‚óè pdu_remota es la longitud m√°xima de los bloques de datos de los visualizadores
‚óè dif = 48 si est√° activa la notificaci√≥n controlada por acuse; 44 si est√° inactiva

Ejemplo
Supongamos que una CPU 414-2 env√≠a avisos a HMI a trav√©s de Industrial Ethernet. La
notificaci√≥n controlada por acuse est√° inactiva.
Se utilizan los valores asociados SD_1, SD_2 y SD_3.
pdu_local = 480 bytes, pdu_remota = 480 bytes,
N√∫mero de par√°metros SD_i utilizados: 3
Se aplica lo siguiente:
longmax = min (480, 480) - 44 - 4 * 3 = 480 - 44 - 12 = 424
Por lo tanto, la longitud de datos m√°xima transmisible por instrucci√≥n es de 424 bytes.

NOTIFY_8P: Notificar hasta ocho cambios de se√±al
Descripci√≥n
La instrucci√≥n "NOTIFY_8P" es la ampliaci√≥n de "NOTIFY (P√°gina 6080)" a ocho se√±ales.
Se genera un aviso cuando se ha detectado un cambio de se√±al en por lo menos una se√±al.
En la primera llamada de "NOTIFY_8P" se genera siempre un aviso. Para las ocho se√±ales
existe un n√∫mero de aviso com√∫n, que se divide en ocho avisos parciales en el visualizador.
Por cada instancia de "NOTIFY_8P" est√° disponible una memoria de avisos con 2 espacios de
memoria. Para m√°s detalles sobre el almacenamiento intermedio de cambios de se√±al, ver la
secci√≥n Introducci√≥n a la creaci√≥n de avisos de PLC con instrucciones (P√°gina 6070).
Nota
A pesar de la p√©rdida de aviso, se notifican al visualizador los dos √∫ltimos cambios de cada
se√±al.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6073

Instrucciones
4.2 Instrucciones
ADVERTENCIA
Llamada de "NOTIFY_8P"
Antes de llamar "NOTIFY_8P" en un sistema de automatizaci√≥n, debe comprobarse que
todos los visualizadores soporten ese bloque. Si no se tiene en cuenta esto, se interrumpir√°
la comunicaci√≥n entre el sistema de automatizaci√≥n y los visualizadores conectados. En
consecuencia, no se podr√° acceder a la instalaci√≥n con los visualizadores conectados.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "NOTIFY_8P":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SIG_i,

Input

BOOL

I, Q, M, D, L

Se√±al con el n√∫mero ordinal i que se debe
vigilar

ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Canal de datos para avisos: W#16#EEEE
ID solo se eval√∫a en la primera llamada.

EV_ID

Input

C_NOTIFY_8P

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0)
EV_ID solo se eval√∫a en la primera llamada.
Tras ello, en cada llamada de "NOTIFY_8P"
con el DB de instancia correspondiente, se
utiliza el mismo n√∫mero de aviso que en la
primera llamada.

1‚â§i‚â§8

El n√∫mero de aviso se asigna autom√°tica‚Äê
mente. Con ello se garantiza la coherencia
de los n√∫meros de aviso. El n√∫mero de aviso
debe ser un√≠voco dentro del programa de
usuario.
SEVERITY

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Peso del evento
Valores posibles: De 0 a 127 (el valor 0 re‚Äê
presenta el peso m√°ximo);
valor predeterminado: 64
Este par√°metro no es relevante para el pro‚Äê
cesamiento del aviso.

DONE

Output

BOOL

I, Q, M, D, L

Par√°metro de estado DONE: Ha finalizado
la generaci√≥n del aviso.

ERROR

Output

BOOL

I, Q, M, D, L

El par√°metro de estado ERROR:
ERROR=TRUE significa que se ha produci‚Äê
do un error durante el procesamiento. Para
m√°s detalles, v√©ase el par√°metro STATUS.

STATUS

Output

WORD

I, Q, M, D, L

Par√°metro de estado STATUS: Ver una in‚Äê
formaci√≥n de error

SD_i,

InOut

ANY

I, Q, M, D, T, C

Valor asociado con n√∫mero ordinal i

1 ‚â§ i ‚â§ 10

Solo se permiten los tipos de datos BOOL
(no permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME
Nota: Si el puntero ANY accede a un DB,
este siempre debe especificarse.
(p. ej.: P# DB10.DBX5.0 byte 10)

6074

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros ERROR y STATUS
La siguiente tabla contiene toda la informaci√≥n de los errores espec√≠ficos de "NOTIFY_8P",
que puede indicarse a trav√©s de los par√°metros ERROR y STATUS .
ERROR

STATUS (de‚Äê
cimal)

Explicaci√≥n

0

11

P√©rdida de aviso: El cambio de se√±al precedente o el aviso precedente no se ha podido enviar
y se sustituye por el aviso actual.

0

22

‚óè Error en el puntero a los valores asociados SD_i:
‚Äì

Referente a la longitud de datos o al tipo de datos

‚Äì

No se puede acceder a los valores asociados en la memoria del usuario, p. ej. debido
a que se ha borrado un DB o a un error de longitud de √°rea

‚Äì

El aviso activado se env√≠a sin valores asociados o solo con el n√∫mero de valores
asociados posible en el momento.

‚óè El par√°metro actual seleccionado de SEVERITY se encuentra por encima del rango
admisible. El aviso activado se env√≠a con SEVERITY=127.
0

25

La comunicaci√≥n se ha iniciado. El aviso se est√° procesando.

1

1

Problemas de comunicaci√≥n: La conexi√≥n se ha interrumpido o no hay registro

1

4

En la primera llamada
‚óè la EV_ID indicada se encuentra fuera del rango admisible
‚óè existe un error formal del puntero ANY SD_i
‚óè se ha rebasado el √°rea de memoria m√°xima transmisible para la CPU por cada
"NOTIFY_8P"

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado)

1

12

En la llamada de la instrucci√≥n ha ocurrido lo siguiente:
‚óè Se ha indicado un DB de instancia que no pertenece a "NOTIFY_8P"
‚óè No se ha indicado ning√∫n DB de instancia, sino un DB global

1

18

EV_ID ya ha sido utilizado por una de las instrucciones "NOTIFY (P√°gina 6080)", "NO‚Äê
TIFY_8P", "ALARM (P√°gina 6083)", "ALARM_8 (P√°gina 6075)" o "ALARM_8P (P√°gina 6077)".

1

20

La memoria de trabajo disponible no es suficiente.

1

21

El aviso con la EV_ID indicada est√° bloqueado.

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

ALARM_8: Generar avisos PLC sin valores asociados para ocho se√±ales
Descripci√≥n
A excepci√≥n de la ausencia de los valores asociados SD_1, ..., SD_10, esta instrucci√≥n es
id√©ntica a NOTIFY_8P (P√°gina 6073).
Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6075

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM_8":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

EN_R

Input

BOOL

I, Q, M, D, L

Par√°metro de control enabled to receive,
con el cual, al llamar el bloque, la salida
ACK_STATE se actualiza (EN_R=1) o no
se actualiza (EN_R=0).

SIG_i,

Input

BOOL

I, Q, M, D, L

Se√±al con el n√∫mero ordinal i que se debe
vigilar

ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Canal de datos para avisos: W#16#EEEE
ID solo se eval√∫a en la primera llamada.

EV_ID

Input

C_ALARM_8

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0) EV_ID
solo se eval√∫a en la primera llamada. Tras
ello, en cada llamada de "ALARM_8" con el
DB de instancia correspondiente, se utiliza
el mismo n√∫mero de aviso que en la primera
llamada.

1‚â§i ‚â§8

El n√∫mero de aviso se asigna autom√°tica‚Äê
mente. Con ello se garantiza la coherencia
de los n√∫meros de aviso. El n√∫mero de aviso
debe ser un√≠voco dentro del programa de
usuario.
SEVERITY

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Peso del evento

Par√°metro de estado DONE:

Valores posibles: De 0 a 127 (el valor 0 sig‚Äê
nifica el peso m√°ximo)
Este par√°metro no es relevante para el pro‚Äê
cesamiento del aviso.

DONE

Output

BOOL

I, Q, M, D, L

ERROR

Output

BOOL

I, Q, M, D, L

El par√°metro de estado ERROR:
ERROR=TRUE significa que se ha produci‚Äê
do un error durante el procesamiento. Para
m√°s detalles, v√©ase el par√°metro STATUS.

STATUS

Output

WORD

I, Q, M, D, L

Par√°metro de estado STATUS: Ver una in‚Äê
formaci√≥n de error

ACK_STATE

Output

WORD

I, Q, M, D, L

Mapa de bits con el estado de acuse actual
de los ocho avisos (1: Evento acusado, 0:
Evento no acusado):

Ha finalizado la generaci√≥n del aviso.

‚óè Los bits de 0 a 7 se reproducen en el
evento entrante en SIG_1 a SIG_8
‚óè Los bits de 8 a 15 se reproducen en el
evento saliente en SIG_1 a SIG_8
‚óè Estado de inicializaci√≥n: W#16#FFFF,
es decir, se han acusado todos los
eventos entrantes y salientes

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6076

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros ERROR y STATUS
La siguiente tabla contiene toda la informaci√≥n de error espec√≠fica de la instrucci√≥n "ALARM_8"
que puede indicarse a trav√©s de los par√°metros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicaci√≥n

0

11

P√©rdida de aviso: El cambio de se√±al precedente o el aviso precedente no se ha podido enviar
y se sustituye por el aviso actual.

0

22

El par√°metro actual seleccionado de SEVERITY se encuentra por encima del rango admisible.
El aviso activado se env√≠a con SEVERITY=127.

0

25

La comunicaci√≥n se ha iniciado. El aviso se est√° procesando.

1

1

Problemas de comunicaci√≥n: La conexi√≥n se ha interrumpido o no hay registro
Si est√° activada la notificaci√≥n controlada por acuse: Indicaci√≥n temporal, si no existen visuali‚Äê
zadores que soporten la notificaci√≥n controlada por acuse

1

4

En la primera llamada, la EV_ID indicada se encuentra fuera del rango admisible.

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado)

1

12

En la llamada de la instrucci√≥n ha ocurrido lo siguiente:
‚óè Se ha indicado un DB de instancia que no pertenece a "ALARM_8"
‚óè No se ha indicado ning√∫n DB de instancia, sino un DB global

1

18

EV_ID ya ha sido utilizado por una de las instrucciones "NOTIFY (P√°gina 6080)", "NOTIFY_8P
(P√°gina 6073)", "ALARM (P√°gina 6083)", "ALARM_8" o "ALARM_8P (P√°gina 6077)".

1

20

La memoria de trabajo disponible no es suficiente.

1

21

El aviso con la EV_ID indicada est√° bloqueado.

Nota
Despu√©s de la primera llamada, todos los bits de la salida ACK_STATE est√°n activados, y los
valores anteriores de las entradas SIG_i, 1 ‚â§ i ‚â§ 8 se ponen a 0.

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

ALARM_8P: Generar avisos PLC con valores asociados para ocho se√±ales
Descripci√≥n
Esta instrucci√≥n es la ampliaci√≥n de "ALARM (P√°gina 6083)" a ocho se√±ales.
Si no est√° activada la notificaci√≥n controlada por acuse, se genera siempre un aviso cuando se
detecta un cambio de se√±al en por lo menos una se√±al (excepci√≥n: En la primera llamada se
genera siempre un aviso). Para las ocho se√±ales existe un n√∫mero de aviso com√∫n, que se
divide en ocho avisos parciales en el visualizador. Puede acusarse por separado cada uno de
los avisos parciales, o bien varios avisos parciales al mismo tiempo.
Mediante el par√°metro de salida ACK_STATE puede seguir proces√°ndose el estado de acuse
de los distintos avisos en el programa. Si se bloquea o habilita un aviso de una instrucci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6077

Instrucciones
4.2 Instrucciones
"ALARM_8P", esto afecta siempre a toda la instrucci√≥n "ALARM_8P". No es posible bloquear
o habilitar se√±ales individualmente.
Por cada instancia de "ALARM_8P" est√° disponible una memoria de avisos con dos espacios
de memoria. Para m√°s detalles sobre el almacenamiento intermedio de cambios de se√±al, ver
la secci√≥n Introducci√≥n a la creaci√≥n de avisos de PLC con instrucciones (P√°gina 6070).

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM_8P":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

EN_R

Input

BOOL

I, Q, M, D, L

Par√°metro de control enabled to receive,
con el cual, al llamar el bloque, la salida
ACK_STATE se actualiza (EN_R=1) o no
se actualiza (EN_R=0).

SIG_i,

Input

BOOL

I, Q, M, D, L

Se√±al con el n√∫mero ordinal i que se debe
vigilar

ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Canal de datos para avisos: W#16#EEEE
ID solo se eval√∫a en la primera llamada.

EV_ID

Input

C_ALARM_8P

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0); EV_ID
solo se eval√∫a en la primera llamada. Tras
ello, en cada llamada de "ALARM_8P" con
el DB de instancia correspondiente, se utili‚Äê
za el mismo n√∫mero de aviso que en la pri‚Äê
mera llamada.

1‚â§i ‚â§8

El n√∫mero de aviso se asigna autom√°tica‚Äê
mente. Con ello se garantiza la coherencia
de los n√∫meros de aviso. El n√∫mero de aviso
debe ser un√≠voco dentro del programa de
usuario.
SEVERITY

DONE

Input

Output

WORD

BOOL

I, Q, M, D, L o cons‚Äê
tante

I, Q, M, D, L

Peso del evento
Valores posibles: De 0 a 127 (el valor 0 sig‚Äê
nifica el peso m√°ximo)
Este par√°metro no es relevante para el pro‚Äê
cesamiento del aviso.
Par√°metro de estado DONE:
Ha finalizado la generaci√≥n del aviso.

ERROR

Output

BOOL

I, Q, M, D, L

El par√°metro de estado ERROR
ERROR=TRUE significa que se ha produci‚Äê
do un error durante el procesamiento. Para
m√°s detalles, v√©ase el par√°metro STATUS.

STATUS

Output

WORD

I, Q, M, D, L

Par√°metro de estado STATUS: Ver una in‚Äê
formaci√≥n de error

6078

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

ACK_STATE

Output

WORD

I, Q, M, D, L

Mapa de bits con el estado de acuse actual
de los ocho avisos (1: Evento acusado, 0:
Evento no acusado):
‚óè Los bits de 0 a 7 se reproducen en el
evento entrante en SIG_1 a SIG_7
‚óè Los bits de 8 a 15 se reproducen en el
evento saliente en SIG_1 a SIG_7
‚óè Estado de inicializaci√≥n: W#16#FFFF,
es decir, se han acusado todos los
eventos entrantes y salientes

SD_j,

InOut

ANY

1‚â§ j ‚â§10

I, Q, M, D, T, C

Valor asociado con n√∫mero ordinal j
Los valores asociados son v√°lidos para to‚Äê
dos los avisos. Solo se permiten los tipos de
datos BOOL (no permitido: mapa de bits),
BYTE, CHAR, WORD, INT, DWORD, DINT,
REAL, DATE, TOD, TIME, S5TIME, DA‚Äê
TE_AND_TIME.
Nota: Si el puntero ANY accede a un DB,
√©ste siempre debe especificarse (por ej.:
P# DB10.DBX5.0 byte 10).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metros ERROR y STATUS
La siguiente tabla contiene toda la informaci√≥n de error espec√≠fica de la instrucci√≥n
"ALARM_8P" que puede indicarse a trav√©s de los par√°metros ERRORy STATUS.
ERROR

STATUS

Explicaci√≥n

(decimal)
0

11

P√©rdida de aviso: El cambio de se√±al precedente o el aviso precedente no se ha podido enviar
y se sustituye por el aviso actual.

0

22

‚óè Error en el puntero a los valores asociados SD_i:
‚Äì

Referente a la longitud de datos o al tipo de datos

‚Äì

No se puede acceder a los valores asociados en la memoria del usuario, p. ej. debido a
que se ha borrado un DB o a un error de longitud de √°rea

‚Äì

El aviso activado se env√≠a sin valores asociados.

‚óè El par√°metro actual seleccionado de SEVERITY se encuentra por encima del rango
admisible. El aviso activado se env√≠a con SEVERITY=127 .
0

25

La comunicaci√≥n se ha iniciado. El aviso se est√° procesando.

1

1

Problemas de comunicaci√≥n: La conexi√≥n se ha interrumpido o no hay registro.
Si est√° activada la notificaci√≥n controlada por acuse: Indicaci√≥n temporal, si no existen visuali‚Äê
zadores que soporten la notificaci√≥n controlada por acuse.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6079

Instrucciones
4.2 Instrucciones
ERROR

STATUS

Explicaci√≥n

(decimal)
1

4

En la primera llamada:
‚óè La EV_ID indicada se encuentra fuera del rango admisible.
‚óè Existe un error formal del puntero ANY SD_i .
‚óè Se ha rebasado el √°rea de memoria m√°xima transmisible para la CPU por cada "ALARM_8P".

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado)

1

12

Al llamar la instrucci√≥n
‚óè se ha indicado un DB de instancia que no pertenece a "ALARM_8P".
‚óè no se ha indicado ning√∫n DB de instancia, sino un DB global

1

18

EV_ID ya ha sido utilizado por una de las instrucciones "NOTIFY (P√°gina 6080)", "NOTIFY_8P
(P√°gina 6073)", "ALARM (P√°gina 6083)", "ALARM_8 (P√°gina 6075)" o "ALARM_8P".

1

20

La memoria de trabajo disponible no es suficiente.

1

21

El aviso con la EV_ID indicada est√° bloqueado.

Nota
Despu√©s de la primera llamada, todos los bits de la salida ACK_STATEest√°n activados, y se
adoptan los valores anteriores "0" de las entradas SIG_i, 1< i < 8.

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

NOTIFY: Notificar un cambio de se√±al
Descripci√≥n
La instrucci√≥n vigila una se√±al. Tanto con flanco ascendente (evento entrante) como con flanco
descendente (aviso saliente), genera un aviso al cual pueden adjuntarse hasta diez valores
asociados. El aviso se env√≠a a todos los dispositivos registrados al efecto. En la primera
llamada se env√≠a un aviso con el estado de se√±al actual.
Los valores asociados se captan en el momento de la evaluaci√≥n de flancos y se asignan al
aviso.
Por cada instancia de la instrucci√≥n est√° disponible una memoria de avisos con 2 espacios de
memoria. Para m√°s detalles sobre el almacenamiento intermedio de cambios de se√±al, ver
Introducci√≥n a la creaci√≥n de avisos de PLC con instrucciones (P√°gina 6070).
La instrucci√≥n "NOTIFY" se ajusta a la norma IEC 1131-5.

6080

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "NOTIFY":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n
La se√±al que debe vigilarse

SIG

Input

BOOL

I, Q, M, D, L

ID

Input

WORD

I, Q, M, D, L o constante Canal de datos para avisos: W#16#EEEE
ID solo se eval√∫a en la primera llamada.

EV_ID

Input

C_NOTIFY

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0)
EV_ID solo se eval√∫a en la primera llamada.
Tras ello, en cada llamada de "NOTIFY" con
el DB de instancia correspondiente, se utili‚Äê
za el mismo n√∫mero de aviso que en la pri‚Äê
mera llamada.
El n√∫mero de aviso se asigna autom√°tica‚Äê
mente. Con ello se garantiza la coherencia
de los n√∫meros de aviso. El n√∫mero de aviso
debe ser un√≠voco dentro del programa de
usuario.

SEVERITY

Input

WORD

I, Q, M, D, L o constante Peso del evento
Valores posibles: De 0 a 127 (el valor 0 sig‚Äê
nifica el peso m√°ximo)
Este par√°metro no es relevante para el pro‚Äê
cesamiento del aviso.

DONE

Output

BOOL

I, Q, M, D, L

Par√°metro de estado DONE: Ha finalizado
la generaci√≥n del aviso.

ERROR

Output

BOOL

I, Q, M, D, L

El par√°metro de estado ERROR
ERROR=TRUE significa que se ha produci‚Äê
do un error durante el procesamiento. Para
m√°s detalles, v√©ase el par√°metro STATUS.

STATUS

Output

WORD

I, Q, M, D, L

Par√°metro de estado STATUS: Ver una in‚Äê
formaci√≥n de error

SD_i,

InOut

ANY

I, Q, M, D, T, C

1‚â§i ‚â§10

Valor asociado con n√∫mero ordinal i
Solo se permiten los tipos de datos BOOL
(no permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME.
Nota: Si el puntero ANY accede a un DB,
este siempre debe especificarse.
(p. ej.: P# DB10.DBX5.0 byte 10)

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6081

Instrucciones
4.2 Instrucciones

Par√°metros ERROR y STATUS
La tabla siguiente contiene toda la informaci√≥n de error espec√≠fica que puede devolverse a
trav√©s de los par√°metros ERROR y STATUS .
ERROR

STATUS
(decimal)

Explicaci√≥n

0

11

P√©rdida de aviso: El cambio de se√±al precedente o el aviso precedente no se ha podido enviar
y se sustituye por el aviso actual.

0

22

‚óè Error en el puntero a los valores asociados SD_i:
‚Äì

Referente a la longitud de datos o al tipo de datos

‚Äì

No se puede acceder a los valores asociados en la memoria del usuario, p. ej. debido a
que se ha borrado un DB o a un error de longitud de √°rea

‚Äì

El aviso activado se env√≠a sin valores asociados o solo con el n√∫mero de valores
asociados posible en el momento.

‚óè El par√°metro actual seleccionado de SEVERITY se encuentra por encima del rango
admisible. El aviso activado se env√≠a con SEVERITY=127 .
0

25

La comunicaci√≥n se ha iniciado. El aviso se est√° procesando.

1

1

Problemas de comunicaci√≥n: La conexi√≥n se ha interrumpido o no hay registro

1

4

En la primera llamada
‚óè la EV_ID indicada se encuentra fuera del rango admisible
‚óè existe un error formal del puntero ANY SD_i
‚óè se ha rebasado el √°rea de memoria m√°xima transmisible para la CPU por cada "NOTIFY"

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado)

1

12

Al llamar la instrucci√≥n
‚óè se ha indicado un DB de instancia que no pertenece a "NOTIFY".
‚óè no se ha indicado ning√∫n DB de instancia, sino un DB global

1

18

EV_ID ya ha sido utilizado por una de las instrucciones "NOTIFY", "NOTIFY_8P (P√°gina 6073)",
"ALARM (P√°gina 6083)", "ALARM_8 (P√°gina 6075)" o "ALARM_8P (P√°gina 6077)".

1

20

La memoria de trabajo disponible no es suficiente.

1

21

El aviso con la EV_ID indicada est√° bloqueado.

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

6082

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

ALARM: Generar avisos PLC con indicaci√≥n de acuse
Descripci√≥n
La instrucci√≥n vigila una se√±al.
‚óè Modo est√°ndar (es decir, la notificaci√≥n controlada por acuse est√° desactivada): Tanto con
flanco ascendente (evento entrante) como con flanco descendente (aviso saliente), el
bloque genera un aviso al cual pueden adjuntarse hasta diez valores asociados.
‚óè Notificaci√≥n controlada por acuse activada: Una vez generado el aviso entrante, el bloque
no genera m√°s avisos para la se√±al hasta que el evento entrante ha sido acusado en un
visualizador.
Consulte tambi√©n: Introducci√≥n a la creaci√≥n de avisos de PLC con instrucciones
(P√°gina 6070).
El aviso se env√≠a a todos los dispositivos registrados al efecto.
En la primera llamada se env√≠a un aviso con el estado de se√±al actual.
La salida ACK_UP se anula cuando existe un flanco ascendente. Se activa cuando llega el
acuse del evento entrante desde un visualizador registrado.
De modo an√°logo, para la salida ACK_DN se aplica lo siguiente: Se anula cuando existe un
flanco descendente. Se activa cuando llega el acuse del evento saliente desde un visualizador
registrado. Una vez llegado el acuse desde un visualizador registrado, la informaci√≥n de acuse
se transfiere a todos los dispositivos registrados al efecto.
Por cada instancia de la instrucci√≥n "ALARM" est√° disponible una memoria de avisos con dos
espacios de memoria. Para m√°s detalles sobre el almacenamiento intermedio de cambios de
se√±al, ver la secci√≥n "Detecci√≥n de cambio de se√±al" en Introducci√≥n a la creaci√≥n de avisos
de PLC con instrucciones (P√°gina 6070).
La instrucci√≥n "ALARM" se ajusta a la norma IEC 1131-5.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

EN_R

Input

BOOL

I, Q, M, D, L

Par√°metro de control enabled to receive con el
cual, al llamar el bloque, las salidas ACK_UP y
ACK_DN se actualizan (EN_R=1) o no se ac‚Äê
tualizan (EN_R=0). Con EN_R=0, los par√°me‚Äê
tros de salida ACK_UP y ACK_DN permane‚Äê
cen invariables.

SIG

Input

BOOL

I, Q, M, D, L

La se√±al que debe vigilarse

ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Canal de datos para avisos: W#16#EEEE
ID solo se eval√∫a en la primera llamada.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6083

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

EV_ID

Input

C_ALARM

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0)
EV_ID solo se eval√∫a en la primera llamada.
Tras ello, en cada llamada de "ALARM" con el
DB de instancia correspondiente, se utiliza el
mismo n√∫mero de aviso que en la primera lla‚Äê
mada.
El n√∫mero de aviso se asigna autom√°ticamen‚Äê
te. Con ello se garantiza la coherencia de los
n√∫meros de aviso. El n√∫mero de aviso debe
ser un√≠voco dentro del programa de usuario.

SEVERITY

DONE

Input

Output

WORD

BOOL

I, Q, M, D, L o cons‚Äê
tante

I, Q, M, D, L

Peso del evento
Valores posibles: De 0 a 127 (el valor 0 signi‚Äê
fica el peso m√°ximo)
Este par√°metro no es relevante para el proce‚Äê
samiento del aviso.
Par√°metro de estado DONE:
Ha finalizado la generaci√≥n del aviso.

ERROR

Output

BOOL

I, Q, M, D, L

El par√°metro de estado ERROR
ERROR=TRUE significa que se ha producido
un error durante el procesamiento. Para m√°s
detalles, v√©ase el par√°metro STATUS.

STATUS

Output

WORD

I, Q, M, D, L

Par√°metro de estado STATUS: Ver una infor‚Äê
maci√≥n de error

ACK_DN

Output

BOOL

I, Q, M, D, L

El evento saliente ha sido acusado en un vi‚Äê
sualizador.
Estado de inicializaci√≥n: 1

ACK_UP

Output

BOOL

I, Q, M, D, L

El evento entrante ha sido acusado en un vi‚Äê
sualizador.
Estado de inicializaci√≥n: 1

SD_i,

InOut

ANY

I, Q, M, D, T, C

Valor asociado con n√∫mero ordinal i

1‚â§i ‚â§10

Solo se permiten los tipos de datos BOOL (no
permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME.
Nota: Si el puntero ANY accede a un DB, este
siempre debe especificarse. (p. ej.:
P# DB10.DBX5.0 byte 10)

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6084

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros ERROR y STATUS
La siguiente tabla contiene toda la informaci√≥n de error espec√≠fica de la instrucci√≥n "ALARM"
que puede indicarse a trav√©s de los par√°metros ERROR y STATUS .
ERROR

STATUS

Explicaci√≥n

(decimal)
0

11

P√©rdida de aviso: El cambio de se√±al precedente o el aviso precedente no se ha podido enviar
y se sustituye por el aviso actual.

0

22

‚óè Error en el puntero a los valores asociados SD_i:
‚Äì

Referente a la longitud de datos o al tipo de datos

‚Äì

No se puede acceder a los valores asociados en la memoria del usuario, p. ej. debido
a que se ha borrado un DB o a un error de longitud de √°rea

‚Äì

El aviso activado se env√≠a sin valores asociados.

‚óè El par√°metro actual seleccionado de SEVERITY se encuentra por encima del rango
admisible. El aviso activado se env√≠a con SEVERITY=127.
0

25

La comunicaci√≥n se ha iniciado. El aviso se est√° procesando.

1

1

Problemas de comunicaci√≥n: La conexi√≥n se ha interrumpido o no hay registro
Si est√° activada la notificaci√≥n controlada por acuse: Indicaci√≥n temporal, si no existen visua‚Äê
lizadores que soporten la notificaci√≥n controlada por acuse

1

4

En la primera llamada
‚óè la EV_ID indicada se encuentra fuera del rango admisible
‚óè existe un error formal del puntero ANY SD_i
‚óè Se ha rebasado el √°rea de memoria m√°xima transmisible para la CPU por cada ALARM

1

10

El acceso a la memoria de usuario local no es posible (p. ej. acceso a un DB borrado)

1

12

En la llamada de la instrucci√≥n ha ocurrido lo siguiente:
‚óè Se ha indicado un DB de instancia que no pertenece a ALARM
‚óè No se ha indicado ning√∫n DB de instancia, sino un DB global

1

18

EV_ID ya ha sido utilizado por una de las instrucciones "NOTIFY (P√°gina 6080)", "NO‚Äê
TIFY_8P" (P√°gina 6073)", "ALARM", "ALARM_8 (P√°gina 6075)" o "ALARM_8P (P√°gi‚Äê
na 6077)".

1

20

La memoria de trabajo disponible no es suficiente.

1

21

El aviso con la EV_ID indicada est√° bloqueado.

Nota
Despu√©s de la primera llamada, las salidas ACK_UP y ACK_DN tienen el valor "1", y para la
entrada SIG se adopta el valor anterior "0".

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6085

Instrucciones
4.2 Instrucciones

Instrucciones para generar avisos de PLC sin DB de instancia
Comportamiento en arranque de las instrucciones para generar avisos de PLC
Comportamiento en rearranque completo (en caliente)
En el rearranque completo (en caliente), los DBs de instancia de las instrucciones para generar
avisos de PLC se ponen en estado no inicializado. Los par√°metros actuales guardados en los
DBs de instancia permanecen invariables. Con la siguiente llamada de bloque, los par√°metros
ID y EV_ID se eval√∫an de nuevo.

Comportamiento en arranque en fr√≠o
En el arranque en fr√≠o, los contenidos de los DBs de instancia de las instrucciones para generar
avisos de PLC se ajustan a los valores iniciales.

Comportamiento en rearranque
En el rearranque, las instrucciones para generar avisos de PLC se comportan como bloques
de funci√≥n del usuario con posibilidad de continuaci√≥n. Contin√∫an ejecut√°ndose a partir del
punto de interrupci√≥n.

Comportamiento tras un borrado total
El borrado total siempre implica la interrupci√≥n de todas las conexiones, de modo que ya no
hay ning√∫n dispositivo registrado para avisos. Se borra el programa de usuario. Si se ha
insertado una tarjeta FLASH, las partes del programa relevantes para la ejecuci√≥n se cargan
de nuevo en la CPU desde la tarjeta, y la CPU efect√∫a un rearranque completo (en caliente) o
un arranque en fr√≠o (impl√≠citamente siempre se trata de un arranque en fr√≠o, ya que tras el
borrado total todos los datos del usuario quedan inicializados).

Comportamiento en fallo de las instrucciones para generar avisos de PLC
Interrupci√≥n de la conexi√≥n
Las conexiones asignadas a las instancias se vigilan para detectar su posible interrupci√≥n. En
caso de interrupci√≥n de la conexi√≥n, el dispositivo afectado se borra de la lista interna de la
CPU de los dispositivos registrados para avisos de PLC. Se borran los avisos todav√≠a
pendientes para ese dispositivo.
Si despu√©s de una interrupci√≥n de conexi√≥n existen todav√≠a otros dispositivos registrados,
√©stos siguen recibiendo avisos. Las instrucciones no dejar√°n de enviar avisos hasta que est√©n
interrumpidas las conexiones con todos los dispositivos registrados. Tras ello se realiza una
notificaci√≥n a trav√©s de los par√°metros de salida ERROR y STATUS (ERROR = 1, STATUS =
1).

6086

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Interfaz de error con el programa de usuario
Si al procesarse una instrucci√≥n para generar avisos de PLC se produce un error, el par√°metro
de salida ERROR se ajusta a "1", y se registra en el par√°metro de salida STATUS la
correspondiente identificaci√≥n de error. Esta informaci√≥n de error se puede evaluar en el
programa.
Ejemplos de posibles errores:
‚óè La transmisi√≥n no es posible debido a falta de recursos
‚óè Error al acceder a una de las se√±ales que se deben vigilar

Introducci√≥n a la creaci√≥n de avisos de PLC con instrucciones
Instrucciones para generar avisos de PLC
Pueden generarse avisos de PLC con las siguientes instrucciones:
‚óè "ALARM_SQ (P√°gina 6092)"
‚óè "ALARM_S (P√°gina 6090)"
‚óè "ALARM_DQ (P√°gina 6096)"
‚óè "ALARM_D (P√°gina 6094)"
Estas instrucciones tienen las siguientes caracter√≠sticas:
‚óè Los avisos de PLC enviados de "ALARM_SQ (P√°gina 6092)" y "ALARM_DQ
(P√°gina 6096)" con el estado de se√±al "1" pueden acusarse desde un visualizador
registrado. Los avisos de PLC de "ALARM_S" (P√°gina 6090) y "ALARM_D (P√°gina 6094)"
siempre se acusan de modo impl√≠cito.
‚óè Los avisos de PLC no se generan al detectarse un cambio de flanco, sino al producirse
cualquier llamada.
‚óè Despu√©s de la ejecuci√≥n del bloque, el valor asociado SD est√° captado por completo y
asignado al aviso de PLC.
En lo referente a la coherencia respecto a clases de prioridad de mayor prioridad, se aplica
al valor asociado lo siguiente: Son coherentes
‚Äì los tipos de datos simples (bit, byte, palabra y palabra doble)
‚Äì una matriz del tipo de datos Byte hasta una longitud m√°xima espec√≠fica de CPU

ALARM_SC
Con ayuda de la instrucci√≥n "ALARM_SC (P√°gina 6098)" es posible determinar
‚óè el estado de acuse del √∫ltimo "aviso entrante" y el estado de se√±al en la √∫ltima llamada de
"ALARM_SQ (P√°gina 6092)" / "ALARM_DQ (P√°gina 6096)", o bien
‚óè el estado de se√±al en la √∫ltima llamada de "ALARM_S (P√°gina 6090)" / "ALARM_D
(P√°gina 6094)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6087

Instrucciones
4.2 Instrucciones

Registro de visualizadores
Para que las instrucciones para generar avisos de PLC env√≠en un aviso de PLC al producirse
una llamada, es necesario que haya por lo menos un visualizador registrado para avisos de
PLC.

Respaldo de avisos
Para evitar en lo posible que se pierdan avisos incluso en caso de sobrecarga del sistema de
comunicaci√≥n, las instrucciones "ALARM_SQ (P√°gina 6092)", "ALARM_S (P√°gina 6090)",
"ALARM_DQ (P√°gina 6096)" y "ALARM_D (P√°gina 6094)" pueden almacenar en memoria
intermedia dos avisos cada una.
Si, a pesar de ello, se pierden avisos de PLC, esto se notifica mediante RET_VAL. Con el
siguiente aviso de PLC que pueda enviarse, los visualizadores registrados recibir√°n una
notificaci√≥n al respecto.

Acuse de aviso con "ALARM_SQ" y "ALARM_DQ"
Cuando se acusa en un visualizador un "aviso entrante", esta informaci√≥n de acuse se env√≠a
en primer lugar a la CPU que ha provocado el aviso. Desde all√≠ se distribuye la informaci√≥n de
acuse a todos los visualizadores registrados al efecto.

Bloquear y habilitar avisos
Los avisos de PLC generados con "ALARM_SQ (P√°gina 6092)", "ALARM_S (P√°gina 6090)",
"ALARM_DQ (P√°gina 6096)" o "ALARM_D (P√°gina 6094)", no se pueden bloquear y a
continuaci√≥n volver a habilitar.

Modificaciones de un programa que contiene llamadas a "ALARM_SQ" / "ALARM_S"
Nota
Al cargar un bloque ya existente en la CPU con llamadas a "ALARM_SQ (P√°gina 6092)" /
"ALARM_S (P√°gina 6090)", es posible que el bloque anterior haya enviado un aviso de PLC
entrante, pero el nuevo bloque no env√≠e el correspondiente aviso de PLC saliente. En este
caso, el aviso permanece en la memoria interna de avisos de la CPU. Esta situaci√≥n puede
producirse tambi√©n cuando se borran bloques con llamadas de "ALARM_SQ (P√°gina 6092)" /
"ALARM_S (P√°gina 6090)".
Para borrar de la memoria interna de avisos este tipo de avisos de PLC, debe ponerse la CPU
en el estado operativo STOP y a continuaci√≥n efectuar un rearranque completo (en caliente)
o un arranque en fr√≠o.

Modificaciones de un programa que contiene llamadas a "ALARM_DQ" / "ALARM_D"
Aunque el programa contenga llamadas a "ALARM_DQ (P√°gina 6096)" y/o "ALARM_D
(P√°gina 6094)", las mencionadas modificaciones del programa pueden provocar que queden
avisos de PLC en la memoria interna de avisos, ocupando de modo permanente recursos del
sistema.

6088

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
A diferencia de los recursos del sistema asignados mediante llamadas de "ALARM_SQ
(P√°gina 6092)" / "ALARM_S (P√°gina 6090)", los recursos del sistema asignados mediante
llamadas de "ALARM_DQ (P√°gina 6096)" / "ALARM_D (P√°gina 6094)" pueden liberarse sin
necesidad de poner la CPU en el estado operativo STOP. Para esto debe usarse la instrucci√≥n
"DEL_SI (P√°gina 6112)". Antes de liberar recursos del sistema asignados de modo din√°mico
"DEL_SI", puede ser √∫til leer con la instrucci√≥n "READ_SI" la informaci√≥n acerca de este tipo
de recursos del sistema en la CPU en el momento actual (ver instrucci√≥n "READ_SI
(P√°gina 6109)").

N√∫mero de datos transmisibles
El n√∫mero de datos transmisibles a trav√©s del valor asociado SD de las instrucciones
"ALARM_S (P√°gina 6090)", "ALARM_SQ (P√°gina 6092)", "ALARM_D (P√°gina 6094)" y
"ALARM_DQ (P√°gina 6096)" no debe superar una determinada longitud m√°xima. Esta longitud
de datos m√°xima se calcula de la siguiente manera:

longmax = min (pdu_local, pdu_remota) - 48
Donde:
‚óè pdu_local es la longitud m√°xima de los bloques de datos de la CPU propia (SZL_ID
W#16#0131, INDEX 1, variable pdu)
‚óè pdu_remota es la longitud m√°xima de los bloques de datos de los visualizadores

Ejemplo
Supongamos que una CPU 414-2 env√≠a avisos a una PG 760 (a trav√©s de MPI).

pdu_local = 480 bytes, pdu_remota = 480 bytes,
Se aplica lo siguiente:

longmax = min (480, 480) - 48 = 480 - 48 = 432
Por lo tanto, la longitud de datos m√°xima transmisible por instrucci√≥n es de 432 bytes.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6089

Instrucciones
4.2 Instrucciones

ALARM_S: Generar aviso de alarma
Descripci√≥n
La instrucci√≥n genera para cada llamada un aviso al que puede adjuntarse un valor asociado.
El aviso se env√≠a a todos los dispositivos registrados al efecto. De este modo, la instrucci√≥n
pone a disposici√≥n del usuario un sencillo mecanismo de notificaci√≥n. Debe tenerse en cuenta
que la instrucci√≥n solo se llama cuando el valor de la se√±al SIG que dispara el aviso est√°
invertido con respecto a la √∫ltima llamada. De lo contrario, se notifica a trav√©s de RET_VAL, y
no se env√≠a ning√∫n aviso. En la primera llamada de la instrucci√≥n, hay que asegurarse de que
en la entrada SIG est√© ajustado el valor "1". De lo contrario, se recibe a trav√©s de RET_VAL una
informaci√≥n de error y no se env√≠a ning√∫n aviso.
Nota
En los programas nuevos que se vayan a crear, se recomienda usar siempre la instrucci√≥n
"ALARM_D (P√°gina 6094)" (si la CPU la soporta), ya que ofrece mejores posibilidades de
administraci√≥n de los recursos del sistema.

Asignaci√≥n de recursos del sistema
Al generar un aviso, el sistema operativo asigna un recurso del sistema para toda la duraci√≥n
de un ciclo de se√±al.
El ciclo de se√±al se prolonga desde la llamada con SIG=1 hasta la siguiente llamada con
SIG=0. Si dentro del ciclo de se√±al se sobrecarga o se borra el bloque que genera el aviso, el
correspondiente recurso del sistema queda ocupado hasta el siguiente rearranque completo
(en caliente).

Acuse de avisos
Los avisos que se han enviado con "ALARM_S" siempre est√°n acusados de modo impl√≠cito. El
estado de se√±al en la √∫ltima llamada de "ALARM_S se puede determinar con ayuda de
"ALARM_SC (P√°gina 6098)".

Almacenamiento intermedio de estados de se√±al
La instrucci√≥n "ALARM_S" ocupa recursos del sistema. En ellos se almacenan
temporalmente, entre otras cosas, los dos √∫ltimos estados de se√±al, incluido el sello de tiempo
y el valor asociado. Si se produce una llamada a "ALARM_S" en un momento en que los
estados de se√±al de las dos √∫ltimas llamadas "v√°lidas" no han sido enviados todav√≠a
(desbordamiento de se√±al), se descartan el estado de se√±al actual y el √∫ltimo estado de se√±al
y se registra en la memoria intermedia una identificaci√≥n de desbordamiento. En el primer
momento en que sea posible, se env√≠a la pen√∫ltima se√±al junto con el identificador de
desbordamiento.
Ejemplo:

6090

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

W

W

W

Supongamos que t0, t1 y t2 son los momentos de llamada de "ALARM_S". Si los estados de
se√±al de t0 y t1 todav√≠a no han sido enviados en el momento t2, se descartan los estados de
se√±al de t1 y t2, y en el estado de se√±al de t0 se activa el identificador de desbordamiento.

Desbordamiento de instancia
Si el n√∫mero de llamadas de "ALARM_S" es mayor que el n√∫mero m√°ximo de recursos del
sistema de la CPU, puede producirse una escasez de recursos (desbordamiento de instancia).
Esto se notifica mediante informaci√≥n de error en RET_VAL, as√≠ como en los visualizadores
registrados.
El n√∫mero m√°ximo de llamadas de "ALARM_S" depende de la CPU.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM_S":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n
La se√±al que dispara el aviso

SIG

Input

BOOL

I, Q, M, D, L

ID

Input

WORD

I, Q, M, D, L o constante Canal de datos para avisos: W#16#EEEE

EV_ID

Input

C_ALARM_S

I, Q, M, D, L

SD

Input

ANY

I, Q, M, D, T, C

N√∫mero de aviso (no permitido: "0")
Valor asociado
Longitud m√°xima: 12 bytes
Solo se permiten los tipos de datos BOOL
(no permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME.

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

0001

‚óè El valor asociado supera la longitud m√°xima admisible.
‚óè No es posible acceder a la memoria de usuario local (p. ej. acceso a un DB borrado) El aviso se env√≠a.
‚óè El valor asociado se√±ala un valor en el √°rea de datos local. El aviso se env√≠a. (solo S7-400)

0002

Advertencia: Se ha asignado el √∫ltimo espacio de memoria libre para acuse de avisos. (solo S7-400)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6091

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
8081

La EV_ID indicada se encuentra fuera del rango admisible.

8082

Se pierde el aviso, ya que la CPU no tiene m√°s recursos libres para generar avisos de PLC mediante
instrucciones.

8083

Se pierde el aviso, ya que ese cambio de se√±al ya existe, pero todav√≠a no se ha podido enviar (desbor‚Äê
damiento de se√±al).

8084

En la llamada actual y anterior a "ALARM_S", la se√±al que dispara el aviso SIG tiene el mismo valor.

8085

No existe registro para la EV_ID indicada.

8086

Ya se est√° procesando en una clase de prioridad menor una llamada para la EV_ID indicada.

8087

En la primera llamada de "ALARM_S", la se√±al que dispara el aviso ten√≠a el valor "0".

8088

La EV_ID indicada ya est√° ocupada por otro recurso del sistema ("ALARM_S", ALARM_DQ (P√°gi‚Äê
na 6096) , ALARM_D (P√°gina 6094)).

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

ALARM_SQ: Generar aviso de alarma con acuse
Descripci√≥n
La instrucci√≥n genera para cada llamada un aviso al que puede adjuntarse un valor asociado.
El aviso se env√≠a a todos los dispositivos registrados al efecto. "De este modo, ALARM_SQ"
pone a disposici√≥n del usuario un sencillo mecanismo de notificaci√≥n. Recuerde que
"ALARM_SQ" solo debe llamarse cuando el valor de la se√±al SIG que dispara el aviso est√°
invertido con respecto a la √∫ltima llamada. De lo contrario, se notifica a trav√©s de RET_VAL, y
no se env√≠a ning√∫n aviso. En la primera llamada de "ALARM_SQ", debe asegurarse de que en
la entrada SIG est√© ajustado el valor "1". De lo contrario, se recibe a trav√©s de RET_VAL una
informaci√≥n de error y no se env√≠a ning√∫n aviso.
Nota
En los programas nuevos que se vayan a crear, se recomienda usar siempre la instrucci√≥n
"ALARM_DQ (P√°gina 6096)" (si la CPU la soporta), ya que ofrece mejores posibilidades de
administraci√≥n de los recursos del sistema.

Asignaci√≥n de recursos del sistema
Al generar un aviso con "ALARM_SQ", el sistema operativo asigna un recurso del sistema para
la duraci√≥n de un ciclo de se√±al.
Con "ALARM_SQ, el ciclo de se√±al se prolonga desde la llamada con SIG=1 hasta la siguiente
llamada con SIG=0. A ese intervalo debe sumarse, en su caso, el tiempo transcurrido hasta el
acuse de la se√±al entrante desde uno de los visualizadores registrados.

6092

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Si dentro del ciclo de se√±al se sobrecarga o se borra el bloque que genera el aviso, el
correspondiente recurso del sistema queda ocupado hasta el siguiente rearranque completo
(en caliente).

Acuse de avisos
Los avisos enviados por "ALARM_SQ" pueden acusarse con el estado de se√±al "1" en un
visualizador registrado. El estado de acuse del √∫ltimo "aviso entrante" y el estado de se√±al en
la √∫ltima llamada de "ALARM_SQ pueden consultarse con ayuda de la instrucci√≥n
"ALARM_SC (P√°gina 6098)".

Almacenamiento intermedio de estados de se√±al
"ALARM_SQ" ocupa recursos del sistema. En ellos se almacenan temporalmente, entre otras
cosas, los dos √∫ltimos estados de se√±al, incluido el sello de tiempo y el valor asociado. Si se
produce una llamada a "ALARM_SQ" en un momento en que los estados de se√±al de las dos
√∫ltimas llamadas "v√°lidas" no han sido enviados todav√≠a (desbordamiento de se√±al), se
descartan el estado de se√±al actual y el √∫ltimo estado de se√±al y se registra en la memoria
intermedia una identificaci√≥n de desbordamiento. En el primer momento en que sea posible,
se env√≠a la pen√∫ltima se√±al junto con el identificador de desbordamiento.
Ejemplo:

W

W

W

Supongamos que t0, t1 y t2 son los momentos de llamada de "ALARM_SQ". Si los estados de
se√±al de t0 y t1 todav√≠a no han sido enviados en el momento t2, se descartan los estados de
se√±al de t1 y t2, y en el estado de se√±al de t0 se activa el identificador de desbordamiento.

Desbordamiento de instancia
Si el n√∫mero de llamadas de "ALARM_SQ" es mayor que el n√∫mero m√°ximo de recursos del
sistema de la CPU, puede producirse una escasez de recursos (desbordamiento de instancia).
Esto se notifica mediante informaci√≥n de error en RET_VAL, as√≠ como en los visualizadores
registrados.
El n√∫mero m√°ximo de llamadas de "ALARM_SQ" depende de la CPU.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM_SQ":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SIG

Input

BOOL

I, Q, M, D, L

La se√±al que dispara el aviso

ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Canal de datos para avisos: W#16#EEEE

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6093

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

EV_ID

Input

C_ALARM_S

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0)

SD

Input

ANY

I, Q, M, D, T, C

Valor asociado
Longitud m√°xima: 12 bytes
Solo se permiten los tipos de datos BOOL (no
permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME.

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

0001

‚óè El valor asociado supera la longitud m√°xima admisible.
‚óè No es posible acceder a la memoria de usuario local (p. ej. acceso a un DB borrado) El aviso se env√≠a.
‚óè El valor asociado se√±ala un valor en el √°rea de datos local. El aviso se env√≠a. (solo S7-400)

0002

Advertencia: Se ha asignado el √∫ltimo espacio de memoria libre para acuse de avisos. (solo S7-400)

8081

La EV_ID indicada se encuentra fuera del rango admisible.

8082

Se pierde el aviso, ya que la CPU no tiene m√°s recursos libres para generar avisos de PLC mediante
instrucciones.

8083

Se pierde el aviso, ya que ese cambio de se√±al ya existe, pero todav√≠a no se ha podido enviar (desbor‚Äê
damiento de se√±al).

8084

En la llamada actual y anterior a "ALARM_SQ", la se√±al que dispara el aviso SIGtiene el mismo valor.

8085

No existe registro para la EV_ID indicada.

8086

Ya se est√° procesando en una clase de prioridad menor una llamada para la EV_ID indicada.

8087

En la primera llamada de "ALARM_SQ", la se√±al que dispara el aviso ten√≠a el valor "0".

8088

La EV_ID indicada ya est√° ocupada por otro recurso del sistema (ALARM_S (P√°gina 6090), ALARM_DQ
(P√°gina 6096), ALARM_D (P√°gina 6094)).

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

ALARM_D: Generar siempre avisos PLC acusados
Descripci√≥n
La instrucci√≥n genera para cada llamada un aviso de PLC al que puede adjuntarse un valor
asociado. En esto coincide con la instrucci√≥n "ALARM_S (P√°gina 6090)".

6094

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Al generar un aviso con "ALARM_D", el sistema operativo asigna un recurso del sistema para
la duraci√≥n de un ciclo de se√±al.
Con "ALARM_D, el ciclo de se√±al se prolonga desde la llamada con SIG=1 hasta la siguiente
llamada con SIG=0. Si dentro del ciclo de se√±al se sobrecarga o se borra el bloque que genera
el aviso, el correspondiente recurso del sistema queda ocupado hasta el siguiente rearranque
completo (en caliente).
La diferencia funcional entre "ALARM_D" y "ALARM_S (P√°gina 6090)" consiste en que el
usuario puede administrar esos recursos del sistema ocupados.
‚óè Con ayuda de READ_SI puede leerse informaci√≥n acerca de los recursos del sistema.
‚óè Con DEL_SI pueden liberarse recursos del sistema ocupados. Esto es especialmente √∫til
cuando los recursos del sistema est√°n ocupados de modo permanente. Un recurso del
sistema permanece ocupado p. ej. hasta el pr√≥ximo rearranque completo (en caliente)
cuando, al efectuar una modificaci√≥n del programa, se borra una llamada de FB que
contiene llamadas de "ALARM_D". Si, al efectuar una modificaci√≥n del programa, se carga
de nuevo un FB con llamadas de "ALARM_D", puede suceder que "ALARM_D" no genere
m√°s avisos de PLC.
La instrucci√≥n "ALARM_D" tiene un par√°metro m√°s que la instrucci√≥n "ALARM_S
(P√°gina 6090)": se trata de la entrada CMP_ID. Con ella se asignan los avisos de PLC
generados con la instrucci√≥n "ALARM_D" a √°reas l√≥gicas, p. ej. instalaciones parciales. Si se
llama "ALARM_D" en un FB, es conveniente asignar a "CMP_ID" el n√∫mero del DB de instancia
correspondiente.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM_D":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SIG

Input

BOOL

I, Q, M, D, L

La se√±al que dispara el aviso

ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Canal de datos para avisos: W#16#EEEE

EV_ID

Input

C_ALARM_S

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0)

CMP_ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

component identifier (no autorizado: 0)
Identificador del sistema parcial al que est√°
asignado el aviso en cuesti√≥n
Valores recomendados:
‚óè low word: de 1 a 65535
‚óè high word: 0
Atendiendo a esta recomendaci√≥n, se evi‚Äê
tan posibles conflictos con paquetes de pro‚Äê
gramaci√≥n creados por SIEMENS.

SD

Input

ANY

I, Q, M, D, T, C

Valor asociado
Longitud m√°xima: 12 bytes
Solo se permiten los tipos de datos BOOL
(no permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME

RET_VAL

Return

INT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

I, Q, M, D, L

Informaci√≥n de error

6095

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

0001

‚óè El valor asociado supera la longitud m√°xima admisible, o
‚óè No es posible acceder a la memoria de usuario local (p. ej. acceso a un DB borrado) El aviso se env√≠a.
‚óè El valor asociado se√±ala un valor en el √°rea de datos local. El aviso se env√≠a. (solo S7-400)

0002

Advertencia: Se ha asignado el √∫ltimo espacio de memoria libre para acuse de avisos. (solo S7-400)

8081

La EV_ID indicada se encuentra fuera del rango admisible.

8082

Se pierde el aviso, ya que la CPU no tiene m√°s recursos libres para generar avisos de PLC mediante
instrucciones.

8083

Se pierde el aviso, ya que ese cambio de se√±al ya existe, pero todav√≠a no se ha podido enviar (desbor‚Äê
damiento de se√±al).

8084

En la llamada actual y anterior a "ALARM_D", la se√±al que dispara el aviso SIGtiene el mismo valor.

8085

No existe registro para la EV_ID indicada.

8086

Ya se est√° procesando en una clase de prioridad menor una llamada para la EV_ID indicada.

8087

En la primera llamada de "ALARM_D", la se√±al que dispara el aviso ten√≠a el valor "0".

8088

La EV_ID indicada ya est√° ocupada por otro recurso del sistema ("ALARM_SQ (P√°gina 6092)",
"ALARM_S (P√°gina 6090)", "ALARM_DQ" (P√°gina 6096)).

8089

Se ha asignado a CMP_ID el valor "0".

808A

CMP_ID no concuerda con EV_ID

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

ALARM_DQ: Generar avisos PLC acusables
Descripci√≥n
La instrucci√≥n "ALARM_DQ" genera para cada llamada un aviso al que puede adjuntarse un
valor asociado. En esto coincide con la instrucci√≥n "ALARM_SQ (P√°gina 6092)".
Al generar un aviso con "ALARM_DQ", el sistema operativo asigna un recurso del sistema para
toda la duraci√≥n de un ciclo de se√±al.
Con "ALARM_DQ, el ciclo de se√±al se prolonga desde la llamada con SIG=1 hasta la siguiente
llamada con SIG=0. A ese intervalo debe sumarse, en su caso, el tiempo transcurrido hasta el
acuse de la se√±al entrante desde uno de los visualizadores registrados.

6096

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Si dentro del ciclo de se√±al se sobrecarga o se borra el bloque que genera el aviso, el
correspondiente recurso del sistema queda ocupado hasta el siguiente rearranque completo
(en caliente).
La diferencia de funcionalidad de "ALARM_DQ" respecto a "ALARM_SQ (P√°gina 6092)"
consiste en que es posible administrar los recursos del sistema ocupados en "ALARM_DQ".
‚óè "READ_SI (P√°gina 6109)" permite leer informaci√≥n acerca de los recursos del sistema
ocupados.
‚óè Con "DEL_SI (P√°gina 6112)" se liberan recursos del sistema ocupados. Esto es
especialmente √∫til cuando los recursos del sistema est√°n ocupados de modo permanente.
Un recurso del sistema permanece ocupado p. ej. hasta el siguiente rearranque completo
(en caliente) cuando, al efectuar una modificaci√≥n del programa, se borra una llamada de
FB que contiene llamadas de "ALARM_DQ". Si, al efectuar una modificaci√≥n del programa,
se carga de nuevo un FB con llamadas de "ALARM_DQ", puede suceder que "ALARM_DQ"
no genere m√°s avisos de PLC.
La instrucci√≥n "ALARM_DQ" tiene un par√°metro m√°s que las instrucciones "ALARM_SQ
(P√°gina 6092)": se trata de la entrada CMP_ID. Con ella se asignan los avisos de PLC
generados con las instrucciones "ALARM_DQ" a √°reas l√≥gicas, p. ej. instalaciones parciales.
Si se llama "ALARM_DQ" en un FB, es conveniente asignar a "CMP_ID" el n√∫mero del DB de
instancia correspondiente.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM_DQ":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SIG

Input

BOOL

I, Q, M, D, L

La se√±al que dispara el aviso

ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Canal de datos para avisos: W#16#EEEE

EV_ID

Input

C_ALARM_S

I, Q, M, D, L

N√∫mero de aviso (no permitido: 0)

CMP_ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

component identifier (no autorizado: 0); Identi‚Äê
ficador del sistema parcial al que est√° asigna‚Äê
do el aviso en cuesti√≥n
Valores recomendados:
‚óè low word: de 1 a 65535
‚óè high word: 0
Atendiendo a esta recomendaci√≥n, se evitan
posibles conflictos con paquetes de programa‚Äê
ci√≥n creados por SIEMENS.

SD

Input

ANY

I, Q, M, D, T, C

Valor asociado
Longitud m√°xima: 12 bytes
Solo se permiten los tipos de datos BOOL (no
permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME

RET_VAL

Return

INT

I, Q, M, D, L

Mostrar

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6097

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

0001

‚óè El valor asociado supera la longitud m√°xima admisible, o
‚óè No es posible acceder a la memoria de usuario local (p. ej. acceso a un DB borrado) El aviso se env√≠a.
‚óè El valor asociado se√±ala un valor en el √°rea de datos local. El aviso se env√≠a. (solo S7-400)

0002

Advertencia: Se ha asignado el √∫ltimo espacio de memoria libre para acuse de avisos. (solo S7-400)

8081

La EV_ID indicada se encuentra fuera del rango admisible.

8082

Se pierde el aviso, ya que la CPU no tiene m√°s recursos libres para generar avisos de PLC mediante
instrucciones.

8083

Se pierde el aviso, ya que ese cambio de se√±al ya existe, pero todav√≠a no se ha podido enviar (desbor‚Äê
damiento de se√±al).

8084

En la llamada actual y anterior a "ALARM_DQ", la se√±al que dispara el aviso SIG tiene el mismo valor.

8085

No existe registro para la EV_ID indicada.

8086

Ya se est√° procesando en una clase de prioridad menor una llamada para la EV_ID indicada.

8087

En la primera llamada de "ALARM_DQ", la se√±al que dispara el aviso ten√≠a el valor "0".

8088

La EV_ID indicada ya est√° ocupada por otro recurso del sistema (ALARM_SQ (P√°gina 6092), ALARM_S
(P√°gina 6090), ALARM_D (P√°gina 6094)).

8089

Se ha asignado a CMP_ID el valor "0".

808A

CMP_ID no concuerda con EV_ID

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

ALARM_SC: Determinar el estado de acuse del √∫ltimo aviso entrante ALARM_SQ
Descripci√≥n
Con ayuda de esta instrucci√≥n es posible determinar
‚óè el estado de acuse del √∫ltimo aviso entrante de "ALARM_SQ (P√°gina 6092)" / "ALARM_DQ
(P√°gina 6096)" y el estado de la se√±al que ha disparado el aviso en la √∫ltima llamada de
"ALARM_SQ (P√°gina 6092)" / "ALARM_DQ (P√°gina 6096)", o bien
‚óè el estado de la se√±al que ha disparado el aviso en la √∫ltima llamada de "ALARM_S
(P√°gina 6090)" / "ALARM_D (P√°gina 6094)"
. Si se han asignado los n√∫meros de aviso con ayuda de la configuraci√≥n de avisos, el aviso o
la se√±al est√°n referenciados de manera un√≠voca a trav√©s del n√∫mero de aviso especificado por
el usuario.
La instrucci√≥n accede a la memoria ocupada temporalmente de las instrucciones "ALARM_SQ
(P√°gina 6092)", "ALARM_S (P√°gina 6090)", "ALARM_DQ (P√°gina 6096)" y "ALARM_D
(P√°gina 6094)".

6098

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ALARM_SC":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

EV_ID

Input

C_ALARM_S

I, Q, M, D, L

N√∫mero de aviso para el que se desea conocer
el estado de se√±al en la √∫ltima llamada o el
estado de acuse del √∫ltimo aviso entrante (solo
con ALARM_SQ y con ALARM_DQ)

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

STATE

Output

BOOL

I, Q, M, D, L

Estado de la se√±al que ha disparado el aviso
en la √∫ltima llamada

Q_STATE

Output

BOOL

I, Q, M, D, L

‚óè si el par√°metro EV_ID indicado
corresponde a una llamada de
"ALARM_S" / "ALARM_D": "1"
‚óè si el par√°metro EV_ID indicado
corresponde a una llamada de
"ALARM_SQ" / "ALARM_DQ": Estado de
acuse del √∫ltimo aviso entrante:
‚Äì

0: no acusado

‚Äì

1: acusado

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8081

La EV_ID indicada se encuentra fuera del rango admisible.

8082

En este momento no hay ning√∫n espacio de memoria asignado para esta EV_ID (posible causa: La se√±al
correspondiente todav√≠a no ha tenido nunca el estado "1", o ya ha vuelto a adoptar el estado "0").

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Consulte tambi√©n
Crear avisos de programa (P√°gina 8326)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6099

Instrucciones
4.2 Instrucciones

WR_USMSG: Escribir evento de diagn√≥stico de usuario en el b√∫fer de diagn√≥stico
Descripci√≥n
Esta instrucci√≥n permite escribir un evento de diagn√≥stico del usuario en el b√∫fer de
diagn√≥stico. Adem√°s es posible enviar el correspondiente aviso de diagn√≥stico del usuario a
todos los dispositivos registrados a tal efecto (asignando el par√°metro de entrada SEND =
TRUE). Cuando se produce un error, el par√°metro de salida RET_VAL contiene la informaci√≥n
de error.

Enviar aviso de diagn√≥stico del usuario
Con la instrucci√≥n, un evento de diagn√≥stico de usuario se registra en el b√∫fer de diagn√≥stico.
Adem√°s es posible enviar el correspondiente aviso de diagn√≥stico del usuario tambi√©n a todos
los dispositivos registrados al efecto (asignando el par√°metro de entrada SEND = TRUE). En
ese caso, el aviso de diagn√≥stico del usuario se escribe en el b√∫fer de transmisi√≥n y desde all√≠
se env√≠a autom√°ticamente a los dispositivos registrados al efecto.
Se puede comprobar si en el momento actual es posible enviar avisos de diagn√≥stico del
usuario. Para ello se llama la instrucci√≥n "RDSYSST (P√°gina 6116)" con los par√°metros
SZL_ID = W#16#0132 y INDEX = W#16#0005. La cuarta palabra del registro que se devuelve
indica si en el momento actual la transmisi√≥n es posible (1) o no (0).
'LVSRVLWLYR

&38

SHM3*23
6(1' 
758(

%¬ºIHUGH
WUDQVPLVL¬µQ


:5B8606*




%¬ºIHUGHGLDJQ¬µVWLFR

7UDQVPLVL¬µQHQPRGR
DV¬ØQFURQRUHVSHFWRDO
SURJUDPDGHXVXDULR



B√∫fer de transmisi√≥n lleno
Para introducir un aviso de diagn√≥stico del usuario en el b√∫fer de transmisi√≥n es necesario que
√©ste no se encuentre lleno. La cantidad de entradas posibles en el b√∫fer de transmisi√≥n
depende del tipo de CPU.
Cuando el b√∫fer de transmisi√≥n est√° lleno, entonces
‚óè se registra pese a ello el evento de diagn√≥stico en el b√∫fer de diagn√≥stico
‚óè se indica en el par√°metro RET_VAL que el b√∫fer de transmisi√≥n est√° lleno.
(RET_VAL = W#16#8092).

6100

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Dispositivo no registrado
Si se debe enviar un aviso de diagn√≥stico de usuario (SEND = TRUE) y no hay ning√∫n
dispositivo registrado, entonces
‚óè se registra pese a ello el evento de diagn√≥stico de usuario en el b√∫fer de diagn√≥stico.
‚óè se indica en el par√°metro RET_VAL que no hay ning√∫n dispositivo registrado (W#16#0091
o W#16#8091. El valor W#16#8091 aparece en versiones antiguas de la CPU).

Estructura de una entrada
Las entradas en el b√∫fer de diagn√≥stico tienen la siguiente estructura interna:
Byte

Contenido

1y2

ID de evento

3

Clase de prioridad

4

N√∫mero de OB

5y6

Reservado

7y8

Informaci√≥n adicional 1

9, 10, 11 y 12

Informaci√≥n adicional 2

de 13 a 20

Sello de tiempo

ID de evento
Cada evento tiene asignada una ID de evento.

Informaci√≥n adicional
La informaci√≥n adicional contiene datos adicionales sobre el evento. El contenido de la
informaci√≥n adicional puede variar seg√∫n el evento en cuesti√≥n. Si se genera un evento de
diagn√≥stico de usuario, se puede definir de modo personalizado el contenido de estas
entradas.
Cuando se env√≠a un aviso de diagn√≥stico de usuario, se puede integrar la informaci√≥n adicional
en el texto del aviso (espec√≠fico de ID de evento) en forma de valores asociados.

Sello de tiempo
El sello de tiempo es del tipo Date_and_Time.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6101

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WR_USMSG":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SEND

Input

BOOL

I, Q, M, D, L

Habilitar el env√≠o del aviso de diagn√≥stico de
usuario a todos los dispositivos registrados

EVENTN

Input

WORD

I, Q, M, D, L o constante ID de evento. El usuario asigna la ID de
evento. La asignaci√≥n predeterminada no
se realiza mediante el servidor de avisos.

INFO1

Input

ANY

I, Q, M, D, L

Informaci√≥n adicional: 1 palabra de longitud

INFO2

Input

ANY

I, Q, M, D, L

Informaci√≥n adicional: 2 palabras de longitud

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro SEND
Con SEND = TRUE se env√≠a el aviso de diagn√≥stico del usuario a todos los dispositivos
registrados al efecto. La transmisi√≥n solo se realiza si hay por lo menos un dispositivo
registrado y el b√∫fer de transmisi√≥n no est√° lleno. La transmisi√≥n se realiza de modo as√≠ncrono
respecto al programa de usuario.

Par√°metro EVENTN
El par√°metro EVENTN contiene la ID de evento del evento de usuario. Pueden registrarse IDs
de evento con el formato W#16#8xyz , W#16#9xyz, W#16#Axyz, W#16#Bxyz.
Las IDs con formato W#16#8xyz y W#16#9xyz pertenecen a eventos predefinidos, y las IDs
con formato W#16#Axyz y W#16#Bxyz , a eventos personalizables.
Un evento entrante se identifica mediante x = 1, y un evento saliente con x = 0. Para eventos
de clase A y B se aplica lo siguiente: yz es el n√∫mero, en formato hexadecimal, asignado al
aviso en cuesti√≥n en la configuraci√≥n de avisos.

Par√°metro INFO1
El par√°metro INFO1 contiene una informaci√≥n de una palabra de longitud. Para INFO1 se
admiten los siguientes tipos de datos:
‚óè WORD
‚óè INT
‚óè ARRAY [0...1] OF CHAR
Se puede integrar el par√°metro INFO1 como valor asociado en el texto del aviso para as√≠
a√±adir al aviso informaci√≥n actual.

6102

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro INFO2
El par√°metro INFO2 contiene una informaci√≥n de dos palabras de longitud. Para INFO2 se
admiten los siguientes tipos de datos:
‚óè DWORD
‚óè DINT
‚óè REAL
‚óè TIME
‚óè ARRAY [0...3] OF CHAR
Se puede integrar el par√°metro INFO2 como valor asociado en el texto del aviso para as√≠
a√±adir al aviso informaci√≥n actual.

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

Ning√∫n error

0091

No hay ning√∫n dispositivo registrado (se registra el evento de diagn√≥stico en el b√∫fer de diagn√≥stico)

8083

Tipo de datos INFO1 no admisible

8084

Tipo de datos INFO2 no admisible

8085

EVENTN no admisible

8086

Longitud de INFO1 no admisible

8087

Longitud de INFO2 no admisible

8091

(Este c√≥digo de error aparece solo en versiones antiguas de la CPU.)
No hay ning√∫n dispositivo registrado (se registra el evento de diagn√≥stico en el b√∫fer de diagn√≥stico)

8092

En este momento no es posible la transmisi√≥n: b√∫fer de transmisi√≥n lleno (se registra el evento de
diagn√≥stico en el b√∫fer de diagn√≥stico)

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

AR_SEND: Enviar datos de fichero
Descripci√≥n
Esta instrucci√≥n env√≠a datos de fichero a sistemas de control y observaci√≥n registrados al
efecto. Estos notifican a la CPU el n√∫mero de fichero relevante en el telegrama de registro. Los
datos de fichero pueden tener un tama√±o de hasta 65534 bytes, en funci√≥n de la memoria de
trabajo de la CPU y del √°rea de operandos utilizada. El formato de los datos de fichero debe
tener en cuenta las especificaciones del sistema de control y observaci√≥n utilizado.
El proceso de transmisi√≥n se activa despu√©s de la llamada del bloque y de un flanco
ascendente en la entrada de control REQ. La direcci√≥n inicial de los datos de fichero que se
deben enviar se define mediante SD_1, y la longitud del bloque de datos, mediante LEN. El
env√≠o de los datos se efect√∫a de modo as√≠ncrono respecto al procesamiento del programa de
usuario. La finalizaci√≥n correcta del proceso de transmisi√≥n se indica con "1" en el par√°metro

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6103

Instrucciones
4.2 Instrucciones
de estado DONE. Con un flanco ascendente en la entrada de control R se cancela el proceso
de transmisi√≥n en curso.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "AR_SEND":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

Par√°metro de control request

R

Input

BOOL

I, Q, M, D, L

Par√°metro de control reset: Interrupci√≥n de
la petici√≥n actual

ID

Input

WORD

I, Q, M, D o constante Canal de datos para avisos: W#16#EEEE
ID solo se eval√∫a en la primera llamada.

AR_ID

Input

C_AR_SEND

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de fichero (no autorizado: 0);
AR_ID solo se eval√∫a en la primera llamada.
Tras ello, en cada llamada de "AR_SEND"
con el DB de instancia correspondiente, se
utiliza el mismo n√∫mero de fichero que en la
primera llamada.
El n√∫mero de fichero se asigna autom√°tica‚Äê
mente. Con ello se garantiza la coherencia
de los n√∫meros de fichero.

DONE

Output

BOOL

I, Q, M, D, L

Par√°metro de estado DONE: Transmisi√≥n
finalizada

ERROR

Output

BOOL

I, Q, M, D, L

El par√°metro de estado ERROR:
ERROR=TRUE significa que se ha produci‚Äê
do un error durante el procesamiento. Para
m√°s detalles, v√©ase el par√°metro STATUS.

STATUS

Output

WORD

I, Q, M, D, L

Par√°metro de estado STATUS: Ver una in‚Äê
formaci√≥n de error

SD_1

InOut

ANY

I, Q, M, D, T, C

Puntero a datos de fichero. La indicaci√≥n de
longitud no se eval√∫a.
Solo se permiten los tipos de datos BOOL
(no permitido: mapa de bits), BYTE, CHAR,
WORD, INT, DWORD, DINT, REAL, DATE,
TOD, TIME, S5TIME, DATE_AND_TIME.
Los datos de fichero deben tener un formato
adecuado para el sistema de destino.
Nota: Si el puntero ANY accede a un DB,
√©ste siempre debe especificarse (por ej.:
P# DB10.DBX5.0 byte 10).

LEN

InOut

WORD

I, Q, M, D, L

Longitud en bytes del bloque de datos que
debe transferirse

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6104

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros ERROR y STATUS
La tabla siguiente contiene toda la informaci√≥n de error espec√≠fica que puede devolverse a
trav√©s de los par√°metros ERROR y STATUS .
ERROR

STATUS

Explicaci√≥n

(decimal)
0

11

Advertencia: La nueva petici√≥n no tiene efecto, ya que la anterior todav√≠a no ha finalizado.

0

25

La comunicaci√≥n se ha iniciado. La petici√≥n est√° en proceso.

1

1

Problemas de comunicaci√≥n

1

2

Acuse negativo, la funci√≥n no puede ejecutarse

1

3

No existe registro para la AR_ID indicada.

1

4

‚óè Error en el puntero a datos de fichero SD_1 referente a la longitud o al tipo de datos
‚óè En la primera llamada, la AR_ID indicada se encuentra fuera del rango admisible.

1

5

Se ha ejecutado la solicitud de reset

1

7

La petici√≥n RESETes irrelevante, ya que la funci√≥n en curso ha finalizado o no ha sido activada
(bloque en estado err√≥neo)

1

10

No es posible acceder a la memoria de usuario local
(p. ej. acceso a un DB borrado)

1

12

En la llamada de la instrucci√≥n ha ocurrido lo siguiente:
‚óè Se ha indicado un DB de instancia que no pertenece a AR_SEND
‚óè No se ha indicado ning√∫n DB de instancia, sino un DB global

1

18

AR_ID ya ha sido utilizada por un AR_SEND.

1

20

La memoria de trabajo disponible no es suficiente.

Coherencia de datos
Para garantizar la coherencia de datos, no puede volver a escribirse en la parte del √°rea de
transmisi√≥n SD_1 utilizada actualmente hasta que no haya finalizado el proceso de
transmisi√≥n actual. Esto ocurre cuando el par√°metro de estado DONE adopta el valor "1".

Otras
EN_MSG: Habilitar avisos PLC
Descripci√≥n
Esta instrucci√≥n permite volver a habilitar avisos de PLC bloqueados. Es indiferente que el
bloqueo se haya realizado desde un visualizador o con "DIS_MSG (P√°gina 6107)".
Los avisos que se deben habilitar se indican mediante los par√°metros de entrada MODEy
MESGN. El requisito para el inicio correcto de una habilitaci√≥n con esta instrucci√≥n es que en
el momento actual no est√© activo ning√∫n otro bloqueo de la misma instrucci√≥n.
Para iniciar la habilitaci√≥n, debe ajustarse a "1" el par√°metro de entrada REQ.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6105

Instrucciones
4.2 Instrucciones

Funcionamiento
La habilitaci√≥n se efect√∫a de modo as√≠ncrono, es decir, puede prolongarse durante varias
llamadas de la instrucci√≥n (ver tambi√©n Diferencia entre las instrucciones que funcionan
s√≠ncronamente y las que funcionan as√≠ncronamente (P√°gina 4813)):
‚óè En la primera llamada (REQ =1), la instrucci√≥n comprueba los par√°metros de entrada e
intenta asignar los recursos de sistema necesarios. Si la comprobaci√≥n da resultado
positivo, se efect√∫a el registro en RET_VAL W#16#7001, se activa BUSY, y se lanza la
habilitaci√≥n.
De lo contrario, se registra en RET_VAL la correspondiente informaci√≥n de error, y la
petici√≥n finaliza. En tal caso, BUSY no debe evaluarse.
‚óè Si hay llamadas intermedias, se efect√∫a el registro en RET_VAL W#16#7002 (la CPU
todav√≠a procesa la petici√≥n), y se activa BUSY. Las llamadas intermedias no afectan a la
petici√≥n en curso.
‚óè En la √∫ltima llamada, se efect√∫a el registro en RET_VALW#16#0000 si no se han detectado
errores. En ese caso, BUSY se ajusta a 0. En caso de error, se registra la informaci√≥n de
error en RET_VAL , y BUSY no debe evaluarse.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "EN_MSG":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n
REQ = 1: Lanzar habilitaci√≥n

REQ

Input

BOOL

I, Q, M, D, L

MODE

Input

BYTE

I, Q, M, D, L o constante Par√°metros para seleccionar los avisos que
deben habilitarse: ver la tabla siguiente;

MESGN

Input

DWORD

I, Q, M, D, L o constante N√∫mero de aviso
Relevante solo para MODE = 6. Esto permi‚Äê
te habilitar un aviso individual.

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error (ver abajo);

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La habilitaci√≥n todav√≠a no ha fi‚Äê
nalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro MODE
La tabla siguiente recoge los valores admisibles del par√°metro de entrada MODE .
Valor

Significado

0

Todos los avisos de PLC de la CPU generados con instrucciones

1

Todos los avisos de PLC de la CPU generados con instrucciones, es decir, todos los avisos de "NOTIFY
(P√°gina 6080)", "NOTIFY_8P (P√°gina 6073)", "ALARM (P√°gina 6083)", "ALARM_8P (P√°gina 6077)" y
"ALARM_8 (P√°gina 6075)"

6

Alarma individual de la clase "Avisos PLC generados con instrucciones"

6106

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

La habilitaci√≥n ha finalizado sin errores.

7000

Primera llamada con REQ =0: No se ha activado la habilitaci√≥n.

7001

Primera llamada con REQ =1: Se ha lanzado la habilitaci√≥n.

7002

Llamada intermedia: La habilitaci√≥n ya est√° activa.

8081

Error al acceder a un par√°metro

8082

MODE tiene un valor no v√°lido.

8083

El n√∫mero de aviso se encuentra fuera del rango de valores admisible.

8084

No hay ning√∫n registro para el/los aviso(s) especificado(s) mediante MODE y en su caso mediante
MESGN .

80C3

La habilitaci√≥n del/los aviso(s) especificado(s) mediante MODE y en su caso mediante MESGN no se
puede lanzar en este momento, porque ya est√° activa otra habilitaci√≥n de "EN_MSG ".

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

DIS_MSG: Bloquear avisos PLC
Descripci√≥n
Esta instrucci√≥n permite bloquear avisos de PLC generados con instrucciones. Los avisos que
se deben bloquear se definen mediante los par√°metros de entrada MODEy MESGN. El
requisito para un bloqueo correcto con la instrucci√≥n "DIS_MSG" es que en el momento actual
no est√© activo ning√∫n otro bloqueo con "DIS_MSG".
Los avisos que al llamar "DIS_MSG" ya est√°n preparados para ser enviados, pero todav√≠a se
encuentran en un b√∫fer interno, no se ven afectados por el bloqueo, y por lo tanto se transmiten.
El bloqueo de avisos se notifica en las salidas ERROR y STATUS de las instrucciones
"NOTIFY (P√°gina 6080)", "NOTIFY_8P (P√°gina 6077)", "ALARM (P√°gina 6083)", "ALARM_8P
(P√°gina 6077)" y "ALARM_8 (P√°gina 6075)".
Para iniciar el proceso, al llamar "DIS_MSG" debe ajustarse a "1"el par√°metro de entrada REQ.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6107

Instrucciones
4.2 Instrucciones

Funcionamiento
El bloqueo se efect√∫a de modo as√≠ncrono, es decir, puede prolongarse durante varias
llamadas (ver tambi√©n Diferencia entre las instrucciones que funcionan s√≠ncronamente y las
que funcionan as√≠ncronamente (P√°gina 4813)):
‚óè En la primera llamada (REQ =1), "DIS_MSG" comprueba los par√°metros de entrada e
intenta asignar los recursos de sistema necesarios. Si la comprobaci√≥n da resultado
positivo, se efect√∫a el registro en RET_VALW#16#7001, se activa BUSY y se lanza el
bloqueo.
De lo contrario, se registra en RET_VAL la correspondiente informaci√≥n de error, y la
petici√≥n finaliza. En tal caso, BUSY no debe evaluarse.
‚óè Si hay llamadas intermedias, se efect√∫a el registro en RET_VALW#16#7002 (la CPU
todav√≠a procesa la petici√≥n), y se activa BUSY. Las llamadas intermedias no afectan a la
petici√≥n en curso.
‚óè En la √∫ltima llamada, se efect√∫a el registro en RET_VALW#16#0000, si no se han
detectado errores. En este caso, BUSY se ajusta a "0". En caso de error, se registra la
informaci√≥n de error en RET_VAL, y BUSY no debe evaluarse.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DIS_MSG":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: Lanzar bloqueo

MODE

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Par√°metros para seleccionar los avisos que
deben bloquearse: ver la tabla siguiente

MESGN

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de aviso
Relevante solo para MODE= 5, 6, 7. Esto per‚Äê
mite bloquear un aviso individual.

RET_VAL

Return

INT

I, Q, M, D, L

C√≥digo de error (ver abajo)

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: El bloqueo todav√≠a no ha finalizado.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro MODE
La tabla siguiente recoge los valores admisibles del par√°metro de entrada MODE .
Valor

Significado

0

Todos los avisos de PLC de la CPU generados con instrucciones

1

Todos los avisos de PLC de la CPU generados con instrucciones, es decir, todos los avisos de "NOTIFY (P√°gi‚Äê
na 6080)", "NOTIFY_8P (P√°gina 6073)", "ALARM (P√°gina 6083)", "ALARM_8P (P√°gina 6077)" y "ALARM_8
(P√°gina 6075)"

6

Alarma individual de la clase "Avisos PLC generados con instrucciones"

6108

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

El bloqueo ha finalizado sin errores.

7000

Primera llamada con REQ =0: No se ha activado el bloqueo.

7001

Primera llamada con REQ =1: Se ha lanzado el bloqueo.

7002

Llamada intermedia: El bloqueo ya est√° activo.

8081

Error al acceder a un par√°metro

8082

MODE tiene un valor no v√°lido.

8083

El n√∫mero de aviso se encuentra fuera del rango de valores admisible.

8084

No hay ning√∫n registro para el/los aviso(s) especificado(s) mediante MODE y en su caso mediante
MESGN .

80C3

El bloqueo del/los aviso(s) especificado(s) mediante MODE y en su caso mediante MESGN no se puede
lanzar en este momento, porque ya est√° activo otro bloqueo de "DIS_MSG".

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

READ_SI: Leer recursos del sistema asignados din√°micamente
Creaci√≥n de recursos del sistema asignados din√°micamente al generar avisos con las instrucciones
"ALARM_DQ" y "ALARM_D"
Al crear avisos con "ALARM_DQ (P√°gina 6096)" y "ALARM_D (P√°gina 6094)", el sistema
operativo asigna temporalmente espacio de almacenamiento en la memoria del sistema.
Si p. ej. se borra un FB presente en la CPU mediante llamadas de "ALARM_DQ (P√°gina 6096)"
o "ALARM_D (P√°gina 6094)", puede suceder que los correspondientes recursos del sistema
queden ocupados de modo permanente. Si se vuelve a cargar el FB con llamadas de
"ALARM_DQ (P√°gina 6096)" o "ALARM_D (P√°gina 6094)", puede suceder que las
instrucciones "ALARM_DQ (P√°gina 6096)" y "ALARM_D (P√°gina 6094)" no se procesen
debidamente.

Descripci√≥n
Con la instrucci√≥n "READ_SI" se pueden leer los recursos del sistema utilizados actualmente
que se han ocupado al generar avisos con "ALARM_DQ (P√°gina 6096)" y "ALARM_D
(P√°gina 6094)". Para esto se emplean los valores EV_ID y CMP_ID. Dichos valores se env√≠an
a la instrucci√≥n "READ_SI" en el par√°metro SI_ID .
La instrucci√≥n "READ_SI" tiene 4 modos de operaci√≥n posibles, que se enumeran en la tabla
siguiente. El modo de operaci√≥n deseado se ajusta con el par√°metro MODE.
MODE

¬øQu√© recursos del sistema ocupados por "ALARM_DQ" / "ALARM_D" se leen?

1

Todos (la llamada de "READ_SI" se efect√∫a con SI_ID:=0)

2

El recurso del sistema que se ha ocupado en la llamada de "ALARM_DQ" / "ALARM_D" con EV_ID:=ev_id (la
llamada de READ_SI se efect√∫a con SI_ID:=ev_id)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6109

Instrucciones
4.2 Instrucciones
MODE

¬øQu√© recursos del sistema ocupados por "ALARM_DQ" / "ALARM_D" se leen?

3

Todos los recursos del sistema que se han ocupado en la llamada de "ALARM_DQ" / "ALARM_D" con
CMP_ID:=cmp_id (la llamada de READ_SI se efect√∫a con SI_ID:=cmp_id)

0

Otros recursos del sistema que no se han podido leer en la llamada anterior con MODE=1 o MODE=3 , por
haberse elegido un campo de destino SYS_INST demasiado peque√±o

Funcionamiento
Si al llamar READ_SI con MODE=1 o MODE=3 se ha escogido un √°rea de destino SYS_INST
lo suficientemente grande, dicha √°rea contendr√° despu√©s de la llamada el contenido de todos
los recursos del sistema seleccionados mediante el par√°metro MODE que est√©n ocupados en
el momento actual.
Si en el momento actual hay una gran cantidad de recursos del sistema ocupados, el tiempo
de ejecuci√≥n ser√° prolongado. Si la CPU tiene mucha carga de trabajo, puede ser que se
rebase el tiempo m√°ximo de vigilancia de ciclo configurado.
Este problema de tiempo de ejecuci√≥n puede resolverse de la siguiente manera: Escoja un
√°rea de destino SYS_INST relativamente peque√±a. Si la instrucci√≥n no puede guardar en
SYS_INST todos los recursos del sistema que se deben leer, se recibir√° una notificaci√≥n a
trav√©s de RET_VAL=W#16#0001. En tal caso, debe llamarse READ_SI, con MODE=0 y la
misma SI_ID que en la llamada anterior, tantas veces como sea necesario para que RET_VAL
adquiera el valor W#16#0000.
Nota
Dado que el sistema operativo no coordina las llamadas de READ_SIcorrespondientes a una
petici√≥n de lectura, todas las llamadas de READ_SIdeben efectuarse en la misma clase de
prioridad.

6110

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "READ_SI":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

INT

I, Q, M, D, L o cons‚Äê
tante

ID de la petici√≥n
Valores permitidos:
‚óè 1: Leer todos los recursos del sistema
‚óè 2: Leer el recurso del sistema que se ha
ocupado en la llamada de "ALARM_DQ" /
"ALARM_D" con EV_ID = ev_id
‚óè 3: Leer los recursos del sistema que se han
ocupado en la llamada de "ALARM_DQ" /
"ALARM_D" con CMP_ID = cmp_id
‚óè 0: Llamada consecutiva

SI_ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Identificador para el/los recurso(s) del sistema
que se debe(n) leer
Valores permitidos:
‚óè 0, si MODE=1
‚óè N√∫mero de aviso ev_id, si MODE=2
‚óè Identificador cmp_id del sistema parcial, si
MODE=3

RET_VAL

Return

INT

I, Q, M, D, L

Valor de retorno (informaci√≥n de error o estado
de la petici√≥n)

N_SI

Output

INT

I, Q, M, D, L

N√∫mero de recursos del sistema que se mues‚Äê
tran en SYS_INT

SYS_INST

Output

ANY

D

√Årea de destino para los recursos del sistema
le√≠dos

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

0001

No se han podido leer todos los recursos del sistema, porque se ha elegido un √°rea de destino SYS_INST
demasiado peque√±a.

8081

(solo con MODE=2 √≥ 3) Se ha asignado a SI_ID el valor 0.

8082

(solo con MODE=1) Se ha asignado a SI_ID un valor distinto de 0.

8083

(solo con MODE=0) Se ha asignado a SI_ID un valor distinto al de la llamada anterior con MODE=1 √≥ 3.

8084

Se ha asignado a MODE un valor no admisible.

8085

READ_SI ya est√° proces√°ndose en otro OB.

8086

El √°rea de destino SYS_INST es demasiado peque√±a para un recurso del sistema.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6111

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
8087 o 8092

El √°rea de destino SYS_INST no se encuentra en un DB, o hay un error en el puntero ANY.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: ALARM_D: Generar siempre avisos PLC acusados (P√°gina 6094)

Par√°metro √Årea de destino SYS_INST: Estructura
El √°rea de destino para los recursos del sistema ocupados le√≠dos debe encontrarse dentro de
un DB. Es recomendable definir el √°rea de destino como un campo de estructuras, cada una
de ellas con el siguiente formato:
Elemento de estruc‚Äê
tura

Tipo de datos

Descripci√≥n

SFC_NO

WORD

N.¬∫ de la instrucci√≥n que ha asignado el recurso del sistema

LEN

BYTE

Longitud en bytes de la estructura, incl. SFC_NO y LEN: B#16#0C

SIG_STAT

BOOL

Estado de se√±al

ACK_STAT

BOOL

Estado de acuse del evento entrante (flanco ascendente)

EV_ID

DWORD

N√∫mero de aviso

CMP_ID

DWORD

Identificador del sistema parcial

DEL_SI: Borrar recursos del sistema asignados din√°micamente
Creaci√≥n de recursos del sistema asignados din√°micamente al generar avisos con las instrucciones
"ALARM_DQ" y "ALARM_D"
Al crear avisos con "ALARM_DQ (P√°gina 6096)" y "ALARM_D (P√°gina 6094)", el sistema
operativo asigna temporalmente espacio de almacenamiento en la memoria del sistema.
Si p. ej. se borra un FB presente en la CPU mediante llamadas de "ALARM_DQ (P√°gina 6096)"
o "ALARM_D (P√°gina 6094)", puede suceder que los correspondientes recursos del sistema
queden ocupados de modo permanente. Si se vuelve a cargar el FB con llamadas de
"ALARM_DQ (P√°gina 6096)" / "ALARM_D (P√°gina 6094)", puede suceder que las
instrucciones "ALARM_DQ (P√°gina 6096)" y "ALARM_D (P√°gina 6094)" no se procesen
debidamente.

Descripci√≥n
La instrucci√≥n "DEL_SI" permite borrar recursos del sistema utilizados en el momento actual.

6112

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
"DEL_SI" tiene tres modos de operaci√≥n posibles, que se enumeran en la tabla siguiente. El
modo de operaci√≥n deseado se ajusta con el par√°metro MODE .
MODE

¬øQu√© recursos del sistema ocupados por "ALARM_DQ" / "ALARM_D" se borran?

1

Todos (la llamada de "DEL_SI" se efect√∫a con SI_ID:=0)

2

El recurso del sistema que se ha ocupado en la llamada de "ALARM_DQ" (P√°gina 6096) / ALARM_D (P√°gi‚Äê
na 6094) con EV_ID:=ev_id (la llamada de DEL_SI se efect√∫a con SI_ID:=ev_id)

3

Todos los recursos del sistema que se han ocupado en la llamada de "ALARM_DQ" (P√°gina 6096) / ALARM_D
(P√°gina 6094) con CMP_ID:=cmp_id (la llamada de DEL_SI se efect√∫a con SI_ID:=cmp_id)

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DEL_SI":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MODE

Input

INT

I, Q, M, D, L o cons‚Äê
tante

ID de la petici√≥n
Valores permitidos:
‚óè 1: Borrar todos los recursos del sistema
‚óè 2: Borrar el recurso del sistema que se ha
ocupado en la llamada de "ALARM_DQ"
(P√°gina 6096) / "ALARM_D (P√°gina 6094)"
con EV_ID = ev_id
‚óè 3: Borrar los recursos del sistema que se
han ocupado en la llamada
de "ALARM_DQ" (P√°gina 6096) /
"ALARM_D (P√°gina 6094)" con
CMP_ID = cmp_id

SI_ID

Input

DWORD

I, Q, M, D, L o cons‚Äê
tante

Identificador para el/los recurso(s) del sistema
que se debe(n) borrar
Valores permitidos:
‚óè 0, si MODE=1
‚óè N√∫mero de aviso ev_id, si MODE=2
‚óè Identificador cmp_id del sistema parcial, si
MODE=3

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8081

(solo con MODE=2 √≥ 3) Se ha asignado a SI_ID el valor "0".

8082

(solo con MODE=1) Se ha asignado a SI_ID un valor distinto de "0".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6113

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
8084

Se ha asignado a MODE un valor no admisible.

8085

"DEL_SI" ya se est√° procesando en este momento.

8086

No se han podido borrar todos los recursos del sistema seleccionados, ya que por lo menos uno de ellos
estaba proces√°ndose en el momento de la llamada de "DEL_SI".

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

4.2.3.9

Diagn√≥stico

RD_SINFO: Leer informaci√≥n de arranque del OB actual
Descripci√≥n
Esta instrucci√≥n permite leer la informaci√≥n de arranque:
‚óè Del √∫ltimo OB llamado que todav√≠a no se ha procesado completamente
‚óè Del √∫ltimo OB de arranque iniciado
Ambas informaciones de arranque carecen de sello de tiempo. Si la llamada se produce en el
OB 100, el OB 101 o el OB 102, se devuelven dos informaciones de arranque id√©nticas.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RD_SINFO".
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

TOP_SI

Output

STRUCT

D, L

Informaci√≥n de arranque del OB actual

START_UP_SI

Output

STRUCT

D, L

Informaci√≥n de arranque del √∫ltimo OB de
arranque iniciado

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
La instrucci√≥n no devuelve informaci√≥n de error espec√≠fica, sino √∫nicamente general. La
informaci√≥n de error general y su evaluaci√≥n se describen en el par√°metro de salida
"RET_VAL".
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174).

6114

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros TOP_SI y START_UP_SI
Los par√°metros de salida TOP_SI y START_UP_SI son dos estructuras con formato id√©ntico.
El formato de ambas se muestra en la tabla siguiente.
Elemento de estructura Tipo de datos

Descripci√≥n

EV_CLASS

BYTE

‚óè Bits de 0 a 3: ID de evento

EV_NUM

BYTE

N√∫mero de evento

PRIORITY

BYTE

N√∫mero del nivel de ejecuci√≥n
(significado de B#16#FE: El OB no existe, est√° bloqueado o no puede arran‚Äê
carse en el actual estado operativo.)

NUM

BYTE

N√∫mero de OB

TYP2_3

BYTE

ID de datos 2_3:
identifica la informaci√≥n registrada en ZI2_3

TYP1

BYTE

ID de datos 1:
identifica la informaci√≥n registrada en ZI1

ZI1

WORD

Informaci√≥n adicional 1

ZI2_3

DWORD

Informaci√≥n adicional 2_3

‚óè Bits de 4 a 7: Clase de evento

Nota
Los elementos estructurales indicados en la tabla anterior coinciden exactamente en su
contenido con las variables temporales de un OB.
Sin embargo, debe tenerse en cuenta que, en los distintos OBs, las variables temporales
pueden tener otros nombres y tipos de datos. Tambi√©n debe tenerse en cuenta que la interfaz
de llamada de los OBs contiene adem√°s la fecha y hora en que se solicit√≥ el OB.
Los bits de 4 a 7 del elemento estructural EV_CLASS contienen la clase de evento. Aqu√≠ son
posibles los siguientes valores:
‚óè 1: Eventos de arranque de OBs est√°ndar
‚óè 2: Eventos de arranque de OBs de errores s√≠ncronos
‚óè 3: Eventos de arranque de OBs de errores as√≠ncronos
El elemento estructural PRIORITY devuelve la clase de prioridad correspondiente al OB actual.
Adem√°s de estos dos elementos, tambi√©n es importante NUM . NUM contiene el n√∫mero del
OB actual o del √∫ltimo OB de arranque iniciado.

Ejemplo
Supongamos que el √∫ltimo OB llamado, que todav√≠a no se ha procesado por completo, es el
OB 80, y el √∫ltimo OB de arranque llamado es el OB 100.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6115

Instrucciones
4.2 Instrucciones
La tabla siguiente muestra la correspondencia entre los elementos estructurales del par√°metro
TOP_SI de la instrucci√≥n "RD_SINFO" y las correspondientes variables locales del OB 80.
TOP_SI
Tipo de datos
Elemento de estructura

OB 80 - Variable local correspondiente

Tipo de datos

EV_CLASS

BYTE

OB80_EV_CLASS

BYTE

EV_NUM

BYTE

OB80_FLT_ID

BYTE

PRIORITY

BYTE

OB80_PRIORITY

BYTE

NUM

BYTE

OB80_OB_NUMBR

BYTE

TYP2_3

BYTE

OB80_RESERVED_1

BYTE

TYP1

BYTE

OB80_RESERVED_2

BYTE

ZI1

WORD

OB80_ERROR_INFO

WORD

ZI2_3

DWORD

OB80_ERR_EV_CLASS

BYTE

OB80_ERR_EV_NUM

BYTE

OB80_OB_PRIORITY

BYTE

OB80_OB_NUM

BYTE

La tabla siguiente muestra la correspondencia entre los elementos estructurales del par√°metro
START_UP_SI de la instrucci√≥n "RD_SINFO" y las correspondientes variables locales del
OB 100.
START_UP_SI
Tipo de datos
Elemento de estructura

OB 100 - Variable local

Tipo de datos

EV_CLASS

BYTE

OB100_EV_CLASS

BYTE

EV_NUM

BYTE

OB100_STRTUP

BYTE

PRIORITY

BYTE

OB100_PRIORITY

BYTE

NUM

BYTE

OB100_OB_NUMBR

BYTE

TYP2_3

BYTE

OB100_RESERVED_1

BYTE

TYP1

BYTE

OB100_RESERVED_2

BYTE

ZI1

WORD

OB100_STOP

WORD

ZI2_3

DWORD

OB100_STRT_INFO

DWORD

RDSYSST: Leer lista de estado del sistema
Descripci√≥n
Esta instrucci√≥n permite leer una lista parcial de las listas de estado del sistema (SZL) o un
extracto de lista parcial de SZL.
Para iniciar la lectura, al llamar "RDSYSST" debe ajustarse a "1" el par√°metro de entrada
REQ . Si la operaci√≥n de lectura se ha podido ejecutar de inmediato, la instrucci√≥n devuelve el

6116

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
valor "0" en el par√°metro de salida BUSY. Si BUSY tiene el valor "1", la operaci√≥n de lectura
todav√≠a no ha finalizado.
Nota
Si se llama la instrucci√≥n "RDSYSST" en el OB de alarma de diagn√≥stico con la
SZL‚ÄëIDW#16#00B1, W#16#00B2 o W#16#00B3 y se accede al m√≥dulo que ha provocado la
alarma de diagn√≥stico, la lectura se efect√∫a de inmediato.
Con "RDSYSST" se transfieren siempre registros enteros.

Recursos del sistema
Si se lanzan varias operaciones de lectura con poca diferencia de tiempo entre s√≠ (las
peticiones con los par√°metros SZL_IDW#16#00B4, W#16#4C91, W#16#4092, W#16#4292,
W#16#4692 y, en su caso, W#16#00B1 y W#16#00B3), el sistema operativo garantiza la
ejecuci√≥n de todas las peticiones sin que se produzcan interferencias entre ellas. En el
momento en que se alcanza el l√≠mite de los recursos del sistema, se env√≠a una notificaci√≥n
mediante RET_VAL. El estado de fallo temporal puede eliminarse repitiendo la petici√≥n.
El n√∫mero m√°ximo de peticiones activas "simult√°neamente" para la instrucci√≥n depende de la
CPU.
Nota
En las CPU S7-400 puede transferirse un m√°ximo de 432 bytes al √°rea de destino con la
instrucci√≥n "RDSYSST".

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RDSYSST":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ=1: Lanzar el procesamiento

SZL_ID

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

SZL‚ÄëID de la lista parcial o del extracto de lista
parcial

INDEX

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

Tipo o n√∫mero de un objeto en una lista parcial

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el par√°metro RET_VAL conten‚Äê
dr√° un c√≥digo de error.

BUSY

Output

BOOL

I, Q, M, D, L

TRUE: La lectura todav√≠a no ha finalizado.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6117

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SZL_HEADER

Output

STRUCT

D, L

V√©ase m√°s abajo

DR

Output

ANY

I, Q, M, L, D

√Årea de destino para la lista parcial SZL le√≠da
o el extracto de lista parcial SZL le√≠do:
‚óè Si solo se ha le√≠do la informaci√≥n de
encabezado de una lista parcial SZL, no se
debe evaluar DR, sino √∫nicamente
SZL_HEADER.
‚óè De lo contrario, el producto de LENTHDR y
N_DR indica cu√°ntos bytes se han
registrado en DR.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro SZL_HEADER
El par√°metro SZL_HEADER es una estructura que se define del siguiente modo:
SZL_HEADER:
STRUCT
LENTHDR: WORD
N_DR:
WORD
END_STRUCT
LENTHDR es la longitud de un registro de la lista parcial SZL o del extracto de lista parcial SZL.
‚óè Si solo se ha le√≠do la informaci√≥n de encabezado de una lista parcial SZL, N_DR contiene
el n√∫mero de registros relevantes presentes.
‚óè De lo contrario, N_DR contiene el n√∫mero de registros transferidos al √°rea de destino.

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

Ning√∫n error

0081

La longitud del campo de resultado es insuficiente (a pesar de ello se enviar√°n todos los registros posibles.
La cantidad puede leerse en el SZL-Header.)

7000

Primera llamada con REQ=0: Ninguna transmisi√≥n de datos activa; BUSY tiene el valor "0".

7001

Primera llamada con REQ=1: Transmisi√≥n de datos iniciada; BUSY tiene el valor "1".

7002

Llamada intermedia (REQ irrelevante): Transmisi√≥n de datos activa; BUSY tiene el valor "1".

8081

La longitud del campo de resultado es insuficiente (no hay espacio para un registro)

8082

La SZL_ID es err√≥nea o se desconoce en la CPU o en la instrucci√≥n.

8083

INDEX err√≥neo o no permitido

8085

En este momento la informaci√≥n no est√° disponible por razones atribuibles al sistema, p. ej. debido a falta
de recursos.

8086

No se puede leer el registro debido a un fallo del sistema (bus, m√≥dulos, sistema operativo).

8087

No se puede leer el registro porque el m√≥dulo no existe o no est√° acusado.

6118

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
8088

No se puede leer el registro porque la ID de m√≥dulo real difiere de la ID de m√≥dulo configurada.

8089

No se puede leer el registro porque el m√≥dulo no es apto para diagn√≥stico o no soporta el registro.

80A2

Error de protocolo de DP (error Layer 2) (error temporal)

80A3

Error de protocolo de DP con User-Interface/User (error temporal)

80A4

Fallo de comunicaci√≥n en el bus K (el error se produce entre la CPU y la interfaz DP externa) (error
temporal)

80C5

Periferia descentralizada no disponible (error temporal)

80C6

La transferencia de registros se ha cancelado por una interrupci√≥n de la clase de prioridad (rearranque o
segundo plano)

80D2

No se puede leer el registro porque el m√≥dulo no es apto para diagn√≥stico.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Par√°metro SZL_ID
Nota
Listas parciales legibles de las CPUs S7
‚óè Encontrar√° las listas parciales para S7-300 legibles mediante "RDSYSST" en la
correspondiente lista de operaci√≥n.
‚óè Encontrar√° las listas parciales S7-400 legibles mediante "RDSYSST" en la correspondiente
lista de operaci√≥n.

SZL_ID
(W#16#...)

Lista parcial

INDEX
(W#16#...)

ID de m√≥dulo
0111 (P√°gi‚Äê
na 6127)

Un registro de identificaci√≥n
Identificaci√≥n del m√≥dulo

0001

Identificaci√≥n del hardware base

0006

Identificaci√≥n del firmware base

0007

Caracter√≠sticas de la CPU
0012 (P√°gi‚Äê
na 6128)
0112 (P√°gi‚Äê
na 6128)

Todas las caracter√≠sticas

Irrelevante

Caracter√≠sticas de un grupo
Unidad de procesamiento MC7

0000

Sistema horario

0100

Comportamiento del sistema

0200

Descripci√≥n de lenguaje MC7

0300

Disponibilidad de la instrucci√≥n "C_DIAG (P√°gina 6184)" 0400
0F12 (P√°gi‚Äê
na 6128)

Solo informaci√≥n de encabezado de la lista parcial SZL

Irrelevante

√Åreas de memoria del usuario

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6119

Instrucciones
4.2 Instrucciones
SZL_ID
(W#16#...)

Lista parcial

INDEX
(W#16#...)

0113 (P√°gi‚Äê
na 6131)

Un registro para el √°rea de memoria especificada
Memoria de trabajo

0001

√Åreas del sistema
0014 (P√°gi‚Äê
na 6132)

Registros de todas las √°reas del sistema

Irrelevante

0F14 (P√°gi‚Äê
na 6132)

Solo informaci√≥n de encabezado de la lista parcial SZL

Irrelevante

Tipos de bloque
0015 (P√°gi‚Äê
na 6133)

Registros de todos los tipos de bloque

Irrelevante

Identificaci√≥n de un componente
001C (P√°gi‚Äê
na 6134)

Identificaci√≥n de todos los componentes

011C (P√°gi‚Äê
na 6134)

Identificaci√≥n de un componente

0F1C (P√°gi‚Äê
na 6134)

Irrelevante

Nombre del sistema de automatizaci√≥n

0001

Nombre del m√≥dulo

0002

Identificador de la instalaci√≥n del m√≥dulo

0003

Entrada de derechos de autor

0004

N√∫mero de serie del m√≥dulo

0005

Nombre de tipo de m√≥dulo

0007

N√∫mero de serie de la Memory Card

0008

Fabricante y perfil de un m√≥dulo de CPU

0009

Identificador de la situaci√≥n de un m√≥dulo

000B

Solo informaci√≥n de encabezado de la lista parcial SZL

Irrelevante

Estado de alarma
0222 (P√°gi‚Äê
na 6140)

Registro para la alarma especificada

N√∫mero de OB

Correspondencia entre memorias imagen parcial de proceso y CPUs
0025 (P√°gi‚Äê
na 6143)

Correspondencia entre todas las memorias imagen par‚Äê
cial de proceso y OBs

Irrelevante

0125 (P√°gi‚Äê
na 6143)

Correspondencia entre una memoria imagen parcial de
proceso y el OB correspondiente

N.¬∫ de memoria imagen
parcial de proceso

0225 (P√°gi‚Äê
na 6143)

Correspondencia entre un OB y las memorias imagen
parcial de proceso correspondientes

N.¬∫ de OB

0F25 (P√°gi‚Äê
na 6143)

Solo informaci√≥n de encabezado de la lista parcial SZL

Irrelevante

Datos de estado de comunicaci√≥n
0132 (P√°gi‚Äê
na 6146)

0232 (P√°gi‚Äê
na 6146)

6120

Datos de estado para un componente de comunicaci√≥n
Diagn√≥stico

0005

Sistema horario

0008

Datos de estado para un componente de comunicaci√≥n

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
SZL_ID
(W#16#...)

Lista parcial

INDEX
(W#16#...)

Nivel de protecci√≥n de la CPU y posiciones del interruptor
de manejo

0004

Estado de los LEDs del m√≥dulo (no se puede leer en todas las CPUs)
0174 (P√°gi‚Äê
na 6153)

Estado de un LED

Identificador de LED

Informaci√≥n del sistema maestro DP
0090 (P√°gi‚Äê
na 6155)

Informaci√≥n acerca de todos los sistemas maestros DP
conocidos para la CPU

0000

0190 (P√°gi‚Äê
na 6155)

Informaci√≥n acerca de un sistema maestro DP

ID del sistema maestro DP

0F90 (P√°gi‚Äê
na 6155)

Solo informaci√≥n de encabezado de la lista parcial SZL

0000

Informaci√≥n de estado del m√≥dulo (se devuelven como m√°ximo 27 registros.)
0091 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado del m√≥dulo de todos los m√≥dulos/ Irrelevante
subm√≥dulos insertados

0191 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de todos los m√≥dulos/racks no de‚Äê Irrelevante
sactivados con ID de m√≥dulo err√≥nea

0291 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de m√≥dulo de todos los m√≥dulos
en estado de fallo y no desactivados

Irrelevante

0391 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de m√≥dulo de todos los m√≥dulos
no disponibles

Irrelevante

0591 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de m√≥dulo de todos los subm√≥du‚Äê Irrelevante
los del m√≥dulo host

0991 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de m√≥dulo de un sistema maestro
DP

ID del sistema maestro DP

0C91 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de un m√≥dulo en configuraci√≥n
centralizada o conectado a una interfaz DP integrada o a
una interfaz PROFINET (integrada o externa)

Direcci√≥n base l√≥gica

4C91 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de un m√≥dulo conectado a una
interfaz DP externa

Direcci√≥n base l√≥gica

0D91 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de m√≥dulo de todos los m√≥dulos
del rack o la estaci√≥n especificados (DP o PROFINET)

ID del rack o del sistema
maestro DP y n√∫mero de
estaci√≥n, o n√∫mero de es‚Äê
taci√≥n seguido de las dos
√∫ltimas posiciones de la ID
del subsistema PNIO

0E91 (P√°gi‚Äê
na 6156)

Informaci√≥n de estado de todos los m√≥dulos asignados

Irrelevante

0F91 (P√°gi‚Äê
na 6156)

Solo informaci√≥n de encabezado de la lista parcial SZL

Irrelevante

Informaci√≥n de estado del rack/de la estaci√≥n
0092 (P√°gi‚Äê
na 6162)

Consigna de estado de los racks en configuraci√≥n cen‚Äê
0/ID del sistema maestro
tralizada o de las estaciones de un sistema maestro DP. DP

4092 (P√°gi‚Äê
na 6162)

ID del sistema maestro DP
Consigna de estado de las estaciones de un sistema
maestro DP conectado a trav√©s de una interfaz DP exter‚Äê
na.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6121

Instrucciones
4.2 Instrucciones
SZL_ID
(W#16#...)

Lista parcial

INDEX
(W#16#...)

0192 (P√°gi‚Äê
na 6162)

Estado de activaci√≥n de las estaciones de un sistema
maestro DP conectado a trav√©s de una interfaz DP inte‚Äê
grada.

ID del sistema maestro DP

0292 (P√°gi‚Äê
na 6162)

Estado real de los racks en configuraci√≥n centralizada o
de las estaciones de un sistema maestro DP.

0/ID del sistema maestro
DP

4292 (P√°gi‚Äê
na 6162)

Estado real de las estaciones de un sistema maestro DP
conectado a trav√©s de una interfaz DP externa.

ID del sistema maestro DP

0392 (P√°gi‚Äê
na 6162)

Estado del respaldo por bater√≠a de un rack de una CPU,
cuando falla por lo menos una bater√≠a.

0

0492 (P√°gi‚Äê
na 6162)

Estado de todo el respaldo por bater√≠a de todos los racks
de una CPU.

0

0592 (P√°gi‚Äê
na 6162)

Estado de la alimentaci√≥n de 24 V de todos los racks de
una CPU.

0

0692 (P√°gi‚Äê
na 6162)

Estado de diagn√≥stico de los aparatos de ampliaci√≥n en 0/ID del sistema maestro
configuraci√≥n centralizada o de las estaciones de un sis‚Äê DP
tema maestro DP conectado a trav√©s de una interfaz DP
integrada.

4692 (P√°gi‚Äê
na 6162)

ID del sistema maestro DP
Estado de diagn√≥stico de las estaciones de un sistema
maestro DP conectado a trav√©s de una interfaz DP exter‚Äê
na.

Informaci√≥n de estado del rack/de la estaci√≥n
0094 (P√°gi‚Äê
na 6165)

Estado te√≥rico de los racks en configuraci√≥n centralizada
o de las estaciones de un sistema de controlador IO.

0/ID del subsistema PNIO

0194 (P√°gi‚Äê
na 6165)

Estado de activaci√≥n de una estaci√≥n de un sistema de
controlador IO configurado y desactivado.

ID del subsistema PNIO

0294 (P√°gi‚Äê
na 6165)

Estado real de los racks en configuraci√≥n centralizada o
de las estaciones de un sistema de controlador IO.

0/ID del subsistema PNIO

0694 (P√°gi‚Äê
na 6165)

Estado de diagn√≥stico de los aparatos de ampliaci√≥n en 0/ID del subsistema PNIO
configuraci√≥n centralizada o de las estaciones de un sis‚Äê
tema de controlador IO.

0794 (P√°gi‚Äê
na 6165)

Estado de mantenimiento del rack central o de las esta‚Äê
ciones de un sistema de controlador IO.

0/ID del subsistema PNIO

0F94 (P√°gi‚Äê
na 6165)

Solo informaci√≥n de encabezado

-

Informaci√≥n avanzada del sistema maestro DP
0195 (P√°gi‚Äê
na 6167)

Informaci√≥n avanzada acerca de un sistema maestro DP ID del sistema maestro DP

0F95 (P√°gi‚Äê
na 6167)

Solo informaci√≥n de encabezado de la lista parcial SZL

0000

Informaci√≥n de estado del m√≥dulo con PROFINET IO y PROFIBUS DP
0696 (P√°gi‚Äê
na 6168)

Informaci√≥n de estado de todos los subm√≥dulos de un
m√≥dulo especificado (solo con PROFINET IO conectado
a una interfaz integrada).

Direcci√≥n con identifica‚Äê
ci√≥n E/S

0C96 (P√°gi‚Äê
na 6168)

Informaci√≥n de estado de un m√≥dulo o subm√≥dulo central
o conectado a una interfaz PROFIBUS DP integrada o a
una interfaz PROFINET (integrada o externa)

Direcci√≥n inicial con identi‚Äê
ficaci√≥n E/S

B√∫fer de diagn√≥stico (se devuelven como m√°ximo 21 registros)

6122

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
SZL_ID
(W#16#...)

Lista parcial

INDEX
(W#16#...)

00A0 (P√°gi‚Äê
na 6175)

Todas las entradas transmisibles en el estado operativo
actual

Irrelevante

01A0 (P√°gi‚Äê
na 6175)

Las entradas m√°s recientes (el n√∫mero se indica median‚Äê N√∫mero
te el √≠ndice)

0FA0 (P√°gi‚Äê
na 6175)

Solo informaci√≥n de encabezado de la lista parcial SZL

Irrelevante

Datos de diagn√≥stico en m√≥dulos
00B1 (P√°gi‚Äê
na 6176)

Los cuatro primeros bytes de diagn√≥stico de un m√≥dulo
(DS0)

Direcci√≥n base l√≥gica

00B2 (P√°gi‚Äê
na 6178)

Todos los datos de diagn√≥stico de un m√≥dulo (220 bytes,
DS1) (ning√∫n m√≥dulo DP)

Rack, slot

00B3 (P√°gi‚Äê
na 6179)

Todos los datos de diagn√≥stico de un m√≥dulo (220 bytes,
DS1)

Direcci√≥n base l√≥gica

00B4 (P√°gi‚Äê
na 6179)

Datos de diagn√≥stico de un esclavo DP

Direcci√≥n de diagn√≥stico
configurada

Consulte tambi√©n
Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que funcionan
as√≠ncronamente (P√°gina 4813)

Lista de estado del sistema
Sinopsis de la lista de estado del sistema (SZL)
Definici√≥n: Lista de estado del sistema
La lista de estado del sistema describe el estado actual de un sistema de automatizaci√≥n. El
contenido de la SZL (lista de estado del sistema) puede leerse, aunque no modificarse,
mediante funciones de informaci√≥n. Las listas parciales son listas virtuales, es decir, el sistema
operativo de los m√≥dulos centrales las confecciona solo a petici√≥n del usuario.
Solo es posible leer una lista parcial al mismo tiempo con "RDSYSST (P√°gina 6116)". Aqu√≠ se
describen las listas parciales de la lista de estado del sistema que pueden leerse en el
programa de usuario mediante "RDSYSST (P√°gina 6116)" y cuya informaci√≥n hace referencia
a
‚óè CPUs o
‚óè a los m√≥dulos cuyas listas parciales no son espec√≠ficas de m√≥dulo (p. ej. las IDs de SZL
W#16#00B1, W#16#00B2, W#16#00B3).
Encontrar√° las listas parciales espec√≠ficas de m√≥dulo, p. ej. para CPs y FMs, en las respectivas
descripciones de m√≥dulo.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6123

Instrucciones
4.2 Instrucciones

Contenido
La lista de estado del sistema contiene informaci√≥n acerca de:
‚óè Datos del sistema
‚óè Informaci√≥n de estado del m√≥dulo en la CPU
‚óè Datos de diagn√≥stico en m√≥dulos
‚óè B√∫fer de diagn√≥stico

Datos del sistema
Los datos del sistema son datos caracter√≠sticos de una CPU, fijos o parametrizables.
Describen las siguientes caracter√≠sticas de rendimiento:
‚óè Configuraci√≥n de la CPU
‚óè Estado de las clases de prioridad
‚óè Comunicaci√≥n.

Informaci√≥n de estado del m√≥dulo
La informaci√≥n de estado del m√≥dulo describe el estado actual de los componentes que se
vigilan mediante el diagn√≥stico del sistema.

Datos de diagn√≥stico en m√≥dulos
Los m√≥dulos aptos para diagn√≥stico asignados a una CPU poseen datos de diagn√≥stico que
se almacenan en los propios m√≥dulos.

B√∫fer de diagn√≥stico
El b√∫fer de diagn√≥stico contiene entradas de diagn√≥stico en el orden en que se generan.

Estructura de una lista parcial de SZL
Principios b√°sicos
Se puede leer una lista parcial o un extracto de lista parcial con "RDSYSST (P√°gina 6116)".
Para ello se define con los par√°metros SZL_ID (ID de lista de estado del sistema) e INDEX lo
que se desea leer.

Estructura
Una lista parcial se compone de
‚óè un encabezado y
‚óè los registros.

6124

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de una lista parcial se compone de:
‚óè SZL-ID
‚óè INDEX
‚óè La longitud en bytes de un registro de la lista
‚óè El n√∫mero de registros que contiene la lista parcial.

√çndice
Para determinadas listas parciales o extractos de listas parciales, es necesario especificar un
identificador de tipo de objeto o un n√∫mero de objeto. Para ello se utiliza el √≠ndice. Si el √≠ndice
no se requiere para una informaci√≥n, su contenido es irrelevante.

Registros
Los registros de una lista parcial tienen una longitud determinada. Esta longitud depende de
qu√© informaci√≥n est√© almacenada en la lista parcial. El modo en que las palabras de datos
est√°n asignadas en un registro depende tambi√©n de la lista parcial.

ID de SZL
SZL-ID (ID de lista de estado del sistema)
Cada lista parcial perteneciente a la lista de estado del sistema posee un n√∫mero. Las listas
parciales pueden visualizarse de modo completo o parcial. Los extractos de lista parcial
posibles est√°n definidos de modo fijo y se identifican a su vez mediante un n√∫mero. La SZL-ID
se compone del n√∫mero de la lista parcial y el n√∫mero del extracto de lista parcial y de la clase
de m√≥dulo.

Estructura
La SZL-ID tiene una longitud de una palabra. Se compone de los siguientes elementos:


 

&ODVHGHP¬µGXOR





1¬ºPHURGHOH[WUDFWR



1¬ºPHURGHOLVWDSDUFLDO

GHOLVWDSDUFLDO

Figura 4-36

Estructura de la SZL-ID

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6125

Instrucciones
4.2 Instrucciones

Clase de m√≥dulo
Ejemplos de clases de m√≥dulos:
Clase de m√≥dulo

Cifrado correspondiente (binario)

CPU

0000

IM

0100

FM

1000

CP

1100

N√∫mero del extracto de lista parcial
Los n√∫meros de extracto de lista parcial y su significado dependen de la lista parcial en
cuesti√≥n. Con el n√∫mero de extracto de lista parcial se indica qu√© porci√≥n de una lista parcial
se desea leer.

N√∫mero de lista parcial
Con el n√∫mero de lista parcial se indica qu√© lista parcial de la lista de estado del sistema se
desea leer.

Listas parciales de SZL posibles
Subset
En un m√≥dulo siempre est√° disponible solo una porci√≥n de todas las listas parciales posibles.
Seg√∫n el m√≥dulo est√°n disponibles unas listas parciales u otras.

Listas parciales de SZL posibles
La tabla siguiente recoge todas las listas parciales posibles con el n√∫mero que les corresponde
dentro de la SZL-ID (ID de lista de estado del sistema).

6126

Lista parcial

SZL-ID

ID de m√≥dulo

W#16#xy11 (P√°‚Äê
gina 6127)

Caracter√≠sticas de la CPU

W#16#xy12 (P√°‚Äê
gina 6128)

√Åreas de memoria del usuario

W#16#xy13 (P√°‚Äê
gina 6131)

√Åreas del sistema

W#16#xy14 (P√°‚Äê
gina 6132)

Tipos de bloque

W#16#xy15 (P√°‚Äê
gina 6133)

Identificaci√≥n de un componente

W#16#xy1C (P√°‚Äê
gina 6134)

Estado de alarma

W#16#xy22 (P√°‚Äê
gina 6140)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Lista parcial

SZL-ID

Correspondencia entre memorias imagen parcial de proceso y OBs

W#16#xy25 (P√°‚Äê
gina 6143)

Comunicaci√≥n: Datos de estado

W#16#xy32 (P√°‚Äê
gina 6146)

Estado de los LEDs de m√≥dulo

W#16#xy74 (P√°‚Äê
gina 6153)

Informaci√≥n del sistema maestro DP

W#16#xy90 (P√°‚Äê
gina 6155)

Informaci√≥n de estado del m√≥dulo

W#16#xy91 (P√°‚Äê
gina 6156)

Informaci√≥n de estado del rack/de la estaci√≥n

W#16#xy92 (P√°‚Äê
gina 6162)

Informaci√≥n de estado del rack/de la estaci√≥n

W#16#xy94 (P√°‚Äê
gina 6165)

Informaci√≥n avanzada del sistema maestro DP

W#16#xy95 (P√°‚Äê
gina 6167)

Informaci√≥n de estado del m√≥dulo con PROFINET IO y PROFIBUS DP

W#16#xy96 (P√°‚Äê
gina 6168)

B√∫fer de diagn√≥stico

W#16#xyA0 (P√°‚Äê
gina 6175)

Informaci√≥n de diagn√≥stico del m√≥dulo (DS 0)

W#16#00B1 (P√°‚Äê
gina 6176)

Informaci√≥n de diagn√≥stico del m√≥dulo (DS 1), direcci√≥n f√≠sica

W#16#00B2 (P√°‚Äê
gina 6178)

Informaci√≥n de diagn√≥stico del m√≥dulo (DS 1), direcci√≥n l√≥gica

W#16#00B3 (P√°‚Äê
gina 6179)

Datos de diagn√≥stico de un esclavo DP

W#16#00B4 (P√°‚Äê
gina 6179)

ID de SZL W#16#xy11: ID de m√≥dulo
Finalidad
La identificaci√≥n de este m√≥dulo se obtiene a trav√©s de la lista parcial con la SZL-ID (ID de lista
de estado del sistema) W#16#xy11.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6127

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de SZL con la SZL-IDW#16#xy11 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial
W#16#0111: Un solo registro de identificaci√≥n

INDEX

N√∫mero de un determinado registro
W#16#0001: Identificaci√≥n del m√≥dulo
W#16#0006: Identificaci√≥n del hardware base
W#16#0007: Identificaci√≥n del firmware base

LENTHDR

W#16#001C: Un registro tiene una longitud de 14 palabras (28 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la SZL con la SZL-IDW#16#xy11 tiene la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra N√∫mero de un registro de identificaci√≥n

MRPC

20 bytes

Machine-Readable Product Code
Con INDEX W#16#0007: Reservado
Con INDEXW#16#0001 y W#16#0006: Referencia del m√≥dulo; cadena de
19 caracteres y un espacio en blanco (20H); p. ej. para CPU 314: "6ES7
314-0AE01-0AB0"

ModuleType

1 palabra Reservado

OutMod1

1 palabra Con INDEXW#16#0001: Versi√≥n del m√≥dulo
Con INDEXW#16#0006 y W#16#0007: "V" y la primera cifra del identifica‚Äê
dor de versi√≥n

OutMod2

1 palabra Con INDEXW#16#0001: Reservado
Con INDEXW#16#0006y W#16#0007: Resto de cifras del identificador de
versi√≥n

ID de SZL W#16#xy12: caracter√≠sticas de la CPU
Finalidad
Los m√≥dulos del tipo CPU poseen una serie de caracter√≠sticas con una clara dependencia del
hardware. Cada una de estas caracter√≠sticas tiene asignado un identificador. Las
caracter√≠sticas del m√≥dulo se pueden conocer a trav√©s de la lista parcial con la SZL-ID (ID de
lista de estado del sistema) W#16#xy12.

6128

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy12 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial:
W#16#0012: Todas las caracter√≠sticas
W#16#0112: Caracter√≠sticas de un grupo; el grupo se indica en el par√°metro INDEX.
W#16#0F12: Solo informaci√≥n de encabezado de la lista parcial SZL

INDEX

Grupo
W#16#0000: Unidad de procesamiento MC7
W#16#0100: Sistema horario
W#16#0200: Comportamiento del sistema
W#16#0300: Descripci√≥n de lenguaje MC7 de la CPU
W#16#0400: Disponibilidad de la instrucci√≥n "C_DIAG (P√°gina 6184)"

LENTHDR

W#16#0002: Un registro tiene una longitud de una palabra (2 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la SZL-IDW#16#xy12 tiene una longitud de una palabra. Para
cada caracter√≠stica existente hay almacenado un identificador de caracter√≠stica. Un
identificador de caracter√≠stica tiene una longitud de una palabra.
Nota
Se visualizan todos los registros relevantes para la CPU en uso. Se muestran uno tras otro sin
espacios intermedios.

Identificador de caracter√≠stica
La tabla siguiente contiene todos los identificadores de caracter√≠sticas.
Identificador

Significado

W#16#0000 - 00FF

Unidad de procesamiento MC7 (grupo con √≠ndice 0000)

W#16#0001

Procesamiento MC7 generador de c√≥digo

W#16#0002

Int√©rprete MC7

W#16#0100 - 01FF

Sistema horario (grupo con √≠ndice 0100)

W#16#0101

Resoluci√≥n de 1 ms

W#16#0102

Resoluci√≥n de 10 ms

W#16#0103

Sin reloj en tiempo real

W#16#0104

Formato de hora BCD

W#16#0105

Conjunto de la funcionalidad horaria (ajustar hora, activar y leer estado de
hora, sincronizaci√≥n horaria: Reloj esclavo y reloj maestro)

W#16#0106

OB_RT est√° disponible

W#16#0200 - 02FF

Comportamiento del sistema (grupo con √≠ndice 0200)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6129

Instrucciones
4.2 Instrucciones

6130

Identificador

Significado

W#16#0201

Apto para multiprocesamiento

W#16#0202

Arranque en fr√≠o, rearranque completo (en caliente) y rearranque disponi‚Äê
bles

W#16#0203

Arranque en fr√≠o y rearranque completo (en caliente) disponibles

W#16#0204

Rearranque completo (en caliente) y rearranque disponibles

W#16#0205

Solo rearranque completo (en caliente) disponible

W#16#0206

Es posible reconfigurar en RUN para la periferia descentralizada mediante
m√≥dulos de reserva configurados.

W#16#0208

Con atenci√≥n a la funcionalidad de Motion Control

W#16#0300 - 03FF

Descripci√≥n de lenguaje MC7 de la CPU (grupo con √≠ndice 0300)

W#16#0301

Ocupado

W#16#0302

Todos los comandos con n√∫meros en coma fija de 32 bits

W#16#0303

Todos los comandos con n√∫meros en coma flotante

W#16#0304

sin, asin, cos, acos, tan, atan, sqr, sqrt, ln, exp

W#16#0305

Acu3/Acu4 con los comandos correspondientes (ENT, PUSH, POP, LEA‚Äê
VE)

W#16#0306

Comandos de Master Control Relay

W#16#0307

Registro de direcciones 1 presente con los comandos correspondientes

W#16#0308

Registro de direcciones 2 presente con los comandos correspondientes

W#16#0309

Comandos para el direccionamiento de varias √°reas

W#16#030A

Comandos para el direccionamiento interno de un √°rea

W#16#030B

Todos los comandos de direccionamiento indirecto mediante M

W#16#030C

Todos los comandos de direccionamiento indirecto mediante DB

W#16#030D

Todos los comandos de direccionamiento indirecto mediante DI

W#16#030E

Todos los comandos de direccionamiento indirecto mediante LD

W#16#030F

Todos los comandos para la transferencia de par√°metros en instrucciones

W#16#0310

Comandos de marcas de flanco mediante E

W#16#0311

Comandos de marcas de flanco mediante A

W#16#0312

Comandos de marcas de flanco mediante M

W#16#0313

Comandos de marcas de flanco mediante DB

W#16#0314

Comandos de marcas de flanco mediante DI

W#16#0315

Comandos de marcas de flanco mediante LD

W#16#0316

Evaluaci√≥n din√°mica del bit ERAB

W#16#0317

√Årea de datos local din√°mica con los correspondientes comandos

W#16#0318

Ocupado

W#16#0319

Ocupado

W#16#0401

Ocupado

W#16#0402

Reservado

W#16#0403

"C_DIAG (P√°gina 6184)" est√° disponible

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

ID de SZL W#16#xy13: √°reas de memoria del usuario
Finalidad
La informaci√≥n sobre las √°reas de memoria de este m√≥dulo se puede obtener a trav√©s de la
lista parcial con la SZL-ID (ID de lista de estado del sistema) W#16#xy13.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy13 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La SZL-ID del extracto de lista parcial
W#16#0113: Registro para un √°rea de memoria
Para indicar el √°rea de memoria debe usarse el par√°metro INDEX.

INDEX

Indicar un √°rea de memoria (solo con SZL-IDW#16#0113)
W#16#0001: Memoria de trabajo

LENTHDR

W#16#0024: Un registro tiene una longitud de 18 palabras (36 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la SZL-IDW#16#xy13 tiene la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra √çndice de un √°rea de memoria

Code

1 palabra Tipo de memoria:

W#16#0001: Memoria de trabajo
‚óè W#16#0001: Memoria vol√°til (RAM)
‚óè W#16#0002: Memoria no vol√°til (FEPROM)
‚óè W#16#0003: Memoria mixta (RAM y FEPROM)
Size

2 pala‚Äê
bras

Tama√±o total de la memoria seleccionada (suma de Area1 y Area2)

Mode

1 palabra Modo l√≥gico de la memoria
‚óè Bit 0: √Årea de memoria vol√°til
‚óè Bit 1: √Årea de memoria no vol√°til
‚óè Bit 2: √Årea de memoria mixta
Para memoria de trabajo:
‚óè Bit 3: C√≥digo y datos separados
‚óè Bit 4: C√≥digo y datos juntos

Granularity

1 palabra Siempre ocupado con "0"

Area1

2 pala‚Äê
bras

Tama√±o en bytes del √°rea de memoria vol√°til

Reserved1

2 pala‚Äê
bras

Tama√±o del √°rea de memoria vol√°til ocupada

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6131

Instrucciones
4.2 Instrucciones
Nombre

Longitud

Significado

Block1

2 pala‚Äê
bras

Mayor bloque libre en el √°rea de memoria vol√°til

Area2

2 pala‚Äê
bras

Tama√±o en bytes del √°rea de memoria no vol√°til

Reserved2

2 pala‚Äê
bras

Tama√±o del √°rea de memoria no vol√°til ocupada

Block2

2 pala‚Äê
bras

Mayor bloque libre en el √°rea de memoria no vol√°til

Si es "0": No hay informaci√≥n o la informaci√≥n no se puede recuperar.

Si es "0": No hay informaci√≥n o la informaci√≥n no se puede recuperar.

ID de SZL W#16#xy14: √°reas del sistema
Finalidad
La informaci√≥n sobre las √°reas del sistema de este m√≥dulo se puede obtener a trav√©s de la lista
parcial con la SZL-ID (ID de lista de estado del sistema) W#16#xy14.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy14 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La SZL-ID del extracto de lista parcial
W#16#0014: Todas las √°reas del sistema de un m√≥dulo
W#16#0F14: Solo informaci√≥n de encabezado de la lista parcial SZL

INDEX

Irrelevante

LENTHDR

W#16#0008: Un registro tiene una longitud de 4 palabras (8 bytes)

N_DR

N√∫mero de registros
El n√∫mero de registros debe parametrizarse por lo menos con 9. Si se elige un √°rea
de destino demasiado peque√±a, "RDSYSST (P√°gina 6116)" no devuelve ning√∫n
registro.

6132

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Registro
Un registro de la lista parcial con la SZL-IDW#16#xy14 tiene la siguiente estructura:
Nombre

Longitud

Index

1 palabra

Significado
√çndice del √°rea del sistema
‚óè W#16#0001: PAE (cantidad en bytes)
‚óè W#16#0002: PAA (cantidad en bytes)
‚óè W#16#0003: Marca (cantidad en bits)
Nota: Este √≠ndice solo es devuelto por las CPUs en las que la cantidad de
marcas puede representarse en una palabra.
Si la CPU usada no devuelve este valor, debe evaluarse el √≠ndice
W#16#0008 .
‚óè W#16#0004: Temporizadores (cantidad)
‚óè W#16#0005: Contadores (cantidad)
‚óè W#16#0006: N√∫mero de bytes en el √°rea de direcciones l√≥gica
‚óè W#16#0007: Datos locales (toda el √°rea de datos local de la CPU, en
bytes)
Nota: Este √≠ndice solo es devuelto por las CPUs en las que la longitud de toda
el √°rea de datos local puede representarse en una palabra.
Si la CPU usada no devuelve este valor, debe evaluarse el √≠ndice
W#16#0009.
‚óè W#16#0008: Marcas (cantidad en bytes)
‚óè W#16#0009: Datos locales (toda el √°rea de datos local de la CPU, en KB)

code

1 palabra

Tipo de memoria
‚óè W#16#0001: Memoria vol√°til (RAM)
‚óè W#16#0002: Memoria no vol√°til (FEPROM)
‚óè W#16#0003: Memoria mixta (RAM y FEPROM)

number

1 palabra

N√∫mero de elementos del √°rea del sistema

retentive

1 palabra

N√∫mero de elementos remanentes

ID de SZL W#16#xy15: Tipos de bloque
Finalidad
Los tipos de bloque presentes en un m√≥dulo se pueden conocer a trav√©s de la lista parcial con
la SZL-ID (ID de lista de estado del sistema) W#16#xy15.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy15 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La SZL-ID del extracto de lista parcial
W#16#0015: Registros de todos los tipos de bloque de un m√≥dulo

INDEX

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Irrelevante

6133

Instrucciones
4.2 Instrucciones
Contenido

Significado

LENTHDR

W#16#000A: Un registro tiene una longitud de 5 palabras (10 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la SZL-IDW#16#xy15 tiene la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra N√∫mero de tipo de bloque
‚óè W#16#0800: OB
‚óè W#16#0A00: DB
‚óè W#16#0B00: SDB
‚óè W#16#0C00: FC
‚óè W#16#0E00: FB

MaxNumber

1 palabra N√∫mero m√°ximo de bloques del tipo
‚óè con OBs: N√∫mero m√°ximo posible de OBs de una CPU
‚óè con DBs: N√∫mero m√°ximo posible de DBs, incluido el DB0
‚óè con SDBs: N√∫mero m√°ximo posible de SDBs, incluido el SDB2
‚óè con FCs y FBs: N√∫mero m√°ximo posible de bloques cargables

MaxLenght

1 palabra Tama√±o total m√°ximo en KB del objeto de carga

MaxWorkMem

2 pala‚Äê
bras

Longitud m√°xima en bytes de la porci√≥n de memoria de trabajo en un
bloque

ID de SZL W#16#xy1C: identificaci√≥n de un componente
Finalidad
La CPU o el sistema de automatizaci√≥n se pueden identificar a trav√©s de la lista parcial con la
SZL-ID (ID de lista de estado del sistema) W#16#xy1C.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy1C tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La SZL-ID del extracto de lista parcial
‚óè W#16#001C: Identificaci√≥n de todos los componentes
‚óè W#16#011C: Identificaci√≥n de un componente
‚óè W#16#0F1C: Solo informaci√≥n de encabezado de la lista parcial SZL

6134

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Contenido

Significado

INDEX

‚óè Identificaci√≥n del componente para el extracto de lista parcial con la SZLIDW#16#011C y W#16#031C
‚Äì

W#16#0001: Nombre del sistema de automatizaci√≥n

‚Äì

W#16#0002: Nombre del m√≥dulo

‚Äì

W#16#0003: Identificador de la instalaci√≥n del m√≥dulo

‚Äì

W#16#0004: Entrada de derechos de autor

‚Äì

W#16#0005: N√∫mero de serie del m√≥dulo

‚Äì

W#16#0007: Nombre del tipo de m√≥dulo

‚Äì

W#16#0008: N√∫mero de serie de la Memory Card
En los m√≥dulos que no permiten insertar una Memory Card, no se devuelve
ning√∫n registro.

‚Äì

W#16#0009: Fabricante y perfil de un m√≥dulo de CPU

‚Äì

W#16#000A: Identificador OEM de un m√≥dulo (solo S7-300)

‚Äì

W#16#000B: Identificador de la situaci√≥n de un m√≥dulo

‚Äì

W#16#000C: n√∫mero de serie del m√≥dulo Sync 1

‚Äì

W#16#000D: n√∫mero de serie del m√≥dulo Sync 2

‚óè N√∫mero de rack correspondiente al extracto de lista parcial con la SZLIDW#16#021C (byte 0: N√∫mero de rack, byte 1: B#16#00)
LENTHDR

W#16#0022: Un registro tiene una longitud de 17 palabras (34 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la SZL-IDW#16#xy1C tiene la siguiente estructura:
INDEX = W#16#0001
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#0001
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:
‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#01

name

12 palabras Nombre del sistema de automatizaci√≥n
(m√°ximo 24 caracteres; si se utilizan menos, se rellena el resto con B#16#00)

res

4 palabras

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Reservado

6135

Instrucciones
4.2 Instrucciones
INDEX = W#16#0002
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#0002
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:
‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#02

name

12 palabras Nombre del m√≥dulo
(m√°ximo 24 caracteres; si se utilizan menos, se rellena el resto con
B#16#00 )

res

4 palabras

Reservado

INDEX = W#16#0003
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#0003
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:

tag

‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#03

16 palabras Identificador de la instalaci√≥n del m√≥dulo
(m√°ximo 32 caracteres; si se utilizan menos, se rellena el resto con
B#16#00)

INDEX = W#16#0004
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#0004
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:

6136

‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#04

copyright

13 palabras Cadena de caracteres constante "Original Siemens Equipment"

res

3 palabras

Reservado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
INDEX = W#16#0005
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#0005
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:

serialn

‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#05

12 palabras N√∫mero de serie del m√≥dulo (cadena de un m√°ximo de 24 caracteres. Si se
utilizan menos, se rellena el resto con B#16#00).
Nota: El n√∫mero de serie es un√≠voco en todo el mundo para componentes
SIMATIC. Est√° vinculado al hardware de la CPU, es decir, se mantiene aun
en caso de que se actualice el firmware.

res

4 palabras

Reservado

INDEX = W#16#0007
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#0007
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:

cputypname

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#07

16 palabras Nombre del tipo de m√≥dulo (cadena de un m√°ximo de 32 caracteres. Si
se utilizan menos, se rellena el resto con B#16#00).

6137

Instrucciones
4.2 Instrucciones
INDEX = W#16#0008
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#0008
‚óè Con los extractos de lista parcial W#16#011C, W#16#021C y
W#16#031C:
byte 0:

sn_mc/mmc

‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#08

16 palabras N√∫mero de serie de la Memory Card/Micro Memory Card (cadena de un
m√°ximo de 32 caracteres). Si se utilizan menos, se rellena el resto con
B#16#00).
‚óè Para n√∫meros de serie Siemens: N√∫mero de serie sin
complementos
‚óè Para n√∫meros de serie de producto (PSN) de una Micro Memory
Card de S7: "MMC" m√°s n√∫mero de serie (PSN)
‚óè Para n√∫meros de serie de una Memory Card de S7: "MC" m√°s
n√∫mero de serie
Si no hay ninguna Memory Card insertada, la cadena de caracteres
finaliza justo despu√©s de "MMC" o "MC".

INDEX = W#16#0009
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial
W#16#011C: Identificador del componente: W#16#0009
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:

6138

‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#09

manufacturer_id

1 palabra

Ver PROFIBUS Profile Guidelines Part 1, Identification & Mainte‚Äê
nance Functions

profile_id

1 palabra

Ver PROFIBUS Profile Guidelines Part 1, Identification & Mainte‚Äê
nance Functions

profile_specific_typ

1 palabra

Ver PROFIBUS Profile Guidelines Part 1, Identification & Mainte‚Äê
nance Functions

res

13 palabras Reservado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
INDEX = W#16#000A
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial
W#16#011C: Identificador del componente: W#16#000A
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:
‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#0A

oem_copy‚Äê
right_string

13 palabras

Identificador de copyright OEM (cadena de un m√°ximo de 20 ca‚Äê
racteres. Si se utilizan menos, se rellena el resto con B#16#00).

oem_id

1 palabra

ID de OEM. Asignada por Siemens.

oem_add_id

2 palabras

Identificador adicional de OEM. Definible por el usuario.

INDEX = W#16#000B
Nombre

Longitud

Significado

index

1 palabra

‚óè Con una CPU est√°ndar y el extracto de lista parcial W#16#011C:
Identificador del componente: W#16#000B
‚óè Con los extractos de lista parcial W#16#021C y W#16#031C:
byte 0:

loc_id

‚Äì

Bits de 0 a 2: N√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111
byte 1: Identificador del componente: B#16#0B

16 palabras Identificador de situaci√≥n (cadena de un m√°ximo de 32 caracteres. Si se
utilizan menos, se rellena el resto con B#16#00).

INDEX = W#16#000C
Nombre

Longitud

Significado

index

1 palabra

‚óè Byte0:
‚Äì

Bits de 0 a 2: n√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111

‚óè Byte 1: identificador del componente: B#16#0C
mlfb

5 palabras

Del car√°cter 10.¬∫ al 19.¬∫ de la referencia del m√≥dulo Sync 1

fill

1 palabra

Cuatro espacios (ASCII)

es

1 palabra

Versi√≥n (ASCII), p. ej. "01"

fill

1 byte

Dos espacios (ASCII)

vendor_sn

17 bytes

N√∫mero de serie

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6139

Instrucciones
4.2 Instrucciones

Nota
Si no existe el m√≥dulo Sync 1 o no se puede identificar, el registro se rellena seg√∫n la variable
"index" con B#16#00.

INDEX = W#16#000D
Nombre

Longitud

Significado

index

1 palabra

‚óè Byte0:
‚Äì

Bits de 0 a 2: n√∫mero de rack;

‚Äì

Bit 3: 0 = CPU de reserva, 1 = CPU maestra;

‚Äì

Bits de 4 a 7: 1111

‚óè Byte 1: identificador del componente: B#16#0D
mlfb

5 palabras

Del car√°cter 10.¬∫ al 19.¬∫ de la referencia del m√≥dulo Sync 2

fill

1 palabra

Cuatro espacios (ASCII)

es

1 palabra

Versi√≥n (ASCII), p. ej. "01"

fill

1 byte

Dos espacios (ASCII)

vendor_sn

17 bytes

N√∫mero de serie

Nota
Si no existe el m√≥dulo Sync 2 o no se puede identificar, el registro se rellena seg√∫n la variable
"index" con B#16#00.

ID de SZL W#16#xy22: estado de alarma
Finalidad
El estado actual de procesamiento de alarma y generaci√≥n de alarmas se puede conocer a
trav√©s de la lista parcial con la SZL-ID (ID de lista de estado del sistema) W#16#xy22.

6140

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy22 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial
W#16#0222 Registro para la alarma especificada. Debe indicarse la alarma
(n.¬∫ de OB) en el par√°metro INDEX.

INDEX

N.¬∫ de OB o clase de alarma (para SZL-IDW#16#0222)
W#16#0000: Ciclo libre
W#16#000A: Alarma horaria
W#16#0014: Alarma de retardo
W#16#001E: Alarma c√≠clica
W#16#0028: Alarma de proceso
W#16#0032: Alarma DP
W#16#003C: Alarma de sincronismo
W#16#0050: Alarmas de error as√≠ncronas
W#16#005A: Segundo plano
W#16#0064: Arranque
W#16#0078: Alarmas de error sincr√≥nicas

LENTHDR

W#16#001C: Un registro tiene una longitud de 14 palabras (28 bytes)

N_DR

N√∫mero de registros

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6141

Instrucciones
4.2 Instrucciones

Registro
Un registro de la lista parcial con la SZL-IDW#16#xy22 tiene la siguiente estructura:
Nombre

Longitud

Significado

Info

10 palabras Informaci√≥n de arranque del OB correspondiente, con las siguientes
excepciones:
‚óè En el OB 1 se obtienen el tiempo de ciclo actual m√≠nimo (en los
bytes 8 y 9) y m√°ximo (en los bytes 10 y 11) (base de tiempo: ms,
recuento de bytes a partir de 0).
‚óè Mientras est√° activa una petici√≥n para una alarma de retardo, los
bytes de 8 a 11 (recuento de bytes a partir de 0) contienen el tiempo
restante en ms respecto al retardo parametrizado.
‚óè En el OB 80 se pueden leer el tiempo de ciclo configurado m√≠nimo
(en los bytes 8 y 9) y m√°ximo (en los bytes 10 y 11) (base de
tiempo: ms, recuento de bytes a partir de 0).
‚óè Para alarmas de error sin informaci√≥n actual
‚óè En las alarmas, la informaci√≥n de estado contiene la
parametrizaci√≥n actual de origen de la alarma.
‚óè En los errores sincr√≥nicos, se registra como clase de prioridad
B#16#7F si los OBs todav√≠a no se han procesado; de lo contrario
se registra la clase de prioridad de la √∫ltima llamada.
‚óè Si un OB tiene varios eventos de arranque y estos no se han
producido todav√≠a en el momento de recabar la informaci√≥n, se
devuelve como n√∫mero de evento W#16#xyzz con:

6142

‚Äì

x: Clase de evento

‚Äì

zz: N√∫mero menor definido del grupo

‚Äì

y: Sin definir. De lo contrario, se utiliza el n√∫mero del √∫ltimo
evento de arranque que se ha producido.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre

Longitud

Significado

AlarmStatus1

1 palabra

Identificadores de procesamiento:
‚óè Bit 0: Estado del evento de alarma fijado mediante
parametrizaci√≥n:
‚Äì

= 0: Habilitado

‚Äì

= 1: Bloqueado

‚óè Bit 1: Estado del evento de alarma fijado mediante "DIS_IRT
(P√°gina 6059)":
‚Äì

= 0: No bloqueado

‚Äì

= 1: Bloqueado

‚óè Bit 2 = 1: El origen de la alarma est√° activo (en el caso de las
alarmas de tiempo, la petici√≥n de generaci√≥n est√° vigente (OB de
alarma horaria iniciado), OB de alarma de retardo iniciado, OB de
alarma c√≠clica configurado)
‚óè Bit 4: El OB de alarma
‚Äì

= 0: no est√° cargado

‚Äì

= 1: est√° cargado

‚óè Bit 5: Estado del OB de alarma fijado mediante TIS:
‚Äì

= 1: Bloqueado

‚óè Bit 6: Entrada en el b√∫fer de diagn√≥stico
‚Äì
AlarmStatus2

1 palabra

= 1: Bloqueado

Reacci√≥n si el OB no est√° cargado o est√° bloqueado
‚óè Bit 0 = 1: Bloquear origen de alarma
‚óè Bit 1 = 1: Generar error de evento de alarma
‚óè Bit 2 = 1: La CPU pasa al estado operativo STOP
‚óè Bit 3 = 1: La alarma solo se descarta

AlarmStatus3

2 palabras

Descartar mediante funciones TIS:
N.¬∫ de bit x activado significa: El n√∫mero de evento que excede en x el
menor n√∫mero de evento del OB en cuesti√≥n est√° descartado median‚Äê
te funci√≥n TIS.

ID de SZL W#16#xy25: correspondencia entre memorias imagen parcial de proceso y OBs
Finalidad
La correspondencia entre memorias imagen parcial de proceso y OBs se puede conocer a
trav√©s de la lista parcial con la SZL-ID (ID de lista de estado del sistema) W#16#xy25.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6143

Instrucciones
4.2 Instrucciones
La lista parcial informa acerca de
‚óè Memorias imagen parcial de proceso que se han asignado a OBs individuales para su
actualizaci√≥n por el sistema
‚óè Memorias imagen parcial de proceso que se han asignado a OBs de alarma de sincronismo
individuales (OBs 61 a 64) En este caso, la actualizaci√≥n de memorias imagen parcial de
proceso se realiza llamando las instrucciones "SYNC_PI (P√°gina 5884)" y "SYNC_PO
(P√°gina 5886)".
La correspondencia entre los sistemas maestros DP y los OBs de alarma de sincronismo
se puede conocer a trav√©s de SZL W#16#xy95 (P√°gina 6167).

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy25 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial
‚óè W#16#0025: Correspondencia entre todas las memorias imagen parcial de proceso
y OBs dentro de la CPU
‚óè W#16#0125: Correspondencia entre una memoria imagen parcial de proceso y el
correspondiente OB
El n√∫mero de memoria imagen parcial de proceso se especifica en el par√°metro
INDEX.
‚óè W#16#0225: Correspondencia entre un OB y las correspondientes memorias imagen
parcial de proceso
El n√∫mero de OB se especifica en el par√°metro INDEX.
Nota: Solo es posible asignar varias memorias imagen parcial de proceso a los OBs
de alarma de sincronismo (OBs 61 a 64).
‚óè W#16#0F25: Solo informaci√≥n de encabezado de la lista parcial SZL

INDEX

‚óè Para SZL-ID W#16#0025: Irrelevante
‚óè Para SZL-ID W#16#0125: N.¬∫ de memoria imagen parcial de proceso
‚óè Para SZL-ID W#16#0225: N.¬∫ de OB
‚óè Para SZL-ID W#16#0F25: Irrelevante

6144

LENTHDR

W#16#0004: Un registro tiene una longitud de 2 palabras (4 bytes)

N_DR

N√∫mero de registros

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Registro
Un registro del extracto de lista parcial con la SZL-IDW#16#xy25 tiene la siguiente estructura:
Nombre

Longitud

Significado

PPI*_nr

1 bytes

N.¬∫ de memoria imagen parcial de proceso

PPI*_use

1 bytes

Tipo de correspondencia entre memoria imagen parcial de proceso y OB:
‚óè Bit 0 = 1: La memoria imagen parcial de proceso de entrada est√°
asignada al OB especificado para su actualizaci√≥n por el sistema.
‚óè Bit 1 = 1: La memoria imagen parcial de proceso de salida est√°
asignada al OB especificado para su actualizaci√≥n por el sistema.
‚óè Bit 2 = 1: La memoria imagen parcial de proceso de entrada est√°
asignada al OB de alarma de sincronismo especificado y puede
actualizarse llamando "SYNC_PI (P√°gina 5884)" en ese OB.
‚óè Bit 3 = 1: La memoria imagen parcial de proceso de salida est√°
asignada al OB de alarma de sincronismo especificado y puede
actualizarse llamando "SYNC_PO (P√°gina 5886)" en ese OB.
‚óè Bits de 4 a 7: 0

ob_nr

1 bytes

N.¬∫ de OB

res

1 bytes

Reservado

*PPI: Parial Process Image

Extractos de lista parcial
‚óè Extracto de lista parcial con SZL-ID = W#16#0025:
Se devuelven en orden ascendente los registros de todas las memorias imagen parcial de
proceso que se han asignado a un OB en la configuraci√≥n. Para las memorias imagen
parcial de proceso no asignadas a ning√∫n OB, ob_nr tiene valor cero. No se devuelve
ning√∫n registro para memorias imagen parcial de proceso.
‚óè Extracto de lista parcial con SZL-ID = W#16#0125:
Si en la configuraci√≥n se ha asignado un OB a la memoria imagen parcial de proceso a la
que se accede, se devuelve un registro. Si no se ha asignado ning√∫n OB, no se devuelve
ning√∫n registro.
Nota
La memoria imagen parcial de proceso 0 tiene asignado de modo predeterminado el OB 1.
En consecuencia, al solicitar informaci√≥n acerca de la memoria imagen parcial de proceso
0, siempre se obtiene un registro.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6145

Instrucciones
4.2 Instrucciones
‚óè Extracto de lista parcial con SZL-ID = W#16#0225:
Para cada memoria imagen parcial de proceso asignada al OB al que se accede, se
devuelve un registro. Si en la configuraci√≥n no se ha asignado al OB al que se accede
ninguna memoria imagen parcial de proceso, no se devuelve ning√∫n registro.
Nota
Los OBs de alarma de sincronismo pueden tener asignadas varias memorias imagen
parcial de proceso. En ese caso se devuelven varios registros.
‚óè Extracto de lista parcial SZL-ID = W#16#0F25:
Se devuelve el n√∫mero m√°ximo posible de registros.

Ejemplos de significado de los registros
Par√°metros de llamada
de "RDSYSST (P√°gi‚Äê
na 6116)"

Variables devueltas

Explicaci√≥n

SZL_ID = W#16#0125,
INDEX = W#16#0008

PPI*_nr = B#16#08,
PPI*_use = B#16#03,
ob_nr = B#16#15

Se devuelve un registro.
Las memorias imagen de proceso de entrada y sa‚Äê
lida 8 est√°n asignadas al OB 21 para su actualiza‚Äê
ci√≥n por el sistema.

SZL_ID = W#16#0125,
INDEX = W#16#0009

‚Äì

No se devuelve ning√∫n registro.
Por lo tanto: La memoria imagen parcial de proceso
9 no est√° asignada a ning√∫n OB.

SZL_ID = W#16#0225,
INDEX = W#16#003D

PPI*_nr = B#16#0A,
PPI*_use = B#16#C0,
ob_nr = B#16#3D

Se devuelven dos registros.
El OB 61 tiene asignadas las memorias imagen de
proceso de entrada y salida 10 y 16. Estas pueden
actualizarse en el OB 61 llamando "SYNC_PI (P√°‚Äê
gina 5884)" y "SYNC_PO (P√°gina 5886)".

PPI*_nr = B#16#10,
PPI*_use = B#16#C0,
ob_nr = B#16#3D
SZL_ID = W#16#0225,
INDEX = W#16#0001

PPI*_nr = B#16#00,
PPI*_use = B#16#03,
ob_nr = B#16#01

Se devuelve un registro.
El OB 1 tiene asignadas las memorias imagen de
proceso de entrada y salida 0. Estas son actualiza‚Äê
das por el sistema.

*PPI: Parial Process Image

ID de SZL W#16#xy32: Datos de estado de comunicaci√≥n
ID de SZL W#16#xy32: Datos de estado de comunicaci√≥n
Finalidad
Los datos de estado de comunicaci√≥n del m√≥dulo se pueden obtener a trav√©s de la lista parcial
con la SZL-IDW#16#xy32.

6146

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL‚ÄëIDW#16#xy32 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL‚ÄëID del extracto de lista parcial
‚óè W#16#0132: Datos de estado de un componente de comunicaci√≥n (siempre solo un
registro). Para indicar el componente de comunicaci√≥n debe usarse el par√°metro
INDEX.
‚óè W#16#0232: Datos de estado para un componente de comunicaci√≥n. Para indicar el
componente de comunicaci√≥n debe usarse el par√°metro INDEX.

INDEX

Componente de comunicaci√≥n
‚óè Para SZL‚ÄëIDW#16#0132:
‚Äì

W#16#0005 Diagn√≥stico

‚Äì

W#16#0008 Sistema horario

‚Äì

W#16#000B Sistema horario

‚Äì

W#16#000C Sistema horario

‚óè Para SZL‚ÄëIDW#16#0232:
W#16#0004 Nivel de protecci√≥n de la CPU, posiciones del interruptor de manejo e
identificadores de versi√≥n/sumas de verificaci√≥n
LENTHDR

W#16#0028: Un registro tiene una longitud de 20 palabras (40 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la SZL-IDW#16#0132 tiene siempre una longitud de 20
palabras. Los registros est√°n ocupados de diferentes maneras. La ocupaci√≥n depende del
par√°metro INDEX, es decir, de a qu√© componente de comunicaci√≥n corresponda el registro.

Registro del extracto de lista parcial con la ID de SZL W#16#0132 √çndice W#16#0005
Contenido
El extracto de lista parcial con la SZL-IDW#16#0132 y el IndexW#16#0005 contiene
informaci√≥n acerca del estado de diagn√≥stico del m√≥dulo.

Registro
Un registro del extracto de lista parcial con la SZL-IDW#16#0132 y el IndexW#16#0005 tiene
la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra

W#16#0005: Diagn√≥stico

ext

1 palabra

Funcionalidad avanzada
‚óè 0: No
‚óè 1: S√≠

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6147

Instrucciones
4.2 Instrucciones
Nombre

Longitud

Significado

send

1 palabra

Transmisi√≥n autom√°tica
‚óè 0: No
‚óè 1: S√≠

possible

1 palabra

La transmisi√≥n de avisos de diagn√≥stico del usuario es posible en este
momento
‚óè 0: No
‚óè 1: S√≠

res

16 palabras Reservado

Registro del extracto de lista parcial con la ID de SZL W#16#0132 √çndice W#16#0008
Contenido
El extracto de lista parcial con la SZL-IDW#16#0132 y el IndexW#16#0008 contiene
informaci√≥n acerca del estado del sistema horario del m√≥dulo.

Registro
Un registro del extracto de lista parcial con la SZL-IDW#16#0132 y el IndexW#16#0008 tiene
la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra

W#16#0008: Estado del sistema horario

cycle

1 palabra

Reservado

corr

1 palabra

Factor de correcci√≥n de la hora

clock 0

1 palabra

Contador de horas de funcionamiento 0: Tiempo en horas

clock 1

1 palabra

Contador de horas de funcionamiento 1: Tiempo en horas

clock 2

1 palabra

Contador de horas de funcionamiento 2: Tiempo en horas

clock 3

1 palabra

Contador de horas de funcionamiento 3: Tiempo en horas

clock 4

1 palabra

Contador de horas de funcionamiento 4: Tiempo en horas

clock 5

1 palabra

Contador de horas de funcionamiento 5: Tiempo en horas

clock 6

1 palabra

Contador de horas de funcionamiento 6: Tiempo en horas

clock 7

1 palabra

Contador de horas de funcionamiento 7: Tiempo en horas

time

4 palabras

Fecha y hora actuales (formato: date_and_time)

rtm _0

1 bytes

Runtime meter
Bit x: Contador de horas de funcionamiento x, 0 ‚â§ x ‚â§ 7 (bit = 1: Contador
de horas de funcionamiento en marcha)

res

1 bytes

Reservado

rtmOV _0

1 bytes

Runtime meter Overflow
Bit x: Desbordamiento del contador de horas de funcionamiento x, 0 ‚â§ x
‚â§ 7 (bit = 1: Desbordamiento)

6148

res

1 bytes

Reservado

status

1 palabra

Estado de la hora (para la asignaci√≥n de bits, ver abajo)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre

Longitud

Significado

res

3 bytes

Reservado

status_valid

1 bytes

Validez de la variable status: B#16#01: status v√°lida

Estado de la hora (status)
Bit

Valor prede‚Äê
terminado

Descripci√≥n

15

0

Signo del valor de correcci√≥n
(0: positivo, 1: negativo)

de 14 a 10 00000

Valor de correcci√≥n
Este par√°metro permite corregir la hora del m√≥dulo obtenida mediante
telegrama, p. ej. para ajustarla a la hora local:
Hora local = Hora del m√≥dulo ¬± Valor de
correcci√≥n * 0,5 h
Esta correcci√≥n tiene en cuenta la zona horaria y la diferencia entre el
horario de verano y el horario de invierno

9

0

Reservado

8

0

Reservado

7

0

Hora de aviso
Este par√°metro indica si en el pr√≥ximo cambio de hora se produce el cam‚Äê
bio de horario de verano a horario de invierno o al rev√©s.
(0: no se produce, 1: se produce)

6

0

Indicador de horario de verano/invierno
Este par√°metro indica si la hora local calculada mediante el valor de co‚Äê
rrecci√≥n corresponde al horario de verano o al de invierno.
(0: horario de invierno, 1: horario de verano)

5

0

Este par√°metro no se utiliza en S7.

de 4 a 3

00

Resoluci√≥n de hora
Este par√°metro refleja la exactitud de la hora transferida.
(00: 0,001 s, 01: 0,01 s, 10: 0,1 s, 11: 1 s)

2

0

Este par√°metro no se utiliza en S7.

1

0

Este par√°metro no se utiliza en S7.

0

0

Fallo de sincronizaci√≥n
Este par√°metro indica si la hora transferida en el telegrama est√° sincroni‚Äê
zada por un reloj maestro externo, p. ej. SICLOCK.
(0: la sincronizaci√≥n no se ha producido, 1: la sincronizaci√≥n se ha produ‚Äê
cido)
Nota:
Solo tiene sentido evaluar este bit en una CPU si existe sincronizaci√≥n
horaria externa continua.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6149

Instrucciones
4.2 Instrucciones

Registro del extracto de lista parcial con la ID de SZL W#16#0132 √çndice W#16#000B
Contenido
El extracto de lista parcial con la SZL-IDW#16#0132 y el IndexW#16#000B contiene
informaci√≥n acerca del estado de los contadores de horas de funcionamiento de 32 bits de 0
a 7 del m√≥dulo.
Nota
En el extracto de lista parcial con la SZL-IDW#16#0132 y el IndexW#16#0008, estos
contadores de horas de funcionamiento aparecen como contadores de horas de
funcionamiento de 16 bits.
Esto permite seguir utilizando los programas que han sido desarrollados para una CPU con
contadores de horas de funcionamiento de 16 bits, y que usan el extracto de lista parcial con
la SZL-IDW#16#0132 y el IndexW#16#0008.

Registro
Un registro del extracto de lista parcial con la SZL-IDW#16#0132 y el √≠ndice W#16#000B tiene
la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra W#16#000B: Estado del sistema horario

rtm _0

1 bytes

Runtime meter
Bit x: Estado del contador de horas de funcionamiento x , 0 ‚â§ x ‚â§ 7 (bit = 1:
Contador de horas de funcionamiento en marcha)

res

1 bytes

rtmOV _0

1 bytes

Reservado
Runtime meter overflow
Bit x: Desbordamiento del contador de horas de funcionamiento x, 0 ‚â§ x ‚â§ 7
(bit = 1: Desbordamiento)

6150

res

1 bytes

Reservado

clock 0

2 pala‚Äê
bras

Contador de horas de funcionamiento 0: Tiempo en horas

clock 1

2 pala‚Äê
bras

Contador de horas de funcionamiento 1: Tiempo en horas

clock 2

2 pala‚Äê
bras

Contador de horas de funcionamiento 2: Tiempo en horas

clock 3

2 pala‚Äê
bras

Contador de horas de funcionamiento 3: Tiempo en horas

clock 4

2 pala‚Äê
bras

Contador de horas de funcionamiento 4: Tiempo en horas

clock 5

2 pala‚Äê
bras

Contador de horas de funcionamiento 5: Tiempo en horas

clock 6

2 pala‚Äê
bras

Contador de horas de funcionamiento 6: Tiempo en horas

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre

Longitud

Significado

clock 7

2 pala‚Äê
bras

Contador de horas de funcionamiento 7: Tiempo en horas

res

1 palabra Reservado

Registro del extracto de lista parcial con la ID de SZL W#16#0132 √çndice W#16#000C
Contenido
El extracto de lista parcial con la SZL-IDW#16#0132 y el INDEXW#16#000C contiene
informaci√≥n acerca del estado de los contadores de horas de funcionamiento de 32 bits de 8
a 15 del m√≥dulo.

Registro
Un registro del extracto de lista parcial con la SZL-IDW#16#0132 y el INDEXW#16#000C tiene
la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra

W#16#000C: Estado del sistema horario

rtm_0

1 bytes

Runtime meter
Bit x: Estado del contador de horas de funcionamiento (8+x), 0 ‚â§ x ‚â§ 7 (bit =
1: Contador de horas de funcionamiento en marcha)

res

1 bytes

rtmOV _0

1 bytes

Reservado
Runtime meter overflow
Bit x: Desbordamiento del contador de horas de funcionamiento (8+x), 0 ‚â§ x
‚â§ 7 (bit = 1: Desbordamiento)

res

1 bytes

Reservado

clock 8

2 pala‚Äê
bras

Contador de horas de funcionamiento 8: Tiempo en horas

clock 9

2 pala‚Äê
bras

Contador de horas de funcionamiento 9: Tiempo en horas

clock 10

2 pala‚Äê
bras

Contador de horas de funcionamiento 10: Tiempo en horas

clock 11

2 pala‚Äê
bras

Contador de horas de funcionamiento 11: Tiempo en horas

clock 12

2 pala‚Äê
bras

Contador de horas de funcionamiento 12: Tiempo en horas

clock 13

2 pala‚Äê
bras

Contador de horas de funcionamiento 13: Tiempo en horas

clock 14

2 pala‚Äê
bras

Contador de horas de funcionamiento 14: Tiempo en horas

clock 15

2 pala‚Äê
bras

Contador de horas de funcionamiento 15: Tiempo en horas

res

1 palabra

Reservado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6151

Instrucciones
4.2 Instrucciones

Registro del extracto de lista parcial con la SZL-ID W#16#0232 √çndice W#16#0004
Contenido
El extracto de lista parcial con la SZL-IDW#16#0232 y el Index W#16#0004 contiene
informaci√≥n acerca del nivel de protecci√≥n de la CPU, las posiciones del selector de modo y las
sumas de verificaci√≥n de la configuraci√≥n de hardware y del programa de usuario.

Registro
Un registro del extracto de lista parcial con la SZL-IDW#16#0232 y el Index W#16#0004 tiene
la siguiente estructura:
Nombre

Longitud

Significado

Index

1 palabra

‚óè Byte 1:
B#16#04: Nivel de protecci√≥n de la CPU, posiciones del selector de modo y
sumas de verificaci√≥n
‚óè Byte 0:
CPU est√°ndar: B#16#00
Bit 3: 0 = CPU de reserva, 1 = CPU maestra
Bits de 4 a 7: 1111

ProtLevel_ModeSwitch

1 palabra

Nivel de protecci√≥n ajustado mediante selector de modo (1, 2, 3)

ProtLevel_Par

1 palabra

Nivel de protecci√≥n parametrizado (0, 1, 2, 3; 0: No hay ninguna contrase√±a
asignada, nivel de protecci√≥n no v√°lido).

ProtLevel_Valid

1 palabra

Nivel de protecci√≥n v√°lido de la CPU

ModeSwitch

1 palabra

Posici√≥n del selector de modo (1:RUN, 2:RUN-P, 3:STOP, 4:MRES, 0:no defi‚Äê
nida o desconocida)

Startup_ModeSwitch

1 palabra

Posici√≥n del selector de tipo de arranque (1:CRST, 2:WRST, 0:no definida, no
existente o desconocida)

res

1 palabra

Reservado

ID_Val_CheckSum

1 palabra

Identificador de la validez de las cuatro sumas de verificaci√≥n siguientes (0: no
v√°lido)

ID_CheckSum1_HWConf

1 palabra

Suma de verificaci√≥n 1 de la configuraci√≥n de hardware (formato Intel):
Operaci√≥n l√≥gica O-exclusiva con las longitudes de todos los bloques de datos
del sistema

ID_CheckSum2_HWConf

1 palabra

Suma de verificaci√≥n 2 de la configuraci√≥n de hardware (formato Intel):
Operaci√≥n l√≥gica O-exclusiva con las sumas de verificaci√≥n de todos los blo‚Äê
ques de datos del sistema

ID_CheckSum1_UserProg

1 palabra

Suma de verificaci√≥n 1 del programa de usuario (formato Intel):
Operaci√≥n l√≥gica O-exclusiva con las longitudes de los siguientes bloques: OBs,
DBs, FBs, FCs

ID_CheckSum2_UserProg

1 palabra

Suma de verificaci√≥n 2 del programa de usuario (formato Intel):
Operaci√≥n l√≥gica O-exclusiva con las sumas de verificaci√≥n de los siguientes
bloques: OBs, DBs, FBs, FCs

res

2 palabras

Reservado

sfc_req

1 palabra

Petici√≥n de nivel de protecci√≥n 2 o 3 realizada por la instrucci√≥n "PROTECT" (1:
petici√≥n realizada)

6152

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre

Longitud

Significado

sfc_act

1 palabra

Activaci√≥n del nivel de protecci√≥n 2 o 3 realizada por la instrucci√≥n "PROTECT"
(1: activaci√≥n realizada)

res

4 palabras

Reservado

SZL-ID W#16#xy74: estado de los LEDs de m√≥dulo
Finalidad
El estado de los LEDs de m√≥dulo se puede conocer a trav√©s de la lista parcial con la SZL-ID
W#16#xy74 en las CPU est√°ndar (si existe).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6153

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-ID W#16#xy74 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial
W#16#0174 Estado de un LED.
Para seleccionar el LED debe usarse el par√°metro INDEX.

INDEX

Identificador de LED (relevante solo para SZL-IDW#16#0174)
‚óè W#16#0001: SF (error de grupo)
‚óè W#16#0002: INTF (error interno)
‚óè W#16#0003: EXTF (error externo)
‚óè W#16#0004: RUN
‚óè W#16#0005: STOP
‚óè W#16#0006: FRCE (forzar permanentemente)
‚óè W#16#0007: CRST (rearranque completo)
‚óè W#16#0008: BAF (error de bater√≠a/sobrecarga, cortocircuito de la tensi√≥n de
bater√≠a en el bus)
‚óè W#16#0009: USR (personalizado)
‚óè W#16#000A: USR1 (personalizado)
‚óè W#16#000B: BUS1F (error de bus interfaz 1)
‚óè W#16#000C: BUS2F (error de bus interfaz 2) o BUS5F (error de bus interfaz 5) en
las CPUs 414-3 PN/DP, 416-3 PN/DP y 416F-3 PN/DP
‚óè W#16#0012: IFM1F (error de interfaz, m√≥dulo de interfaz 1)
‚óè W#16#0013: IFM2F (error de interfaz, m√≥dulo de interfaz 2)
‚óè W#16#0014: BUS3F (error de bus interfaz 3)
‚óè W#16#0015: MAINT (mantenimiento solicitado)
‚óè W#16#0016: DC 24 V
‚óè W#16#0017: BUS5F (error de bus interfaz 5)
‚óè W#16#0080: IF (fallo de inicializaci√≥n)
‚óè W#16#0081: UF (fallo de usuario)
‚óè W#16#0082: MF (fallo de monitorizaci√≥n)
‚óè W#16#0083: CF (fallo de comunicaci√≥n)
‚óè W#16#0084: TF (fallo de tarea)
‚óè W#16#00EC: APPL_STATE_RED
‚óè W#16#00ED: APPL_STATE_GREEN

6154

LENTHDR

W#16#0004: Un registro tiene una longitud de 2 palabras (4 bytes)

N_DR

N√∫mero de registros

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Registro
Un registro de la lista parcial con la SZL-ID W#16#xy74 tiene la siguiente estructura:
Nombre

Longitud

Significado

CPU_LED_ID

1 palabra ‚óè Byte 0:
‚Äì

CPU est√°ndar: B#16#00

‚Äì

Bit 3: 0=CPU de reserva, 1=CPU maestra

‚Äì

Bits de 4 a 7: 1111

‚óè Byte 1: Identificador de LED
LED_on

1 byte

Estado del LED:
‚óè 0: Off
‚óè 1: On

LED_flash

1 byte

Estado de parpadeo del LED:
‚óè 0: Sin parpadeo
‚óè 1: Parpadeo normal (2 Hz)
‚óè 2: Parpadeo lento (0,5 Hz)

SZL-ID W#16#xy90: informaci√≥n del sistema maestro DP
Finalidad
La informaci√≥n de estado de todos los sistemas maestros DP conocidos por la CPU se puede
obtener a trav√©s de la lista parcial con la SZL-IDW#16#xy90.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy90 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La SZL-ID del extracto de lista parcial
W#16#0090: Informaci√≥n acerca de todos los sistemas maestros DP conocidos por la
CPU
W#16#0190: Informaci√≥n acerca de un sistema maestro DP
W#16#0F90: Solo informaci√≥n de encabezado de lista parcial

INDEX

‚óè Para el extracto de lista parcial con la SZL-IDW#16#0190:
‚Äì

byte menos significativo: B#16#00

‚Äì

byte m√°s significativo: ID del sistema maestro DP

‚óè Para los extractos de lista parcial con las SZL-IDW#16#0090 y W#16#0F90:
‚Äì

W#16#0000

LENTHDR

W#16#000E: Un registro tiene una longitud de 7 palabras (14 bytes)

N_DR

N√∫mero de registros
Para el extracto de lista parcial con la SZL-IDW#16#0190: de 0 a 1
Para el extracto de lista parcial con la SZL-IDW#16#0090:
‚óè Con una CPU est√°ndar: de 0 a 14

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6155

Instrucciones
4.2 Instrucciones

Registro
Un registro de la lista parcial con la IDW#16#xy90 tiene la siguiente estructura:
Nombre

Longitud

Significado

dp_m_id

1 bytes

ID del sistema maestro DP

dp_m_rack

1 bytes

N√∫mero de rack del maestro DP
‚óè Con una CPU est√°ndar: 0

dp_m_slot

1 bytes

Slot del maestro DP o
slot de la CPU (con interfaz DP integrada)

dp_m_SubModule

1 bytes

‚óè Con interfaz DP integrada: N√∫mero de interfaz del maestro DP:
‚Äì

1: X2

‚Äì

2: X1

‚Äì

3: IF1

‚Äì

4: IF2

‚óè Con interfaz DP externa: 0
logadr

1 palabra

Direcci√≥n l√≥gica inicial del maestro DP

res

1 palabra

Reservado

res

1 palabra

Reservado

dp_m_state

1 bytes

Otras caracter√≠sticas del sistema maestro DP
Bit 0:

Modo DP
‚óè 0: Compatible con S7
‚óè 1: DPV1

Bit 1:

Ciclo DP
‚óè 0: No equidistante
‚óè 1: Equidistante

Bits de 2 a
6:

‚óè Reservado

Bit 7:

Tipo de maestro DP
‚óè 0: Maestro DP integrado
‚óè 1: Maestro DP externo

res

3 bytes

Reservado

SZL-ID W#16#xy91: informaci√≥n de estado de m√≥dulo
Finalidad
La informaci√≥n de estado de todos los m√≥dulos asignados a la CPU se puede obtener a trav√©s
de la lista parcial con la SZL-ID W#16#xy91.
Nota
No es posible evaluar la SZL-ID W#16#xy91 para un m√≥dulo con direcciones comprimidas
(ET 200S).

6156

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-ID W#16#xy91 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La SZL-ID del extracto de lista parcial
‚óè W#16#0091 Informaci√≥n de estado de todos los m√≥dulos/subm√≥dulos insertados y configurados de la
CPU (solo S7-400)
‚óè W#16#0191 Informaci√≥n de estado de todos los m√≥dulos/racks no desactivados con ID de m√≥dulo
err√≥nea (solo S7-400)
‚óè W#16#0291 Informaci√≥n de estado de todos los m√≥dulos en estado de fallo y no desactivados (solo
S7-400)
‚óè W#16#0391 Informaci√≥n de estado de todos los m√≥dulos no disponibles (solo S7-400)
‚óè W#16#0591 Informaci√≥n de estado de m√≥dulo de todos los subm√≥dulos del m√≥dulo host
‚óè W#16#0991 Informaci√≥n de estado de m√≥dulo de un sistema maestro DP
‚óè W#16#0A91 Informaci√≥n de estado de todos los subsistemas DP y sistemas maestros DP (solo
S7-300 sin CPU 318-2 DP), as√≠ como sistemas PROFINET IO
‚óè W#16#0C91 Informaci√≥n de estado de un m√≥dulo en configuraci√≥n centralizada o conectado a una
interfaz DP integrada o a una interfaz PROFINET a trav√©s de la direcci√≥n base l√≥gica
‚óè W#16#4C91 Informaci√≥n de estado de un m√≥dulo conectado a una interfaz DP externa a trav√©s de la
direcci√≥n base l√≥gica
Si se usan m√°s de 4 interfaces DP externas, puede producirse err√≥neamente un RET_VAL
W#16#80A4.
‚óè W#16#0D91 Informaci√≥n de estado de todos los m√≥dulos del rack o la estaci√≥n indicados (DP o
PROFINET)
‚óè W#16#0E91 Informaci√≥n de estado de todos los m√≥dulos asignados
‚óè W#16#0F91 Solo informaci√≥n de encabezado de lista parcial SZL

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6157

Instrucciones
4.2 Instrucciones
Contenido

Significado

INDEX

‚óè Para el extracto de lista parcial con la SZL-ID W#16#0C91:
‚Äì

S7-400:
Bits de 0 a 14: Direcci√≥n base l√≥gica del m√≥dulo,
Bit 15: 0 = entrada, 1 = salida

‚Äì

S7-300:
Bits de 0 a 14: Cualquier direcci√≥n l√≥gica del m√≥dulo,
Bit 15: 0 = entrada, 1 = salida

‚óè Para el extracto de lista parcial con la SZL-ID W#16#4C91 (solo S7-400):
‚Äì

Bits de 0 a 14: Direcci√≥n base l√≥gica del m√≥dulo,

‚Äì

Bit 15: 0 = entrada/1 = salida

‚óè Para el extracto de lista parcial con las IDs de SZL W#16#0091, W#16#0191,W#16#0291,
W#16#0391, W#16#0491, W#16#0591, W#16#0A91, W#16#0E91, W#16#0F91:
INDEX es irrelevante, todos los m√≥dulos (en rack y en periferia descentralizada)
‚óè Para el extracto de lista parcial con la SZL-ID W#16#0991 (solo S7-400):
W#16#xx00: todos los m√≥dulos de un sistema maestro DP (xx contiene la ID de sistema maestro DP)
‚óè Para el extracto de lista parcial con la SZL-ID W#16#0D91
‚Äì

W#16#00xx: todos los m√≥dulos y subm√≥dulos de un rack (xx contiene el n√∫mero del rack)

‚Äì

W#16#xxyy: todos los m√≥dulos de una estaci√≥n DP o todos los dispositivos IO de una estaci√≥n
PROFINET IO (PROFIBUS DP: xx contiene la ID del sistema maestro DP, yy el n√∫mero de
estaci√≥n; PROFINET IO: bits de 0 a 10: n√∫mero de estaci√≥n, bits de 11 a 14: las dos √∫ltimas
posiciones de la ID del subsistema PNIO, bit 15: 1 (ver abajo tercera figura con adr1)

LENTHDR

W#16#0010: Un registro tiene una longitud de 8 palabras (16 bytes)

N_DR

N√∫mero de registros; en funci√≥n del producto, el n√∫mero de registros transferidos a la instrucci√≥n
"RDSYSST (P√°gina 6116)" puede ser menor

Con W#16#0091, W#16#0191 y W#16#0F91 se devuelven 2 registros adicionales por rack:
‚óè Un registro para la fuente de alimentaci√≥n, si la hay y est√° configurada, y
‚óè un registro para el rack.
El orden de los registros en caso de configuraci√≥n centralizada es el siguiente: PS, slot 1, slot
2,..., slot 18, rack.

6158

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Un registro de la lista parcial con la ID W#16#xy91 tiene la siguiente estructura:
Nombre

Longitud

Significado

adr1

1 palabra ‚óè Con configuraci√≥n centralizada: N√∫mero de rack
‚óè En caso de configuraci√≥n descentralizada con PROFIBUS DP: ID del sistema
maestro DP, n√∫mero de estaci√≥n
‚óè En caso de configuraci√≥n descentralizada con PROFINET IO: Bit 15 = 1
(identificador de PROFINET IO), las dos √∫ltimas posiciones de la ID del sistema
PROFINET IO, n√∫mero de estaci√≥n
Nota: Toda interfaz PROFINET tiene la consideraci√≥n de "subm√≥dulo en
configuraci√≥n centralizada", independientemente de su uso para PROFINET IO.

adr2

1 palabra ‚óè En caso de configuraci√≥n centralizada o descentralizada con PROFIBUS DP:
N√∫mero de slot y n√∫mero de slot del subm√≥dulo
‚óè En caso de configuraci√≥n descentralizada con PROFINET IO: N√∫mero de slot
Nota: Toda interfaz PROFINET tiene la consideraci√≥n de "subm√≥dulo en
configuraci√≥n centralizada", independientemente de su uso para PROFINET IO.

LogicalAddr

1 palabra Primera direcci√≥n l√≥gica E/S asignada (direcci√≥n base)

SetType

1 palabra PROFINET IO: Tipo te√≥rico (ver abajo); de lo contrario, reservado

ActualType

1 palabra PROFINET IO: Tipo real (ver abajo); de lo contrario, reservado

res

1 palabra 00xx = N.¬∫ de CPU 1-4 (solo S7-400)
Con PROFINET IO:
‚óè SZL-ID=W#16#0C91: N√∫mero de subm√≥dulos realmente existentes (sin contar el
subm√≥dulo 0)
‚óè SZL-ID=W#16#0D91: N√∫mero de subm√≥dulos (sin contar el subm√≥dulo 0)
‚óè SZL-ID=W#16#4C91: N√∫mero de subm√≥dulos realmente existentes (sin contar el
subm√≥dulo 0)
‚óè SZL-ID=W#16#4D91: N√∫mero de subm√≥dulos realmente existentes (sin contar el
subm√≥dulo 0)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6159

Instrucciones
4.2 Instrucciones
Nombre

Longitud

IOStat

1 palabra Estado E/S

Significado
‚óè Bit 0 = 1: Fallo del m√≥dulo (detectado mediante alarma de diagn√≥stico)
‚óè Bit 1 = 1: M√≥dulo existente
‚óè Bit 2 = 1: M√≥dulo no disponible
‚óè Bit 3 = 1: M√≥dulo desactivado
‚óè Bit 4 = 1: Fallo de la estaci√≥n (solo slot de representante)
‚óè Bit 5 = 1: Para este m√≥dulo o estaci√≥n hay un proceso CiR activo actualmente, o
todav√≠a no finalizado
‚óè Bit 6 = 1: Reservado para S7-400
‚óè Bit 7 = 1: M√≥dulo en el segmento de bus local
‚óè Bits de 8 a 15: Identificador de datos para direcci√≥n l√≥gica (entrada: B#16#B4,
salida: B#16#B5, interfaz DP integrada: B#16#FE, interfaz DP externa: B#16#FF)

AreaID_ModuleWidth

1 palabra Identificaci√≥n de √°rea/ancho de m√≥dulo
‚óè bits de 0 a 2: Ancho de m√≥dulo
‚óè Bit 3: Reservado
‚óè bits de 4 a 6: Identificaci√≥n de √°rea
‚Äì

0 = S7-400

‚Äì

1 = S7-300

‚Äì

2 = √Årea ET

‚Äì

3 = √Årea P

‚Äì

4 = √Årea Q

‚Äì

5 = √Årea IM3

‚Äì

6 = √Årea IM4

‚óè Bit 7: Reservado

Con determinados m√≥dulos se muestran en el registro los siguientes valores:
Nombre

PS

CPU

(solo S7-400)

CPU IFM

Rack

(S7-300)

(solo S7-400)

adr1

N√∫mero de rack

Informaci√≥n est√°ndar se‚Äê Informaci√≥n est√°ndar se‚Äê N√∫mero de rack
g√∫n se ha descrito ante‚Äê g√∫n se ha descrito ante‚Äê
riormente
riormente

adr2

W#16#01FF

W#16#0200 o
W#16#0200 a
W#16#1800

W#16#0200

W#16#00FF

LogicalAddr

W#16#0000

W#16#7FFF

W#16#007C

W#16#0000

SetType

Informaci√≥n est√°ndar
seg√∫n se ha descrito
anteriormente

W#16#00C0 o
W#16#0081 o
W#16#0082

W#16#00C0

Informaci√≥n est√°ndar se‚Äê
g√∫n se ha descrito ante‚Äê
riormente

6160

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Nombre

PS

CPU

(solo S7-400)

CPU IFM

Rack

(S7-300)

(solo S7-400)

IOStat

W#16#0000

Informaci√≥n est√°ndar se‚Äê Informaci√≥n est√°ndar se‚Äê W#16#0000
g√∫n se ha descrito ante‚Äê g√∫n se ha descrito ante‚Äê
riormente
riormente

AreaID_Module‚Äê
Width

W#16#0000

W#16#0011 o
W#16#0001 o
W#16#0002

W#16#0011

W#16#0000

Par√°metro adr1
El par√°metro adr1 contiene:
‚óè En caso de configuraci√≥n centralizada, el n√∫mero de rack (0-31).
%LW

     

























1¬ºPHURGHUDFN



‚óè En caso de estructura descentralizada con PROFIBUS DP
‚Äì La ID del sistema maestro DP (1-32)
‚Äì El n√∫mero de estaci√≥n (0-127).
%LW

     



















1¬ºPHURGHHVWDFL¬µQ

,'GHOVLVWHPDPDHVWUR'3

‚óè En caso de estructura descentralizada con PROFINET IO
‚Äì Bit de identificaci√≥n para PROFINET IO (bit 15)
‚Äì Las dos √∫ltimas posiciones de la ID del sistema PROFINET IO (0-15); para obtener la ID
del sistema PROFINET IO completa, sume 100 (decimal)
‚Äì El n√∫mero de estaci√≥n (0-2047).
%LW

     



Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

,'GHVLVWHPD,2





















1¬ºPHURGHHVWDFL¬µQ

6161

Instrucciones
4.2 Instrucciones

Par√°metro adr2
El par√°metro adr2 contiene:
‚óè En caso de configuraci√≥n centralizada o descentralizada con PROFIBUS DP, el n√∫mero de
slot y el n√∫mero de slot de subm√≥dulo
Bit:

     









6ORW













6ORWGHVXEP¬µGXOR

‚óè En caso de configuraci√≥n descentralizada con PROFINET IO, el n√∫mero de slot.

Par√°metros Tipo te√≥rico (SetType) y Tipo real (ActualType) para PROFINET IO
ID de tipo

Significado

(W#16#...)
8100

Se especifica en Tipo te√≥rico y en Tipo real si no es posible la comprobaci√≥n de tipo.

8101

Se especifica en Tipo te√≥rico si es posible la comprobaci√≥n de tipo.

8101

Se especifica como Tipo real si Tipo te√≥rico=Tipo real.

8102

Se especifica como Tipo real si Tipo te√≥rico<>Tipo real.

SZL-ID W#16#xy92: Informaci√≥n de estado de rack o estaci√≥n
Finalidad
A trav√©s de la lista parcial con la SZL-IDW#16#xy92 se puede obtener informaci√≥n acerca de
la configuraci√≥n te√≥rica y real de los racks con estructura centralizada y estaciones de un
sistema maestro DP.

6162

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Leer la SZL mediante "RDSYSST" con una CPU S7-400
Si se lee la lista parcial con "RDSYSST (P√°gina 6116)", es imprescindible que los par√°metros
SZL_ID y INDEX de "RDSYSST (P√°gina 6116)" sean compatibles entre s√≠.
SZL_ID

INDEX

W#16#0092 o

ID de un sistema maestro DP conectado a trav√©s de una interfaz
DP integrada.

W#16#0192 o
W#16#0292 o
W#16#0392 o
W#16#0492 o
W#16#0592 o
W#16#0692
:

:

W#16#4092 o

ID de un sistema maestro DP conectado a trav√©s de una interfaz
DP externa.

W#16#4292 o
W#16#4692

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy92 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial:
‚óè W#16#0092: Consigna de estado de los racks en configuraci√≥n centralizada o de
las estaciones de un sistema maestro DP conectado a trav√©s de una interfaz DP
integrada.
‚óè W#16#4092: Consigna de estado de las estaciones de un sistema maestro DP
conectado a trav√©s de una interfaz DP externa.
‚óè W#16#0192: Estado de activaci√≥n de las estaciones de un sistema maestro DP
conectado a trav√©s de una interfaz DP integrada
‚óè W#16#0292: Estado real de los racks en configuraci√≥n centralizada o de las
estaciones de un sistema maestro DP conectado a trav√©s de una interfaz DP
integrada.
‚óè W#16#0392: Estado del respaldo por bater√≠a de un rack de una CPU, cuando falla
por lo menos una bater√≠a.
‚óè W#16#0492: Estado de todo el respaldo por bater√≠a de todos los racks de una CPU
‚óè W#16#0592: Estado de la alimentaci√≥n de 24 V de todos los racks de una CPU.
‚óè W#16#4292: Estado real de las estaciones de un sistema maestro DP conectado a
trav√©s de una interfaz DP externa
‚óè W#16#0692: Estado de diagn√≥stico de los aparatos de ampliaci√≥n en configuraci√≥n
centralizada o de las estaciones de un sistema maestro DP conectado a trav√©s de
una interfaz DP integrada
‚óè W#16#4692: Estado de diagn√≥stico de las estaciones de un sistema maestro DP
conectado a trav√©s de una interfaz DP externa

INDEX

0/ID del sistema maestro DP

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6163

Instrucciones
4.2 Instrucciones
Contenido

Significado

LENTHDR

W#16#0010: El registro tiene una longitud de ocho palabras (16 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la IDW#16#xy92 tiene la siguiente estructura:
Contenido

Longitud

Significado

status_0 a
status_15

16 bytes

Estado de rack/estado de estaci√≥n, estado del respaldo o estado de activa‚Äê
ci√≥n (el estado de activaci√≥n solo es relevante para m√≥dulos DP).
‚óè W#16#0092:
‚Äì

Bit=0: Rack/estaci√≥n no configurados

‚Äì

Bit=1: Rack/estaci√≥n configurados

‚óè W#16#4092:
‚Äì

Bit=0: Estaci√≥n no configurada

‚Äì

Bit=1: Estaci√≥n configurada

‚óè W#16#0192:
‚Äì

Bit=0: Estaci√≥n no configurada o configurada y activada

‚Äì

Bit=1: Estaci√≥n configurada y desactivada

‚óè W#16#0292:
‚Äì

Bit=0: Fallo del rack/de la estaci√≥n, o rack/estaci√≥n desactivados o no
configurados

‚Äì

Bit=1: Rack/estaci√≥n existentes, activados y sin fallo

‚óè W#16#4292:
‚Äì

Bit=0: Fallo de la estaci√≥n, o estaci√≥n desactivada o no configurada

‚Äì

Bit=1: Estaci√≥n existente, activada y sin fallo

‚óè W#16#0692:
‚Äì

Bit=0: Todos los m√≥dulos del aparato de ampliaci√≥n/de una estaci√≥n
est√°n presentes, disponibles y sin fallo, y la estaci√≥n est√° activada

‚Äì

Bit=1: Por lo menos un m√≥dulo del aparato de ampliaci√≥n/de una
estaci√≥n no funciona correctamente, o la estaci√≥n est√° desactivada

‚óè W#16#4692:

status_0

1 bytes

‚Äì

Bit=0: Todos los m√≥dulos de una estaci√≥n est√°n presentes,
disponibles y sin fallo, y la estaci√≥n est√° activada

‚Äì

Bit=1: Por lo menos un m√≥dulo de una estaci√≥n no funciona
correctamente, o la estaci√≥n est√° desactivada

Bit 0: Dispositivo central (INDEX = 0) o estaci√≥n 1 (INDEX <> 0)
Bit 1: 1. Aparato de ampliaci√≥n o estaci√≥n 2
:
:
Bit 7: 7. Aparato de ampliaci√≥n o estaci√≥n 8

6164

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Contenido

Longitud

Significado

status_1

1 bytes

Bit 0: 8. Aparato de ampliaci√≥n o estaci√≥n 9
:
:
Bit 7: 15. Aparato de ampliaci√≥n o estaci√≥n 16

status_2

1 bytes

Bit 0: 16. Aparato de ampliaci√≥n o estaci√≥n 17
:
:
Bit 5: 21. Aparato de ampliaci√≥n o estaci√≥n 22
Bit 6: 0 o estaci√≥n 23
Bit 7: 0 o estaci√≥n 24

status_3

1 bytes

Bit 0: 0 o estaci√≥n 25
:
:
Bit 5: 0 o estaci√≥n 30
Bit 6: Aparato de ampliaci√≥n en el rango SIMATIC-S5 o estaci√≥n 31
Bit 7: 0 o estaci√≥n 32

status_4

1 bytes

Bit 0: 0 o estaci√≥n 33
:
:
Bit 7: 0 o estaci√≥n 40

:
:
status_15

1 bytes

Bit 0: 0 o estaci√≥n 121
:
:
Bit 7: 0 o estaci√≥n 128

SZL-ID W#16#0x94: informaci√≥n de estado de rack o estaci√≥n
Finalidad
A trav√©s de la lista parcial con la SZL-IDW#16#0x94 se puede obtener informaci√≥n acerca de
la configuraci√≥n te√≥rica y real de los racks en configuraci√≥n centralizada y estaciones de un
sistema maestro PROFIBUS DP/un sistema de controlador PROFINET IO.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6165

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#0y94 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial:
‚óè W#16#0094:
Consigna de estado de los racks en configuraci√≥n centralizada o de las estaciones
de un sistema de controlador IO (bit de estado = 1: Rack/estaci√≥n configurados)
‚óè W#16#0194:
Estado de activaci√≥n de una estaci√≥n de un sistema de controlador IO configurada
y desactivada (bit de estado = 1)
‚óè W#16#0294:
Estado real de los racks en configuraci√≥n descentralizada o de las estaciones de un
sistema de controlador IO
(bit de estado = 1: Rack/estaci√≥n existentes, activados y sin fallo)
‚óè W#16#0694:
Estado de diagn√≥stico de los aparatos de ampliaci√≥n en configuraci√≥n
descentralizada o de las estaciones de un sistema de controlador IO (bit de estado
= 1: Por lo menos un m√≥dulo del rack o estaci√≥n est√° en fallo o desactivado)
‚óè W#16#0794:
Estado de diagn√≥stico / mantenimiento del rack central o de las estaciones de un
sistema de controlador IO (bit de estado = 0: No hay aver√≠as y no se requiere
mantenimiento, bit de estado = 1: El rack / la estaci√≥n presenta una aver√≠a y / o se
necesita mantenimiento y / o se solicita mantenimiento)
‚óè W#16#0F94:
Solo informaci√≥n de encabezado

INDEX

‚óè 0: M√≥dulo central
‚óè 1-32: M√≥dulo descentralizado conectado a PROFIBUS DP
‚óè 100-115: M√≥dulo descentralizado conectado a PROFINET IO

LENTHDR

Longitud del registro posterior

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la IDW#16#0y94 tiene la siguiente estructura:
Contenido

Longitud

index

1 palabra ‚óè 0: M√≥dulo central

Significado
‚óè 1-32: M√≥dulo descentralizado conectado a PROFIBUS DP
‚óè 100-115: M√≥dulo descentralizado conectado a PROFINET IO

status_0

BOOL

Informaci√≥n de grupo
‚óè 1: Por lo menos uno de los bits de estado posteriores tiene el valor 1
‚óè 0: Todos los bits de estado posteriores tienen el valor 0

6166

status_1

BOOL

Estado estaci√≥n 1

status_2

BOOL

Estado estaci√≥n 2

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Contenido

Longitud

Significado

BOOL

Estado estaci√≥n 2047

..
status_2047

Un bit de estado de racks/estaciones/dispositivos no configurados contiene el valor "0".
Nota
Diferencia importante respecto a la SZL-IDW#16#xy92 anterior
Hay un desplazamiento de un bit en relaci√≥n a la SZL-IDW#16#xy92 anterior, ya que el bit
status_0 sirve como informaci√≥n de grupo.

SZL-ID W#16#xy95: informaci√≥n avanzada del sistema maestro DP/sistema PROFINET IO
Finalidad
La informaci√≥n de estado avanzada de todos los sistemas maestros DP/ sistemas
PROFINET IO conocidos por la CPU se puede obtener a trav√©s de la lista parcial con la SZLIDW#16#xy95. En relaci√≥n con la lista parcial con la SZL-IDW#16#xy90 se ha introducido
informaci√≥n sobre los sistemas PROFINET IO y datos adicionales acerca del modo is√≥crono
de un sistema maestro DP.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy95 tiene la siguiente estructura:
Contenido
SZL-ID

INDEX

Significado
La SZL-ID del extracto de lista parcial
W#16#0195:

Informaci√≥n avanzada acerca de un sistema maestro DP/sistema PROFINET IO

W#16#0F95:

Solo informaci√≥n de encabezado de la lista parcial SZL

‚óè Para el extracto de lista parcial con la SZL-IDW#16#0195:
‚Äì

byte menos significativo: B#16#00

‚Äì

byte m√°s significativo: ID de sistema maestro DP/ID de sistema PROFINET IO

‚óè Para el extracto de lista parcial con la SZL-IDW#16#0F95:
‚Äì

W#16#0000

LENTHDR

W#16#0028:

Un registro tiene una longitud de 20 palabras (40 bytes)

N_DR

N√∫mero de registros:
Para el extracto de lista parcial con la SZL-IDW#16#0195: de 0 a 1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6167

Instrucciones
4.2 Instrucciones

Registro
Un registro de la lista parcial con la IDW#16#xy95 tiene la siguiente estructura:
Nombre

Longitud

Significado

dp_m_id

1 bytes

ID de sistema maestro DP/ID de sistema PROFINET IO

dp_m_rack

1 bytes

N√∫mero de rack del maestro DP/controlador IO
‚óè Con una CPU est√°ndar: 0

dp_m_slot

1 bytes

Slot del maestro DP/controlador IO o
slot de la CPU (con interfaz DP integrada)

dp_m_SubModule

1 bytes

‚óè Con interfaz integrada: N√∫mero de interfaz del maestro DP/controlador IO:
‚Äì

1: X2

‚Äì

2: X1

‚Äì

3: IF1

‚Äì

4: IF2

‚óè Con interfaz externa: 0
LogicalAddr

2 bytes

Direcci√≥n l√≥gica inicial del maestro DP/controlador IO

res

2 bytes

Reservado

res

2 bytes

Reservado

dp_m_state

1 bytes

‚óè Otras caracter√≠sticas del sistema maestro DP/sistema PROFINET IO
Bit 0:

Modo DP (solo con PROFIBUS DP)
‚óè 0: Compatible con S7
‚óè 1: DPV1

Bit 1:

Ciclo DP o PN
‚óè 0: No equidistante
‚óè 1: Equidistante

Bits de 2 a 6:

‚óè Reservado

Bit 7:

Tipo de maestro DP/controlador IO
‚óè 0: Maestro DP integrado/controlador IO integrado
‚óè 1: Maestro DP externo/controlador IO externo

dp_address

1 bytes

N√∫mero de dispositivo DP (direcci√≥n PROFIBUS)

res

2 bytes

Reservado

SyncCyclInter_OB

1 bytes

OB de alarma de sincronismo asignado (relevante solo si el ciclo DP o PN es equidistante)

res

1 bytes

Reservado

baudrate

4 bytes

Velocidad de transferencia del sistema maestro DP o del sistema PNIO en formato Hex

IsoDPCycle

4 bytes

Duraci√≥n en Œºs del ciclo DP o PN equidistante

res

16 bytes

Reservado

SZL-ID W#16#xy96: informaci√≥n de estado de m√≥dulo con PROFINET IO y PROFIBUS DP
Finalidad
La informaci√≥n de estado de todos los m√≥dulos asignados a la CPU se puede obtener a trav√©s
de la lista parcial con la SZL-IDW#16#xy96.

6168

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Para complementar SZL-IDW#16#xy91 (P√°gina 6156), la lista parcial con la SZLIDW#16#xy96 ofrece datos de estado adicionales de m√≥dulos y subm√≥dulos.
Contiene informaci√≥n espec√≠fica de PROFINET IO e informaci√≥n sobre m√≥dulos PROFIBUS
DP y m√≥dulos centrales.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xy96 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La SZL-ID del extracto de lista parcial
‚óè W#16#0696
Informaci√≥n de estado de todos los subm√≥dulos de un m√≥dulo especificado (con PROFIBUS DP y
m√≥dulos centrales, el nivel de subm√≥dulo no existe).
‚óè W#16#0C96
Informaci√≥n de estado de un m√≥dulo/un subm√≥dulo central o conectado a una interfaz PROFIBUS DP/
PROFINET a trav√©s de la direcci√≥n inicial.

INDEX

‚óè Bits de 0 a 14: Direcci√≥n del m√≥dulo
‚óè Bit 15: 0 = entrada, 1 = salida

LENTHDR

Longitud del registro posterior

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la IDW#16#xy96 tiene la siguiente estructura:
Contenido

Longitud

Significado

LogicalAddr

1 palabra

‚óè Bits de 0 a 14: Direcci√≥n del m√≥dulo
‚óè Bit 15: 0 = entrada, 1 = salida

System

1 palabra

ID de m√≥dulo central/ ID de sistema maestro DP/ ID de sistema PROFINET IO:
‚óè 0: M√≥dulo central
‚óè 1-32: M√≥dulo descentralizado conectado a PROFIBUS DP
‚óè 100-115: M√≥dulo descentralizado conectado a PROFINET IO

API*

2 palabras

Perfil de aplicaci√≥n configurado para un dispositivo PROFINET descentralizado.
Los perfiles son definiciones espec√≠ficas de sector o de tecnolog√≠a, que van m√°s all√°
de la norma PROFINET.
En el perfil 0, los datos concuerdan completamente con las definiciones de la norma
PROFINET.

Station

1 palabra

N√∫mero de rack/n√∫mero de estaci√≥n/n√∫mero de dispositivo

Slot

1 palabra

N√∫mero de slot

Subslot

1 palabra

Slot de subm√≥dulo (si no puede insertarse ning√∫n m√≥dulo, debe indicarse aqu√≠ "0")

Offset

1 palabra

Offset en el √°rea de direcciones de datos √∫tiles del m√≥dulo correspondiente

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6169

Instrucciones
4.2 Instrucciones
Contenido

Longitud

Significado

SetType

7 palabras

Tipo te√≥rico
En PROFINET IO, el tipo te√≥rico tiene estructura jer√°rquica

SetType_UnEqual_Ac‚Äê
tualType

1 palabra

Pala‚Äê
bra

PROFINET IO

PROFIBUS DP

1:

N√∫mero de fabricante o ID de perfil (p. ej.:
W#16#FF00 para PROFIBUS)

0000

2:

Dispositivo

0000

3:

N√∫mero consecutivo o √≠ndice de perfil

0000

4:

1. Palabra de la palabra doble ID m√≥dulo

ID de tipo

5:

2. Palabra de la palabra doble ID m√≥dulo

0000

6:

1. Palabra de la palabra doble ID subm√≥dulo

0000

7:

2. Palabra de la palabra doble ID subm√≥dulo

0000

Identificador te√≥rico/real
‚óè Bit 0 = 0: Te√≥rico coincide con real
‚óè Bit 0 = 1: Te√≥rico no coincide con real
‚óè Bits de 1 a 15: Reservado

res

1 palabra

Reservado

IOStat

1 palabra

Estado E/S
‚óè Bit 0 = 1: Fallo del m√≥dulo (detectado mediante alarma de diagn√≥stico)
‚óè Bit 1 = 1: El m√≥dulo existe
Bit 2 = 1: M√≥dulo no disponible
‚óè Bit 3 = 1: El m√≥dulo est√° desactivado
Bit 4 = 1: Fallo de la estaci√≥n (solo slot de representante)
‚óè Bit 5 = 1: M7: El m√≥dulo puede ser host para subm√≥dulos
S7: Para este m√≥dulo o estaci√≥n hay un proceso CiR activo actualmente, o
todav√≠a no finalizado
‚óè Bit 6 = 1: Reservado para S7-400
‚óè Bit 7 = 1: M√≥dulo en el segmento de bus local (solo con S7-300)
‚óè Bit 8 = 1: M√≥dulo, mantenimiento necesario ("verde")
‚óè Bit 9 = 1: M√≥dulo, solicitud de mantenimiento ("amarillo")
‚óè Bits de 10 a 15: Reservado

6170

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Contenido

Longitud

Significado

AreaID_ModuleWidth

1 palabra

Identificaci√≥n de √°rea/ancho de m√≥dulo
‚óè bits de 0 a 2: Ancho de m√≥dulo
‚óè Bit 3: Reservado
‚óè bits de 4 a 6: Identificaci√≥n de √°rea
‚Äì

0 = S7-400

‚Äì

1 = S7-300

‚Äì

2 = PROFINET IO (descentralizado)

‚Äì

3 = √°rea P

‚Äì

4 = √°rea Q

‚Äì

5 = √°rea IM3

‚Äì

6 = √°rea IM4

‚óè Bit 7: Reservado
‚óè Bit 7: Reservado
res

5 palabras

Reservado

* Application Process Instance

Lista parcial con la SZL-IDW#16#0696 para m√≥dulos conectados al PROFIBUS DP
Se emite el aviso de error "No existe nivel de subm√≥dulo".

SZL-ID W#16#xy9C: Informaci√≥n del intercambiador de herramientas (PROFINET IO)
Finalidad
Puede obtenerse informaci√≥n sobre los intercambiadores de herramientas configurados y sus
herramientas a trav√©s de la lista parcial con la SZL-ID W#16#xy9C.
Los intercambiadores de herramientas son dispositivos IO que gestionan herramientas. Una
herramienta consta de uno o m√°s dispositivos IO. Cada herramienta se asigna de forma
un√≠voca a un puerto de un intercambiador de herramientas.
En un cambio de herramientas en primer lugar se desactivan todos los dispositivos IO que
pertenecen a la herramienta activa en esos momentos y, a continuaci√≥n, se activan los
dispositivos IO pertenecientes a la nueva herramienta. La desactivaci√≥n y activaci√≥n se
realizan con la instrucci√≥n "D_ACT_DP (P√°gina 5917)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6171

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-ID W#16#xy9C tiene la siguiente estructura:
Contenido

Significado

SZL-ID

La ID SZL del extracto de lista parcial
‚óè W#16#009C
Informaci√≥n sobre todos los intercambiadores de herramientas y sus herramientas en un sistema
PROFINET IO
‚óè W#16#019C
Informaci√≥n sobre todos los intercambiadores de herramientas de un sistema PROFINET IO
‚óè W#16#029C
Informaci√≥n sobre un intercambiador de herramientas y sus herramientas
‚óè W#16#039C
Informaci√≥n sobre una herramienta y sus dispositivos IO
‚óè W#16#0F9C
Solo informaci√≥n de encabezado de la lista parcial SZL

INDEX

Para el extracto de lista parcial con la ID SZL
‚óè W#16#009C: ID del sistema PROFINET IO
‚óè ID del sistema W#16#019C: PROFINET IO
‚óè W#16#029C: direcci√≥n l√≥gica del intercambiador de herramientas
‚óè W#16#039C: direcci√≥n l√≥gica de un dispositivo IO cualquiera de la herramienta
‚óè ID del sistema W#16#0F9C: PROFINET IO

LENTHDR

W#16#000C (longitud del siguiente registro en bytes: 12)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la SZL-ID W#16#xy9C tiene la siguiente estructura:
Contenido

Longitud

Significado

StationW

1 WORD

N√∫mero de estaci√≥n (del registro, puede ser intercambiador de herramientas o estaci√≥n
de una herramienta)

LogAdrW

1 WORD

‚óè Bits de 0 a 14: Direcci√≥n del m√≥dulo
‚óè Bit 15: 0 = entrada, 1 = salida

StationWZK

1 WORD

N√∫mero de estaci√≥n del cabezal de la herramienta (el cabezal de la herramienta es el
dispositivo IO de una herramienta que se ha conectado directamente al puerto del inter‚Äê
cambiador de herramientas).

StationWZW

1 WORD

N√∫mero de estaci√≥n del intercambiador de herramientas

SlotWZW

1 WORD

Slot del intercambiador de herramientas

SubslotWZW

1 WORD

Slot de subm√≥dulo del intercambiador de herramientas

Nota
Si un intercambiador de herramientas posee varios puertos en los que se administran
herramientas, para cada puerto se suministra un registro.

6172

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo
El uso de las diferentes listas parciales individuales se representa una vez m√°s a partir del
siguiente ejemplo.
En la l√≠nea de un sistema PROFINET IO hay dos intercambiadores de herramientas (IOD 3 y
IOD 10), cuyas herramientas tienen la siguiente estructura:
‚óè Intercambiador de herramientas IOD 3 (IO-Device 3) con las tres herramientas siguientes
en el puerto 2 del intercambiador:
‚Äì Herramienta 1 (IOD 4, IOD 5 y IOD 6)
‚Äì Herramienta 2 (IOD 7)
‚Äì Herramienta 3 (IOD 8 y IOD 9)
‚óè Intercambiador de herramientas IOD 10 con dos puertos de intercambiador de
herramientas, de los que cada uno posee dos herramientas.
‚Äì Puerto 3 del intercambiador de herramientas: Herramienta 1 (IOD 11 y IOD 12),
herramienta 2 (IOD 13)
‚Äì Puerto 4 del intercambiador de herramientas: Herramienta 1 (IOD 14, IOD 15 y IOD 16),
herramienta 2 (IOD 17 y IOD 18)
De ello resulta la estructura siguiente:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6173

Instrucciones
4.2 Instrucciones

352),1(7,2&RQWUROOHU

,2'

,2'

,QWHUFDPELDGRUGH
KHUUDPLHQWDV
3RUW

,2'

3RUW

&DEH]DOGHOD
KHUUDPLHQWD

,2'

,2'HYLFH
,2'

,2'HYLFH
,2'

+HUUDPLHQWD

,2'
3RUW

,2'

3RUW

,QWHUFDPELDGRUGH
KHUUDPLHQWDV

,2'

,2'

,2'

,2'

3RUW
3RUW
,2'

,2'

3RUW
3RUW

,2'

,2'

,2'

,2'

,2'

Las listas parciales de la SZL ofrecen registros para los siguientes IO-Devices:
‚óè Extracto de listas parciales con SZL-ID W#16#009C (√≠ndice: ID del sistema PROFINET IO):
proporciona 17 registros para los siguientes IO-Devices:
‚Äì Intercambiador de herramientas: IOD 3, IOD 10 (para el puerto 3) e IOD 10 (para el
puerto 4)
‚Äì Herramientas: IOD 4, IOD 5, IOD 6, IOD 7, IOD 8, IOD 9, IOD 11, IOD 12, IOD 13,
IOD 14, IOD 15, IOD 16, IOD 17 y IOD 18
‚óè Extracto de listas parciales con SZL-ID W#16#019C (√≠ndice: ID del sistema PROFINET IO):
proporciona 3 registros para los siguientes IO-Devices:
‚Äì Intercambiador de herramientas: IOD 3, IOD 10 (para el puerto 3) y IOD 10 (para el
puerto 4)
‚Äì Herramientas: Ninguno

6174

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
‚óè Extracto de listas parciales con SZL-ID W#16#029C (√≠ndice: Direcci√≥n del IOD 3):
proporciona 3 registros para los siguientes IO-Devices:
‚Äì Intercambiador de herramientas: IOD 3
‚Äì Herramientas: IOD 4, IOD 5, IOD 6, IOD 7, IOD 8 y IOD 9
‚óè Extracto de listas parciales con SZL-ID W#16#029C (√≠ndice: Direcci√≥n del IOD 10):
proporciona 10 registros para los siguientes IO-Devices:
‚Äì Intercambiador de herramientas: IOD 10 (para el puerto 3) y IOD 10 (para el puerto 4)
‚Äì Herramientas: IOD 11, IOD 12, IOD 13, IOD 14, IOD 15, IOD 16, IOD 17 y IOD 18
‚óè Extracto de listas parciales con SZL-ID W#16#039C (√≠ndice: Direcci√≥n l√≥gica del IOD 4):
proporciona 3 registros para los siguientes IO-Devices: (esto se aplica de forma an√°loga
para la direcci√≥n l√≥gica del IOD 5 y IOD 6)
‚Äì Intercambiador de herramientas: Ninguno
‚Äì Herramientas: IOD 4, IOD 5 y IOD 6
‚óè Extracto de listas parciales con SZL-ID W#16#039C (√≠ndice: Direcci√≥n l√≥gica del IOD 13):
proporciona un registro para los siguientes IO-Devices:
‚Äì Intercambiador de herramientas: Ninguno
‚Äì Herramientas: IOD 13

SZL-ID W#16#xyA0: b√∫fer de diagn√≥stico
Finalidad
Las entradas del b√∫fer de diagn√≥stico del m√≥dulo se pueden conocer a trav√©s de la lista parcial
con la SZL-IDW#16#xyA0.
Nota
Las CPUs S7-300 proporcionan como m√°ximo tantos registros como la cantidad de entradas
de b√∫fer de diagn√≥stico mostradas en el modo de operaci√≥n RUN (valor predeterminado: 10).
10). Las CPUs S7-400 proporcionan como m√°ximo 21 registros.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6175

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#xyA0 tiene la siguiente estructura:
Contenido
SZL-ID

Significado
La SZL-ID del extracto de lista parcial:
‚óè W#16#00A0: Todas las entradas transmisibles en el estado operativo actual
‚óè W#16#01A0: Las entradas m√°s recientes, cuyo n√∫mero se indica mediante el
par√°metro INDEX.
Si el n√∫mero de avisos del b√∫fer de diagn√≥stico es menor que el n√∫mero m√°ximo de
avisos configurado por el usuario, en algunos casos la instrucci√≥n "RDSYSST
(P√°gina 6116)" puede devolver valores no v√°lidos con este extracto de lista parcial.
Por ello debe evitarse un POWER OFF sin respaldo.
‚óè W#16#0FA0: Solo informaci√≥n de encabezado de la lista parcial SZL

INDEX

Solo para SZL-IDW#16#01A0: N√∫mero de las entradas m√°s recientes

LENTHDR

W#16#0014: Un registro tiene una longitud de 10 palabras (20 bytes)

N_DR

N√∫mero de registros

Registro
Un registro de la lista parcial con la SZL-IDW#16#xyA0 tiene la siguiente estructura:
Nombre

Longitud en palabras Significado

ID

1 palabra

ID de evento

info

5 palabras

Informaci√≥n sobre el evento o sus efectos

time

4 palabras

Sello de tiempo del evento

B√∫fer de diagn√≥stico
Encontrar√° m√°s informaci√≥n sobre eventos del b√∫fer de diagn√≥stico en la ayuda contextual
para el evento visualizado.

SZL-ID W#16#00B1: informaci√≥n de diagn√≥stico de rack
Finalidad
Los 4 primeros bytes de diagn√≥stico de un m√≥dulo apto para diagn√≥stico se pueden conocer
a trav√©s de la lista parcial con la SZL-IDW#16#00B1.

6176

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#00B1 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

W#16#00B1

INDEX

‚óè bits de 0 a 14: Direcci√≥n base l√≥gica
‚óè Bit 15: 0 para entrada, 1 para salida

LENTHDR

W#16#0004: Un registro tiene una longitud de 2 palabras (4 bytes)

N_DR

1

Registro
Un registro de la lista parcial con la SZL-IDW#16#00B1 tiene la siguiente estructura:
Nombre

Longitud

Significado

byte0

1 bytes

‚óè Bit 0: Fallo de m√≥dulo/OK (identificador de fallo de grupo)
‚óè Bit 1: Error interno
‚óè Bit 2: Error externo
‚óè Bit 3: Existe error de canal
‚óè Bit 4: Falta tensi√≥n auxiliar externa
‚óè Bit 5: Falta conector frontal
‚óè Bit 6: M√≥dulo no parametrizado
‚óè Bit 7: Par√°metro err√≥neo en m√≥dulo

byte1

1 bytes

‚óè Bit 0 a bit 3: Clase de m√≥dulo (CPU, FM, CP, IM, SM, ...)
‚óè Bit 4: Existe informaci√≥n de canal
‚óè Bit 5: Existe informaci√≥n de usuario
‚óè Bit 6: Alarma de diagn√≥stico de sustituto
‚óè Bit 7: Mantenimiento necesario (solo con PROFINET IO)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6177

Instrucciones
4.2 Instrucciones
Nombre

Longitud

Significado

byte2

1 bytes

‚óè Bit 0: M√≥dulo de usuario err√≥neo o no existe
‚óè Bit 1: Fallo de comunicaci√≥n
‚óè Bit 2: Estado operativo RUN/STOP (0 = RUN, 1 = STOP)
‚óè Bit 3: La vigilancia de tiempo ha reaccionado (watchdog)
‚óè Bit 4: Fallo de la tensi√≥n de alimentaci√≥n interna del m√≥dulo
‚óè Bit 5: Bater√≠a vac√≠a (BFS)
‚óè Bit 6: Fallo de todo el respaldo
‚óè Bit 7: Mantenimiento solicitado (solo con PROFINET IO)

byte3

1 bytes

‚óè Bit 0: Fallo de aparato de ampliaci√≥n (detectado por IM)
‚óè Bit 1: Fallo de procesador
‚óè Bit 2: Error de EPROM
‚óè Bit 3: Error de RAM
‚óè Bit 4: Error de ADU/DAU
‚óè Bit 5: Fallo de fusible
‚óè Bit 6: Alarma de proceso perdida
‚óè Bit 7: Reserva (inicializado con 0)

SZL-ID W#16#00B2: registro de diagn√≥stico 1 a trav√©s de direcci√≥n f√≠sica
Finalidad
El registro de diagn√≥stico 1 de un m√≥dulo insertado central (es decir, excluyendo DP y
subm√≥dulos) puede obtenerse a trav√©s de la lista parcial con la SZL-IDW#16#00B2. Para
especificar el m√≥dulo debe indicarse el n√∫mero de rack y de slot.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#00B2 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

W#16#00B2

INDEX

W#16#xxyy:
‚óè xx contiene el n√∫mero del rack
‚óè yy contiene el n√∫mero del slot

LENTHDR

La longitud del registro depende del m√≥dulo

N_DR

1

Registro
El tama√±o de un registro de la lista parcial con la SZL-IDW#16#00B2, as√≠ como el contenido del
registro, dependen del m√≥dulo que se utilice. Encontrar√° m√°s informaci√≥n al respecto en el
correspondiente manual del m√≥dulo.

6178

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

SZL-ID W#16#00B3: datos de diagn√≥stico de m√≥dulo a trav√©s de la direcci√≥n base l√≥gica
Finalidad
Todos los datos de diagn√≥stico de un m√≥dulo se pueden obtener a trav√©s de la lista parcial con
la SZL-IDW#16#00B3. Esta informaci√≥n tambi√©n es posible para DP y subm√≥dulos. El m√≥dulo
se selecciona a trav√©s de su direcci√≥n base l√≥gica.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#00B3 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

W#16#00B3

INDEX

‚óè bits de 0 a 14: Direcci√≥n base l√≥gica
‚óè Bit 15: 0 para entrada, 1 para salida

LENTHDR

Longitud de un registro (en funci√≥n del m√≥dulo)

N_DR

1

Registro
El tama√±o de un registro de la lista parcial con la SZL-IDW#16#00B3, as√≠ como su contenido,
dependen del m√≥dulo que se utilice. Encontrar√° m√°s informaci√≥n al respecto en el
correspondiente manual del m√≥dulo.

SZL-ID W#16#00B4: datos de diagn√≥stico de un esclavo DP
Finalidad
Los datos de diagn√≥stico de un esclavo DP se pueden obtener a trav√©s de la lista parcial con
la SZL-IDW#16#00B4. El formato de estos datos de diagn√≥stico se especifica en EN50 170
Volume 2, PROFIBUS. El m√≥dulo se selecciona a trav√©s de su direcci√≥n de diagn√≥stico
configurada.

Encabezado
El encabezado de la lista parcial con la SZL-IDW#16#00B4 tiene la siguiente estructura:
Contenido

Significado

SZL-ID

W#16#00B4

INDEX

Direcci√≥n de diagn√≥stico configurada del esclavo DP

LENTHDR

Longitud de un registro. La longitud m√°xima es de 240 bytes; en los esclavos normali‚Äê
zados en los que el n√∫mero de datos de diagn√≥stico normalizados es superior a 240
bytes, con un m√°ximo de 244, se leen los 240 primeros bytes y se adjunta a los datos
el correspondiente bit de desbordamiento.

N_DR

1

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6179

Instrucciones
4.2 Instrucciones

Registro
Un registro de la lista parcial con la SZL-IDW#16#00B4 tiene la siguiente estructura:
Nombre

Longitud

Significado

status1

1 bytes

Estado de estaci√≥n 1

status2

1 bytes

Estado de estaci√≥n 2

status3

1 bytes

Estado de estaci√≥n 3

Station_No

1 bytes

N√∫mero de estaci√≥n maestra

Vendor_ID_highByte

1 bytes

Identificaci√≥n de fabricante (high byte)

Vendor_ID_lowByte

1 bytes

Identificaci√≥n de fabricante (low byte)

....

....

Otros diagn√≥sticos espec√≠ficos de esclavo

OB_RT: Determinar tiempo de ejecuci√≥n del programa OB
Descripci√≥n
Esta instrucci√≥n permite conocer el tiempo de ejecuci√≥n de OBs individuales en distintos
periodos.
Nota
Esta instrucci√≥n devuelve los √∫ltimos valores de tiempo registrados para el OB deseado, sin
importar que este se encuentre cargado o no en el momento actual. Los datos no se anulan
mediante borrado ni sobrecarga, sino solo mediante un rearranque completo (en caliente).

6180

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "OB_RT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Significado

OB_NR

Input

INT

I, Q, M, D, L

OB cuyos √∫ltimos tiempos conocidos se desean
consultar. Son n√∫meros v√°lidos de OB todos los
OBs implementados en la CPU, excepto OB 121
y OB 122. El procesamiento de errores sincr√≥ni‚Äê
cos se incluye en el tiempo de procesamiento del
OB causante del error. Si se indican los OBs 121
y 122 o un OB no cargado en la CPU, se devuel‚Äê
ve un aviso de error.
Si OB_NR=0, se transfieren los datos del OB en
cuyo contexto se haya llamado la instrucci√≥n. Si
se llama la instrucci√≥n "OB_RT" en los OBs 121
√≥ 122 con OB_NR=0, se devuelven los tempori‚Äê
zadores del OB causante de la alarma, junto con
los temporizadores del OB 12x.

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de la
instrucci√≥n, el valor de respuesta contendr√° un
c√≥digo de error.
De lo contrario, RET_VAL contiene el n√∫mero del
OB para el que se han consultado dichos datos.

PRIO

Output

INT

I, Q, M, D, L

En PRIO se devuelve la clase de prioridad del OB
consultado.

LAST_RT

Output

DINT

I, Q, M, D, L

Tiempo de ejecuci√≥n en ¬µs del √∫ltimo procesa‚Äê
miento finalizado del OB indicado.
Si el OB cuyos tiempos de ejecuci√≥n se desean
conocer est√° proces√°ndose actualmente, se apli‚Äê
ca lo siguiente:
En la primera llamada de la instrucci√≥n "OB_RT"
durante el procesamiento actual del OB deseado
se indica en LAST_RT el tiempo de ejecuci√≥n del
√∫ltimo procesamiento finalizado del OB.
Con cada nueva llamada de la instrucci√≥n
"OB_RT" durante el procesamiento actual del OB
deseado, en LAST_RT
‚óè se indica DW#16#FFFF FFFF, en caso de
que en el OB deseado ya se haya efectuado
una llamada de "OB_RT" OB_NR=0,
‚óè el tiempo de ejecuci√≥n del √∫ltimo
procesamiento finalizado del OB, en caso de
que en el OB deseado no se haya efectuado
ninguna llamada de "OB_RT" con OB_NR=0.
Nota: Los tiempos de interrupci√≥n por OBs de
mayor prioridad no se indican en LAST_RT . Las
prestaciones espec√≠ficas de OB del sistema ope‚Äê
rativo (p. ej. la creaci√≥n y preparaci√≥n de infor‚Äê
maci√≥n de arranque de OB, la actualizaci√≥n de la
memoria imagen de proceso, la actualizaci√≥n de
la memoria imagen parcial de proceso) se indi‚Äê
can en LAST_RT .

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6181

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Significado

LAST_ET

Output

DINT

I, Q, M, D, L

Intervalo en ¬µs entre la solicitud de OB y el fin del
procesamiento del OB indicado, para el √∫ltimo
procesamiento finalizado del OB indicado.
Si el OB cuyos tiempos de ejecuci√≥n se desean
conocer est√° proces√°ndose actualmente, rige lo
siguiente:
En la primera llamada de la instrucci√≥n "OB_RT"
durante el procesamiento actual del OB deseado
se indica en LAST_ET el intervalo entre la √∫ltima
solicitud de OB completamente procesada y el fin
del procesamiento del OB indicado.
Con cada nueva llamada de la instrucci√≥n
"OB_RT" durante el procesamiento actual del OB
deseado, en LAST_ET
‚óè se indica DW#16#FFFF FFFF , en caso de
que en el OB deseado ya se haya efectuado
una llamada de "OB_RT" OB_NR=0,
‚óè el intervalo entre la √∫ltima solicitud de OB
completamente procesada y el fin del
procesamiento del OB deseado, en caso de
que en el OB deseado no se haya efectuado
ninguna llamada de "OB_RT" con OB_NR=0.
Nota: Los tiempos de interrupci√≥n por OBs de
mayor prioridad se indican en LAST_ET .

CUR_T

Output

DINT

I, Q, M, D, L

Momento de la solicitud del OB indicado que est√°
proces√°ndose actualmente, en forma de tiempo
relativo en ¬µs. Si el OB indicado no est√° proce‚Äê
s√°ndose actualmente, CUR_T contiene el valor
"0".
Nota: La hora del sistema es un contador que
contabiliza desde "0" a "2 147 483 647" ¬µs. En
caso de desbordamiento, el contador empieza
de nuevo desde "0".

CUR_RT

6182

Output

DINT

I, Q, M, D, L

Tiempo de ejecuci√≥n transcurrido en ¬µs del pro‚Äê
cesamiento actual del OB indicado. CUR_RT es
"0" si el OB (todav√≠a) no est√° proces√°ndose. Fi‚Äê
nalizado el procesamiento, el tiempo de ejecu‚Äê
ci√≥n se transfiere a LAST_RT , y CUR_RT se
ajusta a 0.
Nota: Los tiempos de interrupci√≥n por OBs de
mayor prioridad no se indican en CUR_RT . Las
prestaciones espec√≠ficas de OB del sistema ope‚Äê
rativo suministradas hasta el momento de la lla‚Äê
mada de la instrucci√≥n "OB_RT" se indican en
CUR_RT .

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Significado

CUR_ET

Output

DINT

I, Q, M, D, L

El intervalo en ¬µs transcurrido desde la solicitud
del OB indicado que est√° proces√°ndose actual‚Äê
mente. CUR_ET es "0" si el OB indicado no est√°
proces√°ndose actualmente. Finalizado el proce‚Äê
samiento, el tiempo de ejecuci√≥n se transfiere a
LAST_ET , y CUR_ET se ajusta a "0".
Nota: Los tiempos de interrupci√≥n por OBs de
mayor prioridad se indican en CUR_ET .

NEXT_ET

Output

DINT

I, Q, M, D, L

Si hay m√°s procesamientos del OB indicado pen‚Äê
dientes antes de que finalice la solicitud actual,
en NEXT_ET se indica el intervalo en ¬µs entre el
momento actual y el momento de la pr√≥xima so‚Äê
licitud. NEXT_ET es "0" si no existe para el OB en
cuesti√≥n ning√∫n otro evento de arranque aparte
del evento de inicio en procesamiento o pendien‚Äê
te de procesamiento.
WinLC RTX y las CPUs S7-400 no utilizan este
par√°metro. En estos sistemas, NEXT_ET tiene el
valor "FFFF FFFF".
Nota: Los tiempos de interrupci√≥n por OBs de
mayor prioridad se indican en NEXT_ET .

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Los tiempos incluyen tambi√©n los tiempos de ejecuci√≥n de posibles procesamientos anidados
de alarmas de errores sincr√≥nicos (OB 121, OB 122).
Nota
Si se indica en OB_NR un n√∫mero de OB que est√° presente en los datos de la CPU, pero el OB
correspondiente todav√≠a no ha sido llamado por el sistema operativo o no ha sido cargado en
la CPU por el usuario, RET_VAL contiene el n√∫mero de OB indicado, y PRIO la prioridad
configurada (o en su caso predeterminada) del OB indicado. Los par√°metros de tiempo de
ejecuci√≥n (CUR_RT, CUR_ET, LAST_RT, LAST_ET, NEXT_ET) devuelven el valor inicial
DW#16#FFFF FFFF. En los siguientes tipos de arranque o cambios de estado operativo, los
par√°metros de tiempo de ejecuci√≥n se ajustan a su valor inicial: Rearranque completo,
arranque en fr√≠o, rearranque.

Par√°metro RET_VAL
Clase de evento
c√≥digo de error

Explicaci√≥n

de 1 a 102

N√∫mero del OB al que se transfiere la informaci√≥n

W#16#8080

El par√°metro OB_NR contiene un valor no admisible.

W#16#8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6183

Instrucciones
4.2 Instrucciones

C_DIAG: Determinar estado actual de la conexi√≥n
Descripci√≥n
Esta instrucci√≥n permite conocer el estado actual de todas las conexiones S7 y todas las
conexiones S7 de alta disponibilidad (o sus conexiones parciales).
Evaluando adecuadamente estos datos de conexi√≥n pueden detectarse el fallo de las
conexiones S7 y las conexiones S7 de alta disponibilidad y, en su caso, notificarlo a un sistema
de manejo y visualizaci√≥n. Las conexiones vigiladas pueden existir tanto entre sistemas de
automatizaci√≥n como entre un sistema de automatizaci√≥n y un sistema de manejo y
visualizaci√≥n.
Nota
El cambio de estado operativo RUN -> STOP -> RUN de una CPU no influye en el estado de
las conexiones configuradas. Excepci√≥n: Cuando una estaci√≥n H pasa del estado redundante
al estado STOP, en el caso de las conexiones de alta disponibilidad se deshacen las
conexiones parciales que terminan en la CPU de reserva.
En cambio, despu√©s de un fallo de red, se vuelven a establecer todas las conexiones
configuradas, con lo que cambia el estado de conexi√≥n.
As√≠, al llamarse por primera vez la instrucci√≥n en el arranque o despu√©s de este, la informaci√≥n
de conexi√≥n var√≠a en funci√≥n de si el √∫ltimo estado operativo de la CPU fue STOP o POWER
OFF.

Funcionamiento
C_DIAG" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n puede prolongarse a lo largo
de varias llamadas.
Para iniciar la petici√≥n, debe llamarse "C_DIAG" con REQ=1.
Si la petici√≥n se ha podido ejecutar de inmediato, la instrucci√≥n devuelve en el par√°metro de
salida BUSY el valor "0". Si BUSY tiene el valor "1", la petici√≥n todav√≠a est√° proces√°ndose.

Llamada
Para detectar fallos de conexiones S7 y conexiones S7 de alta disponibilidad debe llamarse
"C_DIAG" en un OB de alarma c√≠clica que sea iniciado por el sistema operativo p. ej. cada 10
segundos.
Dado que en circunstancias normales el estado de las conexiones no suele variar, para estas
llamadas c√≠clicas es recomendable no copiar los datos de conexi√≥n al programa de usuario
hasta que hayan cambiado respecto a la √∫ltima llamada (llamada con MODE=B#16#02, ver
abajo).

6184

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
La instrucci√≥n "C_DIAG" tiene cuatro modos de operaci√≥n posibles, que se enumeran en la
tabla siguiente.
MODE
(B#16#...)

"C_DIAG" copia datos de conexi√≥n en el programa
de usuario

"C_DIAG" transfiere informaci√≥n de acuse al sistema
operativo

00

No

S√ç

01

S√ç

S√ç

02

‚óè S√≠, en caso de que los datos de conexi√≥n hayan
cambiado

S√ç

‚óè No, en caso de que los datos de conexi√≥n no
hayan cambiado
03

S√ç

No

Al transferir la informaci√≥n de acuse al sistema operativo, se acusan las modificaciones de
estado de los datos de conexi√≥n producidas desde la √∫ltima llamada de "C_DIAG" (con
MODE=B#16#00, 01 o 02).
Nota
Si se llama "C_DIAG" en un OB de alarma c√≠clica en el modo de operaci√≥n "Copia
condicionada" (MODE=B#16#02), debe comprobarse que despu√©s de un arranque en fr√≠o de
la CPU no haya valores iniciales en el √°rea de destino. Para asegurarlo, debe llamarse una vez
"C_DIAG" en el OB 102 con el modo de operaci√≥n "Copia incondicional con acuse"
(MODE=B#16#01).

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6185

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "C_DIAG":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

REQ

Input

BOOL

Par√°metro de control request to activate

I, Q, M, D, L

REQ=1: Se lanza la petici√≥n, si todav√≠a no se ha
iniciado.
MODE

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

ID de la petici√≥n
Valores posibles:
‚óè B#16#00: "C_DIAG" no copia datos de
conexi√≥n, sino que se limita a transferir al
sistema operativo una informaci√≥n de acuse.
‚óè B#16#01: "C_DIAG" copia los datos de
conexi√≥n al programa de usuario, sea cual
sea su estado de modificaci√≥n, y transfiere
al sistema operativo una informaci√≥n de
acuse.
‚óè B#16#02: Si los datos de conexi√≥n han
cambiado, "C_DIAG" los copia en el
programa de usuario. Si no han cambiado,
no se realiza la copia. "C_DIAG" transfiere al
sistema operativo una informaci√≥n de acuse
en ambos casos.
‚óè B#16#03: "C_DIAG" copia los datos de
conexi√≥n en el programa de usuario, sea
cual sea su estado de modificaci√≥n. No
transfiere al sistema operativo ninguna
informaci√≥n de acuse.

RET_VAL

Return

INT

I, Q, M, D, L

Valor de retorno (c√≥digo de error o estado de la
petici√≥n)

BUSY

Output

BOOL

I, Q, M, D, L

BUSY=1: La petici√≥n todav√≠a no ha finalizado.

6186

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

N_CON

Output

INT

√çndice de la √∫ltima estructura en CON_ARR, en
la que .DIS_PCON o .DIS_CON tienen el valor
TRUE . As√≠, en el programa de usuario solo es
necesario comprobar los primeros N_CON ele‚Äê
mentos de CON_ARR .

I, Q, M, D, L

Nota: La primera estructura del campo
CON_ARR tiene el √≠ndice "1".
CON_ARR

Output

ANY

I, Q, M, D, L

√Årea de destino para los datos de conexi√≥n le√≠‚Äê
dos.
Solo se admite el tipo de datos BYTE .
Cada conexi√≥n tiene asignada una estructura.
Debe escogerse un √°rea de destino lo bastante
grande para albergar todas las estructuras in‚Äê
cluso en caso de alcanzarse el m√°ximo de co‚Äê
nexiones posibles en la CPU. T√©ngalo en cuen‚Äê
ta sobre todo despu√©s de cambiar una CPU,
siempre que la CPU nueva tenga m√°s recursos
que la anterior.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro CON_ARR
El √°rea de destino para los datos de conexi√≥n le√≠dos es un campo de estructuras. Cada
conexi√≥n tiene asignada una estructura.
No es necesario que el campo est√© ocupado desde las posiciones iniciales con valores v√°lidos,
y tambi√©n puede haber entradas no v√°lidas entre dos valores v√°lidos.
Las conexiones no est√°n ordenadas en funci√≥n de referencias de conexi√≥n.
Nota
Al copiar los datos de conexi√≥n desde el sistema operativo al √°rea de destino especificada, se
garantiza la coherencia de los datos de una conexi√≥n.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6187

Instrucciones
4.2 Instrucciones

Formato de una estructura
Par√°metro

Tipo de datos

Descripci√≥n

CON_ID

WORD

Referencia de conexi√≥n que se ha asignado a esa conexi√≥n en la configuraci√≥n
W#16#FFFF: Identificador no v√°lido, es decir, conexi√≥n no configurada. Si adicional‚Äê
mente CON_ARR[i].DIS_PCON o CON_ARR[i].DIS_CON est√°n activadas (ver aba‚Äê
jo), la conexi√≥n ha sido reconfigurada o borrada desde la √∫ltima llamada de "C_DIAG".

STAT_CON

BYTE

Estado actual de la conexi√≥n S7 o de la conexi√≥n S7 de alta disponibilidad
Valores posibles:
‚óè B#16#00: Conexi√≥n S7 no establecida
‚óè B#16#10: Conexi√≥n S7 de alta disponibilidad no establecida
‚óè B#16#01: La conexi√≥n S7 est√° estableci√©ndose en este momento
‚óè B#16#11: La conexi√≥n S7 de alta disponibilidad est√° estableci√©ndose en este
momento
‚óè B#16#02: La conexi√≥n S7 est√° establecida
‚óè B#16#12: La conexi√≥n S7 de alta disponibilidad est√° establecida, pero sin alta
disponibilidad
‚óè B#16#13: La conexi√≥n S7 de alta disponibilidad est√° establecida, con alta
disponibilidad

PROD_CON

BYTE

STBY_CON

BYTE

N√∫mero de conexi√≥n parcial de la conexi√≥n productiva
Valores posibles: 0, 1, 2, 3
N√∫mero de conexi√≥n parcial de la conexi√≥n de reserva (standby) (B#16#FF: No hay
conexi√≥n de reserva)
Valores posibles: 0, 1, 2, 3
Nota: Solo una conexi√≥n S7 de alta disponibilidad puede poseer una conexi√≥n de
reserva.

DIS_PCON

BOOL

Las transiciones W#16#12 -> W#16#13 y W#16#13 -> W#16#12 de
CON_ARR[i].STAT_CON desde la √∫ltima llamada de instrucci√≥n ajustan
CON_ARR[i].DIS_PCON a "1". Cualquier otro cambio de estado de la conexi√≥n i no
provoca alteraciones en CON_ARR[i].DIS_PCON .
Nota:
‚óè Con MODE=B#16#01 y 02 , al copiar los datos de conexi√≥n en el √°rea de destino
se desactiva el bit del sistema operativo que corresponde a DIS_PCON.
‚óè Con MODE=B#16#03 , el bit del sistema operativo que corresponde a DIS_PCON
permanece invariable.

DIS_CON

BOOL

Toda modificaci√≥n de CON_ARR[i].STAT_CON desde la √∫ltima llamada de
"C_DIAG", a excepci√≥n de las transiciones W#16#12 -> W#16#13 y W#16#13 ->
W#16#12 , ajusta CON_ARR[i].DIS_CON a 1.
Nota:
‚óè Con MODE=B#16#01 y 02 , al copiar los datos de conexi√≥n en el √°rea de destino
se desactiva el bit del sistema operativo que corresponde a "DIS_CON".
‚óè Con MODE=B#16#03 , el bit del sistema operativo que corresponde a "DIS_CON"
permanece invariable.

RES0

BYTE

Reservado (B#16#00)

RES1

BYTE

Reservado (B#16#00)

6188

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error
(W#16#...)

Explicaci√≥n

0000

‚óè MODE=B#16#00, 01 o 02: Sin cambio del estado de conexi√≥n (elemento de estructura STAT_CON)
desde la √∫ltima llamada. La petici√≥n se ha ejecutado sin errores.
‚óè MODE=B#16#03: La copia se ha ejecutado sin errores.

0001

‚óè MODE=B#16#00, 01 o 02: Cambio del estado de conexi√≥n (elemento de estructura STAT_CON) en
por lo menos una conexi√≥n desde la √∫ltima llamada. La petici√≥n se ha ejecutado sin errores.
‚óè MODE=B#16#03: RET_VAL W#16#0001 no es posible:

7000

Primera llamada con REQ=0.
La petici√≥n definida mediante MODE no se procesa; BUSY tiene el valor "0",

7001

Primera llamada con REQ=1.
Se ha lanzado la petici√≥n definida mediante MODE . BUSY tiene el valor "1".

7002

Llamada intermedia (REQ irrelevante). La petici√≥n activada todav√≠a est√° en curso. BUSY tiene el valor "1".

8080

El par√°metro MODE contiene un valor no admisible.

8081

El par√°metro CON_ARR contiene un tipo de datos no admisible.

8082

El par√°metro CON_ARR contiene una indicaci√≥n de longitud demasiado peque√±a. La instrucci√≥n no copia
datos en el √°rea de destino.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

4.2.3.10

Funciones de bloques de datos

READ_DBL: Leer de un bloque de datos de la memoria de carga
Descripci√≥n
La instrucci√≥n copia un DB o una parte de un DB que se encuentra en la memoria de carga
(Micro Memory Card) en el √°rea de datos de un DB de destino. El DB de destino tiene que ser
relevante para la ejecuci√≥n, es decir, no puede haberse creado con el atributo UNLINKED. El
contenido de la memoria de carga no se modifica en la operaci√≥n de copia.
Para garantizar la coherencia de los datos no debe modificarse el √°rea de destino durante el
procesamiento de "READ_DBL" (es decir, mientras el par√°metro BUSY tenga el valor TRUE).
Para los par√°metros SRCBLK y DSTBLK se aplican las siguientes restricciones:
‚óè En el caso de un puntero ANY del tipo BOOL la longitud debe ser divisible entre 8.
‚óè En el caso de un puntero ANY del tipo STRING la longitud debe ser 1.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6189

Instrucciones
4.2 Instrucciones
La longitud del DB de origen puede consultarse, en caso necesario, con la instrucci√≥n
"TEST_DB (P√°gina 6201)".
Nota
READ_DBL se procesa de modo as√≠ncrono, lo que la hace inadecuada para leer variables
repetidamente (es decir, de modo c√≠clico) en la memoria de carga.
Una petici√≥n iniciada siempre se finaliza. Si se alcanza el n√∫mero m√°ximo de instrucciones
"READ_DBL" activas simult√°neamente y en ese momento se vuelve a llamar "READ_DBL" en
una clase de mayor prioridad, se devuelve el c√≥digo de error W#16#80C3. No es
recomendable, por lo tanto, volver a iniciar inmediatamente la petici√≥n de mayor prioridad.

Funcionamiento
La instrucci√≥n "READ_DBL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se
prolonga a lo largo de varias llamadas. Para iniciar la petici√≥n, debe llamarse "READ_DBL" con
REQ =1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813)

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "READ_DBL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: solicitud de lectura

SRCBLK

Input

ANY

D

Puntero al bloque de datos de la memoria de
carga de la que se lee

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: la lectura todav√≠a no ha finaliza‚Äê
do.

DSTBLK

Output

ANY

D

Puntero al bloque de datos de la memoria de
trabajo en la que se tiene que escribir

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6190

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

Sin error

0081

El √°rea de destino es mayor que el √°rea de origen.
El √°rea de origen se escribe completamente en el √°rea de destino, el resto de bytes del √°rea de destino
no se modifica.

7000

Primera llamada con REQ=0: Ninguna transmisi√≥n de datos activa; BUSY tiene el valor "0".

7001

Primera llamada con REQ=1: Transmisi√≥n de datos iniciada; BUSY tiene el valor "1".

7002

Llamada intermedia (REQ irrelevante): Transmisi√≥n de datos activa; BUSY tiene el valor "1".

8081

El √°rea de origen es mayor que el √°rea de destino.
El √°rea de destino se escribe por completo, el resto de bytes del √°rea de origen se ignoran.

8093

En el par√°metro DSTBLK no se ha indicado ning√∫n bloque de datos o se ha indicado uno que no se
encuentra en la memoria de trabajo.

80B1

Con el par√°metro SRCBLK no se ha indicado ning√∫n bloque de datos o el bloque de datos indicado no es
un objeto de la memoria de carga (p. ej. un DB creado mediante "CREAT_DB (P√°gina 6195)").

80B4

El DB con atributo F no debe leerse.

80C0

El DB de destino est√° siendo procesado por otra instrucci√≥n o funci√≥n de comunicaci√≥n.

80C3

El n√∫mero m√°ximo de instrucciones "READ_DBL" activas simult√°neamente ya se ha alcanzado en este
momento.

8xyy

C√≥digos de error generales
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

WRIT_DBL: Escribir en un bloque de datos de la memoria de carga
Descripci√≥n
Esta instrucci√≥n permite transferir el contenido de un DB o un √°rea de DB desde la memoria de
trabajo a un DB o un √°rea de DB de la memoria de carga (Micro Memory Card). El DB de origen
tiene que ser relevante para la ejecuci√≥n, es decir, no puede haberse creado con el atributo
UNLINKED. Sin embargo, s√≠ puede haber sido creado mediante la instrucci√≥n "CREAT_DB".
Para garantizar la coherencia de los datos no debe modificarse el √°rea de origen durante el
procesamiento de "WRIT_DBL" (es decir, mientras el par√°metro BUSY tenga el valor TRUE).
Para los par√°metros SRCBLK y DSTBLK se aplican las siguientes restricciones:
‚óè En el caso de un puntero ANY del tipo BOOL la longitud debe ser divisible entre 8.
‚óè En el caso de un puntero ANY del tipo STRING la longitud debe ser 1.
La longitud del DB de destino puede consultarse, en caso necesario, con la instrucci√≥n
"TEST_DB (P√°gina 6201)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6191

Instrucciones
4.2 Instrucciones
"WRIT_DBL" no modifica la suma de verificaci√≥n del programa de usuario si se escribe en un
DB creado mediante instrucci√≥n. Por el contrario, al describir un DB cargado, la primera
escritura en este DB s√≠ modifica la suma de verificaci√≥n del programa de usuario.
Nota
"WRIT_DBL" no es adecuada para escribir variables repetidamente (es decir, de modo c√≠clico)
en la memoria de carga, ya que, por motivos t√©cnicos, las Micro Memory Cards solo admiten
un n√∫mero determinado de accesos de escritura.

Funcionamiento
La instrucci√≥n "WRIT_DBL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se
prolonga a lo largo de varias llamadas. Para iniciar la petici√≥n, debe llamarse "WRIT_DBL" con
REQ =1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813)

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WRIT_DBL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: solicitud de escritura

SRCBLK

Input

ANY

D

Puntero en el bloque de datos de la memoria
de trabajo de la que se lee

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La escritura todav√≠a no ha finali‚Äê
zado.

DSTBLK

Output

ANY

D

Puntero al bloque de datos de la memoria de
carga en la que se tiene que escribir.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

Sin error

0081

El √°rea de destino es mayor que el √°rea de origen.
El √°rea de origen se escribe completamente en el √°rea de destino, el resto de bytes del √°rea de destino
no se modifica.

7000

Primera llamada con REQ=0: Ninguna transmisi√≥n de datos activa; BUSY tiene el valor "0".

7001

Primera llamada con REQ=1: transmisi√≥n de datos iniciada. BUSY tiene el valor "1".

6192

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error

Descripci√≥n

(W#16#...)
7002

Llamada intermedia (REQ irrelevante): Transmisi√≥n de datos activa; BUSY tiene el valor "1".

8081

El √°rea de origen es mayor que el √°rea de destino.
El √°rea de destino se escribe por completo, el resto de bytes del √°rea de origen se ignoran.

8092

Modo de operaci√≥n incorrecto: Mientras "WRIT_DBL" estaba activo, la CPU ha pasado a STOP. Cuando
vuelva a pasar a RUN, se proporcionar√° este c√≥digo de error. Vuelva a llamar "WRIT_DBL".

8093

En el par√°metro SRCBLK no se ha indicado ning√∫n bloque de datos o se ha indicado uno que no se
encuentra en la memoria de trabajo.

80B1

Con el par√°metro DSTBLK no se ha indicado ning√∫n bloque de datos o el bloque de datos indicado no es
un objeto de la memoria de carga (p. ej. un DB creado mediante "CREAT_DB (P√°gina 6195)").

80B4

El DB con atributo F no debe modificarse

80C0

El destino est√° siendo procesado por otra instrucci√≥n o funci√≥n de comunicaci√≥n. Ejemplo: Se carga un DB
de la CPU en la programadora. El contenido de este DB se quiere modificar con "WRIT_DBL".

80C3

El n√∫mero m√°ximo de instrucciones "WRIT_DBL" activas simult√°neamente ya se ha alcanzado en este
momento.

8xyy

C√≥digos de error generales
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

DEL_DB: Borrar bloque de datos
Descripci√≥n
Esta instrucci√≥n permite borrar un bloque de datos existente en la memoria de trabajo y, en su
caso, en la memoria de carga de la CPU. El DB que se va borrar no debe estar abierto en el
nivel de ejecuci√≥n actual ni en otro de menor prioridad. Es decir, no debe estar registrado en
ninguno de los dos registros de DB ni en la pila B.
De lo contrario, al llamar la instrucci√≥n, la CPU inicia el OB 121. Si el OB 121 no est√° cargado,
la CPU pasa a STOP; con S7-300 (excepci√≥n: CPU 318) el DB se borra sin llamar el OB 121.
Nota
Borrar DBs de instancia con "DEL_DB" no es recomendable y provoca siempre errores de
programa. Evite siempre borrar DBs de instancia con "DEL_DB".
La tabla siguiente explica cu√°ndo puede borrarse un DB con "DEL_DB".
Si el DB ...

"DEL_DB" ...

se cre√≥ llamando la instrucci√≥n "CREAT_DB",

permite borrarlo.

se transfiri√≥ a la CPU y no se cre√≥ con el atributo "Depositar s√≥lo en
la memoria de carga"

permite borrarlo.

se cre√≥ con el atributo "Depositar s√≥lo en la memoria de carga"

‚óè puede borrarse en la S7-300
‚óè no puede borrarse en la S7-400

se cre√≥ llamando la instrucci√≥n "CREA_DBL"

puede borrarse

est√° almacenado en la Flashcard,

no permite borrarlo.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6193

Instrucciones
4.2 Instrucciones

Posibilidad de interrupci√≥n
La instrucci√≥n puede ser interrumpida por niveles de ejecuci√≥n de mayor prioridad. Si se vuelve
a llamar la instrucci√≥n all√≠, esa segunda llamada se interrumpe, y en RET_VAL se registra
W#16#8091.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DEL_DB":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DB_NUMBER

Input

WORD

I, Q, M, D, L o constante N√∫mero del DB que se va a borrar

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8091

En llamadas de "DEL_DB" anidadas entre s√≠ se ha superado la profundidad de anidamiento m√°xima de la
CPU utilizada.

8092

La funci√≥n "Borrar un DB" no puede ejecutarse en este momento, porque
‚óè est√° activa la funci√≥n "Comprimir memoria de usuario"
‚óè el DB que se debe borrar se est√° copiando de la CPU a un proyecto offline.
‚óè la CPU con el software WinAC ha detectado un error en el sistema operativo del ordenador en el que
est√° instalado WinAC.

80A1

Error en el par√°metro de entrada DB_NUMBER: El par√°metro actual seleccionado
‚óè tiene el valor "0"
‚óè es mayor que el n√∫mero de DB m√°ximo posible en la CPU utilizada.

80B1

El DB con el n√∫mero indicado no est√° presente en la memoria de trabajo de la CPU.

80B3

El DB se encuentra en la Flashcard.

80B4

No se ha podido borrar el DB. Causas posibles:
‚óè Pertenece a un programa F.
‚óè Es un DB de instancia de un bloque de la comunicaci√≥n S7 (solo con S7-400).
‚óè Es un DB de tecnolog√≠a.

80C1

La funci√≥n "Borrar un DB" no puede ejecutarse en este momento debido a escasez temporal de recursos.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

6194

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

CREAT_DB: Generar bloque de datos
Descripci√≥n
Esta instrucci√≥n permite crear en el programa de usuario un bloque carente de valores
preasignados. En su lugar, contiene datos casuales. Esta instrucci√≥n crea un bloque de datos
con un n√∫mero perteneciente a un √°rea especificada y con un tama√±o definido. La instrucci√≥n
asigna al DB el n√∫mero m√°s bajo posible del √°rea especificada. Para crear un DB con un
n√∫mero determinado, debe asignarse el mismo n√∫mero al l√≠mite superior y al l√≠mite inferior del
√°rea definida. No se pueden asignar los n√∫meros de los DBs ya contenidos en el programa de
usuario. La longitud del DB debe indicarse con un n√∫mero par.

Posibilidad de interrupci√≥n
La instrucci√≥n puede ser interrumpida por OBs de mayor prioridad. Si en un OB de mayor
prioridad se llama a su vez otra instrucci√≥n "CREAT_DB", se rechaza esta llamada con el
c√≥digo de error W#16#8091.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CREAT_DB":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LOW_LIMIT

Input

WORD

I, Q, M, D, L o constante El l√≠mite inferior es el n√∫mero m√°s bajo del
rango de los n√∫meros que se pueden asig‚Äê
nar al bloque de datos.

UP_LIMIT

Input

WORD

I, Q, M, D, L o constante El l√≠mite superior es el n√∫mero m√°s alto del
rango de los n√∫meros que se pueden asig‚Äê
nar al bloque de datos.

COUNT

Input

WORD

I, Q, M, D, L o constante El valor de contaje indica el n√∫mero de bytes
de datos que se desea reservar para el blo‚Äê
que de datos. Debe especificarse un n√∫me‚Äê
ro par de bytes (m√°ximo 65534).

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n
de la instrucci√≥n, el valor de respuesta con‚Äê
tendr√° un c√≥digo de error.

DB_NUMBER

Output

WORD

I, Q, M, D, L

El n√∫mero de bloque de datos es el n√∫mero
del bloque de datos creado. En caso de
error (bit 15 de RET_VAL activado) en
DB_NUMBER se registra el valor "0".

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6195

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

Sin error

8091

Se ha llamado CREAT_DB con anidamiento.

8092

La funci√≥n "Generar bloque de datos" no puede ejecutarse en este momento, porque
‚óè est√° activa la funci√≥n "Comprimir memoria de usuario"
‚óè ya se ha alcanzado el n√∫mero m√°ximo posible de DBs cargados en la CPU
‚óè la CPU H se encuentra en una operaci√≥n de acoplar y sincronizar.
‚óè la CPU con el software WinAC ha detectado un error en el sistema operativo del ordenador en el que
est√° instalado WinAC.
‚óè el borrado anterior todav√≠a no ha finalizado.

80A1

Error en el n√∫mero del DB:
‚óè el n√∫mero es "0"
‚óè el n√∫mero supera el n√∫mero de DBs espec√≠fico de la CPU
‚óè L√≠mite inferior > l√≠mite superior

80A2

Error en la longitud del DB:
‚óè la longitud es "0"
‚óè se ha indicado la longitud con un n√∫mero impar
‚óè la longitud es mayor que la admisible en la CPU

80B1

No hay ning√∫n n√∫mero de DB libre.

80B2

No hay suficiente espacio de almacenamiento libre.

80B3

No hay suficiente espacio de almacenamiento libre conexo. (Realizar compresi√≥n)

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

CREA_DB: Generar bloque de datos / remanente
Descripci√≥n
Esta instrucci√≥n permite crear en el programa de usuario un bloque carente de valores
preasignados. En su lugar, contiene datos casuales. Esta instrucci√≥n crea un bloque de datos
con un n√∫mero perteneciente a un √°rea especificada y con un tama√±o definido. La instrucci√≥n
asigna al DB el n√∫mero m√°s bajo posible del √°rea especificada. Para crear un DB con un
n√∫mero determinado, debe asignarse el mismo n√∫mero al l√≠mite superior y al l√≠mite inferior del
√°rea definida. No se pueden asignar los n√∫meros de los DBs ya contenidos en el programa de
usuario. La longitud del DB debe indicarse con un n√∫mero par.

6196

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
En funci√≥n de la selecci√≥n del par√°metro ATTRIB , el DB generado tiene la propiedad RETAIN
o NON_RETAIN:
‚óè RETAIN (= remanente) significa que el DB se genera en la parte remanente de la memoria
de trabajo, es decir, los valores actuales del DB se conservan en cada transici√≥n Power
OFF-Power ON y en cada rearranque completo (en caliente).
‚óè NON_RETAIN (= no remanente) significa que el DB se genera en la parte no remanente de
la memoria de trabajo, es decir, los valores actuales del DB no est√°n definidos tras cada
transici√≥n Power OFF-Power ON y en cada rearranque completo (en caliente).
En el caso de que no se distinga entre la memoria de trabajo remanente y no remanente, el
par√°metro ATTRIB se ignora, es decir, los valores del DB se conservan despu√©s de cada
transici√≥n Power OFF-Power ON y despu√©s de cada rearranque completo (en caliente).

Posibilidad de interrupci√≥n
La instrucci√≥n "CREA_DB" puede ser interrumpida por OBs de mayor prioridad. Si en un OB
de mayor prioridad se llama a su vez otra instrucci√≥n "CREA_DB", se rechaza esta llamada con
el c√≥digo de error W#16#8091 .

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CREA_DB":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LOW_LIMIT

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

El l√≠mite inferior es el n√∫mero m√°s bajo del
rango de los n√∫meros que se pueden asignar
al bloque de datos.

UP_LIMIT

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

El l√≠mite superior es el n√∫mero m√°s alto del
rango de los n√∫meros que se pueden asignar
al bloque de datos.

COUNT

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

El valor de contaje indica el n√∫mero de bytes
de datos que se desea reservar para el bloque
de datos. Debe especificarse un n√∫mero par
de bytes (m√°ximo 65534).

ATTRIB

Input

BYTE

I, Q, M, D, L o cons‚Äê
tante

Atributos del DB:
‚óè B#16#00: RETAIN
‚óè B#16#04: NON_RETAIN

RET_VAL

Return

INT

I, Q, M, D, L

Si se produce un error durante la ejecuci√≥n de
la instrucci√≥n, el valor de respuesta contendr√°
un c√≥digo de error.

DB_NUMBER

Output

WORD

I, Q, M, D, L

El n√∫mero de bloque de datos es el n√∫mero
del bloque de datos creado. En caso de error
(bit 15 de RET_VAL activado) en DB_NUM‚Äê
BER se registra el valor "0".

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6197

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error
(W#16#...)

Explicaci√≥n

0000

Sin error

8091

Se ha llamado CREA_DB con anidamiento.

8092

La funci√≥n "Generar bloque de datos" no puede ejecutarse en este momento, porque
‚óè est√° activa la funci√≥n "Comprimir memoria de usuario"
‚óè la CPU con el software WinAC ha detectado un error en el sistema operativo del ordenador en el que
est√° instalado WinAC.

8094

Valor no admisible en ATTRIB

80A1

Error en el n√∫mero del DB:
‚óè el n√∫mero es "0"
‚óè el n√∫mero supera el n√∫mero de DBs espec√≠fico de la CPU
‚óè L√≠mite inferior > l√≠mite superior

80A2

Error en la longitud del DB:
‚óè La longitud es "0"
‚óè se ha indicado la longitud con un n√∫mero impar
‚óè la longitud es mayor que la admisible en la CPU

80B1

No hay ning√∫n n√∫mero de DB libre.

80B2

No hay suficiente espacio de almacenamiento libre.

80B3

No hay suficiente espacio de almacenamiento libre conexo. (Realizar compresi√≥n)

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

CREA_DBL: Generar bloque de datos en la memoria de carga
Descripci√≥n
Esta instrucci√≥n permite crear un bloque de datos nuevo en la memoria de carga (Micro
Memory Card). Esta instrucci√≥n crea un bloque de datos con un n√∫mero perteneciente a un
√°rea especificada y con un tama√±o definido. La instrucci√≥n asigna al DB el n√∫mero m√°s bajo
posible del √°rea especificada. Para crear un DB con un n√∫mero determinado, debe asignarse
el mismo n√∫mero al l√≠mite superior y al l√≠mite inferior del √°rea definida. No se pueden asignar
los n√∫meros de los DBs ya contenidos en el programa de usuario. Si ya existe en la memoria
de trabajo y/o en la memoria de carga un DB con el mismo n√∫mero, o el DB existe ya como
variante copiada, la instrucci√≥n finaliza y se devuelve una informaci√≥n de error.
Nota
En caso necesario, puede consultarse con la instrucci√≥n "TEST_DB (P√°gina 6201)" si ya existe
un DB con el mismo n√∫mero.
El DB se rellena con el contenido del √°rea de datos a la que apunta el par√°metro
SRCBLK(source block). Esta √°rea de datos debe ser un DB o un √°rea de un DB. Para

6198

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
garantizar la coherencia de los datos, no se debe modificar esa √°rea de datos durante el
procesamiento de "CREA_DBL" (es decir, mientras el par√°metro BUSY tenga el valor TRUE).
Un DB con el atributo READ_ONLY solo se puede crear e inicializar mediante "CREA_DBL".
"CREA_DBL" no modifica la suma de verificaci√≥n del programa de usuario.

Funcionamiento
La instrucci√≥n "CREA_DBL" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se
prolonga a lo largo de varias llamadas. Para iniciar la petici√≥n, debe llamarse "CREA_DBL" con
REQ=1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY.
Consulte tambi√©n: Diferencia entre las instrucciones que funcionan s√≠ncronamente y las que
funcionan as√≠ncronamente (P√°gina 4813)

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CREA_DBL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ = 1: Solicitud de creaci√≥n del DB

LOW_LIMIT

Input

WORD

I, Q, M, D, L

L√≠mite inferior del √°rea de la cual "CREA_DBL"
extrae el n√∫mero que se asigna al DB

UP_LIMIT

Input

WORD

I, Q, M, D, L

L√≠mite superior del √°rea de la cual
"CREA_DBL" extrae el n√∫mero que se asigna
al DB

COUNT

Input

WORD

I, Q, M, D, L

El valor de contaje indica el n√∫mero de bytes
de datos que se desea reservar para el DB.
Debe especificarse un n√∫mero par de bytes.

ATTRIB

Input

BYTE

I, Q, M, D, L

Propiedades del DB:
Bit 0 = 1:

UNLINKED:
El DB se encuentra solo en la
memoria de carga.

Bit 1 = 1:

READ_ONLY:
El DB est√° protegido contra
escritura.

Bit 2 = 1:

NON_RETAIN:
El DB no es remanente.

Bits de 3 a 7:

Reservado

SRCBLK

Input

ANY

D

Puntero al bloque de datos con cuyos valores
se inicializar√° el bloque de datos que se va a
crear

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

BUSY

Output

BOOL

I, Q, M, D, L

BUSY = 1: La operaci√≥n todav√≠a no ha finali‚Äê
zado.

DB_NUM

Output

WORD

I, Q, M, D, L

N√∫mero del DB creado

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6199

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Descripci√≥n

(W#16#...)
0000

Sin error

0081

El √°rea de destino es mayor que el √°rea de origen.
El √°rea de origen se escribe por completo en el √°rea de destino, y el resto de los bytes del √°rea de destino
se rellenan con 0.

7000

Primera llamada con REQ=0: Ninguna transmisi√≥n de datos activa; BUSY tiene el valor "0".

7001

Primera llamada con REQ=1: Transmisi√≥n de datos iniciada; BUSY tiene el valor "1".

7002

Llamada intermedia (REQ irrelevante): transferencia de datos ya activa; BUSY tiene el valor "1"

8081

El √°rea de origen es mayor que el √°rea de destino.
El √°rea de destino se escribe por completo, el resto de bytes del √°rea de origen se ignoran.

8091

Se ha llamado "CREA_DBL" con anidamiento.

8092

La funci√≥n "Generar bloque de datos" no puede ejecutarse en este momento, porque
‚óè est√° activa la funci√≥n "Comprimir memoria de usuario";
‚óè se ha alcanzado ya el n√∫mero m√°ximo de bloques admisible en la CPU

8093

En el par√°metro SRCBLK no se ha indicado ning√∫n bloque de datos o se ha indicado uno que no se
encuentra en la memoria de trabajo.

8094

En el par√°metro ATTRIB se ha indicado un atributo todav√≠a no soportado.

80A1

Error en el n√∫mero del DB:
‚óè el n√∫mero es 0 o no est√° dentro del rango v√°lido de la CPU (CPU15xx: 60001 ... 60999)
‚óè el n√∫mero supera el n√∫mero de DBs espec√≠fico de la CPU
‚óè L√≠mite inferior > l√≠mite superior

80A2

Error en la longitud del DB:
‚óè La longitud es "0"
‚óè La longitud es un n√∫mero impar
‚óè La longitud es mayor que la admisible en la CPU

80B1

No hay ning√∫n n√∫mero de DB libre

80B2

Memoria de trabajo insuficiente

80BB

Memoria de carga insuficiente

80C0

El destino est√° siendo procesado por otra instrucci√≥n o por una funci√≥n de comunicaci√≥n.

80C3

El n√∫mero m√°ximo de instrucciones "CREA_DBL" activas simult√°neamente ya se ha alcanzado en este
momento.

8xyy

C√≥digos de error generales, p. ej.:
‚óè El DB de origen no existe o existe solo como variante copiada
‚óè El √°rea de origen no existe en el DB
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

6200

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

TEST_DB: Testear bloque de datos
Descripci√≥n
Con S7-300, la instrucci√≥n devuelve informaci√≥n sobre un bloque de datos que se encuentra
en la memoria de trabajo o la memoria de carga de la CPU y, con S7-400, devuelve informaci√≥n
sobre un bloque de datos que se encuentra en la memoria de trabajo de la CPU. Esta
instrucci√≥n calcula el n√∫mero de bytes de datos correspondientes al DB seleccionado y
comprueba si est√° protegido contra escritura.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "TEST_DB":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

DB_NUMBER

Input

WORD

I, Q, M, D, L o cons‚Äê
tante

N√∫mero del DB que se va a probar

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

DB_LENGTH

Output

WORD

I, Q, M, D, L

N√∫mero de bytes de datos que contiene el DB
seleccionado.

WRITE_PROT

Output

BOOL

I, Q, M, D, L

Informaci√≥n sobre el identificador de protec‚Äê
ci√≥n contra escritura del DB seleccionado ("1"
significa protegido contra escritura).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

80A1

Error en el par√°metro de entrada DB_NUMBER: El par√°metro actual seleccionado
‚óè tiene el valor "0"
‚óè es mayor que el n√∫mero de DB m√°ximo posible en la CPU utilizada.

80B1

El DB con el n√∫mero indicado no est√° cargado en la CPU.

80B2

El DB ha sido creado con la palabra clave UNLINKED.

8xyy

Informaci√≥n de error general,
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6201

Instrucciones
4.2 Instrucciones

4.2.3.11

Funciones de tabla

ATT: Introducir valor en tabla
Descripci√≥n
Esta instrucci√≥n complementa el par√°metro DATA como siguiente entrada de una tabla e
incrementa en uno el n√∫mero de entradas. La tabla est√° compuesta de palabras. Esta
instrucci√≥n permite crear entradas de tabla que son utilizadas por "FIFO (P√°gina 6203)" y
"LIFO (P√°gina 6207)".
‚óè La primera entrada de una tabla "FIFO (P√°gina 6203)" o "LIFO (P√°gina 6207)" indica la
longitud m√°xima de la tabla.
‚óè La segunda entrada de una tabla indica el n√∫mero de entradas que contiene la tabla.
‚óè La tercera entrada de la tabla contiene la primera palabra de datos.
Nota
Al crear la tabla deben inicializarse las dos primeras entradas.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "ATT":
Par√°metros

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

DATA

Input

WORD

I, Q, M, D, L, P o cons‚Äê
tante

Datos que deben introducirse en la tabla.

TABLE

Input

*Puntero

I, Q, M, D

Apunta a la direcci√≥n inicial de la tabla "FIFO"
o "LIFO".

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Si el n√∫mero de entradas es igual o menor que la longitud de la tabla, los datos no se introducen
en la tabla y el estado l√≥gico de "BR" se ajusta a "0".

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "ATT" se ejecuta. En el
ejemplo, DATA se introduce en la tabla como quinta entrada, y el n√∫mero de entrada se
incrementa de 4 a 5.
Si la instrucci√≥n "ATT" se ejecuta sin errores, los estados l√≥gicos de "ENO" y Q 0.0 se ajustan
a "1".

6202

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
$77
,
:
3'%'%;

4
(1

(12

'$7$
7$%/(

Antes de la ejecuci√≥n:
TABLE (longitud de tabla)

DBW10 = W#16#0006

N√∫mero de entradas

DBW12 = W#16#0004
DBW14 = W#16#0012
DBW16 = W#16#0029
DBW18 = W#16#0090
DBW20 = W#16#0002
DBW22 = W#16#0000
DBW24 = W#16#0000

Despu√©s de la ejecuci√≥n:
TABLE (longitud de tabla)

DBW10 = W#16#0006

N√∫mero de entradas

DBW12 = W#16#0005
DBW14 = W#16#0012
DBW16 = W#16#0029
DBW18 = W#16#0090
DBW20 = W#16#0002
DBW22 = W#16#0024
DBW24 = W#16#0000

FIFO: Emitir primer valor de la tabla
Descripci√≥n
Esta instrucci√≥n devuelve la entrada m√°s antigua de la tabla "FIFO" como valor de funci√≥n. El
n√∫mero se entrada se reduce en 1. Si todav√≠a existen entradas en la tabla, se desplazan hacia
abajo. La tabla "FIFO" est√° compuesta de palabras. Con "ATT (P√°gina 6202)" se pueden
introducir valores en la tabla "FIFO".
‚óè La primera entrada de una tabla indica la longitud m√°xima de la tabla.
‚óè La segunda entrada de una tabla indica el n√∫mero de entradas que contiene la tabla.
‚óè La tercera entrada de la tabla contiene la primera palabra de datos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6203

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "FIFO":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

TABLE

Input

*Puntero

I, Q, M, D

Apunta a la direcci√≥n inicial de la tabla "FI‚Äê
FO".

RET_VAL

Return

WORD

I, Q, M, D, L, P

La entrada m√°s antigua de la tabla "FIFO".

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Si la tabla "FIFO" est√° vac√≠a (n√∫mero de entradas = 0), RET_VAL no se modifica y el estado
l√≥gico de "BR/ENO" se ajusta a "0".

Ejemplo (KOP)
Con estado l√≥gico de la entrada I 0.0 = "1" (activado), se ejecuta "FIFO". En el ejemplo, se
emite la entrada m√°s antigua de la tabla como valor de funci√≥n (MW 2.0). El n√∫mero de
entradas se reduce de 5 a 4, y las entradas restantes de la tabla se desplazan hacia abajo.
Si "FIFO" se ejecuta sin errores, los estados l√≥gicos de "BR/ENO" y Q 0.0 se ajustan a "1".
),)2
,

3'%'%;

4
(1
7$%/(

(12
5(7B9$/

0:

Antes de la ejecuci√≥n:
TABLE (longitud de tabla)

DBW10 = W#16#0006

N√∫mero de entradas

DBW12 = W#16#0005
DBW14 = W#16#0012
DBW16 = W#16#0029
DBW18 = W#16#0090
DBW20 = W#16#0002
DBW22 = W#16#0024
DBW24 = W#16#0000

RET_VAL

6204

MW2 = W#16#0000

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Despu√©s de la ejecuci√≥n:
TABLE (longitud de tabla)

DBW10 = W#16#0006

N√∫mero de entradas

DBW12 = W#16#0004
DBW14 = W#16#0029
DBW16 = W#16#0090
DBW18 = W#16#0002
DBW20 = W#16#0024
DBW22 = W#16#0024
DBW24 = W#16#0000

RET_VAL

MW2 = W#16#0012

TBL_FIND: Buscar valor en tabla
Descripci√≥n
Esta instrucci√≥n permite buscar expresiones en la memoria. La instrucci√≥n "TBL_FIND"
efect√∫a una comparaci√≥n (par√°metro CMD) entre la expresi√≥n de origen (par√°metro PATRN)
y las entradas de la tabla de origen (par√°metro SRC). Se busca la primera entrada de la tabla,
a partir de la entrada indicada en el par√°metro INDX, que cumpla los criterios de comparaci√≥n.
El n√∫mero de la entrada se guarda en el par√°metro INDX. Si no se encuentra ninguna
coincidencia, el par√°metro INDXapunta m√°s all√° del final de la tabla y se desactiva la salida de
la instrucci√≥n "TBL_FIND".
‚óè Si CMD = 1, la instrucci√≥n busca "TBL_FIND" el primer valor que coincida con el valor
indicado en el par√°metro PATRN.
‚óè Si CMD = 2, la instrucci√≥n busca "TBL_FIND" el primer valor que no coincida con el valor
indicado en el par√°metro PATRN .
‚óè La primera entrada de la tabla indica la longitud m√°xima de la tabla.
‚óè La segunda entrada de la tabla contiene el primer valor de la tabla.
Nota
Debe inicializarse la primera entrada (longitud) de la tabla.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "TBL_FIND":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SRC

Input

*Puntero

I, Q, M, D

Apunta a la direcci√≥n inicial de la tabla.

PATRN

Input

*Puntero

I, Q, M, D

Apunta a la expresi√≥n que se desea buscar.

CMD

Input

BYTE

I, Q, M, D, L, P

Indica el comando:
‚óè B#16#01 = igual
‚óè B#16#02 = diferente

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6205

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

E_TYPE

Input

BYTE

I, Q, M, D, L, P

Indica el tipo de datos de las entradas de la
tabla:
B#16#02 = BYTE
B#16#04= WORD
B#16#05=INT
B#16#06=DWORD
B#16#07=DINT
B#16#08=REAL

RET_VAL

Return

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000 si la operaci√≥n se
ha llevado a cabo sin errores.

INDX

InOut

WORD

I, Q, M, D, L

√çndice de la tabla, que contiene la siguiente
informaci√≥n:
‚óè Entrada: N√∫mero de la entrada por la que
se debe iniciar la b√∫squeda.
‚óè Salida: N√∫mero de la entrada que coincide
con el patr√≥n especificado.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Si se cumple una de las siguientes condiciones, los valores de la tabla no se modifican. El
estado l√≥gico de "BR/ENO" se ajusta a "0" y el valor de retorno se ajusta como corresponde:
RET_VAL

Explicaci√≥n

W#16#0007

El valor del par√°metro INDX es mayor que el valor de longitud de la tabla.

W#16#0008

No se ha encontrado ninguna coincidencia.

W#16#0009

El par√°metro E_TYPE y/o CMD es/son v√°lido(s).

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "TBL_FIND" se ejecuta. En
el ejemplo, los datos de la tabla se guardan en palabras que empiezan en la direcci√≥n a la que
apunta el par√°metro SRC , porque el par√°metro E_TYPE es igual a "4". Estas palabras se
comparan con la expresi√≥n "5555", que se guarda en la direcci√≥n indicada por el par√°metro
PATRN . Dado que CMD = 1, se busca el primer valor del par√°metro SRC que coincide con la
expresi√≥n. El par√°metro INDX apunta a la direcci√≥n en la que se desea iniciar la b√∫squeda.
Una vez procesada la operaci√≥n, el par√°metro INDX indica el n√∫mero de la entrada de la tabla
en la que se ha encontrado una coincidencia con la expresi√≥n.
Si la instrucci√≥n "TBL_FIND" se ejecuta sin errores, los estados l√≥gicos de ENO y Q 0.0 se
ajustan a "1", y RET_VAL se ajusta al valor W#16#0000.
La instrucci√≥n "MOVE" se utiliza √∫nicamente para restablecer el valor de "MW2" en cada ciclo.

6206

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

,


029(

7%/B),1'

(1

(12

,1

287

(1

4

(12

0:

3'%'%;
3'%'%;
%
%
0:

65& 5(7B9$/
3$751
&0'
(B7<3(

0:

,1';

Antes de la ejecuci√≥n:
SRC (longitud de tabla)

DBW0 = W#16#0004
DBW2 = W#16#1111
DBW4 = W#16#3333
DBW6 = W#16#5555

La primera entrada de la tabla indica la
longitud de la operaci√≥n de b√∫squeda. El
valor 0004 indica que se examinar√°n las
cuatro pr√≥ximas entradas.

DBW8 = W#16#7777
INDX

MW2 = W#16#0000

PATRN

DBW10 = W#16#5555

INDX se transfiere de DW0 (antes del
procesamiento) a DW6 (despu√©s del pro‚Äê
cesamiento), porque la expresi√≥n de
DW6 es igual a la expresi√≥n de 5555 de
PATRN .

Despu√©s de la ejecuci√≥n:
INDX

MW2 = W#16#0003

LIFO: Emitir √∫ltimo valor de la tabla
Descripci√≥n
Esta instrucci√≥n devuelve la entrada m√°s reciente de la tabla "LIFO" como valor de funci√≥n. El
n√∫mero se entrada se reduce en 1. La tabla "LIFO" est√° compuesta de palabras. Con la
instrucci√≥n "ATT (P√°gina 6202)" se pueden introducir valores en la tabla "LIFO".
‚óè La primera entrada de la tabla indica el n√∫mero m√°ximo admisible de entradas de la tabla
(longitud de la tabla).
‚óè La segunda entrada de una tabla indica el n√∫mero de entradas que contiene la tabla.
‚óè La tercera entrada de la tabla contiene la primera palabra de datos.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6207

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "LIFO":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

TABLE

Input

*Puntero

I, Q, M, D

Apunta a la direcci√≥n inicial de la tabla
"LIFO".

RET_VAL

Return

WORD

I, Q, M, D, L, P

La entrada m√°s reciente de la tabla "LI‚Äê
FO".

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Si la tabla "LIFO" est√° vac√≠a (n√∫mero de entradas = 0), RET_VAL no se modifica y el estado
l√≥gico de "BR/ENO" se ajusta a "0".

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "LIFO" se ejecuta. En el
ejemplo, se emite la entrada m√°s reciente de la tabla "LIFO" como valor de funci√≥n (MW 2.0).
El n√∫mero de entradas se reduce de 5 a 4.
Si "LIFO" se ejecuta sin errores, los estados l√≥gicos de "ENO" y Q 0.0 se ajustan a "1".
/,)2
,
3'%'%;

4
(1

(12

7$%/(
5(7B9$/

0:

Antes de la ejecuci√≥n:
TABLE (longitud de tabla)

DBW10 = W#16#0006

N√∫mero de entradas

DBW12 = W#16#0005
DBW14 = W#16#0012
DBW16 = W#16#0029
DBW18 = W#16#0090
DBW20 = W#16#0002
DBW22 = W#16#0024
DBW24 = W#16#0000

RET_VAL

6208

MW2 = W#16#0000

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Despu√©s de la ejecuci√≥n:
TABLE (longitud de tabla)

DBW10 = W#16#0006

N√∫mero de entradas

DBW12 = W#16#0004
DBW14 = W#16#0012
DBW16 = W#16#0029
DBW18 = W#16#0090
DBW20 = W#16#0002
DBW22 = W#16#0024
DBW24 = W#16#0000

RET_VAL

MW2 = W#16#0024

TBL: Ejecutar operaci√≥n de tabla
Descripci√≥n
Esta instrucci√≥n ejecuta la operaci√≥n indicada (par√°metro CMD) con la tabla de origen y
guarda el resultado en la misma entrada de la tabla.
‚óè La primera entrada de la tabla indica el n√∫mero m√°ximo admisible de entradas de la tabla
(longitud de la tabla).
‚óè La segunda entrada de la tabla contiene el primer valor de la tabla.
‚óè Si el par√°metro E_TYPE se ajusta a REAL , el valor de CMD no es v√°lido para el
complemento a 1.
Nota
Al crear la tabla debe inicializarse la primera entrada.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "TBL":
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

SRC

Input

*Puntero

I, Q, M, D

Apunta a la direcci√≥n inicial de la tabla.

CMD

Input

BYTE

I, Q, M, D, L, P

Indica la operaci√≥n que se desea ejecutar. Son
v√°lidas las siguientes operaciones:
B#16#03 = Complemento a 1
B#16#04 = Borrar
B#16#05 = Negar
B#16#06 = Ra√≠z cuadrada

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6209

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos √Årea de memoria

Descripci√≥n

E_TYPE

Input

BYTE

Indica el tipo de datos de las entradas de la tabla.
Son posibles los siguientes tipos de datos:

I, Q, M, D, L, P

B#16#04 = WORD
B#16#05 = INT
B#16#06 = DWORD
B#16#07 = DINT
B#16#08 = REAL
RET_VAL

Return

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000 si la operaci√≥n se ha
llevado a cabo sin errores.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Si el par√°metro CMD o el par√°metro E_TYPE no son v√°lidos y/o el par√°metro CMD y el
par√°metro E_TYPE no coinciden, los valores de la tabla no se modificar√°n. El estado l√≥gico de
BR/ENO se ajusta a "0" y RET_VAL se ajusta al valor W#16#0008 :

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "TBL" se ejecuta. En el
ejemplo, el par√°metro SRC apunta a la direcci√≥n, dentro del bloque de datos, que la operaci√≥n
debe procesar. Dado que el par√°metro E_TYPE = 4, los datos de la tabla se guardan en las
palabras que empiezan en la direcci√≥n indicada por el par√°metro SRC. Dado que CMD = 4
(borrar), cuando se ejecuta la instrucci√≥n TBL se borran (se ajustan a "0") todas las palabras
de la tabla. Dado que en la primera entrada de la tabla se indica una longitud de "5", se borran
las cinco primeras direcciones de la tabla.
Si la instrucci√≥n "TBL" se ejecuta sin errores, los estados l√≥gicos de ENO y Q 0.0 se ajustan
a "1", y RET_VAL se ajusta al valor W#16#0000.
7%/
4

,

(1

3'%'%;
%
%

6210

65&
&0'
(B7<3(

(12
5(7B9$/

0:

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Antes de la ejecuci√≥n:
SRC (longitud de tabla)

DBW0 = W#16#0005
DBW2 = W#16#2000
DBW4 = W#16#3000
DBW6 = W#16#4000
DBW8 = W#16#5000
DBW10 = W#16#6000

Despu√©s de la ejecuci√≥n:
SRC (longitud de tabla)

DBW0 = W#16#0005
DBW2 = W#16#0000
DBW4 = W#16#0000
DBW6 = W#16#0000
DBW8 = W#16#0000
DBW10 = W#16#0000

TBL_WRD: Copiar valor de la tabla
Descripci√≥n
La instrucci√≥n "TBL_WRD" (Copiar valor de la tabla) copia de la tabla SRC en la salida DEST
la entrada que se indica en el par√°metro INDX. Al hacerlo, el valor de INDX se incrementa, si
es inferior a la longitud m√°xima que se indica en la primera palabra de la tabla (SRC[0]). Si el
par√°metro INDX indica la √∫ltima entrada de la tabla, el bit de la salida se ajusta a "0" despu√©s
de la ejecuci√≥n.
‚óè La primera entrada de la tabla indica el n√∫mero m√°ximo admisible de entradas de la tabla
(longitud de la tabla).
‚óè La segunda entrada de la tabla contiene el primer valor de la tabla.
Nota
Al crear la tabla debe inicializarse la primera entrada.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "TBL_WRD":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SRC

Input

*Pointer

I, Q, M, D

Apunta a la direcci√≥n inicial de la tabla.

DEST

Input

*Pointer

I, Q, M, D

Apunta a la direcci√≥n inicial del elemento de
destino.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6211

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

E_TYPE

Input

BYTE

I, Q, M, D, L, P

Indica el tipo de datos de las entradas de la
tabla. Son posibles los siguientes tipos de da‚Äê
tos:
‚óè B#16#04 = WORD
‚óè B#16#05 = INT
‚óè B#16#06 = DWORD
‚óè B#16#07 = DINT
‚óè B#16#08 = REAL

RET_VAL

Return

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000si la operaci√≥n se
ha llevado a cabo sin errores.

Q

Output

BOOL

Q, M, D, L

Indica el valor "0" si, al llamar "TBL_WRD", la
variable INDXcontiene el √∫ltimo valor de la ta‚Äê
bla.

INDX

InOut

WORD

I, Q, M, L

N√∫mero de la entrada que se desea copiar.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Si se cumple una de las siguientes condiciones, "TBL_WRD" no se ejecuta. El estado l√≥gico de
ENO se ajusta a "0" y el valor de retorno se ajusta como corresponde:
RET_VAL

Explicaci√≥n

W#16#0007

El √≠ndice es igual a "0".

W#16#0008

E_TYPE no es v√°lido.

W#16#0009

El √≠ndice se encuentra fuera del rango de la tabla.

Ejemplo
Con estado l√≥gico de la entrada I 0.0 = "1" (activado), se ejecuta "TBL_WRD". Dado que en el
ejemplo E_TYPE = 4, en la entrada indicada por el par√°metro DEST se copia una palabra de
datos que se guarda en la entrada de la tabla a la que apunta el par√°metro SRC. El valor de
INDX apunta a la entrada de la tabla que se desea copiar. Una vez ejecutada correctamente
"TBL_WRD", el valor de INDX se incrementa autom√°ticamente en una entrada. Si, al llamar
TBL_WRD, el par√°metro INDX no contiene la √∫ltima entrada de la tabla, la salida del par√°metro
ENO se ajusta a "1" despu√©s de la ejecuci√≥n.
Si "TBL_WRD" se ejecuta sin errores, el estado l√≥gico de ENO se ajusta a "1" y RET_VAL se
ajusta al valor W#16#0000.

6212

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
7%/B:5'
4

,

(1

3'%'%;
3'%'%;
%
0:

65&
'(67

(12
5(7B9$/
4

0:
0

(B7<3(
,1';

Antes de la ejecuci√≥n:
SRC (longitud de tabla)

DBW0 = W#16#0004
DBW2 = W#16#2000
DBW4 = W#16#3000
DBW6 = W#16#4000
DBW8 = W#16#5000

INDX

MW1 = W#16#0001

DEST

DBW20 = W#16#0000

Antes de la ejecuci√≥n:
INDX

MW1 = W#16#0002

DEST

DBW20 = W#16#2000

WRD_TBL: Combinar un valor l√≥gicamente con un elemento de la tabla y guardarlo
Descripci√≥n
Esta instrucci√≥n ejecuta la operaci√≥n indicada (par√°metro CMD) con el elemento de origen y
la entrada de la tabla en el offset que se indica en el par√°metro INDX. La operaci√≥n solo se
ejecuta mientras el par√°metro INDX sea menor que la longitud de la tabla, que se guarda en
la primera palabra de la tabla.
‚óè La primera entrada de la tabla indica el n√∫mero m√°ximo admisible de entradas de la tabla
(longitud de la tabla).
‚óè La segunda entrada de la tabla contiene el primer valor de la tabla.
‚óè Si el par√°metro E_TYPE es del tipo de datos REAL, el par√°metro CMD solo puede ser
"Transferir".
Nota
Al crear la tabla debe inicializarse la primera entrada.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6213

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "WRD_TBL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SRC

Input

*Puntero

I, Q, M, D

Apunta a los datos de origen

TABLE

Input

*Puntero

I, Q, M, D

Apunta al inicio de la tabla.

CMD

Input

BYTE

I, Q, M, D, L, P

Apunta a la operaci√≥n que se desea ejecu‚Äê
tar. Son posibles las siguientes operaciones:
B#16#0E = Transferir
B#16#07 = Operaci√≥n l√≥gica Y
B#16#08 = Operaci√≥n l√≥gica O
B#16#09 = Operaci√≥n l√≥gica O-exclusiva

E_TYPE

Input

BYTE

I, Q, M, D, L, P

Indica el tipo de datos de las entradas de la
tabla. Son posibles los siguientes tipos de
datos:
B#16#04 = WORD
B#16#05 = INT
B#16#06 = DWORD
B#16#07 = DINT
B#16#08 = REAL

RET_VAL

Return

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000 si la operaci√≥n se
ha llevado a cabo sin errores

Q

Output

BOOL

Q, M, D, L

Indica el valor "0" si la variable del par√°me‚Äê
tro INDX contiene el n√∫mero de la √∫ltima en‚Äê
trada de la tabla.

INDX

InOut

WORD

I, Q, M, D, L

N√∫mero de la entrada con la que se desea
ejecutar la operaci√≥n.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Si se cumple una de las siguientes condiciones, la instrucci√≥n "WRD_TBL" no se ejecuta. El
estado l√≥gico de ENO se ajusta a "0" y el valor de retorno se ajusta como corresponde:
RET_VAL

Explicaci√≥n

W#16#0007

El √≠ndice es igual a 0.

W#16#0008

El par√°metro CMD o el par√°metro E_TYPE no son v√°lidos o el par√°metro CMD y el par√°metro E_TYPE no
coinciden.

W#16#0009

El √≠ndice se encuentra fuera del rango de la tabla.

6214

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "WRD_TBL" se ejecuta.
Dado que, en el ejemplo, el par√°metro E_TYPE es igual a "6", la palabra doble de los datos de
la tabla se guarda en la direcci√≥n a la que apunta el par√°metro TABLE . La primera palabra de
la tabla indica que la tabla contiene tres palabras dobles. El valor de INDX apunta a la entrada
de la tabla que se desea procesar. Dado que CMD = 8, se ejecuta una operaci√≥n l√≥gica O con
el valor al que apunta el par√°metro INDX . Dado que INDX = 2, la segunda palabra (66665544)
se combina mediante operaci√≥n l√≥gica O con el valor al que apunta el par√°metro SRC
(11111111). Una vez ejecutada la operaci√≥n, el resultado de la operaci√≥n l√≥gica O (77775555)
se escribe en la tabla, y el valor de INDX se incrementa autom√°ticamente en una entrada. Si
el par√°metro INDX apunta a la √∫ltima entrada de una tabla, el bit de la salida "Q" se ajusta a "0"
despu√©s de la ejecuci√≥n de la operaci√≥n. En el ejemplo, el valor de INDX no contiene la √∫ltima
entrada de la tabla, por lo que la salida "Q" se ajusta a "1" despu√©s de la ejecuci√≥n.
Si la instrucci√≥n "WRD_TBL" se ejecuta sin errores, los estados l√≥gicos de ENO y Q 0.0 se
ajustan a "1", y RET_VAL se ajusta al valor W#16#0000.
:5'B7%/
4

,

(1

3'%'%;
3'%'%;
%
%
0:

65&
7$%/(

(12
5(7B9$/

0:

4

0

&0'
(B7<3(
,1';

Antes de la ejecuci√≥n:
SRC

DBD20 = DW#16#11111111

TABLE (longitud de tabla)

DBW0 = W#16#0003
DBD2 = DW#16#99998877
DBD6 = DW#16#66665544
DBD10 = DW#16#33332222

INDX

MW1 = W#16#0002

Despu√©s de la ejecuci√≥n:
TABLE (longitud de tabla)

DBW0 = W#16#0003
DBD2 = DW#16#99998877
DBD6 = DW#16#77775555
DBD10 = DW#16#33332222

INDX

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

MW1 = W#16#0003

6215

Instrucciones
4.2 Instrucciones

DEV: Calcular desviaci√≥n est√°ndar
Descripci√≥n
La instrucci√≥n calcula la desviaci√≥n est√°ndar de un grupo de valores guardados en una tabla
(instrucci√≥n "TBL (P√°gina 6209)"). El resultado se guarda en OUT . La desviaci√≥n est√°ndar se
calcula con la siguiente f√≥rmula:
'HVYLDFL¬µQHVW¬£QGDU 

1 6XPD&X 6XPD



1  1

Donde:
‚óè Suma = suma de los valores de la instrucci√≥n "TBL (P√°gina 6209)"
‚óè N= n√∫mero de valores de la instrucci√≥n "TBL (P√°gina 6209)"
‚óè SumaCu = suma de todos los valores de la instrucci√≥n "TBL (P√°gina 6209)" al cuadrado
Todos los c√°lculos utilizan valores en coma flotante IEEE, y en caso necesario la instrucci√≥n
"DEV" convierte autom√°ticamente los tipos de datos.
‚óè La primera entrada de la tabla indica el n√∫mero de entradas (longitud de la tabla).
‚óè La segunda entrada de la tabla contiene el primer valor de la tabla.
‚óè El tama√±o de las entradas de la tabla y el valor calculado (par√°metro OUT) se definen en
el par√°metro E_TYPE.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "DEV":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

TBL

Input

*Puntero

I, Q, M, D

**Apunta a la direcci√≥n inicial de la tabla con
los valores.

OUT

Input

*Puntero

I, Q, M, D

**Apunta a la direcci√≥n que contiene el valor
calculado para la desviaci√≥n est√°ndar.

E_TYPE

Input

BYTE

I, Q, M, D, L, P

Indica el tipo de datos de las entradas de la
tabla. Son v√°lidos los siguientes tipos de datos:
B#16#05 = INT
B#16#07 = DINT
B#16#08 = REAL

RET_VAL

Return

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000 si la operaci√≥n se
ha llevado a cabo sin errores.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas
** Los bloques de datos de origen y destino deben ser id√©nticos

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6216

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
Si se cumple una de las siguientes condiciones, la instrucci√≥n "DEV" no se ejecuta. El estado
l√≥gico de BR/ENO se ajusta a "0" y el valor de retorno se ajusta como corresponde:
RET_VAL

Explicaci√≥n

W#16#0001

Se ha indicado un √°rea de memoria no v√°lida para un par√°metro de "DEV".

W#16#0002

El par√°metro E_TYPE no es v√°lido.

W#16#0004

La longitud de la tabla es igual a cero.

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "DEV" se ejecuta. En el
ejemplo hay cinco valores de la tabla. As√≠ lo indica la primera palabra de la tabla. Los valores
de la tabla son del tipo de datos REAL. As√≠ lo indica el par√°metro E_TYPE.
Si la instrucci√≥n "DEV" se ejecuta sin errores, los estados l√≥gicos de ENO y Q 0.0 se ajustan
a "1", y RET_VAL se ajusta a "W#16#0000".
'(9
4

,

(1

3'%'%;

7%/

3'%'%;

287

%

(12
5(7B9$/

0:

(B7<3(

Antes de la ejecuci√≥n:
TBL (longitud de tabla)

DBW100 = W#16#0005
DBD102 = 2.0
DBD106 = 4.0
DBD110 = 8.0
DBD114 = 16.0
DBD118 = 32.0

OUT

DBD130 = 0.0

Despu√©s de la ejecuci√≥n:
OUT

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

DBD130 = 12.19836055

6217

Instrucciones
4.2 Instrucciones

CDT: Tablas de datos correlativas
Descripci√≥n
Esta instrucci√≥n compara un valor de entrada (par√°metro IN) con una tabla ya existente con
valores de entrada (par√°metro IN_TBL) y busca el primer valor mayor o igual que el valor de
entrada. Tras ello, usando el √≠ndice del valor encontrado, se copia el valor en el valor de salida
correspondiente (par√°metro OUT) en la tabla de valores de salida (par√°metro OUT_TBL).
‚óè Los valores de la tabla de entrada deben estar consignados en orden ascendente. Es decir:
el valor m√°s bajo se encuentra en la primera entrada de la tabla, y el mayor en la √∫ltima.
‚óè El tama√±o del valor de entrada, los valores de la tabla y los valores de salida se definen en
el par√°metro E_TYPE.
‚óè La primera entrada de la tabla indica el n√∫mero de entradas (longitud de la tabla).
‚óè La segunda entrada de la tabla contiene el primer valor de la tabla.
‚óè El n√∫mero de entradas debe ser id√©ntico en las dos tablas y mayor que cero.
Nota
Al crear las tablas debe inicializarse en cada una la primera entrada.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "CDT":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IN_TBL

Input

*Puntero

I, Q, M, D

Apunta al inicio de la tabla de entrada.

OUT_TBL

Input

*Puntero

I, Q, M, D

Apunta al inicio de la tabla de salida.

IN

Input

*Puntero

I, Q, M, D

Apunta a la tabla de entrada.

OUT

Input

*Puntero

I, Q, M, D

Apunta a la tabla de salida.

E_TYPE

Input

BYTE

I, Q, M, D, L, P

Indica el tipo de datos de las entradas de la
tabla. Son v√°lidos los siguientes tipos de da‚Äê
tos:
B#16#05 = INT
B#16#07 = DINT
B#16#08 = REAL

RET_VAL

Return

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000 si la operaci√≥n se
ha llevado a cabo sin errores.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

6218

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
Si se cumple una de las siguientes condiciones, CDT no se ejecuta. El estado l√≥gico de BR/
ENO se ajusta a "0" y el valor de retorno se ajusta como corresponde:
RET_VAL

Explicaci√≥n

W#16#0001

Se ha indicado un √°rea de memoria no v√°lida para un par√°metro de CDT .

W#16#0002

El par√°metro E_TYPE no es v√°lido.

W#16#0003

Las longitudes de las tablas de entrada y de salida no coinciden.

W#16#0004

La tabla tiene una longitud igual a cero.

W#16#0007

El par√°metro IN_TBL no contiene ning√∫n valor mayor o igual que el valor de entrada.

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "CDT" se ejecuta. En el
ejemplo, los par√°metros IN_TBL y OUT_TBL contienen cada uno cinco entradas de tabla. As√≠
lo indica la primera palabra de cada una de las tablas. El tipo de datos de los valores de la tabla
es INTEGER. As√≠ lo indica el par√°metro E_TYPE. El valor del par√°metro IN es 22. El valor del
par√°metro IN_TBL, mayor o igual que "22", es "64", a lo que corresponde el √≠ndice "5". El valor
correspondiente de OUT_TBL es "25". Por eso el valor "25" se escribe en el par√°metro OUT.
Si la instrucci√≥n "CDT" se ejecuta sin errores, los estados l√≥gicos de ENO y Q 0.0 se ajustan
a "1", y RET_VAL se ajusta a W#16#0000 .
&'7
,
3'%'%;

4
(1
,1B7%/

3'%'%;

287B7%/

3'%'%;
3'%'%;
%

,1
287
(B7<3(

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

(12
5(7B9$/

0:

6219

Instrucciones
4.2 Instrucciones
Antes de la ejecuci√≥n:
IN_TBL (longitud de tabla)

DBW0 = W#16#0005
DBW2 = 2
DBW4 = 4
DBW6 = 8
DBW8 = 16
DBW10 = 64

OUT_TBL (longitud de tabla)

DBW100 = W#16#0005
DBW102 = 5
DBW104 = 10
DBW106 = 15
DBW108 = 20
DBW110 = 25

IN

DBW200 = 22

OUT

DBW210 = 0

Despu√©s de la ejecuci√≥n:
OUT

DBW210 = 25

TBL_TBL: Enlazar tablas
Descripci√≥n
Esta instrucci√≥n ejecuta el comando indicado en el par√°metro CMD con las correspondientes
entradas de las dos tablas de origen (par√°metros TBL1 y TBL2) y escribe el resultado en las
correspondientes entradas de la tabla de destino (DEST_TBL).
‚óè Los tipos de datos INT, DINT y REAL solo son v√°lidos para operaciones aritm√©ticas.
‚óè La primera entrada de la tabla indica el n√∫mero de entradas (longitud de la tabla).
‚óè El n√∫mero de entradas debe ser en todas las tablas igual o mayor que cero.
Nota
Al crear las tablas debe inicializarse en cada una la primera entrada.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "TBL_TBL":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

TBL1

Input

*Puntero

I, Q, M, D

Apunta al inicio de la primera tabla de origen.

TBL2

Input

*Puntero

I, Q, M, D

Apunta al inicio de la segunda tabla de origen.

DEST_TBL

Input

*Puntero

I, Q, M, D

Apunta al inicio de la tabla de destino.

6220

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

CMD

Input

BYTE

I, Q, M, D, L, P

Indica el comando que se va a ejecutar: Son
v√°lidos los siguientes comandos:
B#16#07 = Operaci√≥n l√≥gica Y
B#16#08 = Operaci√≥n l√≥gica O
B#16#09 = Operaci√≥n l√≥gica O-exclusiva
B#16#0a = Sumar
B#16#0b = Restar
B#16#0c = Multiplicar
B#16#0d = Dividir

E_TYPE

Input

BYTE

I, Q, M, D, L, P

Indica el tipo de datos de las entradas de la
tabla. Son v√°lidos los siguientes tipos de datos:
B#16#04 = WORD
B#16#05 = INT
B#16#06 = DWORD
B#16#07 = DINT
B#16#08 = REAL

RET_VAL

Return

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000 si la operaci√≥n se
ha llevado a cabo sin errores.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
Si se cumple una de las siguientes condiciones, la instrucci√≥n "TBL_TBL" no se ejecuta. El
estado l√≥gico de BR/ENO se ajusta a "0" y el valor de retorno se ajusta como corresponde:
RET_VAL

Explicaci√≥n

W#16#0001

Se ha indicado un √°rea de memoria no v√°lida para un par√°metro de la instrucci√≥n "TBL_TBL".

W#16#0002

El par√°metro E_TYPE no es v√°lido.

W#16#0003

Las longitudes de las tablas de entrada y salida no coinciden.

W#16#0004

La tabla tiene una longitud igual a cero.

W#16#0005

Los par√°metros E_TYPE y CMD no coinciden.

W#16#0006

El par√°metro CMD no es v√°lido

Ejemplo (KOP)
Con estado l√≥gico en la entrada I 0.0 = 1 (activado), la instrucci√≥n "TBL_TBL" se ejecuta. En
el ejemplo, todas las tablas contienen tres entradas cada una. As√≠ lo indica la primera palabra
de cada una de las tablas. El tipo de datos de los valores de la tabla es WORD. As√≠ lo indica
E_TYPE. CMD emite el comando con el que deben enlazarse TBL1 y TBL2 .
Si la instrucci√≥n "TBL_TBL" se ejecuta sin errores, los estados l√≥gicos de ENOy Q 0.0 se
ajustan a "1", y RET_VAL se ajusta al valor W#16#0000.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6221

Instrucciones
4.2 Instrucciones
7%/B7%/
,
3'%'%;

4
(1

(12
5(7B9$/

7%/

3'%'%;

7%/

3'%'%;
%
%

'(67B7%/
&0'
(B7<3(

0:

Antes de la ejecuci√≥n:
TBL1 (longitud de tabla)

DBW0 = W#16#0003
DBW2 = W#16#00FF
DBW4 = W#16#FF00
DBW6 = W#16#FFFF

TBL2 (longitud de tabla)

DBW20 = W#16#0003
DBW22 = W#16#1111
DBW24 = W#16#2222
DBW26 = W#16#3333

DEST_TBL (longitud de tabla)

DBW40 = W#16#0003
DBW42 = W#16#0000
DBW44 = W#16#0000
DBW46 = W#16#0000

Despu√©s de la ejecuci√≥n:
DST_TBL (longitud de tabla)

DBW40 = W#16#0003
DBW42 = W#16#0011
DBW44 = W#16#2200
DBW46 = W#16#3333

PACK: Recoger/distribuir datos de tabla
Descripci√≥n
Esta instrucci√≥n transfiere datos que se encuentran entre un conjunto cualquiera de
direcciones y una tabla. El sentido de la transferencia se define en el par√°metro DIR . Cada
operaci√≥n de la instrucci√≥n "PACK" procesa como m√°ximo cinco bloques con datos de
(P_DATA1 a P_DATA5). Si el par√°metro DIR contiene el valor "hacia", la instrucci√≥n "PACK"
transfiere datos de las direcciones a la tabla indicada. Si el par√°metro DIRcontiene el valor
"desde", los datos se distribuyen desde la tabla a las direcciones indicadas.

6222

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Normas para la transferencia de datos "hacia" una tabla:
‚óè Los bits individuales (BOOL) se transfieren al pr√≥ximo bit disponible de la tabla.
‚óè Los tipos de datos de 8 bits se transfieren al pr√≥ximo byte disponible de la tabla. Cuando se
escribe un byte en la tabla, los bits no utilizados del byte anterior se rellenan con ceros.
‚óè Los tipos de datos de 16 y 32 bits se transfieren a la pr√≥xima palabra disponible de la tabla.
Cuando se escribe una palabra en la tabla, los bits no utilizados de la palabra anterior se
rellenan con ceros.
Normas para la transferencia de datos "desde" una tabla:
‚óè No debe omitirse secci√≥n alguna de la tabla.
‚óè Todos los datos indicados del tipo de datos BOOL se transfieren desde la tabla.
‚óè Los tipos de datos de 8 bits se transfieren desde el primer byte disponible de la tabla. Por
eso, el byte que se transfiere desde la tabla no contiene bits no utilizados del byte anterior
de la tabla.
‚óè Los tipos de datos de 16 y 32 bits se transfieren desde la primera palabra disponible de la
tabla. En consecuencia, la palabra que se transfiere desde la tabla no contiene bits no
utilizados de la palabra anterior de la tabla.
Tipos de datos v√°lidos para el puntero ANY y soportados por "PACK": BOOL, WORD, INT,
BYTE, DINT, REAL, CHAR, DWORD.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "PACK":
Par√°metros

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

TABLE

Input

*Puntero

I, Q, M, D

Apunta al inicio de la tabla.

P_DATA1

Input

ANY

I, Q, M, D

Apunta al inicio del bloque cuyos datos se
desean transferir.

P_DATA2

Input

ANY

I, Q, M, D

Apunta al inicio del bloque cuyos datos se
desean transferir.

P_DATA3

Input

ANY

I, Q, M, D

Apunta al inicio del bloque cuyos datos se
desean transferir.

P_DATA4

Input

ANY

I, Q, M, D

Apunta al inicio del bloque cuyos datos se
desean transferir.

P_DATA5

Input

ANY

I, Q, M, D

Apunta al inicio del bloque cuyos datos se
desean transferir.

ERR_CODE

Output

WORD

I, Q, M, D, L, P

Emite el valor W#16#0000si la operaci√≥n se
ha llevado a cabo sin errores.

DIR

Static

BOOL

I, Q, M, D, L

Sentido de la transferencia. Son posibles los
siguientes estados l√≥gicos: 0=hacia, 1=des‚Äê
de.

* Puntero en formato de palabra doble para el direccionamiento indirecto por registro abarcando varias √°reas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6223

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
Si se cumple una de las siguientes condiciones de error, la instrucci√≥n "PACK" no se ejecuta.
El estado l√≥gico de BR/ENO se ajusta a "0" y el ERR_CODE se ajusta como corresponde:
ERR_CODE

Explicaci√≥n

W#16#0001

Se ha indicado un √°rea de memoria no v√°lida para un par√°metro de la instrucci√≥n "PACK".

W#16#0002

La instrucci√≥n "E_TYPE" no es v√°lida.

Ejemplo (KOP)
Con estado l√≥gico de la entrada I 0.0 = 1 (activado), se ejecuta "PACK". En el ejemplo se
transfieren cuatro bloques con datos "hacia" la tabla.
Si la instrucci√≥n "PACK" se ejecuta sin errores, los estados l√≥gicos de ENOy O 0.0 se ajustan
a "1", y ERR_CODE se ajusta a "W#16#0000".
Nota
Los par√°metros est√°ticos pueden inicializarse con ayuda del editor de bloques de datos.
3$&.B'%
3$&.
4

,

(1

3'%'%;
30%22/
30%<7(
30%22/
30:25'

7$%/(

(12
(55B&2'(

0:

3B'$7$
3B'$7$
3B'$7$
3B'$7$
3B'$7$

Antes de la ejecuci√≥n:
TABLE

DBB0 = B#16#00
DBB1 = B#16#00
DBB2 = B#16#00
DBB3 = B#16#00
DBB4 = B#16#00
DBB5 = B#16#00

P_DATA1

M 200.0 = TRUE
M 200.1 = TRUE

P_DATA2

MB210 = B#16#FF

P_DATA3

M 300.0 = TRUE
M 300.1 = TRUE

P_DATA4

6224

MW330 = W#16#FFFF

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
DB de instancia
PACK_DB
DIR

DBX58.0 = FALSE

Despu√©s de la ejecuci√≥n:
TABLE

DBB0 = B#16#03
DBB1 = B#16#FF
DBB2 = B#16#03
DBB3 = B#16#00
DBB4 = B#16#FF
DBB5 = B#16#FF

4.2.3.12

Direccionamiento

GEO_LOG: Determinar la direcci√≥n inicial de un m√≥dulo
Descripci√≥n
Supongamos que se conoce el slot de m√≥dulo correspondiente al canal de un m√≥dulo de se√±al.
La instrucci√≥n "GEO_LOG" permite determinar a partir de √©l la correspondiente direcci√≥n inicial
del m√≥dulo, es decir, la direcci√≥n I o Q m√°s baja.
Si se aplica la instrucci√≥n "GEO_LOG" a m√≥dulos de potencia o m√≥dulos con direcciones
comprimidas (ET 200S), se devuelve la direcci√≥n de diagn√≥stico.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6225

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "GEO_LOG":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

MASTER

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Identificaci√≥n de √°rea:
‚óè 0 si el slot se encuentra en una
configuraci√≥n centralizada: Racks de 0 a 3
(con S7-300) o de 0 a 21 (con S7-400)
‚óè de 1 a 32: ID de sistema maestro DP del
aparato de campo correspondiente, si el
slot se encuentra en un aparato de campo
conectado a PROFIBUS
‚óè de 100 a 115: ID de sistema PROFINET IO
del aparato de campo correspondiente, si
el slot se encuentra en un aparato de
campo conectado a PROFINET

STATION

Input

INT

I, Q, M, D, L o cons‚Äê
tante

‚óè N√∫mero del rack, si la identificaci√≥n de
√°rea = 0
‚óè N√∫mero de estaci√≥n del aparato de campo,
si la identificaci√≥n de √°rea > 0

SLOT

Input

INT

I, Q, M, D, L o cons‚Äê
tante

N√∫mero de slot

SUBSLOT

Input

INT

I, Q, M, D, L o cons‚Äê
tante

Slot de subm√≥dulo (si no puede insertarse nin‚Äê
g√∫n m√≥dulo, debe indicarse aqu√≠ 0)

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

LADDR

Output

WORD

I, Q, M, D, L

Direcci√≥n inicial del m√≥dulo
En el bit 15 de LADDR se especifica si se trata
de una direcci√≥n de entrada (bit 15 = 0) o de
salida (bit 15 = 1).

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8094

No est√° configurada ninguna subred con la SUBNETID indicada.

8095

Valor no v√°lido en el par√°metro STATION

8096

Valor no v√°lido en el par√°metro SLOT

8097

Valor no v√°lido en el par√°metro SUBSLOT

8099

El slot no est√° configurado.

6226

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
809A

La direcci√≥n de subm√≥dulo para el slot seleccionado no est√° configurada.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

LOG_GEO: Determinar el slot que corresponde a una direcci√≥n l√≥gica
Descripci√≥n
Esta instrucci√≥n permite determinar el slot correspondiente a una direcci√≥n l√≥gica, as√≠ como el
offset del √°rea de direcciones de datos √∫tiles del m√≥dulo.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "LOG_GEO":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

LADDR

Input

WORD

I, Q, M, D, L o constante Cualquier direcci√≥n l√≥gica del m√≥dulo
En el bit 15 se especifica si se trata de
una direcci√≥n de entrada (bit 15 = 0) o de
salida (bit 15 = 1).

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

AREA

Output

INT

I, Q, M, D, L

Identificaci√≥n de √°rea: Indica c√≥mo de‚Äê
ben interpretarse los par√°metros de sali‚Äê
da restantes.

MASTER

Output

INT

I, Q, M, D, L

Identificaci√≥n de √°rea:
‚óè 0 si el slot se encuentra en una
configuraci√≥n centralizada: Racks de
0 a 3 (con S7-300) o de 0 a 21 (con
S7-400)
‚óè de 1 a 32: ID de sistema maestro DP
del aparato de campo
correspondiente, si el slot se
encuentra en un aparato de campo
conectado a PROFIBUS
‚óè de 100 a 115: ID de sistema
PROFINET IO del aparato de campo
correspondiente, si el slot se
encuentra en un aparato de campo
conectado a PROFINET

STATION

Output

INT

I, Q, M, D, L

N.¬∫ del rack, si:
‚óè Identificaci√≥n de √°rea = 0
‚óè N√∫mero de estaci√≥n del aparato de
campo, si la identificaci√≥n de √°rea > 0

SLOT

Output

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

INT

I, Q, M, D, L

N√∫mero de slot

6227

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

SUBSLOT

Output

INT

I, Q, M, D, L

N√∫mero de subm√≥dulo

OFFSET

Output

INT

I, Q, M, D, L

Offset en el √°rea de direcciones de datos
√∫tiles del m√≥dulo correspondiente

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro AREA
Valor de AREA

Sistema

Significado de MASTER, STATION, SLOT, SUBSLOT y OFFSET

0

S7-400

MASTER: 0
STATION: n√∫mero de rack
SLOT: n√∫mero de slot
SUBSLOT: 0
OFFSET: diferencia entre la direcci√≥n l√≥gica y la direcci√≥n base l√≥gica

1

S7-300

MASTER: 0
STATION: n√∫mero de rack
SLOT: n√∫mero de slot
SUBSLOT: 0
OFFSET: diferencia entre la direcci√≥n l√≥gica y la direcci√≥n base l√≥gica

2

PROFIBUS DP

MASTER: ID del sistema maestro DP
STATION: n√∫mero de estaci√≥n
SLOT: n√∫mero de slot en la estaci√≥n
SUBSLOT: 0
OFFSET: offset en el √°rea de direcciones de datos √∫tiles del m√≥dulo co‚Äê
rrespondiente

PROFINET IO

MASTER: ID de sistema de PROFINET IO
STATION: n√∫mero de estaci√≥n
SLOT: n√∫mero de slot en la estaci√≥n
SUBSLOT: n√∫mero de subm√≥dulo
OFFSET: Offset en el √°rea de direcciones de datos √∫tiles del m√≥dulo
correspondiente

3

√Årea S5-P

MASTER: 0
STATION: n√∫mero de rack
SLOT: n√∫mero de slot de la c√°psula de adaptaci√≥n
SUBSLOT: 0
OFFSET: direcci√≥n en el √°rea S5-x

4

√Årea S5-Q

MASTER: 0
STATION: n√∫mero de rack
SLOT: n√∫mero de slot de la c√°psula de adaptaci√≥n
SUBSLOT: 0
OFFSET: direcci√≥n en el √°rea S5-x

5

√Årea S5-IM3

MASTER: 0
STATION: n√∫mero de rack
SLOT: n√∫mero de slot de la c√°psula de adaptaci√≥n
OFFSET: Direcci√≥n en el √°rea S5-x

6

√Årea S5-IM4

MASTER: 0
STATION: n√∫mero de rack
SLOT: n√∫mero de slot de la c√°psula de adaptaci√≥n
SUBSLOT: 0
OFFSET: direcci√≥n en el √°rea S5-x

6228

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error
(W#16#...)

Explicaci√≥n

0000

No ha ocurrido ning√∫n error.

8090

La direcci√≥n l√≥gica indicada no es v√°lida

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

RD_LGADR: Determinar todas las direcciones l√≥gicas de un m√≥dulo
Descripci√≥n
Se toma como punto de partida una direcci√≥n l√≥gica de un m√≥dulo, de un subm√≥dulo central
o de un subm√≥dulo en PNIO. La instrucci√≥n permite determinar todas las direcciones l√≥gicas
de ese m√≥dulo o subm√≥dulo. Es necesario que est√© configurada previamente la asignaci√≥n de
direcciones l√≥gicas a m√≥dulos o subm√≥dulos. La instrucci√≥n "RD_LGADR" introduce las
direcciones l√≥gicas determinadas en los par√°metros PEADDR o PAADDR en orden
ascendente.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "RD_LGADR":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IOID

Input

BYTE

I, Q, M, D, L o constante Identificador del √°rea de direcciones:
‚óè B#16#00: El bit 15 de LADDR indica si
se trata de una direcci√≥n de entrada (bit
15=0) o de salida (bit 15=1).
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)

LADDR

Input

WORD

I, Q, M, D, L o constante Una direcci√≥n l√≥gica

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

PEADDR

Output

ANY

I, Q, M, D, L

Campo para las direcciones PI; los elemen‚Äê
tos del campo deben ser del tipo de datos
WORD.

PECOUNT

Output

INT

I, Q, M, D, L

N√∫mero de direcciones PI devueltas

PAADDR

Output

ANY

I, Q, M, D, L

Campo para las direcciones PQ; los elemen‚Äê
tos del campo deben ser del tipo de datos
WORD.

PACOUNT

Output

INT

I, Q, M, D, L

N√∫mero de direcciones PQ devueltas

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6229

Instrucciones
4.2 Instrucciones

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

La direcci√≥n l√≥gica indicada no es v√°lida o se ha usado un valor no admisible en el par√°metro IOID

80A0

Error en el par√°metro de salida PEADDR: El tipo de datos de los elementos del campo no es WORD. (Este
c√≥digo de error solo existe con S7-400 y en la CPU 318.)

80A1

Error en el par√°metro de salida PAADDR: El tipo de datos de los elementos del campo no es WORD. (Este
c√≥digo de error solo existe con S7-400 y en la CPU 318.)

80A2

Error en el par√°metro de salida PEADDR: El campo indicado no ha podido alojar todas las direcciones
l√≥gicas.

80A3

Error en el par√°metro de salida PAADDR: El campo indicado no ha podido alojar todas las direcciones
l√≥gicas.

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

GADR_LGC: Determinar la direcci√≥n base l√≥gica de un m√≥dulo
Descripci√≥n
Supongamos que se conocen el slot y el offset del √°rea de direcciones de datos √∫tiles
correspondientes al canal de un m√≥dulo de se√±al. La instrucci√≥n "GADR_LGC" permite
determinar a partir de ellos la correspondiente direcci√≥n base l√≥gica base del m√≥dulo, es decir,
la direcci√≥n I o Q m√°s baja.
Si se aplica la instrucci√≥n "GADR_LGC" a m√≥dulos de potencia o m√≥dulos con direcciones
comprimidas (ET 200S), se devuelve la direcci√≥n de diagn√≥stico.

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "GADR_LGC":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

SUBNETID

Input

BYTE

I, Q, M, D, L o constante Identificaci√≥n de √°rea:

Descripci√≥n
‚óè 0 si el slot se encuentra en uno de los
racks 0 (aparato central) o de 1 a 21
(aparatos de ampliaci√≥n)
‚óè ID de sistema maestro DP del sistema
de periferia descentralizada
correspondiente, si el slot se encuentra
en un sistema de periferia
descentralizada

RACK

Input

WORD

I, Q, M, D, L o constante ‚óè N√∫mero del rack, si la identificaci√≥n de
√°rea es 0
‚óè N√∫mero de estaci√≥n del sistema de
periferia descentralizada, si la
identificaci√≥n de √°rea > 0

6230

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

SLOT

Input

WORD

I, Q, M, D, L o constante N√∫mero de slot

Descripci√≥n

SUBSLOT

Input

BYTE

I, Q, M, D, L o constante Slot de subm√≥dulo (si no puede insertarse
ning√∫n m√≥dulo, debe indicarse aqu√≠ 0)

SUBADDR

Input

WORD

I, Q, M, D, L o constante Offset en el √°rea de direcciones de datos
√∫tiles del m√≥dulo

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

IOID

Output

BYTE

I, Q, M, D, L

Identificador del √°rea de direcciones:
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
En los m√≥dulos mixtos, la instrucci√≥n de‚Äê
vuelve la identificaci√≥n de √°rea de la direc‚Äê
ci√≥n m√°s baja. Si las direcciones son igua‚Äê
les, la instrucci√≥n devuelve la identificaci√≥n
B#16#54.

LADDR

Output

WORD

I, Q, M, D, L

Direcci√≥n base l√≥gica del m√≥dulo

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8093

Valor no admisible en el par√°metro SUBNETID (la instrucci√≥n "GADR_LGC" no es admisible para PRO‚Äê
FINET IO).

8094

No est√° configurada ninguna subred con la SUBNETID indicada.

8095

Valor no v√°lido en el par√°metro RACK

8096

Valor no v√°lido en el par√°metro SLOT

8097

Valor no v√°lido en el par√°metro SUBSLOT

8098

Valor no v√°lido en el par√°metro SUBADDR

8099

El slot no est√° configurado.

809A

La subdirecci√≥n correspondiente al slot seleccionado no est√° configurada (posible solo con periferia
central para CPU e IM)

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6231

Instrucciones
4.2 Instrucciones

LGC_GADR: Determinar el slot que corresponde a una direcci√≥n l√≥gica
Descripci√≥n
Esta instrucci√≥n permite determinar el slot correspondiente a una direcci√≥n l√≥gica, as√≠ como el
offset del √°rea de direcciones de datos √∫tiles del m√≥dulo.
Nota
No es posible aplicar la instrucci√≥n "LGC_GADR" a un m√≥dulo con direcciones comprimidas
(ET 200S).

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "LGC_GADR":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

IOID

Input

BYTE

I, Q, M, D, L o constante Identificador del √°rea de direcciones:
‚óè B#16#00: El bit15 de LADDR indica si se
trata de una direcci√≥n de entrada
(bit15=0) o de salida (bit15=1).
‚óè B#16#54 = entrada de periferia (PI)
‚óè B#16#55 = salida de periferia (PQ)
Si se trata de un m√≥dulo mixto, debe indi‚Äê
carse la identificaci√≥n de √°rea de la direc‚Äê
ci√≥n m√°s baja. Si se trata de las mismas di‚Äê
recciones, debe indicarse B#16#54 .

LADDR

Input

WORD

I, Q, M, D, L o constante Direcci√≥n l√≥gica
Con un m√≥dulo mixto debe indicarse la di‚Äê
recci√≥n m√°s baja de las dos.

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

AREA

Output

BYTE

I, Q, M, D, L

Identificaci√≥n de √°rea: Indica c√≥mo deben
interpretarse los par√°metros de salida res‚Äê
tantes.

RACK

Output

WORD

I, Q, M, D, L

N√∫mero de rack

SLOT

Output

WORD

I, Q, M, D, L

N√∫mero de slot

SUBADDR

Output

WORD

I, Q, M, D, L

Offset en el √°rea de direcciones de datos
√∫tiles del m√≥dulo correspondiente.

6232

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".
Nota
Si se utiliza un sistema de automatizaci√≥n S7-400H en modo redundante y al llamar la
instrucci√≥n "LGC_GADR" se indica en el par√°metro LADDR la direcci√≥n l√≥gica de un m√≥dulo
de un esclavo DP conectado, se devuelve en el byte m√°s significativo del par√°metro RACK la
ID de sistema maestro DP del canal activo. Si no hay ning√∫n canal activo, se devuelve la ID del
correspondiente sistema maestro DP de la CPU maestra.

Par√°metro AREA
El par√°metro AREA indica c√≥mo deben interpretarse los par√°metros de salida RACK, SLOT y
SUBADDR . La tabla siguiente explica esa dependencia.
Valor de AREA

Sistema

Significado de RACK, SLOT y SUBADDR

0

S7-400

RACK : N√∫mero de rack
SLOT : N√∫mero de slot
SUBADDR : Diferencia entre la direcci√≥n l√≥gica y la direcci√≥n base l√≥gica

1

S7-300

RACK : N√∫mero de rack
SLOT : N√∫mero de slot
SUBADDR : Diferencia entre la direcci√≥n l√≥gica y la direcci√≥n base l√≥gica

2

DP

RACK : (byte menos significativo): N√∫mero de estaci√≥n
RACK : (byte m√°s significativo): ID del sistema maestro DP
SLOT : N√∫mero de slot en la estaci√≥n
SUBADDR : Offset en el √°rea de direcciones de datos √∫tiles del m√≥dulo corres‚Äê
pondiente

3

√Årea S5-P

RACK : N√∫mero de rack
SLOT : N√∫mero de slot de la c√°psula de adaptaci√≥n
SUBADDR : Direcci√≥n en el √°rea S5-x

4

√Årea S5-Q

RACK : N√∫mero de rack
SLOT : N√∫mero de slot de la c√°psula de adaptaci√≥n
SUBADDR : Direcci√≥n en el √°rea S5-x

5

√Årea S5-IM3

RACK : N√∫mero de rack
SLOT : N√∫mero de slot de la c√°psula de adaptaci√≥n
SUBADDR : Direcci√≥n en el √°rea S5-x

6

√Årea S5-IM4

RACK : N√∫mero de rack
SLOT : N√∫mero de slot de la c√°psula de adaptaci√≥n
SUBADDR : Direcci√≥n en el √°rea S5-x

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

8090

La direcci√≥n l√≥gica indicada no es v√°lida o se ha usado un valor no admisible en el par√°metro IOID

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6233

Instrucciones
4.2 Instrucciones
C√≥digo de error

Explicaci√≥n

(W#16#...)
8093

Esta instrucci√≥n no es v√°lida para el m√≥dulo seleccionado mediante los par√°metros IOID y LADDR .

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

4.2.3.13

Otras funciones

iSlave
SET_ADDR: Establecer direcci√≥n de red como iSlave propio
Descripci√≥n
Esta instrucci√≥n permite modificar la direcci√≥n DP de de un iSlave DP-Interface. El
direccionamiento se realiza mediante la direcci√≥n de diagn√≥stico de la interfaz DP. Desde el
punto de vista del maestro DP, el esclavo DP con la direcci√≥n antigua se desconecta del bus
y se conecta otro esclavo DP con la direcci√≥n nueva.
‚óè Si la direcci√≥n ya est√° ocupada por una estaci√≥n en la red DP, los dos esclavos DP se
desconectan de la red.
‚óè Si la direcci√≥n se utiliza tambi√©n como direcci√≥n MPI para la conexi√≥n a la programadora,
el acceso al dispositivo puede quedar bloqueado. Para saber si los dispositivos est√°n
accesibles, puede consultarse el cuadro de di√°logo "Dispositivos accesibles".
La direcci√≥n de red no se escribe en el SDB (bloque de datos del sistema) ni se carga en la
memoria de trabajo. Cuando la CPU pasa a STOP, o en caso de arranque en caliente, la
direcci√≥n de red se mantiene. Despu√©s de un reset o un arranque en fr√≠o, se utiliza la direcci√≥n
configurada originalmente.
Esta instrucci√≥n no puede usarse para PROFINET IO, ya que las direcciones de Ethernet
pueden definirse como disjuntas en todo el mundo. Si se utiliza con PROFINET IO, se devuelve
el c√≥digo de error 16#809B.

Funcionamiento
La instrucci√≥n "SET_ADDR" es una instrucci√≥n as√≠ncrona, de modo que la ejecuci√≥n se
prolonga a lo largo de varias llamadas. Para iniciar la petici√≥n, debe llamarse "READ_DBL" con
REQ = 1.
El estado de la petici√≥n se indica a trav√©s de los par√°metros de salida RET_VAL y BUSY .

6234

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Par√°metros
La tabla siguiente muestra los par√°metros de la instrucci√≥n "SET_ADDR":
Par√°metro

Declaraci√≥n

Tipo de datos

√Årea de memoria

Descripci√≥n

REQ

Input

BOOL

I, Q, M, D, L

REQ=1: llamada de funci√≥n

LADDR

Input

WORD

I, Q, M, D, L o constante Direcci√≥n base l√≥gica

ADDR

Input

BYTE

I, Q, M, D, L o constante Nueva direcci√≥n del dispositivo

RET_VAL

Return

INT

I, Q, M, D, L

Informaci√≥n de error

BUSY

Output

BOOL

I, Q, M, D, L

BUSY=1: la orden no ha finalizado toda‚Äê
v√≠a.

Encontrar√° m√°s informaci√≥n sobre los tipos de datos v√°lidos en "Vista general de los tipos de
datos v√°lidos (P√°gina 241)".

Par√°metro RET_VAL
C√≥digo de error

Explicaci√≥n

(W#16#...)
0000

No ha ocurrido ning√∫n error.

700x

La orden no ha finalizado todav√≠a. Par√°metro BUSY=1

8091

La nueva direcci√≥n de estaci√≥n (ADDR) no es v√°lida

8092

La estaci√≥n no es una direcci√≥n de esclavo propia del esclavo I

8093

LADDR no es v√°lido o no es una interfaz

809B

No se puede ejecutar la instrucci√≥n (p. ej. la interfaz no es un esclavo DP o est√° activa).

80C3

Recursos insuficientes (p. ej. varias llamadas de instrucciones con diferentes par√°metros).

8xyy

Informaci√≥n de error general
Consulte tambi√©n: Evaluaci√≥n de errores con el par√°metro de salida RET_VAL (P√°gina 174)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6235

Instrucciones
4.2 Instrucciones

4.2.4

Tecnolog√≠a

4.2.4.1

Control PID

Funciones b√°sicas de PID
CONT_C
Descripci√≥n de CONT_C
La instrucci√≥n CONT_C permite regular procesos t√©cnicos con magnitudes continuas de
entrada y salida en los sistemas de automatizaci√≥n SIMATIC S7. Mediante parametrizaci√≥n se
pueden activar o desactivar funciones parciales del regulador PID para adaptarlo al sistema
regulado. Adem√°s de las funciones de las ramas de valor real y de consigna, la instrucci√≥n
realiza un regulador PID terminado con salida continua de magnitud manipulada y posibilidad
de controlar manualmente la variable manipulada.

Aplicaci√≥n
El regulador se puede utilizar como regulador PID de valor fijo de manera individual o tambi√©n
en regulaciones de varios lazos como regulador en cascada, mixto o de relaci√≥n. El modo de
funcionamiento se basa en el algoritmo de regulaci√≥n PID del regulador por muestreo con
se√±al de salida anal√≥gica, complementada dado el caso con una etapa de formaci√≥n de
impulsos para generar se√±ales de salida con modulaci√≥n de ancho de impulsos para
regulaciones de dos o tres puntos con elementos finales de control proporcionales.

Llamada
La instrucci√≥n CONT_C dispone de una rutina de inicializaci√≥n, que se ejecuta cuando el
par√°metro de entrada COM_RST = TRUE est√° activado. El integrador se ajusta al valor de
inicializaci√≥n I_ITVAL durante la inicializaci√≥n. Todas las salidas de se√±al restantes se ponen
a cero. Una vez ejecutada la rutina de inicializaci√≥n, debe activarse COM_RST = FALSE.
El c√°lculo de los valores en los bloques de regulaci√≥n s√≥lo se realiza correctamente si el bloque
se llama en intervalos regulares. Por ello, los bloques de regulaci√≥n deben llamarse en un OB
de alarma c√≠clica (OB 30 a OB 38). El tiempo de muestreo se indica en el par√°metro CYCLE.
Si se efect√∫a una llamada a la instrucci√≥n CONT_C como DB multiinstancia, no se crea ning√∫n
objeto tecnol√≥gico. No se dispone de interfaz de parametrizaci√≥n y puesta en servicio. Los
CONT_C se deben parametrizar directamente en el DB multiinstancia y ponerse en servicio a
trav√©s de una tabla de observaci√≥n.

Informaci√≥n de error
El bloque no eval√∫a la palabra de notificaci√≥n de error RET_VAL.

6236

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Consulte tambi√©n
Diferencias respecto a CONT_C S7-300/400 (P√°gina 3828)

Funcionamiento de CONT_C
Rama de consigna
La consigna se indica en la entrada SP_INT en formato de coma flotante.

Rama de valor real
El valor real se puede leer en formato de coma flotante o en formato de periferia. La funci√≥n
CRP_IN transforma el valor de periferia PV_PER en un formato en coma flotante de -100 ...
+100 %, seg√∫n la siguiente f√≥rmula:
Salida de CRP_IN = PV_PER * 100 / 27648
La funci√≥n PV_NORM normaliza la salida de CRP_IN seg√∫n la siguiente norma:
Salida de PV_NORM = (salida de CRP_IN) *PV_FAC + PV_OFF
PV_FAC tiene preasignado el valor 1 y PV_OFF el valor 0.

C√°lculo del error de regulaci√≥n
La diferencia entre la consigna y el valor real es el error de regulaci√≥n. Para suprimir una
peque√±a oscilaci√≥n permanente provocada por la cuantificaci√≥n de las magnitudes
manipuladas (p. ej. en caso de una modulaci√≥n de ancho de impulsos con PULSEGEN), el
error de regulaci√≥n se deriva a trav√©s de una zona muerta (DEADBAND). Con DEADB_W = 0
la zona muerta est√° desactivada.

Algoritmo PID
El algoritmo PID trabaja en el algoritmo de posici√≥n. Las acciones proporcional, integral (INT)
y derivativa (DIF) est√°n conectadas en paralelo y pueden conectarse y desconectarse
individualmente. De esta forma pueden parametrizarse reguladores P, PI, PD y PID. Pero
tambi√©n son posibles reguladores I.

Procesamiento de valores en manual
Es posible conmutar entre los modos manual y autom√°tico. En el modo manual, la magnitud
manipulada se corrige seg√∫n un valor manual.
El integrador (INT) se pone internamente a LMN - LMN_P - DISV y el diferenciador (DIF) se
pone a 0 y se compensa internamente. La conmutaci√≥n al modo autom√°tico se efect√∫a as√≠ con
suavidad.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6237

Instrucciones
4.2 Instrucciones

Procesamiento de valores manipulados
La variable manipulada se limita con la funci√≥n LMNLIMIT a valores especificables. El rebase
de los l√≠mites por la magnitud de entrada se se√±aliza mediante bits de aviso.
La funci√≥n LMN_NORM normaliza la salida de LMNLIMIT seg√∫n la siguiente regla:
LMN = (salida de LMNLIMIT) * LMN_FAC + LMN_OFF
LMN_FAC tiene preasignado el valor 1 y LMN_OFF el valor 0.
La variable manipulada tambi√©n est√° disponible en formato de periferia. La funci√≥n CRP_OUT
convierte el valor en coma flotante LMN en un valor de periferia seg√∫n la siguiente regla:
LMN_PER = LMN * 27648 / 100

Control anticipativo
En la entrada DISV se puede aplicar una magnitud perturbadora de manera aditiva.

Consulte tambi√©n
Diferencias respecto a CONT_C S7-300/400 (P√°gina 3828)

6238

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Diagrama de bloques de CONT_C
63B,17
*$,1

393(5B21
39B,1
&53B,1
39B3(5

39B1250



;







'($'%$1'



'($'%B:

39

(5

39B)$&
39B2))
3B6(/

/01B3




,17






,B6(/

',69




7,,17B+2/'
,B,7/B21
,B,7/9$/


/01B,

',)





7'70B/$*

'B6(/

/01B'

4/01B+/0
4/01B//0

0$1B21
0$1


/01/,0,7

/01B1250

/01
&53B287



/01B+/0
/01B//0

/01B3(5

/01B)$&
/01B2))

Consulte tambi√©n
Diferencias respecto a CONT_C S7-300/400 (P√°gina 3828)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6239

Instrucciones
4.2 Instrucciones

Par√°metros de entrada de CONT_C
Tabla 4-267
Par√°metro

Tipo
de da‚Äê
tos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

COM_RST

BOOL

FALSE La instrucci√≥n tiene una rutina de inicializaci√≥n, que se ejecuta cuando est√° activada la
entrada "Rearranque completo".

MAN_ON

BOOL

TRUE

PVPER_ON

BOOL

FALSE Si el valor real se debe leer de la periferia, la entrada PV_PER debe estar interconectada
con la periferia, y la entrada "Activar valor real de periferia" debe estar activada.

P_SEL

BOOL

TRUE

En el algoritmo PID las acciones PID se pueden conectar y desconectar individualmente.
La acci√≥n P est√° conectada si est√° activada la entrada "Activar acci√≥n P".

I_SEL

BOOL

TRUE

En el algoritmo PID las acciones PID se pueden conectar y desconectar individualmente.
La acci√≥n I est√° conectada si est√° activada la entrada "Activar acci√≥n I".

INT_HOLD

BOOL

FALSE La salida del integrador se puede congelar. Para ello debe estar activada la entrada
"Congelar acci√≥n I".

I_ITL_ON

BOOL

FALSE La salida del integrador se puede aplicar a la entrada I_ITLVAL. Para ello, la entrada
"Inicializar acci√≥n I" debe estar activada.

D_SEL

BOOL

FALSE En el algoritmo PID las acciones PID se pueden conectar y desconectar individualmente.
La acci√≥n D est√° conectada si est√° activada la entrada "Activar acci√≥n D".

CYCLE

TIME

T#1s

Si est√° activada la entrada "Conectar modo manual", el lazo de regulaci√≥n est√° interrum‚Äê
pido. Como variable manipulada se especifica un valor manual.

El tiempo entre las llamadas del bloque debe ser constante. La entrada "Tiempo de
muestreo" indica el tiempo entre las llamadas del bloque.
CYCLE >= 1ms

SP_INT

REAL

0.0

La entrada "Consigna interna" sirve para preseleccionar una consigna.
Se admiten los valores de -100 a 100 % o una magnitud f√≠sica 1).

PV_IN

REAL

0.0

En la entrada "Valor real de la entrada" se puede parametrizar un valor de puesta en
servicio, o se puede conectar un valor real externo en coma flotante.
Se admiten los valores de -100 a 100 % o una magnitud f√≠sica 1).

PV_PER

WORD W#16# El valor real en formato de periferia se conecta al regulador a trav√©s de la entrada "Valor
0000
real de la periferia".

MAN

REAL

0.0

La entrada "Valor manual" sirve para establecer un valor manual mediante una funci√≥n de
manejo/visualizaci√≥n.
Se admiten los valores de -100 a 100 % o una magnitud f√≠sica 2).

GAIN

REAL

2.0

TI

TIME

T#20s

La entrada "Ganancia proporcional" indica la ganancia del regulador.
La entrada "Tiempo de integraci√≥n" determina el comportamiento temporal del integrador.
TI >= CYCLE

TD

TIME

T#10s

La entrada "Tiempo de acci√≥n derivada" determina el comportamiento temporal del dife‚Äê
renciador.
TD >= CYCLE

TM_LAG

TIME

T#2s

Tiempo de retardo de la acci√≥n D
El algoritmo de la acci√≥n D contiene un retardo que se puede parametrizar en la entrada
"Tiempo de retardo de la acci√≥n D".
TM_LAG >= CYCLE/2

6240

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo
de da‚Äê
tos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

DEADB_W

REAL

0.0

El error de regulaci√≥n se conduce por una zona muerta. La entrada "Ancho de zona
muerta" determina el tama√±o de la zona muerta.
DEADB_W >= 0.0 (%) o una magnitud f√≠sica 1)

LMN_HLM

REAL

100.0

La variable manipulada est√° limitada siempre por un l√≠mite superior y uno inferior. La
entrada "L√≠mite superior de la variable manipulada" indica el l√≠mite superior.

LMN_LLM

REAL

0.0

PV_FAC

REAL

1.0

La entrada "Factor de valor real" se multiplica por el valor real. La entrada sirve para
adaptar el rango del valor real.

PV_OFF

REAL

0.0

La entrada "Offset de valor real" se suma al valor real. La entrada sirve para adaptar el
rango del valor real.

LMN_FAC

REAL

1.0

La entrada "Factor de la variable manipulada" se multiplica por la variable manipulado. La
entrada sirve para adaptar el rango de la variable manipulada.

LMN_OFF

REAL

0.0

La entrada "Offset de la variable manipulada" se suma a la variable manipulada. La en‚Äê
trada sirve para adaptar el rango de la variable manipulada.

I_ITLVAL

REAL

0.0

La salida del integrador se puede aplicar en la entrada I_ITL_ON. En la entrada "Valor de
inicializaci√≥n para la acci√≥n I" est√° el valor de inicializaci√≥n.

DISV

REAL

0.0

Se admiten valores reales desde LMN_LLM (%) o una magnitud f√≠sica 2).
La variable manipulada est√° limitada siempre por un l√≠mite superior y uno inferior. La
entrada "L√≠mite inferior de la variable manipulada" indica el l√≠mite inferior.
Se admiten valores reales hasta LMN_HLM (%) o una magnitud f√≠sica 2).

Se admiten valores desde -100 hasta 100.0 (%) o una magnitud f√≠sica 2).
Para realizar un control anticipativo, la magnitud perturbadora se conecta a la entrada
"Variable perturbadora".
Se admiten valores desde -100 hasta 100.0 (%) o una magnitud f√≠sica 2).

1) Par√°metros en la rama de consigna, rama de valor real, con la misma unidad
2) Par√°metros en la rama de variable manipulada con la misma unidad

Consulte tambi√©n
Diferencias respecto a CONT_C S7-300/400 (P√°gina 3828)

Par√°metros de salida de CONT_C
Tabla 4-268
Par√°metro

Tipo de
datos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

LMN

REAL

0.0

En la salida "Variable manipulada" se indica la variable manipulada realmente efectiva en
formato de coma flotante.

LMN_PER

WORD

W#16# La variable manipulada en formato de periferia se conecta al regulador en la salida "Va‚Äê
0000
riable manipulada de la periferia".

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6241

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo de
datos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

QLMN_HLM

BOOL

FALSE La variable manipulada est√° limitada siempre por un l√≠mite superior y uno inferior. La
salida "Se ha alcanzado el l√≠mite superior de la variable manipulada" indica que se ha
alcanzado el l√≠mite superior.

QLMN_LLM

BOOL

FALSE La variable manipulada est√° limitada siempre por un l√≠mite superior y uno inferior. La
salida "Se ha alcanzado el l√≠mite inferior de la variable manipulada" indica que se ha
alcanzado el l√≠mite inferior.

LMN_P

REAL

0.0

La salida "Acci√≥n P" contiene la acci√≥n proporcional de la magnitud manipulada.

LMN_I

REAL

0.0

La salida "Acci√≥n I" contiene la acci√≥n integral de la magnitud manipulada.

LMN_D

REAL

0.0

La salida "Acci√≥n D" contiene la acci√≥n derivativa de la magnitud manipulada.

PV

REAL

0.0

En la salida "Valor real" se indica el valor real que act√∫a efectivamente.

ER

REAL

0.0

En la salida "Error de regulaci√≥n" se indica el error de regulaci√≥n que act√∫a realmente.

Consulte tambi√©n
Diferencias respecto a CONT_C S7-300/400 (P√°gina 3828)

CONT_S
Descripci√≥n de CONT_S
La instrucci√≥n CONT_S permite regular procesos t√©cnicos con se√±ales de salida binarias de la
variable manipulada para elementos finales de control integrales en los sistemas de
automatizaci√≥n SIMATIC S7. Mediante parametrizaci√≥n es posible activar o desactivar
funciones parciales del regulador paso a paso PI para adaptarlo al sistema regulado. Junto a
las funciones de la rama de valor real, la instrucci√≥n realiza un regulador PI terminado con
salida binaria de variable manipulada y posibilidades de influir manualmente sobre la variable
manipulada. El regulador paso a paso opera sin realimentaci√≥n de posici√≥n.

Aplicaci√≥n
El regulador puede utilizarse como regulador PI de valor fijo, ya sea individualmente o en lazos
de regulaci√≥n subordinados en regulaciones en cascada, mixtas o de relaci√≥n, pero no como
regulador piloto. El modo de funcionamiento se basa en el algoritmo de regulaci√≥n PI del
regulador por muestreo y se completa con los elementos funcionales que generan la se√±al de
salida binaria a partir de la se√±al manipulada anal√≥gica.

Llamada
La instrucci√≥n CONT_S dispone de una rutina de inicializaci√≥n, que se ejecuta cuando el
par√°metro de entrada COM_RST = TRUE est√° activado. Todas las salidas de se√±al se ponen
a cero. Una vez ejecutada la rutina de inicializaci√≥n, debe activarse COM_RST = FALSE.
El c√°lculo de los valores en los bloques de regulaci√≥n s√≥lo se realiza correctamente si el bloque
se llama en intervalos regulares. Por ello, los bloques de regulaci√≥n deben llamarse en un OB
de alarma c√≠clica (OB 30 a OB 38). El tiempo de muestreo se indica en el par√°metro CYCLE.

6242

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Si se efect√∫a una llamada a la instrucci√≥n CONT_S como DB multiinstancia, no se crea ning√∫n
objeto tecnol√≥gico. No se dispone de interfaz de parametrizaci√≥n y puesta en servicio. Los
CONT_S se deben parametrizar directamente en el DB multiinstancia y ponerse en servicio a
trav√©s de una tabla de observaci√≥n.

Informaci√≥n de error
El bloque no eval√∫a la palabra de notificaci√≥n de error RET_VAL.

Consulte tambi√©n
Diferencias respecto a CONT_S S7-300/400 (P√°gina 3828)

Funcionamiento de CONT_S
Rama de consigna
La consigna se indica en la entrada SP_INT en formato de coma flotante.

Rama de valor real
El valor real se puede leer en formato de coma flotante o en formato de periferia. La funci√≥n
CRP_IN transforma el valor de periferia PV_PER en un formato en coma flotante de -100 ...
+100 %, seg√∫n la siguiente f√≥rmula:
Salida de CRP_IN = PV_PER * 100 / 27648
La funci√≥n PV_NORM normaliza la salida de CRP_IN seg√∫n la siguiente norma:
Salida de PV_NORM = (salida de CRP_IN) * PV_FAC + PV_OFF
PV_FAC tiene preasignado el valor 1 y PV_OFF el valor 0.

C√°lculo de error de regulaci√≥n
La diferencia entre la consigna y el valor real constituye el error de regulaci√≥n. Para suprimir
una peque√±a oscilaci√≥n permanente provocada por la cuantificaci√≥n de las magnitudes
manipuladas (resoluci√≥n limitada de la variable manipulada por parte de la servov√°lvula), el
error de regulaci√≥n se conduce a trav√©s de una zona muerta (DEADBAND). Con DEADB_W
= 0 la zona muerta est√° desactivada.

Algoritmo paso a paso PI
La instrucci√≥n opera sin realimentaci√≥n de posici√≥n. La acci√≥n I del algoritmo PI y la
realimentaci√≥n de posici√≥n supuesta se calculan en un integrador (INT) y se comparan como
valor de realimentaci√≥n con la acci√≥n P restante. La diferencia pasa a un elemento de tres
puntos (THREE_ST) y a un generador de impulsos (PULSEOUT), que genera los impulsos
para la servov√°lvula. Mediante una adaptaci√≥n del umbral de respuesta del elemento de tres
puntos se reduce la frecuencia de conmutaci√≥n del regulador.

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6243

Instrucciones
4.2 Instrucciones

Control anticipativo
En la entrada DISV se puede aplicar una magnitud perturbadora de manera aditiva.

Consulte tambi√©n
Diferencias respecto a CONT_S S7-300/400 (P√°gina 3828)

6244

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Diagrama de bloques de CONT_S
63B,17
*$,1

393(5B21
39B,1
&53B,1
39B3(5

39B1250

;







'($'%$1'





'($'%B:

39

(5

39B)$&
39B2))

/01/,0,7

,17
/015B+6
/015B/6

/015B6,0
/0156B21
/01569$/

/0183
/01'1

/016B21

',69


7+5((B67
DGDSWLY







$1'

38/6(287

$1'

$1'

4/0183

$1'

4/01'1

38/6(B70
%5($.B70

075B70









25

/016B21



,17




;




;





075B70



7,










Consulte tambi√©n
Diferencias respecto a CONT_S S7-300/400 (P√°gina 3828)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6245

Instrucciones
4.2 Instrucciones

Par√°metros de entrada de CONT_S
Tabla 4-269
Par√°metro

Tipo
de da‚Äê
tos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

COM_RST

BOOL

FALSE

La instrucci√≥n tiene una rutina de inicializaci√≥n, que se ejecuta cuando est√° activada la
entrada "Rearranque completo".

LMNR_HS

BOOL

FALSE

La se√±al "Servov√°lvula en el tope superior" se aplica en la entrada "Se√±al de tope superior
de la realimentaci√≥n de posici√≥n". LMNR_HS=TRUE significa: La servov√°lvula se en‚Äê
cuentra en el tope superior.

LMNR_LS

BOOL

FALSE

La se√±al "Servov√°lvula en el tope inferior" se aplica en la entrada "Se√±al de tope inferior
de la realimentaci√≥n de posici√≥n". LMNR_LS=TRUE significa: La servov√°lvula se en‚Äê
cuentra en el tope inferior.

LMNS_ON

BOOL

FALSE

En la entrada "Activar el modo manual de las se√±ales de variable manipulada" el proce‚Äê
samiento de las se√±ales manipuladas pasa a manual.

LMNUP

BOOL

FALSE

En el modo manual de las se√±ales de variable manipulada se controla la se√±al de salida
QLMNUP en la entrada "Se√±al alta de variable manipulada".

LMNDN

BOOL

FALSE

En el modo manual de las se√±ales de variable manipulada se controla la se√±al de salida
QLMNDN en la entrada "Se√±al baja de variable manipulada".

PVPER_ON

BOOL

FALSE

Si se debe leer el valor real de la periferia, la entrada PV_PER debe estar conectada a la
periferia, y la entrada "Activar valor real de la periferia" debe estar activada.

CYCLE

TIME

T#1s

El tiempo entre las llamadas del bloque debe ser constante. La entrada "Tiempo de
muestreo" indica el tiempo entre las llamadas del bloque.

SP_INT

REAL

0.0

CYCLE >= 1ms
La entrada "Consigna interna" sirve para preseleccionar una consigna.
Se admiten los valores de -100 a 100 % o una magnitud f√≠sica 1).
PV_IN

REAL

0.0

En la entrada "Valor real de la entrada" se puede parametrizar un valor de puesta en
servicio, o se puede conectar un valor real externo en coma flotante.
Se admiten los valores de -100 a 100 % o una magnitud f√≠sica 1).

PV_PER

WORD W#16#
0000

El valor real en formato de periferia se conecta al regulador a trav√©s de la entrada "Valor
real de la periferia".

GAIN

REAL

2.0

La entrada "Ganancia proporcional" indica la ganancia del regulador.

TI

TIME

T#20s

La entrada "Tiempo de integraci√≥n" determina el comportamiento temporal del integrador.
TI >= CYCLE

DEADB_W

REAL

1.0

El error de regulaci√≥n se conduce por una zona muerta. La entrada "Ancho de zona
muerta" determina el tama√±o de la zona muerta.
Se admiten los valores de 0 a 100 % o una magnitud f√≠sica 1).

PV_FAC

REAL

1.0

La entrada "Factor de valor real" se multiplica por el valor real. La entrada sirve para
adaptar el rango del valor real.

PV_OFF

REAL

0.0

La entrada "Offset de valor real" se suma al valor real. La entrada sirve para adaptar el
rango del valor real.

PULSE_TM

TIME

T#3s

En el par√°metro "Duraci√≥n m√≠nima de impulso" se puede parametrizar una duraci√≥n de
impulso m√≠nima.
PULSE_TM >= CYCLE

6246

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo
de da‚Äê
tos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

BREAK_TM

TIME

T#3s

En el par√°metro "Duraci√≥n m√≠nima de pausa" se puede parametrizar una longitud de
pausa m√≠nima.
BREAK_TM >= CYCLE

MTR_TM

TIME

T#30s

DISV

REAL

0.0

En el par√°metro "Tiempo de posicionamiento del motor" se introduce el tiempo de ope‚Äê
raci√≥n de la servov√°lvula de tope a tope.
MTR_TM >= CYCLE
Para realizar un control anticipativo, la magnitud perturbadora se conecta a la entrada
"Variable perturbadora".
Se admiten los valores de -100 a 100 % o una magnitud f√≠sica 2).

1)

Par√°metros en la rama de consigna, rama de valor real, con la misma unidad

2)

Par√°metros en la rama de variable manipulada con la misma unidad

Consulte tambi√©n
Diferencias respecto a CONT_S S7-300/400 (P√°gina 3828)

Par√°metros de salida de CONT_S
Tabla 4-270
Par√°metro

Tipo
de da‚Äê
tos

Ajuste prede‚Äê
terminado

Descripci√≥n

QLMNUP

BOOL

FALSE

Si la salida "Se√±al alta de variable manipulada" est√° activada, la servov√°lvula debe
abrirse.

QLMNDN

BOOL

FALSE

Si est√° activada la salida "Se√±al baja de variable manipulada", la servov√°lvula debe
cerrarse.

PV

REAL

0.0

En la salida "Valor real" se indica el valor real que act√∫a efectivamente.

ER

REAL

0.0

En la salida "Error de regulaci√≥n" se indica el error de regulaci√≥n que act√∫a real‚Äê
mente.

Consulte tambi√©n
Diferencias respecto a CONT_S S7-300/400 (P√°gina 3828)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6247

Instrucciones
4.2 Instrucciones

PULSEGEN
Descripci√≥n de PULSEGEN
La instrucci√≥n PULSEGEN permite establecer un regulador PID con salida de impulsos para
actuadores proporcionales. PULSEGEN transforma la magnitud de entrada INV (= LMN del
regulador PID) mediante modulaci√≥n de ancho de impulsos en una secuencia de impulsos con
duraci√≥n de periodo constante, que corresponde al tiempo de ciclo con el que se actualiza la
magnitud de entrada.

Aplicaci√≥n
La instrucci√≥n PULSEGEN permite generar reguladores PID de dos o tres puntos con
modulaci√≥n de ancho de impulsos. La funci√≥n se aplica casi siempre en combinaci√≥n con el
regulador continuo CONT_C.
&217B&

38/6(*(1
/01

,19

Llamada
La instrucci√≥n PULSEGEN dispone de una rutina de inicializaci√≥n, que se ejecuta cuando el
par√°metro de entrada COM_RST = TRUE est√° activado. Todas las salidas de se√±al se ponen
a cero. Una vez ejecutada la rutina de inicializaci√≥n, debe activarse COM_RST = FALSE.
El c√°lculo de los valores en los bloques de regulaci√≥n s√≥lo se realiza correctamente si el bloque
se llama en intervalos regulares. Por ello, los bloques de regulaci√≥n deben llamarse en un OB
de alarma c√≠clica (OB 30 a OB 38). El tiempo de muestreo se indica en el par√°metro CYCLE.

Comportamiento en caso de error
El bloque no eval√∫a la palabra de notificaci√≥n de error RET_VAL.

Consulte tambi√©n
Diferencias respecto a PULSEGEN S7-300/400 (P√°gina 3829)

6248

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Funcionamiento de PULSEGEN
Modulaci√≥n de ancho de impulsos
La duraci√≥n de un impulso por duraci√≥n de per√≠odo es proporcional a la magnitud de entrada.
El ciclo parametrizado con PER_TM no es id√©ntico al ciclo de ejecuci√≥n de la instrucci√≥n
PULSEGEN. Es m√°s, un ciclo PER_TM est√° compuesto por varios ciclos de ejecuci√≥n de la
instrucci√≥n PULSEGEN, y la cantidad de llamadas de PULSEGEN por ciclo PER_TM
representa una medida para la precisi√≥n del ancho de impulso.
,19 
/01







W



4326B3




W
&LFOR38/6(*(1
3(5B70

FLFOR&217B&

As√≠, una magnitud de entrada del 30 % y 10 llamadas de PULSEGEN por PER_TM significan:
‚óè "uno" en la salida QPOS_P para las tres primeras llamadas de PULSEGEN (30% de 10
llamadas)
‚óè "cero" en la salida QPOS_P para otras siete llamadas de PULSEGEN (70% de 10 llamadas)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6249

Instrucciones
4.2 Instrucciones

Diagrama de bloques
326B3B21

6<1B21
67(3B21
67%,B21

1(*B3B21



0$1B21

4326B3

,19

41(*B3


3(5B70
3B%B70
5$7,2)$&

Precisi√≥n de variable manipulada
En este ejemplo, con una "relaci√≥n de muestreo" de 1:10 (llamadas de CONT_C respecto a
llamadas de PULSEGEN) la precisi√≥n de la variable manipulada se reduce al 10%, es decir,
los valores de entrada predeterminados INV s√≥lo se pueden representar en intervalos del 10%
en una duraci√≥n de impulso en la salida QPOS_P.
Del mismo modo aumenta la precisi√≥n con la cantidad de llamadas de PULSEGEN por cada
llamada de CONT_C.
Si por ejemplo PULSEGEN se llama con una frecuencia 100 veces mayor que CONT_C, se
consigue una resoluci√≥n del 1% del rango de la variable manipulada.
Nota
La desmultiplicaci√≥n de la frecuencia de llamada debe ser programada por el usuario.

Sincronizaci√≥n autom√°tica
Existe la posibilidad de sincronizar autom√°ticamente la salida de impulsos con la instrucci√≥n
que actualiza la magnitud de entrada INV (p. ej. CONT_C). De este modo se garantiza que una
magnitud de entrada cambiante tambi√©n se pueda emitir como impulso con la mayor rapidez
posible.
El formador de impulsos eval√∫a siempre la magnitud de entrada INV en el intervalo
correspondiente a la duraci√≥n de per√≠odo PER_TM y transforma el valor en una se√±al de
impulso con la correspondiente duraci√≥n.

6250

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Pero como INV se calcula casi siempre en un nivel de alarma c√≠clica m√°s lento, el formador de
impulsos deber√≠a iniciar la transformaci√≥n del valor discreto en una se√±al de impulso con la
m√°xima rapidez posible tras la actualizaci√≥n de INV.
Para ello, el bloque puede sincronizar √©l mismo el inicio del per√≠odo seg√∫n el siguiente
procedimiento:
Si INV ha cambiado y la llamada de bloque no se encuentra en el primer ciclo de llamada o en
los dos √∫ltimos ciclos de un per√≠odo, se realiza una sincronizaci√≥n. La duraci√≥n de impulso se
calcula de nuevo, y en el siguiente ciclo se inicia la emisi√≥n con un nuevo periodo.
/01 ,19 

/01 ,19 

/01 ,19 

3URFHVDPLHQWRGH&217B&
W

&<&/(YRQ&217B&
,QLFLRGHOSHU¬ØRGR







































 


W

3(5B70

&<&/(YRQ
38/6(*(1

6LQFURQL]DFL¬µQGHO
LQLFLRGHOSHU¬ØRGR
38/6(*(1GHWHFWD
,19KDFDPELDGR\ODOODPDGDQR
VHHQFXHQWUDHQHOSULPHUFLFORQL
HQQLQJXQRGHORVGRV¬ºOWLPRV
FLFORVGHOSHU¬ØRGR

3URFHVDPLHQWRGH38/6(*(1

3(5B70
6LQVLQFURQL]DFL¬µQ
QHFHVDULR
38/6(*(1GHWHFWD
,19KDFDPELDGRDR\OD
OODPDGDVHHQFXHQWUDHQHOSULPHU
FLFORRHQORVGRV¬ºOWLPRVFLFORVGHO
SHU¬ØRGR
3URFHVDPLHQWRGH38/6(*(1HQHOSULPHUFLFORRHQORVGRV
¬ºOWLPRVFLFORVGHOSHU¬ØRGR

La sincronizaci√≥n autom√°tica se desactiva con SYN_ON = FALSE.
Nota
Con el inicio del periodo nuevo, el valor antiguo de INV (es decir, de LMN) se representa en la
se√±al de impulso de manera m√°s o menos precisa una vez concluida la sincronizaci√≥n.

Consulte tambi√©n
Diferencias respecto a PULSEGEN S7-300/400 (P√°gina 3829)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6251

Instrucciones
4.2 Instrucciones

Modos de operaci√≥n de PULSEGEN
Modos de operaci√≥n
Dependiendo de la parametrizaci√≥n del formador de impulsos, los reguladores PID se pueden
configurar con comportamiento de tres puntos o con salida de dos puntos bipolar o unipolar. La
siguiente tabla contiene los ajustes de las combinaciones de conmutadores para los modos de
operaci√≥n posibles.
Modo de operaci√≥n

MAN_ON

STEP3_ON

ST2BI_ON

Regulaci√≥n de tres puntos

FALSE

TRUE

cualquiera

Regulaci√≥n de dos puntos con rango de valores

FALSE

FALSE

TRUE

FALSE

FALSE

FALSE

TRUE

cualquiera

cualquiera

manipulados bipolar (-100 % ... 100 %)
Regulaci√≥n de dos puntos con rango de valores
manipulados unipolar (0 % ... 100 %)
Modo manual

Modo manual en la regulaci√≥n de dos o de tres puntos
En el modo manual (MAN_ON = TRUE) las salidas binarias del regulador de tres puntos o del
regulador de dos puntos pueden activarse independientemente de INV a trav√©s de las se√±ales
POS_P_ONy NEG_P_ON.
Regulaci√≥n

POS_P_ON

NEG_P_ON

QPOS_P

QNEG_P

Regulaci√≥n de tres
puntos

FALSE

FALSE

FALSE

FALSE

TRUE

FALSE

TRUE

FALSE

FALSE

TRUE

FALSE

TRUE

TRUE

TRUE

FALSE

FALSE

FALSE

cualquiera

FALSE

TRUE

TRUE

cualquiera

TRUE

FALSE

Regulaci√≥n de dos
puntos

Consulte tambi√©n
Diferencias respecto a PULSEGEN S7-300/400 (P√°gina 3829)

6252

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones

Regulaci√≥n de tres puntos
Regulaci√≥n de tres puntos
En el modo de operaci√≥n "Regulaci√≥n de tres puntos" se pueden generar tres estados de la
se√±al de salida. Para ello se asignan los valores de estado de las se√±ales binarias de salida
QPOS_P y QNEG_P a los correspondientes estados operativos del actuador. La tabla muestra
el ejemplo de una regulaci√≥n de temperatura:
Se√±ales de salida

Calentar

OFF

Enfriar

QPOS_P

TRUE

FALSE

FALSE

QNEG_P

FALSE

FALSE

TRUE

A partir de la magnitud de entrada se calcula la duraci√≥n del impulso mediante una
caracter√≠stica. La forma de esta caracter√≠stica est√° definida por la duraci√≥n m√≠nima de impulso
o de pausa y por el factor de relaci√≥n. El valor normal del factor de relaci√≥n es 1.
Los puntos escalonados de las caracter√≠sticas son originados por la duraci√≥n m√≠nima de
impulso o de pausa.
Duraci√≥n m√≠nima de impulso o de pausa
La correcta parametrizaci√≥n de la duraci√≥n m√≠nima de impulso o de pausa P_B_TM evita
tiempos de conexi√≥n o desconexi√≥n breves, que merman la vida √∫til de los elementos de
contacto y de los elementos de control final. Se suprimen valores absolutos peque√±os de la
magnitud de entrada LMN que generar√≠an una duraci√≥n de impulso inferior a P_B_TM. Los
valores de entrada grandes que generar√≠an una duraci√≥n de impulso superior a PER_TM P_B_TM se ajustan a 100 % o a -100 %.
La duraci√≥n de los impulsos positivos o negativos se calcula multiplicando la magnitud de
entrada (en %) por la duraci√≥n del per√≠odo:
Duraci√≥n de impulso = INV / 100 * PER_TM
La siguiente figura muestra una caracter√≠stica sim√©trica del regulador de tres puntos (factor de
relaci√≥n = 1)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6253

Instrucciones
4.2 Instrucciones
'XUDFL¬µQGHOLPSXOVR
SRVLWLYR
FRQWLQXDPHQWHFRQHFWDGR
3(5B70
3(5B703B%B70



3B%B70

FRQWLQXDPHQWHGHVFRQHFWDGR



'XUDFL¬µQGHOLPSXOVRQHJDWLYR

Regulaci√≥n de tres puntos asim√©trica
A trav√©s del factor de relaci√≥n RATIOFAC puede modificarse la relaci√≥n de la duraci√≥n de
impulsos positivos respecto a los negativos. Durante un lazo de regulaci√≥n de temperatura,
ello permite tener en cuenta p. ej. constantes temporales de proceso distintas para calentar y
refrigerar.
Factor de relaci√≥n < 1
La duraci√≥n de impulso obtenida de la multiplicaci√≥n de la magnitud de entrada por la duraci√≥n
del per√≠odo en la salida de impulsos negativa se multiplica por el factor de relaci√≥n.
Duraci√≥n de impulso positiva = INV /100 * PER_TM
Duraci√≥n de impulso negativa = INV / 100 * PER_TM * RATIOFAC
La siguiente figura muestra una caracter√≠stica asim√©trica del regulador de tres puntos (factor
de relaci√≥n = 0.5)

6254

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
'XUDFL¬µQGHOLPSXOVRSRV

3(5B70
3(5B703B%B70

3B%B70



3B%B70



 3(5B70
'XUDFL¬µQGHOLPSXOVRQHJ

Factor de relaci√≥n > 1
La duraci√≥n de impulso obtenida de la multiplicaci√≥n de la magnitud de entrada por la duraci√≥n
del per√≠odo en la salida de impulsos positiva se divide por el factor de relaci√≥n.
Duraci√≥n de impulso positiva = INV / 100 * PER_TM / RATIOFAC
Duraci√≥n de impulso negativa = INV / 100 * PER_TM

Consulte tambi√©n
Diferencias respecto a PULSEGEN S7-300/400 (P√°gina 3829)

Regulaci√≥n de dos puntos
En la regulaci√≥n de dos puntos s√≥lo se conecta la salida de impulsos positiva QPOS_P de
PULSEGEN al actuador de conexi√≥n/desconexi√≥n en cuesti√≥n. Seg√∫n cu√°l sea el rango
utilizado de la variable manipulada, el regulador de dos puntos tiene un rango bipolar o
unipolar.
Regulaci√≥n de dos puntos con rango de variable manipulada bipolar (-100% ... 100%)
'XUDFL¬µQGHOLPSXOVRSRVLWLYR

FRQWLQXDPHQWH
FRQHFWDGR

3(5B70
3(5B703B%B70

FRQWLQXDPHQWH
GHVFRQHFWDGR
3B%B70






Regulaci√≥n de dos puntos con rango de variable manipulada unipolar (0%...100%)

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

6255

Instrucciones
4.2 Instrucciones
'XUDFL¬µQGHOLPSXOVRSRVLWLYR
3(5B70
3(5B703B%B70

3B%B70




En QNEG_P est√° disponible la se√±al de salida negada, si la interconexi√≥n del regulador de dos
puntos en el lazo de regulaci√≥n exige una se√±al binaria invertida l√≥gicamente para los impulsos
de la se√±al manipulada.
Impulso

Actuador ON

Actuador OFF

QPOS_P

TRUE

FALSE

QNEG_P

FALSE

TRUE

Consulte tambi√©n
Diferencias respecto a PULSEGEN S7-300/400 (P√°gina 3829)

Par√°metros de entrada de PULSEGEN
Los valores de los par√°metros de entrada no se limitan en el bloque; no tiene lugar una
comprobaci√≥n de los par√°metros.
Tabla 4-271
Par√°metro

Tipo de
datos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

INV

REAL

0.0

En el par√°metro de entrada "Variable de entrada" se aplica una variable manipulada
anal√≥gica.
Se admiten valores entre -100 y 100 %.

PER_TM

TIME

T#1s

En el par√°metro "Duraci√≥n de per√≠odo" se introduce la duraci√≥n de per√≠odo constante de
la modulaci√≥n de ancho de impulsos. La duraci√≥n corresponde al tiempo de muestreo del
regulador. La relaci√≥n entre el tiempo de muestreo del formador de impulsos respecto al
tiempo de muestreo del regulador determina la precisi√≥n de la modulaci√≥n de ancho de
impulsos.
PER_TM >=20*CYCLE

P_B_TM

TIME

T#50m
s

En el par√°metro "Duraci√≥n m√≠nima de impulso" o "Duraci√≥n m√≠nima de pausa" se puede
parametrizar una duraci√≥n de pausa o de impulso m√≠nima.
P_B_TM >= CYCLE

6256

Programaci√≥n del PLC
Manual de programaci√≥n y manejo, 11/2019

Instrucciones
4.2 Instrucciones
Par√°metro

Tipo de
datos

Ajuste
prede‚Äê
termi‚Äê
nado

Descripci√≥n

RATIOFAC

REAL

1.0

Con el par√°metro de entrada "Factor de relaci√≥n" puede modificarse la relaci√≥n de la
duraci√≥n de impulsos negativos a impulsos positivos. De ese modo, en un lazo de regu‚Äê
laci√≥n de temperatura se pueden compensar constantes temporales distintas para ca‚Äê
lentar y refrigerar (p. ej. proceso con calefacci√≥n el√©ctrica y refrigeraci√≥n por agua).
Se admiten valores comprendidos entre 0.1 y 10.0.

STEP3_ON

BOOL

TRUE

En el par√°metro de entrada "Activar la regulaci√≥n de tres puntos" se activa el correspon‚Äê
diente modo de operaci√≥n. En la regulaci√≥n de tres puntos trabajan ambas se√±ales de
salida.

ST2BI_ON

BOOL

FALSE En el par√°metro de entrada "Activar la regulaci√≥n de dos puntos para el rango de valores
manipulados bipolar" puede elegirse entre los modos de operaci√≥n "Regulaci√≥n de dos
puntos para rango de valores manipulados bipolar" y "Regulaci√≥n de dos puntos para el
rango de valores manipulados unipolar". Para ello es necesario que STEP3_ON = FAL‚Äê
SE.

MAN_ON

BOOL

FALSE La activaci√≥n del par√°metro de entrada "Activar modo manual" permite ajustar las se√±a‚Äê
les de salida manualmente.

POS_P_ON

BOOL

FALSE En el modo manual Regulaci√≥n de tres puntos se puede controlar la se√±al de salida
QPOS_P en el par√°metro de entrada "Activar impulso positivo". En modo manual Regu‚Äê
laci√≥n de dos puntos QNEG_P siempre est√° invertido respecto a QPOS_P.

NEG_P_ON

BOOL

FALSE En el modo manual Regulaci√≥n de tres puntos se puede controlar la se√±al de salida
QNEG_P en el par√°metro de entrada "Activar impulso negativo". En modo manual Re‚Äê
gulaci√≥n de dos puntos QNEG_P siempre est√° invertido respecto a QPOS_P.

SYN_ON

BOOL

TRUE

COM_RST

BOOL

FALSE La instrucci√≥n tiene una rutina de inicializaci√≥n que se ejecuta cuando est√° activada la
entrada de rearranque completo.

CYCLE

TIME

T#10m
s

La activaci√≥n del par√°metro de entrada "Activar sincronizaci√≥n" permite sincronizar au‚Äê
tom√°ticamente la salida de impulsos con el bloque que actualiza la magnitud de entrada
INV. De ese modo se garantiza que una magnitud de entrada cambiante tambi√©n se
pueda emitir como impulso con la mayor rapidez posible.

El tiempo entre las llamadas del bloque debe ser constante. La entrada "Tiempo de
muestreo" indica el tiempo entre las llamadas del bloque.
CYCLE >= 1ms

Consulte tambi√©n
Diferencias respecto a PULSEGEN S7-300/400 (P√°gina 382