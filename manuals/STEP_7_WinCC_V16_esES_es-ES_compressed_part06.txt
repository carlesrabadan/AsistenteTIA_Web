ci√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1505

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Transiciones de estado operativo
Resumen
La figura siguiente muestra los estados operativos y las transiciones de CPUs S7-1200:
3$5$'$


5('
21







6723





$55$148(






581



La tabla siguiente muestra las condiciones en las que cambian los estados operativos:
N.¬∫

‚ë†

Transici√≥n de estado operativo Condiciones
POWER ON ‚Üí ARRANQUE

Una vez conectada, la CPU pasa al estado operativo "ARRANQUE" si:
‚óè est√° ajustado el tipo de arranque "Arranque en caliente" y
‚óè la configuraci√≥n de hardware y los bloques de programa son coherentes.

‚ë°

‚ë¢

La memoria no remanente se borra y en el contenido de los DBs no remanentes se
restablecen los valores iniciales de la memoria de carga. La memoria remanente y
el contenido de los DBs remanentes se conservan.
POWER ON ‚Üí STOP

Si se ajusta el tipo de arranque "Sin arranque", la CPU pasa al estado operativo
"STOP" despu√©s de conectar la tensi√≥n de alimentaci√≥n.
La memoria no remanente se borra y en el contenido de los DBs no remanentes se
restablecen los valores iniciales de la memoria de carga. La memoria remanente y
el contenido de los DBs remanentes se conservan.

STOP ‚Üí ARRANQUE

La CPU pasa al estado operativo "ARRANQUE" si:
‚óè la CPU se pone a "RUN" desde la programadora y

‚ë£

‚óè la configuraci√≥n de hardware y los bloques de programa son coherentes.
ARRANQUE ‚Üí STOP

La CPU pasa al estado operativo "STOP" en los casos siguientes:
‚óè Durante el arranque se detecta un error.
‚óè La CPU se pone a "STOP" desde la programadora.

‚ë§
‚ë•

‚óè Se procesa un comando STOP en el OB de arranque.
ARRANQUE ‚Üí RUN

Si el arranque es correcto, la CPU pasa a "RUN".

RUN ‚Üí STOP

La CPU pasa al estado operativo "STOP" en los casos siguientes:
‚óè Se detecta un error que impide seguir trabajando.
‚óè La CPU se pone a "STOP" desde la programadora.
‚óè Se procesa un comando STOP en el programa de usuario.

1506

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estado operativo "ARRANQUE"
Principios b√°sicos del estado operativo "ARRANQUE"
Funci√≥n
Antes de que la CPU empiece a procesar el programa de usuario c√≠clico despu√©s de la
conexi√≥n, se procesa un programa de arranque.
En dicho programa se definen determinadas variables de inicializaci√≥n para el programa
c√≠clico programando de forma adecuada los OBs de arranque. El n√∫mero de OBs de arranque
no est√° prescrito. Es posible no programar ning√∫n OB de arranque, programar s√≥lo uno o bien
varios.

Parametrizaci√≥n del comportamiento de arranque
Existe la posibilidad de determinar si la CPU debe permanecer en estado operativo STOP o
bien si debe realizarse un arranque en caliente. Asimismo, en el grupo "Arranque" de las
propiedades de la CPU se parametriza el comportamiento durante el arranque (RUN o estado
operativo anterior).

Particularidades
Tenga en cuenta los puntos siguientes para el estado operativo "ARRANQUE":
‚óè Los OBs de arranque se procesan. Independientemente del tipo de arranque seleccionado
se procesan todos los OBs de arranque programados.
‚óè No se pueden procesar programas controlados por tiempo.
‚óè El procesamiento de programas controlados por alarmas se limita a:
‚Äì OB 82 (alarma de diagn√≥stico)
‚óè Las salidas de los m√≥dulos est√°n bloqueadas.
‚óè La memoria imagen de proceso no se actualiza, pero es posible un acceso directo de
periferia a las entradas.

Consulte tambi√©n
Principios b√°sicos de los estados operativos de CPUs S7 (P√°gina 1505)
OB de arranque (P√°gina 1572)
Rearranque (en caliente) (P√°gina 1508)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1507

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Rearranque (en caliente)
Funci√≥n
Con el rearranque (en caliente) se borran todas las marcas no remanentes y se restablecen los
valores iniciales de la memoria de carga para todos los contenidos de DB no remanentes. Las
marcas remanentes y contenidos remanentes de DBs se conservan.
El procesamiento del programa empieza con el primer OB de arranque.

Lanzar un rearranque (en caliente)
En los casos siguientes es posible realizar un "Rearranque (en caliente)" desde un comando
de men√∫ de la programadora:
‚óè La CPU est√° en estado operativo "STOP".
‚óè Despu√©s del borrado total
‚óè Despu√©s de cargar un programa coherente y una configuraci√≥n hardware coherente en
estado operativo "STOP" de la CPU.
En caso de "Conexi√≥n (POWER ON)" se lanza un "Rearranque (en caliente)" si se ha
parametrizado el comportamiento de arranque del siguiente modo:
‚óè Tipo de arranque "Arranque en caliente - RUN" (independientemente del estado operativo
de la CPU antes de la desconexi√≥n (POWER OFF)).
‚óè "Arranque en caliente - modo de operaci√≥n antes de desconexi√≥n (POWER OFF)" (en
funci√≥n del estado operativo de la CPU antes de la desconexi√≥n (POWER OFF). La CPU
deb√≠a estar previamente en RUN.)

Consulte tambi√©n
√Åreas de memoria remanentes (P√°gina 1517)

Actividades de arranque
Resumen
La tabla siguiente muestra qu√© actividades realiza la CPU durante el arranque:
Actividades en el orden de procesamiento

en caso de rearranque (en caliente)

Borrar marcas no remanentes

s√≠

Borrar todas las marcas

no

Borrar la memoria imagen de proceso de las salidas

s√≠

Procesamiento de los OBs de arranque

s√≠

Actualizar la memoria imagen de proceso de las entradas

s√≠

Habilitar las salidas tras transici√≥n de estado operativo a "RUN"

s√≠

1508

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejecuci√≥n
La figura siguiente muestra las actividades de la CPU en los estados operativos "STOP",
"ARRANQUE" y "RUN".
El estado de las salidas de la periferia en el primer ciclo del programa de usuario se puede
definir con las medidas siguientes:
‚óè Utilizar m√≥dulos de salida parametrizables para aplicar valores sustitutivos o mantener el
√∫ltimo valor.
‚óè Preasignar las salidas en los OBs de arranque.
Durante el arranque, todos los eventos de alarma se colocan en una cola de espera y se
procesan posteriormente en estado operativo RUN. En estado operativo RUN es posible
procesar alarmas de proceso en cualquier momento.
6723
$55$148(
,QLFLDOL]DUPHPRULDLPDJHQ
GHSURFHVRGHODVHQWUDGDV
%ORTXHDUVDOLGDVGH
SHULIHULD
'HVDFWLYDUPDQWHQHU
¬ºOWLPRYDORURDSOLFDUYDORU
VXVWLWXWLYR
(MHFXWDU2%VGHDUUDQTXH
7UDQVIHULUODVHQWUDGDVGH
SHULIHULDDODPHPRULDLPDJHQ
GHSURFHVRGHODVHQWUDGDV
+DELOLWDUVDOLGDVGH
SHULIHULD
581
(PLWLUPHPRULDLPDJHQGH
SURFHVRGHODVVDOLGDV
7UDQVIHULUODVHQWUDGDVGH
SHULIHULDDODPHPRULDLPDJHQ
GHSURFHVRGHODVHQWUDGDV
(MHFXWDU2%VF¬ØFOLFRV
$FWLYLGDGHVGHOVLVWHPD
RSHUDWLYR FRPXQLFDFL¬µQ
DXWRWHVWHWF

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1509

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Particularidades del arranque
Comportamiento si la configuraci√≥n te√≥rica difiere de la real
La configuraci√≥n te√≥rica se representa mediante la configuraci√≥n cargada en la CPU. La
configuraci√≥n real es la que existe realmente en el sistema de automatizaci√≥n.
Si la configuraci√≥n te√≥rica difiere de la real, en principio la CPU pasa igualmente a RUN.

Cancelaci√≥n de un arranque
Si durante el arranque se producen errores, √©ste se cancela y la CPU permanece en "STOP".
Un arranque no se realiza o se cancela en las condiciones siguientes:
‚óè Si hay insertada una tarjeta SD no v√°lida.
‚óè Si no hay ninguna configuraci√≥n hardware cargada.

Consulte tambi√©n
Resumen de las propiedades de la CPU (P√°gina 1531)

Estado operativo "RUN"
Funci√≥n
En estado operativo "RUN" se procesa el programa c√≠clico, controlado por tiempo y por
alarmas:
‚óè Se emite la memoria imagen de proceso de las salidas.
‚óè Se lee la memoria imagen de proceso de las entradas.
‚óè Se procesa el programa de usuario.
El intercambio activo de datos entre CPUs S7-1200 a trav√©s de la Open User Communication
s√≥lo es posible en estado operativo "RUN".

Procesamiento del programa de usuario
Una vez que la CPU ha le√≠do las entradas, el programa c√≠clico se procesa a partir de la primera
instrucci√≥n y hasta la √∫ltima instrucci√≥n.
Si se ha parametrizado un tiempo m√≠nimo de ciclo, la CPU termina el ciclo una vez transcurrido
el tiempo m√≠nimo de ciclo aunque la ejecuci√≥n del programa de usuario haya requerido menos
tiempo.
Para garantizar que el programa c√≠clico se ejecute en un tiempo determinado, se ajusta un
tiempo de vigilancia del ciclo que se puede adaptar en funci√≥n de las necesidades. Si la
ejecuci√≥n del programa c√≠clico no ha terminado en ese tiempo, el sistema reacciona con un
error de tiempo.

1510

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Otros eventos, p. ej. las alarmas de proceso o las alarmas de diagn√≥stico, pueden interrumpir
el flujo del programa y prolongar el tiempo de ciclo.

Consulte tambi√©n
Principios b√°sicos de los estados operativos de CPUs S7 (P√°gina 1505)
Eventos y OBs (P√°gina 1521)

Estado operativo "STOP"
Funci√≥n
En estado operativo "STOP" no se procesa el programa de usuario. Todas las salidas se
desactivan o reaccionan del modo parametrizado: devuelven el valor sustitutivo parametrizado
o mantienen el √∫ltimo valor emitido, con lo que el proceso controlado pasa a un estado
operativo seguro.
La CPU comprueba los puntos siguientes:
‚óè Hardware, p. ej. si todos los m√≥dulos est√°n disponibles
‚óè Si la CPU se rige por los valores predeterminados o si hay juegos de par√°metros
‚óè Si se cumplen las condiciones marco para el comportamiento de arranque programado

Consulte tambi√©n
Principios b√°sicos de los estados operativos de CPUs S7 (P√°gina 1505)

Principios b√°sicos del borrado total
Funci√≥n
El borrado total de la CPU s√≥lo es posible en estado operativo STOP.
En el borrado total, la CPU pasa a una especie de "estado original". Esto significa que:
‚óè Si existe una conexi√≥n online entre la programadora o el PC y la CPU, se deshar√°.
‚óè Tanto el contenido de la memoria de trabajo como los datos remanentes y no remanentes
se borran.
‚óè El b√∫fer de diagn√≥stico, la hora, la direcci√≥n IP, la configuraci√≥n hardware y las peticiones
actuales de forzado permanente se conservan.
‚óè Seguidamente, la memoria de carga (bloques l√≥gicos y de datos) se copia en la memoria
de trabajo. Esto hace que los bloques de datos ya no tengan valores actuales, sino sus
valores iniciales configurados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1511

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Åreas de memoria
Informaci√≥n importante sobre las SIMATIC Memory Cards
Funcionamiento de la SIMATIC Memory Card
La SIMATIC Memory Card para una S7-1200 es una tarjeta de memoria SD compatible con el
sistema operativo Windows y preformateada por Siemens para el programa de usuario de la
CPU.

ATENCI√ìN
Formateado de la SIMATIC Memory Card
S√≥lo se pueden borrar archivos y carpetas. Si se formatea la SIMATIC Memory Card con
recursos de Windows, p. ej. con un lector de tarjetas de uso com√∫n, la SIMATIC Memory Card
quedar√° inutilizada como medio de almacenamiento para una CPU S7.

Configurar el tipo de tarjeta
La SIMATIC Memory Card se puede utilizar como tarjeta de transferencia, tarjeta de programa
o tarjeta de actualizaci√≥n de firmware.
Para configurar el tipo de tarjeta, inserte la SIMATIC Memory Card en el lector de tarjetas de
la programadora y seleccione la carpeta "Lector de tarjetas/memoria USB" del √°rbol del

1512

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
proyecto. En las propiedades de la Memory Card marcada se puede establecer el tipo de
tarjeta:
‚óè Programa
Si se utiliza como tarjeta de programa, es posible cargar el programa de usuario en la
SIMATIC Memory Card. De esta manera, la memoria de carga interna del dispositivo se
sustituye por la SIMATIC Memory Card y se borra. En este caso, el programa de usuario
puede ejecutarse √≠ntegramente desde la SIMATIC Memory Card. Si se extrae la SIMATIC
Memory Card que contiene el programa de usuario, ya no quedar√° ning√∫n programa.
‚óè Transferencia
Si se utiliza como tarjeta de transferencia, es posible transferir el programa de usuario de
la SIMATIC Memory Card a la memoria de carga interna de la CPU. Despu√©s se puede
extraer la SIMATIC Memory Card.
‚óè Firmware Card
En una SIMATIC Memory Card se puede guardar firmware para m√≥dulos S7-1200. Por este
motivo, es posible realizar una actualizaci√≥n de firmware mediante una SIMATIC Memory
Card especialmente dise√±ada para ello. En la SIMATIC Memory Card tambi√©n puede
guardarse una copia de seguridad del firmware de un m√≥dulo.

Transferir objetos del proyecto a la SIMATIC Memory Card
Si la SIMATIC Memory Card est√° insertada en la programadora o en un lector de tarjetas
externo, se pueden copiar en ella los siguientes objetos desde el √°rbol del proyecto:
‚óè Bloques individuales (posibilidad de selecci√≥n m√∫ltiple)
En este caso, se ofrece una transferencia coherente, es decir, se tiene en cuenta la
interdependencia de los bloques entre s√≠ debida a las llamadas.
‚óè PLC
En este caso, todos los objetos relevantes para la ejecuci√≥n, como los bloques y la
configuraci√≥n hardware, entre otros, se transfieren a la SIMATIC Memory Card, al igual que
durante el proceso de carga.
La transferencia puede realizarse arrastrando y soltando los objetos, o con el comando "Lector
de tarjetas/memoria USB > Escribir en Memory Card" del men√∫ "Proyecto".

Transferir objetos de la SIMATIC Memory Card al proyecto
Los bloques individuales (posibilidad de selecci√≥n m√∫ltiple) se transfieren al proyecto mediante
la funci√≥n Arrastrar y colocar. Las configuraciones hardware no pueden transferirse de la
SIMATIC Memory Card al proyecto.

Actualizar firmware con una SIMATIC Memory Card
Los archivos de firmware m√°s recientes pueden adquirirse en Internet, a trav√©s de las p√°ginas
del "Service & Support":
http://support.automation.siemens.com (http://support.automation.siemens.com/WW/view/es/
34143537)
Guarde los archivos de firmware en el disco duro e inserte la SIMATIC Memory Card en el
lector de tarjetas de su programadora.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1513

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para guardar el archivo en la SIMATIC Memory Card, seleccione la SIMATIC Memory Card en
la carpeta "Lector de tarjetas/memoria USB" del √°rbol del proyecto. Seleccione el men√∫
contextual "Lector de tarjetas/memoria USB > Crear actualizaci√≥n de firmware en Memory
Card".
A continuaci√≥n siga las instrucciones del portal Service & Support para actualizar el firmware
de la CPU.
Con la actualizaci√≥n del firmware, la CPU recibe una nueva versi√≥n del firmware. Si ha utilizado
la CPU en el proyecto, la CPU ya configurada se debe actualizar mediante un cambio de
dispositivo offline con la CPU que contiene la nueva versi√≥n del firmware, y despu√©s adaptar
y cargar el programa y la configuraci√≥n.

Consulte tambi√©n
Informaci√≥n importante sobre las versiones de firmware de la CPU y las versiones de STEP 7
(P√°gina 1595)

Memoria de carga
Funci√≥n
Cada CPU tiene una memoria de carga interna. El tama√±o de dicha memoria depende de cada
CPU.
La memoria de carga interna puede sustituirse externamente por Memory Cards. Si no hay
ninguna Memory Card enchufada, la CPU utiliza la memoria de carga interna; si hay una
insertada, la CPU utiliza la Memory Card como memoria de carga.

Copiar de la memoria de carga interna a la externa
Si en las propiedades de protecci√≥n de la configuraci√≥n de dispositivos de la CPU no se
selecciona el ajuste "Desactivar la copia de la memoria de carga interna a la memoria de carga
externa", la CPU determinar√° el tipo de Memory Card que se inserte:
‚óè Memory Card vac√≠a: una Memory Card vac√≠a no tiene archivo de trabajo (S7_JOB.S7S). Si
se inserta una Memory Card vac√≠a, la CPU agrega un archivo de trabajo del programa.
Seguidamente, copia la memoria de carga interna en la memoria de carga externa (el
archivo de programa de la Memory Card) y borra la memoria de carga interna.
‚óè Tarjeta de programa vac√≠a: una tarjeta de programa vac√≠a contiene un archivo de trabajo de
programa que est√° vac√≠o. En este caso, la CPU copia la memoria de carga interna en la
memoria de carga externa (el archivo de programa de la Memory Card) y borra la memoria
de carga interna.

1514

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si en las propiedades de protecci√≥n de la configuraci√≥n de dispositivos de la CPU se ha
seleccionado el ajuste "Desactivar la copia de la memoria de carga interna a la memoria de
carga externa", la CPU procede del siguiente modo:
‚óè Memory Card vac√≠a: una Memory Card vac√≠a no tiene archivo de trabajo (S7_JOB.S7S). Si
se inserta una Memory Card vac√≠a, la CPU no ejecuta nada. No crea ning√∫n archivo de
trabajo de programa ni copia la memoria de carga interna en la memoria de carga externa
(el archivo de programa de la Memory Card). Tampoco borra la memoria de carga interna.
‚óè Tarjeta de programa vac√≠a: una tarjeta de programa vac√≠a contiene un archivo de trabajo de
programa que est√° vac√≠o. En este caso, la CPU no hace nada. No copia la memoria de
carga interna en la memoria de carga externa (el archivo de programa de la Memory Card).
Tampoco borra la memoria de carga interna.
Si se inserta en la CPU una tarjeta de programa, una tarjeta de transferencia o una tarjeta con
una actualizaci√≥n de firmware, el ajuste de configuraci√≥n "Desactivar la copia de la memoria de
carga interna a la memoria de carga externa" no afecta la forma en la que la CPU eval√∫a la
Memory Card.

Memoria de trabajo
Funci√≥n
La memoria de trabajo es un √°rea de memoria no remanente y almacena las partes del
programa de usuario que son relevantes para la ejecuci√≥n del programa. El programa de
usuario se ejecuta exclusivamente en la memoria de trabajo y sistema.

Memoria de sistema
√Åreas de memoria de sistema
Funci√≥n
La memoria de sistema contiene los elementos de memoria que cada CPU pone a disposici√≥n
del programa de usuario, p. ej. la memoria imagen de proceso de las entradas y salidas y las
marcas.
Si se utilizan las operaciones adecuadas, los datos se direccionan en el programa
directamente al √°rea de operandos correspondiente.
La tabla siguiente muestra las √°reas de operandos de la memoria de sistema:
√Årea de operandos

Descripci√≥n

Memoria imagen de proce‚Äê Al principio del ciclo, la CPU
so de las salidas
escribe los valores de la me‚Äê
moria imagen de proceso de
las salidas en los m√≥dulos de
salida.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Acceso v√≠a unidades del tama√±o siguiente: Notaci√≥n S7
Salida (bit)

Q

Byte de salida

QB

Palabra de salida

QW

Palabra doble de salida

QD

1515

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
√Årea de operandos

Descripci√≥n

Marca

Bloque de datos

Acceso v√≠a unidades del tama√±o siguiente: Notaci√≥n S7
Entrada (bit)

I

Byte de entrada

IB

Palabra de entrada

IW

Palabra doble de entrada

ID

Esta √°rea pone a disposici√≥n Marca (bit)
espacio de memoria para re‚Äê Byte de marcas
sultados intermedios calcula‚Äê
Palabra de marcas
dos en el programa.
Palabra doble de marcas

M

Memoria imagen de proce‚Äê Durante el ciclo, la CPU lee
so de las entradas
las entradas de los m√≥dulos
de entrada y guarda los valo‚Äê
res en la memoria imagen de
proceso de las entradas.

Los bloques de datos guar‚Äê
dan informaci√≥n del progra‚Äê
ma. Existe la posibilidad de
definirlos de modo que todos
los bloques l√≥gicos accedan
a ellos (DBs globales) o que
est√©n asignados a un FB o
SFB determinado (DB instan‚Äê
cia).

MB
MW
MD

Bit de datos

DBX

Byte de datos

DBB

Palabra de datos

DBW

Palabra doble de datos

DBD

Bit de datos locales

L

Byte de datos locales

LB

Palabra de datos locales

LW

Palabra doble de datos locales

LD

Bit de entrada de periferia

<variable>:P

Requisitos: El atributo de blo‚Äê
que "Acceso optimizado al
bloque" no est√° activado.
Datos locales

Esta √°rea de memoria inclu‚Äê
ye los datos locales tempora‚Äê
les de un bloque mientras du‚Äê
re el procesamiento del mis‚Äê
mo.
Requisitos: El atributo de blo‚Äê
que "Acceso optimizado al
bloque" no est√° activado.
Recomendaci√≥n: Acceder a
los datos locales (Temp) sim‚Äê
b√≥licamente.

√Årea de periferia de las en‚Äê Las √°reas de periferia de las
tradas
entradas y salidas permiten
acceder directamente a los
m√≥dulos de entrada y salida
descentralizados.
√Årea de periferia de las sa‚Äê
lidas

Byte de entrada de periferia
Palabra de entrada de periferia
Palabra doble de entrada de periferia
Bit de salida de periferia
Byte de salida de periferia
Palabra de salida de periferia
Palabra doble de salida de periferia

Consulte tambi√©n
B√∫fer de diagn√≥stico (P√°gina 1519)
Principios b√°sicos de las memorias imagen de proceso (P√°gina 1517)
Acceso a las direcciones de periferia (P√°gina 1520)

1516

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Åreas de memoria remanentes
√Åreas de memoria remanentes
Para impedir p√©rdidas de datos en caso de un corte de alimentaci√≥n, algunos datos pueden
marcarse como remanentes. Entonces se guardar√°n en un √°rea de memoria remanente. Un
√°rea de memoria remanente es un √°rea cuyo contenido se conserva en caso de rearranque (en
caliente), es decir, despu√©s de desconectar la tensi√≥n de alimentaci√≥n y volverla a conectar en
una transici√≥n de STOP a RUN.
Es posible definir como remanentes los datos siguientes:
‚óè Marcas: el ancho exacto del √°rea de memoria remanente se define para las marcas en la
tabla de variables PLC o en el plano de ocupaci√≥n.
‚óè Variables de un bloque de funci√≥n (FB): En la interfaz de un FB se pueden definir como
remanentes variables seleccionadas si el acceso optimizado al bloque est√° activado para
este bloque. Si el acceso optimizado al bloque no est√° activado para un FB, los ajustes de
remanencia s√≥lo se pueden efectuar en el bloque de datos de instancia asignado.
‚óè Variables de un bloque de datos global: En un bloque de datos global, se pueden definir
como remanentes algunas o todas las variables del bloque en funci√≥n del ajuste del acceso:
‚Äì Bloque con acceso optimizado: La remanencia se puede ajustar para cada variable
individual.
‚Äì Bloque con acceso est√°ndar: el ajuste de remanencia es v√°lido para todas las variables
del DB; o todas las variables son remanentes o no lo es ninguna.

Consulte tambi√©n
Rearranque (en caliente) (P√°gina 1508)

Memoria imagen de proceso de las entradas y salidas
Principios b√°sicos de las memorias imagen de proceso
Funci√≥n
Si en el programa de usuario se activan las √°reas de operandos de entradas (I) y salidas (Q),
no se consultan o modifican los estados de se√±al en los m√≥dulos de se√±ales digitales, sino un
√°rea de la memoria de sistema de la CPU. Dicha √°rea de memoria se denomina memoria
imagen de proceso.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1517

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ventajas de la memoria imagen de proceso
El acceso a la memoria imagen de proceso tiene la ventaja, en comparaci√≥n con el acceso
directo a los m√≥dulos de entrada y salida, que la CPU dispone de una imagen coherente de las
se√±ales de proceso mientras dura el procesamiento c√≠clico del programa. Si durante el
procesamiento del programa cambia un estado l√≥gico en un m√≥dulo de entrada, dicho estado
se conserva en la memoria imagen de proceso hasta que √©sta se actualiza en el pr√≥ximo ciclo.
Esto permite consultar varias veces una se√±al de entrada en el programa y obtener siempre
una informaci√≥n de entrada coherente.
Asimismo, el acceso a la memoria imagen de proceso requiere bastante menos tiempo que el
acceso directo a los m√≥dulos de se√±ales, porque la memoria imagen de proceso se encuentra
en la memoria interna de la CPU.

Actualizar las memorias imagen de proceso
Ejecuci√≥n
Las √°reas de las memorias imagen de proceso son actualizadas c√≠clicamente por el sistema
operativo, a menos que se haya definido lo contrario en la configuraci√≥n. La actualizaci√≥n de
las memorias imagen de proceso de las entradas y salidas se realiza en el orden siguiente:
1. Se ejecutan las tareas internas del sistema operativo.
2. La memoria imagen de proceso de todas las salidas (IPS) se escribe en las salidas de los
m√≥dulos.
3. El estado de todas las entradas se lee en la memoria imagen de proceso de las entradas
(IPE).
4. Se procesa el programa de usuario con todos los bloques que se han llamado en √©l.
El sistema operativo controla independientemente la escritura de la memoria imagen de
proceso de las salidas en las salidas de los m√≥dulos y la lectura de la memoria imagen de
proceso de las entradas.

Particularidades
Existe la posibilidad de acceder directamente a las entradas y salidas a trav√©s de un acceso
directo a la periferia.
‚óè Si una instrucci√≥n accede directamente a una salida y la direcci√≥n de salida est√° dentro de
la memoria imagen de proceso de las salidas, se corregir√° la memoria imagen de proceso
de la salida en cuesti√≥n.
‚óè Si una instrucci√≥n accede directamente a una salida y la direcci√≥n de salida no est√° dentro
de la memoria imagen de proceso de las salidas, no se corregir√° la memoria imagen de
proceso de la salida en cuesti√≥n.

1518

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de un acceso normal a la periferia a trav√©s de la memoria imagen de proceso
029(
,
0:

(1 (12
,1 287

4
4:

Actualizar QW10 en el √°rea de periferia de las salidas con el valor MW0.

Error de acceso a la periferia al actualizar la memoria imagen de proceso
Si se produce un error al actualizar la memoria imagen de proceso (error de acceso a la
periferia), la CPU reacciona con la reacci√≥n de sistema predeterminada "Ignorar".

Consulte tambi√©n
Direcci√≥n inicial de un m√≥dulo (P√°gina 1520)
Acceso a las direcciones de periferia (P√°gina 1520)
Actividades de arranque (P√°gina 1508)

B√∫fer de diagn√≥stico
Funci√≥n
El b√∫fer de diagn√≥stico forma parte de la memoria de sistema de la CPU. Contiene los errores
detectados por la CPU y los m√≥dulos aptos para diagn√≥stico. Aqu√≠ se incluyen los eventos
siguientes, entre otros:
‚óè Todos los cambios de estado operativo de la CPU (p. ej. conexi√≥n (POWER ON), transici√≥n
al estado operativo STOP, transici√≥n al estado operativo RUN)
‚óè Todas las alarmas de diagn√≥stico
Para la CPU S7-1200, el b√∫fer de diagn√≥stico tiene una capacidad de 50 entradas, de las
cuales se conservan las 10 √∫ltimas (las m√°s recientes) en caso de una transici√≥n de
desconexi√≥n (POWER OFF) - conexi√≥n (POWER ON).
Las entradas s√≥lo se borran al restablecer la configuraci√≥n de f√°brica de la CPU.
El contenido del b√∫fer de diagn√≥stico se lee desde la vista online y de diagn√≥stico.

Consulte tambi√©n
Principios b√°sicos del b√∫fer de diagn√≥stico (P√°gina 3652)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1519

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Årea de datos de la periferia
Direcci√≥n inicial de un m√≥dulo
Definici√≥n
La direcci√≥n inicial es la direcci√≥n de byte m√°s baja de un m√≥dulo. Representa la direcci√≥n
inicial del √°rea de datos de usuario del m√≥dulo.

Configurar las direcciones iniciales de los m√≥dulos
La asignaci√≥n entre las direcciones utilizadas en el programa de usuario y los m√≥dulos se
realiza mediante configuraci√≥n de los m√≥dulos.
Las direcciones iniciales asignadas autom√°ticamente al colocar los m√≥dulos se modifican en
las propiedades del m√≥dulo (grupo "Direcciones E/S...").
Tambi√©n existe la posibilidad de ajustar si las direcciones estar√°n en la memoria imagen de
proceso o no.

Acceso a las direcciones de periferia
Direcciones de periferia
Cuando se inserta un m√≥dulo en la vista de dispositivos, sus datos de usuario se encuentran
en la memoria imagen de proceso de la CPU S7-1200 (ajuste predeterminado). La CPU acepta
autom√°ticamente el intercambio de datos entre el m√≥dulo y el √°rea de memoria imagen de
proceso al actualizarse esta √∫ltima.
Si el programa debe acceder al m√≥dulo directamente y no a trav√©s de la memoria imagen de
proceso, la direcci√≥n de periferia se debe completar con ":P".

Esto sucede, p. ej., en un programa de tiempo cr√≠tico en el que las salidas deben influenciarse
en el mismo ciclo.

1520

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Principios b√°sicos del procesamiento del programa
Denominaci√≥n inglesa de los tipos de OB
Denominaci√≥n inglesa de los tipos de OB
Al crear un OB en el cuadro de di√°logo "Agregar nuevo bloque", por motivos t√©cnicos los tipos
de OB solo pueden indicarse en ingl√©s, con independencia del idioma ajustado para la interfaz
de usuario. Para facilitar su manejo, en la tabla siguiente se muestran junto a los t√©rminos
ingleses las denominaciones en el idioma ajustado para la interfaz de usuario.
Denominaci√≥n inglesa del tipo de OB en el cuadro de di√°logo
"Agregar nuevo bloque".

Denominaci√≥n en el sistema de informaci√≥n

Program cycle

OB de ciclo, OB de ejecuci√≥n c√≠clica del programa, programa
c√≠clico

Startup

OB de arranque

Time delay interrupt

OB de alarma de retardo

Cyclic interrupt

OB de alarma c√≠clica

Hardware interrupt

OB de alarma de proceso

Time error interrupt

OB de error de tiempo

Diagnostic error interrupt

OB de alarma de diagn√≥stico

Pull or plug of modules

OB de enchufe/desenchufe

Rack or station failure

OB de fallo del rack

Time of day

OB de alarma horaria

Status

OB de alarma de estado

Update

OB de alarma de actualizaci√≥n

Profile

OB para la alarma espec√≠fica del fabricante o perfil

MC-Interpolator

OB MC-Interpolator

MC-Servo

OB MC-Servo

MC-PreServo

OB MC-PreServo

MC-PostServo

OB MC-PostServo

Eventos y OBs
Eventos y OB
El sistema operativo de las CPU S7-1200 se basa en eventos. Hay que distinguir entre dos
tipos de eventos:
‚óè Eventos que pueden arrancar un OB
‚óè Eventos que no pueden arrancar OB

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1521

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Un evento que puede arrancar un OB provoca la siguiente reacci√≥n tras su aparici√≥n:
‚óè Si se ha asignado un OB al evento, se llama dicho OB. Si por el momento no es posible
llamar el OB, el evento se incorpora a una cola de espera de acuerdo con su prioridad.
‚óè Si no se ha asignado ning√∫n OB al evento, se ejecuta la reacci√≥n del sistema
predeterminada.
Un evento que no puede iniciar ning√∫n OB provoca la reacci√≥n del sistema predeterminada
para la clase de evento correspondiente tras su aparici√≥n.
Por consiguiente, la ejecuci√≥n del programa de usuario se basa en eventos, en la asignaci√≥n
de OB a los eventos y en el c√≥digo que est√° dentro de los OB o que se llama desde all√≠.
La tabla siguiente ofrece una vista general de los eventos que pueden iniciar un OB, junto con
las clases de eventos y OB correspondientes. Est√° ordenada por la prioridad predeterminada
de los OB. La prioridad 1 es la m√°s baja.
Clase de evento

N.¬∫ del
OB

Programa c√≠clico

Cantidad de
OB

Evento de arranque

Prioridad de OB (ajuste
predeterminado)

1, >= 123 >= 1

Fin de arranque o fin del √∫ltimo OB de
ciclo

1

Arranque

100, >=
123

>=0

Transici√≥n STOP-RUN

1

Alarma horaria

>= 10

M√°x. 2

Se ha alcanzado la hora de arranque

2

Alarma de retardo

>= 20

M√°x. 4

Tiempo de retardo finalizado

‚óè 3
‚óè a partir de la versi√≥n
de firmware V4.0: 3
en OB20, 4 en OB21,
5 en OB22, 6 en
OB23, 3 en OB123 a
32767

Alarma c√≠clica

>= 30

Alarma de proceso

>= 40

Intervalo de tiempo equidistante finaliza‚Äê ‚óè 8
do
‚óè a partir de la versi√≥n
de firmware V4.0: 8
en OB30, 9 en OB31,
10 en OB32, 11 en
OB33, 12 en OB34,
13 en OB35, 14 en
OB36, 16 en OB37,
17 en OB38, 7 en
OB123 a 32767
M√°x. 50
(pueden utili‚Äê
zarse m√°s
con DE‚Äê
TACH y AT‚Äê
TACH)

‚óè Flanco ascendente (m√°x. 16)

18

‚óè Flanco descendente (m√°x. 16)
‚óè HSC: valor de contaje=valor de
referencia (m√°x. 6)

18

‚óè HSC: sentido de contaje modificado
(m√°x. 6)
‚óè HSC: reset externo (m√°x. 6)

Alarma de estado

55

0o1

La CPU ha recibido una alarma de estado 4

Alarma de actualizaci√≥n

56

0o1

La CPU ha recibido una alarma de actua‚Äê 4
lizaci√≥n

1522

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Clase de evento

N.¬∫ del
OB

Cantidad de
OB

Evento de arranque

Prioridad de OB (ajuste
predeterminado)

Alarma espec√≠fica del fabri‚Äê 57
cante o del perfil

0o1

La CPU ha recibido una alarma de fabri‚Äê 4
cante o perfil

Alarma de diagn√≥stico

82

0o1

El m√≥dulo ha detectado un error

5

Alarma de presencia de
m√≥dulo

83

0o1

Extracci√≥n o inserci√≥n de m√≥dulos de la
periferia descentralizada

6

Fallo de rack

86

0o1

Error en el sistema de entrada/salida de
la periferia descentralizada

6

Error de tiempo

80

0o1

‚óè Tiempo de vigilancia del ciclo
excedido

22

‚óè El OB llamado todav√≠a se est√°
ejecutando
‚óè Alarma horaria perdida
‚óè Alarma horaria perdida en STOP
‚óè Desbordamiento de la cola de espera
‚óè P√©rdida de alarmas por sobrecarga
de alarmas

La tabla siguiente describe los eventos que no provocan el arranque de ning√∫n OB y la
reacci√≥n correspondiente del sistema operativo. Est√° ordenada por la prioridad de los eventos.
Clase de evento

Evento

Prioridad de even‚Äê
to

Reacci√≥n del sistema

Enchufe/desenchufe de m√≥du‚Äê Enchufe/desenchufe de un m√≥dulo
los centrales

21

STOP

Error de acceso a la periferia al
actualizar la memoria imagen
de proceso

Error de acceso a la periferia al actualizar la
memoria imagen de proceso

22

Ignorar

Error de programaci√≥n

Error de programaci√≥n en un bloque en el
que se utilizan reacciones proporcionadas
por el sistema operativo (nota: si se ha acti‚Äê
vado el tratamiento de errores local, ser√°
efectivo el tratamiento de errores programa‚Äê
do en el bloque.)

23

RUN

Error de acceso a periferia

Error de acceso a la periferia en un bloque en
el que se utilizan reacciones proporcionadas
por el sistema operativo (nota: si se ha acti‚Äê
vado el tratamiento de errores local, ser√°
efectivo el tratamiento de errores programa‚Äê
do en el bloque.)

24

RUN

Tiempo de vigilancia del ciclo
excedido 2 veces

Tiempo de vigilancia del ciclo excedido 2 ve‚Äê 27
ces

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

STOP

1523

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Asignaci√≥n entre OB y eventos
A excepci√≥n del programa c√≠clico y del programa de arranque, s√≥lo es posible asignar un OB
a un evento. Algunas clases de eventos, como las alarmas de proceso, permiten asignar el
mismo OB a varios eventos.
La asignaci√≥n entre OB y evento se realiza en la configuraci√≥n del hardware. Las asignaciones
realizadas pueden modificarse con las instrucciones ATTACH y DETACH en tiempo de
ejecuci√≥n.

Prioridad de OB y comportamiento de ejecuci√≥n
Las CPU S7-1200 soportan desde la prioridad 1 (m√°s baja) hasta la 27 (m√°s alta). Un OB
obtiene la prioridad de su evento de arranque.
En principio, los OB se procesan por orden de prioridad: Los OB de mayor prioridad se
procesan en primer lugar. Los eventos con la misma prioridad se procesan en el orden de
aparici√≥n.
A partir de la versi√≥n de firmware V4.0 de las CPU S7-1200, en la configuraci√≥n de dispositivos
existe la posibilidad de especificar en las propiedades de la CPU si los OB pueden
interrumpirse o no. Esta parametrizaci√≥n afecta a todos los OB excepto a los OB de ciclo, que
siempre pueden interrumpirse.
Para las CPU S7-1200 con versi√≥n de firmware < V4.0 vale lo siguiente:
‚óè Todos los OB con prioridad >= 2 interrumpen el programa c√≠clico.
‚óè Un OB de prioridad 2 a 25 no puede ser interrumpido por ning√∫n evento de prioridad 2 a 25.
Lo mismo es v√°lido cuando se produce un evento con una prioridad mayor que la del OB
activo en ese momento. Estos eventos se procesan en otro momento.
‚óè La aparici√≥n de un error de tiempo (prioridad 26) interrumpe cualquier otro OB.
Para las CPU S7-1200 con versi√≥n de firmware V4.0 o superior vale lo siguiente:
Si se parametrizan los OB como que no pueden interrumpirse, se procesar√°n siempre hasta
el final, incluso cuando se produzca un evento de prioridad superior durante su ejecuci√≥n. En
particular, esto significa lo siguiente:
‚óè Todos los OB con prioridad >= 2 interrumpen el programa c√≠clico.
‚óè Un OB de prioridad 2 a 25 no puede ser interrumpido por ning√∫n evento. Lo mismo es v√°lido
cuando se produce un evento con una prioridad mayor que la del OB activo en ese
momento, incluso para un error de tiempo. Estos eventos se procesan en otro momento.
Si se parametrizan los OB como que pueden interrumpirse y se produce un evento de prioridad
superior durante la ejecuci√≥n de un OB, dicho OB se interrumpir√° y se procesar√° el OB
correspondiente al evento que se ha producido. Una vez finalizado este √∫ltimo, se seguir√°
procesando el OB interrumpido. En particular, esto significa lo siguiente:
‚óè Todos los OB con prioridad >= 2 interrumpen el programa c√≠clico.
‚óè Un OB de prioridad 2 a 25 puede ser interrumpido por cualquier evento cuya prioridad sea
superior a la del OB en ejecuci√≥n. Lo mismo es v√°lido cuando se produce un error de
tiempo: la aparici√≥n de un error de tiempo (prioridad 26) interrumpe cualquier OB.

1524

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n de arranque del OB
Algunos OBs tienen informaci√≥n de arranque, otros no. Esto se explica con m√°s detalle en la
descripci√≥n del OB correspondiente.

Consulte tambi√©n
Procesamiento del programa basado en eventos (P√°gina 1525)

Procesamiento del programa basado en eventos
Prioridad de OB y comportamiento de ejecuci√≥n
Las CPU S7-1200 soportan desde la prioridad 1 (m√°s baja) hasta la 27 (m√°s alta). Un OB
obtiene la prioridad de su evento de arranque.
Un OB de alarma s√≥lo puede verse interrumpido por un OB de error de tiempo. Lo mismo es
v√°lido cuando se produce un evento con una prioridad mayor que la del OB activo en ese
momento. As√≠ pues, a excepci√≥n del OB de error de tiempo, s√≥lo puede haber activo un OB de
alarma.
Si durante el procesamiento de un OB de alarma se produce otro evento, dicho evento se
incorporar√° a una cola de espera de acuerdo con su prioridad. Los eventos de arranque de una
cola de espera se procesan posteriormente en el orden de aparici√≥n.

Procesamiento del programa en la CPU
Los OB c√≠clicos son interrumpidos por OB de alarma.
Reacciones a eventos que inician un OB de alarma:
‚óè En las CPU hasta la versi√≥n de firmware V3: los OB de alarma solo pueden ser
interrumpidos por OB de error de tiempo.
‚óè En las CPU a partir de la versi√≥n de firmware V4: los OB de alarma pueden ser
interrumpidos por OB de alarma de prioridad superior.
La figura siguiente muestra la secuencia b√°sica en caso de que los OB de alarma no puedan
interrumpirse (comportamiento hasta la versi√≥n de firmware V3):

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1525

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
(YHQWRV

2%VF¬ØFOLFRV

2%VGHDODUPD

2%VGHHUURUGHWLHPSR

Escribir IPS
Leer IPE





Principio
OB 1
Interrupci√≥n


Principio
OB 2xx
Fin

Continuaci√≥n
OB 1
Interrupci√≥n


Principio
OB 2xy
Interrupci√≥n


Principio
OB 80
Time Error
Fin

Continuaci√≥n
OB 2xy
Fin



Principio
OB 2xz
Fin
Continuaci√≥n
OB 1
Fin



‚ë†y‚ë°

‚ë¢
‚ë£

Principio
OB 2xz
Fin

Un evento (p. ej. una alarma de proceso) llama un OB asignado.
Un OB llamado con todos los bloques subordinados se procesa sin interrupci√≥n. Puesto que
no hay ning√∫n otro evento pendiente que provoque el arranque de un OB, despu√©s de pro‚Äê
cesar las alarmas se contin√∫a con el procesamiento del OB c√≠clico.
Un OB de alarma s√≥lo puede verse interrumpido por un OB de error de tiempo (OB 80).
Durante el procesamiento de la alarma se produce otro evento que lanza otra alarma.
Reacci√≥n en las CPU hasta la versi√≥n de firmware V3 inclusive:
Este evento nuevo se incorpora a una cola de espera. S√≥lo cuando ha concluido el proce‚Äê
samiento del OB de alarma actual, los eventos de la cola de espera llaman sucesivamente a
los OB asignados en cada caso, y lo hacen siguiendo las reglas siguientes:
‚óè Los eventos se procesan de acuerdo con su prioridad (empezando por la m√°s alta).
‚óè Los eventos con la misma prioridad se procesan en orden cronol√≥gico.
Reacci√≥n en las CPU a partir de la versi√≥n de firmware V4:
En las CPU con versi√≥n de firmware V4 o superior, la posibilidad de interrupci√≥n se ajusta con
un par√°metro de la CPU. Comportamiento predeterminado: los OB pueden interrumpirse. En
este caso rige lo siguiente: si el nuevo evento tiene una prioridad mayor que el OB en eje‚Äê
cuci√≥n, el OB que se ha iniciado con el nuevo evento interrumpe el OB en ejecuci√≥n.

‚ë§

1526

Si desactiva la opci√≥n, los OB de alarma no se interrumpir√°n.
Los OB c√≠clicos se procesan uno detr√°s de otro.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Indicaciones relativas a la cola de espera
‚óè Para cada clase de prioridad (OB llamados con la misma prioridad) existe una cola de
espera propia. Cada una de esta colas de espera tiene un tama√±o predefinido.
‚óè Si una cola de espera est√° llena y aparece otro evento, el mismo se rechazar√° y se perder√°.
Al mismo tiempo se generar√° un "Evento de error de tiempo". En la informaci√≥n de arranque
del OB de error de tiempo (OB 80) se incluye la informaci√≥n relacionada con el OB que
causa el error. Es posible programar una reacci√≥n adecuada en el OB de error de tiempo,
p. ej. generar un aviso.

Ejemplo de un evento de alarma de proceso
El ejemplo de un m√≥dulo que origina una alarma de proceso describe el funcionamiento del
procesamiento del programa orientado a eventos en la CPU S7-1200.

Eventos de proceso y su prioridad
Los eventos de proceso son eventos que lanza la periferia (p. ej. una entrada digital) y que
provocan la llamada de un OB asignado en la CPU S7-1200. Por ello, los OBs asignados a un
evento de proceso se denominan OBs de alarma de proceso.
Ejemplos de eventos de proceso y su prioridad:
‚óè Evento de proceso "flanco ascendente" o "flanco descendente" de un m√≥dulo que lanza
una alarma: el OB de alarma de proceso que se inicia seguidamente tiene siempre la
prioridad 5.
‚óè Eventos de proceso del contador r√°pido
‚Äì El valor de contaje equivale al valor de referencia
‚Äì Modificar sentido de contaje
‚Äì Reset externo del contador r√°pido
El OB de alarma de proceso que se inicia seguidamente tiene siempre la prioridad 6.
La figura siguiente muestra la evoluci√≥n temporal del procesamiento de una alarma de
proceso: En caso de eventos de alarma de proceso inmediatamente consecutivos, el segundo
evento que dispara una alarma de proceso se retendr√° en la cola de espera hasta que est√©
procesado el primer OBx. Este OBx deber√° procesarse primero para que el siguiente evento
que dispara una alarma de proceso pueda arrancar el correspondiente OBx. Los dem√°s
eventos que disparen alarmas de proceso se a√±adir√°n asimismo a la cola de espera siguiendo
este principio.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1527

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
&38

0¬µGXOR


3ULQFLSLR



2%[

',


&38

0¬µGXOR
:$,7


3ULQFLSLR

2%[

',


&38

0¬µGXOR
:$,7


3ULQFLSLR
2%[
)LQ


',


3ULQFLSLR
2%[

Procesamiento de una alarma de proceso

‚ë†
‚ë°
‚ë¢

1528

Un evento que lanza una alarma de proceso, p. ej. un flanco ascendente en la entrada,
llama a un OB asignado a dicho evento.
Si se produce otro evento que lanza una alarma de proceso mientras se procesa el OB,
dicho evento se incorporar√° a una cola de espera.
El nuevo evento que lanza una alarma de proceso inicia el OB de alarma de proceso
asignado a dicho evento.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Asignar el evento que lanza la alarma
El evento que lanza la alarma se asigna a un OB en la vista de dispositivos, propiedades de las
entradas.
‚óè Un evento que lanza una alarma s√≥lo puede asignarse a un OB.
‚óè Un OB puede estar asignado a varios eventos que lanzan alarmas.
As√≠, p. ej., es posible asignar tanto flancos ascendentes como descendentes al mismo OB
de alarma, con el fin de reaccionar directamente y del mismo modo a cada cambio de la
se√±al de entrada.
‚óè El OB iniciado puede interrumpir un OB de ciclo en cada instrucci√≥n. La coherencia en los
accesos a datos se garantiza hasta el tama√±o de palabra doble.
‚óè Seg√∫n el m√≥dulo es posible parametrizar diferentes eventos que lanzan alarmas, p. ej. un
flanco ascendente y uno descendente en la entrada.
‚óè La asignaci√≥n entre eventos que lanzan alarmas y el OB iniciado se define al configurar el
m√≥dulo que lanza alarmas. Sin embargo, la instrucci√≥n DETACH permite deshacer dicha
asignaci√≥n en el OB de alarma de proceso iniciado y la instrucci√≥n ATTACH, asignar otro
OB al mismo evento. Esto permite reaccionar con flexibilidad a se√±ales de proceso
externas.

Ajustar el comportamiento operativo
Modificar las propiedades de los m√≥dulos
Configuraci√≥n est√°ndar
Todos los componentes de hardware parametrizables est√°n ajustados de f√°brica a los valores
adecuados para las aplicaciones est√°ndar. Estos valores est√°ndar permiten utilizar los
componentes sin tener que realizar m√°s ajustes.
No obstante, el comportamiento y las propiedades de los componentes de hardware pueden
parametrizarse y, con ello, adaptarse a las necesidades y particularidades de la instalaci√≥n.
Los componentes de hardware parametrizables son, p. ej., CPUs, m√≥dulos de comunicaci√≥n
y algunos m√≥dulos de se√±ales anal√≥gicas y digitales.

Ajustar y cargar par√°metros
Si se ha seleccionado un componente de hardware en la vista de dispositivos o redes, las
propiedades se ajustan en la ventana de inspecci√≥n. Al guardar la configuraci√≥n de un
dispositivo junto con sus par√°metros, se generan datos que deben cargarse en la CPU. Desde
all√≠, dichos datos se transfieren a los m√≥dulos correspondientes durante el arranque.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1529

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Propiedades de las CPUs
Para el comportamiento del sistema son muy importantes las propiedades de las CPUs. Una
CPU permite ajustar, p. ej.:
‚óè Interfaces
‚óè Entradas y salidas
‚óè Contadores r√°pidos
‚óè Generadores de impulsos
‚óè Comportamiento de arranque
‚óè Hora
‚óè Nivel de protecci√≥n
‚óè Marcas de sistema y ciclo
‚óè Tiempo de ciclo
‚óè Carga de comunicaci√≥n
Las posibilidades de entrada indican qu√© puede ajustarse y con qu√© rangos de valores. Los
campos no editables est√°n atenuados o no aparecen en la ventana de propiedades.

Requisitos
Los componentes de hardware cuyas propiedades deben modificarse se han dispuesto en un
rack.

Procedimiento
Para modificar las propiedades y los par√°metros de los componentes de hardware, proceda
del siguiente modo:
1. En la vista de dispositivos o redes seleccione el componente de hardware o la interfaz que
desee editar.
2. Edite los ajustes del objeto seleccionado:
‚Äì En la vista general de dispositivos se editan las direcciones y los nombres, p. ej.
‚Äì En la ventana de inspecci√≥n existen otras posibilidades de ajuste adicionales.
No es necesario confirmar las entradas, los valores modificados se aplican inmediatamente.

1530

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Propiedades de la CPU
Resumen de las propiedades de la CPU
Sinopsis
La tabla siguiente muestra las propiedades de la CPU en s√≠ntesis:
Grupo

Propiedades

Descripci√≥n

General

Informaci√≥n del proyecto

Informaci√≥n general que describe la CPU enchufada. Es posible
modificar todos los datos excepto el n√∫mero de slot.

Informaci√≥n del cat√°logo

√önicamente informaci√≥n legible del cat√°logo de hardware para
esta CPU.

Identificaci√≥n y mantenimiento

Para guardar informaci√≥n espec√≠fica de la aplicaci√≥n, como el
nombre de la instalaci√≥n y el lugar de instalaci√≥n.

Sumas de verificaci√≥n

Para comprobar la identidad e integridad de los programas PLC.
Durante la compilaci√≥n, los bloques de la carpeta de bloques y
las listas de textos se marcan autom√°ticamente con sumas de
verificaci√≥n un√≠vocas. Es posible determinar f√°cilmente si el pro‚Äê
grama que se est√° ejecutando en la CPU es el mismo que se
hab√≠a cargado hace tiempo o si ha cambiado entretanto. Para
leer la suma de verificaci√≥n en tiempo de ejecuci√≥n en el progra‚Äê
ma se dispone de la instrucci√≥n "GetChecksum".
V√©ase: Comparaci√≥n de programas PLC a partir de las sumas de
verificaci√≥n

Interfaz PROFINET

General

Nombre y comentario de la interfaz PROFINET. El nombre est√°
limitado a 110 caracteres.

Direcciones Ethernet

Selecci√≥n de si la interfaz PROFINET est√° conectada en red. Si
ya se han creado subredes en el proyecto, estar√°n disponibles
para su selecci√≥n en la lista desplegable. En caso contrario, es
posible crear una subred nueva con el bot√≥n "Agregar nueva
subred".
El protocolo IP incluye datos sobre la direcci√≥n IP, la m√°scara de
subred y el uso de un router IP en la subred. Si se utiliza un router
IP, es imprescindible indicar la direcci√≥n IP del mismo.
V√©ase: Asignaci√≥n de direcciones y nombres para dispositivos
PROFINET

Opciones avanzadas

Nombre, comentario y otras posibilidades de ajuste del puerto de
la interfaz Ethernet.

Sincronizaci√≥n horaria

Ajustes de la sincronizaci√≥n horaria en formato de hora NTP.
NTP (network time protocol) es un procedimiento general para
sincronizar relojes de sistema en redes locales y globales.
Con el procedimiento NTP, la interfaz de la CPU env√≠a regular‚Äê
mente consultas de hora (en modo cliente) al servidor NTP de la
subred (LAN) cuyas direcciones deben parametrizarse aqu√≠. So‚Äê
bre la base de las respuestas del servidor, se determina la hora
m√°s exacta y fiable y se sincroniza. La ventaja de este procedi‚Äê
miento es la posibilidad de sincronizar la hora m√°s all√° de los
l√≠mites de la subred. La precisi√≥n depende de la calidad del ser‚Äê
vidor NTP utilizado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1531

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

DI#/DO#

General

Nombre y comentario de las entradas digitales integradas en la
CPU.

Entradas digitales

Las entradas digitales permiten ajustar retardos a la entrada. Di‚Äê
chos retardos se ajustan por grupos (4 entradas cada uno).
En cada entrada digital puede activarse la detecci√≥n de un flanco
ascendente y uno descendente. A este evento se le puede asig‚Äê
nar un nombre y una alarma de proceso.
En funci√≥n de la CPU es posible activar tomas de impulso en
distintas entradas. Si la toma de impulso est√° activada, los im‚Äê
pulsos que sean m√°s cortos que el tiempo de ciclo del programa
tambi√©n detectar√°n los flancos.

Salidas digitales

Todas las salidas digitales permiten ajustar la reacci√≥n en caso
de cambio de estado operativo de RUN a STOP:
El estado se congela (equivale a mantener el √∫ltimo valor) o bien
se ajusta un valor sustitutivo ("0" o "1").

AI#

Direcciones E/S

Se definen el √°rea de las direcciones de entrada y salida as√≠
como la memoria imagen de proceso.

General

Nombre y comentario de las entradas anal√≥gicas integradas en
la CPU.

Entradas anal√≥gicas

En la reducci√≥n de ruido, las frecuencias perturbadoras de la
frecuencia indicada (en Hz) se suprimen por medio del tiempo de
integraci√≥n ajustado.
Direcci√≥n de canal, tipo de medici√≥n, rango de tensi√≥n, alisa‚Äê
miento y diagn√≥stico de rebase se ajustan en el grupo "Canal #".
El tipo de medici√≥n est√° ajustado fijamente a tensi√≥n, entre 0 y 10
V.
Gracias al alisamiento de los valores anal√≥gicos, se prepara una
se√±al anal√≥gica estable para el procesamiento posterior. El ali‚Äê
samiento de los valores anal√≥gicos es aconsejable en caso de
cambios lentos en los valores medidos, p. ej. en las mediciones
de temperatura. Los valores medidos se alisan mediante filtrado
digital. Para el filtrado, el m√≥dulo calcula valores medios a partir
de un n√∫mero definido de valores anal√≥gicos convertidos (digita‚Äê
lizados). El nivel parametrizado (d√©bil, medio, fuerte) determina
el n√∫mero de se√±ales anal√≥gicas que se tomar√°n para calcular el
valor medio.
Si el diagn√≥stico de rebase est√° activado, se generar√° un evento
de diagn√≥stico en caso de rebase.

Contadores r√°pidos
(HSC)

Direcciones E/S

Se definen el √°rea de las direcciones de entrada as√≠ como la
memoria imagen de proceso.

Contadores r√°pidos (HSC)#

Los contadores r√°pidos suelen emplearse como accionamiento
de contadores de maniobras.
V√©ase: Configurar contadores r√°pidos (P√°gina 1544)

1532

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Generadores de im‚Äê
pulsos (PTO/PWM)

PTO#/PWM#

Un generador de impulsos se activa y recibe informaci√≥n del pro‚Äê
yecto.
Para parametrizar un generador de impulsos activado se ajusta
el uso como PWM (Pulse Width Modulation; "modulaci√≥n del an‚Äê
cho de pulso") o como PTO (Pulse Train Output; "secuencia de
pulso").
Para PWM hay que definir la fuente de salida, base de tiempo,
formato de duraci√≥n de impulso, tiempo de ciclo y duraci√≥n de
impulso inicial. Como salida de hardware est√° prevista una salida
de impulso. La salida PWM es controlada por la instrucci√≥n
CTRL_PWM, v√©ase CTRL_PWM.
Para PTO hay que indicar el origen de la salida. Como salidas de
hardware est√°n previstas una salida de impulso y una de sentido.
Los PTO se utiliza junto con un HSC en el tipo de contaje "Eje de
movimiento" y se controlan con el objeto tecnol√≥gico Motion Con‚Äê
trol (v√©ase la palabra clave "Motion Control S7-1200")
En las direcciones E/S y de diagn√≥stico se muestra la identifica‚Äê
ci√≥n de hardware y, si se selecciona la funci√≥n PWM, tambi√©n es
posible seleccionar el √°rea de las direcciones de salida y la me‚Äê
moria imagen de proceso.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1533

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Arranque

Arranque tras conexi√≥n (POWER Ajuste del comportamiento de arranque tras una transici√≥n de
ON)
desconexi√≥n (POWER OFF)/conexi√≥n (POWER ON).

Descripci√≥n

V√©ase: Principios b√°sicos del estado operativo "ARRANQUE"
(P√°gina 1507)
Comparaci√≥n entre configura‚Äê
ci√≥n te√≥rica y real

Define el comportamiento de arranque de la CPU en caso de que
la configuraci√≥n real de la estaci√≥n S7-1200 no se corresponda
con la configuraci√≥n te√≥rica:
‚óè Arranque de la CPU solo con compatibilidad
‚óè Arranque de la CPU aunque haya diferencias
Con el ajuste "Arranque de la CPU solo con compatibilidad" debe
haber un m√≥dulo en un slot configurado que sea compatible con
el m√≥dulo configurado.
Compatible significa que el m√≥dulo existente concuerde en n√∫‚Äê
mero de entradas y salidas as√≠ como en las caracter√≠sticas el√©c‚Äê
tricas y funcionales. Un m√≥dulo compatible debe poder reempla‚Äê
zar por completo a un m√≥dulo configurado; podr√° hacer m√°s co‚Äê
sas, pero no menos.
Ejemplo del ajuste "Arranque de la CPU solo con compatibilidad":
Una CPU puede ser un sustituto compatible de una CPU del
mismo tipo con una versi√≥n de firmware inferior. Un m√≥dulo de
entrada con 32 entradas digitales puede ser un sustituto compa‚Äê
tible de un m√≥dulo de se√±ales con 16 entradas digitales. La CPU
arranca si est√° enchufado el m√≥dulo configurado o un m√≥dulo
compatible. Si hay enchufado un m√≥dulo no compatible, la CPU
no arranca.
Ejemplo del ajuste "Arranque de la CPU aunque haya diferen‚Äê
cias": En lugar de un m√≥dulo de entradas digitales configurado se
enchufa un m√≥dulo de salidas anal√≥gicas o bien el slot se deja
vac√≠o. La CPU arranca aunque las entradas configuradas no es‚Äê
t√©n accesibles.
Tenga en cuenta que en este caso el programa de usuario no
funcionar√° correctamente, por lo que deben tomarse las medidas
adecuadas.

Tiempo de parametrizaci√≥n para Determina el intervalo de tiempo m√°ximo (est√°ndar: 60000 ms)
la periferia centralizada y descen‚Äê en que deben cargarse la periferia centralizada y la descentrali‚Äê
tralizada
zada. (La CPU suministra a los m√≥dulos CM y CP tensi√≥n y pa‚Äê
r√°metros de comunicaci√≥n durante el arranque. Este tiempo de
parametrizaci√≥n permite un intervalo durante el cual los m√≥dulos
E/S conectados a CM o CP deben cargarse).
La CPU pasa a RUN en cuanto las periferias centralizada y des‚Äê
centralizada est√°n cargadas y listas para el servicio, indepen‚Äê
dientemente del par√°metro "Tiempo de parametrizaci√≥n para pe‚Äê
riferias centralizada y descentralizada". Si las periferias centrali‚Äê
zada y descentralizada no est√°n cargadas dentro de este inter‚Äê
valo de tiempo, la CPU pasa a RUN sin las periferias centralizada
y descentralizada.

1534

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Ciclo

Tiempo de ciclo m√°ximo y m√≠ni‚Äê
mo.

Definici√≥n de un tiempo de ciclo m√°ximo y de un tiempo de ciclo
m√≠nimo fijo.
Si el tiempo de ciclo excede el tiempo de vigilancia del ciclo, la
CPU pasa al estado operativo STOP.
V√©ase: Tiempo de ciclo y tiempo de vigilancia del ciclo (P√°gi‚Äê
na 1537)

Carga por comunica‚Äê
ci√≥n

Porcentaje m√°ximo del ciclo para
la comunicaci√≥n (en %)

Controla hasta cierto punto la duraci√≥n de los procesos de co‚Äê
municaci√≥n que tambi√©n prolongan el tiempo de ciclo. Los pro‚Äê
cesos de comunicaci√≥n pueden ser, p. ej.: transferencia de datos
a otra CPU o carga de bloques (lanzada v√≠a PC).
V√©ase: Carga de ciclo por comunicaci√≥n (P√°gina 1539)

Marcas de sistema y
marcas de ciclo

Bits de marcas de sistema y bits
de marcas de ciclo

Las marcas de sistema se utilizan en las consultas siguientes:
‚óè ¬øEl ciclo actual es el primer ciclo despu√©s de desconexi√≥n y
conexi√≥n (POWER OFF/ON)?
‚óè ¬øHan cambiado los estados de diagn√≥stico respecto del ciclo
anterior?
‚óè Consulta en "1" (high)
‚óè Consulta en "0" (low)
Las marcas de ciclo cambian peri√≥dicamente de valor, en inter‚Äê
valos definidos.
V√©ase: Uso de marcas de sistema (P√°gina 1556)
V√©ase: Uso de marcas de ciclo (P√°gina 1557)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1535

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Servidor web

-

Activa y configura la funci√≥n del servidor web.
V√©ase: Activar el servidor web (P√°gina 1466)

Actualizaci√≥n autom√°tica

Env√≠a peri√≥dicamente la p√°gina web solicitada con los datos ac‚Äê
tuales de la CPU al navegador web. La duraci√≥n de los per√≠odos
se introduce en "Intervalo de actualizaci√≥n". La actualizaci√≥n au‚Äê
tom√°tica solo se puede activar cuando el servidor web est√° acti‚Äê
vado.
V√©ase: Activar la actualizaci√≥n autom√°tica (P√°gina 1466)

Administraci√≥n de usuarios

Aqu√≠ se introducen nombres de usuario con sus derechos de
acceso.
‚óè Cualquiera: usuario predefinido, cuyos derechos de acceso
se asignan desde una lista desplegable. El usuario
"Cualquiera" no necesita iniciar la sesi√≥n introduciendo una
contrase√±a en un acceso web.
‚óè User#: nombre editable de un usuario al que se asignan
derechos de acceso y la contrase√±a correspondiente.
Cuando se hace clic en una fila debajo de "Cualquiera", se
muestra un nombre predeterminado, que se puede cambiar.
Se pueden asignar distintos derechos de acceso a cualquier
usuario a trav√©s de una lista desplegable.
Hay derechos de acceso que est√°n acoplados entre s√≠. Ejemplo:
Si activa el derecho de acceso "Actualizar el firmware", se acti‚Äê
var√°n autom√°ticamente los derechos de acceso "Cambiar esta‚Äê
do operativo" y "...consultar diagn√≥stico". Estos derechos son
necesarios para poder ejecutar una actualizaci√≥n de firmware
desde el servidor web.
V√©ase: Lista de usuarios (P√°gina 1467)

Tablas de observaci√≥n

Permite crear tablas de observaci√≥n y define el acceso a las mis‚Äê
mas.

P√°ginas web definidas por el
usuario

Permite acceder a p√°ginas web de libre configuraci√≥n de la CPU
con un navegador web.
V√©ase: Informaci√≥n importante sobre p√°ginas de usuario (P√°gi‚Äê
na 1471)

P√°gina de acceso

Permite seleccionar la p√°gina de acceso.

Vista general de las interfaces

Representaci√≥n en forma de tabla de todos los m√≥dulos con sus
interfaces Ethernet para la funcionalidad de servidor web de este
dispositivo.
Aqu√≠ se permite o no el acceso al servidor web desde la interfaz
correspondiente para cada interfaz Ethernet del dispositivo
(CPU, CP o CM).

Idiomas de la interfaz -

Si desea utilizar traducciones de textos del proyecto para el ser‚Äê
vidor web, aqu√≠ debe asignar el idioma de proyecto deseado a los
idiomas para el servidor web (el n√∫mero depende de la CPU). De
este modo se definen los idiomas del proyecto que se mostrar√°n
al acceder al servidor web.
Ejemplo: Se asigna al idioma "alem√°n" del servidor web el idioma
de proyecto "Alem√°n (Luxemburgo)" seleccion√°ndolo en la lista
desplegable. Para poder seleccionar el idioma del proyecto en la
lista desplegable, este debe estar activado en "Idiomas y recur‚Äê
sos > Idiomas del proyecto" en el √°rbol del proyecto.

1536

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Grupo

Propiedades

Descripci√≥n

Hora

Hora local y horario de verano

Ajuste de la zona horaria en la que se utiliza la CPU y ajuste del
cambio entre horario de verano y de invierno.

Protecci√≥n y seguri‚Äê
dad

Protecci√≥n y contrase√±a del ac‚Äê
ceso de lectura/escritura

Ajuste de la protecci√≥n contra lectura o escritura y de la contra‚Äê
se√±a de acceso a la CPU.
V√©ase: Posibilidades de ajuste para el nivel de protecci√≥n (FW
V1 a V3) (P√°gina 1558)
V√©ase: Posibilidades de ajuste para la protecci√≥n (FW a partir de
V4) (P√°gina 1559)

Control de configura‚Äê
ci√≥n

Mecanismos de conexi√≥n

Activaci√≥n del acceso a trav√©s de una comunicaci√≥n PUT/GET.

Evento de seguridad

Activaci√≥n de avisos de grupo en caso de eventos de seguridad
y definici√≥n de un per√≠odo de vigilancia (intervalo).

Memoria de carga externa

Desactiva la copia de la memoria de carga (P√°gina 1514) interna
a la externa.

-

Activa el control de configuraci√≥n. Ello permite cambiar la confi‚Äê
guraci√≥n en el programa de usuario hasta cierto punto.
V√©ase: Control de configuraci√≥n

Recursos de cone‚Äê
xi√≥n

-

Ofrece una vista general de los recursos reservados y din√°micos
asignados para las conexiones de la CPU. En la vista online se
muestran tambi√©n los recursos actualmente en uso.
V√©ase: Consumo de recursos de conexi√≥n

Sin√≥ptico de direccio‚Äê nes

Representaci√≥n en forma de tabla de todas las direcciones utili‚Äê
zadas en la CPU para las entradas y salidas integradas as√≠ como
para los m√≥dulos enchufados. Las direcciones que no utiliza nin‚Äê
g√∫n m√≥dulo se representan como hueco.
Es posible filtrar la vista por
‚óè Direcciones de entrada
‚óè Direcciones de salida
‚óè Huecos en las direcciones

Consulte tambi√©n
Parametrizar OBs de alarma de proceso (P√°gina 1593)
Acceso a las direcciones de periferia (P√°gina 1520)
Particularidades del arranque (P√°gina 1510)

Tiempo de ciclo y tiempo de vigilancia del ciclo
Funci√≥n
El tiempo de ciclo es el tiempo que necesita el sistema operativo para el procesamiento c√≠clico
del programa y para todas las partes del programa que interrumpen dicho ciclo. El
procesamiento del programa se interrumpe debido a:
‚óè Errores de tiempo y errores 2xMaxCycleTime
‚óè Actividades del sistema, p. ej. actualizaci√≥n de la memoria imagen de proceso

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1537

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Por consiguiente, el tiempo de ciclo (TC) no es igual en todos los ciclos.
La figura siguiente muestra un ejemplo de tiempos de ciclo diferentes (TC1 ‚â† TC2) para CPU
S7-1200:
7LHPSRVGHFLFORGLIHUHQWHVHQ&38V6
&LFORDFWXDO

&LFORVLJXLHQWH

7]

&LFORVLJXLHQWH

7]

2%

$FWXDOL]DFL¬µQ
GHOD0,36

$FWXDOL]DFL¬µQ
GHOD0,3(

2%

2% 2% $FWXDOL]DFL¬µQ $FWXDOL]DFL¬µQ
GHOD0,36
GHOD0,3(

2% 2% $FWXDOL]DFL¬µQ
GHOD0,36

0,3(0HPRULDLPDJHQGHSURFHVRGHODVHQWUDGDV
0,360HPRULDLPDJHQGHSURFHVRGHODVVDOLGDV

En el ciclo actual, el OB c√≠clico utilizado (p. ej. el OB 1) es interrumpido por un error de tiempo
(p. ej. el OB 80). A continuaci√≥n del OB c√≠clico se procesa el siguiente OB del ciclo, el 201.

Tiempo de vigilancia del ciclo
El sistema operativo vigila si el tiempo de ejecuci√≥n del programa c√≠clico alcanza un l√≠mite
superior configurable, el tiempo de ciclo m√°ximo. Dicho tiempo de vigilancia se reinicia
llamando la instrucci√≥n RE_TRIGR en cualquier punto del programa.
Si el programa c√≠clico excede el tiempo de vigilancia del ciclo, el sistema operativo intenta
arrancar el OB de error de tiempo (OB 80). Si el OB no est√° disponible, la CPU S7-1200
presenta el comportamiento siguiente:
‚óè CPU con versi√≥n de firmware V1.x a V3.x: la CPU permanece en RUN.
‚óè CPU con versi√≥n de firmware V4.x o superior: la CPU pasa al estado operativo STOP.
Adem√°s de vigilar el tiempo de ejecuci√≥n para asegurar que no se excede el tiempo de
vigilancia del ciclo, tambi√©n se garantiza el mantenimiento de un tiempo de ciclo m√≠nimo. Para
ello, el sistema operativo retarda el inicio de un ciclo nuevo hasta que se ha alcanzado el
tiempo de ciclo m√≠nimo. Durante este tiempo de espera se procesan eventos nuevos y
servicios del sistema operativo.
Si el tiempo de vigilancia del ciclo se excede por segunda vez, p. ej., mientras se procesa el OB
de error de tiempo (error 2xMaxCycleTime), la CPU pasa al estado operativo STOP.

Consulte tambi√©n
OB de error de tiempo (P√°gina 1582)

1538

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Carga de ciclo por comunicaci√≥n
Funci√≥n
El tiempo de ciclo de la CPU se prolonga debido a procesos de comunicaci√≥n. Dichos procesos
de comunicaci√≥n incluyen, p. ej.:
‚óè Transferencia de datos a otra CPU
‚óè Carga de bloques lanzada por una programadora
La duraci√≥n de estos procesos de comunicaci√≥n se controla hasta cierto punto con el
par√°metro de la CPU "Carga de ciclo por comunicaci√≥n".
Adem√°s de los procesos de comunicaci√≥n, las funciones de test tambi√©n prolongan el tiempo
de ciclo. En este caso, el par√°metro "Carga de ciclo por comunicaci√≥n" influye en la duraci√≥n.

Funcionamiento del par√°metro
En el par√°metro "Carga de ciclo por comunicaci√≥n" se indica el porcentaje de capacidad de
procesamiento de la CPU que debe estar disponible para los procesos de comunicaci√≥n. La
CPU asigna continuamente dicha capacidad a la comunicaci√≥n. Si la comunicaci√≥n no
requiere esta capacidad de procesamiento, √©sta queda a disposici√≥n del procesamiento del
programa.

Repercusi√≥n en el tiempo de ciclo real
El uso del par√°metro "Carga de ciclo por comunicaci√≥n" prolonga el tiempo de ciclo del bloque
de organizaci√≥n c√≠clico (p. ej. OB 1) en un factor que se calcula seg√∫n la f√≥rmula siguiente:

&DUJDGHFLFORSRUFRPXQLFDFL¬µQ

La f√≥rmula no tiene en cuenta la influencia de eventos as√≠ncronos, como alarmas de proceso
o c√≠clicas, en el tiempo de ciclo.
Si el tiempo de ciclo se prolonga debido a procesos de comunicaci√≥n, tambi√©n es posible que
se produzcan m√°s eventos as√≠ncronos dentro del tiempo de ciclo del bloque de organizaci√≥n
c√≠clico. Esto todav√≠a prolonga m√°s el ciclo. La prolongaci√≥n depende de cu√°ntos eventos
aparezcan y de cu√°nto dure su procesamiento.

Ejemplo 1 - no hay eventos as√≠ncronos adicionales:
Si se ajusta el par√°metro "Carga de ciclo por comunicaci√≥n" al 50 %, el tiempo de ciclo del
bloque de organizaci√≥n c√≠clico puede duplicarse.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1539

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo 2 - hay eventos as√≠ncronos adicionales:
Con un tiempo de ciclo puro de 500 ms, el tiempo de ciclo real puede ascender hasta 1000 ms
debido a una carga de comunicaci√≥n del 50 %, siempre que la CPU tenga suficientes
peticiones de comunicaci√≥n para procesar. Si, paralelamente, se procesa una alarma c√≠clica
cada 100 ms con un tiempo de procesamiento de 20 ms, dicha alarma sin carga de
comunicaci√≥n prolongar√≠a el ciclo en un total de 5*20 ms = 100 ms, es decir, el tiempo de ciclo
real ser√≠a de 600 ms. Puesto que una alarma c√≠clica tambi√©n interrumpe la comunicaci√≥n,
repercute en el tiempo de ciclo con 10 * 20 ms con una carga de comunicaci√≥n del 50 %, es
decir, en este caso el tiempo de ciclo real no ser√≠a de 1000 ms, sino de 1200 ms.
Nota
Tenga en cuenta las indicaciones siguientes:
‚óè Verifique las repercusiones de un cambio de valor del par√°metro "Carga de ciclo por
comunicaci√≥n" en el funcionamiento de la instalaci√≥n.
‚óè La carga por comunicaci√≥n debe tenerse en cuenta al ajustar el tiempo de ciclo m√≠nimo,
puesto que de lo contrario se pueden producir errores de tiempo.

Recomendaciones
‚óè Aumente el valor s√≥lo si la CPU se utiliza principalmente para fines de comunicaci√≥n y el
programa de usuario es de duraci√≥n no cr√≠tica.
‚óè En todos los dem√°s casos, el valor s√≥lo deber√≠a reducirse.

Funciones de reloj
Principios b√°sicos de las funciones de reloj
Todas las CPUs S7-1200 disponen de un reloj interno. El respaldo permite visualizar la hora
correcta en caso de interrupci√≥n de la fuente de alimentaci√≥n durante un m√°ximo de 10 horas.

Formato de hora
El reloj muestra siempre la hora con una resoluci√≥n de 1 milisegundo y la fecha con el d√≠a de
la semana. Se tiene en cuenta el cambio de hora provocado por el horario de verano.

1540

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustar y leer la hora
Ajuste y lectura de la hora con instrucciones
La hora y la fecha del reloj de la CPU se pueden ajustar, iniciar y leer en el programa de usuario
por medio de las instrucciones siguientes:
‚óè Ajustar la hora: "WR_SYS_T"
‚óè Leer la hora "RD_SYS_T"
‚óè Leer la hora local "RD_LOC_T"
‚óè Ajustar zona horaria "SET_TIMEZONE"

Ajuste manual
Tambi√©n es posible leer y ajustar la hora manualmente en la vista online y de diagn√≥stico, en
"Funciones > Ajustar hora".

Parametrizar el reloj
Par√°metros del reloj
Mediante los par√°metros del reloj se ajusta lo siguiente:
‚óè Activar sincronizaci√≥n horaria v√≠a servidor NTP
Active esta casilla de verificaci√≥n si hay que sincronizar el reloj interno con el procedimiento
de sincronizaci√≥n NTP.
‚óè Servidor de hora de la red
Deben configurarse las direcciones IP de hasta cuatro servidores NTP.
‚óè Intervalo de actualizaci√≥n
El intervalo de actualizaci√≥n define el espacio de tiempo entre las consultas de hora.

Contadores r√°pidos
Generalidades de los contadores r√°pidos
Introducci√≥n
Los contadores r√°pidos suelen emplearse como accionamientos de contadores de maniobras
en los que un eje que funciona a una velocidad constante est√° equipado con un encoder
incremental de posici√≥n. Dicho encoder procura un n√∫mero determinado de valores de contaje
por vuelta as√≠ como un impulso de reset una vez por vuelta. El o los generadores de impulsos
de reloj y el impulso de reset del encoder incremental de posici√≥n proporcionan las entradas
del contador r√°pido.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1541

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las diferentes CPU S7-1200 disponen de un n√∫mero variable de contadores r√°pidos:
CPU S7-1200

N√∫mero de HSC

Denominaci√≥n HSC

CPU 1211C

3 (con Signal Board digital 4)*

HSC1‚Ä¶3 (y HSC5)*

CPU 1212C

4 (con Signal Board digital 5)*

HSC1‚Ä¶4 (y HSC5)*

CPU 1214C

6

HSC1‚Ä¶6

CPU 1215C
CPU 1217C

* con Signal Board DI2/DO2

Funcionamiento
El primer valor de varios preconfigurados se carga en el contador r√°pido. Las salidas deseadas
se activan durante el intervalo de tiempo en que el valor actual del contador es inferior al valor
preconfigurado. El contador se configura de modo que se produce una interrupci√≥n cuando el
valor actual del contador es igual al valor preconfigurado o cuando el contador se inicializa.
Si el valor actual es igual al valor preconfigurado y se produce un evento de interrupci√≥n, se
carga un valor preconfigurado nuevo y se activa el pr√≥ximo estado l√≥gico para las salidas. Si
se produce un evento de interrupci√≥n debido a que el contador se inicializa, se activar√°n el
primer valor preconfigurado y los primeros estados l√≥gicos de las salidas, y se repetir√° el ciclo.
Puesto que las interrupciones se producen a una velocidad muy inferior de la que cuenta el
contador r√°pido, es posible implementar un control preciso de las operaciones r√°pidas con una
influencia relativamente reducida en todo el ciclo del sistema de automatizaci√≥n. Puesto que
existe la posibilidad de asignar interrupciones a determinados programas de interrupci√≥n, cada
nuevo ajuste predeterminado puede cargarse en un programa de interrupci√≥n separado, con
lo que el estado se controla f√°cilmente.
Nota
Tambi√©n es posible procesar todos los eventos de interrupci√≥n en un solo programa.

Algoritmos de contaje de los distintos contadores
Todos los contadores funcionan de la misma manera, pero no todos los contadores r√°pidos
soportan todos los algoritmos de contaje. Existen cuatro algoritmos b√°sicos de contaje:
‚óè Contador monof√°sico con control interno de sentido
‚óè Contador monof√°sico con control externo de sentido
‚óè Contador bif√°sico con 2 entradas de impulso de reloj
‚óè Contador A/B
Todos los contadores r√°pidos pueden utilizarse con o sin entrada de reset. Si la entrada de
reset se activa, se inicializa el valor actual. El valor actual permanece inicializado hasta que se
desactiva la entrada de reset.

1542

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Configurar contadores r√°pidos (P√°gina 1544)
Dependencias entre tipo de contador y entradas de contador (P√°gina 1543)

Dependencias entre tipo de contador y entradas de contador
Generalidades del tipo de contador y las entradas de contador
A los contadores r√°pidos se les asignan tipos y entradas de contador y, por encima, las
funciones como generador de impulsos de reloj, control de sentido y resetear. Rigen las reglas
siguientes:
‚óè No es posible utilizar una entrada para dos funciones distintas.
‚óè Si el tipo actual de contador r√°pido definido no requiere una entrada, √©sta estar√° disponible
para otros fines.
As√≠, por ejemplo, si se utiliza HSC1 en el tipo de contador 1 que requiere las entradas I0.0 e
I0.3, es posible utilizar I0.1 para interrupciones de flancos o para HSC2.
Si, por ejemplo, se utiliza HSC1 y HSC5, en los tipos de contador Contaje y Frecuencia se
utilizar√°n siempre las entradas I0.0 (HSC1) e I1.0 (HSC5). Por ello ambas entradas no estar√°n
disponibles para otras funciones cuando se utilicen los contadores.
Hay otras entradas disponibles si se utiliza una Signal Board digital.

Resumen de las dependencias entre el tipo de contador y las entradas de contador
Tipo de contador

Descripci√≥n

Entradas

HSC1

I0.0 (CPU)

I0.1 (CPU)

I0.3 (CPU)

I4.0 (Signal Board)

I4.1 (Signal Board)

I4.3 (Signal Board)

I0.2 (CPU)

I0.3 (CPU)

I0.1 (CPU)

HSC2

I4.2 (Signal Board)

I4.3 (Signal Board)

I4.1 (Signal Board)

HSC3*

I0.4 (CPU)

I0.5 (CPU)

I0.7 (CPU)

HSC4 (solo CPU
1212/14/15/17C)

I0.6 (CPU)

I0.7 (CPU)

I0.5 (CPU)

HSC5 (solo CPU
1214/15/17C)**

I1.0 (CPU)

I1.1 (CPU)

I1.2 (CPU)

I4.0 (Signal Board)

I4.1 (Signal Board)

I4.3 (Signal Board)

HSC6 (solo CPU
1214/15/17C)**

I1.3 (CPU)

I1.4 (CPU)

I1.5 (CPU)

Contaje / frecuencia Contador monof√°sico con con‚Äê
trol interno de sentido
Contaje

Generador de impul‚Äê sos de reloj

-

Contaje / frecuencia Contador monof√°sico con con‚Äê
trol externo de sentido
Contaje

Generador de impul‚Äê Sentido
sos de reloj

-

Contaje / frecuencia Contador bif√°sico con 2 entra‚Äê
das de impulso de reloj
Contaje

Generador de impul‚Äê Generador de impul‚Äê sos de reloj hacia de‚Äê sos de reloj hacia
Resetear
lante
atr√°s

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Resetear
Resetear

1543

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tipo de contador

Descripci√≥n

Contaje / frecuencia Contador A/B
Contaje
Eje de movimiento

Entradas
Generador de impul‚Äê Generador de impul‚Äê sos de reloj A
sos de reloj B
Resetear

Generadores de impulsos PWM/ HSC1 y HSC2 soportan el modo de contaje Eje de movimiento para
PTO
los generadores de impulsos PTO1 y PTO2:
‚óè HSC1 eval√∫a la salida Q0.0 para PTO1 por el n√∫mero de
impulsos
‚óè HSC2 eval√∫a la salida Q0.2 para PTO2 por el n√∫mero de
impulsos
Q0.1 se utiliza como salida para el sentido del movimiento.

* HSC3 s√≥lo puede utilizarse para la CPU 1211 sin entrada de reset
** HSC5 tambi√©n puede utilizarse para la CPU 1211/12 si se utiliza una Signal Board DI2/DO2

Consulte tambi√©n
Generalidades de los contadores r√°pidos (P√°gina 1541)
Configurar contadores r√°pidos (P√°gina 1544)

Configurar contadores r√°pidos
Requisitos
Se ha enchufado una CPU S7-1200 en la configuraci√≥n hardware.

Procedimiento
Para configurar un contador r√°pido, proceda del siguiente modo:
1. Seleccione una CPU S7-1200 en la vista de dispositivos o redes.
2. En la ventana de inspecci√≥n, haga clic en el contador r√°pido deseado en "Propiedades >
Contadores r√°pidos (HSC)":
‚Äì CPU 1211C: de HSC1 a HSC3 (con Signal Board DI2/DO2 tambi√©n HSC5)
‚Äì CPU 1212C: de HSC1 a HSC4 (con Signal Board DI2/DO2 tambi√©n HSC5)
‚Äì CPU 1214C / 1215C / 1217C: de HSC1 a HSC6

1544

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Active el contador r√°pido en el grupo de par√°metros "General" con la casilla de verificaci√≥n
correspondiente.
Nota
Si se utiliza una CPU 1211C o CPU 1212C con Signal Board DI2/DO2, tambi√©n es posible
activar el contador r√°pido HSC5.
Nota
Si se activan los generadores de impulsos y se utilizan como PTO (para controlar motores
paso a paso) se necesitar√°n contadores r√°pidos.
En las versiones de firmware V3.0 y superiores, la CPU utiliza para ello HSC (adicionales)
internos.
En las versiones de firmware inferiores a V3.0, la CPU utiliza el HSC1 para PTO1 y el HSC2
para PTO2. En este caso, los contadores ya no estar√°n disponibles para otras tareas de
contaje.
En "Informaci√≥n del proyecto" existe la posibilidad de introducir un nombre y un comentario
para el contador.
4. El funcionamiento del contador se define en el grupo de par√°metros "Funci√≥n":
‚Äì Modo de contaje: Elija una de las funciones siguientes del contador en la lista
desplegable:
- contaje (determinar el n√∫mero de impulsos)
- duraci√≥n del periodo (medir la duraci√≥n de periodo de los impulsos)
- frecuencia (medici√≥n de la frecuencia de los impulsos)
- Motion Control (utilizar el contador para control de movimiento).
‚Äì Fase operativa: Elija en la lista desplegable c√≥mo debe utilizarse el contador:
- monof√°sica (una entrada de reloj para el contaje, incrementar y decrementar contador
se ajusta mediante la entrada de sentido)
- bif√°sica (una entrada de reloj para incrementar contador, una entrada de reloj para
decrementar contador)
- contador A/B (dos entradas de reloj con impulsos desfasados, valor de contaje simple)
- contador A/B cu√°druple (dos entradas de reloj con impulsos desfasados, valor de
contaje cu√°druple)
‚Äì Origen de la entrada (solo en versiones de firmware inferiores a 4.0): Como origen para
los impulsos de contaje debe seleccionarse una entrada de CPU o una entrada de una
Signal Board.
‚Äì Sentido de contaje indicado por: Si la fase operativa ajustada es "monof√°sica", es
posible elegir si el programa de usuario debe especificar el sentido de contaje
(instrucci√≥n CTRL_HSC, par√°metros DIR y NEW_DIR) o si debe hacerlo una entrada
digital.
‚Äì Sentido de contaje inicial: Si en el sentido de contaje se ha ajustado el programa de
usuario como control de sentido, puede elegir el sentido al iniciar el contaje.
‚Äì Per√≠odo de medici√≥n de frecuencia: Si se ha ajustado la frecuencia o la duraci√≥n del
periodo como modo de contaje, elija en la lista desplegable la duraci√≥n de los per√≠odos
de medici√≥n de frecuencia.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1545

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Defina los valores iniciales y la condici√≥n de reset del contador en el grupo de par√°metros
"Restablecer a valores iniciales":
‚Äì Valor de contador inicial: Introduzca un valor inicial para el contador.
‚Äì Valor de referencia inicial: Introduzca un valor de referencia.
El valor de referencia sirve para comparar la lectura actual del contador: Si el valor actual
del contador es igual al valor de referencia, se dispara un evento (siempre que est√©
activado en "Configuraci√≥n de eventos").
Aqu√≠ tambi√©n es posible ajustar si el contador utiliza una entrada de reset y si restablece el
valor actual de contaje en caso de nivel High o Low en la entrada de reset.
6. En el grupo de par√°metros "Configuraci√≥n de eventos" pueden activarse los eventos
siguientes:
‚Äì Valor del contador igual al valor de referencia
‚Äì Reset externo
‚Äì Cambio de sentido
Asigne a cada uno de estos eventos un OB de alarma de proceso (Hardware interrupt) en
"Alarma de proceso". O bien asigne a cada evento un OB de alarma de proceso en el
programa de usuario (instrucci√≥n "ATTACH").
Resultado: cuando se dispara un evento, la CPU ejecuta el OB de alarma de proceso
asignado (en funci√≥n de la prioridad configurada).
Los nombres de los eventos y las alarmas de proceso pueden modificarse.
7. En el grupo de par√°metros "Entradas de hardware" ya hay registradas entradas de
hardware. Puede aplicarlas. O bien haga clic en el bot√≥n "..." en "Generador de impulsos de
reloj hacia delante", "Generador de impulsos de reloj hacia atr√°s" o "Entrada de reset" y
seleccione una entrada.
Nota: En las versiones de firmware anteriores (inferiores a V4.0), las entradas de hardware
est√°n predeterminadas y no pueden modificarse.
8. En el √°rea "Direcciones E/S" pueden ajustarse los par√°metros siguientes:
‚Äì Direcci√≥n inicial: la CPU escribe el estado del contador en el √°rea de direcciones con la
direcci√≥n inicial ajustada (tipo de datos DInt).
‚Äì Bloque de organizaci√≥n: asignaci√≥n de esta √°rea de direcciones a un bloque de
organizaci√≥n.
‚Äì Memoria imagen de proceso: asignaci√≥n del √°rea de direcciones a una memoria imagen
parcial de proceso (IPP). El ajuste predeterminado es la actualizaci√≥n autom√°tica
(IPP0).

Resultado
Ahora, los par√°metros del contador r√°pido est√°n adaptados a los requerimientos del proyecto.

Consulte tambi√©n
Generalidades de los contadores r√°pidos (P√°gina 1541)
Dependencias entre tipo de contador y entradas de contador (P√°gina 1543)

1546

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comunicaci√≥n punto a punto
Resumen de la comunicaci√≥n punto a punto
La comunicaci√≥n PtP es una comunicaci√≥n a trav√©s de una interfaz serie que utiliza una
transferencia de datos UART estandarizada (Universal Asynchronous Receiver Transmitter).
La S7-1200 utiliza m√≥dulos de comunicaci√≥n con una interfaz RS232 o RS485 para establecer
la comunicaci√≥n PtP.

Funciones de la comunicaci√≥n punto a punto
La comunicaci√≥n punto a punto (PtP) ofrece una gran cantidad de posibilidades de aplicaci√≥n:
‚óè Transmisi√≥n directa de informaci√≥n a un dispositivo externo, p. ej. una impresora o un lector
de c√≥digos de barras
‚óè Recepci√≥n de informaci√≥n de dispositivos externos, p. ej. lectores de c√≥digos de barras,
lectores RFID, c√°maras y sistemas √≥pticos de otros fabricantes y muchos otros dispositivos.
‚óè Intercambio de informaci√≥n con dispositivos de otros fabricantes, p. ej. dispositivos GPS,
radio m√≥dems y muchos m√°s

El protocolo Freeport
La S7-1200 soporta el protocolo Freeport para la comunicaci√≥n serie basada en caracteres. La
comunicaci√≥n Freeport permite configurar el protocolo de transferencia de datos utilizando
exclusivamente el programa de usuario.
Siemens dispone de librer√≠as con funciones de comunicaci√≥n Freeport que pueden utilizarse
en el programa de usuario:
‚óè USS Drive Protocol
‚óè Modbus RTU Master Protocol
‚óè Modbus RTU Slave Protocol

Consulte tambi√©n
Configurar el puerto de comunicaci√≥n (P√°gina 1548)

Uso de m√≥dulos de comunicaci√≥n RS232 y RS485
M√≥dulos de comunicaci√≥n con interfaces RS232 y RS485
En una CPU S7-1200 es posible utilizar dos m√≥dulos de comunicaci√≥n distintos:
‚óè M√≥dulo de comunicaci√≥n RS232
‚óè M√≥dulo de comunicaci√≥n RS485
Los m√≥dulos de comunicaci√≥n se conectan a la CPU S7-1200 a trav√©s del canal I/O de la
izquierda. Se admiten tres m√≥dulos como m√°ximo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1547

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Propiedades de los m√≥dulos de comunicaci√≥n
Los m√≥dulos de comunicaci√≥n se distinguen por las propiedades siguientes:
‚óè Soporte del protocolo Freeport
‚óè Configuraci√≥n a trav√©s del programa de usuario mediante instrucciones avanzadas y
funciones de librer√≠a

Configurar el puerto de comunicaci√≥n
Configuraci√≥n del puerto de comunicaci√≥n
Despu√©s de insertar un m√≥dulo de comunicaci√≥n con una interfaz RS232 o RS485, hay que
ajustar los par√°metros de la interfaz. La interfaz se parametriza en las propiedades de la
misma, aunque tambi√©n es posible controlar los par√°metros de interfaz por medio del
programa de usuario con la instrucci√≥n PORT_CFG. La descripci√≥n siguiente hace referencia
a la configuraci√≥n gr√°fica.
Nota
Si se modifica el ajuste del puerto por medio del programa de usuario, se sobrescribir√°n los
ajustes de la configuraci√≥n gr√°fica.
Asimismo, hay que tener en cuenta que los ajustes realizados desde el programa de usuario
no se conservan en caso de una ca√≠da de tensi√≥n.

Requisitos
‚óè Hay un m√≥dulo de comunicaci√≥n insertado.
‚óè Se encuentra en la vista de dispositivos.

Procedimiento
Para configurar el puerto de comunicaci√≥n, proceda del siguiente modo:
1. Seleccione la interfaz en la representaci√≥n gr√°fica de la vista de dispositivos.
En la ventana de inspecci√≥n aparecen las propiedades de la interfaz.
2. Elija el grupo "Configuraci√≥n del puerto" en la navegaci√≥n local de la ventana de inspecci√≥n.
Aparecen los ajustes del puerto.
3. En lista desplegable "Velocidad de transferencia" elija la velocidad para la transferencia de
datos. Si la comunicaci√≥n se ha programado libremente, tenga en cuenta la influencia de la
velocidad de transferencia en el tiempo de conmutaci√≥n.
4. En la lista desplegable "Paridad" seleccione el tipo de detecci√≥n de palabras informativas
que se transfieren con errores.
5. En la lista desplegable "Bits de datos" elija si un car√°cter debe tener ocho o siete bits.
6. En la lista desplegable "Bit de parada" seleccione con cu√°ntos bits debe marcarse el final
de una palabra transferida.

1548

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
7. En la lista desplegable "Control de flujo" elija con qu√© procedimiento debe asegurarse un
flujo de datos continuo entre el emisor y el receptor. Este par√°metro s√≥lo es ajustable para
la interfaz RS232.
‚Äì En el campo "Car√°cter XON" introduzca un valor HEX cuya aparici√≥n provoque la
continuaci√≥n de la transferencia de mensajes. Este par√°metro s√≥lo es ajustable para el
control del flujo de datos por software.
‚Äì En el campo "Car√°cter XOFF" introduzca un valor HEX cuya aparici√≥n provoque la
suspensi√≥n de la transferencia de mensajes durante el tiempo de espera parametrizado.
Este par√°metro s√≥lo es ajustable para el control del flujo de datos por software.
8. En el campo "Tiempo de espera" introduzca en ms el tiempo que deba esperarse tras
finalizar un mensaje, hasta que pueda iniciarse la pr√≥xima transferencia.
Nota
La interfaz tambi√©n puede configurarse en la vista de redes. Sin embargo, primero hay que
seleccionar el m√≥dulo de comunicaci√≥n en el √°rea de tabla de la vista de redes y,
seguidamente, seleccionar la interfaz en la ventana de inspecci√≥n. Posteriormente, se
procede del modo descrito anteriormente.

Consulte tambi√©n
Ajustar el control del flujo de datos (P√°gina 1549)

Ajustar el control del flujo de datos
Control del flujo de datos
El control del flujo de datos es un procedimiento que procura un comportamiento equilibrado
de transmisi√≥n y recepci√≥n. En condiciones √≥ptimas, con un control inteligente no se pierden
datos. Dicho control asegura que un dispositivo no env√≠e m√°s informaci√≥n de la que puede
procesar el interlocutor receptor.
Existen dos procedimientos de control del flujo de datos:
‚óè Control del flujo de datos por hardware
‚óè Control del flujo de datos por software
En ambos m√©todos, las se√±ales DSR de los interlocutores deben estar activas al empezar la
transferencia. Si las se√±ales DSR est√°n inactivas, no se iniciar√° la transferencia.
El m√≥dulo de comunicaci√≥n RS232 soporta ambos procedimientos, mientras que el m√≥dulo de
comunicaci√≥n RS485 no soporta ninguno.

Control del flujo de datos por hardware
El control del flujo de datos por hardware se realiza a trav√©s de las se√±ales Request-to-send
(RTS) y Clear-to-send (CTS). Con el m√≥dulo de comunicaci√≥n RS232 se transfiere la se√±al
RTS a trav√©s de la salida del pin 7. La se√±al CTS llega por el pin 8.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1549

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si el control del flujo de datos por hardware est√° activado, la se√±al RTS se activar√° siempre que
se env√≠en datos. Al mismo tiempo se vigila la se√±al CTS para determinar si el dispositivo
receptor acepta los datos. Si la se√±al CTS est√° activa, el m√≥dulo puede transferir datos hasta
que se desactive la se√±al CTS. Cuando se desactiva dicha se√±al, la transferencia de datos
debe suspenderse durante el tiempo de espera parametrizado. Si la se√±al CTS sigue inactiva
una vez transcurrido el tiempo de espera parametrizado, se cancelar√° la transferencia de
datos y se notificar√° un error al programa de usuario.

Control del flujo de datos con handshake de hardware
Si el control del flujo de datos se regula por medio del handshake de hardware, el dispositivo
emisor activa por defecto la se√±al RTS. En este caso, un dispositivo, p. ej. un m√≥dem, puede
transferir datos en cualquier momento. No espera la se√±al CTS del receptor. El dispositivo
emisor vigila √©l mismo su propia transferencia enviando √∫nicamente un n√∫mero limitado de
frames (caracteres) del mensaje, con el fin de evitar un desbordamiento del b√∫fer de recepci√≥n,
por ejemplo. Si, a pesar de todo, se desborda el b√∫fer de recepci√≥n, el dispositivo emisor debe
retener el mensaje y notificar un error al programa de usuario.

Control del flujo de datos por software
El control del flujo de datos por software utiliza dentro de los mensajes determinados
caracteres que controlan la transferencia. √âstos son caracteres ASCII que se parametrizan en
XON y XOFF.
XOFF indica cu√°ndo debe suspenderse una transferencia. XON indica cu√°ndo puede
continuar una transferencia.
Cuando el dispositivo emisor recibe el car√°cter XOFF, debe suspender la transmisi√≥n durante
el tiempo de espera parametrizado. Si, una vez transcurrido el tiempo de espera
parametrizado, se env√≠a el car√°cter XON, se continuar√° con la transferencia. Si despu√©s del
tiempo de espera no llega ning√∫n car√°cter XON, se notifica un error al programa de usuario.
El control del flujo de datos por software requiere una comunicaci√≥n d√∫plex, ya que el
interlocutor receptor debe enviar el car√°cter XON durante la transferencia en curso.

Consulte tambi√©n
Configurar el puerto de comunicaci√≥n (P√°gina 1548)

Configuraci√≥n de la transferencia de mensajes
Comunicaci√≥n libremente programable
El tr√°fico de datos entre un m√≥dulo de comunicaci√≥n y un dispositivo conectado externamente
a trav√©s de una interfaz serie se controla libremente. Para ello hay que definir un protocolo de
comunicaci√≥n. En la comunicaci√≥n libremente programable se soportan protocolos ASCII y
binarios para transferir mensajes.
Dentro del protocolo de comunicaci√≥n deben definirse los criterios que deben facilitar la
detecci√≥n del principio y fin de un mensaje dentro del flujo de datos actual.

1550

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La comunicaci√≥n libremente programable s√≥lo puede activarse en estado operativo RUN. Si se
pasa al estado operativo STOP, se detendr√° la comunicaci√≥n libremente programable.

Definici√≥n del protocolo de comunicaci√≥n
El protocolo de comunicaci√≥n se define del siguiente modo:
‚óè Con el programa de usuario
‚Äì El comportamiento durante la transmisi√≥n de datos se controla por medio de la
instrucci√≥n SEND_CFG.
‚Äì El comportamiento durante la recepci√≥n de datos se controla por medio de la instrucci√≥n
RCV_CFG.
‚óè Mediante parametrizaci√≥n gr√°fica en la ventana de inspecci√≥n
Nota
Si se modifica el protocolo de comunicaci√≥n a trav√©s del programa de usuario, se
sobrescribir√°n los ajustes de la configuraci√≥n gr√°fica.
Hay que tener en cuenta que los ajustes realizados desde el programa de usuario no se
conservar√°n en caso de p√©rdida de tensi√≥n.

Consulte tambi√©n
Comunicaci√≥n libremente programable con dispositivos RS232 (P√°gina 1551)
Definir los ajustes para la transmisi√≥n (P√°gina 1553)
Definici√≥n del principio del mensaje (P√°gina 1554)
Definici√≥n del fin del mensaje (P√°gina 1555)

Comunicaci√≥n libremente programable con dispositivos RS232
Cable multimaestro RS232/PPI y comunicaci√≥n libremente programable con dispositivos RS232
Mediante el cable multimaestro RS232/PPI y la comunicaci√≥n libremente programable es
posible conectar a los m√≥dulos de comunicaci√≥n de la S7-1200 muchos dispositivos
compatibles con el est√°ndar RS232. Sin embargo, primero hay que ajustar el cable para el
modo "PPI/comunicaci√≥n libremente programable".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1551

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustes del cable
Los interruptores del cable deben ajustarse del siguiente modo:
‚óè El interruptor 5 debe estar a 0
‚óè El interruptor 6 ajusta el modo local (DCE) o el modo remoto (DTE):
‚Äì Interruptor a 0 para el modo local
‚Äì Interruptor a 1 para el modo remoto

Conmutaci√≥n entre modo de transmisi√≥n y recepci√≥n
El cable multimaestro RS232/PPI est√° en modo de transmisi√≥n cuando se env√≠an datos de la
interfaz RS232 a la interfaz RS485. El cable est√° en modo de recepci√≥n cuando est√° en estado
de reposo o cuando se env√≠an datos de la interfaz RS485 a la interfaz RS232. El cable cambia
inmediatamente del modo de recepci√≥n al de transmisi√≥n cuando se detectan caracteres en la
l√≠nea de transmisi√≥n RS232.

Velocidades de transferencia soportadas
El cable multimaestro RS232/PPI soporta velocidades de transferencia entre 1200 baudios y
115,2 kbaudios. Mediante los interruptores DIP del cable PC/PPI se ajusta el cable
multimaestro RS232/PPI a la velocidad de transferencia deseada.
La tabla siguiente muestra la posici√≥n de los interruptores para las velocidades de
transferencia correspondientes:
Velocidad de transferencia

Tiempo de conmutaci√≥n

Ajustes (1 = arriba)

115200 bits/s

0,15 ms

110

57600 bits/s

0,3 ms

111

38400 bits/s

0,5 ms

000

19200 bits/s

1,0 ms

001

9600 bits/s

2,0 ms

010

4800 bits/s

4,0 ms

011

2400 bits/s

7,0 ms

100

1200 bits/s

14,0 ms

101

El cable retorna al modo de recepci√≥n cuando la l√≠nea de transmisi√≥n RS232 est√° en modo de
reposo durante un tiempo determinado, que se define como tiempo de conmutaci√≥n del cable.
La velocidad de transferencia ajustada influye en el tiempo de conmutaci√≥n, tal como muestra
la tabla.

1552

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Influencia del tiempo de conmutaci√≥n
Al trabajar con un cable multimaestro RS232/PPI en un sistema que tambi√©n utiliza la
comunicaci√≥n libremente programable, el programa debe considerar el tiempo de
conmutaci√≥n, por los motivos siguientes:
‚óè El m√≥dulo de comunicaci√≥n reacciona a los avisos enviados por el dispositivo RS232.
Una vez el m√≥dulo de comunicaci√≥n del dispositivo RS232 ha recibido una petici√≥n, debe
retardar la transmisi√≥n del aviso de reacci√≥n por un intervalo de tiempo mayor o igual al
tiempo de conmutaci√≥n del cable.
‚óè El dispositivo RS232 reacciona a avisos enviados por el m√≥dulo de comunicaci√≥n.
Una vez el m√≥dulo de comunicaci√≥n del dispositivo RS232 ha recibido un aviso de reacci√≥n,
debe retardar la transmisi√≥n del pr√≥ximo aviso de petici√≥n por un intervalo de tiempo mayor
o igual al tiempo de conmutaci√≥n del cable.
En ambas situaciones, el cable multimaestro RS232/PPI tiene tiempo suficiente, gracias al
retardo, para pasar del modo de recepci√≥n al de transmisi√≥n para que los datos puedan
enviarse de la interfaz RS485 a la interfaz RS232.

Consulte tambi√©n
Configuraci√≥n de la transferencia de mensajes (P√°gina 1550)
Definir los ajustes para la transmisi√≥n (P√°gina 1553)
Definici√≥n del principio del mensaje (P√°gina 1554)
Definici√≥n del fin del mensaje (P√°gina 1555)

Definir los ajustes para la transmisi√≥n
Enviar mensajes
Existe la posibilidad de programar pausas entre los diferentes mensajes.
La tabla siguiente muestra qu√© pausas pueden preajustarse:
Par√°metro

Definici√≥n

Retardo RTS ON

Se parametriza el tiempo que debe transcurrir despu√©s de la petici√≥n
de transmisi√≥n RTS (Request to send) antes de que empiece la trans‚Äê
ferencia de datos propiamente dicha.

Retardo RTS OFF

Se parametriza el tiempo que debe transcurrir una vez finalizada la
transferencia por completo antes de que se desactive la se√±al RTS.

Enviar pausa al inicio del men‚Äê Se determina que, cada vez que inicie una transferencia de mensajes,
saje
se env√≠e adicionalmente una pausa si ha transcurrido el tiempo de
retardo RTS ON.
El tiempo de pausa se indica en tiempos de bit.
Enviar Idle Line tras la pausa

Se determina que, tras una pausa parametrizada al inicio del mensaje,
se emita la se√±al "Idle Line" y, por tanto, la l√≠nea se se√±alice como
"desocupada". Para activar el par√°metro tiene que estar activado "En‚Äê
viar pausa al inicio del mensaje".
La duraci√≥n de la se√±al "Idle Line" se indica en tiempos de bit.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1553

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Definici√≥n del principio del mensaje (P√°gina 1554)
Definici√≥n del fin del mensaje (P√°gina 1555)
Comunicaci√≥n libremente programable con dispositivos RS232 (P√°gina 1551)

Definici√≥n del principio del mensaje
Detecci√≥n del principio del mensaje
Para indicar al receptor cu√°ndo ha finalizado la transferencia de un mensaje y cu√°ndo empieza
la pr√≥xima transferencia, hay que definir criterios en el protocolo de transferencia que
identifiquen el final y el principio de un mensaje.
Cuando se cumple un criterio que indica el principio de un mensaje, se empiezan a buscar
criterios para el fin del mensaje en el flujo de datos.
Existen dos procedimientos distintos para detectar el principio del mensaje:
‚óè Empezar con un car√°cter cualquiera:
Cualquier car√°cter puede definir el principio de un mensaje. √âste es el procedimiento
predeterminado.
‚óè Empezar con una condici√≥n especial:
El principio del mensaje se detecta gracias a condiciones definidas.

Condiciones para detectar el principio de un mensaje
La tabla siguiente muestra las diferentes posibilidades que existen para definir el principio de
un mensaje:
Par√°metro

Definici√≥n

Detectar inicio del mensaje
por Line Break

El receptor detecta un Line Break cuando se interrumpe el flujo de datos
recibidos durante un tiempo superior a la longitud de un car√°cter. En este
caso, se determina el principio del mensaje por el Line Break.

Detectar inicio del mensaje
por Idle Line

El principio de un mensaje se detecta cuando la l√≠nea de transferencia
est√° en estado "Idle" durante un tiempo determinado (indicado en tiem‚Äê
pos de bit) para enviar y va seguida de un evento, p. ej. la recepci√≥n de
un car√°cter.

Detectar el inicio del mensa‚Äê El principio de un mensaje se detecta cuando aparece un car√°cter de‚Äê
je por un solo car√°cter
terminado. El car√°cter en cuesti√≥n se introduce como valor HEX.
Detectar el inicio del mensa‚Äê El principio de un mensaje se detecta cuando aparece una cadena de
je por una cadena de carac‚Äê caracteres definida en el flujo de datos. Es posible definir un m√°ximo de
teres
cuatro cadenas de caracteres con cinco caracteres como m√°ximo cada
una.

Las diferentes condiciones pueden enlazarse entre s√≠ del modo deseado.

1554

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Definir los ajustes para la transmisi√≥n (P√°gina 1553)
Comunicaci√≥n libremente programable con dispositivos RS232 (P√°gina 1551)

Definici√≥n del fin del mensaje
Detecci√≥n del fin del mensaje
Para indicar al receptor cu√°ndo ha finalizado la transferencia de un mensaje y cu√°ndo empieza
la pr√≥xima transferencia, hay que definir criterios en el protocolo de transferencia que
identifiquen el final y el principio de un mensaje.
Existen un total de seis procedimientos distintos para detectar el fin de un mensaje, que
pueden enlazarse entre s√≠ del modo deseado. La tabla siguiente muestra las diferentes
posibilidades de ajuste:
Par√°metro

Definici√≥n

Detectar fin del mensaje por
tiempo de mensaje excedido

El fin del mensaje se detecta autom√°ticamente cuando se excede la
duraci√≥n m√°xima predefinida de un mensaje. Se admiten valores entre
0 y 65535 ms.

Detectar fin del mensaje por
El fin del mensaje se detecta cuando no se recibe ninguna respuesta
tiempo de respuesta excedido dentro del tiempo predefinido despu√©s de transferir datos. Se admiten
valores entre 0 y 65535 ms.
Detectar fin del mensaje por
tiempo excedido entre carac‚Äê
teres

El fin del mensaje se detecta cuando se excede un tiempo predefinido
(en tiempos de bit) entre dos caracteres. Se admiten valores entre 0 y
2500 tiempos de bit.
La CPU S7-1200 prev√© un tiempo m√°ximo de ocho segundos, aunque
el tiempo ajustado sea superior.

Detectar fin del mensaje por
longitud m√°xima

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

El fin del mensaje se detecta cuando se excede la longitud m√°xima de
un mensaje. Se admiten valores entre 1 y 1023 caracteres.

1555

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Par√°metro

Definici√≥n

Leer longitud del mensaje en
el mensaje

El propio mensaje contiene informaci√≥n sobre su longitud. El fin del
mensaje se alcanza cuando se llega al valor tomado del mensaje. Con
los par√°metros siguientes se definen los caracteres que deben consi‚Äê
derarse para evaluar la longitud del mensaje:
‚óè Offset del campo de longitud en el mensaje
El valor determina la posici√≥n del car√°cter en el mensaje que debe
considerarse para determinar la longitud del mismo.
Se admiten valores entre 1 y 1022 caracteres.
‚óè Tama√±o del campo de longitud
El valor indica cu√°ntos caracteres deben considerarse a partir de la
primera posici√≥n de evaluaci√≥n para determinar la longitud del
mensaje.
Se admiten valores de 0, 1, 2 y 4 caracteres.
‚óè El campo de longitud que sigue a los datos
(no forma parte de la longitud del mensaje)
El valor indica el n√∫mero de bytes posteriores al campo de longitud
que no deben considerarse al evaluar la longitud del mensaje.
Se admiten valores entre 0 y 255 caracteres.

Detectar fin del mensaje por
una cadena de caracteres

El fin de un mensaje se detecta cuando aparece una cadena de ca‚Äê
racteres definida en el flujo de datos. Se pueden especificar como
m√°ximo cinco caracteres que deben comprobarse dentro de la cade‚Äê
na. Si los caracteres especificados aparecen en la posici√≥n correcta
dentro del mensaje, se detectar√° el fin del mensaje. Para poder de‚Äê
tectar el fin del mensaje, por ejemplo, cuando los caracteres 1 y 3
posean un valor determinado, deben estar activadas las casillas de
verificaci√≥n para el car√°cter 1 y el car√°cter 3 y haberse introducido un
valor de car√°cter.

Consulte tambi√©n
Definir los ajustes para la transmisi√≥n (P√°gina 1553)
Comunicaci√≥n libremente programable con dispositivos RS232 (P√°gina 1551)

Uso de marcas de sistema
Marcas de sistema
Una marca de sistema es una marca con valores definidos.
En la parametrizaci√≥n de la marca de sistema se determina el byte de marcas de la CPU que
se convertir√° en el byte de marcas de sistema.

Uso
Las marcas de sistema pueden utilizarse en el programa de usuario, p. ej. para ejecutar partes
del programa s√≥lo en el primer ciclo tras el arranque o para evaluar el diagn√≥stico al cambiar
el estado del mismo. Dos marcas de sistema son permanentemente 1 o 0.

1556

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Bits del byte de marcas de sistema
La tabla siguiente explica el significado de las marcas de sistema:
Bit del byte de
7
marcas de siste‚Äê
ma

6

5

4

3

2

1

0

Significado

Reserva‚Äê
do (=0)

Reserva‚Äê
do (=0)

Reserva‚Äê
do (=0)

=0

=1

=1 al cam‚Äê
biar el es‚Äê
tado del
diagn√≥sti‚Äê
co

=1 durante el
arranque y
en el primer
ciclo tras el
arranque, en
el resto de
casos, 0

Reservado
(=0)

Nota
El byte de marcas seleccionado no puede emplearse para almacenar datos en la memoria
intermedia.

Uso de marcas de ciclo
Marcas de ciclo
Una marca de ciclo es una marca que modifica peri√≥dicamente su estado binario en una
relaci√≥n 1:1 entre impulso y pausa.
En la parametrizaci√≥n de la marca de ciclo se determina el byte de marcas de la CPU que se
convertir√° en el byte de marcas de ciclo.

Uso
Las marcas de ciclo se utilizan en el programa de usuario, p. ej., para controlar indicadores
luminosos con una luz intermitente o lanzar procesos peri√≥dicos, como la adquisici√≥n de un
valor real.

Frecuencias posibles
Cada bit del byte de marcas de ciclo tiene asignada una frecuencia. La tabla siguiente muestra
la asignaci√≥n:
Bit del byte de
marcas de ciclo

7

6

5

4

3

2

1

0

Duraci√≥n del pe‚Äê
r√≠odo (s)

2,0

1,6

1,0

0,8

0,5

0,4

0,2

0,1

Frecuencia (Hz)

0,5

0,625

1

1,25

2

2,5

5

10

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1557

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Las marcas de ciclo se ejecutan de forma as√≠ncrona al ciclo de la CPU, es decir, en ciclos
largos es posible que el estado de la marca de ciclo cambie varias veces.
El byte de marcas seleccionado no puede emplearse para almacenar datos en la memoria
intermedia.

Protecci√≥n
Posibilidades de ajuste para el nivel de protecci√≥n (FW V1 a V3)
Nivel de protecci√≥n
A continuaci√≥n se explica c√≥mo utilizar los diferentes niveles de protecci√≥n de las CPU
S7-1200 V1 a V3.

Repercusiones del nivel de protecci√≥n ajustado
Existen los niveles de protecci√≥n siguientes:
‚óè Sin protecci√≥n: √âste es el comportamiento predeterminado. No es posible introducir
ninguna contrase√±a. El acceso de lectura y escritura est√° permitido siempre.
‚óè Protecci√≥n contra escritura: S√≥lo es posible un acceso en lectura. No se permite modificar
datos de la CPU ni cargar bloques ni configuraciones. Est√°n excluidos de la protecci√≥n
contra escritura los accesos al HMI y la comunicaci√≥n entre varias CPU. Para seleccionar
este nivel de protecci√≥n, es necesario asignar una contrase√±a.
‚óè Protecci√≥n de escritura/lectura: no es posible acceder en modo de lectura ni de escritura al
√°rea "Dispositivos accesibles" ni a los dispositivos del proyecto que est√°n conectados
online. En el √°rea "Dispositivos accesibles" del √°rbol del proyecto s√≥lo se muestran el tipo
de CPU y los datos de identificaci√≥n. Es posible visualizar informaci√≥n online o bloques en
el √°rea "Dispositivos accesibles" o en el proyecto para dispositivos conectados online.
Est√°n excluidos de la protecci√≥n contra escritura los accesos al HMI y la comunicaci√≥n
entre varias CPU. Para seleccionar este nivel de protecci√≥n, es necesario asignar una
contrase√±a.

Comportamiento de una CPU protegida por contrase√±a durante el funcionamiento
La protecci√≥n de la CPU ser√° efectiva una vez que los ajustes se hayan cargado en la CPU.
Antes de ejecutar una funci√≥n online, se comprobar√°n los permisos. Si existe protecci√≥n por
contrase√±a, se pide que se introduzca la contrase√±a.
Ejemplo: el m√≥dulo se ha parametrizado con una protecci√≥n contra escritura y debe ejecutarse
la funci√≥n "Forzar variable". Puesto que para ello se requiere un acceso de escritura, para
ejecutar la funci√≥n hay que introducir la contrase√±a parametrizada.

1558

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las funciones protegidas por contrase√±a solo pueden ejecutarse desde una programadora o
un PC en un momento dado. No se permite el acceso con contrase√±a de otra programadora
u otro PC.
El permiso de acceso a los datos protegidos tiene validez mientras dure la conexi√≥n online o
hasta que se desactive manualmente con "Online > Borrar derechos de acceso". Cuando se
cierra el proyecto, el permiso de acceso tambi√©n se pierde.
Nota
No es posible restringir las funciones para la conducci√≥n, visualizaci√≥n y comunicaci√≥n del
proceso.
Algunas funciones quedan protegidas porque se utilizan como datos online. Por consiguiente,
las funciones RUN/STOP de la Task Card "Herramientas online" o "Ajustar la hora" del editor
Online y diagn√≥stico est√°n protegidas contra escritura.

Posibilidades de ajuste para la protecci√≥n (FW a partir de V4)
Nivel de protecci√≥n
A continuaci√≥n se explica c√≥mo utilizar los diferentes niveles de acceso de las CPU S7-1200
a partir de V4.
Las CPU S7-1200 ofrecen diferentes niveles de acceso para restringir el uso de determinadas
funciones.
La parametrizaci√≥n de los niveles de acceso se realiza en una tabla. Las marcas de verificaci√≥n
verdes de las columnas de la derecha del respectivo nivel de acceso indican qu√© operaciones
son posibles como m√°ximo sin conocer la contrase√±a de este nivel de acceso. Para utilizar las
funciones que no tienen marcada la casilla de verificaci√≥n es necesario introducir una
contrase√±a.
ATENCI√ìN
La configuraci√≥n de un nivel de acceso no sustituye la protecci√≥n de know how
La parametrizaci√≥n de niveles de acceso impide que se puedan hacer cambios no
autorizados en la CPU limitando los derechos de descarga. En cualquier caso, los bloques de
la Memory Card no est√°n protegidos contra escritura o lectura. Para proteger el c√≥digo de los
bloques de la Memory Card se utiliza la protecci√≥n de know-how.

Comportamiento predeterminado
El nivel de acceso predeterminado es "Acceso completo (sin protecci√≥n)". Todo usuario puede
leer y modificar la configuraci√≥n hardware y los bloques. No hay ninguna contrase√±a
parametrizada y tampoco se necesita para el acceso online.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1559

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Los distintos niveles de acceso
En una CPU S7-1200 se pueden parametrizar los siguientes niveles de acceso:
‚óè Acceso completo (sin protecci√≥n): la configuraci√≥n hardware y los bloques pueden ser
le√≠dos y modificados por cualquier persona.
‚óè Acceso de lectura: con este nivel de acceso solo es posible, sin introducir la contrase√±a, el
acceso de lectura a la configuraci√≥n hardware y a los bloques, es decir, se pueden cargar
la configuraci√≥n hardware y los bloques en la programadora. Adem√°s, tambi√©n es posible
el acceso a HMI y a los datos de diagn√≥stico.
Sin introducir la contrase√±a no se pueden cargar en la CPU ning√∫n m√≥dulo ni ninguna
configuraci√≥n hardware. Adem√°s, sin la contrase√±a no son posibles las funciones de test
con acceso de escritura ni las actualizaciones de firmware.
‚óè Acceso a HMI: con este nivel de acceso, si no se introduce la contrase√±a solo es posible el
acceso a HMI y a los datos de diagn√≥stico.
Sin contrase√±a no se pueden cargar bloques o configuraci√≥n hardware en la CPU, ni
tampoco de esta a la programadora. Adem√°s, sin introducir la contrase√±a tampoco es
posible: funciones de test con acceso de escritura, cambio del estado operativo (RUN/
STOP) y actualizaci√≥n de firmware.
‚óè Sin acceso (protecci√≥n completa): cuando la CPU dispone de protecci√≥n completa no se
tiene acceso ni de lectura ni de escritura a la configuraci√≥n hardware y los bloques.
Tampoco es posible el acceso HMI. La funci√≥n de servidor para la comunicaci√≥n PUT/GET
est√° desactivada en este nivel de acceso (no puede modificarse).
La legitimaci√≥n con la contrase√±a proporciona acceso total a la CPU.

Comportamiento de un m√≥dulo protegido por contrase√±a durante el funcionamiento
La protecci√≥n de la CPU ser√° efectiva una vez que los ajustes se hayan cargado en la CPU.
Antes de ejecutar una funci√≥n online, se comprobar√°n los permisos. Si existe protecci√≥n por
contrase√±a, se pide que se introduzca la contrase√±a.
Ejemplo: el m√≥dulo se ha parametrizado con acceso de lectura y se desea ejecutar la funci√≥n
"Forzar variable". Puesto que para ello se requiere un acceso de escritura, para ejecutar la
funci√≥n hay que introducir la contrase√±a parametrizada.
Las funciones protegidas por contrase√±a solo pueden ejecutarse desde una programadora o
un PC en un momento dado. No se permite el acceso desde otra programadora o PC.
El permiso de acceso a los datos protegidos tiene validez mientras dure la conexi√≥n online o
hasta que se desactive manualmente con "Online > Borrar derechos de acceso".
Todo nivel de acceso permite, incluso sin introducir una contrase√±a, el acceso ilimitado a
determinadas funciones como, p. ej., la identificaci√≥n mediante la funci√≥n "Dispositivos
accesibles".

Parametrizaci√≥n de niveles de acceso
A continuaci√≥n se explica c√≥mo parametrizar un nivel de acceso e introducir una contrase√±a
para una CPU S7-1200 a partir de V4.
En una CPU S7-1200 es posible introducir varias contrase√±as y, por tanto, establecer
diferentes derechos de acceso para distintos grupos de usuarios.

1560

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las contrase√±as se introducen en una tabla, de modo que cada una tiene asignado
exactamente un nivel de acceso.
En la columna "Nivel de acceso" se describen los efectos de la contrase√±a.

Ejemplo
Para una CPU est√°ndar (es decir, no una CPU F) se elige el nivel de acceso "Sin acceso
(protecci√≥n completa)" y se introduce una contrase√±a propia para cada nivel de acceso situado
encima en la tabla.
Para los usuarios que no conocen ninguna de las contrase√±as, la CPU est√° completamente
protegida. Ni siquiera son posibles accesos HMI.
Para los usuarios que conocen una de las contrase√±as parametrizadas, el efecto depende de
la fila de la tabla en la que se encuentre la contrase√±a:
‚óè El efecto de la contrase√±a de la fila 1 (Acceso completo (sin protecci√≥n)) es como si la CPU
no estuviera protegida. Los usuarios que conocen esta contrase√±a tienen un acceso
ilimitado a la CPU.
‚óè El efecto de la contrase√±a de la fila 2 (acceso de lectura) es como si la CPU estuviera
protegida contra escritura. Los usuarios que conocen esta contrase√±a tienen solo acceso
de lectura a la CPU.
‚óè El efecto de la contrase√±a de la fila 3 (acceso a HMI) es como si la CPU estuviera protegida
contra escritura y lectura, de modo que los usuarios que conocen esta contrase√±a solo
disponen de acceso HMI.

Procedimiento
Para parametrizar los niveles de acceso de una CPU S7-1200 proceda del siguiente modo:
1. Abra las propiedades del m√≥dulo en la ventana de inspecci√≥n.
2. Abra la entrada "Protecci√≥n" en la navegaci√≥n local.
En la ventana de inspecci√≥n se muestra una tabla con los niveles de acceso posibles.

3. Active el nivel de acceso deseado en la primera columna de la tabla. Las marcas de
verificaci√≥n verdes de las columnas de la derecha del respectivo nivel de protecci√≥n indican
qu√© operaciones son posibles sin introducir la contrase√±a.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1561

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. En la columna "Contrase√±a", asigne una contrase√±a en la primera fila para el acceso
completo. Repita la contrase√±a elegida en la columna "Confirmaci√≥n" con objeto de evitar
entradas err√≥neas.
Aseg√∫rese de que la contrase√±a sea lo suficientemente segura, es decir, que no tenga un
patr√≥n reconocible por una m√°quina.
La entrada de una contrase√±a en la primera fila "Acceso completo (sin protecci√≥n)" es
obligatoria y permite a la persona que conoce la contrase√±a acceder de forma ilimitada a la
CPU, independientemente del nivel de protecci√≥n seleccionado.
5. Asigne otras contrase√±as a otros niveles de acceso seg√∫n requiera, siempre que el nivel de
protecci√≥n seleccionado lo permita.
6. Cargue la configuraci√≥n hardware para que el nivel de acceso se haga efectivo.

Resultado
La configuraci√≥n hardware y los bloques est√°n protegidos contra los accesos no autorizados
conforme al nivel de acceso configurado. Si una operaci√≥n no se puede ejecutar sin
contrase√±a debido al nivel de acceso parametrizado, se muestra un cuadro de di√°logo para
introducir una contrase√±a.

Restricci√≥n de los servicios de comunicaci√≥n
Introducci√≥n
La CPU puede ser el servidor de una serie de servicios de comunicaci√≥n, es decir, que sin
necesidad de configurar y programar conexiones para la CPU, otros dispositivos de
comunicaci√≥n pueden acceder a los datos de la CPU.
Con ello se prescinde de la posibilidad para la CPU local como servidor de controlar la
comunicaci√≥n con los clientes.
Si este tipo de comunicaci√≥n durante el funcionamiento est√° autorizado o no para la CPU local,
se determina mediante el par√°metro "Mecanismos de conexi√≥n" en el √°rea "Protecci√≥n" de los
par√°metros de la CPU.

Permitir acceso v√≠a comunicaci√≥n PUT/GET del interlocutor remoto
En el ajuste predeterminado, la opci√≥n "Permitir acceso v√≠a comunicaci√≥n PUT/GET del
interlocutor remoto (...)" est√° desactivada. En este caso, el acceso de lectura y de escritura a
los datos de la CPU solo ser√° posible a trav√©s de conexiones de comunicaci√≥n que requieren
una configuraci√≥n o programaci√≥n tanto para la CPU local como para el interlocutor de
comunicaci√≥n. Todav√≠a son posibles, p. ej., los accesos a trav√©s de instrucciones BSEND/
BRCV.
Las conexiones para las que la CPU local es solo servidor (es decir, cuando para la CPU local
no hay una configuraci√≥n/programaci√≥n de la comunicaci√≥n con el interlocutor) no son
posibles durante el funcionamiento de la CPU; p. ej.
‚óè en accesos PUT/GET, FETCH/WRITE o por FTP a trav√©s de m√≥dulos de comunicaciones
‚óè en accesos PUT/GET de otras CPU S7
‚óè en accesos HMI que se realizan a trav√©s de la comunicaci√≥n PUT/GET

1562

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si se desea permitir el acceso del cliente a los datos de la CPU, es decir, si no se desea
restringir los servicios de comunicaci√≥n de la CPU, se debe activar la opci√≥n "Permitir acceso
v√≠a comunicaci√≥n PUT/GET del interlocutor remoto".

Avisos de grupo en caso de eventos de seguridad
Informaci√≥n importante sobre avisos de grupo en caso de eventos de seguridad
Eventos de seguridad en el b√∫fer de diagn√≥stico
La CPU deposita informaci√≥n sobre procedimientos y eventos importantes en el b√∫fer de
diagn√≥stico.
Los siguientes eventos de seguridad (tipos de eventos) originan en cada caso una entrada en
el b√∫fer de diagn√≥stico del S7-1200:
‚óè Pasar a online, con contrase√±a correcta o err√≥nea
‚óè Detecci√≥n de datos de comunicaci√≥n manipulados
‚óè Detecci√≥n de datos manipulados en la Memory Card
‚óè Detecci√≥n de archivo de actualizaci√≥n de firmware manipulado
‚óè Carga de un nivel de protecci√≥n (protecci√≥n de acceso) modificado en la CPU
‚óè Restricci√≥n o habilitaci√≥n de la legitimaci√≥n por contrase√±a (mediante instrucci√≥n o display
de la CPU)
‚óè Acceso online denegado por rebase del n√∫mero de accesos simult√°neos posibles
‚óè Rebase del tiempo de inactividad en una conexi√≥n online existente
‚óè Inicio de sesi√≥n en el servidor web con contrase√±a correcta o err√≥nea
‚óè Creaci√≥n de una copia de seguridad de la CPU (Backup)
‚óè Restauraci√≥n de la configuraci√≥n de la CPU (Restore)
‚óè Durante el arranque:
‚Äì El proyecto de la SIMATIC Memory Card ha cambiado (la SIMATIC Memory Card es la
misma)
‚Äì La SIMATIC Memory Card ha sido reemplazada

Aviso de grupo para eventos de seguridad
Para evitar que el b√∫fer de diagn√≥stico reciba una avalancha de eventos de seguridad
id√©nticos, a partir de STEP 7 V13 Service Pack 1 existe la posibilidad de parametrizar que
dichos eventos se introduzcan en el b√∫fer de diagn√≥stico como un aviso de grupo. En este
caso, para cada intervalo (per√≠odo de vigilancia) la CPU genera uno solo aviso de grupo por
tipo de evento.
Ejemplo: ataques Brute-Force
En caso de ataques Brute-Force, los atacantes intentan obtener acceso a la CPU probando
sistem√°ticamente muchas de las posibles combinaciones de contrase√±as. Esto hace que la

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1563

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
CPU reciba muchos intentos de inicio de sesi√≥n en unos pocos segundos con lo que la
avalancha de entradas individuales en el b√∫fer de diagn√≥stico provoca la p√©rdida de
informaci√≥n de diagn√≥stico importante. Este problema lo solucionan los avisos de grupo.
Funcionamiento con avisos de grupo
La CPU registra de inmediato los tres primeros eventos de un mismo tipo en el b√∫fer de
diagn√≥stico. Todos los eventos de seguridad siguientes del mismo tipo los ignora.
Al final del per√≠odo de vigilancia (intervalo), la CPU genera un aviso de grupo en el que registra
el tipo de evento y la frecuencia del mismo durante el intervalo que ha finalizado.
Si estos eventos de seguridad tambi√©n aparecen en los intervalos siguientes, la CPU genera
√∫nicamente un aviso de grupo para cada intervalo siguiente.
En el b√∫fer de diagn√≥stico, un ataque deja el patr√≥n siguiente: tres avisos individuales seguidos
de una serie de avisos de grupo. Dicha serie puede constar de dos, tres o m√°s avisos de grupo,
en funci√≥n del tiempo de vigilancia seleccionado y de la duraci√≥n del ataque.
Puesto que los avisos del b√∫fer de diagn√≥stico tienen un sello de tiempo, es posible determinar
la duraci√≥n del ataque.







‚ë†
‚ë°
‚ë¢

‚ë£

1564

Eventos de seguridad de un tipo, por ejemplo intentos de inicio de sesi√≥n con contrase√±a inco‚Äê
rrecta.
Intervalo (per√≠odo de vigilancia): Cuando se produce por primera vez (o se repite) un evento de
seguridad de un mismo tipo, se inicia (o reinicia) el tiempo de vigilancia.
Avisos individuales: los tres primeros eventos de seguridad de un mismo tipo se registran de
inmediato en el b√∫fer de diagn√≥stico. A partir del cuarto evento de seguridad del mismo tipo, la
CPU ya solo genera avisos de grupo.
Si tras una pausa de un intervalo como m√≠nimo se vuelve a producir un evento de seguridad de
este tipo, la CPU registra un aviso individual en el b√∫fer de diagn√≥stico y vuelve a iniciar el
per√≠odo de vigilancia.
Avisos de grupo: tras tres eventos de seguridad, la CPU genera √∫nicamente un aviso de grupo
como resumen de todos los dem√°s eventos de seguridad que se producen en este intervalo. Si
estos eventos de seguridad tambi√©n aparecen en los intervalos siguientes, la CPU genera
√∫nicamente un aviso de grupo para cada intervalo siguiente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configurar un aviso de grupo en caso de eventos de seguridad
Requisitos
‚óè STEP 7 V14
‚óè CPU S7-1200 con firmware V4.2 o superior

Procedimiento
Para configurar avisos de grupo para eventos de seguridad, proceda del siguiente modo:
1. Haga clic en el s√≠mbolo de la CPU en la vista de redes.
Las propiedades de la CPU se visualizan en la ventana de inspecci√≥n.
2. Navegue hasta el √°rea "Protecci√≥n" > "Evento de seguridad".
3. Haga clic en "Evento de seguridad inform√°tica".
4. Active la opci√≥n "Agrupar eventos de seguridad inform√°tica en caso de gran cantidad de
mensajes" para activar avisos de grupo para eventos de seguridad.
5. Ajuste la duraci√≥n de un intervalo (per√≠odo de vigilancia); el ajuste predeterminado es 20
segundos.

Consulte tambi√©n
Informaci√≥n importante sobre avisos de grupo en caso de eventos de seguridad (P√°gina 1563)

Desactivar SNMP
El protocolo de gesti√≥n de red SNMP (Simple Network Management Protocol) es un protocolo
que utilizan diferentes servicios y herramientas para detectar y diagnosticar la topolog√≠a de
red. SNMP usa el protocolo de transporte UDP. SNMP conoce dos componentes de red, el
administrador SNMP y el cliente SNMP. El administrador SNMP vigila los nodos de la red. Los
clientes SNMP recopilan en los diversos nodos de red diversa informaci√≥n espec√≠fica de la red
y la depositan de forma estructurada en la MIB (Management Information Base). Estos datos
permiten a diferentes servicios y herramientas ejecutar un diagn√≥stico detallado de la red.
En determinadas ocasiones puede ser aconsejable desactivar SNMP. Ejemplos:
‚óè Las normas de seguridad de la red no permiten utilizar SNMP.
‚óè Se utiliza una soluci√≥n SNMP propia, p. ej. por medio de instrucciones de comunicaci√≥n
propias.
Si se desactiva SNMP para un dispositivo ya no estar√°n disponibles algunas posibilidades de
diagn√≥stico para la topolog√≠a de red (p. ej. mediante la herramienta PRONETA o mediante el
servidor web de la CPU).

Requisitos
‚óè CPU S7-1200 V4.1 o superior
‚óè CPU S7-1500 V1.8 o superior

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1565

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Desactivar SNMP
Para desactivar SNMP proceda del siguiente modo:
1. Cree en STEP 7 un bloque de datos que contenga la estructura del juego de datos F003H.
La tabla siguiente muestra la estructura del juego de datos F003H.
Byte

Elemento

Codificaci√≥n

Explicaci√≥n

0-1

BlockID

F003H

Encabezado

2-3

BlockLength

8

La longitud del juego de datos
se cuenta a partir del byte 4
"Versi√≥n".

4

Version

01H

5

Subversion

00H

6-7

Reservado

-

-

8-11

Controlador SNMP

Desactivaci√≥n/activaci√≥n
de SNMP

Si desea desactivar SNMP, in‚Äê
troduzca el valor 0.
Si desea activar SNMP, intro‚Äê
duzca el valor 1.

2. Transfiera el juego de datos F003H del OB de arranque (OB100) a la CPU con la instrucci√≥n
WRREC (escribir juego de datos). Utilice como ID de hardware una interfaz integrada de la
CPU.

Desactivar SNMP: ejemplo completo del programa
Introducci√≥n
El ejemplo es v√°lido para S7-1500 y S7-1200.
Para incorporar el c√≥digo del programa al proyecto, proceda del siguiente modo:
1. Copie todo el c√≥digo del programa en el portapapeles.
2. Abra un editor de textos (p. ej. "Editor").
3. Inserte el contenido del portapapeles en el editor de textos con el comando Ctrl+V. Guarde
el documento como archivo scl, p. ej. SNMP_DEACT.scl.
4. Abra el proyecto en STEP 7.
5. Importe el archivo scl como fuente externa.
6. Cree el OB de arranque y los bloques de datos.
7. Haga clic con el bot√≥n derecho del rat√≥n en el archivo scl y elija "Generar bloque a partir de
fuente" en el men√∫ contextual.

Ejemplo de programa con llamada de WRREC en el OB 100
DATA_BLOCK "Deactivate_SNMP"
{ S7_Optimized_Access := 'TRUE' }
VERSION : 0.1
NON_RETAIN
VAR
snmp_deactivate : Bool;
snmp_record : Struct

1566

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
BlockID : UInt;
BlockLength : UInt;
"Version" : USInt;
Subversion : USInt;
Reserved : UInt;
SNMPControl : UDInt;
END_STRUCT;
snmp_done : Bool;
snmp_error : Bool;
snmp_Status : DWord;
END_VAR
BEGIN
snmp_deactivate := true;
snmp_record.BlockID := 16#f003;
snmp_record.BlockLength := 8;
snmp_record."Version" := 1;
END_DATA_BLOCK
ORGANIZATION_BLOCK "Startup"
TITLE = "Complete Restart"
{ S7_Optimized_Access := 'TRUE' }
VERSION : 0.1
BEGIN
REPEAT
"WRREC_DB_1"(REQ := "Deactivate_SNMP".snmp_deactivate,
ID := "Local~PROFINET-Schnittstelle_1",
INDEX := 16#b071,
DONE => "Deactivate_SNMP".snmp_done,
ERROR => "Deactivate_SNMP".snmp_error,
STATUS => "Deactivate_SNMP".snmp_Status,
RECORD := "Deactivate_SNMP".snmp_record);
UNTIL "Deactivate_SNMP".snmp_done OR "Deactivate_SNMP".snmp_error
END_REPEAT;
END_ORGANIZATION_BLOCK
DATA_BLOCK "WRREC_DB_1"
{OriginalPartName := 'WRREC';
VersionGUID := 'bc169451-58cd-44a3-855b-3f78cc0623c8';
S7_Optimized_Access := 'TRUE' }
AUTHOR : SIMATIC
FAMILY : DP
NAME : WRREC
VERSION : 1.0
NON_RETAIN
WRREC
BEGIN
END_DATA_BLOCK

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1567

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Denominaci√≥n simb√≥lica y num√©rica de las instrucciones
Descripci√≥n
Las instrucciones de la Task Card se componen de funciones (FC), bloques de funci√≥n (FB),
funciones de sistema (SFC) y bloques de funci√≥n de sistema (SFB) que est√°n identificados
internamente por medio de n√∫meros.
Las tablas siguientes muestran las correspondencias entre la denominaci√≥n num√©rica y la
simb√≥lica.

Bloques de funci√≥n (FBs)

1568

Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FB 105

TC_CONFIG

FB 110

Port_Config

FB 111

Send_Config

FB 112

Receive_Config

FB 113

Send_P2P

FB 114

Receive_P2P

FB 115

Receive_Reset

FB 116

Signal_Get

FB 117

Get_Features

FB 118

Set_Features

FB 163

TC_SEND

FB 164

TC_RECV

FB 165

TC_CON

FB 166

TC_DISCON

FB 804

SET_TIMEZONE

FB 1030

TSEND_C

FB 1031

TRCV_S

FB 1071

USS_DRIVE

FB 1080

MB_COMM_LOAD

FB 1081

MB_MASTER

FB 1082

MB_SLAVE

FB 1084

MB_CLIENT

FB 1085

MB_SERVER

FB 1100

MB_Halt

FB 1101

MC_Home

FB 1102

MC_MoveAbsolute

FB 1103

MC_MoveJog

FB 1104

MC_MoveRelative

FB 1105

MC_MoveVelocity

FB 1107

MC_Power

FB 1108

MC_Reset

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FB 1110

MC_MoveInterrupt

FB 1111

MC_ChangeDynamik

FB 1112

MC_CommandTable

FB 1113

MC_MoveLinearAbs_2D

FB 1114

MC_MoveLinearRel_2D

FB 1115

MC_MoveCircular_2D

FB 1130

PID_Compact

FB 1134

PID_3Step

FB 1140

HSC

FB 2040

RecipeCreate

FB 2041

RecipeOpen

FB 2042

RecipeRead

FB 2043

RecipeWrite

FB 2044

RecipeAppend

FB 2045

RecipeClose

Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

FC 2

CONCAT

Funciones (FCs)
(1)

FC 4 (1)

DELETE

FC 11

(1)

FIND

FC 17

(1)

INSERT

FC 20 (1)

LEFT

FC 21 (1)

LEN

FC 22 (1)

LIMIT

FC 25

MAX

(1)

FC 26 (1)

MID

FC 27

(1)

MIN

FC 31

(1)

REPLACE

FC 32 (1)
FC 36

(1)

RIGHT
ENCO

FC 36 (1)

SEL

FC 37

DECO

FC 800

LED

FC 801

IM_DATA

FC 802

DeviceStates

FC 803

ModuleStates

FC 1070

USS_PORT

FC 1072

USS_RPM

FC 1073

USS_WPM

(1)

Instrucci√≥n MC7+

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1569

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tipos de datos de sistema (SDTs)
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SDT 99

WWW_CDB

SDT 513

CONDITIONS

SDT 581

Send_Conditions

SDT 582

Receive_Conditions

Bloques de funci√≥n de sistema (SFBs)

1570

Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SFB 0

(1)

CTU

SFB 1

(1)

CTD

SFB 2 (1)

CTUD

SFB 3 (1)

TP

SFB 4 (1)

TON

SFB 5

TOF

(1)

SFB 27

START_OB

SFB 52

RDREC

SFB 53

WRREC

SFB 54

RALRM

SFB 105

T_CONFIG

SFB 106

TDIAG

SFB 107

TRESET

SFB 110

PORT_CFG

SFB 111

SEND_CFG

SFB 112

RCV_CFG

SFB 113

SEND_PTP

SFB 114

RCV_PTP

SFB 115

SGN_GET

SFB 116

SGN_SET

SFB 117

RCV_RST

SFB 120

CTRL_HSC

SFB 122

CTRL_PWM

SFB 124

CTRL_HSC_EXT

SFB 140

DataLogCreate

SFB 141

DataLogOpen

SFB 142

DateLogWrite

SFB 143

DataLogClear

SFB 144

DataLogClose

SFB 145

DataLogDelete

SFB 146

DataLogNewFile

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Funciones de sistema (SFCs)
Denominaci√≥n num√©rica

Denominaci√≥n simb√≥lica

SFC 7

DP_PRAL

SFC 11

DPSYC_FR

SFC 13

DPNRM_DG

SFC 14

DPRD_DAT

SFC 16

RD_OBINF

SFC 23

DEL_DB

SFC 28

SET_TINT

SFC 29

CAN_TINT

SFC 30

ACT_TINT

SFC 31

QRY_TINT

SFC 32

SRT_DINT

SFC 33

CAN_DINT

SFC 34

QRY_DINT

SFC 41

DIS_AIRT

SFC 42

EN_AIRT

SFC 43

RE_TRIGR

SFC 45

D_ACT_DP

SFC 46

STP

SFC 82

CREA_DBL

SFC 83

READ_DBL

SFC 84

WRIT_DBL

SFC 86

CREATE_DB

SFC 89

RST_EVOV

SFC 99

WWW

SFC 101

RTM

SFC 117

GET_DIAG

SFC 124

ATTR_DB

SFC 140

IO2MOD

SFC 143

RD_ADDR

SFC 154

RD_LOC_T

SFC 154

DPWR_DAT

SFC 161

WR_LOC_T

SFC 180

ID2LOG

SFC 181

LOG2ID

SFC 182

ID2GEO

SFC 190

SET_CINT

SFC 191

QRY_CINT

SFC 192

ATTACH

SFC 193

DETACH

MC7+ Anweisung

GET_ERROR

MC7+ Anweisung

GET_ERR_ID

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1571

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Bloques de organizaci√≥n
OB de arranque
Descripci√≥n
Es posible definir las condiciones marco para el comportamiento en arranque de la CPU, p. ej.
los valores de inicializaci√≥n para "RUN". Escriba para ello un programa de arranque. Este
programa consta de uno o varios OBs de arranque (n√∫meros de OB 100 o >= 123).
El programa de arranque se ejecuta una vez cuando el estado operativo cambia de "STOP" a
"RUN". Para el programa de arranque no se dispone de valores actuales de la memoria imagen
de proceso de las entradas, ni tampoco es posible activar salidas.
Una vez procesados por completo los OBs de arranque, se lee la memoria imagen de proceso
de las entradas y se inicia el programa c√≠clico.
La ejecuci√≥n del programa de usuario no est√° limitada en el tiempo. Por este motivo, no est√°
activado el tiempo de vigilancia del ciclo. No es posible utilizar bloques de organizaci√≥n
controlados por tiempo ni por alarmas.

Informaci√≥n de arranque
Un OB de arranque tiene la siguiente informaci√≥n de arranque:
Variable

Tipo de datos

Descripci√≥n

LostRetentive

BOOL

= 1, si se han perdido √°reas de datos remanentes

LostRTC

BOOL

= 1, si se ha perdido el reloj en tiempo real

Consulte tambi√©n
Estado operativo "ARRANQUE" (P√°gina 1507)
Eventos y OBs (P√°gina 1521)

OB de ciclo
Introducci√≥n
Para poder comenzar a ejecutar el programa debe existir por lo menos un OB de ciclo en el
proyecto. El sistema operativo llama este OB de ciclo una vez por ciclo, iniciando con ello la
ejecuci√≥n del programa de usuario. Es posible utilizar varios OBs de ciclo (n√∫meros de OB >=
123). Si se utilizan varios OBs de ciclo, estos se llaman uno tras otro en el orden
correspondiente a su n√∫mero de OB. El OB de ciclo con el menor n√∫mero de OB se llama
primero.
Los OBs de ciclo tienen la clase de prioridad 1, es decir, la prioridad m√°s baja de todos los OBs.
Por tanto, los eventos de cualquier otra clase de prioridad pueden interrumpir el programa
c√≠clico.

1572

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Programar la ejecuci√≥n c√≠clica del programa
La ejecuci√≥n c√≠clica del programa se programa escribiendo el programa de usuario en los OBs
de ciclo y los bloques llamados desde all√≠.
La primera ejecuci√≥n c√≠clica del programa comienza tan pronto como haya finalizado sin
errores el programa de arranque. El ciclo vuelve a comenzar cada vez que finaliza la ejecuci√≥n
c√≠clica del programa.

Pasos de la ejecuci√≥n c√≠clica del programa
Un ciclo de ejecuci√≥n del programa abarca los siguientes pasos:
1. El sistema operativo inicia el tiempo de vigilancia del ciclo.
2. El sistema operativo escribe los valores de la memoria imagen de proceso de las salidas en
los m√≥dulos de salidas.
3. El sistema operativo lee el estado de las entradas en los m√≥dulos de entradas y actualiza
la memoria imagen de proceso de las entradas.
4. El sistema operativo procesa el programa de usuario y ejecuta las operaciones
correspondientes.
5. Al final de un ciclo, el sistema operativo puede ejecutar otras tareas pendientes, p. ej. cargar
y borrar bloques, o bien llamar otros OBs de ciclo.
6. A continuaci√≥n, la CPU regresa al comienzo del ciclo y reinicia la vigilancia del tiempo de
ciclo.
Consulte tambi√©n: Memoria imagen de proceso de las entradas y salidas (P√°gina 1517)

Posibilidades de interrupci√≥n
Los siguientes eventos pueden interrumpir la ejecuci√≥n c√≠clica del programa:
‚óè Alarma
‚óè Comando de STOP, disparado por
‚Äì Intervenci√≥n de la programadora
‚Äì Instrucci√≥n "STP"
‚óè Corte de alimentaci√≥n
‚óè Fallo de un dispositivo o error del programa

Informaci√≥n de arranque
‚óè Ninguna
‚óè Informaci√≥n de arranque optimizada:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1573

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre

Tipo de da‚Äê
tos

Significado

first_scan

BOOL

= TRUE en la primera llamada del OB con:
‚óè transici√≥n de STOP o PARADA a RUN
‚óè Tras recargar

remanence

BOOL

= TRUE si hay disponibles datos remanentes

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

Bloques de organizaci√≥n para la ejecuci√≥n del programa controlada por alarmas
OB de alarma horaria
Funci√≥n
Los bloques de organizaci√≥n para alarmas horarias (n√∫meros de OB >=123) pueden
procesarse de la siguiente forma:
‚óè Una sola vez en un instante especificado (con fecha y hora)
‚óè De forma peri√≥dica, con un tiempo de arranque especificado y los siguientes intervalos:
‚Äì Cada minuto
‚Äì Cada hora
‚Äì Cada d√≠a
‚Äì Semanalmente
‚Äì Mensualmente
‚Äì Anualmente
‚Äì A final de mes
Por este motivo, los OBs de alarma horaria se utilizan para ejecutar partes del programa de
usuario de forma controlada por tiempo.

1574

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estados de las alarmas horarias
La siguiente tabla contiene los distintos estados posibles de una alarma horaria, as√≠ como su
significado.
Estado

Significado

Anulada

La alarma ya se ha ejecutado, o bien el evento de arranque de una alarma horaria que a√∫n no se ha
ejecutado se ha borrado con la instrucci√≥n avanzada CAN_TINT.

Ajustada

Se ha determinado el instante o instante de arranque de su ejecuci√≥n.

Activada

Se ha establecido si la alarma debe ejecutarse una sola vez o de forma peri√≥dica, y se ha determinado
el intervalo de tiempo en caso de ejecuci√≥n peri√≥dica.

Reglas para alarmas horarias
Para utilizar alarmas horarias, se aplican las siguientes reglas:
‚óè Una alarma horaria s√≥lo puede ejecutarse si ha sido ajustada y activada, y si existe un
bloque de organizaci√≥n correspondiente en el programa de usuario.
‚óè Los tiempos de arranque de las alarmas horarias peri√≥dicas deben corresponder a una
fecha real. As√≠ pues, no es posible, por ejemplo, la repetici√≥n mensual de un bloque de
organizaci√≥n cuya ejecuci√≥n √∫nica tenga lugar el 31 de enero. En tal caso, el OB s√≥lo se
iniciar√≠a en los meses que tuvieran 31 d√≠as.
‚óè Una alarma horaria que se active durante el arranque llamando la instrucci√≥n avanzada
ACT_TINT, no se ejecutar√° hasta que no haya finalizado el arranque.
‚óè Cada vez que se arranque la CPU, las alarmas horarias ajustadas deber√°n activarse de
nuevo.

Ajuste y activaci√≥n de un OB de alarma horaria
Antes de que una alarma horaria pueda dispararse y de que el sistema operativo pueda
ejecutar, con ello, el OB de alarma horaria asignado, es necesario ajustar y activar la alarma.
Para ello existen las posibilidades siguientes:
Ajustar la alarma horaria

Activar la alarma horaria

Mediante configuraci√≥n

Mediante configuraci√≥n

Mediante configuraci√≥n

Llamando la instrucci√≥n avanzada ACT_TINT

Llamando la instrucci√≥n avanzada SET_TINTL

Llamando la instrucci√≥n avanzada ACT_TINT

Nota
Si se configura una alarma horaria de modo que el OB correspondiente se ejecute una √∫nica
vez, el tiempo de arranque no podr√° encontrarse en el pasado (referido al reloj en tiempo real
de la CPU).
Si se configura una alarma horaria de modo que el OB correspondiente se ejecute de forma
peri√≥dica y el tiempo de arranque se encuentre, sin embargo, en el pasado, el OB de alarma
horaria se ejecutar√° seg√∫n la hora actual cuando se venza la siguiente hora.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1575

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consultar el estado de una alarma horaria
Para consultar el estado de una alarma horaria, llame la instrucci√≥n avanzada QRY_TINT.

Anulaci√≥n de una alarma horaria
Es posible anular alarmas horarias que no se hayan ejecutado todav√≠a a trav√©s de la
instrucci√≥n avanzada CAN_TINT.
Las alarmas horarias anuladas pueden volver a ajustarse con la instrucci√≥n avanzada
SET_TINTL y volver a activarse con la instrucci√≥n avanzada ACT_TINT.

Condiciones que merman el funcionamiento de los OBs de alarma horaria
Puesto que una alarma horaria s√≥lo se ejecuta en determinados intervalos, existen
determinadas condiciones que pueden afectar a la funci√≥n del OB correspondiente durante el
procesamiento del programa. La siguiente tabla muestra algunas de estas condiciones y
describe c√≥mo afectan al procesamiento de un OB de alarma horaria.
Condici√≥n

Resultado

En el programa de usuario, se ejecutan la instrucci√≥n avan‚Äê
zada CAN_TINT.

El sistema operativo borra el evento de arranque (fecha y
hora) de la alarma horaria. La alarma horaria deber√° ajustar‚Äê
se y activarse de nuevo en caso de que deba llamarse nue‚Äê
vamente el correspondiente OB de alarma horaria.

Al sincronizar o corregir el reloj de sistema de la CPU, la hora El sistema operativo ejecuta el OB de error de tiempo (OB 80)
se ha adelantado. Para ello, se ha saltado el tiempo de arran‚Äê e introduce en la informaci√≥n de arranque el evento de arran‚Äê
que de un OB de alarma horaria.
que, el n√∫mero y la prioridad del primer OB de alarma horaria
que se ha saltado. Tras finalizar el OB 80, el sistema opera‚Äê
tivo procesa una √∫nica vez el OB de alarma horaria que se ha
saltado.
Al sincronizar o corregir el reloj de sistema de la CPU, la hora
se ha retrasado. La hora corregida se encuentra por delante
del tiempo de arranque de un OB de alarma horaria ya eje‚Äê
cutado.

El OB de alarma horaria se repite.

Un OB de alarma horaria se est√° procesando todav√≠a cuando El sistema operativo ejecuta el OB de error de tiempo (OB
se produce el evento de arranque para su siguiente procesa‚Äê 80). Tras su procesamiento y el procesamiento posterior del
miento.
OB de alarma horaria actual, se procesa a posteriori el OB
solicitado.

1576

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n de arranque
Un OB de alarma horaria tiene la siguiente informaci√≥n de arranque:
Variable

Tipo de datos

Descripci√≥n

CaughtUp

BOOL

= 1, si se ejecuta el OB a posteriori por haberse adelantado la hora

SecondTime

BOOL

= 1, si el OB se llama por segunda vez por haberse retrasado la hora (dicho de
otro modo: si la hora planeada para el procesamiento actual del OB se en‚Äê
cuentra antes o en el mismo momento de la hora planeada para el procesa‚Äê
miento anterior del OB).
Nota: SecondTime se ajusta una √∫nica vez.

OB de alarma de estado
Descripci√≥n
El sistema operativo de la CPU S7-1200 llama el OB de alarma de estado cuando recibe una
alarma de estado de un maestro DP o un controlador IO. Esto puede suceder cuando un
m√≥dulo de un esclavo cambia de estado operativo, p. ej. de "RUN" a "STOP". Puede obtenerse
m√°s informaci√≥n sobre los eventos que originan una alarma de estado en la documentaci√≥n del
fabricante del esclavo o dispositivo.

Estructura de la informaci√≥n de arranque
El OB de alarma de estado tiene la siguiente informaci√≥n de arranque:
Nombre

Tipo de datos

Significado

LADDR

HW_IO

Direcci√≥n de hardware del componente causante de la alarma

Slot

UINT

N√∫mero de slot del componente causante de la alarma

Especificador

WORD

Especificador de alarma del telegrama de alarma

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

OB de alarma de actualizaci√≥n
Descripci√≥n
El sistema operativo de la CPU S7-1200 llama el OB de alarma de actualizaci√≥n cuando recibe
una alarma de actualizaci√≥n de un maestro DP o un controlador IO. Esto puede suceder
cuando se han modificado par√°metros en un slot de un esclavo o dispositivo. Puede obtenerse
m√°s informaci√≥n sobre los eventos que originan una alarma de actualizaci√≥n en la
documentaci√≥n del fabricante del esclavo o dispositivo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1577

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la informaci√≥n de arranque
El OB de alarma de actualizaci√≥n tiene la siguiente informaci√≥n de arranque:
Nombre

Tipo de datos

Significado

LADDR

HW_IO

Direcci√≥n de hardware del componente causante de la alarma

Slot

UINT

N√∫mero de slot del componente causante de la alarma

Especificador

WORD

Especificador de alarma del telegrama de alarma

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

OB para alarmas espec√≠ficas del fabricante o del perfil
Descripci√≥n
El sistema operativo de la CPU S7-1200 llama el OB57 cuando recibe una alarma de fabricante
o perfil de un maestro DP o un controlador IO. Puede obtenerse m√°s informaci√≥n sobre los
eventos que originan una alarma de este tipo en la documentaci√≥n del fabricante del esclavo
o dispositivo.

Estructura de la informaci√≥n de arranque
El OB de alarma de fabricante o perfil tiene la siguiente informaci√≥n de arranque:
Nombre

Tipo de datos

Significado

LADDR

HW_IO

Direcci√≥n de hardware del componente causante de la alarma

Slot

UINT

N√∫mero de slot del componente causante de la alarma

Especifica‚Äê
dor

WORD

Especificador de alarma del telegrama de alarma

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

OB de alarma de retardo
Descripci√≥n
El sistema operativo inicia un OB de alarma de retardo al cabo de un tiempo de retardo
parametrizable. El tiempo de retardo comienza a transcurrir tras llamar la instrucci√≥n
SRT_DINT.
En el programa pueden utilizarse como m√°ximo cuatro OB de alarma de retardo o de alarma
c√≠clica. Si ya se est√°n utilizando p. ej. dos OBs de alarma c√≠clica, solo se podr√°n insertar como
m√°ximo dos OBs de alarma de retardo en el programa.

1578

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El procesamiento de una alarma de retardo que no se haya iniciado a√∫n se puede impedir con
la instrucci√≥n CAN_DINT.

Funcionamiento de los OB de alarma de retardo
Una vez transcurrido el tiempo de retardo que ha transferido a la instrucci√≥n SRT_DINT junto
con un n√∫mero de OB y una identificaci√≥n, el sistema operativo inicia el OB asociado.
Si desea utilizar un OB de alarma de retardo, utilice las tareas siguientes:
‚óè Llamar la instrucci√≥n SRT_DINT.
‚óè Cargar el OB de alarma de retardo en la CPU como parte del programa de usuario.
La alarma de retardo se mide con una precisi√≥n de 1 ms. Un tiempo de retardo puede
reiniciarse inmediatamente una vez transcurrido.
Los OBs de alarma de retardo se ejecutan √∫nicamente si la CPU se encuentra en estado
operativo "RUN". Un rearranque completo (en caliente) borra todos los eventos de arranque de
los OBs de alarma de retardo.
El sistema operativo llama el OB de alarma de retardo cuando se presenta uno de los eventos
siguientes:
‚óè Cuando el sistema operativo intenta iniciar un OB que no est√° cargado y cuyo n√∫mero se
ha indicado al llamar la instrucci√≥n SRT_DINT.
‚óè Cuando se presenta el siguiente evento de arranque de una alarma de retardo antes de
finalizar el procesamiento del OB de alarma de retardo asociado.
Las alarmas de retardo se pueden inhibir y habilitar con las instrucciones DIS_AIRT y
EN_AIRT, respectivamente.
Nota
Si, tras la ejecuci√≥n de SRT_DINT, se inhibe una alarma con DIS_AIRT, esta alarma se
procesar√° tan solo tras habilitarla con EN_AIRT. El tiempo de retardo se prolonga de la forma
correspondiente.

Informaci√≥n de arranque
‚óè Ninguna
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

sign

WORD

Identificador de usuario: par√°metro de entrada SIGN de la llamada de la
instrucci√≥n "SRT_DINT"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1579

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Variable "sign"
La variable "sign" existe desde la versi√≥n de firmware V4.1 de las CPU S7-1200.
Consulte Informaci√≥n importante sobre las versiones de firmware de la CPU y las versiones de
STEP 7 (P√°gina 1595)

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

OB de alarma c√≠clica
Descripci√≥n
Los OBs de alarma c√≠clica sirven para iniciar programas en intervalos peri√≥dicos,
independientemente de la ejecuci√≥n c√≠clica del programa. Los tiempos de arranque de un OB
de alarma c√≠clica se indican mediante el periodo y el desfase.
El periodo define el intervalo en el que se arranca el OB de alarma c√≠clica y es un m√∫ltiplo
entero del ciclo base de 1 ms. El desfase es el tiempo de desfase del tiempo de arranque con
respecto al ciclo base. Si se utilizan varios OBs de alarma c√≠clica, este desfase puede utilizarse
para impedir un tiempo de arranque simult√°neo, si los periodos de los OBs de alarma c√≠clica
tienen un m√∫ltiplo com√∫n.
Como periodo se puede predeterminar un tiempo comprendido entre 1 ms y 60000 ms.
En el programa pueden utilizarse como m√°ximo cuatro OB de alarma c√≠clica o de alarma de
retardo. Si ya se est√°n utilizando p. ej. dos OBs de alarma de retardo, se podr√°n insertar como
m√°ximo dos OBs de alarma c√≠clica en el programa.
Nota
El tiempo de ejecuci√≥n de todo OB de alarma c√≠clica debe ser muy inferior a su periodo. Si un
OB de alarma c√≠clica no ha finalizado todav√≠a, pero se tiene que ejecutar nuevamente porque
ha finalizado el periodo, se arrancar√° el OB de error de tiempo. A continuaci√≥n, se reactiva o
se rechaza la alarma c√≠clica que ha causado el error.

Ejemplo de utilizaci√≥n del desfase
En el programa se han insertado dos OBs de alarma c√≠clica:
‚óè OB1 de alarma c√≠clica
‚óè OB2 de alarma c√≠clica
Para el OB1 de alarma c√≠clica se ha ajustado un periodo de 20 ms y, para el OB2 de alarma
c√≠clica, de 100 ms. Una vez transcurrido el periodo de 100 ms, el OB1 de alarma c√≠clica
alcanzar√° por quinta vez su tiempo de arranque, mientras que el OB2 de alarma c√≠clica lo har√°

1580

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
por primera vez. No obstante, para procesar ambos OB de alarma c√≠clica de forma desfasada,
es preciso definir un desfase para uno de ellos.

Informaci√≥n de arranque
‚óè Ninguna
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

first_scan

BOOL

= TRUE en la primera llamada del OB
‚óè En la transici√≥n de STOP o PARADA a RUN
‚óè Con cada nueva carga

event_count

INT

N√∫mero de los eventos de arranque perdidos desde el √∫ltimo arranque
del OB

Consulte tambi√©n
Parametrizar OBs de alarma c√≠clica (P√°gina 1592)
Eventos y OBs (P√°gina 1521)

OB de alarma de proceso
Descripci√≥n
Los OB de alarma de proceso pueden utilizarse para reaccionar a determinados eventos. A un
evento que dispara una alarma solo se puede asociar un √∫nico OB de alarma de proceso. En
cambio, a un OB de alarma de proceso pueden asociarse varios eventos.
Los contadores r√°pidos y canales de entrada pueden disparar alarmas de proceso. Es preciso
parametrizar las siguientes propiedades para todo contador r√°pido y canal de entrada que
deba disparar una alarma de proceso:
‚óè El evento de proceso que debe disparar la alarma de proceso (p. ej. cambio del sentido de
contaje de un contador r√°pido)
‚óè El n√∫mero del OB de alarma de proceso asociado a este evento de proceso
En el programa pueden utilizarse como m√°ximo 50 OB de alarma de proceso (n√∫meros de OB
>= 123) independientes unos de otros.

Funcionamiento de un OB de alarma de proceso
Tras disparar una alarma de proceso, el sistema operativo identifica el canal de entrada o el
contador r√°pido y determina el OB de alarma de proceso asociado.
Si no est√° activo ning√∫n otro OB de alarma, se llamar√° el OB de alarma de proceso que se ha
determinado. Si ya se est√° ejecutando otro OB de alarma, la alarma de proceso se colocar√° en

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1581

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
la cola de espera de su clase de prioridad. La alarma de proceso se acusa tras finalizar la
ejecuci√≥n del OB de alarma de proceso asociado.
Si desde que se identifica hasta que se acusa una alarma de proceso se presenta nuevamente
un evento de proceso en el mismo m√≥dulo, se aplicar√° lo siguiente:
‚óè Si el evento se presenta en el canal que ha disparado la alarma de proceso actual, no se
disparar√° ninguna otra alarma de proceso. Una alarma de proceso adicional puede
dispararse tan solo tras haberse acusado la alarma de proceso actual.
‚óè Si el evento se presenta en un canal diferente, se disparar√° una alarma de proceso.
Los OB de alarma de proceso solo se llaman en el estado operativo "RUN" de la CPU.

Informaci√≥n de arranque
‚óè Ninguna
‚óè Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

Laddr

HW_IO

Identificador de hardware del m√≥dulo que dispara la alarma de proceso

USI

WORD

Identificador para ampliaciones futuras (irrelevante para el usuario)

IChannel

USINT

N√∫mero del canal que dispara la alarma de proceso

EventType

BYTE

Identificador de tipo del evento que dispara la alarma (p. ej. flanco as‚Äê
cendente)
Este identificador se indica en la descripci√≥n del m√≥dulo correspondien‚Äê
te.

Consulte tambi√©n
Parametrizar OBs de alarma de proceso (P√°gina 1593)
Eventos y OBs (P√°gina 1521)

OB de error de tiempo
Descripci√≥n
El sistema operativo llama el OB de error de tiempo (OB 80) cuando se presenta uno de los
eventos siguientes:
‚óè El programa c√≠clico excede el tiempo de vigilancia del ciclo.
‚óè El OB llamado se est√° ejecutando todav√≠a (esto es posible en los OBs de alarma de retardo
y de alarma c√≠clica).
‚óè Se ha perdido una alarma horaria porque la hora se ha adelantado m√°s de 20 segundos.
‚óè Una alarma horaria se ha perdido en estado STOP.

1582

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Se ha desbordado una cola de espera de OB de alarma.
‚óè Una alarma se ha perdido por sobrecarga de alarmas.
Si no se ha programado ning√∫n OB de error de tiempo, la CPU S7-1200 se comporta del modo
siguiente:
‚óè CPU con versi√≥n de firmware V1.x a V3.x: La CPU permanece en RUN.
‚óè CPU con versi√≥n de firmware V4.x o superior:
‚Äì Al exceder el tiempo de vigilancia del ciclo, la CPU pasa a STOP.
‚Äì Con todos los dem√°s eventos de inicio del OB de error de tiempo, la CPU permanece en
RUN.
Un segundo rebase del tiempo de vigilancia del ciclo no provoca la llamada de un OB, sino un
STOP de la CPU. El segundo rebase se puede impedir reiniciando la vigilancia del ciclo de la
CPU con la instrucci√≥n RE_TRIGR.
En el programa solo se puede utilizar un OB de error de tiempo.

Informaci√≥n de arranque
El OB de error de tiempo tiene la siguiente informaci√≥n de arranque:
Variable

Tipo de datos

Descripci√≥n

fault_id

BYTE

‚óè 0x01: Tiempo de vigilancia del ciclo excedido
‚óè 0x02: El OB llamado todav√≠a se est√° ejecutando
‚óè 0x05: Alarma horaria expirada debido a salto de hora
‚óè 0x06: Alarma horaria expirada al reanudar en RUN
‚óè 0x07: Desbordamiento de la cola de espera
‚óè 0x09: p√©rdida de alarmas por sobrecarga de alarmas

csg_OBnr

OB_ANY

N√∫mero del OB procesado en el momento en el que ocurri√≥ el
error

csg_prio

UINT

Prioridad del OB procesado en el momento en el que ocurri√≥ el
error

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)
Tiempo de ciclo y tiempo de vigilancia del ciclo (P√°gina 1537)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1583

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OB de alarma de diagn√≥stico
Descripci√≥n
La alarma de diagn√≥stico se puede habilitar para los m√≥dulos aptos para diagn√≥stico, de
manera que el m√≥dulo pueda detectar cambios del estado de la periferia. As√≠, el m√≥dulo
dispara una alarma de diagn√≥stico en los casos siguientes:
‚óè Hay un fallo (evento entrante)
‚óè El fallo se ha solucionado (evento saliente)
Si no est√° activo ning√∫n otro OB de alarma, se llama el OB de alarma de diagn√≥stico (OB 82).
Si ya se est√° ejecutando otro OB de alarma, la alarma de diagn√≥stico se colocar√° en la cola de
espera de su clase de prioridad.
En el programa se puede utilizar un solo OB de alarma de diagn√≥stico.

Informaci√≥n de arranque
El OB de alarma de diagn√≥stico tiene la siguiente informaci√≥n de arranque:
Variable

Tipo de datos

Descripci√≥n

IO_state

WORD

Contiene el estado de la periferia del m√≥dulo
apto para diagn√≥stico.

laddr

HW_ANY

Identificaci√≥n HW

channel

UINT

N√∫mero de canal

multi_error

BOOL

= 1, si ha ocurrido m√°s de un error

Variable IO_state
La tabla siguiente muestra los posibles estados de la periferia que puede contener la variable
IO_state:
IO_state

Descripci√≥n

Bit 0

Configuraci√≥n correcta:
= 1, si la configuraci√≥n es correcta
= 0, si la configuraci√≥n ya no es correcta

Bit 4

Fallo:
= 1, si hay un fallo, p. ej. rotura de hilo
= 0, si se ha solucionado el fallo

Bit 5

Configuraci√≥n incorrecta:
= 1, si la configuraci√≥n no es correcta
= 0, si la configuraci√≥n vuelve a ser correcta

Bit 7

No se puede acceder a la periferia:
= 1, si ha ocurrido un error de acceso a la periferia
En este caso, laddr contiene la ID de hardware de la periferia con el error de acceso.
= 0, si puede accederse nuevamente a la periferia

Bits de 8 a 15

1584

reservado (siempre 0)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

OB de enchufe/desenchufe
Descripci√≥n
El sistema operativo de la CPU S7-1200 llama el OB de cambio de m√≥dulo (OB 83) cuando se
extrae o inserta un m√≥dulo o subm√≥dulo de la periferia descentralizada configurado y no
desactivado (PROFIBUS, PROFINET, AS-i).
Nota
La extracci√≥n o inserci√≥n de un m√≥dulo central provoca un STOP de la CPU.

Informaci√≥n de arranque
El OB de cambio de m√≥dulo tiene la siguiente informaci√≥n de arranque:
Nombre

Tipo de datos Significado

LADDR

HW_IO

Identificador de hardware del m√≥dulo o subm√≥dulo afectado

Event_Class

BYTE

‚óè B#16#38: (sub)m√≥dulo insertado

Fault_ID

BYTE

C√≥digo de error (valores posibles: B#16#51, B#16#54, B#16#55,
B#16#56, B#16#57, B#16#58)

‚óè B#16#39: (sub)m√≥dulo extra√≠do o no responde

La tabla siguiente muestra cu√°l es el evento que ha provocado el arranque del OB de cambio
de m√≥dulo.
ev_class (B#16# ...)

fault_id (B#16# ...)

Significado

39

51

M√≥dulo extra√≠do

39

54

Subm√≥dulo extra√≠do

38

54

Subm√≥dulo insertado equivalente al subm√≥dulo
parametrizado

38

55

Subm√≥dulo insertado que no equivale al subm√≥‚Äê
dulo parametrizado

38

56

Subm√≥dulo insertado, pero error en la parametri‚Äê
zaci√≥n

38

57

Subm√≥dulo o m√≥dulo insertado, pero con fallo o
mantenimiento

38

58

Error de acceso a subm√≥dulo solucionado

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1585

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OB de fallo de rack
Descripci√≥n
El sistema operativo de la CPU S7-1200 llama el OB86 en los siguientes casos:
‚óè Se detecta el fallo de un sistema maestro DP o un sistema PROFINET IO (tanto con evento
entrante como con evento saliente).
‚óè Se detecta el fallo de un esclavo DP o un dispositivo IO (tanto con evento entrante como con
evento saliente).
‚óè Se detecta el fallo de una parte de los subm√≥dulos de un I-Device PROFINET.

Estructura de la informaci√≥n de arranque
El OB de fallo de rack tiene la siguiente informaci√≥n de arranque:
Nombre

Tipo de datos

Significado

LADDR

HW_IO

Identificador de hardware del objeto de hardware defectuoso

Event_Class

BYTE

‚óè B#16#32: activaci√≥n de un esclavo DP o un dispositivo IO
‚óè B#16#33: desactivaci√≥n de un esclavo DP o un dispositivo IO
‚óè B#16#38: evento saliente
‚óè B#16#39: evento entrante

Fault_ID

BYTE

C√≥digo de error (valores posibles: B#16#C3, B#16#C4,
B#16#C5, B#16#C6, B#16#C7, B#16#C8, B#16#C9, B#16#CA,
B#16#CB, B#16#CC, B#16#CD, B#16#CE, B#16#CF, B#16#F8,
B#16#F9)

La tabla siguiente muestra cu√°l es el evento que ha provocado el arranque del OB86.

1586

Ev_class

Fault_id

Significado

B#16# ...

B#16# ...

39

C3

Fallo de un sistema maestro DP

39/38

C4

Fallo/retorno de un esclavo DP

38

C5

Retorno de un esclavo DP, aunque defectuoso

38

C6

Retorno del aparato de ampliaci√≥n, pero error en la parametrizaci√≥n del m√≥‚Äê
dulo

38

C7

Retorno de un esclavo DP, pero hay un fallo en la parametrizaci√≥n del m√≥dulo

38

C8

Retorno de un esclavo DP, pero con diferencias entre la configuraci√≥n te√≥rica
y la configuraci√≥n real

32/33

C9

Activaci√≥n/desactivaci√≥n de un esclavo DP con la instrucci√≥n "D_ACT_DP"

39

CA

Fallo de un sistema PROFINET IO

39/38

CB

Fallo/retorno de un dispositivo PROFINET IO

38

CC

Retorno de un dispositivo PROFINET IO con fallo o mantenimiento

38

CD

Retorno de un dispositivo PROFINET IO, pero la configuraci√≥n te√≥rica difiere
de la configuraci√≥n real

38

CE

Retorno de un dispositivo PROFINET IO, pero error en la parametrizaci√≥n del
m√≥dulo

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Ev_class

Fault_id

B#16# ...

B#16# ...

Significado

32/33

CF

Activaci√≥n/desactivaci√≥n de un dispositivo IO con la instrucci√≥n "D_ACT_DP"

39/38

F8

Fallo/retorno de una parte de los subm√≥dulos de un I-Device PROFINET

38

F9

Retorno de una parte de los subm√≥dulos de un I-Device PROFINET con
diferencias en la configuraci√≥n de dispositivos

Consulte tambi√©n
Eventos y OBs (P√°gina 1521)

OB de servo MC
Descripci√≥n
Si se crea un objeto tecnol√≥gico con conexi√≥n a un accionamiento mediante PROFIdrive/salida
anal√≥gica, se crear√° autom√°ticamente el bloque de organizaci√≥n "MC-Servo [OB91]". La
funcionalidad de Motion Control de los objetos tecnol√≥gicos crea un nivel de ejecuci√≥n propio
y se llama de acuerdo con el ciclo de aplicaci√≥n de Motion Control.
El OB de servo MC est√° protegido contra escritura. No es posible modificar el contenido.
Dentro del OB MC-Servo se calculan los algoritmos de la regulaci√≥n de posici√≥n de todos los
objetos tecnol√≥gicos configurados en la CPU para Motion Control.
Se pueden ajustar el ciclo de aplicaci√≥n y la prioridad del bloque de organizaci√≥n seg√∫n los
propios requisitos de calidad de regulaci√≥n y carga del sistema.

Ciclo de aplicaci√≥n
El ciclo de aplicaci√≥n en el que se llama al OB MC-Servo puede ajustarse en las propiedades
del bloque de organizaci√≥n.
El OB MC-Servo se llama de forma c√≠clica con el ciclo de aplicaci√≥n indicado.
El ciclo de aplicaci√≥n debe elegirse lo suficientemente grande como para procesar todos los
objetos tecnol√≥gicos en un solo ciclo. Si el tiempo de ejecuci√≥n de los objetos tecnol√≥gicos es
mayor que el ciclo de aplicaci√≥n se producen desbordamientos.
Para evitar fallos en la secuencia de programa de la CPU, ajuste el ciclo de aplicaci√≥n en
funci√≥n del n√∫mero de ejes utilizados del siguiente modo:
Ciclo de aplicaci√≥n = n√∫mero de ejes √ó 2 ms
La tabla siguiente muestra a modo de ejemplo el ciclo de aplicaci√≥n resultante de acuerdo con
el n√∫mero de ejes:
N√∫mero de ejes

Ciclo de aplicaci√≥n

1

2 ms

2

4 ms

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

4

8 ms

8

16 ms

1587

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El accionamiento SINAMICS G120 actualiza el sin√≥ptico del proceso del accionamiento cada
4 ms. Para mejorar la regulaci√≥n, ajuste el ciclo de aplicaci√≥n del OB MC-Servo a 4 ms o a un
m√∫ltiplo entero de 4 ms.

Consulte tambi√©n
OB MC-PreServo (P√°gina 1588)
OB MC-PostServo (P√°gina 1589)
OB de interpolador MC (P√°gina 1589)
Parametrizar el OB MC-Servo (P√°gina 1594)

OB MC-PreServo
Descripci√≥n
El bloque de organizaci√≥n MC-PreServo [OB67] puede programarse y se llama en el ciclo de
aplicaci√≥n configurado en el OB MC-Servo (P√°gina 1587). MC-PreServo [OB67] se llama justo
antes que el MC-Servo [OB91].
El bloque de organizaci√≥n permite leer el ciclo de aplicaci√≥n configurado (indicaci√≥n en Œºs).

Estructura de la informaci√≥n de arranque
Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

Initial_Call

BOOL

=TRUE en la primera llamada de este OB durante el paso de STOP
a RUN

PIP_Input

BOOL

TRUE: la respectiva memoria imagen de proceso de las entradas
est√° actualizada

PIP_Output

BOOL

TRUE: la respectiva memoria imagen de proceso de las salidas se
transfiri√≥ a tiempo a las salidas tras el √∫ltimo ciclo

IO_System

USINT

N√∫mero del sistema de periferia descentralizada que ha disparado
la alarma

Event_Count

INT

‚óè = n: n√∫mero de ciclos perdidos
‚óè = -1: se ha perdido un n√∫mero desconocido de ciclos (p. ej.
porque el ciclo ha cambiado).

1588

Synchronous

BOOL

Reservado

CycleTime

UDINT

Indicaci√≥n del ciclo de aplicaci√≥n configurado en el OB MC-Servo
en Œºs

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

OB MC-PostServo
Descripci√≥n
El bloque de organizaci√≥n MC-PostServo [OB95] puede programarse y se llama en el ciclo de
aplicaci√≥n configurado en el OB MC-Servo (P√°gina 1587). MC-PostServo [OB95] se llama
justo despu√©s del MC-Servo [OB91].
El bloque de organizaci√≥n permite leer el ciclo de aplicaci√≥n configurado (indicaci√≥n en Œºs).

Estructura de la informaci√≥n de arranque
Informaci√≥n de arranque optimizada:
Nombre

Tipo de da‚Äê
tos

Significado

Initial_Call

BOOL

=TRUE en la primera llamada de este OB durante el paso de STOP
a RUN

PIP_Input

BOOL

TRUE: la respectiva memoria imagen de proceso de las entradas
est√° actualizada

PIP_Output

BOOL

TRUE: la respectiva memoria imagen de proceso de las salidas se
transfiri√≥ a tiempo a las salidas tras el √∫ltimo ciclo

IO_System

USINT

N√∫mero del sistema de periferia descentralizada que ha disparado
la alarma

Event_Count

INT

‚óè = n: n√∫mero de ciclos perdidos
‚óè = -1: se ha perdido un n√∫mero desconocido de ciclos (p. ej.
porque el ciclo ha cambiado).

Synchronous

BOOL

Reservado

CycleTime

UDINT

Indicaci√≥n del ciclo de aplicaci√≥n configurado en el OB MC-Servo
en Œºs

OB de interpolador MC
Descripci√≥n
Si se crea un objeto tecnol√≥gico con conexi√≥n a un accionamiento mediante PROFIdrive/salida
anal√≥gica, se crear√° autom√°ticamente el bloque de organizaci√≥n "MC‚ÄëInterpolator [OB91]". La
funcionalidad de Motion Control de los objetos tecnol√≥gicos crea un nivel de ejecuci√≥n propio
y se llama de acuerdo con el ciclo de aplicaci√≥n de Motion Control del OB MC-Servo
(P√°gina 1587).
El OB MC-Interpolator est√° protegido contra escritura. No es posible modificar el contenido.
Dentro del OB MC-Interpolator se lleva a cabo la evaluaci√≥n de las instrucciones de Motion
Control, as√≠ como la vigilancia y la generaci√≥n de consignas para todos los objetos
tecnol√≥gicos configurados en la CPU (Motion Control).
El OB MC-Interpolator se llama al finalizar la ejecuci√≥n del OB MC-Servo. La relaci√≥n de ciclos
entre el OB MC-Interpolator y el OB MC-Servo es siempre 1:1.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1589

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comportamiento de ejecuci√≥n
El ciclo de aplicaci√≥n del OB MC-Servo debe elegirse lo suficientemente grande como para
procesar todos los objetos tecnol√≥gicos para Motion Control en un solo ciclo de aplicaci√≥n. Si
no se mantiene el ciclo de aplicaci√≥n, se producen desbordamientos. Tenga en cuenta lo
siguiente en relaci√≥n con los desbordamientos:
‚óè La CPU tolera como m√°ximo tres desbordamientos consecutivos del OB MC-Interpolator.
‚óè La ejecuci√≥n de un OB MC-Interpolator puede ser interrumpida como m√°ximo por una
llamada del OB MC-servo.

Par√°metros de bloques de organizaci√≥n
Principios b√°sicos de los par√°metros de bloque
Introducci√≥n
Algunos bloques de organizaci√≥n (OBs) tienen propiedades que permiten controlar su
comportamiento o asignaci√≥n a determinados eventos. Parametrizando estas propiedades se
puede influir en ellas.

Resumen
Es posible parametrizar las propiedades de los siguientes bloques de organizaci√≥n:
‚óè OBs de alarma horaria
‚óè OBs de alarma c√≠clica
‚óè OBs de alarma de proceso
‚óè OB MC-Servo

Consulte tambi√©n
Parametrizar OBs de alarma de proceso (P√°gina 1593)
Parametrizar OBs de alarma c√≠clica (P√°gina 1592)

Parametrizar un OB de alarma horaria
Procedimiento para configurar los par√°metros
Para ajustar los par√°metros de un OB de alarma horaria, proceda del siguiente modo:
1. Abra el cuadro de di√°logo "Propiedades" del OB de alarma horaria en cuesti√≥n.
2. Haga clic en el grupo "Alarma horaria" de la navegaci√≥n local.

1590

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Vista general de los par√°metros ajustables
Se pueden configurar los par√°metros siguientes:
‚óè Ejecuci√≥n
‚óè Fecha de inicio y hora
‚óè Botones de opci√≥n "Hora local" y "Hora del sistema"

Par√°metro "Ejecuci√≥n"
La lista desplegable "Ejecuci√≥n" permite indicar con qu√© periodicidad debe ejecutarse el OB de
alarma horaria. Los intervalos se basan en los ajustes de "Fecha de inicio" y "Hora".
Est√°n disponibles los siguientes valores de "Ejecuci√≥n":
‚óè nunca
‚óè una sola vez
‚óè una vez por minuto
‚óè una vez por hora
‚óè una vez al d√≠a
‚óè una vez por semana
‚óè una vez al mes
‚óè una vez al a√±o
‚óè a finales de mes
Nota
Con el valor "a finales de mes", el valor indicado bajo "Fecha de inicio" es irrelevante.

Par√°metros "Fecha de inicio" y "Hora"
Permiten establecer en qu√© momento debe ejecutarse el OB de alarma horaria por primera vez.
Ejemplo: fecha de inicio = 05.07.2013, hora =11:16
En funci√≥n del valor del par√°metro "Ejecuci√≥n", la CPU genera otras alarmas horarias
peri√≥dicas. La hora de inicio se refiere, seg√∫n la configuraci√≥n, bien a la hora local, bien al
tiempo universal coordinado UTC.
Nota
Si se configura el par√°metro "Ejecuci√≥n" como "mensual", los d√≠as 29, 30 y 31 no se pueden
seleccionar como fecha de inicio. Si el OB de alarma horaria debe iniciarse a finales de mes,
seleccione en su lugar "a finales de mes" en el par√°metro "Ejecuci√≥n".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1591

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

"Hora local" u "Hora del sistema"
Permite definir a qu√© hora hace referencia la hora de inicio del OB de alarma horaria:
‚óè "Hora local": la hora de inicio se refiere a la zona horaria configurada en la CPU.
‚óè "Hora del sistema": la hora de inicio se refiere al tiempo universal coordinado UTC
(Universal Time Coordinated).

Parametrizar OBs de alarma c√≠clica
Introducci√≥n
Los OB de alarma c√≠clica permiten iniciar programas en intervalos peri√≥dicos. Para ello es
preciso especificar un periodo y un desfase para cada OB de alarma c√≠clica utilizado.
En el programa pueden utilizarse como m√°ximo cuatro OB de alarma c√≠clica u OB de alarma
de retardo (n√∫meros de OB >= 200). Si ya se est√°n utilizando p. ej. dos OB de alarma de
retardo, se podr√°n insertar como m√°ximo dos OB de alarma c√≠clica en el programa.
Nota
Si parametriza varios OB de alarma c√≠clica, es preciso asignar un tiempo de ciclo o un desfase
diferente a cada OB de alarma c√≠clica, con objeto de impedir su ejecuci√≥n simult√°nea y/o una
cola de espera. Al crear un OB de alarma c√≠clica se especifican el tiempo de ciclo 100 y el
desfase 0 como valor de arraque.

Procedimiento
Para especificar un periodo y un desfase para un OB de alarma c√≠clica, proceda del siguiente
modo:
1. Abra la carpeta "Bloques de programa" del √°rbol del proyecto.
2. Haga clic con el bot√≥n derecho del rat√≥n en un OB de alarma c√≠clica existente.
3. Elija el comando "Propiedades" del men√∫ contextual.
Se abre el di√°logo "<Nombre del OB de alarma c√≠clica>".
4. Haga clic en el grupo "Alarma c√≠clica" de la navegaci√≥n local.
Se visualizan los campos de entrada para el periodo y el desfase.
5. Introduzca el periodo y el desfase.
6. Confirme las entradas realizadas con "Aceptar".

Consulte tambi√©n
Principios b√°sicos de los par√°metros de bloque (P√°gina 1590)
OB de alarma c√≠clica (P√°gina 1580)

1592

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Parametrizar OBs de alarma de proceso
Introducci√≥n
Para todo canal de entrada y todo contador r√°pido que debe disparar una alarma de proceso
es preciso activar el evento correspondiente y asignar los par√°metros siguientes:
‚óè Nombre del evento
‚óè N√∫mero del OB de alarma de proceso asociado a este evento de proceso
Las alarmas de proceso se parametrizan en las propiedades del dispositivo correspondiente.
Como m√°ximo pueden parametrizarse 50 OBs de alarma de proceso.
El OB de alarma de proceso que se desea parametrizar puede crearse antes o durante la
activaci√≥n de un evento.

Procedimiento
Para configurar un evento de alarma de proceso, proceda del siguiente modo:
1. Haga doble clic en la entrada "Dispositivos y redes" del √°rbol del proyecto.
El editor de hardware y redes se abre en la vista de red.
2. Cambie a la vista de dispositivos.
3. Si la ventana de inspecci√≥n est√° cerrada en la vista de dispositivos, active la casilla de
verificaci√≥n "Ventana de inspecci√≥n" del men√∫ "Ver".
Se abre la ventana de inspecci√≥n.
4. Haga clic en la ficha "Propiedades".
5. En la vista de dispositivos, seleccione el m√≥dulo para el que desea parametrizar una alarma
de proceso.
6. Active el evento que deba disparar una alarma de proceso, p. ej. un flanco ascendente.

7. Introduzca un nombre de evento.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1593

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
8. Seleccione un OB de alarma de proceso de la lista desplegable "Alarma de proceso", o cree
un OB de alarma de proceso nuevo. Si todav√≠a no ha creado ning√∫n OB de alarma de
proceso, haga clic en el bot√≥n "Agregar nuevo bloque" en la lista desplegable.
La informaci√≥n de arranque del OB de alarma de proceso correspondiente se actualiza con
todos los datos sobre el evento que dispara la alarma.

9. Si desea parametrizar m√°s alarmas de proceso, repita los pasos 5 a 8.
Para el evento, identificado por el nombre de evento un√≠voco, se crea autom√°ticamente una
constante de sistema del tipo de datos Event_Hwlnt. Las constantes de sistema se muestran
en la tabla de variables est√°ndar.

Consulte tambi√©n
Principios b√°sicos de los par√°metros de bloque (P√°gina 1590)
OB de alarma de proceso (P√°gina 1581)
Eventos y OBs (P√°gina 1521)

Parametrizar el OB MC-Servo
Procedimiento para configurar los par√°metros
Para ajustar los par√°metros de un OB MC-Servo, proceda del siguiente modo:
1. Abra el cuadro de di√°logo "Propiedades" del OB MC-Servo en cuesti√≥n.
2. Haga clic en el grupo "Tiempo de ciclo" de la navegaci√≥n local.

Resumen de los par√°metros ajustables
En el grupo "Tiempo de ciclo" se selecciona con qu√© ciclo de aplicaci√≥n se llama c√≠clicamente
el OB MC-Servo en el sistema de ejecuci√≥n de SIMATIC S7-1200:
En el campo "Ciclo de aplicaci√≥n" se ajusta el ciclo en el que se llama el OB MC-Servo.

Consulte tambi√©n
Principios b√°sicos de los par√°metros de bloque (P√°gina 1590)
OB de servo MC (P√°gina 1587)

1594

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n importante sobre las versiones de firmware de la CPU y las versiones de STEP 7
Las CPU y el software de ingenier√≠a para la configuraci√≥n de CPU se encuentran en
permanente desarrollo para mejorar sus prestaciones y su seguridad. De esta forma surgen
nuevas versiones que presentan algunas particularidades en combinaci√≥n con los
componentes. Las siguientes secciones describen las particularidades de las CPU S7-1200
con versi√≥n de firmware V4 en comparaci√≥n con las versiones de firmware V1 a V3.
Para comparar con detalle el volumen de funciones, lea el manual de sistema S7-1200
(descripci√≥n de instrucciones nuevas, bloques de organizaci√≥n nuevos y opciones de
configuraci√≥n avanzadas).

Software de ingenier√≠a necesario
Las CPU S7-1200 V4 son configurables con STEP 7 a partir de V13.

Compatibilidad entre los contenidos de la Memory Card y la versi√≥n de firmware de la CPU
Las Memory Card (tarjeta de transferencia o tarjeta de programa) con configuraci√≥n y
programa para una CPU S7-1200 V1, V2 o V3 no funcionan en una CPU S7-1200 V4.
Las Memory Card con configuraci√≥n y programas para una CPU S7-1200 V4 no funcionan en
una CPU S7-1200 V1, V2 o V3.
La configuraci√≥n de una CPU S7-1200 de V1 a V3 debe cambiarse a una configuraci√≥n de
CPU S7-1200 V4 (sustituci√≥n de dispositivos) y, seguidamente, cargarse en la CPU. Para las
CPU S7-1200 V1 y V2 se requiere una sustituci√≥n gradual (v√©ase abajo).
Si inserta la Memory Card en una CPU con una versi√≥n de firmware incompatible, la CPU no
arranca. Si inserta una Memory Card para una CPU V1, V2 o V3 en una CPU S7-1200 V4, esta
CPU indica un error de versi√≥n.

Paso a online y carga
Si ha configurado con STEP 7 una CPU S7-1200 con la versi√≥n de firmware V1, V2 o V3, es
necesario que la CPU que quiere cargar o a la que quiere pasar online tenga tambi√©n esta
versi√≥n de firmware. Con una CPU S7-1200 V1, V2 o V3 configurada no se puede pasar online
a una CPU S7-1200 V4.
Inversamente, con una CPU S7-1200 V4 configurada no se puede pasar online a una CPU
S7-1200 V1, V2 o V3 ni se puede cargar esta CPU.

Sustituci√≥n de la CPU existente
Existe la posibilidad de sustituir una CPU S7-1200 V1, V2 o V3 por una CPU con una versi√≥n
de firmware V4 o superior. En caso de tener una CPU S7-1200 V1 o V2, primero deber√°
sustituirse por una CPU S7-1200 V3: no es posible cambiarla directamente por una CPU
S7-1200 V4.
1. CPU S7-1200 V1 (V2) > CPU S7-1200 V3
2. CPU S7-1200 V3 > CPU S7-1200 V4
Una sustituci√≥n de dispositivo puede deshacerse (comando "Deshacer" del men√∫ "Edici√≥n")
mientras no se haya cargado la configuraci√≥n. Una vez cargada en la CPU la configuraci√≥n de

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1595

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
la nueva versi√≥n de firmware de la CPU ("configuraci√≥n V4") ya no es posible regresar a una
versi√≥n V3.
Por este motivo es recomendable guardar el proyecto existente, p. ej. con una configuraci√≥n
V3 como fichero de proyecto, para poder acceder a √©l posteriormente.
Particularidades de la sustituci√≥n de dispositivos (V3 > V4):
‚óè El comportamiento de interrupci√≥n de los OB de alarma no cambia; est√°n parametrizados
para que no puedan interrumpirse. Este tambi√©n es el comportamiento predeterminado en
las CPU S7-1200 V1 a V3. En las CPU S7-1200 V4, el comportamiento de interrupci√≥n de
los OB de alarma puede parametrizarse. Si se arrastra una CPU S7-1200 V4 directamente
desde el cat√°logo de hardware hasta la vista de redes, esta opci√≥n est√° activada (los OB
de alarma pueden interrumpirse).
‚óè El comportamiento para el acceso PUT/GET de interlocutores remotos no cambia, el
acceso est√° permitido. Este tambi√©n es el comportamiento predeterminado en las CPU
S7-1200 V1 a V3. En las CPU S7-1200 V4, el acceso v√≠a comunicaci√≥n PUT/GET por parte
de interlocutores remotos es parametrizable (√°rea "Protecci√≥n" de los par√°metros de la
CPU). Si se arrastra una CPU S7-1200 V4 directamente desde el cat√°logo de hardware
hasta la vista de redes, el acceso no est√° permitido y debe habilitarse expl√≠citamente.
‚óè El enunciado de los niveles de protecci√≥n es distinto, pero el efecto de los ajustes es el
mismo. Se ha agregado el nivel de acceso "Sin acceso (protecci√≥n completa)".
‚óè Los ajustes del servidor web para activar este √∫ltimo y los ajustes HTTP/HTTPS se aplican.
Adem√°s existe la posibilidad de crear usuarios y asignarles derechos espec√≠ficos (√°rea
Servidor web > Administraci√≥n de usuarios de los par√°metros de CPU). Sin la
parametrizaci√≥n de usuarios, un usuario del servidor web solo tiene acceso a p√°ginas web
est√°ndar. Las CPU S7-1200 V4 ya no soportan el usuario "admin" ni su contrase√±a.
‚óè Por motivos de compatibilidad, las interfaces de los OB utilizados no cambian al sustituir el
dispositivo. Por consiguiente, es posible seguir utilizando los OB. Si desea utilizar
propiedades del OB que se han agregado a la nueva versi√≥n de firmware de la CPU
S7-1200 o se han modificado, deber√° volver a crear el OB correspondiente.

Comunicaci√≥n con dispositivos HMI
Si conecta un dispositivo HMI a una CPU S7-1200 V4, procure que la versi√≥n del software
runtime del dispositivo HMI sea adecuada.
En caso necesario, debe transferir la √∫ltima versi√≥n de runtime del HMI mediante el software
de ingenier√≠a WinCC.
Para que la comunicaci√≥n CPU-HMI est√© operativa durante el funcionamiento, la configuraci√≥n
HMI debe compilarse de nuevo y volver a cargarse en el dispositivo HMI.

Consulte tambi√©n
Informaci√≥n importante sobre las SIMATIC Memory Cards (P√°gina 1512)

1596

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.2.2

Direccionar m√≥dulos

Direccionamiento de m√≥dulos
Introducci√≥n
En las columnas Direcci√≥n I y Direcci√≥n Q de la vista general de dispositivos se ven las
direcciones o √°reas de direcciones de los m√≥dulos. Al lado hay otras direcciones que se
explican a continuaci√≥n.

Direcci√≥n E/S (direcci√≥n de periferia)
Las direcciones E/S (de entrada y salida) se necesitan para leer entradas y activar salidas en
el programa de usuario.
Las direcciones de entrada y salida se asignan autom√°ticamente al insertar m√≥dulos en el
rack. La direcci√≥n del primer canal representa la direcci√≥n inicial de un m√≥dulo. Las direcciones
de los dem√°s canales se derivan de dicha direcci√≥n inicial. La direcci√≥n inicial se deriva de la
longitud de direcci√≥n espec√≠fica del m√≥dulo.

Direcci√≥n de dispositivo (p. ej. direcci√≥n Ethernet)
Las direcciones de dispositivos son direcciones de m√≥dulos programables (direcciones
Industrial Ethernet). Se requieren para direccionar los distintos dispositivos de una subred, p.
ej. para cargar un programa de usuario en una CPU.

ID de hardware para la identificaci√≥n de m√≥dulos y subm√≥dulos
Adem√°s de las direcciones E y S, se asigna autom√°ticamente un identificador de hardware (ID
HW) que se utiliza para direccionar e identificar el m√≥dulo. Tambi√©n los subm√≥dulos (unidades
funcionales de un m√≥dulo), como un contador integrado, obtienen una ID HW.
La ID HW consiste en un n√∫mero entero y es emitida por el sistema junto con avisos de
diagn√≥stico con el fin de localizar el m√≥dulo o subm√≥dulo defectuoso.
La ID HW se utiliza tambi√©n para una serie de instrucciones para direccionar el m√≥dulo
correspondiente.
No es posible modificar la ID HW.
Ejemplo: Identificaci√≥n de contador r√°pido de la CPU S7-1200

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1597

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La ID HW se asigna autom√°ticamente al insertar componentes en la vista de dispositivos o
redes y se introduce junto a las variables PLC (ficha Constantes del sistema). Tambi√©n se
asigna autom√°ticamente un nombre para la ID HW. Las constantes del sistema de las
variables PLC tampoco se pueden modificar.

Consulte tambi√©n
Definir las direcciones de entrada y salida (P√°gina 1598)
Asignar direcciones a una ubicaci√≥n del programa (P√°gina 1599)
Introducci√≥n a la carga de una configuraci√≥n (P√°gina 3334)
Ventana de inspecci√≥n (P√°gina 24)

Definir las direcciones de entrada y salida
Las direcciones de entrada y salida se predeterminan autom√°ticamente. De todas formas, es
posible modificar posteriormente la asignaci√≥n de direcciones.
Todas las direcciones de m√≥dulos est√°n en el √°rea de la memoria imagen de proceso. √âsta se
actualiza c√≠clica y autom√°ticamente.

Requisitos
Se encuentra en la vista de dispositivos.

Procedimiento
Para modificar el √°rea de direcciones predeterminada, proceda del siguiente modo:
1. En la vista de dispositivos, haga clic en el m√≥dulo cuya direcci√≥n inicial desea ajustar.
2. En la ventana de inspecci√≥n, vaya a "Propiedades" y, seguidamente, a "Direcciones de E/
S".
3. Introduzca la direcci√≥n inicial deseada en "Direcci√≥n inicial".
4. Pulse <Intro> o haga clic en cualquier otro objeto para aplicar el valor modificado.
Si se ha introducido una direcci√≥n no v√°lida, aparecer√° un aviso con la pr√≥xima direcci√≥n libre.
Nota
Tambi√©n existe la posibilidad de modificar las direcciones directamente en la vista de
dispositivos.

Consulte tambi√©n
Editar las propiedades y los par√°metros (P√°gina 63)
Direcciones de entrada y salida en la vista de direcciones (P√°gina 65)

1598

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Asignar direcciones a una ubicaci√≥n del programa
Es posible asignar direcciones desde los canales E/S de los m√≥dulos directamente a las
ubicaciones del programa o a una tabla de variables.

Requisitos
‚óè Est√° abierta la vista de dispositivos del editor de hardware y redes.
‚óè El factor de zoom en la vista de dispositivos debe ser del 200% como m√≠nimo para que se
vean los diferentes canales E/S.
‚óè Est√°n abiertas la ventana de instrucciones del editor de programaci√≥n o una tabla de
variables.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1599

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento
Para asignar canales E/S de m√≥dulos a las ubicaciones del programa o a una tabla de
variables, proceda del siguiente modo:
1. En la vista de dispositivos, navegue hasta el m√≥dulo que tenga el canal E/S deseado.
2. Manteniendo pulsado el bot√≥n del rat√≥n, arrastre la direcci√≥n E/S deseada hasta la
ubicaci√≥n correspondiente del bloque o hasta la tabla de variables.

1600

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La direcci√≥n del m√≥dulo se asignar√° a la ubicaci√≥n del programa, o se introducir√° como
variable en la tabla de variables.
Nota
La variable para una entrada o salida de un bloque tambi√©n puede arrastrarse hasta la entrada
o la salida de un m√≥dulo para relacionar l√≥gicamente la variable con el canal E/S del m√≥dulo.

1.4.2.3

Signal Board

Insertar una Signal Board en la CPU
Introducci√≥n
Las Signal Boards ofrecen la posibilidad de aumentar el n√∫mero de entradas y salidas propias
de la CPU en las CPUs S7-1200. Como todos los dem√°s componentes de hardware, las Signal
Boards est√°n en el cat√°logo de hardware. Las Signal Boards no se insertan en el rack como los
dem√°s m√≥dulos, sino directamente en un slot propio de la CPU.
Al utilizar una Signal Board hay que tener en cuenta lo siguiente:
‚óè Cada CPU puede alojar una sola Signal Board.
‚óè La Signal Board s√≥lo se puede insertar si el slot de la CPU est√° libre.
Existen las posibilidades siguientes para insertar una Signal Board en una CPU:
‚óè Doble clic en una Signal Board del cat√°logo de hardware si hay un slot libre en la CPU
‚óè Drag & Drop del cat√°logo de hardware a un slot libre de la CPU
‚óè Men√∫ contextual de una Signal Board en el cat√°logo de hardware para "Copiar" y "Pegar"

Requisitos
‚óè El cat√°logo de hardware est√° abierto.
‚óè La CPU S7-1200 tiene un slot libre para la Signal Board.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1601

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Insertar una Signal Board en la CPU
Para insertar una Signal Board en una CPU, proceda del siguiente modo:
1. Navegue hasta la Signal Board deseada en el cat√°logo de hardware.
2. Seleccione la Signal Board deseada.
3. Arrastre la Signal Board hasta el slot libre de la CPU con la funci√≥n Drag & Drop.

Ahora se ha insertado la Signal Board en el slot de la CPU.
Si est√° en la vista de redes, tambi√©n puede arrastrar una Signal Board hasta un dispositivo con
la funci√≥n Drag & Drop. Si la CPU tiene un slot libre para una Signal Board, √©sta se insertar√°
autom√°ticamente en dicho slot.

1.4.2.4

Configuraciones para el servidor web

Informaci√≥n importante sobre el servidor web
Introducci√≥n
El servidor web le proporciona la posibilidad de observar su CPU a trav√©s de Internet o de la
Intranet de la empresa. Eso permite la evaluaci√≥n y el diagn√≥stico a grandes distancias.
Los avisos y la informaci√≥n sobre el estado se muestran en p√°ginas HTML.

Navegador web
Para acceder a las p√°ginas HTML de la CPU se requiere un navegador web.
La informaci√≥n acerca de los navegadores web y las versiones con las que se ha probado el
servidor web se encuentra en el manual (http://support.automation.siemens.com/WW/
view/es/36932465) correspondiente.

Leer informaci√≥n sobre el servidor web
La informaci√≥n detallada a continuaci√≥n puede leerse de la CPU. La disponibilidad de las
respectivas p√°ginas web depende de la CPU y de su versi√≥n de firmware.

1602

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
A partir de la versi√≥n de firmware 4, las p√°ginas web est√°n disponibles en varios idiomas.
P√°gina/informaci√≥n

Descripci√≥n

Introducci√≥n

P√°gina de acceso para p√°ginas web est√°ndar

P√°gina de inicio con informaci√≥n general de la CPU La p√°gina inicial ofrece informaci√≥n general de la
CPU, el nombre de la CPU, el tipo de CPU e in‚Äê
formaci√≥n b√°sica sobre el estado operativo actual.
Diagn√≥stico

Visualizaci√≥n de informaci√≥n detallada de la CPU,
incluidos el n√∫mero de serie, la referencia y la ver‚Äê
si√≥n.
Visualizaci√≥n del contenido del b√∫fer de diagn√≥s‚Äê
tico con las entradas m√°s recientes en primer lu‚Äê
gar.

Informaci√≥n de m√≥dulos

Visualizaci√≥n de la informaci√≥n que identifica si los
componentes de una estaci√≥n insertados de for‚Äê
ma centralizada son correctos, si hay, p. ej., soli‚Äê
citudes de mantenimiento o si algunos componen‚Äê
tes no son accesibles.
A partir de la versi√≥n 4 de FW es posible actualizar
el firmware a trav√©s de esta p√°gina web.

Comunicaci√≥n

Visualizaci√≥n de las conexiones de comunicaci√≥n
con una comunicaci√≥n abierta (OUC), visualiza‚Äê
ci√≥n de los recursos y los par√°metros de direcci√≥n.

B√∫fer de diagn√≥stico

Visualizaci√≥n del contenido del b√∫fer de diagn√≥s‚Äê
tico.

Variables

Indicaci√≥n del estado de los operandos del pro‚Äê
grama de usuario para observar y forzar valores.

Explorador de archivos

Ficheros de datos en formato CSV para transferir
al disco duro de la PG. Los ficheros de datos se
crean con instrucciones Data Log en el programa
de usuario y se llenan con datos.

(a partir de la versi√≥n de firmware 4)

A partir de la versi√≥n de firmware 4 se accede a
trav√©s de esta p√°gina web a los archivos de la
memoria de carga interna y externa (Memory
Card), p. ej., al contenido de los directorios "Data‚Äê
Logs" y "Recipes".
Inicio de sesi√≥n

Inicio de sesi√≥n como usuario o cierre de sesi√≥n.

P√°ginas de usuario (en caso de que se hayan con‚Äê Las p√°ginas web del usuario proporcionan una lis‚Äê
figurado y cargado p√°ginas web definidas por el
ta de las p√°ginas web con aplicaciones web espe‚Äê
c√≠ficas del cliente.
usuario)

Acceso web a la CPU mediante PG/PC
Para acceder al servidor web, proceda de la siguiente manera:
1. Conecte el cliente (la PG/el PC) con la CPU a trav√©s de la interfaz PROFINET.
2. Abra el navegador web.
En el campo "Direcci√≥n" del navegador web, introduzca la direcci√≥n IP de la CPU de la
manera siguiente: http://ww.xx.yy.zz (entrada a modo de ejemplo: http://192.168.3.141).
Se abre la p√°gina inicial de la CPU. Desde all√≠ podr√° acceder al resto de las informaciones.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1603

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

P√°ginas web est√°ndar
Requisitos para el acceso web
A continuaci√≥n se explican los requisitos para el acceso a las p√°ginas web est√°ndar de la CPU,
as√≠ como las repercusiones de la falta o la existencia de informaci√≥n de configuraci√≥n.

Requisitos
El servidor web debe estar iniciado.
El servidor web no se inicia hasta que no se activa en las propiedades de la CPU, dentro de la
secci√≥n "Servidor web".
Considere lo siguiente:
De forma est√°ndar, las p√°ginas web se transfieren a trav√©s de una conexi√≥n no segura y no
est√°n protegidas de los ataques de terceros. Si se desean transferir las p√°ginas web al
navegador de manera codificada, utilice la URL https://, seguida de la direcci√≥n IP de la CPU.

Iniciar sesi√≥n
Para acceder a las p√°ginas web est√°ndar en modo de lectura no es necesario iniciar sesi√≥n.
Para realizar determinadas acciones como el cambio de estado operativo de la CPU o para
acceder en escritura, es preciso que un usuario haya iniciado sesi√≥n.
CPU S7-1200 hasta la versi√≥n 3 de FW:
para las acciones mencionadas m√°s arriba, el usuario debe haber iniciado sesi√≥n como
"admin". Los campos de entrada para iniciar sesi√≥n se encuentran en la esquina superior
izquierda de todas las p√°ginas web est√°ndar.

Al iniciar sesi√≥n como usuario "admin", deber√° introducirse el nombre de usuario y la
contrase√±a.
Nombre: admin.
Contrase√±a: contrase√±a configurada para la CPU (para CPU protegida por contrase√±a).
CPU S7-1200 a partir de la versi√≥n 4 de FW:
Los nombres de usuario y las contrase√±as pueden elegirse a discreci√≥n (par√°metro de CPU
"Servidor web", √°rea "Administraci√≥n de usuarios").
Se deben asignar derechos a los usuarios, p. ej., el derecho a consultar el diagn√≥stico o a
actualizar el firmware.

Javascript y cookies
Las p√°ginas web est√°ndar utilizan Javascript y cookies. Ambos deber√°n estar habilitados en
el navegador web.

1604

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si Javascript no est√° habilitado, aparecen, entre otras, las siguientes restricciones:
‚óè Los datos de las p√°ginas web est√°ndar no se actualizan autom√°ticamente.
‚óè No es posible iniciar sesi√≥n como usuario.
‚óè Los campos no pueden clasificarse (informaci√≥n del m√≥dulo)
Si las cookies no est√°n habilitadas, no es posible iniciar sesi√≥n.

Consulte tambi√©n
Acceso para HTTPS (P√°gina 1606)

Ajustes para el funcionamiento
Ajustes para el funcionamiento
Para poder utilizar el servidor web de una CPU S7-1200, hay que marcar la CPU en la vista de
redes o dispositivos y realizar los siguientes ajustes en la ventana de inspecci√≥n dentro de
"Propiedades > General > Servidor web":
‚óè Activar el servidor web
‚óè Limitar los accesos a la CPU al protocolo de transferencia HTTPS (transferencia codificada)
En este caso se bloquean los accesos a trav√©s del puerto 80. La comunicaci√≥n s√≥lo es
posible a trav√©s del puerto 443.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1605

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Activar la actualizaci√≥n autom√°tica de las p√°ginas web
El intervalo de actualizaci√≥n est√° predeterminado y no puede modificarse. La CPU
actualiza las p√°ginas web con contenidos variables (p. ej. informaci√≥n de estado o de
diagn√≥stico) a intervalos regulares.
‚óè Crear y gestionar usuarios
El usuario dispondr√° √∫nicamente de las opciones que se le hayan asignado en los derechos
de acceso.
Dependiendo de la CPU y el firmware utilizados, se pueden asignar diferentes derechos de
usuario. Los derechos que su CPU no soporta no pueden activarse. En la lista de usuarios
se ha incluido de forma predeterminada un usuario con el nombre "Cualquiera" que posee
derechos de acceso m√≠nimos, aunque pueden ampliarse: Todo usuario que utilice el
servidor web sin introducir la contrase√±a, tendr√° los derechos de acceso del usuario
"Cualquiera".
Existe la posibilidad de parametrizar otros usuarios con derechos de acceso distintos.
Estos usuarios deben iniciar sesi√≥n con el nombre de usuario y la contrase√±a
parametrizados.
ADVERTENCIA
Acceso no autorizado a la CPU a trav√©s del servidor web
El acceso no autorizado a la CPU o la modificaci√≥n de las variables PLC a valores no
v√°lidos puede causar interrupciones del proceso controlado por la CPU, as√≠ como
provocar la muerte, lesiones graves o da√±os materiales.
Dado que la activaci√≥n del servidor web permite a personas autorizadas realizar tareas
como cambiar los estados operativos, acceder a datos de la CPU en modo de escritura o
actualizar el firmware, recomendamos tener en cuenta las siguientes medidas de
seguridad:
‚óè Si es posible, limite los accesos al protocolo HTTPS.
‚óè Cree usuarios con contrase√±as seguras. Una contrase√±a segura es aquella que, por
ejemplo, solo se usa para una √∫nica aplicaci√≥n, contiene m√°s de 8 caracteres y est√°
formada por letras may√∫sculas y min√∫sculas, caracteres especiales y cifras (?!+%
$1234...). Asimismo, no debe utilizarse ninguna cadena de caracteres habitual del
teclado del ordenador o palabras del diccionario.
Modifique la contrase√±a peri√≥dicamente.
‚óè No ampl√≠e los derechos del usuario "Cualquiera".
‚óè Compruebe las variables PLC en el programa de usuario y limite el rango de valores a
rangos admisibles, dado que los usuarios pueden ajustar valores no v√°lidos a trav√©s
del servidor web.

Acceso para HTTPS
Acceso a trav√©s de HTTPS
Un HTTP sirve para codificar y autenticar la comunicaci√≥n entre el navegador y el servidor web.
Para llevar a cabo la transmisi√≥n de datos entre el navegador y la CPU a trav√©s del protocolo
HTTPS, deber√° introducirse la URL como https://ww.xx.yy.zz en la barra de direcci√≥n del

1606

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
navegador web, teniendo en cuenta que ww.xx.yy.zz hace referencia a la direcci√≥n IP de la
CPU.
Para que el HTTPS pueda acceder correctamente a la CPU, es necesario tener instalado un
certificado v√°lido.
Si no hay ning√∫n certificado instalado, aparece una advertencia con la recomendaci√≥n de no
utilizar la p√°gina. Para poder visualizar la p√°gina, debe seleccionarse expl√≠citamente la opci√≥n
"Agregar excepci√≥n".
En "Download certificate" de la p√°gina web "Intro" puede descargarse un certificado v√°lido
(Certification Authority) "SIMATIC CONTROLLER". En la Ayuda del navegador web
correspondiente se explica c√≥mo instalar un certificado.

Acceder a datos de la memoria de la CPU
A los datos que se encuentran en la memoria de carga interna o externa de la CPU se puede
acceder a trav√©s de una p√°gina web est√°ndar.
‚óè En las CPU S7-1200 hasta la versi√≥n 3 de FW inclusive, utilice la p√°gina web "Data Logs".
Desde esta p√°gina web se transmiten los Data Logs (registros de datos) desde la CPU
hasta una unidad de su PC.
‚óè En las CPU S7-1200 a partir de la versi√≥n 4 de FW, utilice la p√°gina web "File Browser".
Desde esta p√°gina web se transmiten los datos, p. ej., desde las carpetas "Data Logs" o
"Recipes", hasta una unidad de su PC.
Dependiendo del tipo de archivo y de los derechos de acceso que haya parametrizado para los
usuarios del servidor web, los archivos se podr√°n descargar, borrar, renombrar o cargar. Los
directorios propiamente dichos solo pueden crearse, borrarse o renombrarse.

Ejemplo: Data Logs
Para abrir un Data Log, hay que hacer clic en el enlace del Data Log deseado. Existe la
posibilidad de abrir el archivo (.csv) p. ej. en Microsoft Excel u otro programa de su elecci√≥n o
de guardarlo.
Particularidad: los Data Logs est√°n guardados en el formato CSV estadounidense, por lo que
solo pueden abrirse directamente con la versi√≥n estadounidense de Microsoft Excel. En caso
de disponer del programa en la versi√≥n de otro pa√≠s, ser√° necesario importar el archivo. En el
asistente de importaci√≥n deber√° elegirse "Coma" como car√°cter separador.

Descargar un Data Log
Para descargar un Data Log, haga clic en el s√≠mbolo de descarga del Data Log deseado. Existe
la posibilidad de abrir el archivo (.csv) p. ej. en Microsoft Excel u otro programa de su elecci√≥n
o de guardarlo.

Descargar y vaciar o borrar un Data Log
En una CPU con la versi√≥n de FW hasta V3.0:
Para poder descargar y borrar las entradas actuales del Data Log, es necesario haber iniciado
una sesi√≥n. Para ello, es necesario hacer clic en el s√≠mbolo "Descargar y borrar" del

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1607

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
correspondiente Data Log. Existe la posibilidad de abrir el archivo (.csv) p. ej. en Microsoft
Excel u otro programa de su elecci√≥n o de guardarlo.
En una CPU con la versi√≥n de FW a partir de V4.0:
Para inicializar el Data Log, proceda del siguiente modo:
1. Abra el archivo CSV, p. ej. con Excel.
2. Borre las filas entre la fila de t√≠tulo y la fila con la entrada "//END", si existe.
3. Guarde el archivo en una unidad de su PC.
4. Borre el Data Log (es decir, el archivo CSV) en la p√°gina web "File Browser" y cargue el
archivo CSV preparado con el bot√≥n "Upload file" de la p√°gina web "File Browser" en la
CPU.
Encontrar√° m√°s informaci√≥n en el manual de sistema de la CPU S7-1500.

Crear y cargar p√°ginas de usuario
Informaci√≥n importante sobre p√°ginas de usuario
Concepto
El concepto de p√°ginas de usuario o p√°ginas web definidas por el usuario permite acceder con
un navegador web a las p√°ginas web de la CPU dise√±adas por el usuario. El servidor web de
la CPU pone a disposici√≥n esta funci√≥n.
Para configurar la apariencia y funcionalidad de las p√°ginas web definidas por el usuario no se
requieren herramientas especiales. Puede utilizarse CSS para adaptar el dise√±o de las
p√°ginas, Javascript para incluir contenido din√°mico o cualquier otro framwork que el usuario
desee para crear las p√°ginas web. El conjunto de archivos que procesa el servidor web
tambi√©n recibe el nombre de "aplicaci√≥n web".

Aplicaci√≥n web y programa de usuario
Utilizando un c√≥digo HTML especial en p√°ginas web definidas por el usuario (comandos
AWP), tambi√©n pueden transferirse datos al programa de usuario de la CPU a trav√©s de un
navegador web para su posterior procesamiento, as√≠ como visualizarse datos del √°rea de
operandos de la CPU en el navegador web.
Con instrucciones de script (p. ej. Javascript) puede optimizar sus p√°ginas web, p. ej. modificar
contenidos de forma din√°mica o validar entradas de usuario.

1608

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para sincronizar el programa de usuario y el servidor web, as√≠ como para la inicializaci√≥n, es
necesario llamar la instrucci√≥n WWW (SFC 99) del programa de usuario.
‚óè Si no hace falta que la aplicaci√≥n web y el programa de usuario interact√∫en, p. ej. si una
p√°gina web solo ofrece informaci√≥n est√°tica, solo es necesaria una inicializaci√≥n en el
programa de usuario.
‚óè Si se requiere un intercambio de datos sencillo entre las variables PLC y las variables de la
aplicaci√≥n web, p. ej. para mostrar el contenido de las variables PLC o para escribir un valor
en una variable PLC, deber√° tener en cuenta la sintaxis para la lectura y escritura de
variables. Asimismo, en el programa de usuario se requiere en este caso tan solo una
inicializaci√≥n, p. ej. en el OB de arranque.
‚óè Si se requiere una mayor interacci√≥n entre la aplicaci√≥n web y el programa de usuario,
deber√° manipular, adem√°s de la sincronizaci√≥n entre el servidor web y el programa de
usuario, la informaci√≥n de estado y de control del DB Web Control. Esto ser√° necesario,
p. ej., en el caso de entradas de usuario que se transfieran al servidor web a trav√©s del
navegador web para que la CPU las eval√∫e. A diferencia del intercambio de datos sencillo,
el programa de usuario influye directamente en el momento en el que se devuelve al
navegador web la p√°gina web solicitada. En este caso, es necesario que el usuario se
familiarice con el concepto de los fragmentos manuales y las estructuras del DB Web
Control.

Integraci√≥n de las fuentes HTML a trav√©s de TIA Portal
Los par√°metros para la integraci√≥n de las fuentes HTML en TIA Portal se encuentran en las
propiedades de la CPU en cuesti√≥n con servidor web:
Par√°metro

Significado

Directorio HTML Directorio de las fuentes HTML para la aplicaci√≥n web. Existe la posibilidad de introducir la ruta directa‚Äê
mente o navegar hasta el directorio utilizando el bot√≥n situado junto al campo de entrada.
Resulta conveniente integrar las p√°ginas web con rutas relativas. Para ello es necesario insertar el di‚Äê
rectorio en el que se guardan las fuentes HTML para la aplicaci√≥n web en el directorio de proyecto de
STEP 7, p. ej. en un directorio nuevo denominado "Webpages". Seguidamente, se indica como directorio
HTML el nombre de ruta relativa, en el ejemplo ".\Webpages".
Ventajas del uso de rutas relativas:
‚óè Las p√°ginas web personalizadas se archivan junto con el proyecto de STEP 7.
‚óè Las p√°ginas web se copian tambi√©n en la nueva ruta con el comando de men√∫ "Proyecto > Guardar
como...".
‚óè Al copiar el proyecto en otra ruta con el Explorador de Windows, no se adapta la ruta del directorio
HTML para generar nuevos DB web.
‚óè Si en un proyecto hay varios controladores que utilizan las mismas p√°ginas HTML, tambi√©n tendr√°n la
misma ruta de directorio HTML.
P√°gina HTML
predeterminada

Ruta a la p√°gina HTML predeterminada. Existe la posibilidad de introducir la ruta directamente o navegar
hasta la p√°gina HTML utilizando el bot√≥n situado junto al campo de entrada. La p√°gina HTML predeter‚Äê
minada es la p√°gina HTML que se debe abrir al iniciar la aplicaci√≥n web.

Nombre de apli‚Äê
caci√≥n

Nombre opcional para la aplicaci√≥n. Este nombre sirve para la posterior clasificaci√≥n o agrupaci√≥n de las
p√°ginas web. Si hay un nombre de aplicaci√≥n disponible, la URL se muestra en el formato siguiente: "http://
a.b.c.d/awp/<nombre de aplicaci√≥n>/<nombre de la p√°gina>.html"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1609

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Inicializaci√≥n
Las p√°ginas web definidas por el usuario se "comprimen" en bloques de datos para que la CPU
pueda procesarlas. Durante la configuraci√≥n, deben generarse los correspondientes bloques
de datos a partir de los datos de origen (archivos HTML, im√°genes, archivos Javascript, etc.)
para poder cargar la aplicaci√≥n web en la CPU. El DB Web Control (predeterminado: DB 333),
que contiene informaci√≥n de estado y de control, as√≠ como referencias a otros bloques de datos
con p√°ginas web cifradas, desempe√±a una funci√≥n particular. Los bloques de datos que
contienen las p√°ginas web encriptadas reciben el nombre de "DBs de fragmento".
Si los bloques de datos se han cargado en la CPU, esta no "sabe" que las p√°ginas web
definidas por el usuario que contiene est√°n cifradas. Con la instrucci√≥n "WWW" (SFC 99), p.
ej. en un OB de arranque, se le informa de qu√© DB es el DB Web Control. Tras esta
inicializaci√≥n, es posible acceder a las p√°ginas web definidas por el usuario desde un
navegador web.

Sincronizaci√≥n
Si el programa de usuario debe intercambiar datos o interactuar con las p√°ginas web definidas
por el usuario, deber√° utilizarse la instrucci√≥n WWW (SFC 99) en la parte c√≠clica del programa.
Ejemplos de interacci√≥n entre programa de usuario y p√°gina web:
‚óè Comprobar los datos recibidos
‚óè Recopilar y reenviar los datos para el navegador web solicitante
En este caso, la informaci√≥n de estado debe ser evaluable en el momento y la informaci√≥n de
control debe comunicarse al servidor web, p. ej., para habilitar una p√°gina web solicitada.

Vista general del procedimiento
Principios b√°sicos
En este cap√≠tulo se describe paso a paso el procedimiento fundamental que hay que seguir
para crear, cargar y utilizar en la fase operativa p√°ginas web definidas por el usuario.
El siguiente gr√°fico muestra el proceso para la creaci√≥n y visualizaci√≥n de p√°ginas web
definidas por el usuario de forma simplificada:

1610

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones







+70/
*,)



:::

‚ë†
‚ë°
‚ë¢



Programaci√≥n de una aplicaci√≥n web (si es necesario, utilizando herramientas adecuadas y, si
se da el caso, con los comandos AWP incluidos para p√°ginas din√°micas).
La aplicaci√≥n web se compone de distintos archivos de origen, p. ej. *.html, *.gif, *.js, etc.
Con STEP 7:
‚óè Generar bloques de datos (DB de Web Control y DBs de fragmento) de los archivos de
origen. Los DBs contienen metainformaci√≥n y la aplicaci√≥n web completa, incluidas las
im√°genes y las partes din√°micas y est√°ticas de la aplicaci√≥n web. Los DBs se almacenan en
el √°rbol del proyecto, dentro de "Bloques de sistema".
‚óè Llamar la instrucci√≥n "WWW" en el programa de usuario. La instrucci√≥n inicializa el servidor
web de la CPU para una aplicaci√≥n web.

‚ë£
‚ë§

‚óè Si es necesario, desprogramar la interacci√≥n entre el servidor web y el programa de usuario.
Cargar los bloques en la CPU.
Abrir la p√°gina web en el navegador web. La llamada de las p√°ginas web de la CPU se realiza
introduciendo la direcci√≥n IP de la CPU.

Informaci√≥n adicional
Encontrar√° m√°s informaci√≥n y ejemplos sobre el servidor web de la S7-1200 en Internet (http://
support.automation.siemens.com/WW/view/es/36932465).

Crear p√°ginas web
Para crear p√°ginas web definidas por el usuario pueden utilizarse herramientas de dise√±o web
de distintos proveedores. B√°sicamente, las p√°ginas web deben programarse y dise√±arse
seg√∫n las convenciones del W3C (World Wide Web Consortium). En el servidor web de la CPU
no se comprueba si se cumplen los criterios del W3C.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1611

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas
‚óè La herramienta debe ofrecer la posibilidad de editar el c√≥digo HTML directamente para que
los comandos AWP puedan insertarse en la p√°gina HTML.
En la CPU s√≥lo se analizan sint√°cticamente los comandos AWP y, por ejemplo, se
sustituyen por valores del programa de usuario / memoria imagen de proceso de la CPU.
‚óè Los archivos que contienen comandos AWP deben estar codificados con UTF-8. Por esta
raz√≥n, ajuste el atributo charset a UTF-8 en los metadatos de la p√°gina HTML y guarde el
archivo codificado en UTF-8.
‚óè Los archivos que contienen comandos AWP no pueden contener la siguiente secuencia: ]]
‚óè Los archivos que contienen comandos AWP no pueden contener fuera de "Rangos de
lectura variables" (:=<Nombre de la variable>:) la siguiente secuencia: :=
Sugerencia: Sustituya el primer car√°cter de una secuencia prohibida por su c√≥digo de
car√°cter; para el car√°cter de dos puntos p. ej. &#58;.
Un peque√±o ejemplo de p√°gina web definida por el usuario pretende ilustrar la estructura
b√°sica.

Requisitos
‚óè La CPU debe disponer de un servidor web y √©ste debe estar activado.
‚óè El usuario debe haber iniciado sesi√≥n como "admin" para acceder en modo de escritura a
las variables PLC como usuario de p√°ginas web definidas por el usuario.
‚óè Para el ejemplo inferior, deben haberse definido variables PLC para las variables PLC que
deban mostrarse en la p√°gina web. Aqu√≠ se muestra el ejemplo de la primera variable PLC
utilizada "Tank_below_max".

Crear p√°ginas web definidas por el usuario
El siguiente c√≥digo para un ejemplo de p√°gina web lee valores de la memoria imagen de
proceso y los representa en una tabla.
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/
TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;
charset=utf-8">
<title>Mix</title>
</head>
<body>
<h1>Mix</h1>
<h2> Actual State </h2>
<table border="1">
<tr>
<th>Variable</th>
<th>State</th>
</tr>

1612

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
<tr>
<td>Tank below max</td>
<td>:="Tank_below_max":</td>
</tr>
<tr>
<td>Tank above min</td>
<td>:="Tank_above_min":</td>
</tr>
</table>
</body>
</html>

Comandos AWP para controlar p√°ginas web
Utilizar comandos AWP en p√°ginas web
Con los comandos AWP (Automation Web Programming) se declara la interfaz entre sus
p√°ginas de usuario (aplicaci√≥n web, p. ej. una p√°gina HTML sencilla) y los datos de la CPU.
Para el desarrollo de p√°ginas de usuario o aplicaciones web solo existen las limitaciones que
especifican los navegadores web. Con el programa de usuario de la CPU se controla en uno
de los lenguajes de programaci√≥n de STEP 7 qu√© datos de la CPU deben mostrarse en el
navegador web del visitante y en qu√© momento.
Utilizando los comandos AWP, que se anotan en la p√°gina HTML, se acuerdan datos para la
interacci√≥n pretendida entre la aplicaci√≥n web y el programa de usuario.
Los comandos AWP se insertan en p√°ginas HTML como comentarios HTML con una sintaxis
especial. Los comandos AWP permiten aplicar las funciones siguientes:
‚óè leer variables PLC
‚óè escribir variables PLC
‚óè leer variables especiales
‚óè escribir variables especiales
‚óè definir los tipos Enum
‚óè asignar variables a los tipos Enum
‚óè definir fragmentos
‚óè importar fragmentos

Sintaxis de los comandos AWP
Un comando AWP empieza por "<!-- AWP_" y acaba por " -->". En los archivos de
Javascript, los comandos deben estar incluidos en comentarios de Javascript ("/*...*/").

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1613

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas de notaci√≥n para los nombres de variables PLC dentro de un comando AWP
Los comandos AWP "AWP_In_Variable" y "AWP_Out_Variable" contienen un atributo de
nombre y, de forma opcional, un atributo de uso. Estos atributos tienen asignado un nombre de
variable PLC a trav√©s del cual se escriben o leen variables PLC en el navegador. Para el uso
de nombres de variables PLC en c√≥digo HTML existen las siguientes reglas:
‚óè Las variables PLC deben indicarse entre comillas (" ... ").
‚óè En los comandos AWP, las variables PLC utilizadas deben indicarse, adem√°s de entre
comillas simples ('" ... "') o con una barra invertida (Backslash), con comillas enmascaradas
("\" ... \"").
‚óè Si el nombre de la variable PLC contiene el car√°cter \ (barra diagonal inversa) o *
(asterisco), este car√°cter debe identificarse con la secuencia de escape \\ como car√°cter
normal del nombre de la variable PLC. Encontrar√° ejemplos m√°s adelante.
‚óè Si el nombre de la variable PLC en el comando AWP se encuentra adicionalmente entre
comillas simples y dentro del nombre aparece la comilla simple ('), debe identificarse
asimismo con la secuencia de escape \' como car√°cter normal.
‚óè Si en el comando AWP se utiliza una direcci√≥n absoluta (entrada, salida, marca), deber√° ir
entre comillas simples.
Variable PLC

Variable PLC en c√≥digo HTML

"Velocity"

<!-- AWP_In_Variable Name='"Velocity"' -->
<!-- AWP_In_Variable Name="\"Velocity\"" -->

"abc\de"

<!-- AWP_In_Variable Name='"abc\\de"' -->

"abc'de"

<!-- AWP_In_Variable Name='"abc\'de"' -->

"abc'de"

<!-- AWP_In_Variable Name="abcde" Use'"abc\'de"' -->

"DB name".tag

<!-- AWP_In_Variable Name='"DB name".tag' -->

"Plc1".Data[1].typeDataStruct.value

<!-- AWP_In_Variable Name='"Plc1".Data[1].typeDataStruct.value' -->

-

<!-- AWP_Out_Variable Name=‚Äôflag1‚Äô Use='M0.0' -->

Consulte tambi√©n
Leer variables (P√°gina 1614)
Escribir variables (P√°gina 1616)
Variables especiales (P√°gina 1617)

Leer variables
Las p√°ginas web definidas por el usuario pueden leer variables PLC.
Cada variable PLC debe estar especificada con un nombre de variable PLC.
Estas variables Out (direcci√≥n de salida vista desde el controlador) se introducen en un lugar
cualquiera del texto HTML con la sintaxis que se describe a continuaci√≥n.

1614

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Sintaxis

:=<varname>:
Durante el funcionamiento, el servidor web sustituye estas referencias por los
correspondientes valores actuales de las variables PLC.
<varname> puede ser una variable PLC general sencilla, pero tambi√©n una ruta completa de
variables hacia un elemento de una estructura.

Reglas de notaci√≥n para los nombres de variables PLC
‚óè Las variables PLC en c√≥digo HTML deben ir entre comillas (") si han sido definidas en la
tabla de variables. En el caso de las variables de bloques de datos, el nombre del bloque
de datos debe ir entre comillas. Si se utilizan caracteres especiales en los elementos de
estructura del bloque de datos tales como, p. ej., el punto (.) o el espacio en blanco, esta
parte debe ir asimismo entre comillas.
‚óè No se utilizan las comillas para las direcciones absolutas de entradas, salidas o marcas.
Variable PLC

Variable PLC en c√≥digo HTML

"DB_name".var_name

:="DB_name".var_name:

"DB_name"."var.name"

:="DB_name"."var.name":

"memory"

:="memory":

-

:=I0.0:
:=Q0.0:
:=MW100:
:=%MW100:

"My_Data_Block".flag1

<!-- AWP_Out_Variable Name='flag1'
Use='"My_Data_Block".flag1' -->
...
:=flag1:

‚óè Si el nombre de variable PLC contiene los caracteres: (dos puntos) o \ (barra diagonal
inversa), estos caracteres deben identificarse con la secuencia de escape \: o \\ como
car√°cter normal del nombre de la variable PLC.
Variable PLC

Variable PLC en c√≥digo HTML

"abc:de"

:="abc\:de":

"abc\de"

:="abc\\de":

‚óè Caracteres especiales "<, &, >"
Si aparecen estos caracteres en el nombre de la variable (p. ej. "a<b"), pueden darse
problemas de representaci√≥n.
Evite expresiones tales como, p. ej. :="a<b": en la p√°gina HTML.
A fin de evitar problemas de representaci√≥n, utilice p. ej. un comando AWP con una
expresi√≥n Use siguiendo el patr√≥n que se muestra a continuaci√≥n. El atributo Use define la
variable PLC con los caracteres problem√°ticos, el atributo Name define el nombre sin
caracteres problem√°ticos, tal y como se utiliza en la p√°gina HTML.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1615

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Variable PLC
"a<b"

Variable PLC en c√≥digo HTML
<!-- AWP_Out_Variable Name='simplename'
Use='"a<b"' -->
...
:=simplename:

Consulte tambi√©n
Utilizar comandos AWP en p√°ginas web (P√°gina 1613)

Escribir variables
Las p√°ginas web definidas por el usuario pueden escribir datos en la CPU.
Para ello, se requiere un comando AWP que identifique la variable PLC que hay que escribir.
Adem√°s, cada variable PLC debe estar especificada con un nombre de variable PLC.
Las variables In (direcci√≥n de entrada vista desde el controlador) se activan en la p√°gina del
navegador. Esto puede producirse, por ejemplo, en el caso de los formularios.
El navegador activa las variables con Request de HTTP ya sea en el encabezado de HTTP (por
cookie o m√©todo POST) o en la URL (m√©todo GET) y, a continuaci√≥n, el servidor web las
escribe en la correspondiente variable PLC.

Sintaxis
Para que las variables In puedan escribirse en la CPU, es necesario definirlas con una
instrucci√≥n AWP expl√≠cita:
<!-- AWP_In_Variable Name='<PLC_Varname1>' Name='<PLC_Varname2>'
Name='<PLC_Varname3>' -->
En una instrucci√≥n puede haber varias variables definidas (como puede verse arriba).
El nombre concreto de la variable PLC se escribe entre comillas dobles; p. ej.
<PLC_Varname1> = "myVar".
En caso de que el nombre de la variable que utilice para la aplicaci√≥n web no sea id√©ntico al
nombre de la variable PLC, puede realizarse la asignaci√≥n a una variable PLC con el
par√°metro "Use":
<!-- AWP_In_Variable Name=‚Äô<Webapp_Varname>‚Äô Use=‚Äô<PLC_Varname>‚Äô

Ejemplo
El comando AWP "AWP_In_Variable" es imprescindible, especialmente para el tratamiento de
formularios.
<form method='post' action='/awp/appl/x.html'>
<p>
<input name='"var1"' type='text'>
<input value='set' name='Button1' type='submit'>
</p>
</form>

1616

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el formulario antes definido, se transmite la variable "var1" al servidor web con el m√©todo
Request de HTTP "post". El usuario activa la variable "var1" en el campo del formulario. La
variable 'Button1' tiene el valor 'set', pero no es necesaria para la CPU. Para que la variable
"var1" pueda escribirse en la CPU, debe incluirse la siguiente instrucci√≥n en el mismo
fragmento:
<!-- AWP_In_Variable Name='"var1"' -->
Puesto que las variables PLC deben ir entre comillas dobles ("), el nombre en el comando AWP
debe ir entre comillas simples (') o entre comillas dobles con una barra inversa (\"). Para evitar
las numerosas secuencias Escape, es recomendable utilizar comillas simples.
<!-- AWP_In_Variable Name=‚Äô"Info".par1‚Äô -->
<!-- AWP_In_Variable Name="\"Info".par1\"" -->

Condiciones para el acceso en escritura durante el funcionamiento
Para que un usuario pueda escribir en variables PLC desde una p√°gina web definida por el
usuario, debe cumplirse el siguiente requisito:
El usuario debe tener derechos para modificar variables. El servidor web ignora los comandos
si el usuario no tiene derechos de modificaci√≥n.
Esta regla es v√°lida en principio para todos los accesos en escritura de p√°ginas web a una
CPU.

Consulte tambi√©n
Requisitos para el acceso web (P√°gina 1604)
Utilizar comandos AWP en p√°ginas web (P√°gina 1613)

Variables especiales
Las variables especiales son principalmente las variables HTTP que aparecen en las
definiciones del World Wide Web Consortium (W3C) . Tambi√©n se utilizan variables especiales
para las cookies y las variables de servidor.
Los comandos AWP para leer y escribir variables especiales s√≥lo se diferencian por los
par√°metros adicionales de los comandos AWP para leer y escribir variables normales.

Leer variable especial
El servidor web puede leer variables PLC y entregarlas a variables especiales en el
encabezado de respuesta HTTP. Puede p. ej. leer una URL para un desv√≠o a otra p√°gina web
y entregarla a la variable especial HEADER:Location sirvi√©ndose de la variable especial
HEADER:Location.
Pueden leerse las siguientes variables especiales:
Nombre

Descripci√≥n

COOKIE_VALUE:name

Valor de la cookie con el nombre: "name"

COOKIE_EXPIRES:name

Tiempo de ejecuci√≥n de la cookie con el nombre:
"name" en segundos (debe haberse activado con
antelaci√≥n).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1617

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Nombre

Descripci√≥n

HEADER:Status

C√≥digo de estado HTTP (si no se ha introducido
ning√∫n otro valor, se devolver√° el c√≥digo de esta‚Äê
do 302).

HEADER:Location

Ruta para la derivaci√≥n a otra p√°gina. El c√≥digo de
estado 302 debe estar activado.

HEADER:Retry-After

Tiempo durante el que previsiblemente el servicio
no estar√° disponible. El c√≥digo de estado 503 de‚Äê
be estar activado.

HEADER: ‚Ä¶

El resto de las variables de encabezado tambi√©n
puede transmitirse de este modo.

Con el comando AWP "AWP_Out_Variable" se determinan las variables PLC que deben
transferirse al navegador web en el encabezado de HTTP.
Estructura general:

<!-- AWP_Out_Variable Name="<Typ>:<Name>" [Use="<Varname>"] -->

Descripci√≥n de par√°metros
‚óè Name: tipo y nombre de la variable especial
‚óè Use (par√°metro opcional): en caso de que el nombre de la variable especial no sea id√©ntico
al nombre de la variable PLC, puede realizarse la asignaci√≥n a una variable PLC con el
par√°metro "Use".
Ejemplo:

<!-- AWP_Out_Variable Name="COOKIE_VALUE:siemens" Use='"info".language' -->

Escribir una variable especial
En principio, el programa de usuario de la CPU puede evaluar todas las variables HTTP
escritas por el navegador web en el encabezado de HTTP. Ejemplos de tipos de variables:

1618

Nombre

Descripci√≥n

HEADER:Accept-Language

Idioma aceptado o preferente

HEADER:Authorization

Prueba de autorizaci√≥n para un recurso solicitado

HEADER:Host

Host y puerto del recurso solicitado

HEADER:User-Agent

Informaci√≥n sobre el navegador

HEADER: ‚Ä¶

El resto de las variables de encabezado tambi√©n
puede transmitirse de este modo

SERVER:current_user_id

Indica si un usuario ha iniciado una sesi√≥n (cu‚Äê
rrent_user_id=0: ning√∫n usuario ha iniciado una
sesi√≥n)

SERVER:current_user_name

Nombre del usuario que ha iniciado la sesi√≥n

SERVER:GET

El m√©todo Request es GET

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Nombre

Descripci√≥n

SERVER:POST

El m√©todo Request es POST

COOKIE_VALUE:name

Valor de la cookie con el nombre: "name"

Con el comando AWP "AWP_In_Variable" se determinan las variables especiales que deben
evaluarse en el programa de usuario de la CPU.
Estructura general:

<!-- AWP_In_Variable Name="<Typ>:<Name>" [Use="<Varname>"] -->

Descripci√≥n de par√°metros:
Name: tipo y nombre de la variable especial
Use (par√°metro opcional): en caso de que el nombre de la variable especial no sea id√©ntico al
nombre de la variable PLC, puede realizarse la asignaci√≥n a una variable PLC con el
par√°metro Use .

Ejemplos:
<!-- AWP_In_Variable Name="COOKIE_VALUE:siemens" Use='"info".language' -->

El nombre de la variable en el encabezado de HTTP se sustituye por el nombre de la variable
PLC indicado en Use . La cookie se escribe en la variable PLC "info".language .

<!-- AWP_In_Variable Name='COOKIE_VALUE:siemens' Use='"info".language' -->

El nombre de la variable en el encabezado de HTTP se sustituye por el nombre de la variable
PLC indicado en Use. La cookie se escribe en la variable PLC "info".language .

<!-- AWP_In_Variable Name='"COOKIE_VALUE:siemens"' -->

La variable del encabezado HTTP se escribe en la variable PLC del mismo nombre.

Consulte tambi√©n
Utilizar comandos AWP en p√°ginas web (P√°gina 1613)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1619

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tipos de enumeraciones
Tipos de "enumerations" (Enums)
Con la ayuda de los Enums, los valores num√©ricos del programa del PLC pueden convertirse
en texto y viceversa. La asignaci√≥n de los valores num√©ricos tambi√©n puede realizarse para
m√°s de un idioma.

Crear Enums
Introduzca un comando AWP utilizando la siguiente sintaxis al principio del archivo HTML:
<!-- AWP_Enum_Def Name="<Nombre del tipo de Enum>"
Values='0:"<Text_1>", 1:"<Text_2>", ... , x:"<Text_x>"' -->
Para guardar, por ejemplo, valores alemanes como archivo HTML en la carpeta "de" del
directorio HTML:

<!-- AWP_Enum_Def Name="Enum1" Values='0:"an", 1:"aus", 2:"St√∂rung"' -->

Para guardar, por ejemplo, valores ingleses como archivo HTML en la carpeta "en" del
directorio HTML:

<!-- AWP_Enum_Def Name="Enum1" Values='0:"on", 1:"off", 2:"error"' -->

Asignar Enums
La asignaci√≥n de las variables del programa de usuario a cada uno de los textos Enum se
realiza con un comando AWP propio:

<!-- AWP_Enum_Ref Name="<VarName>" Enum="<EnumTypeName>" -->

<VarName> representa el nombre simb√≥lico del programa de usuario y <EnumTypeName>, el
nombre definido anteriormente del tipo Enum.
Nota
En todos los fragmentos en los que una variable PLC referencie textos Enum, esta variable
PLC debe asignarse junto con el correspondiente comando AWP al nombre del tipo de Enum.
Se debe tener en cuenta que entre una asignaci√≥n Enum y el uso de Enum no existe ning√∫n
comando AWP para importar fragmentos debido a que esta importaci√≥n hace que la
asignaci√≥n Enum se encuentre en otro fragmento que el uso de Enum.

1620

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo
Se ha definido un tipo de Enum "estado" con los valores "0" y "1". "0" equivale a "off", mientras
que "1" equivale a "on":

<!-- AWP_Enum_Def Name="estado" Values='0:"off", 1:"on"' -->

El c√≥digo HTML de la p√°gina web que debe visualizarse contiene el siguiente c√≥digo:

<!-- AWP_Enum_Ref Name="estado operativo" Enum="estado" -->
:=estado operativo:

En funci√≥n del valor de la variable "estado operativo", ya no se muestra "0" √≥ "1" como
resultado, sino "off" u "on".

Uso simplificado de tipos de enumeraci√≥n
En las CPU S7-1200 a partir de la versi√≥n 4 del firmware es posible emplear enumeraciones
directamente en comandos AWP para leer y escribir variables PLC.
Cree enumeraciones como se ha descrito en el p√°rrafo anterior para poder utilizar los valores
con comandos AWP de lectura y escritura.

Crear Enums

<!-- AWP_Enum_Def Name="<Name des Enum Typs>" Values='0:"<Text_1>",
1:"<Text_2>", ... , x:"<Text_x>"' -->

Uso de Enums en comandos AWP de escritura y lectura

<!-- AWP_In_Variable Name='<Varname>' Enum="<EnumType>" -->
<!-- AWP_Out_Variable Name='<Varname>' Enum="<EnumType>" -->

Ejemplo de lectura de variables PLC

<!-- AWP_Enum_Def Name='AlarmEnum' Values='0:"No alarms", 1:"Tank is
full", 2:"Tank is empty"' --><!-- AWP_Out_Variable Name='"Alarm"'
Enum="AlarmEnum" -->...<p>The current value of "Alarm"
is :="Alarm":</p>
Si el valor de "Alarma" est√° en la CPU "2", en la p√°gina HTML se muestra el siguiente texto:
'The current value of "Alarm" is Tank is empty' porque la definici√≥n de Enum asigna al string
"Tank is empty" el valor num√©rico 2.

Ejemplo de escritura de variables PLC

<!-- AWP_Enum_Def Name='AlarmEnum' Values='0:"No alarms", 1:"Tank is
full", 2:"Tank is empty"' --><!-- AWP_In_Variable Name='"Alarm"'
Enum='AlarmEnum' -->...

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1621

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
<form method="POST">
<p><input type="hidden" name='"Alarm"' value="Tank is full" /></p>
<p><input type="submit" value='Set Tank is full' /></p>
</form>
Como la definici√≥n de Enum asigna al string "Tank is full" el valor num√©rico "1", el valor "1" se
escribe en la variable PLC"Alarm".

Definir fragmentos
Fragmentos
Se entiende por fragmentos cada una de las "unidades de significado" de una p√°gina web que
debe procesar la CPU.
Los fragmentos suelen ser p√°ginas enteras, aunque tambi√©n pueden ser elementos
individuales como archivos (p. ej. im√°genes) o documentos enteros.

Definir fragmentos
<!-- AWP_Start_Fragment Name="<Name>" [Type="<Type>"] [ID="<Id>"]
[Mode=<Mode>]-->

Con este comando se define el inicio de un fragmento. Un fragmento se extiende hasta el
principio del siguiente fragmento o hasta el final del archivo.
‚óè <Name> indica el nombre del fragmento.
El nombre debe comenzar con una letra [a-zA-Z] o un car√°cter de subrayado ( _ ). Tras este
primer car√°cter pueden aparecer letras, caracteres de subrayado o n√∫meros [0-9].
‚óè <Type> indica el tipo de fragmento.
‚Äì "manual" El programa de usuario se informa mediante el Request de un fragmento de
que es posible realizar cambios en la p√°gina web que debe devolverse con el programa
de usuario.
‚Äì "automatic" La p√°gina se edita autom√°ticamente (por defecto).

1622

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè <id> para el fragmento puede predefinirse una ID num√©rica. Si no se especifica ninguna ID,
se asignar√° autom√°ticamente una ID al fragmento. En el caso de p√°ginas manuales
(<Type>=manual) puede accederse al fragmento en el programa de usuario de la CPU con
esta ID.
Nota
Es necesario establecer una ID baja, ya que la ID m√°s alta condiciona el tama√±o del DB
Web Control.
‚óè <Mode> Los fragmentos son compatibles con ambos modos: visible y hidden.
‚Äì "visible": el fragmento forma parte de la p√°gina web. Este modo est√° predeterminado y
puede omitirse.
‚Äì "hidden": el fragmento no forma parte de la p√°gina web, pero se guarda en el DB web y
est√° disponible para que el programa de usuario lo agregue a una p√°gina web solicitada.
Intercambiando los ID de fragmento (Variable del DB Web Control fragment_index) se
agrega un fragmento "oculto" a la p√°gina web solicitada.
Con el comando "AWP_Start_Fragment", el documento Input se divide completamente en
fragmentos. Por este motivo, no es necesario un "AWP_End_Fragment".
Sin un comando de inicio de fragmento, un archivo se reproduce como un fragmento cuyo
nombre se deriva del nombre del archivo. Si un archivo se descompone en varios fragmentos
(mediante "AWP_Start_Fragment"), el archivo debe empezar por el comando
"AWP_Start_Fragment".

Importar fragmentos
Existe la posibilidad de declarar un fragmento en una p√°gina HTML e importar dicho fragmento
a otras p√°ginas web.

Ejemplo
El logotipo de un empresa debe mostrarse en todas las p√°ginas web de una aplicaci√≥n web.
El c√≥digo HTML para el fragmento que muestra el logotipo de la empresa s√≥lo existe una vez.
El fragmento puede importarse tantas veces y a tantos archivos HTML como sea necesario.

Sintaxis
<!-- AWP_Import_Fragment Name = "<name>"-->

‚óè <name> es el nombre del fragmento que se desea importar.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1623

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo
C√≥digo HTML dentro de una p√°gina web que declara un fragmento:

<!-- AWP_Start_Fragment Name = "My_Company_Logo" -->
<p><img src = "compay_logo.jpg"></p>

Ejemplo
C√≥digo HTML dentro de otra p√°gina web que importa el fragmento declarado:

<!-- AWP_Import_Fragment Name = "My_Company_Logo" -->

Generar y cargar bloques de datos
Requisitos
‚óè Se han creado todos los archivos de origen necesarios (*.html, *.js, *.png...) para la
aplicaci√≥n web.
‚óè Los archivos de origen est√°n en una carpeta, pero s√≥lo los archivos de origen que son
necesarios para la aplicaci√≥n web. En esta carpeta no debe haber otros archivos.
Nota
Longitud de los nombres de archivos y variables
Si tiene una aplicaci√≥n web amplia, con muchos archivos y directorios, es posible que fracase
la generaci√≥n de los bloques de datos web. En este caso, la generaci√≥n se cancela con el
mensaje "Lista de textos desbordada...". La causa son limitaciones internas del tama√±o de la
informaci√≥n administrativa que se guardar√° en el bloque de datos web.
Soluci√≥n: utilice nombres de archivo y nombres de variable cortos.

Procedimiento
Para generar bloques de datos a partir de los archivos de origen para las p√°ginas web
definidas por el usuario en STEP 7, proceda del siguiente modo:
1. Seleccione la CPU, p. ej. en la configuraci√≥n de dispositivos.
2. Seleccione las propiedades para las p√°ginas web definidas por el usuario "Propiedades >
General > Servidor web" de la ventana de inspecci√≥n.
3. Como "fuente HTML" debe seleccionarse la carpeta en la que se encuentran los archivos
de origen para la aplicaci√≥n web.
4. Como p√°gina de inicio HTML debe introducirse la p√°gina HTML que deba abrirse al iniciar
la aplicaci√≥n web.

1624

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Si es necesario, introduzca el nombre de una aplicaci√≥n.
6. Si es necesario, complemente la serie de extensiones de nombres de archivos como
"archivos con contenido din√°mico". S√≥lo deben introducirse las extensiones de nombres de
archivos que contengan comandos AWP.
7. El n√∫mero del DB Web Control y del inicio del DB de fragmento pueden conservarse si no
est√°n ocupados por el programa de usuario.
8. Haga clic en el bot√≥n "Generar" para generar DBs a partir de los archivos de origen.
Los bloques de datos generados se depositan en la carpeta "Bloques de sistema"
(subcarpeta "Servidor web") del √°rbol del proyecto.
9. En la vista de redes, seleccione la CPU que debe cargarse y elija el comando "Cargar en
dispositivo" en el men√∫ "Online" para cargar los bloques. Antes de la carga se iniciar√°
impl√≠citamente la compilaci√≥n de los bloques.
En caso de que se notifiquen fallos durante este proceso, deben solucionarse antes de
cargar la configuraci√≥n.

Generar y cargar bloques de datos
Requisitos
‚óè Se han creado todos los archivos de origen necesarios (*.html, *.js, *.png...) para la
aplicaci√≥n web.
‚óè Los archivos de origen est√°n en una carpeta, pero s√≥lo los archivos de origen que son
necesarios para la aplicaci√≥n web. En esta carpeta no debe haber otros archivos.
Nota
Longitud de los nombres de archivos y variables
Si tiene una aplicaci√≥n web amplia, con muchos archivos y directorios, es posible que fracase
la generaci√≥n de los bloques de datos web. En este caso, la generaci√≥n se cancela con el
mensaje "Lista de textos desbordada...". La causa son limitaciones internas del tama√±o de la
informaci√≥n administrativa que se guardar√° en el bloque de datos web.
Soluci√≥n: utilice nombres de archivo y nombres de variable cortos.

Procedimiento
Para generar bloques de datos a partir de los archivos de origen para las p√°ginas web
definidas por el usuario en STEP 7, proceda del siguiente modo:
1. Seleccione la CPU, p. ej. en la configuraci√≥n de dispositivos.
2. Seleccione las propiedades para las p√°ginas web definidas por el usuario "Propiedades >
General > Servidor web" de la ventana de inspecci√≥n.
3. Como "fuente HTML" debe seleccionarse la carpeta en la que se encuentran los archivos
de origen para la aplicaci√≥n web.
4. Como p√°gina de inicio HTML debe introducirse la p√°gina HTML que deba abrirse al iniciar
la aplicaci√≥n web.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1625

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Si es necesario, introduzca el nombre de una aplicaci√≥n.
6. Si es necesario, complemente la serie de extensiones de nombres de archivos como
"archivos con contenido din√°mico". S√≥lo deben introducirse las extensiones de nombres de
archivos que contengan comandos AWP.
7. El n√∫mero del DB Web Control y del inicio del DB de fragmento pueden conservarse si no
est√°n ocupados por el programa de usuario.
8. Haga clic en el bot√≥n "Generar" para generar DBs a partir de los archivos de origen.
Los bloques de datos generados se depositan en la carpeta "Bloques de sistema"
(subcarpeta "Servidor web") del √°rbol del proyecto.
9. En la vista de redes, seleccione la CPU que debe cargarse y elija el comando "Cargar en
dispositivo" en el men√∫ "Online" para cargar los bloques. Antes de la carga se iniciar√°
impl√≠citamente la compilaci√≥n de los bloques.
En caso de que se notifiquen fallos durante este proceso, deben solucionarse antes de
cargar la configuraci√≥n.

Estructura del programa del PLC
El programa de usuario debe llamar la instrucci√≥n " WWW" para que la aplicaci√≥n web, es
decir, las p√°ginas web definidas por el usuario, est√©n disponibles en las p√°ginas web est√°ndar
de la CPU y puedan abrirse.
El DB de Web Control generado a partir de los archivos de origen es el par√°metro de entrada
(CTRL_DB) para la instrucci√≥n "WWW". El DB de Web Control referencia el contenido de las
p√°ginas web definidas por el usuario que est√° codificado en los DBs de fragmento y contiene
informaci√≥n de estado y control.

Llamada de la instrucci√≥n "WWW" en el programa de arranque
Para evitar que el programa de usuario no influya en p√°ginas web solicitadas, basta con llamar
una sola vez la instrucci√≥n "WWW" en un OB de arranque. La instrucci√≥n inicializa la
comunicaci√≥n entre el servidor web y la CPU.

Llamada de la instrucci√≥n "WWW" en el programa c√≠clico
La llamada de la instrucci√≥n "WWW" tambi√©n puede producirse en un OB procesado
c√≠clicamente (p. ej. el OB 1). Esto ofrece la ventaja de que pueden aceptarse solicitudes del
servidor web en el programa de usuario. Para ello, deben utilizarse fragmentos manuales.
En este caso, hay que evaluar informaci√≥n del DB de Web Control para identificar la p√°gina
web solicitada o el fragmento solicitado. Por otra parte, es necesario activar un bit en el
programa de usuario para habilitar expl√≠citamente la p√°gina web que debe proporcionar el
servidor web despu√©s de procesar la solicitud de p√°gina web.
La estructura del DB de Web Control se describe en el siguiente apartado.

DB de Web Control
El DB de Web Control (por defecto, DB 333) es generado por STEP 7 y contiene informaci√≥n
sobre la estructura de las p√°ginas de usuario, el estado de la comunicaci√≥n y posibles errores
producidos.

1626

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Adem√°s del DB de Web Control, tambi√©n se crean los DBs de fragmento. Estos DBs de
fragmento (tambi√©n puede ser un solo DB de fragmento) se referencian en el DB de Web
Control. Los DBs de fragmento contienen las p√°ginas web y los datos de medios (p. ej.
im√°genes) codificados en fragmentos. El contenido de los DBs de fragmento no puede
modificarse con el programa de usuario. Se crean autom√°ticamente y s√≥lo sirven para la
gesti√≥n de datos.
A las variables de estado y control del DB de Web Control se accede de forma simb√≥lica.
A continuaci√≥n, se indican las variables del DB de Web Control necesarias para la evaluaci√≥n
de estado y el control de la interacci√≥n.
Pueden obtenerse dos tipos de informaci√≥n del DB de Web Control:
‚óè Informaci√≥n de estado general: informaci√≥n no vinculada a ninguna solicitud de p√°gina web
concreta (Request).
‚óè Informaci√≥n de estado y control de Request: informaci√≥n sobre Requests pendientes.

Informaci√≥n de estado general
"WEB-Control_DB".commandstate.init
"WEB-Control_DB".commandstate.deactivate
"WEB-Control_DB".commandstate.inititiali‚Äê
zing
"WEB-Control_DB".commandstate.error

Activa e inicializa la aplicaci√≥n web.
Desactiva la aplicaci√≥n web.
Se inicializa la aplicaci√≥n web (leer DB de
Web Control, etc.).
No se ha podido inicializar la aplicaci√≥n web.
El motivo est√° codificado in "WEB-Con‚Äê
trol_DB".commandstate.last_error .
"WEB-Control_DB".commandstate.deactiva‚Äê Se finaliza la aplicaci√≥n web.
ting
"WEB-Control_DB".commandstate.initialized Se ha inicializado la aplicaci√≥n web y √©sta ya
est√° lista.
"WEB-Control_DB".commandstate.last_error Tabla de valores de posibles errores (v√©ase
tabla siguiente).
Last_error

Descripci√≥n

1

El DB de fragmento es incoherente (no es compatible con el DB de Web Control).

2

Ya existe una aplicaci√≥n web con este nombre.

3

Problema de memoria al inicializar en el servidor web.

4

Los datos del DB de Web Control son incoherentes.

5

Un DB de fragmento no est√° disponible (no est√° cargado).

6

Un DB de fragmento no tiene identificaci√≥n AWP.

7

El fragmento Enum (contiene los textos e informaci√≥n para los tipos Enum) no est√°
disponible.

8

Una acci√≥n solicitada a trav√©s de las marcas de comando en el DB de Web Control
no est√° permitida en el estado actual.

9

La aplicaci√≥n web no est√° inicializada (si no se produce una nueva inicializaci√≥n tras
la desactivaci√≥n).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1627

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Last_error

Descripci√≥n

10

El servidor web est√° desactivado.

...

Se desactiva Last_error si la aplicaci√≥n web se ha inicializado correctamente.

Informaci√≥n de estado de Request
La informaci√≥n de estado de Request est√° vinculada a uno de los cuatro Requests posibles, x
= [1 ‚Ä¶ 4].
"WEB-Control_DB".requesttab[x].idle
"WEB-Control_DB".requesttab[x].waiting

"WEB-Control_DB".requesttab[x].sending
"WEB-Control_DB".requesttab[x].aborting

No hay que hacer nada.
El programa de usuario debe responder a un
Request de un fragmento manual e iniciar ex‚Äê
pl√≠citamente el procesamiento posterior en el
servidor web.
El servidor web est√° ocupado con el procesa‚Äê
miento de Requests/fragmentos.
El servidor web cierra la conexi√≥n TCP.

Informaci√≥n de control de Request
La informaci√≥n de control de Request est√° vinculada a uno de los cuatro Requests posibles, x
= [1 ‚Ä¶ 4].
"WEB-Control_DB".requesttab[x].continue
"WEB-Control_DB".requesttab[x].repeat
"WEB-Control_DB".requesttab[x].abort
"WEB-Control_DB".requesttab[x].finish

Habilita el fragmento que se acaba de proce‚Äê
sar para su transmisi√≥n. Se inicia el procesa‚Äê
miento del siguiente fragmento.
Habilita el fragmento que se acaba de proce‚Äê
sar para su transmisi√≥n. A continuaci√≥n, el
fragmento se procesa de nuevo.
Cierra la conexi√≥n TCP.
Habilita el fragmento que se acaba de proce‚Äê
sar para su transmisi√≥n. Detiene el procesa‚Äê
miento posterior de fragmentos (finaliza el Re‚Äê
quest).

Ejemplo:
La variable para el DB es la siguiente: "WEB-Control_DB". Con el bit "WEBControl_DB".commandstate.error del programa de usuario puede consultarse si se han
producido errores durante la inicializaci√≥n de la aplicaci√≥n web.
En caso de que se haya producido un error, √©ste puede analizarse con el valor de "WEBControl_DB".commandstate.last_error.

1628

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Interacci√≥n con el programa de usuario
Con la ayuda de los fragmentos manuales, se consigue que el programa de usuario reaccione
a las entradas del navegador de forma s√≠ncrona y pueda preparar la p√°gina web que se debe
devolver.

Tipo de fragmento
Debe utilizarse el tipo de fragmento "manual" (para "p√°ginas manuales") para el fragmento que
escribe los datos con el fin de poder reaccionar ante los datos recibidos en el programa de
usuario:
<!-- AWP_Start_Fragment Name="testfrag" ID="1" Type="manual" -->
La transmisi√≥n de los valores al servidor web de la CPU siempre se realiza del mismo modo en
las p√°ginas autom√°ticas y manuales:
Ejemplo:
<form method="POST" action="">
<p>
<input type="submit" value="Set new value">
<input type="text" name='"Velocity"' size="20">
</p>
</form>

Programa de usuario para fragmentos manuales
En el programa de usuario de la CPU debe llamarse c√≠clicamente la instrucci√≥n "WWW" al
utilizar p√°ginas manuales.
Para poder reaccionar ante los valores indicados en el navegador, es necesario evaluar el
Request que proporciona la p√°gina manual al servidor web en el programa de usuario. Para
ello, el DB de Web Control (p. ej. DB 333) debe analizarse c√≠clicamente por si tiene alg√∫n
request pendiente. En el apartado "requesttab" del DB de Web Control se encuentra la matriz
que gestiona cuatro requests. Cada elemento del array contiene, en una estructura,
informaci√≥n sobre el request en cuesti√≥n.
Un sencillo ejemplo de programa muestra c√≥mo se comprueba la existencia de Requests
pendientes con las variables del DB de Web Control.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1629

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

En caso de que exista un Request, esta secci√≥n de programa escribe la ID de fragmento en la
variable #frag_index y el n.¬∫ de Request (rango de valores 1-4) en la variable #req_index.
Con la informaci√≥n obtenida de este modo, en el programa puede procesarse por separado la
informaci√≥n transmitida en el Request para cada ID de fragmento (p. ej. comprobaci√≥n de
plausibilidad).
Cuando el programa haya finalizado el procesamiento del Request, debe responderse al
Request y volver a restablecerse la correspondiente entrada en "requesttab" del DB de Web
Control (p. ej. DB 333).
Un sencillo ejemplo de programa para responder a Requests:

1630

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1631

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Secuencia b√°sica de un request del navegador con interacci√≥n del programa de usuario
La figura siguiente muestra la secuencia b√°sica y simplificada de un request del navegador
web sobre los efectos en los contenidos del DB de Web Control y las acciones necesarias del
programa de usuario hasta la devoluci√≥n de la p√°gina web preparada (Response).

5HVSRQVH
1DYHJDGRU
ZHE

5HTXHVW

6HUYLGRUZHE

3UHSDUDU5HVSRQVH

'%ZDLWLQJ 758(

'%UHTFRQWLQXH 758(

$FWLYDUYDULDEOHV,1
'DWD7DEOH

(VFULELUYDULDEOHV287
'DWD7DEOH

3URJUDPDGHXVXDULR

3UHSDUDU5HTXHVW

'%GH:HE
&RQWURO

&38

 ,GHQWLILFDUS¬£JLQD
VROLFLWDGD
5HTXHVW

 (YDOXDUSURFHVDU
YDULDEOHV,1
DFWLYDUYDULDEOHV
287

 +DELOLWDUS¬£JLQD
VROLFLWDGD

Visualizaci√≥n de p√°ginas web definidas por el usuario en el navegador
Visualizar p√°ginas web en el navegador
Las p√°ginas web se abren desde las p√°ginas web est√°ndar del navegador web.

1632

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las p√°ginas web est√°ndar disponen, adem√°s de los otros enlaces de la barra de navegaci√≥n,
de un enlace a las "P√°ginas de usuario".
Al hacer clic sobre el enlace "P√°ginas de usuario", el navegador web abre la p√°gina web que
se haya configurado como p√°gina de inicio HTML.

Crear p√°ginas web definidas por el usuario en varios idiomas
Existe la posibilidad de poner a disposici√≥n las p√°ginas web definidas por el usuario en
distintos idiomas.

Requisitos
Las p√°ginas HTML dependientes del idioma deben colocarse dentro de una estructura de
carpetas que contenga carpetas con las abreviaturas de los correspondientes idiomas:

Abreviaturas definidas para los idiomas
Las abreviaturas "de", "en", "fr", "es", "it" y "zh" est√°n definidas. No se soportan carpetas para
otros idiomas o carpetas con otros nombres.
Si es necesario, pueden crearse otras carpetas en la misma jerarqu√≠a de carpetas para otros
archivos; por ejemplo, una carpeta "img" para im√°genes y una carpeta "script" para archivos
Javascript.

Seleccionar la p√°gina de acceso
Definir una p√°gina de usuario como p√°gina de inicio
Junto a la p√°gina introductoria predeterminada, tambi√©n puede establecer la p√°gina de inicio
de sus p√°ginas de usuario como p√°gina de inicio del servidor web.
Para establecer las p√°ginas de usuario en STEP 7 como p√°gina de inicio del servidor web,
proceda del siguiente modo:
1. Seleccione la CPU en la configuraci√≥n de dispositivos.
2. Abra los ajustes en la ventana de inspecci√≥n de la CPU, en "Propiedades > General >
Servidor web".
3. En el √°rea "P√°gina de acceso", seleccione la entrada "AWP1" en "Seleccionar p√°gina de
acceso".
Si introduce a continuaci√≥n la direcci√≥n IP de la CPU en el navegador, se establecer√°
autom√°ticamente una conexi√≥n con sus p√°ginas de usuario.
Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1633

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si desea volver a acceder a las p√°ginas web de la CPU, enlace las p√°ginas web desde sus
p√°ginas de usuario; por ejemplo, mediante la URL "http://a.b.c.d./Portal/Portal.mwsl?
PriNav=Start" o "https://a.b.c.d/Portal/Portal.mwsl?PriNav=Start". La indicaci√≥n "a.b.c.d"
representa a modo de ejemplo la direcci√≥n IP de la CPU configurada.
Ejemplo de enlace en HTML:
<a href="/Portal/Portal.mwsl?PriNav=Start">p√°ginas web SIMATIC</a>
Nota
Si establece su p√°gina de usuario como p√°gina de inicio del servidor web, se bloquear√°n todos
los accesos directos a las p√°ginas web de la CPU. Lo mismo se aplica a los marcadores
guardados para las p√°ginas web de la CPU, as√≠ como a la p√°gina para leer los datos de
servicio.
Lectura de datos de servicio
Si establece su p√°gina de usuario como p√°gina de inicio del servidor web, tambi√©n se
bloquear√° el acceso directo a la p√°gina que contiene los datos de servicio.
Si en caso de reparaci√≥n desea poder leer los datos de servicio mediante el servidor web,
enlace su p√°gina de datos de servicio directamente desde su p√°gina de usuario.
Al igual que en las p√°ginas web de la CPU, la p√°gina de datos de servicio se enlaza p. ej.
mediante la URL "http://a.b.c.d/save_service_data" o "https://a.b.c.d/save_service_data", la
indicaci√≥n "a.b.c.d" representa a modo de ejemplo la direcci√≥n IP de la CPU configurada.
Ejemplo de enlace en HTML:
<a href="/save_service_data">Datos de servicio</a>

Cambio de idioma para p√°ginas web definidas por el usuario
Requisitos
Las p√°ginas HTML se encuentran en las carpetas de idioma predefinidas, p. ej., p√°ginas HTML
con texto en alem√°n en la carpeta "de", p√°ginas HTML con texto en ingl√©s en la carpeta "en",
etc.

Concepto del cambio de idioma
El cambio de idioma se basa en una cookie predefinida denominada
"siemens_automation_language". Si se activa el valor "de" en la cookie, el servidor web se
conectar√° a la p√°gina web de la carpeta "de" en la pr√≥xima solicitud o actualizaci√≥n de p√°gina
web.
De forma an√°loga, el servidor web se conecta a la p√°gina web de la carpeta "en" si la cookie
adopta el valor "en".

1634

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de un cambio de idioma
El ejemplo est√° estructurado de la manera siguiente:
‚óè En las dos carpetas de idioma "de" y "en" se encuentran los archivos HTML dependientes
del idioma con el mismo nombre, p. ej. "langswitch.html". Los textos que se muestran dentro
de ambos archivos est√°n en alem√°n o ingl√©s en funci√≥n del nombre de la carpeta.
‚óè Adem√°s, en la estructura de carpetas hay una carpeta "script" en la que se encuentra el
archivo Javascript "lang.js". A este archivo se han transferido las funciones necesarias para
el cambio de idioma.

Estructura del archivo "langswitch.html" (carpeta "de")
En el encabezado del archivo est√°n definidos los metadatos "Content-Language", charset y
ruta para el archivo Javascript.
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Cambio de idioma p√°gina alemana</title>
<script type="text/javascript" src="script/lang.js" ></script>
</head>
En el cuerpo del archivo se realiza la selecci√≥n de idioma con la ayuda del elemento HTML
"select". El elemento "select" inicia una lista de selecci√≥n y contiene las opciones "de", con el
nombre de "Alem√°n", y "en", con el nombre de "Ingl√©s"; "de" est√° preseleccionado.
Con la ayuda del event handler "onchange", se llama la funci√≥n
"DoLocalLanguageChange(this)". El par√°metro "this" transfiere el objeto "select" con la opci√≥n
seleccionada a esta funci√≥n. Ante cualquier cambio de la opci√≥n, "onchange" lleva a cabo la
llamada de la funci√≥n.
<!-- Language Selection -->
<table>
<tr>
<td align="right" valign="top" nowrap>
<!-- change language immediately on change of the selection
-->
<select name="Language"
onchange="DoLocalLanguageChange(this)" size="1">
<option value="de" selected >Alem√°n</option>
<option value="en" >Ingl√©s</option>
</select>
</td>
</tr>
</table>
<!-- Language Selection End-->

Estructura del archivo "langswitch.html" (carpeta "en")
El encabezado del archivo HTML con texto en ingl√©s tiene una estructura an√°loga a la del
archivo HTML con texto en alem√°n.
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1635

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
<html>
<head>
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Language switching english page</title>
<script type="text/javascript" src="script/lang.js" ></script>
En el cuerpo del archivo tambi√©n se realiza la selecci√≥n de idioma con la ayuda del elemento
HTML "select". A diferencia del archivo HTML alem√°n, la opci√≥n inglesa est√° preseleccionada
y el texto o las etiquetas est√°n en ingl√©s.
<!-- Language Selection -->
<table>
<tr>
<td align="right" valign="top" nowrap>
<!-- change language immediately on change of the selection
-->
<select name="Language"
onchange="DoLocalLanguageChange(this)" size="1">
<option value="de" >German</option>
<option value="en" selected >English</option>
</select>
</td>
</tr>
</table>
<!-- Language Selection End-->

Estructura del archivo "lang.js" (en la carpeta "script")
En el archivo Javascript est√° definida la funci√≥n "DoLocalLanguageChange" que, a su vez,
llama la funci√≥n "SetLangCookie" con el valor de selecci√≥n de idioma. SetLangCookie agrupa
el nombre y el valor de la cookie y, finalmente, activa la cookie mediante la correspondiente
propiedad document.cookie. Para que el servidor web reaccione ante la activaci√≥n de la cookie
con la visualizaci√≥n del idioma deseado, debe cargarse de nuevo la p√°gina web
(top.window.location.reload).
function DoLocalLanguageChange(oSelect) {
SetLangCookie(oSelect.value);
top.window.location.reload();
}
function SetLangCookie(value) {
var strval = "siemens_automation_language=";
// this is the cookie by which the webserver
// detects the desired language
// this name is required by the webserver
strval = strval + value;
strval = strval + "; path=/ ;";
// set path to the application, since otherwise
// path would be set to the requesting page
// would not get the cookie.
// The path for user defined applications follows this
sample:

1636

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
// path=/awp/<application name>/<pagename>
// example: path=/awp/myapp/myappstartpage.htm
//(where myapp is the name of the web application
// entered in the web server properties of the cpu)
/*
use expiration if this cookie should live longer
than the current browser session
var now
= new Date();
var endttime = new Date(now.getTime() + expiration);
strval = strval + "; expires=" + endttime.toGMTString() +
";";
*/
document.cookie = strval;
}

Otros ejemplos
Llenar botellas con bebidas distintas
Este ejemplo describe una planta de llenado (http://support.automation.siemens.com/WW/
view/es/94681612) que puede vigilarse y controlarse desde una p√°gina web personalizada.
Es posible determinar el tipo de bebida para llenar por medio de una receta.
Para el control y la visualizaci√≥n de la instalaci√≥n no se requiere ning√∫n panel (HMI).
Un navegador web sirve para visualizar la p√°gina web.
La p√°gina web recibe regularmente valores de proceso actuales.
Para ello se emplea un inlineframe (iframe) invisible que es reenviado regularmente por el
servidor web. Con el inlineframe, los valores de proceso actuales llegan al navegador.
Utilizando JavaScript se leen los valores de proceso del inlineframe y se insertan en la p√°gina
principal.
Adem√°s, desde la p√°gina web los usuarios pueden llamar funciones de la CPU, como iniciar
y parar el llenado de botellas o importar y exportar recetas (consulte el enlace Aplicaci√≥n de
instalaci√≥n de llenado (http://support.automation.siemens.com/WW/view/es/94681612)).
Llenar y vaciar un dep√≥sito
Este ejemplo describe un dep√≥sito para l√≠quidos (http://support.automation.siemens.com/WW/
view/es/58862931) que puede vigilarse y controlarse desde una p√°gina web personalizada.
Por medio de botones, el usuario controla la entrada de l√≠quido en el dep√≥sito y la salida del
mismo.
Se muestra el nivel actual, as√≠ como los diez √∫ltimos niveles con las indicaciones de tiempo
correspondientes.
Las p√°ginas "Overview" y "Data" leen los valores de proceso actuales en intervalos fijos; en
concreto, el servidor web env√≠a cada vez las p√°ginas completas al navegador.
En cambio, la p√°gina "DataOpti" utiliza un inlineframe para obtener √∫nicamente los niveles
actuales del dep√≥sito por parte del servidor web (consulte Aplicaci√≥n de simulaci√≥n de
dep√≥sito (http://support.automation.siemens.com/WW/view/es/58862931)).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1637

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.2.5

Control de configuraci√≥n (configuraci√≥n futura) para dispositivos

Informaci√≥n importante sobre el control de configuraci√≥n (configuraci√≥n futura)
Principio de funcionamiento
Con una S7-1200 a partir de la versi√≥n de firmware 4.1, el control de la configuraci√≥n permite
configurar un controlador y utilizar variantes (opciones) que difieran de esta configuraci√≥n.
‚óè En un proyecto maestro con una configuraci√≥n m√°xima (maestro de estaci√≥n) est√°n
configurados todos los m√≥dulos necesarios en una serie de partes de instalaci√≥n o
m√°quinas semejantes.
‚óè En el programa de usuario del proyecto maestro hay previstas diversas opciones de
estaci√≥n para diversas partes de instalaci√≥n o m√°quinas, as√≠ como una opci√≥n de estaci√≥n
seleccionada. Una opci√≥n de estaci√≥n utiliza, p. ej., solo una parte de los m√≥dulos
configurados, y dichos m√≥dulos se insertan en orden diferente.
‚óè Un usuario selecciona in situ una opci√≥n de estaci√≥n para una instalaci√≥n concreta. No es
necesario que modifique el proyecto ni que cargue una configuraci√≥n modificada.
(VWDFL¬µQPDHVWUD

2SFL¬µQGHHVWDFL¬µQ

2SFL¬µQGHHVWDFL¬µQ

2SFL¬µQGHHVWDFL¬µQ

Mediante un juego de datos de control (programado por el usuario) en el programa de
arranque, se notifica a la CPU los m√≥dulos que faltan en la configuraci√≥n real en comparaci√≥n

1638

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
con la configuraci√≥n o bien los m√≥dulos que se encuentran en un slot distinto al previsto en la
configuraci√≥n. El control de configuraci√≥n no afecta a la parametrizaci√≥n de los m√≥dulos.
El control de configuraci√≥n permite variar la instalaci√≥n centralizada de forma flexible siempre
que la configuraci√≥n real derive de la configuraci√≥n m√°xima prevista.
A continuaci√≥n se describe la manera de activar el control de configuraci√≥n (parametrizaci√≥n
de CPU) y la estructura que debe tener el juego de datos necesario.

Requisitos
‚óè STEP 7 versi√≥n V13 SP1 o superior
‚óè CPU S7-12XX versi√≥n de firmware 4.1 o superior Los m√≥dulos que admiten la funci√≥n
"Control de configuraci√≥n" tambi√©n tienen la entrada "Control de configuraci√≥n" en la
descripci√≥n (texto informativo) del cat√°logo de hardware.
‚óè Recomendaci√≥n: Antes de cargar un programa nuevo con un juego de datos de control
modificado realice un borrado total. Con esta medida se evitan estados incoherentes que
podr√≠an producirse debido a la existencia de un juego de datos de control incompatible.
‚óè El par√°metro de arranque "Comparaci√≥n de configuraci√≥n te√≥rica y real" est√° ajustado a
"Arranque de la CPU aunque haya diferencias" (ajuste predeterminado).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1639

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Pasos necesarios
1. Active en la configuraci√≥n de la CPU el par√°metro "Permitir la reconfiguraci√≥n del
dispositivo en el programa de usuario" (secci√≥n "Control de configuraci√≥n").

2. Cree un juego de datos de control (p. ej. en un bloque de datos) de acuerdo con la
configuraci√≥n actual siguiendo el patr√≥n de juego de datos de control descrito m√°s abajo.
El juego de datos de control tiene el n√∫mero 196. Si desea transferir el juego de datos de
control como bloque completo de la instrucci√≥n WRREC (par√°metro de entrada RECORD),
tenga en cuenta que primero debe crear un tipo de datos PLC que contenga la estructura
del juego de datos de control y que el bloque de datos debe basarse en ese tipo de datos
PLC.

3. Transfiera el juego de datos de control del programa de arranque a la CPU.
El control de configuraci√≥n de los m√≥dulos enchufados de forma centralizada solo act√∫a
cuando el estado operativo de la CPU cambia de STOP a RUN. Llame la instrucci√≥n

1640

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
avanzada WRREC (escribir registro) en el OB de arranque y transfiera el juego de datos de
control creado a la CPU, ver apartado siguiente.
Si en el OB de arranque no se transfiere ning√∫n juego de datos de control v√°lido, el
controlador no estar√° operativo. En este caso, la CPU interrumpe el arranque y vuelve al
estado "STOP".

Transferencia del juego de datos de control en el programa de arranque
La CPU ejecuta la instrucci√≥n WRREC para transferir el juego de datos de control de modo
as√≠ncrono. Por ello es necesario llamar varias veces WRREC en un bucle en el OB de
arranque, hasta que los par√°metros de salida "BUSY" o "DONE" indiquen que se ha transferido
el juego de datos.
Sugerencia: para programar el bucle utilice el lenguaje de programaci√≥n SCL con la instrucci√≥n
REPEAT ... UNTIL.
REPEAT
"WRREC_DB"(REQ := "start_config_control",
ID := 33,
INDEX := 196,
LEN := "conf_LEN",
DONE => "conf_DONE",
BUSY => "conf_BUSY",
ERROR => "conf_ERROR",
RECORD := "ConfDB".ConfigControl,
STATUS => "conf_STATUS");
UNTIL NOT "conf_BUSY"
END_REPEAT;

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1641

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
A continuaci√≥n se explican los distintos par√°metros de bloque que deben recibir determinados
valores en el contexto del control de configuraci√≥n. Para m√°s informaci√≥n sobre los par√°metros
de bloque restantes, consulte tambi√©n WRREC:
Par√°metro

Explicaci√≥n

ID

Identificador de hardware; es siempre 33 (decimal) con control de configuraci√≥n para
m√≥dulos dispuestos de manera centralizada.

INDEX

N√∫mero del juego de datos; es siempre 196 (decimal) con control de configuraci√≥n para
m√≥dulos dispuestos de manera centralizada.

RECORD

Juego de datos de control que tiene que transferirse.
Para m√°s informaci√≥n sobre la estructura del juego de datos de control, consulte el
apartado "Juego de datos de control".
Sugerencia: el par√°metro de bloque "RECORD" de la instrucci√≥n WRREC (versi√≥n
V1.1 o superior) es del tipo de datos "VARIANT", por lo que exige una variable con tipo
de datos. Si deposita el juego de datos de control en un bloque de datos, l√≥gicamente
el propio bloque debe tener tambi√©n un tipo de datos. El bloque de datos creado no
puede ser del tipo "DB global", sino que debe derivar de un tipo de datos de usuario.
Proceda del siguiente modo:
1. Primero cree un tipo de datos PLC (tipo de datos de usuario) nuevo con la estructura
del juego de datos de control y ll√°melo, p. ej., "ConfDB".
2. Cree un bloque de datos nuevo. Para ese bloque de datos seleccione el tipo de
datos de usuario que acaba de crear, p. ej., "ConfDB".

En los lenguajes de programaci√≥n gr√°ficos convierta el bucle con ayuda de instrucciones de
control de programa.
Ejemplo en FUP: Se programa un bucle con la instrucci√≥n LABEL (Etiqueta) y con la
instrucci√≥n JMP (Saltar si RLO = 1).

1642

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Disposici√≥n de los m√≥dulos
La siguiente tabla muestra la asignaci√≥n de los n√∫meros de slot:
Slot

M√≥dulos

Observaci√≥n

1

Signal Board, tarjeta de comunicaci√≥n, tar‚Äê Slot en el frontal de la CPU
jeta de bater√≠as

2-9

M√≥dulos de se√±ales

Slots a la derecha de la CPU

101 - 103

M√≥dulos de comunicaci√≥n

Slots a la izquierda de la CPU

Juego de datos de control
Para el control de configuraci√≥n se define un juego de datos de control 196 que contiene una
asignaci√≥n de slots.
Rigen las codificaciones siguientes:
0

El m√≥dulo est√° incluido en la configuraci√≥n de hardware pero no se utiliza
en la configuraci√≥n actual.
de 1 a 9, de 101 a Slot actual del m√≥dulo.
103
16#FF (255)
En la configuraci√≥n de hardware no hay ning√∫n m√≥dulo en este slot.
Byte

Elemento

Codificaci√≥n

Explicaci√≥n

0

Longitud del bloque

4 + n√∫mero de slots

Header

1

Block-ID

196

2

Version

5 (para periferia centraliza‚Äê
da)

3

Subversion

0

4

Asignaci√≥n de la tarjeta de
ampliaci√≥n de CPU

Tarjeta de ampliaci√≥n, 0 o
16#FF

5

Asignaci√≥n de slot 2 confi‚Äê
gurado

Slot real, 0 o 16#FF

...

...

...

12

Asignaci√≥n de slot 9 confi‚Äê
gurado

Slot real, 0 o 16#FF

13

Asignaci√≥n de slot 101 con‚Äê Slot real o 16#FF
figurado

14

Asignaci√≥n de slot 102 con‚Äê Slot real o 16#FF
figurado

15

Asignaci√≥n de slot 103 con‚Äê Slot real o 16#FF
figurado

Elemento de control
Describe en cada ele‚Äê
mento qu√© slot real del
dispositivo est√° asig‚Äê
nado al slot configura‚Äê
do. La estructura de
un elemento de con‚Äê
trol se describe en el
apartado siguiente.
A diferencia de los m√≥‚Äê
dulos de se√±ales, el
slot real de los m√≥du‚Äê
los de comunicaci√≥n
debe corresponderse
con el slot configurado.

Estructura de un elemento de control
Un elemento de control recibe informaci√≥n sobre qu√© m√≥dulo est√° enchufado en qu√© slot.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1643

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los n√∫meros de byte representan los slots configurados en orden ascendente (ver m√°s arriba):
‚óè el byte 4 representa el slot configurado de la tarjeta de ampliaci√≥n
‚óè los bytes 5 a 9 representan los slots 2 a 9 configurados
‚óè los bytes 13 a 15 representan los slots 101 a 103 configurados
El valor que hay que asignar al byte correspondiente se obtiene aplicando la regla siguiente:
‚óè Si el m√≥dulo existe en la configuraci√≥n real, introduzca el n√∫mero de slot real del m√≥dulo.
‚Äì Ejemplo 1: el m√≥dulo del slot 2 configurado se encuentra en el slot 2.
En el byte 5 (= slot 2 configurado) introduzca el valor 2 (= slot real).
‚Äì Ejemplo 2: el m√≥dulo del slot 3 configurado se encuentra en el slot 2.
En el byte 6 (= slot 3 configurado) introduzca el valor 2 (= slot real).
‚óè Si el m√≥dulo est√° configurado pero no existe en la instalaci√≥n real, introduzca 0 en el byte
correspondiente al slot configurado.
‚óè Si en la configuraci√≥n hardware no existe ning√∫n m√≥dulo en este slot, introduzca 16#FF
(255) en el byte correspondiente al slot configurado.

Reglas
Tenga en cuenta las siguientes reglas:
‚óè El control de configuraci√≥n no soporta el cambio de posici√≥n de los m√≥dulos de
comunicaci√≥n. Las entradas de slots en el juego de datos de control para los slots 101 a 103
deben corresponderse con las posiciones reales de los m√≥dulos, o deben definirse
mediante la entrada 16#FF (255) como no existentes en la configuraci√≥n de hardware.
‚óè En la configuraci√≥n no est√°n permitidos slots vac√≠os. Si, por ejemplo, en la configuraci√≥n
real hay un m√≥dulo de se√±ales insertado en el slot 4, en la configuraci√≥n real deben estar
ocupados tambi√©n los slots 2 y 3. Lo mismo es v√°lido para los slots 101 a 103. Si en la
configuraci√≥n real hay un m√≥dulo de comunicaci√≥n insertado en el slot 102, en la
configuraci√≥n real tambi√©n debe haber un m√≥dulo de comunicaci√≥n insertado en el slot 101.
‚óè Si se ha activado el control de configuraci√≥n, la CPU no estar√° operativa sin juego de datos
de control. Si en el OB de arranque no se transfiere ning√∫n juego de datos de control v√°lido,
la CPU interrumpe el arranque y vuelve al estado "STOP". En este caso no se inicializa la
periferia centralizada. La causa del estado operativo "STOP" se introduce en el b√∫fer de
diagn√≥stico.
‚óè Para direccionar la instrucci√≥n WRREC, utilice el identificador de hardware 33 (decimal,
para el par√°metro de bloque ID) para escribir el juego de datos de control.
‚óè El juego de datos de control se almacena de forma remanente en la CPU, de modo que si
la configuraci√≥n no var√≠a, no es necesario escribir de nuevo el juego de datos de control 196
al volver a arrancar. Antes de la puesta en marcha se recomienda efectuar un borrado total
de la CPU a fin de borrar cualquier juego de datos de control que pueda haber.
‚óè La CPU ignora las entradas de slots en el juego de datos de control que no est√°n en la
configuraci√≥n te√≥rica configurada.
‚óè Cada slot real no debe figurar m√°s de una vez en el juego de datos de control.
‚óè Un slot real solamente puede asignarse a un slot configurado.

1644

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Configuraci√≥n modificada
La escritura de un juego de datos de control con la configuraci√≥n modificada provoca
autom√°ticamente la siguiente reacci√≥n de la CPU:
borrado total y, a continuaci√≥n, arranque con esta configuraci√≥n modificada.
Con esta reacci√≥n se borra el juego de datos 196 original guardado de forma remanente y se
guarda de forma remanente el nuevo juego de datos 196.

Comportamiento durante el funcionamiento
Repercusi√≥n de la discrepancia entre la configuraci√≥n prevista y la configuraci√≥n real:
‚óè Para la visualizaci√≥n online y la visualizaci√≥n en el b√∫fer de diagn√≥stico (m√≥dulo en buen
estado o m√≥dulo defectuoso) se utiliza siempre la configuraci√≥n hardware, no la
configuraci√≥n real diferente de esta.
Ejemplo: un m√≥dulo proporciona un diagn√≥stico. Este m√≥dulo est√° configurado para el slot
4, pero est√° enchufado realmente en el slot 3 (m√≥dulo no presente; ver ejemplo en el
cap√≠tulo siguiente). En la vista online se muestra un slot 4 configurado como err√≥neo; en la
estructura real, el m√≥dulo del slot 3 se√±aliza un error mediante un indicador LED.
Si en el juego de datos de control se han registrado m√≥dulos como no presentes, el sistema de
automatizaci√≥n se comportar√° de la siguiente manera:
‚óè Los m√≥dulos marcados como no presentes en el juego de datos de control no notifican
ning√∫n diagn√≥stico; su estado siempre es OK. La informaci√≥n de calidad es OK.
‚óè Acceso directo de escritura a las salidas o acceso de escritura a la memoria imagen de
proceso de las salidas no presentes: sin efecto; no se notifica ning√∫n error de acceso.
‚óè Acceso directo de lectura a las entradas o acceso de lectura a la memoria imagen de
proceso de las entradas no presentes: se proporciona el valor "0"; no se notifica ning√∫n
error de acceso.
‚óè Escribir juego de datos en m√≥dulo no presente: sin efecto; no se notifica ning√∫n error.
‚óè Leer juego de datos de m√≥dulo no presente: se notifica un error, ya que no se puede
devolver ning√∫n juego de datos v√°lido.

Mensajes de error
Al escribir el juego de datos de control, en caso de fallo se devuelven los siguientes mensajes
de error:
Tabla 1-106 Mensajes de error
C√≥digo de error

Significado

16#80B1

Longitud no permitida; la indicaci√≥n de longitud del juego de datos
196 no es correcta.

16#80B5

Control de configuraci√≥n no parametrizado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1645

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de error

Significado

16#80E2

El juego de datos se ha transferido en un contexto de OB err√≥neo.
El juego de datos debe transferirse en el programa de arranque.

16#80B8

Error de par√°metros; el m√≥dulo notifica par√°metros no v√°lidos.

Consulte tambi√©n
Informaci√≥n importante sobre el control de configuraci√≥n (configuraci√≥n futura) (P√°gina 1278)
Manual de sistema S7-1200 (http://support.automation.siemens.com/WW/view/es/89851659)

Ejemplo de un control de la configuraci√≥n
A continuaci√≥n se programa una configuraci√≥n compuesta por CPU y 3 m√≥dulos de se√±ales.
El m√≥dulo del slot 3 no est√° presente en el primer nivel de configuraci√≥n y el control de la
configuraci√≥n lo "oculta".
En el segundo nivel de configuraci√≥n, el m√≥dulo ocultado anteriormente se coloca en el √∫ltimo
slot. El slot agregado se notifica a la CPU a trav√©s de un registro de control modificado.

Configuraci√≥n real con m√≥dulo ausente
La configuraci√≥n programada incluye todos los m√≥dulos que pueden estar presentes en una
configuraci√≥n final.
El m√≥dulo insertado en el slot 3 en la configuraci√≥n programada falta en la configuraci√≥n real.
Por este motivo, el slot 3 debe codificarse en el registro de datos con "FF H" (= no presente) de
forma correspondiente.

1646

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones











‚ë†

El m√≥dulo falta en la configuraci√≥n real

Configuraci√≥n real con m√≥dulo agregado a posteriori
El m√≥dulo presente en la configuraci√≥n programada en el slot 3 se "adjunta al final" en la
configuraci√≥n real; queda insertado como √∫ltimo m√≥dulo en el slot 4.
El registro de control se adapta de forma correspondiente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1647

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones



1648







Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.2.6

Configuraciones adicionales

Configuraci√≥n de otras funciones
El sistema de automatizaci√≥n S7-1200 dispone de numerosas funciones adicionales que
pueden utilizarse como funciones de CPU integradas o que est√°n disponibles mediante
m√≥dulos insertables (p. ej. m√≥dulos de comunicaci√≥n). Encontrar√° la descripci√≥n en los
enlaces que aparecen m√°s abajo.

1.4.3

Configuraci√≥n de CP y aplicaciones para estaciones PC

1.4.3.1

CP para estaci√≥n PC 1.0

Estaci√≥n PC
Software SIMATIC NET PC para procesadores de comunicaciones de PC
Software SIMATIC NET PC para procesadores de comunicaciones de PC
Para los siguientes procesadores de comunicaciones se recomienda, dependiendo del
sistema operativo, el uso de las versiones del software SIMATIC NET PC indicadas a
continuaci√≥n:
‚óè CP 1613, CP 1613 A2, CP 1623, CP 1628
‚óè CP 5613, CP 5613 A2, CP 5614, CP 5614 A2, CP 5623, CP 5624
Dependiendo del sistema operativo, utilice las siguientes versiones del software SIMATIC NET
PC:
‚óè Windows 8 (Professional, Enterprise), 32 y 64 bits, y Windows Server 2012
DVD "SIMATIC NET PC Software" V12
‚óè Windows 7 (Professional, Enterprise, Ultimate), 32 y 64 bits, y Windows Server 2008 R2
DVD "SIMATIC NET PC Software" V12
‚óè Windows XP, Windows Server 2003 y Windows Server 2008 32 bits
CD "SIMATIC NET PC Software", edici√≥n 2008 + SP6, n√∫mero de versi√≥n V7.1.6

Reglas de slots para una estaci√≥n PC
Introducci√≥n
Los componentes tales como CP, programas de usuario basado en PC para la configuraci√≥n
de las conexiones y el servidor OPC pueden insertarse en el slot (√≠ndice) 1 a 32. Las estaciones
PC est√°n sujetas a las reglas de slots.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1649

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Inserci√≥n de un servidor OPC
En las estaciones PC pueden insertarse servidores OPC para clientes OPC que accedan a
variables de sistemas de automatizaci√≥n a trav√©s de conexiones configuradas:
‚óè En una estaci√≥n PC puede insertarse como m√°ximo un servidor OPC para clientes OPC.
‚óè Si ya hay un servidor OPC insertado en una estaci√≥n PC, podr√° asign√°rsele un CP.
En lugar de un servidor OPC o de forma adicional a un servidor OPC podr√° utilizar tambi√©n las
aplicaciones est√°ndar.

Insertar componentes
Las siguientes reglas se aplican a la numeraci√≥n de √≠ndice y la inserci√≥n de componentes en
la estaci√≥n PC:
‚óè Los n√∫meros de √≠ndices pueden asignarse del 1 al 32.
‚óè El primer componente insertado recibe siempre el √≠ndice 1.
‚óè El resto de componentes insertados reciben el siguiente n√∫mero de √≠ndice libre.
‚óè Al borrar un componente los n√∫meros de √≠ndice permanecen inalterados para el resto de los
componentes. De esta forma pueden aparecer huecos en la numeraci√≥n de √≠ndice.
‚óè Se permite la inserci√≥n de componentes entre los componentes ya disponibles.
‚óè Para la inserci√≥n de componentes en una ocupaci√≥n disponible rige lo siguiente:
‚Äì Si existen n√∫meros de √≠ndice libres entre dos componentes se asignar√° en primer lugar
el primer √≠ndice libre.
‚Äì Si no hay n√∫meros de √≠ndice libres y disponibles entre dos componentes, se elevar√° en
un n√∫mero el √≠ndice de todos los dem√°s componentes hasta el primer √≠ndice libre.
De esta forma podr√° sustituirse un componente con el √≠ndice 32 en el dep√≥sito de los
m√≥dulos no insertados. As√≠ puede ampliar las estaciones PC sin perder ajustes
importantes por un hacinamiento de componentes.

Inserci√≥n de subm√≥dulos
WinLC RTX soporta como subm√≥dulo
‚óè una tarjeta CP 5611/21 como m√°ximo o una interfaz integrada CP 5611/21
‚óè una interfaz PROFINET como m√°ximo (CP 1616, CP 1604 u.o.)
‚óè cuatro subm√≥dulos como m√°ximo en total. En los cuatro subm√≥dulos puede tratarse de un
n√∫mero cualquiera de interfaces de comunicaci√≥n CP 5613.
Cuando un componente tiene subm√≥dulos tienen validez las siguientes reglas:
‚óè Un controlador contiene un n√∫mero fijo de sub-slots libres.
‚óè Los sub-slots libres se muestran en la visa de dispositivos gr√°fica y en forma de tabla.
‚óè Los subm√≥dulos pueden insertarse √∫nicamente en los sub-slots libres.
‚óè Al borrar un subm√≥dulo surge un sub-slot libre.
‚óè Los sub-slots no ocupan ning√∫n n√∫mero de √≠ndice.

1650

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

CP PC Ethernet
Direccionamiento de subred en CP 1613, CP 1623 y CP 1628
CP 1613, CP 1623 y CP 1628 son m√≥dulos de comunicaci√≥n con microprocesador. Para el
desarrollo seguro de conexiones de comunicaci√≥n, estas se procesan en el m√≥dulo. Para fines
de diagn√≥stico (SNMP, DCP) se utiliza la pila de protocolo en el PC. Para permitir a ambas
pilas de protocolo (acceso IE y NDIS) la comunicaci√≥n con los mismos interlocutores se
recomienda depositar ambas pilas de un m√≥dulo en la misma subred.

Inserci√≥n y extracci√≥n de CPs PC Ethernet
Inserci√≥n y extracci√≥n de CPs PC Ethernet
Los m√≥dulos PC Ethernet, como p. ej. las tarjetas de red USB, ya deben estar insertadas y
activadas en el momento del arranque del sistema. Si alg√∫n m√≥dulo Ethernet est√° desactivado
o no est√° presente en el momento de arrancar el sistema o bien se extrae y se vuelve a insertar
durante el funcionamiento, la funci√≥n "Dispositivos accesible" de STEP 7 no mostrar√° todos los
dispositivos. Esto afecta tambi√©n al cambio de estaciones de acoplamiento si el m√≥dulo
Ethernet no est√° insertado en el port√°til, sino en estas estaciones.
Active los m√≥dulos Ethernet desactivados en "Panel de control > Conexiones de red" y reinicie
el sistema. Reinicie tambi√©n el sistema si los m√≥dulos Ethernet fueron insertados durante el
funcionamiento o si se cambi√≥ la estaci√≥n de acoplamiento con el m√≥dulo Ethernet durante el
funcionamiento.

Configuraci√≥n OPC (CP Ethernet)
Referencia
Parametrizaci√≥n de la configuraci√≥n OPC en el PC CP Ethernet, en el grupo de par√°metros
"Propiedades > General > Configuraci√≥n OPC".
El grupo de par√°metros est√° presente cuando en el estaci√≥n PC hay un servidor OPC
configurado.

Opci√≥n "Acceso a trav√©s del servidor OPC"
Active el m√≥dulo para el funcionamiento a trav√©s de un servidor OPC configurado en el
dispositivo.

Opci√≥n "Modo autom√°tico del controlador PROFINET IO"
Al seleccionar esta opci√≥n, el estado operativo del controlador PROFINET IO cambia
autom√°ticamente a OPERATE.
En estado operativo OPERATE, el controlador PROFINET IO tiene acceso al sistema PN IO
conectado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1651

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Esta opci√≥n est√° disponible cuando se ha seleccionado la opci√≥n "Acceso a trav√©s del servidor
OPC".
‚óè Activar opci√≥n (ajuste predeterminado)
Si se elige esta opci√≥n, el controlador PROFINET IO pasar√° al estado operativo OPERATE
en cuanto se produzca un acceso a un dispositivo IO. Dicho acceso puede producirse a
trav√©s de la interfaz OPC-Item o de la interfaz de programaci√≥n de usuario IO-Base, por
ejemplo.
Para inicializar el estado operativo no debe haber otras llamadas anteriores.
‚óè Desactivar opci√≥n
El controlador PROFINET IO debe ponerse al estado operativo OPERATE antes de
acceder a los datos. Utilice para ello las llamadas de inicializaci√≥n correspondientes de una
interfaz en el programa de usuario.
La interfaz del programa de usuario puede ser una interfaz OPC-Item o una interfaz de
programaci√≥n de usuario IO-Base.

Interfaz Ethernet
Sincronizaci√≥n horaria
Sincronizaci√≥n horaria
Aqu√≠ se determina si el CP debe procesar telegramas de hora o no.
Seg√∫n donde debe encontrarse el reloj maestro, se ofrecen las dos opciones siguientes:
‚óè Maestro (emisor de hora)
Los mensajes de hora pueden provenir de la estaci√≥n PC y transferirse a la subred (LAN).
Una aplicaci√≥n PC que ejecuta la funci√≥n de reloj maestro transfiere la informaci√≥n de hora
al CP a petici√≥n.
‚óè Esclavo (receptor de hora)
Los mensajes de hora pueden provenir de la subred (LAN) y transferirse a la estaci√≥n. Una
aplicaci√≥n PC puede leer la hora transmitida con una petici√≥n adecuada.
Si se utilizan varios CPs en la estaci√≥n, deber√≠a considerarse el flujo de telegramas de hora en
funci√≥n del reloj maestro, ya que con la funci√≥n aqu√≠ descrita es posible acoplar telegramas de
hora de una red a otra.
Si en una estaci√≥n hay varios CPs conectados a la misma red, s√≥lo uno de estos CPs puede
transferir los mensajes de sincronizaci√≥n horaria.

Opciones avanzadas
Vigilancia de conexi√≥n Keep Alive
Referencia
Parametrizaci√≥n de ajustes especiales para la interfaz Ethernet en el grupo de par√°metros
"Interfaz PROFINET/Ethernet > Opciones avanzadas > Opciones de interfaz"

1652

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Vigilancia de conexi√≥n Keep Alive
Si el mecanismo Keep Alive est√° activado, en caso de conexiones se env√≠an telegramas de
se√±al de vida a trav√©s de TCP/IP. De este modo se garantiza que las conexiones finalicen
despu√©s de que falle un interlocutor y que los recursos de conexi√≥n se liberen.
Seg√∫n el tipo de m√≥dulo se ofrecen dos posibilidades para el ajuste:
‚óè Vigilancia de conexi√≥n activable/desactivable con un intervalo fijo
En este caso se puede activar y desactivar el mecanismo de vigilancia de la conexi√≥n. El
intervalo de tiempo en el que se enviar√°n telegramas de se√±al de vida (Keep Alive) al
interlocutor de una conexi√≥n est√° determinado en 30 segundos para el m√≥dulo.
‚Äì Keep Alive desactivado: 0 segundos
‚Äì Keep Alive activado: intervalo fijo de 30 segundos
‚óè Intervalo ajustable para telegramas de vigilancia
Aqu√≠ se puede ajustar el intervalo en segundos en el que se enviar√°n telegramas de se√±al
de vida al interlocutor de una conexi√≥n.
‚Äì Rango de valores: 0 .. 999999
‚Äì Funci√≥n desactivada: 0
‚Äì Ajuste predeterminado: 30

Indicaciones / recomendaciones:
Tenga en cuenta que el mecanismo Keep Alive puede provocar que se mantengan conexiones
subordinadas (p. ej. una conexi√≥n telef√≥nica RDSI) aunque no se transfieran datos de usuario
propiamente dichos. Si no desea que esto suceda, proceda del siguiente modo:
‚óè Desactive el mecanismo de vigilancia (intervalo = 0)
o
‚óè Ajuste un intervalo de tiempo tan alto que la conexi√≥n subordinada finalice tras la ausencia
de datos de usuario antes de que se env√≠e un telegrama Keep Alive.
Nota
M√≥dulos de otros fabricantes
Si utiliza m√≥dulos de otros fabricantes observe sus indicaciones respecto de los ajustes de
Keep Alive.

Indicaciones sobre la vigilancia del establecimiento de conexi√≥n
Relaci√≥n con la configuraci√≥n de conexiones
La vigilancia de tiempo que se ajusta aqu√≠ est√° relacionada del siguiente modo con la vigilancia
de tiempo que puede ajustarse en la configuraci√≥n de conexiones: el valor v√°lido es el m√°s
peque√±o.
En la configuraci√≥n de conexiones, la vigilancia de tiempo se configura en "Propiedades >
Detalles del establecimiento de conexi√≥n".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1653

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Web
Servidor web en el CP PC
Referencia
Parametrizaci√≥n para los accesos al servidor web del CP PC en el grupo de par√°metros
"Servidor web"

Opci√≥n "Activar webserver en este m√≥dulo"
El CP le ofrece la funci√≥n de un servidor web para el acceso mediante navegador web por el
puerto 80. Para ello, se almacenan determinadas p√°ginas HTML con informaci√≥n del CP y
funciones de diagn√≥stico en un √°rea de memoria del CP.
Active esta opci√≥n para obtener acceso a dichas p√°ginas HTML.
‚óè Opci√≥n activada
Active la casilla de verificaci√≥n para que se inicie el servidor web del CP despu√©s de cargar
los datos de configuraci√≥n. Posteriormente, con un navegador web podr√° leer toda la
informaci√≥n del CP que este ponga a disposici√≥n en p√°ginas web.
‚óè Opci√≥n desactivada
Si la casilla de verificaci√≥n est√° desactivada, solo ser√° posible acceder de forma limitada a
la informaci√≥n que el CP pone a disposici√≥n en p√°ginas web. La desactivaci√≥n puede ser
adecuada en determinados casos de servicio para liberar recursos adicionales en el CP.
Las p√°ginas siguientes no se muestran:
‚Äì b√∫fer de diagn√≥stico
‚Äì informaci√≥n del m√≥dulo
‚Äì topolog√≠a

Actualizaci√≥n autom√°tica
Si la casilla de verificaci√≥n est√° activada, las p√°ginas web se actualizan autom√°ticamente en
el intervalo definido en "Intervalo de actualizaci√≥n".
La p√°gina web "Identificaci√≥n" est√° excluida de la actualizaci√≥n autom√°tica.

Selecci√≥n de los idiomas
Seleccione los idiomas para textos vinculados a idiomas que deben cargarse en el CP. El
n√∫mero de idiomas seleccionables depende del CP. Est√°n vinculados a idiomas, p. ej., los
textos del b√∫fer de diagn√≥stico.
Tenga en cuenta adem√°s que los idiomas seleccionados deben estar instalados en el
proyecto. La selecci√≥n de idiomas del proyecto se encuentra en el √°rbol del proyecto, bajo
"Idiomas y recursos".
Si previamente no se han instalado los idiomas seleccionados, el servidor web solo podr√°
visualizar los textos en su idioma est√°ndar.

1654

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Posibilidades de acceso para la protecci√≥n
Nivel de protecci√≥n
A continuaci√≥n se explica la forma de utilizar los diferentes niveles de acceso del CP.
Los CPs como, p. ej., el CP 1626 ofrecen diferentes niveles de acceso para restringir el acceso
a determinadas funciones.
Los niveles de acceso se parametrizan en una tabla. Las marcas de verificaci√≥n verdes que se
muestran en las columnas situadas a la derecha del nivel de acceso correspondiente indican
las operaciones que pueden llevarse a cabo como m√°ximo sin conocer la contrase√±a del nivel
de acceso en cuesti√≥n. Para utilizar las funciones que no tienen la casilla de verificaci√≥n
marcada es necesario introducir una contrase√±a.
ATENCI√ìN
La configuraci√≥n de un nivel de acceso no sustituye la protecci√≥n de know-how
La parametrizaci√≥n de niveles de acceso impide que se realicen cambios ileg√≠timos en el CP
restringiendo los derechos de descarga. Sin embargo, los bloques de la Memory Card no
est√°n protegidos contra lectura o escritura. Para proteger el c√≥digo de los bloques de la
Memory Card debe utilizarse la protecci√≥n de know-how.

Comportamiento predeterminado
El nivel de acceso predeterminado es "Acceso completo (sin protecci√≥n)". Todos los usuarios
pueden leer y modificar los bloques y la configuraci√≥n hardware. No hay ninguna contrase√±a
parametrizada y tampoco se requiere para el acceso online.

Los diferentes niveles de acceso
En un CP es posible parametrizar los siguientes niveles de acceso:
‚óè Acceso completo (sin protecci√≥n): cualquiera puede leer y modificar los bloques y la
configuraci√≥n hardware.
‚óè Acceso de lectura: con este nivel de acceso, si no se introduce la contrase√±a solo es posible
acceder en modo de lectura a la configuraci√≥n hardware y los bloques, es decir, sin
contrase√±a no se pueden cargar ni bloques ni la configuraci√≥n hardware en el CP. Tampoco
est√° permitido realizar funciones de test en modo de escritura ni actualizaciones de
firmware sin contrase√±a.
‚óè Sin acceso (protecci√≥n completa): cuando el CP est√° completamente protegido no est√°
permitido el acceso de lectura ni escritura a la configuraci√≥n hardware y los bloques.
La legitimaci√≥n con la contrase√±a permite volver a tener acceso completo al CP.

Comportamiento de un CP protegido con contrase√±a durante el funcionamiento
La protecci√≥n del CP es efectiva una vez se han cargado los ajustes en el mismo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1655

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Antes de ejecutar una funci√≥n online se comprueba que est√© permitida. Si est√° protegida por
contrase√±a, deber√° introducirse.
Ejemplo: el m√≥dulo se ha parametrizado con acceso de lectura y el usuario desea ejecutar la
funci√≥n "Forzar variable". Puesto que esta funci√≥n es un acceso de escritura, para ejecutarla
debe introducirse la contrase√±a parametrizada.
Las funciones protegidas con contrase√±a solo pueden ejecutarse desde una PG/un PC en un
mismo momento. Otra PG/otro PC no podr√° iniciar sesi√≥n.
La autorizaci√≥n de acceso a los datos protegidos es v√°lida mientras dure la conexi√≥n online o
hasta que se suprima manualmente la autorizaci√≥n de acceso mediante "Online > Borrar
derechos de acceso".
Todos los niveles de acceso permiten el acceso ilimitado a determinadas funciones sin
necesidad de introducir la contrase√±a, p. ej. identificaci√≥n por medio de la funci√≥n "Dispositivos
accesibles".

Parametrizar la protecci√≥n de acceso
A continuaci√≥n se explica el modo de parametrizar un nivel de acceso para un CP e introducir
contrase√±as.
Es posible introducir varias contrase√±as para un CP, con lo que se crean diferentes derechos
de acceso para grupos de usuarios distintos.
La contrase√±as se introducen en una tabla, de modo que cada contrase√±a tiene asignado un
nivel de acceso concreto.
El efecto que tiene cada contrase√±a se explica en la columna "Nivel de acceso".
Ejemplo:
Seleccione el nivel de acceso "Sin acceso (protecci√≥n completa)" para el CP e introduzca una
contrase√±a propia para cada uno de los niveles de acceso que hay en la tabla.
Para los usuarios que no conozcan ninguna de las contrase√±as, el CP estar√° completamente
protegido.
Para los usuarios que conozcan una de las contrase√±as parametrizadas, el efecto depende de
la fila de la tabla en la que est√© la contrase√±a:
‚óè Si la contrase√±a est√° en la fila 1 (acceso completo (sin protecci√≥n)), al introducirla el CP
quedar√° desprotegido. Los usuarios que conozcan esta contrase√±a tendr√°n acceso
ilimitado al CP.
‚óè Si la contrase√±a est√° en la fila 2 (acceso de lectura), al introducirla el CP quedar√° protegido
contra escritura. A pesar de conocer esta contrase√±a, los usuarios solo tendr√°n acceso de
lectura al CP.
‚óè Si la contrase√±a est√° en la fila 3 (sin acceso (protecci√≥n completa)), al introducirla el CP
quedar√° protegido contra escritura y lectura. Los usuarios que conozcan esta contrase√±a
solo tendr√°n acceso de lectura al CP.
Procedimiento

1656

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para parametrizar los niveles de acceso en un CP, proceda del siguiente modo:
1. Abra las propiedades del CP en la ventana de inspecci√≥n.
2. Abra la entrada "Protecci√≥n" en la navegaci√≥n local.
En la ventana de inspecci√≥n se muestra una tabla con los niveles de acceso posibles.
3. Seleccione el nivel de acceso deseado en la primera columna de la tabla. Las marcas de
verificaci√≥n verdes que se muestran en las columnas situadas a la derecha del nivel de
protecci√≥n correspondiente indican las operaciones que se pueden seguir realizando sin
introducir la contrase√±a.
4. Si se ha seleccionado un nivel de acceso distinto a "Acceso completo":
‚Äì Asigne una contrase√±a para el acceso completo en la columna "Contrase√±a" de la
primera fila (acceso completo).
‚Äì Repita la contrase√±a introducida en la columna "Confirmar contrase√±a" para evitar
entradas incorrectas.
‚Äì Aseg√∫rese de que la contrase√±a sea lo suficientemente segura, es decir, de que no
tenga un patr√≥n reconocible por una m√°quina.
‚Äì La entrada de una contrase√±a en la primera fila "Acceso completo (sin protecci√≥n)" es
obligatoria y permite a las personas que conocen la contrase√±a acceder sin limitaciones
al CP, independientemente del nivel de protecci√≥n seleccionado.
5. En caso necesario, asigne otras contrase√±as a otros niveles de acceso, siempre que el
nivel de acceso seleccionado lo permita.
6. Cargue la configuraci√≥n hardware para que el nivel de acceso sea efectivo.
Resultado
La configuraci√≥n hardware y los bloques est√°n protegidos contra accesos online no
autorizados en funci√≥n del nivel de acceso ajustado. Si una operaci√≥n no puede ejecutarse sin
contrase√±a debido al nivel de acceso parametrizado, se abre un cuadro de di√°logo para
introducir una contrase√±a.

Adaptaciones espec√≠ficas del cliente para CP 1626 V1.0 y superior
General
En las "Adaptaciones espec√≠ficas del cliente", un fabricante de dispositivos puede reemplazar
los datos espec√≠ficos de SIEMENS por datos propios. Dichos datos se exportar√°n tambi√©n al
archivo GSDML.

ID de fabricante PROFINET e ID de dispositivo PROFINET
Estos par√°metros los solicita PI (PROFIBUS International) a cada fabricante y pueden
introducirse aqu√≠.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1657

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Referencia
En este campo de entrada se puede introducir una referencia cualquiera.

Familia de productos, nombre del fabricante, nombre del producto y versi√≥n de software
Estos par√°metros se utilizan de forma complementaria en interfaces WEB y en el protocolo
SNMP y pueden introducirse aqu√≠.

Archivo Bitmap GSD
En este campo de entrada se define el nombre del archivo de exportaci√≥n Bitmap GSD, que se
crea al realizar la entrada. El formato Bitmap es el predeterminado y no debe introducirse.

Asignar la funcionalidad RT o IRT
A partir de la versi√≥n V1.1 existe la posibilidad de elegir entre las opciones "RT" e "IRT". La
opci√≥n seleccionada se exporta con el archivo GSDML independientemente del ajuste en
"Parametrizaci√≥n de la interfaz PN por el controlador IO de nivel superior" del cuadro de
di√°logo "Modo de operaci√≥n".

Adaptaciones espec√≠ficas del cliente para CP 1604/CP 1616 V2.7 y superior
General
En las "Adaptaciones espec√≠ficas del cliente", un fabricante de dispositivos puede reemplazar
los datos espec√≠ficos de SIEMENS por datos propios. Dichos datos se exportar√°n tambi√©n al
archivo GSDML.

ID de fabricante PROFINET e ID de dispositivo PROFINET
Estos par√°metros los solicita PI (PROFIBUS International) a cada fabricante y pueden
introducirse aqu√≠.

Referencia
En este campo de entrada se puede introducir una referencia cualquiera.

Familia de productos, nombre del fabricante, nombre del producto y versi√≥n de software
En estos campos de entrada se pueden introducir nombres cualesquiera.

Archivo Bitmap GSD
En este campo de entrada se define el nombre del archivo de exportaci√≥n Bitmap GSD, que se
crea al realizar la entrada. El formato Bitmap es el predeterminado y no debe introducirse.

1658

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Asignar la funcionalidad RT o IRT
A partir de la versi√≥n V2.8 existe la posibilidad de elegir entre las opciones "RT" e "IRT". La
opci√≥n seleccionada se exporta con el archivo GSDML independientemente del ajuste en
"Parametrizaci√≥n de la interfaz PN por el controlador IO de nivel superior" del cuadro de
di√°logo "Modo de operaci√≥n".

CP PC PROFIBUS
Funcionamiento de CPs PROFIBUS en equipos con STEP 7 V5.5
Funcionamiento de CPs PROFIBUS en equipos con STEP 7 V5.5
Si en un equipo est√°n instalados tanto STEP 7 V5.5 como STEP 7 Professional y se desinstala
STEP 7 V5.5, ser√° necesario ejecutar la funci√≥n de reparaci√≥n de STEP 7 Professional antes
de poder utilizar los siguientes procesadores de comunicaciones como adaptadores de red al
cargar firmware:
‚óè CP 561x, CP 5611 A2, CP 5612, CP 5613 A2, CP 5614 A2
‚óè CP 5621, CP 5622, CP 5623, CP 5624
‚óè CP 5711

Carga de firmware en CPs PROFIBUS S7-300/400
Carga de firmware en CPs PROFIBUS S7-300/400 a trav√©s del CP 5612 o CP 5622
En caso de que falte la parametrizaci√≥n de interfaz necesaria para la carga de firmware ("FWL"
o "FWL_FAST_LOAD"), proceda del siguiente modo:
1. Abra el programa "Ajustar interface PG/PC". Encontrar√° el programa en el Panel de control
del sistema operativo Windows.
2. Seleccione la parametrizaci√≥n de interfaz en funci√≥n del sistema operativo y c√≥piela:
‚Äì En un sistema operativo de 32 bits:
"CP5612(PROFIBUS)" / "CP5622(PROFIBUS)"
‚Äì En un sistema operativo de 64 bits:
"CP5612.PROFIBUS.1" / "CP5622.PROFIBUS.1"
3. Asigne uno de los nombres siguientes a la copia, seg√∫n corresponda:
‚Äì En un sistema operativo de 32 bits:
CP5612(FWL) / CP5622(FWL)
CP5612(FWL_FAST_LOAD) / CP5622(FWL_FAST_LOAD)
‚Äì En un sistema operativo de 64 bits:
"CP5612.FWL.1" / "CP5622.FWL.1"
"CP5612.FWL_FAST_LOAD.1" / "CP5622.FWL_FAST_LOAD.1"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1659

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Abra las propiedades de la entrada y realice los siguiente ajustes en la ficha "PROFIBUS":
‚Äì Active la casilla de verificaci√≥n "La PG/el PC es el √∫nico maestro del bus".
‚Äì Asigne a la direcci√≥n el valor "0".
‚Äì Para la velocidad de transmisi√≥n asigne el valor 187,5 kbits/s (o bien para
FWL_FAST_LOAD el valor 1,5 Mbits/s).
‚Äì Modifique la "Direcci√≥n de estaci√≥n m√°s alta" al valor 126.
‚Äì Modifique el perfil a "Universal (DP/FMS)".
5. Cierre el programa "Ajustar interface PG/PC".
Resultado:
La parametrizaci√≥n de interfaz configurada se crea y est√° disponible seguidamente en el
actualizador de firmware.

Configuraci√≥n LSAP
Referencia
Parametrizaci√≥n de la configuraci√≥n LSAP en el PC CP PROFIBUS, en el grupo de par√°metros
"Propiedades > General > Configuraci√≥n LSAP".

Reservar LSAPs
Reserve LSAPs (Local Service Access Point) para otros protocolos utilizados en el CP.
Conexiones FDL de ejemplo: El protocolo FDL utiliza LSAPs que no pueden ser utilizados
simult√°neamente por otros protocolos.
Seleccione para ello el n√∫mero correspondiente al LSAP en la lista.

Conexiones FDL
Los LSAP que ya se han utilizado en conexiones FDL se representan como desactivados.
Visualice el LSAP local y el LSAP del interlocutor en la tabla de conexiones para comprobar
qu√© conexi√≥n utiliza un LSAP y cu√°l.
Estos valores no se muestran en el ajuste predeterminado. Para visualizarlos, despliegue el
men√∫ contextual en la cabecera de la tabla de conexiones. Haga clic en el comando "Mostrar/
Ocultar" y seleccione en la lista "LSAP local" y "LSAP del interlocutor".
El LSAP se muestra tambi√©n en las propiedades de la conexi√≥n, en "Detalles de direcciones".
Aqu√≠ existe la posibilidad de modificar los LSAP utilizados en caso necesario.

1660

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuraci√≥n OPC (CP PROFIBUS)
Referencia
Parametrizaci√≥n de la configuraci√≥n OPC en el PC CP PROFIBUS, en el grupo de par√°metros
"Propiedades > General > Configuraci√≥n OPC".
El grupo de par√°metros est√° presente cuando en el estaci√≥n PC hay un servidor OPC
configurado.

Opci√≥n "Acceso a trav√©s del servidor OPC"
Active el m√≥dulo para el funcionamiento a trav√©s de un servidor OPC configurado en el
dispositivo.

Opci√≥n "Poner el maestro DP autom√°ticamente en Operate"
Si se selecciona esta opci√≥n, el modo DP se activa autom√°ticamente en el arranque del
servidor OPC.

Control de actividad del CP activado - Opci√≥n "Vigilancia de tiempo DP"
Si el servidor OPC ya no accede (debido a un error) a la interfaz DP, con el control de actividad
activado el m√≥dulo reacciona del siguiente modo: en todos los esclavos DP asignados al
servidor OPC se env√≠an datos con el valor 0 (valores sustitutivos).
Par√°metros ajustables:
‚óè Timeout del watchdog de DP
Con el control de actividad activado, la transmisi√≥n de los valores sustitutivos se activa si
tras el tiempo ajustado aqu√≠ no se produce ning√∫n acceso a la interfaz DP.
Predeterminado: 6000 ms

Opci√≥n "Vigilancia de diagn√≥stico" activada
Si la vigilancia de diagn√≥stico est√° activada, el servidor OPC vigila autom√°ticamente el flag de
diagn√≥stico en los accesos a entradas y salidas de los esclavos DP, y en el caso de los
esclavos DP normalizados, eval√∫a los datos de diagn√≥stico. Si en los datos de diagn√≥stico se
detectan errores o problemas, el acceso a las entradas y salidas de los esclavos DP se impide
durante el tiempo de bloqueo especificado aqu√≠, y las peticiones de lectura o escritura se
acusan con error.
Par√°metros ajustables:
‚óè Tiempo de bloqueo para Read / Write
Predeterminado: 500 ms

Tiempo de espera a error para peticiones DP C1
Especifique aqu√≠ un tiempo de espera a error para servicios DPC1 (transmisi√≥n ac√≠clica como
maestro DP de clase 1).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1661

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Predeterminado: 15000 ms

Funciones de servidor OPC para el maestro DP clase 2
Aqu√≠ se pueden activar las funciones de servidor OPC para el maestro DP clase 2. Los ajustes
realizados aqu√≠ afectan a las funciones de registro seg√∫n maestro DP clase 2.
Se ofrece una opci√≥n de 2 niveles:
‚óè Activar funciones de registro
Las funciones de registro permiten leer informaci√≥n espec√≠fica del dispositivo o escribir
par√°metros. Con esta opci√≥n se activa el servidor OPC que soporta dicha funci√≥n.
‚óè Utilizar en modo PROFIdrive
Al seleccionar adicionalmente esta opci√≥n se activa el servidor de bus PROFIdrive. De este
modo, las funciones de registro solo pueden utilizarse en el modo especial PROFIdrive.
Par√°metros ajustables:
‚óè Timeout para el establecimiento de conexi√≥n
Si el interlocutor no responde a la solicitud de establecimiento de una conexi√≥n dentro del
tiempo ajustado aqu√≠, las peticiones OPC se cancelan con un mensaje de error.
Dado que dependiendo de la estructura de la red, el correcto establecimiento de la
conexi√≥n puede requerir un tiempo mayor, el timeout para el establecimiento de conexi√≥n
debe ser mayor que el de la petici√≥n (consulte el tiempo de espera a error para peticiones
as√≠ncronas).
Predeterminado: 15000 ms
‚óè Tiempo de espera a error para peticiones as√≠ncronas
Si una petici√≥n de lectura o escritura a un interlocutor no se responde dentro del tiempo
ajustado aqu√≠, las peticiones OPC pendientes se cancelan con un mensaje de error.
Predeterminado: 15000 ms

Configuraci√≥n del archivo LDB
Referencia
Parametrizaci√≥n de la configuraci√≥n LDB en el PC CP PROFIBUS en el grupo de par√°metros
"Propiedades > General > Configuraci√≥n LDB"
Nota
Versi√≥n del software SIMATIC NET PC
El archivo LDB solo puede utilizarse para CPs que utilicen una versi√≥n del software SIMATIC
NET PC anterior a mayo de 2000.

1662

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Crear un archivo LDB (solo v√°lido para CPs con firmware < V6.0 SP5 o hasta el software SIMATIC NET
PC anterior a mayo de 2000)
La configuraci√≥n del sistema maestro DP debe exportarse a un archivo LDB (base de datos
cargable) al guardar y compilar. Este archivo contiene la informaci√≥n del proyecto DP. Se
necesita para las conexiones de sistema DP de la PG/el PC as√≠ como SOFTNET o CP 5614
en las estaciones PC.

Nota
Archivo LDB y determinaci√≥n de las direcciones de entrada/salida de los m√≥dulos DP
Las direcciones de las √°reas de entrada/salida de los esclavos DP se determinan
autom√°ticamente, en orden ascendente y con justificaci√≥n sobre la base de la direcci√≥n
PROFIBUS de los esclavos DP y de los m√≥dulos DP insertados y se almacenan en el archivo
LDB.
Por consiguiente, los datos o los cambios de direcciones de entrada/salida de los esclavos DP
en el sistema maestro DP configurado aqu√≠ no repercuten en la informaci√≥n de direcci√≥n
almacenada en el archivo LDB.

Configuraciones de PC conectados en red
Cuadro de di√°logo de configuraci√≥n
Referencia
Con la estaci√≥n PC seleccionada, se elige el comando de men√∫ "Online > Configurar estaci√≥n
PC online".
En el cuadro de di√°logo abierto, se transfiere la configuraci√≥n seleccionada para una estaci√≥n
PC o se visualiza su configuraci√≥n actual.

Requisitos
En el equipo de destino y en el de configuraci√≥n debe estar instalado el DVD "SIMATIC NET
PC-Software".
Si en el equipo de configuraci√≥n o de destino hay m√°s de un m√≥dulo de comunicaci√≥n, primero
habr√° que definir el m√≥dulo correspondiente para la operaci√≥n de configuraci√≥n. Para ello
existe el programa "SIMATIC Shell".
Cuando ya lo haya definido en el equipo de configuraci√≥n o si solo hay un m√≥dulo de
comunicaci√≥n, se visualizar√° la conexi√≥n de red local, que no podr√° modificarse.
Si en el proyecto de STEP 7 se ha seleccionado el equipo de destino y existe una asignaci√≥n
un√≠voca con los equipos accesibles, los campos "Equipos de destino accesibles" y "Equipos de
destino" dispondr√°n ya de la asignaci√≥n correspondiente y no deber√°n modificarse.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1663

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
SIMATIC Shell
El programa "SIMATIC Shell" se instala junto con los productos del software SIMATIC NET PC.
Observe la documentaci√≥n del software SIMATIC NET PC.

Proceda del siguiente modo:
1. En la lista desplegable seleccione la conexi√≥n de red con la que debe activarse el equipo
de destino.
2. Pulse el bot√≥n "Actualizar" para determinar los equipos accesibles.
3. En la lista "Equipos accesibles" seleccione el equipo de destino que desee o introduzca el
nombre del equipo de destino directamente en el campo "Equipo de destino". La
denominaci√≥n del equipo de destino es id√©ntica al nombre del equipo en Windows.
4. Elija entre los procedimientos siguientes:
‚Äì Mostrar la configuraci√≥n actual del equipo de destino seleccionado: pulse para ello el
bot√≥n "Mostrar...".
‚Äì Cargar la configuraci√≥n en el equipo de destino: pulse para ello el bot√≥n "Configurar...".
5. Una vez realizada la configuraci√≥n observe los posibles avisos.

Asignar conexi√≥n de red y equipo de destino
Si resulta que no desea utilizar las asignaciones predefinidas o que no hay ninguna, proceda
del siguiente modo:
1. Dado el caso, desactive la opci√≥n "Utilizar equipo de destino configurado".
2. En la lista desplegable seleccione la conexi√≥n de red con la que debe activarse el equipo
de destino.
3. Pulse el bot√≥n "Actualizar" para determinar los equipos accesibles.
4. Seleccione el equipo de destino deseado en la lista "Ordenadores accesibles". Otra
posibilidad consiste en introducir el nombre del equipo de destino directamente en el campo
"Equipo de destino". La denominaci√≥n del equipo de destino es id√©ntica al nombre del
equipo en Windows.

Configurar equipo de destino
Proceda del siguiente modo:
1. Elija entre los procedimientos siguientes:
‚Äì Mostrar la configuraci√≥n actual del equipo de destino seleccionado: pulse para ello el
bot√≥n "Mostrar...".
‚Äì Cargar la configuraci√≥n en el equipo de destino: pulse para ello el bot√≥n "Configurar...".
2. Una vez realizada la configuraci√≥n observe los avisos que pueden aparecer.

1664

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Sugerencia:
Las funciones descritas para los botones tambi√©n son accesibles mediante el bot√≥n derecho
del rat√≥n.
Indicaciones generales
Tenga en cuenta que tras iniciar el cuadro de di√°logo de configuraci√≥n ya no se registran
cambios en el equipo local. Siguen siendo v√°lidos los ajustes o los datos de configuraci√≥n que
se detectaron al inicio. Las acciones afectadas son:
‚óè La activaci√≥n o desactivaci√≥n de los adaptadores de red.
‚óè Los cambios en la configuraci√≥n de STEP 7 de la estaci√≥n PC.

Cuadro de di√°logo "Configuraci√≥n del equipo de destino"
Este cuadro de di√°logo muestra la configuraci√≥n actual con m√≥dulos y aplicaciones.
Aqu√≠ existe la posibilidad de comparar una configuraci√≥n actual con una predefinida.

Estaci√≥n
Aqu√≠ se indica el nombre de la estaci√≥n.
Dicho nombre puede ser id√©ntico al nombre del equipo de destino, a menos que se haya
asignado un nombre nuevo a la estaci√≥n de destino despu√©s de instalar el software SIMATIC
NET PC. Al arrancar se aplica primero el nombre del equipo como nombre de la estaci√≥n.

Consulte tambi√©n
S√≠mbolos de estado al configurar (P√°gina 1667)
Cuadro de di√°logo de configuraci√≥n (P√°gina 1663)

Cuadro de di√°logo "Configurar: equipo de destino seleccionado"
Este cuadro de di√°logo muestra la configuraci√≥n actual para el equipo de destino seleccionado
con m√≥dulos y aplicaciones.
Desde aqu√≠ se lanza la transferencia para la primera configuraci√≥n o la modificaci√≥n de la
misma.
Al abrir el cuadro de di√°logo se comprueba si es plausible transferir la configuraci√≥n al equipo
de destino y, por tanto, si puede ejecutarse.

Estaci√≥n
Aqu√≠ se indica el nombre de la estaci√≥n.
Dicho nombre puede ser id√©ntico al nombre del equipo de destino, siempre que todav√≠a no se
haya asignado un nombre nuevo a la estaci√≥n de destino despu√©s del arranque. Al arrancar se
aplica primero el nombre del equipo como nombre de la estaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1665

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comprobar y aplicar la configuraci√≥n configurada
Aqu√≠ se verifica la configuraci√≥n configurada antes de realizar la transferencia de datos
definitiva.
En la l√≠nea de informaci√≥n, debajo de la lista de configuraci√≥n, se indica si es posible realizar
la configuraci√≥n. Para que sea posible es imprescindible que la configuraci√≥n real (f√≠sica) y la
predefinida coincidan.
Observe los s√≠mbolos que indican particularidades.
Despu√©s de haber comprobado los indicadores y de iniciado la aplicaci√≥n (bot√≥n Aceptar),
deber√° volver a confirmarla.

Cu√°ndo se rechaza la configuraci√≥n
La configuraci√≥n no puede transferirse en los casos siguientes:
‚óè Los m√≥dulos configurados no existen en la estaci√≥n PC.
‚óè Los m√≥dulos configurados no pueden asignarse un√≠vocamente (consulte las reglas de
asignaci√≥n m√°s adelante).
‚óè La configuraci√≥n predefinida excede el alcance permitido para la estaci√≥n PC.
‚óè No es posible establecer una conexi√≥n con la estaci√≥n PC.
La causa puede ser un firewall configurado en la estaci√≥n PC que bloquee el acceso al
puerto 102 utilizado por STEP 7. Libere el puerto 102 para TCP en la estaci√≥n PC.
Observe las indicaciones y los avisos de los campos "Error" y "Estado". As√≠, por ejemplo, se
recibir√°n advertencias si la asignaci√≥n puede provocar un cambio de la configuraci√≥n actual
(ejemplo: un m√≥dulo ya configurado se desplazar√° a otro √≠ndice).
Haciendo doble clic en el texto de aviso se abre una ventana con informaci√≥n detallada acerca
del aviso en cuesti√≥n.

Reglas de asignaci√≥n
Al importar se comprueba si es posible una asignaci√≥n de los m√≥dulos y, con ello, una
aplicaci√≥n, del siguiente modo:
‚óè Los m√≥dulos predefinidos tienen que estar presentes.
‚óè Si se encuentran varios m√≥dulos (por ejemplo CPs PROFIBUS), se intentar√° realizar la
asignaci√≥n:
‚Äì sobre la base del string de parametrizaci√≥n asignado al m√≥dulo (en STEP 7)
‚Äì sobre la base de la direcci√≥n (PC o MAC/IP)
‚Äì sobre la base de la compatibilidad (volumen de funciones)
Nota
CPs Softnet
Tenga en cuenta que en cada configuraci√≥n s√≥lo puede haber un CP Softnet
(PROFIBUS o Industrial Ethernet).

1666

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
S√≠mbolos de estado al configurar (P√°gina 1667)
Cuadro de di√°logo de configuraci√≥n (P√°gina 1663)

S√≠mbolos de estado al configurar
Columna "Estado"
Observe la informaci√≥n adicional de la columna "Causas" en cada caso.

Error: componente no asignable / aplicable / no instalado

Advertencia: la asignaci√≥n se ha adaptado o no es un√≠voca.

L√≠nea de informaci√≥n debajo de la lista de configuraci√≥n
La l√≠nea de informaci√≥n notifica un aviso de grupo que informa de la operaci√≥n de importaci√≥n:

La configuraci√≥n no puede ejecutarse

La configuraci√≥n puede ejecutarse pero hay advertencias: la asignaci√≥n de los diferentes
componentes se ha adaptado o no es un√≠voca.

La configuraci√≥n puede ejecutarse

Consulte tambi√©n
Cuadro de di√°logo "Configurar: equipo de destino seleccionado" (P√°gina 1665)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1667

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustes de CP PC independientes de protocolo o de red
Configuraci√≥n XDB
Referencia
Parametrizaci√≥n de la configuraci√≥n XDB en una estaci√≥n PC en el grupo de par√°metros
"Propiedades > Configuraci√≥n XDB"

Configuraci√≥n XDB
‚óè Compatibilidad - La opci√≥n "S7RTM" est√° instalada
Si se configura una estaci√≥n PC, la casilla de verificaci√≥n est√° activada. En ese caso, en la
estaci√≥n PC de destino es necesario un "Administrador de estaciones en runtime"
(S7RTM). La estaci√≥n PC de destino debe estar configurada con el configurador de
componentes (software SIMATIC NET PC a partir de aprox. 7/2001).
Si la casilla de verificaci√≥n est√° desactivada se generan archivos de configuraci√≥n
interpretables por estaciones PC "m√°s antiguas".
‚óè Ubicaci√≥n del archivo de configuraci√≥n
La configuraci√≥n con las descripciones de conexi√≥n para la estaci√≥n PC SIMATIC se
guarda en un archivo de configuraci√≥n (*.XDB) al guardar y compilar. Ese archivo debe
instalarse en la estaci√≥n PC correspondiente.
Con el bot√≥n "Examinar" se puede modificar la ruta predeterminada para el archivo de
configuraci√≥n.
La indicaci√≥n de ruta relativa (.\...) se refiere al directorio en el que se guarda el proyecto
actual (<Install-Dir>\S7proj\<Projekt>\XDB). Si introduce una ruta absoluta (p. ej. C:\...),
recuerde que el acceso solo funciona mientras el proyecto permanezca en el entorno actual.

Asignaci√≥n de la parametrizaci√≥n de la interfaz
Comprobaci√≥n de la parametrizaci√≥n de la interfaz
Al tomar la tarjeta de comunicaci√≥n PC del cat√°logo de hardware y colocarla en el rack se
asigna una parametrizaci√≥n de interfaz adecuada.
La parametrizaci√≥n v√°lida se detecta a partir de la informaci√≥n del tipo de m√≥dulo existente en
el cat√°logo (nombre del m√≥dulo y n√∫mero de m√≥dulos configurables del mismo tipo) as√≠ como
de los m√≥dulos ya configurados (asignaci√≥n del n√∫mero de tarjeta).
Si se configuran varios CPs del mismo tipo en la estaci√≥n, las denominaciones de los m√≥dulos
se complementar√°n con un n√∫mero correlativo adicional (el n√∫mero de tarjeta). Por medio de
la lista desplegable que aparece pueden detectarse y seleccionarse las entradas admisibles.

1668

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En casos especiales, p. ej. cuando se intercambia la asignaci√≥n de m√≥dulos id√©nticos en la
estaci√≥n PC, puede ser necesario adaptar la asignaci√≥n de la interfaz; en este caso nos
referimos a cambiar el hardware, no el slot "virtual" en HW Config.
Nota
Parametrizaci√≥n de la interfaz en el sistema de destino (estaci√≥n PC)
Aseg√∫rese de que el sistema de destino (estaci√≥n PC) utilice la misma parametrizaci√≥n de
interfaz que la indicada aqu√≠. De lo contrario se producir√° un conflicto de interfaces despu√©s de
cargar el archivo de configuraci√≥n.
Nota
Comprobaci√≥n en el sistema de destino
Para la comprobaci√≥n en el sistema de destino (estaci√≥n PC) utilice la funci√≥n Ajustar interfaz
PG/PC. La encontrar√° en el Panel de control de Windows. En la ficha "V√≠a de acceso" ver√° qu√©
interfaces est√°n configuradas y si existen conflictos.

1.4.3.2

Aplicaciones para estaci√≥n PC 1.0

Aplicaci√≥n de usuario para servidor OPC
Servidor OPC
Ajustes generales espec√≠ficos de protocolo
En general
Tiempo de ciclo
Repercusi√≥n del tiempo de ciclo ajustable
El tiempo de ciclo influye en la frecuencia con que el servidor OPC actualiza en su cach√© los
valores de los OPC Items mediante una petici√≥n de comunicaci√≥n nueva y comprueba los
cambios. De este modo, el tiempo de ciclo influye en el rendimiento, la carga de comunicaci√≥n
y la carga del procesador.
Si los valores del tiempo de ciclo son demasiado peque√±os se aumenta innecesariamente la
carga del procesador.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1669

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Relaci√≥n entre el tiempo de ciclo y el tiempo de actualizaci√≥n (UpdateRate)
El par√°metro "Tiempo de actualizaci√≥n" (UpdateRate) que se ajusta desde el programa de
usuario define el intervalo de tiempo m√°s peque√±o para comprobar los valores de los OPC
Items de un grupo OPC activo. Justo despu√©s de pasado este intervalo, pero no antes, el
servidor comprueba si el valor de los OPC Items ha cambiado. De este modo se limita la carga
de comunicaci√≥n.
Los tiempos de actualizaci√≥n (UpdateRate) utilizados por el servidor OPC para SIMATIC NET
son m√∫ltiplos del tiempo de ciclo definido durante la configuraci√≥n. El tiempo de actualizaci√≥n
m√°s peque√±o posible (UpdateRate m√≠nimo) equivale al tiempo de ciclo.

Relaci√≥n entre los tiempos de ciclo ajustados de forma espec√≠fica para los protocolos
Puesto que el servidor OPC SIMATIC NET puede utilizar a la vez varios protocolos,
el UpdateRate m√≠nimo del servidor OPC resulta ser el valor m√°s grande del tiempo de ciclo
configurado para los protocolos activos (son aquellos para los que se han configurado
conexiones).
Ejemplo:
Para S7 se ha configurado un tiempo de ciclo de 100 ms. No se utiliza ning√∫n otro protocolo.
El servidor OPC utiliza el valor 100 ms como tiempo de actualizaci√≥n (UpdateRate) m√≠nimo.
Adicionalmente se utiliza el protocolo DP, para el que se ha configurado un tiempo de ciclo de
50 ms. Consecuencia: Ahora el servidor OPC utiliza para todos los protocolos un UpdateRate
m√≠nimo de 50 ms.
Observaci√≥n: El comportamiento descrito es el resultado de las exigencias de la norma OPC.
Esta prescribe que los cambios de los datos no pueden notificarse con mayor rapidez que la
derivada del tiempo de actualizaci√≥n (UpdateRate) m√≠nimo.

Tiempo de actualizaci√≥n real (UpdateRate)
El tiempo de actualizaci√≥n (UpdateRate) que se alcanza realmente durante el funcionamiento
depende de distintos factores, entre ellos:
‚óè Protocolo de comunicaci√≥n subordinado
‚óè Interlocutores
‚óè N√∫mero y tipo de items
Con ello, el tiempo de actualizaci√≥n (UpdateRate) que se alcanza realmente puede ser mayor
que el valor m√≠nimo configurado aqu√≠.
Si el valor de proceso cambia varias veces dentro del intervalo de actualizaci√≥n real, no se
transferir√°n todos los cambios de valor a la aplicaci√≥n.
Observaci√≥n:
El caudal de datos en peticiones as√≠ncronas y s√≠ncronas no depende de los par√°metros
UpdateRate ni del tiempo de ciclo definido en la configuraci√≥n.

1670

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Protecci√≥n de acceso
Activar la protecci√≥n de acceso
Referencia
Ajustes de servidor OPC / grupo de par√°metros "Propiedades > General"; el nodo espec√≠fico
de protocolo est√° seleccionado.

Significado de los derechos de acceso para variables OPC
A trav√©s del servidor OPC se pueden definir derechos de acceso para variables o grupos de
variables individuales espec√≠ficamente para cada protocolo. La asignaci√≥n de derechos de
acceso permite, por ejemplo, impedir que se sobrescriba una variable de c√°lculo de control
interno.
‚óè Derechos est√°ndar
Para elementos OPC no citados espec√≠ficamente se puede definir un valor est√°ndar:
‚Äì ReadWrite: lectura y escritura
‚Äì Read: lectura
‚Äì Write: escritura
‚Äì None: ning√∫n acceso
‚óè Derechos de acceso espec√≠ficos de elementos OPC
Seleccionando esta opci√≥n es posible asignar expl√≠citamente derechos de acceso para
elementos OPC determinados en el campo de entrada correspondiente.

Consulte tambi√©n
Sintaxis - Asignar derechos de acceso espec√≠ficos de elementos OPC (P√°gina 1671)

Sintaxis - Asignar derechos de acceso espec√≠ficos de elementos OPC
Es posible introducir derechos de acceso para uno o varios elementos OPC.
Esto no afecta a los derechos est√°ndar de los dem√°s elementos OPC.

La sintaxis de los derechos de acceso espec√≠ficos de elementos OPC est√° definida del siguiente modo:
<OPCItem>=<derechos>

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1671

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
siendo:
‚óè <OPCItem>
Indicaci√≥n de uno o varios elementos OPC de acuerdo con la sintaxis definida en la
documentaci√≥n OPC. Est√° permitido utilizar alias.
Pueden emplearse los comodines siguientes:
* un n√∫mero cualquiera de caracteres irrelevantes
? un car√°cter exactamente es irrelevante
‚óè <derechos>

1672

ReadWrite

lectura y escritura

Read

lectura

Write

escritura

None

ning√∫n acceso

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas de evaluaci√≥n
‚óè Los derechos asignados aqu√≠ espec√≠ficamente tienen prioridad sobre los derechos
est√°ndar que se han asignado en el √°rea de entrada Protecci√≥n de acceso.
‚óè Los derechos asignados aqu√≠ espec√≠ficamente se eval√∫an en el orden introducido aqu√≠. En
caso de asignaci√≥n m√∫ltiple a un elemento OPC siempre es v√°lida la √∫ltima asignaci√≥n.
Ejemplo:
DP:[CP 5611]Slave040_AB*=RW
DP:[CP 5611]Slave040_AB1=R
DP:[CP 5611]Slave040_AB2=W
DP:[CP 5611]Slave040_AB1=W
DP:[CP 5611]Slave040_AB1*=R
Debido a esta entrada tienen efecto los derechos de acceso siguientes, entre otros:
DP:[CP 5611]Slave040_AB2=W
DP:[CP 5611]Slave040_AB1=R
Sugerencia: observe la descripci√≥n detallada de la sintaxis en la documentaci√≥n OPC
citada m√°s abajo. All√≠ encontrar√° una serie de ejemplos, incluso para aplicaciones como
PROFINET IO.
‚óè Los ceros a la izquierda en los elementos y en las definiciones de los derechos de acceso
se ignorar√°n por principio.
El ejemplo siguiente explica la ventaja resultante:
Se configura el derecho de acceso siguiente: Slave004_AB0=R
Con ello se ha asignado impl√≠citamente el derecho de acceso correspondiente a los
elementos siguientes, p. ej.:
‚Äì Elemento 1: Slave00004_AB000
‚Äì Elemento 2: Slave4_AB00,1 (observaci√≥n: la sintaxis con ",1" la predetermina el OPC
Scout)
Para el uso de los comodines "*" y "?" resulta de ello:
No utilice dichos comodines en lugares en los que puede haber un cero a la izquierda en el
elemento.
Ejemplo:
La definici√≥n Slave0?9M06_AB1=R debe reemplazarse por las dos definiciones siguientes:
‚Äì Slave?9M06_AB1=R
‚Äì Slave9M06_AB1=R

Informaci√≥n relacionada
Observe la descripci√≥n detallada de la sintaxis en la documentaci√≥n OPC. All√≠ encontrar√° una
serie de ejemplos, incluso para aplicaciones como PROFINET IO.

Ceros a la izquierda en items - ejemplo con comodines:
Se utiliza el item siguiente:
‚óè Slave00004_AB000
Una definici√≥n del derecho de acceso que fallar√≠a en la comparaci√≥n ser√≠a:
‚óè Slave0?4_AB0=R

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1673

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Raz√≥n:
En la comparaci√≥n se detecta un "0" a la izquierda en el item, de modo que √©ste se reduce a:
Slave4_AB
A causa del comod√≠n "?", en la definici√≥n el "0" antepuesto ya no se reconoce como un "0" a
la izquierda durante la comparaci√≥n. Por consiguiente, la definici√≥n del derecho de acceso no
se reduce y la comparaci√≥n falla.

Soluci√≥n:
Para obtener la asignaci√≥n de derechos deseada en este ejemplo, deber√° realizar en su lugar
las dos definiciones siguientes:
‚óè Slave?4_AB0=R
‚óè Slave4_AB0=R

Ajustes espec√≠ficos de S7
S√≠mbolos OPC
Utilizar s√≠mbolos
Referencia
Ajustes de servidor OPC / grupo de par√°metros "Propiedades > S7 > S√≠mbolos OPC".

Utilizar s√≠mbolos (a partir del servidor OPC V6.1)
Es posible determinar si deben incluirse s√≠mbolos en los datos de sistema para el servidor OPC
desde las tablas de s√≠mbolos configuradas para una CPU. Esto es imprescindible para que las
aplicaciones de usuario (cliente OPC) puedan depositar accesos simb√≥licos a variables a
trav√©s del servidor OPC.
Se consultan las tablas de s√≠mbolos de las CPUs para las que se han configurado conexiones
S7 para el servidor OPC. En este caso s√≥lo se tendr√°n en cuenta los s√≠mbolos que hacen
referencia a bloques de datos (DB).
Las alternativas que pueden elegirse aqu√≠ son:
‚óè Ninguno
No se incluir√° ning√∫n s√≠mbolo de STEP 7 en los datos de sistema del servidor OPC. Son
v√°lidos los derechos de acceso configurados para los OPC Items en la protecci√≥n de
acceso.
‚óè Todos
Se incluir√°n todos los s√≠mbolos relevantes de STEP 7 en los datos de sistema del servidor
OPC.
Los derechos de todos los accesos simb√≥licos a las variables asignadas se establecen en
Read/Write (RW) con esta selecci√≥n. Tienen prioridad sobre los derechos de acceso de los
OPC_Items seleccionados en el √°rea Protecci√≥n de acceso.

1674

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Configurar
En los datos de sistema para el servidor OPC se incluyen s√≠mbolos seleccionados y
configurados especialmente de STEP 7. A trav√©s del bot√≥n "Configurar" se accede al
cuadro de di√°logo "Configuraci√≥n de s√≠mbolos", en el que se pueden seleccionar y
configurar s√≠mbolos.
‚óè Elementos de campo visibles en runtime (seleccionable a partir de servidor OPC V8.0)
Se puede decidir si los elementos de matrices deben ser visibles en el servidor OPC en
runtime. Los afectados son los campos (matrices) que est√°n configurados como s√≠mbolos.
La opci√≥n est√° desactivada por defecto, ya que la visibilidad de los elementos de campo
puede traducirse en una gran carga de tiempo en el servidor OPC. En versiones anteriores
de servidor OPC (< V8.0), los elementos de campo est√°n visibles por principio y no es
posible desactivar esta opci√≥n.
Nota
Coherencia
Si se selecciona la opci√≥n "Todos", al guardar y compilar se tendr√°n en cuenta las tablas de
s√≠mbolos actuales de la CPU.
Si se utiliza la opci√≥n "Configurados", hay que tener en cuenta que los cambios posteriores
en las tablas de s√≠mbolos tienen las siguientes consecuencias en los datos del sistema para
el servidor OPC:
‚óè Los s√≠mbolos agregados no se tienen en cuenta
‚óè Los s√≠mbolos seleccionados retirados posteriormente de la tabla de s√≠mbolos no pueden
guardarse.
Nota
Matrices de bits
Los s√≠mbolos que contienen datos del tipo "matriz de bits" no se incluir√°n en los datos de
sistema del servidor OPC.
Nota
Acerca del procedimiento
Durante la aplicaci√≥n de s√≠mbolos aqu√≠ descrita no puede estar abierto en KOP / AWL / FUP
ning√∫n FB en el que se utilicen s√≠mbolos. En caso contrario no se leer√°n todos los s√≠mbolos
al aplicarlos.

Configuraci√≥n de s√≠mbolos
Referencia
Ajustes de servidor OPC / grupo de par√°metros "Propiedades > S7 > S√≠mbolos OPC".
Acceso a la configuraci√≥n de s√≠mbolos a trav√©s del bot√≥n "Configurar s√≠mbolos".

Resumen
En este cuadro de di√°logo se pueden seleccionar y configurar los s√≠mbolos que deben
aplicarse en los datos de sistema del servidor OPC.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1675

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para la plantilla de los s√≠mbolos son relevantes las CPUs para las que hay configuradas
conexiones S7 para el servidor OPC.
En el √°rea de navegaci√≥n, a la izquierda, se muestran las estaciones y CPUs
correspondientes, y, dado el caso, los elementos de estructura. En el √°rea de contenido, a la
derecha, se muestran los s√≠mbolos definidos para la CPU o el elemento de estructura
seleccionado. Para cada s√≠mbolo se indican el tipo de datos asignado y las propiedades
configuradas en ese momento. Estas propiedades pueden configurarse en la parte inferior del
cuadro de di√°logo.
Nota
Tenga en cuenta que el indicador de la columna "Acceso" tambi√©n debe contener el valor
"mixed (derecho de acceso predeterminado)". Este se muestra cuando el derecho de acceso
en un elemento subordinado es diferente del derecho de acceso predeterminado. El derecho
de acceso predeterminado se ajusta por defecto en los elementos subordinados nuevos que
se crean.

Seleccionar y configurar s√≠mbolos
1. Seleccione primero en el √°rea de navegaci√≥n el grupo de s√≠mbolos de una CPU o de un
elemento de estructura.
2. A continuaci√≥n, seleccione uno o varios s√≠mbolos en el √°rea de contenido con el cursor del
rat√≥n.
3. Configure las propiedades de los s√≠mbolos seleccionados en la parte inferior del cuadro de
di√°logo seg√∫n las posibilidades descritas a continuaci√≥n.

Indicaci√≥n "Elementos con rama activa"
La indicaci√≥n tiene el siguiente significado:
‚óè S√≠mbolos: N√∫mero de elementos presentes en total en la rama o el elemento de estructura
seleccionado (los elementos de estructura seleccionados tambi√©n se cuentan).
‚óè Elementos de matriz: N√∫mero de elementos en la matriz
‚Äì Indicaci√≥n de valor izquierda: N√∫mero de elementos marcados como "visibles"
‚Äì Indicaci√≥n de valor derecha: Total de elementos

Propiedades configurables
‚óè Opci√≥n "Visible"
Si se selecciona esta opci√≥n, el s√≠mbolo seleccionado se excluye del proceso de carga al
servidor OPC.
‚óè Opci√≥n "Cargar solo s√≠mbolos visibles"
Si se selecciona esta opci√≥n, solo se aplicar√°n en los datos de sistema del servidor OPC los
s√≠mbolos marcados como "visibles", con lo que ser√°n visibles para el cliente OPC. La
opci√≥n reduce considerablemente el tiempo de carga al servidor OPC si hay muchos
s√≠mbolos marcados como "no visible".

1676

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Derecho de acceso
A los s√≠mbolos seleccionados se les pueden asignar los siguientes derechos de acceso
desde la lista desplegable:
‚Äì ReadWrite: Lectura y escritura
‚Äì Read: Leer
‚Äì Write: Escribir
‚Äì None: Ning√∫n acceso
Los derechos aqu√≠ seleccionados tienen preferencia ante los derechos de acceso
configurados para los objetos OPC en la protecci√≥n de acceso.
Nota
Tenga en cuenta que con "Derecho de acceso" este ajuste no se exporta y por tanto
tampoco se importa, sino que siempre se muestra el ajuste actual.
‚óè Conexi√≥n
En la lista desplegable de conexiones configuradas, seleccione la conexi√≥n S7 a trav√©s de
la cual debe producirse el acceso simb√≥lico a variables.
‚óè Campos de entrada "Edit EU Lo / Hi" - Definir el rango de tolerancia para valores medidos
(valores l√≠mite EU Lo y EU Hi)
Defina aqu√≠ valores l√≠mite para la determinaci√≥n de un rango de tolerancia para los objetos
OPC seleccionados. Los campos de entrada est√°n activos si se da la siguiente condici√≥n:
‚Äì Solo se ha seleccionado un s√≠mbolo;
‚Äì El s√≠mbolo tiene asignado un tipo de datos elemental que admite la representaci√≥n
num√©rica (INT, DINT, REAL, BYTE, WORD, DWORD).
Observaci√≥n:
La entrada solo es posible para servidores OPC a partir de la versi√≥n 6.4.
Consulte tambi√©n Introducir valores l√≠mite para EU Lo y EU Hi (P√°gina 1678)

Indicaci√≥n "Ruta de acceso"
Aqu√≠ se indica la ruta de almacenamiento en el proyecto STP 7 actual para el objeto
seleccionado en el √°rea de navegaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1677

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Particularidades
‚óè Las matrices de bits no se aplican
Los s√≠mbolos que contienen datos del tipo "matriz de bits" no se incluyen en los datos de
sistema del servidor OPC. Esta restricci√≥n es v√°lida aunque los s√≠mbolos se muestren
dentro de la selecci√≥n posible. Tambi√©n es v√°lida independientemente de si se ajusta la
opci√≥n "Visible" (ver arriba) para los s√≠mbolos.
‚óè La representaci√≥n de los tipos de datos "Array of UDT" y "Array of Struct" es diferente
En el caso de los s√≠mbolos que contienen los tipos de datos compuestos "Array of UDT" o
"Array of Struct" la estructura del tipo de datos "UDT" o "Struct" solo se muestra una vez en
la parte izquierda del cuadro de di√°logo. El hecho de que se trate de una matriz se reconoce
por la indicaci√≥n "Matriz" (ARRAY) en el campo "Tipo de datos" de la parte derecha.
Solo se muestra el primer elemento Array con sus direcciones y, con √©l, la asignaci√≥n de
direcciones de los diferentes elementos del Array.
Al contrario de lo que ocurre en esta forma de representaci√≥n, en otras herramientas, como
el configurador de archivos de s√≠mbolos, los elementos de matriz se muestran de forma
m√∫ltiple.
Sin embargo, en principio se trata de estructuras de datos id√©nticas.
Recuerde que el ajuste de la opci√≥n "visible" arriba descrita es efectivo para todos los
elementos de una matriz; es decir, tambi√©n para los elementos de matriz no representados.

Introducir valores l√≠mite para EU Lo y EU Hi
Introducir un rango de tolerancia para valores medidos (valores l√≠mite superior e inferior EU Lo y EU Hi)
Defina aqu√≠ valores l√≠mite para la determinaci√≥n de un rango de tolerancia para los objetos
OPC seleccionados (vea el significado m√°s abajo).
Pueden indicarse valores num√©ricos como n√∫mero entero, coma flotante o notaci√≥n
exponencial ("notaci√≥n de ingenier√≠a")
Nota: Como separador debe utilizarse el car√°cter "." en lugar del car√°cter ",".
‚óè EU Lo (Engineering Unit Low)
L√≠mite inferior
‚óè EU Hi (Engineering Unit High)
L√≠mite superior
Debe regir: EU Lo <= EU Hi
A los campos de entrada vac√≠os se les asigna autom√°ticamente "0".

1678

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Observe los rangos de valores dependientes del tipo de datos: Rango de valores de los tipos
de datos (P√°gina 1680)
‚óè Ejemplos:
‚Äì EU Lo = 10 EU Hi = 25
‚Äì EU Lo = 4.5 EU Hi = 14.5
‚Äì EU Lo = 1.2e-2 EU Hi = 2.5e-2
‚óè Observaciones:
‚Äì La indicaci√≥n del rango de tolerancia ("Percent Deadband" = rango de tolerancia
porcentual) corresponde en cada caso a un grupo de objetos OPC.
‚Äì La entrada solo es posible para servidores OPC a partir de la versi√≥n 6.4.

Significado del valor l√≠mite inferior - EU Lo y del valor l√≠mite superior - EU Hi
Pueden indicarse rangos de tolerancia para el registro de valores medidos. Un valor medido
puede variar dentro de un rango de tolerancia ("Percent Deadband" = rango de tolerancia
porcentual) sin que la variaci√≥n se notifique.
Para ello se determina un valor relativo a partir de los par√°metros indicados y seg√∫n la
siguiente f√≥rmula. Este valor indica cu√°ntas unidades puede variar como m√°ximo una
magnitud f√≠sica hacia arriba o hacia abajo sin que el cambio se notifique.
--------------------------------------------------------A = PD / 100 x ( EU HI ‚Äì EU Lo)
--------------------------------------------------------siendo:
A = cantidad correspondiente a la variaci√≥n (hacia arriba o hacia abajo)
PD = Percent Deadband / %
EU Lo = Valor l√≠mite inferior
EU Hi = Valor l√≠mite superior

Ejemplo
En una curva de medici√≥n de temperatura partimos del hecho de que en el rango entre 30¬∞C
y 40¬∞C se da el rango de tolerancia t√≠pico para el valor medido. Como rango de tolerancia
porcentual ("Percent Deadband") se fija el 10%.
Por ello se definen los siguientes valores:
EU Lo = 30
EU Hi = 40
PD = 10%
De ello se deriva: A = 10 / 100 x (40 ‚Äì 30) = 1
As√≠, un cambio de temperatura solo se notifica como cambio si var√≠a m√°s de 1¬∞C por encima
o por debajo del valor medido anterior registrado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1679

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Configuraci√≥n de s√≠mbolos (P√°gina 1675)

Rango de valores de los tipos de datos
Se aplican los siguientes rangos de valores para los tipos de datos utilizados:
BYTE= 0 .. 256
INT= -32768 ... 32767
WORD= 0 ... 65535
DWORD= 0 ... 4294967295.0
DINT= -2147483648 ... 2147483647.0
REAL POS UPPER = 3.402823e+38
REAL POS UNDER = 1.175495e-38
REAL NEG UPPER = -1.175495e-38 (l√≠mite superior negativo)
REAL NEG UNDER = -3.402823e+38 (l√≠mite inferior negativo)

Consulte tambi√©n
Introducir valores l√≠mite para EU Lo y EU Hi (P√°gina 1678)

Sintaxis - Asignar derechos de acceso espec√≠ficos de elementos OPC
Es posible introducir derechos de acceso para uno o varios elementos OPC.
Esto no afecta a los derechos est√°ndar de los dem√°s elementos OPC.

La sintaxis de los derechos de acceso espec√≠ficos de elementos OPC est√° definida del siguiente modo:
<OPCItem>=<derechos>
siendo:
‚óè <OPCItem>
Indicaci√≥n de uno o varios elementos OPC de acuerdo con la sintaxis definida en la
documentaci√≥n OPC. Est√° permitido utilizar alias.
Pueden emplearse los comodines siguientes:
* un n√∫mero cualquiera de caracteres irrelevantes
? un car√°cter exactamente es irrelevante
‚óè <derechos>

1680

ReadWrite

lectura y escritura

Read

lectura

Write

escritura

None

ning√∫n acceso

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas de evaluaci√≥n
‚óè Los derechos asignados aqu√≠ espec√≠ficamente tienen prioridad sobre los derechos
est√°ndar que se han asignado en el √°rea de entrada Protecci√≥n de acceso.
‚óè Los derechos asignados aqu√≠ espec√≠ficamente se eval√∫an en el orden introducido aqu√≠. En
caso de asignaci√≥n m√∫ltiple a un elemento OPC siempre es v√°lida la √∫ltima asignaci√≥n.
Ejemplo:
DP:[CP 5611]Slave040_AB*=RW
DP:[CP 5611]Slave040_AB1=R
DP:[CP 5611]Slave040_AB2=W
DP:[CP 5611]Slave040_AB1=W
DP:[CP 5611]Slave040_AB1*=R
Debido a esta entrada tienen efecto los derechos de acceso siguientes, entre otros:
DP:[CP 5611]Slave040_AB2=W
DP:[CP 5611]Slave040_AB1=R
Sugerencia: observe la descripci√≥n detallada de la sintaxis en la documentaci√≥n OPC
citada m√°s abajo. All√≠ encontrar√° una serie de ejemplos, incluso para aplicaciones como
PROFINET IO.
‚óè Los ceros a la izquierda en los elementos y en las definiciones de los derechos de acceso
se ignorar√°n por principio.
El ejemplo siguiente explica la ventaja resultante:
Se configura el derecho de acceso siguiente: Slave004_AB0=R
Con ello se ha asignado impl√≠citamente el derecho de acceso correspondiente a los
elementos siguientes, p. ej.:
‚Äì Elemento 1: Slave00004_AB000
‚Äì Elemento 2: Slave4_AB00,1 (observaci√≥n: la sintaxis con ",1" la predetermina el OPC
Scout)
Para el uso de los comodines "*" y "?" resulta de ello:
No utilice dichos comodines en lugares en los que puede haber un cero a la izquierda en el
elemento.
Ejemplo:
La definici√≥n Slave0?9M06_AB1=R debe reemplazarse por las dos definiciones siguientes:
‚Äì Slave?9M06_AB1=R
‚Äì Slave9M06_AB1=R

Informaci√≥n relacionada
Observe la descripci√≥n detallada de la sintaxis en la documentaci√≥n OPC. All√≠ encontrar√° una
serie de ejemplos, incluso para aplicaciones como PROFINET IO.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1681

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Avisos de OPC
Configurar avisos de OPC
Referencia
Ajustes de servidor OPC / grupo de par√°metros "Propiedades > S7 > Avisos de OPC".

Idioma / Ajuste de idioma del texto de aviso
Para avisos de OPC se define qu√© versiones de idioma de la librer√≠a de textos deben cargarse
en el servidor OPC para los textos de aviso (avisos de bloque y de s√≠mbolos).
Mediante las dos casillas de verificaci√≥n se ajusta lo siguiente:
‚óè Idioma predeterminado (definido como predeterminado para visualizadores):
Si el idioma predeterminado para avisos es uno de los siguientes idiomas est√°ndar de
STEP 7: Alem√°n (Alemania), Ingl√©s (EE.UU.), Franc√©s (Francia), Espa√±ol (alfabetizaci√≥n
tradicional), Italiano (Italia). En cualquier otro caso, la casilla de verificaci√≥n est√°
desactivada.
‚óè Ingl√©s (USA)
(si est√° instalado el ingl√©s (USA) como idioma est√°ndar)
Si el idioma est√°ndar para visualizadores ya es de por s√≠ el ingl√©s (USA), la casilla de
verificaci√≥n estar√° desactivada.
Se puede seleccionar una de las dos opciones. Si se seleccionan ambas opciones, se
comprueba si en el proyecto, en "Idioma para visualizador" se ha seleccionado una
memorizaci√≥n del texto en varios idiomas. Si es as√≠, en la descarga a la estaci√≥n PC se cargan
las librer√≠as de texto correspondientes.

Sellos de tiempo para avisos
En este grupo de par√°metros, seleccione de qu√© instancia debe colocarse el sello de tiempo
de un aviso. Si se deja que sea la CPU la encargada de colocar sellos de tiempo, los avisos
pueden registrarse exactamente con la indicaci√≥n del momento en que se produjeron. La
posible indicaci√≥n de un offset de tiempo tambi√©n permite registrar en un sistema de registro
los avisos que se producen, por ejemplo, en instalaciones con diferentes zonas horarias, con
una hora de referencia com√∫n.
‚óè Sello de tiempo de la CPU
Los avisos obtienen el sello de tiempo de la CPU que notifica el aviso. Excepci√≥n: Los
StatepathEvents son avisos de generaci√≥n local y obtienen la hora del PC (UTC).
‚óè Hora de la CPU + offset
Los avisos reciben el sello de tiempo de la CPU que notiifica el aviso; a dicho sello se le
a√±ade un retardo ajustable con precisi√≥n de segundo (offset). Excepci√≥n: Los
StatepathEvents son avisos de generaci√≥n local y obtienen la hora del PC (UTC).
Rango de retardo: de -23:59:59 a + 23:59:59
‚óè Hora del PC (UTC)
En el momento en que se producen, los avisos reciben el sello de tiempo (UTC) de la
estaci√≥n PC que lo recibe (servidor OPC).

1682

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tabla de asignaci√≥n de avisos de OPC
Tabla de asignaci√≥n de avisos de OPC
Referencia
Ajustes de servidor OPC / grupo de par√°metros "Propiedades > S7 > Tabla de asignaci√≥n de
avisos de OPC".

Significado
Las categor√≠as de avisos configuradas en un proyecto en "Datos comunes > Categor√≠as" se
representan en una tabla. Las categor√≠as tienen asignada por defecto la categor√≠a OPC
"OffNormal". En caso necesario, asigne una categor√≠a OPC diferente.

Conexiones S7 para el acceso a bloques de datos optimizados con S7-1200/S7-1500
Para el acceso de datos a bloques de datos optimizados del servidor OPC V12 para bloques
de datos, marcas, entradas, salidas, contadores y temporizadores sin seguridad de tipos de un
SIMATIC S7-1500 y S7-1200 existe la posibilidad de configurar una conexi√≥n S7 con la CPU.
Las conexiones S7 para el acceso a bloques de datos optimizados en el S7-1500/S7-1200 solo
son posibles v√≠a Industrial Ethernet.

Requisitos
‚óè STEP 7 Professional V12 SP1 o superior
‚óè Servidor OPC V12 o superior
‚óè S7-1500 o S7-1200 V4.0 o superior

Nombre de la conexi√≥n para servidor OPC V12 y conexiones S7
Al crear una conexi√≥n S7 para un servidor OPC, STEP 7 propone un nombre v√°lido. Existe la
posibilidad de modificar en cualquier momento el nombre de la conexi√≥n S7. Algunos
caracteres y nombres de conexi√≥n est√°n ocupados por el sistema y no pueden utilizarse para
asignar el nombre de la conexi√≥n. STEP 7 comprueba autom√°ticamente que el nombre de la
conexi√≥n no contenga caracteres inadmisibles.

Tabla de conexiones
En la tabla de conexiones de la vista de redes de la ficha "Conexiones" se muestran las
conexiones creadas por el usuario junto con sus par√°metros. En la columna "Interlocutor"
existe la posibilidad de modificar el interlocutor del servidor OPC V12.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1683

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros de las propiedades especiales de la conexi√≥n
En la ventana de inspecci√≥n de la conexi√≥n S7 unilateral seleccionada est√°n activadas las
casillas de verificaci√≥n "Unilateral" y "Establecimiento activo de la conexi√≥n" en "Propiedades
> Configuraci√≥n > Propiedades especiales de la conexi√≥n". En el grupo de par√°metros
"Propiedades especiales de la conexi√≥n" no es posible realizar cambios.

Detalles de direcciones
En la ventana de inspecci√≥n de la conexi√≥n S7 unilateral seleccionada se ven los TSAPs de los
interlocutores en los recursos de la conexi√≥n, en "Propiedades > Configuraci√≥n > Detalles de
direcciones". El TSAP local tiene la estructura siguiente:
SNOPCCxxxxyyyyyy
‚óè SNOPCC = SIMATIC NET OPC Configured connection
‚óè xxxx = √≠ndice del servidor OPC V12
‚óè yyyyyy = ID de la conexi√≥n S7
El TSAP del interlocutor es "SIMATIC-ROOT-OTH".
En el grupo de par√°metros "Detalles de direcciones" no es posible realizar cambios.

Par√°metros OPC
En la ventana de inspecci√≥n de la conexi√≥n S7 unilateral seleccionada existen las siguientes
propiedades de configuraci√≥n en "Propiedades > Configuraci√≥n > OPC".
‚óè Activaci√≥n del acceso optimizado
‚óè Configuraci√≥n del tama√±o del b√∫fer para el acceso optimizado a variables
‚óè Administraci√≥n del acceso optimizado a variables introduciendo la contrase√±a de acceso
Tama√±o del b√∫fer:
El tama√±o predeterminado del b√∫fer puede modificarse para casos de aplicaciones especiales
con una capacidad especialmente elevada de variables de datos en una CPU (S7-1500 o
S7-1200 V4.0). El acceso a variables de datos colindantes dentro de un √°rea de datos se
optimiza para mejorar el rendimiento. Los resultados √≥ptimos se consiguen con tama√±os de
b√∫fer que abarquen como m√≠nimo la mayor√≠a de variables de datos colindantes a las que se
accede con regularidad y frecuencia.
Ejemplo: Desde el bloque de datos "db10" se leen regularmente muchas variables de datos
entre los bytes 1000 y 1999 y, en contadas ocasiones, tambi√©n una variable de datos del byte
30000. En este caso basta con un tama√±o de b√∫fer de 1000 bytes.

Recursos de conexi√≥n
En las conexiones S7 configuradas para un servidor OPC V12 o superior con el fin de acceder
a bloques de datos optimizados en un PLC S7-1500 o S7-1200 V4.0 o superior, se muestran
los recursos de conexi√≥n necesarios para ello en el lado del PLC. Los recursos de conexi√≥n
necesarios se visualizan en las propiedades de la CPU correspondiente, en "Propiedades >
General > Recursos de conexi√≥n" de la ventana de inspecci√≥n.

1684

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para conexiones S7 para el acceso de datos a bloques de datos optimizados de un servidor
OPC V12 o superior, en el lado del PLC los recursos de este tipo de conexiones no se asignan
a la fila "Comunicaci√≥n S7" sino a las filas "Otra comunicaci√≥n" (S7-1500) o "Conexiones libres
disponibles" (S7-1200 V4.0 o superior). En una conexi√≥n S7 configurada para un servidor OPC
V12 con un S7-1500 o S7-1200 V4.0 o superior se requieren varios recursos de conexi√≥n.

Sustituir servidor OPC
Desde el men√∫ contextual "Sustituir dispositivo" de un servidor OPC seleccionado existe la
posibilidad de sustituir un servidor OPC V12 que permite el acceso de datos a bloques de datos
optimizados en S7-1500 o S7-1200 V4.0, por un servidor OPC < V12 y viceversa.
En tanto que se hayan configurado ya conexiones S7 para el servidor OPC que debe
sustituirse, durante el intercambio de servidores OPC se mostrar√° una nota indicando que las
conexiones S7 existentes se borrar√°n. Una vez realizado el intercambio deber√°n crearse de
nuevo.

Visualizaci√≥n de una conexi√≥n S7 unilateral entre un servidor OPC V12 y un S7-1500 o S7-1200 V4.0
o superior
En cuanto un servidor OPC V12 haya solicitado correctamente el acceso de datos a bloques
de datos optimizados en un S7-1500 o S7-1200 V4.0 o superior, dicha conexi√≥n se mostrar√°
en STEP 7 en la tabla de conexiones online del PLC correspondiente.
Este tipo de conexiones tambi√©n se muestran en la ventana de inspecci√≥n "Informaci√≥n de la
conexi√≥n" de la CPU online seleccionada: aqu√≠ se visualizan los recursos de conexi√≥n online
utilizados en el PLC.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1685

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Servidor OPC UA redundante
Servidor OPC UA redundante - Principios b√°sicos
Servidor de redundancia OPC UA transparente
La siguiente representaci√≥n muestra c√≥mo, en la soluci√≥n de redundancia OPC UA
transparente, los servidores OPC UA est√°n incrustados en un grupo de redundancia y
configurados en correspondencia.

23&8$&OLHQW
3&



&HUWLILFDGR

,QGXVWULDO(WKHUQHW


'LVWULEXFL¬µQGHFDUJD6HVVLRQUHGXQGDQ
FLD

*UXSRGHUHGXQGDQFLD

'LUHFFL¬µQ,3UHGXQGDQWH 1/% 
2SFWFS

6HUYLGRU23&8$
3&

&HUWLILFDGR

&3

(QODFH6B
(QODFH6B



6HUYLGRU23&8$

6LQFURQL]DFL¬µQ
6HVVLRQV
6XEVFULSWLRQV

(QODFHV6FRQILJXU
DGDVSRULJXDO

&HUWLILFDGR
&3

3&

(QODFH6B
(QODFH6B



6,0$7,&6

‚ë†
‚ë°
‚ë¢

Se configura una estaci√≥n PC para cada servidor OPC UA redundante. Las estaciones PC redundantes asignadas
a un cliente OPC UA forman un grupo de redundancia. Esta asignaci√≥n se realiza mediante la configuraci√≥n unitaria
de la "direcci√≥n IP del grupo de redundancia" en los servidores OPC UA.
El cliente OPC UA que utiliza la redundancia est√° en una estaci√≥n PC de nivel superior.
La estaci√≥n PC de nivel superior no debe configurarse para el uso de la redundancia OPC UA en el proyecto de STEP
7.
La comunicaci√≥n entre los servidores OPC UA y los aut√≥matas programables se consigue mediante conexiones S7
que se han creado de forma m√∫ltiple y se han configurado de forma id√©ntica.
Seg√∫n sea la configuraci√≥n, es posible utilizar conexiones S7 v√≠a Ind.Ethernet o PROFIBUS.

1686

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Parametrizar un servidor OPC SIMATIC NET como servidor S7 OPC UA para la redundancia OPC UA
transparente
La redundancia transparente utilizada por el cliente OPC UA de nivel superior se consigue
b√°sicamente del modo siguiente en la configuraci√≥n:
1. Para utilizar estaciones PC con servidor OPC UA SIMATIC NET redundante, se crea en
cada caso un componente del tipo servidor OPC >= V8.1. Para estos servidores OPC se
activa la redundancia S7 UA.
2. Se adopta la direcci√≥n IP virtual. Esta direcci√≥n IP virtual se ha definido previamente en el
administrador de compensaci√≥n de carga de red (NLB) para ambas estaciones PC. La
direcci√≥n IP virtual se reproduce en las direcciones IP reales del servidor OPC UA.
3. Se define un puerto que permite a los dos servidores OPC UA comunicarse con el fin de
sincronizar los datos;
4. Se configuran conexiones S7 id√©nticas para la comunicaci√≥n con los sistemas de
automatizaci√≥n conectados para ambos servidores OPC UA;
5. Se asignan a las estaciones PC certificados de autenticaci√≥n generados autom√°ticamente.
En caso necesario, se asignan certificados de autenticaci√≥n nuevos a las dos estaciones
PC redundantes.

Comprobaci√≥n de coherencia
Al guardar y compilar la configuraci√≥n se lleva a cabo una comprobaci√≥n de coherencia. En
relaci√≥n a la redundancia OPC UA se realizan las comprobaciones siguientes:
‚óè Las direcciones de servidor a servidor deben ser un√≠vocas dentro de un grupo de
redundancia. Del mismo modo, dentro de un proyecto solo est√° permitido utilizar una vez
una direcci√≥n IP com√∫n de un grupo de redundancia.
‚óè Cada miembro de un grupo de redundancia debe disponer de las mismas conexiones S7
con los mismos nombres e interlocutores.
‚óè La configuraci√≥n de hardware de las estaciones PC en los grupos de redundancia debe ser
id√©ntica, es decir, los m√≥dulos utilizados para la funci√≥n de redundancia deben ser id√©nticos
en las estaciones PC redundantes.
‚óè Los par√°metros de las conexiones S7 tienen que ser id√©nticos; entre ellos se incluyen el
establecimiento de la conexi√≥n, los avisos, las optimizaciones, el tama√±o de PDU, el
n√∫mero de peticiones paralelas y los tiempos de vigilancia.
‚óè Los ajustes S7 de los servidores OPC UA tienen que ser id√©nticos; entre ellos se incluyen
el tiempo de ciclo, los derechos de acceso, las alarmas S7 y los s√≠mbolos S7.
Nota
Recomendaci√≥n: conexiones S7 establecidas de forma permanente
Se recomienda encarecidamente configurar conexiones S7 establecidas de forma
permanente y activa en los servidores OPC UA. De este modo se consiguen tiempos de
conmutaci√≥n m√°s reducidos en caso de fallo de un servidor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1687

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento / recomendaci√≥n
Las parametrizaciones de los servidores OPC UA redundantes deben corresponderse entre s√≠.
Al guardar y compilar la configuraci√≥n se lleva a cabo una comprobaci√≥n de coherencia
correspondiente.
Si se aprovechan en STEP 7 las posibilidades de copia, se reduce el peligro de que se
produzcan indicaciones incoherentes. Es posible copiar toda la estaci√≥n PC o bien solo el
servidor OPC. Si ya se han configurado conexiones S7, tambi√©n se copiar√°n. Todav√≠a debe
asignarse el interlocutor correspondiente a las conexiones de la estaci√≥n PC copiada.

Consulte tambi√©n
Configurar la redundancia S7 UA (P√°gina 1688)

Configurar la redundancia S7 UA
Referencia
Parametrizaci√≥n de servidores OPC UA redundantes en el grupo de par√°metros "Propiedades
> General > Redundancia S7 UA

Redundancia OPC UA transparente
En este grupo de par√°metros se configura la estaci√≥n PC como servidor OPC UA redundante
para el funcionamiento con la redundancia OPC UA transparente. Para ello se utiliza el
servidor OPC SIMATIC NET en su versi√≥n 8.1
Las estaciones PC redundantes asignadas a un cliente OPC UA forman parte de un grupo de
redundancia.

En este grupo de par√°metros, proceda del siguiente modo:
1. Seleccione la opci√≥n "Activar redundancia".
2. Introduzca la direcci√≥n IP del grupo de redundancia. Existen para ello las siguientes
posibilidades:
‚Äì Introducir la direcci√≥n IP directamente o bien aplicar o modificar la direcci√≥n IP
propuesta.
Elija esta opci√≥n cuando se cree un grupo de redundancia nuevo.
‚Äì Seleccionar el bot√≥n "Asignar...".
Elija esta opci√≥n para asignar el servidor OPC a un grupo de redundancia que ya est√©
creado.
Nota
Despu√©s de la entrada o asignaci√≥n, tenga en cuenta la tabla "Direcciones IP de los
dem√°s miembros del grupo de redundancia" al final del grupo de par√°metros. Ver√° qu√©
servidores OPC est√°n asignados al mismo grupo de redundancia.

1688

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Defina el puerto de redundancia para la comunicaci√≥n con el cliente OPC UA; dado el caso,
aplique el ajuste predeterminado.
4. Defina los par√°metros de los servidores para la comunicaci√≥n entre servidores.
5. Dado el caso, compruebe el certificado de autenticaci√≥n asignado al servidor OPC
mediante el bot√≥n "Visualizar...".

Par√°metros / √Åreas de entrada / Botones
‚óè Opci√≥n "Activar redundancia"
Al activar esta opci√≥n se habilita la posibilidad de parametrizaci√≥n para la funcionalidad de
servidor OPC UA.
‚óè Bot√≥n "Asignar..."
Se abre el cuadro de di√°logo en el que pueden seleccionarse grupos de redundancia
previamente creados.
‚óè Par√°metro "Direcci√≥n IP del grupo de redundancia"
Direcci√≥n IP virtual mediante la que el cliente OPC UA accede al servidor OPC UA
redundante (el grupo de redundancia).
Esta direcci√≥n IP virtual se define en el administrador de compensaci√≥n de carga de red
(NLB) para ambas estaciones PC. La direcci√≥n IP virtual se reproduce en las direcciones
IP reales del servidor OPC UA.
‚óè Par√°metro "Puerto de redundancia"
Puerto por el que se lleva a cabo la comunicaci√≥n con el cliente OPC UA.
Predeterminado: 4845
‚óè Par√°metro "Puerto servidor-a-servidor"
Puerto por el que se lleva a cabo la comunicaci√≥n para fines de sincronizaci√≥n con los
servidores OPC UA del grupo de redundancia.
Predeterminado: 4846
‚óè Par√°metro "Interfaz servidor-a-servidor"
Seleccione aqu√≠ la interfaz hacia la subred por la que se lleva a cabo la sincronizaci√≥n con
los servidores OPC UA en el grupo de redundancia.
‚óè √Årea de entrada "Certificado" / bot√≥n "Visualizar..."
STEP 7 genera autom√°ticamente un certificado que se transmite al cliente OPC UA al
establecer la conexi√≥n. El cliente OPC UA lo utiliza para la autenticaci√≥n en los procesos de
comunicaci√≥n subsiguientes.
El certificado tambi√©n se emplea para transferir los c√≥digos para la codificaci√≥n de los
datos.
El c√≥digo privado permanece en el servidor y se utiliza para la codificaci√≥n. A continuaci√≥n,
utilizando el c√≥digo p√∫blico correspondiente obtenido del servidor mediante el certificado,
el cliente puede descodificar los mensajes cifrados del servidor.
Aqu√≠ puede visualizar y comprobar el certificado v√°lido actualmente.
Observaci√≥n:
la visualizaci√≥n del certificado no detecta si ya se est√° visualizando un certificado. Cada vez
que se pulsa el bot√≥n "Visualizar..." se abre una nueva visualizaci√≥n de certificado.
‚óè √Årea de entrada "Certificado" / bot√≥n "Actualizar..."
Se ordena a STEP 7 que cree un certificado nuevo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1689

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Direcciones IP de los dem√°s miembros del grupo de redundancia
Visualizaci√≥n de los dem√°s miembros del grupo de redundancia. A un grupo de redundancia
pertenecen las estaciones PC que tienen asignada la misma "direcci√≥n IP del grupo de
redundancia".
Nota
N√∫mero m√°ximo de miembros en un grupo de redundancia
En la versi√≥n actual de STEP 7 V12 se soportan 2 servidores OPC UA dentro de un grupo de
redundancia.

Consulte tambi√©n
Servidor OPC UA redundante - Principios b√°sicos (P√°gina 1686)

Asignar grupo de redundancia S7 UA
Referencia
Parametrizaci√≥n de servidores OPC UA redundantes en el grupo de par√°metros "Propiedades
> General > Redundancia S7 UA > Seleccionar maestro de redundancia S7 UA

Asignar un grupo de redundancia S7 UA existente
La tabla muestra los grupos de redundancia disponibles y seleccionables en el proyecto de
STEP 7 junto con sus direcciones IP.
Siempre que se haya asignado una direcci√≥n IP nueva al servidor OPC actual, aparece la
entrada siguiente en sustituci√≥n de dicha asignaci√≥n:
‚óè "(grupo de redundancia propio <direcci√≥n IP>)"

Proceda del siguiente modo:
1. Seleccione el grupo de redundancia deseado;
2. Confirme el cuadro de di√°logo con el bot√≥n "Aceptar".
De este modo, la direcci√≥n IP del grupo de redundancia seleccionado se incorpora al grupo de
par√°metros "Redundancia S7 UA".

Consulte tambi√©n
Servidor OPC UA redundante - Principios b√°sicos (P√°gina 1686)

1690

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Avisos de PLC para servidor OPC
Servidor OPC SIMATIC NET: recomendaciones para la configuraci√≥n de avisos de CPU
Si configura avisos de PLC para un servidor OPC de una estaci√≥n PC, STEP 7 no comprobar√°
si est√°n configurados de forma coherente. Para conseguir que los avisos de PLC funcionen
correctamente, tenga en cuenta las siguientes recomendaciones:
‚óè Para recibir avisos configure por cada PLC una sola conexi√≥n S7 apta para alarmas.
‚óè Utilice un solo idioma para los textos de aviso en cada proyeccto. El uso de textos de aviso
en varios idiomas no es compatible.
‚óè No introduzca fuentes espec√≠ficas del usuario (texto adicional 1) en los avisos. Utilizando
las fuentes predeterminadas se garantiza la univocidad de los mensajes.

Editor para avisos de programa OPC
General
El editor para avisos de programa OPC est√° disponible a partir del servidor OPC V14. Le ayuda
a configurar avisos de programa OPC de una conexi√≥n S7 entre una estaci√≥n PC o servidor
OPC y un S7-1500/S7-1500S de forma que la representaci√≥n en la vista espec√≠fica del usuario
se corresponda con la topolog√≠a de la instalaci√≥n, por ejemplo. Es posible agregar, renombrar
o borrar √°reas, or√≠genes y condiciones en la vista espec√≠fica del usuario, adem√°s de
administrarlos en diferentes idiomas. La estructura y los nombres de los avisos de programa
OPC en la vista est√°ndar est√°n especificados por la estructura de √°rbol del proyecto de STEP
7. Los textos de los avisos de programa OPC se configuran en la configuraci√≥n de STEP 7 del
S7-1500/S7-1500S. La estructuraci√≥n creada de los avisos de programa OPC en la vista
espec√≠fica del usuario se muestra de forma id√©ntica en el cliente OPC UA con interfaz de
navegaci√≥n despu√©s de que haya compilado y cargado la configuraci√≥n de la estaci√≥n PC.

Vista est√°ndar
La vista est√°ndar muestra los avisos de programa OPC disponibles. Si el n√∫mero de avisos de
programa OPC es elevado se recomienda armonizar la configuraci√≥n del PLC con la de OPC
para facilitar la gesti√≥n.
Para ello es imprescindible que haya una conexi√≥n S7 en cuyas propiedades de OPC est√©n
activadas las casillas de verificaci√≥n "Mantener la conexi√≥n de forma permanente" y "Recibir
avisos de programa" ("Vista de redes" > ficha "Conexiones" > seleccionar "Conexi√≥n S7" >
ficha "General" > "OPC" > "Establecimiento de conexi√≥n" o "Avisos").
Nota
Si despu√©s de configurar el editor se desactivan en la conexi√≥n S7 las casillas "Mantener la
conexi√≥n de forma permanente" y "Recibir avisos de programa" en las propiedades de OPC,
en la vista est√°ndar no se mostrar√°n los avisos de programa OPC configurados hasta el
momento hasta que se vuelvan a activar las opciones.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1691

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Si no se configuran avisos de programa OPC en la vista espec√≠fica del usuario y se carga el
proyecto STEP 7 en la estaci√≥n PC, los avisos de programa OPC se mostrar√°n en el cliente
OPC UA iguales que en la estructura de √°rbol especificada en el proyecto STEP 7.

Vista espec√≠fica del usuario
En la vista espec√≠fica del usuario existe la posibilidad de estructurar los avisos de programa
OPC seg√∫n las necesidades. Mediante el men√∫ contextual de "S7OPTAREAS:" se definen las
√°reas y los or√≠genes seg√∫n la topolog√≠a de la instalaci√≥n y se insertan las condiciones en los
or√≠genes correspondientes.
Entre la vista est√°ndar y la vista espec√≠fica del usuario se muestra mediante s√≠mbolos de
flechas la asignaci√≥n gr√°fica de las condiciones. Cuando se selecciona una condici√≥n en la
vista espec√≠fica del usuario, se muestran el origen y el destino de la condici√≥n mediante el
s√≠mbolo de flecha. En funci√≥n del nodo que est√© seleccionado o de la expansi√≥n o contracci√≥n
de las estructuras de √°rbol, el s√≠mbolo de flecha cambia de posici√≥n. Si las estructuras de √°rbol
est√°n contra√≠das, los s√≠mbolos de flecha pueden visualizarse agrupados. Existen las
siguientes posibilidades para asignar gr√°ficamente las condiciones por medio de s√≠mbolos de
flecha:
‚óè Las estructuras de √°rbol est√°n completamente expandidas en las dos vistas. Al seleccionar
una condici√≥n se muestra la asignaci√≥n 1:1 directa entre el origen y el destino de la
condici√≥n.
‚óè El √°rea o el origen que contiene la condici√≥n est√° contra√≠da en la vista est√°ndar. Se
selecciona una condici√≥n (destino) en la vista espec√≠fica del usuario. El s√≠mbolo de flecha
apunta a la condici√≥n configurada (destino) de la vista espec√≠fica del usuario desde el √°rea
u origen de la vista est√°ndar.
‚óè El √°rea o el origen que contiene la condici√≥n configurada est√° contra√≠da en la vista
espec√≠fica del usuario. Se selecciona una condici√≥n (origen) en la vista est√°ndar. El s√≠mbolo
de flecha apunta a la condici√≥n (origen) de la vista est√°ndar desde el √°rea u origen de la
vista espec√≠fica del usuario.
‚óè Se selecciona una condici√≥n en la vista est√°ndar que no est√° configurada en la vista
espec√≠fica del usuario. No se muestra ning√∫n s√≠mbolo de flecha, pues no hay asignaciones
o no son posibles.
Una vez que ha configurado una condici√≥n en la vista espec√≠fica del usuario, esta se muestra
atenuada en la vista est√°ndar. Si se borra una condici√≥n en la vista espec√≠fica del usuario, esta
ya no se muestra atenuada en la vista est√°ndar y puede volver a emplearse en otro lugar de
la vista espec√≠fica del usuario.
Nota
Si se borran los avisos de programa OPC del S7-1500/S7-1500S, ya no se muestran en la vista
est√°ndar. En la vista espec√≠fica del usuario estos avisos de programa OPC est√°n marcados en
rojo y son incoherentes. Ya no es posible emplear los avisos de programa OPC incoherentes
y deben borrarse manualmente.

1692

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Todos los avisos de programa OPC configurados en el PLC que no se configuran en la vista
espec√≠fica del usuario se cargan igualmente en la estaci√≥n PC al realizar la carga. En el cliente
OPC UA, estos avisos de programa OPC no configurados en el editor est√°n incluidos en una
carpeta aparte. El nombre de esta carpeta es el mismo que el utilizado en la configuraci√≥n del
PLC.

Significado de los iconos utilizados
En el editor para avisos de programa OPC existen los iconos siguientes que se emplean para
representar √°reas, or√≠genes y condiciones en ambas vistas:

√Årea:
Cada nombre de estaci√≥n (p. ej. Estaci√≥n1), nombre de dispositivo (p. ej. Controlador1) y grupo
(p. ej. Grupo1) se muestra como un √°rea en la vista est√°ndar. La estructura de √°rbol resultante
viene dada por la estructura del proyecto STEP 7.
El √°rea debe crearse primero en la vista espec√≠fica del usuario, puesto que al principio no se
dispone de ninguna √°rea. Es posible definir varias √°reas.

Origen:
El origen en la vista est√°ndar est√° compuesta de nombre de estaci√≥n (p. ej. Estaci√≥n1), nombre
de dispositivo (p. ej. Controlador1) y el nombre simb√≥lico del bloque de datos del aviso PLC (p.
ej. Motor1).
Un origen debe agregarse a un √°rea en la vista espec√≠fica del usuario. Existe la posibilidad de
agregar varios or√≠genes a un √°rea.

Condici√≥n:
La condici√≥n en la vista est√°ndar est√° compuesta del nombre del aviso de programa OPC
configurado. Ejemplo: alarm_motor1
Las condiciones se desplazan por Drag & Drop de la vista est√°ndar al origen deseado dentro
de la vista espec√≠fica del usuario.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1693

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ficha "General"
En la ficha "General" se muestran las propiedades "Condici√≥n", "Severidad OPC" y "Tipo de
evento OPC" del aviso de programa OPC seleccionado. El campo de entrada "Condici√≥n" es
editable.

Ficha "General" > "Instancias de aviso OPC"
En la ficha "General" > "Instancias de aviso OPC" es posible ver en forma de tabla las
diferentes propiedades del aviso de programa OPC. Aqu√≠ estas propiedades son de solo
lectura y no pueden modificarse.
Se muestran las siguientes propiedades de los avisos de programa OPC:
‚óè Nombre
Indica el nombre del aviso de programa OPC.
‚óè ID
Indica la ID del aviso de programa OPC.
‚óè Nombre del PLC
Indica el nombre del S7-1500/S7-1500S en el que se han configurado los avisos de
programa OPC.
‚óè Texto de aviso
Indica los textos de aviso que se han configurado en el S7-1500/S7-1500S.
‚óè Condici√≥n
Indica el nombre de la condici√≥n.
‚óè Severidad OPC
Indica la severidad OPC del aviso de programa OPC.
‚óè √Årea
Indica el nombre del √°rea del aviso de programa OPC.

Cuadro de di√°logo "Idiomas y recursos"
En el cuadro de di√°logo "Idiomas y recursos" es posible ajustar el idioma de edici√≥n y de
referencia en todos los idiomas soportados por "STEP 7 Professional (TIA Portal)". De este
modo, existe la posibilidad de editar y guardar en alem√°n y, si seguidamente se cambia al
idioma ingl√©s, es posible cambiar el nombre de los avisos OPC a ingl√©s y guardarlos, por
ejemplo. Dependiendo del idioma ajustado, los nombres de los avisos de programa OPC
siempre se mostrar√°n en el idioma "correcto". Los nombres nuevos sin traducir de los avisos
de programa OPC en la vista espec√≠fica del usuario se muestran entre los caracteres "<" y ">".
En la vista est√°ndar se usan para todos los idiomas los mismos nombres, tal y como se ha
definido durante la configuraci√≥n en el PLC.
Es posible agregar m√°s idiomas del proyecto en "√Årbol del proyecto" > "Idiomas y recursos" >
"Idiomas del proyecto".
En "√Årbol del proyecto" > "Idiomas y recursos" > "Textos del proyecto" pueden visualizarse y
editarse todos los textos del proyecto, incluidos los textos de aviso de las condiciones, por

1694

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ejemplo. En la misma ventana de inspecci√≥n es posible importar textos del proyecto o exportar
los textos del proyecto seleccionados, en este caso condiciones.
Nota
Para traducir los nombres de los avisos de programa OPC a los diferentes idiomas se
recomienda utilizar la funci√≥n de importaci√≥n y exportaci√≥n descrita, que facilita el manejo.

Procedimiento t√≠pico durante el primer uso del editor
Proceda del siguiente modo:
1. Cree avisos de programa OPC en el S7-1500/S7-1500S para el proyecto de STEP 7. Para
la conexi√≥n S7 deben estar activadas las propiedades OPC "Mantener la conexi√≥n de
forma permanente" y "Recibir avisos de programa".
2. Abra el editor para los avisos de programa OPC haciendo doble clic en "Editor para avisos
de programa OPC" en la estructura del √°rbol del proyecto en el servidor OPC
correspondiente del proyecto de STEP 7.
3. Seleccione en la vista espec√≠fica del usuario el comando "Agregar nodo de √°rea" desde el
men√∫ contextual de "S7OPTAREAS:".
4. Asigne un nombre cualquiera al √°rea nueva (caracteres prohibidos: "\" y car√°cter de
control). Dependiendo de la topolog√≠a de la instalaci√≥n, existe la posibilidad de subordinar
al √°rea otras √°reas.
5. Seleccione el comando "Agregar origen" en el √°rea correspondiente del men√∫ contextual.
6. Asigne un nombre cualquiera al √°rea nueva (caracteres prohibidos: car√°cter de control).
7. Arrastre las condiciones por Drag & Drop de la vista est√°ndar al lugar deseado dentro de la
vista espec√≠fica de usuario.
8. Asigne un nombre cualquier a la condici√≥n (caracteres prohibidos: car√°cter de control).
9. En su caso, especifique en el cuadro de di√°logo "Idiomas y recursos" el idioma de edici√≥n
y referencia. Aseg√∫rese de que los nombres no traducidos se traduzcan entre par√©ntesis
angulares (<>).
10.Guarde y compile o cargue la configuraci√≥n nueva en la estaci√≥n PC y en el PLC.
11.Abra un cliente OPC UA que tenga una interfaz de navegaci√≥n.
12.Active y observe los avisos de programa OPC configurados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1695

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Si se selecciona un nodo ya creado, pueden utilizarse las teclas "x", "+" y "-" del bloque
num√©rico para acelerar la abertura y el cierre de la estructura de √°rbol subordinada.
‚óè Tecla de multiplicaci√≥n "x": abre toda la estructura de √°rbol subordinada del nodo
seleccionado.
‚óè Tecla de suma "+": abre solo el nodo seleccionado actualmente.
‚óè Tecla de resta "-": cierra toda la estructura de √°rbol subordinada del nodo seleccionado.
Esto funciona tanto en la vista est√°ndar como en la vista espec√≠fica del usuario.

Procedimiento t√≠pico durante el uso posterior del editor
1. Abra el editor para los avisos de programa OPC haciendo doble clic en "Editor para avisos
de programa OPC" en la estructura del √°rbol del proyecto en el servidor OPC
correspondiente del proyecto de STEP 7.
2. Analice la situaci√≥n real de la configuraci√≥n existente.
3. Decida los cambios que desea realizar en la configuraci√≥n.
4. Realice los cambios en correspondencia.
5. Guarde y compile o cargue la configuraci√≥n nueva en la estaci√≥n PC y en el PLC.
6. Abra un cliente OPC UA que tenga una interfaz de navegaci√≥n.
7. Active y observe los avisos de programa OPC configurados.

Comprobaci√≥n de la coherencia
La coherencia de la configuraci√≥n en el editor para avisos de programa OPC se comprueba
antes de cargarla en la estaci√≥n PC. Es posible que se emitan los siguientes errores y
advertencias de compilaci√≥n:
Error o advertencia de compilaci√≥n

Soluci√≥n

Error: Los avisos de programa OPC del PLC indicado est√°n
conectados a trav√©s de varias conexiones.

Los avisos de programa OPC solo deben estar conectados
a trav√©s de una conexi√≥n S7.

Error: La combinaci√≥n del origen y la condici√≥n indicados no es La combinaci√≥n de origen y condici√≥n debe configurarse de
un√≠voca en uno de los idiomas.
forma un√≠voca.
Error: El aviso de programa OPC en la ruta indicada contiene
caracteres no v√°lidos en el idioma indicado.

Solo deben utilizarse caracteres permitidos.

Error: El aviso de programa OPC en la ruta indicada contiene
como m√≠nimo un nodo de √°rea, un origen o una condici√≥n con
caracteres de c√≥digo ANSI no visibles en el idioma indicado.

Solo deben utilizarse caracteres permitidos.

Error: Para el aviso de programa OPC en la ruta indicada hay
como m√≠nimo un nodo de √°rea, un origen o una condici√≥n que
no est√° traducido al idioma indicado.

Deben existir todas las traducciones en los idiomas utiliza‚Äê
dos.

Error: El aviso de programa OPC en la ruta indicada ya no es
v√°lido porque no existe ninguna conexi√≥n S7 con propiedades
de alarma v√°lidas para el PLC indicado.

Debe crearse una conexi√≥n S7 correspondiente o bien el
aviso de programa OPC citado debe borrarse en la vista
espec√≠fica del usuario.

1696

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Error o advertencia de compilaci√≥n

Soluci√≥n

Error: El aviso de programa OPC en la ruta indicada ya no es
v√°lido porque la instancia del aviso PLC correspondiente ya no
existe.

El aviso de programa OPC citado debe borrarse en la vista
espec√≠fica del usuario.

Advertencia: El texto de aviso indicado no est√° traducido en el
idioma especificado.

El texto predefinido debe adaptarse al idioma especificado.

Advertencia: El aviso de programa OPC indicado en la ruta
especificada no est√° configurado en la vista espec√≠fica del
usuario, pero el servidor OPC utiliza como m√≠nimo un aviso de
programa OPC configurado en la vista espec√≠fica del usuario.

En su caso, configurar en la vista espec√≠fica del usuario el
aviso de programa OPC indicado en la advertencia.

Nota
Los errores de compilaci√≥n visualizados deben solucionarse antes de cargar la configuraci√≥n
en la estaci√≥n PC.
Dado el caso, es posible ignorar las advertencias de compilaci√≥n, es decir, la configuraci√≥n
puede cargarse en la estaci√≥n PC sin solucionar la advertencia.

Acceso a datos hist√≥ricos (Historical Access)
Requisitos
Los requisitos siguientes est√°n vinculados al uso de datos hist√≥ricos:
‚óè Es posible activar simult√°neamente como datos hist√≥ricos un m√°ximo de 1000 s√≠mbolos
mediante el servidor S7OPT y 1000 s√≠mbolos mediante el servidor OPC UA S7.
‚óè Solo los s√≠mbolos visibles pueden activarse como datos hist√≥ricos.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1697

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Solo los s√≠mbolos con derecho de acceso m√≠nimo de lectura (lectura o lectura/escritura)
pueden activarse como datos hist√≥ricos.
‚óè El acceso a datos hist√≥ricos solo es posible en los siguientes tipos de datos S7OPT y S7:

1698

Tipos de datos S7OPT

Tipo de datos OPC UA

BYTE

Byte

USINT

NByte

CHAR

SByte

SINT

SByte

WCHAR

UInt16

WORD

UInt16

UINT

UInt16

DWORD

UInt32

UDINT

UInt32

LWORD

UInt64

ULINT

UInt64

INT

Int16

DINT

Int32

LINT

Int64

REAL

Float

LREAL

Double

DATE_TIME

UtcTime

LDT

UtcTime

DTL

UtcTime

DATE

UtcTime

TIME

Int32

LTIME

Int64

TOD

UInt32

LTOD

UInt64

S5TIME

UInt16

BOOL

Boolean

STRING

String (UTF-8)

WSTRING

String (UTF-8)

TIMER

UInt16

COUNTER

UInt16

Tipos de datos S7 soportados

Tipo de datos OPC UA

BYTE

Byte

CHAR

SByte

WORD

UInt16

DWORD

UInt32

INT

Int16

DINT

Int32

REAL

Float

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tipos de datos S7 soportados

Tipo de datos OPC UA

DATE_TIME

UtcTime

DATE

UtcTime

TIME

Int32

TOD

UInt32

S5TIME

UInt16

BOOL

Boolean

STRING

String (UTF-8)

TIMER

UInt16

COUNTER

UInt16

Activaci√≥n de datos hist√≥ricos
Para poder activar datos hist√≥ricos hay que navegar hasta los s√≠mbolos configurados y poner
una marca de verificaci√≥n en la casilla "Activar acceso a datos hist√≥ricos".
Nota
En todos los s√≠mbolos, el acceso a datos hist√≥ricos est√° desactivado en el ajuste
predeterminado.

Utilizar datos hist√≥ricos en la configuraci√≥n de s√≠mbolos
Si en la tabla se selecciona una fila que contiene datos hist√≥ricos, en la columna "Datos
hist√≥ricos" se muestra el valor "True".
Si en la tabla se selecciona una fila que no contiene datos hist√≥ricos, en la columna "Datos
hist√≥ricos" se muestra el valor "False".
Si en la tabla se selecciona una fila que no contiene datos hist√≥ricos, pero uno de sus nodos
hijos s√≠ contiene datos hist√≥ricos, en la columna "Datos hist√≥ricos" se muestra el valor
"mixed(False)".
Si en la tabla se selecciona una fila que contiene datos hist√≥ricos, pero uno de sus nodos hijos
tiene desactivados los datos hist√≥ricos, en la columna "Datos hist√≥ricos" se muestra el valor
"mixed(True)".
En "N√∫mero de datos hist√≥ricos", en la parte izquierda de la configuraci√≥n de s√≠mbolos, se
muestra el n√∫mero de datos hist√≥ricos seleccionados.
Si la columna "Datos hist√≥ricos" de la tabla no se muestra ning√∫n valor, significa que el nodo
seleccionado no contiene datos hist√≥ricos que puedan activarse.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1699

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Importaci√≥n / exportaci√≥n CSV
Si los datos hist√≥ricos est√°n activados en la importaci√≥n / exportaci√≥n CSV, est√° disponible la
selecci√≥n siguiente en los derechos de acceso:
‚óè N
Ninguno
‚óè R
Solo acceso de lectura; datos hist√≥ricos no activados
‚óè HR
Acceso de lectura; datos hist√≥ricos activados
‚óè W
Solo acceso de escritura
‚óè RW
Acceso de lectura y escritura; datos hist√≥ricos no activados
‚óè HRW
Acceso de lectura y escritura; datos hist√≥ricos activados

1.4.4

Configuraciones para acoplamientos punto a punto (S7-1500)

1.4.4.1

Configuraciones para acoplamientos punto a punto

Introducci√≥n
Sinopsis de los m√≥dulos de comunicaciones
Los sistemas de automatizaci√≥n est√°n compuestos por los m√°s diversos componentes; entre
ellos, los m√≥dulos de comunicaci√≥n. La comunicaci√≥n serie mediante conexiones punto a
punto representa una opci√≥n sencilla de intercambio de datos.
Ajustando los par√°metros de comunicaci√≥n en el nivel inferior del modelo de capas OSI (ISO)
(consulte el cap√≠tulo Seguridad de la transmisi√≥n (P√°gina 1706)) es posible adaptarse a los
m√°s diversos interlocutores.
La comunicaci√≥n mediante acoplamiento punto a punto en S7-1500, ET 200MP y ET 200SP
se realiza exclusivamente a trav√©s de m√≥dulos de comunicaci√≥n (CM) con interfaces serie.
SIMATIC S7 ofrece una serie de m√≥dulos que, para esta finalidad, ponen a disposici√≥n la
interfaz f√≠sica y los mecanismos de protocolo fundamentales.
‚óè RS232: interfaz que puede coordinar la comunicaci√≥n entre los interlocutores mediante
se√±ales cualificadoras adicionales.
‚óè RS422/RS485: interfaz que permite l√≠neas m√°s largas utilizando tensiones diferenciales
como tecnolog√≠a de transmisi√≥n y que tambi√©n posibilita estructuras con m√°s de 2
dispositivos a trav√©s de hardware de bus (RS485).
Para transmitir los datos de la CPU a los m√≥dulos correspondientes, se dispone de
instrucciones que asumen la coordinaci√≥n entre la CPU y el CM (Communication module).

1700

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Comunican al programa de usuario si la transmisi√≥n se ha realizado con √©xito o si se han
recibido datos nuevos (en sistemas sin una CPU SIMATIC, el usuario debe programar √©l
mismo la funci√≥n de estas instrucciones).
En este manual de funciones se describe el funcionamiento y el uso de los m√≥dulos de
comunicaci√≥n PtP.

Sinopsis de los componentes y las referencias
Tabla sin√≥ptica de los m√≥dulos de comunicaci√≥n y su compatibilidad
M√≥dulo de comunicaci√≥n
CM PtP RS232 BA

S7-1500

ET 200MP

ET 200SP

X

CM PtP RS422/485 BA

X

X

‚Äë

6ES7540-1AB00-0AA0

CM PtP RS232 HF 2)

X

X

‚Äë

6ES7541-1AD00-0AB0

CM PtP RS422/485 HF

X

X

‚Äë

6ES7541-1AB00-0AB0

CM PtP (ET 200SP)

‚Äë

‚Äë

X

6ES7137-6AA00-0BA0

1)

BA = Basic

2)

HF = High Feature

‚Äë

Referencia

X

1)

6ES7540-1AD00-0AA0

Sinopsis de los componentes y las interfaces
Tabla sin√≥ptica de los m√≥dulos de comunicaci√≥n y sus funciones.
M√≥dulo de comunicaci√≥n

Interfaz

Protocolos
Freeport

CM PtP RS232 BA
CM PtP RS422/485 BA

RS232

Sistema de cone‚Äê
xi√≥n
3964(R)

Modbus
Master

Modbus
Slave

USS-Mas‚Äê
ter

Sub-D
9 polos

Sub-D
15 polos

X

X

-

-

X

X

-

RS422

X

X

-

-

X

-

X

RS485

X

-

-

-

X

-

X

CM PtP RS232 HF

RS232

X

X

X

X

X

X

-

CM PtP RS422/485 HF

RS422

X

X

X

X

X

-

X

RS485

X

-

X

X

X

-

X

CM PtP (ET 200SP)

RS232

X

X

X

X

X

RS422 2)

X

X

X

X

X

RS485

X

-

X

X

X

ET 200SP BaseU‚Äê
nit 1)

1) BaseUnit con bornes en lugar de Sub-D; asignaci√≥n seg√∫n la f√≠sica de transmisi√≥n
2) El m√≥dulo de comunicaci√≥n CM PtP tambi√©n se puede utilizar para acoplamiento multipunto en el modo RS422.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1701

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Sinopsis de los componentes y las velocidades de transferencia de datos
Los m√≥dulos de comunicaci√≥n pueden enviar y recibir datos con distintas velocidades de
transferencia de datos. La siguiente tabla muestra la asignaci√≥n a los m√≥dulos de
comunicaci√≥n individuales.
M√≥dulo de comunicaci√≥n

Velocidad de transferencia de datos en bits/s
300

600

1200

2400

9600

19200

38400

57600

76800

CM PtP RS232 BA

X

X

X

X

4800
X

X

X

-

-

-

115200

CM PtP RS422/485 BA

X

X

X

X

X

X

X

-

-

-

-

CM PtP RS232 HF

X

X

X

X

X

X

X

X

X

X

X

CM PtP RS422/485 HF

X

X

X

X

X

X

X

X

X

X

X

CM PtP (ET 200SP)

X

X

X

X

X

X

X

X

X

X

X

-

Sinopsis de los componentes y capacidades del b√∫fer de recepci√≥n
Cada m√≥dulo de comunicaci√≥n dispone de un b√∫fer para almacenar provisionalmente las
tramas recibidas. La siguiente tabla muestra la asignaci√≥n del tama√±o m√°ximo de una trama
individual, as√≠ como el tama√±o de la memoria de los m√≥dulos de comunicaci√≥n individuales.
M√≥dulo

Capacidad del b√∫fer de
recepci√≥n
kB

Longitud m√°xima de la
trama
kB

Tramas en b√∫‚Äê
fer

CM PtP RS232 BA

2

1

255

CM PtP RS422/485 BA

2

1

255

CM PtP RS232 HF

8

4

255

CM PtP RS422/485 HF

8

4

255

CM PtP (ET 200SP)

4

2

255

Se√±ales cualificadoras y control del flujo de datos
‚óè Control del flujo de datos de software con XON/XOFF
El control del flujo de datos con XON/XOFF es posible en el protocolo Freeport mediante las
interfaces RS232 y RS422.
‚óè Control del flujo de datos de hardware con RTS/CTS
El control del flujo de datos con RTS/CTS es posible en el protocolo Freeport mediante la
interfaz RS232.
‚óè Manejo autom√°tico de las se√±ales cualificadoras
Con los protocolos Freeport, maestro Modbus y esclavo Modbus es posible manejar las
se√±ales cualificadoras RS232 a trav√©s de la interfaz RS232. (Esta solo est√° disponible si
est√° activado el control de flujo del hardware.)

1702

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Protocolos de los m√≥dulos de comunicaci√≥n
En funci√≥n de los m√≥dulos de comunicaci√≥n empleados es posible establecer una conexi√≥n de
comunicaci√≥n con diferentes protocolos:
‚óè Freeport: transferencia de cadenas de caracteres ASCII sin un formato de protocolo
espec√≠fico
‚óè 3964(R): comunicaci√≥n entre aut√≥matas programables (comunicaci√≥n maestro-maestro)
‚óè Modbus RTU: comunicaci√≥n entre aut√≥matas programables (comunicaci√≥n maestroesclavo). El m√≥dulo de comunicaci√≥n puede ser tanto maestro como esclavo.
‚óè USS: comunicaci√≥n entre un aut√≥mata programable y un accionamiento (comunicaci√≥n
maestro-esclavo). La comunicaci√≥n est√° adaptada a las necesidades de la tecnolog√≠a de
accionamientos. El m√≥dulo de comunicaci√≥n solo puede ser maestro.

Sinopsis de las operaciones
Acoplamiento punto a punto
Existen varias posibilidades de interconexi√≥n en red para intercambiar datos entre dos o m√°s
interlocutores. El acoplamiento punto a punto entre dos interlocutores es el m√©todo m√°s
sencillo de intercambio de informaci√≥n.
El m√≥dulo de comunicaciones (CM) constituye la interfaz entre un aut√≥mata programable y un
interlocutor. En el acoplamiento punto a punto, la transferencia de datos se realiza en serie con
el m√≥dulo de comunicaciones.

Configuraci√≥n/parametrizaci√≥n
La configuraci√≥n del m√≥dulo de comunicaciones incluye la disposici√≥n del m√≥dulo de
comunicaciones en la configuraci√≥n de dispositivos de STEP 7 (TIA Portal), as√≠ como los
ajustes de los par√°metros espec√≠ficos de los protocolos en el cuadro de di√°logo de
propiedades del m√≥dulo de comunicaci√≥n (configuraci√≥n est√°tica).

Programaci√≥n
La programaci√≥n incluye la conexi√≥n inform√°tica del m√≥dulo de comunicaciones a la CPU
correspondiente a trav√©s del programa de usuario. La programaci√≥n del m√≥dulo de
comunicaci√≥n se realiza con STEP 7 (TIA Portal).
La comunicaci√≥n entre la CPU, el m√≥dulo de comunicaci√≥n y un interlocutor tiene lugar a trav√©s
de instrucciones. Para los sistemas de automatizaci√≥n S7-1500 y S7-1200 se dispone de una
serie de instrucciones que permiten iniciar y controlar la comunicaci√≥n en el programa de
usuario, as√≠ como modificar la configuraci√≥n durante el tiempo de ejecuci√≥n (configuraci√≥n
din√°mica).
Para m√°s informaci√≥n al respecto, consulteResumen de las instrucciones (P√°gina 1704) y la
Ayuda en pantalla de STEP 7 (TIA Portal).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1703

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Resumen de las instrucciones
Nota
Capacidad de la CPU
Las instrucciones punto a punto se comunican con los m√≥dulos de comunicaciones mediante
lectura o escritura de registros.
Por ello, al utilizar las instrucciones debe tenerse en cuenta la capacidad de lectura y escritura
de registros de la CPU correspondiente.
Si varias instrucciones de una CPU deben leer o escribir registros de forma simult√°nea, es
posible que el programa de usuario tenga que llamar las instrucciones con un desfase
temporal.

Resumen de instrucciones
En el m√≥dulo de comunicaciones se produce la conversi√≥n de los protocolos de transmisi√≥n.
A trav√©s del protocolo se adapta la interfaz del m√≥dulo de comunicaciones a la interfaz del
interlocutor.
La comunicaci√≥n entre la CPU, el m√≥dulo de comunicaciones y un interlocutor se desarrolla a
trav√©s de instrucciones especiales y los protocolos soportados por los m√≥dulos de
comunicaciones correspondientes.
Las instrucciones conforman la interfaz de software entre la CPU y el m√≥dulo de
comunicaciones. Deben llamarse c√≠clicamente desde el programa de usuario. Una transmisi√≥n
de datos tiene lugar a lo largo de varios ciclos.
Las instrucciones forman parte de STEP 7 (TIA Portal). Encontrar√° las instrucciones en la Task
Card "Instrucciones", en Comunicaci√≥n > Procesador de comunicaciones. Son aplicables a
todos los m√≥dulos de comunicaciones indicados, siempre que estos soporten la funci√≥n
deseada.
Tabla 1-107 Instrucciones para PaP

1704

Instrucci√≥n

Significado

Send_P2P

La instrucci√≥n Send_P2P permite enviar datos a un interlocutor.

Receive_P2P

La instrucci√≥n Receive_P2P permite recibir datos de un interlocutor.

Receive_Reset

La instrucci√≥n Receive_Reset permite borrar el b√∫fer de recepci√≥n del m√≥dulo
de comunicaci√≥n.

Port_Config

La instrucci√≥n Port_Config permite configurar par√°metros b√°sicos de la inter‚Äê
faz de forma din√°mica.

Send_Config

La instrucci√≥n Send_Config (parametrizaci√≥n de la transmisi√≥n) permite con‚Äê
figurar din√°micamente par√°metros de transmisi√≥n serie de un puerto.

Receive_Config

La instrucci√≥n Receive_Config (parametrizaci√≥n de la recepci√≥n) permite pa‚Äê
rametrizar din√°micamente par√°metros de recepci√≥n serie de un puerto.

P3964_Config

La instrucci√≥n P3964_Config (configuraci√≥n del protocolo) permite configurar
los par√°metros del procedimiento 3964(R) de forma din√°mica.

Signal_Get

La instrucci√≥n Signal_Get permite leer las se√±ales cualificadoras RS232.

Signal_Set

La instrucci√≥n Signal_Set permite activar las se√±ales cualificadoras RS232.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Instrucci√≥n

Significado

Get_Features

La instrucci√≥n Get_Features permite leer funciones avanzadas soportadas
por el m√≥dulo de comunicaciones.

Set_Features

La instrucci√≥n Set_Features permite activar funciones avanzadas soportadas
por el m√≥dulo de comunicaciones.

Tabla 1-108 Instrucciones para Modbus
Instrucci√≥n

Significado

Modbus_Master

La instrucci√≥n Modbus_Master permite comunicarse a trav√©s del puerto PtP
en calidad de maestro Modbus.

Modbus_Slave

La instrucci√≥n Modbus_Slave permite comunicarse a trav√©s del puerto PtP en
calidad de esclavo Modbus.

Modbus_Comm_Load

La instrucci√≥n Modbus_Comm_Load permite configurar el puerto del m√≥dulo
de comunicaci√≥n para Modbus RTU.

Tabla 1-109 Instrucciones para el USS
Instrucci√≥n

Significado

USS_Port_Scan

La instrucci√≥n USS_Port_Scan permite la comunicaci√≥n a trav√©s de la red
USS.

USS_Drive_Control

La instrucci√≥n USS_Drive_Control permite intercambiar datos con el accio‚Äê
namiento.

USS_Read_Param

La instrucci√≥n USS_Read_Param permite leer par√°metros del accionamien‚Äê
to.

USS_Write_Param

La instrucci√≥n USS_Write_Param permite modificar los par√°metros del ac‚Äê
cionamiento.

Fundamentos de la comunicaci√≥n serie
Transferencia de datos serie
En la transferencia de datos serie, los diferentes bits de un car√°cter correspondiente a la
informaci√≥n que desea transferirse se transmiten uno detr√°s de otro en un orden fijo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1705

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tr√°fico de datos bidireccional - Modo de operaci√≥n
En el m√≥dulo de comunicaciones, se distingue entre dos modos de operaci√≥n para el
intercambio de datos bidireccional:
‚óè Modo semid√∫plex
Los datos se transfieren alternativamente en ambas direcciones entre uno o m√°s
interlocutores. Modo semid√∫plex significa que en un momento determinado un interlocutor
env√≠a y el otro interlocutor recibe. Para ello se utiliza una l√≠nea que var√≠a de direcci√≥n para
la transmisi√≥n o la recepci√≥n.
‚óè Modo d√∫plex
Los datos se intercambian simult√°neamente entre uno o m√°s interlocutores, por lo que es
posible enviar y recibir al mismo tiempo. Para ello se necesita una l√≠nea para la transmisi√≥n
y una l√≠nea para la recepci√≥n.

Transferencia de datos as√≠ncrona
En los m√≥dulos de comunicaciones se realiza una transmisi√≥n de datos serie as√≠ncrona. El
proceso llamado sincronizaci√≥n con el modelo temporal (modelo temporal fijo para la
transmisi√≥n de una secuencia de caracteres determinada) solo se cumple durante la
transmisi√≥n de un car√°cter. Cada uno de los caracteres que debe transferirse va precedido de
un impulso de sincronizaci√≥n, tambi√©n llamado bit de arranque. La longitud de la transmisi√≥n
del bit de inicio determina la frecuencia. Uno o dos bits de parada establecen el fin de la
transferencia de caracteres.

Convenciones
Adem√°s del bit de arranque y del bit de parada, para una transferencia de datos serie se
requieren otras convenciones entre los interlocutores. Entre ellas se incluyen:
‚óè velocidad de transferencia de datos
‚óè criterios de inicio de trama y de fin (p. ej. tiempo de retardo de caracteres)
‚óè paridad
‚óè n√∫mero de bits de datos (7 u 8 bits/car√°cter)
‚óè n√∫mero de bits de parada (1 o 2)

Seguridad de la transmisi√≥n
La seguridad de la transmisi√≥n es muy importante en el proceso de transferencia de datos y
para la selecci√≥n del m√©todo de transmisi√≥n. Por norma general puede decirse que cuantas
m√°s capas del modelo de referencia se ejecuten, mayor ser√° la seguridad de la transmisi√≥n.

1706

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Clasificaci√≥n de los protocolos existentes
La clasificaci√≥n de los protocolos existentes del m√≥dulo de comunicaciones en el modelo de
referencia puede consultarse en la siguiente figura.
&DSDGHWUDQVSRUWH

0RGEXV866

&DSD

/DFDSDGHWUDQVSRUWHHVHOSXQWRGH
XQL¬µQHQWUHODVFDSDVRULHQWDGDVDO
WUDQVSRUWH\ODVFDSDVRULHQWDGDVDOD
DSOLFDFL¬µQ$TX¬ØVHDVLJQDQORVSDTXHWHV
GHGDWRVDXQDDSOLFDFL¬µQ
1LYHOGHWUDQVPLVL¬µQ
1RH[LVWHSXHVHVXQ
DFRSODPLHQWRSXQWRDSXQWRSXUR

&DSD

&DSDGHVHJXULGDG

&DSD

Figura 1-74

 5

7UDQVIHUHQFLDGHORVE\WHVGHGDWRVFRQ
 5 /RVFDUDFWHUHVGHLQLFLR\ILQ
VHDJUHJDQHQFDVRGHHUURUHVVH
UHSLWHODWUDQVIHUHQFLDGDGRHOFDVR

&DSDGHDSOLFDFL¬µQ
'HILQLFL¬µQGHODWUDQVIHUHQFLD
I¬ØVLFDGHORVE\WHVGHGDWRV

)UHHSRUW

&DSD

Catalogaci√≥n de los protocolos existentes del m√≥dulo de comunicaciones en el modelo de
referencia

Seguridad de la transmisi√≥n con Freeport
Seguridad de la transmisi√≥n en caso de utilizar Freeport:
‚óè Dado que, en el transporte de datos con Freeport, aparte del bit de paridad no se aplica
ninguna otra medida para la protecci√≥n de los datos, la transferencia de datos con Freeport
resulta muy eficaz en lo que respecta al flujo de datos, pero la seguridad del transporte de
los datos es nula. Parametrizando las condiciones de inicio y fin de trama es posible
conseguir cierta seguridad de los datos.
‚óè Mediante el uso del bit de paridad se garantiza la inversi√≥n de un bit en un car√°cter que debe
transmitirse. Si se invierten dos o m√°s bits de un car√°cter, ya no se podr√° garantizar que el
fallo se detecte.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1707

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Si fuera necesario aumentar la seguridad de la transmisi√≥n, puede hacerse introduciendo
una suma de verificaci√≥n, indicando la longitud de una trama o mediante condiciones de fin
parametrizables. Estas medidas debe realizarlas el usuario.
‚óè Otra forma de aumentar la seguridad de los datos consiste en introducir tramas de acuse
en las tramas de transmisi√≥n y recepci√≥n. Esto ya ocurre en los protocolos de comunicaci√≥n
de datos de alto nivel (v√©ase el modelo de referencia OSI de 7 capas).

Seguridad de la transmisi√≥n con 3964(R)
El bit de paridad sirve para aumentar la seguridad de los datos; complementa el n√∫mero de bits
de datos transferidos a un n√∫mero par o impar seg√∫n sea la parametrizaci√≥n.
Mediante el uso del bit de paridad se garantiza la inversi√≥n de un bit en un car√°cter que debe
transmitirse. Si se invierten dos o m√°s bits de un car√°cter, los fallos ya no podr√°n detectarse
con seguridad.
Paridad "ninguna" indica que no se transmite ning√∫n bit de paridad. Esto reduce la seguridad
de la transmisi√≥n.
Dependiendo de si se desea transmitir los datos con o sin car√°cter de control de bloque, se
distingue entre:
‚óè Transferencia de datos sin car√°cter de control de bloque: 3964
La seguridad de la transmisi√≥n se consigue mediante establecimiento y desconexi√≥n fijos
de las tramas, as√≠ como con repeticiones de las mismas.
‚óè Transferencia de datos con car√°cter de control de bloque: 3964R
La elevada seguridad de transmisi√≥n se consigue mediante establecimiento y desconexi√≥n
fijos de las tramas, repeticiones de los mismos as√≠ como la inclusi√≥n del car√°cter de control
de bloque (BCC).
En las descripciones e indicaciones que se refieren a ambos m√©todos de transferencia de
datos se utiliza en este manual la denominaci√≥n 3964(R).

Seguridad de la transmisi√≥n con Modbus y USS
El bit de paridad sirve para aumentar la seguridad de la transmisi√≥n; complementa el n√∫mero
de bits de datos transferidos a un n√∫mero par o impar seg√∫n sea la parametrizaci√≥n.
Mediante el uso del bit de paridad se garantiza la inversi√≥n de un bit en un car√°cter que debe
transmitirse. Si se invierten dos o m√°s bits de un car√°cter, el fallo ya no podr√° detectarse con
seguridad.
Paridad "ninguna" indica que no se transmite ning√∫n bit de paridad. Esto reduce la seguridad
de la transmisi√≥n.
En el caso de Modbus se utiliza adem√°s el control c√≠clico de redundancia (CRC: cyclic
redundancy check). Antes de la transferencia de datos se a√±ade redundancia adicional, en
forma de un valor denominado valor CRC, para cada bloque de datos de usuario. Se trata de
un valor de ensayo calculado seg√∫n un procedimiento determinado, con el cual se pueden
detectar posibles errores producidos durante la transmisi√≥n.
Con USS se utiliza adem√°s un car√°cter de control de bloque BCC (block check character).
Durante la recepci√≥n se forma el car√°cter de control de bloque y, tras la lectura de toda la
trama, se compara con el BCC recibido. Si no coinciden, no se eval√∫a la trama. (Si un car√°cter

1708

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
se transmite incorrectamente, se detectar√° un fallo con seguridad. Si se ha transmitido
err√≥neamente un n√∫mero par a un car√°cter, ya no se podr√° detectar un fallo con seguridad.)

Modo RS232
El modo RS232 es compatible con los siguientes m√≥dulos de comunicaciones:
‚óè CM PtP RS232 BA
‚óè CM PtP RS232 HF
‚óè CM PtP (ET 200SP)
En el modo RS232, la transmisi√≥n de datos se realiza a trav√©s de dos l√≠neas. Una de las l√≠neas
est√° disponible para la transmisi√≥n y la otra para la recepci√≥n. Es posible enviar y recibir al
mismo tiempo (d√∫plex).

Se√±ales RS232
Cuando se emplea la f√≠sica RS232, en el m√≥dulo de comunicaciones existen otras se√±ales
RS232 adem√°s de las se√±ales TXD, RXD y GND:
TXD

Salida

RXD

Entrada

Datos enviados (Transmitted Data);
Interfaz env√≠a
Datos recibidos (Received Data);
Interfaz recibe

GND

Tierra funcional (Ground);
Libre de potencial

DCD

Entrada

Nivel de se√±al de recepci√≥n (Data Carrier detect);
Se√±al portadora en caso de conexi√≥n de un m√≥dem. El interlocutor se√±aliza que
ha detectado datos entrantes.

DTR

Salida

Terminal listo (Data terminal ready);
DTR en "ON": m√≥dulo de comunicaciones encendido y listo para entrar en
funcionamiento
DTR en "OFF": m√≥dulo de comunicaciones apagado y no listo para entrar en
funcionamiento

DSR

Entrada

Disponibilidad para el funcionamiento (Data set ready);
DSR en "ON": el interlocutor se√±aliza que est√° listo para entrar en funciona‚Äê
miento
DSR en "OFF": interlocutor apagado y no listo para entrar en funcionamiento

RTS

Salida

Activar secci√≥n de transmisi√≥n (Request to send);
RTS en "ON": m√≥dulo de comunicaciones preparado para enviar; se√±aliza al
interlocutor que hay datos listos para ser enviados.
RTS en "OFF": m√≥dulo de comunicaciones no preparado para enviar

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1709

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
CTS

Entrada

Disponibilidad de env√≠o (Clear to send);
El interlocutor puede recibir datos del m√≥dulo de comunicaciones (respuesta a
RTS = ON del m√≥dulo de comunicaciones)
CTS en "ON": se√±aliza al interlocutor la disponibilidad de recepci√≥n
CTS en "OFF": se√±aliza al interlocutor la no disponibilidad de recepci√≥n

RI

Entrada

Llamada entrante en caso de conexi√≥n de un m√≥dem (Ring Indicator)

Tras conectar el m√≥dulo de comunicaciones las se√±ales de salida est√°n en estado OFF
(inactivas).
La operaci√≥n de las se√±ales de control DTR/DSR y RTS/CTS puede parametrizarse en la
interfaz del m√≥dulo de comunicaciones.
No es posible influir en las se√±ales RS232 cuando:
‚óè se ha parametrizado el control del flujo de datos "RTS de HW con protoc. intercambio"
(equivale al manejo autom√°tico de las se√±ales cualificadoras)
‚óè se ha parametrizado el control del flujo de datos "RTS de HW siempre ON"
(equivale al control del flujo de hardware con RTS/CTS)
‚óè se ha parametrizado el control del flujo de datos "RTS de HW siempre ON, ignorar DTR/
DSR"
Consulte tambi√©n el cap√≠tulo Procedimiento Handshake (P√°gina 1718).

Cables de conexi√≥n
Para establecer una conexi√≥n con un interlocutor que tambi√©n disponga de un conector macho
Sub-D de 9 polos, est√°n disponibles los siguientes cables de conexi√≥n est√°ndar de distintas
longitudes:
Referencia

6ES7902-1AB00-0AA0

Nombre del
tipo de producto
Longitud de cable

1710

6ES7902-1AC00-0AA0

6ES7902-1AD00-0AA0

Cable de conexi√≥n S7 RS232
5m

10 m

15 m

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En la siguiente tabla encontrar√° la ocupaci√≥n de pines del conector macho sub-D de 9 pines
del correspondiente m√≥dulo de comunicaci√≥n.
Conector macho*












Pin

Denominaci√≥n

Entrada/
Salida

Necesario/opcional en caso
de confecci√≥n propia

1

DCD

Entrada

Opcional

2

RXD

Entrada

Necesario

3

TXD

Salida

Necesario

4

DTR

Salida

Opcional

5

GND

‚Äî

Necesario

6

DSR

Entrada

Opcional

7

RTS

Salida

Opcional

8

CTS

Entrada

Opcional

9

RI

Entrada

Opcional

* Vista frontal

El conductor o el conector de los cables de conexi√≥n mencionados no est√°n disponibles como
art√≠culos individuales. Si confecciona los cables personalmente, debe recordar que es posible
que las entradas no cableadas del interlocutor tengan que estar conectadas en potencial de
reposo.
Recuerde que solo puede utilizar cajas de conector apantalladas. Una gran superficie de la
pantalla del cable debe estar en contacto por ambos lados con la caja del conector.
PRECAUCI√ìN
No conectar la pantalla del cable con GND en ning√∫n caso
No conecte nunca la pantalla del cable con GND, ya que las interfaces podr√≠an resultar
da√±adas. GND (pin 5) debe estar conectado siempre por ambos lados, ya que en caso
contrario los m√≥dulos de interfaz podr√≠an resultar da√±ados.
La siguiente figura representa los cables de conexi√≥n para un acoplamiento punto a punto
entre un m√≥dulo de comunicaci√≥n y un interlocutor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1711

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
0¬µGXORGHFRPXQLFDFLRQHV

5HFHSWRU

,QWHUORFXWRU

(PLVRU


5;'

7;'

(PLVRU

5HFHSWRU


7;'

5;'



576

&76



&76

576



&65

'75



'75

'65



*1'

*1'

3DQWDOODGHFDMD

7LSRGHFDEOH
/,<&<[

3DQWDOODGHFDMD

Modo RS422
El modo RS422 es soportado por los siguientes m√≥dulos de comunicaciones:
‚óè CM PtP RS422/485 BA
‚óè CM PtP RS422/485 HF
‚óè CM PtP (ET 200SP)
En el modo de operaci√≥n RS422, la transmisi√≥n de datos se realiza a trav√©s de dos parejas de
hilos (modo a cuatro hilos). Una de las parejas est√° disponible para la transmisi√≥n y la otra para
la recepci√≥n. Es posible enviar y recibir al mismo tiempo (d√∫plex).
Cada interlocutor debe poder utilizar simult√°neamente una direcci√≥n de transmisi√≥n y
recepci√≥n.

1712

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los datos pueden intercambiarse simult√°neamente entre dos o m√°s interlocutores. En el modo
multipunto RS422 solo debe enviarse un esclavo en un instante concreto.

Modos de operaci√≥n de la interfaz
En la tabla siguiente se muestran los modos de operaci√≥n de la interfaz para m√≥dulos de
comunicaciones y protocolos en general.
El m√≥dulo de comunicaciones puede emplearse en el modo RS422 en las siguientes
topolog√≠as:
‚óè Acoplamiento entre dos dispositivos: acoplamiento punto a punto
‚óè Acoplamiento entre varios dispositivos: acoplamiento multipunto
(solo disponible con CM PtP (ET 200SP))
Modo de operaci√≥n

Descripci√≥n

D√∫plex (RS422) modo a 4 hilos
(acoplamiento punto a punto)

En este modo de operaci√≥n, ambos dispositivos tienen los mis‚Äê
mos derechos.

D√∫plex (RS422) modo a 4 hilos
(maestro multipunto)

El m√≥dulo de comunicaciones puede emplearse como maestro
multipunto.

D√∫plex (RS422) modo a 4 hilos
(esclavo multipunto)

El m√≥dulo de comunicaciones puede emplearse como esclavo
multipunto.

En una topolog√≠a maestro/esclavo multipunto en modo RS422 se aplica lo siguiente:
‚óè El emisor del maestro se interconecta con los receptores de todos los esclavos.
‚óè Los emisores de los esclavos se interconectan con el receptor del maestro.
‚óè El estado inicial (asignaci√≥n predeterminada) solo se produce en el receptor del maestro y
en el receptor de un esclavo. Todos los dem√°s esclavos trabajan sin asignaci√≥n previa.

Se√±ales RS422
Cuando se emplea la f√≠sica RS422, en el m√≥dulo de comunicaci√≥n existen las siguientes
se√±ales:
T (A) -

Salida

Datos enviados (Transmitted Data)

T (B) +

Salida

Datos enviados (Transmitted Data)

R (A) -

Entrada

Datos recibidos (Received Data)

R (B) +

Entrada

Datos recibidos (Received Data)

GND

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Tierra funcional (Ground); libre de potencial

1713

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Cables de conexi√≥n
Para establecer una conexi√≥n con un interlocutor que tambi√©n disponga de un conector
hembra Sub-D de 15 polos est√°n disponibles los siguientes cables de conexi√≥n est√°ndar de
distintas longitudes:
Referencia

6ES7902-3AB00-0AA0

Nombre del
tipo de producto

6ES7902-3AC00-0AA0

6ES7902-3AG00-0AA0

Cable de conexi√≥n S7 RS422

Longitud de cable

5m

10 m

50 m

En la tabla siguiente encontrar√° la asignaci√≥n de pines del conector hembra Sub-D de 15 polos
del correspondiente m√≥dulo de comunicaci√≥n.
Conector hembra*


















Pin

Denominaci√≥n

Entrada/Salida

1

-

-

2

T (A) -

Salida

3

-

-

4

R (A) -

Entrada

5

-

-

6

-

-

7

-

-

8

GND

-

9

T (B) +

Salida

10

-

-

11

R (B) +

Entrada

12

-

-

13

-

-

14

-

-

15

-

-

* Vista frontal

El conductor o el conector de los cables de conexi√≥n mencionados no est√°n disponibles como
art√≠culos individuales. Si confecciona los cables personalmente, debe recordar que es posible
que las entradas no cableadas del interlocutor tengan que estar conectadas en potencial de
reposo.
Recuerde que solo puede utilizar cajas de conector apantalladas. Una gran superficie de la
pantalla del cable debe estar en contacto por ambos lados con la caja del conector.
PRECAUCI√ìN
No conectar la pantalla del cable con GND en ning√∫n caso
No conecte nunca la pantalla del cable con GND, ya que las interfaces podr√≠an resultar
da√±adas. GND (pin 8) debe estar conectado siempre por ambos lados, ya que en caso
contrario los m√≥dulos de interfaz podr√≠an resultar da√±ados.
La siguiente figura representa los cables de conexi√≥n para un acoplamiento punto a punto
entre un m√≥dulo de comunicaci√≥n y un interlocutor.

1714

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
0¬µGXORGHFRPXQLFDFLRQHV

(PLVRU



7 $



5 $



7 %



5 %



5 $



7 $

5 %

 7 %


5HFHSWRU





*1'

*1'

,QWHUORFXWRU



5HFHSWRU

(PLVRU

3DQWDOOD
3DQWDOODGHFDMD



7LSRGHFDEOH
3DQWDOODGHFDMD
/,<&<[[
7 $ 7 % XQG5 $ 5 %
WUHQ]DGRSRUSDUHV

&RQORQJLWXGHVGHFDEOHVXSHULRUHVDPGHEHU¬£VROGDUXQDUHVLVWHQFLD
WHUPLQDOGHDSUR[‡¥µHQHOODGRGHOUHFHSWRUSDUDJDUDQWL]DUXQWU¬£ILFRGH
GDWRVVLQDQRPDO¬ØDV

Nota
Con el tipo de cable utilizado pueden aplicarse las siguientes longitudes para un m√≥dulo de
comunicaci√≥n como interlocutor: m√°x. 1200 m a 19200 baudios, m√°x. 500 m a 38400 baudios,
m√°x. 250 m a 115200 baudios.

Modo RS485
El modo RS485 es soportado por los siguientes m√≥dulos de comunicaciones:
‚óè CM PtP RS422/485 BA
‚óè CM PtP RS422/485 HF
‚óè CM PtP (ET 200SP)
En el modo RS485, la transferencia de datos se realiza a trav√©s de una pareja de hilos (modo
a dos hilos). La pareja de hilos est√° disponible para la transmisi√≥n y la recepci√≥n de forma
alternativa. Es posible o enviar o recibir (semid√∫plex). Tras una transmisi√≥n se conmuta
inmediatamente a la recepci√≥n (disponibilidad de recepci√≥n). En cuanto llega otra petici√≥n de
transmisi√≥n, se conmuta de nuevo a transmisi√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1715

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Modos de operaci√≥n de la interfaz
En la tabla siguiente se muestran los modos de operaci√≥n de la interfaz para m√≥dulos de
comunicaciones y protocolos en general.
Modo de operaci√≥n

Descripci√≥n

Semid√∫plex (RS485) modo a Modo de operaci√≥n para acoplamiento punto a punto o acoplamiento
2 hilos
multipunto (Multipoint) en modo a dos hilos. El m√≥dulo de comunicacio‚Äê
nes puede ser tanto maestro como esclavo.

Si se utiliza Freeport en modo RS485 (semid√∫plex, modo a dos hilos), hay que procurar en el
programa de usuario que nunca env√≠e m√°s de un dispositivo a la vez. Si se realizan
transmisiones simult√°neas, las tramas se falsifican.
En el caso de Modbus, est√° garantizado autom√°ticamente que nunca se env√≠e m√°s de un
dispositivo a la vez.

Tiempos de conmutaci√≥n para el m√≥dulo de comunicaciones RS485 en modo semid√∫plex
El tiempo de conmutaci√≥n m√°ximo entre la transmisi√≥n y la recepci√≥n es de 0,1 ms.

Se√±ales RS485
Cuando se emplea la f√≠sica RS485, en el m√≥dulo de comunicaci√≥n existen las siguientes
se√±ales:
R (A)/T (A) -

Entrada/Salida

Datos recibidos/datos enviados (Received/Transmitted Da‚Äê
ta)

R (B)/T (B) +

Entrada/Salida

Datos recibidos/datos enviados (Received/Transmitted Da‚Äê
ta)

GND

1716

Tierra funcional (Ground); libre de potencial

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Cables de conexi√≥n
En la tabla siguiente encontrar√° la asignaci√≥n de pines del conector hembra Sub-D de 15 polos
del correspondiente m√≥dulo de comunicaci√≥n.
Conector hembra*


















Pin

Denominaci√≥n

Entrada/Salida

1

-

-

2

-

-

3

-

-

4

R (A)/T (A) -

Entrada/salida

5

-

-

6

-

-

7

-

-

8

GND

-

9

-

-

10

-

-

11

R (B)/T (B) +

Entrada/salida

12

-

-

13

-

-

14

-

-

15

-

-

* Vista frontal

Al confeccionar los cables, recuerde que es posible que las entradas no cableadas del
interlocutor tengan que estar conectadas en potencial de reposo.
Recuerde que solo puede utilizar cajas de conector apantalladas. Una gran superficie de la
pantalla del cable debe estar en contacto por ambos lados con la caja del conector.
PRECAUCI√ìN
No conectar la pantalla del cable con GND en ning√∫n caso
No conecte nunca la pantalla del cable con GND, ya que las interfaces podr√≠an resultar
da√±adas. GND (pin 8) debe estar conectado siempre por ambos lados, ya que en caso
contrario los m√≥dulos de interfaz podr√≠an resultar da√±ados.
La siguiente figura representa los cables de conexi√≥n para un acoplamiento punto a punto
entre un m√≥dulo de comunicaci√≥n y un interlocutor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1717

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
,QWHUORFXWRU

0¬µGXORGHFRPXQLFDFLRQHV

(PLVRU

(PLVRU

5 $ 7 $ 




5 % 7 % 
5HFHSWRU

*1'

5HFHSWRU

3DQWDOOD
3DQWDOODGHFDMD



7LSRGHFDEOH
/,<&<[
5 $ 5 % WUHQ]DGR

3DQWDOODGHFDMD

&RQORQJLWXGHVGHFDEOHVXSHULRUHVDPGHEHU¬£VROGDUXQDUHVLVWHQFLD
WHUPLQDOGHDSUR[‡¥µHQHOODGRGHOUHFHSWRUSDUDJDUDQWL]DUXQWU¬£ILFRGH
GDWRVVLQDQRPDO¬ØDV

Procedimiento Handshake
Introducci√≥n
Los procedimientos handshake controlan el flujo de datos entre dos interlocutores. Con el uso
de procedimientos handshake se impide que se pierdan datos durante la transmisi√≥n entre
dispositivos que trabajan a diferentes velocidades.
B√°sicamente se distinguen los procedimientos siguientes:
Tabla 1-110 Sinopsis de los procedimientos y las interfaces
Procedimiento

1718

RS232

RS422

RS485

Control del flujo de datos de software XON/XOFF

X

X

‚Äë

Control del flujo de datos de hardware RTS/CTS

X

‚Äë

‚Äë

Manejo autom√°tico de las se√±ales cualificadoras

X

‚Äë

‚Äë

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Control del flujo de datos de software
El control del flujo de datos de software en el m√≥dulo de comunicaciones se desarrolla del
siguiente modo:
‚óè XON/XOFF
‚Äì En cuanto el m√≥dulo de comunicaciones entra por parametrizaci√≥n en el modo de
operaci√≥n "XON/XOFF", env√≠a el car√°cter XON y permite as√≠ que el interlocutor env√≠e.
‚Äì Cuando se alcanza el n√∫mero m√°ximo de tramas parametrizado o bien 16 caracteres
antes de que el b√∫fer de recepci√≥n se desborde, el m√≥dulo de comunicaciones env√≠a el
car√°cter XOFF y pide as√≠ al interlocutor que interrumpa la transmisi√≥n. Si a pesar de ello
el interlocutor contin√∫a enviando, se genera un mensaje de error cuando el b√∫fer de
recepci√≥n se desborda. Los datos recibidos de la √∫ltima trama se rechazan.
‚Äì En cuanto la CPU recoge una trama y el b√∫fer de recepci√≥n vuelve a estar listo para la
recepci√≥n, el m√≥dulo de comunicaciones env√≠a el car√°cter XON.
‚Äì Si el m√≥dulo de comunicaciones recibe el car√°cter XOFF durante una transmisi√≥n,
interrumpe la transmisi√≥n hasta que recibe de nuevo un XON del interlocutor. Si
transcurrido un tiempo determinado parametrizable no se recibe ning√∫n car√°cter XON,
el proceso de transmisi√≥n se cancela y se genera el correspondiente mensaje de error.
Nota
Los caracteres para XON y XOFF pueden parametrizarse (cualquier car√°cter ASCII).
Al parametrizar el control del flujo de datos de software XON/XOFF, los datos de usuario
no pueden contener ninguno de los caracteres XON o XOFF parametrizados.

Control del flujo de datos de hardware
Nota
Con la parametrizaci√≥n "RTS de HW siempre ON, ignorar DTR/DSR", las se√±ales DTR/DSR
no tienen que estar cableadas.
Con la parametrizaci√≥n "RTS de HW siempre ON" es necesario cablear por completo las
se√±ales de interfaz utilizadas. Aseg√∫rese de que la RTS local (out) est√© conectada con la CTS
(in) del interlocutor y la CTS local con la RTS del interlocutor. En correspondencia, la DTR local
debe estar conectada con la DSR del interlocutor y la DSR local con la DTR del interlocutor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1719

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

576&76
&76576
'65'75
'75'65

Figura 1-75

1720

Cableado de las se√±ales de interfaz

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè RTS de HW siempre ON, ignorar DTR/DSR
‚Äì En cuanto el m√≥dulo de comunicaciones entra por parametrizaci√≥n en un modo de
operaci√≥n con "RTS de HW siempre ON", indica su disponibilidad al interlocutor
mediante RTS = ON.
‚Äì Cuando se alcanza el n√∫mero m√°ximo de tramas parametrizado o bien 16 caracteres
antes de que el b√∫fer de recepci√≥n se desborde, RTS se pone a OFF.
Si a pesar de ello el interlocutor contin√∫a enviando, se genera un mensaje de error
cuando el b√∫fer de recepci√≥n se desborda. Los datos recibidos de la √∫ltima trama se
rechazan.
‚Äì En cuanto la CPU recoge una trama y el b√∫fer de recepci√≥n vuelve a estar preparado
para la recepci√≥n, RTS se pone de nuevo a ON.
‚Äì Si se produce un cambio de CTS a OFF durante la transmisi√≥n, el m√≥dulo de
comunicaciones interrumpe el proceso de transmisi√≥n hasta que CTS vuelve a ponerse
a ON. Si transcurrido un tiempo parametrizable CTS no vuelve a ponerse a ON, el
proceso de transmisi√≥n se cancela y se genera el correspondiente mensaje de error.
‚óè RTS de HW siempre ON
El modo de operaci√≥n "RTS de HW siempre ON" es equivalente al modo de operaci√≥n "RTS
de HW siempre ON, ignorar DTR/DSR", aunque hay que cablear adicionalmente DTR y
DSR.
‚Äì En cuanto el m√≥dulo de comunicaciones entra por parametrizaci√≥n en un modo de
operaci√≥n con "RTS de HW siempre ON", indica por lo general su disponibilidad al
interlocutor poniendo DTR = ON y RTS = ON.
‚Äì Cuando se alcanza el n√∫mero m√°ximo de tramas parametrizado o bien 16 caracteres
antes de que el b√∫fer de recepci√≥n se desborde, RTS se pone a OFF.
Si a pesar de ello el interlocutor contin√∫a enviando, se genera un mensaje de error
cuando el b√∫fer de recepci√≥n se desborda. Los datos recibidos de la √∫ltima trama se
rechazan.
‚Äì En cuanto la CPU recoge una trama y el b√∫fer de recepci√≥n vuelve a estar preparado
para la recepci√≥n, RTS se pone de nuevo a ON.
‚Äì Si se produce un cambio de CTS a OFF durante la transmisi√≥n, el m√≥dulo de
comunicaciones interrumpe el proceso de transmisi√≥n hasta que CTS vuelve a ponerse
a ON. Si transcurrido un tiempo parametrizable CTS no vuelve a ponerse a ON, el
proceso de transmisi√≥n se cancela y se genera el correspondiente mensaje de error.
‚Äì Con un cambio de DSR = ON a OFF, una petici√≥n de transmisi√≥n en curso se cancela
con un mensaje de error.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1721

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Manejo autom√°tico de las se√±ales cualificadoras
‚óè HW RTS siempre activado
La realizaci√≥n de "RTS de HW con protoc. intercambio" en el m√≥dulo de comunicaciones se
desarrolla del siguiente modo:
‚Äì En cuanto el m√≥dulo de comunicaciones entra por parametrizaci√≥n en el modo de
operaci√≥n con "RTS de HW con protoc. intercambio", pone las l√≠neas RTS a OFF y DTR
a ON (m√≥dulo de comunicaciones operativo).
Solo es posible enviar tramas tras poner la l√≠nea DSR a ON. Mientras DSR permanezca
en OFF, no se podr√°n transferir datos a trav√©s de la interfaz del RS232. Cualquier
petici√≥n de transmisi√≥n se cancela con el correspondiente mensaje de error.
‚Äì Si est√° pendiente una petici√≥n de transmisi√≥n, RTS pasa a ON y se inicia el retardo
RTS ON parametrizado. Una vez transcurrido el tiempo de salida de datos se
comprueba si el interlocutor ha puesto CTS a ON. En caso afirmativo, los datos se
env√≠an a trav√©s de la interfaz RS232.
‚Äì Si la l√≠nea CTS no pasa a ON durante el retardo RTS ON, o si durante el proceso de
transmisi√≥n CTS cambia a OFF, se cancela la petici√≥n de transmisi√≥n y se genera el
correspondiente mensaje de error.
‚Äì Tras la transmisi√≥n de los datos y una vez transcurrido el retardo RTS OFF
parametrizado, la l√≠nea RTS pasa a OFF. No se espera a que la l√≠nea CTS pase a OFF.
‚Äì Siempre es posible recibir datos a trav√©s de la interfaz RS232. Si existe riesgo de
desbordamiento del b√∫fer de recepci√≥n del m√≥dulo de comunicaciones, no se produce
ninguna reacci√≥n.
‚Äì Con un cambio de DSR = ON a OFF, una petici√≥n de transmisi√≥n en curso se cancela
con un mensaje de error.
Nota
El "retardo RTS ON" debe definirse de tal manera que el interlocutor pueda pasar a
modo de disponibilidad de recepci√≥n antes de que el tiempo haya transcurrido.
El "retardo RTS OFF" debe definirse de tal manera que el interlocutor pueda recibir
completos los √∫ltimos caracteres de la trama antes de que la l√≠nea RTS, y con ella la
petici√≥n de transmisi√≥n, se desactiven.
Nota
En caso de parametrizaci√≥n de un control autom√°tico de las se√±ales RS232 no es
posible controlar RTS y DTR con las instrucciones correspondientes.

1722

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Cronograma
La siguiente figura muestra el desarrollo temporal de una petici√≥n de transmisi√≥n con control
del flujo de datos "RTS de HW con protoc. intercambio" parametrizado.

576

&76
7;'

21
2))
21
2))



3HWLFL¬µQGH
WUDQVPLVL¬µQ
576 21
,QWHUORFXWRU
&76 21
5HWDUGR57621
WUDQVFXUULGR!7UDQVIHULU
5HWDUGR57621

Figura 1-76

7UDQVPLVL¬µQ
ILQDOL]DGD

W

5HWDUGR5762))
WUDQVFXUULGR
,QWHUORFXWRU
&76 2))
5HWDUGR576
2))

cronograma con RTS de HW con protocolo de intercambio

Informaci√≥n adicional
Nota
Con los ajustes siguientes, el m√≥dulo de comunicaciones se hace cargo del control de DTR/
DSR y RTS/CTS:
‚óè RTS de HW siempre ON, ignorar DTR/DSR
‚óè RTS de HW siempre ON
‚óè RTS de HW con protoc. intercambio

Configuraci√≥n/parametrizaci√≥n
Configuraci√≥n/parametrizaci√≥n de un m√≥dulo de comunicaciones
En los cap√≠tulos siguientes encontrar√° explicaciones sobre los siguientes protocolos y sus
par√°metros:
‚óè Comunicaci√≥n a trav√©s de Freeport (P√°gina 1724)
‚óè Comunicaci√≥n a trav√©s de 3964(R) (P√°gina 1732)
‚óè Comunicaci√≥n a trav√©s de Modbus RTU (P√°gina 1737)
‚óè Comunicaci√≥n a trav√©s de USS (P√°gina 1743)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1723

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Esta informaci√≥n es necesaria para poder realizar la parametrizaci√≥n y, seguidamente, la
programaci√≥n de la comunicaci√≥n conforme al protocolo utilizado.
La configuraci√≥n y parametrizaci√≥n se realiza en la vista de dispositivos de STEP 7 (TIA Portal)
y en el cuadro de di√°logo de propiedades del m√≥dulo de comunicaci√≥n. Algunas
configuraciones se pueden modificar tambi√©n durante el tiempo de ejecuci√≥n con las
instrucciones "Config" correspondientes (Port_Config, Send_Config, Receive_Config,
P3964_Config).

Procedimiento para configurar una comunicaci√≥n PtP
El procedimiento es independiente del m√≥dulo de comunicaciones empleado.
1. En la vista de dispositivos del editor de hardware de STEP 7 (TIA Portal), configure un
S7-1500 con CPU y m√≥dulo de comunicaci√≥n.
2. Parametrice la interfaz del m√≥dulo de comunicaciones (protocolo, par√°metros de protocolo,
direcciones) en el campo "General" de la ficha "Propiedades".

Comunicaci√≥n a trav√©s de Freeport
Procedimiento para establecer una conexi√≥n serie con Freeport
Requisitos
‚óè El hardware est√° montado y existe una conexi√≥n el√©ctrica con el interlocutor acoplado.
‚óè El proyecto ya est√° creado en STEP 7 (TIA Portal) y la CPU se ha insertado en la
configuraci√≥n hardware.

Procedimiento: configuraci√≥n hardware
1. Inserte el m√≥dulo de comunicaci√≥n CM PtP en la configuraci√≥n hardware.
2. Ajuste los par√°metros de comunicaci√≥n de acuerdo con el interlocutor acoplado:
P. ej., velocidad de transferencia, trama e inicio y final de trama.
Estos par√°metros se transfieren al m√≥dulo de comunicaci√≥n CM PtP cada vez que arranca
la CPU.

Procedimiento: programaci√≥n
1. Cree la estructura de datos que debe contener los datos que se van a transferir.

1724

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Env√≠o de datos
1. Inserte las instrucciones de la librer√≠a PtP Communication: Send_P2P para enviar datos
2. Interconecte los par√°metros de entrada y de salida de la instrucci√≥n, p. ej.:
‚Äì HWID de las variables del sistema en la entrada PORT;
‚Äì Estructura de datos con los datos que se van a enviar en la entrada BUFFER.
Nota: durante el funcionamiento, todos los flancos ascendentes de la entrada REQ
enviar√°n una vez el √°rea de datos especificada. El bloque debe llamarse tantas veces como
sea necesario hasta que se indique mediante DONE que los datos se han transferido al
m√≥dulo.
En caso de error, ajustando una vez ERROR y la informaci√≥n correspondiente en STATUS
se indicar√° que los datos no se han transferido.
Recepci√≥n de datos
1. Inserte las instrucciones de la librer√≠a PtP Communication: Receive_P2P para enviar datos
2. Interconecte los par√°metros de entrada y de salida de la instrucci√≥n, p. ej.:
‚Äì HWID de las variables del sistema en la entrada PORT;
‚Äì Estructura de datos para guardar los datos que van a recibirse en la entrada BUFFER.
Nota: durante el funcionamiento, con un nivel alto en la salida NDR se indica que se han
recibido datos nuevos y que se han guardado en el √°rea de datos especificada. El bloque
se debe ir llamando hasta que NDR=TRUE. Luego podr√°n evaluarse los datos recibidos y
podr√° volver a llamarse RECEIVE_P2P.

Adiciones opcionales
‚óè Opcionalmente pueden utilizarse instrucciones que terminan con _Config para cambiar los
par√°metros de la configuraci√≥n hardware mientras se est√° ejecutando el programa de
usuario. Los cambios no se guardar√°n en la configuraci√≥n hardware. Se sobrescribir√°n en
el siguiente reinicio.
‚óè Las instrucciones Signal_Set y Signal_Get pueden utilizarse para controlar individualmente
las se√±ales cualificadoras RS232 en caso de que no sea adecuado el control autom√°tico.

Transferencia de datos con Freeport
Introducci√≥n
Freeport es un protocolo basado en telegramas (tramas) que puede programarse libremente
y que tambi√©n se denomina protocolo ASCII.
El protocolo Freeport controla la transferencia de datos en un acoplamiento punto a punto
entre el m√≥dulo de comunicaci√≥n y un interlocutor. El protocolo Freeport contiene la capa f√≠sica
(capa 1).
El protocolo Freeport permite transferir y recibir mensajes con cualquier estructura (todos los
caracteres desde 00H hasta FFH (en tramas de 8 bits de datos) o desde 00H hasta 7FH (en
tramas de 7 bits de datos)).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1725

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tanto para el sentido de transmisi√≥n como para el de recepci√≥n deben parametrizarse criterios
de inicio y fin de un telegrama. Los criterios de inicio y fin se pueden parametrizar de forma
diferente.
Para la comunicaci√≥n con un interlocutor se dispone de instrucciones (consulte Resumen de
la programaci√≥n PtP (P√°gina 1746)).

Transferir datos con Freeport
Definici√≥n de los ajustes para la transmisi√≥n
Para enviar un mensaje hay que comunicar al interlocutor el principio y fin de un mensaje.
Estos ajustes pueden realizarse de forma fija en la configuraci√≥n hardware o adaptarse
durante el tiempo de ejecuci√≥n con la instrucci√≥n Send_CFG. Puede elegir entre las siguientes
opciones o combinarlas:
‚óè Enviar Break antes de iniciar la trama
Existe la posibilidad de especificar que, al principio de cada transmisi√≥n de mensajes, se
env√≠e adicionalmente un 'break' una vez transcurrido el tiempo de retardo RTS ON.
La duraci√≥n de la se√±al "Break" se indica en tiempos de bit.
Si la sincronizaci√≥n se realiza con otros mecanismos, se puede desactivar dicha pausa.
‚óè Enviar Idle Line
Existe la posibilidad de especificar que, al principio de cada transmisi√≥n de mensajes, se
emita adicionalmente la se√±al "Idle Line".
La duraci√≥n de la se√±al "Idle Line" se indica en tiempos de bit.
Si la sincronizaci√≥n se realiza con otros mecanismos, se puede desactivar dicha pausa.
‚óè Retardo RTS ON
Es posible parametrizar el tiempo que debe transcurrir tras la solicitud de transmisi√≥n RTS
(Request to send) antes de que empiece la transferencia de datos propiamente dicha (solo
RS232).
‚óè Retardo RTS OFF
Es posible parametrizar el tiempo que debe transcurrir tras la transferencia completa antes
de que se desactive la se√±al RTS (solo RS232).

1726

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Enviar hasta car√°cter de fin inclusive
Existe la posibilidad de parametrizar el n√∫mero de caracteres de fin (1 o 2) y su valor.
Se env√≠a hasta el o los caracteres de fin, independientemente de la longitud de trama
seleccionada. El delimitador de fin debe encontrarse en los datos que se van a enviar. Los
datos se env√≠an √∫nicamente hasta el delimitador de fin incluido, aunque se haya
especificado una mayor longitud de datos.
‚óè N√∫mero de caracteres a√±adidos
Entrada del n√∫mero de caracteres a√±adidos. Se env√≠a hasta la longitud parametrizada. El
o los delimitadores de fin se a√±aden autom√°ticamente. Dependiendo del n√∫mero de
delimitadores de fin se le env√≠an al interlocutor de 1 a 5 caracteres m√°s de los indicados en
la instrucci√≥n.
Nota
Si se combinan "Enviar Break antes de iniciar la trama", "Enviar Idle Line" y "Retardo RTS
ON", estos se procesar√°n en el orden: "Retardo RTS ON", "Enviar Break antes de iniciar la
trama" y "Enviar Idle Line".

Recibir datos con Freeport
Definici√≥n del principio del mensaje
En la transferencia de datos con Freeport se puede elegir entre varios criterios de inicio
distintos. El criterio de inicio establece cu√°ndo empieza una trama. Cuando se cumple un
criterio que indica el principio de un mensaje, se empieza a examinar el flujo de datos
buscando criterios para el fin del mensaje. Seleccione aqu√≠ los ajustes correspondientes a las
propiedades del interlocutor emisor.
Para detectar el principio de un mensaje existen dos m√©todos distintos:
‚óè Empezar con cualquier car√°cter
Cualquier car√°cter puede definir el principio de un mensaje (ajuste predeterminado).
Esto significa que el primer car√°cter al principio de una comunicaci√≥n o tras la detecci√≥n de
un fin de trama se detecta como primer car√°cter de un mensaje.
‚óè Iniciar con una condici√≥n especial
El principio de un mensaje se reconoce por las siguientes condiciones especificadas.
‚Äì Tras detectar Line Break
El principio de la trama solo se acepta si previamente se ha recibido un Break, es decir,
el interlocutor tiene que enviar obligatoriamente un Break antes de enviar una trama.
‚Äì Tras detectar Idle Line
El principio de la trama solo se acepta una vez transcurrida la duraci√≥n parametrizada
de la Idle Line. Para ello se requiere una pausa m√≠nima entre 2 tramas.
‚Äì Tras detectar el car√°cter de inicio
El principio de la trama se detecta cuando se detecta el car√°cter de inicio parametrizado.
‚Äì Tras detectar una o varias secuencias de inicio
El principio de la trama se detecta cuando se detecta la secuencia de caracteres
parametrizada, que est√° formada por un m√°ximo de 5 caracteres. Es posible
parametrizar hasta 4 secuencias de inicio. Las secuencias de inicio formadas por un
m√°ximo de 5 caracteres tambi√©n pueden contener "don't care characters".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1727

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Ejemplo:
Tabla 1-111 Condiciones de inicio parametrizadas
Condici√≥n de ini‚Äê
cio

1.er car√°cter

2.¬∫ car√°cter

3.er car√°cter

4.¬∫ car√°cter

5.¬∫ car√°cter

1

0x68

xx

xx

0x68

xx

2

0x10

0xaa

xx

xx

xx

3

0xdc

0xaa

xx

xx

xx

4

0xe5

xx

xx

xx

xx

:

Se ha recibido el siguiente mensaje: 68 10 aa 68 bb 10 aa 16
La evaluaci√≥n de los criterios de inicio comienza al recibir el 1.er car√°cter: 0x68.
Los caracteres 2.¬∫ y 3.¬∫ pueden ser cualquiera.
Al recibir el 4.¬∫ car√°cter (segundo 0x68) se cumple la primera condici√≥n de inicio y comienza
la consiguiente evaluaci√≥n del mensaje.

Definici√≥n del fin del mensaje
En la transmisi√≥n de datos con el protocolo Freeport se puede elegir entre varios criterios de
fin distintos. El criterio de fin establece el momento en el que se completa la recepci√≥n de una
trama.
Los criterios de fin ajustables son:
‚óè Detectar fin del mensaje por rebase del tiempo m√°ximo de espera
‚óè Detectar fin del mensaje por rebase del tiempo de respuesta
‚óè Transcurrido el tiempo de retardo de caracteres (ajuste predeterminado)
‚óè Tras recibir una longitud fija de la trama
‚óè Tras recibir un n√∫mero m√°ximo de caracteres
‚óè Leer longitud del mensaje en el mensaje
‚óè Tras recibir una secuencia de fin

Tiempo de mensaje excedido
En la recepci√≥n de datos se detecta el fin de la trama una vez transcurrido el tiempo
parametrizado para la transferencia de una trama. El tiempo se empieza a medir cuando se
cumple el criterio de inicio.

Rebase del tiempo de respuesta
Con el tiempo de respuesta se vigila el comportamiento de respuesta del interlocutor. Si al
concluir un proceso de transmisi√≥n no se detecta un inicio de trama v√°lido, el proceso de
transmisi√≥n se acusa con el mensaje correspondiente.
El criterio de fin real debe parametrizarse adicionalmente.

1728

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Transcurrido el tiempo de retardo de caracteres
Al recibir datos se detecta el final de la trama una vez rebasado el tiempo m√°ximo ajustado
entre caracteres consecutivos (tiempo de retardo de caracteres). El valor se indica en tiempos
de bit.
En este caso, el tiempo de retardo de caracteres deber√° ajustarse de tal modo que pueda
transcurrir con seguridad entre dos tramas consecutivas. Esta indicaci√≥n de tiempo deber√≠a
ser lo suficientemente larga como para que no se confunda el final de la trama con una pausa
de transmisi√≥n del interlocutor dentro de una trama.

Longitud fija de la trama
Al recibir datos se detecta el final de la trama una vez alcanzada la longitud parametrizada de
la trama.
Si el tiempo de retardo de caracteres transcurre (si est√° activado) antes de que se alcance la
longitud fija de la trama, se genera un mensaje de error y la trama se rechaza.
Cuando la longitud de la trama de los caracteres recibidos no coincida con la longitud fijada,
tenga en cuenta lo siguiente:
‚óè Todos los caracteres que se reciben tras alcanzar la longitud parametrizada de la trama se
rechazan hasta que se detecta un nuevo criterio de inicio.
‚óè Si se cumple otro criterio de fin (activado) antes de que se alcance la longitud de trama
parametrizada, se genera un mensaje de error y se rechaza la trama.

N√∫mero m√°ximo de caracteres
Al recibir datos se detecta el fin de la trama cuando se recibe el n√∫mero parametrizado de
caracteres.
Este ajuste puede combinarse con los ajustes de "tiempo de retardo de caracteres". La trama
tambi√©n se considera recibida sin errores cuando se cumple otra condici√≥n de fin,
independientemente de si se ha alcanzado el n√∫mero m√°ximo de caracteres.
Cuando la longitud de trama de los caracteres recibidos no coincida con la longitud m√°xima
parametrizada, tenga en cuenta lo siguiente:
‚óè Todos los caracteres que se reciben tras alcanzar el n√∫mero m√°ximo de caracteres
parametrizado se rechazan hasta que se detecta un nuevo criterio de inicio (p. ej. "Idle
Line").
‚óè Si se cumple otro criterio de fin (activado) antes de que se alcance el n√∫mero m√°ximo de
caracteres parametrizado, esta "parte de la trama" se valora como trama v√°lida y se espera
un nuevo criterio de inicio. Todos los caracteres recibidos antes de que se cumpla un nuevo
criterio de inicio se rechazan.
Nota
Si no hay ning√∫n otro criterio de fin activado, la longitud fija de la trama y el n√∫mero m√°ximo
de caracteres presentan el mismo comportamiento.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1729

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Longitud del mensaje dentro del mensaje
Al recibir datos se detecta el final de la trama cuando se alcanza la longitud de trama enviada
en la trama de recepci√≥n.
Con los par√°metros siguientes se especifican los caracteres que deben considerarse para
evaluar la longitud del mensaje:
‚óè Offset del campo de longitud en el mensaje
Este valor determina la posici√≥n del car√°cter en el mensaje que debe considerarse para
determinar la longitud del mensaje.
En funci√≥n del tama√±o del b√∫fer pueden ajustarse valores entre 0 y 4095 caracteres.
‚óè Tama√±o del campo de longitud
Este valor indica cu√°ntos caracteres a partir de la primera posici√≥n de evaluaci√≥n deben
considerarse para determinar la longitud del mensaje.
Pueden ajustarse valores de 1, 2 y 4 caracteres.
‚óè N√∫mero de caracteres que se excluyen de la longitud
N√∫mero de caracteres a√±adidos a la trama pero que no se incluyen en la longitud de la
trama. Este valor indica el n√∫mero de bytes al final de la trama que no deben tenerse en
cuenta al evaluar la longitud de la trama.
Pueden ajustarse valores entre 0 y 255 caracteres.
Ejemplo:
Parametrizaciones para "Longitud del mensaje dentro del mensaje"
Offset del campo de longitud en el mensaje: 3.er byte (como Offset debe parametrizarse "2")
Tama√±o del campo de longitud:
1 byte
N√∫mero de caracteres que se excluyen de 3 bytes
la longitud:
Mensaje

N√∫mero de caracteres que se excluyen
de la longitud

Car√°cter de
inicio

Direc‚Äê
ci√≥n

Campo de
longitud

Byte 1

Byte 2

Byte 3

Suma de verifi‚Äê Car√°cter de fin
caci√≥n
Byte...

Byte X

Byte X+1

Byte X+2

Byte X+3

Secuencia de fin
Al recibir datos se detecta el final de la trama cuando se recibe la secuencia de fin
parametrizada (m√°x. 5 caracteres). La secuencia de fin formada por un m√°ximo de 5
caracteres tambi√©n puede contener "don't care characters". Los datos recibidos son aplicados
por la CPU, incluida la secuencia de fin.

1730

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si se trabaja con secuencia de fin, la transferencia no tendr√° transparencia de c√≥digo y deber√°
excluirse la posibilidad de que el o los delimitadores de fin est√©n incluidos en los datos de
usuario.
Nota
Secuencia de fin de telegrama
Si solo hay 1 car√°cter de fin, la entrada debe realizarse forzosamente en la 5.¬™ l√≠nea.
Si hay 2 caracteres de fin, las entradas deben realizarse en las l√≠neas 4.¬™ y 5.¬™ (sin dejar
huecos).
Si se utilizan m√°s caracteres, se aplican reglas an√°logas.

Transparencia del c√≥digo
Transparencia del c√≥digo
"Transparencia del c√≥digo" significa que en los datos de usuario pueden darse todas las
combinaciones de caracteres posibles sin que se detecte el criterio de fin.
La transparencia del c√≥digo del procedimiento depende del criterio de fin parametrizado y del
control del flujo de datos:
‚óè Con secuencia de fin determinada o utilizando el control del flujo XON/XOFF
‚Äì No hay transparencia del c√≥digo
‚óè Criterio de fin tiempo de retardo de caracteres, longitud fija de trama, longitud m√°xima de
trama, tiempo de mensaje excedido o tiempo de respuesta excedido y longitud del mensaje
dentro del mensaje
‚Äì Con transparencia del c√≥digo

B√∫fer de recepci√≥n
B√∫fer de recepci√≥n del m√≥dulo
Los m√≥dulos de comunicaciones disponen de un b√∫fer de recepci√≥n, que almacena
provisionalmente las tramas recibidas hasta que se transfieren a la CPU. El b√∫fer de recepci√≥n
es un b√∫fer en anillo, es decir, las tramas se transmiten a la CPU siguiendo su orden de
recepci√≥n hasta que el b√∫fer de recepci√≥n est√° lleno. Si se reciben posteriormente m√°s tramas,
se sobrescribe la m√°s antigua de las existentes. Si se ha parametrizado "Impedir
sobrescritura", cuando el b√∫fer de recepci√≥n se llene se generar√° el mensaje correspondiente.
Todas las dem√°s tramas se rechazan hasta que el b√∫fer de recepci√≥n vuelva a estar listo para
la recepci√≥n.
Durante la parametrizaci√≥n se puede indicar si se desea borrar el b√∫fer de recepci√≥n al
arrancar. Adem√°s puede indicarse el rango de valores (de 1 a 255) para el n√∫mero de tramas
de recepci√≥n guardadas en el b√∫fer.
Dependiendo del m√≥dulo de comunicaciones utilizado, el b√∫fer de recepci√≥n del m√≥dulo puede
alojar hasta 8 kB (consulte el cap√≠tulo Introducci√≥n (P√°gina 1700)). La longitud m√°xima de la

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1731

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
trama es de 4 kB. De este modo, cada m√≥dulo de comunicaciones puede respaldar al menos
dos tramas.
Si desea que se transfiera siempre la trama m√°s reciente a la CPU, deber√° parametrizar para
el n√∫mero de tramas en b√∫fer el valor "1" y desactivar la protecci√≥n contra sobrescritura.
Nota
Si la lectura continua de los datos recibidos en el programa de usuario se interrumpe durante
un tiempo, al volver a solicitar los datos recibidos puede ocurrir que la CPU reciba primero una
trama antigua del m√≥dulo de comunicaciones y despu√©s la √∫ltima trama. La trama antigua se
tomaba del b√∫fer de recepci√≥n del m√≥dulo de comunicaciones en el momento de la
interrupci√≥n y se preparaba para la transferencia a la CPU.

Comunicaci√≥n a trav√©s de 3964(R)
Procedimiento para establecer una conexi√≥n serie con 3964(R)
Requisitos
‚óè El hardware est√° montado y existe una conexi√≥n el√©ctrica con el interlocutor acoplado.
‚óè El proyecto ya est√° creado en STEP 7 (TIA Portal) y la CPU se ha insertado en la
configuraci√≥n hardware.

Procedimiento: configuraci√≥n hardware
1. Inserte el m√≥dulo de comunicaci√≥n CM PtP en la configuraci√≥n hardware.
2. Ajuste los par√°metros de comunicaci√≥n de acuerdo con el interlocutor acoplado:
P. ej., velocidad de transferencia, trama e inicio y final de trama.
Estos par√°metros se transfieren al m√≥dulo de comunicaci√≥n CM PtP cada vez que arranca
la CPU.

Procedimiento: programaci√≥n
1. Cree la estructura de datos que debe contener los datos que se van a transferir.

1732

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Env√≠o de datos:
1. Inserte las instrucciones de la librer√≠a PtP Communication: Send_P2P para enviar datos
2. Interconecte los par√°metros de entrada y de salida de la instrucci√≥n, p. ej.:
‚Äì HWID de las variables del sistema en la entrada PORT;
‚Äì Estructura de datos con los datos que se van a enviar en la entrada BUFFER.
Nota: durante el funcionamiento, todos los flancos ascendentes de la entrada REQ
enviar√°n una vez el √°rea de datos especificada. El bloque debe llamarse tantas veces como
sea necesario hasta que se indique mediante DONE que los datos se han transferido al
m√≥dulo.
En caso de error, ajustando una vez ERROR y la informaci√≥n correspondiente en STATUS
se indicar√° que los datos no se han transferido.
Recepci√≥n de datos
1. Inserte las instrucciones de la librer√≠a PtP Communication: Receive_P2P para enviar datos
2. Interconecte los par√°metros de entrada y de salida de la instrucci√≥n, p. ej.:
‚Äì HWID de las variables del sistema en la entrada PORT;
‚Äì Estructura de datos para guardar los datos que van a recibirse en la entrada BUFFER.
Nota: durante el funcionamiento, con un nivel alto en la salida NDR se indica que se han
recibido datos nuevos y que se han guardado en el √°rea de datos especificada. El bloque
se debe ir llamando hasta que NDR=TRUE. Luego podr√°n evaluarse los datos recibidos y
podr√° volver a llamarse RECEIVE_P2P.

Adiciones opcionales
‚óè Opcionalmente pueden utilizarse instrucciones que terminan con _Config para cambiar los
par√°metros de la configuraci√≥n hardware mientras se est√° ejecutando el programa de
usuario. Los cambios no se guardar√°n en la configuraci√≥n hardware. Se sobrescribir√°n en
el siguiente reinicio.
‚óè Las instrucciones Signal_Set y Signal_Get pueden utilizarse para controlar individualmente
las se√±ales cualificadoras RS232 en caso de que no sea adecuado el control autom√°tico.

Transferencia de datos con el procedimiento 3964(R)
Introducci√≥n
El procedimiento 3964(R) controla la transferencia de datos en un acoplamiento punto a punto
entre el m√≥dulo de comunicaci√≥n y un interlocutor. El procedimiento 3964(R) contiene,
adem√°s de la capa f√≠sica (capa 1), la capa de enlace de datos (capa 2).
Para la comunicaci√≥n con un interlocutor se dispone de instrucciones (consulte Resumen de
la programaci√≥n PtP (P√°gina 1746)).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1733

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Caracteres de control
Introducci√≥n
El procedimiento 3964(R) agrega caracteres de control a los datos de informaci√≥n (capa de
enlace de datos) durante la transmisi√≥n de datos. Mediante estos caracteres de control, el
interlocutor puede controlar si los datos le llegan de forma completa y sin errores.

Caracteres de control del procedimiento 3964(R)
El procedimiento 3964(R) eval√∫a los siguientes caracteres de control:
STX
DLE
ETX
NAK
BCC

Inicio de la secuencia de caracteres que debe trans‚Äê
mitirse
Data Link Escape
Conmutaci√≥n de transmisi√≥n de datos
End of Text
Fin de la secuencia de caracteres que debe transmi‚Äê
tirse
Negative Acknowledge Respuesta negativa
Block Check Character Car√°cter de control de bloque
(solo con 3964R)
Start of Text

02H
10H
03H
15H

BCC se forma y vigila autom√°ticamente en el m√≥dulo de comunicaciones. El car√°cter de
control de bloque no se transmite a la CPU como contenido de la trama.
Nota
Si dentro de una trama se transmite el car√°cter DLE como car√°cter de informaci√≥n, este se
enviar√° doblemente para distinguir el car√°cter de control DLE durante el establecimiento de la
conexi√≥n y la desconexi√≥n en la l√≠nea de transmisi√≥n (duplicado DLE). El receptor anula el
duplicado DLE.

Prioridad
En el procedimiento 3964(R), un interlocutor debe tener asignada una prioridad mayor que el
otro. Si ambos interlocutores empiezan a establecer la conexi√≥n simult√°neamente, el
interlocutor que tiene la prioridad m√°s baja retira su petici√≥n de transmisi√≥n.

Car√°cter de control de bloque
Car√°cter de control de bloque
En el protocolo de transmisi√≥n 3964R, la seguridad de datos se aumenta mediante un car√°cter
de control de bloque (BCC = Block Check Character) enviado adicionalmente.
El car√°cter de control de bloque es la paridad longitudinal par (operaci√≥n l√≥gica EXOR de todos
los bytes de datos) de un bloque enviado o recibido. La formaci√≥n se inicia con el primer byte

1734

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
de datos de usuario (1.er byte de la trama) tras establecerse la conexi√≥n y finaliza despu√©s del
car√°cter DLE ETX en la desconexi√≥n.
Nota
En un duplicado DLE, el car√°cter DLE se incluye dos veces en la formaci√≥n del BCC.

Transferir datos con 3964(R)
Establecimiento de la conexi√≥n al enviar
Para establecer la conexi√≥n, el procedimiento 3964(R) env√≠a el car√°cter de control STX. Si el
interlocutor responde con el car√°cter DLE antes de que transcurra el tiempo de retardo de
acuse, el procedimiento pasa al modo de transmisi√≥n.
Si, por el contrario, el interlocutor responde con NAK, otro car√°cter cualquiera (con la
excepci√≥n de DLE o STX) o si el tiempo de retardo de acuse transcurre sin que se produzca
una reacci√≥n, el procedimiento repite el establecimiento de la conexi√≥n. Tras el n√∫mero
parametrizado de intentos fallidos, el procedimiento cancela el establecimiento y env√≠a el
car√°cter NAK al interlocutor. El m√≥dulo de comunicaci√≥n emite el correspondiente mensaje de
error.

Transferir datos
Si el establecimiento de la conexi√≥n tiene √©xito, los datos de usuario contenidos en el b√∫fer de
salida del m√≥dulo de comunicaciones se env√≠an al interlocutor con los par√°metros de
transmisi√≥n seleccionados (un DLE detectado en los datos de usuario se duplicar√° durante el
proceso de transmisi√≥n). El interlocutor controla la distancia temporal de los caracteres
entrantes. La distancia entre dos caracteres no debe ser mayor al tiempo de retardo de
caracteres. La vigilancia del tiempo de retardo de caracteres empieza justo despu√©s de que se
haya conseguido establecer la conexi√≥n.
Si el interlocutor env√≠a el car√°cter NAK durante una transmisi√≥n, el procedimiento cancela el
bloque y lo repite del modo arriba descrito, comenzando con el establecimiento de la conexi√≥n.
Si el interlocutor env√≠a cualquier otro car√°cter, el procedimiento espera primero a que
transcurra el tiempo de retardo de caracteres y a continuaci√≥n env√≠a el car√°cter NAK para que
el interlocutor pase a estado de reposo. Entonces el procedimiento comienza de nuevo la
transmisi√≥n con el establecimiento de la conexi√≥n STX.

Desconexi√≥n al enviar
Una vez que se ha enviado el contenido del b√∫fer, el procedimiento agrega los caracteres DLE,
ETX y, solo en el caso de 3964R, el car√°cter de control de bloque BCC como delimitador de fin,
y espera un car√°cter de acuse. Si el interlocutor env√≠a el car√°cter DLE dentro del tiempo de
retardo de acuse, significa que el bloque de datos se ha recibido sin errores. Si, por el contrario,
el interlocutor responde con NAK, otro car√°cter cualquiera (con la excepci√≥n de DLE), un
car√°cter err√≥neo, o si el tiempo de retardo de acuse transcurre sin que se produzca una
reacci√≥n, el procedimiento comienza de nuevo la transmisi√≥n con el establecimiento de la
conexi√≥n STX.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1735

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tras un n√∫mero parametrizado de intentos de transferencia, el procedimiento cancela el
proceso y env√≠a el car√°cter NAK al interlocutor. El m√≥dulo de comunicaci√≥n emite el
correspondiente mensaje de error.

Recibir datos con 3964(R)
Establecimiento de la conexi√≥n al recibir
En estado de reposo, cuando no debe procesarse ninguna petici√≥n de transmisi√≥n, el
procedimiento espera a que el interlocutor establezca la conexi√≥n.
Si durante el establecimiento de la conexi√≥n con STX no hay ning√∫n b√∫fer de recepci√≥n
disponible, se inicia un tiempo de espera (tiempo de espera = tiempo de retardo de acuse - 10
ms, aunque m√°ximo 400 ms). Si transcurrido dicho tiempo no hay ning√∫n b√∫fer de recepci√≥n
libre, se genera un mensaje de error. El procedimiento env√≠a el car√°cter NAK y regresa al
estado de reposo. En caso contrario, el procedimiento env√≠a el car√°cter DLE y recibe los datos
como se ha descrito.
El tiempo de retardo de acuse deber√≠a ajustarse al mismo valor en ambos interlocutores.
Si el procedimiento recibe cualquier car√°cter (con la excepci√≥n de STX o NAK) estando en
reposo, espera primero a que transcurra el tiempo de retardo de caracteres y a continuaci√≥n
env√≠a el car√°cter NAK. El m√≥dulo de comunicaci√≥n emite el correspondiente mensaje de error.

Recibir datos
Una vez que la conexi√≥n se ha establecido correctamente, los caracteres de recepci√≥n
entrantes se depositan en el b√∫fer de recepci√≥n. Si se reciben dos caracteres DLE
consecutivos, solo uno de ellos se registra en el b√∫fer de recepci√≥n.
Una vez establecida correctamente la conexi√≥n y despu√©s de cada car√°cter recibido, se
espera al siguiente durante el tiempo de retardo de caracteres. Si este transcurre sin
recepci√≥n, se env√≠a el car√°cter NAK al interlocutor. El m√≥dulo de comunicaci√≥n emite el
correspondiente mensaje de error. A continuaci√≥n se espera una repetici√≥n.
Si durante la recepci√≥n se producen errores de transmisi√≥n (error de trama, error de paridad,
etc.), se contin√∫a recibiendo hasta que se produce la desconexi√≥n y, a continuaci√≥n, se env√≠a
el car√°cter NAK al interlocutor. A continuaci√≥n se espera una repetici√≥n. Si el bloque no puede
recibirse sin errores tras el n√∫mero de intentos especificado, o si el interlocutor no inicia la
repetici√≥n dentro de un tiempo de espera de bloque de 4 s, el procedimiento cancela la
recepci√≥n. El m√≥dulo de comunicaci√≥n notifica la primera transmisi√≥n err√≥nea y la cancelaci√≥n
definitiva.

Desconexi√≥n al recibir
Cuando el procedimiento 3964 reconoce la secuencia de caracteres DLE ETX, finaliza la
recepci√≥n y env√≠a el car√°cter DLE al interlocutor si ha recibido un bloque sin errores. Si, por el
contrario, se produce un error de recepci√≥n, env√≠a el car√°cter NAK al interlocutor. A
continuaci√≥n se espera una repetici√≥n.
Cuando el procedimiento 3964R reconoce la secuencia de caracteres DLE ETX BCC, finaliza
la recepci√≥n. Compara el car√°cter de control de bloque recibido (BCC) con la paridad
longitudinal calculada internamente. Si el car√°cter de control de bloque es correcto y no ha

1736

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
ocurrido ning√∫n otro error en la recepci√≥n, el procedimiento 3964R env√≠a el car√°cter DLE y
vuelve al estado de reposo. El m√≥dulo de comunicaciones informa al control de que existen
nuevos datos recibidos.
Si hay un error en el BCC o si se produce cualquier otro error de recepci√≥n, se env√≠a el car√°cter
NAK al interlocutor. A continuaci√≥n se espera una repetici√≥n.

Comunicaci√≥n a trav√©s de Modbus RTU
Procedimiento para establecer una conexi√≥n serie con Modbus RTU
Requisitos
‚óè El hardware est√° montado y existe una conexi√≥n el√©ctrica con el interlocutor acoplado.
‚óè El proyecto ya est√° creado en STEP 7 (TIA Portal) y la CPU se ha insertado en la
configuraci√≥n hardware.

Procedimiento: configuraci√≥n hardware
1. Inserte el m√≥dulo de comunicaci√≥n CM PtP en la configuraci√≥n hardware.
2. Seleccione el protocolo Modbus RTU.
Nota: Con Modbus RTU, la mayor√≠a de los par√°metros de comunicaci√≥n se ajusta con la
instrucci√≥n Modbus_Comm_Load al arrancar la CPU.

Procedimiento: programaci√≥n
1. Cree la estructura de datos que debe contener los datos que se van a transferir.
2. Integre la instrucci√≥n Modbus_Comm_Load en la ejecuci√≥n c√≠clica para parametrizar el
m√≥dulo de comunicaci√≥n.
3. Interconecte el HWID de las variables del sistema en la entrada PORT.
4. Llame la instrucci√≥n tantas veces como sea necesario hasta que se indique en la salida
DONE que la ejecuci√≥n es correcta. Despu√©s no vuelva a llamar la instrucci√≥n, a no ser que
desee modificar los par√°metros de comunicaci√≥n.
Funcionamiento como maestro Modbus:
1. Inserte la instrucci√≥n Modbus_Master de la librer√≠a MODBUS (RTU).
2. Interconecte la estructura de datos con los datos que se van a enviar en la entrada BUFFER.
3. Interconecte el DB de instancia de la instrucci√≥n Modbus_Master en la entrada MB_DB de
Modbus_Comm_Load.
Nota: durante el funcionamiento, todos los flancos ascendentes de la entrada REQ
procesar√°n una vez la petici√≥n especificada. El bloque debe llamarse tantas veces como
sea necesario hasta que se indique mediante DONE que los datos se han transferido al
m√≥dulo.
En caso de error, ajustando una vez ERROR y la informaci√≥n correspondiente en STATUS
se indicar√° que los datos no se han transferido.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1737

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Funcionamiento como esclavo Modbus:
1. Inserte la instrucci√≥n Modbus_Slave de la librer√≠a MODBUS (RTU).
2. Interconecte la estructura de datos con los registros de parada de Modbus.
3. Indique la direcci√≥n del esclavo Modbus en la entrada MB_ADDR.
4. Interconecte el DB de instancia de la instrucci√≥n Modbus_Master en la entrada MB_DB de
Modbus_Comm_Load.
Nota: durante el funcionamiento, con un nivel alto en la salida NDR se indica que se han
recibido datos nuevos y que se han guardado en el √°rea de datos especificada.

Resumen de la comunicaci√≥n Modbus
Comunicaci√≥n Modbus RTU
Modbus RTU (Remote Terminal Unit) es un protocolo est√°ndar para la comunicaci√≥n dentro de
la red y utiliza la conexi√≥n el√©ctrica RS232 o RS422/485 para la transferencia de datos serie
entre dispositivos Modbus de la red.
Modbus RTU utiliza una red de maestros y esclavos en la que toda la comunicaci√≥n parte de
un solo dispositivo maestro, mientras que los esclavos simplemente reaccionan a la solicitud
del maestro. El maestro env√≠a una solicitud a una direcci√≥n de esclavo y solo responde al
comando dicha direcci√≥n de esclavo (excepci√≥n: tramas Broadcast en direcci√≥n de esclavo 0
que no son acusadas por los esclavos).
Se utiliza un procedimiento semid√∫plex as√≠ncrono y con trasparencia de c√≥digos. La
transmisi√≥n de datos se realiza sin procedimientos Handshake.

Clasificaci√≥n dentro del entorno del sistema
La siguiente descripci√≥n de Modbus se refiere al uso de los m√≥dulos de comunicaciones
correspondientes.
‚óè CM PtP RS232 HF
‚óè CM PtP RS422/485 HF
‚óè CM PtP (ET 200SP)

Funci√≥n del acoplamiento
Con los m√≥dulos de comunicaciones correspondientes y las instrucciones respectivas, es
posible establecer una conexi√≥n de comunicaci√≥n entre un sistema de control Modbus remoto
y un SIMATIC S7.
Para la transmisi√≥n se utiliza el protocolo GOULD - MODBUS en el formato RTU.
En la comunicaci√≥n entre un m√≥dulo de comunicaciones utilizado como esclavo Modbus y un
sistema maestro se pueden utilizar los c√≥digos de funci√≥n 01, 02, 03, 04, 05, 06, 08, 15 y 16
(consulte C√≥digos de funci√≥n (P√°gina 1742)).
Si un m√≥dulo de comunicaciones SIMATIC S7 se utiliza como maestro Modbus, adem√°s est√°n
disponibles los c√≥digos de funci√≥n 11 y 12.

1738

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

SIMATIC S7 como esclavo Modbus
El maestro tiene la iniciativa en la transmisi√≥n, el m√≥dulo de comunicaciones funciona como
esclavo.
No es posible el intercambio de tramas entre esclavos.
La instrucci√≥n Modbus_Slave pone los datos a disposici√≥n en un √°rea de datos SIMATIC
conforme a la especificaci√≥n de la figura o los guarda.

SIMATIC S7 como esclavo Modbus
Como maestro, el m√≥dulo de comunicaciones inicia la transmisi√≥n y, tras transmitir la trama de
solicitud, espera la trama de respuesta del esclavo durante el tiempo de vigilancia de respuesta
parametrizado. Si el esclavo no responde, el maestro repite la petici√≥n conforme a la
parametrizaci√≥n antes de devolver un mensaje de error.

Estructura de la trama
El intercambio de datos "maestro-esclavo" y "esclavo-maestro" comienza con la direcci√≥n del
esclavo, seguida del c√≥digo de funci√≥n. A continuaci√≥n se transfieren los datos. La estructura
del campo de datos depende del c√≥digo de funci√≥n utilizado. Al final de la trama se transmitir√°
la comprobaci√≥n CRC (CRC-Check).
ADDRESS

FUNCTION

DATA

CRC-CHECK

Byte/palabra

Bytes

n bytes

2 bytes

ADDRESS

FUNCTION
DATA
CRC-CHECK

Direcci√≥n del esclavo Modbus
‚óè Direcci√≥n est√°ndar: de 1 a 247 (bytes)
‚óè Direcci√≥n de estaci√≥n avanzada: de 1 a 65535 (palabra)
C√≥digos de funci√≥n (P√°gina 1742) Modbus
Datos de la trama: datos de gesti√≥n y de usuario dependientes del
c√≥digo de funci√≥n
Suma de verificaci√≥n de la trama

Direcci√≥n del esclavo
La direcci√≥n de esclavo puede encontrarse en el rango de 1 a 247 (byte) o de 1 a 65535
(palabra). Con la direcci√≥n se llega a un esclavo concreto del bus.

Mensaje Broadcast
Con la direcci√≥n de esclavo cero, el maestro se dirige a todos los esclavos del bus.
Los mensajes Broadcast se permiten √∫nicamente en relaci√≥n con los c√≥digos de funci√≥n 05,
06, 15 o 16 de escritura.
En un mensaje Broadcast, el esclavo no env√≠a ninguna trama de respuesta.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1739

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Campo de datos DATA
En el campo de datos DATA se transfieren los datos espec√≠ficos del c√≥digo de funci√≥n:
‚óè Bytecount, Coil_Startaddress, Register_Startaddress; Number_of_Coils,
Number_of_Registers, ...
Consulte al respecto "C√≥digos de funci√≥n (P√°gina 1742)".

CRC-Check
El final de la trama forma la suma de verificaci√≥n CRC-16 de dos bytes de longitud, formada
seg√∫n el polinomio x16 + x15 + x2 + 1.
En primer lugar se transfiere el byte Low, y despu√©s, el byte High.

Fin de la trama
Se detecta el fin de la trama cuando no se realiza ninguna transferencia en el tiempo que
tardan en transferirse 3,5 caracteres y medio (3,5 veces el tiempo de retardo de caracteres
(v√©ase Modbus Protocol Reference Guide).
As√≠, este TIME_OUT de fin de trama depende de la velocidad de transferencia de datos y se
indica en tiempos de bit (35 tiempos de bit est√°n codificados internamente de forma fija; en la
instrucci√≥n se pueden parametrizar adicionalmente otros tiempos de bit).
Tras el TIME_OUT de fin de trama se eval√∫a y comprueba formalmente la trama Modbus
recibida por el interlocutor.

Exception Responses
Cuando el esclavo detecta un error (p. ej., una direcci√≥n de registro no permitida) en la trama
de solicitud del maestro, establece el bit de mayor valor en el c√≥digo de funci√≥n de la trama de
respuesta.
A continuaci√≥n se transfiere un byte de Exception Code que describe la causa del error.
El significado de dicho par√°metro se describe en el "GOULD MODICON Modbus Protocol" (no
forma parte de la presente documentaci√≥n).

Trama de Exception Code
La estructura de la trama de Exception Code del esclavo es la siguiente:
‚óè p. ej., direcci√≥n de esclavo 5, c√≥digo de funci√≥n 5, Exception Code 2
Trama de respuesta del esclavo EXCEPTION_CODE_xx:
05H

Direcci√≥n del esclavo

85H

C√≥digo de funci√≥n

02H

Exception Code (1...7)

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Cuando el driver recibe una trama de Exception Code, la petici√≥n en curso finalizar√° con error.

1740

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los siguientes c√≥digos de error est√°n definidos seg√∫n la especificaci√≥n Modbus:
C√≥digo de
error

Significado seg√∫n la especificaci√≥n Mod‚Äê
bus

Causa - Resumen t√©cnico *

1

Illegal function

C√≥digo de funci√≥n no permitido

2

Illegal data address

Direcci√≥n de datos no permitida en el es‚Äê
clavo

3

Illegal data value

Valor de datos no permitido en el esclavo

4

Failure in associated device

Error interno en el esclavo

5

Acknowledge

La funci√≥n ser√° ejecutada

6

Busy, Rejected message

El esclavo no est√° preparado

7

Negative acknowledgement

Funci√≥n no ejecutable

* Buscar causa detallada en el esclavo.

Modo RS232
El modo RS232 es compatible con los siguientes m√≥dulos de comunicaciones:
‚óè CM PtP RS232 HF
‚óè CM PtP (ET 200SP)
Encontrar√° m√°s informaci√≥n sobre el modo RS232 en el cap√≠tulo Modo RS232 (P√°gina 1709).
Encontrar√° informaci√≥n sobre el control del flujo de datos de hardware y sobre el manejo
autom√°tico de las se√±ales cualificadoras en el cap√≠tulo Procedimiento Handshake
(P√°gina 1718).

Modo RS422/485
El modo RS422/485 es compatible con los siguientes m√≥dulos de comunicaciones:
‚óè CM PtP RS422/485 HF
‚óè CM PtP (ET 200SP)
Encontrar√° m√°s informaci√≥n sobre el modo RS422/485 en los cap√≠tulos Modo RS422
(P√°gina 1712) y Modo RS485 (P√°gina 1715).

Preguntas frecuentes (FAQ)
Para m√°s informaci√≥n al respecto, consulte la siguiente pregunta frecuente (FAQ) en el
Siemens Industry Online Support:
‚óè ID de art√≠culo 68202723 (https://support.industry.siemens.com/cs/ww/en/view/68202723)
‚óè ID de art√≠culo 58386780 (https://support.industry.siemens.com/cs/ww/en/view/58386780)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1741

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√≥digos de funci√≥n
C√≥digos de funci√≥n utilizados
El c√≥digo de funci√≥n define el significado de la trama. Mediante el c√≥digo de funci√≥n se define
tambi√©n la estructura de la trama.
El m√≥dulo de comunicaciones soporta los siguientes c√≥digos de funci√≥n:
C√≥digo de fun‚Äê Funci√≥n seg√∫n la especificaci√≥n MODBUS
ci√≥n

Rango

01

Read Coil Status

1 a 2000 bits/solicitud

02

Read Input Status

1 a 2000 bits/solicitud

03

Read Holding Registers

1 a 124/125 bits/solicitud (124
con direcci√≥n de estaci√≥n avan‚Äê
zada)

04

Read Input Registers

1 a 124/125 bits/solicitud (124
con direcci√≥n de estaci√≥n avan‚Äê
zada)

05

Force Single Coil

1 bit/solicitud

06

Preset Single Register

1 palabra/solicitud

08 *

Loop Back Test

Leer estado del esclavo o reini‚Äê
ciar contador de eventos en el
esclavo

11 *

Fetch Communications Event Counter (solo maes‚Äê tro)

15

Force Multiple Coils

1 a 1968 bits/solicitud

16

Preset Multiple Registers

1 a 123 bits/solicitud

* Informaci√≥n de diagnostico para la comunicaci√≥n del esclavo

El c√≥digo de funci√≥n Modbus 00 env√≠a un mensaje Broadcast (difusi√≥n) a todos los esclavos
(sin respuesta del esclavo).

Asignaci√≥n de las direcciones Modbus a las direcciones SIMATIC
La tabla siguiente muestra la asignaci√≥n de las direcciones Modbus a las direcciones SIMATIC.
Modbus
FC

S7-1500

Funci√≥n

Declaraci√≥n

√Årea de direccio‚Äê
nes

Declaraci√≥n

Direcci√≥n de la CPU

01

Leer bits

Output

1 - 9999

Imagen de proceso de las
salidas

Q0.0 - Q1249.6

02

Leer bits

Input

10001 - 19999

Imagen de proceso de las
entradas

I0.0 - I1249.6

03 2)

Leer palabras

Holding Register

40001 - 49999
o
400001 - 465535

DW0 - DW19998
o
DW0 - DW131068

El √°rea de direcciones
M depende de la CPU

04

Leer palabras

Input

30001 - 39999

Imagen de proceso de las
entradas

EW0 - EW19996

1)

1742

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Modbus

S7-1500

FC 1) Funci√≥n

Declaraci√≥n

√Årea de direccio‚Äê
nes

Declaraci√≥n

Direcci√≥n de la CPU

5 2)

Escribir bits

Output

1 - 9999

Imagen de proceso de las
salidas

A0.0 - A1248.7

06

Escribir palabras

Holding Register

40001 - 49999
o
400001 - 465535

DW0 - DW19998
o
DW0 - DW131068

El √°rea de direcciones
M depende de la CPU

15

Escribir bits

Output

1 - 9999

Imagen de proceso de las
salidas

Q0.0 - Q1249.6

16 2)

Escribir palabras

Holding Register

40001 - 49999
o
400001 - 465535

DW0 - DW19998
o
DW0 - DW131068

El √°rea de direcciones
M depende de la CPU

1) FC = C√≥digo de funci√≥n
2) Con el valor de HR_Start_Offset se determina si con los FC 03, 05 y 16 se direccionan √°reas de datos o de marcas en la CPU
SIMATIC.

Comunicaci√≥n a trav√©s de USS
Procedimiento para establecer una conexi√≥n serie con Modbus USS
Requisitos
‚óè El hardware est√° montado y existe una conexi√≥n el√©ctrica con el interlocutor acoplado.
‚óè El proyecto ya est√° creado en STEP 7 (TIA Portal) y la CPU se ha insertado en la
configuraci√≥n hardware.

Procedimiento: configuraci√≥n hardware
1. Inserte el m√≥dulo de comunicaci√≥n CM PtP en la configuraci√≥n hardware.
2. Seleccione el protocolo Freeport y ajuste los par√°metros de comunicaci√≥n.
Nota: la funcionalidad USS se realiza con las instrucciones.

Procedimiento: programaci√≥n
1. Inserte la instrucci√≥n USS_Port_Scan de la librer√≠a USS Communication.
2. Interconecte el HWID de las variables del sistema en la entrada PORT.
3. Inserte la instrucci√≥n USS_Drive_Control de la librer√≠a USS Communication.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1743

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Interconecte la estructura de datos USS_DB en el DB de instancia de la instrucci√≥n
USS_Drive_Control en la entrada USS_DB de la instrucci√≥n USS_Port_Scan. La estructura
de datos contiene los datos que se van a transferir para todos los accionamientos.
5. Por cada eje adicional que deba conectarse a trav√©s de esta interfaz USS inserte una
llamada m√°s de la instrucci√≥n USS_Drive_Control.
Utilice el mismo DB de instancia cada vez. La diferenciaci√≥n es gracias a la direcci√≥n USS
que se especifica en la entrada DRIVE de la instrucci√≥n USS_Drive_Control. De esta
manera tendr√° a su disposici√≥n los datos de control y de respuesta en los par√°metros de la
respectiva llamada para cada accionamiento.

Resumen de la comunicaci√≥n USS
Clasificaci√≥n dentro del entorno del sistema
La siguiente descripci√≥n de USS se refiere al uso de los m√≥dulos de comunicaciones
correspondientes.
‚óè CM PtP RS232 BA
‚óè CM PtP RS422/485 BA
‚óè CM PtP RS232 HF
‚óè CM PtP RS422/485 HF
‚óè CM PtP (ET 200SP)

Introducci√≥n
El protocolo USS¬Æ (protocolo de interfaz en serie universal) es un protocolo sencillo de
transferencia de datos serie, que est√° adaptado a las necesidades de la tecnolog√≠a de
accionamientos.
El protocolo USS define una t√©cnica de acceso de acuerdo con el principio maestroesclavo
para la comunicaci√≥n a trav√©s de un bus serie. Es posible conectar al bus un maestro y un
m√°ximo de 16 accionamientos (esclavos). El maestro selecciona los diferentes
accionamientos en la trama con la ayuda de un car√°cter de direcci√≥n. Un accionamiento no
puede enviar datos nunca sin que el maestro haya iniciado la transferencia previamente. Esto
significa que no es posible una transferencia de datos directa entre accionamientos. La
comunicaci√≥n funciona en modo semid√∫plex. La funci√≥n del maestro no puede transferirse.
La tecnolog√≠a de accionamientos exige tiempos de reacci√≥n definidos para las tareas de
control y regulaci√≥n que deben realizarse y, por tanto, un tr√°fico de tramas con un ciclo estricto:
El maestro env√≠a tramas de forma continua (tramas de petici√≥n) a los accionamientos y espera
una trama de respuesta de cada accionamiento activado.
Un accionamiento debe enviar una trama de respuesta cuando
‚óè haya recibido correctamente una trama y
‚óè dicha trama estaba dirigida a √©l.
Un accionamiento no tiene permitido transmitir si no se cumplen las condiciones mencionadas
o si el accionamiento ha sido activado en Broadcast (difusi√≥n).

1744

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para el maestro, la conexi√≥n con los accionamientos en cuesti√≥n est√° establecida cuando
recibe una trama de respuesta del accionamiento tras un tiempo de procesamiento definido
(tiempo de retardo de respuesta).

Estructura de la trama
Cada trama empieza con un car√°cter de inicio (STX), seguido de la informaci√≥n sobre la
longitud (LGE) y el byte de direcci√≥n (ADR). A continuaci√≥n sigue el campo de datos. La trama
finaliza con el car√°cter de comprobaci√≥n de bloque (BCC). Para la longitud del telegrama se
tienen en cuenta los datos de usuario (n√∫mero n), el byte de direcci√≥n (ADR) y el car√°cter de
protecci√≥n de los datos (BCC).
STX

LGE

ADR

1

2

...

N

BCC

En el caso de datos compuestos por una palabra (16 bits), primero se env√≠a el byte High y
despu√©s el byte Low. En el caso de datos de palabras dobles, primero se env√≠a la palabra High
y, a continuaci√≥n, la palabra Low. La longitud de una trama se indica en bytes.

Cifrado de datos
Los datos se encriptan del modo siguiente:
‚óè STX: 1 byte, inicio de texto, 02H
‚óè LGE: 1 byte, contiene la longitud de trama como n√∫mero binario
‚óè ADR: 1 byte, contiene la direcci√≥n del esclavo y el tipo de trama en c√≥digo binario
‚óè Campos de datos: Un byte cada uno; el contenido depende de la petici√≥n
‚óè BCC: 1 byte, car√°cter de comprobaci√≥n de bloque

Procedimiento de transmisi√≥n de datos
El maestro se ocupa de la transferencia de datos c√≠clica en tramas. El maestro direcciona
sucesivamente todos los dispositivos esclavos con una trama de petici√≥n. Los dispositivos en
cuesti√≥n responden con una trama de respuesta. De acuerdo con el procedimiento maestro‚Äê
esclavo, el esclavo debe enviar la trama de respuesta al maestro despu√©s de haber recibido
la trama de petici√≥n. Solo entonces el maestro puede comunicarse con el siguiente esclavo.

Campo de datos en la trama
El campo de datos est√° dividido en dos secciones: Par√°metros (PKW) y datos de proceso
(PZD).
STX

LGE

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

ADR

Par√°metros (PKW)

Datos de proceso (PZD)

BCC

1745

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

‚óè √Årea de par√°metros (PKW)
El √°rea PKW gestiona la transferencia de par√°metros entre dos interlocutores (p. ej.
aut√≥mata y accionamiento). Esto incluye, por ejemplo, leer y escribir valores de par√°metros
as√≠ como leer descripciones de par√°metros y el texto correspondiente. La interfaz de PKW
suele contener peticiones de manejo y visualizaci√≥n, mantenimiento y diagn√≥stico.
‚óè √Årea de datos de proceso (PZD)
El √°rea PZD incluye se√±ales necesarias para la automatizaci√≥n:
‚Äì Palabras de control y consignas del maestro al esclavo
‚Äì Palabras de estado y valores reales del esclavo al maestro
Los accionamientos esclavos definen el contenido del √°rea de par√°metros y del √°rea de
datos de proceso.
Encontrar√° m√°s informaci√≥n al respecto en la documentaci√≥n del accionamiento.

Sinopsis de funciones
Secuencia de transmisi√≥n
Las instrucciones procesan c√≠clicamente la transferencia de datos con un m√°ximo de 16
accionamientos esclavos. Cada accionamiento solo tiene una petici√≥n activa.

Caracter√≠sticas de prestaciones:
‚óè Creaci√≥n de √°reas de datos para la comunicaci√≥n seg√∫n la configuraci√≥n de bus
‚óè Ejecuci√≥n y supervisi√≥n de peticiones de PKW
‚óè Supervisi√≥n de todo el sistema y tratamiento de errores
‚óè Comunicaci√≥n con la CPU
‚óè Acceso a las funciones del accionamiento
‚óè Lectura de los par√°metros del accionamiento
‚óè Escritura de los par√°metros del accionamiento

Programaci√≥n - Comunicaci√≥n mediante instrucciones
Resumen de la programaci√≥n PtP
Intercambio de datos mediante comunicaci√≥n Freeport o 3964 (R)
Los datos enviados deben ponerse a disposici√≥n en bloques de datos o en el √°rea de marcas
en el programa de usuario de la CPU correspondiente. En el m√≥dulo de comunicaciones existe
un b√∫fer de recepci√≥n para los datos recibidos. Se crea el bloque de datos correspondiente en
la CPU.

1746

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el programa de usuario de la CPU, las siguientes instrucciones se encargan de la
transferencia de datos entre la CPU y el m√≥dulo de comunicaci√≥n.
‚óè Send_P2P
‚óè Receive_P2P
La instrucci√≥n Receive_Reset permite borrar el b√∫fer de recepci√≥n.

Configuraci√≥n din√°mica mediante el programa de usuario
Alternativa o complementariamente a la parametrizaci√≥n de la interfaz del m√≥dulo de
comunicaciones descrita en el cap√≠tulo Configuraci√≥n/parametrizaci√≥n de un m√≥dulo de
comunicaciones (P√°gina 1723), en determinados campos de aplicaci√≥n puede ser ventajoso
establecer la comunicaci√≥n din√°micamente, es decir, controlada por programa mediante una
aplicaci√≥n espec√≠fica.
Todas las parametrizaciones realizadas en el cuadro de di√°logo de propiedades del m√≥dulo de
comunicaci√≥n se pueden modificar tambi√©n en tiempo de ejecuci√≥n con una de las siguientes
instrucciones "Config":
Port_Config, Send_Config, Receive_Config, P3964_Config

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1747

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Secuencia de las llamadas de programa para la comunicaci√≥n PtP
El gr√°fico siguiente ilustra la funci√≥n de las instrucciones PtP para la secuencia de
comunicaci√≥n entre el programa de usuario y el interlocutor.
6HQGB33

0¬µGXORGH
FRPXQLFDFL¬µQ

5HFHLYHB33
3RUWB&RQILJ
,QWHUORFXWRU
6HQGB&RQILJ
5HFHLYHB&RQILJ
3B&RQILJ

6LJQDOB*HW
6LJQDOB6HW
5HFHLYHB5HVHW

*HWB)HDWXUHV
6HWB)HDWXUHV

1748

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Instrucciones PtP

Aplicaci√≥n

Instrucci√≥n

Send_P2P
Intercambio de datos
entre la CPU, el m√≥dulo
de comunicaci√≥n y el in‚Äê
terlocutor (comunica‚Äê
ci√≥n)

Descripci√≥n
La instrucci√≥n Send_P2P (enviar datos punto a punto) permite enviar datos al
interlocutor.
Para transferir datos con el protocolo Freeport, llame la instrucci√≥n Send_P2P.
Debe llamar la instrucci√≥n de forma c√≠clica hasta que reciba el acuse corres‚Äê
pondiente en los par√°metros de salida de la instrucci√≥n.
Nota: Al parametrizar el control del flujo de datos XON/XOFF, los datos de
usuario no deben contener ninguno de los caracteres XON o XOFF parame‚Äê
trizados. Los ajustes predeterminados son DC1 = 11H para XON y DC3 = 13H
para XOFF.

Receive_P2P

La instrucci√≥n Receive_P2P (recibir datos punto a punto) permite recoger los
mensajes que se han recibido de un interlocutor en el m√≥dulo de comunicaci√≥n.
Para recibir datos con el protocolo Freeport, llame la instrucci√≥n Receive_P2P
de forma c√≠clica. La instrucci√≥n indica si hay nuevos datos recibidos en el
par√°metro NDR.
Para indicar al receptor cu√°ndo empieza la transmisi√≥n de un mensaje y cu√°n‚Äê
do ha finalizado, hay que definir en el protocolo Freeport criterios que identifi‚Äê
quen el principio y el fin de un mensaje.

Borrado del b√∫fer de re‚Äê Receive_Reset
cepci√≥n
Parametrizaci√≥n din√°‚Äê
mica de la interfaz o del
protocolo (opcional)

La instrucci√≥n Receive_Reset (borrar b√∫fer de recepci√≥n) permite borrar el
b√∫fer de recepci√≥n del m√≥dulo de comunicaciones.

Port_Config

La instrucci√≥n Port_Config (configuraci√≥n de puerto) permite configurar de for‚Äê
ma din√°mica par√°metros b√°sicos de la interfaz, como velocidad de transferen‚Äê
cia de datos, paridad y control del flujo de datos, a trav√©s del programa de
usuario.

Send_Config

La instrucci√≥n Send_Config (parametrizaci√≥n de la transmisi√≥n) permite confi‚Äê
gurar de forma din√°mica par√°metros de transmisi√≥n serie, como retardo RTS
ON/RTS OFF para una interfaz de comunicaci√≥n PtP.

Receive_Config

La instrucci√≥n Receive_Config (parametrizaci√≥n de la recepci√≥n) permite con‚Äê
figurar din√°micamente par√°metros de recepci√≥n serie de un m√≥dulo de comu‚Äê
nicaci√≥n.
Esta instrucci√≥n parametriza las condiciones que marcan el principio y fin de un
mensaje recibido.

Control de las se√±ales
cualificadoras RS232

Activar compatibilidad
Modbus CRC y alarma
de diagn√≥stico

P3964_Config

La instrucci√≥n P3964_Config (configuraci√≥n del protocolo) permite configurar
de forma din√°mica desde el programa los par√°metros de protocolo del proce‚Äê
dimiento 3964(R), como tiempo de retardo de caracteres, prioridad y compro‚Äê
baci√≥n de bloque.

Signal_Get

La instrucci√≥n Signal_Get (consultar se√±ales RS232) permite leer los estados
actuales de las se√±ales RS232.

Signal_Set

La instrucci√≥n Signal_Set (consultar se√±ales RS232) permite activar los esta‚Äê
dos de las se√±ales RS232 DTR y RTS.

Get_Features

La instrucci√≥n Get_Features (activar funciones avanzadas) permite consultar
informaci√≥n sobre la compatibilidad con Modbus y sobre la generaci√≥n de alar‚Äê
mas de diagn√≥stico.

Set_Features

La instrucci√≥n Set_Features (ajustar funciones avanzadas) permite activar la
generaci√≥n de alarmas de diagn√≥stico, siempre que el m√≥dulo la soporte.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1749

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Procedimiento de configuraci√≥n de la comunicaci√≥n Freeport o 3964 (R)
Requisitos: la configuraci√≥n y parametrizaci√≥n de una CPU y de un m√≥dulo de comunicaciones
en la vista de dispositivos y en el di√°logo de propiedades del m√≥dulo de comunicaciones han
concluido.
1. Seleccione en el √°rbol del proyecto de la CPU la carpeta "Bloques de programa" y abra el
Main (OB1) de la carpeta haciendo doble clic. Se abre el "Editor de programas".
2. Seleccione en la Task Card "Instrucciones", en el campo "Comunicaci√≥n", las instrucciones
Send_P2P y Receive_P2P y despl√°celas a una red del Main (OB1) mediante arrastrar y
soltar.
3. Parametrice las instrucciones seg√∫n sus especificaciones.
4. Cargue la configuraci√≥n hardware y el programa de usuario en la CPU.

Resumen de la programaci√≥n Modbus
Secuencia de las llamadas de programa para la comunicaci√≥n Modbus
El gr√°fico siguiente ilustra la funci√≥n de las instrucciones Modbus para la secuencia de
comunicaci√≥n entre el programa de usuario y un dispositivo Modbus. (Se requieren las
instrucciones Send_P2P, Receive_P2P y las instrucciones "Config" subordinadas).
0RGEXVB0DVWHU'%
0RGEXVB0DVWHU

6HQGB33

0¬µGXORGH
FRPXQLFDFLRQHV
0DHVWUR

5HFHLYHB33
0RGEXVB&RPPB/RDG'%
0RGEXVB&RPPB/RDG

0RGEXVB6ODYH'%
0RGEXVB6ODYH
0RGEXVB&RPPB/RDG'%
0RGEXVB&RPPB/RDG

1750

B&RQILJ

6HQGB33

'LVSRVLWLYR
0RGEXV

0¬µGXORGH
FRPXQLFDFLRQHV
(VFODYR

5HFHLYHB33
B&RQILJ

'LVSRVLWLYR
0RGEXV

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Instrucciones Modbus
Aplicaci√≥n

Instrucci√≥n

Descripci√≥n

Intercambio de da‚Äê
tos entre el progra‚Äê
ma de usuario y el
dispositivo Modbus
(comunicaci√≥n)

Modbus_Master

La instrucci√≥n Modbus_Master permite comunicarse a trav√©s del puerto PtP en
calidad de maestro Modbus.
Con la instrucci√≥n Modbus_Master es posible utilizar la CPU como dispositivo
maestro Modbus RTU para la comunicaci√≥n con uno o varios dispositivos es‚Äê
clavos Modbus.

Modbus_Slave

La instrucci√≥n Modbus_Slave permite comunicarse a trav√©s del puerto PtP en
calidad de esclavo Modbus.
Con la instrucci√≥n Modbus_Slave es posible utilizar la CPU como dispositivo
esclavo Modbus RTU para la comunicaci√≥n con un dispositivo maestro Modbus.

Parametrizaci√≥n de Mod‚Äê
la interfaz y del pro‚Äê bus_Comm_Load
tocolo (obligatoria)

La instrucci√≥n Modbus_Comm_Load permite configurar el puerto del m√≥dulo de
comunicaciones para Modbus RTU.
Es necesario ejecutar Modbus_Comm_Load para establecer par√°metros de
puerto PtP como velocidad de transferencia de datos, paridad y control del flujo.
Una vez se ha configurado la interfaz para el protocolo Modbus RTU, solo
pueden utilizarla la instrucci√≥n Modbus_Master o la instrucci√≥n Modbus_Slave .

Nota
Uso alternativo de Modbus_Slave y Modbus_Master
Un m√≥dulo de comunicaciones puede utilizarse como maestro o como esclavo.

Procedimiento para configurar la comunicaci√≥n Modbus
Requisitos: la configuraci√≥n y parametrizaci√≥n de una CPU y de un m√≥dulo de comunicaciones
en la vista de dispositivos y en el di√°logo de propiedades del m√≥dulo de comunicaciones han
concluido.
1. Seleccione en el √°rbol del proyecto de la CPU la carpeta "Bloques de programa" y abra el
Main (OB1) de la carpeta haciendo doble clic. Se abre el "Editor de programas".
2. Seleccione en la Task Card "Instrucciones", en el campo "Comunicaci√≥n", las instrucciones
para la comunicaci√≥n Modbus seg√∫n la tarea planteada y despl√°celas a una red del Main
(OB1) mediante arrastrar y soltar:
‚Äì La instrucci√≥n Modbus_Comm_Load configura el puerto del CM para la comunicaci√≥n
Modbus.
La instrucci√≥n Modbus_Comm_Load debe ser llamada en el Main (OB1) hasta que se
muestre DONE (o ERROR).
‚Äì La instrucci√≥n Modbus_Master se utiliza para la funcionalidad de maestro Modbus.
‚Äì La instrucci√≥n Modbus_Slave se utiliza para la funcionalidad de esclavo Modbus.
3. Parametrice las instrucciones seg√∫n sus especificaciones.
4. Cargue la configuraci√≥n hardware y el programa de usuario en la CPU.

Consulte tambi√©n
Resumen de las instrucciones (P√°gina 1704)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1751

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Resumen de la programaci√≥n USS
Secuencia de las llamadas de programa para la comunicaci√≥n USS
El gr√°fico siguiente ilustra la funci√≥n de las instrucciones USS para la secuencia de
comunicaci√≥n entre el programa de usuario y el accionamiento USS. (Se requieren las
instrucciones Send_P2P, Receive_P2P y las instrucciones "Config" subordinadas).
'%GHLQVWDQFLD
866B3RUWB6FDQ
'%GHLQVWDQFLD
866B'ULYHB&RQWURO
$FFWR
866B'ULYHB&RQWURO
$FFWR

866B'ULYHB&RQWURO
$FFWR

6HQGB33

0¬µGXORGH
FRPXQLFDFLRQHV
PDHVWUR

5HFHLYHB33
B&RQILJ

866
$FFWR
866
$FFWR
866
$FFWR

866B5HDGB3DUDP
866B:ULWHB3DUDP

1752

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Instrucciones USS
Aplicaci√≥n

Instrucci√≥n

Comunicaci√≥n de datos USS_Port_Scan
entre la CPU, el m√≥dulo
de comunicaci√≥n y el ac‚Äê
cionamiento USS

Descripci√≥n
La instrucci√≥n USS_Port_Scan permite la comunicaci√≥n a trav√©s de un
m√≥dulo de comunicaci√≥n con hasta 16 accionamientos, a trav√©s de una
red USS (debe ser llamada de forma c√≠clica).
La instrucci√≥n USS_Port_Scan controla la comunicaci√≥n entre la CPU y los
accionamientos a trav√©s del puerto de comunicaci√≥n PtP. Cada vez que se
llama esta funci√≥n se procesa una comunicaci√≥n con un accionamiento. La
instrucci√≥n USS_Port_Scan es requerida una vez.
Puesto que la mayor√≠a de los accionamientos disponen de una funci√≥n
interna parametrizable que vigila la integridad de la comunicaci√≥n median‚Äê
te un timeout, la instrucci√≥n USS_Port_Scan debe ser llamada desde un
OB controlado por tiempo.

Intercambiar datos con
un accionamiento USS

USS_Drive_Control

La instrucci√≥n USS_Drive_Control permite preparar los datos enviados
para un accionamiento y visualizar los datos recibidos.
Las entradas y salidas de la instrucci√≥n corresponden a los estados y las
funciones de control del accionamiento. La instrucci√≥n USS_Drive_Control
debe llamarse una vez por accionamiento. Para todas las llamadas de la
instrucci√≥n USS_Drive_Control a una red USS, solo es necesario un DB de
instancia com√∫n. Interconecte todas las llamadas de la instrucci√≥n
USS_Drive_Control para una red USS con el mismo DB de instancia.
La instrucci√≥n USS_Drive_Control debe llamarse desde el Main (OB1)
c√≠clico del programa principal.

Leer o modificar par√°‚Äê
USS_Read_Param
metros del accionamien‚Äê
to USS

La instrucci√≥n USS_Read_Param permite leer par√°metros del acciona‚Äê
miento.
Con la instrucci√≥n USS_Read_Param se leen los par√°metros operativos
del accionamiento que controlan las funciones internas del mismo.
La instrucci√≥n USS_Read_Param debe llamarse desde el Main (OB1) c√≠c‚Äê
lico del programa principal.

USS_Write_Param

La instrucci√≥n USS_Write_Param permite modificar par√°metros del accio‚Äê
namiento.
La instrucci√≥n USS_Write_Param debe llamarse desde el Main (OB1) c√≠c‚Äê
lico del programa principal.

Procedimiento para configurar la comunicaci√≥n USS
Requisitos: la configuraci√≥n y parametrizaci√≥n de una CPU y de un m√≥dulo de comunicaciones
en la vista de dispositivos y en el di√°logo de propiedades del m√≥dulo de comunicaciones han
concluido.
1. Seleccione en el √°rbol del proyecto de la CPU la carpeta "Bloques de programa" y abra el
OB controlado por tiempo deseado haciendo doble clic. Se abre el "Editor de programas".
2. Seleccione en la Task Card "Instrucciones", en el campo "Comunicaci√≥n", la instrucci√≥n
USS_Port_Scan y despl√°cela a una red del OB controlado por tiempo mediante arrastrar y
soltar.
La instrucci√≥n USS_Port_Scan permite la comunicaci√≥n a trav√©s de la red USS.
3. Seleccione en el √°rbol del proyecto de la CPU la carpeta "Bloques de programa" y abra el
Main (OB1) de la carpeta haciendo doble clic. Se abre el "Editor de programas".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1753

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
4. Seleccione en la Task Card "Instrucciones", en el campo "Comunicaci√≥n", las instrucciones
para la comunicaci√≥n USS seg√∫n la tarea planteada y despl√°celas a una red del Main (OB1)
mediante arrastrar y soltar:
‚Äì La instrucci√≥n USS_Drive_Control sirve para el intercambio de datos con el
accionamiento.
‚Äì La instrucci√≥n USS_Read_Param sirve para leer par√°metros del accionamiento.
‚Äì La instrucci√≥n USS_Write_Param sirve para modificar par√°metros del accionamiento.
5. Parametrice las instrucciones seg√∫n sus especificaciones.
6. Cargue la configuraci√≥n hardware y el programa de usuario en la CPU.

Consulte tambi√©n
Resumen de las instrucciones (P√°gina 1704)

Arranque y diagn√≥stico
Comportamiento de arranque
Transiciones de estado operativo
Tras el arranque del m√≥dulo de comunicaciones se intercambian todos los datos entre la CPU
y el m√≥dulo de comunicaciones a trav√©s de instrucciones.
STOP de la CPU
RUN de la CPU

Si hay una transferencia de datos en curso entre el m√≥dulo de co‚Äê
municaciones y la CPU, ya sea una petici√≥n de transmisi√≥n o de
recepci√≥n, se interrumpe.
En el estado RUN de la CPU est√° garantizado el intercambio de
datos, ya sea env√≠o o recepci√≥n.
Con la parametrizaci√≥n correspondiente en el cuadro de di√°logo de
propiedades del m√≥dulo se puede borrar autom√°ticamente el b√∫fer
de recepci√≥n del m√≥dulo de comunicaciones durante el arranque de
la CPU.

Desde el punto de vista del m√≥dulo de comunicaciones, no hay m√°s estados operativos/
transiciones de estado operativo.

1754

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Funciones de diagn√≥stico
Introducci√≥n
Las funciones de diagn√≥stico del m√≥dulo de comunicaciones permiten localizar r√°pidamente
los errores ocurridos. Para ello existen varias posibilidades de diagn√≥stico:
Diagn√≥stico a trav√©s de los elementos
de indicaci√≥n del m√≥dulo de comunica‚Äê
ciones

Los elementos de indicaci√≥n informan sobre el estado operativo o posibles esta‚Äê
dos de error del m√≥dulo de comunicaciones. Los elementos de indicaci√≥n pro‚Äê
porcionan una primera vista general sobre los errores internos y externos ocurri‚Äê
dos, as√≠ como los errores espec√≠ficos de interfaz. Encontrar√° m√°s informaci√≥n al
respecto en el manual de producto del m√≥dulo de comunicaciones correspon‚Äê
diente.

Diagn√≥stico a trav√©s de la salida STA‚Äê
TUS de las instrucciones

Las instrucciones disponen de una salida STATUS destinada al diagn√≥stico, que
proporciona informaci√≥n sobre errores de comunicaci√≥n entre el m√≥dulo de co‚Äê
municaciones y la CPU. El par√°metro STATUS se puede evaluar en el programa
de usuario (permanece pendiente durante un ciclo exacto).

Alarma de diagn√≥stico

El m√≥dulo de comunicaciones puede lanzar una alarma de diagn√≥stico en la CPU
que tiene asignada. El m√≥dulo de comunicaciones pone a disposici√≥n informaci√≥n
de diagn√≥stico. Dicha informaci√≥n se eval√∫a a trav√©s del programa de usuario o
leyendo el b√∫fer de diagn√≥stico de la CPU.

Alarmas de diagn√≥stico
Los diagn√≥sticos se muestran en texto expl√≠cito en STEP 7 (TIA Portal) en la vista Online y
diagn√≥stico. Los c√≥digos de error pueden evaluarse con el programa de usuario.
Se pueden emitir los siguientes diagn√≥sticos:
‚óè Error (9H)
‚óè Error de parametrizaci√≥n (10H)
‚óè Rotura de hilo (109H)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1755

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

1.4.5

Configuraciones para acoplamientos punto a punto (S7-300, S7-400)

1.4.5.1

Configuraciones para acoplamientos punto a punto

Introducci√≥n
Sinopsis de los componentes e interfaces
Contenido
Resumen tabular de los distintos tipos de m√≥dulos y sus funciones.
Para CP 340/341/440/441 y ET 200S 1SI
M√≥dulo

Interfaz

Protocolo
ASCII

3964(R)

RK512

Driver de
impresora

Maestro
Modbus

Esclavo
Modbus

Maestro
USS

CP 340

RS232 C

X

X

-

X

-

-

-

CP 340

20 mA TTY

X

X

-

X

-

-

-

CP 340 1)

RS422

X

X

-

X

-

-

-

RS485

X

-

-

-

-

-

-

CP 341

RS232 C

X

X

X

X

X 2)

X 2)

-

CP 341

20 mA TTY

X

X

X

X

X 2)

X 2)

-

CP 341 1)

RS422

X

X

X

X

X 2)

X 2)

-

RS485

X

-

-

X

X 2)

X 2)

-

RS422

X

X

-

-

-

-

-

RS485

X

-

-

-

-

-

-

CP 441-1

RS232 C

X

X

-

X

-

-

-

CP 441-1

20 mA TTY

X

X

-

X

-

-

-

CP 441-1 1)

RS422

X

X

-

X

-

-

-

RS485

X

-

-

X

-

-

-

CP 441-2

RS232 C

X

X

X

X

X 2)

X 2)

-

CP 441-2

20 mA TTY

X

X

X

X

X 2)

X 2)

-

CP 441-2 1)

RS422

X

X

X

X

X 2)

X 2)

-

RS485

X

-

-

X

-

-

-

RS232 C

X

X

-

-

-

-

-

RS422

X

X

-

-

-

-

-

RS485

X

-

-

-

-

-

-

-

-

-

-

X

X

X

-

-

-

-

X

X

-

-

-

-

-

X

X

X

CP 440

ET 200S 1SI pa‚Äê
ra ASCII y
3964(R)

ET 200S 1SI pa‚Äê RS232 C
ra Modbus y USS RS422
RS485
CPU 313C-2 PtP RS422

X

X

-

-

-

-

-

RS485

X

-

-

-

-

-

-

1756

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
M√≥dulo

Interfaz

Protocolo
ASCII

3964(R)

RK512

Driver de
impresora

Maestro
Modbus

Esclavo
Modbus

Maestro
USS

CPU 314C-2 PtP RS422

X

X

X

-

-

-

-

RS485

X

-

-

-

-

-

-

1)

La diferencia entre RS 422 y RS 485 se define en el cuadro de di√°logo de par√°metros.

2)

Para el protocolo Modbus es necesario un driver cargable con un dongle.

Se√±ales cualificadoras y control del flujo de datos
Con los protocolos ASCII, Maestro Modbus y Esclavo Modbus es posible manejar las se√±ales
cualificadoras RS232C a trav√©s de la interfaz RS232C.
El control del flujo de datos con RTS/CTS en los protocolos ASCII y driver de impresora puede
realizarse a trav√©s de la interfaz RS 232C.
El control del flujo de datos con XON/XOFF en los protocolos ASCII y driver de impresora
puede realizarse a trav√©s de las interfaces RS 232C, 20mA TTY y RS 422.

Resumen de instrucciones
Resumen de instrucciones
La comunicaci√≥n entre CPU, m√≥dulo de comunicaci√≥n y un interlocutor se desarrolla a trav√©s
de las instrucciones y los protocolos del m√≥dulo de comunicaci√≥n.
Las instrucciones conforman la interfaz de software entre la CPU y el m√≥dulo de comunicaci√≥n.
Deben llamarse c√≠clicamente desde el programa de usuario.
En el m√≥dulo de comunicaci√≥n se produce la conversi√≥n de los protocolos de transmisi√≥n. A
trav√©s del protocolo se adapta la interfaz del m√≥dulo de comunicaci√≥n a la interfaz del
interlocutor.
Tabla 1-112 Instrucciones para el CP 340
Instrucci√≥n

Significado

P_SEND

La instrucci√≥n P_SEND permite enviar a un interlocutor una √°rea completa o par‚Äê
cial de un bloque de datos.

P_RCV

La instrucci√≥n P_RCV permite recibir datos de un interlocutor y depositarlos en un
bloque de datos.

P_PRINT

La instrucci√≥n P_PRINT permite transmitir a una impresora un texto de aviso con
hasta 4 variables.

P_RESET

La instrucci√≥n P_RESET permite inicializar el b√∫fer de recepci√≥n interno del
CP 340.

V24_STAT_340

La instrucci√≥n V24_STAT permite leer los estados l√≥gicos en la interfaz RS 232C
del CP 340-RS 232C.

V24_SET_340

La instrucci√≥n V24_SET permite activar/desactivar las salidas de la interfaz
RS 232C del CP 340-RS 232C.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1757

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tabla 1-113 Instrucciones para el CP 341
Instrucci√≥n

Significado

P_SND_RK

Con la instrucci√≥n P_SND_RK se puede tanto enviar a un interlocutor el √°rea
completa o parcial de un bloque de datos como recoger datos de dicho interlocutor
(utilizando RK512).

P_RCV_RK

Con la instrucci√≥n P_RCV_RK se puede tanto recibir datos de un interlocutor y
depositarlos en un bloque de datos como preparar datos para dicho interlocutor
(utillizando RK512).

P_PRINT341

La instrucci√≥n P_PRINT341 permite transmitir a una impresora un texto de aviso
con hasta 4 variables.

V24_STAT

La instrucci√≥n V24_STAT permite leer los estados de se√±al en la interfaz RS 232C
del CP 341-RS 232C.

V24_SET

La instrucci√≥n V24_SET permite activar/desactivar las salidas de la interfaz
RS 232C del CP 341-RS 232C.

Tabla 1-114 Instrucciones para el CPU 313C-2 PTP
Instrucci√≥n

Significado

SEND_PTP

Con la instrucci√≥n SEND_PTP se puede enviar a un interlocutor el √°rea completa
o parcial de un bloque de datos.

RCV_PTP

Con la instrucci√≥n RCV_PTP se pueden recibir datos de un interlocutor y deposi‚Äê
tarlos en un bloque de datos.

RES_RCVB

Con la instrucci√≥n RES_RCVB se puede inicializar el b√∫fer de recepci√≥n del m√≥‚Äê
dulo.

Tabla 1-115 Instrucciones para el CPU 314C-2 PTP

1758

Instrucci√≥n

Significado

SEND_PTP

Con la instrucci√≥n SEND_PTP se puede enviar a un interlocutor el √°rea completa
o parcial de un bloque de datos.

RCV_PTP

Con la instrucci√≥n RCV_PTP se pueden recibir datos de un interlocutor y deposi‚Äê
tarlos en un bloque de datos.

RES_RCVB

Con la instrucci√≥n RES_RCVB se puede inicializar el b√∫fer de recepci√≥n del m√≥‚Äê
dulo.

SEND_RK

Con la instrucci√≥n SEND_RK se puede enviar a un interlocutor el √°rea completa o
parcial de un bloque de datos con el protocolo RK512.

FETCH_RK

Con la instrucci√≥n FETCH_RK se pueden solicitar datos de interlocutor con el
protocolo RK512

SERVE_RK

Con la instrucci√≥n SERVE_RK y el protocolo RK512 se puede tanto recibir datos
de un interlocutor y depositarlos en un bloque de datos como preparar datos para
dicho interlocutor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tabla 1-116 Instrucciones para el CP 440
Instrucci√≥n

Significado

SEND_440

Con la instrucci√≥n SEND_440 se puede enviar a un interlocutor el √°rea completa
o parcial de un bloque de datos.

RECV_440

Con la instrucci√≥n RECV_440 se pueden recibir datos de un interlocutor y depo‚Äê
sitarlos en un bloque de datos.

RES_RECV

Con la instrucci√≥n RES_RECV se puede restablecer el b√∫fer de recepci√≥n del
CP 440.

Tabla 1-117 Instrucciones para el CP 441
Instrucci√≥n

Significado

V24_STAT_441

La instrucci√≥n V24_STAT_441 permite leer los estados l√≥gicos en la interfaz
RS 232C del CP 441.

V24_SET_441

La instrucci√≥n V24_SET_441 permite activar/desactivar las salidas en la interfaz
RS 232C del CP 441 .

El sistema de automatizaci√≥n S7-400 ofrece una serie de instrucciones que inician y controlan la
comunicaci√≥n entre la CPU y el procesador de comunicaci√≥n CP 441 en el programa de usuario. Estas
instrucciones se encuentran depositadas de manera fija en la memoria de la CPU (v√©ase el apartado
"Instrucciones del sistema de automatizaci√≥n S7-400", situado m√°s abajo).

Tabla 1-118 Instrucciones para el ET 200S 1SI
Instrucci√≥n

Significado

S_SEND

La instrucci√≥n S_SEND permite enviar a un interlocutor una √°rea completa o par‚Äê
cial de un bloque de datos.

S_RCV

La instrucci√≥n S_RCV permite recibir datos de un interlocutor y depositarlos en un
bloque de datos.

S_VSTAT

La instrucci√≥n S_VSTAT permite leer los estados de se√±al en la interfaz RS 232C
del m√≥dulo ET 200S 1SI.

S_VSET

La instrucci√≥n S_VSET permite establecer/restablecer las salidas de la interfaz
RS 232C del m√≥dulo ET 200S 1SI.

S_XON

Con la instrucci√≥n S_XON puede definir par√°metros adicionales en caso de que se
haya parametrizado el m√≥dulo para el control de flujo XON/XOFF.

S_RTS

Con la instrucci√≥n S_RTS puede definir par√°metros adicionales en caso de que se
haya parametrizado el m√≥dulo para el control de flujo RTS/CTS.

S_V24

Con la instrucci√≥n S_V24 puede definir par√°metros adicionales en caso de que se
haya parametrizado el m√≥dulo para el uso autom√°tico de las se√±ales V.24.

S_MODB

La instrucci√≥n S_MODB permite establecer una comunicaci√≥n con un sistema de
control maestro Modbus y transformar las direcciones Modbus en √°reas de me‚Äê
moria SIMATIC.

S_USST

La instrucci√≥n S_USST gestiona la transmisi√≥n de los datos de red (PZD y even‚Äê
tualmente datos PKW) a los esclavos seg√∫n la estructura de datos de red utiliza‚Äê
da.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1759

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Instrucci√≥n

Significado

S_USSR

La instrucci√≥n S_USSR gestiona la recepci√≥n de los datos de red (PZD y even‚Äê
tualmente datos PKW) a los esclavos seg√∫n la estructura de datos de red utiliza‚Äê
da.

S_USSI

Si se activa la instrucci√≥n S_USSI durante el arranque del sistema S7, se gene‚Äê
rar√°n los DB de procesador de comunicaci√≥n, de datos de red y de parametriza‚Äê
ci√≥n necesarios para la comunicaci√≥n.

Tabla 1-119 Instrucciones para el Modbus
Instrucci√≥n

Significado

MODB_341

Con la instrucci√≥n MODB_341 y el driver correspondiente se permite una conexi√≥n
de comunicaci√≥n entre un sistema de control de maestro Modbus y el sistema
esclavo compatible con Modbus CP 341 del m√≥dulo de comunicaci√≥n.

MODB_441

Con la instrucci√≥n MODB_441 y el driver correspondiente se permite una conexi√≥n
de comunicaci√≥n entre un sistema de control de maestro Modbus y el sistema
esclavo compatible con Modbus CP 441-2 del m√≥dulo de comunicaci√≥n.

Instrucciones del sistema de automatizaci√≥n S7-400
En la tabla que sigue a continuaci√≥n encontrar√° las instrucciones del sistema de
automatizaci√≥n S7-400 disponibles para establecer la comunicaci√≥n entre la CPU y el CP 441.
Tabla 1-120 Instrucciones del sistema de automatizaci√≥n S7-400
Instrucci√≥n

Significado

BSEND

Con la instrucci√≥n BSEND se pueden enviar datos de una √°rea de datos S7 a un
interlocutor con un destino indicado.

BRCV

Con la instrucci√≥n BRCV se pueden recibir datos de un interlocutor y transferirlos
a una √°rea de datos S7.

GET

S√≥lo con RK512: Con la instrucci√≥n GET se pueden recoger datos de un interlo‚Äê
cutor.

PUT

S√≥lo con RK512: Con la instrucci√≥n PUT se pueden enviar datos a un interlocutor
con una introducci√≥n din√°mica y modificable de la direcci√≥n.

PRINT

La instrucci√≥n PRINT permite imprimir un texto de aviso con hasta cuatro varia‚Äê
bles.

STATUS

Con la instrucci√≥n STATUS se puede consultar el estado de una conexi√≥n de
comunicaci√≥n.

M√°s informaci√≥n
Encontrar√° una descripci√≥n detalladla de las instrucciones del sistema de automatizaci√≥n
S7-400 y sus par√°metros en: Resumen de instrucciones para la comunicaci√≥n del S7

1760

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n b√°sica
Transferencia en serie de un car√°cter
Introducci√≥n
Existen distintas posibilidades de conexi√≥n para el intercambio de datos entre dos o m√°s
interlocutores. El acoplamiento punto a punto entre dos interlocutores es la forma m√°s sencilla
de intercambio de informaci√≥n.

Acoplamiento punto a punto
En el acoplamiento punto a punto, el m√≥dulo de comunicaci√≥n crea una interfaz entre un
aut√≥mata programable y un interlocutor. En el acoplamiento punto a punto, la transmisi√≥n de
datos con el m√≥dulo de comunicaci√≥n es serial.
En el m√≥dulo de comunicaci√≥n se produce la conversi√≥n a los mecanismos de
direccionamiento del procedimiento de transmisi√≥n seleccionado. Por ello, la conexi√≥n punto
a punto ya termina en el m√≥dulo de comunicaci√≥n y no en el interlocutor, como ocurre en otras
conexiones.

Transmisi√≥n de datos en serie
En la transmisi√≥n de datos en serie, los bits individuales de un byte correspondiente a la
informaci√≥n que desea transferirse se transmiten uno detr√°s de otro en un orden fijo.

Intercambio de datos unidireccional/bidireccional
La transmisi√≥n de datos con el interlocutor se desarrolla independientemente en una interfaz
serie del m√≥dulo de comunicaci√≥n. Para ello, el m√≥dulo de comunicaci√≥n est√° equipado con
tres drivers distintos.
‚óè Intercambio de datos unidireccional:
‚Äì Driver de impresora
‚óè Intercambio de datos bidireccional:
‚Äì Driver ASCII
‚Äì Procedimiento 3964(R)
‚Äì Protocolo para mainframe RK512
‚Äì Modbus/USS
El m√≥dulo de comunicaci√≥n desarrolla la transmisi√≥n de datos a trav√©s de una interfaz serie en
funci√≥n de la f√≠sica de la interfaz y del driver seleccionado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1761

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Intercambio de datos unidireccional - Proceso de impresi√≥n
En el proceso de impresi√≥n (driver de impresora) se env√≠an a una impresora n bytes de datos
√∫tiles. Sin embargo, no se produce una recepci√≥n de caracteres. Se excluyen los caracteres
de control individuales para el control de flujo (p. ej., XON/XOFF).

Intercambio de datos bidireccional - Modos de operaci√≥n
En el m√≥dulo de comunicaci√≥n, y para el intercambio de datos bidireccional, se distingue entre
dos modos de operaci√≥n:
‚óè Modo semid√∫plex (procedimiento 3964(R), driver ASCII, RK 512, Modbus/USS)
Los datos se transfieren entre uno o varios interlocutores variando en ambas direcciones.
Un modo semid√∫plex es un modo en que, dependiendo del momento, se realizar√°n env√≠os
o recepciones. La excepci√≥n en este caso puede venir dada por los caracteres de control
individuales para el control del flujo de datos (p. ej., XON/XOFF), que tambi√©n pueden
resultar enviados o recibidos durante el modo de env√≠o/recepci√≥n.
‚óè Modo d√∫plex (driver ASCII)
Los datos se intercambian simult√°neamente entre uno o varios interlocutores; en un
determinado punto puede tanto enviarse como recibirse. Cada interlocutor deber√° poder
utilizar simult√°neamente una direcci√≥n de env√≠o y recepci√≥n.
En el subm√≥dulo de interfaz X27 (RS 422/485) √∫nicamente puede trabajarse con un ajuste
RS 485 (2 hilos) en el modo semid√∫plex.

Transmisi√≥n de datos as√≠ncrona
En el m√≥dulo de comunicaci√≥n se realiza una transmisi√≥n de datos as√≠ncrona en serie. La as√≠
llamada sincronizaci√≥n de tiempo (periodo de tiempo fijo durante la transferencia de una
secuencia fija de caracteres) s√≥lo se mantiene durante la transferencia de un car√°cter. Cada
uno de los caracteres que vaya a transferirse recibe un impulso de sincronizaci√≥n, tambi√©n
llamado bit de arranque. La duraci√≥n de la transferencia del bit de arranque establece el ritmo.
El final de la transferencia de caracteres forma el bit de parada.

Convenciones
Adem√°s del bit de arranque y de parada existe una serie de convenciones entre ambos
interlocutores necesarias para la transmisi√≥n de datos en serie. Entre ellas se incluyen:
‚óè Velocidad de transmisi√≥n (baudrate)
‚óè Tiempo de retardo entre caracteres y de acuse
‚óè Paridad
‚óè N√∫mero de bits de datos
‚óè N√∫mero de bits de parada

1762

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Trama
Los datos que deban transferirse entre el m√≥dulo de comunicaci√≥n y un interlocutor se
transmiten a trav√©s de la interfaz en serie en una trama de entre 10 y 11 bits. Para cada trama
hay varios formatos de datos disponibles. El formato deseado para la transmisi√≥n de datos se
parametriza en el cuadro de di√°logo de propiedades del m√≥dulo: Dependiendo del m√≥dulo de
comunicaci√≥n correspondiente, no est√°n disponibles todas las tramas (y combinaciones de
tramas) te√≥ricamente posibles.

Trama de 10 bits
En la siguiente imagen se representan tres formatos de datos de la trama de 10 bits a modo de
ejemplo.
ELWVGHGDWRVELWGHLQLFLRELWVGHGDWRVELWVGHSDUDGD
(VWDGRGHVH¬≥DO
1

2

8

9

10

ELWGHLQLFLR

ELWVGHGDWRV

ELWVGHSDUDGD

(VWDGRGHVH¬≥DO

1

2

8

9

10
ELWGHSDUDGD

(VWDGRGHVH¬≥DO

ELWGHSDULGDG

ELWVGHGDWRVELWGHLQLFLRELWVGHGDWRVELWGHSDULGDGELWVGHSDUDGD

9

10

ELWGHLQLFLR

ELWVGHGDWRV

(VWDGRGHVH¬≥DO

ELWVGHGDWRVELWGHLQLFLRELWVGHGDWRVELWVGHSDUDGD
(VWDGRGHVH¬≥DO
1

2

Figura 1-77

ELWGHSDUDGD

ELWVGHGDWRV

ELWGHLQLFLR

(VWDGRGHVH¬≥DO

Trama de 10 bits

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1763

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Trama de 11 bits
En la siguiente imagen se representan tres formatos de datos de la trama de 11 bits a modo de
ejemplo.
ELWVGHGDWRVELWGHLQLFLRELWVGHGDWRVELWGHSDULGDGELWVGHSDUDGD
(VWDGRGHVH¬≥DO
1

2

8

9

11

ELWVGHSDUDGD

10

ELWGHSDULGDG

ELWGHLQLFLR

ELWVGHGDWRV

(VWDGRGHVH¬≥DO

9

10 11

(VWDGRGHVH¬≥DO

1

2

ELWGHSDULGDG

ELWVGHGDWRV

ELWGHLQLFLR

(VWDGRGHVH¬≥DO

ELWGHSDUDGD

ELWVGHGDWRVELWGHLQLFLRELWVGHGDWRVELWGHSDULGDGELWVGHSDUDGD

ELWVGHGDWRVELWGHLQLFLRELWVGHGDWRVELWVGHSDUDGD
(VWDGRGHVH¬≥DO
1

2

9

10 11

Figura 1-78

1764

ELWVGHSDUDGD

ELWVGHGDWRV

ELWGHLQLFLR

(VWDGRGHVH¬≥DO

Trama de 11 bits

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tiempo de retardo de caracteres
En la siguiente imagen se representa el intervalo m√°ximo de tiempo permitido entre dos
caracteres recibidos dentro de un telegrama = tiempo de retardo entre caracteres
representado.
6H√¢DO

FDU√íFWHUQ

FDU√íFWHU Q
75&


7LHPSRW

Figura 1-79

Tiempo de retardo de caracteres

Seguridad de transmisi√≥n
La seguridad de transmisi√≥n es muy importante en el proceso de transferencia de datos y para
la selecci√≥n del procedimiento de transmisi√≥n. Por norma general puede decirse que cuantos
m√°s capas del modelo de referencia se ejecuten, mayor ser√° la seguridad de transmisi√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1765

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Clasificaci√≥n de los protocolos existentes
La clasificaci√≥n de los protocolos existentes del m√≥dulo de comunicaci√≥n en el modelo de
referencia puede consultarse en la siguiente figura:

1LYHOGHWUDQVSRUWH

RK 512

&DGDXQRGHORVWHOHJUDPDVGH
FRPDQGRUHFLELGRFRUUHFWDPHQWHVH
UHVSRQGHFRQXQWHOHJUDPDGH
UHVSXHVWD

1LYHO

1RH[LVWHGDGRTXHVHWUDWDGHXQ
VLPSOHDFRSODPLHQWRSXQWRDSXQWR

1LYHO

1LYHOGHVHJXULGDG

'ILQLFL¬µQGHODWUDQVPLVL¬µQI¬ØVLFD
GHORVE\WHVGHGDWRV

Figura 1-80

3964(R)
'ULYHU$6&,,

1LYHOGHWUDQVPLVL¬µQGHELWV

1LYHO

'ULYHUGHLPSUHVRUD

1LYHO

7UDQVPLVL¬µQGHORVE\WHVGHGDWRVFRQ
 5 6HD¬≥DGHQORVFDUDFWHUHVGH
LQLFLR\ILQDOHQFDVRGHHUURUOD
WUDQVPLVL¬µQSXHGHUHSHWLUVH

Catalogaci√≥n de los protocolos existentes del m√≥dulo de comunicaci√≥n en el modelo de
referencia

Asignaci√≥n de los protocolos a los m√≥dulos de comunicaci√≥n
Protocolo

CP 340

CP 341

CPU
313C-2
PtP

CPU
314C-2
PtP

CP 440

Driver de impre‚Äê
sora

‚óè

‚óè

ET 200S
1SI

Driver ASCII

‚óè

‚óè

‚óè

‚óè

‚óè

‚óè

‚óè

Procedimiento
3964(R)

‚óè

‚óè

‚óè

‚óè

‚óè

‚óè

‚óè

‚óè

Protocolo para
mainframe
RK512

‚óè

‚óè

‚óè2)

Maestro Mod‚Äê
bus

‚óè 1)

‚óè 1) 2)

‚óè

Esclavo Mod‚Äê
bus

‚óè 1)

‚óè 1) 2)

‚óè

Maestro USS

1766

CP 441

‚óè

1)

Ser√° necesario un driver cargable con un dongle para el protocolo Modbus.

2)

s√≥lo CP 441-2

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Seguridad de transmisi√≥n en el driver de impresora
Seguridad de los datos al utilizar el driver de impresora:
‚óè No se ha previsto ninguna medida de seguridad para la transmisi√≥n de datos con el driver
de impresora.
‚óè Para impedir que se pierdan datos en caso de desbordarse el b√∫fer de recepci√≥n de la
impresora, utilice el control del flujo de datos (XON/XOFF, RTS/CTS).
‚óè En la salida de la impresora se eval√∫a la se√±al BUSY de la impresora. La se√±al BUSY llega
al m√≥dulo de comunicaci√≥n como se√±al CTS y se eval√∫a como tal (v√©ase driver ASCII). Hay
que tener en cuenta que en el control de flujo con CTS/RTS debe ajustarse la polaridad de
la se√±al BUSY a CTS = "OFF" en la impresora.

Seguridad de transmisi√≥n con el driver ASCII
Seguridad de los datos al utilizar el driver ASCII:
‚óè Dado que durante el transporte de datos con el driver ASCII, a parte del bit de paridad, no
se aplica ninguna otra medida para la protecci√≥n de los datos (dependiendo de la trama de
caracteres seleccionada tambi√©n puede desactivarse), la transmisi√≥n de datos con el driver
ASCII resulta muy eficaz en lo que respecta al flujo de datos, pero la seguridad del
transporte de los datos es nula.
‚óè Mediante el uso del bit de paridad se garantiza la inversi√≥n de un bit en un car√°cter a
transmitir. Si se invierten dos o m√°s bits de un car√°cter, el fallo ya no podr√° detectarse.
‚óè Si fuera necesario aumentar la seguridad de la transmisi√≥n, puede hacerse introduciendo
una suma de verificaci√≥n (checksum) y la indicaci√≥n de longitud de un telegrama. Estas
medidas debe realizarlas el usuario.
‚óè Otra forma de aumentar la protecci√≥n de los datos consiste en introducir telegramas de
acuse de los telegramas de emisi√≥n y recepci√≥n. Esto ya ocurre en los protocolos de
comunicaci√≥n de datos de alto rendimiento (v√©ase el modelo de referencia ISO de 7 capas).

Seguridad de transmisi√≥n con 3964(R)
Mayor seguridad de los datos mediante utilizaci√≥n del procedimiento 3964(R):
‚óè La distancia Hamming con 3964(R) es de 3. La distancia Hamming es una medida para la
seguridad de una transmisi√≥n de datos.
‚óè Mediante el procedimiento 3964(R) se garantiza una elevada seguridad de transmisi√≥n en
la l√≠nea de transmisi√≥n. La elevada seguridad de transmisi√≥n se consigue gracias al
establecimiento y desconexi√≥n prefijadas del telegrama as√≠ como a la inclusi√≥n del car√°cter
de comprobaci√≥n de bloque (BCC).
Dependiendo de si se desea transmitir los datos con o sin car√°cter de comprobaci√≥n de bloque,
se distingue entre
‚óè Transmisi√≥n de datos sin car√°cter de comprobaci√≥n de bloque: 3964
‚óè Transmisi√≥n de datos con car√°cter de comprobaci√≥n de bloque: 3964(R)
En las descripciones e indicaciones que se refieren a ambos m√©todos de transmisi√≥n de datos
se utiliza en este manual la denominaci√≥n 3964(R).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1767

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Seguridad de transmisi√≥n con RK512
Protecci√≥n de datos muy elevada gracias al uso del RK512:
‚óè La distancia Hamming en el caso del RK512 con 3964R es de 4. La distancia Hamming es
una medida para la seguridad de una transmisi√≥n de datos.
‚óè Utilizando el protocolo para mainframe RK512 se garantiza una elevada seguridad de
transmisi√≥n en la l√≠nea de transmisi√≥n (ya que con RK 512 se utiliza el procedimiento 3964R
para el transporte de datos).
‚óè Se garantiza el procesamiento posterior de los datos en el interlocutor (porque el int√©rprete
del RK512 eval√∫a la indicaci√≥n adicional de la longitud de los datos y, una vez depositados
los datos en el √°rea de datos de destino del interlocutor, se genera un telegrama de acuse
sobre el √©xito/el fracaso del transporte de los datos).
‚óè El protocolo para mainframe RK512 garantiza el uso correcto del procedimiento 3964R y la
evaluaci√≥n/complemento de la indicaci√≥n de longitud as√≠ como la generaci√≥n autom√°tica de
telegramas de respuesta. ¬°El usuario no tiene que hacer nada! Tan solo tiene que evaluar
el acuse positivo/negativo final.

Seguridad de transmisi√≥n con Modbus/USS
Seguridad de datos al utilizar el driver Modbus/USS:
‚óè La distancia Hamming en el caso de Modbus/USS es de 4. La distancia Hamming es una
medida para la seguridad de una transmisi√≥n de datos.
‚óè El uso de Modbus/USS garantiza una seguridad de transmisi√≥n muy elevada en la l√≠nea de
transmisi√≥n (con una comprobaci√≥n de bloque CRC16 con Modbus y una comprobaci√≥n
XOR con USS).
‚óè Se garantiza el procesamiento posterior en el interlocutor, porque tanto Modbus como USS
eval√∫an una informaci√≥n de longitud adicional en el encabezado y porque se genera un
telegrama de acuse (doblemente vigilado), que indica si el transporte de datos ha sido
correcto o fallido.

Transmisi√≥n de datos con driver ASCII
Transmisi√≥n de datos con el driver ASCII
Para la asignaci√≥n de los protocolos a los m√≥dulos de comunicaci√≥n v√©ase: Sinopsis de los
componentes e interfaces (P√°gina 1756)

Introducci√≥n
El driver ASCII controla la transmisi√≥n de datos en un acoplamiento punto a punto entre el
procesador de comunicaciones y un interlocutor. El driver ASCII contiene el nivel de
transmisi√≥n de bits (nivel 1).
La estructura de los telegramas se mantiene as√≠ abierta mediante la transmisi√≥n de todo el
telegrama de env√≠o al procesador de comunicaciones por parte del usuario de S7. Para la
recepci√≥n debe parametrizarse el criterio de fin de un telegrama. La estructura de los
telegramas de env√≠o puede ser diferente de la de los telegramas de recepci√≥n.

1768

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Con el driver ASCII pueden enviarse y recibirse datos con cualquier estructura (todos los
caracteres ASCII imprimibles, as√≠ como el resto de caracteres desde 00 hasta FFH (en tramas
con 8 bits de datos) y desde 00 hasta 7FH (en tramas con 7 bits de datos)).

Env√≠o de datos con el driver ASCII
Enviar datos
En el env√≠o debe indicarse el n√∫mero de bytes de datos √∫tiles que deben transferirse en cada
llamada de la instrucci√≥n de env√≠o con el par√°metro correspondiente a la longitud. Encontrar√°
m√°s informaci√≥n al respecto en el apartado "Resumen de instrucciones (P√°gina 1757)".
Si se trabaja con el criterio de fin "Tiempo de retardo de caracteres transcurrido", el driver
ASCII realiza una pausa entre dos telegramas tambi√©n al enviarlos. Se puede acceder en todo
momento a la instrucci√≥n de env√≠o, aunque el driver ASCII no inicia la salida hasta que, desde
el √∫ltimo telegrama enviado, haya transcurrido un tiempo superior al tiempo de retardo
parametrizado entre caracteres.
Nota
Si se parametriza el control del flujo XON/XOFF, los datos √∫tiles no pueden contener ninguno
de los caracteres XON o XOFF parametrizados. Los ajustes predeterminados son DC1 = 11H
para XON y DC3 = 13H para XOFF.
Si trabaja con el criterio de fin "Caracteres de fin", puede elegir entre 3 posibilidades:
‚óè Enviar hasta el car√°cter de fin incluido
El car√°cter de fin debe encontrarse en los datos que se van a enviar. Los datos se env√≠an
√∫nicamente hasta el car√°cter de fin incluido, aunque en la instrucci√≥n se haya especificado
una mayor longitud de datos.
‚óè Enviar hasta la longitud parametrizada en la instrucci√≥n
Se env√≠an los datos hasta la longitud parametrizada en la instrucci√≥n. El √∫ltimo car√°cter
debe ser un car√°cter de fin.
‚óè Enviar hasta la longitud parametizada en la instrucci√≥n y agregar autom√°ticamente el(los)
car√°cter(es) de fin
Se env√≠an los datos hasta la longitud parametrizada en la instrucci√≥n. Adicionalmente se
agrega autom√°ticamente el(los) car√°cter(es) de fin. Esto es, los caracteres de fin no pueden
encontrarse en los datos que se van a enviar. Dependiendo del n√∫mero de caracteres de
fin se le env√≠an al interlocutor 1 √≥ 2 caracteres m√°s de los indicados en la instrucci√≥n.
Si se trabaja con el criterio de fin "Longitud fija de telegrama", el n√∫mero de datos que haya
indicado en el par√°metro de longitud de la instrucci√≥n se transfiere en el sentido de env√≠o. En
el sentido de recepci√≥n, esto es, en el DB de recepci√≥n, se registra el n√∫mero de datos que se
ha especificado en el cuadro de di√°logo de propiedades del m√≥dulo a trav√©s del par√°metro
"Longitud fija de telegrama". Para garantizar un intercambio de datos correcto, ambos
par√°metros deber√°n escogerse de forma id√©ntica. Al enviar se mantendr√° una pausa entre dos
telegramas igual al tiempo de retardo de car√°cter (TRC) para que el interlocutor pueda
sincronizarse (detecci√≥n de inicio del telegrama).
Si la sincronizaci√≥n se realiza con otros mecanismos, puede desactivarse la pausa de env√≠o en
el cuadro de di√°logo de propiedades del m√≥dulo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1769

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Desarrollo durante el env√≠o
En la siguiente figura se representan los procesos de env√≠o.

3HWLFL¬µQSURFHVDGD

(VSHUDUD
SHWLFL¬µQGHHQY¬ØR

3HWLFL¬µQ6(1'UHFLELGD

(QY¬ØRGHORV
GDWRV¬ºWLOHV

Figura 1-81

(OQ¬ºPHURQGHORV
GDWRVTXHGHEHQ
HQYLDUVHVHFRQVXOWDHQ
HOSDU¬£PHWUR/RQJLWXG
GHODLQVWUXFFL¬µQ

Esquema del proceso de env√≠o del driver ASCII

Recepci√≥n de datos con el driver ASCII
Criterios de fin seleccionables
En la transmisi√≥n de datos con el driver ASCII puede elegir entre tres criterios distintos de fin.
El criterio de fin determina cu√°ndo se ha recibido un telegrama completo. Los criterios
ajustables de fin son los siguientes:
‚óè Tiempo de retardo de caracteres transcurrido
El telegrama no tiene una longitud fija ni caracteres de fin definidos; una pausa en la l√≠nea
determina el fin de dicho telegrama (tiempo de retardo de caracteres trascurrido).
‚óè Recepci√≥n del/de los car√°cter(es) de fin
Al final del telegrama hay uno o dos caracteres de fin definidos.
‚óè Recepci√≥n de un n√∫mero de caracteres determinado
La longitud de los telegramas de recepci√≥n es siempre igual.

1770

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Transparencia del c√≥digo
La transparencia del c√≥digo del procedimiento depende de la elecci√≥n del criterio de fin
parametrizable y del control del flujo:
‚óè Con uno o dos caracteres de fin
‚Äì No hay transparencia del c√≥digo
‚óè Criterio de fin "Tiempo de retardo entre caracteres" o "Longitud fija de telegrama"
‚Äì Con transparencia del c√≥digo
‚óè Si se utiliza el control del flujo XON/XOFF, la transparencia del c√≥digo no es posible.
"Transparencia del c√≥digo" significa que en los datos √∫tiles pueden darse todas las
combinaciones de caracteres posibles sin que se detecte el criterio de fin.

Criterio de fin "Tiempo de retardo de caracteres transcurrido"
En la recepci√≥n de datos se detecta el final del telegrama una vez que ha transcurrido el tiempo
de retardo entre caracteres. Los datos recibidos los acepta la CPU.
El tiempo de retardo entre caracteres debe ajustare en este caso de tal modo que transcurra
con seguridad entre dos telegramas consecutivos. Asimismo, ha de ser lo suficientemente
largo como para garantizar que en las pausas de env√≠o del interlocutor dentro de un mismo
telegrama no se reconozca por error el final del mismo.
En la siguiente figura encontrar√° las fases de recepci√≥n con el criterio de fin "Tiempo de retardo
de caracteres transcurrido".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1771

Configuraci√≥n de dispositivos y redes

(VSHUDUD
FDU¬£FWHU

&DU¬£FWHU
UHFLELGR

7HOHJUDPDUHVSDOGDGR

&ULWHULRGHILQGHWHOHJUDPDGHWHFWDGRSRVWHULRUUHJLVWURGHHUURU

1.4 Crear configuraciones

&DU¬£FWHU
UHFLELGRFRQ
YLJLODQFLDGH75&

(UURUHQODUHFHSFL¬µQ
QLQJ¬ºQHUURU75&
(VSHUDUD75&
'HVFDUWDUFDU¬£FWHU
UHFLELGR

7HOHJUDPDFRPSOHWR
75&WUDQVFXUULGR
7HOHJUDPDUHJLVWUDGR
HQE¬ºIHUGHUHFHSFL¬µQ

5HJLVWUDUHUURU
VDOLGD67$786GHOD
LQVWUXFFL¬µQ

Figura 1-82

Desarrollo del proceso de recepci√≥n con el criterio de fin "Transcurrido el tiempo de
retardo entre caracteres"

Criterio de fin "Car√°cter de fin"
Al recibir datos se detecta el fin del telegrama si se recibe(n) el(los) car√°cter(es) de fin
parametrizado(s). Los datos recibidos, incluidos los caracteres de fin, los acepta la CPU.
El transcurso del tiempo de retardo entre caracteres durante la recepci√≥n implica el final de la
recepci√≥n. Se genera un mensaje de error y el fragmento de telegrama se rechaza.
Cuando se trabaja con caracteres de fin, la transferencia no tiene transparencia del c√≥digo y
debe excluirse la posibilidad de que el(los) identificador(es) de fin aparezcan en los datos √∫tiles.

1772

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Cuando en el telegrama recibido el √∫ltimo car√°cter no sea el car√°cter de fin, tenga en cuenta
lo siguiente:
‚óè Los caracteres de fin se encuentran en la posici√≥n deseada del telegrama:
todos los caracteres, incluidos los caracteres de fin, se incluyen en el DB de recepci√≥n. Los
caracteres que se encuentren detr√°s del car√°cter de fin
‚Äì se rechazan una vez haya transcurrido el tiempo de retardo de car√°cter (TRC), al final
del telegrama.
‚Äì se fusionan con el siguiente telegrama al recibir uno nuevo antes de que transcurra el
tiempo de retardo de car√°cter.
‚óè El telegrama no contiene caracteres de fin:
El telegrama
‚Äì se rechaza una vez haya transcurrido el tiempo de retardo de car√°cter (TRC), al final del
telegrama.
‚Äì se fusiona con el siguiente telegrama al recibir uno nuevo antes de que transcurra el
tiempo de retardo de car√°cter.
En la siguiente figura encontrar√° las fases de recepci√≥n con el criterio de fin "Caracteres de fin".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1773

Configuraci√≥n de dispositivos y redes

(VSHUDUD
&DU¬£FWHU

&DU¬£FWHU
UHFLELGR
7HOHJUDPDUHVSDOGDGR

&ULWHULRGHILQGHWHOHJUDPDGHWHFWDGRSRVWHULRUUHJLVWURGHHUURU

1.4 Crear configuraciones

&DU¬£FWHU
UHFLELGRFRQ
FRQWUROILQDO\
YLJLODQFLDGH75&
(UURUHQOD
UHFHSFL¬µQ

7HOHJUDPD
FRPSOHWR

(VSHUDUD
GHWHFFL¬µQGHILQ
Y¬£OLGRR
WUDQVFXUVRGH75&

7HOHJUDPDUHJLVWUDGR
HQE¬ºIHUGHUHFHSFL¬µQ
75&
WUDQV
FXUULGR

(UURUHQVDOLGD
67$786GHOD
LQVWUXFFL¬µQ

Figura 1-83

Desarrollo del proceso de recepci√≥n con el criterio de fin "Caracteres de fin"

Criterio de fin "Longitud fija de telegrama"
Al recibir datos se detecta el fin del telegrama si se ha recibido el n√∫mero de caracteres
parametrizado. Los datos recibidos los acepta la CPU.
El transcurso del tiempo de retardo entre caracteres antes de alcanzar el n√∫mero
parametrizado de caracteres implica el final de la recepci√≥n. Se genera un mensaje de error y
el fragmento de telegrama se rechaza.

1774

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Cuando la longitud del telegrama de los caracteres recibidos no coincida con la longitud fijada,
tenga en cuenta lo siguiente:
‚óè Longitud del telegrama de los caracteres recibidos mayor que la longitud de telegrama fija
parametrizada:
Todos los caracteres que se reciban tras alcanzar la longitud parametrizada fija de
telegrama
‚Äì se rechazan una vez haya transcurrido el tiempo de retardo de car√°cter (TRC), al final
del telegrama.
‚Äì se fusionan con el siguiente telegrama al recibir uno nuevo antes de que transcurra el
tiempo de retardo de car√°cter.
‚óè Longitud del telegrama de los caracteres recibidos menor que la longitud de telegrama fija
parametrizada:
El telegrama
‚Äì se rechaza una vez haya transcurrido el tiempo de retardo de car√°cter (TRC), al final del
telegrama.
‚Äì se fusiona con el siguiente telegrama al recibir uno nuevo antes de que transcurra el
tiempo de retardo de car√°cter.
En la siguiente figura encontrar√° las fases de recepci√≥n con el criterio de fin "Longitud fija de
telegrama".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1775

Configuraci√≥n de dispositivos y redes

(VSHUDUD
&DU¬£FWHU

&DU¬£FWHU
UHFLELGR
7HOHJUDPDUHVSDOGDGR

&ULWHULRGHILQGHWHOHJUDPDGHWHFWDGRSRVWHULRUUHJLVWURGHHUURU

1.4 Crear configuraciones

&DU¬£FWHU
UHFLELGRFRQ
FRQWUROGHORQJLWXG\
YLJLODQFLDGH75&
(UURUHQOD
UHFHSFL¬µQ

7HOHJUDPD
FRPSOHWR

(VSHUDUD
Q¬ºPHURGHFDUDFWHUHV
SDUDPHWUL]DGRR
WUDQVFXUVRGH75&

7HOHJUDPDUHJLVWUDGR
HQE¬ºIHUGHUHFHSFL¬µQ
75&
WUDQVFXU
ULGR

Figura 1-84

(UURUHQVDOLGD
67$786GHOD
LQVWUXFFL¬µQ

Desarrollo del proceso de recepci√≥n con el criterio de fin "Longitud fija de telegrama"

B√∫fer de recepci√≥n del m√≥dulo
Dependiendo del m√≥dulo de comunicaci√≥n utilizado, el b√∫fer de recepci√≥n del m√≥dulo puede
alojar hasta 4096 bytes.
Durante la parametrizaci√≥n puede indicar si:
‚óè CP y CPU 31xC-2 PtP
el b√∫fer de recepci√≥n debe borrarse durante el arranque y si debe evitarse una
sobrescritura de los datos contenidos en el mismo. Adem√°s puede indicar el rango de
valores (de 1 a 250) para el n√∫mero de telegramas de recepci√≥n guardados en el b√∫fer.
‚óè ET 200S 1SI
Se borra el b√∫fer de recepci√≥n durante el arranque y si debe evitarse una sobrescritura de
los datos contenidos en el mismo. Adem√°s puede activar o bloquear el respaldo de los
telegramas recibidos.

1776

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El b√∫fer de recepci√≥n del m√≥dulo es un b√∫fer en anillo:
‚óè Si se incluyen varios telegramas en el b√∫fer de recepci√≥n del m√≥dulo: siempre se enviar√°
el telegrama m√°s antiguo del m√≥dulo a la CPU.
‚óè Si se desea enviar siempre el telegrama m√°s reciente a la CPU, tiene que:
‚Äì CP y CPU 31xC-2 PtP
parametrizar el valor "1" para el n√∫mero de telegramas respaldados y desactivar la
protecci√≥n de sobrescritura.
‚Äì ET 200S 1SI
bloquear los telegramas din√°micos y desactivar la protecci√≥n de sobrescritura.
Nota
Si la lectura continua de los datos recibidos en el programa de usuario se interrumpe
durante un tiempo, al volver a solicitar los datos recibidos puede ocurrir que la CPU
reciba primero telegramas antiguos del m√≥dulo y despu√©s el √∫ltimo telegrama.
Los telegramas m√°s antiguos se encontraban de camino entre el m√≥dulo y la CPU
durante la interrupci√≥n o la instrucci√≥n ya los hab√≠an recibido.

Modo RS485 (CP 34x, 44x, CPU 31xC-2 PtP + ET 200S 1SI)
Modo RS485
Si utiliza el driver ASCII en modo RS485 (semid√∫plex, modo de dos cables), debe garantizar
mediante el programa de usuario que nunca pueda enviar m√°s de una estaci√≥n. Si env√≠an m√°s
de una simult√°neamente, el telegrama se falsifica.

Tiempos de conmutaci√≥n para el m√≥dulo RS485 en modo semid√∫plex
El tiempo m√°ximo de conmutaci√≥n entre el env√≠o y la recepci√≥n es de 1 ms.

Modo RS232 (CP 34x, 44x, CPU 31xC-2 PtP + ET 200S 1SI)
Se√±ales cualificadoras RS232C
Las siguientes se√±ales cualificadoras RS232C estar√°n disponibles en los m√≥dulos al utilizar la
f√≠sica RS232C:
DCD

(Entrada)

DTR

(Salida)

DSR

(Entrada)

RTS

(Salida)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Data Carrier detect,
soporte de datos detectado
Data terminal ready;
m√≥dulo listo para funcionar
Data set ready,
interlocutor listo para funcionar
Request to send,
m√≥dulo listo para enviar

1777

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
CTS

(Entrada)

RI

(Entrada)

Clear to send,
el interlocutor puede recibir datos del m√≥dulo (respuesta a RTS = ON
del m√≥dulo de comunicaci√≥n)
Ring Indicator,
indicador de llamada

Tras la conexi√≥n del m√≥dulo las se√±ales de salida est√°n en estado OFF (inactivas).
El procesamiento de las se√±ales de control DTR/DSR y RTS/CTS puede parametrizarse en el
cuadro de di√°logo de propiedades del m√≥duloo controlarse mediante las instrucciones del
programa de usuario.

Manejo de se√±ales cualificadoras RS232C
Las se√±ales cualificadoras RS232C pueden utilizarse de la siguiente manera:
‚óè en la parametrizaci√≥n del uso autom√°tico de todas las se√±ales cualificadoras de RS232C
‚óè con flujo de datos parametrizado (RTS/CTS)
‚óè mediante las instrucciones V24_STAT y V24_SET
Nota
Si se parametriza el uso autom√°tico de las se√±ales cualificadoras de RS232C no es posible
ni el control del flujo de datos con RTS/CTS ni el control de RTS y DTR mediante la
instrucci√≥n V24_SET. Si se parametriza un control del flujo de datos con RTS/CTS no es
posible controlar RTS con la instrucci√≥n V24_SET. La lectura de todas las se√±ales
cualificadoras RS232C con la instrucci√≥n V24_STAT es posible en todos los casos.
A continuaci√≥n se explica el procedimiento b√°sico para controlar y evaluar las se√±ales
cualificadoras de RS 232C.

Manejo autom√°tico de las se√±ales cualificadoras
El manejo autom√°tico de las se√±ales cualificadoras RS232C en el m√≥dulo de comunicaci√≥n se
establece de la siguiente manera:
‚óè Cuando el m√≥dulo entra por parametrizaci√≥n en un modo de operaci√≥n con manejo
autom√°tico de las se√±ales cualificadoras de RS232C, pone las l√≠neas RTS en estado OFF
y las DTR en estado ON (m√≥dulo de comunicaci√≥n preparado para entrar en
funcionamiento).
S√≥lo es posible enviar y recibir telegramas tras poner la l√≠nea DTR a ON. Mientras DTR
permanezca en OFF, no se pueden recibir datos v√≠a la interfaz del RS232C. Cualquier
petici√≥n de env√≠o se interrumpe con el correspondiente mensaje de error.
‚óè Si est√° pendiente una petici√≥n de env√≠o, RTS pasa al estado ON y se inicia el tiempo de
espera de salida de datos parametrizado. Una vez transcurrido el tiempo de salida de datos
y con CTS = ON, los datos se env√≠an a trav√©s de la interfaz RS232C.
‚óè Si durante el env√≠o la l√≠nea CTS no pasa a ON durante el tiempo de espera, o si durante el
proceso de salida, CTS cambia al estado OFF, se interrumpir√° el env√≠o mostrando el aviso
correspondiente.
‚óè Tras la emisi√≥n de los datos y una vez transcurrido el tiempo de RTS a OFF parametrizado,
la l√≠nea RTS pasa al estado de inactividad. No se espera a que la l√≠nea CTS pase a OFF.

1778

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Es posible recibir datos v√≠a la interfaz RS232C tan pronto como se active la l√≠nea DSR (ON).
Si existe riesgo de sobrecarga del b√∫fer de recepci√≥n del m√≥dulo de comunicaci√≥n, el
m√≥dulo no reacciona.
‚óè Al cambiar de DSR = ON a OFF se interrumpe tanto el env√≠o en curso como la recepci√≥n
de datos con un aviso de error. En el b√∫fer de diagn√≥stico del m√≥dulo se registra el aviso
‚ÄúDSR = OFF (manejo autom√°tico de las se√±ales V24)".
Nota
Si se parametriza el uso autom√°tico de las se√±ales cualificadoras de RS232C no es posible
ni el control del flujo de datos con RTS/CTS ni el control de RTS y DTR mediante la
instrucci√≥n V24_SET.
El "tiempo RTS a OFF" debe definirse en el cuadro de propiedades del m√≥dulo de tal
manera que el interlocutor pueda recibir completos los √∫ltimos caracteres del telegrama
antes de que la l√≠nea RTS, y con ella la petici√≥n de env√≠o, se desactiven. El "tiempo de salida
de datos" debe definirse de tal manera que el interlocutor pueda pasar a modo de
disponibilidad de recepci√≥n antes de que el tiempo haya transcurrido.

Cronograma
La figura muestra el desarrollo temporal de una petici√≥n de env√≠o.

576

&76
7;'

21
2))
21
2))



(QYLDU
WHUPLQDGR

3HWLFL¬µQGHWUDQVPLVL¬µQ
576 21
,QWHUORFXWRU
&76 21
7LHPSRGHHVSHUDGHVDOLGD
GHGDWRVWUDQVFXUULGR‡µ∫HQYLDU
7LHPSRGHHVSHUD
DVDOLGDGHGDWRV

Figura 1-85

W

7LHPSRGH576D2))
WUDQVFXUULGR
,QWHUORFXWRU
&76 2))
7LHPSRGH576
D2))

Cronograma para el manejo autom√°tico de las se√±ales cualificadoras de RS232C

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1779

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Funciones de la instrucci√≥n V24_STAT/SET
La instrucci√≥n V24_STAT permite determinar el estado de cada se√±al cualificadora RS232C.
La instrucci√≥n V24_SET permite controlar las se√±ales de salida DTR y RTS.

Handshake de software/hardware
Introducci√≥n
Los procedimientos handshake controlan el flujo de datos entre dos interlocutores. Con la
utilizaci√≥n de procedimientos Handshake se evita que se pierdan datos durante la transmisi√≥n
de datos entre dispositivos que trabajan a diferentes velocidades.

Procedimiento Handshake
Se distinguen dos procedimientos:
‚óè Handshake de software (p. ej. XON/XOFF)
‚óè Handshake de hardware (p. ej. RTS/CTS)
El control del flujo de datos en el m√≥dulo de comunicaci√≥n se desarrolla de la siguiente manera:
‚óè En cuanto el m√≥dulo pasa por parametrizaci√≥n a un modo de operaci√≥n con control de flujo,
env√≠a el car√°cter XON o pone la l√≠nea RTS en estado ON.
‚óè Al alcanzar el n√∫mero de telegrama parametrizado o bien los 50 caracteres antes de que
se desborde el b√∫fer de recepci√≥n (capacidad del b√∫fer de recepci√≥n: 4096 bytes), el
m√≥dulo env√≠a el car√°cter XOFF o pone la l√≠nea RTS en estado OFF. Si a pesar de ello el
interlocutor contin√∫a enviando, se genera un mensaje de error si el b√∫fer de recepci√≥n se
desborda. Los datos recibidos del √∫ltimo telegrama se descartan.
‚óè En cuanto la CPU-S7 ha captado un telegrama, y una vez que el b√∫fer de recepci√≥n est√°
listo para recibir, el m√≥dulo env√≠a el car√°cter XON o pone la l√≠nea RTS en estado ON.
‚óè Si el m√≥dulo recibe el car√°cter XOFF o si la se√±al de control CTS pasa a estado OFF, el
m√≥dulo interrumpe el proceso de env√≠o. Si transcurrido un tiempo determinado
parametrizable no se recibe ning√∫n car√°cter XON o CTS no pasa a ON, el proceso de env√≠o
se interrumpe y se registra el correspondiente mensaje de error (0708H) en el √°rea de
registro de errores del m√≥dulo.
Nota
Al definir el control de flujo de datos con RTS/CTS es necesario cablear por completo las
se√±ales de interfaz utilizadas en la conexi√≥n por conector. Si se parametriza un control del
flujo de datos con RTS/CTS no es posible controlar RTS con la instrucci√≥n V24_SET.

Transmisi√≥n de datos con 3964(R)
Transmisi√≥n de datos con el procedimiento 3964(R)
Para la asignaci√≥n de los protocolos a los m√≥dulos de comunicaci√≥n v√©ase: Sinopsis de los
componentes e interfaces (P√°gina 1756)

1780

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Introducci√≥n
El procedimiento 3964(R) controla la transmisi√≥n de datos en un acoplamiento punto a punto
entre el procesador de comunicaciones y un interlocutor. El procedimiento 3964(R) contiene,
adem√°s del nivel de transmisi√≥n de bits (nivel 1), el nivel de seguridad (nivel 2).

Arranque
En la siguiente figura encontrar√° las fases de arranque del procedimiento 3964(R).
$UUDQTXHWUDVHOUHLQLFLRGHOD&38R
HOUHVWDEOHFLPLHQWRGHODWHQVL¬µQ

(YDOXDFL¬µQGHSDUDPHWUL]DFL¬µQ

,QLFLDOL]DFL¬µQGHODLQWHUID]

(QY¬ØRGH1$.

*

Figura 1-86

Esquema de desarrollo del arranque del procedimiento 3964(R)

Caracteres de control
Introducci√≥n
El procedimiento 3964(R) a√±ade los caracteres de control de los datos de informaci√≥n (nivel de
seguridad) durante la transmisi√≥n de datos. Mediante estos caracteres de control, el
interlocutor puede controlar si los datos le llegan de forma completa y sin errores.

Caracteres de control del procedimiento 3964(R)
El procedimiento 3964(R) valora los siguientes caracteres de control:
‚óè STX Start of Text; inicio de la secuencia de caracteres que debe transmitirse
‚óè DLE Data Link Escape; conmutaci√≥n de transmisi√≥n de datos
‚óè ETX End of Text; fin de la secuencia de caracteres que debe transmitirse
‚óè BCC Block Check Character (s√≥lo con 3964(R)); car√°cter de comprobaci√≥n de bloque
‚óè NAK Negative Acknowledge; realimentaci√≥n negativa
Nota
Si se transmite el car√°cter DLE como car√°cter de informaci√≥n, √©ste se enviar√° doblemente
para distinguir el car√°cter de control DLE durante el establecimiento y la desconexi√≥n de la
comunicaci√≥n en la l√≠nea de transferencia (duplicado de DLE). El receptor anula el
duplicado del car√°cter DLE.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1781

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Prioridad
En el procedimiento 3964(R) un interlocutor debe tener asignada una prioridad mayor que el
otro. Si ambos interlocutores inician simult√°neamente una petici√≥n de transmisi√≥n, el
interlocutor que tiene la prioridad m√°s baja retira su petici√≥n de transmisi√≥n.

Suma de comprobaci√≥n de bloque
Suma de comprobaci√≥n de bloque
En el protocolo de transmisi√≥n 3964(R) la seguridad de datos se aumenta mediante un
car√°cter de comprobaci√≥n de bloque (BCC = Block Check Character) enviado adicionalmente.

7HOHJUDPD
67;'DWRV'/((7;%&&
+‡µ∫+‡µ∫+‡µ∫+‡µ∫+‡µ∫+‡µ∫+
 
 










;25 
 










;25 
 










;25 
 










;25 







%&&‡µ∫







Figura 1-87

Suma de comprobaci√≥n de bloque

La suma de comprobaci√≥n de bloque es la paridad longitudinal par (operaci√≥n l√≥gica EXOR de
todos los bytes de datos) de un bloque enviado o recibido. La formaci√≥n se inicia con el primer
byte de datos √∫tiles (1er byte del telegrama) tras el establecimiento de la conexi√≥n y finaliza
despu√©s del car√°cter DLE ETX al interrumpir la conexi√≥n.
Nota
En un duplicado DLE, el car√°cter DLE se incluye dos veces en la formaci√≥n del BCC.

1782

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Enviar datos con 3964(R)
Desarrollo del proceso de transmisi√≥n de datos en el env√≠o
En la figura siguiente se representa el desarrollo de la transmisi√≥n de datos al enviar con el
procedimiento 3964(R).

0¬µGXOR

,QWHUORFXWRU

&DU¬£FWHUGHLQLFLR + 
&RQILUPDWL¬µQSRV +

67;
'/(

HUE\WHGHGDWRV
|E\WHGHGDWRV

|E\WH
|E\WH

‡≤µ
‡≤µ
Q|E\WHGHGDWRV

‡≤µ
‡≤µ
Q|E\WH

&DU¬£FWHUGHILQ + 
&DU¬£FWHUGHILQ + 
6¬µOR5
&RQILUPDWL¬µQSRV +

'/(
(7;
%&&
'/(

Figura 1-88

(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ

'DWRV¬ºWLOHV

)LQDOL]DFL¬µQ
GHOD
FRQH[L¬µQ

Intercambio de datos en el env√≠o con el procedimiento 3964(R)

Establecimiento de la conexi√≥n en el env√≠o
Para establecer la conexi√≥n, el procedimiento 3964(R) env√≠a el car√°cter de control STX. Si el
interlocutor responde con el car√°cter DLE antes de que transcurra el tiempo de retardo del
acuse (TRA), el procedimiento entra en la fase de env√≠o.
Si, por el contrario, el interlocutor responde con NAK, otro car√°cter cualquiera (con la
excepci√≥n de DLE o STX) o si el tiempo de retardo del acuse transcurre sin que se produzca
una reacci√≥n, el procedimiento repite el establecimiento de la conexi√≥n. Tras el n√∫mero
parametrizado de intentos fallidos, el procedimiento interrumpe el establecimiento y env√≠a el
car√°cter NAK al interlocutor. El m√≥dulo de comunicaci√≥n registra el n√∫mero de error
correspondiente en su √°rea de registro de errores.

Enviar datos
Si el establecimiento de la conexi√≥n tiene √©xito, los datos √∫tiles contenidos en el b√∫fer de salida
del procesador de comunicaciones se env√≠an al interlocutor con los par√°metros de transmisi√≥n
seleccionados. El interlocutor controla la distancia temporal de los caracteres entrantes. La
distancia entre dos caracteres no debe ser mayor al tiempo de retardo de caracteres.
Si el interlocutor env√≠a el car√°cter NAK durante un env√≠o, el procedimiento aborta el proceso
y lo repite del modo arriba descrito, comenzando con el establecimiento de la conexi√≥n. Si el
interlocutor env√≠a cualquier otro car√°cter, el procedimiento espera primero a que transcurra el
tiempo de retardo de caracteres y a continuaci√≥n env√≠a el car√°cter NAK para que el interlocutor
pase a estado de reposo. Entonces el procedimiento comienza de nuevo la fase de env√≠o con
el establecimiento de la conexi√≥n STX.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1783

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Interrupci√≥n de la conexi√≥n en el env√≠o
Una vez que se ha enviado el contenido del b√∫fer, el procedimiento a√±ade los caracteres DLE,
ETX en el caso de 3964R el car√°cter de comprobaci√≥n de bloques BCC como car√°cter de fin,
y espera a un car√°cter de acuse. Si el interlocutor env√≠a el car√°cter DLE dentro del tiempo de
retardo de acuse, el bloque de datos se recibe sin errores. Si, por el contrario, el interlocutor
responde con NAK, otro car√°cter cualquiera (con la excepci√≥n de DLE), un car√°cter err√≥neo,
o si el tiempo de retardo de acuse transcurre sin que se produzca una reacci√≥n, el
procedimiento comienza de nuevo el env√≠o con el establecimiento de la conexi√≥n STX.
Tras un n√∫mero preestablecido de intentos de env√≠o del bloque de datos, el procedimiento
interrumpe el proceso y env√≠a el car√°cter NAK al interlocutor. El m√≥dulo de comunicaci√≥n
registra el error en el √°rea de registro de errores.

1784

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Fases del env√≠o con el procedimiento 3964(R)
En la siguiente figura encontrar√° las fases de env√≠o del procedimiento 3964(R).
*

'HVHRGHWUDQVPLVL¬µQ



*

*

7UDQVPLWLU1$.
: 

7UDQVPLWLU1$.



[ 
[!

[ 

[ 

7UDQVPLWLU67;

:

,QLFLDU7 75$

3ULRULGDG
DOWD

67;

3ULRULGDG
EDMD

(VSHUDU
DFXVH
'/(

[
7!7 75$
FDUDFWHUHVH[FHSWR
'/(67;R
FDU¬£FWHUHUU¬µQHR

'/(
7UDQVPLWLUEORTXH
'REODU'/(VL
SURFHGH



7UDQVPLWLU
'/((7;


[!

5HFHSFL¬µQ
QRSHUPLWLGD
7UDQVPLWLU1$.

5
7UDQVPLWLU%&&

,QLFLDU7 75$
(VSHUDU
DFXVH
'/(

7!7 75$
FDUDFWHUHVH[FHSWR
'/(RFDU¬£FWHU
HUU¬µQHR

'/(
7UDQVPLVL¬µQFRQFOXLGD
%&&V¬µORFRQ 5
[ FRQWDGRULQWHQWRVGHHVWDEOHFLPLHQWR
*
7 75$ PV 57 75$ V
: FRQWDGRULQWHQWRVGHWUDQVPLVL¬µQ
&RQURWXUDGHKLOR%5($.LQPHGLDWDPHQWHDHVWDGRLQLFLDO

Figura 1-89

Esquema de desarrollo del env√≠o con el procedimiento 3964(R)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1785

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Recibir datos con 3964(R)
Desarrollo del proceso de transmisi√≥n de datos en la recepci√≥n
En la siguiente imagen se representa el desarrollo de la transmisi√≥n de datos al recibir con el
procedimiento 3964(R).

,QWHUORFXWRU
(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ

'DWRV¬ºWLOHV

)LQDOL]DFL¬µQ
GHOD
FRQH[L¬µQ

Figura 1-90

0¬µGXOR
67;
'/(

&DU¬£FWHUGHLQLFLR + 
&RQILUPDWL¬µQSRV +

HUE\WH
|E\WH

HUE\WHGHGDWRV
|E\WHGHGDWRV

‡≤µ
‡≤µ
Q|E\WH

‡≤µ
‡≤µ
Q|E\WHGHGDWRV

'/(
(7;
%&&
'/(

,QGLFDGRUGHILQ + 
,QGLFDGRUGHILQ + 
6¬µOR5
&RQILUPDWL¬µQSRV +

Intercambio de datos en la recepci√≥n con el procedimiento 3964(R)

Nota
En cuanto est√° preparado, el procedimiento 3964(R) comienza a enviar el car√°cter NAK al
interlocutor para que √©ste pase a estado de reposo.

Establecimiento de la conexi√≥n en la recepci√≥n
En estado de reposo, cuando no debe procesarse ninguna orden de env√≠o, el procedimiento
espera a que el interlocutor establezca la conexi√≥n.
Si durante el establecimiento de la conexi√≥n con STX no hay ning√∫n b√∫fer de recepci√≥n
disponible, se inicia un tiempo de espera de 400 ms. Si una vez transcurrido este tiempo
contin√∫a sin haber ning√∫n b√∫fer disponible, el programa registra el error en el √°rea de registro
de errores del m√≥dulo. El procedimiento env√≠a un car√°cter NAK y regresa al estado de reposo.
En caso contrario, el procedimiento env√≠a el car√°cter DLE y recibe los datos como se ha
descrito.
Si el procedimiento recibe cualquier car√°cter (con la excepci√≥n de STX o NAK) durante el modo
de reposo, el procedimiento espera primero a que transcurra el tiempo de retardo de car√°cter
y a continuaci√≥n env√≠a un car√°cter NAK. El m√≥dulo de comunicaci√≥n registra el error en el √°rea
de registro de errores del m√≥dulo.

Recibir datos
Una vez que la conexi√≥n se ha establecido con √©xito, los datos entrantes se recogen en el b√∫fer
de recepci√≥n. Si se reciben dos caracteres DLE consecutivos, s√≥lo uno de ellos se registra en
el b√∫fer.

1786

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Despu√©s de cada car√°cter recibido, se espera al siguiente durante el tiempo de retardo de
caracteres. Si √©ste transcurre sin ninguna recepci√≥n, se env√≠a el car√°cter NAK al interlocutor.
El m√≥dulo de comunicaci√≥n registra el error en el √°rea de registro de errores del m√≥dulo. El
procedimiento 3964(R) no inicia una repetici√≥n.
Si durante la recepci√≥n se producen errores de transmisi√≥n (car√°cter perdido, error de trama,
error de paridad, etc.), se contin√∫a recibiendo hasta que se produce la interrupci√≥n de la
conexi√≥n y a continuaci√≥n se env√≠a el car√°cter NAK al interlocutor. A continuaci√≥n se espera
una repetici√≥n. Si el bloque no puede recibirse sin errores tras el n√∫mero de intentos
especificado en el registro est√°tico de par√°metros, o si el interlocutor no inicia la repetici√≥n
dentro de un tiempo de espera de 4 s, el procedimiento interrumpe la recepci√≥n. El m√≥dulo de
comunicaci√≥n registra la primera transmisi√≥n err√≥nea y la interrupci√≥n final del proceso en el
√°rea de registro de errores del m√≥dulo.

Interrupci√≥n de la conexi√≥n en la recepci√≥n
Cuando el procedimiento 3964 reconoce la secuencia de caracteres DLE ETX, finaliza la
recepci√≥n y env√≠a el car√°cter DLE al interlocutor si ha recibido un bloque sin errores. Si, por el
contrario, se produce un error de transmisi√≥n, env√≠a el car√°cter NAK al interlocutor. A
continuaci√≥n se espera una repetici√≥n.
Cuando el procedimiento 3964R reconoce la secuencia de caracteres DLE ETX BCC, finaliza
la recepci√≥n. Compara el car√°cter de comprobaci√≥n de bloques BCC con la paridad
longitudinal calculada internamente. Si el car√°cter de comprobaci√≥n de bloques es correcto y
no ha ocurrido ning√∫n otro error en la recepci√≥n, el procedimiento 3964R env√≠a el car√°cter DLE
y vuelve al estado de reposo. Si hay un error en el BCC o si se produce cualquier otro error de
recepci√≥n, se env√≠a el car√°cter NAK al interlocutor. A continuaci√≥n se espera una repetici√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1787

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Recepci√≥n con el procedimiento 3964(R)
En las siguientes figuras encontrar√° las fases de recepci√≥n del procedimiento 3964(R).
&DU¬£FWHUFRQH[FHSFL¬µQ
GH67;1$.
*

3HWLFL¬µQGHHQY¬ØR



5HFHSFL¬µQ
GH67;
(VSHUDGH
UHSHWLFL¬µQ



$QRWDFL¬µQ
GH1$.

:




&RQIOLFWRGH
LQLFLDOL]DFL¬µQ
SULRULGDGEDMD

,QLFLR
71$.7,0

(VSHUD

%¬ºIHUOLEUH

7!71$.7,0
1RKD\E¬ºIHUOLEUH

(QY¬ØRGH'/(

(QY¬ØRGH1$.



*

71$.7,0 PV
: FRQWDGRUGHLQWHQWRVGHWUDQVPLVL¬µQ
HQFDVRGHURWXUDGHO¬ØQHD %5($. LQPHGLDWDPHQWH
DHVWDGRGHUHSRVR

Figura 1-91

1788

Esquema de procesos en la recepci√≥n con el procedimiento 3964(R) (parte 1)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones


,QLFLR775&

$QRWDFL¬µQ
GH1$.

&DU¬£FWHU
FRUUHFWRFRQ
H[FHSFL¬µQGH (VSHUDD
UHFHSFL¬µQ
'/(
GHFDU¬£FWHU


&DU¬£FWHUHUU¬µQHR
7!775&

'/(
,QLFLR775&
'/(GXSOLFDGR
$QRWDFL¬µQGH1$.

(VSHUDD
(7;

&DU¬£FWHUFRQ
H[FHSFL¬µQ
(7;'/(

7!775&

(7;
5


,QLFLR775&
7!775&
(VSHUDD %&&HUU¬µQHR
%&&
%&&
1$.DQRWDGR

&RQIOLFWRGH
LQLFLDOL]DFL¬µQDQRWDGR
SULRULGDGEDMD

(QY¬ØRGH1$.

(QY¬ØRGH'/(
5HFHSFL¬µQILQDOL]DGD

:!
: 

$QRWDUUHSHWLFL¬µQHVSHUDGD
LQLFLRGH7EORTXH


*

7LHPSRV775& PV7EORTXH V
: FRQWDGRULQWHQWRVGHWUDQVPLVL¬µQ
%&&V¬µORHQ5
HQFDVRGHURWXUDGHO¬ØQHD %5($. LPPHGLDWDPHQWH
DHVWDGRGHUHSRVR

Figura 1-92

(VSHUDD 7!7EORTXH
67;
67;

*



Esquema de procesos en la recepci√≥n con el procedimiento 3964(R) (parte 2)

Transmisi√≥n de datos con RK512
Transmisi√≥n de datos con el protocolo para mainframe RK512
Para la asignaci√≥n de los protocolos a los m√≥dulos de comunicaci√≥n v√©ase: Sinopsis de los
componentes e interfaces (P√°gina 1756)
Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1789

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Introducci√≥n
El protocolo para mainframe RK512 controla la transmisi√≥n de datos en un acoplamiento punto
a punto entre el m√≥dulo de comunicaci√≥n y un interlocutor.
A diferencia del procedimiento 3964(R), el protocolo para mainframe RK512 contiene adem√°s
del nivel de transmisi√≥n de bits (nivel 1) y del nivel de seguridad (nivel 2) el nivel de transporte
(nivel 4). El protocolo para mainframe RK512 ofrece adem√°s una mayor protecci√≥n de los
datos y posibilidades de direccionamiento avanzadas.

telegrama de reacci√≥n
El protocolo para mainframe RK512 responde a cada telegrama de orden recibido
correctamente con un telegrama de reacci√≥n al ordenante (nivel de transporte). De ese modo
el remitente puede comprobar si sus datos han llegado correctamente a la CPU del interlocutor
o bien si los datos solicitados est√°n disponibles en la misma.

Telegrama de orden
Los telegramas de orden pueden ser telegramas SEND o bien telegramas FETCH.

Telegrama SEND
En un telegrama SEND, el m√≥dulo de comunicaci√≥n env√≠a un telegrama de orden con datos
√∫tiles y el interlocutor responde con un telegrama de reacci√≥n sin datos √∫tiles.

Telegrama FETCH
En un telegrama FETCH, el m√≥dulo de comunicaci√≥n env√≠a un telegrama de orden sin datos
√∫tiles y el interlocutor responde con un telegrama de reacci√≥n con datos √∫tiles.

Telegrama de continuaci√≥n
Si la cantidad de datos supera los 128 bytes, en el caso de telegramas SEND y FETCH se
env√≠an autom√°ticamente telegramas de continuaci√≥n.

Encabezado de telegrama
Cada telegrama de RK512 comienza con un encabezado. √âste puede contener datos
identificadores del telegrama, informaci√≥n sobre el destino y la fuente de los datos y un n√∫mero
de error.

1790

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura del encabezado de telegrama
En la siguiente tabla puede verse la estructura del encabezado del telegrama de orden.
Tabla 1-121 Estructura del encabezado del telegrama de orden (RK512)
4¬∫ byte

Significado

1

El identificador de telegrama en telegramas de orden (00H),
en telegramas de continuaci√≥n de orden (FFH)

2

Identificador de telegrama (00H)

3

'A' (41H) para petici√≥n SEND con DB de destino o bien
'O' (4FH) para petici√≥n SEND con DX de destino o bien
'E' (45H) para petici√≥n FETCH

4

los datos que deben transferirse son (en el env√≠o s√≥lo es posible 'D'):
'D' (44H) = bloque de datos
'I' (45H) = bytes de entrada
'Q' (41H) = bytes de salida
'M' (4DH) = bytes de marca
'C' (5AH) = celdas de contador
'T' (54H) = celdas de temporizador

5y6

Destino de los datos en petici√≥n SEND/PUT o bien Fuente de los datos en petici√≥n GET
p. ej. byte 5 = n¬∫ DB, byte 6 = n¬∫ DW.
(El direccionamiento de RK512 describe la fuente y el destino de los datos con l√≠mites de
palabra. El c√°lculo de las direcciones de bytes en SIMATIC S7 se produce autom√°tica‚Äê
mente.)

7y8

Longitud High-Byte Longitud de los datos a transmitir seg√∫n el tipo en bytes o bien
Longitud Low-Byte Palabras

9

N√∫mero de bytes de la marca de acoplamiento;
si no ha indicado ninguna marca de acoplamiento, aqu√≠ aparece FFH.

10

Bit 0 a 3: N√∫mero de bits de la marca de acoplamiento,
si ha especificado una marca de acoplamiento, el protocolo registra aqu√≠ FH.
Bit 4 a 7: N√∫mero de CPU (de 1 a 4);
si no ha especificado ning√∫n n√∫mero de CPU, pero ha indicado una marca de acopla‚Äê
miento, aqu√≠ aparece 0H; si no ha indicado ni un n√∫mero de CPU ni una marca de aco‚Äê
plamiento, aqu√≠ aparece FH.

Las letras de los bytes 3 y 4 son caracteres ASCII.
El encabezado del telegrama de continuaci√≥n de orden s√≥lo se compone de los bytes 1 a 4.

Telegrama de reacci√≥n
Una vez transferido el telegrama de orden, RK512 espera un telegrama de reacci√≥n del
interlocutor durante un tiempo de vigilancia fijo. La longitud del tiempo de vigilancia es de 20
s, independientemente de la velocidad de transferencia (baudrate).
Dependiendo del m√≥dulo PtP utilizado, el usuario puede reducir el tiempo de vigilancia
mediante parametrizaci√≥n en el cuadro de di√°logo de propiedades del m√≥dulo. Seleccionando

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1791

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
la opci√≥n "seg√∫n la velocidad de transferencia" se vigila con los tiempos de espera m√°ximos
indicados a continuaci√≥n:
Tabla 1-122 Tiempo de vigilancia del telegrama de reacci√≥n en funci√≥n de la velocidad de transferencia
Velocidad de transferencia

Tiempo de vigilancia

‚óè 300 baudios

10 s

‚óè 600 baudios

7s

‚óè 1200 baudios

5s

‚óè A partir de 38400 baudios

3s

El campo gris "Tiempo de espera m√°ximo" s√≥lo indica el tiempo de vigilancia utilizado, pero no
puede editarse.

Estructura y contenido del telegrama de reacci√≥n
El telegrama de reacci√≥n se compone de 4 bytes y contiene informaci√≥n sobre el desarrollo de
la petici√≥n.
Byte

Significado

1

Identificador de telegrama en telegramas de respuesta (00H),
en telegramas de continuaci√≥n de respuesta (FFH)

2

Identificador de telegrama (00H)

3

Ocupado con 00H

4

N√∫mero de error del interlocutor en el telegrama de reacci√≥n:
‚óè 00H si la transmisi√≥n ha transcurrido sin problemas
‚óè > 00H n√∫mero de error
El n√∫mero de error en el telegrama de reacci√≥n provoca autom√°ticamente la entrada de un
n√∫mero de error en el √°rea de registro de errores del m√≥dulo.

1792

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Enviar datos con RK512
Desarrollo del proceso de transmisi√≥n de datos en el env√≠o
La siguiente figura representa el desarrollo del proceso de transmisi√≥n de datos durante el
env√≠o con un telegrama de reacci√≥n con el protocolo para mainframe RK512.

0¬µGXOR

,QWHUORFXWRU

7HOHJUDPD6(1'
&DU¬£FWHUGHLQLFLR +
&RQILUPDWL¬µQSRV +
+
+
3HWLFL¬µQ6(1' +
%ORTXHGHGDWRV +
'HVWLQRGHGDWRV'% $+
': +
/RQJLWXG +
': +
6LQ&) ))+
6ROR&38 )+

67;
'/(
HUE\WH
|E\WH
|E\WH
|E\WH
|E\WH
|E\WH
|E\WH
|E\WH

(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ

(QFDEH]DGR
GH
UHVSXHVWD

|E\WH
|E\WH

HUE\WHGHGDWRV
|E\WHGHGDWRV

|E\WH
|E\WH

‡≤µ
‡≤µ
Q|E\WHGHGDWRV

‡≤µ
‡≤µ
Q|E\WH

'HWHFFL¬µQGHILQ +
'HWHFFL¬µQGHILQ +
6¬µORFRQFRPSUREDFL¬µQGH
EORTXH
&RQILUPDWL¬µQSRV +

'/(
(7;
%&&

'DWRV¬ºWLOHV

)LQDO]DFL¬µQGH
ODFRQH[L¬µQ

'/(

7HOHJUDPDGHUHVSXHVWD
&DU¬£FWHUGHLQLFLR +
&RQILUPDWL¬µQSRV +

67;
'/(

+
+
+
1¬ºPHURGHHUURU +

HUE\WH

'HWHFFL¬µQGHILQ +
'HWHFFL¬µQGHILQ +
6¬µORFRQFRPSUREDFL¬µQGH
EORTXH
&RQILUPDWL¬µQSRV +

'/(
(7;
%&&

Figura 1-93

|E\WH
|E\WH
|E\WH

(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ
(QFDEH]DGR
GHWHOHJUDPD
GHUHVSXHVWD

)LQDO]DFL¬µQGH
ODFRQH[L¬µQ

'/(

Intercambio de datos al enviar con telegrama de reacci√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1793

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Enviar datos
La petici√≥n SEND se desarrolla en el siguiente orden:
‚óè Interlocutor activo
Env√≠a un telegrama SEND. √âste contiene datos y el encabezado del telegrama.
‚óè Interlocutor pasivo
Recibe el telegrama, comprueba el encabezado y los datos y confirma con un telegrama de
reacci√≥n tras realizar la transmisi√≥n de dichos datos a la CPU.
‚óè Interlocutor activo
Recibe el telegrama de reacci√≥n y termina la petici√≥n SEND.
Nota
Si la CPU no ha recibido los datos √∫tiles de la petici√≥n SEND sin errores o si se ha producido
un error en el encabezado del telegrama, el interlocutor inserta un n√∫mero de error en el 4¬∫
byte del telegrama de reacci√≥n. Si se trata de fallos de protocolo, no se produce ninguna
entrada en el telegrama de reacci√≥n.

Telegrama SEND de continuaci√≥n
Se inicia una petici√≥n SEND de continuaci√≥n cuando la cantidad de datos sobrepasa los
128 bytes. El procedimiento se corresponde con el de la petici√≥n SEND.
Si se env√≠an m√°s de 128 bytes, √©stos se transmiten autom√°ticamente en uno o m√°s telegramas
de continuaci√≥n. Cada telegrama SEND de continuaci√≥n se acusa con un telegrama de
reacci√≥n de continuaci√≥n
La siguiente figura representa el desarrollo del proceso de transmisi√≥n de datos al enviar un
telegrama SEND de continuaci√≥n con un telegrama de reacci√≥n de continuaci√≥n.
El telegrama de reacci√≥n de continuaci√≥n al √∫ltimo telegrama SEND de continuaci√≥n no se
env√≠a hasta haber enviado todos los datos √∫tiles a la CPU.

1794

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
0¬µGXOR

,QWHUORFXWRU

7HOHJUDPD6(1'GHFRQWLQXDFL¬µQ

(VWDEOHFL
PLHQWRGHOD
FRQH[L¬µQ

&DU¬£FWHUGHLQLFLR +
&RQILUPDWL¬µQSRV +

67;
'/(

7HOHJUDPDGHFRQWLQXDFL¬µQ ))+
+
3HWLFL¬µQ6(1' +
%ORTXHGHGDWRV +

HUE\WH
|E\WH
HUE\WH
|E\WH

|E\WHGHGDWRV
|E\WHGHGDWRV
‡≤µ
‡≤µ

|E\WH
|E\WH
‡≤µ
‡≤µ

Q|E\WHGHGDWRV

Q|E\WH

&DU¬£FWHUGHILQ +
&DU¬£FWHUGHILQ +
6¬µORFRQFRPSUREDFL¬µQGH
EORTXH
&RQILUPDWL¬µQSRV +

'/(
(7;
%&&
'/(

)LQDO]DFL¬µQGH
ODFRQH[L¬µQ

67;

(VWDEOHFL
PLHQWRGHOD
FRQH[L¬µQ

(QFDEH]DGR
GH
UHVSXHVWD

'DWRV
¬ºWLOHV

7HOHJUDPDGHUHDFFL¬µQGHFRQWLQXDFL¬µQ
&DU¬£FWHUGHLQLFLR +
&RQILUPDWL¬µQSRV +
7HOHJUDPDGHUHDFFL¬µQ
GHFRQWLQXDFL¬µQ ))+
+
+
1¬ºPHURGHHUURU
+
&DU¬£FWHUGHILQ +
&DU¬£FWHUGHILQ +
6¬µORFRQFRPSUREDFL¬µQGH
EORTXH
&RQILUPDWL¬µQSRV +

Figura 1-94

'/(

HUE\WH
|E\WH
HUE\WH
|E\WH
'/(
(7;
%&&
'/(

(QFDEH]DGR
GHWHOHJUDPD
GHUHVSXHVWD

)LQDO]DFL¬µQ
GHOD
FRQH[L¬µQ

Desarrollo del telegrama SEND de continuaci√≥n con un telegrama de reacci√≥n de
continuaci√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1795

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Recoger datos con RK512
Fases de la recogida de datos con RK512
La siguiente figura representa el desarrollo del proceso de transmisi√≥n de datos durante la
recogida con un telegrama de reacci√≥n con el protocolo para mainframe RK512.
0¬µGXOR

,QWHUORFXWRU

7HOHJUDPD)(7&+
&DU¬£FWHUGHLQLFLR + 
&RQILUPDWL¬µQSRV +
+ 
+
3HWLFL¬µQ)(7&+ + 
%ORTXHGHGDWRV + 
)XHQWHGDWRV'% +
': +
/RQJLWXG +
': +
VLQ&) ))+
VROR&38 )+
&DU¬£FWHUGHILQ +
&DU¬£FWHUGHILQ +
6¬µORFRQFRPSUREDFL¬µQ
GHEORTXH
&RQILUPDWL¬µQSRV +

67;
'/(
HUE\WH
|E\WH
HUE\WH
|E\WH
|E\WH
|E\WH
|E\WH
|E\WH
|E\WH
|E\WH
'/(
(7;
%&&

(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ

(QFDEH]DGRGH
UHVSXHVWD

)LQDOL]DFL¬µQ
GHODFRQH[L¬µQ

'/(

7HOHJUDPDGHUHDFFL¬µQFRQGDWRV
&DU¬£FWHUGHLQLFLR + 
&RQILUPDWL¬µQSRV +

67;
'/(

+
+
+
1¬ºPHURGHHUURU +

HUE\WH
|E\WH
HUE\WH
|E\WH

HUE\WHGHGDWRV
|E\WHGHGDWRV

|E\WH
|E\WH

‡≤µ
‡≤µ
Q|E\WHGHGDWRV

‡≤µ
‡≤µ
Q|E\WH

&DU¬£FWHUGHILQ +
&DU¬£FWHUGHILQ +
6¬µORFRQFRPSUREDFL¬µQ
GHEORTXH
&RQILUPDWL¬µQSRV +

'/(
(7;
%&&

'/(

Figura 1-95

1796

(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ

(QFDEH]DGR
GHWHOHJUDPD
GHUHVSXHVWD

'DWRV
¬ºWLOHV

)LQDOL]DFL¬µQ
GHODFRQH[L¬µQ

Intercambio de datos al recoger con telegrama de reacci√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Recoger datos
La petici√≥n FETCH se desarrolla en el siguiente orden:
‚óè Interlocutor activo
Env√≠a un telegrama FETCH. √âste contiene el encabezado.
‚óè Interlocutor pasivo
Recibe el telegrama, comprueba el encabezado, recoge los datos de la CPU y confirma la
recepci√≥n con un telegrama de reacci√≥n. √âste contiene los datos.
‚óè Interlocutor activo
Recibe el telegrama de reacci√≥n, transfiere a la CPU los datos √∫tiles recibidos en el
telegrama de reacci√≥n y termina la petici√≥n FETCH.
Si el 4¬∫ byte lleva un n√∫mero de error (no igual a 0), el telegrama de reacci√≥n no contiene datos.
Si se solicitan m√°s de 128 bytes, √©stos se transmiten autom√°ticamente en uno o m√°s
telegramas de continuaci√≥n. Cada telegrama FETCH de continuaci√≥n se acusa con un
telegrama de reacci√≥n de continuaci√≥n (con m√°s datos √∫tiles).
Tras la recepci√≥n del √∫ltimo telegrama de reacci√≥n de continuaci√≥n (con el √∫ltimo bloque de
datos √∫tiles) se transmite todo el conjunto de datos √∫tiles a la CPU y se termina la petici√≥n
FETCH.
Nota
Si la CPU no ha podido procesar correctamente el telegrama FETCH o si se ha producido un
error en el encabezado del telegrama, el interlocutor inserta un n√∫mero de error en el 4¬∫ byte
del telegrama de reacci√≥n. Si se trata de fallos de protocolo no se produce ninguna entrada en
el telegrama de reacci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1797

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Telegrama FETCH de continuaci√≥n
La siguiente figura representa el desarrollo del proceso de transmisi√≥n de datos al recoger
datos con un telegrama de reacci√≥n de continuaci√≥n.

0¬µGXOR

,QWHUORFXWRU

7HOHJUDPD)(7&+GHFRQWLQXDFL¬µQ
&DU¬£FWHUGHLQLFLR +
&RQILUPDWL¬µQSRV +

67;
'/(

(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ

7HOHJUDPDGHFRQWLQXDFL¬µQ
))+
+
3HWLFL¬µQ)(7&+ +
%ORTXHGHGDWRV +

HUE\WH
|E\WH
HUE\WH
|E\WH

(QFDEH]DG
RGH
UHVSXHVWD

&DU¬£FWHUGHILQ +
&DU¬£FWHUGHILQ +
6¬µORFRQFRPSUREDFL¬µQGH
EORTXH
&RQILUPDWL¬µQSRV +

'/(
(7;
%&&

)LQDO]DFL¬µQGH
ODFRQH[L¬µQ

'/(

7HOHJUDPDGHUHDFFL¬µQGHFRQWLQXDFL¬µQ
&DU¬£FWHUGHLQLFLR +
&RQILUPDWL¬µQSRV +
7HOHJUDPDGHUHDFFL¬µQ
GHFRQWLQXDFL¬µQ ))+
+
+

'/(

HUE\WH
|E\WH
HUE\WH

1¬ºPHURGHHUURU +

|E\WH

|E\WHGHGDWRV
|E\WHGHGDWRV

|E\WH

‡≤µ
‡≤µ
Q|E\WHGHGDWRV

|E\WH
‡≤µ
‡≤µ
Q|E\WH

&DU¬£FWHUGHILQ +
&DU¬£FWHUGHILQ 
6¬µORFRQFRPSUREDFL¬µQGH
EORTXH
&RQILUPDWL¬µQSRV +

'/(
(7;
%&&
'/(

Figura 1-96

1798

67;

(VWDEOHFLPLHQWR
GHODFRQH[L¬µQ

(QFDEH]DGR
GHWHOHJUDPD
GHUHVSXHVWD

'DWRV¬ºWLOHV

)LQDO]DFL¬µQGH
ODFRQH[L¬µQ

Desarrollo del telegrama FETCH de continuaci√≥n con un telegrama de reacci√≥n de
continuaci√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Modo casi d√∫plex
Casi d√∫plex significa: los interlocutores pueden enviar telegramas de orden y de respuesta en
cualquier momento, menos cuando el otro interlocutor est√° enviando. La profundidad de
anidado m√°ximo de los telegramas de orden y de recepci√≥n es "1". Por ello, s√≥lo es posible
procesar un nuevo telegrama de orden cuando el primero ha sido contestado con un telegrama
de reacci√≥n.
En algunos casos - cuando ambos interlocutores quieren enviar - puede enviarse un telegrama
SEND o FETCH del interlocutor antes del telegrama de reacci√≥n. Por ejemplo, cuando en el
b√∫fer de salida del m√≥dulo de comunicaci√≥n se ha registrado un telegrama SEND o FETCH del
interlocutor antes del telegrama de reacci√≥n.
En la siguiente figura el telegrama de reacci√≥n de continuaci√≥n para el primer telegrama SEND
se env√≠a despu√©s del telegrama SEND del interlocutor .

0¬µGXOR

,QWHUORFXWRU
7HOHJUDPD6(1'
7HOHJUDPDGHUHVSXHVWD
HUWHOHJUDPD6(1'GHFRQWLQXDFL¬µQ
7HOHJUDPD6(1'GLQWHUORFXWRU
HUWHOHJUDPDGHUHVSXHVWDGHFRQWLQXDFL¬µQ
|WHOHJUDPD6(1'GHFRQWLQXDFL¬µQ
7HOHJUDPDGHUHVSXHVWD
|WHOHJUDPDGHUHVSXHVWDGHFRQWLQXDFL¬µQ

Figura 1-97

Modo casi d√∫plex

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1799

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Peticiones RK512 de CPU
En la siguiente figura se representa el desarrollo del proceso de protocolo para mainframe
RK512 mediante peticiones de CPU.
3RVLFL¬µQ
GHUHSRVR
SHWLFLRQHV
&38
3HWLFL¬µQ&38
7HOHJUDPDGH
RUGHQGH&38
,QLFLR75($

7!75($
(VSHUDD HUURULQWHUUXSFL¬µQ
WHOHJUDPDGH
UHVS
7HOHJUDPDGH
UHVSXHVWDUHFLELGR
7RGRVORVGDWRVUHFLELGRV
3HWLFL¬µQGH&38
ILQDOL]DGD

2WURVVXE
EORTXHV
(QYLRGHWHOH
JUDPDGHRUGHQ
GHFRQWLQXDFL¬µQ
,QLFLR75($
(VSHUD
DWHOHJGH
UHVSGH
FRQWLQXDFL¬µQ

7!75($RWHOHJUDPD
GHUHVSXHVWDUHFLELGR
(UURULQWHUUXSFL¬µQ

7HOHJUDPDGH
UHVSXHVWDGHFRQ
WLQXDFL¬µQUHFLELGR
7LHPSRGHYLJLODQFLDGHWHOHJUDPDGHUHVSXHVWD
HQIXQFL¬µQGHODYHORFLGDGGHWUDQVP
75($ V VV

Figura 1-98

1800

Fases de la transmisi√≥n de datos con RK512 mediante peticiones de CPU

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Peticiones RK512 de interlocutor
En la siguiente figura se representa el desarrollo del proceso de protocolo para mainframe
RK512 mediante peticiones de interlocutor.
3RVLFL¬µQGH
UHSRVRSHWL
FLRQHVGHLQ
WHUORFXWRU
7HOHJUDPDGHRUGHQGH
LQWHUORFXWRUUHFLELGR
7UDQVPLWLUGDWRVDO
3/&RUHFRJHUORV
GHOPLVPR
(UURU
(QY¬ØRGHWHOHJUDPD
GHUHVSXHVWDVLQ
UHJLVWURGHHUURU

(QY¬ØRGHWHOHJUDPD
GHUHVSXHVWDFRQ
UHJLVWURGHHUURU
3HWLFL¬µQGH
LQWHUORFXWRUILQDOL]DGD

2WURV
VXEEORTXHV

7RGRVORVGDWRVUHFLELGRV

,QLFLR75($

(VSHUDD 7!75($RWHOHJUDPD
WHOHJUDPDGH GHRUGHQUHFLELGR
(UURULQWHUUXSFL¬µQ
FRQWLQXDFL¬µQ
7HOHJUDPDGH
UHVSXHVWDGHFRQ
WLQXDFL¬µQUHFLELGR
7LHPSRGHYLJLODQFLDSDUDWHOHJUDPDGHUHVSXHVWDHQIXQFL¬µQGHODYHORFLGDGGHWUDQVPLVL¬µQ
75($ V VV 
3/& DXW¬µPDWD

Figura 1-99

Esquema de desarrollo de la transmisi√≥n de datos con RK512 mediante peticiones de
interlocutor

Transmisi√≥n de datos con driver de impresora
Transmisi√≥n de datos con el driver de impresora
Para la asignaci√≥n de los protocolos a los m√≥dulos de comunicaci√≥n v√©ase: Sinopsis de los
componentes e interfaces (P√°gina 1756)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1801

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Introducci√≥n
Con el driver de impresora se pueden imprimir textos de aviso con indicaci√≥n de fecha y hora.
De este modo es posible controlar procesos sencillos, imprimir avisos de error o alarmas o p.ej.
dar instrucciones a los operarios.
El driver de impresora contiene el nivel de transmisi√≥n de bits (nivel 1).

Textos de aviso y par√°metros para la impresi√≥n
En el cuadro de di√°logo de propiedades del m√≥dulo se configuran los textos de aviso y se
definen los par√°metros (dise√±o de p√°gina, juego de caracteres, caracteres de control) para la
impresi√≥n. Los textos de aviso y los par√°metros para la impresi√≥n se transmiten al m√≥dulo de
comunicaci√≥n durante su arranque junto con los par√°metros del m√≥dulo.
‚óè Textos de aviso:
Los textos de aviso se pueden configurar con variables e instrucciones de control (como p.
ej. negrita, cursiva, subrayado, etc.). Cada texto de aviso recibe un n√∫mero en la
configuraci√≥n. En los m√≥dulos CP 441, la impresi√≥n de un texto de aviso determinado se
produce mediante la indicaci√≥n de una referencia (en la c√©lula de memoria que contiene el
n√∫mero del texto) en los par√°metros de env√≠o SD_1 a SD_4 de la instrucci√≥n. En los
m√≥dulos CP 34x se define indicando el n√∫mero de texto de aviso en una cadena de formato
en la llamada de la instrucci√≥n.
Los textos de aviso configurados pueden guardarse en un archivo de texto externo (nombre
del SDB, m√°ximo 8 caracteres ASCII) y modificarlos con el editor apropiado. De esta forma,
por ejemplo, es posible traducir los textos y volver a leerlos.
Estructura del archivo de textos de aviso:
<N√∫mero de versi√≥n>
<N√∫mero del aviso>:<Contenido del aviso>
‚óè Dise√±o de p√°gina:
Para el dise√±o de p√°gina es posible ajustar los m√°rgenes, saltos de l√≠nea, as√≠ como los pies
de p√°gina y los encabezamientos.
‚óè Juego de caracteres:
Con una tabla de conversi√≥n de caracteres se cambia del juego de caracteres ANSI de
STEP 7 al juego de caracteres de impresi√≥n. Es posible hacer modificaciones en la tabla de
conversi√≥n de caracteres propuesta para el tipo de impresi√≥n, y adoptar as√≠ p. ej. los
caracteres espec√≠ficos de un pa√≠s.
‚óè Caracteres de control:
Una tabla de caracteres de control le permite modificar las instrucciones de control del texto
de aviso para la emulaci√≥n de impresora para activar y desactivar la letra negrita, cursiva,
comprimida y expandida o el subrayado o incluir nuevos caracteres de control.

Variables
En el texto del aviso se pueden visualizar hasta 4 variables (3 + n√∫mero de aviso). Los valores
de las variables pueden transferirse de la CPU al modulo de comunicaci√≥n. Como variables
pueden visualizarse:
‚óè Valores de c√°lculo del programa de usuario (p. ej.: niveles de llenado)
‚óè Fecha y hora

1802

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Cadenas (variable String)
‚óè Otros textos de aviso
Para cada variable es necesario indicar en el texto de aviso configurado o en la cadena de
formato una instrucci√≥n de conversi√≥n en la que est√© codificado el significado y el formato de
salida del valor de la variable.

Cadena de formato
Con la cadena de formato se define la representaci√≥n y composici√≥n de un texto de aviso. La
cadena de formato puede componerse de:
‚óè Texto (todos los caracteres imprimibles, p. ej.: A las ... horas se ha alcanzado el nivel ... l)
‚óè Las instrucciones de conversi√≥n para variables (p. ej. %N = puntero al n√∫mero de texto de
aviso x, donde x es un valor de variable (ver ejemplo 2 m√°s abajo))
Para cada variable debe haber exactamente una instrucci√≥n de conversi√≥n en la cadena de
formato o en el texto de aviso configurado. Las instrucciones de conversi√≥n se aplican a las
variables conforme a su orden.
‚óè Las instrucciones de control con car√°cter de control para negrita, comprimida, expandida,
cursiva y subrayado (p. ej. \B = activar negrita) o bien con caracteres de control definidos
por el usuario
Se pueden utilizar caracteres de control adicionales registr√°ndolos en el cuadro de di√°logo de
propiedades del m√≥dulo y reparametrizando el m√≥dulo de comunicaci√≥n.

Otras funciones
Adem√°s de la impres√≥n de textos de aviso, tambi√©n se pueden utilizar las siguientes funciones
de impresi√≥n. La ejecuci√≥n de una de estas funciones tambi√©n se indica en la cadena de
formato.
‚óè Ajustar el n√∫mero de p√°gina (cadena de caracteres = %P)
‚óè Iniciar p√°gina nueva (cadena de formato = \F)
‚óè Imprimir con/sin salto de l√≠nea m(\x al final de la cadena de formato)
Recuerde que en la configuraci√≥n est√°ndar se realizar un salto de l√≠nea despu√©s de cada
impresi√≥n.

Ejemplos
Ejemplo 1: A las "17:30" horas se ha alcanzado el nivel "200" l
Cadena de formato = A las %Z horas se ha alcanzado el nivel %i l.
Variable 1 = hora
Variable 2 = nivel
Ejemplo 2: La presi√≥n de la c√°mara "desciende"
Cadena de formato = %N %S
Variable 1 = 17 (texto de aviso n.¬∫ 17: La presi√≥n de la c√°mara ...)
Variable 2 = referencia a cadena (variable String: ... desciende)
Ejemplo 3: (Ajustar el n√∫mero de p√°gina a 10)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1803

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Cadena de formato = %P
Variable 1 = 10 (n√∫mero de p√°gina: 10)

Impresi√≥n
Para que pueda producirse la salida de n bytes de datos √∫tiles a la impresora deben indicarse
la cadena de formato y las variables del texto de aviso en la llamada de la instrucci√≥n en forma
de par√°metros.
Durante la impresi√≥n se preparan los datos que se van a imprimir. La impresi√≥n se procesa
conforme a la parametrizaci√≥n del cuadro de di√°logo de propiedades del m√≥dulo (dise√±o de
p√°gina, juego de caracteres, caracteres de control, etc.).
En la salida por impresora no se reciben caracteres. Son excepci√≥n los caracteres de control
para el control de flujo, si √©stos se han parametrizado de la forma correspondiente. No se
acepta ning√∫n otro car√°cter que pueda aparecer.

Salida del texto de aviso
En la figura siguiente se representan los procesos de impresi√≥n.

3HWLFL¬µQSURFHVDGD

(VSHUDUDSHWLFL¬µQ
GHLPSUHVL¬µQ

3HWLFL¬µQGHLPSUHVL¬µQUHFLELGD

3UHSDUDFL¬µQGH
LPSUHVL¬µQ\VDOLGD
GHOWH[WRGHDYLVR

Figura 1-100

Esquema del proceso de impresi√≥n

Handshake de software/hardware
Los procedimientos handshake controlan el flujo de datos entre dos interlocutores. El
procedimiento handschake evita que se pierdan datos durante la transmisi√≥n con equipos que
trabajan a diferente velocidad.

1804

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En la impresi√≥n tambi√©n es posible enviar los datos de salida con control de flujo de datos.
B√°sicamente se distinguen dos procedimientos:
‚óè Handshake de software (p. ej. XON/XOFF)
‚óè Handshake de hardware (p. ej. RTS/CTS)
En la impresi√≥n, el control del flujo de datos en el m√≥dulo de comunicaci√≥n se desarrolla de la
siguiente manera:
‚óè En cuanto el m√≥dulo de comunicaci√≥n pasa por parametrizaci√≥n al modo de operaci√≥n con
control de flujo, env√≠a el car√°cter XON o pone la l√≠nea RTS en estado ON.
‚óè Si el m√≥dulo de comunicaci√≥n recibe el car√°cter XOFF o si la se√±al de control CTS pasa a
estado OFF, el m√≥dulo interrumpe la salida de caracteres. Si transcurrido un tiempo
determinado parametrizable no se recibe ning√∫n car√°cter XON o CTS no pasa a ON, la
impresi√≥n se interrumpe y se registra el correspondiente mensaje de error (0708H) en la
salida STATUS de la instrucci√≥n.
Nota
Si se parametriza con control de flujo RTS/CTS es necesario cablear por completo las
se√±ales de interfaz utilizadas en la conexi√≥n por conector.

Se√±al BUSY
El m√≥dulo de comunicaci√≥n eval√∫a la se√±al de control "BUSY" de la impresora. √âsta notifica al
CP 34x1 su disposici√≥n de recepci√≥n,
‚óè En el caso del CP 34x-20mA-TTY: Con corriente en la l√≠nea RxD.
‚óè En el caso del CP 34x‚ÄìRS232C y el CP 34x-RS422/485: Con se√±al CTS = "ON".
Nota
Si se parametriza con control de flujo, en la impresora hay que ajustar la polaridad de la
se√±al BUSY de la siguiente manera:
‚óè Se√±al BUSY: CTS = "OFF"
Recuerde que algunas impresoras indican la se√±al BUSY con la se√±al DTR. En ese caso
hay que realizar el cableado correspondiente en el cable de conexi√≥n que va al m√≥dulo de
comunicaci√≥n.

Detecci√≥n del fin de un telegrama
Criterios de fin
En la transmisi√≥n de datos con el driver ASCII se puede elegir entre tres criterios de fin distintos
para la recepci√≥n de datos:
‚óè Tiempo de retardo entre caracteres transcurrido
‚óè Recepci√≥n del/de los car√°cter(es) de fin
‚óè Recepci√≥n de un n√∫mero de caracteres determinado

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1805

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros de protocolo
En la tabla siguiente encontrar√° una descripci√≥n de los par√°metros de protocolo.
Tabla 1-123 Par√°metros de protocolo (driver ASCII)
Par√°metro

Descripci√≥n

Rango de valores

Valor predeterminado

Detecci√≥n de fin de
un telegrama de re‚Äê
cepci√≥n

Determinaci√≥n del criterio que determina
el fin de telegramas.

‚óè Transcurrido el tiempo de
retardo de caracteres

Transcurrido el tiempo
de retardo de caracte‚Äê
res

‚óè Tras recibir el/los
car√°cter(es) de fin
‚óè Tras recibir un n√∫mero fijo
de caracteres

Car√°cter de fin 1 1

C√≥digo de la primera identificaci√≥n de fin. ‚óè Con 7 bits de datos:
0 a 7FH (Hex) 2

3 (03H = ETX)

‚óè Con 8 bits de datos:
0 a FFH (Hex) 2
Car√°cter de fin 2 1

C√≥digo de la segunda identificaci√≥n de
fin, si est√° activada.

0

‚óè Con 7 bits de datos:
0 a 7FH (Hex) 2
‚óè Con 8 bits de datos:
0 a FFH (Hex) 2

1

S√≥lo ajustable con el criterio de fin Car√°cter final.

2

Dependiendo de si para la trama de caracteres se parametrizan 7 u 8 bits de datos.

Informaci√≥n adicional
Encontrar√° una descripci√≥n detallada de la recepci√≥n de datos con el driver ASCII en el
apartado Recepci√≥n de datos con el driver ASCII (P√°gina 1770).

Control del flujo de datos y se√±ales cualificadoras
Introducci√≥n
El m√≥dulo de comunicaci√≥n le permite crear un acoplamiento punto a punto con m√≥dulos
SIMATIC y con productos externos.

Funciones compatibles con las interfaces
Dependiendo de la interfaz utilizada, pueden utilizarse diferentes funciones de los drivers:
Tabla 1-124 Funciones del m√≥dulo de comunicaci√≥n dependiendo de la interfaz utilizada
RS232C

20mA TTY

X27 (RS422/485)
RS422*

RS485*

Funci√≥n CP 441
Procedimiento 3964(R)

‚óè

‚óè

‚óè

-

Protocolo para mainframe RK512

‚óè

‚óè

‚óè

-

1806

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
RS232C
Driver ASCII:

‚óè

20mA TTY
‚óè

X27 (RS422/485)
RS422*

RS485*

‚óè

‚óè

‚óè Manejo de las se√±ales cualificadoras RS 232C

‚óè

-

-

-

‚óè Control/lectura de las se√±ales cualificadoras RS 232C con
instrucciones

‚óè

-

-

-

‚óè Control del flujo de datos con RTS/CTS

‚óè

-

-

-

‚óè Control del flujo de datos con XON/XOFF

‚óè

‚óè

‚óè

-

Driver de impresora:

‚óè

‚óè

‚óè

‚óè

‚óè Control del flujo de datos con RTS/CTS

‚óè

-

-

-

‚óè Control del flujo de datos con XON/XOFF

‚óè

‚óè

‚óè

-

Procedimiento 3964(R)

‚óè

-

Driver ASCII:

‚óè

‚óè

‚óè Control del flujo de datos con XON/XOFF

‚óè

-

Funci√≥n CP 440

Funci√≥n CP 341
Procedimiento 3964(R)

‚óè

‚óè

‚óè

-

Protocolo para mainframe RK512

‚óè

‚óè

‚óè

-

Driver ASCII:

‚óè

‚óè

‚óè

‚óè

‚óè Manejo de las se√±ales cualificadoras RS 232C

‚óè

-

-

-

‚óè Control/lectura de las se√±ales cualificadoras RS 232C con
instrucciones

‚óè

-

-

-

‚óè Control del flujo de datos con RTS/CTS

‚óè

-

-

-

‚óè Control del flujo de datos con XON/XOFF

‚óè

‚óè

‚óè

-

Driver de impresora:

‚óè

‚óè

‚óè

‚óè

‚óè Control del flujo de datos con RTS/CTS

‚óè

-

-

-

‚óè Control del flujo de datos con XON/XOFF

‚óè

‚óè

‚óè

-

Procedimiento 3964(R)

‚óè

‚óè

‚óè

-

Driver ASCII:

‚óè

‚óè

‚óè

‚óè

‚óè Manejo de las se√±ales cualificadoras RS 232C

‚óè

-

-

-

‚óè Control/lectura de las se√±ales cualificadoras RS 232C con
instrucciones

‚óè

-

-

-

‚óè Control del flujo de datos con RTS/CTS

‚óè

-

-

-

‚óè Control del flujo de datos con XON/XOFF

‚óè

‚óè

‚óè

-

Driver de impresora:

‚óè

‚óè

‚óè

‚óè

‚óè Control del flujo de datos con RTS/CTS

‚óè

-

-

-

‚óè Control del flujo de datos con XON/XOFF

‚óè

‚óè

‚óè

-

Funci√≥n CP 340

Funci√≥n ET 200S 1SI
Procedimiento 3964(R)

‚óè

‚óè

-

Driver ASCII:

‚óè

‚óè

‚óè

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1807

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Manejo de las se√±ales cualificadoras RS 232C

‚óè

-

-

‚óè Control/lectura de las se√±ales cualificadoras RS 232C
con instrucciones

‚óè

-

-

‚óè Control del flujo de datos con RTS/CTS

‚óè

-

-

‚óè Control del flujo de datos con XON/XOFF

‚óè

‚óè

-

* La diferenciaci√≥n entre RS422 y RS485 se consigue mediante parametrizaci√≥n.

Aplicaciones posibles de los m√≥dulos de comunicaci√≥n
Dependiendo del m√≥dulo de comunicaci√≥n utilizado puede crearse un acoplamiento punto a
punto con diferentes m√≥dulos Siemens, as√≠ como con productos externos:
‚óè SIMATIC S5 v√≠a driver 3964(R) o RK512 con el correspondiente m√≥dulo de interfaz en el
lado de S5
‚óè Terminales Siemens BDE de la familia ES 2 v√≠a driver 3964(R)
‚óè MOBY I (ASM 420/421, SIM), MOBY L (ASM 520) y estaci√≥n de registro ES 030K v√≠a driver
3964R
‚óè PC mediante procedimiento 3964(R) (existen herramientas de desarrollo para
programaci√≥n en PC: PRODAVE DOS 64R (6ES5 897-2UD11) para MS-DOS,
PRODAVE WIN 64R
(6ES5 897-2VD01) para Windows o el driver ASCII)
‚óè Lector de c√≥digo de barras v√≠a driver 3964(R) o driver ASCII
‚óè PLC de otro fabricante v√≠a 3964(R), driver ASCII o RK512
‚óè Otros aparatos con estructuras de protocolo sencillas mediante la correspondiente
adaptaci√≥n del protocolo con el driver ASCII
‚óè Otros equipos que tambi√©n dispongan del driver 3964(R) o RK512
‚óè Impresora (HP-Deskjet, HP-Laserjet, Postscript, Epson, IBM)

1808

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Modos de operaci√≥n de la interfaz
Posibles modos de operaci√≥n de la interfaz
En la siguiente tabla se muestran los modos de operaci√≥n de la interfaz para m√≥dulos de
comunicaci√≥n y protocolos en general.
Modo de operaci√≥n

Descripci√≥n

Semid√∫plex (RS485) a 2 hilos

Modo de operaci√≥n para acoplamiento punto a punto o acoplamiento multipunto
(Multipoint) en modo a dos hilos. El m√≥dulo de comunicaci√≥n puede ser tanto
maestro como esclavo.
En el modo de operaci√≥n RS485, la transmisi√≥n de datos se realiza a trav√©s de dos
l√≠neas (modo a dos hilos). Las dos l√≠neas est√°n disponibles para el env√≠o y la
recepci√≥n variando de direcci√≥n. Podr√° bien enviarse o bien recibirse (semid√∫‚Äê
plex). Tras un proceso de env√≠o se conmuta inmediatamente al proceso de re‚Äê
cepci√≥n (tiempo m√°ximo de conmutaci√≥n de 1 ms).

D√∫plex (RS422) a 4 hilos

En el modo de operaci√≥n RS422, la transmisi√≥n de datos se realiza a trav√©s de
cuatro l√≠neas (modo a cuatro hilos). Dos de las l√≠neas estar√°n disponibles para el
env√≠o y las otras dos para la recepci√≥n. Podr√° enviarse y recibirse al mismo tiempo
(d√∫plex).
Los datos se intercambian simult√°neamente entre uno o varios interlocutores; en
un determinado punto puede tanto enviarse como recibirse. Cada interlocutor
deber√° poder utilizar simult√°neamente una direcci√≥n de env√≠o y recepci√≥n.

D√∫plex (RS422) modo a 4 hilos (acopla‚Äê El m√≥dulo de comunicaci√≥n puede emplearse en el modo de operaci√≥n RS422 en
miento punto a punto) 1)
las siguientes topolog√≠as:
‚óè Acoplamiento entre dos estaciones: acoplamiento Punto a punto
‚óè Acoplamiento entre varias estaciones: acoplamiento multipunto
El m√≥dulo de comunicaci√≥n puede emplearse como maestro y como esclavo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1809

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Modo de operaci√≥n

Descripci√≥n

D√∫plex (RS422) modo a 4 hilos (maes‚Äê
tro multipunto) 1)

El m√≥dulo de comunicaci√≥n puede emplearse en el modo de operaci√≥n RS422 en
las siguientes topolog√≠as:
‚óè Acoplamiento entre dos estaciones: Acoplamiento punto a punto
‚óè Acoplamiento entre varias estaciones: Acoplamiento multipunto
El m√≥dulo de comunicaci√≥n puede emplearse como maestro multipunto y como
esclavo multipunto.
En una topolog√≠a maestro/esclavo en modo RS422 se aplica que:
‚óè El emisor del maestro se interconecta con los receptores de todos los esclavos.
‚óè Los emisores de los esclavos se interconectan con el receptor del maestro.
‚óè La asignaci√≥n previa s√≥lo se produce en el receptor del maestro y en el
receptor de un esclavo. Todos los dem√°s esclavos trabajan sin asignaci√≥n
previa.

D√∫plex (RS422) modo a 4 hilos (maes‚Äê
tro multipunto) 1)

El m√≥dulo de comunicaci√≥n puede emplearse en el modo de operaci√≥n RS422 en
las siguientes topolog√≠as:
‚óè Acoplamiento entre dos estaciones: Acoplamiento punto a punto
‚óè Acoplamiento entre varias estaciones: Acoplamiento multipunto
El m√≥dulo de comunicaci√≥n puede emplearse como maestro multipunto y como
esclavo multipunto.
En una topolog√≠a maestro/esclavo en modo RS422 se aplica que:
‚óè El emisor del maestro se interconecta con los receptores de todos los esclavos.
‚óè Los emisores de los esclavos se interconectan con el receptor del maestro.
‚óè La asignaci√≥n previa s√≥lo se produce en el receptor del maestro y en el
receptor de un esclavo. Todos los dem√°s esclavos trabajan sin asignaci√≥n
previa.

1)

s√≥lo CP 440

1810

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ocupaci√≥n est√°ndar de la l√≠nea de recepci√≥n
Interfaz X27 (RS422/485)
En la siguiente tabla se describen los par√°metros del subm√≥dulo interfaz X27 (RS422/485). No
puede emplearse el modo RS485 con los procedimientos 3964(R) y RK512 y la impresora.
Tabla 1-125 M√≥dulo interfaz X27 (RS422/485)
Par√°metros

Descripci√≥n

Ocupaci√≥n est√°n‚Äê
ninguno: este ajuste s√≥lo tiene sentido
dar de la l√≠nea de re‚Äê para drivers especiales con capacidad
cepci√≥n
para bus.
Se√±al R(A) 5V, se√±al R(B) 0V (detec‚Äê
ci√≥n de rotura): Con estos ajustes pre‚Äê
determinados, en el modo "D√∫plex
(RS 422) modo a 4 hilos" es posible la
detecci√≥n de rotura.

Rango de valores

Valor por defecto

ninguno

Se√±al R(A) 5 V, se√±al R(B) 0
V (detecci√≥n de rotura) (2)

Se√±al R(A) 5 V, se√±al R(B) 0
V (detecci√≥n de rotura) (1)

Se√±al R(A) 0V, se√±al R(B) 5V: Este es‚Äê Se√±al R(A) 0V, se√±al R(B)
5V
tado inicial corresponde al estado de
reposo (no hay emisor activo) en el mo‚Äê
do "semid√∫plex (RS 485) dos cables".
Con este ajuste predeterminado no es
posible la detecci√≥n de rotura.
(1)

S√≥lo en "D√∫plex (RS422) modo a cuatro hilos"

S√≥lo en "D√∫plex (RS422) modo a cuatro hilos"; en "Semid√∫plex (RS485) modo a dos hilos" la configuraci√≥n predeterminada
es R(A) 0V, se√±al R(B) 5V
(2)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1811

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ocupaci√≥n est√°ndar de la l√≠nea de recepci√≥n
La figura muestra el cableado del receptor en la interfaz X27 (RS422/485):
5 % 

1LQJXQR

5 $ 

9
5 % 

6H¬≥DO5 $ 9
6H¬≥DO5 % 9
'HWHFFL¬µQ%UHDN

5 $ 
9
9

5 % 

6H¬≥DO5 $ 9
6H¬≥DO5 % 9

5 $ 
9

Figura 1-101

Cableado del receptor en la interfaz X27 (RS 422/485)

CP 440 en una topolog√≠a multipunto con los protocolos RS422/485
Posibles aplicaciones
En los modos de operaci√≥n RS422 y RS485, el CP 440 puede emplearse en diferentes
topolog√≠as.
Se distingue entre acoplamientos con
‚óè dos estaciones (punto a punto) y
‚óè muchas estaciones (multipunto/multipoint).
El CP 440 puede emplearse como
‚óè maestro o
‚óè esclavo.

1812

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Modo RS422 o RS485 con conexiones punto a punto

Figura 1-102

RS422 punto a punto

Figura 1-103

RS485 punto a punto

En una topolog√≠a maestro/esclavo, en el programa de usuario debe suprimirse el telegrama
correspondiente. Ejemplo: el maestro env√≠a a todos los esclavos un telegrama con una
informaci√≥n de direcci√≥n. Todos los esclavos los reciben y comparan la direcci√≥n con la suya
propia. Si coinciden, el esclavo invocado env√≠a su respuesta.
Los emisores de todos los esclavos deben ser capaces de activarse con alta resistencia
√≥hmica.

Modo RS422 con conexiones multipunto
En una topolog√≠a maestro/esclavo en modo RS422
‚óè el emisor del maestro se interconecta con los receptores de todos los esclavos,
‚óè los emisores de los esclavos se interconectan con el receptor del maestro,
‚óè la asignaci√≥n previa s√≥lo se produce en el receptor del maestro y en el receptor de un
esclavo. Todos los dem√°s esclavos trabajan sin asignaci√≥n previa.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1813

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
0DVWHU

6ODYH

6ODYH

Figura 1-104

6ODYH

RS422 multipunto (multipoint)

Modo RS485 con conexiones multipunto
En una topolog√≠a en modo RS485
‚óè se interconectan la pareja de cables para env√≠o/recepci√≥n de todas las estaciones,
‚óè la asignaci√≥n previa s√≥lo se realiza en el receptor de una estaci√≥n. Todos los dem√°s
m√≥dulos trabajan sin asignaci√≥n previa.
0DVWHU

6ODYH

Figura 1-105

1814

6ODYH

6ODYH

RS485 multipunto (multipoint)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los ajustes necesarios para las diferentes topolog√≠as se realizan en el cuadro de di√°logo de
propiedades, en la m√°scara "Interfaz".
Nota
Si utiliza el driver ASCII en modo RS422 multipunto o en modo RS485, en el programa de
usuario debe asegurarse de que nunca pueda enviar m√°s de una estaci√≥n. Si env√≠an m√°s de
una simult√°neamente, el telegrama se falsifica.

B√∫fer de recepci√≥n
B√∫fer de recepci√≥n del m√≥dulo
La tabla siguiente describe los par√°metros del b√∫fer de recepci√≥n del m√≥dulo.
Tabla 1-126 B√∫fer de recepci√≥n del m√≥dulo - Procedimiento 3964(R) / RK512 / driver ASCII
Par√°metros

Descripci√≥n

Rango de va‚Äê
lores

Valor por defec‚Äê
to

Borrar b√∫fer de recep‚Äê
ci√≥n del m√≥dulo en el
arranque

El b√∫fer de recepci√≥n del m√≥dulo no se borra durante el arranque no (no modifi‚Äê
de la CPU (cambio STOP RUN).
cable)

no

Utilizar un buz√≥n de
CPU (s√≥lo CP 441)

Puede indicar si desea configurar un buz√≥n en la CPU.

‚óè s√≠

no

Se debe configurar un buz√≥n de recepci√≥n si en el programa de
usuario de la CPU para el m√≥dulo no se ha programado ninguna
instrucci√≥n BRCV.

‚óè no

Si ha programado un BRCV, debe desactivar este par√°metro, ya
que si no lo hace los datos no ser√°n procesados por el BRCV,
sino que se recoger√°n en el buz√≥n.
N√∫mero DB (1)

N√∫mero del bloque de datos para el buz√≥n en la CPU

(1)

S√≥lo con "Utilizar buz√≥n de CPU" = "s√≠".

(2)

S√≥lo si "Telegramas de recepci√≥n respaldados" = "1".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1 a 65535 (se‚Äê 1
g√∫n la CPU)

1815

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tabla 1-127 B√∫fer de recepci√≥n del m√≥dulo - adicionalmente en el driver ASCII
Par√°metros

Descripci√≥n

Rango de va‚Äê
lores

Valor por defec‚Äê
to

Telegramas de recep‚Äê
ci√≥n respaldados

Se puede indicar el n√∫mero de telegramas de recepci√≥n que se
deben respaldar en el b√∫fer de recepci√≥n del modulo de comu‚Äê
nicaci√≥n.

1 a 250

250

Si indica el valor "1", y desactiva el siguiente par√°metro "Impedir
sobrescritura" y lee los datos recibidos c√≠clicamente en el pro‚Äê
grama de usuario, siempre se enviar√° un telegrama actual a la
CPU.
Telegramas din√°micos
ET 200S 1SI

Activado
En la recepci√≥n de avisos puede establecer si deber√° respal‚Äê
‚óè Activado
darse un √∫nico aviso o si, por el contrario, los avisos deben res‚Äê ‚óè Bloqueado
paldarse de forma din√°mica.
Al activar los telegramas din√°micos, el m√≥dulo puede respaldar
m√°s avisos con distintas longitudes. El b√∫fer en cuesti√≥n es un
b√∫fer en anillo. Si √©ste estuviera lleno, se sobrescribir√≠a el aviso
m√°s antiguo, a no ser que estuviese activado el par√°metro "Evi‚Äê
tar sobrescritura de b√∫fer". En este caso, se rechazar√° el nuevo
aviso. En ambos casos una alarma de diagn√≥stico ser√° la en‚Äê
cargada de indicar que se han perdido datos.

Impedir sobrescritura

Si para el par√°metro "Telegramas de recepci√≥n respaldados"
indica el valor "1", puede desactivar este par√°metro. De esta
manera permite que se sobrescriba el telegrama de recepci√≥n
respaldado.

(1)

S√≥lo con "Utilizar buz√≥n de CPU" = "s√≠".

(2)

S√≥lo si "Telegramas de recepci√≥n respaldados" = "1".

s√≠

‚óè s√≠
‚óè no

(2)

Comunicaci√≥n Modbus
Resumen de la comunicaci√≥n Modbus
Clasificaci√≥n dentro del entorno del sistema
La siguiente descripci√≥n de Modbus se refiere al uso del driver correspondiente cargable
posteriormente en los procesadores de comunicaciones CP 341 (S7 300) y CP 441‚Äë2 (S7 400),
as√≠ como al uso del m√≥dulo ET 200S 1SI en la variante Modbus/USS.

Funci√≥n del acoplamiento
Con los m√≥dulos de comunicaci√≥n debidamente equipados y las correspondientes
instrucciones se puede establecer un enlace entre un sistema de control Modbus remoto (p. ej.
aut√≥matas Modicon o Honeywell TDC3000) y una SIMATIC S7.
Para la transmisi√≥n se utiliza el protocolo GOULD - MODBUS en el formato RTU.
En la comunicaci√≥n entre un m√≥dulo de comunicaci√≥n utilizado como esclavo Modbus y un
sistema maestro se pueden utilizar los c√≥digos de funci√≥n 01, 02, 03, 04, 05, 06, 08, 15 y 16.

1816

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si un m√≥dulo de comunicaci√≥n SIMATIC S7 se utiliza como maestro Modbus, adem√°s est√°n
disponibles los siguientes c√≥digos de funci√≥n 07, 11 y 12.

Protocolo Modbus
El protocolo Modbus es un protocolo de comunicaci√≥n basado en una arquitectura maestro/
esclavo o cliente/servidor.
Se utiliza un procedimiento semid√∫plex as√≠ncrono y con trasparencia de c√≥digos. La
transmisi√≥n de datos se realiza sin procedimientos Handshake.

SIMATIC S7 como esclavo Modbus
El maestro tiene la iniciativa en la transmisi√≥n, el CP/la CPU S7 funciona como esclavo.
No es posible el intercambio de telegramas entre esclavos.

SIMATIC S7 como esclavo Modbus
Como maestro, el m√≥dulo de comunicaci√≥n inicia la transmisi√≥n y, tras la emisi√≥n del
telegrama de solicitud, espera el telegrama de respuesta del esclavo durante el tiempo de
vigilancia de respuesta parametrizado.

Estructura del telegrama
El intercambio de datos "maestro-esclavo" y "esclavo-maestro" comienza con la direcci√≥n de
esclavo, seguida del c√≥digo de funci√≥n. A continuaci√≥n se transfieren los datos. La estructura
del campo de datos depende del c√≥digo de funci√≥n utilizado. Al final del telegrama se
transmitir√° la comprobaci√≥n CRC (CRC-Check).
ADDRESS

FUNCTION

DATA

CRC-CHECK

Bytes

Bytes

n bytes

2 bytes

ADDRESS

Direcci√≥n del esclavo MODBUS

FUNCTION

C√≥digo de funci√≥n MODBUS

DATA

Datos del telegrama: Byte_Count, Coil_Number, Data

CRC-CHECK

Suma de verificaci√≥n del telegrama

Direcci√≥n del esclavo
La direcci√≥n del esclavo puede estar en el √°rea de 1 a 255. Con la direcci√≥n se llega a un
esclavo concreto del bus.

Mensaje Broadcast
Con la direcci√≥n de esclavo cero, el maestro se dirige a todos los esclavos del bus.
Los mensajes Broadcast se permiten √∫nicamente en conexi√≥n con los c√≥digos de funci√≥n 05,
06, 15 √≥ 16 de escritura.
Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1817

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En un mensaje Broadcast, el esclavo no env√≠a ning√∫n telegrama de respuesta.

C√≥digo de funci√≥n
El c√≥digo de funci√≥n define el significado del telegrama. Mediante el c√≥digo de funci√≥n se
define tambi√©n la estructura del telegrama. El m√≥dulo de comunicaci√≥n soporta los siguientes
c√≥digos de funci√≥n:
C√≥digo de funci√≥n

Funci√≥n seg√∫n la especificaci√≥n MODBUS

01

Read Coil Status

02

Read Input Status

03

Read Holding Registers

04

Read Input Registers

05

Force Single Coil

06

Preset Single Register

07

Read Exception Status (s√≥lo maestro)

08

Loop Back Test

11

Fetch Communications Event Counter (s√≥lo maestro)

12

Fetch Communications Event Log (s√≥lo maestro)

15

Force Multiple Coils

16

Preset Multiple Registers

Campo de datos DATA
En el campo de datos DATA se transfieren los datos espec√≠ficos del c√≥digo de funci√≥n:
‚óè Bytecount, Coil_Startaddress, Register_Startaddress; Number_of_Coils,
Number_of_Registers, ... .
V√©ase el cap√≠tulo "C√≥digos de funci√≥n (P√°gina 1832)".

CRC-Check
El final del telegrama forma la suma de verificaci√≥n CRC-16 de dos bytes de longitud, formada
seg√∫n el polinomio x16 + x15 + x2 + 1.
En primer lugar se transfiere el byte Low, y despu√©s, el byte High.

Fin del telegrama
El driver cargable detecta el fin del telegrama cuando no se realiza ninguna transferencia en
el tiempo que tardan en transferirse 3 caracteres y medio (3,5 veces el tiempo de retardo de
caracteres (v√©ase MODBUS Protocol Reference Guide).
As√≠, este TIME_OUT de fin de telegrama depende de la velocidad de transmisi√≥n.

1818

Velocidad de transmisi√≥n

TIME_OUT

115200 bits/s

0,3 ms

76800 bits/s

0,5 ms

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Velocidad de transmisi√≥n

TIME_OUT

57600 bits/s

0,7 ms

38400 bits/s

1 ms

19200 bits/s

2 ms

9600 bits/s

4 ms

4800 bits/s

8 ms

2400 bits/s

16 ms

1200 bits/s

32 ms

600 bits/s

64 ms

300 bits/s

128 ms

En el "Funcionamiento normal" se eval√∫a y comprueba de manera formal el fin de telegrama
Modbus recibido por el interlocutor acoplado tras el fin de telegrama TIME_OUT.
En "Supresi√≥n de perturbaciones", el fin de telegrama se detecta gracias un telegrama de
recepci√≥n correcto y formal con un c√≥digo CRC igualmente correcto.

Exception Responses
Cuando el esclavo detecta un error (p. ej., una direcci√≥n de registro no permitida) en el
telegrama de solicitud del maestro, establece el bit de mayor valor en el c√≥digo de funci√≥n del
telegrama de respuesta.
A continuaci√≥n se transfiere un byte de c√≥digo de error (Exception Code) que describe la causa
de dicho error.
El significado de dicho par√°metro se describe en el "GOULD MODICON Modbus Protocol".

Telegrama de Exception Code
La estructura del telegrama de respuesta del c√≥digo de error del esclavo es la siguiente:
‚óè p. ej., direcci√≥n de esclavo 5, c√≥digo de funci√≥n 5, Exception Code 2
Telegrama de respuesta del esclavo EXCEPTION_CODE_xx:
05H

Direcci√≥n del esclavo

85H

C√≥digo de funci√≥n

02H

Exception Code (1...7)

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Cuando el driver recibe un telegrama de respuesta del c√≥digo de error, la petici√≥n en curso
finalizar√° con error.
Adem√°s, en el √°rea de registro de errores se registra el n√∫mero de error correspondiente al
c√≥digo de error recibido (Exception Code 1‚Äë7).
No se produce ninguna entrada en el bloque de datos de destino.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1819

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los siguientes c√≥digos de error est√°n definidos seg√∫n la especificaci√≥n MODBUS:
C√≥digo de
error

Significado de la especificaci√≥n MODBUS

Causa - Resumen t√©cnico *

1

Illegal function

C√≥digo de funci√≥n no permitido

2

Illegal data address

Direcci√≥n de datos no permitida en el es‚Äê
clavo

3

Illegal data value

Valor de datos no permitido en el esclavo

4

Failure in associated device

Error interno en el esclavo

5

Acknowledge

La funci√≥n ser√° ejecutada

6

Busy, Rejected message

El esclavo no est√° preparado

7

Negative acknowledgement

Funci√≥n no ejecutable

* Buscar causa detallada en el esclavo.

Se√±ales cualificadoras RS232C
Las siguientes se√±ales cualificadoras RS232C estar√°n disponibles en el m√≥dulo de
comunicaci√≥n al utilizar el m√≥dulo de interfaz RS232C:
DCD

(Entrada)

Data carrier detect

Soporte de datos detectado

DTR

(Salida)

Data terminal ready

Interlocutor listo para funcionar

DSR

(Entrada)

Data set ready

Interlocutor listo para funcionar

RTS

(Salida)

Request to send

M√≥dulo de comunicaci√≥n preparado para enviar

CTS

(Entrada)

Clear to send

El interlocutor puede recibir datos del m√≥dulo de co‚Äê
municaci√≥n (respuesta a RTS = ON del CP)

RI

(Entrada)

Ring indicator

Indicador de llamada

Tras la conexi√≥n del m√≥dulo de comunicaci√≥n las se√±ales de salida est√°n en estado OFF
(inactivas).
El procesamiento de las se√±ales de control DTR/DSR y RTS/CTS puede parametrizarse en el
cuadro de di√°logo de propiedades del m√≥dulo o controlarse mediante las instrucciones del
programa de usuario.

1820

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Manejo de se√±ales cualificadoras RS232C
Las se√±ales cualificadoras RS232C pueden manejarse de la siguiente manera:
‚óè En la parametrizaci√≥n del manejo autom√°tico de todas las se√±ales cualificadoras de
RS232C
‚óè Mediante las instrucciones correspondientes. Encontrar√° m√°s informaci√≥n al respecto en el
apartado "Resumen de instrucciones (P√°gina 1757)".
Nota
En caso de parametrizaci√≥n de un manejo autom√°tico de las se√±ales cualificadoras
RS232C no es posible controlar RTS y DTR con las instrucciones correspondientes (v√©ase
el apartado "Resumen de instrucciones (P√°gina 1757)").
Sin embargo, la lectura de todas las se√±ales cualificadoras RS232C con la instrucci√≥n
correspondiente es posible en todos los casos.
A continuaci√≥n se explica el procedimiento b√°sico para controlar y evaluar las se√±ales
cualificadoras de RS232C.

Manejo autom√°tico de las se√±ales cualificadoras
El manejo autom√°tico de las se√±ales cualificadoras RS232C en el m√≥dulo de comunicaci√≥n se
establece de la siguiente manera:
‚óè Cuando el m√≥dulo de comunicaci√≥n entra por parametrizaci√≥n en un modo de operaci√≥n
con manejo autom√°tico de las se√±ales cualificadoras de RS232C, pone las l√≠neas RTS en
estado OFF y las DTR en estado ON (m√≥dulo de comunicaci√≥n preparado para entrar en
funcionamiento).
‚óè S√≥lo es posible enviar y recibir telegramas tras poner la l√≠nea DTR a ON. Mientras DTR
permanezca en OFF, no se pueden recibir datos v√≠a la interfaz del RS232C. Cualquier
petici√≥n de env√≠o se interrumpe con el correspondiente mensaje de error.
‚óè Si est√° pendiente una petici√≥n de env√≠o, RTS pasa al estado ON y se inicia el tiempo de
espera de salida de datos parametrizado. Una vez transcurrido el tiempo de salida de datos
y con CTS = ON, los datos se env√≠an a trav√©s de la interfaz RS232C.
‚óè Si durante el env√≠o la l√≠nea CTS no pasa a ON durante el tiempo de espera o si, durante el
proceso de salida, CTS cambia al estado OFF, se interrumpir√° el env√≠o y se mostrar√° el
aviso correspondiente.
‚óè Tras la emisi√≥n de los datos y una vez transcurrido el tiempo de RTS a OFF parametrizado,
la l√≠nea RTS pasa al estado de inactividad. No se espera a que la l√≠nea CTS pase al estado
OFF.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1821

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Es posible recibir datos v√≠a la interfaz RS232C tan pronto como se active la l√≠nea DSR (ON).
Si existe riesgo de sobrecarga del b√∫fer de recepci√≥n del m√≥dulo de comunicaci√≥n, √©ste no
reacciona.
‚óè Al cambiar de DSR = ON a OFF se interrumpe tanto el env√≠o en curso como la recepci√≥n
de datos con un aviso de error. En el b√∫fer de diagn√≥stico del m√≥dulo de comunicaci√≥n se
registra el aviso "DSR = OFF" (manejo autom√°tico de las se√±ales V24).
Nota
En caso de parametrizaci√≥n de un manejo autom√°tico de las se√±ales cualificadoras
RS232C no es posible controlar RTS y DTR con las instrucciones correspondientes.
Encontrar√° m√°s informaci√≥n al respecto en el apartado "Resumen de instrucciones
(P√°gina 1757)".
Nota
Defina el "tiempo de RTS a OFF" en el cuadro de di√°logo de propiedades del m√≥dulo de tal
manera que el CP pueda recibir completos los √∫ltimos caracteres del telegrama antes de
que la l√≠nea RTS, y con ella la petici√≥n de env√≠o, se desactiven. Defina el "tiempo de salida
de datos" de tal manera que el interlocutor pueda pasar a modo de disponibilidad de
recepci√≥n antes de que el tiempo haya transcurrido.

Cronograma
La siguiente figura muestra el desarrollo temporal de una petici√≥n de env√≠o:

576

&76
7;'

21
2))
21
2))



3HWLFL¬µQGHWUDQVPLVL¬µQ
576 21
,QWHUORFXWRU
&76 21
7LHPSRGHHVSHUDGHVDOLGD
GHGDWRVWUDQVFXUULGR!HQYLDU

7LHPSRGH576D2))
WUDQVFXUULGR
,QWHUORFXWRU
&76 2))

7LHPSRGHHVSHUD
VDOLGDGHGDWRV

Figura 1-106

1822

W

(QY¬ØDU
WHUPLQDGR

7LHPSRGH
576D2))

Cronograma para el manejo autom√°tico de las se√±ales cualificadoras RS232C

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Maestro Modbus
CP 341
Transferencia de datos de la CPU al m√≥dulo de comunicaci√≥n con P_SND_RK (CP 341)
Activaci√≥n
La ejecuci√≥n de un c√≥digo de funci√≥n MODBUS se activa con un SFB P_SND_RK con
un flanco en la entrada REQ.
Introduzca "S" en el par√°metro SF para SEND.
La direcci√≥n l√≥gica del m√≥dulo se introduce en LADDR.
Como tipo de √°rea de la CPU del interlocutor debe introducirse "X" para el bloque de datos
ampliado. No hay que introducir ning√∫n valor para el resto de los par√°metros de la CPU del
interlocutor (R_...).
De esta forma se transfieren al driver los par√°metros necesarios para la ejecuci√≥n del c√≥digo
de funci√≥n.

Fuente de datos
Si se activa el P_SND_RK, se transferir√° al m√≥dulo de comunicaci√≥n el √°rea de datos fuente
indicada con los par√°metros DB_NO y DBB_NO y la longitud LEN.

Indicaci√≥n de la longitud
La longitud LEN depende del c√≥digo de funci√≥n utilizado.
C√≥digo de funci√≥n

Longitud LEN en bytes

01

6

02

6

03

6

04

6

05

6

06

6

07

2

08

6

11

2

12

2

15

>6

16

>6

Si en los c√≥digos de funci√≥n no se transfieren las cantidades de datos indicadas, no se
realizar√° la petici√≥n y el P_SND_RK terminar√° con un flanco en la salida ERROR.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1823

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

DB de origen SEND
En el √°rea de datos fuente deben incluirse como datos √∫tiles los par√°metros necesarios para
la ejecuci√≥n de un c√≥digo de funci√≥n.
La estructura detallada del correspondiente DB de origen P_SND_RK se incluye en la
descripci√≥n de los c√≥digos de funci√≥n individuales en el cap√≠tulo "C√≥digos de funci√≥n
(P√°gina 1832)".

Generaci√≥n de telegrama
Los telegramas de petici√≥n se env√≠an al esclavo mediante los datos de origen P_SND_RK
transferidos y estructurados por el m√≥dulo de comunicaci√≥n.
A continuaci√≥n, el driver comprueba que la longitud LEN indicada en el P_SND_RK se
corresponda con la longitud prevista para este c√≥digo de funci√≥n.
Si no es as√≠, la petici√≥n no se ejecuta y termina con un flanco en la salida ERROR del
P_SND_RK.
Si se utilizan c√≥digos de funci√≥n distintos a los listados, la petici√≥n activada no se ejecuta y
termina con ERROR en el P_SND_RK.
El m√≥dulo de comunicaci√≥n forma los elementos "Contador de bytes" y "Comprobaci√≥n CRC"
contenidos en el telegrama de petici√≥n; no es necesaria una entrada en el DB de origen
P_SND_RK.

Finalizaci√≥n de petici√≥n en funciones de escritura
En c√≥digos de funci√≥n de escritura, el P_SND_RK activado finaliza tras la correcta recepci√≥n
del telegrama de respuesta. Este suceso se le comunica al programa de usuario SIMATIC con
un flanco en la salida DONE del P_SND_RK.
Si se han detectado errores en el tr√°fico de telegramas o si el esclavo responde con un
telegrama de respuesta de c√≥digo de error, se informar√° de ello mediante un flanco en la salida
ERROR.

Finalizaci√≥n de petici√≥n en funciones de lectura
En las funciones de lectura, el P_SND_RK activado finaliza tras la correcta recepci√≥n del
telegrama de respuesta y la completa trasferencia a la CPU de los datos recibidos.
Este suceso se le comunica al programa de usuario SIMATIC con un flanco en la salida DONE
del P_SND_RK.
En ese momento los datos recibidos ya est√°n disponibles en la CPU.
Si se han detectado errores en el tr√°fico de telegramas o si el esclavo responde con un
telegrama de respuesta de c√≥digo de error, se informar√° de ello mediante un flanco en la salida
ERROR.
En este caso no se transfiere ning√∫n dato recibido a la CPU.

1824

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Entrada STATUS en final de petici√≥n
En los casos en que una petici√≥n finaliza con ERROR en P_SND_RK, se produce la entrada
adicional de un c√≥digo de error en el par√°metro STATUS.
Mediante este c√≥digo de error puede determinarse la causa exacta del mismo

Transferencia de datos del m√≥dulo de comunicaci√≥n a la CPU con P_RCV_RK (CP 341)
Requisito
Todos los c√≥digos de funci√≥n de lectura necesitan un P_RCV_RK.

Destino de datos
Con la disponibilidad de recepci√≥n activada de la instrucci√≥n P_RCV_RK, aplica los datos
recibidos del m√≥dulo de comunicaci√≥n y los introduce en un destino de datos especificado por
los par√°metros DB_N0 y DBB_N0.

Visualizaci√≥n de la recepci√≥n de datos
Al usuario se le comunica la recepci√≥n de datos en la CPU mediante un flanco en la
salida NDR.
En ese momento, en el par√°metro LEN se indica la longitud del bloque de datos recibido.
La finalizaci√≥n de la petici√≥n de Modbus completa puede detectarse en la salida DONE de la
instrucci√≥n P_SND_RK.

Comportamiento en caso de error
En el caso de errores durante la recepci√≥n o la transferencia, no se enviar√°n los datos a la
CPU. La instrucci√≥n P_SND_RK finalizar√° en este caso con un flanco en la salida ERROR.

DB de destino P_RCV_RK
Los datos √∫tiles recibidos por un c√≥digo de funci√≥n de lectura se introducen en el √°rea de
destino P_RCV_RK.
La estructura detallada del correspondiente DB de destino P_RCV_RK se incluye en la
descripci√≥n de los c√≥digos de funci√≥n en el cap√≠tulo "C√≥digos de funci√≥n (P√°gina 1832)".
La longitud de los datos introducidos se muestra en el par√°metro LEN del P_RCV_RK.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1825

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

CP 441-2
Transferencia de datos de la CPU al m√≥dulo de comunicaci√≥n con BSEND (CP 441-2)
Enlace de comunicaci√≥n
El par√°metro ID describe el enlace de comunicaci√≥n un√≠voco a un interlocutor. El ID local de la
configuraci√≥n de la conexi√≥n debe introducirse aqu√≠.

Relaci√≥n de bloque
El par√°metro R_ID describe la relaci√≥n de bloque un√≠voca dentro de un enlace de
comunicaci√≥n.
En este driver pueden incluirse los valores deseados0..255 para el R_ID en BSEND.
El BRCV correspondiente a las peticiones de lectura debe tener el R_ID parametrizado de la
misma forma que en BSEND.

Activaci√≥n
La ejecuci√≥n de un c√≥digo de funci√≥n MODBUS se activa con una instrucci√≥n BSEND con
un flanco en la entrada REQ.
De esta forma se transfieren al driver los par√°metros necesarios para la ejecuci√≥n del c√≥digo
de funci√≥n.

Fuente de datos
Al activar BSEND, el √°rea de datos fuente introducida en el par√°metro SD_1 con la
longitud LEN se transfiere al m√≥dulo de comunicaci√≥n.

Indicaci√≥n de la longitud
La longitud LEN depende del c√≥digo de funci√≥n utilizado.

1826

C√≥digo de funci√≥n

Longitud LEN en bytes

01

6

02

6

03

6

04

6

05

6

06

6

07

2

08

6

11

2

12

2

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de funci√≥n

Longitud LEN en bytes

15

>6

16

>6

Si en los c√≥digos de funci√≥n no se transfieren las cantidades de datos indicadas, no se
realizar√° la petici√≥n y el BSEND terminar√° con un flanco en la salida ERROR.

DB de origen BSEND
En el √°rea de datos fuente deben incluirse como datos √∫tiles los par√°metros necesarios para
la ejecuci√≥n de un c√≥digo de funci√≥n.
La estructura detallada del correspondiente DB de origen BSEND se incluye en la descripci√≥n
de los c√≥digos de funci√≥n individuales en el apartado "C√≥digos de funci√≥n (P√°gina 1832)".

Generaci√≥n de telegrama
Los telegramas de petici√≥n se env√≠an al esclavo mediante los datos de origen BSEND
transferidos y estructurados por el m√≥dulo de comunicaci√≥n.
A continuaci√≥n, el driver comprueba que la longitud LEN indicada en el BSEND se corresponda
con la longitud prevista para este c√≥digo de funci√≥n.
Si no es as√≠, la petici√≥n no se ejecuta y termina con un flanco en la salida ERROR del BSEND.
Si se utilizan c√≥digos de funci√≥n distintos a los listados, la petici√≥n activada no se ejecuta y
termina con ERROR en el BSEND.
El m√≥dulo de comunicaci√≥n forma los elementos "Contador de bytes" y "Comprobaci√≥n CRC"
contenidos en el telegrama de petici√≥n; no es necesaria una entrada en el DB de origen
BSEND.

Finalizaci√≥n de petici√≥n en funciones de escritura
En c√≥digos de funci√≥n de escritura, el BSEND activado finaliza tras la correcta recepci√≥n del
telegrama de respuesta.
Este suceso se le comunica al programa de usuario SIMATIC con un flanco en la salida DONE
del BSEND.
Si se han detectado errores en el tr√°fico de telegramas o si el esclavo responde con un
telegrama de respuesta de c√≥digo de error, se informar√° de ello mediante un flanco en la salida
ERROR.

Finalizaci√≥n de petici√≥n en funciones de lectura
En las funciones de lectura, el BSEND activado finaliza tras la correcta recepci√≥n del telegrama
de respuesta y la completa trasferencia a la CPU de los datos recibidos.
Este suceso se le comunica al programa de usuario SIMATIC con un flanco en la salida DONE
del BSEND.
En ese momento los datos recibidos ya est√°n disponibles en la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1827

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si se han detectado errores el tr√°fico de telegramas o si el esclavo responde con un telegrama
de respuesta de c√≥digo de error, se informar√° de ello mediante un flanco en la salida ERROR.
En este caso no se transfiere ning√∫n dato recibido a la CPU.

Entrada en el √°rea de registro de errores con fin de petici√≥n
En los casos en que una petici√≥n finaliza con ERROR en BSEND, se produce la entrada
adicional de un c√≥digo de error en el √°rea de registro de errores.
Mediante este c√≥digo de error puede determinarse la causa exacta del mismo

Transferencia de datos del m√≥dulo de comunicaci√≥n a la CPU con BRCV (CP 441-2)
Enlace de comunicaci√≥n
El par√°metro ID describe el enlace de comunicaci√≥n un√≠voco a un interlocutor. El ID local de la
configuraci√≥n de la conexi√≥n debe introducirse aqu√≠.

Relaci√≥n de bloque
El par√°metro R_ID describe la relaci√≥n de bloque un√≠voca dentro de un enlace de
comunicaci√≥n.
Todos los c√≥digos de funci√≥n de lectura necesitan un BRCV.
El R_ID parametrizado en BRCV debe ser el mismo R_ID que el del BSEND correspondiente
con el que se activ√≥ la petici√≥n (valores preferidos 0 ... 255).
De esta forma es posible programar varios pares BSEND/BRCV en el programa de usuario
SIMATIC.
Los telegramas de respuesta recibidos por el esclavo Modbus se recogen en distintas √°reas de
destino, dependiendo del R_ID utilizado por esta petici√≥n.

Destino de datos
Con la disponibilidad para recepci√≥n activada de la instrucci√≥n BRCV, √©ste aplica los datos
recibidos del m√≥dulo de comunicaci√≥n y los introduce en el destino de datos indicado en el
par√°metro RD_1. De esta forma, el destino de datos es variable.

Visualizaci√≥n de la recepci√≥n de datos
Al usuario se le comunica la recepci√≥n de datos en la CPU mediante un flanco en la
salida NDR.
En ese momento, en el par√°metro LEN se indica la longitud del bloque de datos recibido.
La finalizaci√≥n de la petici√≥n de Modbus completa puede detectarse en la salida DONE de la
instrucci√≥n BSEND.

1828

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comportamiento en caso de error
En el caso de errores durante la recepci√≥n o la transferencia, no se enviar√°n los datos a la
CPU. BSEND finalizar√° en este caso con un flanco en la salida ERROR.

DB de destino BRCV
Los datos √∫tiles recibidos por un c√≥digo de funci√≥n de lectura se introducen en el √°rea de
destino BRCV.
La estructura detallada del correspondiente DB de destino BRCV se incluye en la descripci√≥n
de los c√≥digos de funci√≥n en el apartado "C√≥digos de funci√≥n (P√°gina 1832)".
La longitud de los datos introducidos se muestra en el par√°metro LEN del BRCV.

ET 200S 1SI
Transferencia de datos con el maestro Modbus ET 200S 1SI
Introducci√≥n
La transmisi√≥n de datos entre el m√≥dulo y la CPU se realiza mediante las instrucciones
S_SEND y S_RCV.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1829

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Instrucci√≥n S_SEND: Enviar datos a un interlocutor
Para ejecutar una petici√≥n del maestro Modbus tienen que activarse las instrucciones S_SEND
y S_RCV. La instrucci√≥n S_SEND se activa con un flanco en la entrada REQ cuando deben
emitirse datos al m√≥dulo. La instrucci√≥n S_RCV se prepara con EN_R=1 para recibir datos del
m√≥dulo. En todos los c√≥digos de funci√≥n de lectura es necesario un S_RCV. La figura siguiente
muestra el comportamiento global de los par√°metros S_SEND y S_RCV cuando se ejecuta
una petici√≥n Modbus.

6B6(1'5(4
'DWRVDHVFODYR

6B6(1''21(
6B6(1'(5525
'DWRVGHHVFODYR

6B5&9(1B5

6B5&91'5

6B5&9(5525
5HVSXHVWDFRUUHFWDGHOHVFODYR

Figura 1-107

QLQJXQDUHVSXHVWDGHOHVFODYR

Cronograma de una petici√≥n Modbus

Con flanco positivo en la entrada REQ se inicia la transmisi√≥n de los datos. Dependiendo de
la cantidad de datos, la transmisi√≥n puede desarrollarse en varias llamadas (ciclos del
programa).
La instrucci√≥n S_SEND se puede llamar en el ciclo con el estado l√≥gico "1" en la entrada de
par√°metros R. De este modo, se cancela la transferencia al m√≥dulo y la instrucci√≥n S_SEND
pasa al estado b√°sico. Los datos que ya ha recibido el m√≥dulo se env√≠an al interlocutor. Si hay
un estado de se√±al "1" est√°tico en la entrada R, la transmisi√≥n est√° desactivada.
En el par√°metro LADDR se indica la direcci√≥n del m√≥dulo interfaz serie ET 200S Modbus/USS
con el que debe realizarse la conexi√≥n.
La salida DONE indica "Fin de petici√≥n sin errores". ERROR indica que se ha producido un
error. En caso de producirse un error, el n√∫mero correspondiente de evento se indica en
STATUS. Si no se produce ning√∫n fallo, STATUS tiene el valor 0. DONE y ERROR/STATUS
se indican tambi√©n en caso de RESET de S_SEND. Si se ha producido un error, se desactiva
el resultado binario RB. Si se termina el bloque sin errores, el estado del resultado binario es
"1".

1830

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Petici√≥n de lectura del maestro Modbus
Dado que la interfaz entre el programa de usuario y el m√≥dulo interfaz funciona en modo
semid√∫plex, hay que tener en cuenta lo siguiente:
Despu√©s de una petici√≥n de lectura del maestro Modbus con acuse positivo, hay que recoger
los datos recibidos del m√≥dulo interfaz con la instrucci√≥n S_RCV antes de iniciar una nueva
petici√≥n de env√≠o del maestro Modbus.

Esclavo Modbus
Inicializaci√≥n del m√≥dulo de comunicaci√≥n
Introducci√≥n
Las instrucciones de comunicaci√≥n Modbus (MODB_341, MODB_441 y S_MODB) para el
driver cargable del esclavo Modbus deben llamarse en la CPU SIMATIC S7 en la parte c√≠clica.
La instrucci√≥n de comunicaci√≥n Modbus inicializa el CP y ejecuta las funciones Modbus que el
driver no puede ejecutar por s√≠ mismo. La instrucci√≥n de comunicaci√≥n Modbus tambi√©n debe
llamarse en el programa de usuario si el sistema maestro Modbus no utiliza estos c√≥digos de
funci√≥n.
La comunicaci√≥n entre CP y la instrucci√≥n se realiza mediante funciones del sistema operativo
de la CPU y las instrucciones BSEND (CP 441-2) o P_SND_RK y P_RCV_RK (CP 341)
llamadas por la instrucci√≥n.

Arranque, inicializaci√≥n
Despu√©s de rearrancar o reiniciar la CPU, hay que inicializar la instrucci√≥n de comunicaci√≥n
Modbus.
La inicializaci√≥n se activa con un flanco ascendente en la entrada CP_START.
La instrucci√≥n borra primero el DB de instancia, lee las √°reas de operandos E, A, M, T, Z de la
CPU y las almacena en el DB de instancia. De esta forma se puede comprobar si las solicitudes
de escritura del sistema maestro Modbus sobrepasan el √°rea.
Con una petici√≥n de env√≠o, se comunica al CP el n√∫mero del DB de instancia y el transcurso
satisfactorio de la inicializaci√≥n.
Si la inicializaci√≥n termina con errores, no es posible una comunicaci√≥n Modbus. Todas las
solicitudes del sistema maestro Modbus se responden con un telegrama Exception Code.

DB de instancia
Todos los datos relevantes para la instrucci√≥n de comunicaci√≥n Modbus se encuentran en un
bloque de datos de instancia. Este bloque de datos es al mismo tiempo DB de instancia
(m√∫ltiples instancias) para las instrucciones utilizadas y √°rea de trabajo para la instrucci√≥n de
comunicaci√≥n Modbus. No es necesaria otra √°rea de datos.
La instrucci√≥n de comunicaci√≥n Modbus solo trabaja con el DB de instancia y con datos locales.
El DB de instancia solo permite acceso de lectura.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1831

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Tiempo de vigilancia
Tras encenderla, la CPU necesita unos segundos para hacer comprobaciones de hardware y
de memoria antes de estar lista. Los intentos de inicializaci√≥n realizados durante ese tiempo
por la instrucci√≥n de comunicaci√≥n Modbus finalizan con error. Por eso, durante ese tiempo de
vigilancia se repite varias veces la petici√≥n de inicializaci√≥n.

Leer intervalo de tiempo SYSTAT (solo CP 441-2)
Como leer peri√≥dicamente el SYSTAT en cada ciclo del PLC, o un ciclo de cada dos,
sobrecarga innecesariamente el CP y el bus K y reduce el flujo de datos, se puede configurar
un intervalo de tiempo para leer el SYSTAT (solo relevante para CP 441-2 (MODB_441)).

C√≥digos de funci√≥n
Maestro Modbus (RTU)
C√≥digo de funci√≥n 01 - Read Output Status
Funci√≥n
Esta funci√≥n permite leer bits individuales del esclavo.

Direcci√≥n inicial
El driver no comprueba el par√°metro Direcci√≥n inicial de bit y lo env√≠a sin modificarlo.

N√∫mero de bits
Como n√∫mero de bits, number of coils, se admite cualquier valor entre 1 y 2040 (en el
ET 200S 1SI Modbus hasta 2008).

DB de origen SEND
Estructura del √°rea de origen SEND:

1832

Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#1

C√≥digo de funci√≥n

+2.0

bit_startadr

WORD

W#16#0040

Direcci√≥n inicial de bit

+4.0

bit_anzahl

INT

16

N√∫mero de bits

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo
Telegrama de solicitud FUNCTION 01:
05H

Direcci√≥n del esclavo

01H

C√≥digo de funci√≥n

00H

Direcci√≥n inicial de bit "High"

40H

Direcci√≥n inicial de bit "Low"

00H

N√∫mero de bits "High"

10H

N√∫mero de bits "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 01:
05H

Direcci√≥n del esclavo

01H

C√≥digo de funci√≥n

02H

Contador de bytes

01H

<Datos>

17H

<Datos>

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

DB de destino RCV
Contenido del √°rea de destino RCV:
Direcci√≥n

Nombre

Tipo

Valor actual

Comentario

+0.0

data[1]

WORD

W#16#1701

Datos

El driver registra los datos del telegrama de respuesta por palabras en el DB de destino.
El primer byte recibido se registra como byte Low de la primera palabra "data[1]", el tercer byte
recibido como byte Low de la segunda palabra "data[2]", etc.
Si se leen menos de 9 bits o si s√≥lo se ha le√≠do un byte Low, en el byte High restante de la √∫ltima
palabra se registra el valor 00H.

C√≥digo de funci√≥n 02 - Read Input Status
Funci√≥n
Esta funci√≥n permite leer bits individuales del esclavo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1833

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Direcci√≥n inicial
El driver no comprueba el par√°metro Direcci√≥n inicial de bit y lo env√≠a sin modificarlo.

N√∫mero de bits
Como n√∫mero de bits, number of coils, se admite cualquier valor entre 1 y 2040 (en el
ET 200S 1SI Modbus hasta 2008).

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#2

C√≥digo de funci√≥n

+2.0

bit_startadr

WORD

W#16#0120

Direcci√≥n inicial de bit

+4.0

bit_anzahl

INT

24

N√∫mero de bits

Ejemplo
Telegrama de solicitud FUNCTION 02:
05H

Direcci√≥n del esclavo

02H

C√≥digo de funci√≥n

01H

Direcci√≥n inicial de bit "High"

20H

Direcci√≥n inicial de bit "Low"

00H

N√∫mero de bits "High"

18H

N√∫mero de bits "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 02:

1834

05H

Direcci√≥n del esclavo

02H

C√≥digo de funci√≥n

03H

Contador de bytes

04H

<Datos>

26H

<Datos>

48H

<Datos>

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

DB de destino RCV
Contenido del √°rea de destino RCV:
Direcci√≥n

Nombre

Tipo

Valor actual

Comentario

+0.0

data[1]

WORD

W#16#2604

Datos

+2.0

data[2]

WORD

W#16#0048

Datos

El driver registra los datos del telegrama de respuesta por palabras en el DB de destino.
El primer byte recibido se registra como byte Low de la primera palabra "data[1]", el tercer byte
recibido como byte Low de la segunda palabra "data[2]", etc.
Si se leen menos de 9 bits o si s√≥lo se ha le√≠do un byte Low, en el byte High restante de la √∫ltima
palabra se registra el valor 00H.

C√≥digo de funci√≥n 03 - Read Output Registers
Funci√≥n
Esta funci√≥n permite leer registros individuales del esclavo.

Direcci√≥n inicial
El driver no comprueba el par√°metro Direcci√≥n inicial del registro y lo env√≠a sin modificarlo.

N√∫mero de registros
Pueden leerse entre 1 y 127 registros como m√°ximo (con ET 200S 1SI Modbus m√°x. 125
registros) (1 registro = dos bytes).

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#3

C√≥digo de funci√≥n

+2.0

reg_startadr

WORD

W#16#0040

Direcci√≥n inicial del registro

+4.0

reg_anzahl

INT

2

N√∫mero de registros

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1835

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo
Telegrama de solicitud FUNCTION 03:
05H

Direcci√≥n del esclavo

03H

C√≥digo de funci√≥n

00H

Direcci√≥n inicial de registro "High"

40H

Direcci√≥n inicial de registro "Low"

00H

N√∫mero de registros "High"

02H

N√∫mero de registros "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 03:
05H

Direcci√≥n del esclavo

03H

C√≥digo de funci√≥n

04H

Contador de bytes

21H

Direcci√≥n de registro 40H datos "High"

23H

Direcci√≥n de registro 40H datos "Low"

25H

Direcci√≥n de registro 41H datos "High"

27H

Direcci√≥n de registro 41H datos "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

DB de destino RCV
Contenido del √°rea de destino RCV:
Direcci√≥n

Nombre

Tipo

Valor actual

Comentario

+0.0

data[1]

WORD

W#16#2123

Datos

+2.0

data[2]

WORD

W#16#2527

Datos

C√≥digo de funci√≥n 04 - Read Input Registers
Funci√≥n
Esta funci√≥n permite leer registros individuales del esclavo.

Direcci√≥n inicial
El driver no comprueba el par√°metro Direcci√≥n inicial del registro y lo env√≠a sin modificarlo.

1836

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

N√∫mero de registros
Pueden leerse entre 1 y 127 registros como m√°ximo (con ET 200S 1SI Modbus m√°x. 125
registros) (1 registro = dos bytes).

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#4

C√≥digo de funci√≥n

+2.0

reg_startadr

WORD

W#16#0050

Direcci√≥n inicial del registro

+4.0

reg_anzahl

INT

3

N√∫mero de registros

Ejemplo
Telegrama de solicitud FUNCTION 04:
05H

Direcci√≥n del esclavo

04H

C√≥digo de funci√≥n

00H

Direcci√≥n inicial de registro "High"

50H

Direcci√≥n inicial de registro "Low"

00H

N√∫mero de registros "High"

03H

N√∫mero de registros "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 04:
05H

Direcci√≥n del esclavo

04H

C√≥digo de funci√≥n

04H

Contador de bytes

31H

Direcci√≥n de registro 50H datos "High"

32H

Direcci√≥n de registro 50H datos "Low"

33H

Direcci√≥n de registro 51H datos "High"

34H

Direcci√≥n de registro 51H datos "Low"

35H

Direcci√≥n de registro 52H datos "High"

36H

Direcci√≥n de registro 52H datos "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1837

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

DB de destino RCV
Contenido del √°rea de destino RCV:
Direcci√≥n

Nombre

Tipo

Valor actual

Comentario

+0.0

data[1]

WORD

W#16#3132

Datos

+2.0

data[2]

WORD

W#16#3334

Datos

+4.0

data[3]

WORD

W#16#3536

Datos

C√≥digo de funci√≥n 05 - Force Single Coil
Funci√≥n
Con esta funci√≥n puede activarse o borrarse un bit individual en el esclavo.

Direcci√≥n de bit
El driver no comprueba el par√°metro Direcci√≥n de bit y lo env√≠a sin modificarlo.

Estado de bit
El estado de bit admite los dos valores siguientes:
‚óè FF00H = activar bit
‚óè 0000H = borrar bit

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#5

C√≥digo de funci√≥n

+2.0

bit_address

WORD

W#16#0019

Direcci√≥n de bit

+4.0

bit_state

WORD

W#16#FF00

Estado de bit

Ejemplo
Telegrama de solicitud FUNCTION 05:
05H

Direcci√≥n del esclavo

05H

C√≥digo de funci√≥n

00H

Direcci√≥n de bit "High"

19H

Direcci√≥n de bit "Low"

FFH

Activar bit

00H

1838

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 05:
05H

Direcci√≥n del esclavo

05H

C√≥digo de funci√≥n

00H

Direcci√≥n de bit "High"

19H

Direcci√≥n de bit "Low"

FFH

Estado de bit "High"

00H

Estado de bit "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

El telegrama de respuesta no se registra en un DB de recepci√≥n.

C√≥digo de funci√≥n 06 - Preset Single Register
Funci√≥n
Con este comando puede sobrescribirse un registro de esclavo con un valor nuevo.

Direcci√≥n de registro
El driver no comprueba el par√°metro Direcci√≥n de registro y lo env√≠a sin modificarlo.

Valor de registro
El valor de registro puede ser cualquier valor.

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#6

C√≥digo de funci√≥n

+2.0

reg_address

WORD

W#16#0180

Direcci√≥n de registro

+4.0

reg_value

WORD

W#16#3E7F

Valor de registro

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1839

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo
Telegrama de solicitud FUNCTION 06:
05H

Direcci√≥n del esclavo

06H

C√≥digo de funci√≥n

01H

Direcci√≥n de registro "High"

80H

Direcci√≥n de registro "Low"

3EH

Valor de registro "High"

7FH

Valor de registro "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 06:
05H

Direcci√≥n del esclavo

06H

C√≥digo de funci√≥n

01H

Direcci√≥n de registro "High"

80H

Direcci√≥n de registro "Low"

3EH

Valor de registro "High"

7FH

Valor de registro "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

El telegrama de respuesta no se registra en un DB de recepci√≥n.

C√≥digo de funci√≥n 07 - Read Exception Status
Funci√≥n
Con este c√≥digo de funci√≥n pueden leerse 8 bits de evento del esclavo conectado.
El n√∫mero de bit inicial del bit de evento est√° definido por el equipo conectado y, por lo tanto,
el programa de usuario SIMATIC no tiene que preajustarlo.

DB de origen SEND
Estructura del √°rea de origen SEND:

1840

Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#7

C√≥digo de funci√≥n

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo
Telegrama de solicitud FUNCTION 07:
05H

Direcci√≥n del esclavo

07H

C√≥digo de funci√≥n

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 07:
05H

Direcci√≥n del esclavo

07H

C√≥digo de funci√≥n

3EH

<Datos>

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

DB de destino RCV
Contenido del √°rea de destino RCV:
Direcci√≥n

Nombre

Tipo

Valor actual

Comentario

+0.0

data[1]

WORD

W#16#3Exx

Datos

El driver registra el √∫nico byte del telegrama de respuesta en el byte High del DB de destino
data[1].
El byte Low de data[1] no se modifica.
Como longitud, en el par√°metro LEN de la instrucci√≥n de recepci√≥n se indica el valor 1.

C√≥digo de funci√≥n 08 - Loop Back Diagnostic Test
Funci√≥n
Esta funci√≥n sirve para comprobar el enlace de comunicaci√≥n.
Para este c√≥digo de funci√≥n s√≥lo se admite el c√≥digo de diagn√≥stico 0000.

C√≥digo de diagn√≥stico
Para el par√°metro C√≥digo de diagn√≥stico s√≥lo se admite el valor 0000.

Valor de test
El valor de test puede ser cualquier valor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1841

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#8

C√≥digo de funci√≥n

+2.0

diag_code

WORD

W#16#0000

C√≥digo de diagn√≥stico

+4.0

test_value

WORD

W#16#A5C3

Valor de test

Ejemplo
Telegrama de solicitud FUNCTION 08:
05H

Direcci√≥n del esclavo

08H

C√≥digo de funci√≥n

00H

C√≥digo de diagn√≥stico "High"

00H

C√≥digo de diagn√≥stico "Low"

A5H

Valor de test "High"

C3H

Valor de test "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 08:
05H

Direcci√≥n del esclavo

08H

C√≥digo de funci√≥n

00H

C√≥digo de diagn√≥stico "High"

00H

C√≥digo de diagn√≥stico "Low"

A5H

Valor de test "High"

C3H

Valor de test "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

El esclavo tiene que devolver el telegrama de solicitud recibido por el maestro como eco y sin
modificarlo.
El telegrama de respuesta no se registra en un DB RCV.

C√≥digo de funci√≥n 11 - Fetch Communications Event Counter
Funci√≥n
Con este c√≥digo de funci√≥n el esclavo puede leerse una "palabra de estado" de 2 bytes y
un "contador de eventos" de 2 bytes.

1842

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El significado de dicho par√°metro se describe en el "GOULD MODICON Modbus Protocol".

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#0B

C√≥digo de funci√≥n

Ejemplo
Trama de de solicitud FUNCTION 11:
05H

Direcci√≥n del esclavo

0BH

C√≥digo de funci√≥n

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Trama de respuesta del esclavo FUNCTION 11:
05H

Direcci√≥n del esclavo

0BH

C√≥digo de funci√≥n

FEH

Palabra de estado "High"

DCH

Palabra de estado "Low"

01H

Contador de eventos "High"

08H

Contador de eventos "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

DB de destino RCV
Contenido del √°rea de destino RCV:
Direcci√≥n

Nombre

Tipo

Valor actual

Comentario

+0.0

data[1]

WORD

W#16#FEDC

Palabra de estado

+2.0

data[2]

WORD

W#16#0108

Contador de even‚Äê
tos

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1843

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Uso con la unidad de periferia descentralizada ET 200S 1SI
Tenga en cuenta que si se utiliza con la periferia descentralizada ET 200S 1SI, toda la trama
de respuesta del esclavo (con direcci√≥n Modbus y c√≥digo de funci√≥n, incluidos 2 bytes) se
guarda en el DB de destino RCV. De este modo se desplaza el offset de la palabra de estado
(offset 2.0) y del contador de eventos (offset 4.0).

C√≥digo de funci√≥n 12 - Fetch Communications Event Log
Funci√≥n
Con este c√≥digo de funci√≥n el esclavo puede leer lo siguiente:
‚óè "palabra de estado" de dos bytes;
‚óè "contador de eventos" de dos bytes;
‚óè "contador de mensajes" de dos bytes;
‚óè "bytes de eventos" de 64 bytes.
El significado de dicho par√°metro se describe en el "GOULD MODICON Modbus Protocol".

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#0C

C√≥digo de funci√≥n

Ejemplo
Telegrama de solicitud FUNCTION 12:
05H

Direcci√≥n del esclavo

0CH

C√≥digo de funci√≥n

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 12:

1844

05H

Direcci√≥n del esclavo

0CH

C√≥digo de funci√≥n

46H

Contador de bytes

87H

Palabra de estado "High"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
65H

Palabra de estado "Low"

01H

Contador de eventos "High"

08H

Contador de eventos "Low"

02H

Contador de mensajes "High"

20H

Contador de mensajes "Low"

01H

Byte de eventos 1

12H

Byte de eventos 2

:

:

C2H

Byte de eventos 63

D3H

Byte de eventos 64

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

DB de destino RCV
Contenido del √°rea de destino RCV:
Direcci√≥n

Nombre

Tipo

Valor actual

Comentario

+0.0

data[1]

WORD

W#16#8765

Palabra de estado

+2.0

data[2]

WORD

W#16#0108

Contador de even‚Äê
tos

+4.0

data[3]

WORD

W#16#0220

Contador de men‚Äê
sajes

+6.0

bytedata[1]

BYTE

B#16#01

Byte de eventos 1

+7.0

bytedata[2]

BYTE

B#16#12

Byte de eventos 2

:

:

:

+68.0

bytedata[63]

BYTE

B#16#C2

Byte de eventos 63

+69.0

bytedata[64]

BYTE

B#16#D3

Byte de eventos 64

C√≥digo de funci√≥n 15 - Force Multiple Coils
Funci√≥n
Con este c√≥digo de funci√≥n se pueden modificar hasta 2040 bits (con ET 200S 1SI Modbus
m√°x. 1744 bits) en el esclavo

Direcci√≥n inicial
El driver no comprueba el par√°metro Direcci√≥n inicial de bit y lo env√≠a sin modificarlo.

N√∫mero de bits
Como n√∫mero de bits, number of coils, se admite cualquier valor entre 1 y 2040 (en el
ET 200S 1SI Modbus hasta 1744 bits).
Con ello se define cu√°ntos bits pueden sobrescribirse en el esclavo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1845

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El driver crea el par√°metro "Contador de bytes" incluido en el telegrama de solicitud a causa
del par√°metro "N√∫mero de bits" transferido.

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#0F

C√≥digo de funci√≥n

+2.0

bit_startadr

WORD

W#16#0058

Direcci√≥n inicial de bit

+4.0

bit_anzahl

INT

10

N√∫mero de bits

+6.0

coil_state[1]

WORD

W#16#EFCD

Estado
Coil 5FH..58H/57H..50H

Ejemplo
Telegrama de solicitud FUNCTION 15:
05H

Direcci√≥n del esclavo

0FH

C√≥digo de funci√≥n

00H

Direcci√≥n de bit "High"

50H

Direcci√≥n de bit "Low"

00H

N√∫mero de bits "High"

0AH

N√∫mero de bits "Low"

02H

Contador de bytes

CDH

Estado Coil 50H..57H

EFH

Estado Coil 58H..59H

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 15:
05H

Direcci√≥n del esclavo

0FH

C√≥digo de funci√≥n

00H

Direcci√≥n de bit "High"

50H

Direcci√≥n de bit "Low"

00H

N√∫mero de bits "High"

0AH

N√∫mero de bits "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

El telegrama de respuesta no se registra en un DB de recepci√≥n.

1846

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√≥digo de funci√≥n 16 - Preset Multiple Registers
Funci√≥n
El c√≥digo de funci√≥n 16 permite sobrescribir un m√°ximo de 127 registros en (en ET 200S 1SI
Modbus m√°x. 109 registros) en el esclavo con un telegrama de solicitud.

Direcci√≥n inicial
El driver no comprueba el par√°metro Direcci√≥n inicial del registro y lo env√≠a sin modificarlo.

N√∫mero de registros
Pueden leerse entre 1 y 127 registros como m√°ximo (con ET 200S 1SI Modbus m√°x. 109
registros) (1 registro = dos bytes).
El driver crea el par√°metro "Contador de bytes" incluido en el telegrama de solicitud a causa
del par√°metro "N√∫mero de registros" transferido.

DB de origen SEND
Estructura del √°rea de origen SEND:
Direcci√≥n

Nombre

Tipo

Valor inicial

Comentario

+0.0

Direcci√≥n

BYTE

B#16#5

Direcci√≥n del esclavo

+1.0

Funci√≥n

BYTE

B#16#10

C√≥digo de funci√≥n

+2.0

reg_startadr

WORD

W#16#0060

Direcci√≥n inicial del registro

+4.0

reg_anzahl

INT

3

N√∫mero de registros

+6.0

reg_data[1]

WORD

W#16#41A1

Datos de registro

+8.0

reg_data[2]

WORD

W#16#42A2

Datos de registro

+10.0

reg_data[3]

WORD

W#16#43A3

Datos de registro

Ejemplo
Telegrama de solicitud FUNCTION 16:
05H

Direcci√≥n del esclavo

10H

C√≥digo de funci√≥n

00H

Direcci√≥n de registro "High"

60H

Direcci√≥n de registro "Low"

00H

N√∫mero de registros "High"

03H

N√∫mero de registros "Low"

06H

Contador de bytes

41H

<reg_data[1]> "High"

A1H

<reg_data[1]> "Low"

42H

<reg_data[2]> "High"

A2H

<reg_data[2]> "Low"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1847

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
43H

<reg_data[3]> "High"

A3H

<reg_data[3]> "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta del esclavo FUNCTION 16:
05H

Direcci√≥n del esclavo

10H

C√≥digo de funci√≥n

00H

Direcci√≥n de registro "High"

60H

Direcci√≥n de registro "Low"

00H

N√∫mero de registros "High"

03H

N√∫mero de registros "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

El telegrama de respuesta no se registra en el DB de recepci√≥n.

Esclavo Modbus (RTU)
C√≥digo de funci√≥n 01 - Read Coil (Output) Status
Funci√≥n
Esta funci√≥n permite leer diferentes bits de las √°reas de memoria SIMATIC listadas a
continuaci√≥n a trav√©s del sistema maestro Modbus.

Telegrama de solicitud
ADDR

FUNC

start_address

bit_number

CRC

FUNC

Byte_count n

n-Byte DATA

CRC

Telegrama de respuesta
ADDR

start_address
La direcci√≥n de bit Modbus "start_address" la interpreta el driver del siguiente modo:

1848

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
el driver comprueba si "start_address" se encuentra en una de las √°reas que se indicaron en
la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento MODBUS para FC 01, 05,
15" (desde/hasta: marcas, salidas, temporizadores, contadores).
Si la direcci√≥n de bit MODBUS start_address se
encuentra en una de estas √°reas,

se accede a este √°rea de memoria SIMATIC.

De aaaaa a bbbbb

A partir de la marca

M uuuuu.0

De ccccc a ddddd

A partir de la salida

Q ooooo.0

De eeeee a fffff

A partir del temporizador

T ttttt

De ggggg a hhhhh

A partir del contador

C ccccc

La direcci√≥n para el acceso, la conversi√≥n de direcci√≥n, se calcula entonces del modo
siguiente:
Acceso empezando
con la
Byte de marca =
Byte de salida =
Temporizador =
Contadores
=

f√≥rmula de conversi√≥n SIMATIC
((start_address
((start_address
((start_address
((start_address

‚Äì aaaaa)
‚Äì ccccc)
‚Äì eeeee)
‚Äì ggggg)

/ 8)
/ 8)
/ 16)
/ 16)

+ uuuuu
+ ooooo
+ ttttt
+ ccccc

Acceso a "marcas" y "salidas"
Al acceder a las √°reas SIMATIC "Marcas" y "Salidas", se calcula el n√∫mero de bit restante y se
utiliza para direccionar el bit en cuesti√≥n dentro del primer/√∫ltimo byte de marca o de salida.
Acceso a "Temporizadores" y "Contadores"
Al calcular las direcciones, los siguientes resultados deben ser divisibles por 16 sin resto:
‚óè (start_address - eeeee)
‚óè (start_address - ggggg)
S√≥lo es posible el acceso por palabras empezando en el l√≠mite de palabra.

bit_number
Como bit_number, number of coils, se admiten valores entre 1 y 2040 (en el ET 200S 1SI
Modbus hasta 1768 bits). Se lee esta cantidad de bits.
Acceso a "Temporizadores" y "Contadores"
Al acceder a las √°reas SIMATIC "Temporizadores" y "Contadores", "bit_number" tiene que ser
divisible por 16 (s√≥lo acceso por palabras).
Tenga en cuenta que, al aplicar el CP 341, pueden leerse un m√°ximo de 16 "temporizadores"
o "contadores".
Nota
Observe las restricciones espec√≠ficas de la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1849

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-128 Conversi√≥n del direccionamiento MODBUS para los c√≥digos de funci√≥n FC 01, 05 y 15
Direcci√≥n MODBUS en el tele‚Äê
grama de transferencia

√Årea de memoria SIMATIC

De 0 a 2047

A partir de la marca

M 1000.0

De 2048 a 2559

A partir de la salida

Q 256,0

De 4096 a 4607

A partir del temporizador

T 100

De 4608 a 5119

A partir del contador

C 200

Telegrama de solicitud FUNCTION 01:
05H

Direcci√≥n del esclavo ADDR

01H

C√≥digo de funci√≥n FUNC

00H

start_address "High"

40H

start_address "Low"

00H

bit_number "High"

20H

bit_number "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 01:
05H

Direcci√≥n del esclavo ADDR

01H

C√≥digo de funci√≥n FUNC

04H

Byte_count

01H

<DATA 1> M 1008.0 - M 1008.7

17H

<DATA 2> M 1009.0 - M 1009.7

02H

<DATA 3> M 1010.0 - M 1010.7

18H

<DATA 4> M 1011.0 - M 1011.7

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

C√°lculo de direcciones:
La direcci√≥n MODBUS "start_address" 0040 Hex (64 decimal) se encuentra en el √°rea
"Marcas":
Byte de marca

1850

=
=
=

((start_address - aaaaa) / 8)
((64
- 0)
/ 8)
1008 ;

+ uuuuu
+ 1000

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El n√∫mero de bits restante da:
N¬∫ bit restante

=
=
=

((start_address - aaaaa) % 8) [M√≥dulo 8]
((64
- 0)
% 8)
0;

Se produce un acceso que empieza con la marca M 1008.0 hasta M 1011.7 inclusive.
N√∫mero de bits:
El n√∫mero de bits de Modbus ‚Äúbit_number" 0020 Hex (32 decimal) significa que deben leerse
32 bits = 4 bytes.

Otros ejemplos
A continuaci√≥n se muestra una tabla con m√°s ejemplos de acceso.
Todos los ejemplos se basan en la clasificaci√≥n de √°reas anteriormente indicada.
start_address

Acceso a SIMATIC empezando

->

con

Hex

Decimal

(Decimal)

0000

0

Marca

((0

- 0)

/ 8)

+ 1000

->

M 1000.0

0021

33

Marca

((33

- 0)

/ 8)

+ 1000

->

M 1004.1

0400

1024

Marca

((1024

- 0)

/ 8)

+ 1000

->

M 1128.0

0606

1542

Marca

((1542

- 0)

/ 8)

+ 1000

->

M 1192.6

0840

2112

Salida

((2112

- 2048)

/ 8)

+ 256

->

Q 264.0

09E4

2532

Salida

((2532

- 2048)

/ 8)

+ 256

->

Q 316.4

1010

4112

Temporiza‚Äê
dores

((4112

- 4096)

/ 16)

+ 100

->

T 101

10C0

4288

Temporiza‚Äê
dores

((4288

- 4096)

/ 16)

+ 100

->

T 112

1200

4608

Contadores

((4608

- 4608)

/ 16)

+ 200

->

C 200

13E0

5088

Contadores

((5088

- 4608)

/ 16)

+ 200

->

C 230

C√≥digo de funci√≥n 02 - Read Input Status
Funci√≥n
Esta funci√≥n permite leer diferentes bits de las √°reas de memoria SIMATIC listadas a
continuaci√≥n a trav√©s del sistema maestro Modbus.

Telegrama de solicitud
ADDR

FUNC

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

start_address

bit_number

CRC

1851

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Telegrama de respuesta
ADDR

FUNC

Byte_count n

n-Byte DATA

CRC

start_address
La direcci√≥n de bit Modbus "start_address" la interpreta el driver del siguiente modo:
el driver comprueba si "start_address" se encuentra en una de las √°reas que se indicaron en
la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento MODBUS para FC 02"
(desde/hasta: marcas, entradas).
Si la direcci√≥n de bit MODBUS se encuentra en el
√°rea start_address,

se accede al √°rea de memoria SIMATIC.

De kkkkk a lllll

A partir de la marca

M vvvvv.0

De nnnnn a rrrrr

A partir de la entrada

I sssss.0

La direcci√≥n para el acceso, la conversi√≥n de direcci√≥n, se calcula entonces del modo
siguiente:
Acceso empezando
con la
Byte de marca
=
Byte de entrada =

f√≥rmula de conversi√≥n SIMATIC
((start_address ‚Äì kkkkk) / 8)
((start_address ‚Äì nnnnn) / 8)

+ vvvvv
+ sssss

Acceso a "marcas" y "entradas"
Al acceder a las √°reas SIMATIC "Marcas" y "Entradas", se calcula el n√∫mero de bit restante y
se utiliza para direccionar el bit en cuesti√≥n dentro del primer/√∫ltimo byte de marca o de entrada.

bit_number
Como bit_number, number of coils, se admiten valores entre 1 y 2040 (en el ET 200S 1SI
Modbus hasta 1768 bits). Se lee esta cantidad de bits.
Nota
Observe las restricciones espec√≠ficas de la CPU.

1852

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-129 Conversi√≥n del direccionamiento MODBUS en el c√≥digo de funci√≥n FC 02
Direcci√≥n MODBUS en el tele‚Äê
grama de transferencia

√Årea de memoria SIMATIC

De 0 a 4095

A partir de la marca

M 2000.0

De 4096 a 5119

A partir de la entrada

E 128.0

Telegrama de solicitud FUNCTION 02:
05H

Direcci√≥n del esclavo ADDR

02H

C√≥digo de funci√≥n FUNC

10H

start_address "High"

30H

start_address "Low"

00H

bit_number "High"

18H

bit_number "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 02:
05H

Direcci√≥n del esclavo ADDR

02H

C√≥digo de funci√≥n FUNC

03H

Byte_count

12H

<DATA 1> I 134.0 - I 134.7

34H

<DATA 2> I 135.0 - I 135.7

56H

<DATA 3> I 136.0 - I 136.7

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

C√°lculo de direcciones:
La direcci√≥n MODBUS "start_address" 1030 Hex (4144 decimal) se encuentra en el √°rea
"Entradas":
Byte de entrada

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

=
=
=

((start_address - nnnnn) / 8)
((4144
- 4096) / 8)
134 ;

+ sssss
+ 128

1853

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El n√∫mero de bits restante da:
N¬∫ bit restante

=
=
=

((start_address - nnnnn) % 8) [M√≥dulo 8]
((4144
- 4096) % 8)
0;

Se produce un acceso que empieza con la entrada I 134.0 hasta I 136.7 inclusive.

N√∫mero de bits:
El n√∫mero de bits MODBUS ‚Äúbit_number" 0018 Hex (24 decimal) significa que deben leerse 24
bits = 3 bytes.

Otros ejemplos
A continuaci√≥n se muestra una tabla con m√°s ejemplos de acceso.
Todos los ejemplos se basan en la clasificaci√≥n de √°reas anteriormente indicada.
start_address

Acceso a SIMATIC empezando

->

con

Hex

Decimal

(Decimal)

0000

0

Marca

((0

- 0)

/ 8)

0071

113

Marca

((113

- 0)

/ 8)

+ 2000

->

M 2000.0

+ 2000

->

M 2014.1

0800

2048

Marca

((2048

- 0)

0D05

3333

Marca

((3333

- 0)

/ 8)

+ 2000

->

M 2256.0

/ 8)

+ 2000

->

M 2416.5

1000

4096

Entrada

((4096

- 4096)

/ 8)

+ 128

->

I 128.0

10A4

4260

Entrada

((4260

- 4096)

/ 8)

+ 128

->

I 148.4

C√≥digo de funci√≥n 03 - Read Output Registers
Funci√≥n
Esta funci√≥n permite leer palabras de datos de un bloque de datos a trav√©s del sistema
maestro MODBUS.

Telegrama de solicitud
ADDR

FUNC

start_register

register_number

CRC

FUNC

Byte_count n

n/2-Register DATA (High,Low)

CRC

Telegrama de respuesta
ADDR

1854

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

start_register
La direcci√≥n de registro MODBUS "start_register" la interpreta el driver del siguiente modo:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU






VWDUWBUHJLVWHU1|B'%B2IIVHW





%LW

VWDUWBUHJLVWHU1|BSDODEUD

Para seguir creando direcciones, el driver utiliza el "n√∫mero de DB b√°sico" (a partir de DB
xxxxx) registrado en la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento
MODBUS para FC 03, 06, 16".
La direcci√≥n para el acceso, la conversi√≥n de direcci√≥n, se calcula entonces del modo
siguiente:
Acceso a la
Bloque de datos DB
(DB resultante)
Palabra de datos
DBW

=

f√≥rmula de conversi√≥n SIMATIC
(N√∫mero de DB b√°sico xxxxx + start_register N¬∫_DB_Offset)

=

(start_register N¬∫_palabra

‚àó 2)

F√≥rmula de c√°lculo para start_register
Si se conoce el DB resultante que se debe leer, la direcci√≥n MODBUS start_register requerida
en el sistema maestro puede calcularse con la siguiente f√≥rmula:
start_register

= ((DB resultante - N√∫mero de DB b√°sico) ‚àó 512) +
(Palabra de datos_DBW / 2)

Para ello s√≥lo pueden emplearse n√∫meros pares de palabra de datos.

register_number
Como register_number, number of coils, se admite cualquier valor entre 1 y 127 (en el
ET 200S 1SI Modbus hasta 110 registros). Se lee esta cantidad de registros. Aqu√≠ hay que
tener en cuenta la siguiente regla:
(register_number)m√°x.

=

512 - start_register

Nota
Observe las restricciones espec√≠ficas de la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1855

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-130 Conversi√≥n del direccionamiento MODBUS para los c√≥digos de funci√≥n FC 03, 06 y 16
Direcci√≥n MODBUS en el
telegrama de transferencia

√Årea de memoria SIMATIC

0

A partir del bloque de datos
(n√∫mero de DB b√°sico)

DB 800

Telegrama de solicitud FUNCTION 03:
05H

Direcci√≥n del esclavo ADDR

03H

C√≥digo de funci√≥n FUNC

00H

start_register "High"

50H

start_register "Low"

00H

register_number "High"

02H

register_number "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 03:

1856

05H

Direcci√≥n del esclavo ADDR

03H

C√≥digo de funci√≥n FUNC

04H

Byte_count

87H

<DATA 1> DBW 160 "High"

65H

<DATA 2> DBW 160 "Low"

43H

<DATA 3> DBW 161 "High"

21H

<DATA 4> DBW 161 "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√°lculo de direcciones:
La direcci√≥n MODBUS "start_register" 0050 Hex (80 decimal) se interpreta:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU  +H[








VWDUWBUHJLVWHU2IIVHWB'%B1U
+H[ GHFLPDO



%LW

VWDUWBUHJLVWHU:RUW1U
+H[ GHFLPDO

%ORTXHGHGDWRV'%
'%UHVXOWDQWH

1¬ºPHUREDVH'%[[[[

VWDUWBUHJLVWHU2IIVHWB'%B1U



3DODEUDGHGDWRV
'%:

VWDUWBUHJLVWHU1|BSDODEUD 




Se accede al DB 800, palabra de datos DBW 160.

N√∫mero de registros:
El n√∫mero de registros MODBUS ‚Äúregister_number" 0002 Hex (2 decimal) significa que deben
leerse 2 registros = 2 palabras de datos.

Otros ejemplos
A continuaci√≥n se muestra una tabla con m√°s ejemplos de acceso.
start_register
start_register

N¬∫ de DB
b√°sico

N¬∫_DB_Off‚Äê
set

N√∫mero de pala‚Äê
bra

DB resultante

DBW

Hex

Decimal

Decimal

Decimal

Hex

Decimal

Decimal

Decimal

0000

0

800

0

000

0

800

0

01F4

500

800

0

1F4

500

800

1000

0200

512

800

1

000

0

801

0

02FF

767

800

1

0FF

255

801

510

0300

768

800

1

100

256

801

512

03FF

1023

800

1

1FF

511

801

1022

0400

1024

800

2

000

0

802

0

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1857

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√≥digo de funci√≥n 04 - Read Input Registers
Funci√≥n
Esta funci√≥n permite leer palabras de datos de un bloque de datos a trav√©s del sistema
maestro MODBUS.

Telegrama de solicitud
ADDR

FUNC

start_register

register_number

CRC

FUNC

Byte_count n

n/2-Register DATA (High,Low)

CRC

Telegrama de respuesta
ADDR

start_register
La direcci√≥n de registro MODBUS "start_register" la interpreta el driver del siguiente modo:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU




VWDUWBUHJLVWHU1|B'%B2IIVHW







%LW

VWDUWBUHJLVWHU1|BSDODEUD

Para seguir creando direcciones, el driver utiliza el "n√∫mero de DB b√°sico" (a partir de DB
xxxxx) introducido en la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento
MODBUS para FC 04".
El c√°lculo de la direcci√≥n para el acceso y la conversi√≥n de la direcci√≥n se realiza en dos niveles
de la siguiente forma:
Acceso a la
Bloque de datos DB
(DB resultante)
Palabra de datos
DBW

=
=

f√≥rmula de conversi√≥n SIMATIC
(n√∫mero DB b√°sico xxxxx + start_register-Offset_DB_Nr.)
(start_register N¬∫_pala‚Äê ‚àó 2)
bra

F√≥rmula de c√°lculo para start_register
Si se conoce el DB resultante que se debe leer, la direcci√≥n MODBUS start_register requerida
en el sistema maestro puede calcularse con la siguiente f√≥rmula:
start_register

=

((DB resultante - N√∫mero de DB b√°sico) ‚àó 512) +(palabra de datos_DBW /
2)

√önicamente pueden emplearse n√∫meros pares de palabras de datos.

1858

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

register_number
Como register_number, number of coils, se admite cualquier valor entre 1 y 127 (en el
ET 200S 1SI Modbus hasta 110 registros). Se lee esta cantidad de registros. Debe tenerse en
cuenta la siguiente regla:
(register_number)m√°x.

=

512 - start_register

Nota
Observe las restricciones espec√≠ficas de la CPU.

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-131 Conversi√≥n del direccionamiento MODBUS para el c√≥digo de funci√≥n FC 04
Direcci√≥n MODBUS en el tele‚Äê
grama de transferencia

√Årea de memoria SIMATIC

0

A partir del bloque de datos
(n√∫mero de DB b√°sico)

DB 900

Telegrama de solicitud FUNCTION 04:
05H

Direcci√≥n del esclavo ADDR

04H

C√≥digo de funci√≥n FUNC

02H

start_register "High"

C0H

start_register "Low"

00H

register_number "High"

03H

register_number "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 04:
05H

Direcci√≥n del esclavo ADDR

04H

C√≥digo de funci√≥n FUNC

06H

Byte_count

A1H

<DATA 1> DBW 384 "High"

A2H

<DATA 2> DBW 384 "Low"

A3H

<DATA 3> DBW 385 "High"

A4H

<DATA 4> DBW 385 "Low"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1859

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
A5H

<DATA 5> DBW 386 "High"

A6H

<DATA 6> DBW 386 "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

C√°lculo de direcciones:
La direcci√≥n MODBUS "start_register" 02C0 Hex (704 decimal) se interpreta:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU  &+H[




 

VWDUWBUHJLVWHU2IIVHWB1|B'%
+H[ GHFLPDO



%LW

VWDUWBUHJLVWHU1|BSDODEUD
&+H[ GHFLPDO

%ORTXHGHGDWRV'%
'%UHVXOWDQWH

1¬ºPHURGH'%E¬£VLFR[[[[[ 
VWDUWBUHJLVWHU2IIVHWB1|B'%



3DODEUDGHGDWRV
'%:

VWDUWBUHJLVWHU1|BSDODEUD 




Se accede al DB 901, palabra de datos DBW 384.

N√∫mero de registros:
El n√∫mero de registros MODBUS ‚Äúregister_number" 0003 Hex (3 decimal) significa que deben
leerse 3 registros = 3 palabras de datos.

Otros ejemplos
A continuaci√≥n se muestra una tabla con m√°s ejemplos de acceso.
start_register

1860

start_register

N¬∫ de DB
b√°sico

N¬∫_DB_Off‚Äê
set

N√∫mero de palabra DB resultante

DBW

Hex

decimal

decimal

decimal

Hex

decimal

decimal

decimal

0000

0

900

0

000

0

900

0

0064

100

900

0

064

100

900

200

00C8

200

900

0

0C8

200

900

400

0190

400

900

0

190

400

900

800

1400

5120

900

10

000

0

910

0

1464

5220

900

10

064

100

910

200

14C8

5320

900

10

0C8

200

910

400

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√≥digo de funci√≥n 05 - Force Single Coil
Funci√≥n
Esta funci√≥n permite escribir un bit de las √°reas de memoria SIMATIC listadas a continuaci√≥n
a trav√©s del sistema maestro MODBUS.

Telegrama de solicitud
ADDR

FUNC

coil_address

DATA-on/off

CRC

FUNC

coil_address

DATA-on/off

CRC

Telegrama de respuesta
ADDR

coil_address
La direcci√≥n de bit MODBUS "coil_address" la interpreta el driver del siguiente modo:
el driver comprueba si "coil_address" se encuentra en una de las √°reas que se introdujeron en
la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento MODBUS para FC 01, 05,
15" (desde/hasta: marcas, salidas, temporizadores, contadores).
Si la
direcci√≥n de bit MODBUS
coil_address
se encuentra en el √°rea,

se accede al
√°rea de memoria SIMATIC.

De aaaaa a bbbbb

A partir de la marca

M uuuuu.0

De ccccc a ddddd

A partir de la salida

Q ooooo.0

El c√°lculo de la direcci√≥n para el acceso (conversi√≥n de la direcci√≥n) se realiza de la siguiente
forma:
Acceso empezando con la f√≥rmula de conversi√≥n SIMATIC
/ 8)
Byte de marca
= ((coil_address
- aaaaa)
Byte de salida
= ((coil_address
- ccccc)
/ 8)

+ uuuuu
+ ooooo

Acceso a "marcas" y "salidas"
Al acceder a las √°reas SIMATIC "Marcas" y "Salidas", se calcula el n√∫mero de bits restante y
se utiliza para direccionar el bit en cuesti√≥n dentro del byte de marca o de salida.

Acceso a "Temporizadores" y "Contadores"
Con el c√≥digo de funci√≥n FC 05 no se permite el acceso al √°rea SIMATIC Temporizadores y
Contador; el driver avisa de ello con un telegrama de error.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1861

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

DATA-on/off
Se permiten los dos siguientes valores como DATA-on/off:
‚óè FF00H -> activar bit
‚óè 0000H -> borrar bit

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-132 Conversi√≥n del direccionamiento MODBUS para los c√≥digos de funci√≥n FC 01, 05, 15
Direcci√≥n MODBUS en el
telegrama de transferencia

√Årea de memoria SIMATIC

De 0 a 2047

A partir de la marca

M 1000.0

de 2048 a 2559

A partir de la salida

Q 256,0

Telegrama de solicitud FUNCTION 05:
05H

Direcci√≥n del esclavo ADDR

05H

C√≥digo de funci√≥n FUNC

08H

coil_address "High"

09H

coil_address "Low" Q 257.1

FFH

DATA-on/off "High"

00H

DATA-on/off "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 05:

1862

05H

Direcci√≥n del esclavo ADDR

05H

C√≥digo de funci√≥n FUNC

08H

coil_address "High"

09H

coil_address "Low" Q257.1

FFH

DATA-on/off "High"

00H

DATA-on/off "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√°lculo de direcciones:
La direcci√≥n MODBUS "coil_address" 0809 Hex (2057 decimal) se encuentra en el √°rea
"Salidas":
Byte de salida

= ((coil_address
= ((2057
= 257 ;

- ccccc)
- 2048)

/ 8)
/ 8)

+ ooooo
+ 256

- ccccc)
- 2048)

% 8)
% 8)

[M√≥dulo 8]

El n√∫mero de bits restante da:
N¬∫ bit restante

= ((coil_address
= ((2057
= 1;

Se accede a la salida Q 257.1.

Otros ejemplos
Pueden consultarse m√°s ejemplos de accesos a marcas y salidas en el FC 01.

C√≥digo de funci√≥n 06 - Preset Single Register
Funci√≥n
Esta funci√≥n permite escribir palabras de datos en un bloque de datos de la CPU a trav√©s del
sistema maestro MODBUS.

Telegrama de solicitud
ADDR

FUNC

start_register

DATA-value (High,Low)

CRC

FUNC

start_register

DATA-value (High,Low)

CRC

Telegrama de respuesta
ADDR

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1863

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

start_register
La direcci√≥n de registro MODBUS "start_register" la interpreta el driver del siguiente modo:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU






VWDUWBUHJLVWHU1|B'%B2IIVHW





%LW

VWDUWBUHJLVWHU1|BSDODEUD

Para seguir creando direcciones, el driver utiliza el "n√∫mero de DB b√°sico" (a partir de DB
xxxxx) registrado en la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento
MODBUS para FC 03, 06, 16".
El c√°lculo de la direcci√≥n para el acceso y la conversi√≥n de la direcci√≥n se realiza en dos niveles
de la siguiente forma:
Acceso a la
Bloque de datos DB
(DB resultante)
Palabra de datos
DBW

=

f√≥rmula de conversi√≥n SIMATIC
(n√∫mero DB b√°sico xxxxx + start_register-Offset_DB_Nr.)

=

(start_register N¬∫_palabra

‚àó 2)

F√≥rmula de c√°lculo para start_register
Si se conoce el DB resultante en el que se debe escribir, la direcci√≥n MODBUS start_register
requerida en el sistema maestro puede calcularse con la siguiente f√≥rmula:
start_register

=

((DB resultante - N√∫mero de DB b√°sico) ‚àó 512) +(palabra de datos_DBW /
2)

√önicamente pueden emplearse n√∫meros pares de palabras de datos.

DATA-value
El valor de registro, como DATA-value, puede ser cualquier valor.

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-133 Conversi√≥n del direccionamiento MODBUS para los c√≥digos de funci√≥n FC 03, 06 y 16

1864

Direcci√≥n MODBUS en el tele‚Äê
grama de transferencia

√Årea de memoria SIMATIC

0

A partir del bloque de datos
(n√∫mero de DB b√°sico)

DB 800

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Telegrama de solicitud FUNCTION 06:
05H

Direcci√≥n del esclavo ADDR

06H

C√≥digo de funci√≥n FUNC

01H

start_register "High"

80H

start_register "Low" DBW 768

2BH

DATA-value "High"

1AH

DATA-value "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 06:
05H

Direcci√≥n del esclavo ADDR

06H

C√≥digo de funci√≥n FUNC

01H

start_register "High"

80H

start_register "Low" DBW 768

2BH

DATA-value "High"

1AH

DATA-value "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

C√°lculo de direcciones:
La direcci√≥n MODBUS "start_register" 0180 Hex (384 decimal) se interpreta:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU  +H[
















VWDUWBUHJLVWHU2IIVHWB'%B1U
+H[ GHFLPDO

%ORTXHGHGDWRV'%
'%UHVXOWDQWH

3DODEUDGHGDWRV
'%:

 

















%LW



VWDUWBUHJLVWHU:RUW1U
+H[ GHFLPDO


1¬ºPHUREDVH'%[[[[
VWDUWBUHJLVWHU2IIVHWB'%B1U
  
VWDUWBUHJLVWHU1|BSDODEUD 





Se accede al DB 800, palabra de datos DBW 768.

Otros ejemplos
Pueden consultarse otros ejemplos de acceso en el FC 03.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1865

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√≥digo de funci√≥n 08 - Loop Back Diagnostic Test
Funci√≥n
Esta funci√≥n sirve para comprobar el enlace de comunicaci√≥n.
Tiene efecto en la CPU S7 y los programas y datos de usuario. El driver reenv√≠a
independientemente el telegrama recibido al sistema maestro.

Telegrama de solicitud

ADDR

FUNC

C√≥digo de diagn√≥stico (High,Low)

Test-Data

CRC

FUNC

C√≥digo de diagn√≥stico (High,Low)

Test-Data

CRC

Telegrama de respuesta

ADDR

C√≥digo de diagn√≥stico
√önicamente se admite el c√≥digo de diagn√≥stico 0000.

Test-Data
Valor de 16 bits deseado.

Ejemplo de aplicaci√≥n
Telegrama de solicitud FUNCTION 08:
05H

Direcci√≥n del esclavo ADDR

08H

C√≥digo de funci√≥n FUNC

00H

C√≥digo de diagn√≥stico "High"

00H

C√≥digo de diagn√≥stico "Low"

A5H

Valor de test "High"

C3H

Valor de test "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 08:

1866

05H

Direcci√≥n del esclavo ADDR

08H

C√≥digo de funci√≥n FUNC

00H

C√≥digo de diagn√≥stico "High"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
00H

C√≥digo de diagn√≥stico "Low"

A5H

Valor de test "High"

C3H

Valor de test "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

C√≥digo de funci√≥n 15 - Force Multiple Coils
Funci√≥n
Esta funci√≥n permite escribir varios bits de las √°reas de memoria SIMATIC listadas a
continuaci√≥n a trav√©s del sistema maestro MODBUS.

Telegrama de solicitud

ADDR

FUNC

start_address

quantity

byte_count n

n-DATA

CRC

Telegrama de respuesta

ADDR

FUNC

start_address

quantity

CRC

start_address
La direcci√≥n de bit MODBUS "start_address" la interpreta el driver del siguiente modo:
el driver comprueba si "start_address" se encuentra en una de las √°reas que se indicaron en
la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento MODBUS para FC 01, 05,
15" (desde/hasta: marcas, salidas, temporizadores, contadores).
Si la direcci√≥n de bit MODBUS se encuentra en el se accede al √°rea de memoria SIMATIC.
√°rea start_address,
De aaaaa a bbbbb

A partir de la marca

M uuuuu.0

De ccccc a ddddd

A partir de la salida

Q ooooo.0

El c√°lculo de la direcci√≥n para el acceso, la conversi√≥n de la direcci√≥n, se realiza de la siguiente
forma:
Acceso empezando con la f√≥rmula de conversi√≥n SIMATIC
Byte de marca
= ((start_address - aaaaa) / 8) + uuuuu
Byte de salida
= ((start_address - ccccc) / 8) + ooooo

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1867

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Acceso a "marcas" y "salidas"
Al acceder a las √°reas SIMATIC "Marcas" y "Salidas", se calcula el n√∫mero de bits restante y
se utiliza para direccionar el bit en cuesti√≥n dentro del byte de marca o de salida.

Acceso a "Temporizadores" y "Contadores"
Con el c√≥digo de funci√≥n FC 15 no se permite el acceso al √°rea SIMATIC Temporizadores y
Contador; el driver avisa de ello con un telegrama de error.

Quantity
Como quantity, n√∫mero de bits, se admite cualquier valore entre 1 y 2040 (en el ET 200S 1SI
Modbus hasta 1976).
Nota
Observe las restricciones espec√≠ficas de la CPU.

DATA
En el campo DATA se encuentran los valores deseados como estados de bits.

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-134 Conversi√≥n del direccionamiento MODBUS para los c√≥digos de funci√≥n FC 01, 05 y 15
Direcci√≥n MODBUS en el tele‚Äê
grama de transferencia

√Årea de memoria SIMATIC

De 0 a 2047

A partir de la marca

M 1000.0

De 2048 a 2559

A partir de la salida

Q 256,0

Acci√≥n:
El sistema maestro MODBUS pretende describir las marcas M 1144.0 ... M 1144.7 y
M 1145.0 ... M 1145.3 con los siguientes estados de bits:
Marcas M 1144

Marcas M 1145

1868

7

6

5

4

3

2

1

0

ON

ON

OFF

OFF

ON

ON

OFF

ON

7

6

5

4

3

2

1

0

-

-

-

-

ON

OFF

OFF

ON

Bit

Bit

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Telegrama de solicitud FUNCTION 15:
05H

Direcci√≥n del esclavo ADDR

0FH

C√≥digo de funci√≥n FUNC

04H

start_address "High"

80H

start_address "Low" (M 1144.0 ... )

00H

quantity "High"

0CH

quantity "Low" (12 bits)

02H

bytecount

CDH

Coil de estado (M 1144.0 ... M 1144.7)

09H

Coil de estado (M 1145.0 ... M 1145.3)

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 15:
05H

Direcci√≥n del esclavo ADDR

0FH

C√≥digo de funci√≥n FUNC

04H

start_address "High"

80H

start_address "Low"

00H

quantity "High"

0CH

quantity "Low"

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

C√°lculo de direcciones:
La direcci√≥n MODBUS "coil_address" 0480 Hex (1152 decimal) se encuentra en el √°rea
"Marcas":
Byte de marca

=
=
=

((start_address - aaaaa) / 8)
((1152
- 0)
/ 8)
1144 ;

+ uuuuu
+ 1000

El n√∫mero de bits restante da:
N¬∫ bit restante

=
=
=

((start_address - aaaaa) % 8) [M√≥dulo 8]
((1152
- 0)
% 8)
0;

Se produce un acceso a la marca que comienza en M 1144.0.

Otros ejemplos
Pueden consultarse m√°s ejemplos de accesos a marcas y salidas en el FC 01.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1869

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

C√≥digo de funci√≥n 16 - Preset Multiple Registers
Funci√≥n
Este c√≥digo de funci√≥n permite escribir palabras de datos en un bloque de datos de la CPU
SIMATIC a trav√©s del sistema maestro MODBUS.

Telegrama de solicitud
ADDR

FUNC

start_register

quantity

byte_count n

n-DATA (High,Low)

CRC

Telegrama de respuesta
ADDR

FUNC

start_register

quantity

CRC

start_register
La direcci√≥n de registro MODBUS "start_register" la interpreta el driver del siguiente modo:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU




VWDUWBUHJLVWHU1|B'%B2IIVHW







%LW

VWDUWBUHJLVWHU1|BSDODEUD

Para seguir creando direcciones, el driver utiliza el "n√∫mero de DB b√°sico" (a partir de DB
xxxxx) registrado en la parametrizaci√≥n de la m√°scara "Conversi√≥n del direccionamiento
MODBUS para FC 03, 06, 16".
El c√°lculo de la direcci√≥n para el acceso y la conversi√≥n de la direcci√≥n se realiza en dos niveles
de la siguiente forma:
Acceso a la
f√≥rmula de conversi√≥n SIMATIC
Bloque de datos DB
= (n√∫mero DB b√°sico xxxxx + start_register-Offset_DB_Nr.)
(DB resultante)
Palabra de datos DBW = (start_register N¬∫_palabra ‚àó 2)

F√≥rmula de c√°lculo para start_register
Si se conoce el DB resultante en el que se debe escribir, la direcci√≥n MODBUS start_register
requerida en el sistema maestro puede calcularse con la siguiente f√≥rmula:
start_register

=

((DB resultante - N√∫mero de DB b√°sico) ‚àó 512) +(palabra de datos_DBW /
2)

√önicamente pueden emplearse n√∫meros pares de palabras de datos.

1870

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Quantity
Como quantity, n√∫mero de registros, se admite cualquier valor entre 1 y 127 (en el ET 200S 1SI
Modbus hasta 123). Aqu√≠ hay que tener en cuenta la siguiente regla:
(Quantity)m√°x.

=

512 - start_register

Nota
Observe las restricciones espec√≠ficas de la CPU.

DATA (High,Low)
Puede utilizarse cualquier valor como DATA (High,Low) (valor de registro).

Ejemplo de aplicaci√≥n
Ejemplo para la parametrizaci√≥n:
Tabla 1-135 Conversi√≥n del direccionamiento MODBUS para los c√≥digos de funci√≥n FC 03, 06, 16
Direcci√≥n MODBUS en el
telegrama de transferencia

√Årea de memoria SIMATIC

0

A partir del bloque de datos
(n√∫mero de DB b√°sico)

DB 800

Acci√≥n:
El sistema maestro MODBUS pretende describir las palabras de datos DBW 100, DBW 102,
DBW 104 del DB 800 con los valores CD09 Hex, DE1A Hex, EF2B Hex.

Telegrama de solicitud FUNCTION 16:
05H

Direcci√≥n del esclavo ADDR

10H

C√≥digo de funci√≥n FUNC

00H

start_register "High"

32H

start_register "Low" DBW 100

00H

quantity "High"

03H

quantity "Low" (3 registros)

06H

bytecount

CDH

register value -High (DBW100)

09H

register value -Low

DEH

register value -High (DBW102)

1AH

register value -Low

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1871

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
EFH

register value -High (DBW104)

2BH

register value -Low

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

Telegrama de respuesta FUNCTION 16:
05H

Direcci√≥n del esclavo ADDR

10H

C√≥digo de funci√≥n FUNC

00H

start_register "High"

32H

start_register "Low"

00H

quantity "High"

03H

quantity "Low" (3 registros)

xxH

C√≥digo de verificaci√≥n CRC "Low"

xxH

C√≥digo de verificaci√≥n CRC "High"

C√°lculo de direcciones:
La direcci√≥n MODBUS "start_register" 0032 Hex (50 decimal) se interpreta:
1¬ºPHURGHUHJLVWUR0RGEXV VWDUWBUHJLVWHU  +H[
















VWDUWBUHJLVWHU2IIVHWB'%B1U
+H[ GHFLPDO
%ORTXHGHGDWRV'%
'%UHVXOWDQWH

3DODEUDGHGDWRV
'%:

 

















%LW



VWDUWBUHJLVWHU:RUW1U
+H[ GHFLPDO

1¬ºPHUREDVH'%[[[[

VWDUWBUHJLVWHU2IIVHWB'%B1U


VWDUWBUHJLVWHU1|BSDODEUD 





Se accede al DB 800, palabra de datos DBW 100.

Otros ejemplos
Pueden consultarse otros ejemplos de acceso en el FC 03.

1872

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

√Årea de registro de errores
Esquema num√©rico clase de evento/n√∫mero de evento
1|GHELW



 

5HVHUYD





&ODVHGH
HYHQWR



1¬ºPHURGHHYHQWR
1¬ºPHURGHHUURU

Clases de eventos
Clase de evento

Significado

2

Error en la inicializaci√≥n

5

Error en la edici√≥n de una petici√≥n CPU

8

Error de recepci√≥n

14 (0EH)

Error general de edici√≥n

30 (1EH)

Error durante la comunicaci√≥n entre la interfaz serie y la CPU.

Clase de evento/n√∫mero de evento
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

0201

No hay parametrizaci√≥n (v√°lida).

Proporcione par√°metros correctos al m√≥dulo.
Dado el caso, compruebe que el montaje de la
instalaci√≥n es correcto.

0502

Petici√≥n no admisible en este estado operativo del m√≥dulo
interfaz serie ET 200S Modbus/USS (ejemplo: La interfaz
de dispositivo no est√° parametrizada).

Eval√∫e la alarma de diagn√≥stico y elimine el
error de la forma correspondiente.

050E

Longitud de telegrama no v√°lida

La longitud del telegrama de env√≠o supera los
224 bytes. La petici√≥n de env√≠o ha sido interrum‚Äê
pida por el m√≥dulo ET 200S Modbus/USS.
Seleccione una longitud de telegrama inferior.

0518

‚óè La longitud de transferencia en el env√≠o es demasiado
grande (> 4 kbytes)

Comprobar par√°metro LEN en SEND.

‚óè La longitud de transferencia en SEND es demasiado
peque√±a.
0530

Petici√≥n de env√≠o de maestro Modbus rechazada, ya que
todav√≠a no se ha llamado la respuesta del interlocutor a una
petici√≥n de env√≠o de lectura anterior del maestro Modbus.

Despu√©s de una petici√≥n de lectura del maestro
Modbus correcta, primero hay que recoger del
m√≥dulo la respuesta del interlocutor antes de
iniciar una nueva petici√≥n de env√≠o del maestro
Modbus.

0551

Error de desarrollo de trama en la comunicaci√≥n entre el
m√≥dulo interfaz serie ET 200S Modbus/USS y la CPU. El
error se ha producido durante la transmisi√≥n de un telegra‚Äê
ma recibido del m√≥dulo interfaz serie ET 200S SI en la CPU.

El m√≥dulo y la CPU han interrumpido la transmi‚Äê
si√≥n. Repita la petici√≥n de recepci√≥n. El m√≥dulo
interfaz serie ET 200S Modbus/USS vuelve a
enviar el aviso recibido.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1873

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

0806

Se ha sobrepasado el tiempo de retardo de caracteres ZVZ Error en el dispositivo interlocutor o deben elimi‚Äê
narse interferencias importantes en la l√≠nea de
transmisi√≥n.

080A

Desbordamiento del b√∫fer de recepci√≥n en el maestro du‚Äê
rante la recepci√≥n del telegrama de reacci√≥n.

Compruebe los ajustes de protocolo del esclavo.

080C

Se ha detectado un error de transferencia en uno de los
caracteres (error de paridad, de overrun o de bit de parada
(Frame)).

Comprobar si las interferencias afectan a la l√≠‚Äê
nea de transferencia.
De ser necesario, modifique la estructura del
sistema o el tendido de la l√≠nea.
Compruebe si los par√°metros de protocolo de la
velocidad de transmisi√≥n, el n√∫mero de bits de
datos, la paridad, el n√∫mero de bits de parada en
el m√≥dulo de comunicaci√≥n y el interlocutor aco‚Äê
plado est√°n ajustados de la misma forma.

080D

BREAK
Se ha interrumpido la l√≠nea de recepci√≥n hasta el dispositivo
interlocutor.

0810

Establezca la conexi√≥n entre los equipos o acti‚Äê
ve el dispositivo interlocutor.
En el modo TTY, comprobar si la corriente de
l√≠nea contin√∫a fluyendo en estado de reposo.
Compruebe y modifique si fuera necesario la
ocupaci√≥n de la l√≠nea de recepci√≥n R(A), R(B)
de 2 hilos en una conexi√≥n RS422/485 (X27).

Error de paridad: Hay una interrupci√≥n en la l√≠nea de cone‚Äê Compruebe la l√≠nea de conexi√≥n de los interlo‚Äê
xi√≥n (rotura de hilo) de ambos interlocutores.
cutores y si la velocidad de transmisi√≥n, la pari‚Äê
dad y el n√∫mero de bits de parada tienen la mis‚Äê
ma configuraci√≥n en ambos interlocutores.
Modifique la configuraci√≥n de su sistema o el
cableado.

0811

Error de trama de caracteres: Hay una interrupci√≥n en la
l√≠nea de conexi√≥n (rotura de hilo) de ambos interlocutores.

Compruebe la l√≠nea de conexi√≥n de los interlo‚Äê
cutores y si la velocidad de transmisi√≥n, la pari‚Äê
dad y el n√∫mero de bits de parada tienen la mis‚Äê
ma configuraci√≥n en ambos interlocutores.
Modifique la configuraci√≥n de su sistema o el
cableado.

0812

Se han recibido m√°s caracteres despu√©s de que la interfaz
serie haya puesto CTS en OFF.

Parametrice el interlocutor de nuevo o vac√≠e la
interfaz serie con mayor rapidez.

0830

El tiempo de vigilancia de respuesta tras el env√≠o de un te‚Äê
legrama de solicitud ha trascurrido sin que se haya detec‚Äê
tado el inicio del telegrama de reacci√≥n.

Compruebe si la l√≠nea de transferencia se ha
visto afectada por alg√∫n problema (de ser nece‚Äê
sario, utilizar el analizador de interfaz).
Compruebe si los par√°metros de protocolo de la
velocidad de transmisi√≥n, el n√∫mero de bits de
datos, la paridad, el n√∫mero de bits de parada en
el m√≥dulo de comunicaci√≥n y el interlocutor aco‚Äê
plado est√°n ajustados de la misma forma.
Compruebe si el tiempo de vigilancia de res‚Äê
puesta parametrizado en el cuadro de di√°logo
de propiedades del m√≥dulo es suficiente.
Compruebe si la direcci√≥n del esclavo indicada
est√° o no disponible.

1874

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

0831

El primer car√°cter del telegrama de reacci√≥n del esclavo no
es igual a la direcci√≥n de esclavo enviado en el telegrama de
solicitud (en el modo de operaci√≥n "Normal").

Ha respondido un esclavo equivocado.

0832

Desbordamiento del b√∫fer de recepci√≥n en el m√≥dulo de
comunicaci√≥n al recibir el telegrama de reacci√≥n.

Compruebe los ajustes de protocolo del esclavo.

0833

El n√∫mero de bits o registros con el c√≥digo de funci√≥n FC
Corrija el n√∫mero de bits/registros o byte_count.
15/16 y el elemento de telegrama byte_count no coinciden.

0834

Codificaci√≥n de bit no admisible para "Activar bit"/"Desacti‚Äê Para FC05 utilice s√≥lo las codificaciones
var bit".
0000Hex o FF00Hex.

0835

Detectado subc√≥digo de diagn√≥stico no admisible (no igual
que 0000Hex) con el c√≥digo de funci√≥n FC 08 "Loop Back
Test".

0836

El valor calculado internamente con la suma de comproba‚Äê Compruebe el c√°lculo de la suma de comproba‚Äê
ci√≥n CRC-16 no concuerda con la suma de comprobaci√≥n ci√≥n CRC en el sistema maestro Modbus.
CRC recibida.

0837

Error de proceso de telegrama: El sistema maestro Modbus
env√≠a un nuevo telegrama de petici√≥n antes que el driver
haya transmitido el √∫ltimo telegrama de reacci√≥n.

Aumente el timeout para el telegrama de reac‚Äê
ci√≥n del esclavo en el sistema maestro Modbus.

0850

Longitud del telegrama de recepci√≥n mayor de 224 bytes o
bien mayor que la longitud de telegrama parametrizada.

Adaptar la longitud de telegrama del interlocutor.

0E01

Error en la inicializaci√≥n del proceso SCC espec√≠fico del
driver.

Volver a parametrizar y cargar el driver.

0E02

Error en el arranque del driver:
proceso SCC err√≥neo activo (driver SCC).
El driver no funciona con este driver SCC.

Volver a parametrizar y cargar el driver.

0E03

Error en el arranque del driver:
proceso err√≥neo de transferencia de datos activo (interfaz
con las instrucciones).
El driver no funciona con este proceso de transferencia de
datos.

Volver a parametrizar y cargar el driver.

0E04

Error en el arranque del driver:
subm√≥dulo de interfaz no permitido
El driver no puede funcionar con el subm√≥dulo de interfaz
parametrizado.

Comprobar y corregir la parametrizaci√≥n.

0E05

Error en el dongle del driver:
no se ha conectado ning√∫n dongle o se ha producido un
error en el dongle conectado.
El driver no est√° preparado para entrar en funcionamiento.

Compruebe si hay un dongle de driver conecta‚Äê
do al m√≥dulo de comunicaci√≥n.
Si es as√≠, sustituya el dongle err√≥neo por uno
correcto.

0E06

Error en el dongle del driver:
el contenido del dongle no es v√°lido.
El driver no est√° preparado para entrar en funcionamiento.

Solicite un dongle correcto a la filial de SIE‚Äê
MENS a la que adquiri√≥ el driver.

0E10

Error interno de procedimiento:
rama predeterminada en el aut√≥mata del procedimiento.

Rearranque del m√≥dulo de comunicaci√≥n (Po‚Äê
wer ON)

0E11

Error interno de procedimiento:
rama predeterminada en estado de procedimiento enviar/
recibir.

Rearranque del m√≥dulo de comunicaci√≥n (Po‚Äê
wer ON)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Compruebe si la l√≠nea de transferencia se ha
visto afectada por alg√∫n problema (de ser nece‚Äê
sario, utilizar el analizador de interfaz).

Para FC08 utilice s√≥lo el subc√≥digo 0000Hex.

1875

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

0E12

Error interno en aut√≥mata activo:
rama predeterminada

Rearranque del m√≥dulo de comunicaci√≥n (Po‚Äê
wer ON)

0E13

Error interno en aut√≥mata pasivo:
rama predeterminada

Rearranque del m√≥dulo de comunicaci√≥n (Po‚Äê
wer ON)

0E20

El n√∫mero de los bits de datos en este acoplamiento debe
ser 8.

Corrija la parametrizaci√≥n del driver.

El driver no est√° preparado para entrar en funcionamiento.
Corrija la parametrizaci√≥n del driver.

0E21

El factor de multiplicaci√≥n parametrizado para el tiempo de
retardo de caracteres no se encuentra dentro del √°mbito de
1 a 10.
El driver funciona con 1 como ajuste est√°ndar.

0E22

No se permite el modo de operaci√≥n parametrizado del dri‚Äê Corrija la parametrizaci√≥n del driver.
ver.
Deber√° indicarse el modo "Normal" o de "Supresi√≥n de per‚Äê
turbaciones". El driver no est√° preparado para entrar en
funcionamiento.

0E23

El valor no permitido para el tiempo de vigilancia de res‚Äê
puesta parametriza:
Valores permitidos 5 ‚Ä¶ 65500 ms.
El driver no est√° preparado para entrar en funcionamiento.

Corrija la parametrizaci√≥n del driver.

0E24

Se han parametrizado l√≠mites no permitidos para los acce‚Äê
sos de escritura.
El driver no est√° listo.

Corrija la parametrizaci√≥n del driver.

0E25

Se ha parametrizado una combinaci√≥n "de/a" no v√°lida en la
introducci√≥n de las √°reas "cambio del direccionamiento
Modbus en la FC 01, 05, 15".
(√Årea de marcas, salidas, temporizadores, contadores).
El driver no est√° operativo.

Corrija la parametrizaci√≥n del driver.

0E26

Corrija la parametrizaci√≥n del driver.
Al introducir las √°reas "Conversi√≥n del direccionamiento
Modbus para FC 02", se ha parametrizado una combinaci√≥n
"desde/hasta" no permitida.
(√Årea marcas, entradas).
El driver no est√° listo.

0E27

Corrija la parametrizaci√≥n del driver.
Al introducir las √°reas "Conversi√≥n del direccionamiento
Modbus para FC 01, 05, 15", hay solapamiento en las com‚Äê
binaciones "desde/hasta".
(√Årea marcas, salidas, temporizadores, contadores).
El driver no est√° listo.

0E28

Corrija la parametrizaci√≥n del driver.
Al introducir las √°reas "Conversi√≥n del direccionamiento
Modbus para FC 02", hay solapamiento en las combinacio‚Äê
nes "desde/hasta".
(√Årea marcas, entradas).
El driver no est√° listo.

0E2E

Se ha producido un error al leer el archivo de los par√°metros
de interfaz.
El driver no est√° preparado para entrar en funcionamiento.

Rearranque del m√≥dulo de comunicaci√≥n (Po‚Äê
wer ON).

0E30

Error interno de la transferencia a la CPU:
Confirmaci√≥n inesperada pasiva.

Puede ignorarse si s√≥lo aparece de manera es‚Äê
por√°dica.

0E31

Time out al transferir datos a la CPU

Comprobar la interfaz CP-CPU.

1876

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

0E32

Error al transferir datos con RCV a la CPU:
analizar causa - El error en detalle se encuentra en
SYSTAT, antes de esta entrada.

Comprobar la interfaz CP-CPU.

0E33

Error interno de la transferencia de datos a la CPU:
Estado del aut√≥mata no permitido

Comprobar la interfaz CP-CPU.

:
0E38

Compruebe que existe el √°rea SIMATIC llamada
Se ha producido un error al acceder a una de las √°reas
SIMATIC "marcador, salida, temporizador, contador, entra‚Äê y que no se ha intentado acceder m√°s all√° del
final del √°rea.
da" con el c√≥digo de funci√≥n FC 01 o FC 02:
P. ej.: No existe esa entrada, o se ha intentado leer m√°s all√°
del final del √°rea.

0E39

Se ha producido un error al acceder al √°rea SIMATIC "Blo‚Äê Compruebe que el bloque de datos llamado
que de datos" con el c√≥digo de funci√≥n FC 03, 04, 06, 16: existe y que es suficientemente largo.
El bloque de datos no existe o es demasiado corto.

0E3A

Se ha producido un error al ejecutar la petici√≥n de escritura
con el c√≥digo de funci√≥n FC 05,15:
El bloque de datos de instancia de la instrucci√≥n Modbus no
existe o es demasiado corto.

Compruebe que el DB de instancia parametriza‚Äê
do en la instrucci√≥n de comunicaci√≥n Modbus
existe y que es suficientemente largo.

0E3B

TimeOut (espera de acuse) en la ejecuci√≥n de una petici√≥n
de escritura por la instrucci√≥n de comunicaci√≥n Modbus.

Comprobar la configuraci√≥n de conexiones y la
interfaz CP-CPU (BSEND) y, en caso necesario,
volver a cargar la instrucci√≥n de comunicaci√≥n
Modbus.

0E3C

Petici√≥n no permitida en este driver.

S√≥lo se permiten SEND, RCV, STATUS (s√≥lo
con CP 441-2)

0E40

Se ha introducido un valor demasiado peque√±o para el pa‚Äê La longitud m√≠nima es de 2 bytes.
r√°metro LEN en la instrucci√≥n SEND.

0E41

Se ha introducido un valor demasiado peque√±o para el pa‚Äê La longitud m√≠nima en este c√≥digo de funci√≥n es
r√°metro LEN en la instrucci√≥n SEND. Se necesita una ma‚Äê de 6 bytes.
yor longitud para el c√≥digo de funci√≥n transferido.

0E42

No se permite el c√≥digo de funci√≥n transferido.

S√≥lo se permiten los c√≥digos de funci√≥n inclui‚Äê
dos en el cap√≠tulo " C√≥digos de funci√≥n (P√°gi‚Äê
na 1832) ".

0E43

No se permite la direcci√≥n del esclavo 0 (= Broadcast) en
este c√≥digo de funci√≥n.

Utilice una direcci√≥n del esclavo 0 s√≥lo en los
c√≥digos de funci√≥n adecuados para ello.

0E44

El valor del par√°metro transferido "N√∫mero de bits" no se
encuentra en el √°rea 1... 2040.

El par√°metro "N√∫mero de bits" debe encontrarse
en el √°rea 1 ... 2040.

0E45

El valor del par√°metro transferido "N√∫mero de registro" no
se encuentra en el √°rea 1... 127.

El par√°metro "N√∫mero de registro" debe encon‚Äê
trarse en el √°rea 1 ... 127.

0E46

C√≥digo de funci√≥n 15 √≥ 16:
el valor del par√°metro transferido "N√∫mero de bits " o "N√∫‚Äê
mero de registro" no se encuentra en el √°rea 1 ... 2040 ni en
la 1 ... 127.

El par√°metro "N√∫mero de bits" o el par√°metro
"N√∫mero de registro" debe encontrarse en el
√°rea 1 ... 2040 √≥ 1 ... 127.

0E47

C√≥digo de funci√≥n 15 √≥ 16:
el par√°metro LEN de la instrucci√≥n SEND no se correspon‚Äê
de con el par√°metro transferido "N√∫mero de bits" ni "N√∫me‚Äê
ro de registro".
El par√°metro LEN es demasiado bajo.

Aumente el par√°metro LEN en SEND hasta que
se transfiera un n√∫mero suficiente de datos √∫ti‚Äê
les al m√≥dulo de comunicaci√≥n.
Debido al "N√∫mero de bits" o al "N√∫mero de re‚Äê
gistro" debe transferirse un mayor n√∫mero de
datos √∫tiles al m√≥dulo de comunicaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1877

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

0E48

C√≥digo de funci√≥n 05:
la codificaci√≥n dada en DB de origen SEND para "Activar
bit" (FF00H) o "Borrar bit" (0000H) es err√≥nea.

S√≥lo se permiten las codificaciones FF00H y
0000H.

0E49

C√≥digo de funci√≥n 08:
El "C√≥digo de diagn√≥stico" dado en DB de origen SEND es
err√≥neo.

S√≥lo se permite el "C√≥digo de diagn√≥stico "
0000H.

0E50

En las √°reas de SIMATIC de temporizadores/contadores
orientadas a palabras, el n√∫mero de bits sobrante de la di‚Äê
recci√≥n Modbus ‚â† 0.

Utilizar solo direcciones Modbus que den como
resultado n√∫meros de bits v√°lidos.

0E51

La direcci√≥n Modbus recibida queda fuera de las √°reas pa‚Äê Utilizar en el telegrama de solicitud solo direc‚Äê
rametrizadas "desde/hasta".
ciones ya definidas en la parametrizaci√≥n.

0E52

‚óè Se ha rebasado un l√≠mite de √°rea SIMATIC en un intento
de acceso del sistema maestro Modbus:
N√∫mero de DB resultante < 1

Limitar las √°reas de acceso a √°reas de memoria
SIMATIC v√°lidas.

‚óè Acceso de escritura en un √°rea no autorizada
(parametrizaci√≥n)
‚óè Acceso de escritura al DB de instancia de la instrucci√≥n
de comunicaci√≥n
0E53

Se ha rebasado un l√≠mite de √°rea SIMATIC en un intento de
acceso por parte del sistema maestro Modbus:
P. ej.: Desbordamiento en el c√°lculo del n√∫mero de DB re‚Äê
sultante (> 65535)

Limitar las √°reas de acceso a √°reas de memoria
SIMATIC v√°lidas.

0E54

Acceso m√°s all√° del final del √°rea parametrizada o acceso
m√°s all√° del final del √°rea SIMATIC.

Limitar las √°reas de acceso a √°reas de memoria
SIMATIC v√°lidas.

0E55

No se permite el acceso de escritura en esta √°rea de me‚Äê
moria SIMATIC.

Efectuar accesos de escritura solo en las √°reas
de datos SIMATIC de marcas y salidas.

0E56

No es posible el funcionamiento del acoplamiento, ya que la
instrucci√≥n de comunicaci√≥n no funciona.

Llame la instrucci√≥n de comunicaci√≥n Modbus
c√≠clicamente en el programa de usuario STEP 7.
En caso necesario, vuelva a inicializar la instruc‚Äê
ci√≥n de comunicaci√≥n.

0E57

Al procesar el c√≥digo de funci√≥n Modbus se ha producido un
error en la instrucci√≥n de comunicaci√≥n.

Analice la cause exacta.

0E4A

La longitud de este c√≥digo de funci√≥n supera la longitud
m√°xima.

En el manual encontrar√° los valores de longitud
m√°xima para cada c√≥digo de funci√≥n.

0E4F

CP 441:
La R_ID indicada en la instrucci√≥n SEND no se permite en
este driver.

S√≥lo pueden utilizarse las R_ID 0 ... 255
(00 00 00 00 ... 00 00 00 FFH).

CP 341:
El R_TYP indicado en la instrucci√≥n SEND_RK no se per‚Äê
mite en este driver.

Debe introducirse "X" como R_TYP.

Direcci√≥n del esclavo err√≥nea:
la direcci√≥n del esclavo no es igual a la direcci√≥n del esclavo
enviada.

Ha respondido un esclavo equivocado.

C√≥digo de funci√≥n err√≥neo:
el c√≥digo de funci√≥n recibido en el telegrama de reacci√≥n no
es igual al c√≥digo de funci√≥n enviado.

Compruebe el equipo esclavo.

0E50

0E51

1878

Compruebe si la l√≠nea de transferencia se ha
visto afectada por alg√∫n problema (de ser nece‚Äê
sario, utilizar el analizador de interfaz).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

0E52

Flujo insuficiente de bytes:
se han recibido menos caracteres de los generados por el
contador de bytes del telegrama de reacci√≥n o de los que se
esperaban en este c√≥digo de funci√≥n.

Compruebe el equipo esclavo.

0E53

Flujo excesivo de bytes:
se han recibido m√°s caracteres de los generados por el
contador de bytes del telegrama de reacci√≥n o de los que se
esperaban en este c√≥digo de funci√≥n.

Compruebe el equipo esclavo.

0E54

Contador de bytes demasiado peque√±o:
el contador de bytes recibido en el telegrama de reacci√≥n es
demasiado peque√±o.

Compruebe el equipo esclavo.

0E55

Contador de bytes err√≥neo:
el contador de bytes recibido en el telegrama de reacci√≥n es
err√≥neo.

Compruebe el equipo esclavo.

0E56

Eco err√≥neo:
los datos del telegrama de reacci√≥n repetidos por el esclavo
(n√∫mero de bits, etc.) no son iguales a los datos enviados en
el telegrama de solicitud.

Compruebe el equipo esclavo.

0E57

Error en la comprobaci√≥n CRC:
se ha detectado un fallo en la comprobaci√≥n de la suma de
verificaci√≥n CRC16 del telegrama de reacci√≥n del esclavo.

Compruebe el equipo esclavo.

0E61

telegrama de reacci√≥n con Exception Code 01:
Illegal function

Ve√°se "Manual del equipo esclavo"

0E62

telegrama de reacci√≥n con Exception Code 02:
Illegal data address

Ve√°se "Manual del equipo esclavo"

0E63

telegrama de reacci√≥n con Exception Code 03:
Illegal data value

Ve√°se "Manual del equipo esclavo"

0E64

telegrama de reacci√≥n con Exception Code 04:
Failure in associated device

Ve√°se "Manual del equipo esclavo"

0E65

telegrama de reacci√≥n con Exception Code 05:
Acknowledge

Ve√°se "Manual del equipo esclavo"

0E66

telegrama de reacci√≥n con Exception Code 06:
Busy, Rejected message

Ve√°se "Manual del equipo esclavo"

0E67

telegrama de reacci√≥n con Exception Code 07:
Negative Acknowledgement

Ve√°se "Manual del equipo esclavo"

1E0D

"Cancelaci√≥n de petici√≥n por rearranque, rearranque com‚Äê
pleto o inicializaci√≥n"

1E0E

Error est√°tico en la llamada de la instrucci√≥n DP_RDDAT. El Cargue la variable SFCERR del DB de instancia.
valor de respuesta RET_VAL de la instrucci√≥n se deposita
en la variable SFCERR del DB de instancia para su evalua‚Äê
ci√≥n.

1E0F

Error est√°tico en la llamada de la instrucci√≥n DP_WRDAT.
El valor de respuesta RET_VAL de la instrucci√≥n se depo‚Äê
sita en la variable SFCERR del DB de instancia para su
evaluaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Cargue la variable SFCERR del DB de instancia.

1879

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
C√≥digo de
error(W#16
#...)

Descripci√≥n

Soluci√≥n

1E10

Error est√°tico en la llamada de la instrucci√≥n RD_LGADR. El Cargue la variable SFCERR del DB de instancia.
valor de respuesta RET_VAL de la instrucci√≥n se deposita
en la variable SFCERR del DB de instancia para su evalua‚Äê
ci√≥n.

1E11

Error est√°tico en la llamada de la instrucci√≥n RDSYSST. El Cargue la variable SFCERR del DB de instancia.
valor de respuesta RET_VAL de la instrucci√≥n se deposita
en la variable SFCERR del DB de instancia para su evalua‚Äê
ci√≥n.

1E20

Par√°metro fuera de rango

Indique un par√°metro dentro del rango permitido
para el bloque de funci√≥n.

1E41

El n√∫mero de bytes indicado en el par√°metro LEN de la
instrucci√≥n no es admisible.

Respete el rango de entre 1 y 256 bytes.

Comunicaci√≥n USS
Resumen de la comunicaci√≥n USS
Clasificaci√≥n dentro del entorno del sistema
La siguiente descripci√≥n USS se refiere al uso del m√≥dulo ET 200S 1SI en la variante Modbus/
USS.

Introducci√≥n
El protocolo USS es un protocolo sencillo de transferencia de datos serie, que est√° adaptado
a las necesidades de la tecnolog√≠a de accionamientos.
El protocolo USS define una t√©cnica de acceso de acuerdo con el principio maestroesclavo
para la comunicaci√≥n a trav√©s de un bus serie. Es posible conectar al bus un maestro y un
m√°ximo de 31 esclavos. Maestros y esclavos forman una red USS. Los datos intercambiados
entre maestro y esclavos se denominan datos de red. El bloque de datos de red contiene los
datos de red del maestro. El maestro selecciona los diferentes esclavos en el telegrama con
la ayuda de un car√°cter de direcci√≥n. Un esclavo no puede enviar nunca sin que el maestro lo
haya activado antes. Esto significa que no es posible una transferencia de datos directa entre
esclavos. La comunicaci√≥n funciona en modo semid√∫plex. La funci√≥n del maestro no puede
transferirse. El sistema USS s√≥lo dispone de un maestro.

Estructura de telegrama
Cada telegrama empieza con un car√°cter de inicio (STX), seguido de la informaci√≥n sobre la
longitud (LGE) y el byte de direcci√≥n (ADR). A continuaci√≥n sigue el campo de datos. El
telegrama finaliza con el car√°cter de comprobaci√≥n de bloque (BCC).
STX

1880

LGE

ADR

1

2

...

N

BCC

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En el caso de datos de un bloque de datos de red compuestos por una palabra (16 bits),
primero se env√≠a el byte High y despu√©s el byte Low. En el caso de datos de palabras dobles,
primero se env√≠a la palabra High y, a continuaci√≥n, la palabra Low.
El protocolo no identifica ninguna tarea en los campos de datos.

Codificaci√≥n de datos
Los datos se codifican del modo siguiente:
‚óè STX: 1 byte, inicio de texto, 02H
‚óè LGE: 1 byte, contiene la longitud de telegrama como n√∫mero binario
‚óè ADR: 1 byte, contiene la direcci√≥n del esclavo y el tipo de telegrama en c√≥digo binario
‚óè Campos de datos: Un byte cada uno, el contenido depende de la tarea
‚óè BCC: 1 byte, car√°cter de comprobaci√≥n de bloque

Procedimiento de transmisi√≥n de datos
El maestro se ocupa de la transferencia de datos c√≠clica en telegramas. El maestro direcciona
sucesivamente todas las estaciones esclavo con un telegrama de tarea. Las estaciones en
cuesti√≥n responden con un telegrama de respuesta. De acuerdo con el procedimiento maestro‚Äê
esclavo, el esclavo debe enviar el telegrama de respuesta al maestro despu√©s de haber
recibido el telegrama de tarea. S√≥lo entonces el maestro puede comunicarse con el siguiente
esclavo.

Estructura general del bloque de datos de red
El bloque de datos de red est√° dividido en dos secciones: Par√°metros (PKW) y datos de
proceso (PZD).
STX

LGE

ADR

Par√°metros (PKW)

Datos de proceso (PZD)

BCC

‚óè √Årea de par√°metros (PKW)
El √°rea PKW gestiona la transferencia de par√°metros entre dos interlocutores (p. ej.
aut√≥mata y accionamiento). Esto incluye, por ejemplo, leer y escribir valores de par√°metros
as√≠ como leer descripciones de par√°metros y el texto correspondiente. La interfaz de PKW
suele contener tareas para manejo e indicadores, mantenimiento y diagn√≥stico.
‚óè √Årea de datos de proceso (PZD)
El √°rea PZD incluye se√±ales necesarias para la automatizaci√≥n:
‚Äì Palabras de control y valores consigna del maestro al esclavo
‚Äì Palabras de estado y valores reales del esclavo al maestro
Los accionamientos esclavos definen el contenido del √°rea de par√°metros y del √°rea de
datos de proceso. Encontrar√° m√°s informaci√≥n al respecto en la documentaci√≥n del
accionamiento.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1881

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Maestro USS
Sinopsis de funciones
Procedimiento de transmisi√≥n de datos de red
Las instrucciones procesan c√≠clicamente la transferencia de datos de red con un m√°ximo de 31
accionamientos esclavos de acuerdo con el orden indicado en la lista de sondeo (DB de
parametrizaci√≥n). Cada esclavo s√≥lo tiene una petici√≥n activa. El usuario guarda los datos de
red para cada esclavo en un bloque de datos (bloque de datos de red) y los llama desde all√≠.
Se transfieren al procesador de comunicaciones a trav√©s de otra √°rea de datos (DB de
procesador de comunicaciones) de acuerdo con la definici√≥n de programa en la lista de sondeo
y se llaman desde all√≠.
Para este procedimiento se requieren dos llamadas de funciones (una instrucci√≥n de env√≠o y
una de recepci√≥n). Una tercera funci√≥n soporta la creaci√≥n y la asignaci√≥n de valores
predeterminados de los bloques de datos necesarios para la comunicaci√≥n.
Caracter√≠sticas y prestaciones:
‚óè Creaci√≥n de √°reas de datos para la comunicaci√≥n seg√∫n la configuraci√≥n de bus
‚óè Valores predeterminados de la lista de sondeo
‚óè Estructura de telegramas de acuerdo con la especificaci√≥n USS
‚óè El intercambio de datos de red puede parametrizarse de acuerdo con la estructura
necesaria de datos de red
‚óè Ejecuci√≥n y supervisi√≥n de peticiones de PKW
‚óè Gesti√≥n de informes sobre modificaci√≥n de par√°metros
‚óè Supervisi√≥n de todo el sistema y eliminaci√≥n de fallos
Pueden usarse diferentes estructuras de datos de red para enviar datos de red. Es decir, que
el contenido de los datos de red se puede seleccionar seg√∫n la aplicaci√≥n.
Seg√∫n sea la estructura seleccionada, los datos de red disponen de un √°rea PZD para los
datos de proceso y de un √°rea PKW para el procesamiento de par√°metros.
En el √°rea PKW, el maestro puede leer y escribir los valores de par√°metros y el esclavo puede
visualizar modificaciones de par√°metros mediante los informes correspondientes.
El √°rea PZD contiene las se√±ales necesarias para el control de procesos, p. ej. palabras de
control, el valor consigna del maestro al esclavo, as√≠ como palabras de estado y valores reales
del esclavo al maestro.
El orden correcto de las llamadas de instrucciones es: S_USST, S_SEND, S_RCV, S_USSR.
Esto es importante porque las salidas de las instrucciones S_SEND y S_RCV s√≥lo son v√°lidas
en el ciclo actual del sistema de automatizaci√≥n.
La figura siguiente muestra el intercambio de datos entre el programa de usuario y el esclavo
USS.

1882

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

3URJUDPDGHXVXDULR 2%HWF

'DWRVDHVFODYR

'DWRVGHHVFODYR

'%GHGDWRVGHUHG

68667



-XHJRGH
SDU¬£PHWURV
'%



68665



'%GHSURFHVDGRUGHFRPXQLFDFLRQHV

66(1'

65(&9

(766,
0RGEXV866
0¬µGXOR

(V
FODYR
866

Figura 1-108

Intercambio de datos entre el programa de usuario y el esclavo USS

Informaci√≥n adicional
Encontrar√° informaci√≥n sobre los bloques de datos utilizados en:
‚óè AUTOHOTSPOT
‚óè AUTOHOTSPOT
‚óè AUTOHOTSPOT

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1883

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Arranque y diagn√≥stico
Comportamiento de arranque
Comportamiento de arranque
El arranque del m√≥dulo de comunicaci√≥n se divide en las siguientes fases:
‚óè Inicializaci√≥n (POWER ON del m√≥dulo de comunicaci√≥n)
‚óè Parametrizaci√≥n

Inicializaci√≥n
En cuanto el m√≥dulo de comunicaci√≥n recibe tensi√≥n, tras la ejecuci√≥n de un programa de test
de hardware se prepara el firmware en el m√≥dulo de comunicaci√≥n para el servicio.

Parametrizaci√≥n
Durante la parametrizaci√≥n, el m√≥dulo de comunicaci√≥n recibe los par√°metros del m√≥dulo
asignados al slot actual. El m√≥dulo de comunicaci√≥n ya est√° listo para el servicio.

Transiciones de estado operativo
Tras el arranque del m√≥dulo de comunicaci√≥n se intercambian todos los datos entre la CPU y
el m√≥dulo de comunicaci√≥n a trav√©s de instrucciones. La respuesta a la transici√≥n de estado
operativo del m√≥dulo de comunicaci√≥n depende del estado operativo de la CPU.
STOP de la CPU

Si hay un intercambio de datos entre m√≥dulo de comunicaci√≥n y
CPU se interrumpe, ya sea una petici√≥n de env√≠o o de recepci√≥n, y
el enlace se reinicia.
RUN de la CPU
En el estado RUN de la CPU es posible el intercambio de datos
ilimitado, ya sea env√≠o o recepci√≥n. En las primeras ejecuciones de
instrucci√≥n tras rearranque de la CPU se sincronizan el m√≥dulo de
comunicaci√≥n y la instrucci√≥n en cuesti√≥n.
Rearranque de la CPU En caso de rearranque de la CPU, las peticiones de la CPU se
inicializan, de modo que todas las peticiones en curso entre la CPU
y el m√≥dulo de comunicaci√≥n se interrumpen autom√°ticamente.
Rearranque completo En caso de rearranque completo de la CPU, las peticiones se siguen
de la CPU
procesando.
Con la parametrizaci√≥n correspondiente en el cuadro de di√°logo de
propiedades del m√≥dulo se puede borrar autom√°ticamente el b√∫fer
de recepci√≥n del m√≥dulo de comunicaci√≥n en el arranque de la CPU.

1884

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Funciones de diagn√≥stico
Introducci√≥n
Las funciones de diagn√≥stico del m√≥dulo de comunicaci√≥n permiten localizar los errores
ocurridos con rapidez. Para ello existen varias posibilidades de diagn√≥stico:
Diagn√≥stico a trav√©s de los elementos
de indicaci√≥n del m√≥dulo de comunica‚Äê
ci√≥n

Los elementos de indicaci√≥n informan sobre el estado operativo o posibles esta‚Äê
dos de error del m√≥dulo de comunicaci√≥n. Los elementos de indicaci√≥n propor‚Äê
cionan una primera vista general sobre los errores internos y externos ocurridos,
as√≠ como los errores espec√≠ficos de interfaz.

Diagn√≥stico a trav√©s de la salida STA‚Äê
TUS de las instrucciones

Las instrucciones disponen de una salida STATUS destinada al diagn√≥stico, que
proporciona informaci√≥n sobre errores de comunicaci√≥n entre el m√≥dulo de co‚Äê
municaci√≥n y la CPU. El par√°metro STATUS se puede evaluar en el programa de
usuario.

Diagn√≥stico a trav√©s del √°rea de registro
de errores SYSTAT 1)

Mediante la programaci√≥n de la instrucci√≥n STATUS en el programa de usuario se
puede consultar el estado de la interfaz. Leyendo SYSTAT se obtiene informaci√≥n
detallada sobre errores/eventos ocurridos durante la comunicaci√≥n entre el m√≥‚Äê
dulo de comunicaci√≥n y la CPU correspondiente y el interlocutor acoplado a esa
interfaz.

Diagn√≥stico sobre los n√∫meros de error
en el telegrama de respuesta

Si se trabaja con el protocolo para mainframe RK512 y se produce un error en un
telegrama SEND o FETCH en el interlocutor, √©ste env√≠a un telegrama de res‚Äê
puesta con un n√∫mero de error en el 4¬∫ byte.

Diagn√≥stico a trav√©s del b√∫fer de diag‚Äê
n√≥stico del m√≥dulo de comunicaci√≥n

Todos los errores/eventos tambi√©n se registran en el b√∫fer de diagn√≥stico 2) del
m√≥dulo de comunicaci√≥n.
Igual que ocurre con el b√∫fer de diagn√≥stico de la CPU, la informaci√≥n del b√∫fer de
diagn√≥stico del CP relevante para el usuario tambi√©n puede leerse en texto claro
y comprensible.

Alarma de diagn√≥stico

El m√≥dulo de comunicaci√≥n puede lanzar una alarma de diagn√≥stico en la CPU
asignada a √©l. El m√≥dulo de comunicaci√≥n pone a disposici√≥n 4 bytes de infor‚Äê
maci√≥n de diagn√≥stico. Dicha informaci√≥n se eval√∫a a trav√©s del programa de
usuario o leyendo el b√∫fer de diagn√≥stico de la CPU.

1)

Solo CP 441-1 y CP 441-2

2)

El CP 340, los m√≥dulos ET 200S 1SI y la CPU31xC-2 PtP no tienen b√∫fer de diagn√≥stico

1.4.6

TeleControl

1.4.6.1

Configuraci√≥n de m√≥dulos de Telecontrol

Configuraci√≥n
Tipos de comunicaci√≥n
En este grupo de par√°metros se activan los tipos de comunicaci√≥n que se deseen utilizar para
el m√≥dulo correspondiente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1885

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para minimizar el riesgo de accesos no autorizados a la estaci√≥n, deber√° activar
individualmente los servicios de comunicaci√≥n que desee utilizar con el m√≥dulo.
Se pueden dejar desactivadas todas las opciones si no se necesitan, por ejemplo si un CP solo
se utiliza para enviar SMS o para la Open User Communication.

1886

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Grupo de par√°metros "Tipos de comunicaci√≥n"
‚óè Activar la comunicaci√≥n por Telecontrol
Habilita en el m√≥dulo la comunicaci√≥n por Telecontrol.
Nota
Plena funcionalidad de Telecontrol solo con funciones de seguridad activadas
Para las siguientes funciones deben activarse las funciones de seguridad:
‚óè Env√≠o de mensajes de correo electr√≥nico a trav√©s de la funcionalidad Telecontrol
‚óè Uso del protocolo "TeleControl Basic" (general)
‚óè Uso de las funciones de seguridad DNP3
‚óè Uso de certificados
Nota
P√©rdida de datos de configuraci√≥n al cambiar el protocolo Telecontrol
Si cambia el protocolo en un m√≥dulo configurado, se perder√°n los datos de configuraci√≥n
espec√≠ficos del protocolo. Son los siguientes, entre otros:
‚óè Configuraci√≥n del interlocutor
‚óè Configuraci√≥n de puntos de datos
‚óè Mensajes configurados (correos electr√≥nicos, SMS)
‚óè Sincronizaci√≥n horaria configurada
‚óè Interlocutores VPN configurados
En funci√≥n del tipo de m√≥dulo pueden utilizarse los protocolos siguientes:
‚Äì TeleControl Basic *
Activa la comunicaci√≥n con el servidor de Telecontrol.
‚Äì ST7
Activa la comunicaci√≥n con un sistema de control compatible con el protocolo ST7.
‚Äì DNP3 *
Activa la comunicaci√≥n con hasta cuatro maestros DNP3.
‚Äì IEC 60870‚Äë5‚Äë104 *
Activa la comunicaci√≥n con hasta cuatro maestros IEC.
* Consulte la comunicaci√≥n por Telecontrol a trav√©s de SINEMA Remote Connect en el
apartado siguiente.
Respecto a la configuraci√≥n de las conexiones de Telecontrol para los protocolos ST7,
DNP3 e IEC, consulte el cap√≠tulo AUTOHOTSPOT.
La descripci√≥n de par√°metros y funciones importantes de los protocolos de Telecontrol est√°
recogida en el cap√≠tulo AUTOHOTSPOT.
‚óè Activar funciones online
Habilita el acceso a la CPU en el m√≥dulo para las funciones online (diagn√≥stico, carga de
datos de proyecto, etc.). Si esta funci√≥n est√° activada, la estaci√≥n de ingenier√≠a puede
acceder a la CPU a trav√©s del m√≥dulo.
Si la opci√≥n est√° desactivada, no es posible acceder a la CPU a trav√©s del m√≥dulo con las
funciones online. De todas formas, sigue siendo posible realizar un diagn√≥stico online de la
CPU con conexi√≥n directa a la interfaz de la CPU.
‚óè Activar comunicaci√≥n S7

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1887

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Habilita las funciones de la comunicaci√≥n S7 con la CPU SIMATIC asignada y el routing S7.
Active esta opci√≥n si configura conexiones S7 con la estaci√≥n en cuesti√≥n que pasan por el
m√≥dulo.
Los siguientes m√≥dulos soportan el routing S7:
‚Äì CP 1243‚Äë1, CP 124x‚Äë7, CP 1243‚Äë8
A partir del firmware V2.1 del CP con CPU ‚â• V4.2
‚Äì CP 1542SP‚Äë1, CP 1542SP‚Äë1 IRC, CP 1543SP‚Äë1
A partir del firmware V1.0 del CP con CPU ‚â• V2.0

Telemantenimiento con SINEMA Remote Connect (SINEMA RC)
La aplicaci√≥n "SINEMA Remote Connect" (SINEMA RC) sirve para fines de telemantenimiento.
SINEMA RC utiliza OpenVPN para el cifrado de datos. El centro de la comunicaci√≥n es el
servidor SINEMA RC, por el que transcurre la comunicaci√≥n entre los dispositivos y que
administra la configuraci√≥n del sistema de comunicaci√≥n.
M√≥dulos y protocolos de Telecontrol utilizables
Los siguientes CP soportan la comunicaci√≥n a trav√©s de SINEMA RC:
‚óè CP 1243‚Äë1, CP 1243‚Äë7, CP 1243‚Äë8
Firmware V3.1 o superior
‚óè CP 1542SP‚Äë1 IRC, CP 1543SP‚Äë1
Firmware V2.0 o superior
Los CP Telecontrol con capacidad VPN tambi√©n pueden realizar la comunicaci√≥n por
Telecontrol a trav√©s del servidor SINEMA RC. Los siguientes protocolos de Telecontrol
soportan la comunicaci√≥n a trav√©s de SINEMA RC:
‚óè TeleControl Basic
‚óè DNP3
‚óè IEC 60870‚Äë5‚Äë104
Aplicaciones y configuraci√≥n
Para el uso de SINEMA Remote Connect y la comunicaci√≥n por Telecontrol v√≠a SINEMA RC
realice los siguientes ajustes:
1. Comunicaci√≥n v√≠a SINEMA RC: grupo de par√°metros "Seguridad > VPN"
Active VPN para que se visualicen los dem√°s par√°metros.
2. Comunicaci√≥n por Telecontrol v√≠a SINEMA RC: grupo de par√°metros "Tipos de
comunicaci√≥n"
La comunicaci√≥n v√≠a SINEMA RC debe haberse activado antes.
La combinaci√≥n entre la comunicaci√≥n por Telecontrol y el uso de SINEMA RC hace posible
los siguientes usos:
‚óè (1) No se utiliza la comunicaci√≥n por Telecontrol ni ning√∫n SINEMA RC - CP solo para
separar redes.
‚óè (2) CP solo para telemantenimiento v√≠a SINEMA RC
‚óè (3) CP solo para comunicaci√≥n por Telecontrol

1888

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè (4) El CP utiliza la comunicaci√≥n por Telecontrol, pero SINEMA RC solo para
telemantenimiento.
‚óè (5) El CP utiliza SINEMA RC para la comunicaci√≥n por Telecontrol y el telemantenimiento.
La tabla proporciona una sinopsis de las posibles aplicaciones con los ajustes de par√°metros.
Tabla 1-136 Casos de aplicaci√≥n y par√°metros que deben activarse
Ajustes de par√°metros *
Caso de aplicaci√≥n

(par√°metro abreviado)
SRC

TC

TC + SRC

Desactivado

Desactivado

Desactivado

(2)

Activado

Desactivado

Desactivado

(3)

Desactivado

Activado

Desactivado

(4)

Activado

Activado

Desactivado

(5)

Activado

Activado

Activado

(1)

* Explicaci√≥n de las abreviaturas de los par√°metros:
SRC ‚Äë Security > VPN (activado) > "Tipo de conexi√≥n VPN":
"Configuraci√≥n OpenVPN autom√°tica a trav√©s de SINEMA Remote Connect Server"
TC ‚Äë Tipos de comunicaci√≥n > Comunicaci√≥n por Telecontrol activada
TC + SRC ‚Äë Tipos de comunicaci√≥n >
"Activar la comunicaci√≥n de Telecontrol a trav√©s de SINEMA Remote Connect"

Comunicaci√≥n por Telecontrol v√≠a SINEMA Remote Connect
Pasos de configuraci√≥n
Para configurar el CP de forma que pueda utilizar la comunicaci√≥n por Telecontrol v√≠a
SINEMA RC, proceda del siguiente modo:
1. En el grupo de par√°metros "Tipos de comunicaci√≥n" active la comunicaci√≥n por Telecontrol
y seleccione uno de los protocolos citados anteriormente.
La opci√≥n de comunicaci√≥n v√≠a SINEMA RC todav√≠a no es visible.
2. Cambie al grupo de par√°metros "Security" y active las funciones de seguridad.
(En el grupo de par√°metros "Tipos de comunicaci√≥n", la opci√≥n SINEMA RC aparece
desactivada y atenuada.)
3. Abra el grupo de par√°metros "Security > VPN" y active VPN.
4. En el par√°metro "Tipo de conexi√≥n VPN" elija la opci√≥n "Configuraci√≥n OpenVPN
autom√°tica a trav√©s de SINEMA Remote Connect Server" si todav√≠a no est√° seleccionada.
(En el grupo de par√°metros "Tipos de comunicaci√≥n", la opci√≥n SINEMA RC se vuelve
operativa.)
5. Cambie al grupo de par√°metros "Tipos de comunicaci√≥n" y ponga la marca de verificaci√≥n
en la opci√≥n "Activar la comunicaci√≥n de Telecontrol a trav√©s de SINEMA Remote Connect".
Ahora el CP est√° preparado para la comunicaci√≥n por Telecontrol v√≠a SINEMA Remote
Connect.
6. Siga configurando el servidor SINEMA RC en "Security > VPN".
7. Importe el certificado del servidor SINEMA RC en "Security > Administrador de certificados".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1889

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Configuraci√≥n del establecimiento de la conexi√≥n
El establecimiento de la conexi√≥n se configura con el par√°metro "Tipo de conexi√≥n" en el grupo
de par√°metros "Security > VPN > Ajustes opcionales".
‚óè Intervalo de actualizaci√≥n
Mediante este par√°metro se ajusta el intervalo en el que el CP consulta la configuraci√≥n al
servidor SINEMA RC.
Con el ajuste 0 (cero), tenga en cuenta que los cambios en la configuraci√≥n del servidor
SINEMA RC pueden tener como consecuencia que el CP no pueda establecer m√°s
conexiones con el servidor SINEMA RC.
‚óè "Tipo de conexi√≥n"
Las dos opciones del par√°metro tienen la repercusi√≥n siguiente:
‚Äì Permanente
Esta opci√≥n est√° prevista para la comunicaci√≥n continua.
Este caso se da, por ejemplo, en la comunicaci√≥n por Telecontrol v√≠a SINEMA RC. El CP
y su interlocutor de la comunicaci√≥n deben configurarse en el servidor SINEMA RC.
‚Äì Disparo de PLC
Esta opci√≥n est√° prevista para la comunicaci√≥n espor√°dica del CP a trav√©s del servidor
SINEMA RC.
La opci√≥n solo puede utilizarse cuando debe establecerse una conexi√≥n temporal
espor√°dica entre el CP y la estaci√≥n de ingenier√≠a (PC con el proyecto STEP 7 del CP),
por ejemplo para fines de servicio t√©cnico.
‚óè Variable PLC para establecimiento de conexi√≥n
Si est√° seleccionada la opci√≥n "Disparo de PLC", el CP establece una conexi√≥n cuando la
variable PLC adopta el valor 1. Durante el funcionamiento es posible activar la variable PLC
si fuera necesario, por ejemplo desde un panel HMI.
Al poner la variable PLC de nuevo a 0 finaliza la conexi√≥n.

Ajustes b√°sicos
Configuraci√≥n
El grupo de par√°metros solo est√° disponible con algunos m√≥dulos de comunicaci√≥n del
sistema SINAUT ST7.
Consulte los m√≥dulos soportados en el cap√≠tulo Ampliaci√≥n de proyectos SINAUT
(P√°gina 2002).

1890

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuraci√≥n de Telecontrol
Aqu√≠ se especifica el m√©todo de configuraci√≥n de los datos de conexi√≥n del dispositivo y
SINAUT para el m√≥dulo de comunicaci√≥n.
‚óè Configurar
Los datos de configuraci√≥n citados se configuran en los grupos de par√°metros del m√≥dulo
y en el editor de conexiones.
‚óè Importar
Para un m√≥dulo Proxy los datos de configuraci√≥n citados se configuran en STEP 7 V5.
Los datos de configuraci√≥n del m√≥dulo Proxy se importan de STEP 7 V5 a STEP 7
Professional para el m√≥dulo.
Respecto a la importaci√≥n y al volumen de los datos importados consulte el
cap√≠tulo Importar configuraci√≥n del interlocutor (protocolo ST7) (P√°gina 1899).
Nota
Borrar datos de configuraci√≥n
Establezca una de las dos opciones antes de seguir configurando el m√≥dulo.
Si el par√°metro se modifica a posteriori se rechazar√°n todos los datos de configuraci√≥n
realizados hasta el momento.

Sincronizaci√≥n horaria
Sincronizaci√≥n horaria en los CP
Nota
Recomendaci√≥n: Sincronizaci√≥n horaria solo mediante 1 m√≥dulo
Sincronice la hora de la estaci√≥n de una fuente horaria externa con un solo m√≥dulo de la
estaci√≥n, para tener dentro de la estaci√≥n una hora coherente.
Si la CPU adopta la hora del CP, desactive la sincronizaci√≥n horaria de la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1891

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Validez
Las funciones descritas a continuaci√≥n son v√°lidas para:
‚óè S7‚Äë1200
‚Äì CP 1243‚Äë1
‚Äì CP 1242‚Äë7
‚Äì CP 1243‚Äë7 LTE
‚Äì CP 1243‚Äë8
‚óè ET 200SP
‚Äì CP 1542SP‚Äë1
‚Äì CP 1543SP‚Äë1
‚Äì CP 1543SP‚Äë1 IRC

M√©todo de sincronizaci√≥n
Cuando se emplea una fuente horaria externa, la estaci√≥n S7 puede captar la hora actual tanto
a trav√©s de la CPU como a trav√©s de un CP.
En los dispositivos mencionados no se reenv√≠a la hora de la estaci√≥n a la subred.
Sincronizaci√≥n horaria de la CPU
Como procedimiento de sincronizaci√≥n en la CPU solo puede seleccionarse NTP.
Sobre la sincronizaci√≥n horaria de la CPU a trav√©s de un CP, consulte m√°s abajo.

1892

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Sincronizaci√≥n horaria en los CP
Es posible elegir entre los procedimientos de sincronizaci√≥n siguientes para CP:
‚óè NTP
En los CP de Telecontrol, NTP tambi√©n puede emplearse si se ha desactivado la
comunicaci√≥n por Telecontrol. En este caso el CP se usa como interfaz PROFINET
avanzada de la CPU.
La direcci√≥n del servidor NTP tambi√©n puede indicarse como URL, por ejemplo
<ntp.server.com>.
Con las funciones de seguridad activadas, en algunos m√≥dulos tambi√©n puede utilizarse el
procedimiento "NTP (secure)".
‚óè Hora de la CPU
Si en el CP no hay configurada ninguna fuente horaria, se aplican los mecanismos
siguientes.
‚Äì S7‚Äë1200
Si en la CPU est√° activada la opci√≥n "La CPU sincroniza los m√≥dulos del dispositivo" en
"Interfaz PROFINET > Sincronizaci√≥n horaria", todos los CM/CP de la estaci√≥n se
sincronizan con la hora de la CPU.
‚Äì ET 200SP
Si la sincronizaci√≥n horaria del CP est√° desactivada, los CP con versi√≥n de firmware
‚â• V2.1 son sincronizados autom√°ticamente en ciclos de 10 segundos por una CPU con
versi√≥n de firmware ‚â• V2.0.
En los CP con versi√≥n de firmware ‚â§ V2.0, el CP lee una vez durante el arranque la hora
de la CPU, aunque como fuente horaria se haya seleccionado la opci√≥n "Sin fuente
horaria". Entonces la siguiente sincronizaci√≥n horaria depende del m√©todo de
sincronizaci√≥n configurado.
Con los CP de Telecontrol, adicionalmente:
‚óè Hora del interlocutor
Si se ha activado la comunicaci√≥n por Telecontrol y la opci√≥n est√° activada, el CP acepta
la hora del ajuste predeterminado de un interlocutor de la comunicaci√≥n.
‚óè Hora de la CPU (S7‚Äë1200)
El CP acepta la hora de la CPU.
‚óè De estaci√≥n local (ET 200SP)
El CP acepta la hora de la CPU.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1893

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reenv√≠o de la hora del CP a la CPU
Nota
Reenv√≠o de la hora a la CPU
Dependiendo de la versi√≥n de firmware de los m√≥dulos participantes, la hora del CP puede
reenviarse a la CPU de diferentes modos.
‚óè Reenv√≠o opcional de la hora del CP a la CPU a trav√©s de una variable PLC:
‚Äì S7‚Äë1200
‚Äì ET 200SP
‚óè Reenv√≠o de la hora del CP a la CPU a trav√©s del bus de fondo, a partir de las versiones de
firmware mencionadas m√°s abajo:
‚Äì S7‚Äë1200
‚Äì ET 200SP
El reenv√≠o de la hora del CP a la CPU depende de la versi√≥n de firmware del CP y de la CPU.
Tenga en cuenta el comportamiento siguiente.
‚óè Reenv√≠o de la hora del CP a trav√©s de una variable PLC
Esta es la √∫nica posibilidad de reenviar la hora del CP a la CPU en el caso de las versiones
de firmware siguientes:
‚Äì S7‚Äë1200: firmware del CP ‚â§ V2.1.5
‚Äì ET 200SP: firmware del CP ‚â• V2.0
Opcionalmente, con esta versi√≥n de firmware la hora del CP puede ponerse a disposici√≥n
de la CPU a trav√©s de una variable PLC. Si esta variable PLC es le√≠da c√≠clicamente por la
CPU, esta adopta la hora del CP.
La variable PLC se configura en el grupo de par√°metros "Comunicaci√≥n con la CPU" del CP.
‚óè Reenv√≠o de la hora del CP a trav√©s del bus de fondo
La hora del CP se reenv√≠a autom√°ticamente a la CPU si en el CP se ha configurado un
m√©todo de sincronizaci√≥n y el CP y la CPU tienen una de las versiones de firmware
siguientes:
‚Äì S7‚Äë1200: firmware del CP ‚â• V2.1.7 y firmware de la CPU ‚â• V4.2
‚Äì ET 200SP: firmware del CP ‚â• V2.1 y firmware de la CPU ‚â• V2.0
Puesto que la CPU adopta autom√°ticamente la hora del CP, con estas versiones de
firmware ya no se requiere la opci√≥n de reenv√≠o a trav√©s de la variable PLC.

Sincronizaci√≥n horaria por NTP
Procedimiento NTP
Con el procedimiento NTP, el m√≥dulo env√≠a regularmente consultas de hora a uno o m√°s
servidores NTP. El m√≥dulo selecciona la hora m√°s exacta seg√∫n las respuestas del servidor.
La ventaja de este procedimiento es la posibilidad de sincronizar la hora m√°s all√° de los l√≠mites
de la subred.

1894

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
NTP utiliza normalmente UTC (Universal Time Coordinated), que equivale a la hora GMT
(Greenwich Mean Time).

Servidores NTP e intervalo de sincronizaci√≥n
Debe configurarse la direcci√≥n IP como m√≠nimo de un servidor NTP.
El intervalo de sincronizaci√≥n define el ciclo de las consultas de hora en el servidor NTP. En
funci√≥n del m√≥dulo seleccionado, el ciclo puede seleccionarse en una lista desplegable o
dentro del rango de valores comprendido entre 10 segundos y 1 d√≠a (86400 segundos).

Opci√≥n "Aceptar tiempo de servidores NTP no sincronizados"
Si el m√≥dulo seleccionado es compatible con la opci√≥n, se aplica el comportamiento siguiente:
‚óè Activado
El m√≥dulo tambi√©n toma la hora de servidores NTP no sincronizados con estrato ‚â• 15.
‚óè Desactivado
Si el m√≥dulo recibe un telegrama de hora de un servidor NTP no sincronizado con estrato
‚â• 15, no se ajustar√° la hora de forma correspondiente.

Interfaz Ethernet
Retardo al establecer la conexi√≥n
Nota
Si el interlocutor no est√° disponible, el establecimiento de la conexi√≥n a trav√©s de la red de
telefon√≠a m√≥vil puede tardar varios minutos. Esto puede depender de la red correspondiente
y de la carga de red en ese momento.
Dependiendo del contrato, el intento de conexi√≥n puede estar ligado a costes.

Par√°metro "Retardo al establecer la conexi√≥n"
El retardo al establecer la conexi√≥n es, para conexiones de la comunicaci√≥n de Telecontrol, el
tiempo de espera entre los intentos repetidos de establecer una conexi√≥n del CP cuando el
servidor de Telecontrol no est√° accesible o se ha interrumpido la conexi√≥n. Este tiempo de
espera sirve para evitar que se intente establecer continuamente una conexi√≥n en intervalos
muy cortos en el caso de problemas de conexi√≥n.
Se configura un valor b√°sico para el tiempo de espera hasta el siguiente intento de
establecimiento de conexi√≥n. Empezando por el valor b√°sico, el tiempo de espera actual se
duplica cada 3 intentos infructuosos hasta llegar a un valor m√°ximo de 900 s. Rango de valores
para el valor b√°sico: 10 .. 300 s

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1895

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Ejemplo: el valor b√°sico 20 da como resultado los intervalos siguientes (tiempos de espera)
entre los intentos de volver a establecer una conexi√≥n:
‚óè tres veces 20 s
‚óè tres veces 40 s
‚óè tres veces 80 s
‚óè etc. hasta m√°x. 900 s
Nota
Particularidad del CP 1242‚Äë7 (6GK7242‚Äë7KX30‚Äë0XE0) en combinaci√≥n con TELECONTROL
SERVER BASIC (V2)
Si se ha configurado un segundo servidor de Telecontrol o un segundo router del servidor de
Telecontrol, en el 4.¬∫. intento el CP tratar√° de conectarse con el segundo interlocutor. Si
tampoco puede conectarse al segundo interlocutor, el CP intenta en el 7.¬∫ intento volver a
conectarse con el primer interlocutor, y as√≠ sucesivamente.

Interfaz serie
Activaci√≥n de la interfaz serial del CP 1243-8 IRC (V3) para el protocolo ST7
Interfaz serie del CP 1243‚Äë8 IRC
Cuando se inserta el CP en el proyecto desde el cat√°logo, la interfaz serie del CP no se ve en
la vista de redes de STEP 7.
Si se utilizan los tipos de comunicaci√≥n "DNP3" e "IEC", la interfaz serie no puede utilizarse.
Despu√©s de activar el tipo de comunicaci√≥n "ST7", la interfaz serie se ve pero no puede
configurarse. Para utilizar la interfaz serie del CP se requiere un m√≥dulo TS.
Proceda del siguiente modo para insertar un m√≥dulo TS y activar con ello la interfaz serie para
la comunicaci√≥n ST7:
1. Abra la vista de dispositivo del CP desde la vista de redes (haga doble clic en el m√≥dulo).
Se abre la vista de dispositivo.
Al mismo tiempo cambia la vista del cat√°logo. Aparece, entre otros, el directorio "M√≥dulos
de comunicaci√≥n".
2. Abra el directorio "M√≥dulos de comunicaci√≥n".
> Industrial Remote Communication > TS Modules
3. Abra el subdirectorio del m√≥dulo TS necesario.
4. Seleccione el m√≥dulo TS.
En el s√≠mbolo del CP de la vista de dispositivo aparece una raya azul vertical.
5. Arrastre el m√≥dulo TS hasta la raya azul del CP en la vista de dispositivo.
6. El m√≥dulo TS con una interfaz serie se inserta en la estaci√≥n.
Al mismo tiempo, en la vista de redes se inserta una nueva interfaz WAN en el CP.

1896

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La interfaz serie puede configurarse directamente en la vista del dispositivo del TS-Adapter o
bien en la interfaz WAN del CP dentro de la vista de redes.

Par√°metros de redes WAN (l√≠nea dedicada / red de marcaci√≥n)
Modo de operaci√≥n de interfaz
El modo de operaci√≥n de la interfaz serie indica el modo de transferencia de datos.
En el modo DMA se puede utilizar como m√°ximo una interfaz serie de un m√≥dulo de
comunicaci√≥n.
Rango de valores:
‚óè Interrupt (Block)
Este modo de operaci√≥n es v√°lido para el modo de env√≠o y recepci√≥n. En principio el modo
est√°ndar Interrupt (block) es adecuado para todas las conexiones. Por cada bloque se
transmiten 4 caracteres. A continuaci√≥n se produce una alarma (Interrupt) Los caracteres
recibidos no se comprueban hasta que se ha recibido un telegrama de datos completo.
‚óè DMA
Este modo de operaci√≥n es v√°lido para el modo de env√≠o y recepci√≥n. El modo DMA es
conveniente para conexiones de alta velocidad o un elevado tr√°fico de datos, pero no para
redes GSM.
‚óè Interrupt (car√°cter √∫nico)
Este modo de operaci√≥n solo se utiliza en direcci√≥n de recepci√≥n. En el sentido de env√≠o se
contin√∫a trabajando en modo Block. El modo Interrupt es apropiado para l√≠neas de muy
mala calidad. Por cada car√°cter transmitido se lanza una alarma y cada car√°cter se analiza
inmediatamente tras su recepci√≥n, lo que permite diagnosticar muy bien errores de
transmisi√≥n. Este modo de operaci√≥n es m√°s seguro que el modo Block, pero tambi√©n es
m√°s lento.

Criterio de transmisi√≥n
Solo para interfaces con el modo de conexi√≥n "Estaci√≥n" / "Estaci√≥n nodo".
El criterio de transferencia controla el establecimiento de conexi√≥n para la transferencia de
telegramas de datos espont√°neos con limitaciones. Eso reduce el n√∫mero de intentos de
establecimiento de conexi√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1897

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Rango de valores:
‚óè Condiciones est√°ndar
No se establece ninguna conexi√≥n debido a la presencia de telegramas de datos
espont√°neos con limitaciones.
Solo se establece una conexi√≥n para enviar telegramas de datos espont√°neos sin
limitaciones en los casos siguientes:
‚Äì Desbordamiento inminente del b√∫fer de transmisi√≥n
‚Äì Establecimiento de conexi√≥n por el interlocutor
‚óè Nivel de llenado
El m√≥dulo no establece una conexi√≥n hasta que se rebasa el nivel de llenado configurado
del b√∫fer de transmisi√≥n para telegramas de datos espont√°neos con limitaciones.
En el campo de entrada se especifica el nivel de llenado (%) del b√∫fer de transmisi√≥n, cuyo
rebase provoca que el m√≥dulo establezca una conexi√≥n.
‚óè Hora
El m√≥dulo env√≠a telegramas de datos espont√°neos con limitaciones a una hora
configurada, que puede configurarse mediante "Horas" / "Minutos".
‚óè Modelo temporal
El m√≥dulo env√≠a telegramas de datos espont√°neos con limitaciones de manera c√≠clica a
intervalos de tiempo configurables, que pueden configurarse mediante "Horas" / "Minutos".

Tiempo de vigilancia de sondeo
Solo para redes WAN del tipo L√≠nea dedicada
El m√≥dulo de comunicaci√≥n supervisa el tr√°fico de telegramas por la WAN. Si no se llama el
m√≥dulo pasado un tiempo determinado, este env√≠a un aviso a su CPU indicando que la central
falla. Se aplica el comportamiento siguiente:
‚óè Tiempo de vigilancia de sondeo configurado
Una vez transcurrido el tiempo configurado, el m√≥dulo env√≠a un aviso a su CPU local.
‚óè Tiempo de vigilancia de sondeo no configurado
Si no se ha configurado ning√∫n tiempo de vigilancia, el m√≥dulo env√≠a un mensaje de fallo
tras los siguientes tiempos calculados internamente.
‚Äì Con una velocidad de transmisi√≥n de 9.600 bits/s: Tras 4 segundos sin transmisi√≥n de
telegramas
‚Äì Con una velocidad de transmisi√≥n de 1.200 bits/s: Tras 32 segundos sin transmisi√≥n de
telegramas

Servidor web
El servidor web del m√≥dulo
El m√≥dulo de comunicaci√≥n pone a disposici√≥n las p√°ginas HTML de su servidor web para el
acceso de un PC con servidor web. Las p√°ginas HTML del WBM (Web Based Management)
ofrecen informaci√≥n de configuraci√≥n y diagn√≥stico del m√≥dulo.

1898

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

General
‚óè Activar servidor web en el m√≥dulo
Si la opci√≥n est√° activada se activa el procesamiento de datos en el servidor web del
m√≥dulo y se permite el acceso por HTTP/HTTPS.
En m√≥dulos con varias interfaces hay que especificar adem√°s las interfaces para el acceso
(v√©ase m√°s abajo).
‚óè Permitir acceso solo v√≠a HTTPS
Permite el acceso al servidor web solo con el protocolo seguro HTTPS.
Si la opci√≥n est√° activada solo es posible establecer una conexi√≥n HTTPS segura a trav√©s
del puerto 443 abierto del m√≥dulo de comunicaci√≥n.
Si la opci√≥n est√° desactivada se establece una conexi√≥n HTTP a trav√©s del puerto 80 del
m√≥dulo de comunicaci√≥n.

Actualizaci√≥n autom√°tica
‚óè Activar actualizaci√≥n autom√°tica
Activa la actualizaci√≥n autom√°tica de los valores mostrados.
Si la opci√≥n est√° desactivada solo se muestran los valores en el momento de establecerse
la conexi√≥n con el servidor web.
‚óè Intervalo de actualizaci√≥n
Seleccione el intervalo en el que desea una actualizaci√≥n de los valores mostrados.
Ajuste predeterminado: 30. Rango admisible: 5...999

Vista general de las interfaces
Mediante las casillas de verificaci√≥n se definen las interfaces que est√°n autorizadas a acceder
al WBM del m√≥dulo.
Los ajustes para activar las interfaces para el acceso al servidor web se aplican
rec√≠procamente en los dos grupos de par√°metros "Servidor web" e "Interfaz Ethernet > Acceso
al servidor web".
Si no hay ninguna interfaz activada para el acceso no es posible acceder al WBM del m√≥dulo.

Estaciones interlocutoras
Importar configuraci√≥n del interlocutor (protocolo ST7)
Estaciones interlocutoras
Los par√°metros descritos a continuaci√≥n solo est√°n disponibles para m√≥dulos ST7 para los
que se ha seleccionado el m√©todo de configuraci√≥n "Importar" en el grupo de par√°metros
"Ajustes b√°sicos"; consulte el cap√≠tulo Configuraci√≥n (P√°gina 1890).
Las opciones de importaci√≥n solo est√°n disponibles en los m√≥dulos de comunicaci√≥n que se
han configurado previamente como proxy en STEP 7 V5.
Consulte los m√≥dulos soportados en el cap√≠tulo Ampliaci√≥n de proyectos SINAUT
(P√°gina 2002).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1899

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Importaci√≥n de los datos de configuraci√≥n del proxy
Requisitos
Antes de la importaci√≥n, un TIM 1531 IRC debe estar conectado en red con su CPU y estar
asignado a ella (grupo de par√°metros "N√∫meros de dispositivos").
Par√°metro
‚óè Importar configuraci√≥n del interlocutor
Con este bot√≥n se importa el archivo de configuraci√≥n (SDB) desde el proyecto de
STEP 7 V5.
El archivo de configuraci√≥n debe estar en el sistema de archivos de la estaci√≥n de
ingenier√≠a.
‚óè Restablecer configuraci√≥n del interlocutor
Este bot√≥n permite borrar todos los datos de configuraci√≥n del m√≥dulo que se han
importado previamente desde el archivo de texto con el bot√≥n "Importar configuraci√≥n del
interlocutor". Con ello pone los datos de configuraci√≥n del interlocutor al estado de un
m√≥dulo no configurado.
Excepci√≥n:
Cuando el m√≥dulo configurado en STEP 7 utiliza la variante de TD7 "TD7onCPU", los
bloques de programa TD7 creados se conservan tras el restablecimiento.
‚óè Archivo de configuraci√≥n importado
Muestra el nombre del archivo de texto con los √∫ltimos datos de configuraci√≥n que se han
cargado.
‚óè √öltima importaci√≥n
Muestra el instante en el que se ha importado el archivo de configuraci√≥n.
Tenga en cuenta lo siguiente:
‚óè En una segunda importaci√≥n se sobrescribir√°n los datos de la primera importaci√≥n.
En caso de una segunda importaci√≥n, compruebe siempre la configuraci√≥n, las conexiones
y los puntos de datos del m√≥dulo.
‚óè Al cambiar de "Importar" a "Configurar" despu√©s de una importaci√≥n se borran todas las
conexiones ST7 importadas, incluidos los datos de hora correspondientes. Los puntos de
datos configurados pierden sus interlocutores.

Datos de configuraci√≥n importados
Datos importados
Al importar los datos de configuraci√≥n de un m√≥dulo proxy desde STEP 7 V5 al m√≥dulo
compatible de STEP 7 Professional se importan tambi√©n los datos de dispositivo espec√≠ficos
de ST7 y las conexiones SINAUT.
El archivo de importaci√≥n generado en STEP 7 V5 contiene los datos de los siguientes SDB:
‚óè SDB 3202: WAN data
Los datos de una interfaz no pueden aplicarse a un CP 1542SP-1 IRC; consulte tambi√©n el
cap√≠tulo Ampliaci√≥n de proyectos SINAUT (P√°gina 2002).
‚óè SDB 3203: Subscriber data

1900

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè SDB 3207: S7 connection data
‚óè SDB 3208: Ethernet data
Informaci√≥n de puntos de datos / objetos SINAUT
La aplicaci√≥n de datos de configuraci√≥n de STEP 7 V5 difiere seg√∫n sea la versi√≥n de TD7
utilizada en STEP 7 V5:
‚óè TD7onTIM
Los datos de configuraci√≥n no se convierten en puntos de datos.
‚óè TD7onCPU
Durante la importaci√≥n a un TIM 1531 IRC, los bloques TD7onCPU de la CPU 1500 se
crean a partir de la informaci√≥n contenida en los bloques parametrizados en STEP 7 V5.
Si se deshace la importaci√≥n ("Restablecer configuraci√≥n del interlocutor", v√©ase m√°s
arriba), los bloques TD7onCPU se conservan.
Datos de la sincronizaci√≥n horaria
Los datos de la sincronizaci√≥n horaria se importan de STEP 7 V5.
En los siguientes m√≥dulos, los datos de hora de una interfaz serie pueden modificarse
posteriormente en STEP 7 Professional:
‚óè CP 1243‚Äë8 IRC a partir de la versi√≥n de firmware V3
‚óè TIM 1531 IRC

Estaciones interlocutoras
Despu√©s de la importaci√≥n, la tabla muestra los datos siguientes de todos los interlocutores de
la comunicaci√≥n del m√≥dulo configurados en STEP 7 V5:
‚óè N√∫mero de dispositivo
N√∫mero de dispositivo del interlocutor
‚óè Identificador del dispositivo
Identificador del tipo de dispositivo:
‚Äì 0 = CPU
‚Äì 1 = TIM
‚Äì 4 = WinCC
‚Äì 7 = SMSC
‚óè Identificador adicional del dispositivo
Encontrar√° m√°s informaci√≥n en el apartado inferior que lleva el mismo nombre.
‚óè N√∫mero de conexiones
N√∫mero de conexiones con cada interlocutor
‚óè N√∫mero de interlocutores
N√∫mero de interlocutores de comunicaci√≥n que est√°n configurados para el interlocutor en
cuesti√≥n.
Para cada interlocutor que aparece en la tabla "Estaciones interlocutoras" es posible visualizar
datos adicionales en las tablas siguientes.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1901

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Lista de interlocutores y conexiones
‚óè Seleccionar interlocutor
Seleccione en la lista desplegable uno de los interlocutores que aparece en la tabla
"Estaciones interlocutoras".
Tabla "Conexiones"
La tabla muestra la informaci√≥n siguiente relacionada con el interlocutor seleccionado en la
lista desplegable:
‚óè N√∫mero de dispositivo del interlocutor
N√∫meros de dispositivos de todos los interlocutores de comunicaci√≥n que est√°n
configurados para este interlocutor.
‚óè Identificaci√≥n de interfaz
Identificaci√≥n de tipo de la interfaz por la que transcurre la conexi√≥n con el interlocutor en
cuesti√≥n:
‚Äì 0 = bus de fondo (interlocutor de la conexi√≥n = CPU)
‚Äì 1 = interfaz Ethernet 1
‚Äì 2 = interfaz Ethernet 2
‚Äì 3 = interfaz Ethernet 3
‚Äì 4 = interfaz serie
‚óè Longitud de la ID de subred
Longitud de la ID de subred S7: 6 bytes
‚óè ID de subred
ID de subred (hexadecimal) de la red por la que transcurre la conexi√≥n con el interlocutor:
‚Äì Bytes 0..2: n√∫mero de la subred
‚Äì Bytes 3..5: n√∫mero del proyecto de STEP 7 V5
En funci√≥n de los datos importados del SDB, es posible que el valor mostrado est√© vac√≠o.
‚óè Referencia CFB
√çndice asignado internamente de una conexi√≥n S7 configurada para el t√∫nel de transporte
a un dispositivo local

1902

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Tipo de conexi√≥n
Identificador de conexi√≥n (binario)
‚Äì 128: conexi√≥n PBK (comunicaci√≥n de bloque programada)
‚Äì 136: conexi√≥n WAN
Asignaci√≥n de bytes:
Bits 0..6
‚Äì Para interfaces Ethernet:
Bits 0..3:
0 = conexi√≥n S7
1 / 2 / 3 = conexi√≥n local
5 = conexi√≥n MSC
Bit 5:
0 = conexi√≥n permanente
1 = conexi√≥n temporal
Bit 6:
1 = GPRS
‚Äì Para interfaces serie:
Bits 0..3:
8 = protocolo ST7
Bit 7
‚Äì 0 = v√≠a local
‚Äì 1 = v√≠a remota
‚óè Longitud de la direcci√≥n
Longitud de la direcci√≥n del interlocutor: 1...6 bytes
‚Äì Direcciones IP: 4
‚Äì Direcciones WAN: 1
‚óè Direcci√≥n
‚Äì Para conexiones v√≠a interfaces Ethernet:
Direcci√≥n IP del interlocutor
‚Äì Para conexiones v√≠a interfaces serie:
Direcci√≥n WAN del interlocutor (0...255)
Tabla "Lista de interlocutores"
En las tablas se muestran datos adicionales de los interlocutores seleccionados en la lista
desplegable "Seleccionar interlocutor".
‚óè N√∫mero de dispositivo del interlocutor
N√∫mero de dispositivo propio del interlocutor seleccionado anteriormente (interlocutor del
m√≥dulo de comunicaci√≥n)
‚óè Interlocutor de conexi√≥n
N√∫mero de dispositivo del interlocutor de destino con el que se comunica el interlocutor
seleccionado.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1903

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Identificador adicional del dispositivo
En la tabla "Estaciones interlocutoras" se muestra el "Identificador adicional del dispositivo" (32
bits). Dependiendo del Tipo de dispositivo del interlocutor, el Identificador adicional del
dispositivo contendr√° la siguiente informaci√≥n:
‚óè CPU (TD7)
Estado del bit 0:
‚Äì 0: la CPU no env√≠a el estado operativo al interlocutor.
‚Äì 1: la CPU env√≠a el estado operativo al interlocutor.
Los bits restantes no est√°n asignados para la CPU.
‚óè TIM (ST7)
N.¬∫ de bit

Significado

Bit 0

Hora DCF77
‚óè 0: no existe
‚óè 1: existe

Bit 1

Establecimiento de la conexi√≥n del m√≥dulo de comunicaci√≥n a la CPU
‚óè 0: no se permite
‚óè 1: se permite

Bit 2

Interfaz serie 1 (driver WAN)
‚óè 0: la interfaz no existe
‚óè 1: la interfaz existe

Bit 3

Interfaz serie 2 (driver WAN)
‚óè 0: la interfaz no existe
‚óè 1: la interfaz existe

Bits 4...15

No asignados

Bits 16...19

Interfaz serie 1: Tipo de red
‚óè 0: l√≠nea dedicada
‚óè 1: red espont√°nea (red de telefon√≠a m√≥vil)
‚óè 2: red de marcaci√≥n
‚óè 3...4: no asignados
‚óè 5: red MSC
‚óè 6...15: no asignados

Bits 20...21

Interfaz serie 1: Tipo de nodo de red
‚óè 0: estaci√≥n central
‚óè 1: estaci√≥n nodo
‚óè 2: estaci√≥n

Bit 22

Interfaz serie 1: Formato de telegrama
‚óè 0: FT1.2
‚óè 1: FT2

Bit 23

1904

No asignados

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
N.¬∫ de bit

Significado

Bits 24...27

Interfaz serie 2: Tipo de red
‚óè 0: l√≠nea dedicada
‚óè 1: red espont√°nea (red de telefon√≠a m√≥vil)
‚óè 2: red de marcaci√≥n
‚óè 3...4: no asignados
‚óè 5: red MSC
‚óè 6...15: no asignados

Bits 28...29

Interfaz serie 2: Tipo de nodo de red
‚óè 0: estaci√≥n central
‚óè 1: estaci√≥n nodo
‚óè 2: estaci√≥n

Bit 30

Interfaz serie 2: Formato de telegrama
‚óè 0: FT1.2
‚óè 1: FT2

Bit 31

No asignados

Servidor de Telecontrol (protocolo Telecontrol Basic)
Direccionamiento del servidor de Telecontrol doble o redundante
‚óè TCSB V3: direccionamiento del grupo de redundancia de TCSB
Para CP a partir de la versi√≥n de firmware V2 con el protocolo "Telecontrol Basic"
En la LAN de la central a la que est√°n conectados los PC servidores TCSB y el router DSL
(p. ej., SCALANCE M), se asigna una direcci√≥n IP virtual com√∫n a los dos PC servidores por
medio del Network Load Balancing (NLB) del sistema operativo del equipo.
Dicha direcci√≥n IP se configura en funci√≥n de la estructura de la red:
‚Äì Si est√°n conectados CP sin router DSL, en los CP debe configurarse la direcci√≥n virtual
asignada por medio del NLB como direcci√≥n IP del servidor de Telecontrol.
‚Äì En caso de utilizar un router DSL, para el direccionamiento del servidor de Telecontrol
redundante en las estaciones se configura una sola direcci√≥n IP, la direcci√≥n p√∫blica del
router DSL.
Ajuste el reenv√≠o de puertos en el router DSL de manera que la direcci√≥n IP p√∫blica (red
externa) conduzca a la direcci√≥n IP virtual del PC servidor del TCSB (red interna). Desde
Internet solo se puede acceder a la direcci√≥n IP p√∫blica. De este modo, la estaci√≥n no
recibe informaci√≥n sobre con cu√°l de los dos equipos del grupo de redundancia est√°
conectada.
Si se configura una segunda direcci√≥n IP, hay que asegurarse de que es posible acceder
a TCSB utilizando la direcci√≥n IP de un segundo router.
‚óè TCSB V2: direccionamiento del servidor de Telecontrol principal y sustitutivo
Solo para CP 1242‚Äë7 (6GK7 242-7KX30-0XE0)
TCSB V2 permite instalar dos PC servidores independientes. Solo es necesario configurar
la direcci√≥n del servidor de Telecontrol sustitutivo si ambos PC est√°n conectados a Internet
mediante dos routers.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1905

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comunicaci√≥n con la CPU
Ciclo de muestreo de la CPU
Los puntos de datos de entrada se asignan al ciclo de lectura de la CPU en la configuraci√≥n de
puntos de datos, en la ficha "General > Ciclo de lectura".

Estructura del ciclo de muestreo de la CPU
El ciclo con el que el m√≥dulo de transmisi√≥n (CP/TIM) explora el √°rea de memoria de la CPU
consta de las fases siguientes:
‚óè Peticiones de lectura con prioridad alta
(Ciclo r√°pido)
Para todos los puntos de datos con la asignaci√≥n "Ciclo r√°pido" se leen las variables PLC
en cada ciclo de muestreo.
Generalmente es suficiente con asignar el ciclo r√°pido solo a los datos que deben
registrarse r√°pidamente, como alarmas, mensajes y objetos de comando, consigna y
par√°metros para el control 1 de n.
‚óè Peticiones de escritura
En cada ciclo se escriben en la CPU los valores de un n√∫mero determinado de peticiones
de escritura espont√°neas.
‚Äì CP de Telecontrol / TIM 1500:
El n√∫mero de variables que se escriben en cada ciclo se especifica para el m√≥dulo de
transmisi√≥n con el par√°metro "N√∫mero m√°x. de peticiones de escritura" en el grupo de
par√°metros "Comunicaci√≥n con la CPU". Las variables cuyo n√∫mero excede este valor
se escriben en el pr√≥ximo ciclo o en uno de los siguientes.
‚óè Peticiones de lectura con prioridad baja - proporcionalmente
(Ciclo normal)
Para los puntos de datos con la asignaci√≥n "Ciclo normal" se leen los valores de sus
variables PLC proporcionalmente en cada ciclo de muestreo.
‚Äì CP de Telecontrol / TIM 1500:
El n√∫mero de variables que se leen en cada ciclo se especifica para el m√≥dulo de
transmisi√≥n con el par√°metro "N√∫mero m√°x. de peticiones de lectura" del grupo de
par√°metros "Comunicaci√≥n con la CPU". Las variables que pasan de dicho valor y, por
tanto, no se leen en un ciclo, se leer√°n en el pr√≥ximo ciclo o en otro ulterior.
‚óè Tiempo de pausa del ciclo
Este tiempo de espera entre dos ciclos de muestreo sirve para reservar tiempo suficiente
para otros procesos que acceden a la CPU.

Duraci√≥n del ciclo de muestreo de la CPU
Puesto que para el ciclo no es posible configurar un tiempo fijo y las diferentes fases no tienen
asignado un n√∫mero fijo de objetos, la duraci√≥n del ciclo de muestreo es variable y puede
cambiar din√°micamente.

1906

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estado de interlocutor y Estado de recorrido
Los par√°metros descritos a continuaci√≥n se encuentran en el siguiente grupo de par√°metros
de los m√≥dulos con el tipo de comunicaci√≥n "ST7":
"Comunicaci√≥n con la CPU" > "Estado del interlocutor"
Los siguientes estados se vigilan y se escriben en variables PLC:
‚óè Estado de interlocutor
Accesibilidad de un interlocutor de comunicaci√≥n
‚óè Estado de recorrido
Estado de las conexiones con un interlocutor

Interlocutor / Nombre de interlocutor
Aqu√≠ se definen los interlocutores del m√≥dulo seleccionado, cuyos estados de accesibilidad y
recorrido deben vigilarse en las conexiones de Telecontrol. Los interlocutores pueden ser CPU
o una aplicaci√≥n de central de control (por ejemplo ST7cc).
En la tabla pueden seleccionarse todos los interlocutores con los que se ha configurado una
conexi√≥n de Telecontrol.

Variables PLC en los diferentes tipos de TIM
Las variables PLC en las que se escriben los estados se distinguen por el tipo de TIM:
‚óè TIM 4R‚ÄëIE
‚Äì Estado de interlocutor
El estado de interlocutor se deposita en una variable PLC del tipo Bool (DB, marca,
salida).
Consulte la codificaci√≥n m√°s abajo.
‚Äì Estado de recorrido
El estado de recorrido se deposita en una variable PLC del tipo Byte (DB, marca, salida).
Consulte la asignaci√≥n de la variable PLC m√°s abajo.
‚óè TIM 1531 IRC / CP 1243‚Äë8 IRC
‚Äì Estado de interlocutor / estado de recorrido
Ambos estados se depositan en una variable PLC com√∫n del tipo Word o UInt (DB,
marca, salida).
Cada uno de los estados ocupa un byte de la variable PLC. La codificaci√≥n se escribe
por separado para byte 0 (estado de interlocutor) y byte 1 (estado de recorrido).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1907

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estado de interlocutor
‚óè TIM 4R‚ÄëIE
El bit para el estado de interlocutor tiene la codificaci√≥n siguiente (rango de valores):
‚Äì 0: interlocutor no accesible
‚Äì 1: interlocutor accesible
‚óè TIM 1531 IRC / CP 1243‚Äë8 IRC
El byte 0 de la variable PLC com√∫n para estado de interlocutor / estado de recorrido codifica
informaci√≥n sobre la accesibilidad del interlocutor, sobre las conexiones y v√≠as de conexi√≥n
existentes y sobre el estado del b√∫fer de transmisi√≥n del TIM.
Bit 7
Redundan‚Äê
cia de v√≠as

Bit 6

0: sin redun‚Äê 0: perma‚Äê
dancia
nente
1: hay re‚Äê
dundancia

Bit 5

Modo de co‚Äê Conexi√≥n
nexi√≥n
temporal **

1: temporal

0: interlocu‚Äê
tor no acce‚Äê
sible
1: interlocu‚Äê
tor accesi‚Äê
ble *

Bit 1

Bit 0

(Reser‚Äê
vado)

Bit 4

Memoria de tele‚Äê
gramas *

Bit 3

Bit 2

Estado de
recorrido

Estado de
interlocutor

‚Äë

0: b√∫fer de trans‚Äê
misi√≥n en buen
estado

0: no todos
los recorri‚Äê
dos son ac‚Äê
cesibles

0: interlocu‚Äê
tor no acce‚Äê
sible

1: < 90% de me‚Äê
moria ocupada
3: desbordamien‚Äê
to (100% de me‚Äê
moria ocupada)

1: todos los
recorridos
son accesi‚Äê
bles

1: interlocu‚Äê
tor accesi‚Äê
ble

* Los interlocutores que soportan conexiones temporales se establecen como "accesibles"
cuando el propio interlocutor deshace la conexi√≥n.
** Respecto al comportamiento de la memoria de telegrama consulte el apartado "B√∫fer de
transmisi√≥n" del cap√≠tulo Memoria imagen de proceso, tipo de transferencia, clases de
eventos (P√°gina 1963)

Estado de recorrido
El byte 1 muestra desde la perspectiva del TIM local el estado de la v√≠a de conexi√≥n (conexi√≥n
configurada) hacia el interlocutor.
Como m√°ximo es posible configurar 2 v√≠as (v√≠a principal y v√≠a sustitutiva) hacia un interlocutor;
consulte el cap√≠tulo Crear conexiones de Telecontrol (P√°gina 1919).
Ambas v√≠as de conexi√≥n deben comenzar o terminar en un TIM local.
La variable PLC muestra lo siguiente:
‚óè Las rutas a trav√©s de las cuales se accede al interlocutor.
‚óè La ruta utilizada actualmente.
‚óè La interfaz TIM a trav√©s de la que se ha configurado la ruta principal.
‚óè La interfaz TIM a trav√©s de la que se ha configurado la ruta sustitutiva.

1908

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La ruta de una conexi√≥n se indica como combinaci√≥n de las interfaces utilizadas del TIM y el
estado de la ruta.
‚óè Asignaci√≥n de byte
La asignaci√≥n del byte es la siguiente:
‚Äì Dos bits para la interfaz de la ruta principal
‚Äì Dos bits para la interfaz de la ruta sustitutiva
‚Äì Dos bits para la estado de la ruta principal
‚Äì Dos bits para la estado de la ruta sustitutiva
Bits 6 + 7

Bits 4 + 5

Bits 2 + 3

Interfaz configurada
N.¬∫ para ruta sustitutiva

N.¬∫ para ruta principal

Bits 0 + 1

Estado de la ruta
Ruta sustitutiva (2.¬™
ruta)

Ruta principal (1.¬™
ruta)

‚óè Interfaz configurada
En la tabla siguiente, las interfaces de los m√≥dulos TIM est√°n numeradas de 0 a 3 y tienen
el significado siguiente:
‚Äì "0"
TIM 4R‚ÄëIE: interfaz Ethernet 1 (X3)
TIM 1531 IRC: interfaz Ethernet 1 (X1)
CP 1243‚Äë8 IRC: interfaz Ethernet (X1)
‚Äì "1"
TIM 4R‚ÄëIE: interfaz Ethernet 2 (X4)
TIM 1531 IRC: interfaz Ethernet 2 (X2)
CP 1243‚Äë8 IRC: Interfaz WAN (X2)
‚Äì "2"
TIM 4R‚ÄëIE: interfaz WAN 1 (X1)
TIM 1531 IRC: interfaz Ethernet 3 (X3)
‚Äì "3"
TIM 4R‚ÄëIE: interfaz WAN 2 (X2)
TIM 1531 IRC: interfaz WAN 1 (X4)
Para el CP 1243‚Äë8 IRC los n√∫meros de interfaz "2" y "3" son irrelevantes.
Estado bit 5 /
bit 7

Estado bit 4 /
bit 6

Significado

0

0

Codificaci√≥n de la interfaz "0"

0

1

Codificaci√≥n de la interfaz "1"

1

0

Codificaci√≥n de la interfaz "2"

1

1

Codificaci√≥n de la interfaz "3"

‚óè Estado de recorrido
‚Äì V√≠a principal = 1. V√≠a, codificaci√≥n con bit 0 y 1
‚Äì V√≠a sustitutiva = 2. V√≠a, codificaci√≥n con bit 2 y 3

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1909

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Estado bit
1 / bit 3

Estado bit
0 / bit 2

Significado bit 1 / bit 3

Significado bit 0 / bit 2

0

0

la ruta no es actual

no se puede acceder al dispositivo

0

1

la ruta no es actual

dispositivos accesibles

1

0

la ruta es actual

no se puede acceder al dispositivo

1

1

la ruta es actual

dispositivos accesibles

Ejemplo de posibilidades de codificaci√≥n del estado de recorrido
La tabla siguiente muestra un ejemplo de posibilidades de codificaci√≥n del estado de recorrido
en el TIM 1531 IRC.
Las abreviaciones de las interfaces tienen el significado siguiente:
‚óè IE1 = interfaz Ethernet 1 (X1)
‚óè IE2 = interfaz Ethernet 2 (X2)
‚óè IE3 = interfaz Ethernet 3 (X3)
‚óè WAN = interfaz serie (X4)
La misma codificaci√≥n de la interfaz configurada para la ruta principal y sustitutiva significa que
no existe una redundancia de ruta (solo 1 interfaz configurada). En este caso, el estado de la
ruta se emite mediante los bits de la ruta principal (1.¬™ ruta).
Tabla 1-137 Ejemplo de codificaci√≥n para el Estado de recorrido.
Interfaz configurada

1910

Estado de recorrido

Codificaci√≥n para la v√≠a
sustitutiva

Codificaci√≥n para la v√≠a
principal

V√≠a sustitutiva (2.¬™ v√≠a) V√≠a principal (1.¬™ v√≠a)

00

0 0 = codificaci√≥n para IE1 Irrelevante (no redun‚Äê
dante)

Estado de IE1

00

0 1 = codificaci√≥n para IE2 Estado de IE1

Estado de IE2

00

1 0 = codificaci√≥n para IE3 Estado de IE1

Estado de IE3

00

1 1 = codificaci√≥n para
WAN

Estado de IE1

Estado de WAN

01

00

Estado de IE2

Estado de IE1

01

01

Irrelevante (no redun‚Äê
dante)

Estado de IE2

01

10

Estado de IE2

Estado de IE3

01

11

Estado de IE2

Estado de WAN

10

00

Estado de IE3

Estado de IE1

10

01

Estado de IE3

Estado de IE2

10

10

Irrelevante (no redun‚Äê
dante)

Estado de IE3

10

11

Estado de IE3

Estado de WAN

11

00

Estado de WAN

Estado de IE1

11

01

Estado de WAN

Estado de IE2

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Interfaz configurada

Estado de recorrido

11

10

Estado de WAN

Estado de IE3

11

11

Irrelevante (no redun‚Äê
dante)

Estado de WAN

Vigilancia de entradas de operador
Vigilancia de entradas de operador
La Vigilancia de entradas de operador permite vigilar entradas de operador (pulsadores, etc.)
para la protecci√≥n contra entradas err√≥neas.
Para las entradas de operador vigiladas se define una duraci√≥n m√≠nima y una m√°xima. El
estado de vigilancia se guarda en la "Variable PLC para vigilancia de entradas de operador"
(byte).
La variable PLC puede utilizarse para entradas a trav√©s de los siguientes tipos de puntos de
datos:
‚óè Salida de comando (Cmd01B_S)
‚óè Salida de consigna (Set01W_S)
‚óè Entradas de par√°metros (Par12D_S)
Se recomienda utilizar la Vigilancia de entradas de operador especialmente cuando la entrada
de comandos se realiza mediante entradas digitales, p. ej. pulsadores conectados. Lo mismo
sucede cuando las entradas de consignas y par√°metros se preparan para la transmisi√≥n
mediante un disparador y este disparo tiene lugar por medio de una entrada digital, es decir,
en este caso tambi√©n mediante un pulsador, por ejemplo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1911

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Vigilancia de entradas incorrectas (tiempo de entrada)
Para las entradas mediante entradas digitales es posible conseguir una mayor seguridad
contra entradas err√≥neas utilizando Vigilancia de entradas de operador. Los temporizadores y
bits de indicaci√≥n citados a continuaci√≥n solo son relevantes para entradas de operador a
trav√©s de entradas digitales.
‚óè Tiempo de entrada m√≠n.
Se puede definir un Tiempo de entrada m√≠nimo para las entradas, es decir, el pulsador
accionado en cada caso debe permanecer pulsado hasta que ha transcurrido el tiempo
m√≠nimo ajustado. De ese modo, si se acciona accidentalmente un pulsador, no tiene lugar
una transmisi√≥n involuntaria. Una vez transcurrido el tiempo de entrada m√≠nimo y y cuando
ya puede soltarse el pulsador, la "Variable PLC para la vigilancia de entradas de operador"
indica "Entrada OK" en el bit 0 (ver a continuaci√≥n).
Recomendamos una duraci√≥n m√≠nima de 1 segundo.
Si el par√°metro no es necesario, configure 0 (cero).
‚óè Tiempo de entrada m√°x.
Adem√°s del tiempo m√≠nimo, tambi√©n es posible parametrizar un tiempo de entrada m√≠nimo
para las entradas digitales. Esto permite detectar a tiempo teclas que quedan atascadas o
entradas digitales defectuosas que proporcionan una se√±al 1 permanente. Este tipo de
errores se escriben como "Error de entrada" en el bit 1 de la variable PLC.
No se procesar√°n m√°s entradas de hardware mientras se mantenga activado el bit "Error
de entrada".
Si el par√°metro no es necesario, configure 0 (cero).

Vigilancia de errores 1 de n
Generalmente, para todas las entradas de operador a trav√©s de entradas digitales, marcas o
bloques de datos, la variable PLC devuelve el estado de error "Error 1 de n" en el bit 2. El
estado de error se activa si se activa simult√°neamente m√°s de 1 bit.
El error se devuelve en los siguientes casos:
‚óè Error 1 de n con "Cmd01B_S"
En el byte de entrada del tipo de punto de datos de comando "Cmd01B_S" se ha activado
m√°s de 1 bit. Para mayor seguridad a la hora de introducir comandos, no debe activarse
m√°s de 1 bit para este objeto. Si se activan dos o m√°s bits al mismo tiempo, se rechaza la
entrada de comandos.
‚óè Error 1 de n con todas las entradas de comando, consigna y par√°metros en el ciclo de
lectura r√°pido
Si se desea aumentar la seguridad para la entrada de comandos, consignas y par√°metros,
deber√≠an asignarse al ciclo de lectura r√°pido todos los objetos con los que deben enviarse
dichos datos. En este caso, todos los objetos de comando, consigna y par√°metro del ciclo
de lectura r√°pido se someten a una comprobaci√≥n 1 de n.
Al final del ciclo de lectura r√°pido se comprueba si hay una entrada de comando, consigna
o par√°metro en uno solo de los objetos registrados. Solo en caso afirmativo se procesa y
transmite la entrada en cuesti√≥n. Si hay m√°s de una entrada pendiente al mismo tiempo, las
entradas se rechazan. Un nuevo comando, una nueva consigna o un nuevo par√°metro no
se procesar√° mientras previamente no se haya registrado ninguna entrada en un ciclo
r√°pido como m√≠nimo.

1912

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Reset del bit de comando
Si se introducen comandos mediante un byte de marcas o datos o se habilita una entrada de
consignas o par√°metros mediante un bit de marcas o datos (se√±al de disparo), el bit de
comando o la se√±al de disparo activada en cada caso se pone a cero.
Sin embargo, cuando se detecta un error 1 de N, los bits de comando no se desactivan
autom√°ticamente. La desactivaci√≥n debe realizarse a trav√©s del programa de usuario.

Ocupaci√≥n del byte de estado de la "Variable PLC para la vigilancia de entradas de operario"
Tabla 1-138 Asignaci√≥n de bits del byte de estado
Bit:

.7 *

.6 *

.5 *

.4 *

.3 *

.2

.1

.0

Estado:

‚Äë

‚Äë

‚Äë

‚Äë

‚Äë

Error 1
de n

Error de
entrada

Entrada
correcta

Con va‚Äê
lor:

0

0

0

0

0

1

1

1

* Los bits no ocupados se escriben con 0

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1913

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

N√∫meros de dispositivos
Asignaci√≥n de la CPU y configuraci√≥n del direccionamiento de los n√∫meros de dispositivos
Para m√≥dulos cuyas relaciones de comunicaci√≥n se configuran mediante conexiones de
Telecontrol en el editor "Datos de red", la asignaci√≥n de la CPU y la configuraci√≥n de los
n√∫meros de dispositivos o de la direcci√≥n de estaci√≥n se lleva a cabo en el grupo de
par√°metros "N√∫meros de dispositivos".
‚óè CPU asignada
En los siguientes m√≥dulos de comunicaci√≥n, que est√°n en el mismo rack que la CPU, la
CPU local se asigna autom√°ticamente al m√≥dulo:
‚Äì CP de Telecontrol de S7-1200
‚Äì TIM 3V‚ÄëIE... / TIM 4R‚ÄëIE
‚Äì TIM 3V‚ÄëIE DNP3 / TIM 4R‚ÄëIE DNP3
En los m√≥dulos de comunicaci√≥n que no est√°n en el mismo rack que una CPU hay que
utilizar la lista desplegable para asignar el m√≥dulo a una CPU con la que est√© conectado en
red. Esto se aplica a:
‚Äì TIM 4R‚ÄëIE Standalone
‚Äì TIM 4R‚ÄëIE DNP3 Standalone
‚Äì TIM 1531 IRC
En todos los protocolos (ST7, DNP3, IEC 60870‚Äë5) es posible asignar al TIM 1531 IRC
una CPU de las siguientes familias SIMATIC: S7‚Äë300, S7‚Äë400, S7‚Äë1500, ET 200SP
Si se asigna el TIM 1531 IRC a una CPU S7‚Äë1500R/H, para la comunicaci√≥n del TIM con
la CPU se utiliza la direcci√≥n IP del sistema de la CPU S7‚Äë1500R/H.
‚óè N√∫mero de dispositivo de la CPU asignada
En m√≥dulos ST7, aqu√≠ existe la posibilidad de modificar el n√∫mero de dispositivo
predeterminado de la CPU que forma el punto final de las conexiones de Telecontrol.
Una CPU S7‚Äë1500R/H (TIM 1531 IRC) solo obtiene un n√∫mero de dispositivo.
Observaci√≥n:
Para la aplicaci√≥n ST7 del PC central, el n√∫mero de dispositivo se configura en la conexi√≥n
de Telecontrol.
‚óè N√∫mero de dispositivo / Direcci√≥n de estaci√≥n / Direcci√≥n ASDU
Aqu√≠ existe la posibilidad de adaptar el n√∫mero de dispositivo predeterminado o la direcci√≥n
predeterminada del m√≥dulo de comunicaci√≥n.

RTU3000C
En la RTU3000C, que puede configurarse como comod√≠n cuando se utiliza el protocolo ST7,
encontrar√° los par√°metros siguientes.
‚óè N√∫mero de dispositivo (RTU)
Aqu√≠ se asigna el n√∫mero de dispositivo de la RTU, tal como se ha configurado en el WBM
de la respectiva RTU.
‚óè N√∫mero de dispositivo de la CPU (RTU)
Aqu√≠ se asigna el n√∫mero de dispositivo de la CPU, tal como se ha configurado en el WBM
de la respectiva RTU.

1914

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Protecci√≥n
Protecci√≥n del TIM 1531 IRC
Protecci√≥n
La tabla "Protecci√≥n" permite configurar diferentes niveles de acceso con el fin de limitar el
acceso a los datos de configuraci√≥n del m√≥dulo.
Las marcas de verificaci√≥n verdes que se muestran en la columna "Acceso" indican las
operaciones que est√°n habilitadas sin conocer la contrase√±a del nivel de acceso en cuesti√≥n.
Para utilizar operaciones no habilitadas es necesario introducir la contrase√±a configurada.
Excepci√≥n:
Todos los niveles de acceso permiten el acceso a los datos de identificaci√≥n (nombre,
direcciones ...) del m√≥dulo sin necesidad de introducir la contrase√±a, por medio de la funci√≥n
"Dispositivos accesibles".

Comportamiento predeterminado
El nivel de acceso predeterminado es "Acceso completo (sin protecci√≥n)". Todos los usuarios
pueden leer y modificar los datos de configuraci√≥n del TIM. No hay ninguna contrase√±a
configurada y tampoco se requiere para el acceso online.

Los diferentes niveles de acceso
Es posible configurar los niveles de acceso siguientes:
‚óè Acceso completo (sin protecci√≥n)
cualquiera puede leer y modificar los bloques y la configuraci√≥n hardware.
‚óè Acceso de lectura
Si no se introduce la contrase√±a solo es posible el acceso de lectura.
Sin contrase√±a no es posible cargar datos (configuraci√≥n, firmware, certificados) en el
m√≥dulo ni ejecutar funciones de test de escritura.
‚óè Sin acceso (protecci√≥n completa)
No est√° permitido el acceso de lectura ni escritura al m√≥dulo.
La legitimaci√≥n con la contrase√±a permite volver a tener acceso completo al m√≥dulo.

Comportamiento de un m√≥dulo protegido por contrase√±a durante el funcionamiento
La protecci√≥n del m√≥dulo es efectiva una vez que se ha cargado el m√≥dulo.
Las funciones protegidas con contrase√±a solo pueden ejecutarse desde la estaci√≥n de
ingenier√≠a (PC STEP 7).
Antes de ejecutar una funci√≥n online se comprueba que est√© permitida. Si est√° protegida por
contrase√±a, deber√° introducirse.
Ejemplo:
El m√≥dulo se ha configurado con acceso de lectura y el usuario desea cargar un nuevo

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1915

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
firmware. Puesto que esta funci√≥n es un acceso de escritura, para ejecutarla debe introducirse
la contrase√±a configurada.
La autorizaci√≥n de acceso a los datos protegidos es v√°lida mientras dure la conexi√≥n online o
hasta que se suprima manualmente la autorizaci√≥n de acceso mediante "Online > Borrar
derechos de acceso".

Consulte tambi√©n
Configurar la protecci√≥n de acceso (P√°gina 1916)

Configurar la protecci√≥n de acceso
Es posible introducir varias contrase√±as para el m√≥dulo, con lo que se crean diferentes
derechos de acceso para grupos de usuarios distintos.
La contrase√±as se introducen en la tabla, de modo que cada contrase√±a tiene asignado un
nivel de acceso concreto. El efecto que tiene cada contrase√±a se explica en la columna "Nivel
de acceso".
Ejemplo (Sin acceso):
Seleccione el nivel de acceso "Sin acceso (protecci√≥n completa)" e introduzca una contrase√±a
propia para los dos niveles de acceso que situados por encima en la tabla.
Para los usuarios que no conozcan ninguna de las contrase√±as, el m√≥dulo est√°
completamente protegido.
Para los usuarios que conozcan una de las contrase√±as, el efecto depende de la fila de la tabla
en la que est√© la contrase√±a:
‚óè La contrase√±a de la fila "Acceso completo (sin protecci√≥n)" desprotege el m√≥dulo para los
usuarios que la conocen. Tienen acceso ilimitado al m√≥dulo.
‚óè La contrase√±a de la fila "Acceso de lectura" protege el m√≥dulo contra escritura. Los
usuarios que conozcan esta contrase√±a tendr√°n acceso de lectura al m√≥dulo.
Procedimiento
Proceda del siguiente modo para configurar los niveles de acceso en la tabla "Protecci√≥n":
1. Seleccione el nivel de acceso deseado en la primera columna de la tabla. Las marcas de
verificaci√≥n verdes que se muestran en las columnas situadas a la derecha del nivel de
protecci√≥n correspondiente indican las operaciones que se pueden seguir realizando sin
introducir la contrase√±a.
2. Si se ha seleccionado un nivel de acceso distinto a "Acceso completo":
‚Äì Asigne una contrase√±a para el acceso completo en la celda "Contrase√±a" de la primera
fila (acceso completo).
‚Äì Repita la contrase√±a introducida para evitar entradas incorrectas.
Aseg√∫rese de que la contrase√±a sea lo suficientemente segura, es decir, de que no tenga
un patr√≥n reconocible por una m√°quina.
La entrada de una contrase√±a en la fila "Acceso completo (sin protecci√≥n)" es obligatoria y
permite a las personas que conocen la contrase√±a acceder sin limitaciones al m√≥dulo,
independientemente del nivel de protecci√≥n seleccionado.

1916

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. En caso necesario, asigne otras contrase√±as a otros niveles de acceso, siempre que el
nivel de acceso seleccionado lo permita.
4. Cargue los datos de configuraci√≥n en el m√≥dulo para que el nivel de acceso sea efectivo.
Resultado
Los datos de configuraci√≥n est√°n protegidos contra accesos online no autorizados en funci√≥n
del nivel de acceso ajustado. Si una operaci√≥n no puede ejecutarse sin contrase√±a debido al
nivel de acceso configurado, se abre un cuadro de di√°logo para introducir la contrase√±a.

Conexiones de Telecontrol
Conexiones de Telecontrol
Conexiones de Telecontrol
Para la comunicaci√≥n remota se necesitan relaciones de Telecontrol entre los m√≥dulos de
comunicaci√≥n intervinientes. Dependiendo del tipo de m√≥dulo y de la versi√≥n de firmware, la
configuraci√≥n se realiza en los grupos de par√°metros siguientes:
‚óè grupo de par√°metros "Estaciones interlocutoras"
o
‚óè editor "Datos de red"

Configuraci√≥n en el grupo de par√°metros "Estaciones interlocutoras"
Para los CP de Telecontrol S7-1200 de versi√≥n V2.1 o inferior, que solo act√∫an como estaci√≥n,
las relaciones con la estaci√≥n central o con el maestro se configuran en el grupo de par√°metros
"Estaciones interlocutoras". Aqu√≠ se definen los interlocutores de la comunicaci√≥n de los CP.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1917

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Todos los dem√°s ajustes necesarios para la comunicaci√≥n con la estaci√≥n central se toman de
los restantes datos de configuraci√≥n de los CP y no es necesario configurarlos
espec√≠ficamente para las conexiones.
Nota
Excepci√≥n: CP 1243‚Äë8 IRC V2.1 (ST7)
A partir de STEP 7 V15.1, un CP f√≠sico de versi√≥n de firmware V2.1 puede configurarse en el
proyecto STEP 7 con la versi√≥n de firmware V3.0:
1. Agregue en el proyecto STEP 7 un CP con la versi√≥n de firmware V3.0.
2. En el grupo de par√°metros "General > Informaci√≥n de cat√°logo" del CP active la opci√≥n
"Modo de compatibilidad V2.1".
A continuaci√≥n puede utilizar el CP en conexiones de Telecontrol que haya configurado a
trav√©s del editor "Datos de red".
Los datos de configuraci√≥n V3.0 se pueden cargar en el CP V2.1.
Con la opci√≥n activada no se soportan las funciones siguientes:
‚óè Conmutaci√≥n del tipo de protocolo
‚óè Recibir hora de estaci√≥n local y a trav√©s de NTP
‚óè "Comunicaci√≥n con la CPU > Diagn√≥stico CP"
‚óè Online y diagn√≥stico > "Funciones > Guardar datos de servicio"

Configuraci√≥n en el editor "Datos de red"
Para todos restantes los m√≥dulos de Telecontrol que no est√©n dentro del grupo mencionado,
configure las conexiones de Telecontrol en el editor "Datos de red".

1918

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El editor "Datos de red" se usa para los protocolos y m√≥dulos siguientes:
‚óè ST7
M√≥dulos sin datos de configuraci√≥n importados:
‚Äì CP 1243‚Äë8 IRC a partir de versi√≥n de firmware V3.0
‚Äì CP 1542SP‚Äë1 IRC a partir de versi√≥n de firmware V2.0
‚Äì TIM 1531 IRC a partir de versi√≥n de firmware V1.0
‚Äì TIM 3V-IE / TIM 4R-IE a partir de la versi√≥n de firmware V2.7
‚óè DNP3
‚Äì CP 1243‚Äë1 / CP 1243‚Äë8 IRC a partir de versi√≥n de firmware V3.0
‚Äì CP 1542SP‚Äë1 IRC a partir de versi√≥n de firmware V2.0
‚Äì TIM 1531 IRC a partir de versi√≥n de firmware V2.0
‚Äì TIM 3V-IE DNP3 / TIM 4R-IE DNP3 a partir de versi√≥n de firmware V3.2
‚óè IEC 60870-5
‚Äì CP 1243‚Äë1 / CP 1243‚Äë8 IRC a partir de versi√≥n de firmware V3.0
‚Äì CP 1542SP‚Äë1 IRC a partir de versi√≥n de firmware V2.0
‚Äì TIM 1531 IRC a partir de versi√≥n de firmware V2.0

Crear conexiones de Telecontrol
Requisitos para crear conexiones
Compruebe los requisitos siguientes antes de crear conexiones de Telecontrol:
‚óè Conexi√≥n en red
Los interlocutores de comunicaci√≥n afectados deben estar conectados en red.
‚óè Asignaci√≥n de la CPU
El m√≥dulo de comunicaci√≥n debe tener asignada una CPU.
Consulte la configuraci√≥n en el cap√≠tulo N√∫meros de dispositivos (P√°gina 1914).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1919

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Tipo de red de las interfaces
‚Äì Interfaces para conexiones entre m√≥dulo de comunicaci√≥n y CPU asignada
Las interfaces tienen el tipo de red "Neutro".
‚Äì Interfaces para conexiones entre dos m√≥dulos de comunicaci√≥n
Ajuste el tipo de red al protocolo de comunicaci√≥n correspondiente: ST7 / DNP3 /
IEC 60870‚Äë5
‚óè TIM 1531 IRC con CPU S7‚Äë1500R/H
Si se asigna el TIM 1531 IRC a una CPU S7‚Äë1500R/H, para la comunicaci√≥n del TIM con
la CPU se utiliza la direcci√≥n IP del sistema de la CPU S7‚Äë1500R/H. Despu√©s de crear una
conexi√≥n de Telecontrol se crea autom√°ticamente una conexi√≥n S7. El uso de la direcci√≥n
IP del sistema se reconoce en el cuadro de di√°logo de propiedades de la conexi√≥n S7, en
el editor "Datos de red" > ficha "Conexiones". Aqu√≠ se activa la opci√≥n para utilizar la
direcci√≥n IP del sistema en el ajuste predeterminado.
En las dos CPU, aseg√∫rese de que la direcci√≥n IP del sistema est√° configurada y de que las
m√°scaras de subred de las interfaces son id√©nticas.

Abrir el editor "Datos de red" > ficha "Telecontrol"
Para abrir el editor proceda del siguiente modo:
1. Abra la vista de redes del proyecto.
A la derecha encontrar√° sin desplegar el editor "Datos de red".

2. Abra el editor "Datos de red" con el s√≠mbolo de flecha.
Se muestra el editor con varias fichas; a la izquierda est√° situada la ficha "Vista general de
la red".
3. Arrastre hacia afuera el editor hasta que aparezca la ficha "TeleControl".
Esta ficha est√° subdividida en las siguientes fichas:
‚Äì ST7
‚Äì DNP3
‚Äì IEC
Seg√∫n el protocolo utilizado, seleccione la ficha correspondiente para configurar
conexiones de Telecontrol.

1920

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Visualizar y mostrar/ocultar columnas
En la tabla "Conexiones de Telecontrol" es posible mostrar, ocultar u organizar columnas y
optimizar su ancho. Haga clic con el bot√≥n derecho del rat√≥n en el encabezado de una columna
para acceder al men√∫ contextual.
‚óè Organizar columnas
Si se hace clic en el encabezado de una columna, es posible desplazar la columna dentro
de la tabla manteniendo pulsado el bot√≥n izquierdo del rat√≥n.
‚óè Mostrar/ocultar
Esta funci√≥n del men√∫ contextual permite mostrar u ocultar columnas individualmente.
Eso permite mantener una mejor perspectiva de la tabla.
‚óè Mostrar todas las columnas
Muestra todas las columnas de la tabla.
‚óè Optimizar ancho / Optimizar ancho de todas las columnas
Con estos men√∫s contextuales se optimiza el ancho de la columna seleccionada o bien de
todas las columnas de la tabla.
El ancho de la columna se adapta entonces a la entrada m√°s ancha de la columna.

Creaci√≥n de conexiones de Telecontrol
Para crear una conexi√≥n de Telecontrol, proceda del siguiente modo:
1. En la tabla "Conexiones de Telecontrol", haga doble clic en un campo de la primera fila
vac√≠a.
Se crea una nueva conexi√≥n vac√≠a. El nombre de la conexi√≥n se asigna por defecto.
2. Seleccione el punto de inicio de la conexi√≥n en la lista desplegable del campo "Punto de
inicio".
La lista desplegable del campo muestra los puntos de inicio posibles.
3. Para cambiar el nombre de la conexi√≥n, haga clic en el campo "Nombre".
Consulte tambi√©n el apartado siguiente.
4. Configure los par√°metros necesarios, como p. ej. interfaces y punto final de la conexi√≥n, en
los campos restantes.
Algunos campos de la tabla son editables, en otros el par√°metro se configura mediante una
lista desplegable.
Los campos sin configurar o configurados err√≥neamente se representan con fondo rojo; en el
ejemplo de la figura "TC_Connection_3".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1921

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-109

Editor "Datos de red", ficha "Telecontrol > ST7", ejemplo de conexiones ST7

En las fichas "DNP3" e "IEC", las conexiones se muestran de manera algo diferente, consulte
el cap√≠tulo espec√≠fico de protocolos en AUTOHOTSPOT.

Nombres de las conexiones
Es posible adaptar los nombres predeterminados de las conexiones.
Est√°n permitidos como m√°ximo 129 caracteres de los siguientes juegos de caracteres ASCII
(n√∫meros decimales):
‚óè N.¬∫ 32..126
espacio , ! " # $ % & ' ( ) * + , - . / : ; < = > ? @ [ \ ] ^ _ ` { | } ~
‚óè N.¬∫ 128, 130..140, 142, 145..156, 158..159, 161..172
‚Ç¨‚Äö∆í‚Äû‚Ä¶‚Ä†‚Ä°ÀÜ‚Ä∞≈†‚Äπ≈í≈Ω‚Äò‚Äô‚Äú‚Äù‚Ä¢‚Äì‚ÄîÀú‚Ñ¢≈°‚Ä∫≈ì≈æ≈∏¬°¬¢¬£¬§¬•¬¶¬ß¬®¬©¬™¬´¬¨
‚óè N.¬∫ 174..255
¬Æ¬Ø¬∞¬±¬≤¬≥¬¥¬µ¬∏¬π¬∫¬ª¬º¬Ω¬æ¬ø√Ä√Å√Ç√É√Ñ√Ö√Ü√á√à√â√ä√ã√å√ç√é√è√ê√ë√í√ì√î√ï√ñ√ó√ò√ô√ö√õ√ú
√ù√û√ü√†√°√¢√£√§√•√¶√ß√®√©√™√´√¨√≠√Æ√Ø√∞√±√≤√≥√¥√µ√∂√∑√∏√π√∫√ª√º√Ω√æ√ø

Definici√≥n de la V√≠a de conexi√≥n
Despu√©s de crear una conexi√≥n, generalmente a√∫n no est√° especificado el recorrido real de la
conexi√≥n. Especialmente en redes grandes a menudo hay varias v√≠as de conexi√≥n posibles.
Defina la v√≠a de conexi√≥n real de la conexi√≥n de Telecontrol creada mediante el s√≠mbolo
"Agregar nueva v√≠a de conexi√≥n".
Se abre el cuadro de di√°logo "Agregar v√≠as de conexi√≥n".

1922

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Encontrar√° m√°s detalles en los siguientes cap√≠tulos de conexiones de Telecontrol espec√≠ficos
de protocolos.

S√≠mbolos en el cuadro de di√°logo "Agregar v√≠as de conexi√≥n".
Para comprobar las conexiones configuradas puede ayudarse de la tabla "V√≠a de conexi√≥n".
En ella se muestra la v√≠a de conexi√≥n detallada para cada conexi√≥n configurada.
En la columna "Posici√≥n" se muestra un s√≠mbolo de estaci√≥n con un identificador para el punto
de conexi√≥n:
El color del identificador indica la validez del punto de conexi√≥n:
‚óè Azul: punto de conexi√≥n v√°lido
‚óè Rojo: punto de conexi√≥n no v√°lido
S√≠mbolo

Significado
Punto de inicio
Nodo ‚Äë entrada
Nodo ‚Äë salida
Punto final
Ejemplos de puntos de conexi√≥n no v√°lidos

Indicadores de error
En las tablas los puntos de conexi√≥n, redes o par√°metros defectuosos se marcan sobre fondo
rojo.
Las conexiones defectuosas pueden deberse, por ejemplo, a las siguientes causas:
‚óè Los puntos de inicio y final son id√©nticos.
‚óè La conexi√≥n se desarrolla a trav√©s de una red no permitida.
‚óè La conexi√≥n se desarrolla a trav√©s de un dispositivo no permitido.
Ejemplo de representaci√≥n:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1923

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-110

Conexi√≥n redundante con v√≠a de conexi√≥n configurada err√≥neamente (Route_2)

La v√≠a mostrada en la figura "Route_2" de una conexi√≥n ST7 se ha creado a trav√©s de una red
MSC no permitida. La integraci√≥n de la estaci√≥n PC en la red MSC se ha borrado, por lo que
la conexi√≥n de Telecontrol transcurre a trav√©s de estaciones que ya no existen.

1924

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Reglas generales para la configuraci√≥n de conexiones
Observe las siguientes reglas generales para la configuraci√≥n de conexiones:
‚óè Una conexi√≥n debe trascurrir a trav√©s de una √∫nica subred.
Si un "dispositivo de terceros" interlocutor est√° en otra subred, la transici√≥n de red entre las
subredes es el punto final de la configuraci√≥n de la conexi√≥n.
‚óè Todas las secciones de una conexi√≥n de Telecontrol deben configurarse con el mismo
protocolo de Telecontrol.
‚óè Una conexi√≥n que pasa por una red incoherente no es v√°lida.
Ejemplos:
‚Äì Dispositivos con tipos de nodo de red incompatibles (ejemplo: 2 maestros)
‚Äì Conexiones a trav√©s de nodos que no est√°n configurados como estaci√≥n nodo.
‚Äì Dispositivos con m√≥dems incompatibles
‚Äì Ajustes incompatibles de dos m√≥dems en una conexi√≥n
‚Äì Ajustes incompatibles entre par√°metros de m√≥dem y red
‚Äì No est√°n permitidas dos conexiones a un interlocutor a trav√©s de la misma interfaz de
un m√≥dulo.
‚Äì No es v√°lida una conexi√≥n que pasa por una red en la que dos m√≥dems de red de
marcaci√≥n anal√≥gicos (p. ej. MD3) se comunican entre s√≠ con el modo 1200 baudios /
semid√∫plex / modo AT.
Encontrar√° otras reglas espec√≠ficas de protocolos en los cap√≠tulos siguientes.

Borrar conexiones no v√°lidas o redundantes
Si existen conexiones no v√°lidas o redundantes no deseadas es necesario borrar una v√≠a de
conexi√≥n:
1. Seleccione la v√≠a de conexi√≥n no deseada en la tabla "V√≠as de conexi√≥n configuradas".
2. Haga clic en el men√∫ contextual "Borrar".

Ficha "Propiedades" de la conexi√≥n
Si en la tabla "Conexiones de Telecontrol" del editor "Datos de red" se selecciona una
conexi√≥n, en la ficha "Propiedades" de la ventana de inspecci√≥n, se mostrar√°n otros grupos de
par√°metros de esa conexi√≥n. Aqu√≠ es posible comprobar y, en caso necesario, corregir la
configuraci√≥n de la conexi√≥n, y configurar otras propiedades.
Grupos de par√°metros:
‚óè General
Muestra las propiedades fundamentales de la conexi√≥n de Telecontrol.
Es posible cambiar el nombre de la conexi√≥n y el n√∫mero de dispositivo / la direcci√≥n de
estaci√≥n de los puntos de inicio y final. Eso repercute en los datos de configuraci√≥n de los
dispositivos.
‚óè Otros par√°metros espec√≠ficos de protocolo
Encontrar√° la descripci√≥n a continuaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1925

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Conexiones ST7
Reglas espec√≠ficas de ST7 para la configuraci√≥n de conexiones
Observe las siguientes reglas especiales para la configuraci√≥n de conexiones:
‚óè Una conexi√≥n MSC solo puede funcionar a trav√©s de la primera interfaz Ethernet [X1] de un
TIM o a trav√©s de de la interfaz serie de un m√≥dulo con el ajuste "Basada en IP".
‚óè Las conexiones entre una aplicaci√≥n PC y un m√≥dulo solo pueden ser del tipo de red
"Neutro" (conexiones S7).
‚óè Para conexiones entre una aplicaci√≥n PC redundante y un m√≥dulo es necesario crear dos
conexiones.
Cree en STEP 7 dos estaciones PC con una aplicaci√≥n ST7cc cada una para una central
de control ST7cc redundante.
Es la √∫nica forma de configurar una conexi√≥n de cada aplicaci√≥n.

Creaci√≥n de conexiones ST7
Para la comunicaci√≥n entre dos estaciones ST7 a trav√©s de redes WAN cl√°sicas (l√≠nea
dedicada, red de marcaci√≥n) se necesita como m√≠nimo una conexi√≥n de Telecontrol.
En el campo "Punto de inicio" se muestran los siguientes puntos de inicio configurables:
‚óè Estaciones S7: CPU asignadas
‚óè Estaciones PC: aplicaci√≥n (por ejemplo ST7cc / ST7sc)
Para conexiones entre una aplicaci√≥n en el PC central y una estaci√≥n S7 seleccione siempre
la aplicaci√≥n como punto de inicio, puesto que solo se puede seleccionar en la lista de puntos
de inicio.
Haga clic en el s√≠mbolo "Agregar nueva v√≠a de conexi√≥n".
Se abre el cuadro de di√°logo "Agregar v√≠as de conexi√≥n", en el que se buscan las v√≠as de
conexi√≥n posibles. Las v√≠as de conexi√≥n detectadas se muestran en la tabla "Seleccione una
v√≠a de conexi√≥n ...".
En el caso de las conexiones ST7, debajo de la tabla "Conexiones de Telecontrol" se abre la
tabla "V√≠as de conexi√≥n configuradas". Esta contiene la v√≠a de conexi√≥n agregada para cada
una de las conexiones seleccionadas.
En el caso de las conexiones redundantes se muestran ambas v√≠as.

1926

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-111

Editor "Datos de red", ficha "Telecontrol"

En la tercera tabla "V√≠a de conexi√≥n" se muestran detalles sobre la v√≠a seleccionada.

Definici√≥n de la v√≠a de conexi√≥n
Defina la v√≠a de conexi√≥n real de la conexi√≥n de Telecontrol creada procediendo de la forma
siguiente.
1. Seleccione una conexi√≥n en la tabla "Conexiones de Telecontrol".
2. Haga clic en el s√≠mbolo "Agregar nueva v√≠a de conexi√≥n".
Se abre el cuadro de di√°logo "Agregar v√≠as de conexi√≥n".
Se buscan autom√°ticamente las v√≠as de conexi√≥n posibles, y el progreso de la b√∫squeda
se muestra en la barra de progreso que aparece en la parte inferior del cuadro de di√°logo.
El estado y el resultado de la b√∫squeda se muestran en el campo "Informaci√≥n".
Las v√≠as de conexi√≥n encontradas se muestran en la tabla "Seleccione una v√≠a de
conexi√≥n ...".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1927

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
3. Seleccione una de las posibles v√≠as de conexi√≥n.
Los detalles de la v√≠a de conexi√≥n seleccionada se muestran en la tabla "V√≠a de conexi√≥n".
La tabla "Vista preliminar" contiene m√°s detalles sobre todos los puntos de conexi√≥n
implicados en la v√≠a de conexi√≥n seleccionada.
‚Äì Si en la tabla "Seleccione una v√≠a de conexi√≥n ..." se muestran varias conexiones, es
posible seleccionar una o dos conexiones redundantes para la selecci√≥n de la v√≠a de
conexi√≥n que se va a utilizar.
‚Äì Si en la tabla no se muestra ninguna conexi√≥n, existe un error de configuraci√≥n en las
estaciones o redes correspondientes.
En ese caso, cierre el cuadro de di√°logo con el bot√≥n "Cerrar" y complete la
configuraci√≥n.
4. Seleccione una v√≠a de conexi√≥n y haga clic en "Agregar" para agregar esa v√≠a al proyecto
como conexi√≥n configurada.
En "Informaci√≥n" se indica si se ha agregado la conexi√≥n o si esta ya est√° configurada.
5. Si procede, seleccione una segunda v√≠a de conexi√≥n y haga clic en "Agregar" para agregar
esa v√≠a al proyecto como conexi√≥n redundante.
6. Cierre el cuadro de di√°logo con el bot√≥n "Cerrar" si las v√≠as de conexi√≥n agregadas
coinciden con las especificaciones del proyecto.

Creaci√≥n de conexiones ST7 redundantes
Si en la configuraci√≥n de red se han creado diferentes redes entre dos dispositivos, se
mostrar√°n las diferentes v√≠as de conexi√≥n.
> Cuadro de di√°logo "Agregar v√≠as de conexi√≥n" > Tabla "Seleccione una v√≠a de conexi√≥n ..."
Si solo se desea utilizar una v√≠a de conexi√≥n, hay que marcar en la tabla solo esa v√≠a y hacer
clic en "Agregar".
Para utilizar dos v√≠as de conexi√≥n redundantes para la conexi√≥n ST7, seleccione ambas v√≠as
una tras otra y haga clic en "Agregar" para cada una de ellas.
Al cerrar el cuadro de di√°logo "Agregar v√≠as de conexi√≥n" en la tabla "Conexiones
configuradas" se muestran ambas v√≠as para la conexi√≥n en cuesti√≥n.
La primera de las dos es la v√≠a principal y la segunda la v√≠a sustitutiva. As√≠ se indica en la
columna "Prioridad" de la tabla "Conexiones configuradas".
1. V√≠a principal
2. V√≠a sustitutiva
La prioridad de ambas v√≠as de conexi√≥n (v√≠a principal/v√≠a sustitutiva) puede modificarse
posteriormente. Para ello sirven las teclas con flechas:

1928

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ficha "Propiedades" de las conexiones
Para m√°s informaci√≥n sobre el grupo de par√°metros "General" consulte el cap√≠tulo Crear
conexiones de Telecontrol (P√°gina 1919).
‚óè ST7cc/sc redundante
Si en el proyecto se utiliza una central de control redundante (por ejemplo, ST7cc o ST7sc),
primero es necesario crear dos estaciones PC y las conexiones entre el m√≥dulo y ambas
aplicaciones.
Solo a continuaci√≥n se define aqu√≠ la uni√≥n redundante para la conexi√≥n con la uni√≥n
redundante.
‚Äì Agregar interlocutor ST7cc/sc redundante
‚Äì Active la opci√≥n para cada una de las dos conexiones entre la aplicaci√≥n redundante y
el m√≥dulo.
‚Äì Aplicaci√≥n redundante
En la lista desplegable "Aplicaci√≥n redundante" seleccione la aplicaci√≥n deseada.
‚óè Propiedades del dispositivo de destino
Este grupo de par√°metros se refiere al dispositivo de destino que se ha configurado como
punto final de la conexi√≥n.
‚Äì Tiempo de vigilancia de la consulta general
Es el tiempo m√°ximo que puede necesitar un dispositivo de destino (m√≥dulo de
comunicaci√≥n compatible con ST7) para una respuesta completa a la consulta general
(GA) de la central.
Si el interlocutor que ha realizado la consulta general no ha recibido la respuesta a la
consulta transcurrido el tiempo de vigilancia, se registra un aviso en el b√∫fer de
diagn√≥stico del m√≥dulo.
El tiempo de vigilancia de la consulta general es b√°sicamente de 900 segundos.
‚Äì Telegramas para dispositivo de destino con sello de tiempo
Con independencia de la configuraci√≥n, todos los telegramas se enviar√°n al dispositivo
de destino con sello de tiempo.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1929

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Conexiones DNP3 e IEC
Posibilidades de comunicaci√≥n
V√≠as de comunicaci√≥n
Son posibles las v√≠as de comunicaci√≥n siguientes:
‚óè Conexiones entre maestro y estaci√≥n
‚óè Conexiones redundantes
Si hay accesibles dos dispositivos a trav√©s de v√≠as o redes diferentes, para establecer una
redundancia de v√≠as se pueden crear como m√°ximo dos conexiones entre los dispositivos.
Algunos m√≥dulos soportan la configuraci√≥n de un tercer maestro cuando se utiliza el
protocolo DNP3. Consulte la configuraci√≥n en Configuraci√≥n de conexiones DNP3/IEC
(P√°gina 1931).
‚óè Comunicaci√≥n directa
Para la comunicaci√≥n directa entre dos estaciones pueden configurarse conexiones
Ethernet sencillas. El tipo de nodo de red de la interfaz est√° configurado como "estaci√≥n" en
los dos m√≥dulos de comunicaci√≥n. Los telegramas no deben provenir necesariamente de
una central.
Requisitos:
‚Äì En la configuraci√≥n de puntos de datos, active la opci√≥n "Funci√≥n de maestro" en los
puntos de datos que desee utilizar para la comunicaci√≥n directa.
Para el direccionamiento, indique como interlocutor el punto de datos deseado de la
estaci√≥n del interlocutor.
‚Äì En la conexi√≥n de Telecontrol est√° activada la opci√≥n "Espont√°neo".
La comunicaci√≥n directa se soporta entre los m√≥dulos siguientes.
STEP 7 V15.1:
‚Äì CP 1243‚Äë1 V3.1
‚Äì CP 1243‚Äë8 IRC V3.1
‚Äì CP 1542SP‚Äë1 IRC V2.0
‚Äì TIM 1531 IRC V2.0
‚Äì TIM 3V‚ÄëIE DNP3 V3.2
‚Äì TIM 4R‚ÄëIE DNP3 V3.2
STEP 7 V16:
‚Äì CP 1243‚Äë1 V3.2
‚Äì CP 1243‚Äë8 IRC V3.2
‚Äì CP 1542SP‚Äë1 IRC V2.1
‚Äì TIM 1531 IRC V2.1
‚Äì Dispositivo de terceros
‚Äì TIM 3V‚ÄëIE DNP3 V3.2
‚Äì TIM 4R‚ÄëIE DNP3 V3.2

1930

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuraci√≥n de conexiones DNP3/IEC
Reglas espec√≠ficas para conexiones DNP3 e IEC
Observe las siguientes reglas especiales para la configuraci√≥n de conexiones:
‚óè Conexiones entre dispositivos de STEP 7
Es posible crear conexiones entre dispositivos configurados en el proyecto STEP 7.
Los datos de direcciones e interfaces de los dos dispositivos est√°n disponibles en la tabla
de conexiones.
‚óè Conexiones con dispositivos de terceros
Es posible crear conexiones entre un dispositivo configurado en STEP 7 y un "dispositivo
de terceros" que no est√© configurado en STEP 7.
El dispositivo que no est√° configurado en STEP 7 se muestra como "Dispositivo de
terceros" en el campo "Punto final" de la tabla de conexiones. Los datos de direcci√≥n de ese
dispositivo se configuran a trav√©s de los datos de direcci√≥n reales (direcci√≥n IP / n√∫mero de
tel√©fono).
‚óè Conexiones v√≠a transiciones de red
Es posible configurar conexiones sencillas y redundantes con dispositivos de otras
subredes a los que se puede acceder a trav√©s de una transici√≥n de red. Para ello se dispone
de los campos correspondientes de la tabla de conexiones.
‚óè Conexiones para la comunicaci√≥n directa
Para la comunicaci√≥n directa entre dos estaciones pueden utilizarse conexiones Ethernet
sencillas.
Una conexi√≥n sencilla o redundante entre estaci√≥n central y estaci√≥n no puede emplearse
para la comunicaci√≥n directa.
Encontrar√° m√°s detalles en Posibilidades de comunicaci√≥n (P√°gina 1930).
‚óè Cambiar puntos finales
En las conexiones creadas no est√° permitido cambiar un solo punto final.
Si desea corregir el punto final de una conexi√≥n, corrija los puntos finales de las secciones
de conexi√≥n con coherencia o borre la conexi√≥n y cree una nueva.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1931

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Definici√≥n de la v√≠a de conexi√≥n sencilla o redundante
Defina la v√≠a de conexi√≥n real de la conexi√≥n de Telecontrol creada procediendo de la forma
siguiente.
1. Seleccione una conexi√≥n en la tabla "Conexiones de Telecontrol".
2. Haga clic en el s√≠mbolo "Agregar nueva v√≠a de conexi√≥n".
Se abre el cuadro de di√°logo "Agregar v√≠as de conexi√≥n".
Se buscan autom√°ticamente las v√≠as de conexi√≥n posibles, y el progreso de la b√∫squeda
se muestra en la barra de progreso que aparece en la parte inferior del cuadro de di√°logo.
‚Äì El estado y el resultado de la b√∫squeda se muestran en el campo "Informaci√≥n".
‚Äì Las v√≠as de conexi√≥n encontradas se muestran en la tabla superior "Seleccione una v√≠a
de conexi√≥n ...".
‚Äì Los detalles de una v√≠a de conexi√≥n seleccionada se muestran en la tabla "V√≠a de
conexi√≥n".
‚Äì Al seleccionar una v√≠a de conexi√≥n, haciendo clic en "Agregar", en la tabla "Vista
preliminar" se muestran los puntos de conexi√≥n de la v√≠a de conexi√≥n seleccionada que
se han aplicado en el editor de conexiones.
3. Seleccione la v√≠a o las v√≠as de conexi√≥n deseadas.
‚Äì Cuando en la tabla superior se muestre una o varias v√≠as de conexi√≥n, seleccione la v√≠a
de conexi√≥n deseada y haga clic en "Agregar".
En "Informaci√≥n" se indica si se ha agregado la v√≠a de conexi√≥n o si ya est√° configurada.
Si se desea utilizar una v√≠a de conexi√≥n redundante, hay que marcar en la tabla una
segunda v√≠a y hacer clic en "Agregar".
Cierre el cuadro de di√°logo con el bot√≥n "Cerrar" si las v√≠as de conexi√≥n agregadas
coinciden con las especificaciones del proyecto.
‚Äì Si en la tabla no se muestra ninguna conexi√≥n, existe un error de configuraci√≥n en las
estaciones o redes correspondientes.
En ese caso, cierre el cuadro de di√°logo con el bot√≥n "Cerrar" y complete la
configuraci√≥n.

Configurar espec√≠ficamente para cada interfaz las secciones de conexi√≥n

Figura 1-112

1932

Tabla de conexiones (DNP3 / IEC): Editor "Datos de red", ficha "Telecontrol"

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Una secci√≥n de conexi√≥n con dos filas
Las secciones de conexi√≥n entre las interfaces de dos dispositivos se muestran en filas
independientes. Ejemplo de una conexi√≥n entre el m√≥dulo 1 y el m√≥dulo 2:
‚óè Secci√≥n 1
M√≥dulo 1 ‚áí m√≥dulo 2
‚óè Secci√≥n 2
M√≥dulo 2 ‚áí m√≥dulo 1
Para las dos secciones de conexi√≥n pueden configurarse ajustes individuales.
Una secci√≥n para varias conexiones
Los conexiones DNP3 e IEC puede transcurrir a trav√©s de varios dispositivos. Una secci√≥n de
conexi√≥n entre dos dispositivos puede utilizarse para varias conexiones.
Una secci√≥n de conexi√≥n entre dos dispositivos utilizada para varias conexiones solo aparece
una vez en la tabla de conexiones.
Estaciones nodo
En la figura anterior, la estaci√≥n "15_3_node" es una estaci√≥n nodo situada en la jerarqu√≠a de
la instalaci√≥n entre la central (15_4) y la estaci√≥n (15_6). Las particularidades de las estaciones
nodo se describen con el par√°metro "Lista de interlocutores" en la tabla de conexiones
correspondiente; v√©ase m√°s abajo.
Filtros
En la columna "Punto de inicio" de la figura est√° ajustado el filtro "15_". Solo se muestran
conexiones cuyo punto de inicio empiece por "15_". Consulte el significado de los filtro en Filtro
de la tabla de conexiones (P√°gina 1936).

DNP3: conexiones de una estaci√≥n con tres maestros
Funci√≥n
En caso de conexi√≥n a una central de control redundante, algunos m√≥dulos configurados como
Outstation pueden establecer una conexi√≥n con un tercer maestro, siempre que uno de los dos
primeros maestros salga del grupo de redundancia. En tiempo de ejecuci√≥n, un m√≥dulo puede
establecer como m√°ximo 2 conexiones simult√°neas con maestros.
La funci√≥n es soportada por los m√≥dulos siguientes:
‚óè TIM 1531 IRC V2.1
‚óè CP 1542SP-1 IRC V2.1
‚óè CP 1243-1 V3.2
‚óè CP 1243-8 IRC V3.2
En la configuraci√≥n de la estaci√≥n, cree una estaci√≥n S7 con CPU y m√≥dulo de comunicaci√≥n
de la forma habitual. No cree estaciones para los tres maestros. Se configuran en el editor de
las conexiones de Telecontrol como "Dispositivo de terceros".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1933

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Requisitos en la configuraci√≥n
‚óè Desactivaci√≥n del par√°metro "Comprobaci√≥n de direcci√≥n IP"
En el m√≥dulo de comunicaci√≥n, abra el grupo de par√°metros "Interfaz Ethernet > Opciones
avanzadas > Ajustes de estaci√≥n DNP3".
Ponga la opci√≥n "Comprobaci√≥n de direcci√≥n IP" a "No comprobar la direcci√≥n IP".
Con este ajuste, la direcci√≥n IP del interlocutor de la comunicaci√≥n no se comprueba. De
este modo se garantiza que todos los dispositivos de la red que est√°n configurados con la
direcci√≥n de estaci√≥n DNP3 del maestro puedan comunicarse con el m√≥dulo de
comunicaci√≥n independientemente de su direcci√≥n IP.
Configuraci√≥n de las conexiones de Telecontrol
En la Task Card "Datos de red > TeleControl > DNP3", cree dos conexiones DNP3 con el
m√≥dulo de comunicaci√≥n.
Las dos secciones de conexi√≥n son pr√°cticamente id√©nticas, solo se distinguen por la
configuraci√≥n del par√°metro "Interfaz final (red.)":
‚óè Section_1
‚Äì Punto de inicio: m√≥dulo de comunicaci√≥n (outstation)
‚Äì Interfaz inicial: interfaz Ethernet del m√≥dulo
‚Äì Interfaz inicial (red.): interfaz Ethernet del m√≥dulo
‚Äì Punto final: dispositivo de terceros
‚Äì Interfaz final: direcci√≥n IP de la interfaz del maestro 1
‚Äì Interfaz final (red.): direcci√≥n IP de la interfaz del maestro 2
‚óè Section_2
‚Äì Punto de inicio: m√≥dulo de comunicaci√≥n (outstation)
‚Äì Interfaz inicial: interfaz Ethernet del m√≥dulo
‚Äì Interfaz inicial (red.): interfaz Ethernet del m√≥dulo
‚Äì Punto final: dispositivo de terceros
‚Äì Interfaz final: direcci√≥n IP de la interfaz del maestro 1
‚Äì Interfaz final (red.): direcci√≥n IP de la interfaz del maestro 3
La figura muestra un ejemplo de esta configuraci√≥n de la conexi√≥n.

Figura 1-113

Configuraci√≥n de conexiones de una estaci√≥n con 3 maestros redundantes

Los tres maestros obtienen la misma direcci√≥n de estaci√≥n DNP3 ("dispositivo final"); en el
ejemplo de la figura "0".

1934

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las direcciones IP que se ven en la figura est√°n asignadas a las siguientes interfaces:
‚óè 192.168.0.1
Direcci√≥n IP del maestro 1
‚óè 192.168.0.2
Direcci√≥n IP del maestro 2
‚óè 192.168.0.3
Direcci√≥n IP del maestro 3
Seleccione la fila de la primera conexi√≥n. En el cuadro de di√°logo de propiedades de la
conexi√≥n, seleccione el grupo de par√°metros "Par√°metros de dispositivo de terceros" y ajuste
el tipo de nodo de red del dispositivo de terceros a "Estaci√≥n central" para ambas v√≠as.
Elija los mismos ajustes para la segunda conexi√≥n (segunda fila).

Par√°metros de las conexiones DNP3
Encontrar√° la descripci√≥n de los par√°metros en el cap√≠tulo Tabla de conexiones - DNP3
(P√°gina 1937).

Par√°metros de las conexiones IEC
Encontrar√° la descripci√≥n de los par√°metros en el cap√≠tulo Tabla de conexiones - IEC
(P√°gina 1941).

Ficha "Propiedades" de la conexi√≥n
‚óè General
Consulte Crear conexiones de Telecontrol (P√°gina 1919).
‚óè Vigilancia de conexi√≥n TCP
Encontrar√° informaci√≥n en los tooltips de los par√°metros.
‚óè Opciones de seguridad DNP3
Consulte Opciones de seguridad DNP3 (P√°gina 2013).
‚óè Ajustes de transferencia DNP3
Consulte Tabla de conexiones - DNP3 (P√°gina 1937).
‚óè Opciones 1.¬™ v√≠a / Opciones 2.¬™ v√≠a
Consulte Opciones (IEC) (P√°gina 1946).
‚óè Par√°metros de dispositivos de terceros
Consulte Par√°metros de dispositivos de terceros (P√°gina 1946).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1935

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Filtro de la tabla de conexiones
Filtros

Figura 1-114

Tabla de conexiones (aqu√≠: IEC)

En las tablas de las conexiones DNP3 e IEC, la primera fila por debajo del encabezado de la
tabla sirve de filtro.
La funci√≥n de filtro permite seleccionar los dispositivos configurables y limitar las posibilidades
de conexi√≥n. De este modo se reducen las combinaciones posibles y aumenta la claridad.
Si se han creado algunas secciones de conexi√≥n, active el filtro tecleando un string repetitivo
(componente del nombre) en la celda de filtro.
La celda del filtro se marca en color. En la tabla se muestran ahora √∫nicamente las seccione
de conexi√≥n que contienen este string en la columna correspondiente.
Los filtros pueden aplicarse a las columnas siguientes:
‚óè Nombre de la conexi√≥n
‚óè Punto de inicio / Dispositivo inicial
‚óè Punto final / Dispositivo final
La selecci√≥n "*" en la celda de filtro elimina el filtro. En este caso, se vuelven a mostrar todas
las secciones de conexi√≥n existentes.
Filtros m√∫ltiples
‚óè Varios filtros en una columna
Existe la posibilidad de aplicar varios filtros a una columna (p. ej. "15_" y "12_"). En este
caso, solo se mostrar√°n las secciones de conexi√≥n cuyo nombre contenga los strings "15_"
y "12_".
Los diferentes filtros se separan dentro de la celda con un punto y coma. Ejemplo de
entrada: 12_;15_
‚óè Filtros en varias columnas
Es posible activar simult√°neamente filtros en varias columnas.
Los filtros en varias columnas se multiplican.

Ejemplo
En una tabla de conexiones se han creado conexiones con puntos de inicio que contienen los
strings "12_...", "PLC_..." y "15_...".

1936

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En la celda de filtro del punto de inicio se ha introducido "15_"; v√©ase la figura anterior.
En la tabla solo se muestran las secciones de conexi√≥n cuyos puntos de inicio contienen este
string parcial: "15_3...", "15_4...", "15_6". etc.

Tabla de conexiones - DNP3
En la tabla de conexiones se configuran los par√°metros de las diferentes secciones de
conexi√≥n.
Si los par√°metros ya est√°n asignados en la configuraci√≥n, los valores se aplican en las
columnas correspondientes de la tabla de conexiones. En caso de diferencias entre los valores
configurados, tienen prioridad los valores de la tabla de conexiones.

Par√°metros para v√≠as de conexi√≥n redundantes
En el caso de que haya configuradas v√≠as de conexi√≥n redundantes, estas se configuran igual
que las v√≠as principales.
Los par√°metros de las v√≠as de conexi√≥n redundantes se distinguen mediante el sufijo siguiente:
‚óè * (red)
Ejemplo:
‚óè Interfaz inicial (red.)
Interfaz del m√≥dulo del punto de inicio a trav√©s de la que transcurre la conexi√≥n redundante.
Los par√°metros de las v√≠as de conexi√≥n redundantes tienen las mismas funciones que los de
las v√≠as principales. En la descripci√≥n siguiente solo se indican los par√°metros de las v√≠as
principales.

Par√°metros atenuados
Los par√°metros atenuados no pueden configurarse por uno de los motivos siguientes:
‚óè Hay un valor fijo preasignado que es v√°lido en general o que est√° configurado en otro lugar.
‚óè No se admiten valores alternativos.
Ejemplo: El punto final de la conexi√≥n es el maestro. Los par√°metros siguientes no pueden
configurarse:
‚Äì "Espont√°neo"
Es un par√°metro de estaci√≥n.
‚Äì "Dispositivo final"
En m√≥dulos del proyecto se aplica la direcci√≥n de estaci√≥n de la configuraci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1937

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros
‚óè Nombre
Es posible adaptar el nombre predeterminado de la secci√≥n de conexi√≥n entre dos
dispositivos.
Consulte a este respecto el cap√≠tulo Crear conexiones de Telecontrol (P√°gina 1919).
‚óè Punto de inicio
Seleccione en la lista desplegable el punto de inicio deseado de la conexi√≥n.
‚Äì El punto de inicio de una conexi√≥n es siempre una CPU.
‚óè Dispositivo inicial
Direcci√≥n de estaci√≥n del punto de inicio
‚óè Interfaz inicial
Interfaz del m√≥dulo del punto de inicio a trav√©s de la que transcurre la conexi√≥n.
‚óè Punto final
Seleccione el punto final de la conexi√≥n.
Pueden ser puntos finales de la conexi√≥n:
‚Äì una CPU
‚Äì un dispositivo de terceros
El tipo de nodo de red de dispositivos de terceros se configura en el grupo de par√°metros
de la conexi√≥n, consulte el cap√≠tulo Par√°metros de dispositivos de terceros
(P√°gina 1946).
‚óè Dispositivo final
Direcci√≥n de estaci√≥n del punto final

1938

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Lista de interlocutores
Al seleccionar un interlocutor de la conexi√≥n ("Punto final") que se encuentra en el proyecto
STEP 7, su direcci√≥n de estaci√≥n ("Dispositivo final") se registra autom√°ticamente en la lista
de interlocutores.
Nota
Entradas manuales
En los casos siguientes deben agregarse manualmente las direcciones de estaci√≥n:
‚óè Dispositivo de terceros
En un dispositivo de terceros que no est√° configurado en el proyecto de STEP 7, la
direcci√≥n de estaci√≥n debe introducirse manualmente.
‚óè Estaci√≥n nodo
La lista de interlocutores de una secci√≥n de conexi√≥n que transmite datos de y a otras
estaciones debe contener la direcci√≥n de estaci√≥n de todos los interlocutores. En las
secciones de conexi√≥n, esto sucede cuando un dispositivo es una estaci√≥n nodo. Aqu√≠
deben agregarse manualmente las direcciones de estaci√≥n de los dem√°s interlocutores.
Introduzca las direcciones de estaci√≥n ("Dispositivo final") separadas por coma.
Encontrar√° un ejemplo de una estaci√≥n nodo en la figura del cap√≠tulo Configuraci√≥n de
conexiones DNP3/IEC (P√°gina 1931). Deben configurarse tres estaciones:
‚Äì Maestro
Nombre: "15_4", direcci√≥n de estaci√≥n: "1"
‚Äì Estaci√≥n nodo
Nombre: "15_3_node", direcci√≥n de estaci√≥n: "2"
‚Äì Estaci√≥n
Nombre: "15_6", direcci√≥n de estaci√≥n: "3"
Explicaci√≥n:
‚Äì Secci√≥n de conexi√≥n "_5"
La secci√≥n de conexi√≥n "_5" va del maestro a la estaci√≥n nodo. La direcci√≥n de estaci√≥n
"2" de la estaci√≥n nodo se registra autom√°ticamente en la lista de interlocutores.
Sin embargo, puesto que por la secci√≥n de conexi√≥n tambi√©n deben transmitirse los
datos de y a la estaci√≥n "15_6" (v√©ase la conexi√≥n "_6"), la direcci√≥n de estaci√≥n "3"
debe agregarse manualmente.
‚Äì Secci√≥n de conexi√≥n "_6"
Lo mismo es v√°lido para la secci√≥n de conexi√≥n "_6" entre estaci√≥n y estaci√≥n nodo, por
la que deben transmitirse los datos de y al maestro.
Aqu√≠ deben introducirse las siguientes direcciones de estaci√≥n:
‚Äë "1" para el dispositivo final de la conexi√≥n "_3"
‚Äë "2" para el dispositivo final de la conexi√≥n "_3"
‚óè Interfaz final/direcci√≥n
Interfaz del m√≥dulo de punto final
En un dispositivo de terceros que no est√° configurado en el proyecto STEP 7, los siguientes
datos deben introducirse manualmente:
‚Äì Conexi√≥n Ethernet: direcci√≥n IP del punto final
‚Äì Conexi√≥n de l√≠nea dedicada: direcci√≥n de estaci√≥n del punto final
‚Äì Conexi√≥n de red de marcaci√≥n: n√∫mero de tel√©fono del punto final

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1939

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Nivel DNP3
Indicaci√≥n del nivel de conformidad DNP3 (DNP3 implementation level) soportado por el
interlocutor: Level 1, 2, 3, 4 y Level 4+
El nivel de conformidad denominado Level 4+ incluye el volumen de funciones de Level 4
m√°s la compatibilidad con otros tipos de datos / variaciones; v√©anse los tipos de puntos de
datos en el cap√≠tulo Tipos de puntos de datos (P√°gina 1956).
‚óè Puerto final
N√∫mero del puerto Listener del interlocutor
En el ajuste predeterminado, para todos los interlocutores se introduce el valor est√°ndar
20000. El valor puede modificarse. Con dispositivos de terceros es necesario introducir el
n√∫mero de puerto.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 20000
‚óè Tiempo de vigilancia del interlocutor
Si el m√≥dulo de la estaci√≥n no recibe ninguna se√±al de vida del maestro a nivel de aplicaci√≥n
dentro del tiempo configurado, clasifica la conexi√≥n como fallida y deshace la conexi√≥n.
Tras el env√≠o de datos, el m√≥dulo maestro espera durante el tiempo configurado una
respuesta de la estaci√≥n.
Con el valor 0 (cero) la funci√≥n est√° desactivada.
Consulte el par√°metro "Tiempo de vigilancia del interlocutor", cap√≠tulo Ajustes de
transferencia - DNP3 (P√°gina 2008).
‚óè Protocolo de transporte
Relevante para todos los tipos de dispositivo
Seleccione el protocolo de transporte:
‚Äì TCP
‚Äì UDP
‚óè Espont√°neo
Modo de transferencia para eventos
‚Äì S√≠: los telegramas de eventos se transfieren inmediatamente.
‚Äì No: los telegramas de eventos no se transfieren hasta que el maestro consulta los datos.
Sobre el par√°metro, consulte el cap√≠tulo Ajustes de estaci√≥n DNP3 (P√°gina 2011).
‚óè Sondeo de eventos
Relevante para maestro, dispositivo de terceros (maestro)
El "intervalo de sondeo de eventos" determina en qu√© ciclo la central DNP3 debe consultar
eventos de la estaci√≥n. El intervalo se indica como m√∫ltiplo del "intervalo b√°sico de sondeo"
del maestro; consulte Ajustes de la funci√≥n de maestro DNP3 (P√°gina 2010).
‚óè Sondeo de clase 0
Relevante para maestro, dispositivo de terceros (maestro)
El Intervalo de sondeo de clase 0 determina en qu√© ciclo la central DNP3 consulta datos de
clase 0 de la memoria imagen de la estaci√≥n. El intervalo se indica como m√∫ltiplo del
par√°metro "intervalo b√°sico de sondeo" del maestro; consulte Ajustes de la funci√≥n de
maestro DNP3 (P√°gina 2010).
El valor configurado en la estaci√≥n se transmite a la central, donde se guarda.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 1
Con el valor 0 (cero) la funci√≥n est√° desactivada; los datos de clase 0 no se transfieren
c√≠clicamente.

1940

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Duraci√≥n m√°x. de sondeo
Relevante para maestro, dispositivo de terceros (maestro)
Indica el intervalo m√°ximo durante el cual la central puede llamar esta estaci√≥n de forma
continuada. Aunque en la estaci√≥n siga habiendo datos pendientes de transferir una vez
transcurrido este tiempo, se cancelar√°n las llamadas por parte de la central. De este modo,
la central est√° disponible de nuevo para otras estaciones.
El valor configurado en la estaci√≥n se transmite a la central, donde se guarda.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 10
Con 0 (cero) la funci√≥n est√° desactivada, es decir, el intervalo de llamada es ilimitado.
‚óè Modo de sondeo
Relevante para maestro, dispositivo de terceros (maestro)
Modo con el que la central llama la estaci√≥n.
El valor configurado en la estaci√≥n se transmite a la central, donde se guarda.
Rangos de valores:
‚Äì C√≠clico
La estaci√≥n se llama c√≠clicamente. El intervalo de tiempo del ciclo de sondeo es igual al
"Intervalo de sondeo de clase 0"; v√©ase m√°s arriba.
‚Äì Tras el arranque
La estaci√≥n se consulta solo despu√©s del primer arranque y tras un rearranque completo.
Si para una estaci√≥n no est√° activada la transferencia espont√°nea, al seleccionar esta
opci√≥n no se transfieren datos durante el funcionamiento.
‚óè Temporal
Relevante para interlocutores con conexiones temporales (p. ej. RTU)
Active esta opci√≥n si el interlocutor soporta conexiones temporales que pueda deshacer por
s√≠ mismo. En tal caso cuando el interlocutor deshace la conexi√≥n no se interpreta como
interrupci√≥n de la conexi√≥n.
Por ejemplo, el interlocutor puede ser una RTU3000C en la que est√© activada la opci√≥n
"Conexi√≥n temporal".

Ficha "Propiedades" de la conexi√≥n
Ajustes de transferencia DNP3
‚óè Forma de transmisi√≥n
Relevante para estaci√≥n, dispositivo de terceros (estaci√≥n)
Define el orden de transferencia de eventos a la central DNP3.
‚Äì Espec√≠fico de tipo
Transferencia agrupada por tipos de datos
‚Äì Cronol√≥gico
Transferencia cronol√≥gica por sello de tiempo

Tabla de conexiones - IEC
En la tabla de conexiones se configuran los par√°metros de las diferentes secciones de
conexi√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1941

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si los par√°metros ya est√°n asignados en la configuraci√≥n, los valores se aplican en las
columnas correspondientes de la tabla de conexiones. En caso de diferencias entre los valores
configurados, tienen prioridad los valores de la tabla de conexiones.

Par√°metros para v√≠as de conexi√≥n redundantes
En el caso de que haya configuradas v√≠as de conexi√≥n redundantes, estas se configuran igual
que las v√≠as principales.
Los par√°metros de las v√≠as de conexi√≥n redundantes se distinguen mediante el sufijo siguiente:
‚óè * (red)
Ejemplo:
‚óè Interfaz inicial (red.)
Interfaz del m√≥dulo del punto de inicio a trav√©s de la que transcurre la conexi√≥n redundante.
Los par√°metros de las v√≠as de conexi√≥n redundantes tienen las mismas funciones que los de
las v√≠as principales. En la descripci√≥n siguiente solo se indican los par√°metros de las v√≠as
principales.

Par√°metros atenuados
Los par√°metros atenuados no pueden configurarse por uno de los motivos siguientes:
‚óè Hay un valor fijo preasignado que es v√°lido en general o que est√° configurado en otro lugar.
‚óè No se admiten valores alternativos.
Ejemplo: El punto final de la conexi√≥n es el maestro. Los par√°metros siguientes no pueden
configurarse:
‚Äì "Espont√°neo"
Es un par√°metro de estaci√≥n.
‚Äì "Dispositivo final"
En m√≥dulos del proyecto se aplica la direcci√≥n de estaci√≥n de la configuraci√≥n.

Par√°metros
‚óè Nombre
Es posible adaptar el nombre predeterminado de la secci√≥n de conexi√≥n entre dos
dispositivos.
Consulte a este respecto el cap√≠tulo Crear conexiones de Telecontrol (P√°gina 1919).
‚óè Punto de inicio
Seleccione en la lista desplegable el punto de inicio deseado de la conexi√≥n.
‚Äì El punto de inicio de una conexi√≥n es siempre una CPU.
‚óè Dispositivo inicial
Direcci√≥n de estaci√≥n del punto de inicio
‚óè Interfaz inicial
Interfaz del m√≥dulo del punto de inicio a trav√©s de la que transcurre la conexi√≥n.

1942

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Punto final
Seleccione el punto final de la conexi√≥n.
Pueden ser puntos finales de la conexi√≥n:
‚Äì una CPU
‚Äì un dispositivo de terceros
El tipo de nodo de red de dispositivos de terceros se configura en el grupo de par√°metros
de la conexi√≥n, consulte el cap√≠tulo Par√°metros de dispositivos de terceros
(P√°gina 1946).
‚óè Dispositivo final
Direcci√≥n de estaci√≥n del punto final

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1943

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Lista de interlocutores
Al seleccionar un interlocutor de la conexi√≥n ("Punto final") que se encuentra en el proyecto
STEP 7, su direcci√≥n de estaci√≥n ("Dispositivo final") se registra autom√°ticamente en la lista
de interlocutores.
Nota
Entradas manuales
En los casos siguientes deben agregarse manualmente las direcciones de estaci√≥n:
‚óè Dispositivo de terceros
En un dispositivo de terceros que no est√° configurado en el proyecto de STEP 7, la
direcci√≥n de estaci√≥n debe introducirse manualmente.
‚óè Estaci√≥n nodo
La lista de interlocutores de una secci√≥n de conexi√≥n que transmite datos de y a otras
estaciones debe contener la direcci√≥n de estaci√≥n de todos los interlocutores. En las
secciones de conexi√≥n, esto sucede cuando un dispositivo es una estaci√≥n nodo. Aqu√≠
deben agregarse manualmente las direcciones de estaci√≥n de los dem√°s interlocutores.
Introduzca las direcciones de estaci√≥n ("Dispositivo final") separadas por coma.
Encontrar√° un ejemplo de una estaci√≥n nodo en la figura del cap√≠tulo Configuraci√≥n de
conexiones DNP3/IEC (P√°gina 1931). Deben configurarse tres estaciones:
‚Äì Maestro
Nombre: "15_4", direcci√≥n de estaci√≥n: "1"
‚Äì Estaci√≥n nodo
Nombre: "15_3_node", direcci√≥n de estaci√≥n: "2"
‚Äì Estaci√≥n
Nombre: "15_6", direcci√≥n de estaci√≥n: "3"
Explicaci√≥n:
‚Äì Secci√≥n de conexi√≥n "_5"
La secci√≥n de conexi√≥n "_5" va del maestro a la estaci√≥n nodo. La direcci√≥n de estaci√≥n
"2" de la estaci√≥n nodo se registra autom√°ticamente en la lista de interlocutores.
Sin embargo, puesto que por la secci√≥n de conexi√≥n tambi√©n deben transmitirse los
datos de y a la estaci√≥n "15_6" (v√©ase la conexi√≥n "_6"), la direcci√≥n de estaci√≥n "3"
debe agregarse manualmente.
‚Äì Secci√≥n de conexi√≥n "_6"
Lo mismo es v√°lido para la secci√≥n de conexi√≥n "_6" entre estaci√≥n y estaci√≥n nodo, por
la que deben transmitirse los datos de y al maestro.
Aqu√≠ deben introducirse las siguientes direcciones de estaci√≥n:
‚Äë "1" para el dispositivo final de la conexi√≥n "_3"
‚Äë "2" para el dispositivo final de la conexi√≥n "_3"
‚óè Interfaz final/direcci√≥n
Interfaz del m√≥dulo de punto final
En un dispositivo de terceros que no est√° configurado en el proyecto STEP 7, los siguientes
datos deben introducirse manualmente:
‚Äì Conexi√≥n Ethernet: direcci√≥n IP del punto final
‚Äì Conexi√≥n de l√≠nea dedicada: direcci√≥n de estaci√≥n del punto final
‚Äì Conexi√≥n de red de marcaci√≥n: n√∫mero de tel√©fono del punto final

1944

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Puerto final
N√∫mero del puerto Listener del interlocutor
En el ajuste predeterminado, para todos los interlocutores se introduce el valor est√°ndar
2404. El valor puede modificarse. Con dispositivos de terceros es necesario introducir el
n√∫mero de puerto.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 2404
‚óè Tiempo de vigilancia del interlocutor
Si el m√≥dulo de la estaci√≥n no recibe ninguna se√±al de vida del maestro a nivel de aplicaci√≥n
dentro del tiempo configurado, clasifica la conexi√≥n como fallida. El m√≥dulo deshace la
conexi√≥n e intenta establecerla de nuevo.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 0
Con el valor 0 (cero) la funci√≥n est√° desactivada.
‚óè Espont√°neo
Modo de transferencia para eventos
‚Äì S√≠: los telegramas de eventos se transfieren inmediatamente.
‚Äì No: los telegramas de eventos no se transfieren hasta que el maestro consulta los datos.
Sobre el par√°metro, consulte el cap√≠tulo Par√°metros espec√≠ficos IEC (P√°gina 2018).
‚óè Modo de sondeo
Relevante para maestro, dispositivo de terceros (maestro)
Aqu√≠ se define el modo con el que la central llama la estaci√≥n.
El valor configurado en la estaci√≥n se transmite a la central, donde se guarda.
Rangos de valores:
‚Äì C√≠clico
La estaci√≥n se llama c√≠clicamente. El intervalo de tiempo del ciclo de sondeo es igual al
"Intervalo de sondeo de clase 0"; v√©ase m√°s arriba.
‚Äì Tras el arranque
La estaci√≥n se consulta solo despu√©s del primer arranque y tras un rearranque completo.
Si para una estaci√≥n no est√° activada la transferencia espont√°nea, al seleccionar esta
opci√≥n no se transfieren datos durante el funcionamiento.
‚óè Temporal
Relevante para interlocutores con conexiones temporales (p. ej. RTU)
Active esta opci√≥n si el interlocutor soporta conexiones temporales que pueda deshacer por
s√≠ mismo. En tal caso cuando el interlocutor deshace la conexi√≥n no se interpreta como
interrupci√≥n de la conexi√≥n.
Por ejemplo, el interlocutor puede ser una RTU3000C en la que est√© activada la opci√≥n
"Conexi√≥n temporal".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1945

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros de dispositivos de terceros
Par√°metros de dispositivos de terceros
S√≥lo v√°lidos para interlocutores que no se configuran en el proyecto STEP 7. Estos
interlocutores se crean como "Dispositivo de terceros" con el par√°metro "Punto final" en la
tabla de conexiones.
‚óè Tipo de nodo de red dispositivo de terceros
Tipo de nodo de red del dispositivo de terceros al que puede accederse a trav√©s de la v√≠a
de conexi√≥n seleccionada:
‚Äì Estaci√≥n central
(maestro)
‚Äì Estaci√≥n nodo
Para m√≥dulos que act√∫an de estaci√≥n nodo rige lo siguiente:
La interfaz que se dirige a la central se configura como "estaci√≥n nodo".
La interfaz que se dirige a la red subordinada se configura como "central".
‚Äì Estaci√≥n
‚óè Tipo de nodo de red dispositivo de terceros (red.)
Tipo de nodo de red del dispositivo de terceros al que puede accederse a trav√©s de una v√≠a
de conexi√≥n redundante. La opci√≥n est√° disponible cuando en el "dispositivo inicial" se
conecta un dispositivo de terceros a trav√©s de la "interfaz inicial".
Consulte las tres opciones arriba.

Opciones (IEC)
Los siguientes par√°metros se encuentran en los grupos de par√°metros "Opciones 1¬™ v√≠a" /
"Opciones 2¬™ v√≠a" de las conexiones IEC

Intervalos de llamada
Los siguientes par√°metros establecen los intervalos de llamadas especiales del maestro para
la estaci√≥n (cause of transmission 20 - 41).
Todos los par√°metros se configuran como m√∫ltiplo del "Intervalo b√°sico de sondeo" (consulte
el maestro).
‚óè Intervalo para consulta general
Define el intervalo con el que se responden las consultas generales del maestro.
‚óè Intervalo para consulta de grupo
Define el intervalo con el que se responde la consulta de grupo concreta del maestro.
‚óè Intervalo para consulta general de contador
Define el intervalo con el que se responden las consultas generales de contador del
maestro.
‚óè Intervalo para consulta de grupo de contador
Define el intervalo con el que se responde la consulta de grupo de contador concreta del
maestro.

1946

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El ajuste de si una consulta general se responde y la asignaci√≥n a una consulta de grupo se
definen en la configuraci√≥n de puntos de datos individualmente para cada punto de datos.

Editor de puntos de datos
Configuraci√≥n de puntos de datos y mensajes
Observaci√≥n previa: M√≥dulos TIM con SINAUT ST7
Como alternativa a los puntos de datos (TD7onTIM), los m√≥dulos TIM que utilizan el protocolo
de acci√≥n remota SINAUT ST7 pueden utilizar la librer√≠a de bloques "Telecontrol ST7"
(TD7onCPU).
Este cap√≠tulo es aplicable para la variante "TD7onTIM".

Comunicaci√≥n de puntos de datos con la CPU
La transferencia de datos de usuario entre la estaci√≥n y el interlocutor en los m√≥dulos de
Telecontrol con configuraci√≥n de punto de datos no requiere la programaci√≥n de bloques de
programa. Las √°reas de datos de la memoria de la CPU destinadas a la comunicaci√≥n con el
interlocutor de la comunicaci√≥n se configuran en el m√≥dulo vinculadas a puntos de datos. Cada
punto de datos est√° vinculado a una variable PLC o a la variable de un bloque de datos.

Requisitos: Variables PLC y/o bloques de datos (DB) creados
El requisito para la configuraci√≥n de los puntos de datos es que las variables PLC o los DB
correspondientes se hayan creado en la CPU.
Las variables PLC de la configuraci√≥n de puntos de datos pueden crearse en la tabla de
variables est√°ndar o en una tabla de variables definida por el usuario. Todas las variables PLC
que deben utilizarse para la configuraci√≥n de puntos de datos deben marcarse con el atributo
"Visible en HMI".
Las √°reas de direcciones de las variables PLC son las √°reas de entrada, de salida o de marcas
en la CPU.
Encontrar√° los formatos y tipos de datos S7 de las variables PLC compatibles con los tipos de
puntos de datos del CP espec√≠ficos del protocolo en el cap√≠tulo Tipos de puntos de datos
(P√°gina 1956).

Acceso a las √°reas de memoria de la CPU
Los valores de las variables PLC o los DB referenciados por los puntos de datos se leen y son
transferidos al interlocutor por el CP.
El CP escribe los datos recibidos por el interlocutor en la CPU mediante las variables PLC o los
DB.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1947

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Configuraci√≥n de los puntos de datos y mensajes en STEP 7
Los puntos de datos se configuran en el editor de puntos de datos y mensajes de STEP 7. Los
dos editores pueden abrirse alternativamente mediante:
‚óè Selecci√≥n del m√≥dulo de comunicaci√≥n en la vista de redes o en la vista de dispositivos
men√∫ contextual "Abrir el editor de puntos de datos y mensajes"
‚óè Desde el √°rbol del proyecto:
Proyecto > directorio de la estaci√≥n > M√≥dulos locales > m√≥dulo de comunicaci√≥n deseado

Figura 1-115

Abrir el editor de puntos de datos y mensajes

Haciendo doble clic en la entrada se abre el editor de puntos de datos y mensajes.
Despu√©s de abrir la ventana del editor, puede cambiar entre el editor de puntos de datos y
mensajes utilizando las dos entradas situadas a la derecha encima de la tabla.

Figura 1-116

Cambiar entre los dos editores

Creaci√≥n de objetos
Con el editor de puntos de datos y mensajes abierto se crea un objeto nuevo (punto de datos /
mensaje) haciendo doble clic en la primera fila de la tabla con la entrada "<Agregar objeto>"
atenuada.
En la celda se escribe un nombre predeterminado. Es posible adaptar el nombre seg√∫n las
necesidades, aunque debe ser un√≠voco dentro del m√≥dulo.

1948

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Figura 1-117

Tabla de puntos de datos

El resto de propiedades de cada objeto se configura mediante las listas desplegables del resto
de columnas de la tabla y mediante los campos de par√°metros mostrados.

Asignar puntos de datos a su origen
Un punto de datos nuevo debe asignarse a su origen. Dependiendo del tipo de datos del punto
de datos debe considerarse como origen de los datos una variable PLC.
Existen las siguientes posibilidades para la asignaci√≥n:
‚óè Haga clic en el s√≠mbolo de la tabla
en la celda de la columna "PLC-Tag".
Se muestran todas las variables PLC configuradas y las variables de los bloques de datos
creados. Seleccione con el rat√≥n o con el teclado el origen de datos deseado.
‚óè Haga clic en el s√≠mbolo
.
Se muestra una lista desplegable de las variables PLC configuradas y de los bloques.
Seleccione en la tabla correspondiente el origen de datos deseado.
‚óè Introduzca en el campo de nombre de la variable PLC una parte del nombre del origen de
datos deseado.
Se muestran todas las variables y variables PLC configuradas de los bloques de datos cuyo
nombre contienen las letras introducidas.

Seleccione el origen de datos deseado.
Nota
Asignaci√≥n de valores de par√°metro a variables PLC
Los mecanismos descritos aqu√≠ tambi√©n son v√°lidos para asignar el valor de un par√°metro a
una variable PLC. Los campos de entrada para la variable PLC (p. ej.: Variable PLC para
estado de interlocutor) soportan las funciones descritas aqu√≠ para la selecci√≥n de la variable
PLC.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1949

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Organizar columnas y filas, mostrar/ocultar columnas
Igual que en muchos otros programas, en el editor de punto de datos o de mensajes es posible
organizar las columnas y clasificar la tabla seg√∫n las necesidades de cada caso:
‚óè Organizar columnas
Si se hace clic en el encabezado de la columna con el bot√≥n izquierdo del rat√≥n es posible
desplazar la columna.
‚óè Clasificar objetos
Si se hace clic brevemente con el bot√≥n izquierdo del rat√≥n en el encabezado de la columna
es posible clasificar los objetos de la tabla en orden ascendente o descendente en funci√≥n
de las entradas de dicha columna. La clasificaci√≥n se visualiza mediante una flecha en el
encabezado de la columna.
Despu√©s de clasificar en orden descendente una columna es posible deshacer la
clasificaci√≥n haciendo de nuevo clic en el encabezado de la columna.
‚óè Adaptar el ancho de la columna
A esta funci√≥n se accede a trav√©s de las siguientes acciones:
‚Äì Desde el men√∫ contextual, que se abre haciendo clic con el bot√≥n derecho del rat√≥n en
el encabezado de una columna:
"Optimizar ancho", "Optimizar ancho de todas las columnas"
‚Äì Si coloca el cursor cerca del l√≠mite derecho del encabezado de una columna, aparece el
s√≠mbolo siguiente:

Haga doble clic en ese momento en el encabezado de la columna. El ancho de la
columna se adapta entonces a la entrada m√°s ancha de la columna.
‚óè Mostrar/ocultar columnas
Se accede a esta funci√≥n desde el men√∫ contextual, que se abre haciendo clic con el bot√≥n
derecho del rat√≥n en el encabezado de una columna. Existen las siguientes posibilidades:
‚Äì Mostrar/ocultar
Si se elige esta opci√≥n se abre una tabla en la que las columnas visualizadas
(par√°metros) est√°n marcadas. Existe la posibilidad de seleccionar una columna
adicional o bien de borrar la marca de una columna.
Haciendo clic en "M√°s" al final de la tabla se abre una ventana que muestra todas las
columnas disponibles para su selecci√≥n.
‚Äì Mostrar todas las columnas
Si se elige esta opci√≥n se mostrar√°n todas las columnas.

Copiar puntos de datos y mensajes
Igual que en muchos otros programas, en el editor de punto de datos o de mensajes tambi√©n
es posible copiar e insertar objetos.
Si se hace clic con el bot√≥n derecho del rat√≥n en la fila de un objeto de la tabla, se accede a la
funci√≥n deseada desde el men√∫ contextual.
‚óè Cortar
‚óè Copiar

1950

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Pegar
Es posible pegar objetos cortados o copiados dentro de la tabla o en la primera fila libre
debajo de la tabla.
Los objetos cortados o copiados tambi√©n se pueden insertar en tablas de otros m√≥dulos de
comunicaci√≥n del mismo tipo y con el mismo protocolo de Telecontrol.
‚óè Borrar
Con la tecla <Ctrl> pulsada se pueden seleccionar varias filas no contiguas.
Con la tecla <May√∫sculas> pulsada se puede seleccionar el inicio y el final de un √°rea completa
de filas contiguas.

Autocompletado de celdas (solo puntos de datos ST7)
Para puntos de datos ST7 el autocompletado de celdas est√° disponible en las siguientes
variantes de funci√≥n:
‚óè Sobrescribir
‚óè Insertar
El autocompletado resulta especialmente √∫til en las siguientes aplicaciones:
‚óè Ha copiado puntos de datos ST7.
Desea rellenar las celdas de una columna con el mismo valor o en orden correlativo
ascendente o descendente.
‚óè Ha creado puntos de datos ST7.
Desea agregar puntos de datos del mismo tipo.
Para rellenar celdas autom√°ticamente proceda del siguiente modo:
1. Seleccione una o varias celdas (celdas de inicio) de una columna para la funci√≥n.
2. Coloque el cursor en la esquina inferior derecha de la selecci√≥n y arr√°strelo hacia abajo a
las celdas de destino.

Se abre un cuadro de di√°logo en el que se puede elegir la variante de funci√≥n.
3. Elija la opci√≥n que desee, "Sobrescribir" o "Pegar" y haga clic en "Aceptar".
Sobrescribir

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1951

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
En funci√≥n del contenido deseado para las celdas de destino, proceda del siguiente modo:
‚óè Para sobrescribir las celdas de destino con el valor de la celda de origen, seleccione una
√∫nica celda de origen.
‚óè Para sobrescribir las celdas de destino con valores num√©ricos ascendentes, seleccione
como m√≠nimo dos celdas de origen con valores num√©ricos ascendentes. Esta variante est√°
representada arriba, bajo el paso 2.
Por el contrario, si selecciona dos celdas que contienen texto diferente (p. ej. las variables
PLC Bool[1] y DWord[1]), las celdas de destino solo se sobrescribir√°n con el primer valor.
Se seleccionan varias celdas, como en la funci√≥n Copiar:
‚Äì tecla <Ctrl>: selecci√≥n de varias celdas. Las celdas deben ser contiguas.
‚Äì Tecla <May√∫sculas>: selecci√≥n de un √°rea compuesta por celdas contiguas
‚óè Seleccione varias celdas de origen con un bloque de valores cualquiera para sobrescribir
las celdas de destino con ese bloque de valores.
Ejemplo: Se seleccionan tres celdas con los valores 4, 12 y 7. Las celdas de destino se
sobrescriben entonces de forma correlativa con bloques de 4, 12 y 7.
Excepci√≥n: Para el nombre de los puntos de datos rigen reglas especiales, indicadas m√°s
abajo.
Si se seleccionan celdas de origen conforme a la figura superior, al arrastrar el cursor las
celdas de destino se sobrescribir√°n con los siguientes valores.

Tambi√©n es posible sobrescribir celdas de destino con valores num√©ricos descendentes si las
dos celdas de origen contienen valores descendentes o si se seleccionan dos celdas con los
n√∫meros m√°s altos y se arrastra el cursor hacia arriba. Al sobrescribir en orden descendente,
el valor m√°s bajo es 1, ya que 0 no es un valor v√°lido.
La funci√≥n Sobrescribir se puede aplicar en las siguientes columnas:
‚óè Nombre
Al sobrescribir el nombre de puntos de datos no se asignan nombres correlativos. No
obstante, se asigna un nombre un√≠voco para cada punto de datos.
‚óè Variable PLC
Requisitos: Las celdas de destino tienen asignados tipos de puntos de datos compatibles
con la celda de origen.
‚óè Tipo de punto de datos
Requisitos: Los puntos de datos de las celdas de destino utilizan la misma variable PLC.
‚óè Tipo de transferencia
Requisitos: Los puntos de datos de las celdas de destino utilizan la misma variable PLC y
tienen el mismo sentido de transferencia (entrada o salida).

1952

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Canal del objeto
Se aplican las reglas para la asignaci√≥n de los n√∫meros de canal, consulte el
cap√≠tulo Puntos de datos ST7 (P√°gina 1966).
‚óè N√∫mero de objeto
Se aplican las reglas para la asignaci√≥n de los n√∫meros de objeto.
Insertar
Esta opci√≥n inserta filas nuevas al final de la tabla
‚óè Seleccione una o varias celdas y a continuaci√≥n arrastre el cursor hacia m√°s celdas.
Se inserta el n√∫mero total de celdas seleccionadas tras arrastrar el cursor.
La funci√≥n se soporta en las siguientes columnas:
‚óè Nombre
‚óè Variable PLC
‚óè Tipo de punto de datos
‚óè Tipo de transferencia
‚óè Canal del objeto
‚óè N√∫mero de objeto

Exportar e importar puntos de datos
Para facilitar la ingenier√≠a de grandes instalaciones es posible exportar los puntos de datos de
un m√≥dulo configurado e importarlos en otros m√≥dulos del proyecto. Esto ofrece ventajas
especialmente en proyectos con muchas estaciones o m√≥dulos iguales o similares.
Tambi√©n puede accederse a la funci√≥n de exportaci√≥n/importaci√≥n:
‚óè a trav√©s de los dos s√≠mbolos de la lista de puntos de datos
‚óè a trav√©s del men√∫ contextual del m√≥dulo, si se ha seleccionado en la vista de redes o la vista
de dispositivos.

Figura 1-118

Parte del men√∫ contextual de un m√≥dulo de Telecontrol

La informaci√≥n de puntos de datos de un m√≥dulo se guarda durante la exportaci√≥n en un solo
archivo CSV.
No es posible importar puntos de datos de un proyecto antiguo a un proyecto creado en
STEP 7 V15.1, porque el volumen de par√°metros de algunos tipos de puntos de datos no es
el mismo. Con todo, la importaci√≥n funciona si se complementan los par√°metros que faltan
(v√©ase m√°s abajo) en el archivo CSV.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1953

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Exportaci√≥n
Cuando se llama la funci√≥n de exportaci√≥n se abre el cuadro de di√°logo correspondiente. Aqu√≠
se selecciona el o los m√≥dulos del proyecto cuya informaci√≥n de puntos de datos debe
exportarse. En caso necesario, es posible exportar los puntos de datos de todos los m√≥dulos
del proyecto de una sola vez.
En el cuadro de di√°logo de exportaci√≥n existe la posibilidad de seleccionar la ubicaci√≥n en el
directorio de archivos. Si se exportan los datos de un m√≥dulo, tambi√©n es posible cambiar el
nombre predeterminado de un archivo.
Cuando se exportan varios m√≥dulos, los archivos con nombre predeterminado se forman a
partir del nombre de la estaci√≥n y el nombre del m√≥dulo.
Adem√°s de la informaci√≥n de los puntos de datos, el archivo contiene la siguiente informaci√≥n:
‚óè Nombre del m√≥dulo
‚óè Tipo de m√≥dulo
‚óè Nombre de la CPU
‚óè Tipo de CPU

Editar los archivos de exportaci√≥n
Es posible editar la informaci√≥n de puntos de datos en un archivo CSV exportado. De este
modo existe la posibilidad de emplear este archivo como plantilla de configuraci√≥n para
muchas otras estaciones.
Si se dispone de un proyecto con muchas estaciones iguales, es posible copiar el archivo CSV
con los puntos de datos de un m√≥dulo configurado para otras estaciones todav√≠a no
configuradas y adaptar cada uno de los par√°metros a las estaciones correspondientes. De
esta forma se evita tener que configurar los puntos de datos para cada m√≥dulo en STEP 7. En
su lugar, solo hay que importar el archivo CSV copiado y adaptado a los otros m√≥dulos del
mismo tipo. Al importar el archivo a otro m√≥dulo, los valores de par√°metros modificados del
archivo CSV se aplican a la configuraci√≥n de puntos de datos de dicho m√≥dulo.
Las filas del archivo CSV tienen el contenido siguiente:
‚óè Fila 1: ,Name,Type,
Esta fila no debe cambiarse.
‚óè Fila 2: PLC,<Nombre de la CPU>,<Tipo de CPU>,
Significado: PLC (Nombre de la clase de estaci√≥n), nombre de la CPU, tipo de CPU
Solo deben cambiarse los elementos <Nombre de la CPU> y <Tipo de CPU>.
El tipo de CPU debe corresponderse exactamente con el nombre de la CPU en el cat√°logo.
‚óè Fila 3: Module,<nombre del m√≥dulo>,<tipo de m√≥dulo>,
Significado: Module (Nombre de la clase de m√≥dulo), tipo de m√≥dulo, nombre del m√≥dulo
Solo deben cambiarse los elementos <nombre del m√≥dulo> y <tipo de m√≥dulo>.
Tenga cuidado al cambiar los nombres de m√≥dulo si desea importar los puntos de datos a
varios m√≥dulos (v√©ase m√°s abajo).
El tipo de m√≥dulo debe corresponderse exactamente con el nombre del m√≥dulo en el
cat√°logo.

1954

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Fila 4: Nombre del par√°metro (ingl√©s) de los puntos de datos
Esta fila no debe cambiarse.
‚óè Filas 5..n: Valores de los par√°metros seg√∫n la fila 4 de cada uno de los puntos de datos
Es posible cambiar los valores de los par√°metros para cada estaci√≥n.

Importar a un m√≥dulo
Antes de importar los puntos de datos, aseg√∫rese de que se han creado las variables PLC
necesarias para los puntos de datos.
Tenga en cuenta que cuando se importa un archivo CSV se borran todos los puntos de datos
existentes en el m√≥dulo y se reemplazan por los puntos de datos importados.
Seleccione un CP y elija la funci√≥n de importaci√≥n desde el men√∫ contextual del m√≥dulo. Se
abre un cuadro de di√°logo de importaci√≥n en el que se selecciona el archivo CSV en el
directorio de archivos.
Si la informaci√≥n relacionada con la asignaci√≥n de los diferentes puntos de datos a su
correspondiente variable PLC concuerda con la asignaci√≥n en el m√≥dulo original, los puntos de
datos se asignar√°n a la variable PLC correspondiente.
Si importa puntos de datos a un CP pero en la CPU todav√≠a no se han creado algunas variables
PLC necesarias, la informaci√≥n de puntos de datos correspondientes no podr√° asignarse. En
ese caso, las variables PLC que falten pueden crearse a posteriori para asignarles despu√©s la
informaci√≥n de puntos de datos importada. Para ello se dispone de la funci√≥n "Reparaci√≥n de
asignaciones" (v√©ase m√°s abajo).
Si los nombres de las variables PLC en el m√≥dulo al que se realiza la importaci√≥n se
diferencian del m√≥dulo que ha realizado la exportaci√≥n, los puntos de datos correspondientes
no pueden asignarse a sus variables PLC.

Importaci√≥n de varios m√≥dulos
Es posible importar los puntos de datos de varios m√≥dulos en los m√≥dulos de otro proyecto.
Para ello, seleccione todos los archivos CSV necesarios en el cuadro de di√°logo de
importaci√≥n utilizando la tecla de control.
Antes de importar los puntos de datos aseg√∫rese de que las estaciones correspondientes con
CPU hom√≥nimas, m√≥dulos hom√≥nimos y variables PLC hom√≥nimas est√°n creadas.
Durante la importaci√≥n se buscan las estaciones correspondientes en funci√≥n del nombre del
m√≥dulo en los archivos CSV. Si una estaci√≥n de destino no est√° en el proyecto o si el m√≥dulo
tiene un nombre distinto, se ignora la importaci√≥n del archivo CSV correspondiente.

Limitaciones en la importaci√≥n de puntos de datos
En los casos siguientes se cancela la importaci√≥n de los puntos de datos:
‚óè En el archivo CSV que debe importarse falta un atributo necesario para el m√≥dulo.
Ejemplo: Si un punto de datos que debe importarse se emplea un disparo de hora, se
cancela la importaci√≥n cuando para el m√≥dulo no se ha configurado la sincronizaci√≥n
horaria.
‚óè El protocolo de Telecontrol empleado por el m√≥dulo difiere del m√≥dulo original.
Los m√≥dulos con el mismo protocolo de Telecontrol son compatibles entre s√≠:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1955

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Solo cuando se importa a varios m√≥dulos:
‚óè La importaci√≥n se cancela cuando un nombre de m√≥dulo o CPU difiere de los datos del
archivo CSV.

Reparaci√≥n de asignaciones
Si en una estaci√≥n a la que debe importarse el archivo CSV las variables PLC tienen nombres
distintos a los de la estaci√≥n de la que desea exportar el archivo CSV, la asignaci√≥n entre el
punto de datos y la variable PLC se perder√° en la importaci√≥n.
En ese caso existe la posibilidad de cambiar convenientemente el nombre de variables PLC
existentes o bien de agregar las variables PLC que faltan. A continuaci√≥n es posible reparar la
asignaci√≥n entre puntos de datos no asignados y variables PLC. Se accede a esta funci√≥n
desde el men√∫ contextual del CP (v√©ase m√°s arriba) o mediante el s√≠mbolo siguiente situado
en la parte superior izquierda del editor de puntos de datos:
Si la funci√≥n de reparaci√≥n encuentra una variable PLC para un punto de datos con un nombre
adecuado, la asignaci√≥n se restablece. Sin embargo, no se comprueba el tipo de datos de la
variable.
Tras reparar la asignaci√≥n, compruebe siempre si las variables PLC reasignadas son
correctas.

Tipos de puntos de datos
Al configurar los datos de usuario que debe transferir el m√≥dulo de comunicaci√≥n, cada punto
de datos se crea como tipo de punto de datos espec√≠fico del protocolo.
A continuaci√≥n se listan los tipos de puntos de datos espec√≠ficos del protocolo, junto con los
tipos de datos S7 compatibles en cada caso.
La columna "Sentido" indica el sentido de la transferencia:
‚óè "in": sentido de observaci√≥n
‚óè "out": sentido de control
En el protocolo ST7, el sentido de la transferencia se ve en el nombre de objeto.
Nota
Repercusi√≥n del cambio de arrays para puntos de datos
Si cambia posteriormente un array deber√° volver a crearse el punto de datos.

Tipos de puntos de datos del protocolo "TeleControl Basic"
Tabla 1-139 Tipos de puntos de datos soportados y tipos de datos S7 compatibles
Formato (memoria necesaria)

Tipo de punto de datos

Bit

Entrada digital
Salida digital

1956

Sentido

Tipos de datos S7

√Årea de operan‚Äê
dos

in

Bool

I, Q, M, DB

in

Bool

Q, M, DB

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Formato (memoria necesaria)

Tipo de punto de datos

Byte

Entrada digital
Salida digital

Entero con signo (16 bits)

Entrada anal√≥gica
Salida anal√≥gica

Sentido

Tipos de datos S7

√Årea de operan‚Äê
dos

in

Byte, Char, USInt

I, Q, M, DB

out

Byte, Char, USInt

Q, M, DB

in

Int

I, Q, M, DB

out

Int

Q, M, DB

Contador (16 bits)

Entrada de contador

in

Word, UInt

I, Q, M, DB

Entero con signo (32 bits)

Entrada anal√≥gica

in

DInt

Q, M, DB

Salida anal√≥gica

out

DInt

Q, M, DB

in

UDInt, DWord

I, Q, M, DB

in

Real

Q, M, DB

out

Real

Q, M, DB

out

LReal

Q, M, DB

out

LReal

Q, M, DB

ARRAY 1)

DB

ARRAY 1)

DB

Contador (32 bits)

Entrada de contador

N√∫mero en coma flotante con signo
(32 bits)

Entrada anal√≥gica
Salida anal√≥gica

N√∫mero en coma flotante con signo
(64 bits)

Entrada anal√≥gica

Bloque de datos (1 .. 64 bytes)

Datos

in / out

Datos

in / out

1)

Salida anal√≥gica

Consulte los formatos posibles en "Bloque de datos (ARRAY)".

Bloque de datos (ARRAY)
El tipo de datos ARRAY permite transferir √°reas de memoria relacionadas de hasta 64 bytes
de tama√±o. Los componentes compatibles de ARRAY son los siguientes tipos de datos S7:
‚óè Byte, USInt (en total hasta 64 por bloque de datos)
‚óè Char (en total hasta 64 por bloque de datos)
CP-1200 a partir de la versi√≥n de firmware V2.1.77
‚óè Int, UInt, Word (en total hasta 32 por bloque de datos)
‚óè DInt, UDInt, DWord (en total hasta 16 por bloque de datos)
‚óè Real (en total hasta 16 por bloque de datos) *
‚óè LReal (en total hasta 8 por bloque de datos) *
* CP-1200 a partir de V3.2, CP 1542SP‚Äë1 IRC a partir de V2.1
En caso de que cambie posteriormente el array deber√° volver a crearse el punto de datos.
Sello de tiempo en formato UTC
Los sellos de tiempo son emitidos por las aplicaciones de servidor OPC en formato UTC (48
bits) e incluyen milisegundos.

Tipos de puntos de datos del protocolo "ST7"
El sentido de la transferencia de datos puede consultarse en la columna "Objeto":
‚óè Los objetos emisores tienen el sufijo "_S".
‚óè Los objetos receptores tienen el sufijo "_R".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1957

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tabla 1-140 Tipos de puntos de datos soportados y tipos de datos S7 compatibles
Formato (memo‚Äê Tipo de punto de datos
ria necesaria)

Tipo de datos S7

√Årea de ope‚Äê
randos

Bit

Entrada digital

Bool

I, Q, M, DB

1 .. 8

Salida digital

Bool

Q, M, DB

1 .. 8

Bin08X_R

Entrada digital

Byte, USInt 3)

I, Q, M, DB

4

Bin04B_S

Salida digital

Byte, USInt 3)

Q, M, DB

4

Bin04B_R

Byte

Entero con sig‚Äê
no (16 bits)

N√∫mero en co‚Äê
ma flotante (32
bits)
Bloque de datos
(4 .. 48 bytes)

Salida de comando

Byte, USInt

Q, M, DB

1

Cmd01B_R

Entrada de comando

Byte, USInt 3)

Q, M, DB

1

Cmd01B_S

Entrada anal√≥gica

Int

I, Q, M, DB

4

Ana04W_S

Entrada de valor medio

Int

I, Q, M, DB

4

Mean04W_S

Salida anal√≥gica

Int

Q, M, DB

4

Ana04W_R

Salida de valor medio

Int

Q, M, DB

4

Mean04W_R

Salida de consigna

Int, UInt, Word

Q, M, DB

1

Set01W_R

1)

Int, UInt, Word

Q, M, DB

1

Set01W_S

Entrada de contador

UInt, Word 3)

I, Q, M, DB

1

Cnt01D_S

1)

Entrada de contador

UInt, Word

I, Q, M, DB

4

Cnt04D_S

Salida de contador

UDInt, DWord 3)

I, Q, M, DB

1

Cnt01D_R

Salida de contador

UDInt, DWord

3)

I, Q, M, DB

4

Cnt04D_R

Entrada anal√≥gica

Real

3)

M, DB

4

Ana04R_S

Salida anal√≥gica

Real 3)

M, DB

4

Ana04R_R

Entrada de datos

ARRAY [0...11] of
DInt / UDInt /
DWord / Real 2) 3)

DB

12

Dat12D_S

DB

12

Dat12D_R

Salida de datos
Salida de par√°metros

1)

3)

Entrada de par√°metros 1)
Bloque de datos
(1 .. 12 bytes)

Bin08X_S

3)

Entrada de consigna
Contador (16
bits)

Puntos de datos Objeto
(canales) por ob‚Äê
jeto

Entrada de datos
Salida de datos
Entrada de par√°metros
Salida de par√°metros

Byte, USInt,
Word; Int, UInt;
DWord, DInt;
UDInt; DWord 3)

1)

Consulte m√°s abajo, apartado "1: Retroalimentaci√≥n"

2)

Consulte m√°s abajo, apartado "2: Bloque de datos mediante Array"

3)

El S7‚Äë300/400 no soporta USInt, UInt, Real ni UDInt.

DB

12

Par12D_R

DB

12

Par12D_S

I, Q, M, DB

1 .. 12

Dat12X1_S

I, Q, M, DB

1 .. 12

Dat12X1_R

I, Q, M, DB

1 .. 12

Par12X1_S

I, Q, M, DB

1 .. 12

Par12X1_R

1: Retroalimentaci√≥n (TIM 3V‚ÄëIE / TIM 4R‚ÄëIE)
La retroalimentaci√≥n de los datos locales actuales al interlocutor se configura con los tipos de
puntos de datos siguientes:
‚óè Entrada/salida de consigna (Set01W_R / Set01W_S)
‚óè Entrada/salida de par√°metros (Par12D_R / Par12D_S)
Al activar la opci√≥n "Modo de entrada de consigna del interlocutor", se vigila si ha habido
cambios en los valores locales, y si ha cambiado el valores se transfiere al interlocutor.
La funci√≥n se configura a trav√©s de los par√°metros de la ficha "Entrada local de consigna",
consulte el cap√≠tulo Ficha "Entrada local de consigna" (P√°gina 1972).

1958

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
2: Bloque de datos mediante Array
El tipo de datos ARRAY permite transferir bloques de datos provenientes de √°reas de memoria
relacionadas de hasta 4 .. 48 bytes de tama√±o.
Los componentes compatibles de ARRAY son DInt, UDInt, DWord o Real. Los componentes
integrados en un array deben ser del mismo tipo.
Formato de los sellos de tiempo
Consulte el formato de los sellos de tiempo en el manual del m√≥dulo.

Tipos de puntos de datos del protocolo "DNP3"
Tabla 1-141 Tipos soportados de puntos de datos, grupos de objetos DNP3, variantes y tipos de datos S7 compatibles
Formato (memoria
necesaria)

Tipo de punto de datos
CP
[Tipo de punto de da‚Äê
tos TIM]

Bit

[variations]

Tipos de datos S7
CP

TIM

√Årea de operan‚Äê
dos

1 [1, 2]

in

Bool

Bool

I, Q, M, DB

Binary Input Event

2 [1, 2]

in

Bool

Bool

I, Q, M, DB

Double-bit Binary Input

3 [1]

in

Bool

Bool

I, Q, M, DB

Double-bit Binary Input
Event

4 [1]

in

Bool

Bool

I, Q, M, DB

Binary Output

10 [2]

out

Bool

Bool

Q, M, DB

1)

11 [1, 2]

out

Bool

Bool

Q, M, DB

Binary Command

12 [1]

out

Bool

Byte

Q, M, DB

Counter

20 [2]

in

UInt, Word Word

I, Q, M, DB

Frozen Counter

1)

21 [2, 6]

in

UInt, Word Word

I, Q, M, DB

Counter Event

22 [2, 6]

in

UInt, Word Word

I, Q, M, DB

Frozen Counter
Event 3)

23 [2, 6]

in

UInt, Word Word

I, Q, M, DB

30 [2]

in

Int

2)

Analog Input
Analog Output Status

32 [2]

in

Int

Int

I, Q, M, DB

out

Int

Int

Q, M, DB

41 [2]

out

Int

Int

Q, M, DB

4)

42 [2, 4]

out

Int

Int

Q, M, DB

20 [1]

in

DWord

DWord

I, Q, M, DB

Counter
Frozen Counter

I, Q, M, DB

40 [2]

Analog Output
Analog Output Event

Int

4)

Analog Input Event

Integer (32 bits)

Sentido

Binary Input

Binary Output Event
Integer (16 bits)

Grupo de obje‚Äê
tos DNP3

21 [1, 5]

in

DWord

DWord

I, Q, M, DB

Counter Event

22 [1, 5]

in

DWord

DWord

I, Q, M, DB

Frozen Counter
Event 3)

23 [1, 5]

in

DWord

DWord

I, Q, M, DB

30 [1]

in

DInt

2)

Analog Input
Analog Input Event
Analog Output Status

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

‚Äë

Q, M, DB
Q, M, DB

32 [1]

in

DInt

4)

40 [1, 3]

out

DInt

41 [1]

out

DInt

DWord

Q, M, DB

4)

42 [1]

out

DInt

DWord

Q, M, DB

Analog Output
Analog Output Event

‚Äë
DWord

Q, M, DB

1959

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Formato (memoria
necesaria)

Tipo de punto de datos
CP
[Tipo de punto de da‚Äê
tos TIM]

4)

Analog Output
Analog Output Event

4)

N√∫mero en coma flo‚Äê Analog Input
tante (64 bits)
Analog Input Event
Analog Output
Analog Output Event
Bloque de datos
(1...64 bytes) 5)

4)

Octet String
Octet String Event

Sentido

5)

Tipos de datos S7
CP

[variations]

N√∫mero en coma flo‚Äê Analog Input
tante (32 bits)
Analog Input Event
Analog Output Status

Grupo de obje‚Äê
tos DNP3

TIM

√Årea de operan‚Äê
dos

30 [5]

in

Real

‚Äë

Q, M, DB

32 [5, 7]

in

Real

‚Äë

Q, M, DB

40 [3]

out

Real

‚Äë

Q, M, DB

41 [3]

out

Real

‚Äë

Q, M, DB

42 [5, 7]

out

Real

‚Äë

Q, M, DB

30 [6]

in

LReal

‚Äë

Q, M, DB

32 [6, 8]

in

LReal

‚Äë

Q, M, DB

41 [4]

out

LReal

‚Äë

Q, M, DB

42 [6, 8]

out

LReal

‚Äë

Q, M, DB

110 [ ‚Äë ]

in, out

5)

5)

DB

111 [ ‚Äë ]

in, out

5)

5)

DB

Este grupo de objetos puede configurarse en el editor de puntos de datos de STEP 7 mediante el grupo de objetos sustitutivos
12.

1)

Este grupo de objetos puede configurarse en el editor de puntos de datos de STEP 7 mediante el grupo de objetos sustitutivos
20.

2)

Este grupo de objetos puede configurarse en el editor de puntos de datos de STEP 7 mediante el grupo de objetos sustitutivos
22.

3)

Este grupo de objetos puede configurarse en el editor de puntos de datos de STEP 7 mediante el grupo de objetos sustitutivos
41.

4)

Con estos tipos de puntos de datos pueden transferirse √°reas de memoria relacionadas de hasta 64 bytes de tama√±o. Son
compatibles todos los tipos de datos S7 de 1 a 64 bytes de tama√±o.

5)

Informaci√≥n sobre las notas 1), 2), 3), 4): Configuraci√≥n de puntos de datos mediante grupos de
objetos sustitutivos
Los tipos de puntos de datos de partida para los grupos de objetos siguientes pueden
configurarse mediante los grupos de objetos sustitutivos citados anteriormente:
‚óè 10 [2]
‚óè 11 [1, 2]
‚óè 21 [1, 2, 5, 6]
‚óè 23 [1, 2, 5, 6]
‚óè 40 [1, 2, 3]
‚óè 42 [1, 2, 4, 5, 6, 7, 8]
Utilice para la configuraci√≥n en el CP DNP3 el grupo de objetos sustitutivo indicado en cada
caso.
Asigne el punto de datos correspondiente en el maestro utilizando el √≠ndice de puntos de datos
configurable en STEP 7. El punto de datos del CP DNP3 se asignar√° a continuaci√≥n al punto
de datos correspondiente en el maestro.
Ejemplo de configuraci√≥n del punto de datos Binary Output (10 [2])
El punto de datos se configura del siguiente modo:
en el CP DNP3 como Binary Command (12 [1])
en el maestro como Binary Output (10 [2])

1960

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para los tipos de puntos de datos Binary Output Event (11) y Analog Output Event (42) debe
activarse adicionalmente la retroalimentaci√≥n.
Configuraci√≥n de la retroalimentaci√≥n para Output Events (grupos de objetos 11 y 42)
Los tipos de puntos de datos Binary Output Event (grupo de objetos 11) y Analog Output Event
(grupo de objetos 42) se crean primero como puntos de datos de los grupos de objetos 12 y 41,
respectivamente, tal como se ha descrito anteriormente.
Existe la posibilidad de supervisar los cambios en los valores locales de ambos grupos de
objetos y transferirlos al maestro. La modificaci√≥n de un valor local puede ser causada por una
operaci√≥n manual local, por ejemplo.
Para que pueda transferirse al maestro el valor provocado por eventos o intervenciones
locales, el punto de datos en cuesti√≥n requiere un canal de retroalimentaci√≥n. La funci√≥n de
retroalimentaci√≥n se configura en la ficha "General" de la configuraci√≥n de puntos de datos con
la opci√≥n "Vigilancia de valores".
Tenga en cuenta que para la funci√≥n de retroalimentaci√≥n es necesario reubicar los valores
locales del controlador en la variable PLC correspondiente del punto de datos.
Sellos de tiempo de los datos en el protocolo DNP3 en formato UTC
Los sellos de tiempo se transfieren en formato UTC (48 bits) e incluyen milisegundos.

Tipos de puntos de datos del protocolo "IEC 60870‚Äë5"
Tabla 1-142 Tipos soportados de puntos de datos, tipos IEC y tipos de datos S7 compatibles
Formato (memoria
necesaria)

Tipo de punto de datos

Tipo IEC

Sentido

Bit

Single-point information

<1>

Single-point information with time tag
CP56Time2a 1)

Byte

Tipos de datos
S7

√Årea de operan‚Äê
dos

in

Bool

I, Q, M, DB

<30>

in

Bool

I, Q, M, DB

Single command

<45>

out

Bool

Q, M, DB

Single command with time tag
CP56Time2a 1)

<58>

out

Bool

Q, M, DB

Double command with time tag
CP56Time2a 1)

<59>

out

Bool

DB 2)

Step position information

<5>

in

Byte, USInt

I, Q, M, DB

Step position information with time
tag CP56Time2a 1)

<32>

in

Byte, USInt

I, Q, M, DB

Regulating step command with time
tag CP56Time2a 1)

<60>

out

Byte, USInt

DB 2)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1961

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Formato (memoria
necesaria)

Tipo de punto de datos

Integer (16 bits)

Integer (32 bits)

N√∫mero en coma
flotante (32 bits)

Bloque de datos
(1...2 Bit) 2)

Bloque de datos
(1...32 Bit) 3)

Tipo IEC

Sentido

Tipos de datos
S7

√Årea de operan‚Äê
dos

Measured value, normalized value

<9>

in

Int

I, Q, M, DB

Measured value, normalized value
with time tag CP56Time2a 1)

<34>

in

Int

I, Q, M, DB

Measured value, scaled value

<11>

in

Int

I, Q, M, DB

Measured value, scaled value with ti‚Äê
me tag CP56Time2a 1)

<35>

in

Int

I, Q, M, DB

Set point command, normalized value

<48>

out

Int

Q, M, DB

Set point command, scaled value

<49>

out

Int

Q, M, DB

Set point command, normalized value
with time tag CP56Time2a 1)

<61>

out

Int

Q, M, DB

Set point command, scaled value with
time tag CP56Time2a 1)

<62>

out

Int

Q, M, DB

Bitstring of 32 bits

<7>

in

UDInt, DWord

I, Q, M, DB

Bitstring of 32 bits with time tag
CP56Time2a 1)

<33>

in

UDInt, DWord

I, Q, M, DB

Integrated totals

<15>

in

UDInt, DWord

I, Q, M, DB

Integrated totals with time tag CP56Ti‚Äê
me2a 1)

<37>

in

UDInt, DWord

I, Q, M, DB

Bitstring of 32 bits

<51>

out

UDInt, DWord

Q, M, DB

Bitstring of 32 bits with time tag
CP56Time2a ‚Äë control direction

<64>

out

UDInt, DWord

Q, M, DB

Measured value, short floating point
number

<13>

in

Real

Q, M, DB

Measured value, short floating point
number with time tag CP56Time2a 1)

<36>

in

Real

Q, M, DB

Set point command, short floating
point number

<50>

out

Real

Q, M, DB

Set point command, short floating
point with time tag CP56Time2a 1)

<63>

out

Real

Q, M, DB

Double-point information

<3>

in

2)

DB

Double-point information with time
tag CP56Time2a 1)

<31>

in

2)

DB

Double command

<46>

out

2)

DB

Regulating step command

<47>

out

2)

DB

Double command with time tag
CP56Time2a 1)

<59>

out

2)

DB

Regulating step command with time
tag CP56Time2a 1)

<60>

out

2)

DB

Bitstring of 32 bits

<7>

in

3)

DB

Bitstring of 32 bits with time tag
CP56Time2a 1) 3)

<33>

in

3)

DB

Bitstring of 32 bits

<51>

out

3)

DB

<64>

out

3)

DB

3)

3)

Bitstring of 32 bits with time tag
CP56Time2a ‚Äë control direction
1)

1)

1) 3)

Consulte el formato de los sellos de tiempo m√°s abajo.

1962

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
2)

Cree un array de 2 Bool en el DB para estos tipos de puntos de datos.

Con estos tipos de puntos de datos pueden transferirse √°reas de memoria relacionadas de hasta 32 bits. Cree un Array[0..31]
of Bool en el DB.
3)

Sellos de tiempo de los datos en el protocolo IEC
Los sellos de tiempo se transfieren en formato "CP56Time2a" conforme a la especificaci√≥n
IEC. Tenga en cuenta que solo se transfieren los 3 primeros bytes correspondientes a
milisegundos y minutos.

Memoria imagen de proceso, tipo de transferencia, clases de eventos
Introducci√≥n
Algunas de las funciones descritas a continuaci√≥n se diferencian por el m√≥dulo de
comunicaci√≥n o por el protocolo utilizados.

Almacenamiento de valores
Por lo general, los valores de todos los puntos de datos se guardan en la memoria imagen del
m√≥dulo. Los valores de la memoria imagen no se transfieren hasta que se produce una
llamada por parte de la central o del maestro DNP3/IEC.
Los eventos se guardan tambi√©n en el b√∫fer de transmisi√≥n y pueden transferirse de forma
espont√°nea.

Memoria imagen, la memoria imagen de proceso del m√≥dulo
La memoria imagen es la memoria imagen de proceso del m√≥dulo de comunicaci√≥n. En la
memoria imagen se guardan todos los valores actuales de los puntos de datos configurados.
Los valores nuevos de un punto de datos sobrescriben el √∫ltimo valor guardado en la memoria
imagen.
Los valores solo se transfieren en las condiciones siguientes:
‚óè Tras la consulta del interlocutor de la comunicaci√≥n; consulte "Transferencia tras llamada"
en el apartado "Tipos de transferencia" m√°s adelante.
‚óè Junto con un telegrama de datos proveniente del b√∫fer de transmisi√≥n que debe transferirse
de inmediato.

El b√∫fer de transmisi√≥n
El b√∫fer de transmisi√≥n del m√≥dulo de comunicaci√≥n es la memoria para los diferentes valores
de puntos de datos configurados como eventos (memoria de telegramas). Encontrar√° el
tama√±o del b√∫fer de transmisi√≥n en el manual del m√≥dulo correspondiente.
La capacidad del b√∫fer de transmisi√≥n se reparte equitativamente entre todos los
interlocutores activados.
En caso de que se haya interrumpido la conexi√≥n con un interlocutor, los valores de los
diferentes eventos se conservan gracias al respaldo. Cuando se recupera la conexi√≥n se

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1963

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
env√≠an los valores respaldados. La memoria de telegramas funciona cronol√≥gicamente, es
decir, los datos m√°s antiguos se env√≠an en primer lugar (principio FIFO).
Cuando se transfiere un telegrama de datos al interlocutor de la comunicaci√≥n, los datos
transmitidos se borran del b√∫fer de transmisi√≥n.
Cuando no es posible transmitir datos durante un tiempo prolongado y el b√∫fer de transmisi√≥n
est√° a punto de desbordarse, se aplica el siguiente procedimiento acorde con el protocolo:
‚óè Telecontrol Basic, ST7
El m√©todo de memoria imagen forzada
Cuando el b√∫fer de transmisi√≥n alcanza un determinado nivel de llenado, m√≥dulo cambia
al m√©todo de memoria imagen forzada. El nivel de llenado para cambiar al m√©todo de
memoria imagen forzada es:
‚Äì Telecontrol Basic: 80 % de la memoria ocupada del b√∫fer de transmisi√≥n
‚Äì ST7: 90 % de la memoria ocupada del b√∫fer de transmisi√≥n
Los valores nuevos de los puntos de datos que est√°n configurados como eventos ya no se
registran adicionalmente en el b√∫fer de transmisi√≥n con el m√©todo de memoria imagen
forzada, sino que sobrescriben los valores m√°s antiguos que ya est√°n en la memoria
imagen.
Cuando se recupera la conexi√≥n con el interlocutor, el m√≥dulo cambia de nuevo al m√©todo
de b√∫fer de transmisi√≥n una vez que el nivel de llenado ha bajado del 50 % de la capacidad.
‚óè DNP3 / IEC
Cuando el b√∫fer de transmisi√≥n est√° lleno en un 100 % de su capacidad, no se guardan m√°s
valores hasta que el nivel de llenado baja por debajo del 100 %.

Almacenamiento de los valores de puntos de datos
Por norma general, los valores de puntos de datos se guardan en la memoria imagen del
m√≥dulo y no se transfieren hasta que son solicitados por el interlocutor de la comunicaci√≥n.
Los eventos se guardan tambi√©n en el b√∫fer de transmisi√≥n y pueden transferirse de forma
espont√°nea.

1964

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los puntos de datos se configuran como valores est√°ticos o como eventos por medio del
par√°metro "Tipo de transferencia" (v√©ase m√°s adelante):
‚óè Valor est√°tico (sin evento)
Los valores est√°ticos se introducen en la memoria imagen (memoria imagen de proceso del
CP).
Valores est√°ticos de las siguientes clases:
‚Äì DNP3: Class 0
‚Äì IEC: Clase 2
‚óè Evento
Los valores de puntos de datos que est√°n configurados como eventos tambi√©n se
introducen en la memoria imagen del m√≥dulo de comunicaci√≥n. El valor del evento se env√≠a
espont√°neamente al interlocutor cuando esta funci√≥n est√° habilitada por parte del maestro.
Adicionalmente, los valores de eventos se introducen en el b√∫fer de transmisi√≥n del m√≥dulo
de comunicaci√≥n.
Los eventos equivalen a las siguientes clases:
‚Äì DNP3: Class 1 / 2 / 3
‚Äì IEC: Clase 1

Tipos de transferencia
Son posibles los siguientes tipos de transferencia:
‚óè Transferencia tras llamada (class 0)
El valor actual del punto de datos en cada caso se introduce en la memoria imagen del CP.
Los valores nuevos de un punto de datos sobrescriben el √∫ltimo valor guardado en la
memoria imagen.
Tras una llamada del interlocutor se transfiere el valor actual en ese momento.
‚óè Con disparo (eventos)
Los valores de puntos de datos que est√°n configurados como eventos se registran en la
memoria imagen y tambi√©n en el b√∫fer de transmisi√≥n del CP.
Los valores de eventos se guardan en los casos siguientes:
‚Äì Se cumplen las condiciones de disparo configuradas en cada caso (configuraci√≥n de
puntos de datos > ficha "Disparo", v√©ase m√°s adelante).
‚Äì El valor de un bit de estado de las identificaciones de estado del punto de datos cambia,
consulte el cap√≠tulo Identificaciones de estado de los puntos de datos (P√°gina 1969).
Ejemplo:
Si el valor de un punto de datos configurado como evento se actualiza al arrancar la
estaci√≥n con la primera lectura de los datos de la CPU, cambia el estado "RESTART" de
dicho punto de datos (cambio de estado del bit 1 ‚Üí 0). Esto provoca la generaci√≥n de un
evento.
Las clases de eventos configurables de los diferentes protocolos se describen en los
apartados siguientes.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1965

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Clases de evento en el tipo de transferencia "Con disparo"
En funci√≥n del protocolo utilizado est√°n disponibles las siguientes clases de evento:
‚óè TeleControl Basic / ST7
‚Äì Todos los valores disparados
Cada cambio de valor se introduce en el b√∫fer de transmisi√≥n en orden cronol√≥gico.
‚Äì Valor actual disparado
Solo se introduce en el b√∫fer de transmisi√≥n el valor actual, que es el √∫ltimo en cada
caso. Sobrescribe el valor que estaba guardado all√≠ previamente.
‚óè DNP3
El maestro debe evaluar la clasificaci√≥n siguiente.
‚Äì Clase de evento 1
Clase seg√∫n el protocolo DNP3: Class 1
Cada cambio de valor se introduce en el b√∫fer de transmisi√≥n en orden cronol√≥gico.
‚Äì Clase de evento 2
Clase seg√∫n el protocolo DNP3: Class 2
Cada cambio de valor se introduce en el b√∫fer de transmisi√≥n en orden cronol√≥gico.
‚Äì Clase de evento 3
Clase seg√∫n el protocolo DNP3: Class 3
So se introduce en el b√∫fer de transmisi√≥n y sobrescribe el √∫ltimo valor guardado all√≠ el
valor actual en el momento en que se cumple la condici√≥n de disparo.
‚óè IEC
Las dos siguientes clases de evento equivalen a la clase de datos de usuario 1 del protocolo
IEC
‚Äì Todos los valores disparados
Cada cambio de valor se introduce en el b√∫fer de transmisi√≥n en orden cronol√≥gico.
‚Äì Valor actual disparado
So se introduce en el b√∫fer de transmisi√≥n y sobrescribe el √∫ltimo valor guardado all√≠ el
valor actual en el momento en que se cumple la condici√≥n de disparo.
Para la activaci√≥n de la transferencia controlada por evento hay disponibles diferentes tipos de
disparo, consulte el cap√≠tulo Ficha "Disparo" (P√°gina 1976).

Puntos de datos ST7
Objetos del software TD7
La comunicaci√≥n por Telecontrol de m√≥dulos que utilizan el protocolo de acci√≥n remota
SINAUT ST7 se desarrolla a trav√©s del software TD7.
Los datos de los objetos SINAUT que deben transferirse se configuran y parametrizan
alternativamente de una de las siguientes formas:
‚óè mediante puntos de datos (TD7onTIM)
‚óè mediante bloques de programa de la librer√≠a "Telecontrol ST7" (TD7onCPU)
Encontrar√° informaci√≥n sobre las dos variantes del software TD7 en el cap√≠tulo El software
TD7 (P√°gina 1997).

1966

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Objetos de datos
El env√≠o y la recepci√≥n de datos de proceso se configura utilizando objetos de datos
estandarizados. En funci√≥n de los dos sentidos de transmisi√≥n, los objetos se diferencian en:
‚óè Objetos de transmisi√≥n (.._S)
Objetos de datos para el registro y env√≠o de datos
El nombre tiene la terminaci√≥n "_S" (send).
‚óè Objetos de recepci√≥n (.._R)
Objetos de datos para la recepci√≥n y salida de datos
El nombre tiene la terminaci√≥n "_R" (receive).
Los nombres de los objetos de datos son id√©nticos en TD7onTIM y en TD7onCPU. En lo
referente a las funciones, son compatibles entre s√≠.

N√∫meros de objeto
Cada objeto de datos tiene un n√∫mero de objeto. Al crear puntos de datos nuevos, en el ajuste
predeterminado los n√∫meros se asignan en orden ascendente. Los n√∫meros pueden
cambiarse.
Reglas:
‚óè Los n√∫meros de objeto de un m√≥dulo deben ser un√≠vocos.
‚óè El n√∫mero de objeto menor es 1.

Canales de objetos
Cada objeto de datos tiene uno o m√°s canales de objeto, consulte el cap√≠tulo Tipos de puntos
de datos (P√°gina 1956).
Los canales de emisi√≥n y recepci√≥n de los objetos de datos se encargan de procesar un valor
de proceso individual en cada caso, p. ej. para preparar el env√≠o de un valor anal√≥gico o la
recepci√≥n y visualizaci√≥n de un byte de comando.
Cada objeto de datos contiene uno o varios canales de emisi√≥n o recepci√≥n. No es posible
modificar el n√∫mero y tipo de los canales de emisi√≥n y recepci√≥n por objeto de datos. As√≠, por
ejemplo, el objeto de datos "Ana04W_S" tiene 4 canales de env√≠o del tipo "enviar valor
anal√≥gico".
Si los objetos tienen varios canales del mismo tipo, no es necesario activarlos todos si no son
necesarios.
Reglas:
‚óè Todos los canales de un objeto deben tener el mismo tipo de punto de datos.
‚óè Los n√∫meros de canal de un objeto deben comenzar por 1 y asignarse en orden correlativo
y sin huecos.
‚óè Todos los canales de un objeto deben tener el mismo interlocutor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1967

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Puntos de datos DNP3 e IEC
General
Encontrar√° tambi√©n los principales par√°metros de la primera ficha del editor de puntos de
datos en la tabla de puntos de datos.
‚óè Origen de datos
‚Äì Nombre: nombre un√≠voco del punto de datos
‚Äì Consulte la asignaci√≥n de la variable PLC en el cap√≠tulo Configuraci√≥n de puntos de
datos y mensajes (P√°gina 1947).
‚Äì Consulte el tipo de punto de datos en el cap√≠tulo Tipos de puntos de datos
(P√°gina 1956).
‚Äì Consulte el √≠ndice de puntos de datos en el cap√≠tulo √çndice de punto de datos
(P√°gina 1970).
‚óè Funci√≥n de maestro
‚Äì Opci√≥n activada: los valores del punto de datos se env√≠an igual que en el caso de un
maestro:
‚Äë se reciben puntos de datos de entrada.
‚Äë se env√≠an puntos de datos de salida.
‚Äì Opci√≥n desactivada: el punto de datos puede emplearse para 'comunicaci√≥n directa'
entre estaciones:
‚Äë los puntos de datos de entrada pueden recibirse y enviarse.
‚Äë los puntos de datos de salida pueden enviarse y recibirse al mismo tiempo.
‚óè Vigilancia de valores
Solo con comandos DNP3 y salidas
Si esta opci√≥n est√° activada, el valor actual del punto de datos, que puede ser activado por
el maestro, es retroalimentado por la estaci√≥n al maestro. Adem√°s pueden activarse las
opciones de disparo del punto de datos para configurar el inicio del env√≠o.
‚óè Tipo de transferencia
Consulte el tipo de transferencia en el cap√≠tulo Memoria imagen de proceso, tipo de
transferencia, clases de eventos (P√°gina 1963).
‚óè Ciclo de lectura
Solo con entradas
Consulte el ciclo de lectura en el cap√≠tulo Ciclo de lectura (P√°gina 1972).
‚óè Respuesta a consulta general
Activa el punto de datos para la respuesta a una consulta general. Si la funci√≥n est√°
desactivada, el valor del punto de datos no se env√≠a al interlocutor de la comunicaci√≥n tras
una consulta general.
‚óè Asignaci√≥n a consulta de grupo
Solo con puntos de datos IEC
Asigna el punto de datos a una consulta de grupo.
Si el maestro realiza una consulta de grupo al grupo en cuesti√≥n, se env√≠a al maestro el
valor del punto de datos.

1968

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Identificaciones de estado de los puntos de datos
Identificaciones de estado
Las identificaciones de estado de puntos de datos listadas en las tablas siguientes se
transfieren con el valor en cada telegrama de datos dirigido al interlocutor de la comunicaci√≥n.
Pueden ser evaluados por el interlocutor de la comunicaci√≥n.
El CP 1243‚Äë8 IRC no proporciona identificaciones de estado.
Las identificaciones de estado se distinguen por el protocolo utilizado.
En la tabla, las entradas de la l√≠nea "Significado" se refieren a la entrada correspondiente de
la l√≠nea "Estado del bit".

TeleControl Basic
TCSB convierte los bits de estado (consulte la tabla) en el OPC quality code en funci√≥n del
estado.
‚óè Quality = BAD
Bit 2 o 7 = 1
‚óè Quality = UNCERTAIN
Bit 1 o 3 o 5 = 1
‚óè Quality = GOOD
Bits 1 y 2 y 3 y 5 y 6 = 0
Tabla 1-143 Ocupaci√≥n de bits del byte de estado 0
Bit

7

6

5

Nombre de
la marca

‚Äë

NON_

Substituted

Significado

‚Äë

Punto de da‚Äê Valor susti‚Äê
tos no dispo‚Äê tutivo
nible o direc‚Äê
ci√≥n S7 no
accesible

Estado del
bit

(siem‚Äê
pre 0)

EXISTENT

1

1

4

3

2

1

0

LOCAL_
FORCED

CARRY

OVER_
RANGE

RESTART

ONLINE

Operaci√≥n
local

Desborda‚Äê
miento del
valor de
contaje an‚Äê
tes de leer
el valor

Valor l√≠mite
del prepro‚Äê
cesamiento
de valores
anal√≥gicos
rebasado
por exceso
o defecto

El valor si‚Äê
gue sin ac‚Äê
tualizar tras
el inicio

Valor v√°lido

1

1

1

1

1

DNP3
Las identificaciones de estado corresponden a los elementos siguientes de las
especificaciones:

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1969

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
OBJECT FLAGS ‚Äë DNP3 Specification, Volume 6, Data Object Library - Part 1
Tabla 1-144 Ocupaci√≥n de bits del byte de estado
7

6

5

Nombre de
la marca

‚Äë

‚Äë

‚Äë

LOCAL_
FORCED

Significado

‚Äë

‚Äë

‚Äë

Operaci√≥n lo‚Äê Desborda‚Äê
cal
miento del va‚Äê
lor de contaje
antes de leer
el valor

Estado del
bit

(siem‚Äê
pre 0)

(siem‚Äê
pre 0)

(siem‚Äê
pre 0)

Bit

4

3
DISCONTI
NUITY

1

1

2
OVER_
RANGE

1
RESTART

Valor l√≠mite
El valor sigue
del preproce‚Äê sin actualizar
samiento de tras el inicio
valores ana‚Äê
l√≥gicos reba‚Äê
sado por ex‚Äê
ceso o defec‚Äê
to
1

1

0
ONLINE
Valor v√°lido

1

IEC 60870-5
Las identificaciones de estado corresponden a los elementos siguientes de las
especificaciones:
Quality descriptor ‚Äë IEC 60870 Part 5-101
Tabla 1-145 Ocupaci√≥n de bits del byte de estado
Bit

7

6

Nombre de
la marca

‚Äë

‚Äë

SB
substituted

‚Äë

CY
carry

OV
overflow

Significado

‚Äë

‚Äë

Valor sustitu‚Äê
tivo

‚Äë

Desborda‚Äê
miento del va‚Äê
lor de contaje
antes de leer
el valor

Rango de va‚Äê Valor no ac‚Äê
lores rebasa‚Äê tualizado
do por exce‚Äê
so, valor ana‚Äê
l√≥gico

Estado del
bit

(siem‚Äê
pre 0)

(siem‚Äê
pre 0)

1

(siem‚Äê
pre 0)

1

5

4

3

2

1

1
NT
not topical

1

0
IV
invalid
Valor v√°lido

0

√çndice de punto de datos
Configuraci√≥n del √≠ndice de punto de datos
A continuaci√≥n encontrar√° las reglas para configurar el √≠ndice de punto de datos en los
diferentes tipos de protocolo.
Para el protocolo ST7 no se configura ning√∫n √≠ndice de punto de datos.

1970

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

TeleControl Basic
Dentro de un CP, los √≠ndices de las clases de puntos de datos deben cumplir las reglas
siguientes:
‚óè Entrada
El √≠ndice de un punto de datos del tipo Entrada debe ser un√≠voco en todos los tipos de
puntos de datos (entradas digitales, entradas anal√≥gicas, etc.).
‚óè Salida
‚Äì Un punto de datos del tipo Salida puede tener el mismo √≠ndice que un punto de datos del
tipo Entrada.
‚Äì Varios puntos de datos del tipo Salida pueden tener el mismo √≠ndice.
Nota
Puntos de datos para la comunicaci√≥n cruzada con un CP en otra estaci√≥n S7
Tenga en cuenta que en la comunicaci√≥n cruzada los √≠ndices de los dos puntos de datos
correspondientes (parejas de puntos de datos) deben ser id√©nticos tanto en el CP que env√≠a
como en el que recibe.

DNP3
En un CP, los √≠ndices de puntos de datos deben ser un√≠vocos dentro de uno de los grupos de
objetos siguientes:
‚óè Binary Input / Binary Input Event
‚óè Binary Output / Binary Command
‚óè Counter / Counter Event
‚óè Analog Input / Analog Input Event
‚óè Analog Output
‚óè Octet String / Octet String Event
Los √≠ndices de dos puntos de datos en diferentes grupos de objetos pueden ser id√©nticos.
Los √≠ndices de dos puntos de datos pueden ser id√©nticos si los dos puntos de datos est√°n
configurados para interlocutores distintos.
Los √≠ndices de interlocutor correspondientes tienen que ser id√©nticos en el lado emisor y
receptor.

IEC 60870-5
Los √≠ndices de puntos de datos deben ser un√≠vocos dentro de un CP para cada interlocutor de
la comunicaci√≥n.
Los √≠ndices de puntos de datos asignados por duplicado se notifican como errores durante la
comprobaci√≥n de la coherencia e impiden que se compile el proyecto.
Los √≠ndices de dos puntos de datos pueden ser id√©nticos si los dos puntos de datos est√°n
configurados para interlocutores distintos.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1971

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los √≠ndices de interlocutor correspondientes tienen que ser id√©nticos en el lado emisor y
receptor.

Ciclo de lectura
Los puntos de datos de entrada se asignan al ciclo de lectura de la CPU en la configuraci√≥n de
puntos de datos, en la ficha "General > Ciclo de lectura".

Estructura del ciclo de muestreo de la CPU
El ciclo con el que el m√≥dulo de transferencia (TIM) explora el √°rea de memoria de la CPU
consta de las fases siguientes:
‚óè Peticiones de lectura con prioridad alta
(Ciclo r√°pido)
Para todos los puntos de datos con la asignaci√≥n "Ciclo r√°pido" se leen las variables PLC
en cada ciclo de muestreo.
Generalmente es suficiente con asignar al ciclo r√°pido solo los datos que deben registrarse
r√°pidamente, como alarmas, mensajes y objetos de comando, consigna y par√°metros para
la comprobaci√≥n 1 de n.
Consulte la comprobaci√≥n 1 de n en el glosario.
‚óè Peticiones de escritura
En cada ciclo se escriben en la CPU los valores de un n√∫mero determinado de peticiones
de escritura espont√°neas.
El n√∫mero de variables que se escriben en cada ciclo se especifica para el m√≥dulo de
transmisi√≥n con el par√°metro "N√∫mero m√°x. de peticiones de escritura" en el grupo de
par√°metros "Comunicaci√≥n con la CPU". Las variables cuyo n√∫mero excede este valor se
escriben en el pr√≥ximo ciclo o en uno de los siguientes.
‚óè Peticiones de lectura con prioridad baja - proporcionalmente
(Ciclo normal)
Para los puntos de datos con la asignaci√≥n "Ciclo normal" se leen los valores de sus
variables PLC proporcionalmente en cada ciclo de muestreo.
El n√∫mero de variables que se leen en cada ciclo se especifica para el m√≥dulo de
transmisi√≥n con el par√°metro "N√∫mero m√°x. de peticiones de lectura" del grupo de
par√°metros "Comunicaci√≥n con la CPU". Las variables que pasan de dicho valor y, por
tanto, no se leen en un ciclo, se leer√°n en el pr√≥ximo ciclo o en otro ulterior.
‚óè Tiempo de pausa del ciclo
Este tiempo de espera entre dos ciclos de muestreo sirve para reservar tiempo suficiente
para otros procesos que acceden a la CPU.

Ficha "Entrada local de consigna"
Consignas y su retroalimentaci√≥n
Las opciones que se describen a continuaci√≥n permiten registrar valores de salidas de
consigna introducidos localmente y retroalimentar al interlocutor con los valores actuales en
caso de que cambio. La modificaci√≥n de un valor local puede ser causada, p. ej. por una
operaci√≥n manual local.

1972

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Las funciones est√°n disponibles para los m√≥dulos siguientes:
‚óè TIM 3V‚ÄëIE / TIM 3V‚ÄëIE Advanced
‚óè TIM 4R‚ÄëIE
Las funciones pueden configurarse con los siguientes tipos de puntos de datos:
‚óè Entrada de consigna (Set01W_S)
‚óè Salida de consigna (Set01W_R)
‚óè Entrada de par√°metros (Par12D_S)
‚óè Salida de par√°metros (Par12D_R)
Para las funciones deben estar creados los puntos de datos de entrada y salida
correspondientes en los dos interlocutores de la comunicaci√≥n. Para la funci√≥n de
retroalimentaci√≥n reubique el valor local del controlador en la variable PLC correspondiente del
punto de datos.
Los par√°metros para el modo de entrada de consigna local y para la retroalimentaci√≥n son
opcionales. Si no los necesita d√©jelos desactivados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1973

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros
La lista muestra las funciones de los tipos de puntos de datos, as√≠ como la ficha y los grupos
de par√°metros en los que se configuran las funciones.
‚óè Entrada de consigna/par√°metros
Ficha "General" > "Origen de datos":
‚Äì Enviar consigna al interlocutor
La consigna est√° depositada en la variable PLC.
Ficha "Entrada local de consigna" > "Recibir":
‚Äì Recepci√≥n del modo de entrada de consigna 'Entrada local' enviado conjuntamente por
el objeto interlocutor
El modo de entrada se transmite a la variable PLC "Modo de entrada de consigna"
(Bool).
‚Äì Recepci√≥n del valor de retroalimentaci√≥n del interlocutor
El valor retroalimentado por el interlocutor se transmite a la variable PLC "Valor de
retroalimentaci√≥n".
‚óè Salida de consigna/par√°metros
Ficha "General" > "Origen de datos":
‚Äì Recibir consigna del interlocutor
La consigna se transmite a la variable PLC.
Ficha "Entrada local de consigna" > "Enviar":
‚Äì Env√≠o del modo de entrada de consigna local 'Entrada local' al objeto interlocutor
La informaci√≥n de si la consigna asignada localmente o si la consigna recibida por el
interlocutor es v√°lida se lee de la variable PLC "Modo de entrada de consigna":
‚Äë 0: la consigna recibida es v√°lida.
‚Äë 1: la consigna introducida localmente es v√°lida.
‚Äì Env√≠o de la consigna introducida localmente al interlocutor
La consigna se lee de la variable PLC "Consigna local".

Entrada de consigna local ‚Äë Recibir
El grupo de par√°metros est√° activo con tipos de datos emisores (*_S).

1974

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Para consignas locales del interlocutor est√°n disponibles los siguientes par√°metros:
‚óè Modo de entrada de consigna
A trav√©s de este par√°metro se recibe la respuesta del punto de datos del interlocutor sobre
su modo de entrada de consigna.
La informaci√≥n se guarda en la variable PLC (Bool).
‚Äì 0 = punto de datos remoto del interlocutor en el modo 'Recepci√≥n de consigna'
‚Äì 1 = punto de datos del interlocutor en el modo de entrada de consigna 'local'
El par√°metro tiene una mera funci√≥n de se√±alizaci√≥n. A trav√©s de este par√°metro y del
par√°metro correspondiente del punto de datos del interlocutor no se provoca en el
interlocutor un bloqueo de la especificaci√≥n de consigna local. El bloqueo debe realizarse
a trav√©s del programa de usuario.
Despu√©s del arranque de la CPU o de la CPU del interlocutor o de restablecerse la
conexi√≥n, se emite una consulta general para asegurar que en el par√°metro se muestre el
estado v√°lido actual del interlocutor.
‚óè Valor de retroalimentaci√≥n
El punto de datos del interlocutor que recibe la consigna retroalimenta la consigna v√°lida
actualmente en √©l, si en √©l est√° activado el par√°metro "Estado de la consigna". Esta
consigna retroalimentada se visualiza aqu√≠.
Si el objeto interlocutor est√° en "local" y all√≠ se hace una nueva entrada, aqu√≠ se mostrar√°
la consigna modificada all√≠, si en el objeto interlocutor est√° activado el par√°metro "Consigna
local".
Despu√©s del arranque de la CPU o de la CPU del interlocutor o de restablecerse la
conexi√≥n, se emite una consulta general para asegurar que en el par√°metro se muestre la
consigna v√°lida del interlocutor.

Entrada de consigna local ‚Äë Enviar
El grupo de par√°metros est√° activo con tipos de datos receptores (*_R).
Para consignas locales de la propia estaci√≥n est√°n disponibles los siguientes par√°metros:
‚óè Modo de entrada de consigna
A trav√©s de esta entrada puede se√±alizarse la informaci√≥n de si es v√°lida la consigna
especificada a nivel local o la consigna enviada por el interlocutor.
La informaci√≥n se guarda en la variable PLC (Bool).
‚Äì 0 = la consigna del interlocutor es v√°lida.
‚Äì 1 = la consigna introducida localmente es v√°lida.
Si se ha activado el par√°metro (True), el objeto puede aceptar tambi√©n una consigna
enviada por el interlocutor (p. ej. por la central).
El par√°metro tiene una mera funci√≥n informativa. El enclavamiento con la especificaci√≥n de
consigna remota ha de realizarse en el programa de usuario.
‚óè Consigna local
Con el par√°metro activado, la consigna introducida localmente se lee desde la variable PLC
y se retroalimenta al punto de datos de emisi√≥n del interlocutor.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1975

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ficha "Disparo"
Disparo
Los puntos de datos se configuran como valores est√°ticos o como eventos mediante el
par√°metro "Tipo de transferencia":
El almacenamiento de un valor de evento en el b√∫fer de transmisi√≥n (memoria de telegrama)
puede iniciarse utilizando diferentes tipos de disparo:
‚óè Disparo de valor umbral
El valor del punto de datos se guarda cuando alcanza un umbral determinado. El umbral se
calcula como diferencia respecto del √∫ltimo valor guardado, consulte el cap√≠tulo Disparo de
valor umbral (P√°gina 1978).
‚óè Disparo de tiempo
El valor del punto de datos se guarda en un espacio de tiempo configurable o a una hora
determinada.
‚óè Disparo de evento (variable de disparo)
El valor del punto de datos se guarda cuando se lanza una se√±al de disparo configurable.
Como se√±al de disparo se eval√∫a el cambio de flanco (0 ‚Üí 1) de una variable de disparo
activada desde el programa de usuario. En caso necesario es posible configurar una
variable de disparo independiente para cada punto de datos.
Reinicio de la variable de disparo en el √°rea de marcas / DB:
Cuando el √°rea de memoria de la variable de disparo est√° en el √°rea de marcas o en un
bloque de datos, la variable de disparo se pone a cero al transferir el valor. Esto puede
tardar 500 milisegundos como m√°ximo.
Nota
Activaci√≥n r√°pida de disparos
Los disparos no puede activarse con m√°s rapidez que con una distancia m√≠nima de 500
milisegundos. Lo mismo es v√°lido para disparos de hardware (√°rea de entrada).
Nota
Disparo de hardware
Los disparos de hardware se desactivan mediante el programa de usuario.

1976

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Archivaci√≥n de eventos
El TIM 1531 IRC permite guardar los valores de puntos de datos disparados en la tarjeta SD
de la CPU.
‚óè Activar archivaci√≥n
En caso de fallos de conexi√≥n, activa el almacenamiento remanente de valores de eventos
(b√∫fer de transmisi√≥n) en la tarjeta SD.
Requisitos para poder activar la funci√≥n:
‚Äì Activaci√≥n del par√°metro "Almacenamiento remanente" (grupo de par√°metros "Ajustes
b√°sicos")
‚Äì Desactivaci√≥n del par√°metro "Funci√≥n de maestro" (editor de puntos de datos > ficha
"General")
La archivaci√≥n es posible en los siguientes tipos de puntos de datos:
‚óè ST7
‚Äì Bin04B_S / Bin08X_S
‚Äì Ana04W_S / Ana04R_S
‚Äì Mean04W_S
‚Äì Cnt01D_S / Cnt04D_S
‚Äì Dat12D_S / Dat12x1D_S
‚Äì Cmd01B_S / Cmd08X_S
‚Äì Set01W_S
‚Äì Par12D_S / Par12x1D_S
‚óè DNP3
‚Äì Binary Input Event (2)
‚Äì Counter Input Event (22)
‚Äì Analog Input Event (32)
‚Äì Octet String Event (111)
‚óè IEC 60870‚Äë5
‚Äì Information objects <1/5/30/32>
‚Äì Measured value <9/11/13/34/35/36>
‚Äì Integrated totals <15/37>
‚Äì Bitstring <7/33>

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1977

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Momento de transferencia
Seg√∫n el protocolo utilizado y los ajustes, el valor de un evento se transferir√° al interlocutor de
inmediato o con retardo tras iniciar el disparo.
‚óè DNP3 / IEC
Con estos protocolos la transferencia espont√°nea depende de si en la red es posible el
env√≠o espont√°neo o la comunicaci√≥n asim√©trica.
En m√≥dulos DNP3, esto puede ajustarse mediante el par√°metro "Se√±alizaci√≥n
espont√°nea" en el grupo de par√°metros "Ajustes de estaci√≥n DNP3" de la interfaz o bien
mediante el par√°metro "Espont√°neo" del editor de conexiones.
‚óè TeleControl Basic / ST7
Aqu√≠ se determina el momento de transferencia con el par√°metro "Modo de transferencia"
en el punto de datos.

Modo de transferencia
El modo de transferencia de un telegrama ST7 se ajusta en la ficha "Disparo" del punto de
datos. Con esta opci√≥n se especifica si los telegramas de datos de los eventos se env√≠an de
inmediato o con retardo:
‚óè Espont√°neo (transferencia directa)
El valor se transfiere de inmediato.
‚óè Espont√°neo con limitaciones (transferencia respaldada)
El valor no se transfiere hasta que se cumple una de las condiciones siguientes:
‚Äì El interlocutor de la comunicaci√≥n consulta la estaci√≥n.
‚Äì Se transfiere el valor de otro evento con el modo de transferencia "Espont√°neo".
‚Äì El nivel de llenado del b√∫fer de transmisi√≥n ha alcanzado el 80 % de su capacidad
m√°xima.

Disparo de valor umbral
Nota
Disparo de valor umbral: c√°lculo despu√©s del Preprocesamiento de valores anal√≥gicos
Tenga en cuenta que el preprocesamiento de valores anal√≥gicos se lleva a cabo antes de la
comprobaci√≥n de un valor umbral configurado y antes de calcular el valor umbral.
Esto afecta al valor que se configura en Disparo de valor umbral.
Nota
No hay disparo de valor umbral si c√°lculo del valor medio est√° configurado
Si el c√°lculo del valor medio est√° configurado, no es posible configurar un disparo de valor
umbral para el evento de valor anal√≥gico correspondiente.
Respecto al proceso de Preprocesamiento de valores anal√≥gicos consulte el cap√≠tulo
Preprocesamiento de valores anal√≥gicos (P√°gina 1980).

1978

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Disparo de valor umbral
Funci√≥n
Si el valor de proceso difiere en el valor de umbral, se guarda el valor de proceso.
Para calcular la desviaci√≥n del valor de umbral se aplican dos m√©todos:
‚óè M√©todo absoluto
Para valores binarios o num√©ricos, as√≠ como para valores anal√≥gicos, para los que se ha
configurado la formaci√≥n del promedio, se aplica el m√©todo absoluto para calcular la
desviaci√≥n del valor de umbral.
‚óè M√©todo integrativo
Para valores anal√≥gicos, para los que no se ha configurado la formaci√≥n del promedio, se
aplica el m√©todo integrativo para calcular la desviaci√≥n del valor de umbral.
En el c√°lculo integrador del valor umbral no se eval√∫a el valor absoluto de la desviaci√≥n del
valor de proceso respecto del √∫ltimo valor guardado, sino la diferencia integrada.
M√©todo absoluto
Para cada valor binario se comprueba si el valor actual (quiz√° filtrado) se encuentra fuera del
margen del valor de umbral. El margen aplicable en cada caso resulta del √∫ltimo valor
almacenado y del valor absoluto del valor de umbral configurado:
‚óè L√≠mite superior del margen del valor de umbral: √∫ltimo valor almacenado + valor de umbral
‚óè L√≠mite inferior del margen del valor de umbral: √∫ltimo valor almacenado - valor de umbral
En cuanto el valor de proceso alcanza el l√≠mite superior o inferior del margen del valor de
umbral, se almacena el valor. El nuevo valor guardado sirve de base para calcular el nuevo
margen del valor de umbral.
M√©todo integrativo
El c√°lculo integrador del valor umbral trabaja con una comparaci√≥n c√≠clica del valor actual
integrado con el √∫ltimo valor guardado. El ciclo de c√°lculo en el que se comparan ambos
valores es de 500 milisegundos.
(Observaci√≥n: el ciclo de c√°lculo no debe confundirse con el ciclo de muestreo de las √°reas de
memoria de la CPU).
Las desviaciones del valor de proceso actual se totalizan en cada ciclo de c√°lculo. El disparo
no se activa hasta que el valor totalizado alcanza el valor configurado para el disparo de valor
umbral y entonces se registra un valor de proceso nuevo en el b√∫fer de transmisi√≥n.
El m√©todo se explica con el ejemplo siguiente, que tiene configurado un valor umbral de 2,0.
Tabla 1-146 Ejemplo de c√°lculo integrador de un valor umbral configurado con 2,0
Tiempo [s]

Diferencia absoluta
respecto del valor
guardado

Diferencia integra‚Äê
da

20,0

0

0

0,5

20,3

+0,3

0,3

1,0

19,8

-0,2

0,1

1,5

20,2

+0,2

0,3

(ciclo de c√°lculo)
0

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Valor de proceso Valor de proceso
guardado en el
actual
b√∫fer de transmi‚Äê
si√≥n
20,0

1979

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tiempo [s]
(ciclo de c√°lculo)

Valor de proceso Valor de proceso
guardado en el
actual
b√∫fer de transmi‚Äê
si√≥n

Diferencia absoluta
respecto del valor
guardado

Diferencia integra‚Äê
da

2,0

20,5

+0,5

0,8

2,5

20,3

+0,3

1,1

3,0
3,5

20,5

4,0

20,4

+0,4

1,5

20,5

+0,5

2,0

20,4

-0,1

-0,1

4,5

20,1

-0,4

-0,5

5,0

19,9

-0,6

-1,1

5,5
6,0

19,9

20,1

-0,4

-1,5

19,9

-0,6

-2,1

En el desarrollo del valor de proceso mostrado en el ejemplo, el disparo de valor umbral
configurado con 2,0 se lanza dos veces:
‚óè En el instante 3,5 s: El importe de la diferencia integrada es de 2,0. El nuevo valor de
proceso guardado en el b√∫fer de transmisi√≥n es 20,5.
‚óè En el instante 6,0 s: El importe de la diferencia integrada es de 2,1. El nuevo valor de
proceso guardado en el b√∫fer de transmisi√≥n es 19,9.
Si en este ejemplo una desviaci√≥n del valor de proceso de aprox. 0,5 debiera originar el
disparo, deber√≠a configurarse un valor umbral de entre 1,5 y 2,5 en el comportamiento
representado del valor de proceso.

Preprocesamiento de valores anal√≥gicos
Los CPs con configuraci√≥n de punto de datos soportan el preprocesamiento de valores
anal√≥gicos. Para puntos de datos de valores anal√≥gicos pueden configurarse algunas o todas
las funciones descritas a continuaci√≥n.
Requisitos y restricciones
Encontrar√° los requisitos para la configuraci√≥n de las opciones de preprocesamiento as√≠ como
las restricciones mutuas en el apartado correspondiente a cada funci√≥n.
Nota
Restricciones debidas a disparos configurados
Las opciones de preprocesamiento de valores anal√≥gicos "Tiempo de supresi√≥n de errores",
"C√°lculo de valores l√≠mite" y "Filtrado" no se ejecutan si no se ha configurado un disparo de
valor umbral para el punto de datos correspondiente. En estos casos, el valor de proceso le√≠do
del punto de datos se registra en la memoria imagen del CP antes de que finalice el ciclo de
preprocesamiento del c√°lculo de valor umbral (500 ms) y se transfiere de forma transparente.

1980

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ejecuci√≥n de las opciones de preprocesamiento de valores anal√≥gicos
Los valores de entradas anal√≥gicas que est√°n configuradas como eventos se procesan en el
CP siguiendo el esquema descrito a continuaci√≥n:
/HHUGDWRVGHOD&38

&¬£OFXORGHO
YDORUvPHGLR
FRQILJXUDGR

1R

FLFORGHPV
WHUPLQDGR

6¬Ø

1R

6¬Ø

&¬£OFXORGHOYDORUPHGLR
FLFORGHPV

'LVSDURGHYDORU
XPEUDO
FRQILJXUDGR

7UDQVIHUHQFLD
XQLSRODU
FRQILJXUDGD

1R

6¬Ø

1R

7UDQVIHUHQFLD
XQLSRODU

6¬Ø
'LVSDURGHYDORU
XPEUDO
FRQILJXUDGR

&¬£OFXORGHOYDORUXPEUDO
3URFHGLPLHQWRDEVROXWR

1R

6¬Ø
7LHPSRGH
VXSUHVL¬µQGHHUURUHV
FRQILJXUDGR

1R

5HEDVHSRUH[FHVR
GHOYDORUXPEUDO

1R

6¬Ø

6¬Ø
$FWLYDU
'LVSDURGHWLHPSR
HYHQWR
6¬Ø

6XSUHVL¬µQ
GHHUURUHV
1R

9DORUHQPHPRULD
LPDJHQ

9DORUHVO¬ØPLWH
FRQILJXUDGRV

1R

6¬Ø
&¬£OFXORGHYDORU
O¬ØPLWH

7UDQVIHUHQFLDGHYDORU
)LOWUDGR
FRQILJXUDGR

1R

6¬Ø
)LOWUDGR
&¬£OFXORGHOYDORUXPEUDO
3URFHGLPLHQWRLQWHJUDWLYR
FLFORGHPV
6¬Ø
5HEDVHSRUH[FHVR
GHOYDORUXPEUDO
6¬Ø

1R

'LVSDURGH
HYHQWRWLHPSR
FRQILJXUDGR
6¬Ø
$FWLYDU
'LVSDURGHWLHPSR
HYHQWR

7UDQVIHUHQFLDGHYDORU

Figura 1-119

1R

1R
9DORUHQPHPRULD
LPDJHQ

Ejecuci√≥n del preprocesamiento de valores anal√≥gicos

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1981

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
El ciclo de 500 milisegundos se aplica mediante el c√°lculo integrativo del valor umbral. En este
ciclo, los valores se guardan tambi√©n cuando se activan las siguientes opciones de
preprocesamiento:
‚óè Transferencia unipolar
‚óè Tiempo de supresi√≥n de errores
‚óè C√°lculo de valores l√≠mite
‚óè Filtrado

C√°lculo del valor medio
Nota
Opciones de preprocesamiento limitadas en caso de configurar el c√°lculo del valor medio
Si se configura el c√°lculo del valor medio para un evento de valor anal√≥gico, no estar√°n
disponibles las siguientes opciones de preprocesamiento:
‚óè Transferencia unipolar
‚óè Tiempo de supresi√≥n de errores
‚óè Filtrado
Funci√≥n
Con este par√°metro se transfieren valores anal√≥gicos captados como valores medios.
El c√°lculo del valor medio solo se soporta para enteros del tipo "Int" en el caso de los protocolos
siguientes:
‚óè TeleControl Basic
‚óè DNP3
‚óè IEC 60870‚Äë5
Si el c√°lculo del valor medio est√° activado es conveniente configurar un disparo de tiempo.
Los valores actualmente pendientes para un punto de datos de valor anal√≥gico se leen y
totalizan en un ciclo de 100 milisegundos. El n√∫mero de valores le√≠dos por unidad de tiempo
depende del ciclo de lectura de la CPU y del ciclo de muestreo de la CPU para el CP.
A partir de los valores totalizados se calcula el valor medio en cuanto se lanza la transferencia
por medio de un disparo. A continuaci√≥n se reinicia la totalizaci√≥n para calcular el pr√≥ximo valor
medio.
El valor medio tambi√©n se calcula cuando la transferencia del telegrama de valores anal√≥gicos
es lanzada por una llamada del interlocutor de la comunicaci√≥n. En este caso, la duraci√≥n del
per√≠odo de c√°lculo es el tiempo que transcurre entre la √∫ltima transferencia (p. ej. lanzada por
el disparo) y el instante de la llamada. Despu√©s de esta transferencia tambi√©n se reinicia la
totalizaci√≥n para calcular el pr√≥ximo valor medio.
M√≥dulos de entrada: Rango de rebase por exceso / Rango de rebase por defecto
En cuanto se capta un valor en el rango de desbordamiento por exceso o defecto se cancela
el c√°lculo del valor medio. Para el per√≠odo de c√°lculo en curso, el valor 32767 / 7FFFh o ‚Äë32768 /
8000h se guarda como valor medio no v√°lido y se transfiere en el pr√≥ximo telegrama de datos.

1982

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Posteriormente se inicia un nuevo c√°lculo del valor medio. Si el valor anal√≥gico sigue estando
en el rango de desbordamiento por exceso o defecto, uno de los dos valores citados se guarda
como valor medio no v√°lido y se env√≠a con la pr√≥xima transferencia que se inicie.
Nota
Tiempo de supresi√≥n de errores > 0 configurado
Si se ha configurado un tiempo de supresi√≥n de errores y posteriormente se activa el c√°lculo
del valor medio, el valor del tiempo de supresi√≥n de errores se aten√∫a y deja de aplicarse. El
tiempo de supresi√≥n de errores se pone a 0 (cero) internamente cuando el c√°lculo del valor
medio est√° activado.

Transferencia unipolar
Restricciones
La transferencia unipolar no puede configurarse simult√°neamente con el c√°lculo del valor
medio. La activaci√≥n de la transferencia unipolar deja de tener efecto en el momento de
activarse el c√°lculo del valor medio.
Funci√≥n
Al activar la transferencia unipolar se corrigen los valores negativos a cero. Esto puede ser
aconsejable si los valores del rango de saturaci√≥n por debajo no deben transmitirse como
valores medidos reales.
Excepci√≥n: En los datos de proceso de m√≥dulos de entrada, el valor -32768 / 8000h se
transfiere para la rotura de hilo de un entrada Life Zero.
En cambio, en una entrada de software se corrigen a cero todos los valores inferiores a cero.

Tiempo de supresi√≥n de errores
Requisitos para la funci√≥n
Configuraci√≥n del disparo de valor umbral para este punto de datos
Restricciones
El tiempo de supresi√≥n de errores no puede configurarse simult√°neamente con el c√°lculo del
valor medio. Un valor configurados deja de tener efecto en el momento de activarse el c√°lculo
del valor medio.
Funci√≥n
Un caso t√≠pico de aplicaci√≥n para este par√°metro es la supresi√≥n de valores de corriente de
pico al arrancar motores potentes que, en caso de no hacerse, se notificar√≠an como fallo al
punto de control.
La transmisi√≥n de un valor anal√≥gico que se encuentra en el rango de desbordamiento por
exceso (7FFFh) o defecto (8000h) se suprime mientras dure el intervalo de tiempo indicado.
Una vez transcurrido el tiempo de supresi√≥n de errores se transmitir√° el valor de 7FFFh o
8000h, siempre que siga pendiente.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1983

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Si el valor vuelve a entrar en el rango asignado antes de que transcurra el tiempo de supresi√≥n
de errores se transferir√° el valor actual.
M√≥dulos de entrada
La supresi√≥n est√° ajustada a valores anal√≥gicos que son captados directamente como valores
brutos por los m√≥dulos de entradas anal√≥gicas S7. Dichos m√≥dulos suministran para todas las
√°reas de entrada los valores citados para el rango de desbordamiento por exceso y defecto,
incluso para entradas Life Zero.
Un valor anal√≥gico en el rango de desbordamiento por exceso (32767 / 7FFFh) o defecto
(‚Äë32768 / 8000h) no se transfiere mientras dure el tiempo de supresi√≥n de errores. Lo mismo es
v√°lido para entradas Life Zero. Una vez transcurrido el tiempo de supresi√≥n de errores se
transferir√° el valor en el rango de desbordamiento por exceso o defecto, siempre que siga
pendiente.
Recomendaci√≥n para valores listos que han sido preprocesados por la CPU:
Si en el √°rea de marcas o en un bloque de datos se preparan valores listos preprocesados por
la CPU, solo es posible o aconsejable una supresi√≥n cuando los valores listos tambi√©n adoptan
los valores citados de 32767 / 7FFFh o ‚Äë32768 / 8000h en el rango de desbordamiento por
exceso o defecto, respectivamente. En caso contrario, no deber√≠a configurarse el par√°metro
para valores preprocesados.
Los valores de desbordamiento por exceso y defecto pueden asignarse libremente para
valores listos preprocesados en la CPU.

Factor de filtrado
Requisitos para la funci√≥n
Configuraci√≥n del disparo de valor umbral para este punto de datos
Restricciones
El factor de filtrado no puede configurarse simult√°neamente con el c√°lculo del valor medio. Un
valor configurados deja de tener efecto en el momento de activarse el c√°lculo del valor medio.
Funci√≥n
Los valores anal√≥gicos que sufren oscilaciones r√°pidas pueden estabilizarse utilizando la
funci√≥n de filtrado.
Los factores de filtrado se calculan siguiendo la f√≥rmula siguiente, igual que en los m√≥dulos de
entradas anal√≥gicas S7.

\Q

[ Q  N ‡∑•  \ Q
N

siendo
yn = valor filtrado en el ciclo actual n
yn-1 = valor filtrado en el ciclo anterior n-1
xn = valor captado en el ciclo actual n
k = factor de filtrado

1984

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los valores siguientes pueden configurarse como factor de filtrado para el m√≥dulo.
‚óè 1 = sin filtrado
‚óè 4 = filtrado d√©bil
‚óè 32 = filtrado medio
‚óè 64 = filtrado fuerte

Establecer valor l√≠mite 'bajo' / Establecer valor l√≠mite 'alto'
Requisitos para la funci√≥n
‚óè Configuraci√≥n del disparo de valor umbral para este punto de datos
‚óè Variable PLC en el √°rea de operandos de marcas o datos
El punto de datos de valor anal√≥gico debe estar enlazado con una variable PLC en el √°rea
de marcas o datos (bloque de datos). Para variables PLC de m√≥dulos de hardware (√°rea de
operandos de entrada) no es posible la configuraci√≥n de valores l√≠mite.
Para valores medidos que ya se han preprocesado en la CPU, no tiene sentido configurar
valores l√≠mite.
Funci√≥n
En estos dos campos de entrada existe la posibilidad de establecer un valor l√≠mite en el sentido
del principio del rango de medici√≥n o en el sentido del fin de rango de medici√≥n. As√≠, por
ejemplo, los valores l√≠mite pueden evaluarse tambi√©n como principio del rango de medici√≥n o
fin del rango de medici√≥n.
Identificaci√≥n de estado "OVER_RANGE" / "overflow"
En los protocolos que soportan identificaciones de estado, cuando se rebasa por defecto o
exceso el valor l√≠mite se activa la identificaci√≥n de estado del punto de datos para rebase por
exceso del rango de medici√≥n, en adelante denominado como identificador "OV". Las
identificaciones de estado se describen en el cap√≠tulo Identificaciones de estado de los puntos
de datos (P√°gina 1969).
El bit "OV" del identificador de estado del punto de datos se activa cuando se transfiere el valor
anal√≥gico correspondiente, de la forma siguiente:
‚óè Valor l√≠mite "alto":
‚Äì Cuando se rebasa por exceso el valor l√≠mite: OV = 1
‚Äì Cuando seguidamente se rebasa por defecto el valor l√≠mite: OV = 0
‚óè Valor l√≠mite "bajo":
‚Äì Cuando se rebasa por defecto el valor l√≠mite: OV = 1
‚Äì Cuando seguidamente se rebasa por exceso el valor l√≠mite: OV = 0

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1985

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Configuraci√≥n del valor l√≠mite
El valor l√≠mite se configura como n√∫mero decimal entero. El rango de valores se orienta en el
rango del valor bruto de m√≥dulos de entradas anal√≥gicas.
Rango

Valor bruto (16 bits)
Decimal

Hexadecimal

Salida del m√≥dulo [mA]
0 .. 20

-20 .. +20

4 .. 20

(unipolar)

(bipolar)

(life zero)

Rango de
medici√≥n
[%]

Rebase por exceso

32767

7FFF

> 23,515

> 23,515

> 22,810

> 117,593

Rango de saturaci√≥n por enci‚Äê
ma

32511
...
27649

7EFF
...
6C01

23,515
...
20,001

23,515
...
20,001

22,810
...
20,001

117,593
...
100,004

Rango nominal
(unipolar / life zero)

27648
...
0

6C00
...
0000

20
...
0

20
...
4

100
...
0

27648 ...

6C00 ...

Rango nominal (bipolar)

20 ...

100 ...

0

0000

0

0

... -27648

... 9400

... -20

... -100

Rango de saturaci√≥n por deba‚Äê
jo
(unipolar / life zero)

-1
...
-4864

FFFF
...
ED00

Rango de saturaci√≥n por deba‚Äê
jo (bipolar)

-27649
...
-32512

93FF
...
8100

Rebase por defecto / rotura de
hilo

-32768

8000

-0,001
...
-3,518

3,999
...
1,185
-20,001
...
-23,516

< -3,518

-0,004
...
-17,59
-100,004
...
-117,593

< 1,185

< -17,593

Tenga en cuenta lo siguiente: La entrada del valor 0 (cero) se interpreta como valor l√≠mite
desactivado.
Recomendaci√≥n para valores anal√≥gicos que sufren oscilaciones r√°pidas:
Si el valor anal√≥gico sufre oscilaciones r√°pidas, en los valores l√≠mites configurados puede ser
√∫til filtrar previamente el valor anal√≥gico.

M√°scaras
Enmascaramiento de bits individuales en el byte de entradas binarias (Bin04B_S)
En el grupo de par√°metros "M√°scaras" se ofrecen tres opciones para transmitir valores
binarios. Los bits correspondientes se enmascaran en formato hexadecimal.

1986

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
La entrada de valores hexadecimales permite especificar individualmente para cada bit si
determinados bits no provocan ninguna transmisi√≥n o qu√© bits se transmiten en otro modo de
transmisi√≥n.
‚óè M√°scara de alarma
Los bits enmascarados provocan una transmisi√≥n espont√°nea sin limitaciones en caso de
cambio. Se eval√∫an los cambios de 0 a 1 y de 1 a 0.
El enmascaramiento "Alarm mask" solo es aconsejable cuando el punto de datos se
transmite por una red de marcaci√≥n con la opci√≥n "Conditional spontaneous" activada.
‚óè M√°scara de principio del b√∫fer de env√≠o
Los bits enmascarados provocan una transmisi√≥n seg√∫n el principio del b√∫fer de
transmisi√≥n en caso de cambio. Se eval√∫an los cambios de 0 a 1 y de 1 a 0.
La m√°scara de principio de b√∫fer del b√∫fer de env√≠o solo es aconsejable con la opci√≥n
"Memoria de imagen".
‚óè M√°scara de bloqueo
Los bits enmascarados no se toman en consideraci√≥n en el control de cambios. Esto hace
que los cambios en los bits enmascarados no provoquen transmisi√≥n alguna para este
punto de datos. Por principio, un bit enmascarado tiene el valor 0 en el telegrama de datos.

Ejemplo de asignaci√≥n de bytes
La tabla siguiente muestra el enmascaramiento del bit de acuerdo con el valor hexadecimal
"A3" registrado en el campo de entrada del par√°metro.
Tabla 1-147 Ocupaci√≥n de bytes
Bit:

.7

.6

.5

.4

.3

.2

.1

.0

Enmascarado

1

0

1

0

0

0

1

1

M√°scara Hex

A

3

Los bits ocupados con el valor 1 est√°n enmascarados, es decir, los bits n.¬∫ 0, 1, 5 y 7 originan
la funci√≥n correspondiente en las m√°scaras descritas.

Salida de comando
Opciones de procesamiento de salidas de comando
Par√°metros
Para puntos de datos en estaciones que emiten comandos de una estaci√≥n central o de un
maestro pueden activarse tambi√©n las siguientes opciones de salida:
‚óè LATCH_ON/OFF
Esta funci√≥n bloquea una salida de comando en el valor 0 o 1 de forma permanente.
Recuerde:
El valor bloqueado no se anula hasta que hay otro comando. El comando tambi√©n puede
anularse desde el programa de usuario.
‚óè PULSE_ON/OFF
La funci√≥n eval√∫a el n√∫mero y la longitud de se√±ales (impulsos) de comandos procedentes
de una central.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1987

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Tipos de puntos de datos
Las opciones de salida pueden configurarse para los siguientes tipos de puntos de datos:
‚óè ST7
Salida de comando (Cmd01B_R)
‚óè IEC
Single command
‚óè DNP3
Binary Command Output
Referencia a especificaciones
Las opciones de salida corresponden a las siguientes partes de la especificaci√≥n:
‚óè IEC
Qualifier of command ‚Äë IEC 60870-5-101, parte 1
‚óè DNP3
Control Code, Operation Type field (OP Type) ‚Äë Volume 6, Part 2, Objects

Procesamiento en funci√≥n del protocolo
ST7
‚óè LATCH_ON/OFF
Esta funci√≥n bloquea el valor de un comando de la forma descrita anteriormente.
‚óè PULSE_ON/OFF
Esta funci√≥n eval√∫a el "Tiempo de emisi√≥n para salida de comando" para un √∫nico impulso
(v√©ase a continuaci√≥n).
IEC
‚óè LATCH_ON/OFF
Esta funci√≥n bloquea el valor de un comando de la forma descrita anteriormente.
‚óè PULSE_ON/OFF
El maestro codifica la funci√≥n mediante un "Qualifier of command". El m√≥dulo de
comunicaci√≥n eval√∫a las codificaciones siguientes en la estaci√≥n:
‚Äì QU (Type 1.1) <0> no additional definition
Par√°metro correspondiente en el m√≥dulo: "Control de impulsos"
‚Äì QU (Type 1.1) <1> short pulse duration
Par√°metro correspondiente en el m√≥dulo: "Duraci√≥n de impulso corta"
‚Äì QU (Type 1.1) <2> long pulse duration
Par√°metro correspondiente en el m√≥dulo: "Duraci√≥n de impulso larga"
‚Äì S/E (Type 6) <0> execute
Par√°metro correspondiente en el m√≥dulo: "Modo de comando"
‚Äì S/E (Type 6) <1> select
Par√°metro correspondiente en el m√≥dulo: "Modo de comando"
DNP3

1988

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Ambas funciones son codificadas por el maestro a trav√©s del Control Code del objeto.
‚óè LATCH_ON/OFF
Esta funci√≥n bloquea una salida de comando en el valor 0 o 1 de forma permanente.
La estaci√≥n procesa el comando seg√∫n el Complementary Latch Model.
‚óè PULSE_ON/OFF
La funci√≥n eval√∫a en telegramas de comando de un maestro el Control Code "PULSE_ON".
El maestro env√≠a a la estaci√≥n la informaci√≥n "Trip-Close Count", "On-time", "Off-time" y
"Pulse count" con el telegrama de comando.
El punto de datos de la estaci√≥n eval√∫a esa informaci√≥n y comprueba si es coherente con
los par√°metros "Duraci√≥n m√°x. de impulso", "Duraci√≥n de impulso tiempo de sustituci√≥n" y
"N√∫mero m√°x. de impulsos".
El TIM 1531 IRC procesa el comando seg√∫n el Activation Model.
El campo "Clear" (CR) no es compatible.
El punto de datos de la estaci√≥n eval√∫a la codificaci√≥n del Control Code de la siguiente forma.
Tabla 1-148 Descodificaci√≥n del DNP3 Control Code por el punto de datos de comando de la estaci√≥n
Control Code recibido

Reacci√≥n del punto de datos de estaci√≥n

Control
Code

TripClose
Code

Operation
Type Field

Opci√≥n activada:

Opci√≥n activada:

PULSE_ON

LATCH_ON / OFF

0x01

NUL

PULSE_ON

La salida se pone de "On-time"
a 1 de forma permanente.

El comando se rechaza.

0x03

NUL

LATCH_ON

‚óè CP
El comando se rechaza.

La salida se pone a 1.

‚óè TIM 1531 IRC
La salida se pone de "Ontime" a 1 de forma
permanente.
0x04

NUL

LATCH_OFF ‚óè CP
El comando se rechaza.

La salida se pone a 0.

‚óè TIM 1531 IRC
La salida se pone de "Ontime" a 1 de forma
permanente.
0x41

0x81

CLOSE

TRIP

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

PULSE_ON

PULSE_ON

‚óè CP
El comando se rechaza.

‚óè CP
El comando se rechaza.

‚óè TIM 1531 IRC
La salida se pone de "Ontime" a 1 de forma
permanente.

‚óè TIM 1531 IRC
La salida se pone a 1.

‚óè CP
El comando se rechaza.

‚óè CP
El comando se rechaza.

‚óè TIM 1531 IRC
La salida se pone de "Ontime" a 1 de forma
permanente.

‚óè TIM 1531 IRC
La salida se pone a 0.

1989

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
Retroalimentaci√≥n
Si el punto de datos de estaci√≥n debe retroalimentar al maestro el valor actual, active en el ficha
"General" del punto de datos la opci√≥n "Vigilancia de valores".

Par√°metros
Nombre:
Control Code
Rango de valo‚Äê ‚óè PULSE_ON
res:
‚óè LATCH_ON/OFF
Explicaci√≥n:
Opci√≥n de salida de la salida de comando. Consulte el significado m√°s arriba.
Nombre:

Control de impulsos
(solo maestro)
‚óè DNP3: Trip-Close Code
‚óè IEC: Qualifier of command
Rango de valo‚Äê DNP3:
res:
‚óè NUL
‚óè CLOSE
‚óè TRIP
IEC:
‚óè No hay especificaciones
Para los dem√°s cualificadores consulte los par√°metros "Duraci√≥n de
impulso corta / Duraci√≥n de impulso larga" m√°s abajo.
Explicaci√≥n:
Trip-Close Code para el Control Code "PULSE_ON". El punto de datos trans‚Äê
fiere el c√≥digo configurado al punto de datos correspondiente de la estaci√≥n.
Consulte el significado m√°s arriba.
Nombre:

Duraci√≥n ON de impulso
(solo maestro)
Rango de valo‚Äê 0 ... 4294967295
res:
Ajuste prede‚Äê 10
terminado:
Explicaci√≥n:
Tiempo (milisegundos) para "On-time". El punto de datos transfiere el tiempo
configurado al punto de datos correspondiente de la estaci√≥n.

1990

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre:

Duraci√≥n OFF de impulso
(solo maestro)
Rango de valo‚Äê 0 ... 4294967295
res:
Ajuste prede‚Äê 0
terminado:
Explicaci√≥n:
Tiempo (milisegundos) para "Off-time". El punto de datos transfiere el tiempo
configurado al punto de datos correspondiente de la estaci√≥n.
Nombre:

N√∫mero de impulsos
(solo maestro DNP3)
Rango de valo‚Äê 1 ... 255
res:
Ajuste prede‚Äê 1
terminado:
Explicaci√≥n:
N√∫mero de impulsos que el punto de datos transfiere al correspondiente pun‚Äê
to de datos de la estaci√≥n.
Nombre:
N√∫mero de impulsos m√°x.
Rango de valo‚Äê ‚óè DNP3: 0 ... 255
res:
‚óè ST7 e IEC: asignaci√≥n fija "1"
Ajuste prede‚Äê 1
terminado:
Explicaci√≥n:
Vigila el n√∫mero de impulsos enviado por el maestro (Count). Si el n√∫mero de
impulsos recibido por el maestro supera el valor configurado aqu√≠, el coman‚Äê
do se rechaza.
Con el valor 0 (cero) se desactiva la vigilancia.
Nombre:

Duraci√≥n m√°x. de impulso (s)
(solo DNP3)
Rango de valo‚Äê 0 ... 65535
res:
Ajuste prede‚Äê 0
terminado:
Explicaci√≥n:
Vigila la duraci√≥n de impulso (On-time) transferida en el telegrama de co‚Äê
mando por el maestro.
Si la duraci√≥n del impulso recibido por el maestro supera el valor configurado
aqu√≠ y no se ha configurado ning√∫n "Duraci√≥n de impulso tiempo de sustitu‚Äê
ci√≥n", el comando del maestro se rechaza.
Con 0 (cero), el valor no se vigila (duraci√≥n de impulso ilimitada).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1991

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nombre:

Duraci√≥n de impulso tiempo de sustituci√≥n (s)
(solo DNP3)
Rango de valo‚Äê 0 ... 65535
res:
Ajuste prede‚Äê 0
terminado:
Explicaci√≥n:
Valor de sustituci√≥n para la duraci√≥n de impulso
El valor de sustituci√≥n se utiliza si la duraci√≥n de impulso recibida por el
maestro supera el valor configurado en "Duraci√≥n m√°x. de impulso".
El par√°metro solo se aplica si "Duraci√≥n m√°x. de impulso" es > 0.
Si el valor es 0 (cero) no se aplica ning√∫n valor de sustituci√≥n.
Nombre:

Duraci√≥n de impulso corta (s)
(solo IEC)
Rango de valo‚Äê 0 ... 65535
res:
Ajuste prede‚Äê 0
terminado:
Explicaci√≥n:
El m√≥dulo de comunicaci√≥n emite comandos del maestro con Qualifier of
command (QOC) = <1> (short pulse duration) durante el tiempo configurado
aqu√≠.
Con 0 (cero) el m√≥dulo descarta comandos con QOC = <1>.
Nombre:

Duraci√≥n de impulso larga (s)
(solo IEC)
Rango de valo‚Äê 0 ... 65535
res:
Ajuste prede‚Äê 0
terminado:
Explicaci√≥n:
El m√≥dulo de comunicaci√≥n emite comandos del maestro con Qualifier of
command (QOC) = <2> (long pulse duration) durante el tiempo configurado
aqu√≠.
Con 0 (cero) el m√≥dulo descarta comandos con QOC = <2>.
Nombre:

Tiempo de emisi√≥n para salida de comando (s)
(solo ST7)
Rango de valo‚Äê 0 ... 65535
res:

1992

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Ajuste prede‚Äê
terminado:
Explicaci√≥n:

0
Tiempo que dura la salida del comando. La duraci√≥n rige para los 8 canales
del objeto SINAUT.
Una vez transcurrido ese tiempo, la salida se desactiva autom√°ticamente.
Con cero la salida de comando activada no se desactiva autom√°ticamente.
En ese caso hay que desactivar la salida desde el programa de usuario.

Nombre:

Modo de comando
(solo DNP3 e IEC)
Rango de valo‚Äê ‚óè Ejecuci√≥n directa
res:
‚óè Selecci√≥n y ejecuci√≥n
Ajuste prede‚Äê Ejecuci√≥n directa
terminado:
Explicaci√≥n:
‚óè Ejecuci√≥n directa
El comando se transfiere inmediatamente a la CPU de la estaci√≥n para su
ejecuci√≥n.
‚óè Selecci√≥n y ejecuci√≥n
Secuencia:
‚Äì Activaci√≥n del comando en el m√≥dulo maestro
La central transfiere el telegrama "Selecci√≥n" al m√≥dulo de
comunicaci√≥n de la estaci√≥n.
‚Äì La estaci√≥n acusa la recepci√≥n.
‚Äì Tras recibir el acuse de la estaci√≥n, el punto de datos maestro env√≠a el
telegrama de ejecuci√≥n.
‚Äì La estaci√≥n solo reenv√≠a el comando a la CPU si dentro del "Tiempo
m√°x. entre Select y Operate" configurado recibe el telegrama
"Ejecuci√≥n" del maestro.
La estaci√≥n no debe recibir ning√∫n otro telegrama de datos entre
Selecci√≥n y ejecuci√≥n.
Nota: "Tiempo m√°x. entre Select y Operate" se configura en los ajustes de
transferencia de la interfaz correspondiente.
Referencia a las especificaciones:
‚Äì DNP3
"Select and Operate" se realiza a trav√©s de los c√≥digos de funci√≥n 03
y 04.
"Direct Operate" se realiza a trav√©s de los c√≥digos de funci√≥n 05 y 06.
‚Äì IEC (Select and Execute)
El m√≥dulo de comunicaci√≥n acusa la recepci√≥n de la ASDU de
selecci√≥n con el Qualifier "S/E (Type 6) <1> select".
Tras recibir el acuse, el maestro env√≠a el ASDU de ejecuci√≥n con el
Qualifier "S/E (Type 6) <1> execute".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1993

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Editor de mensajes
Estado de procesamiento de mensajes (correos electr√≥nicos / SMS)
Activar identificaci√≥n de estado / Estado externo
Si la opci√≥n est√° activada el CP escribe un estado de procesamiento sobre el correo
electr√≥nico / SMS enviado en una variable PLC.
Los estados filtrados tienen el siguiente significado:
Tabla 1-149 SMS: significado de la identificaci√≥n de estado en formato hexadecimal
Estado

Significado

0000

Transferencia concluida sin fallos

0001

Error en la transferencia; causas posibles:
‚óè Tarjeta SIM no v√°lida
‚óè No hay red
‚óè N√∫mero de tel√©fono de destino err√≥neo (n√∫mero no disponible)

Tabla 1-150 Correos electr√≥nicos: significado del estado de procesamiento emitido en formato
hexadecimal
Estado

Significado

0000

Transferencia concluida sin fallos

82xx

Otro mensaje de error del servidor de correo electr√≥nico
Excepto el "8" de la izquierda, el estado se corresponde con el n√∫mero de error de tres cifras
del protocolo SMTP.

8401

Ning√∫n canal disponible
Posible causa: ya existe una conexi√≥n de correo electr√≥nico a trav√©s del CP. No es posible
crear una segunda conexi√≥n en paralelo.

1994

8403

No se ha podido establecer ninguna conexi√≥n TCP/IP con el servidor SMTP.

8405

El servidor SMTP ha rechazado la solicitud de inicio de sesi√≥n.

8406

El cliente SMTP ha detectado un error SSL interno o un problema con la estructura del
certificado.

8407

La solicitud para utilizar SSL se ha rechazado.

8408

El cliente no ha podido determinar ning√∫n socket para establecer una conexi√≥n TCP/IP con
el servidor de correo.

8409

No es posible escribir a trav√©s de la conexi√≥n. Posible causa: el interlocutor de la comuni‚Äê
caci√≥n ha realizado un reset de la conexi√≥n o bien esta se ha interrumpido.

8410

No es posible leer a trav√©s de la conexi√≥n. Posible causa: el interlocutor de la comunicaci√≥n
ha cancelado la conexi√≥n o la conexi√≥n se ha interrumpido.

8411

Error al enviar el correo electr√≥nico. Causa: no hab√≠a suficiente memoria para llevar a cabo
el proceso de transmisi√≥n.

8412

El servidor DNS configurado no ha podido descifrar el nombre de dominio indicado.

8413

Debido a un error interno en el subsistema DNS no ha sido posible descifrar el nombre de
dominio.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Estado

Significado

8414

Se ha indicado una cadena de caracteres vac√≠a como nombre de dominio.

8415

Se ha producido un error interno en el m√≥dulo Curl. Se ha cancelado la ejecuci√≥n.

8416

Se ha producido un error interno en el m√≥dulo SMTP. Se ha cancelado la ejecuci√≥n.

8417

Solicitud para SMTP en un canal ya utilizado o ID de canal no v√°lido. Se ha cancelado la
ejecuci√≥n.

8418

Se ha cancelado la transmisi√≥n del correo electr√≥nico. Posible causa: rebase por exceso del
tiempo de ejecuci√≥n.

8419

El canal se ha interrumpido y no puede utilizarse hasta que se cancele la conexi√≥n.

8420

No ha sido posible verificar la cadena de certificados del servidor con el certificado ra√≠z del
CP.

8421

Se ha producido un error interno. Se ha detenido la ejecuci√≥n.

8450

Acci√≥n no ejecutada: bandeja de entrada no disponible / no accesible. Vu√©lvalo a intentar
m√°s adelante.

84xx

Otro mensaje de error del servidor de correo electr√≥nico
Excepto el "8" de la izquierda, el estado se corresponde con el n√∫mero de error de tres cifras
del protocolo SMTP.

8500

Error de sintaxis: comando desconocido.
Esto incluye el error de una cadena de comandos demasiado larga. La causa puede ser que
el servidor de correo electr√≥nico no soporte el m√©todo de autenticaci√≥n LOGIN.
Intente enviar correos electr√≥nicos sin autenticaci√≥n (sin nombre de usuario).

8501

Error de sintaxis. Compruebe los siguientes datos de configuraci√≥n:
Configuraci√≥n del mensaje > Par√°metros del mensaje:
‚óè Direcci√≥n del destinatario ("Para" y "Cc").

8502

Error de sintaxis. Compruebe los siguientes datos de configuraci√≥n:
Configuraci√≥n del mensaje > Par√°metros del mensaje:
‚óè Direcci√≥n de correo electr√≥nico (remitente)

8535

Autenticaci√≥n SMTP incompleta. Compruebe los par√°metros "Nombre de usuario" y "Con‚Äê
trase√±a" en la configuraci√≥n del CP.

8550

No es posible acceder al servidor SMTP. No tiene derechos de acceso. Compruebe los
siguientes datos de configuraci√≥n:
‚óè Configuraci√≥n del CP > Configuraci√≥n de correo electr√≥nico:
‚Äì

Nombre de usuario

‚Äì

Contrase√±a

‚Äì

Direcci√≥n de correo electr√≥nico (remitente)

‚óè Configuraci√≥n del mensaje > Par√°metros del mensaje:
‚Äì

Direcci√≥n del destinatario ("Para" y "Cc").

8554

Transferencia fallida

85xx

Otro mensaje de error del servidor de correo electr√≥nico
Excepto el "8" de la izquierda, el estado se corresponde con el n√∫mero de error de tres cifras
del protocolo SMTP.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1995

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros espec√≠ficos del protocolo
TeleControl Basic
Identificaci√≥n del CP
Referencia
CPs con uso del protocolo TeleControl "TeleControl Basic".
Grupo de par√°metros "Identificaci√≥n del CP"

Un n√∫mero de proyecto para todo el proyecto STEP 7
Si en un CP cambia el n√∫mero de proyecto en el grupo de par√°metros "Identificaci√≥n del CP",
el par√°metro cambiar√° en todo el proyecto STEP 7 en todos los CPs con uso del protocolo
"TeleControl Basic".
TCSB eval√∫a los n√∫meros de proyecto comprendidos entre 1 y 2000.

Configuraci√≥n del n√∫mero de estaci√≥n
Para cada estaci√≥n del proyecto STEP 7 que utiliza un CP con uso del protocolo "TeleControl
Basic" hay que configurar un n√∫mero de estaci√≥n un√≠voco.
TCSB eval√∫a los n√∫meros de estaci√≥n comprendidos entre 1 y 8000.

ID de acceso
El "ID de acceso" mostrado en el grupo de par√°metros Identificaci√≥n del CP se genera a partir
de los valores hexadecimales de n√∫mero de proyecto, n√∫mero de estaci√≥n y slot. El par√°metro
del tipo DWORD tiene la asignaci√≥n siguiente:
‚óè Bits 0 - 7: Slot
‚óè Bits 8 - 20: N√∫mero de estaci√≥n
‚óè Bits 21 - 31: N√∫mero de proyecto

Datos de direcci√≥n y autenticaci√≥n
Direcci√≥n IP del CP
Como generalmente el CP se conecta con el TCSB, se puede asignar una direcci√≥n IP
din√°mica para el CP a trav√©s del operador de servicios de Internet.

1996

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Datos de direcci√≥n y autenticaci√≥n para la comunicaci√≥n con el TCSB
La siguiente informaci√≥n es necesaria a la hora de configurar el CP con STEP 7 para la
comunicaci√≥n con el TCSB:
‚óè Par√°metros del grupo de par√°metros "Estaciones interlocutoras"
‚Äì Direcci√≥n IP del interlocutor
Direcci√≥n IP o nombre de host del router DSL a trav√©s del cual se conecta a Internet el
servidor de Telecontrol.
Se recomienda una direcci√≥n IP fija.
‚Äì Puerto interlocutor (n√∫mero del puerto Listener del TCSB)
‚óè Par√°metros del grupo de par√°metros "Security > Identificaci√≥n CP"
‚Äì N√∫mero de proyecto
‚Äì N√∫mero de estaci√≥n
‚Äì Contrase√±a (para la autenticaci√≥n)

Acuse
Acuse en TeleControl Basic
La recepci√≥n de un telegrama enviado se acusa del siguiente modo.
‚óè Comunicaci√≥n por Telecontrol
Los telegramas recibidos por TCSB son acusados de inmediato por el CP.
Los telegramas enviados por el CP son acusados por TCSB.
‚óè Comunicaci√≥n cruzada
Los telegramas recibidos son acusados de inmediato por el CP. El telegrama de acuse se
reenv√≠a a trav√©s del servidor de Telecontrol al CP destinatario.
Para telegramas enviados el procedimiento es an√°logo en sentido inverso.

SINAUT ST7
El software TD7
Tareas del software TD7
El software "SINAUT TD7" se encarga de la comunicaci√≥n y la transferencia de datos de
proceso en m√≥dulos de comunicaci√≥n que utilizan el protocolo de acci√≥n remota SINAUT ST7.
La comunicaci√≥n de datos mediante conexiones WAN entre CP aptos para ST7 y m√≥dulos TIM
solo puede llevarse a cabo utilizando el software TD7.
TD7 gestiona la transmisi√≥n de datos de proceso controlada por modificaciones entre la
estaci√≥n y el puesto de control (p. ej. ST7cc), entre las diferentes estaciones y entre el m√≥dulo
de comunicaci√≥n y la CPU. Si se producen fallos en conexiones, en las CPU o en el puesto de
control, se se√±alizan. Una vez subsanado el fallo y durante el arranque de la CPU o el puesto
de control, se actualizan autom√°ticamente los datos.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1997

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Variantes del software TD7
El software TD7 est√° disponible en dos variantes. En los m√≥dulos de comunicaci√≥n que
soportan ambas variantes de TD7 solo puede utilizarse una de ellas.
‚óè TD7onTIM
TD7onTIM se configura a trav√©s de los puntos de datos del m√≥dulo. En modo productivo se
ejecuta en el m√≥dulo de comunicaci√≥n.
Las funciones y los par√°metros se describen en los cap√≠tulos relativos a la configuraci√≥n de
los puntos de datos.
Esta variante puede usarse en todos los m√≥dulos que soportan ST7.
Esta variante presenta las siguientes ventajas:
‚Äì Posibilidades de configuraci√≥n sencillas
‚Äì El software TD7 es independiente del programa de la CPU
‚Äì Los bloques pueden ejecutarse en una CPU S7-1500 con firmware V2.5 o superior.
En S7-1500 se soporta TD7onTIM de la CPU con firmware V2.1 o superior.
‚óè TD7onCPU
TD7onCPU est√° realizada como librer√≠a de bloques de programa. Los bloques se utilizan
y parametrizan en la CPU que est√° conectada en red con el TIM. El software se ejecuta en
modo productivo en la CPU.
TD7onCPU puede utilizarse en los m√≥dulos siguientes:
‚Äì TIM 1531 IRC
‚Äì TIM 3V‚ÄëIE Advanced
‚Äì TIM 4R‚ÄëIE / TIM 4R‚ÄëIE Standalone
Esta variante presenta las siguientes ventajas:
‚Äì Mayor velocidad en caso de modificaci√≥n de datos
Los cambios se registran con cada ciclo de la CPU.
‚Äì Mayor selecci√≥n de typicals de datos para la central y la estaci√≥n

Las librer√≠as de TD7onCPU
TD7onCPU est√° disponible en dos librer√≠as de bloques para las siguientes familias SIMATIC:
‚óè S7-1500
Los bloques pueden ejecutarse en una CPU S7-1500 con firmware V2.5 o superior.
‚óè S7-300 / 400
Los bloques pueden ejecutarse en un S7-300 y en una CPU S7-400. Las excepciones se
indican expl√≠citamente.
Excepto para la transmisi√≥n de datos de proceso v√≠a WAN, el paquete sirve tambi√©n para
la comunicaci√≥n local entre CPUs, siempre que estas est√©n conectadas entre s√≠ por medio
de MPI. Tambi√©n en este caso se vigilan continuamente las conexiones locales y las CPU
y se realiza una actualizaci√≥n autom√°tica tras el arranque o tras solucionar fallos.
Encontrar√° la descripci√≥n de TD7onCPU en el cap√≠tulo AUTOHOTSPOT.

1998

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Comunicaci√≥n entre objetos SINAUT
Comunicaci√≥n entre objetos o typicals
‚óè Objeto / typical
El t√©rmino "objeto" designa en SINAUT ST7 el tipo de representaci√≥n y el tratamiento de
magnitudes del proceso, como avisos, valores anal√≥gicos, comandos, motores, v√°lvulas,
reguladores, etc. El software TD7 procesa b√°sicamente "objetos".
Los objetos en el entorno de TD7 est√°n formados por normas de procesamiento en forma
de bloques de programa y se denominan "typicals".
Un objeto tiene los componentes siguientes:
‚Äì un bloque de funci√≥n (FB)
‚Äì un bloque de datos (DB)
El DB es el juego de datos del objeto que est√° asignado al FB como DB de instancia.
Un objeto o typical se compone siempre de una parte para el proceso y otra para manejo y
visualizaci√≥n (parte de operador), que trabajan en diferentes dispositivos de la red SINAUT.
Para poder procesar su funci√≥n predeterminada es necesario que ambas partes se
comuniquen.
Las dos partes se utilizan en los siguientes tipos de dispositivos y se encargan de las tareas
siguientes:
‚óè Typicals de operador
Uso en estaciones centrales (lado de operador)
Estos bloques env√≠an consignas, par√°metros, comandos e instrucciones organizativas a
los typicals de proceso.
‚óè Typicals de proceso
Uso en estaciones (lado del proceso)
Estos bloques procesas valores de proceso y devuelven a los typicals de operador datos de
proceso, alarmas, avisos de estado e informaci√≥n organizativa.
Los datos que describen al objeto se intercambian entre los dos interlocutores de la
comunicaci√≥n. Los datos est√°n en los √≠ndices de datos 0...n dentro del juego de datos del
objeto. El volumen y la composici√≥n de esta √°rea de datos dependen del Typical
correspondiente. Puede estar formada por varios tipos de datos id√©nticos o por una
combinaci√≥n de tipos de datos diferentes. En el registro de objeto de la parte de proceso y
operador, la estructura de datos de dos Typicals relacionados es id√©ntica.
El intercambio de datos no debe funcionar obligatoriamente en ambos sentidos.

Direccionamiento de objetos
‚óè N√∫mero de dispositivo
Cada CPU con software TD7 obtiene un n√∫mero de dispositivo SINAUT un√≠voco en la red
que puede estar comprendido en el rango de 1 a 32000.
‚óè N√∫mero de objeto
Cada typical que se llama en una de estas CPU tiene un DB de instancia cuyo n√∫mero es
id√©ntico al n√∫mero de objeto SINAUT.
Con el n√∫mero de dispositivo SINAUT y el n√∫mero de objeto SINAUT se lleva a cabo un
direccionamiento un√≠voco para la comunicaci√≥n entre los typicals relacionados.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

1999

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Todos los typicals de puntos de datos son bloques de funci√≥n (FB). Cuando se llama un FB
debe indicarse un DB de instancia. El n√∫mero de este DB de instancia es id√©ntico al n√∫mero
del objeto de punto de datos. El n√∫mero de objeto no tiene que ser id√©ntico en el lado emisor
y receptor.
Para determinar la relaci√≥n de comunicaci√≥n, cada typical tiene los par√°metros siguientes:
‚óè N√∫mero de interlocutor
"PartnerNo"
N√∫mero de dispositivo del interlocutor con el que se comunica.
‚óè N√∫mero de objeto interlocutor
"PartnerObcetcNo"
N√∫mero de objeto (= n.¬∫ de DB de instancia) en dicho interlocutor.
‚óè √çndice
Para el almacenamiento se considera tambi√©n el n√∫mero de √≠ndice incluido en el telegrama
de datos.

Tipos de telegrama
Adem√°s de los datos de proceso y operador, entre ambas partes tambi√©n se intercambia
informaci√≥n organizativa (telegramas organizativos). Se distingue entre los siguientes tipos de
telegrama (TA):
‚óè TA 0: telegramas organizativos espont√°neos
‚óè TA 1: telegramas organizativos consultados
‚óè TA 2: telegramas de datos espont√°neos
‚óè TA 3: telegramas de datos consultados
El flujo de datos de los telegramas organizativos y las √°reas de datos previstas para tal fin en
el juego de datos de objeto (√≠ndices organizativos) no se representan en la figura superior.

2000

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Par√°metros de direcci√≥n en el protocolo "ST7"
Direccionamiento de interlocutores y nodos de red
La comunicaci√≥n en el protocolo "SINAUT ST7" puede ejecutarse utilizando diferentes
trayectos y subredes. Para el direccionamiento de los distingos dispositivos en la red ST7
sirven los dos par√°metros siguientes:
‚óè N√∫mero de dispositivo
En un proyecto STEP 7 el n√∫mero de dispositivo es un√≠voco para cada dispositivo. Los
siguientes dispositivos precisan de un n√∫mero de dispositivo:
‚Äì M√≥dulo de comunicaciones
M√≥dulos (TIM, CP) compatibles con ST7
‚Äì CPU
La CPU local que est√° asignada al m√≥dulo de comunicaci√≥n recibe un n√∫mero de
dispositivo como punto final de una conexi√≥n de Telecontrol a trav√©s del protocolo ST7.
Con un CP y un TIM 3V‚ÄëIE / TIM 4R‚ÄëIE, la CPU local se asigna autom√°ticamente a trav√©s
del rack.
Al TIM 1531 IRC se le asigna la CPU en el grupo de par√°metros "N√∫meros de
dispositivo".
‚Äì Aplicaci√≥n del PC central
La aplicaci√≥n que se configura en la estaci√≥n PC de la central.
Para el TIM y la CPU asignada, el n√∫mero de dispositivo se configura en el grupo de
par√°metros "N√∫meros de dispositivos" del TIM.
Para la aplicaci√≥n del PC central, el n√∫mero de dispositivo se configura en la conexi√≥n de
Telecontrol: editor "Datos de red" > ficha "Telecontrol"
‚óè Direcci√≥n WAN
Para cada interfaz serie conectada en red de una red ST7 cl√°sica se asigna una direcci√≥n
WAN. Es un√≠voco en cada red WAN.
Como las conexiones de Telecontrol pueden realizarse a trav√©s de varios nodos de red y
varias estaciones nodo, es necesario direccionar un√≠vocamente las interfaces involucradas
en toda la red.
La direcci√≥n WAN se configura en el grupo de par√°metros "Par√°metros WAN" de la interfaz
serie.

Direccionamiento de los datos
Los datos de proceso que debe transmitirse se configuran como puntos de datos; consulte el
cap√≠tulo Puntos de datos ST7 (P√°gina 1966).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2001

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Acuse
Acuse en ST7
‚óè Comunicaci√≥n con la central
‚Äì Los telegramas de datos enviados por la central son acusados de inmediato por el CP
a su recepci√≥n.
‚Äì Los telegramas de datos enviados por el m√≥dulo de comunicaci√≥n son acusados por la
central.
‚óè Comunicaci√≥n cruzada entre estaciones
Los telegramas de datos se acusan del mismo modo que en la comunicaci√≥n entre estaci√≥n
y central.
En la comunicaci√≥n cruzada, los telegramas de acuse del m√≥dulo receptor no son
reenviados por la central al m√≥dulo de comunicaci√≥n transmisor.

Ampliaci√≥n de proyectos SINAUT
Ampliaci√≥n de proyectos SINAUT existentes
Los proyectos SINAUT con m√≥dulos TIM de las familias SIMATIC S7-300 y 400 configurados
en STEP 7 V5 pueden ampliarse con m√≥dulos m√°s recientes configurados en STEP 7
Professional.
Para ello, en los proyectos STEP 7 V5 se configuran m√≥dulos TIM como comodines (proxies)
de m√≥dulos que se configuran en STEP 7 Professional. Los datos de configuraci√≥n (SDB) se
exportan de STEP 7 V5 y se importan a STEP 7 Professional.
El requisito para poder importar datos de configuraci√≥n de STEP 7 V5 es que se haya
seleccionado el m√©todo de configuraci√≥n "Importar" en el grupo de par√°metros "Ajustes
b√°sicos", consulte el cap√≠tulo Configuraci√≥n (P√°gina 1890).
La ampliaci√≥n de proyectos SINAUT se soporta en los siguientes m√≥dulos:
Tabla 1-151 Migraci√≥n de m√≥dulos de STEP 7 V5 a STEP 7 Basic / Professional (TIA Portal)

2002

Funci√≥n del m√≥dulo para la ampliaci√≥n del
proyecto STEP 7 V5

M√≥dulo S7-1200/1500 en STEP 7 Basic / Pro‚Äê
fessional

TIM (funci√≥n) para la
ampliaci√≥n

Proxy del cat√°logo
que se utilizar√°

M√≥dulo compatible

Versi√≥n de STEP 7
necesaria

TIM 3V‚ÄëIE Advanced

PROXY
CP1243‚Äë8 IRC

‚áí

CP 1243‚Äë8 IRC

STEP 7 Basic

TIM 3V‚ÄëIE Advanced

PROXY
CP1243‚Äë8 IRC

‚áí

CP 1542SP‚Äë1 IRC

STEP 7 Professional

TIM 4R‚ÄëIE

PROXY
TIM 1531 IRC

‚áí

TIM 1531 IRC

STEP 7 Professional

TIM 4R‚ÄëIE Stand-alo‚Äê
ne

PROXY
TIM 1531 IRC

‚áí

TIM 1531 IRC

STEP 7 Professional

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Nota
TIM 4R‚ÄëIE Stand-alone para S7‚Äë400 se convierte en TIM 1531 IRC
Un TIM 4R‚ÄëIE Stand-alone necesario en STEP 7 V5 y asignado a una CPU-400 debe
sustituirse por un TIM 1531 IRC cuando se ampl√≠an proyectos SINAUT cl√°sicos en STEP 7
Professional.
Solo es posible crear un TIM 4R‚ÄëIE Stand-alone en proyectos nuevos que se configuran
exclusivamente en STEP 7 Professional.
Nota
No hay interfaz serie para CP 1542SP‚Äë1 IRC
Para un CP 1542SP‚Äë1 IRC no est√° permitido configurar una interfaz serie en STEP 7 V5, ya
que el CP no tiene interfaz serie.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2003

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Requisitos y actualizaci√≥n de m√≥dulos
Los requisitos para la importaci√≥n son:
‚óè Proyecto de STEP 7 V5
Un archivo de configuraci√≥n de un proyecto STEP 7 V5 coherente
‚óè Versi√≥n de firmware
Para el m√≥dulo de comunicaci√≥n se requiere una de las siguientes versiones de firmware:
‚Äì TIM 1531 IC: V2.0
‚Äì TIM 1531 IC: V1.1
Un TIM V1.1 puede sustituirse por un TIM V2.0, pero no a la inversa.
En STEP 7 el m√©todo de la "Configuraci√≥n de Telecontrol" se ajusta a "Configurar". Se
aplican los datos de configuraci√≥n existentes.
‚Äì CP 1542SP‚Äë1 IRC: V2.0
Un CP V1.0 puede sustituirse por un CP V2.0, pero no a la inversa.
En STEP 7 el m√©todo de la "Configuraci√≥n de Telecontrol" se ajusta a "Configurar". Se
aplican los datos de configuraci√≥n existentes.
‚Äì CP 1243‚Äë8 IRC: V3.1
Aplicaci√≥n de los datos de STEP 7 V5 con posibilidad de cambio (v√©ase m√°s abajo,
apartado "Datos de configuraci√≥n importados")
Un CP V3.0 puede sustituirse por un CP V3.1, pero no a la inversa.
‚Äì CP 1243‚Äë8 IRC: V2.1
Aplicaci√≥n de los datos de STEP 7 V5 sin posibilidad de cambio
Un CP V2.1 puede sustituirse por un CP V3.1, pero no a la inversa. El CP utilizado debe
tener la versi√≥n de hardware 2.
En STEP 7 el m√©todo de la "Configuraci√≥n de Telecontrol" se ajusta a "Importar". Se
aplican los datos de configuraci√≥n existentes.
Nota
Desactivaci√≥n de los datos de configuraci√≥n de interlocutores en la migraci√≥n de STEP 7
V13 SP1
Al migrar un CP 1243‚Äë8 IRC V2.1 de STEP 7 V13 SP1 a STEP 7 V15, los datos de
configuraci√≥n de interlocutores se desactivan. Al compilar el proyecto aparecer√° un
mensaje.
En ese caso, vuelva a importar los datos de configuraci√≥n de interlocutores al m√≥dulo.
‚Äì TIM 3V... / TIM 4R...: V2.5.5

2004

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Conexiones ST7
Para conexiones ST7 entre un TIM 1531 IRC y una CPU:
‚Äì El firmware de la CPU debe tener como m√≠nimo la versi√≥n V2.5.
‚Äì El TIM y la CPU deben estar conectados en red antes de la importaci√≥n a
STEP 7 Professional.
‚Äì Para la configuraci√≥n de TD7onCPU, la CPU no debe estar asignada al TIM en
STEP 7 Professional.
Para conexiones ST7 entre un TIM 1531 IRC y una aplicaci√≥n de PC:
‚Äì El TIM y la estaci√≥n PC deben estar conectados en red antes de la importaci√≥n a
STEP 7 Professional.
‚óè CPU 1500 / estaci√≥n PC
Para una CPU 1500 o una estaci√≥n PC con aplicaci√≥n SINAUT como interlocutor ST7 la
direcci√≥n IP del proyecto STEP 7 V15 debe coincidir con la direcci√≥n configurada en
STEP 7 V5.

Configuraci√≥n en STEP 7 V5
Encontrar√° la descripci√≥n de la configuraci√≥n en los manuales de los m√≥dulos en cuesti√≥n.

DNP3
Direccionamiento
La configuraci√≥n y la puesta en marcha del m√≥dulo de comunicaci√≥n requieren la siguiente
informaci√≥n:

Informaci√≥n de direcci√≥n del m√≥dulo de comunicaci√≥n
Para el direccionamiento deben configurarse los par√°metros siguientes en el m√≥dulo:
‚óè Direcci√≥n de estaci√≥n (direcci√≥n DNP en la capa de enlace)
‚óè Direcci√≥n, seg√∫n el tipo de red:
‚Äì Direcci√≥n IP y m√°scara de subred; alternativa: direcci√≥n IP de un servidor DHCP
‚Äì N√∫mero de tel√©fono (para red de marcaci√≥n)
‚Äì Direcci√≥n WAN (para l√≠nea dedicada)
‚óè N√∫mero del puerto Listener propio de la estaci√≥n (para consulta de conexi√≥n por parte del
maestro)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2005

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n de direcci√≥n del maestro
La siguiente informaci√≥n del maestro es necesaria para la configuraci√≥n del m√≥dulo:
‚óè Direcci√≥n de estaci√≥n (direcci√≥n DNP del maestro en la capa de enlace)
‚óè Direcci√≥n del maestro, seg√∫n el tipo de red:
‚Äì Direcci√≥n IP / M√°scara de subred + N√∫mero de puerto del puerto Listener del maestro
o bien
Mediante nombre DNS descomponible
(se necesita la direcci√≥n del servidor DNS; el m√≥dulo debe poder acceder al servidor
DNS).
‚Äì N√∫mero de tel√©fono (para red de marcaci√≥n)
‚Äì Direcci√≥n WAN (para l√≠nea dedicada)

Maestros DNP3 redundantes
Ambos dispositivos de un maestro redundante tienen una direcci√≥n de estaci√≥n id√©ntica.
Solo se requieren direcciones IP o nombres de host diferentes.

Configuraciones con conexiones v√≠a Internet: conexiones VPN
En las conexiones por Internet es posible utilizar direcciones IP din√°micas.
Para permitir la comunicaci√≥n en ambos sentidos y, por consiguiente, transferir los datos de
forma protegida, se requiere una conexi√≥n con t√∫nel VPN. Para ello son adecuados los
m√≥dulos de seguridad de las series SCALANCE S o SCALANCE M.
Para realizar la configuraci√≥n tenga en cuenta los puntos siguientes:
‚óè La direcci√≥n IP del maestro se configura del modo habitual.
‚óè En la configuraci√≥n de la interfaz del m√≥dulo se configura la direcci√≥n IP del router.
‚óè La configuraci√≥n VPN con SCALANCE S/M se realiza en STEP 7 tanto para las estaciones
como para la central de control.

Establecimiento de la conexi√≥n
Establecimiento de la conexi√≥n en DNP3
En el protocolo DNP3 el maestro establece la conexi√≥n (modo de llamada /sondeo)
Si se interrumpe una conexi√≥n establecida desde el CP, un m√≥dulo maestro intenta establecer
de nuevo la conexi√≥n.
Nota
Interrupci√≥n de la conexi√≥n por parte del operador de la red de telefon√≠a m√≥vil
Cuando utilice servicios de telefon√≠a m√≥vil, recuerde que las conexiones existentes pueden ser
interrumpidas por los operadores de las redes de telefon√≠a m√≥vil con fines de mantenimiento.

2006

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Modo espont√°neo
Al activar el par√°metro "Se√±alizaci√≥n espont√°nea" del grupo de par√°metros "Transferencia
espont√°nea", en los "Ajustes de estaci√≥n DNP3" de una interfaz se habilita la transferencia
espont√°nea de datos de una estaci√≥n. En tal caso el m√≥dulo de comunicaci√≥n puede
establecer conexiones de red de marcaci√≥n como cliente, para enviar espont√°neamente datos
de eventos.

Establecimiento de la conexi√≥n con Open User Communication y comunicaci√≥n PG/OP
En la Open User Communication, la CPU es el interlocutor de la conexi√≥n en una estaci√≥n S7.
Las conexiones se establecen en cuanto se llaman los bloques de programa correspondientes
en la CPU.
Esto tambi√©n se aplica cuando otra estaci√≥n S7 env√≠a datos. En este caso, la estaci√≥n
receptora llama los bloques de recepci√≥n correspondientes.

Acuse en el protocolo DNP3
Acuse en DNP3
Los mecanismos de acuse b√°sicos se configuran para la capa de enlace, consulte el
cap√≠tulo Ajustes de transferencia - DNP3 (P√°gina 2008).
Un m√≥dulo de estaci√≥n acusa una solicitud del maestro con sus telegramas de respuesta.
El acuse de telegramas espont√°neos que un m√≥dulo de estaci√≥n env√≠a al maestro se configura
en el grupo de par√°metros "Ajustes de estaci√≥n DNP3", consulte el cap√≠tulo Ajustes de
estaci√≥n DNP3 (P√°gina 2011).

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2007

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Ajustes de transferencia - DNP3
Ajustes de transferencia - DNP3
‚óè Tiempo m√°x. entre Select y Operate
Tiempo m√°x. (segundos) entre la preselecci√≥n de comando (Select) y la entrada de
comando (Operate)
‚Äì Estaci√≥n central:
Si, tras una preselecci√≥n de comando, en la central no se realiza ninguna entrada de
comando durante el tiempo configurado, ser√° necesario volver a seleccionar el
comando. La obligaci√≥n de entrada doble evita el riesgo de que se produzca un manejo
involuntario en la central.
‚Äì Estaci√≥n:
Para que un comando recibido se transfiera a la CPU y, por tanto, sea efectivo, la
estaci√≥n no debe recibir ning√∫n otro telegrama de comando entre Selecci√≥n y ejecuci√≥n.
Rango de valores: 1..65535
Ajuste predeterminado: 1
Si un maestro env√≠a a la estaci√≥n un objeto con el c√≥digo de funci√≥n 7
"DIRECT_OPERATE", la estaci√≥n no eval√∫a el tiempo configurado aqu√≠.
‚óè Forma de transmisi√≥n
Define la forma de transmisi√≥n de eventos.
‚Äì Espec√≠fico de tipo
Es la transmisi√≥n agrupada de eventos por tipos de datos, t√≠pica de DNP3. Primero se
transmiten los eventos binarios existentes, despu√©s todos los valores anal√≥gicos y,
finalmente, todos los cambios de valores de contaje. Con ello, los telegramas se
compactan y la transmisi√≥n es m√°s eficiente.
‚Äì Cronol√≥gico
En este modo, los eventos se transmiten por orden cronol√≥gico estricto. No se produce
la agrupaci√≥n optimizada en bloques del mismo tipo de datos (v√©ase arriba), tal como se
prev√© en la especificaci√≥n DNP3. Este modo sirve ante todo para sistemas de control
que archivan los eventos en orden cronol√≥gico estricto.
Ajuste predeterminado: Espec√≠fico de tipo

2008

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Tiempo de vigilancia de conexi√≥n (capa de aplicaci√≥n)
(Application layer confirmation timeout)
Tiempo (segundos) durante el que el m√≥dulo espera de su interlocutor una se√±al de vida en
la capa de aplicaci√≥n.
‚Äì Maestro (estaci√≥n central):
Tiempo (segundos) durante el que el maestro espera una se√±al de vida de la estaci√≥n.
Si se rebasa el tiempo configurado, el maestro env√≠a un telegrama a la estaci√≥n. Si la
estaci√≥n no acusa ese telegrama, el maestro considera que la estaci√≥n no est√°
accesible, deshace la conexi√≥n y a continuaci√≥n la establece de nuevo.
Comandos:
Si se interrumpe o falla una conexi√≥n con una estaci√≥n, los telegramas de comando se
repiten tres veces como m√°ximo antes de ser rechazados por el maestro.
‚Äì Estaci√≥n:
En la estaci√≥n el par√°metro se emplea para calcular los tiempos de espera durante el
establecimiento de la conexi√≥n.
En v√≠as redundantes rige lo siguiente: si falta el acuse se considera que hay un fallo en el
recorrido de transferencia.
Rango de valores: 0 ... 65535 s
Ajuste predeterminado: 5
Con el valor 0 (cero) la funci√≥n est√° desactivada.
‚óè Tiempo de vigilancia del interlocutor
Si el m√≥dulo de la estaci√≥n no recibe ninguna se√±al de vida del maestro a nivel de aplicaci√≥n
dentro del tiempo configurado, clasifica la conexi√≥n como fallida y deshace la conexi√≥n.
Tras el env√≠o de datos, el m√≥dulo maestro espera durante el tiempo configurado una
respuesta de la estaci√≥n.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 0
Con el valor 0 (cero) la funci√≥n est√° desactivada.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2009

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Capa de enlace
‚óè Repetici√≥n de telegrama
N√∫mero m√°ximo de intentos repetidos de enviar un telegrama cuando en la capa de enlace
no se recibe ning√∫n acuse del interlocutor.
‚Äì En las conexiones serie es aconsejable utilizar repeticiones en caso de que la calidad de
la conexi√≥n no sea buena.
‚Äì En las conexiones Ethernet se recomienda configurar el valor 0, pues las repeticiones
necesarias se llevan a cabo mediante la implementaci√≥n de protocolos.
Rango de valores: 0 ... 255
Ajuste predeterminado: 0
Con el valor 0 (cero) la funci√≥n est√° desactivada.
‚óè Acuse
Condici√≥n en la cual el m√≥dulo solicita una confirmaci√≥n de recepci√≥n (acuse) del
interlocutor (env√≠o del c√≥digo de funci√≥n "CONFIRMED_USER_DATA"):
‚Äì Nunca:
No se solicitan acuses.
‚Äì Siempre
Siempre se solicitan acuses.
‚Äì Con segmentaci√≥n
Solo se solicitan acuses en telegramas de datos que se dividen en varios segmentos
debido a su longitud.
En las conexiones Ethernet, la especificaci√≥n DNP3 recomienda no utilizar solicitudes de
acuse en la capa de enlace.
En caso de conexiones susceptibles de sufrir fallos, p. ej. l√≠neas inal√°mbricas, es
aconsejable configurar solicitudes de acuse en la capa de enlace.
‚óè Tiempo de vigilancia de acuse
Tiempo (segundos) durante el que se espera del interlocutor una confirmaci√≥n (acuse) en
la capa de enlace. Si en el tiempo configurado no se recibe ning√∫n acuse, se repite la
transferencia de los datos, consulte el par√°metro "Repetici√≥n de telegrama" m√°s arriba.
Rango de valores: 0...65535
Ajuste predeterminado: 2
Por regla general, el valor predeterminado de 2 segundos debe aumentarse en caso de
conexiones serie lentas.
Con el valor 0 (cero) la funci√≥n est√° desactivada.

Ajustes de la funci√≥n de maestro DNP3
Par√°metros DNP3 espec√≠ficos del maestro
Las par√°metros siguientes solo son v√°lidos para las siguientes interfaces de m√≥dulos de
comunicaci√≥n:
‚óè Interfaces cuyo par√°metro "Tipo de nodo de red" est√° configurado como "Estaci√≥n central".
‚óè Interfaces de estaciones que utilizan la funci√≥n de maestro para la "comunicaci√≥n directa"
con otras estaciones.

2010

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los siguientes par√°metros se encuentran en el grupo de par√°metros "Ajustes de la funci√≥n de
maestro DNP3":
‚óè Intervalo b√°sico de sondeo
Aqu√≠ se define el valor b√°sico para llamadas de estaci√≥n desde la central.
Rango de valores: 0 ... 65535 segundos
Ajuste predeterminado: 30
Con el valor 0 (cero) la funci√≥n est√° desactivada. No se produce un sondeo c√≠clico, ni tan
solo para los par√°metros indicados a continuaci√≥n, cuyo valor se calcula como m√∫ltiplo del
Intervalo b√°sico de sondeo.
Base para otros par√°metros
El Intervalo b√°sico de sondeo se utiliza como base de c√°lculo para los par√°metros
siguientes:
‚Äì Intervalo de sondeo de eventos
‚Äì Intervalo de sondeo de clase 0
El valor configurado en estos par√°metros es el factor para el intervalo b√°sico de sondeo.
Los par√°metros se configuran en el editor de conexiones "Datos de red > Telecontrol >
DNP3"; consulte Tabla de conexiones - DNP3 (P√°gina 1937).
‚óè N√∫mero m√°x. de eventos por llamada
N√∫mero m√°ximo de eventos que pueden enviarse en el telegrama de respuesta de la
estaci√≥n tras una llamada por parte de la central.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 0
Con 0 (cero) la funci√≥n est√° desactivada (no hay l√≠mite).

Ajustes de estaci√≥n DNP3
Par√°metros DNP3 de la estaci√≥n / estaci√≥n nodo
Los siguientes par√°metros se encuentran en el grupo de par√°metros "Ajustes de estaci√≥n
DNP3" de las interfaces ajustadas en el tipo de nodo de red "estaci√≥n" o "estaci√≥n nodo" del
m√≥dulo de comunicaci√≥n.
Par√°metros de vigilancia
‚óè Bit de fallo
La estaci√≥n puede utilizar el Internal Indication Byte (IIN1.6) del Application Response
Header para se√±alizar al maestro un fallo de la CPU.
Con la opci√≥n activada, el bit se pone a "1" si la CPU se encuentra en estado STOP.
‚óè Comprobaci√≥n de direcci√≥n IP
El par√°metro contribuye a la seguridad al establecer una conexi√≥n entre la estaci√≥n y el
maestro.
‚Äì Comprobar la direcci√≥n IP
Con la opci√≥n activada, en una consulta de la conexi√≥n, adem√°s de comprobar la
direcci√≥n de estaci√≥n del interlocutor, la estaci√≥n comprueba su direcci√≥n IP.
Si la direcci√≥n IP del interlocutor no coincide con la direcci√≥n de un interlocutor
configurado de la estaci√≥n, la estaci√≥n rechaza la conexi√≥n.
‚Äì No comprobar la direcci√≥n IP
La estaci√≥n no comprueba las direcciones IP al consultar las conexiones TCP entrantes.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2011

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Propiedades de evento
‚óè Clase de evento para memoria imagen
Selecci√≥n de una clase de evento para la que solo se guardan en el b√∫fer de transmisi√≥n
los √∫ltimos valores actuales en cada caso. Los eventos m√°s antiguos se sobrescriben en el
b√∫fer de transmisi√≥n (m√©todo de la memoria imagen)
El par√°metro no est√° disponible con el TIM 3V‚ÄëIE DNP3 / TIM 4R‚ÄëIE DNP3. Estos m√≥dulos
trabajan seg√∫n el ajuste "Est√°ndar".
‚Äì Eventosdeclase x
De los eventos de la clase seleccionada solo se guardan en el b√∫fer de transmisi√≥n los
valores actuales en cada caso (m√©todo de la memoria imagen).
‚Äì Est√°ndar
Todos los valores de eventos de las clases 1 y 2 se guardan en el b√∫fer de transmisi√≥n.
Solo para los eventos de la clase 3 se guarda en el b√∫fer de transmisi√≥n el valor actual
en cada caso (m√©todo de la memoria imagen).
Encontrar√° detalles sobre la funci√≥n de la memoria imagen y del b√∫fer de transmisi√≥n, as√≠
como sobre las posibilidades de transferencia, en el cap√≠tulo Memoria imagen de proceso,
tipo de transferencia, clases de eventos (P√°gina 1963).
‚óè B√∫fer para clase de evento 1 / 2 / 3
Aqu√≠ se especifica, para cada una de las tres clases de eventos, a partir de qu√© n√∫mero de
evento se env√≠an los eventos guardados al interlocutor de la comunicaci√≥n.
Tenga en cuenta que el tama√±o m√°ximo del b√∫fer de transmisi√≥n se reparte entre todas las
centrales DNP3 conectadas.
Rango admisible: 1 ... 255
‚óè Tiempo de retardo para clase de evento 1 / 2 / 3
Aqu√≠ se especifica en segundos, para cada una de las tres clases de eventos, durante
cu√°nto tiempo deben guardarse los eventos como m√°ximo en el b√∫fer de transmisi√≥n antes
de enviarlos al interlocutor de la comunicaci√≥n.
El requisito es que est√© configurada la transferencia espont√°nea (v√©ase m√°s abajo).
Rango admisible: 0 ... 65535
Con el valor 0 (cero) la funci√≥n est√° desactivada.

Estaci√≥n nodo
Este par√°metro solo est√° disponible con interfaces en las que el tipo de nodo de red est√°
ajustado a "estaci√≥n nodo".
‚óè Respuesta solo con imagen de estaci√≥n actual
En una interfaz con el tipo de nodo de red "estaci√≥n nodo" el m√≥dulo de comunicaci√≥n de
la estaci√≥n nodo guarda para cada estaci√≥n DNP3 subordinada la memoria imagen de
proceso de la estaci√≥n en la memoria imagen.
‚Äì Opci√≥n activada
El m√≥dulo responde a una llamada de clase 0 solo si la memoria imagen de proceso en
la memoria imagen de la estaci√≥n nodo es actual.
‚Äì Opci√≥n desactivada
El m√≥dulo responde a una llamada de clase 0 aunque la memoria imagen de proceso en
la memoria imagen de la estaci√≥n nodo no sea actual. Cuando una central realiza una
llamada, los datos de todas las estaciones conectadas se env√≠an a la central, aunque los
datos de una o varias estaciones no sean actuales.

2012

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Transferencia espont√°nea
‚óè Se√±alizaci√≥n espont√°nea
Modo de transferencia para eventos
‚Äì S√≠ / Espont√°neo
Los telegramas de eventos se transfieren inmediatamente.
En esta opci√≥n la estaci√≥n establece autom√°ticamente una conexi√≥n con el maestro.
Si el env√≠o espont√°neo est√° desactivado en la central, la central env√≠a el c√≥digo de
funci√≥n "DISABLE_UNSOLICITED" (no est√° permitido el env√≠o de telegramas
espont√°neos por parte de la central). En este caso la estaci√≥n guarda los eventos sin
enviarlos inmediatamente.
‚Äì No / No espont√°neo
Los telegramas de eventos no se transfieren hasta que el maestro ha consultado datos.
Para una configuraci√≥n coherente deber√≠a elegirse el mismo ajuste en la estaci√≥n y en la
central.
Nota
Ajuste con l√≠neas dedicadas
Si se conecta una interfaz serie a una l√≠nea dedicada DNP3 con el ajuste "semid√∫plex", el
par√°metro debe ponerse a "No".
Para evitar colisiones, tambi√©n debe utilizarse este ajuste en caso de conexi√≥n a l√≠neas
dedicadas Multidrop d√∫plex.
‚óè N√∫mero m√°x. de repeticiones
N√∫mero m√°ximo de repeticiones de telegramas espont√°neos cuando no se recibe acuse
por parte del maestro. Una vez alcanzado el n√∫mero configurado, la estaci√≥n deshace la
conexi√≥n.
Rango de valores: 0...255
Ajuste predeterminado: 3
En conexiones Ethernet, por lo general puede introducirse el valor 0, ya que las
repeticiones en caso de errores de transferencia se llevan a cabo por medio del protocolo
debido a las colisiones.
‚óè Tiempo de vigilancia para telegramas espont√°neos
El "Unsolicited Confirmation Timeout period" es el tiempo durante el que la estaci√≥n espera
del maestro un acuse de telegramas espont√°neos. Si en el tiempo configurado no se recibe
ning√∫n acuse, se repite la transferencia de los datos.
Los telegramas enviados solo se borran del b√∫fer de transmisi√≥n cuando la estaci√≥n recibe
el acuse del maestro.
Unidades en funci√≥n del m√≥dulo: segundos o milisegundos
Rango de valores: 1...65535 s / 0...65535 ms
Ajuste predeterminado: 5 / 5000

Opciones de seguridad DNP3
autenticaci√≥n y cambio de clave
Si la funci√≥n (Secure Authentication) est√° activada, el maestro DNP3 y la estaci√≥n se
autentican con una clave secreta, la Pre-shared Key.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2013

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Con la pre-shared key com√∫n, tras el primer establecimiento de conexi√≥n entre el maestro y la
estaci√≥n se acuerdan claves de sesi√≥n, que se renuevan c√≠clicamente a partir de entonces. Por
norma general, la iniciativa para renovar la clave de sesi√≥n la toma el maestro.
Los criterios para renovar las claves se definen en los par√°metros siguientes.
‚óè Intervalo de cambio de clave
‚óè Solicitudes de autenticaci√≥n previas al cambio de clave
En cuanto se cumple una de estas dos condiciones se renueva la clave de sesi√≥n.

Par√°metro
‚óè Activar opciones de seguridad DNP3
Active esta opci√≥n para poder utilizar Secure Authentication.
‚óè Modo IKE
Selecci√≥n del modo de cambio de clave. Rango de valores:
‚Äì Aggressive Mode
El Aggressive Mode es un poco m√°s r√°pido pero transfiere la identidad sin codificar.
‚Äì Main Mode
El modo predeterminado es Main Mode.
Ajuste predeterminado: Aggressive Mode
‚óè Estad√≠sticas de seguridad
Indica si se env√≠an al maestro las estad√≠sticas de los eventos de seguridad. Los eventos de
seguridad son solicitudes de autenticaci√≥n para el m√≥dulo. Si se activa esta opci√≥n, todas
las solicitudes de autenticaci√≥n se guardar√°n en el m√≥dulo con fecha, hora y resultado y se
enviar√°n al maestro para su posterior evaluaci√≥n.
Rango de valores:
‚Äì No enviar estad√≠sticas de seguridad
‚Äì Enviar estad√≠sticas de seguridad
Ajuste predeterminado: No enviar estad√≠sticas de seguridad
‚óè Enclavamiento SHA-1
Determina si el CP est√° autorizado a utilizar el algoritmo Secure Hash SHA-1 cuando se ha
configurado "SHA-256" como algoritmo Secure Hash y el maestro no soporta SHA-256.
Rango de valores:
‚Äì Modo SHA-1 no permitido
El m√≥dulo no puede utilizar SHA‚Äë1. Cuando el maestro no soporta SHA-256 no se lleva
a t√©rmino la conexi√≥n.
‚Äì Modo SHA-1 permitido
El m√≥dulo puede utilizar SHA‚Äë1 si el maestro no soporta SHA‚Äë256.
Ajuste predeterminado: Modo SHA-1 no permitido

2014

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Algoritmo Secure Hash (SHA)
Selecci√≥n del Secure Hash Algorithm (SHA)
Rango de valores:
‚Äì SHA‚Äë1
‚Äì SHA‚Äë256
Ajuste predeterminado: 256
‚óè Algoritmo Key Wrap
Selecci√≥n del Advanced Encryption Standard (AES)
Rango de valores:
‚Äì AES‚Äë128
‚Äì AES‚Äë256
Ajuste predeterminado: AES‚Äë128
‚óè Longitud de clave
Indica la longitud de la Pre-shared Key en bytes.
En funci√≥n del algoritmo key wrap se utilizan las longitudes siguientes:
‚Äì Para AES-128: 16 bytes
‚Äì Para AES-256: 32 bytes
‚óè N√∫mero m√°x. de solicitudes de estad√≠stica
Si se rebasa por exceso el n√∫mero configurado aqu√≠ para solicitudes de estad√≠stica de un
maestro dentro del Intervalo de intercambio de clave, el m√≥dulo registra un aviso en el b√∫fer
de diagn√≥stico de la CPU.
Rango de valores: 2...255. Ajuste predeterminado: 5
‚óè Solicitudes de autenticaci√≥n previas al cambio de clave
N√∫mero m√°ximo de solicitudes de autenticaci√≥n de la estaci√≥n al maestro. Cuando se
alcanza este n√∫mero se renueva la clave de sesi√≥n.
Rango de valores: 1...10000. Ajuste predeterminado: 1000
Recomendaci√≥n: En la estaci√≥n, ajuste un n√∫mero que sea el doble que el del maestro.
‚óè Intervalo de cambio de clave
Periodo tras el cual volver√° a intercambiarse la clave entre la estaci√≥n y el maestro. El
intervalo debe sintonizarse en ambos interlocutores.
Rango de valores: 0...65535 min. Con 0 (cero) no se cambia nunca la clave (funci√≥n
desactivada). Ajuste predeterminado: 15 min.
Recomendaci√≥n: En la estaci√≥n, ajuste un intervalo de intercambio de claves que sea el
doble que el del maestro.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2015

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Tiempo de vigilancia de autenticaci√≥n
Tiempo de espera m√°ximo hasta recibir la respuesta del maestro a una solicitud de
autenticaci√≥n de la estaci√≥n.
Si se rebasa el tiempo de espera, la estaci√≥n lo evaluar√° como un error. En ese caso, la
estaci√≥n genera un evento de seguridad y lo env√≠a al maestro.
Rango de valores: 1... 65535 s. Ajuste predeterminado: 5
‚óè Pre-shared Key
La Pre-shared Key puede configurarse de dos formas:
‚Äì Configuraci√≥n manual
Introduzca manualmente la Pre-shared Key en STEP 7 en formato de valor hexadecimal.
‚Äì Importaci√≥n en formato de archivo
Importe la Pre-shared Key desde el sistema de archivos de la estaci√≥n de ingenier√≠a si
ha sido generada por el maestro u otro sistema.
La pre-shared key de un m√≥dulo de estaci√≥n debe ser id√©ntica a la pre-shared key del
maestro.

IEC 60870-5
Direccionamiento
La configuraci√≥n y la puesta en marcha del m√≥dulo de comunicaci√≥n requieren la siguiente
informaci√≥n:

Informaci√≥n de direcci√≥n del m√≥dulo de comunicaci√≥n
Para el direccionamiento deben configurarse los par√°metros siguientes en el m√≥dulo:
‚óè Direcci√≥n ASDU (direcci√≥n del objeto informativo en la capa de enlace)
‚óè Direcci√≥n, seg√∫n el tipo de red:
‚Äì Direcci√≥n IP y m√°scara de subred; alternativa: direcci√≥n IP de un servidor DHCP
‚Äì N√∫mero de tel√©fono (para red de marcaci√≥n)
‚Äì Direcci√≥n WAN (para l√≠nea dedicada)
‚óè N√∫mero del puerto Listener propio de la estaci√≥n (para consulta de conexi√≥n por parte del
maestro)

2016

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n de direcci√≥n del maestro
La siguiente informaci√≥n del maestro es necesaria para la configuraci√≥n del m√≥dulo:
‚óè Direcci√≥n ASDU (direcci√≥n del objeto informativo del maestro en la capa de enlace)
‚óè Direcci√≥n del maestro, seg√∫n el tipo de red:
‚Äì Direcci√≥n IP / M√°scara de subred + N√∫mero de puerto del puerto Listener del maestro
o bien
Mediante nombre DNS descomponible
(se necesita la direcci√≥n del servidor DNS; el m√≥dulo debe poder acceder al servidor
DNS).
‚Äì N√∫mero de tel√©fono (para red de marcaci√≥n)
‚Äì Direcci√≥n WAN (para l√≠nea dedicada)

Maestro IEC redundante
Ambos dispositivos de un maestro redundante tienen una direcci√≥n ASDU id√©ntica.
Solo se requieren direcciones IP o nombres de host diferentes.

Configuraciones con conexiones v√≠a Internet: conexiones VPN
En las conexiones por Internet es posible utilizar direcciones IP din√°micas.
Para permitir la comunicaci√≥n en ambos sentidos y, por consiguiente, transferir los datos de
forma protegida, se requiere una conexi√≥n con t√∫nel VPN. Para ello son adecuados los
m√≥dulos de seguridad de las series SCALANCE S o SCALANCE M.
Para realizar la configuraci√≥n tenga en cuenta los puntos siguientes:
‚óè La direcci√≥n IP del maestro se configura del modo habitual.
‚óè En la configuraci√≥n de la interfaz del m√≥dulo se configura la direcci√≥n IP del router.
‚óè La configuraci√≥n VPN con SCALANCE S/M se realiza en STEP 7 tanto para las estaciones
como para la central de control.

Acuse en el protocolo IEC
Mecanismos de acuso con el protocolo IEC 60870‚Äë5‚Äë104
Configuraci√≥n: Interfaz del m√≥dulo > "Opciones avanzadas" > Ajustes de transferencia - IEC
60870-5"
El m√≥dulo env√≠a junto con cada telegrama de datos un n√∫mero secuencial de emisi√≥n
correlativo. Inicialmente el telegrama de datos queda guardado en el b√∫fer de transmisi√≥n del
m√≥dulo.
Cuando el maestro lo recibe, devuelve al m√≥dulo como acuse el n√∫mero secuencial de emisi√≥n
de ese telegrama de datos o, en caso de recepci√≥n de varios telegramas de datos, del √∫ltimo
recibido. El m√≥dulo guarda el n√∫mero secuencial de emisi√≥n devuelto por el maestro como
n√∫mero secuencial de recepci√≥n y lo utiliza como acuse.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2017

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Los telegramas de datos que tienen un n√∫mero secuencial de emisi√≥n igual o menor que el de
recepci√≥n actual se eval√∫an como transferidos correctamente y se borran del b√∫fer de
transmisi√≥n del m√≥dulo.
Par√°metros:
‚óè k: Diferencia entre n√∫mero de secuencia de emisi√≥n N(S) y el n√∫mero de secuencia de
recepci√≥n N(R)
N√∫mero m√°ximo de telegramas de datos sin acusar (I‚ÄëAPDU) como diferencia m√°xima
entre N√∫mero de secuencia de emisi√≥n N(S) y N√∫mero de secuencia de recepci√≥n N(R).
Si se alcanza k y todav√≠a no ha finalizado t1, el m√≥dulo deja de enviar telegramas de datos
hasta que el maestro ha acusado todos los telegramas de datos enviados.
Si se alcanza k y t1 ha concluido, se deshace la conexi√≥n TCP.
‚óè w: N√∫mero m√°ximo de telegramas de datos no acusados
N√∫mero m√°ximo de telegramas de datos (I-APDU) recibidos, alcanzado el cual el maestro
debe confirmar el telegrama de datos recibido m√°s antiguo.
Recomendaciones de la especificaci√≥n:
‚óè w no debe ser mayor que 2/3 k.
‚óè Valor recomendado para k: 12
‚óè Valor recomendado para w: 8

Par√°metros espec√≠ficos IEC
Los siguientes par√°metros se encuentran en los grupos de par√°metros correspondientes a los
ajustes del maestro y/o de las estaciones.
Algunos par√°metros tambi√©n se muestran en el editor de conexiones de las conexiones de
Telecontrol, donde pueden editarse parcialmente.

2018

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Maestro IEC
Los siguientes par√°metros se encuentran en el grupo de par√°metros "Ajustes de maestro IEC"
de las interfaces ajustadas en el tipo de red "IEC" y el tipo de nodo de red "Estaci√≥n central" del
m√≥dulo de comunicaci√≥n.
‚óè Intervalo b√°sico de sondeo
Aqu√≠ se define el intervalo b√°sico para llamadas de estaci√≥n desde la central.
Rango de valores: 0 ... 65535 segundos
Ajuste predeterminado: 30
Con el valor 0 (cero) la funci√≥n est√° desactivada. No se produce un sondeo c√≠clico, ni tan
solo para los par√°metros indicados a continuaci√≥n, cuyo c√°lculo se basa en el Intervalo
b√°sico de sondeo.
El intervalo b√°sico se utiliza para calcular los par√°metros siguientes en la configuraci√≥n de
conexiones:
‚Äì Intervalo para consulta general
‚Äì Intervalo para consulta general de contador
‚Äì Intervalo para consulta de grupo
‚Äì Intervalo para consulta de grupo de contador
‚óè N√∫mero m√°x. de eventos por llamada
N√∫mero m√°ximo de eventos que pueden enviarse en el telegrama de respuesta de la
estaci√≥n tras una llamada por parte de la central.
Rango de valores: 0 ... 65535
Ajuste predeterminado: 0
Con 0 (cero) la funci√≥n est√° desactivada (no hay l√≠mite).

Estaci√≥n IEC
Los siguientes par√°metros se encuentran en el grupo de par√°metros "Ajustes de estaci√≥n IEC"
de las interfaces afectadas del m√≥dulo de comunicaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Par√°metros de estaci√≥n
‚óè Modo de transmisi√≥n
Este par√°metro especifica si las ASDU (eventos) de esta estaci√≥n pueden enviarse
espont√°neamente a la central.
Rango de valores:
‚Äì Transferencia espont√°nea
El m√≥dulo puede enviar ASDU espont√°neas (cause of transmission <3>).
‚Äì Sin transferencia espont√°nea
El m√≥dulo no env√≠a ASDU espont√°neas.
Ajuste predeterminado: Espont√°neo
Nota
Colisiones en l√≠neas dedicadas d√∫plex
Si se conecta una interfaz serie a una l√≠nea dedicada con tipo de conexi√≥n "semid√∫plex",
hay que desactivar "Transmisi√≥n espont√°nea".
Para evitar colisiones, tambi√©n debe desactivar Transmisi√≥n espont√°nea en la conexi√≥n a
l√≠neas dedicadas Multidrop d√∫plex.
‚óè Modo de sondeo
Aqu√≠ se define el modo con el que la central llama la estaci√≥n.
El valor configurado en la estaci√≥n se transmite a la central, donde se guarda.
Rangos de valores:
‚Äì C√≠clico
La estaci√≥n se llama c√≠clicamente.
El tiempo de ciclo est√° determinado por el par√°metro "Intervalo de sondeo de clase 0"
del maestro.
‚Äì Tras arranque / Establecimiento de la conexi√≥n
La estaci√≥n se consulta solo despu√©s del primer arranque y tras un rearranque completo.

Otros par√°metros
‚óè Par√°metros generales espec√≠ficos de IEC
Consulte "Ajustes de transferencia - IEC 60870-5" de la correspondiente interfaz del
m√≥dulo.
‚óè Respuesta a consulta general / Asignaci√≥n a consulta de grupo
En la configuraci√≥n de puntos de datos, consulte el cap√≠tulo Puntos de datos DNP3 e IEC
(P√°gina 1968).
‚óè Intervalos de llamada
En la configuraci√≥n de la conexi√≥n, consulte el cap√≠tulo Opciones (IEC) (P√°gina 1946).

2020

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Informaci√≥n adicional sobre CP de telefon√≠a m√≥vil
CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0)
Modos de operaci√≥n del CP 1242-7
Modos de operaci√≥n del CP
El CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0) permite que un S7-1200 pueda comunicarse como
estaci√≥n GPRS con una central u otras estaciones remotas a trav√©s de la red GSM. Para la
comunicaci√≥n a trav√©s de GPRS, el CP se ajusta a uno de los siguientes modos de operaci√≥n:
‚óè Telecontrol
Este modo de operaci√≥n del CP permite que la estaci√≥n GPRS pueda intercambiar datos
con los siguientes interlocutores:
‚Äì Comunicaci√≥n con el servidor Telecontrol
Este modo de operaci√≥n del CP permite que la estaci√≥n GPRS intercambie datos con un
servidor Telecontrol.
El servidor de Telecontrol es un PC conectado a Internet con la aplicaci√≥n "TCSB". Por
lo general se encuentra en la central y sirve para supervisar y controlar las estaciones
GPRS retiradas. A trav√©s de la interfaz OPC integrada pueden intercambiarse datos con
el cliente OPC de un sistema de control central.
El PC del servidor Telecontrol no se configura en STEP 7. La aplicaci√≥n "TCSB" tiene
una interfaz de configuraci√≥n propia.
‚Äì Comunicaci√≥n con otra estaci√≥n GPRS remota
Los datos se transmiten a trav√©s del servidor de Telecontrol.
‚Äì Comunicaci√≥n con una estaci√≥n de ingenier√≠a (para TeleService)
La comunicaci√≥n con el servidor Telecontrol se realiza a trav√©s de la red GSM y de Internet.
Los requisitos para este modo de operaci√≥n son disponer de una tarjeta SIM con servicio
GPRS habilitado y de un servidor Telecontrol accesible para el CP.
‚óè GPRS directo
Este modo de operaci√≥n del CP sirve para que las estaciones remotas puedan comunicarse
directamente a trav√©s de la red GMS. No se requiere ning√∫n servidor Telecontrol.
Para poder acceder directamente a las estaciones en las redes p√∫blicas, es necesario
acceder a ellas mediante una direcci√≥n fija. Para esto se utilizan tarjetas SIM con direcci√≥n
IP fija que permiten direccionar las estaciones directamente.
Los servicios de comunicaci√≥n y las funciones de seguridad disponibles (p. ej. VPN)
dependen de la oferta del proveedor de la red.
Posibles interlocutores de la estaci√≥n con el CP 1242‚Äë7 en el modo de operaci√≥n "GPRS
directo":
‚Äì Un dispositivo accesible para el CP a trav√©s de una direcci√≥n IP (estaci√≥n S7 con
CP 1242‚Äë7)
‚Äì Una estaci√≥n de ingenier√≠a (para TeleService)

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2021

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Consulte tambi√©n
Establecimientos de la conexi√≥n en el CP 1242-7 (P√°gina 2022)

Establecimientos de la conexi√≥n en el CP 1242-7
Modos de conexi√≥n del CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0)
‚óè Modo de operaci√≥n "GPRS directo"
El modo de operaci√≥n "GPRS directo" no incluye distintos modos de conexi√≥n.
‚óè Modo de operaci√≥n "Telecontrol"
El CP puede configurarse para los siguientes modos de conexi√≥n.
‚Äì Modo de conexi√≥n "Permanente"
Existe una conexi√≥n TCP permanente con el servidor de Telecontrol. Una vez se ha
establecido la conexi√≥n se dispone de una conexi√≥n TCP permanente con el servidor de
Telecontrol, incluso aunque no se transfieran datos continuamente.
‚Äì Modo de conexi√≥n "Temporal"
Solo se establece una conexi√≥n con el servidor de Telecontrol en caso de necesidad.
Una vez establecida la conexi√≥n TCP, el env√≠o de datos de proceso se produce en cuanto las
instrucciones de Telecontrol se invoquen en la CPU.
Una conexi√≥n se establece siempre por medio del CP. Si se interrumpe una conexi√≥n
establecida desde el CP, √©ste intenta autom√°ticamente establecer de nuevo la conexi√≥n.

Establecimiento de conexi√≥n en el caso de estaciones permanentes (modo de operaci√≥n "Telecontrol")
En el modo de operaci√≥n "Telecontrol" el establecimiento de la conexi√≥n permanente con el
servidor de Telecontrol se lleva a cabo cuando arranca la estaci√≥n. Si la conexi√≥n se
interrumpe, el establecimiento puede iniciarse con un SMS de activaci√≥n (vea a continuaci√≥n).

Establecimiento de conexi√≥n en el caso de estaciones temporales (modo de operaci√≥n "Telecontrol")
Para las estaciones temporales el establecimiento de la conexi√≥n puede activarse con los
siguientes eventos:
‚óè Evento en la CPU local, que debe evaluarse obligatoriamente en el programa.
En el programa se distinguen dos casos:
‚Äì Los eventos que provocan un establecimiento de conexi√≥n √∫nico (p. ej. alarmas o
comandos de un operador).
‚Äì Expiraci√≥n de un intervalo, que provoca un establecimiento de conexi√≥n c√≠clico (p. ej.
una vez al d√≠a para la transmisi√≥n de datos)
‚óè Solicitud desde un interlocutor (cliente OPC o estaci√≥n S7)
La solicitud del interlocutor provoca un establecimiento de conexi√≥n.
‚óè Solicitud desde una estaci√≥n de ingenier√≠a para TeleService
La solicitud, en la que el servidor de Telecontrol o la gateway de TeleService ejercen de
intermediarios, no tiene que ser evaluada por el programa.

2022

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè SMS de activaci√≥n del servidor de Telecontrol
El SMS de activaci√≥n puede lanzarse espont√°neamente en el servidor de Telecontrol.
Tambi√©n es posible configurar un env√≠o c√≠clico en el servidor de Telecontrol.
‚óè Llamada de activaci√≥n de un tel√©fono
La llamada de activaci√≥n puede enviarse desde un tel√©fono cuyo n√∫mero est√© autorizado
en el proyecto STEP 7. El tel√©fono debe soportar la funci√≥n CLIP (transferencia del propio
n√∫mero).
Se inicia el establecimiento de conexi√≥n con el servidor de Telecontrol (principal).
‚óè SMS de activaci√≥n de un tel√©fono
El SMS de activaci√≥n puede enviarse desde un tel√©fono cuyo n√∫mero est√© autorizado en el
proyecto STEP 7. El tel√©fono debe soportar la funci√≥n CLIP (transmisi√≥n del propio n√∫mero
de llamada) y la transmisi√≥n de SMS.
Se inicia el establecimiento de conexi√≥n con el servidor de Telecontrol especificado en el
SMS.
Al activar una estaci√≥n temporal se transfieren todos los datos si √©stos han sido modificados
desde la √∫ltima transferencia de datos.

Llamada / SMS de activaci√≥n en el modo de operaci√≥n "Telecontrol"
Respecto a la llamada o el SMS de activaci√≥n consulte el cap√≠tulo Activaci√≥n de CPs de
telefon√≠a m√≥vil (P√°gina 2024).

Establecimiento de conexi√≥n en el modo de operaci√≥n "GPRS directo"
En el modo de operaci√≥n "GPRS directo" el establecimiento de la conexi√≥n se activa con los
siguientes eventos:
‚óè Evento en la CPU local, que se eval√∫a en el programa.
‚óè Solicitud desde un interlocutor (no desde una estaci√≥n de ingenier√≠a)
La solicitud del interlocutor se eval√∫a t√©cnicamente en el programa cuando se llaman las
instrucciones de Telecontrol.
‚óè Solicitud desde una estaci√≥n de ingenier√≠a para TeleService
La solicitud, en la que el servidor de Telecontrol o la gateway de TeleService ejercen de
intermediarios, no tiene que ser evaluada por el programa.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2023

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Activaci√≥n de CPs de telefon√≠a m√≥vil
Autorizaci√≥n de alarma a trav√©s de "N√∫meros de llamada autorizados"
El requisito para que el CP acepte un SMS o una llamada de activaci√≥n es la autorizaci√≥n del
interlocutor emisor mediante su n√∫mero de llamada. Estos n√∫meros de llamada se configuran
en STEP 7 con el CP en la lista "N√∫meros de llamada autorizados".
Nota
"N√∫meros de llamada autorizados" en el proyecto STEP 7
‚óè Un n√∫mero de llamada aqu√≠ registrado autoriza al remitente que transfiere adicionalmente
este n√∫mero de llamada a iniciar el establecimiento de la conexi√≥n.
‚óè Si en la lista se introduce un asterisco (*), el CP aceptar√° SMS de todos los remitentes.
‚óè Si la lista est√° vac√≠a, no ser√° posible activar el CP para el establecimiento de conexiones.

2024

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

SMS despertador
En funci√≥n del tipo de conexi√≥n y del servidor que la activa o del servidor TeleService
transmisor, en el SMS despertador debe transferirse el texto siguiente:
‚óè Para enlaces Telecontrol:
‚Äì Texto para el SMS de activaci√≥n para establecer una conexi√≥n con el servidor de
Telecontrol:
TELECONTROL
‚Äì Texto para el SMS de activaci√≥n para establecer una conexi√≥n con el servidor de
Telecontrol principal:
TELECONTROL MAIN
‚Äì Texto para el SMS de activaci√≥n para establecer una conexi√≥n con el servidor de
Telecontrol de sustituci√≥n:
TELECONTROL BACKUP
La configuraci√≥n de los servidores de Telecontrol para el CP GPRS en STEP 7 se realiza
en "Interfaz Telecontrol > Modo de operaci√≥n > Servidor Telecontrol principal o sustitutivo".
Nota
Activaci√≥n a trav√©s de un tel√©fono m√≥vil
‚óè En un SMS de activaci√≥n se puede utilizar uno de los textos arriba mencionados.
‚óè Tras una llamada de activaci√≥n la estaci√≥n se conecta siempre con el servidor de
Telecontrol principal.
‚óè Para conexiones de TeleService:
‚Äì Texto para el SMS de activaci√≥n para establecer una conexi√≥n a trav√©s del primer
servidor de TeleService configurado:
TELESERVICE
o bien
TELESERVICE 1
‚Äì Texto para el SMS de activaci√≥n para establecer una conexi√≥n a trav√©s del segundo
servidor de TeleService configurado:
TELESERVICE 2
La configuraci√≥n de los servidores de TeleService para el CP GPRS se realiza en STEP 7,
en "Interfaz Telecontrol > Autorizaci√≥n TeleService > 1.er o 2.¬∫ servidor TeleService".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2025

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Redes de telefon√≠a m√≥vil preferentes
Selecci√≥n de las redes de telefon√≠a m√≥vil preferentes
Para elegir las redes a las que el CP de telefon√≠a m√≥vil debe conectarse preferentemente, se
ofrecen las siguientes opciones:
‚óè Autom√°tico
El CP se conecta a la red de telefon√≠a m√≥vil del operador de redes contractual seg√∫n las
especificaciones de la tarjeta SIM de m√°xima prioridad. Si la conexi√≥n a la red contratada
no se realiza correctamente, el CP se conecta a otras redes de telefon√≠a m√≥vil con las que
el operador contractual haya firmado contratos de roaming y cuyos datos de acceso est√©n
almacenados en la tarjeta SIM.
‚óè Solo red contractual
El CP se conecta √∫nicamente a la red de telefon√≠a m√≥vil del operador contractual cuya
tarjeta SIM est√° insertada en el CP. Sin roaming.
‚óè Red contractual y redes alternativas
El CP se conecta a la red contratada como primera preferencia. Si la conexi√≥n a la red
contratada no se realiza correctamente, el CP se conecta a otras redes de telefon√≠a m√≥vil
alternativas, que se incluir√°n en la Lista de operadores de red preferentes con prioridad
descendente.
Las redes alternativas se incluyen en la lista como "Public Land Mobile Network" (PLMN).
PLMN se compone de Mobile Country Code (MCC) y Mobile Network Code (MNC).
Ejemplo: 26276
Este es el PLMN para la red de prueba de la empresa Siemens AG con MCC = 262 y MNC
= 76.

Funciones online
Carga de dispositivo en el CP 1243-8 IRC (V2.1)
Restricciones al cargar desde un CP 1243‚Äë8 IRC
Al cargar los datos de configuraci√≥n desde un CP 1243‚Äë8 IRC con ayuda de funciones online
los siguientes datos no se cargan completamente:
‚óè Datos de estaciones interlocutoras
‚óè Datos de configuraci√≥n y de interlocutor de los puntos de datos
‚óè Referencias de variables PLC con referencia a interlocutores de comunicaci√≥n
Para poder utilizar el proyecto STEP 7 por completo tras cargarlo desde los dispositivos, hay
que cargar los archivos de exportaci√≥n originales desde STEP 7 V5 con los datos de
configuraci√≥n de los Proxys en los diferentes CP 1243‚Äë8 IRC (Importar configuraci√≥n de
interlocutor).

2026

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

TeleService a trav√©s de telefon√≠a m√≥vil
Cargar v√≠a TeleService
El comportamiento siguiente es v√°lido para los siguientes CPs de telefon√≠a m√≥vil:
‚óè CP 1242‚Äë7 (6GK7 242‚Äë7KX30‚Äë0XE0)
‚óè CP 1242‚Äë7 GPRS V2 (6GK7 242‚Äë7KX31‚Äë0XE0)
‚óè CP 1243‚Äë7 LTE‚ÄëEU (6GK7 243‚Äë7KX30‚Äë0XE0)
‚óè CP 1243‚Äë7 LTE‚ÄëUS (6GK7 243‚Äë7SX30‚Äë0XE0)

Recursos de conexi√≥n en TeleService
La funci√≥n TeleService ocupa un recurso de conexi√≥n en la estaci√≥n de ingenier√≠a.
La funci√≥n de cargar en o desde dispositivo durante una sesi√≥n de TeleService ocupa un
segundo recurso de conexi√≥n en la estaci√≥n de ingenier√≠a.

Cargar en dispositivo
La funci√≥n "Cargar en dispositivo" solo puede realizarse en el CP de telefon√≠a m√≥vil mediante
una conexi√≥n TeleService del siguiente modo:
1. Seleccione el CP en STEP 7.
2. Seleccione el men√∫ "Online" > "Cargar en dispositivo".
3. Seleccione la interfaz TeleService en el cuadro de di√°logo visualizado "Carga avanzada".
4. Cargue los datos del proyecto desde el cuadro de di√°logo "Carga avanzada".

Cargar de dispositivo
La funci√≥n "Cargar en dispositivo" mediante una conexi√≥n TeleService es soportada por los
CPs de telefon√≠a m√≥vil junto con las siguientes aplicaciones de servidor TeleService:
‚óè TeleControl Server Basic a partir de la versi√≥n V3
‚óè TeleService Gateway a partir de la versi√≥n V3

TeleService a trav√©s de Telecontrol
V√≠a de comunicaci√≥n en TeleService a trav√©s de Telecontrol
En TeleService a trav√©s de Telecontrol la conexi√≥n entre la estaci√≥n de ingenier√≠a y la estaci√≥n
S7 remota siempre se establece a trav√©s de un servidor TeleServicecomo mediador.
La solicitud de establecimiento de la conexi√≥n es iniciada por la estaci√≥n de ingenier√≠a y es
enviada a trav√©s del servidor TeleService. Dependiendo de las v√≠as de conexi√≥n a la estaci√≥n
disponibles, el servidor TeleService env√≠a las solicitudes a la estaci√≥n v√≠a LAN o a trav√©s de un
SMS de activaci√≥n. El CP de TeleControl de la estaci√≥n S7‚Äë1200 establece la conexi√≥n con la
estaci√≥n de ingenier√≠a a trav√©s del servidor TeleService.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2027

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Como intermediario (servidor TeleService) tambi√©n funcionan:
‚óè Un servidor de Telecontrol
El servidor de Telecontrol puede ser un PC independiente o bien puede estar instalado
como aplicaci√≥n "TCSB" en la estaci√≥n de ingenier√≠a.
‚óè Una gateway TeleService
Se utiliza una gateway TeleService cuando no hay disponible ning√∫n servidor de
Telecontrol.
El servidor TeleService puede estar conectado v√≠a LAN o Internet con la estaci√≥n de ingenier√≠a
desde la que se llama la funci√≥n TeleService.

Requisitos para TeleService a trav√©s de Telecontrol
‚óè Un servidor TeleService
‚óè El proyecto de STEP 7 con las estaciones necesarias

Indicaciones sobre la configuraci√≥n
El servidor TeleService no se configura en STEP 7.

Establecer conexi√≥n remota v√≠a Telecontrol
Requisitos para TeleService a trav√©s de Telecontrol
Para conocer los requisitos y mecanismos consulte el cap√≠tulo TeleService a trav√©s de
Telecontrol (P√°gina 2027).

Iniciar una sesi√≥n TeleService a trav√©s de Telecontrol
Inicie TeleService a trav√©s de Telecontrol del siguiente modo:
1. Dentro del proyecto y en la estaci√≥n de ingenier√≠a autorizada, seleccione la estaci√≥n S7
remota con la que se desea establecer una conexi√≥n de TeleService a trav√©s de WAN.
2. Abra el cuadro de di√°logo "Establecer conexi√≥n online" utilizando alternativamente las
siguientes opciones:
‚Äì Bot√≥n "Establecer conexi√≥n online"
‚Äì Men√∫ contextual "Establecer conexi√≥n online" (bot√≥n derecho del rat√≥n)
‚Äì Men√∫ "Online" > "Establecer conexi√≥n online"
Se abre el cuadro de di√°logo "Establecer conexi√≥n online".
3. Seleccione en la lista desplegable "Tipo de interfaz PG/PC" el tipo de interfaz "TeleService
a trav√©s de Telecontrol".
4. Seleccione en la lista desplegable "Interfaz PG/PC" la opci√≥n "TeleService board" si esta no
aparece de forma autom√°tica.

2028

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
5. Haga clic en el s√≠mbolo "Conectar" que se encuentra junto a la lista desplegable "Interfaz
PG/PC".
Se abre el cuadro de di√°logo "Establecer conexi√≥n remota v√≠a Telecontrol".
6. Configure los ajustes necesarios en este cuadro de di√°logo.
Para m√°s detalles al respecto, consulte los tooltips en cascada de STEP 7.
Para un correcto establecimiento de la conexi√≥n son necesarios los siguientes datos:

Datos necesarios para el establecimiento de la conexi√≥n con la estaci√≥n S7
En el cuadro de di√°logo "Establecer conexi√≥n remota" deben indicarse los siguientes datos:
‚óè Direcci√≥n IP o nombre DNS del servidor Telecontrol
‚óè N√∫mero de puerto TCP del servidor de Telecontrol o del router ADSL a trav√©s del cual se
ha establecido la conexi√≥n entre la estaci√≥n de ingenier√≠a y la estaci√≥n S7 remota.
‚óè Contrase√±a de servidor de la estaci√≥n de ingenier√≠a para su autenticaci√≥n en el servidor
Telecontrol
Solo es necesaria si se ha configurado una contrase√±a espec√≠fica de grupo en la aplicaci√≥n
"TCSB".
‚óè Nombre de usuario de TeleService
V√©ase la configuraci√≥n del CP en STEP 7.
‚óè Contrase√±a de TeleService
V√©ase la configuraci√≥n del CP en STEP 7.
‚óè ID de acceso del CP
Solo es necesaria cuando la estaci√≥n cuenta con varios CP de Telecontrol. V√©ase la
configuraci√≥n del CP en STEP 7.

Estado
Estados de conexi√≥n en TeleService a trav√©s de Telecontrol
En el cuadro de di√°logo "Establecer conexi√≥n remota a trav√©s de Telecontrol" pueden
mostrarse los siguientes estados de conexi√≥n:
Al abrir el cuadro de di√°logo
‚óè No conectado
No existe ninguna conexi√≥n con la estaci√≥n S7 remota. Todav√≠a no se ha iniciado el
establecimiento de conexi√≥n.
Al establecer la conexi√≥n
Despu√©s de iniciar el establecimiento de la conexi√≥n haciendo clic en el bot√≥n "Conectar", se
mostrar√°n los siguientes estados de forma consecutiva si la conexi√≥n se establece con √©xito:
‚óè Conectar con el servidor Telecontrol
La estaci√≥n de ingenier√≠a se conecta con el servidor Telecontrol.
‚óè Esperar a la estaci√≥n S7
El SMS despertador se ha depositado en la estaci√≥n remota. Esperar una respuesta de la
estaci√≥n.

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2029

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
‚óè Autenticaci√≥n en la estaci√≥n S7
La estaci√≥n S7 ha establecido una conexi√≥n IP con la estaci√≥n de ingenier√≠a a trav√©s de
GPRS e Internet y comprueba los datos de inicio de sesi√≥n y autenticaci√≥n recibidos.
‚óè Conectado
La estaci√≥n se ha conectado correctamente con la estaci√≥n de ingenier√≠a.
Si la conexi√≥n no se establece correctamente
Si la conexi√≥n no se establece con √©xito, pueden mostrarse los siguientes estados:
‚óè Servidor Telecontrol no accesible
Causas posibles:
‚Äì Se ha interrumpido la conexi√≥n entre la estaci√≥n de ingenier√≠a y el servidor Telecontrol.
‚Äì El servidor Telecontrol est√° desconectado.
‚óè Contrase√±a del servidor incorrecta
Causa: En el cuadro de di√°logo se ha especificado una contrase√±a de servidor incorrecta
para el inicio de sesi√≥n y la autenticaci√≥n de la estaci√≥n en el servidor Telecontrol.
‚óè La estaci√≥n S7 no da se√±al
Causas posibles:
‚Äì La comunicaci√≥n entre el servidor Telecontrol y la estaci√≥n es defectuosa.
‚Äì La conexi√≥n entre la red de telefon√≠a m√≥vil e Internet es defectuosa.
‚Äì La conexi√≥n a Internet es defectuosa.
‚Äì El servidor Telecontrol no ha podido enviar un SMS despertador.
‚Äì El CP no ha recibido nig√∫n SMS despertador.
‚Äì El remitente del SMS no se ha configurado en la lista de n√∫meros de llamada
despertador autorizados.
‚óè Nombre de usuario de TeleService o contrase√±a de TeleService incorrecta
Causas posibles:
‚Äì En el cuadro de di√°logo se ha introducido un nombre de usuario de TeleService o una
contrase√±a de TeleService incorrectos para la autenticaci√≥n en el CP.
‚Äì El nombre de usuario de TeleService o la contrase√±a de TeleService no se han
configurado en STEP 7.
‚óè Todos los puntos de acceso de TeleService est√°n ocupados.
‚óè El servidor Telecontrol no conoce el CP.
Causa: El CP procede de un proyecto de STEP 7 que no se corresponde con el proyecto
del servidor Telecontrol.
‚óè No hay recursos para TeleService en el CP: P√≥ngase en contacto con la l√≠nea directa de
atenci√≥n al cliente.
‚óè Error de protocolo
Causa: Datos incompatibles o datos de dispositivos incompatibles. P√≥ngase en contacto
con la l√≠nea directa de atenci√≥n al cliente.

2030

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Librer√≠a de bloques Telecontrol ST7
Crear una librer√≠a
Forma de suministro de la librer√≠a de bloques
Los bloques de programa de la librer√≠a TD7onCPU se utilizan como librer√≠a global para STEP 7.
La librer√≠a se archiva y se pone a disposici√≥n comprimida en la siguiente direcci√≥n de Internet:
Enlace: (https://support.industry.siemens.com/cs/ww/es/view/109755374)
El nombre del fichero comprimido tiene la estructura siguiente: TD7_<Versi√≥n>.zip

Creaci√≥n de la librer√≠a
Proceda del siguiente modo para utilizar la librer√≠a en STEP 7:
1. Cree un directorio adecuado en el directorio de instalaci√≥n de STEP 7 de su estaci√≥n de
ingenier√≠a, por ejemplo con el nombre "Telecontrol ST7".
2. Guarde la librer√≠a comprimida y archivada (*.zip) en este directorio.
3. Descomprima el archivo comprimido con los medios proporcionados por el sistema
operativo.
Ahora, la librer√≠a aparece como librer√≠a global archivada con el nombre "Telecontrol
ST7.zal15".
4. Abra el proyecto de STEP 7.
5. En el men√∫ "Opciones" seleccione el comando "Librer√≠as globales > Desarchivar librer√≠a".
Se abre el cuadro de di√°logo "Desarchivar la librer√≠a global archivada".
6. Elija el archivo comprimido.
7. Recomendaci√≥n: Abra la librer√≠a global con protecci√≥n contra escritura.
En el ajuste predeterminado est√° activada la opci√≥n "Abrir con protecci√≥n contra escritura".
8. Haga clic en Abrir.
Se abre el cuadro de di√°logo "Buscar carpeta". Elija el directorio de destino en el que de
descomprimir√° la librer√≠a global archivada.
9. Haga clic en "Aceptar".
La librer√≠a se descomprime y se abre.
Encontrar√° la librer√≠a en la paleta "Librer√≠as globales" de la vista de librer√≠as (Task Card) del
proyecto de STEP 7 con el nombre "Telecontrol ST7_<Versi√≥n>".

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

2031

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones

Estructura de la librer√≠a
Estructura de la librer√≠a global
La librer√≠a abierta contiene los directorios siguientes:
‚óè Tipos
‚Äì PLC data types (UDT)
Aqu√≠ hay los tipos de datos PLC (UDT) que utilizan las librer√≠as.
‚Äì System data types (SDT)
Aqu√≠ hay los tipos de datos datos de sistema que utilizan las librer√≠as.
‚óè Plantillas maestras
Aqu√≠ hay los siguientes bloques de programa:
‚Äì CPU300/400
Bloques de programa para la CPU S7-300/400
‚Äì CPU1500
Bloques de programa para la CPU S7-1500
Plantillas maestras
Las dos librer√≠as de "Plantillas maestras" para S7-300/400 y S7-1500 est√°n divididas en las
carpetas siguientes:
‚óè Data point typicals
Typicals de puntos de datos (bloques) para la transmisi√≥n de datos
‚óè Optional blocks
Bloques opcionales que pueden utilizarse en caso necesario.
‚óè System blocks
Bloques que se utilizan para la comunicaci√≥n b√°sica.
En funci√≥n de la familia SIMATIC utilizada, encontrar√° los siguientes bloques auxiliares
para la comunicaci√≥n entre TIM y CPU en carpetas separadas:
‚Äì BCom
Bloques para el procesamiento del buz√≥n de comunicaci√≥n de S7‚Äë400 y S7‚Äë1500
‚Äì PCom
Bloques para el procesamiento del buz√≥n de comunicaci√≥n de un S7‚Äë300 con bus P
(CPU sin l√≠nea compartida)
‚Äì XCom
Bloques para el procesamiento del buz√≥n de comunicaci√≥n de un S7‚Äë300 con
conexiones X

Generar, utilizar y llamar los bloques
Generar bloques TD7onCPU
Despu√©s de haber abierto la librer√≠a TD7 en la paleta "Librer√≠as globales" con el nombre
"Telecontrol ST7", pueden generarse los bloques para la comunicaci√≥n b√°sica de una o varias
CPU.

2032

Edici√≥n de dispositivos y redes
Manual de programaci√≥n y manejo, 11/2019

Configuraci√≥n de dispositivos y redes
1.4 Crear configuraciones
Requisitos
Se tienen que cumplir los requisitos siguientes antes de generar los bloques:
‚óè Los m√≥dulos de comunicaci√≥n deben estar conectados en red entre s√≠.
‚óè Un TIM 1531 IRC debe estar conectado en red con una CPU a trav√©s de Ethernet.
‚óè Un TIM 1531 IRC no debe estar asignado a ninguna CPU.
En el grupo de par√°metros "N√∫meros de dispositivos", el campo "CPU seleccionada" debe
estar vac√≠o.
‚óè En el TIM cuya CPU debe utilizar TD7onCPU no debe haberse creado ning√∫n punto de
datos.
‚óè En el editor de mensajes del TIM no debe haberse creado a√∫n ning√∫n mensaje.
‚óè Entre los interlocutores de la comunicaci√≥n deben haberse creado conexiones v√°lidas de
Telecontrol.
‚óè La librer√≠a "Telecontrol ST7" debe estar abierta en la Task Card "Librer√≠as globales".
Los requisitos difieren en m√≥dulos con datos de configuraci√≥n importados
Hay que tener en cuenta otros requisitos para m√≥dulos de comunicaci√≥n cuya configuraci√≥n
SINAUT se ha importado de un proyecto STEP 7 V5. En estos m√≥dulos, en el grupo de
par√°metros "Ajustes b√°sicos > Configuraci√≥n" la opci√≥n "Configuraci√≥n de Telecontrol" est√°
puesta a "Importar".
Para estos m√≥dulos rigen los siguientes requisitos divergentes para generar bloques:
‚óè Entre los interlocutores de la comunicaci√≥n no deben crearse conexiones de Telecontrol
ST7.
La informaci√≥n correspondiente est√° almacenada en los datos de configuraci√≥n
importados.
‚óè La CPU del m√≥dulo de comunicaci√≥n debe tener la misma direcci√≥n IP que en el proyecto
de STEP 7 V5. La CPU se asigna al m√≥dulo de comunicaci√≥n por medio de su direcci√≥n IP.
Procedimiento para la generaci√≥n
Genere los bloques para la comunicaci√≥n b√°sica del siguiente modo:
1. Seleccione el TIM que desee.
2. Seleccione el comando "Generar