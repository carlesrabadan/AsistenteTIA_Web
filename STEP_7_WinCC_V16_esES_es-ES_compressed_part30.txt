n y manejo, 11/2019

21

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Es posible parametrizar el comportamiento del contador en los límites de contaje:
● Continuar o finalizar los procedimientos de contaje al rebasarse un límite de contaje (cierre
de puerta automático).
● Cambiar el valor de contaje por el valor inicial o por el límite de contaje opuesto al rebasarse
un límite de contaje.

Valor inicial
Como valor inicial se puede parametrizar un valor cualquiera comprendido entre los límites de
contaje. El valor inicial puede modificarse en tiempo de ejecución mediante el programa de
usuario.
Según la parametrización, el módulo tecnológico puede cambiar el valor de contaje actual por
el valor inicial durante la sincronización, durante la función Capture, al rebasarse un límite de
contaje o al abrirse la puerta.

Control de puerta
La apertura y el cierre de la puerta de hardware (puerta HW) y la puerta de software (puerta
SW) definen el intervalo temporal en el que se capturan las señales de contaje.
El control de la puerta HW se realiza de forma externa a través de una entrada digital del
módulo tecnológico. El control de la puerta SW se realiza a través del programa de usuario. La
puerta HW se puede activar con la parametrización. La puerta SW (bit en la interfaz de control
de los datos IO cíclicos) no se puede desactivar.

Capture (Latch)
Es posible parametrizar el flanco de una señal de referencia externa que dispare el
almacenamiento del valor de contaje o del valor de posición actuales como valor Capture. Las
siguientes señales externas pueden desencadenar la función de Capture.
● Flanco ascendente o descendente de una entrada digital
● Ambos flancos de una entrada digital
● Flanco ascendente de la señal N en la entrada del encóder
Si se utiliza una entrada digital, es posible parametrizar si a continuación de la función Capture
se seguirá contando con el valor de contaje actual o con el valor inicial. Al utilizar el flanco
ascendente de la señal N en la entrada del encóder, a continuación de la función Capture se
seguirá contando con el valor de contaje actual. El uso de una entrada digital y el uso de la
señal N no se excluyen mutuamente para la función Capture.
El parámetro "Frecuencia de la función Capture" determina si la función se ejecuta en cada
flanco parametrizado o solo una vez después de cada habilitación.

Detector
Si se utiliza la lectura de posición para Motion Control (Página 62), puede usarse el objeto
tecnológico "Detector" para ejecutar una función de detector con una entrada digital de
hardware.

22

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización
Se puede parametrizar el flanco de una señal de referencia externa que cargue el valor inicial
predefinido en el contador. Las siguientes señales externas pueden cargar el valor inicial en el
contador:
● Flanco ascendente o descendente de una entrada digital
● Flanco ascendente de la señal N en la entrada del encóder
● Flanco ascendente de la señal N en la entrada del encóder en función del nivel de la entrada
digital asignada
El parámetro "Frecuencia de la sincronización" determina si la función se ejecuta en cada
flanco parametrizado o solo una vez después de cada habilitación.

Histéresis
Se puede especificar una histéresis para los valores de comparación, dentro de la cual se
impide que vuelva a conmutarse una salida digital. Un encóder puede permanecer en una
posición determinada en torno a la cual oscila el valor de contaje con leves movimientos. Si en
este rango de oscilación hay un valor de comparación o un límite de contaje, la salida digital
correspondiente se activa y desactiva con la frecuencia conveniente sin aplicar una histéresis.
La histéresis impide esta conmutación no deseada.

Lectura de posición con encóder absoluto SSI
Descripción
Se pueden utilizar los módulos tecnológicos TM PosInput con un encóder absoluto SSI para la
lectura de posición. El módulo tecnológico lee el valor de posición a través de una interfaz serie
síncrona del encóder absoluto SSI y lo pone a disposición del controlador.
Puede conmutar las salidas digitales del módulo tecnológico con exactitud en los valores de
posición definidos, independientemente del programa de usuario. La lectura de posición con
un encóder absoluto SSI se lleva a cabo sin control de puerta. Por motivos del sistema, la
sincronización no es posible con un encóder absoluto SSI.

Código Gray y código binario
Se soportan encóders absolutos SSI con codificación Gray y Binaria.

Capture (Latch)
Puede parametrizar uno o ambos flancos de una entrada digital que desencadenen el
almacenamiento del valor de posición actual como valor de Capture.
El parámetro "Frecuencia de la función Capture" determina si la función se ejecuta en cada
flanco parametrizado o solo una vez después de cada habilitación.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

23

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Detector
Si se utiliza la lectura de posición para Motion Control (Página 62), puede usarse el objeto
tecnológico "Detector" para ejecutar una función de detector con una entrada digital de
hardware.

Histéresis
Se puede especificar una histéresis para los valores de comparación, dentro de la cual se
impide que vuelva a conmutarse una salida digital. Un encóder puede permanecer en una
posición determinada en torno a la cual oscila el valor de posición con leves movimientos. Si
en este rango de oscilación hay un valor de comparación o un límite, la salida digital
correspondiente se activa y desactiva con la frecuencia adecuada sin aplicar una histéresis. La
histéresis impide esta conmutación no deseada.

Rango para valor de posición
Puede definir para el encóder absoluto SSI una longitud de telegrama de entre 10 y 40 bits. Los
números de bit parametrizables del LSB y del MSB del valor de posición en el telegrama
definen el rango de valores. El módulo tecnológico puede leer un valor de posición con una
longitud máxima de 32 bits y transmitirlo al controlador.
Si se utiliza un encóder con una longitud del valor de posición de hasta 31 bits, el valor de
posición sin signo se trata como un valor positivo y puede adoptar valores entre 0 y 2(MSB-LSB
+1)
-1. Si se utiliza un encóder con una longitud del valor de posición de 32 bits, el MSB del valor
de posición corresponde al signo y el valor de posición puede adoptar valores entre –
2147483648 y 2147483647. Si se utiliza un valor de posición de 32 bits para la función de
comparación, el valor de posición se interpreta como DINT.

Telegrama SSI completo
En lugar de una magnitud pueden devolverse los 32 bits menos significativos del actual
telegrama SSI no procesado. De esta manera, además del valor de posición, obtiene bits
específicos de encóder adicionales, p. ej., bits de error. Si el telegrama SSI es más corto que
32 bits, se devuelven el telegrama SSI completo, justificado a la derecha, y los bits superiores
no usados con "0" en la interfaz de respuesta.

Comportamiento en los límites de contaje
Rebase de un límite de contaje
El límite superior se rebasa por exceso cuando el valor de contaje actual coincide con el límite
superior y se produce un nuevo impulso de contaje en sentido ascendente. El límite inferior de
contaje se rebasa por exceso si el valor de contaje actual coincide con el límite inferior de
contaje y se produce un nuevo impulso de contaje en sentido descendente.

24

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
En caso de rebase, en la interfaz de realimentación se activa el bit de estado correspondiente:
Límite de contaje rebasado

Bit de estado

Límite superior de contaje

EVENT_OFLW se activa

Límite inferior de contaje

EVENT_UFLW se activa

Puede restablecer los bits de estado con RES_EVENT .
Para el rebase por exceso de un límite de contaje puede parametrizar si se sigue contando con
el valor de contaje y con cuál de ellos.
Nota
El límite superior y el valor inicial definen el rango del contador:
Rango del contador = (límite superior ‒ valor inicial) + 1

Ejemplos
La siguiente figura muestra un ejemplo de finalización del proceso de contaje (cierre de puerta
automática) tras un rebase por exceso y el ajuste del contador al valor inicial:
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGHDUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

7LHPSR

La siguiente figura muestra un ejemplo de continuación del proceso de contaje tras un rebase
por exceso y el ajuste del contador al valor inicial:
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGHDUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

7LHPSR

La siguiente figura muestra un ejemplo de finalización del proceso de contaje tras un rebase
por exceso y el establecimiento del contador al otro límite de contaje:
Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

25

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGHDUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

7LHPSR

La siguiente figura muestra un ejemplo de continuación del proceso de contaje tras un rebase
por exceso y el establecimiento del contador al otro límite de contaje:
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGHDUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

7LHPSR

Control de puerta con encóder incremental o generador de impulsos
Muchas aplicaciones requieren que el contaje comience o se detenga en función de otros
eventos. El contaje se inicia o se detiene por medio de la función de puerta.
Por cada canal, los módulos tecnológicos poseen dos puertas, que determinan la puerta
interna resultante:
● Puerta software (puerta SW)
● Puerta hardware (puerta HW)

Puerta SW
La puerta SW se abre y cierra con el bit de control (Página 175) SW_GATE. El estado de la
puerta SW se indica mediante el bit de realimentación (Página 177) STS_SW_GATE .

26

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Puerta HW
La puerta HW es opcional. La puerta HW se abre y cierra mediante señales en las entradas
digitales parametrizadas del canal.
Nota
Los filtros de entrada parametrizados retrasan la señal de control de la entrada digital.
El estado de una entrada digital DIm se indica mediante el bit de respuesta (Página 177)
STS_DIm correspondiente.

Apertura y cierre controlados por nivel de la puerta HW con una entrada digital
La siguiente figura muestra un ejemplo de apertura y cierre controlados por nivel con una
entrada digital. La entrada digital se parametriza de tal modo que esté activa con nivel alto:
9DORUGHFRQWDMH
&28179$/8(

























,PSXOVRVGH
FRQWDMH
',P DSHUWXUD
GHSXHUWD
FLHUUHGHSXHUWD

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

Mientras la entrada digital está activa, la puerta HW está abierta y se cuentan los impulsos de
contaje. Si la entrada digital se desactiva, la puerta HW se cierra. Los impulsos de contaje se
ignoran y el valor de contaje se mantiene constante.

Apertura y cierre controlados por flanco de la puerta HW con dos entradas digitales
La siguiente figura muestra un ejemplo de apertura y cierre con dos entradas digitales. Las dos
entradas digitales están parametrizadas de modo que se evalúe el flanco ascendente:
9DORUGHFRQWDMH
&28179$/8(
,PSXOVRVGH
FRQWDMH
', DSHUWXUD
GHSXHUWD
', FLHUUHGH
SXHUWD

























$SHUWXUDGH
SXHUWD
&LHUUHGH
SXHUWD

La puerta HW se abre con un flanco parametrizado en la entrada digital, que está
parametrizada para la apertura. La puerta HW se cierra con un flanco parametrizado en la
entrada digital, que está parametrizada para el cierre.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

27

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Puerta interna
Puerta interna
La puerta interna está abierta cuando la puerta SW está abierta y la puerta HW está abierta o
no se ha parametrizado. El estado de la puerta interna se indica mediante el bit de
realimentación (Página 177) STS_GATE.
Cuando la puerta interna está abierta, se inicia el contaje. Cuando la puerta interna está
cerrada, el resto de los impulsos de contaje se ignoran y el contaje se detiene.
La puerta SW debe estar abierta para controlar un proceso de contaje solo con la puerta HW.
Si no se parametriza ninguna puerta HW, se considerará que está siempre abierta. En ese
caso, la puerta interna debe abrirse y cerrarse únicamente mediante la puerta SW.
Puerta hardware

Puerta software

Puerta interna

Abierta/no parametrizada

Abierta

Abierta

Abierta/no parametrizada

Cerrada

Cerrada

Cerrada

Abierta

Cerrada

Cerrada

Cerrada

Cerrada

Durante la parametrización del comportamiento del contador debe establecerse si, tras abrir la
puerta interna, el proceso de contaje debe empezar con el valor de arranque o con el valor de
contaje actual.
Además, la puerta interna puede cerrarse automáticamente al rebasar por exceso un valor de
contaje. Para continuar el contaje es necesario que se cierre y se vuelva a abrir la puerta
software o la puerta hardware.

Comportamiento del contador ante la apertura de puerta
Dispone de las siguientes posibilidades de parametrización para el comportamiento del
contador en la apertura de la puerta:
● Ajustar el contador al valor de arranque.
● Continuar con el valor de contaje actual.

Ajuste del contador al valor de arranque
Con esta parametrización se aplican los siguientes comportamientos de contador:
Cada proceso de contaje comienza tras la apertura de la puerta interna con el valor de
arranque.
La siguiente imagen muestra un ejemplo de continuación del proceso de contaje tras poner el
contador al valor de arranque:

28

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGH
DUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

$SHUWXUDGH
SXHUWD

7LHPSR

Continuar con el valor de contaje actual
Con esta parametrización se aplican los siguientes comportamientos de contador:
Cada proceso de contaje comienza tras la nueva apertura de la puerta interna con el valor de
contaje actual.
La siguiente figura muestra un ejemplo de continuación del proceso de contaje con el valor de
contaje actual:
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGH
DUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

$SHUWXUDGH
SXHUWD

7LHPSR

Capture (Latch)
Capture con encóder incremental o generador de impulsos
Descripción
Con la función "Capture" se guarda el valor de contaje actual a través de una señal de
referencia externa. La función de Capture se puede parametrizar para las siguientes señales
de referencia:
● Flanco ascendente o descendente en una entrada digital
● Flanco ascendente y descendente en una entrada digital
● Flanco ascendente de la señal N en la entrada del encóder

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

29

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Funcionamiento
El valor de Capture es siempre exactamente el valor de contaje en el instante del flanco
correspondiente (retardado con el retardo a la entrada parametrizado). La función de Capture
actúa independientemente del estado de la puerta interna. Si la puerta está cerrada, se guarda
el valor de contaje sin cambios.
La siguiente figura muestra un ejemplo de la función de Capture con la siguiente
parametrización:
● Valor inicial = 0
● Evento de Capture con flanco ascendente en la entrada digital parametrizada
● Poner el contador al valor inicial con la apertura de puerta
● Continuar el contaje tras evento de Capture
3XHUWDLQWHUQD
$ELHUWD
&HUUDGD
',P &DSWXUH
9DORUGHFRQWDMH
&2817B9$/8(
9DORUGHFDSWXUD
&$3785('B9$/8(

La siguiente figura muestra otro ejemplo de la función de Capture con la siguiente
parametrización:
● Valor inicial = 0
● Evento de Capture con flanco ascendente en la entrada digital parametrizada
● Poner el contador al valor inicial con la apertura de puerta
● Tras el evento de Capture, establecer el valor de contaje al valor inicial y continuar el contaje
3XHUWDLQWHUQD
$ELHUWD
&HUUDGD
',P &DSWXUH
9DORUGHFRQWDMH
&2817B9$/8(
9DORUGHFDSWXUD
&$3785('B9$/8(

Con el bit de control (Página 175) EN_CAPTURE se habilita la función de Capture. El bit de
respuesta (Página 177) EVENT_CAP indica que se ha guardado un valor de contaje como
valor Capture en la interfaz de respuesta. Cuando restablece EN_CAPTURE, se restablece

30

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
EVENT_CAP. El estado de una entrada digital se indica mediante el bit de respuesta
(Página 177) STS_DIm correspondiente.
La siguiente figura muestra un ejemplo de los bits EN_CAPTURE y EVENT_CAP al utilizar la
función única de Capture mediante un flanco ascendente en una entrada digital:
',P &DSWXUH

(1B&$3785(

(9(17B&$3

&DSWXUH

6LQ
&DSWXUH

6LQ
&DSWXUH

&DSWXUH

La siguiente figura muestra un ejemplo de los bits EN_CAPTURE y EVENT_CAP al utilizar la
función periódica de Capture mediante un flanco ascendente en una entrada digital:
',P &DSWXUH

(1B&$3785(

(9(17B&$3

&DSWXUH

&DSWXUH

VLQFDSWXUD
&DSWXUH

&DSWXUH

Nota
Los filtros de entrada parametrizados retrasan la señal de control de la entrada digital
correspondiente.
La función de Capture no tiene ninguna influencia en el bit de respuesta STS_CNT ni en los
LED UP y DN.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

31

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Alarma de proceso
Se puede parametrizar una alarma de proceso para la función de Capture. Si las alarmas de
proceso se disparan más rápido de lo que el sistema puede acusarlas, se pierden alarmas de
proceso y se notifica la alarma de diagnóstico "Alarma de proceso perdida".

Capture con encóder absoluto SSI
Descripción
Con la función "Capture" se guarda el valor de posición actual a través de una señal de
referencia externa. La función de Capture se puede parametrizar para las siguientes señales
de referencia:
● Flanco ascendente o descendente en una entrada digital
● Flanco ascendente y descendente en una entrada digital

Funcionamiento
En el instante del flanco correspondiente, el valor de posición del último telegrama SSI válido
se guarda en el valor Capture.
La siguiente figura muestra un ejemplo de evento de Capture mediante un flanco ascendente
en la entrada digital parametrizada:
7HOHJUDPD66,FRQ
YDORUGHSRVLFLµQ
PRGLILFDGR
',P &DSWXUH
9DORUGHSRVLFLµQ
&2817B9$/8(
9DORUGH&DSWXUH
&$3785('B9$/8(

Con el bit de control (Página 175) EN_CAPTURE se habilita la función de Capture. El bit de
respuesta (Página 177) EVENT_CAP indica que se ha guardado un valor de posición como
valor de Capture en la interfaz de respuesta. Cuando restablece EN_CAPTURE, se restablece
EVENT_CAP. El estado de una entrada digital se indica mediante el bit de respuesta
(Página 177) STS_DIm correspondiente.
La siguiente figura muestra un ejemplo de los bits EN_CAPTURE y EVENT_CAP al utilizar la
función única de Capture mediante un flanco ascendente en una entrada digital:

32

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

',P &DSWXUH

(1B&$3785(

(9(17B&$3

&DSWXUH

6LQ
&DSWXUH

6LQ
&DSWXUH

&DSWXUH

La siguiente figura muestra un ejemplo de los bits EN_CAPTURE y EVENT_CAP al utilizar la
función periódica de Capture mediante un flanco ascendente en una entrada digital:
',P &DSWXUH

(1B&$3785(

(9(17B&$3

&DSWXUH

&DSWXUH

VLQFDSWXUD
&DSWXUH

&DSWXUH

Nota
Los filtros de entrada parametrizados retrasan la señal de control de la entrada digital
correspondiente.

Alarma de proceso
Se puede parametrizar una alarma de proceso para la función de Capture. Si las alarmas de
proceso se disparan más rápido de lo que el sistema puede acusarlas, se pierden alarmas de
proceso y se notifica la alarma de diagnóstico "Alarma de proceso perdida".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

33

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización
Descripción
Con la función "Sincronización" se pone el contador al valor inicial predefinido mediante una
señal de referencia externa. La sincronización se puede parametrizar para las siguientes
señales de referencia:
● Flancos ascendentes o descendentes en una entrada digital
● Flanco ascendente de la señal N en la entrada del encóder
● Flanco ascendente de la señal N en la entrada del encóder en función del nivel de una
entrada digital

Funcionamiento
La sincronización siempre se realiza en el instante preciso de la señal de referencia. La
sincronización actúa independientemente del estado de la puerta interna.
Con el bit de control (Página 175) EN_SYNC_UP se habilita la sincronización para el contaje
en sentido ascendente. Con el bit de control (Página 175) EN_SYNC_DN se habilita la
sincronización para el contaje en sentido descendente. El bit de respuesta (Página 177)
EVENT_SYNC indica que se ha producido una sincronización. Al restablecer EN_SYNC_UP
o EN_SYNC_DN, se restablece también EVENT_SYNC.
Nota
Los filtros de entrada parametrizados retrasan la señal de control de la entrada digital
correspondiente.
La sincronización no tiene ninguna influencia en el bit de respuesta (Página 177) STS_CNT ni
en los LED UP y DN.

34

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización única
La siguiente figura muestra un ejemplo de los bits EN_SYNC_UP, EN_SYNC_DN y
EVENT_SYNC con una única sincronización mediante un flanco en una entrada digital en el
caso de los impulsos de contaje en sentido ascendente:
',P
6LQFURQL]DFLµQ

(1B6<1&B83

(1B6<1&B'1

(9(17B6<1&

6LQFURQL]DFLµQ

6LQ
6LQFURQL]DFLµQ

6LQ
6LQFURQL]DFLµQ

6LQFURQL]DFLµQ

Tras la habilitación de la sincronización para el contaje en sentido ascendente, el contador se
sincroniza con el primer flanco ascendente en la entrada digital parametrizada. Solo tras
desactivar y volver a activar el bit de control (Página 175) EN_SYNC_UP, el contador puede
volver a sincronizarse.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

35

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización periódica
La siguiente figura muestra un ejemplo de los bits EN_SYNC_UP, EN_SYNC_DN y
EVENT_SYNC con una sincronización periódica mediante un flanco en una entrada digital en
el caso de los impulsos de contaje en sentido ascendente:
',P
6LQFURQL]DFLµQ

(1B6<1&B83

(1B6<1&B'1

(9(17B6<1&

6LQFURQL]DFLµQ

6LQFURQL]DFLµQ

6LQ
6LQFURQL]DFLµQ

6LQFURQL]DFLµQ

Mientras esté habilitada la sincronización para el contaje en sentido ascendente, el contador
se sincroniza con cada flanco ascendente en la entrada digital parametrizada.

Alarma de proceso
Se puede parametrizar una alarma de proceso para la sincronización. Si las alarmas de
proceso se disparan más rápido de lo que el sistema puede acusarlas, se pierden alarmas de
proceso y se notifica la alarma de diagnóstico "Alarma de proceso perdida".

Sincronización mediante entrada digital
Se puede activar la sincronización en una entrada digital mediante flancos.

36

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización única
La siguiente figura muestra un ejemplo de sincronización única mediante un flanco en una
entrada digital:
,PSXOVRVGH
FRQWDMH
DGHODQWH
'OP
6LQFURQL]DFLµQ

(1B6<1&B83

9DORUGHFRQWDMH
&28179$/8(

9DORUGH
DUUDQTXH

Tras la habilitación de la sincronización para el contaje en sentido ascendente, el contador se
sincroniza con el primer flanco ascendente en la entrada digital parametrizada. Hasta que el bit
de control (Página 175) EN_SYNC_UP se desactiva y se vuelve activar, se ignora un nuevo
flanco ascendente en la entrada digital. A continuación puede sincronizarse de nuevo el
contador.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

37

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización periódica
La siguiente figura muestra un ejemplo de sincronización periódica mediante un flanco en una
entrada digital:
,PSXOVRVGH
FRQWDMH
DGHODQWH
'OP
6LQFURQL]DFLµQ

(1B6<1&B83

9DORUGHFRQWDMH
&28179$/8(

9DORUGH
DUUDQTXH

Mientras esté habilitada la sincronización para el contaje en sentido ascendente, el contador
se sincroniza con cada flanco ascendente en la entrada digital parametrizada.

Sincronización en caso de señal N
La sincronización en caso de señal N en la entrada de encóder se puede disparar dependiente
o independientemente del estado de una entrada digital.

38

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización única
La siguiente figura muestra un ejemplo de sincronización única en caso de señal N
(independientemente de una entrada digital):
,PSXOVRVGH
FRQWDMH
DGHODQWH
6H³DO1

(1B6<1&B83

9DORUGHFRQWDMH
&28179$/8(
9DORUGH
DUUDQTXH

Tras la habilitación de la sincronización para el contaje en sentido ascendente, el contador se
sincroniza con la primera señal N. Tras desactivar y volver a activar el bit de control
(Página 175) EN_SYNC_UP , el contador puede volver a sincronizarse.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

39

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sincronización periódica
La siguiente figura muestra un ejemplo de sincronización periódica en caso de señal N:
,PSXOVRVGH
FRQWDMH
DGHODQWH
6H³DO1

(1B6<1&B83

9DORUGHFRQWDMH
&28179$/8(
9DORUGH
DUUDQTXH

Mientras esté habilitada la sincronización para el contaje en sentido ascendente, el contador
se sincroniza con cada señal N.

40

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Habilitación mediante una entrada digital
La siguiente figura muestra un ejemplo de sincronización periódica en caso de señal N en
función del estado de una entrada digital:
,PSXOVRVGH
FRQWDMH
DGHODQWH
6H³DO1
',P KDELOLWDU
VLQFURQL]DFLµQ
FRQVH³DO1

(1B6<1&B83

9DORUGHFRQWDMH
&28179$/8(

9DORUGH
DUUDQTXH

Mientras esté habilitada la sincronización para el contaje en sentido ascendente y la entrada
digital correspondiente esté activa, el contador se sincroniza con cada señal N. Si no se cumple
una de las dos condiciones, el contador no se sincroniza con la señal N.

Valores de comparación
Valores de comparación y salidas
Descripción
Es posible definir dos valores de comparación que pueden controlar las dos salidas digitales
del canal, independientemente del programa de usuario:
● Valor de comparación 0 para salida digital DQ0
● Valor de comparación 1 para salida digital DQ1
En función del modo de operación y el sensor o encóder utilizado, establezca como valores de
comparación dos valores de posición, valores de contaje o valores medidos. Los valores de

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

41

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
comparación son parametrizables y pueden modificarse en tiempo de ejecución a través del
programa de usuario.
Nota
DQ0 de un contador de una CPU compacta
En una CPU compacta, la salida digital DQ0 correspondiente está disponible a través de la
interfaz de respuesta, pero no como salida física.

Conmutación de salidas digitales desde el programa de usuario
Con los bits de control (Página 175) TM_CTRL_DQ0 y TM_CTRL_DQ1 se controla la
utilización de las salidas digitales.
Si TM_CTRL_DQm está establecido en 0, se puede controlar la salida digital correspondiente
con el bit de control SET_DQm desde el programa de usuario independientemente de la
función tecnológica configurada. Si TM_CTRL_DQm está establecido en 1, se habilita la
función tecnológica para controlar la salida digital correspondiente.
El estado de una salida digital se notifica mediante el bit de respuesta STS_DQm
correspondiente.

Conmutación a los valores de comparación con valor de contaje como referencia
Los valores de comparación se comparan con el valor de contaje actual. Si el valor de contaje
cumple la condición de comparación parametrizada y la función tecnológica de la salida digital
correspondiente está habilitada, la salida digital se activa. Cuando se parametriza "Entre valor
de comparación 0 y 1" para la salida digital DQ1, los dos valores de comparación repercuten
en DQ1.
La conmutación de una salida digital puede configurarse para que dependa de los siguientes
eventos de comparación:

Ajuste entre el valor de comparación y el límite superior de contaje
La salida digital correspondiente se establece en 1 cuando:
Valor de comparación <= valor de contaje <= límite superior de contaje
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGH
FRPSDUDFLµQP
/¯PLWHLQIHULRUGH
FRQWDMH

'4P

42

W

W

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
El evento de comparación es independiente del sentido de contaje.

Ajuste entre el valor de comparación y el límite inferior de contaje
La salida digital correspondiente se establece en 1 cuando:
Límite inferior de contaje <= valor de contaje <= valor de comparación
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGH
FRPSDUDFLµQP
/¯PLWHLQIHULRUGH
FRQWDMH

W

'4P

W

El evento de comparación es independiente del sentido de contaje.

Ajuste entre los valores de comparación 0 y 1
El evento de comparación puede parametrizarse para la salida digital DQ1 cuando para la
salida digital DQ0 se ha parametrizado "Utilizada por el programa de usuario". El valor de
comparación 1 debe ser superior al valor de comparación 0.
DQ1 se establece en 1 cuando:
Valor de comparación 0 <= valor de contaje <= valor de comparación 1
La siguiente figura muestra un ejemplo del evento de comparación al contar en sentido
ascendente:
9DORUGHFRQWDMH

9DORUGH
FRPSDUDFLµQ
9DORUGH
FRPSDUDFLµQ
/¯PLWHLQIHULRUGH
FRQWDMH

W

'4
W

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

43

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Ajuste con valor de comparación para una duración del impulso
La salida digital correspondiente se ajusta a 1 durante un tiempo definido si se cumplen las
siguientes condiciones:
● Valor de contaje = valor de comparación
● Sentido de contaje actual = sentido de contaje parametrizado para el evento de
comparación
La siguiente figura muestra un ejemplo del evento de comparación al contar en sentido
ascendente:
9DORUGHFRQWDMH

9DORUGH
FRPSDUDFLµQP
/¯PLWHLQIHULRUGH
FRQWDMH

W

'4P

W
'XUDFLµQGHOLPSXOVR

La siguiente figura muestra un ejemplo del evento de comparación al contar en sentido
descendente:
9DORUGHFRQWDMH

9DORUGH
FRPSDUDFLµQP
/¯PLWHLQIHULRUGH
FRQWDMH

W

'4P

W
'XUDFLµQGHOLPSXOVR

Para repetir el evento de comparación, debe cambiarse el valor de contaje de modo que
coincida de nuevo con el valor de comparación correspondiente.
Cuando se define "0" como duración del impulso y el valor de contaje coincide con el valor de
comparación, la salida digital correspondiente se establece en 1 hasta el siguiente impulso de
contaje:

44

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
,PSXOVRVGH
FRQWDMH
'4P
9DORUGHFRQWDMH YDORUGHFRPSDUDFLµQ

Nota
Este evento de comparación conmuta la salida digital correspondiente cuando el valor de
comparación se alcanza mediante un impulso de contaje. Al establecer el valor de contaje,
p. ej. por medio de la sincronización, la salida digital no se conmuta.

Ajuste mediante el programa de usuario hasta el valor de comparación
Puede establecer cada salida digital en 1 (flanco) ajustando el bit de control (Página 175)
SET_DQm. La correspondiente salida digital se establece en 0 si se produce uno de los
siguientes eventos:
● Coincidencia del valor de contaje y el valor de comparación en el sentido parametrizado del
evento de comparación
● Desactivación del correspondiente bit de control SET_DQm
La siguiente figura muestra un ejemplo del evento de comparación al contar en sentido
ascendente:
9DORUGHFRQWDMH

9DORUGH
FRPSDUDFLµQP

/¯PLWHLQIHULRUGH
FRQWDMH

6(7B'4P

'4P

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

W

W

W

45

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Al establecer el bit de control SET_DQm a 0 puede desconectar la salida digital antes de que
el valor de contaje coincida con el de comparación.
Nota
Si se alcanza el valor de comparación en el sentido de contaje parametrizado, el bit de
respuesta EVENT_CMPm se establece independientemente del estado del bit de control
SET_DQm.
El evento de comparación conmuta una salida digital cuando el valor de comparación
correspondiente se alcanza mediante un impulso de contaje. Al establecer el valor de contaje,
p. ej. por medio de la sincronización, la salida digital no se conmuta.

Conmutación a los valores de comparación con valor de posición (valor absoluto SSI) como referencia
Los valores de comparación se comparan con el valor de posición actual. Si el valor de posición
cumple la condición de comparación parametrizada y la función tecnológica de la salida digital
correspondiente está habilitada, la salida digital se activa. Cuando se parametriza "Entre valor
de comparación 0 y 1" para la salida digital DQ1, los dos valores de comparación repercuten
en DQ1.
Si se utiliza un valor de posición de 32 bits para la función de comparación, el valor de posición
se interpreta como DINT.
La conmutación de una salida digital puede configurarse para que dependa de los siguientes
eventos de comparación:

Ajuste entre el valor de comparación y el límite superior
El límite superior coincide con el valor de posición máximo.
La salida digital correspondiente se establece en 1 cuando:
Valor de comparación <= valor de posición <= valor de posición máximo
9DORUSRVLFLµQ
9DORUSRVLFLµQ
P£[LPR
9DORUFRPSDUP



W

'4P
W

El evento de comparación es independiente del sentido del cambio del valor de posición. El
valor de posición máximo depende de la resolución del encóder absoluto SSI.

46

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Ajuste entre el valor de comparación y el límite inferior
El límite inferior coincide con el valor de posición "0".
La salida digital correspondiente se establece en 1 cuando:
0 <= Valor de posición = valor de comparación
9DORUSRVLFLµQ

9DORUSRVLFLµQ
P£[LPR
9DORUFRPSDUP


W

'4P
W

El evento de comparación es independiente del sentido del cambio del valor de posición.

Ajuste entre los valores de comparación 0 y 1
El evento de comparación puede parametrizarse para la salida digital DQ1 cuando para la
salida digital DQ0 se ha parametrizado "Utilizada por el programa de usuario". El valor de
comparación 1 debe ser superior al valor de comparación 0.
DQ1 se establece en 1 cuando:
Valor de comparación 0 <= valor de posición <= valor de comparación 1
La siguiente figura muestra un ejemplo del evento de comparación en sentido ascendente:
9DORUGHSRVLFLµQ

9DORUGHFRPSDUDFLµQ
9DORUGHFRPSDUDFLµQ



W

'4
W

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

47

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Ajuste con valor de comparación para una duración del impulso
La salida digital correspondiente se ajusta a 1 durante un tiempo definido si se cumplen las
siguientes condiciones:
● Coincidencia del valor de posición y del valor de comparación o cruce del valor de
comparación
● Sentido actual del cambio de valor de posición = sentido parametrizado para el evento de
comparación
La siguiente figura muestra un ejemplo del evento de comparación en sentido ascendente:
9DORUGHSRVLFLµQ

9DORUGH
FRPSDUDFLµQP


W

'4P
W
'XUDFLµQGHOLPSXOVR

La siguiente figura muestra un ejemplo del evento de comparación en sentido descendente:
9DORUGHSRVLFLµQ

9DORUGH
FRPSDUDFLµQP


W

'4P
W
'XUDFLµQ
GHOLPSXOVR

Para repetir el evento de comparación, debe cambiarse el valor de posición de modo que
coincida de nuevo con el valor de comparación correspondiente o lo cruce.

48

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Ajuste mediante el programa de usuario hasta el valor de comparación
Puede establecer cada salida digital en 1 (flanco) ajustando el bit de control (Página 175)
SET_DQm. La correspondiente salida digital se establece en 0 si se produce uno de los
siguientes eventos:
● Coincidencia del valor de posición y del valor de comparación o cruce del valor de
comparación en el sentido parametrizado del evento de comparación
● Desactivación del correspondiente bit de control SET_DQm
La siguiente figura muestra un ejemplo del evento de comparación en sentido ascendente:
9DORUGHSRVLFLµQ

9DORUGH
FRPSDUDFLµQP



W

6(7B'4P
W
'4P
W

Al establecer el bit de control SET_DQm a 0 puede desconectar la salida digital antes de que
el valor de posición coincida con el de comparación o lo cruce.
Nota
Si se alcanza o se cruza el valor de comparación en el sentido parametrizado, el bit de
respuesta EVENT_CMPm se establece independientemente del estado del bit de control
SET_DQm.

Conmutación a los valores de comparación con valor medido como referencia
Los valores de comparación se comparan con el valor medido actual. Si el valor medido de la
condición de comparación parametrizada se cumple y la función tecnológica de la salida digital
correspondiente está habilitada, se activa la salida digital. Cuando se parametriza "Entre los
valores de comparación 0 y 1" o "No comprendido entre valor de comparación 0 y 1" para la
salida digital DQ1, los dos valores de comparación repercuten en DQ1.
La conmutación de una salida digital puede configurarse para que dependa de los siguientes
eventos de comparación:

Ajuste por encima del valor de comparación
La salida digital correspondiente se establece en 1, cuando:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

49

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Valor medido >= valor de comparación
9DORUPHGLGR

9DORUGH
FRPSDUDFLµQP


W

'4P
W

Ajuste por debajo del valor de comparación
La salida digital correspondiente se establece en 1, cuando:
Valor medido <= valor de comparación
9DORUPHGLGR

9DORUGH
FRPSDUDFLµQP


W

'4P
W

Ajuste entre los valores de comparación 0 y 1
El evento de comparación puede parametrizarse para la salida digital DQ1 cuando se ha
parametrizado "Utilizada por el programa de usuario" para la salida digital DQ0. El valor de
comparación 1 debe ser superior al valor de comparación 0.
DQ1 se establece en 1 cuando:
Valor de comparación 0 <= valor medido <= valor de comparación 1

50

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
9DORUPHGLGR

9DORUGH
FRPSDUDFLµQ
9DORUGH
FRPSDUDFLµQ


W

'4
W

Sin ajuste entre los valores de comparación 0 y 1
El evento de comparación puede parametrizarse para la salida digital DQ1 cuando se ha
parametrizado "Utilizada por el programa de usuario" para la salida digital DQ0. El valor de
comparación 1 debe ser superior al valor de comparación 0.
DQ1 se establece en 1 cuando:
Valor de comparación 1 <= valor medido <= valor de comparación 0
9DORUPHGLGR
9DORUGH
FRPSDUDFLµQ
9DORUGH
FRPSDUDFLµQ


W

'4
W

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

51

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Determinación de medidas
Sinopsis de las funciones de medición
Están disponibles las siguientes funciones de medición de alta precisión (precisión hasta 100
ppm):
Tipo de medición (Página 53)

Descripción

Medición de frecuencia

A partir del cronograma de los impulsos de contaje o cambios de los
valores de posición se calcula la frecuencia media en un intervalo de
medición, y dicha frecuencia se devuelve como número en coma
flotante en hercios.

Medición del período

A partir del cronograma de los impulsos de contaje o los cambios de
los valores de posición se calcula el período medio en un intervalo
de medición, y dicho período medio se devuelve como número en
coma flotante en segundos.

Medición de velocidad

A partir del cronograma de los impulsos de contaje o los cambios de
los valores de posición y otros parámetros se calcula la velocidad
media en un intervalo de medición, y dicha velocidad media se de‐
vuelve en la unidad parametrizada.

Los valores medidos y de contaje están disponibles simultáneamente en la interfaz de
respuesta.

Tiempo de actualización
Puede parametrizar como tiempo de actualización el intervalo con el que el módulo tecnológico
actualiza cíclicamente los valores medidos. A través de tiempos de actualización más
dilatados se pueden filtrar magnitudes inestables y se puede aumentar la precisión de medida.

Control de puerta en encóders incrementales y generadores de impulsos
La apertura y el cierre de la puerta interna definen la ventana de tiempo en la que se capturan
los impulsos de contaje. El tiempo de actualización es asíncrono al abrir la puerta, es decir, el
tiempo de actualización no se inicia con la apertura de la puerta. Después del cierre de la
puerta interna se devuelve el último valor medido.

52

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Determinación de medidas con encóder incremental o generador de impulsos
Rangos de medición (TM Count y TM PosInput)
Las funciones de medición tienen los siguientes límites de rango de medición:
Tipo de medición

Límite inferior del rango de medi‐
ción

Límite superior del rango de medi‐
ción

Medición de frecuencia

0,04 Hz

800 kHz* / 4 MHz**

Medición de período

1,25 µs* / 0,25 µs**

25 s

Medición de velocidad

Depende del número parametrizado de "incrementos por unidad" y de
la "base de tiempo para medición de velocidad"

* Válido para encóder incrementales de 24 V y evaluación de señal "cuádruple".
** Válido para encóder incremental RS422 y evaluación de señal "cuádruple".

Todos los valores medidos se devuelven como valores con signo. El signo indica si el valor de
contaje ha aumentado o disminuido durante el intervalo en cuestión.

Rangos de medición (CPU compacta)
Las funciones de medición tienen los siguientes límites de rango de medición:
Tipo de medición

Límite inferior del rango de medi‐
ción

Límite superior del rango de medi‐
ción

Medición de frecuencia

0,04 Hz

400 kHz*

Medición de período

2,5 µs*

25 s

Medición de velocidad

Depende del número parametrizado de "incrementos por unidad" y de
la "base de tiempo para medición de velocidad"

* Válido para encóder incrementales de 24 V y evaluación de señal "cuádruple".

Todos los valores medidos se devuelven como valores con signo. El signo indica si el valor de
contaje ha aumentado o disminuido durante el intervalo en cuestión.

Principio de medición
El módulo tecnológico asigna un valor de tiempo a cada impulso de contaje. El intervalo de
medida se define como el intervalo que transcurre entre el último impulso de contaje antes y
durante el tiempo de actualización precedente. Para calcular una magnitud se evalúan el
intervalo de medida y el número de impulsos del intervalo de medida.
Cuando no se produce ningún impulso de contaje en el tiempo de actualización, se produce
una adaptación dinámica del intervalo de medida. En este caso, se adopta un impulso al final
del tiempo de actualización y el intervalo de medida se calcula desde ahí hasta el último
impulso producido. A continuación, el número de impulsos es 1.
El bit de realimentación STS_M_INTERVAL notifica si se ha producido un impulso de contaje
en el intervalo de medida precedente. De ese modo, se puede distinguir entre un impulso de
contaje adoptado y uno efectivo.
Las siguientes figuras muestran el principio de medición y la adaptación dinámica del intervalo
de medida:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

53

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
DFWXDOL]DFLµQ

,PSXOVRVGH
FRQWDMH
,QWHUYDORGH
PHGLGD

,QWHUYDORGH
PHGLGD

7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
DFWXDOL]DFLµQ

,QWHUYDORGH
PHGLGD

7LHPSRGH
DFWXDOL]DFLµQ

,PSXOVRVGH
FRQWDMH
676B0B,17(59$/
,QWHUYDORGH
PHGLGD
,QWHUYDORGH
PHGLGD
,QWHUYDORGH
PHGLGD

Medición de frecuencia
En el tiempo que transcurre hasta el primer valor de medida existente se devuelve el valor "0".
El proceso de medición empieza con el primer impulso captado tras la apertura de la puerta
interna. El primer valor medido no se calcula hasta después del segundo impulso.
Cada vez que transcurre el tiempo de actualización, el valor medido se actualiza en la interfaz
de realimentación (Página 177). Cuando la puerta interna está cerrada, el proceso de medición
se detiene y el valor medido ya no se actualiza.
La siguiente figura muestra un ejemplo de la medición de la frecuencia con un tiempo de
actualización de 1 s:

54

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
3XHUWDLQWHUQD
DELHUWD
FHUUDGD
,PSXOVRV
GHFRQWDMH
9DORU
PHGLGR










W

7LHPSRGHDFWXDOL]DFLµQ

Medición del período
En la medición del período, el valor inverso de la frecuencia se emite como valor medido.
En el tiempo que transcurre hasta el primer valor de medida existente se devuelve el valor
"25 s".

Medición de velocidad
Para la medición de la velocidad, la frecuencia normalizada se emite como valor medido. La
normalización se parametriza a través de la base de tiempo y el número de incrementos que
el encóder emite por unidad.
Ejemplo:
Su encóder emite 4000 incrementos por metro. La velocidad debe medirse en metros por
minuto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

55

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
En este caso, debe parametrizar 4000 Incrementos por unidad y una base de tiempo de un
minuto.

Determinación de medidas con encóder absoluto SSI
Rangos de medición para el encóder absoluto SSI
Las funciones de medición tienen los siguientes límites de rango de medida:
Tipo de medición

Límite inferior del rango de medida Límite superior del rango de medi‐
da

Medición de frecuencia

0,04 Hz

4 MHz

Medición del período

0,25 μs

25 s

Medición de velocidad

En función del número parametrizado de "Incrementos por unidad" y
"Base de tiempo para medición de velocidad"

Todos los valores medidos se devuelven como valores con signo. El signo indica si el valor de
posición ha aumentado o disminuido durante el intervalo.

Principio de medición
El módulo tecnológico asigna un valor de tiempo a cada telegrama SSI. El intervalo de medida
se define como el intervalo que transcurre entre el último telegrama SSI con un cambio del
valor de posición antes y durante el tiempo de actualización precedente. Para el cálculo de una
magnitud se evalúan el intervalo de medición y el cambio total del valor de posición en el
intervalo de medición. El cambio total del valor de posición en un intervalo de medición coincide
con el número de incrementos del encóder en el mismo intervalo de medición.
Cuando no se produce ningún cambio del valor de posición en el tiempo de actualización, se
produce una adaptación dinámica del intervalo de medición. En este caso, se adopta un
cambio del valor de posición al final del tiempo de actualización y el intervalo de medición se
calcula desde ahí hasta el último telegrama SSI con un cambio del valor de posición. Entonces,
el cambio del valor de posición es 1.
El bit de realimentación STS_M_INTERVAL notifica si se ha producido un cambio del valor de
posición en el intervalo de medición precedente. De ese modo, se puede distinguir entre un
cambio del valor de posición adoptado y uno efectivo. Si el módulo tecnológico no puede
calcular ningún valor medido debido a un rebase de los límites del rango de medida, no se
establece el bit de realimentación STS_M_INTERVAL.

Medición de frecuencia
En el tiempo que transcurre hasta el primer valor medido existente se devuelve el valor "0,0".
El proceso de medición empieza con el primer cambio del valor de posición captado. El primer
valor medido no se calcula hasta después del segundo cambio del valor de posición captado.
Cada vez que transcurre el tiempo de actualización, el valor medido se actualiza en la interfaz
de respuesta (Página 177).
La siguiente figura muestra un ejemplo de la medición de la frecuencia con un tiempo de
actualización de 1 s:

56

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
7HOHJUDPD
66,FRQYDORU
GHSRVLFLµQ
PRGLILFDGR
9DORU
PHGLGR










W

7LHPSRGHDFWXDOL]DFLµQ

Medición del período
En la medición del período, el valor inverso de la frecuencia se emite como valor medido.
En el tiempo que transcurre hasta el primer valor medido existente se devuelve el valor "25 s".

Medición de velocidad
Para la medición de la velocidad, la frecuencia normalizada se emite como valor medido. La
normalización se parametriza a través de la base de tiempo y el número de incrementos que
el encóder emite por unidad.
Ejemplo:
Su encóder absoluto SSI funciona con una resolución de 12 bits por vuelta y emite 4096
incrementos por vuelta. La velocidad debe medirse en vueltas por minuto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

57

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
En este caso, debe parametrizar 4096 Incrementos por unidad y una base de tiempo de un
minuto.
Nota
Una velocidad demasiado alta del encóder puede devolver un sentido de giro erróneo
Si un encóder absoluto SSI gira tan rápido que recorre más de la mitad del rango de valores
dentro de un ciclo del módulo1, no es posible calcular con exactitud la velocidad y el sentido de
giro. Esto puede provocar un funcionamiento incorrecto en:
● funciones DQ
● bits de respuesta EVENT_OFLW, EVENT_UFLW, EVENT_ZERO, EVENT_CMP0,
EVENT_CMP1 y STS_DIR
1

Modo no isócrono: 500 μs; modo isócrono: tiempo de ciclo PROFINET

Nota
Si se utiliza un encóder absoluto SSI cuyo rango de valores no sea una potencia de dos, puede
ser que el valor medido de velocidad calculado en el momento del desbordamiento resulte
erróneo.

Histéresis
Histéresis con encóder incremental o generador de impulsos
Descripción
Con la histéresis se puede definir un rango para los valores de comparación en el que las
salidas digitales no deban conmutarse de nuevo antes de que el valor de contaje haya salido
una vez de este rango.
Con leves movimientos del encóder, el valor de contaje puede oscilar alrededor de un valor
concreto. Si en el rango de oscilación hay un valor de comparación o un límite de contaje, la
salida digital correspondiente se activa y desactiva con la frecuencia conveniente sin aplicar
una histéresis. La histéresis evita esta conmutación no deseada, así como alarmas de proceso
parametrizadas cuando tiene lugar un evento de comparación.
La histéresis se activa si el correspondiente valor de comparación se alcanza con un impulso
de contaje. Si el valor de contaje se ajusta al valor de arranque durante una histéresis activa,
la histéresis se desactiva.
El rango de histéresis finaliza, independientemente del valor de histéresis, en el límite inferior
o superior de contaje.

58

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Funcionamiento
La siguiente figura muestra un ejemplo de histéresis con la siguiente parametrización:
● Ajuste de una salida digital entre el valor de comparación y el límite de contaje superior
● Valor de comparación = 5
● Histéresis = 0 o 2 (sobre fondo gris)
9DORUGHFRQWDMH
&2817B9$/8(










'4PFRQ
KLVW«UHVLVb b
'4PFRQ
KLVW«UHVLVb b

La histéresis se activa al alcanzar el valor de contaje 5. Con la histéresis activada el resultado
de la comparación permanece invariable. La histéresis se desactiva al alcanzar los valores de
contaje 2 u 8.
La siguiente figura muestra un ejemplo de histéresis con la siguiente parametrización:
● Ajuste con valor de comparación para una duración del impulso
● Valor de comparación = 5
● Comparación en ambos sentidos de contaje
● Histéresis = 0 o 2 (sobre fondo gris)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

59

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
9DORUGHFRQWDMH
&2817B9$/8(










'4PFRQ
KLVW«UHVLVb b
'4PFRQ
KLVW«UHVLVb b
'XUDFLµQGHLPSXOVRSDUDPHWUL]DGD

Histéresis con encóder absoluto SSI
Descripción
Con la histéresis se puede definir un rango para los valores de comparación en el que las
salidas digitales no deban conmutarse de nuevo antes de que el valor de posición haya salido
una vez de este rango.
Con leves movimientos del encóder, el valor de posición puede oscilar alrededor de un valor
concreto. Si en el rango de oscilación hay un valor de referencia, el valor de posición mínimo
o máximo correspondiente, la salida digital correspondiente se activa y desactiva con la
frecuencia conveniente sin aplicar una histéresis. La histéresis evita esta conmutación no
deseada, así como alarmas de proceso parametrizadas cuando tiene lugar un evento de
comparación.
El rango de histéresis finaliza en el valor de posición mínimo o máximo, independientemente
del valor de la histéresis.

Funcionamiento
La siguiente figura muestra un ejemplo de histéresis con la siguiente parametrización:
● Ajuste de una salida digital entre el valor de comparación y el límite superior
● Valor de comparación = 10
● Histéresis = 0 o 2 (sobre fondo gris)

60

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
9DORUGHSRVLFLµQ
&2817B9$/8(










'4PFRQ
KLVW«UHVLVb b
'4PFRQ
KLVW«UHVLVb b

La histéresis se activa al alcanzarse el valor de posición 10. Con la histéresis activada el
resultado de la comparación permanece invariable. La histéresis se desactiva al alcanzarse
los valores de posición 7 o bien 13.
La siguiente figura muestra un ejemplo de histéresis con la siguiente parametrización:
● Ajuste con valor de comparación para una duración del impulso
● Valor de comparación = 10
● Comparación en ambos sentidos de los cambios del valor de posición
● Histéresis = 0 o 2 (sobre fondo gris)
9DORUGHSRVLFLµQ
&2817B9$/8(










'4PFRQ
KLVW«UHVLVb b
'4PFRQ
KLVW«UHVLVb b
'XUDFLµQGHLPSXOVRSDUDPHWUL]DGD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

61

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Alarmas
Alarma de proceso
El módulo tecnológico puede disparar una alarma de proceso en la CPU, entre otros, cuando
tiene lugar un evento de comparación, cuando se rebasan el límite superior o inferior, cuando
el contador pasa por cero y/o cuando cambia el sentido de contaje (inversión de sentido). Es
posible definir qué eventos deben generar una alarma de proceso durante el funcionamiento.

Alarma de diagnóstico
El módulo tecnológico puede disparar alarmas de diagnóstico si se producen errores. Debe
habilitar las alarmas de diagnóstico para determinados errores en la configuración del
dispositivo. Infórmese con el manual de producto del módulo tecnológico sobre los eventos
que pueden disparar una alarma de diagnóstico durante el funcionamiento.

Lectura de posición para Motion Control
Descripción
El módulo tecnológico se puede utilizar, p. ej., con un encóder incremental para los siguientes
objetos tecnológicos de eje de S7-1500 Motion Control para la lectura de posición:
● TO_PositioningAxis
● TO_SynchronousAxis
● TO_ExternalEncoder
Si se emplea un encóder incremental o un generador de impulsos, la lectura de posición se
basa en la función de contaje del módulo tecnológico. Con un encóder absoluto SSI, el valor
absoluto se lee a través de una interfaz serie síncrona, se acondiciona de acuerdo con la
parametrización y se pone a disposición de S7-1500 Motion Control.
La funcionalidad del módulo tecnológico tiene las siguientes limitaciones:
● No pueden parametrizarse comportamientos de contador
● No se dispone de funciones para entradas digitales, excepto la función de detector
● No se dispone de funciones de comparación para salidas digitales
● No se dispone de alarmas de proceso
En la configuración de dispositivos del módulo tecnológico en STEP 7 (TIA Portal), seleccione
el modo de operación "Lectura de posición para el objeto tecnológico "Motion Control"" y utilice
el objeto tecnológico correspondiente en el programa. Así se reducen las posibilidades de
parametrización a los parámetros necesarios. Para TM Count o TM PosInput el modo de
funcionamiento se aplica automáticamente a todos los canales del módulo tecnológico. En una
CPU compacta el modo de operación se aplica al canal en cuestión.
En este modo de operación puede usarse el objeto tecnológico Detector (TO_MeasuringInput)
para ejecutar una función de detector con una entrada digital de hardware. Para ello,
seleccione en el objeto tecnológico Detector el tipo de detector "Medición mediante telegrama
PROFIdrive" y, como número del detector, el valor "1".

62

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Encontrará información sobre el resto de la configuración en la ayuda sobre objetos
tecnológicos Eje y el objeto tecnológico Detector de S7-1500 Motion Control.

Señales del encóder
Señales de contaje de 24 V y TTL
Señales de contaje de encóder incrementales de 24 V y TTL
El encóder incremental de 24 V suministra al módulo tecnológico las señales de 24 V A, B y N.
Las señales A y B están desfasadas 90° entre sí. Puede conectar también encóders
incrementales sin señal N.
En un encóder incremental de 24 V se utilizan las señales A y B para contar. La señal N sirve,
en la parametrización correspondiente, para poner el contador al valor de inicio o guardar el
valor de contaje actual en el valor de Capture.
La siguiente figura muestra un ejemplo del cronograma de las señales de un encóder
incremental de 24 V:
6H³DO$

6H³DO%

6H³DO1
6HQWLGRGHFRQWDMH

DGHODQWH

DWU£V

El módulo tecnológico detecta el sentido de contaje por la secuencia de los flancos en las
señales A y B. Puede definir una inversión del sentido de contaje.

Señales de contaje de generadores de impulsos de 24 V y TTL sin/con señal de sentido
El sensor, por ejemplo un detector de proximidad (BERO) o una fotocélula, solo proporciona
una señal de contaje, que debe conectarse a la conexión A del contador.
Adicionalmente puede conectar a la conexión B del contador una señal para detectar el
sentido. Con nivel alto de la señal de sentido se cuenta hacia atrás. Si el encóder no
proporciona la señal correspondiente, se puede predefinir el sentido de contaje con el
programa de usuario a través de la interfaz de control.
La siguiente figura muestra un ejemplo del cronograma de las señales de un encóder de
impulsos de 24 V con señal de sentido y los impulsos de contaje resultantes:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

63

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
6H³DO$

6H³DO%
FRPRVH³DO
GHVHQWLGR
,PSXOVRVGH
FRQWDMH
DGHODQWH

DGHODQWH

DWU£V

,PSXOVRVGH
FRQWDMH
DWU£V

Señales de contaje de generadores de impulsos de 24 V y TTL con señal de contaje ascendente/
descendente
La señal de contaje ascendente se conecta al conector A. La señal de contaje descendente se
conecta al conector B.
La siguiente figura muestra un ejemplo del cronograma de las señales de un generador de
impulsos con señal de contaje ascendente/descendente y los impulsos de contaje resultantes:
6H³DO$FRPRVH³DOGH
FRQWDMHDVFHQGHQWH

6H³DO%
FRPRVH³DOGHFRQWDMH
GHVFHQGHQWH
,PSXOVRVGHFRQWDMH
DGHODQWH
,PSXOVRVGHFRQWDMHDWU£V

Sensores tipo PNP/tipo NPN para señales de contaje de 24 V (TM Count)
En las entradas de contaje se pueden conectar los siguientes encóder o sensores:
● Sensores tipo PNP:
Las entradas A, B y N se conmutan a 24VDC .
● Sensores tipo NPN:
Las entradas A, B y N se conmutan a masa M .
● Sensores tipo push/pull (tipo PNP y M):
Las entradas A, B y N se conmutan de forma alternativa a 24VDC y a masa M .

Sensores tipo PNP para señales de contaje de 24 V (CPU compacta)
En las entradas de contaje se pueden conectar los encóders o sensores tipo P y push/pull:

Vigilancia de las señales de encóder (TM Count y TM PosInput)
El módulo tecnológico vigila la posible rotura de hilo en las señales de encóders tipo push/pull
de 24 V. El módulo tecnológico vigila posibles errores en la tensión de alimentación en las
señales TTL.

64

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si se habilita la alarma de diagnóstico en la configuración de dispositivos, el módulo
tecnológico disparará una alarma de diagnóstico en caso de error en las señales del encóder.

Señales de contaje RS422
Señales de contaje de encóders incrementales RS422
El encóder incremental RS422 proporciona al módulo tecnológico las siguientes señales
diferenciales:
● +A y –A
● +B y –B
● +N y –N
La información de señal en señales RS422 se codifica en su tensión diferencial entre +A y –A,
+B y –B o +N y –N. Las señales A y B están desfasadas 90° entre sí. Puede conectar también
el encóder incremental sin señal N.
En un encóder incremental RS422 se emplean las señales A y B para contar. La señal N sirve,
en la parametrización correspondiente, para poner el contador al valor inicial o guardar el valor
de contaje actual como valor de Capture.
La siguiente figura muestra un ejemplo del cronograma de las señales de un encóder
incremental RS422:

7HQVLµQGLIHUHQFLDO $  ದ$ 

9

7HQVLµQGLIHUHQFLDO %  ದ%

9

7HQVLµQGLIHUHQFLDO 1  ದ1

9

6HQWLGRGHFRQWDMH

DVFHQGHQWH

GHVFHQGHQWH

El módulo tecnológico detecta el sentido de contaje por la secuencia de los flancos en las
señales A y B. Puede definir una inversión del sentido de contaje.

Señales de contaje de encóders de impulsos RS422 sin/con señal de sentido
El encóder, por ejemplo una fotocélula, solo proporciona una señal de contaje, que debe
conectarse a la conexión A.
Adicionalmente puede conectar a la conexión B una señal para detectar el sentido. Con nivel
alto de la señal de sentido se cuenta hacia atrás. Si el encóder no proporciona la señal
correspondiente, se puede predefinir el sentido de contaje con el programa de usuario a través
de la interfaz de control.
La siguiente figura muestra un ejemplo del cronograma de las señales de un generador de
impulsos RS422 con señal de sentido y los impulsos de contaje resultantes:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

65

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
7HQVLµQGLIHUHQFLDO $  ದ$ 
7HQVLµQGLIHUHQFLDO %  ದ% 
FRPRVH³DOGHVHQWLGR

9
DVFHQGHQWH

GHVFHQGHQWH

9

,PSXOVRVGHFRQWDMHDVFHQGHQWH
,PSXOVRVGHFRQWDMHGHVFHQGHQWH

Señales de contaje de encóders de impulsos RS422 con señal de contaje ascendente/descendente
La señal de contaje ascendente se conecta a las conexiones A. La señal de contaje
descendente se conecta a las conexiones B.
La siguiente figura muestra un ejemplo del cronograma de las señales de un generador de
impulsos RS422 con señal de contaje ascendente/descendente y los impulsos de contaje
resultantes:
7HQVLµQGLIHUHQFLDO $  ದ$
FRPRVH³DOGHFRQWDMHDVFHQGHQWH

9

7HQVLµQGLIHUHQFLDO %  ದ% 
FRPRVH³DOGHFRQWDMHGHVFHQGHQWH

9

,PSXOVRVGHFRQWDMHDVFHQGHQWH
,PSXOVRVGHFRQWDMHGHVFHQGHQWH

Vigilancia de las señales de encóder
El módulo tecnológico vigila posibles roturas de hilo, cortocircuitos y errores en la tensión de
alimentación en las señales RS422.
Si se habilitan la alarma de diagnóstico en la configuración del dispositivo, el módulo
tecnológico dispara una alarma de diagnóstico en caso de error en las señales del encóder.

Señales SSI
Señales de encóders absolutos SSI
El encóder absoluto SSI y el módulo tecnológico se comunican a través de las señales de
datos SSI +D y –D y las señales de reloj SSI +C y –C. SSI utiliza el estándar de señal RS422.
La información de señal está codificada en la tensión diferencial entre +C y –C y entre +D y –
D.

Vigilancia de las señales de encóder y los telegramas SSI
El módulo tecnológico vigila posibles roturas de hilo, cortocircuitos y errores en la tensión de
alimentación en las señales de un encóder absoluto SSI. Además, el módulo tecnológico vigila
posibles errores en los telegramas SSI.

66

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si se habilitan las alarmas de diagnóstico en la configuración de dispositivo, el módulo
tecnológico dispara una alarma de diagnóstico en caso de error en las señales del encóder o
el telegrama SSI.

Evaluación de señales incrementales
Vista general
El contador del módulo tecnológico cuenta los flancos de las señales de encóder A y B. En los
encóders incrementales con señales A y B desfasadas entre sí, se puede elegir entre la
evaluación simple y la múltiple para aumentar la resolución.
Es posible parametrizar las siguientes evaluaciones de la señal:
● Evaluación simple (Página 67)
● Doble evaluación (Página 68)
● Evaluación cuádruple (Página 68)
Nota
Se evalúa el desfase entre los flancos de las señales A y B. Si no se detecta ningún desfase,
se notifica un error de encóder (transición ilegal de las señales A/B) a través del bit de
respuesta ENC_ERROR.

Evaluación simple
En la evaluación simple se evalúan el flanco ascendente y descendente en la señal A durante
un nivel bajo en la señal B.
Los impulsos de contaje en sentido ascendente se generan con un flanco ascendente en la
señal A durante un nivel bajo en la señal B. Los impulsos de contaje en sentido descendente
se generan con un flanco descendente en la señal A durante un nivel bajo en la señal B.
La figura siguiente muestra un ejemplo de evaluación simple de señales de contaje de 24 V y
TTL:
6H³DO$
6H³DO%
,PSXOVRVGH
FRQWDMH
DGHODQWH
,PSXOVRVGH
FRQWDMHDWU£V
6HQWLGRGHFRQWDMH

DGHODQWH

DWU£V

La figura siguiente muestra un ejemplo de evaluación simple de las señales de contaje RS422:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

67

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
7HQVLµQGLIHUHQFLDO $  ದ$
FRPRVH³DOGHFRQWDMHDVFHQGHQWH

9

7HQVLµQGLIHUHQFLDO %  ದ% 
FRPRVH³DOGHFRQWDMHGHVFHQGHQWH

9

,PSXOVRVGHFRQWDMHDVFHQGHQWH
,PSXOVRVGHFRQWDMHGHVFHQGHQWH
DVFHQGHQWH

GHVFHQGHQWH

Evaluación doble
En la evaluación doble se evalúan los flancos ascendentes y descendentes de la señal A.
En función del sentido de los flancos de la señal A y del nivel de la señal B entretanto, se crean
impulsos de contaje en sentido ascendente o descendente.
La figura siguiente muestra un ejemplo de evaluación doble de señales de contaje de 24 V y
TTL:
6H³DO$
6H³DO%
,PSXOVRVGH
FRQWDMH
DGHODQWH
,PSXOVRVGH
FRQWDMH
DWU£V

DGHODQWH

DWU£V

La figura siguiente muestra un ejemplo de evaluación doble de las señales de contaje RS422:
7HQVLµQGLIHUHQFLDO $  ದ$
FRPRVH³DOGHFRQWDMHDVFHQGHQWH

9

7HQVLµQGLIHUHQFLDO %  ದ% 
FRPRVH³DOGHFRQWDMHGHVFHQGHQWH

9

,PSXOVRVGHFRQWDMHDVFHQGHQWH
,PSXOVRVGHFRQWDMHGHVFHQGHQWH

DVFHQGHQWH

GHVFHQGHQWH

Evaluación cuádruple
En la evaluación cuádruple se evalúan los flancos ascendentes y descendentes en las
señales A y B.
En función del sentido de los flancos de una señal y del nivel entretanto de la otra, se crean los
impulsos de contaje en sentido ascendente o descendente.
La figura siguiente muestra un ejemplo de evaluación cuádruple de señales de contaje de 24 V
y TTL:

68

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

6H³DO$
6H³DO%
,PSXOVRVGH
FRQWDMH
DGHODQWH
,PSXOVRVGH
FRQWDMH
DWU£V

DGHODQWH

DWU£V

La figura siguiente muestra un ejemplo de evaluación cuádruple de las señales de contaje
RS422:
7HQVLµQGLIHUHQFLDO $  ದ$
FRPRVH³DOGHFRQWDMHDVFHQGHQWH

9

7HQVLµQGLIHUHQFLDO %  ದ% 
FRPRVH³DOGHFRQWDMHGHVFHQGHQWH

9

,PSXOVRVGHFRQWDMHDVFHQGHQWH
,PSXOVRVGHFRQWDMHGHVFHQGHQWH

DVFHQGHQWH

GHVFHQGHQWH

Modo isócrono (TM Count y TM PosInput)
El módulo tecnológico soporta la función de sistema "Modo isócrono". Esta función de sistema
permite capturar valores de posición, valores de contaje y valores medidos en un determinado
ciclo del sistema.
En el modo isócrono, el ciclo del programa de usuario, la transferencia de los datos de entrada
y salida y el procesamiento en el módulo se sincronizan entre sí. Las señales de salida se
conmutan inmediatamente cuando se cumple la condición de comparación correspondiente.
Un cambio de estado en una entrada digital causa de inmediato la reacción prevista del módulo
tecnológico y el cambio del bit de estado de la entrada digital en la interfaz de respuesta.
Al operar con un objeto tecnológico "Contaje y medición", se utiliza un OB del tipo
"Synchronous Cycle" (p. ej., OB61). En el OB asignado se llama la instrucción
High_Speed_Counter o SSI_Absolute_Encoder.
En la lectura de posición de un objeto tecnológico "Motion Control" se utiliza un OB del tipo
"MC-Servo". Si se usan los objetos tecnológicos Leva y Pista de levas, se necesita el modo
isócrono. Si se usa el objeto tecnológico Detector en combinación con la entrada digital de
hardware DI1, no es necesario el modo isócrono.
En el modo manual se utiliza un OB del tipo "Ciclo síncrono" (p. ej., OB61). En el OB asignado
se procesan los datos de entrada y salida.

Procesamiento de los datos
Los datos transferidos al módulo tecnológico en el ciclo de bus actual a través de la interfaz de
control se hacen efectivos al editarlos en el marco del ciclo interno del módulo tecnológico. En
el instante de la lectura de los datos de entrada (Ti) se capturan el valor de posición o de contaje
y, en su caso, el valor medido y los bits de estado, y se envían a la interfaz de respuesta para
la recogida en el ciclo de bus actual.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

69

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
El tiempo de actualización del valor medido se sincroniza en una relación adecuada con el ciclo
del sistema y, en caso necesario, se modifica su duración. Si se parametriza "0", el valor
medido se actualiza una vez por cada ciclo del sistema.

Parámetros de sincronismo
En el modo isócrono, los siguientes parámetros pueden afectar a los parámetros de
sincronismo del dominio Sync:
● Frecuencia de filtrado
● Longitud de telegrama1
● Velocidad de transferencia1
● Tiempo monoestable1
● Paridad1
1

Solo si se utiliza un encóder absoluto SSI

Puesto que los parámetros de sincronismo no se comprueban en RUN, se pueden producir
desbordamientos si se cambian en RUN uno o varios de los parámetros mencionados. Para
prevenir rebases, seleccione la opción que requiera más tiempo ya en el ajuste de parámetros
offline.

Más información
Encontrará una descripción detallada del modo isócrono:
● En el manual de funciones Modo isócrono, disponible para descarga en Internet (https://
support.industry.siemens.com/cs/ww/es/view/109755401)
● En el manual de funciones PROFINET con STEP 7, disponible para descarga en Internet
(https://support.industry.siemens.com/cs/ww/es/view/49948856).

1.1.1.3

Principios básicos de contaje (TM Timer DIDQ)

Sinopsis de las aplicaciones posibles
Introducción
El TM Timer DIDQ se configura y parametriza con el software de configuración.
Las funciones del módulo se controlan con el programa de usuario a través de la interfaz de
control y respuesta.

70

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Entorno del sistema
El módulo correspondiente puede emplearse con sus funciones de contaje en los siguientes
entornos del sistema:
Aplicaciones posibles

Componentes necesarios

Operación centralizada con
● Sistema de
una CPU S7-1500 o 151xSP
automatización S7-1500
o CPU ET 200SP
● TM Timer DIDQ
Operación descentralizada
con una CPU S7-1500

Software de configuración

En el programa de usuario

STEP 7 (TIA Portal):

Acceso directo a la interfaz
de respuesta del módulo tec‐
nológico en los datos IO

Configuración de dispositi‐
vos y ajuste de parámetros
con configuración hardware

● Sistema de
automatización S7-1500
● Sistema de periferia
descentralizada ET 200
● TM Timer DIDQ

Operación descentralizada
con una CPU S7-300/400

● Sistema de
automatización
S7-300/400
● Sistema de periferia
descentralizada ET 200
● TM Timer DIDQ

STEP 7 (TIA Portal):
Configuración de dispositi‐
vos y ajuste de parámetros
con configuración hardware
STEP 7:
Configuración de dispositi‐
vos y ajuste de parámetros
con configuración hardware
(solo ET 200SP)

Nota
Encontrará una descripción de la interfaz de control y respuesta en el manual de producto del
TM Timer DIDQ.

Contaje con encóder incremental
Algunos canales de un TM Timer DIDQ pueden utilizarse para tareas de contaje sencillas con
un encóder incremental. Contar significa registrar y sumar eventos. Cada uno de los canales
parametrizados como contadores captura las dos señales incrementales y las evalúa como
corresponda.

Sentido de contaje
El módulo tecnológico puede contar hacia delante o hacia atrás con un encóder incremental.
Es posible invertir el sentido de contaje para adaptarlo al proceso.

Límites de contaje
Los límites de contaje definen el rango utilizado por los valores de contaje.
El valor de contaje mínimo es ‒2147483648 (‒231). El valor de contaje máximo es 2147483647
(231–1). El contador correspondiente cuenta de manera continua. En caso de rebase por
exceso, el contador salta al límite de contaje opuesto y continúa contando.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

71

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
El programa de usuario no puede influir en el valor de contaje.

Parametrización
Para utilizar un contador para un encóder incremental, se agrupan dos entradas digitales de un
grupo de canales. Para ello, en los parámetros de canal del grupo que corresponda se
selecciona la configuración "Encóder incremental (A, B desfasadas)".
Nota
Contadores del TM Timer DIDQ 16x24V
El número de contadores disponibles del TM Timer DIDQ 16x24V depende de la configuración
del canal. Para poder utilizar 4 contadores, en la configuración del canal debe seleccionarse
el uso de ocho entradas. Si se selecciona el uso de tres entradas, se podrá utilizar 1 contador.
Otras configuraciones de canal no permiten utilizar contadores.

Valor de contaje indicado como respuesta
El valor de contaje actual se muestra en la interfaz de respuesta en el valor TEC_IN (DIm). DIm
es la primera de las dos entradas digitales agrupadas. Para la segunda entrada digital, en el
valor TEC_IN (DIm+1) se devuelve "0".

Contaje con generador de impulsos
Algunos canales de un TM Timer DIDQ pueden utilizarse para tareas de contaje sencillas con
un generador de impulsos. Contar significa registrar y sumar eventos. Cada uno de los canales
parametrizados como contadores captura una señal de impulso y la evalúa como corresponda.

Sentido de contaje
El módulo tecnológico puede contar hacia delante con un generador de impulsos.

Límites de contaje
Los límites de contaje definen el rango utilizado por los valores de contaje.
El valor de contaje mínimo es ‒2147483648 (‒231). El valor de contaje máximo es 2147483647
(231–1). El contador correspondiente cuenta de manera continua. En caso de rebase por
exceso, el contador salta al límite de contaje opuesto y continúa contando.
El programa de usuario no puede influir en el valor de contaje.

72

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Parametrización
Para utilizar un contador para un generador de impulsos, en los parámetros de canal del grupo
que corresponda se selecciona la configuración "Utilizar entradas individualmente" o "Utilizar
entrada/salida individualmente". La primera entrada digital de un grupo se puede parametrizar
como contador.
Nota
Contadores del TM Timer DIDQ 16x24V
El número de contadores disponibles del TM Timer DIDQ 16x24V depende de la configuración
del canal. Para poder utilizar 4 contadores, en la configuración del canal debe seleccionarse
el uso de ocho entradas. Si se selecciona el uso de tres entradas, se podrá utilizar 1 contador.
Otras configuraciones de canal no permiten utilizar contadores.

Valor de contaje indicado como respuesta
El valor de contaje actual se muestra en la interfaz de realimentación en el valor TEC_IN (DIm).
DIm es la entrada digital correspondiente.

Señales de contaje de 24 V
Señales de contaje de encóders incrementales de 24 V
El encóder incremental de 24 V suministra al módulo tecnológico las señales de 24 V A y B. Las
señales A y B están desfasadas 90° entre sí.
La siguiente figura muestra un ejemplo del cronograma de las señales de un encóder
incremental de 24 V:
',P
6H³DO$
',P
6H³DO%
6FRQWDMH

DGHODQWH

DWU£V

El módulo tecnológico detecta el sentido de contaje por la secuencia de los flancos en las
señales A y B. Puede definir una inversión del sentido de contaje.
Evaluación de señal
Las dos señales desfasadas de un encóder incremental se evalúan cuatro veces. En la
evaluación cuádruple se evalúan los flancos ascendentes y descendentes en las señales A
y B.
Los impulsos de contaje se crean en sentido ascendente o descendente en función del sentido
de los flancos de una señal y del nivel de la otra señal entretanto.
La figura siguiente muestra un ejemplo de evaluación cuádruple de señales de contaje de 24 V:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

73

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
',P
6H³DO$
',P
6H³DO%
,PSFRQW
DGHODQWH
,PSFRQW
DWU£V

DGHODQWH

DWU£V

Señales de contaje de generadores de impulsos de 24 V
Un encóder, por ejemplo un detector de proximidad (BERO) o una fotocélula, solo proporciona
una señal de contaje que se conecta a la entrada digital de un contador.
Se pueden contar los flancos ascendentes o descendentes de la señal.

Modo isócrono
El TM Timer DIDQ soporta la función de sistema "Modo isócrono". Esta función de sistema
permite capturar valores de contaje en un determinado ciclo del sistema.
En el modo isócrono, el ciclo del programa de usuario, la transferencia de los datos de entrada
y salida y el procesamiento en el módulo se sincronizan entre sí.

Procesamiento de los datos
Los datos transferidos al módulo en el ciclo de bus actual a través de la interfaz de control se
hacen efectivos al editarlos en el marco del ciclo interno del módulo. En el instante Ti se leen
el valor de contaje y los bits de estado, y se preparan en la interfaz de respuesta para la
recogida en el ciclo de bus actual.

Más información
Encontrará una descripción detallada del modo isócrono en los siguientes documentos:
● En el manual de funciones Modo isócrono, disponible para descarga en Internet (https://
support.industry.siemens.com/cs/ww/es/view/109755401)
● En el manual de funciones PROFINET con STEP 7, disponible para descarga en Internet
(https://support.industry.siemens.com/cs/ww/es/view/49948856).

1.1.1.4

Principios básicos de contaje (módulos digitales)

Sinopsis de las aplicaciones posibles
Introducción
El módulo digital se configura y parametriza con el software de configuración.

74

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Las funciones del módulo se controlan con el programa de usuario a través de la interfaz de
control y respuesta.

Entorno del sistema
El módulo correspondiente puede emplearse en los siguientes entornos del sistema:
Aplicaciones posibles

Componentes necesarios

Software de configuración

En el programa de usuario

Operación centralizada con
una CPU S7-1500 o
ET 200SP

● Sistema de
automatización S7-1500
o CPU ET 200SP

STEP 7 (TIA Portal):

Acceso directo a la interfaz
de control y respuesta del mó‐
dulo digital en los datos IO

Operación descentralizada
con una CPU S7-1500

● Sistema de
automatización S7-1500

● Módulo digital

Configuración de dispositi‐
vos y ajuste de parámetros
con configuración hardware

● Sistema de periferia
descentralizada ET 200
● Módulo digital
Operación descentralizada
con una CPU S7-300/400

● Sistema de
automatización
S7-300/400
● Sistema de periferia
descentralizada ET 200

Operación descentralizada
en un sistema de otro fabri‐
cante

STEP 7 (TIA Portal):
Configuración de dispositi‐
vos y ajuste de parámetros
con configuración hardware
STEP 7:

● Módulo digital

Configuración de dispositi‐
vos y ajuste de parámetros
con configuración hardware
(ET 200SP) o archivo GSD
(ET 200MP)

● Sistema de
automatización de otro
fabricante

Software de configuración de
otro fabricante:

● Sistema de periferia
descentralizada ET 200

Configuración del dispositivo
y ajuste de parámetros con el
archivo GSD

● Módulo digital

Nota
Encontrará una descripción de la interfaz de control y respuesta en el manual de producto del
módulo digital.

Contaje con generador de impulsos
Contar significa registrar y sumar eventos. Los contadores de los módulos capturan señales de
impulsos y las evalúan según corresponda. El sentido de contaje puede predefinirse a través
de señales de encóder o de impulsos adecuadas o a través de la parametrización.
Existe la posibilidad de emplear bits de respuesta para conmutar salidas digitales de módulos
de salidas digitales en valores de contaje definidos.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

75

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Es posible parametrizar el comportamiento de los contadores con ayuda de las funciones que
se describen a continuación.

Límites de contaje
Los límites de contaje definen el rango utilizado por los valores de contaje. Los límites de
contaje son parametrizables y pueden modificarse durante el funcionamiento a través del
programa de usuario. Consulte el manual de producto del módulo para obtener información
sobre los límites de contaje máximos y mínimos ajustables.
Existe la posibilidad de parametrizar si los procesos de contaje continúan o finalizan al superar
un límite de contaje (cierre de puerta automático).

Valor inicial
Como valor inicial se puede parametrizar un valor cualquiera comprendido entre los límites de
contaje. El valor inicial puede modificarse durante el funcionamiento a través del programa de
usuario.

Control de puerta
La apertura y el cierre de la puerta de hardware (puerta HW) y la puerta de software (puerta
SW) definen el intervalo temporal en el que se capturan las señales de contaje.
El control de la puerta HW se realiza de forma externa a través de una entrada digital del
módulo digital. La puerta HW se puede activar con la parametrización. El control de la puerta
SW se realiza a través del programa de usuario. Encontrará una descripción de la interfaz de
control y respuesta en el manual de producto del módulo digital.

Comportamiento en los límites de contaje
Rebase de un límite de contaje
El límite superior se rebasa por exceso cuando el valor de contaje actual coincide con el límite
superior y se produce un nuevo impulso de contaje en sentido ascendente. El límite inferior de
contaje se rebasa por exceso si el valor de contaje actual coincide con el límite inferior de
contaje y se produce un nuevo impulso de contaje en sentido descendente.
En los módulos digitales para ET 200SP y ET 200AL se activa el bit de evento correspondiente
en la interfaz de respuesta en caso de rebase por exceso. Un bit de evento se desactiva con
el bit de control correspondiente:

76

Límite de contaje rebasado

Bit de evento

Bit de desactivación

Límite superior de contaje

EVENT_OFLW

RES_EVENT_OFLW

Límite inferior de contaje

EVENT_UFLW

RES_EVENT_UFLW

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
Encontrará una descripción de la interfaz de control y respuesta en el manual de producto del
módulo digital.
Para el rebase por exceso de un límite de contaje puede parametrizar si se sigue contando en
el otro límite de contaje.
Nota
El límite superior y el valor inicial definen el rango del contador:
Rango del contador = (límite superior ‒ valor inicial) + 1

Ejemplos
La siguiente figura muestra un ejemplo de finalización del proceso de contaje tras un rebase
por exceso y el establecimiento del contador al otro límite de contaje:
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGHDUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

7LHPSR

La siguiente figura muestra un ejemplo de continuación del proceso de contaje tras un rebase
por exceso y el establecimiento del contador al otro límite de contaje:
9DORUGHFRQWDMH
/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGHDUUDQTXH
/¯PLWHLQIHULRUGH
FRQWDMH

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

$SHUWXUDGH
SXHUWD

&LHUUHGH
SXHUWD

7LHPSR

77

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Control de puerta
Muchas aplicaciones requieren que el contaje comience o se detenga en función de otros
eventos. El contaje se inicia o se detiene por medio de la función de puerta.
Por cada canal de contaje, los módulos digitales poseen hasta dos puertas, que determinan la
puerta interna resultante:
● Puerta software (puerta SW)
● Puerta hardware (puerta HW)
Nota
La puerta HW no está disponible en todos los módulos digitales.

Puerta SW
La puerta SW del canal se abre y cierra con el bit de control SW_GATE.
Nota
Encontrará una descripción de la interfaz de control y respuesta en el manual de producto del
módulo digital.

Puerta HW
La puerta HW es opcional. La puerta HW se abre y cierra mediante señales en la entrada digital
correspondiente.
Nota
Un retardo a la entrada parametrizado retarda la señal de control de la entrada digital.
El estado de una entrada digital DIm se indica mediante el bit de realimentación STS_DIm
correspondiente. Encontrará una descripción de la interfaz de control y respuesta en el manual
de producto del módulo digital.

Apertura y cierre de la puerta HW
La siguiente figura muestra un ejemplo de apertura y cierre con una entrada digital:
9DORUGHFRQWDMH
&2817B9$/8(
,PSXOVRVGHFRQWDMH
',P DSHUWXUDGHSXHUWD
FLHUUHGHSXHUWD

78

















$SHUWXUDGHSXHUWD









&LHUUHGHSXHUWD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Mientras la entrada digital está activa, la puerta HW está abierta y se cuentan los impulsos de
contaje. Si la entrada digital se desactiva, la puerta HW se cierra. Los impulsos de contaje se
ignoran y el valor de contaje se mantiene constante.

Puerta interna
Puerta interna
La puerta interna está abierta cuando la puerta SW está abierta y la puerta HW está abierta o
no se ha parametrizado. El estado de la puerta interna se indica mediante el bit de respuesta
STS_GATE. Encontrará una descripción de la interfaz de control y respuesta en el manual de
producto del módulo digital.
Cuando la puerta interna está abierta, se inicia el contaje. Cuando la puerta interna está
cerrada, el resto de los impulsos de contaje se ignoran y el contaje se detiene.
La puerta SW debe estar abierta para controlar un proceso de contaje solo con la puerta HW.
Si no se parametriza ninguna puerta HW, se considerará que está siempre abierta. En ese
caso, la puerta interna debe abrirse y cerrarse únicamente mediante la puerta SW.
Puerta hardware

Puerta software

Puerta interna

Abierta/no parametrizada

Abierta

Abierta

Abierta/no parametrizada

Cerrada

Cerrada

Cerrada

Abierta

Cerrada

Cerrada

Cerrada

Cerrada

Además, la puerta interna puede cerrarse automáticamente al rebasar por exceso un valor de
contaje. Para continuar el contaje es necesario que se cierre y se vuelva a abrir la puerta
software o la puerta hardware.

Valores de referencia
Dependiendo del módulo pueden definirse hasta dos valores de referencia que controlan un bit
de respuesta del canal, independientemente del programa de usuario.
Con dos valores de referencia, el valor de referencia 1 debe ser mayor que el valor de
referencia 0. Los valores de referencia son parametrizables y pueden modificarse durante el
funcionamiento a través del programa de usuario.
Los valores de referencia se comparan con el valor de contaje actual. Cuando el valor de
contaje cumple con la condición de comparación parametrizada, se activa el bit de respuesta
STS_DQ correspondiente.
Es posible emplear el bit de respuesta correspondiente para conmutar una salida digital de un
módulo de salidas digitales. Es posible hacer que la activación del bit de respuesta STS_DQ
correspondiente dependa de uno de los eventos de comparación siguientes. En el manual de
producto del módulo digital puede consultar qué eventos de comparación pueden
parametrizarse.

Ajuste entre el valor de referencia y el límite superior de contaje
El bit de respuesta STS_DQ correspondiente se pone a 1 si:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

79

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Valor de referencia <= valor de contaje <= límite superior de contaje
9DORUGHFRQWDMH

/¯PLWHVXSHULRUGHFRQWDMH
9DORUGHUHIHUHQFLD
/¯PLWHLQIHULRUGHFRQWDMH

W

676B'4

W

Ajuste entre el valor de referencia y el límite inferior de contaje
El bit de respuesta STS_DQ correspondiente se pone a 1 si:
Límite inferior de contaje <= valor de contaje <= valor de referencia
9DORUGHFRQWDMH

/¯PLWHVXSHULRUGHFRQWDMH
9DORUGHUHIHUHQFLD
/¯PLWHLQIHULRUGHFRQWDMH

W

676B'4

W

Ajuste entre los valores de referencia 0 y 1
El bit de respuesta STS_DQ correspondiente se pone a 1 si:
Valor de referencia 0 <= valor de contaje <= valor de referencia 1

80

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
9DORUGHFRQWDMH

9DORUGHUHIHUHQFLD
9DORUGHUHIHUHQFLD
/¯PLWHLQIHULRUGHFRQWDMH

W

676B'4
W

Sin ajuste entre los valores de referencia 0 y 1
El bit de respuesta STS_DQ correspondiente se pone a 1 si:
Valor de referencia 0 <= valor de contaje <= valor de referencia 1
9DORUGHFRQWDMH

9DORUGHUHIHUHQFLD
9DORUGHUHIHUHQFLD


W

676B'4
W

Alarmas
Alarma de proceso
Con determinados eventos, los módulos pueden disparar una alarma de proceso en la CPU
durante el funcionamiento. Las alarmas de proceso se habilitan a través de la parametrización.
Consulte el manual de producto del módulo para obtener información sobre qué eventos
pueden disparar una alarma de proceso durante el funcionamiento.
Nota
Las alarmas de proceso para el contaje no están disponibles en todos los módulos.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

81

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Señales de contaje de 24 V
Señales de contaje de generadores de impulsos de 24 V
Un encóder, por ejemplo un detector de proximidad (BERO) o una fotocélula, proporciona una
señal de contaje que se conecta a la conexión de un contador. En algunos módulos se puede
modificar el sentido de contaje mediante la parametrización de la función DI.
La siguiente figura muestra un ejemplo del cronograma de las señales de un encóder de
impulsos de 24 V con señal de sentido y los impulsos de contaje resultantes:
6H³DOGHFRQWDMH

6H³DOGH
VHQWLGR

DVFHQGHQWH

GHVFHQGHQWH

,PSXOVRVGHFRQWDMH
DVFHQGHQWH
,PSXOVRVGHFRQWDMH
GHVFHQGHQWH

Nota
La señal para detectar el sentido no se puede conectar en todos los módulos digitales.

Modo isócrono
El módulo digital soporta la función de sistema "Modo isócrono". Esta función de sistema
permite capturar valores de contaje en un determinado ciclo del sistema.
En el modo isócrono, el ciclo del programa de usuario, la transferencia de los datos de entrada
y salida y el procesamiento en el módulo se sincronizan entre sí.

Procesamiento de los datos
Los datos transferidos al módulo en el ciclo de bus actual a través de la interfaz de control se
hacen efectivos al editarlos en el marco del ciclo interno del módulo. En el instante Ti se leen
el valor de contaje y los bits de estado, y se preparan en la interfaz de respuesta para la
recogida en el ciclo de bus actual.

Más información
Encontrará una descripción detallada del modo isócrono en los siguientes documentos:
● En el manual de funciones Modo isócrono, disponible para descarga en Internet (https://
support.industry.siemens.com/cs/ww/es/view/109755401)
● En el manual de funciones PROFINET con STEP 7, disponible para descarga en Internet
(https://support.industry.siemens.com/cs/ww/es/view/49948856).

82

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

1.1.1.5

Principios básicos de contaje (SIMATIC Drive Controller)

Sinopsis de las aplicaciones posibles
Introducción
Las E/S tecnológicas X142 del SIMATIC Drive Controller se configuran y parametrizan con el
software de configuración STEP 7. El contador de eventos y la medición de la duración del
periodo se evalúan mediante la interfaz de respuesta de las E/S tecnológicas X142 en los
datos I/O.
Nota
Encontrará una descripción de la interfaz de control y respuesta en el manual de sistema del
SIMATIC Drive Controller (https://support.industry.siemens.com/cs/ww/es/view/109766665).

Entorno del sistema
Los SIMATIC Drive Controller pueden utilizarse en el siguiente entorno de sistema:

1

Aplicaciones posibles

Componentes necesarios

Solución de automatización
basada en transmisión con
SIMATIC Drive Controller

● SIMATIC Drive Controller
● Componentes de
accionamiento
SINAMICS S120 (etapa
de potencia...)

1

Software de configuración

En el programa de usuario

STEP 7 y SINAMICS S120
Startdrive (TIA Portal):

Acceso directo a la interfaz
de control y respuesta de las
E/S tecnológicas X142

1

Configuración del dispositivo
y ajuste de parámetros (Pági‐
na 189)

Necesario para E/S tecnológicas X142

Contador de eventos
Se pueden utilizar hasta 8 canales de las E/S tecnológicas X142 para tareas de contaje.
Con el contador de eventos (valor de 16 bits) se puede medir, a través de la interfaz de
respuesta, el número de flancos ascendentes por cada ciclo de aplicación.
El contador de eventos es un contador en anillo.
● Los rebases por exceso del contador de eventos no se indican.
● El valor exacto debe calcularse a partir de la diferencia.

Sentido de contaje
Se cuenta siempre hacia delante.

Medición del periodo
Se pueden utilizar hasta 8 canales de las E/S tecnológicas X142 para una medición del periodo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

83

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Con la medición del periodo (valor de 32 bits) se puede medir, a través de la interfaz de
respuesta, el número de incrementos de 41,67 ns entre los dos últimos flancos ascendentes
recibidos en el ciclo de aplicación.
Duración del periodo = 41,67 ns × número de incrementos

Modo isócrono
La medición de duración del periodo/evento requiere el modo isócrono.
Para más información al respecto, consulte el manual de sistema del SIMATIC Drive Controller
(https://support.industry.siemens.com/cs/ww/es/view/109766665).

1.1.2

Utilizar el objeto tecnológico High_Speed_Counter

1.1.2.1

Convención
Módulo tecnológico: en este capítulo, la designación "módulo tecnológico" se utiliza tanto para
los módulos tecnológicos TM Count y TM PosInput como para el componente tecnológico de
las CPU compactas.

1.1.2.2

Objeto tecnológico High_Speed_Counter
STEP 7 (TIA Portal) ofrece soporte para la configuración, puesta en marcha y diagnóstico de
las funciones de contaje y medición de los módulos tecnológicos mediante la función "Objetos
tecnológicos":
● En STEP 7 (TIA Portal), configure el objeto tecnológico High_Speed_Counter con los
ajustes para las funciones de contaje y medición.
● En el programa de usuario, programe la respectiva instrucción High_Speed_Counter. Esta
instrucción aplica la alimentación de la interfaz de control y respuesta del módulo
tecnológico.
El objeto tecnológico High_Speed_Counter corresponde al DB de instancia de la instrucción
High_Speed_Counter. La configuración de las funciones de contaje y medición se guarda en
el objeto tecnológico. El objeto tecnológico se encuentra en la carpeta "PLC > Objetos
tecnológicos".
El objeto tecnológico High_Speed_Counter puede utilizarse igualmente para los módulos
tecnológicos de los sistemas S7-1500 y ET 200SP .

Modo de funcionamiento
Para poder parametrizar un módulo tecnológico con el objeto tecnológico, en la configuración
hardware del módulo tecnológico debe especificarse el modo de operación (Página 138)
"Funcionamiento con objeto tecnológico 'Contaje y medición'". Esta opción ya está
preajustada.

84

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

1.1.2.3

Sinopsis de los pasos de configuración

Introducción
La siguiente sinopsis muestra el procedimiento básico de configuración de las funciones de
contaje y medición del módulo tecnológico a través del objeto tecnológico
High_Speed_Counter.

Requisitos (TM Count y TM PosInput)
Para utilizar el objeto tecnológico High_Speed_Counter, en STEP 7 (TIA Portal) debe haberse
creado un proyecto con una CPU S7-1500 o una CPU ET 200SP.

Requisitos (CPU compacta)
Para utilizar el objeto tecnológico High_Speed_Counter, en STEP 7 (TIA Portal) debe haberse
creado un proyecto con una CPU compacta S7-1500.

Procedimiento
Siga el orden que se recomienda a continuación:

1.1.2.4

Paso

Descripción

1

Configurar módulo tecnológico (Página 133)

2

Agregar objeto tecnológico (Página 85)

3

Configurar módulo tecnológico conforme a su aplicación (Página 87)

4

Llamar la instrucción en el programa de usuario (Página 107)

5

Carga en la CPU

6

Puesta en servicio del objeto tecnológico (Página 108)

7

Diagnóstico del objeto tecnológico (Página 109)

Agregar objeto tecnológico

Agregar un objeto tecnológico en el árbol del proyecto
Al agregar un objeto tecnológico, se genera un DB de instancia de la instrucción para este
objeto tecnológico. En él se guarda la configuración del objeto tecnológico.

Requisitos (TM Count y TM PosInput)
Hay un proyecto creado con una CPU S7-1500.

Requisitos (CPU compacta)
Hay un proyecto creado con una CPU compacta S7-1500.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

85

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Procedimiento
Para agregar un objeto tecnológico, proceda del siguiente modo:
1. Abra la carpeta de la CPU en el árbol del proyecto.
2. Abra la carpeta "Objetos tecnológicos".
3. Haga doble clic en "Agregar objeto".
Se abre el cuadro de diálogo "Agregar objeto".
4. Seleccione la tecnología "Contaje y medición".
5. Seleccione el objeto "High_Speed_Counter".
6. En el campo de entrada "Nombre" introduzca un nombre personalizado para el objeto
tecnológico.
7. Haga clic en "Más información" para guardar información propia sobre el objeto tecnológico.
8. Confirme con "Aceptar".

Resultado
El nuevo objeto tecnológico se genera y se guarda en la carpeta "Objetos tecnológicos" del
árbol del proyecto.

①

Objeto

Descripción

Configuración (Pá‐
gina 87)

En el cuadro de diálogo de configuración:
● Asignación del módulo tecnológico y del canal
● Ajuste del parámetro del objeto tecnológico para las
funciones de contaje y medición

86

Si modifica la configuración del objeto tecnológico, a con‐
tinuación deberá cargar en la CPU el objeto tecnológico y
la configuración hardware.

②

Puesta en servicio
(Página 108)

③

Puesta en servicio y prueba funcional del objeto tecnológi‐
co:
Simulación de parámetros de la instrucción
High_Speed_Counter y observación de sus efectos

Diagnóstico (Pági‐
na 109)

Vigilancia de las funciones de contaje y medida

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

1.1.2.5

Configuración de High_Speed_Counter

Trabajando con el diálogo de configuración
Las propiedades del objeto tecnológico se configuran en la ventana de configuración. Para
abrir la ventana de configuración del objeto tecnológico, proceda del siguiente modo:
1. Abra la carpeta "Objetos tecnológicos" en el árbol del proyecto.
2. Abra el objeto tecnológico en el árbol del proyecto.
3. Haga doble clic en el objeto "Configuración".
La configuración se divide en las siguientes categorías:
● Parámetros básicos
Los parámetros básicos contienen la selección del módulo tecnológico y el número del
canal de contaje para el que se configura el objeto tecnológico.
● Parámetros avanzados
Los parámetros avanzados contienen los parámetros para adaptar las funciones de contaje
y medición y ajustar el comportamiento de las entradas y salidas digitales.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

87

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Símbolos de la ventana de configuración
Los símbolos que aparecen en la navegación local de la configuración muestran más detalles
sobre el estado de la configuración:
La configuración contiene valores predeterminados y está completa.
La configuración contiene exclusivamente valores predeterminados. Con ellos es posible utilizar el objeto tecnológico
sin más modificaciones.
La configuración contiene valores definidos por el usuario o adaptados automáticamente y está completa
Todos los campos de entrada de la configuración contienen valores válidos y al menos un valor predeterminado ha sido
modificado.
La configuración es errónea o está incompleta
Al menos un campo de entrada o una lista desplegable contiene un valor no válido. El campo o la lista desplegable en
cuestión se marca en rojo. Al hacer clic, el roll out con el aviso de error indica la causa del error.

88

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Parámetros básicos
"Parámetros básicos" permite establecer la conexión entre el objeto tecnológico
High_Speed_Counter y el módulo tecnológico.

Módulo (TM Count y TM PosInput)
Seleccione el módulo tecnológico en el diálogo siguiente. Se pueden seleccionar todos los
módulos tecnológicos (centralizados o descentralizados) configurados en la CPU S7-1500 o
en la CPU ET 200SP para el uso de un objeto tecnológico de "contaje y medición".
Tras la selección del módulo tecnológico, puede abrir la configuración del dispositivo
correspondiente al módulo tecnológico haciendo clic en el botón "Configuración del
dispositivo".
El ajuste de parámetros del módulo tecnológico necesario para utilizar el objeto tecnológico se
realiza a través de "Parámetros avanzados" del objeto tecnológico.

Módulo (CPU compacta)
Seleccione un contador rápido de la CPU compacta en el diálogo siguiente. Están disponibles
todos los contadores rápidos que están activados y configurados para el uso con un objeto
tecnológico de "contaje y medición".
Tras seleccionar el contador rápido se puede abrir la configuración del dispositivo
correspondiente a la CPU compacta haciendo clic en el botón "Configuración de dispositivos".
El ajuste de parámetros del contador rápido necesario que es para poder utilizar el objeto
tecnológico se realiza en "Parámetros avanzados" del objeto tecnológico.

Canal
En el caso de un módulo tecnológico con varios canales de contaje, seleccione también el
número del canal de contaje para el que se aplicará el objeto tecnológico
High_Speed_Counter.
Nota
Un canal puede asignarse a un único objeto tecnológico. Una vez asignado a un objeto
tecnológico, el canal ya no se puede seleccionar.

Calibración de los valores de parámetro
Si tras asignar el canal al objeto tecnológico existe una incoherencia entre los valores de los
parámetros en el diálogo de propiedades y en el objeto tecnológico, se muestra un botón con
una pregunta de seguridad al respecto. Al hacer clic en este botón, se sobrescriben los valores
de los parámetros en el diálogo de propiedades de STEP 7 (TIA Portal) con los valores de los
parámetros del objeto tecnológico. Los valores de parámetros actuales del objeto tecnológico
se muestran en el diálogo de propiedades (solo lectura).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

89

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Entradas de contaje (High_Speed_Counter)
Tipo de señal
Puede escoger entre los siguientes tipos de señal (Página 63):
Símbolo

Tipo de señal

Significado

Otros parámetros específi‐
cos de la opción

Encóder incremental (A, B
desfasadas)

Hay conectado un encóder incremental con
las señales desfasadas A y B.

● Evaluación de señal
● Invertir sentido
● Frecuencia de filtrado
● Tipo de sensor o
Estándar de interfaz

Encóder incremental
(A, B, N)

Hay conectado un encóder incremental con
las señales A y B desfasadas entre sí, así
como con la señal nula N.

● Evaluación de señal
● Invertir sentido
● Frecuencia de filtrado
● Tipo de sensor o
Estándar de interfaz
● Comportamiento con
señal N
● Frecuencia de la
sincronización
● Frecuencia de la función
Capture

Impulso (A) y sentido (B)

Hay conectado un encóder de impulsos (se‐
ñal A) con señal de sentido (señal B).

● Frecuencia de filtrado
● Tipo de sensor o
Estándar de interfaz

Impulso (A)

Hay conectado un encóder de impulsos (se‐ ● Frecuencia de filtrado
ñal A) sin señal de sentido. El sentido de con‐ ● Tipo de sensor o
taje puede especificarse a través de la inter‐
Estándar de interfaz
faz de control (Página 175).

Contaje ascendente (A),
contaje descendente (B)

Hay conectadas señales para el contaje en
sentido ascendente (señal A) y sentido des‐
cendente (señal B).

● Frecuencia de filtrado
● Tipo de sensor o
Estándar de interfaz

Invertir sentido
Es posible invertir el sentido de contaje para adaptarlo al proceso.
La inversión del sentido puede parametrizarse y es efectiva con los siguientes tipos de señal:
● Encóder incremental (A, B desfasadas)
● Encóder incremental (A, B, N)

90

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Evaluación de señal
Con el parámetro Evaluación de señal (Página 67) se establece qué flancos de las señales se
contarán.
Puede escoger entre las siguientes opciones:
Símbolo

Evaluación de señal Significado
Simple (Página 67)
(predeterminado)

Se evalúan los flancos de la señal A durante un nivel bajo de
la señal B.

Doble (Página 68)

Se evalúan todos los flancos de la señal A.

Cuádruple (Pági‐
na 68)

Se evalúan todos los flancos de las señales A y B.

El parámetro puede parametrizarse con los siguientes tipos de señal:
● Encóder incremental (A, B desfasadas)
● Encóder incremental (A, B, N)

Frecuencia de filtrado
Al parametrizar la frecuencia de filtrado se suprimen las interferencias en las entradas de
contaje A, B y N.
La frecuencia de filtrado seleccionada se refiere a una relación de impulso/pausa comprendida
entre aprox. 40:60 y aprox. 60:40. De ello resulta una determinada duración mínima de impulso
y pausa. Los cambios de señal con una duración menor que la duración mínima de impulso/
pausa se suprimen.
Puede escoger entre las siguientes frecuencias de filtrado:
Frecuencia de filtrado

Duración mínima de impulso y pausa

100 Hz

4,0 ms

200 Hz

2,0 ms

500 Hz

800 µs

1 kHz

400 µs

2 kHz

200 µs

5 kHz

80 µs

10 kHz

40 µs

20 kHz

20 µs

50 kHz

8,0 µs

100 kHz (predeterminado en CPU compacta)

4,0 µs

200 kHz** (predeterminado en TM Count)

2,0 µs

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

91

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Frecuencia de filtrado

Duración mínima de impulso y pausa

500 kHz*

0,8 µs

1 MHz* (predeterminado en TM PosInput)

0,4 µs

* Solo disponible en TM PosInput
* Solo disponible en TM Count y TM PosInput

Tipo de sensor (TM Count)
Al parametrizar el tipo de sensor se define para TM Count el modo de conmutación de las
entradas de contaje.
Puede escoger entre las siguientes opciones:
Tipo de sensor

Significado

Sensor tipo PNP
(predeterminado)

El encóder o sensor conmuta las entradas A, B y N a 24VDC.

Sensor tipo NPN

El encóder o sensor conmuta las entradas A, B y N a M.

Push-pull (tipo NPN y PNP)

El encóder o sensor conmuta las entradas A, B y N alternati‐
vamente a M y 24VDC.

Al utilizar encóders incrementales, la selección típica es "Push-pull". Cuando se utilizan
sensores de 2 hilos, p. ej. barreras fotoeléctricas o detectores de proximidad, se debe
seleccionar el cableado "Sensor tipo PNP" o "Sensor tipo NPN" según corresponda.
Para saber si el encóder incremental es de tipo push/pull, consulte la hoja de datos del encóder.
Nota
Si utiliza un sensor tipo push/pull y se ha parametrizado el tipo de sensor "Push-pull (tipo NPN
y PNP)", se puede vigilar si las señales del sensor indican rotura de hilo.

Tipo de sensor (CPU compacta)
Para una CPU compacta se ha ajustado el tipo de sensor "Sensor tipo PNP" y no puede
cambiarse. El encóder o sensor conmuta las entradas A, B y N a 24V DC.
En la CPU compacta es posible utilizar tanto sensores de tipo PNP como tipo push/pull (en
contrafase). Encontrará más información sobre el tipo de sensor en la hoja de datos del sensor.

Estándar de interfaz (TM PosInput)
Con este parámetro puede definir para el TM PosInput si el encóder emite señales simétricas
(RS422) o asimétricas (TTL).

92

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede escoger entre las siguientes opciones:
Estándar de interfaz

Significado

RS422, simétrica
(predeterminada)

El encóder emite señales simétricas conforme al estándar RS422
(Página 65).

TTL (5 V), asimétrico

El encóder emite señales asimétricas de 5 V conforme al estándar
TTL (Página 63).

Nota
El estándar RS422 brinda una mayor inmunidad a perturbaciones que el estándar TTL. Si el
encóder incremental o el generador de impulsos dominan los estándares RS422 y TTL, se
recomienda el estándar RS422.

Comportamiento con señal N
Este parámetro define cuál será la reacción en caso de señal N.
Puede escoger entre las siguientes opciones:
Opción

Significado

Sin reacción en caso de señal N La señal N no afecta al contador.
(predeterminado)
Sincronización en caso de se‐
ñal N (Página 38)

En caso de señal N, el contador se ajusta al valor de inicio.

Capturar con señal N (Pági‐
na 29)

El valor de contaje se guarda en el valor de captura (Capture) en caso
de señal N. El uso de una entrada digital y el uso de la señal N no se
excluyen mutuamente para la función Capture.

Si se selecciona para una entrada digital la función "Habilitar sincro‐
nización con señal N", la sincronización dependerá del nivel detec‐
tado en la entrada digital.

El objeto tecnológico muestra el valor Capture en el parámetro de
salida CapturedValue.

Nota
El comportamiento con señal N solo puede seleccionarse si se ha elegido el tipo de señal
"Encóder incremental (A, B, N)".
Nota
Si se selecciona " Sincronización en caso de señal N", puede elegirse para una entrada digital
(Página 96) la función "Habilitar sincronización con señal N".
Nota
Para High_Speed_Counter a partir de V3.0 se aplica:
"Capturar con señal N" solo puede seleccionarse en el modo de operación "Utilizar valor de
contaje como referencia".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

93

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Frecuencia de la sincronización
Con estos parámetros se define la frecuencia de los siguientes eventos:
● Sincronización en caso de señal N
● Sincronización como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única
(predeterminado)

El contador solo se ajusta con la primera señal N o el primer flanco
parametrizado de la entrada digital.

Periódica

El contador se ajusta con cada señal N o cada flanco parametrizado de
la entrada digital.

Frecuencia de la función Capture
Con estos parámetros se define la frecuencia de los eventos de Capture para las siguientes
funciones:
● Capture con señal N
● Capture como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única

El primer flanco parametrizado en la entrada digital correspondiente o
el primer flanco ascendente de la señal N guarda el valor de contaje
actual en forma de valor de Capture.

Periódica
(ajuste predeterminado)

Cada flanco parametrizado en la entrada digital correspondiente o en
cada flanco ascendente de la señal N guarda el valor de contaje actual
en forma de valor de Capture.

Nota
Este parámetro está disponible para High_Speed_Counter a partir de V3.2.

Comportamiento del contador
Límites de contaje y valor de arranque
Límite de contaje superior
Con la parametrización del límite de contaje superior se limita el rango de contaje. Puede
especificarse un valor hasta 2147483647 (231-1). Debe introducirse un valor que esté por
encima del límite de contaje inferior.
El ajuste predeterminado es "2147483647".

94

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Límite de contaje inferior
Con la parametrización del límite de contaje inferior se limita el rango de contaje. Puede
especificarse un valor hasta -2147483648 (-231). Debe introducirse un valor que esté por
debajo del límite de contaje superior.
El ajuste predeterminado es "-2147483648".

Valor de arranque
Con la parametrización del valor de arranque se establece con qué valor de contaje se
empieza y se continúa ante determinados eventos. Debe introducir un valor igual a los límites
de contaje o comprendido entre ellos.
El ajuste predeterminado es "0".

Más información
Encontrará más información en Comportamiento en los límites de contaje (Página 24)
y Comportamiento del contador ante la apertura de puerta (Página 28).

Comportamiento del contador en los límites y ante la apertura de puerta
Comportamiento al rebasar un límite de contaje
Puede parametrizarse el comportamiento siguiente al rebasar un límite de contaje (Página 24):
Comportamiento

Significado

Parar contaje

Después de rebasar por exceso un límite de con‐
taje, el contaje se cancela y la puerta interna se
cierra. Para reiniciar el contaje debe cerrar y abrir
de nuevo la puerta SW o la puerta HW, en su caso.

Continuar contaje
(predeterminado)

En función del resto de la parametrización, se pro‐
sigue el contaje con el valor de arranque o con el
límite de contaje opuesto en cada caso.

Inicializar al rebasar un límite de contaje
Puede ajustarse el contador a los siguientes valores al rebasar un límite de contaje:
Restablecimiento del valor

Significado

A valor de arranque

El valor de contaje se fija al valor de arranque.

A otro límite de contaje
(predeterminado)

El valor de contaje se fija al límite de contaje
opuesto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

95

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Comportamiento ante apertura de puerta
Puede parametrizarse el siguiente comportamiento ante apertura de puerta (Página 28):
Comportamiento

Significado

Poner a valor de arranque

Al abrirse la puerta, el valor de contaje se ajusta al
valor de arranque.

Continuar con valor actual
(predeterminado)

Al abrirse la puerta se sigue contando desde el
último valor de contaje.

Comportamiento de una DI (High_Speed_Counter)
Ajuste de la función de la DI
Al parametrizar una entrada digital se define la función que dicha entrada digital disparará al
conmutar.
Puede escoger entre las siguientes opciones:
Función de una entrada digital

Significado

Otros parámetros específicos de la
opción

Apertura/cierre de puerta (con‐
trolados por nivel)

El nivel en la correspondiente entrada digital abre y
cierra la puerta HW (Página 27).

● Retardo a la entrada

Apertura de puerta (controlada
por flanco)

El flanco parametrizado en la correspondiente en‐
trada digital abre la puerta HW (Página 27).

● Retardo a la entrada

Cierre de puerta (controlado por
flanco)

El flanco parametrizado en la correspondiente en‐
trada digital cierra la puerta HW (Página 27).

● Retardo a la entrada

Sincronización (Página 34)

El flanco parametrizado en la correspondiente en‐
trada digital pone el contador al valor de inicio.

● Retardo a la entrada

El objeto tecnológico muestra en el parámetro de
salida SyncStatus si se ha llevado a cabo una sin‐
cronización.
Habilitar sincronización con se‐
ñal N

96

● Selección de nivel
● Selección de flanco
● Selección de flanco
● Selección de flanco
● Frecuencia de la sincronización

El nivel activo en la respectiva entrada digital habi‐ ● Retardo a la entrada
lita la sincronización del contador en caso de se‐
● Selección de nivel
ñal N (Página 38).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Función de una entrada digital

Significado

Otros parámetros específicos de la
opción

Capture

El flanco parametrizado en la respectiva entrada
digital guarda el valor de contaje actual (Página 29)
como valor Capture. El uso de una entrada digital y
el uso de la señal N no se excluyen mutuamente
para la función Capture.

● Retardo a la entrada

El objeto tecnológico muestra el valor Capture en el
parámetro de salida CapturedValue.

● Comportamiento del valor de
contaje tras Capture

Entrada digital sin función

● Selección de flanco
● Frecuencia de la función
Capture

La respectiva entrada digital no tiene asignada nin‐ ● Retardo a la entrada
guna función tecnológica.
El estado de señal de la entrada digital puede leer‐
se a través de la respectiva variable estática del
objeto tecnológico:
● UserStatusFlags.StatusDI0
● UserStatusFlags.StatusDI1
● UserStatusFlags.StatusDI2

Nota
Toda función, excepto "Entrada digital sin función", solo puede utilizarse una vez por contador
y ya no puede volver a seleccionarse en el resto de las entradas digitales.
Nota
Para High_Speed_Counter a partir de V3.0 se aplica:
La función "Capture" solo puede seleccionarse en el modo de operación "Utilizar valor de
contaje como referencia".

Retardo a la entrada (TM Count y TM PosInput)
Con este parámetro se suprimen las interferencias de señal en las entradas digitales. Los
cambios de señal solo se capturan si permanecen estables durante más tiempo que el retardo
a la entrada parametrizado.
Puede escoger entre los siguientes retardos a la entrada:
● Ninguno
● 0,05 ms
● 0,1 ms (predeterminado)
● 0,4 ms
● 0,8 ms
● 1,6 ms
● 3,2 ms
● 12,8 ms
● 20 ms

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

97

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
Si selecciona la opción "Ninguno" o "0,05 ms", deberá utilizar cables apantallados para la
conexión de las entradas digitales.
Nota
El retardo a la entrada se parametriza en "Comportamiento DI0" para todas las entradas
digitales en conjunto. El retardo a la entrada se muestra adicionalmente en "Comportamiento
DI1" y con TM Count también en "Comportamiento DI2".

Retardo a la entrada (CPU compacta)
Con este parámetro se suprimen las interferencias en las entradas digitales de las señales. Los
cambios de señal solo se capturan si permanecen estables durante más tiempo que el retardo
a la entrada parametrizado.
El retardo a la entrada para una entrada digital de una CPU compacta se parametriza en la
ventana de inspección de la configuración de dispositivos, en "Propiedades > DI 16/DQ 16 >
Entradas > Canal n".
Puede escoger entre los siguientes retardos a la entrada:
● Ninguno
● 0,05 ms
● 0,1 ms
● 0,4 ms
● 1,6 ms
● 3,2 ms (predeterminado)
● 12,8 ms
● 20 ms
Nota
Si selecciona la opción "Ninguno" o "0,05 ms", deberá utilizar cables apantallados para la
conexión de las entradas digitales.

Selección de nivel
Con este parámetro se determina el nivel con el que se activa la entrada digital.

98

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede escoger entre las siguientes opciones:
Nivel

Significado

Activa con nivel alto
(predeterminado)

La respectiva entrada digital está activa cuando está activado.

Activa con nivel bajo

La respectiva entrada digital está activa cuando está desactiva‐
do.

El parámetro puede parametrizarse con las siguientes funciones de una entrada digital:
● Apertura/cierre de puerta (controlados por nivel)
● Habilitar sincronización con señal N

Selección de flanco
Este parámetro determina con qué flanco de una entrada digital se dispara la función
parametrizada.
Dependiendo de la función seleccionada, puede elegir entre las siguientes opciones:
● Con flanco ascendente (predeterminado)
● Con flanco descendente
● Con flanco ascendente y descendente
El parámetro puede parametrizarse con las siguientes funciones de una entrada digital:
● Apertura de puerta (controlada por flanco)
● Cierre de puerta (controlado por flanco)
● Sincronización
● Capture
Nota
"Con flanco ascendente y descendente" solo puede parametrizarse para la función "Capture".

Frecuencia de la sincronización
Con estos parámetros se define la frecuencia de los siguientes eventos:
● Sincronización en caso de señal N
● Sincronización como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única
(predeterminado)

El contador solo se ajusta con la primera señal N o el primer flanco
parametrizado de la entrada digital.

Periódica

El contador se ajusta con cada señal N o cada flanco parametrizado de
la entrada digital.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

99

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Frecuencia de la función Capture
Con estos parámetros se define la frecuencia de los eventos de Capture para las siguientes
funciones:
● Capture con señal N
● Capture como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única

El primer flanco parametrizado en la entrada digital correspondiente o
el primer flanco ascendente de la señal N guarda el valor de contaje
actual en forma de valor de Capture.

Periódica
(ajuste predeterminado)

Cada flanco parametrizado en la entrada digital correspondiente o en
cada flanco ascendente de la señal N guarda el valor de contaje actual
en forma de valor de Capture.

Nota
Este parámetro está disponible para High_Speed_Counter a partir de V3.2.

Comportamiento del valor de contaje tras Capture
Puede parametrizarse el siguiente comportamiento del contador tras un evento Capture
(Página 29):
Comportamiento

Significado

Continuar contaje
(predeterminado)

El proceso de contaje continúa sin cambios después de guar‐
darse el valor de contaje actual como valor de Capture.

Poner al valor inicial y seguir contan‐ El proceso de contaje continúa con el valor inicial tras guardarse
do
el valor de contaje actual como valor de captura (Capture).

Comportamiento de una DQ (High_Speed_Counter)
Modo de operación (High_Speed_Counter V3.0 o superior)
Con el modo de operación se establece con qué valor trabajan las funciones de comparación.
Modo de operación

Significado

Utilizar valor de contaje como refe‐
rencia
(predeterminado)

Las funciones de comparación y las alarmas de proceso para
eventos de comparación trabajan con el valor de contaje.
Esta funcionalidad equivale a la funcionalidad del
High_Speed_Counter en las versiones anteriores a la V3.0.

Utilizar el valor medido como referen‐ Las funciones de comparación y las alarmas de proceso para
cia
eventos de comparación trabajan con el valor medido.

100

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
El modo de operación se parametriza en "Comportamiento DQ0" para las dos salidas digitales
en conjunto. El modo de operación también se muestra en "Comportamiento DQ1".

Activar salida
Al parametrizar una salida digital se define la condición que provocará la conmutación de la
salida digital.
Puede escoger entre las siguientes opciones:
Función de una salida digital (Pági‐
Significado
na 42) en el modo de operación "Uti‐
lizar valor de contaje como referen‐
cia"

Otros parámetros específicos de
la opción

Entre valor de comparación y límite
de contaje superior
(predeterminado)

La respectiva salida digital está activa cuando:
● Valor de comparación 0
valor de comparación <= valor de contaje <= límite
● Valor de comparación 1
de contaje superior
● Histéresis (en incrementos)

Entre valor de comparación y límite
de contaje inferior

La respectiva salida digital está activa cuando:
límite de contaje inferior <= valor de contaje <=
valor de comparación

● Valor de comparación 0

La salida digital DQ1 está activa cuando:
valor de comparación 0 <= valor de contaje <=
valor de comparación 1

● Valor de comparación 0

Entre valor de comparación 0 y 1

Con valor de comparación para una
duración del impulso

● Valor de comparación 1
● Histéresis (en incrementos)
● Valor de comparación 1
● Histéresis (en incrementos)

La respectiva salida digital solo está activa duran‐ ● Valor de comparación 0
te el tiempo y en el sentido parametrizados cuan‐ ● Valor de comparación 1
do el valor de contaje coincide con el valor de
● Sentido de contaje
comparación.
● Duración del impulso
● Histéresis (en incrementos)

Tras comando Set de CPU hasta va‐ Cuando se produce un comando Set de la CPU, la ● Valor de comparación 0
lor referencia
respectiva salida digital está activa hasta que el
● Valor de comparación 1
valor de contaje coincida con el de referencia.
● Sentido de contaje
● Histéresis (en incrementos)
Utilizada por el programa de usuario

La respectiva salida digital puede ser conmutada
por la CPU a través de la interfaz de control (Pá‐
gina 41).

—

Nota
DQ0 de un contador de una CPU compacta
En una CPU compacta, la salida digital DQ0 correspondiente está disponible a través de la
interfaz de respuesta, pero no como salida física.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

101

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Nota
La función "Entre valor de comparación 0 y 1" solamente puede seleccionarse para la salida
digital DQ1, y si se ha seleccionado para la salida digital DQ0 la función "Utilizada por el
programa de usuario".
Nota
Las funciones "Con valor de comparación para una duración del impulso" y "Tras comando Set
de CPU hasta valor de referencia" conmutan la salida digital correspondiente solo cuando el
valor de comparación es alcanzado por un impulso de contaje. Cuando el valor de contaje se
ajusta, p. ej., por medio de la sincronización, la salida digital no se conmuta.

Función de una salida digital (Pági‐ Significado
na 49) en el modo de operación "Uti‐
lizar valor medido como referencia"

Otros parámetros específicos
de la opción

Valor medido >= valor de compara‐
ción
(predeterminado)

La respectiva salida digital está activa cuando el
● Valor de comparación 0
valor medido es mayor o igual que el valor de com‐ ● Valor de comparación 1
paración.

Valor medido <= valor de compara‐
ción

La respectiva salida digital está activa cuando el
● Valor de comparación 0
valor medido es menor o igual que el valor de com‐ ● Valor de comparación 1
paración.

Entre valor de comparación 0 y 1

La salida digital DQ1 está activa cuando:
valor de comparación 0 <= valor medido <= valor
de comparación 1

No comprendido entre valor de com‐ La salida digital DQ1 está activa cuando:
paración 0 y 1
valor de comparación 1 <= valor medido <= valor
de comparación 0

● Valor de comparación 0
● Valor de comparación 1
● Valor de comparación 0
● Valor de comparación 1

Utilizada por el programa de usuario La respectiva salida digital puede ser conmutada —
por la CPU a través de la interfaz de control (Pági‐
na 41).

Nota
Las funciones "Entre valor de comparación 0 y 1" y "No comprendido entre valor de
comparación 0 y 1" solamente pueden seleccionarse para la salida digital DQ1, y si se ha
seleccionado para la salida digital DQ0 la función "Utilizada por el programa de usuario".

Valor de comparación 0 (TM Count y TM PosInput)
Modo de operación "Utilizar valor de contaje como referencia"
Al parametrizar el valor de comparación (Página 42) se determina con qué valor de contaje
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un entero (DINT) mayor o igual que el límite de contaje inferior. Si se utiliza
la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe ser menor
que el valor de comparación 1. El ajuste predeterminado es "0".
Modo de operación "Utilizar valor medido como referencia"

102

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor mínimo es ‒7,922816 x 1028. El ajuste predeterminado es "0.0". La
unidad del valor de comparación depende de la magnitud.

Valor de comparación 0 (CPU compacta)
Modo de operación "Utilizar valor de contaje como referencia"
Al parametrizar el valor de comparación (Página 42) se determina con qué valor de contaje se
activará el bit STS_DQ0 en la interfaz de respuesta de acuerdo con el evento de comparación
seleccionado. En una CPU compacta, la salida digital DQ0 no está disponible como salida
física.
Debe introducirse un entero (DINT) mayor o igual que el límite de contaje inferior. Si se utiliza
la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe ser menor
que el valor de comparación 1. El ajuste predeterminado es "0".
Modo de operación "Utilizar valor medido como referencia"
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
activará el bit STS_DQ0 en la interfaz de respuesta de acuerdo con el evento de comparación
seleccionado. En una CPU compacta, la salida digital DQ0 no está disponible como salida
física.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor mínimo es ‒7,922816 x 1028. El ajuste predeterminado es "0.0". La
unidad del valor de comparación depende de la magnitud.

Valor de comparación 1
Modo de operación "Utilizar valor de contaje como referencia"
Al parametrizar el valor de comparación (Página 42) se determina con qué valor de contaje
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un entero (DINT) menor o igual que el límite superior de contaje. Si se utiliza
la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe ser menor
que el valor de comparación 1. El ajuste predeterminado es "10".
Modo de operación "Utilizar valor medido como referencia"
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor máximo es 7,922816 x 1028. El ajuste predeterminado es "10.0". La
unidad del valor de comparación depende de la magnitud.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

103

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sentido de contaje
Con este parámetro se define para qué sentido de contaje es válida la función seleccionada.
Puede escoger entre las siguientes opciones:
Sentido de contaje

Significado

En ambos sentidos
(predeterminado)

La salida digital correspondiente se compara y se conmuta indepen‐
dientemente del sentido de contaje.

Ascendente

La respectiva salida digital solo se compara y se conmuta cuando el
contador cuenta hacia delante.

Descendente

La respectiva salida digital solo se compara y se conmuta si el con‐
tador cuenta hacia atrás.

El parámetro puede parametrizarse con las siguientes funciones:
● Con valor de comparación para una duración del impulso
● Tras comando Set de CPU hasta valor referencia

Duración del impulso
Al parametrizar la duración de impulso para la función "Con valor de comparación para una
duración del impulso", se determina durante cuántos milisegundos estará activa la salida
digital en cuestión.
Si introduce "0" y el valor de contaje coincide con el respectivo valor de comparación, la salida
digital estará activa hasta el siguiente impulso de contaje.
Se admiten valores entre 0,0 y 6553,5.
El ajuste predeterminado es "500,0" y corresponde a una duración de impulso de 0,5 s.

Histéresis (en incrementos)
Al parametrizar la histéresis (Página 58) se define un rango en torno a los valores de
comparación. En el caso de las funciones "Entre valor de referencia y límite superior" y "Entre
valor de referencia y límite inferior" la histéresis también se aplica en los límites de contaje. En
el rango de histéresis las salidas digitales no pueden conmutar de nuevo hasta que el valor de
contaje haya salido de este rango.
Seleccione una histéresis lo bastante pequeña. Si el rango de histéresis, partiendo del valor de
referencia parametrizado, cubre todo el rango de contaje, no es posible garantizar el correcto
funcionamiento de los valores de referencia.
Si un valor de comparación se encuentra tan próximo a un límite de contaje que el rango de
histéresis sobrepasaría dicho límite de contaje, el rango de histéresis finaliza en este.

104

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si se introduce "0" se desactiva la histéresis. Se admiten valores entre 0 y 255. El ajuste
predeterminado es "0".
Nota
Para High_Speed_Counter a partir de V3.0 se aplica:
La histéresis se parametriza en "Comportamiento DQ0" para las dos salidas digitales en
conjunto. La histéresis también se muestra en "Comportamiento DQ1".
La histéresis solo está disponible en el modo de operación "Utilizar valor de contaje como
referencia".

Especificar valor medido (High_Speed_Counter)
Magnitud
Con este parámetro se define qué magnitud (Página 53) debe suministrar el módulo
tecnológico. El objeto tecnológico muestra el valor medido en el parámetro de salida
MeasuredValue.
Puede escoger entre las siguientes opciones:
Magnitud

Significado

Otros parámetros específicos de la op‐
ción

Frecuencia
(predeterminado)

La magnitud muestra el número de incrementos por se‐
gundo. El valor es un número de coma flotante (REAL). La
unidad es Hz.

● Tiempo de actualización

El objeto tecnológico muestra el valor medido en el pará‐
metro de salida MeasuredValue.
Duración del período La magnitud es la duración media del período entre dos
● Tiempo de actualización
incrementos. El valor es un número entero (DINT). La uni‐
dad es s.
El objeto tecnológico muestra el valor medido en el pará‐
metro de salida MeasuredValue.
Velocidad

La magnitud es una velocidad.

● Tiempo de actualización

Encontrará ejemplos de medición de velocidad en la expli‐ ● Base de tiempo para medición de
cación del parámetro "Incrementos por unidad".
velocidad
El objeto tecnológico muestra el valor medido en el pará‐ ● Incrementos por unidad
metro de salida MeasuredValue.

Tiempo de actualización
Con la parametrización del tiempo de actualización (Página 53) en milisegundos se define el
intervalo de tiempo que transcurre entre dos actualizaciones del valor medido.
El tiempo de actualización y el tipo de señal influyen en la precisión de la medición. Con
tiempos de actualización de al menos 100 ms la influencia del Tipo de señal es insignificante.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

105

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Con tiempos de actualización inferiores a 100 ms se alcanza la máxima precisión de medición
con los siguientes tipos de señales:
● Encóder incremental (A, B desfasado) con Evaluación de señal "Simple"
● Encóder incremental (A, B, N) con Evaluación de señal "Simple"
● Impulso (A) y sentido (B)
● Impulso (A)
En otros tipos de señales la precisión de medición depende del encóder utilizado y de la línea.
Si se introduce "0", el valor medido se actualiza una vez por cada ciclo interno del módulo.
Puede introducir un máximo de tres decimales. Se admiten valores entre 0.0 y 25000.0. El
ajuste predeterminado es "10.0".

Base de tiempo para medición de velocidad
Con este parámetro se define la base de tiempo con la que debe ponerse a disposición la
velocidad.
Puede escoger entre las siguientes opciones:
● 1 ms
● 10 ms
● 100 ms
● 1s
● 60 s
El ajuste predeterminado es "60 s".

Incrementos por unidad
Con este parámetro se define, para la medición de velocidad, el número de impulsos de
contaje que proporciona el encóder incremental o de impulsos por cada unidad relevante.
El número de impulsos de contaje depende de la Evaluación de señal parametrizada. Se
admiten valores entre 1 y 65535.
Ejemplo 1:
El encóder proporciona 4000 impulsos de contaje con un desplazamiento de un metro. La
velocidad debe medirse en metros por segundo. Como Evaluación de señal se ha
parametrizado "doble".
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 8000
● Base de tiempo para medición de velocidad: 1 s
Ejemplo 2:
El encóder entrega 4096 impulsos de contaje por vuelta. La velocidad debe medirse en vueltas
por minuto. Como Evaluación de señal se ha parametrizado "Simple".

106

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 4096
● Base de tiempo para medición de velocidad: 60 s

1.1.2.6

Programación de High_Speed_Counter

Instrucción High_Speed_Counter
High_Speed_Counter
La instrucción High_Speed_Counter corresponde al objeto tecnológico High_Speed_Counter
y acepta la alimentación de la interfaz de control y realimentación del módulo tecnológico.
La instrucción High_Speed_Counter constituye así la interfaz de software entre el programa de
usuario y el módulo tecnológico. Debe llamarse cíclicamente desde el programa de usuario
para comparar los datos de entrada y salida.
La instrucción High_Speed_Counter puede utilizarse de igual modo para los módulos
tecnológicos de los sistemas S7-1500 y ET 200SP. Los módulos pueden utilizarse de forma
centralizada o descentralizada. La instrucción se aplica al canal del módulo tecnológico al que
se haya asignado el correspondiente objeto tecnológico.

Más información
AUTOHOTSPOT
AUTOHOTSPOT
AUTOHOTSPOT
AUTOHOTSPOT
AUTOHOTSPOT

Llamar la instrucción en el programa de usuario
La instrucción High_Speed_Counter puede llamarse una vez por contador en el ciclo o
alternativamente en un programa controlado por tiempo. No se permite realizar la llamada en
un programa de interrupción controlado por eventos.

Procedimiento
Para llamar a la instrucción en el programa de usuario, proceda del siguiente modo:
1. Abra la carpeta de la CPU en el árbol del proyecto.
2. Abra la carpeta "Bloques de programa".
3. Haga clic en el OB para la ejecución cíclica del programa.
El bloque se abre en el área de trabajo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

107

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
4. En la ventana "Instrucciones" abra el grupo "Tecnología" y la carpeta "Contaje y medición".
La carpeta contiene la instrucción.
5. Seleccione la instrucción, arrástrela al OB y suéltela.
Se abre el cuadro de diálogo "Opciones de llamada".
6. En la lista "Nombre" seleccione un objeto tecnológico o introduzca el nombre del nuevo
objeto tecnológico.
7. Confirme con "OK" (Aceptar).

Resultado
Si el objeto tecnológico no existe todavía, se agregará. La instrucción se agregará en el OB. El
objeto tecnológico está asignado a esta llamada de la instrucción.
Nota
Al hacer clic sobre uno de los botones "Configuración", "Puesta en marcha" o "Diagnóstico" en
la interfaz de la instrucción, se abre el editor correspondiente.

1.1.2.7

Puesta en servicio de High_Speed_Counter

Puesta en servicio del objeto tecnológico
El editor de puesta en marcha, con una representación gráfica del bloque, lo ayudará a poner
en marcha cómodamente el objeto tecnológico y a probar su funcionalidad. En el modo online
de la CPU/del IM se pueden modificar determinados parámetros de la instrucción
SSI_Absolute_Encoder y observar el efecto de los cambios.

Requisitos
● Hay una conexión online entre STEP 7 (TIA Portal) y la CPU.
● La CPU se encuentra en el estado operativo RUN.
● La instrucción High_Speed_Counter correspondiente se ejecuta de modo cíclico desde el
programa de usuario.
● Los parámetros del objeto tecnológico no se sobrescriben del programa de usuario.

Procedimiento
Para abrir el editor de puesta en marcha de un objeto tecnológico y simular una modificación
del valor de los parámetros, haga lo siguiente:
1. Abra la carpeta "Objetos tecnológicos" en el árbol del proyecto.
2. Abra el objeto tecnológico High_Speed_Counter en el árbol del proyecto.
3. Haga doble clic en el objeto "Puesta en servicio".
Se muestran las funciones de puesta en servicio del objeto tecnológico
High_Speed_Counter.

108

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
4. En la parte superior izquierda del diálogo de puesta en marcha, haga clic en el botón
"Observar todo".
Se cargan y se muestran los parámetros (valores online) del objeto tecnológico
High_Speed_Counter.
5. Si el parámetro que desea modificar tiene un campo de entrada, introduzca en él el nuevo
valor.
6. Active la casilla de verificación del parámetro.
El nuevo valor del parámetro surte efecto y se simulan las repercusiones de la modificación.

Modo online
En el modo online se pueden modificar los siguientes parámetros y, de este modo, probar el
funcionamiento del objeto tecnológico:
● Nuevo valor de contaje (NewCountValue)
● Nuevo límite de contaje superior (NewUpperLimit)
● Nuevo límite de contaje inferior (NewLowerLimit)
● Nuevo valor de referencia 0 (NewReferenceValue0 o bien NewReferenceValue0_M)
● Nuevo valor de referencia 1 (NewReferenceValue1 o bien NewReferenceValue1_M)
● Nuevo valor de arranque (NewStartValue)
● Iniciar y parar contador (SwGate)
● Habilitar Capture (CaptureEnable)
● Habilitar sincronización (SyncEnable)
● Confirmación de los estados de error notificados (ErrorAck)
● Restablecimiento de flags de estado (EventAck)

1.1.2.8

Diagnóstico de High_Speed_Counter

Observación de valores de contaje, valores medidos, DI y DQ
Con las funciones de diagnóstico se vigilan las funciones de contaje y medida.

Requisitos
● Hay una conexión online entre STEP 7 (TIA Portal) y la CPU.
● La CPU se encuentra en el estado operativo RUN.

Procedimiento
Para abrir el editor de visualización de las funciones de diagnóstico, haga lo siguiente:
1. Abra la carpeta "Objetos tecnológicos" en el árbol del proyecto.
2. Abra el objeto tecnológico High_Speed_Counter en el árbol del proyecto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

109

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
3. Haga doble clic en el objeto "Diagnóstico".
4. Haga clic en el botón "Observar todos".

Indicador
El objeto tecnológico lee de la interfaz de respuesta y muestra los siguientes valores:
● Indicación de eventos/información de diagnóstico
● Estados lógicos de las entradas digitales y las salidas digitales
● Valor de contaje
● Valor Capture
● Valor medido
Encontrará más información acerca de la indicación de estados en la ayuda contextual de cada
evento en STEP 7 (TIA Portal). Si la CPU está en STOP, no se actualiza la indicación de
estado.

110

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

1.1.3

Utilizar el objeto tecnológico SSI_Absolute_Encoder

1.1.3.1

Objeto tecnológico SSI_Absolute_Encoder
Mediante la función "Objetos tecnológicos", STEP 7 (TIA Portal) facilita la configuración,
puesta en marcha y diagnóstico de las funciones de lectura de posición y medida para el
módulo tecnológico TM PosInput en combinación con encóders absolutos SSI:
● En STEP 7 (TIA Portal) se configura el objeto tecnológico SSI_Absolute_Encoder
introduciendo los parámetros de encóder.
● En el programa de usuario, programe la respectiva instrucción SSI_Absolute_Encoder.
Esta instrucción aplica la alimentación de la interfaz de control y respuesta del módulo
tecnológico.
El objeto tecnológico SSI_Absolute_Encoder corresponde al DB de instancia de la instrucción
SSI_Absolute_Encoder. La configuración de las funciones de lectura de posición y medición se
guarda en el objeto tecnológico. El objeto tecnológico se encuentra en la carpeta "PLC >
Objetos tecnológicos".
El objeto tecnológico SSI_Absolute_Encoder puede utilizarse de igual modo para los
TM PosInput de los sistemas S7-1500 y ET 200SP.

Modo de funcionamiento
Para poder parametrizar TM PosInput con el objeto tecnológico, en la configuración hardware
de TM PosInput debe especificarse el modo de operación (Página 138) "Funcionamiento con
objeto tecnológico 'Contaje y medición'". Esta opción ya está preajustada.

1.1.3.2

Sinopsis de los pasos de configuración

Introducción
La siguiente tabla muestra el procedimiento básico de configuración de las funciones de
lectura de posición y medición del módulo tecnológico mediante el objeto tecnológico
SSI_Absolute_Encoder.

Requisitos
Para utilizar el módulo tecnológico, en STEP 7 (TIA Portal) debe haberse creado un proyecto
con una CPU S7-1500 o una CPU ET 200SP.

Procedimiento
Siga el orden que se recomienda a continuación:
Paso

Descripción

1

Configurar módulo tecnológico (Página 133)

2

Agregar objeto tecnológico (Página 112)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

111

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

1.1.3.3

Paso

Descripción

3

Configurar módulo tecnológico conforme a su aplicación (Página 113)

4

Llamar la instrucción en el programa de usuario (Página 129)

5

Carga en la CPU

6

Puesta en servicio del objeto tecnológico (Página 129)

7

Diagnóstico del objeto tecnológico (Página 130)

Agregar objeto tecnológico

Agregar un objeto tecnológico en el árbol del proyecto
Al agregar un objeto tecnológico, se genera un DB de instancia de la instrucción para este
objeto tecnológico. En él se guarda la configuración del objeto tecnológico.

Requisitos
Hay un proyecto creado con una CPU S7-1500.

Procedimiento
Para agregar un objeto tecnológico, proceda del siguiente modo:
1. Abra la carpeta de la CPU en el árbol del proyecto.
2. Abra la carpeta "Objetos tecnológicos".
3. Haga doble clic en "Agregar objeto".
Se abre el cuadro de diálogo "Agregar objeto".
4. Seleccione la tecnología "Contaje y medición".
5. Seleccione el objeto "SSI_Absolute_Encoder".
6. En el campo de entrada "Nombre" introduzca un nombre personalizado para el objeto
tecnológico.
7. Haga clic en "Más información" para guardar información propia sobre el objeto tecnológico.
8. Confirme con ""OK" (Aceptar).".

Resultado
El nuevo objeto tecnológico se genera y se guarda en la carpeta "Objetos tecnológicos" del
árbol del proyecto.

112

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

①

Objeto

Descripción

Configuración (Pági‐
na 113)

En el cuadro de diálogo de configuración:
● Asignación del módulo tecnológico y del canal
● Ajuste de los parámetros del objeto tecnológico para las
funciones de lectura de posición y medición

1.1.3.4

Si modifica la configuración del objeto tecnológico, a continua‐
ción deberá cargar en la CPU el objeto tecnológico y la configu‐
ración hardware.

②

Puesta en servicio (Pági‐
na 129)

③

Puesta en servicio y prueba funcional del objeto tecnológico:
Simulación de parámetros de la instrucción SSI_Absolute_Enco‐
der y observación de sus efectos

Diagnóstico (Página 130)

Vigilancia de las funciones de lectura de posición y medida

Configurar SSI_Absolute_Encoder

Trabajando con el diálogo de configuración
Las propiedades del objeto tecnológico se configuran en la ventana de configuración. Para
abrir la ventana de configuración del objeto tecnológico, proceda del siguiente modo:
1. Abra la carpeta "Objetos tecnológicos" en el árbol del proyecto.
2. Abra el objeto tecnológico en el árbol del proyecto.
3. Haga doble clic en el objeto "Configuración".
La configuración se divide en las siguientes categorías:
● Parámetros básicos
Los parámetros básicos contienen la selección del módulo tecnológico y el número del
canal para el que se configura el objeto tecnológico.
● Parámetros avanzados
Los parámetros avanzados contienen los parámetros para adaptar las funciones de lectura
de posición y medición y ajustar el comportamiento de las entradas y salidas digitales.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

113

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Símbolos de la ventana de configuración
Los símbolos que aparecen en la navegación local de la configuración muestran más detalles
sobre el estado de la configuración:
La configuración contiene valores predeterminados y está completa.
La configuración contiene exclusivamente valores predeterminados. Con ellos es posible utilizar el objeto tecnológico
sin más modificaciones.
La configuración contiene valores definidos por el usuario o adaptados automáticamente y está completa
Todos los campos de entrada de la configuración contienen valores válidos y al menos un valor predeterminado ha sido
modificado.
La configuración es errónea o está incompleta
Al menos un campo de entrada o una lista desplegable contiene un valor no válido. El campo o la lista desplegable en
cuestión se marca en rojo. Al hacer clic, el roll out con el aviso de error indica la causa del error.

Parámetros básicos
"Parámetros básicos" permite establecer la conexión entre el objeto tecnológico TM PosInput
y el módulo tecnológico.

Módulo
Seleccione el módulo tecnológico en el diálogo siguiente. Se pueden seleccionar todos los
módulos tecnológicos TM PosInput (centralizados o descentralizados) configurados en la CPU
S7-1500 o en la CPU ET 200SP para el uso de un objeto tecnológico de "contaje y medición".
Tras la selección del módulo tecnológico, puede abrir la configuración del dispositivo
correspondiente al módulo tecnológico haciendo clic en el botón "Configuración del
dispositivo".
El ajuste de parámetros del módulo tecnológico necesario para utilizar el objeto tecnológico se
realiza a través de "Parámetros avanzados" del objeto tecnológico.

Canal
En el caso de un módulo tecnológico con varios canales, seleccione el número del canal para
el que se aplicará el objeto tecnológico.
Nota
Un canal puede asignarse a un único objeto tecnológico. Una vez asignado a un objeto
tecnológico, el canal ya no se puede seleccionar.

114

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Calibración de los valores de parámetro
Si tras asignar el canal al objeto tecnológico existe una incoherencia entre los valores de los
parámetros en el diálogo de propiedades del módulo TM PosInput y en el objeto tecnológico,
se muestra un botón con una pregunta de seguridad al respecto. Al hacer clic en este botón,
se sobrescriben los valores de los parámetros en el diálogo de propiedades del módulo
asignado en STEP 7 (TIA Portal) con los valores de los parámetros del objeto tecnológico. Los
valores de parámetros actuales del objeto tecnológico se muestran en el diálogo de
propiedades del módulo (solo lectura).

Encóder absoluto SSI
Longitud de telegrama
Parametrizando la longitud de trama se define el número de bits de una trama SSI del encóder
absoluto SSI (Página 23) utilizado. Para conocer la longitud de trama del encóder absoluto
SSI, consulte la hoja de datos del encóder. Los bits especiales también cuentan para la
longitud de telegrama. Un bit de paridad presente no cuenta en la longitud de telegrama.
Se permite una longitud de telegrama de entre 10 y 40 bits. El ajuste predeterminado es
"13 Bit".
Encontrará dos ejemplos de la estructura de la trama SSI en Ejemplos de estructuras de
telegrama (Página 126).

Tipo de código
Con la parametrización del tipo de código se define si el encóder proporciona códigos binarios
naturales o códigos Gray.
Puede escoger entre las siguientes opciones:
Tipo de código

Significado

Gray
(predeterminado)

El valor de posición emitido en código Gray por el encóder absoluto SSI se con‐
vierte a código binario natural.

Binario

El valor emitido por el encóder absoluto SSI no se convierte.

Velocidad de transferencia
Al parametrizar la velocidad de transferencia se define la velocidad de la transferencia de datos
entre el módulo tecnológico y el encóder absoluto SSI.
Puede escoger entre las siguientes opciones:
● 125 kHz (predeterminado)
● 250 kHz
● 500 kHz
● 1 MHz
● 1,5 MHz
● 2 MHz

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

115

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
La velocidad de transferencia máxima depende de la longitud de línea y de los datos técnicos
del encóder absoluto SSI. Encontrará más información en el manual de producto del
TM PosInput y en la descripción del encóder.

Tiempo monoestable
Al parametrizar el tiempo monoestable se define el tiempo de pausa entre dos telegramas SSI.
El tiempo del flip-flop monoestable parametrizado debe ser como mínimo igual que el tiempo
monoestable del encóder absoluto SSI utilizado. Este valor figura en los datos técnicos del
encóder absoluto SSI.
Puede escoger entre las siguientes opciones:
● Automático (predeterminado)
● 16 µs
● 32 µs
● 48 µs
● 64 µs
Nota
Si se elige la opción "Automático", el tiempo del flip-flop monoestable se ajusta
automáticamente al encóder utilizado.
En modo isócrono, la opción "Automático" corresponde a un tiempo monoestable de 64 µs. Si
el tiempo monoestable del encóder absoluto SSI utilizado es inferior a 64 µs, puede
seleccionarse el valor del encóder para alcanzar tiempos isócronos más rápidos.

Paridad
Al parametrizar la paridad se define si el encóder absoluto SSI transferirá un bit de paridad.
Si, p. ej., un encóder de 25 bits está parametrizado con paridad, el módulo tecnológico lee
26 bits. El objeto tecnológico muestra un error de paridad en el parámetro de salida ErrorID con
el valor 80A2.

Número de bit LSB del valor de posición
Con este parámetro se define el número del bit menos significativo (LSB = Least significant bit)
del valor de posición en el telegrama del encóder absoluto SSI. De este modo se limita el rango
que indica el valor de posición dentro del telegrama.
El valor debe ser inferior al número de bit del MSB del valor de posición. La diferencia entre los
números de bit del MSB y del LSB del valor de posición debe ser inferior a 32.

116

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
El ajuste predeterminado es "0".
Nota
Cuando se ha seleccionado "Gray" como tipo de código, solo se convierte a código binario
natural el rango comprendido entre el LSB y el MSB del valor de posición.

Número de bit MSB del valor de posición
Con este parámetro se define el número del bit más significativo (MSB = Most significant bit)
del valor de posición en el telegrama del encóder absoluto SSI. De este modo se limita el rango
que indica el valor de posición dentro del telegrama.
El valor debe ser inferior a la longitud del telegrama y superior al número de bit del LSB del valor
de posición. La diferencia entre los números de bit del MSB y del LSB del valor de posición
debe ser inferior a 32.
El ajuste predeterminado es "12".
Nota
Cuando se ha seleccionado "Gray" como tipo de código, solo se convierte a código binario
natural el rango comprendido entre el LSB y el MSB del valor de posición.

Invertir sentido
Con este parámetro se invierten los valores entregados por el encóder absoluto SSI. De ese
modo el sentido registrado del encóder puede adaptarse al sentido de giro del motor.
Nota
Dentro del telegrama, este parámetro solamente tiene efecto en el rango comprendido entre
el LSB y el MSB del valor de posición.

Telegrama SSI
Los siguientes parámetros también pueden ajustarse en el gráfico mediante Drag & Drop:
● Longitud de telegrama
● Número de bit LSB del valor de posición
● Número de bit MSB del valor de posición
Telegrama SSI completo

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

117

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si como magnitud se ha seleccionado "Telegrama SSI completo", el módulo devuelve los
32 bits menos significativos del telegrama SSI actual no procesado como valor medido. El
gráfico muestra el significado de cada bit emitido. Se utilizan las siguientes abreviaturas:
V

Value: valor de posición como código Gray o como código binario

S

Special:bit especial

P

Parity: bit de paridad
Si se ha parametrizado un bit de paridad, el módulo devuelve los 31 bits menos significativos del
telegrama SSI y el bit de paridad.

Comportamiento de una DI (SSI_Absolute_Encoder)
Ajuste de la función de la DI
Al parametrizar una entrada digital se define la función que dicha entrada digital disparará al
conmutar.
Puede escoger entre las siguientes opciones:
Función de una entra‐ Significado
da digital

Otros parámetros específicos de
la opción

Capture (Página 32)

● Retardo a la entrada

El flanco parametrizado en la entrada digital correspondiente
guarda el valor de posición actual como valor de Capture. El
objeto tecnológico muestra el valor Capture en el parámetro de
salida CapturedValue.
La función solo puede utilizarse para una de las dos entradas
digitales.

Entrada digital sin fun‐ La respectiva entrada digital no tiene asignada ninguna función
ción
tecnológica.

● Selección de flanco
● Frecuencia de la función
Capture
● Retardo a la entrada

El estado de señal de la entrada digital puede leerse a través de
la respectiva variable estática del objeto tecnológico:
● UserStatusFlags.StatusDI0
● UserStatusFlags.StatusDI1

Nota
La función "Capture" solo puede seleccionarse en el modo de operación "Utilizar el valor de
posición (valor absoluto SSI) como referencia".

Retardo a la entrada
Al parametrizar el retardo a la entrada se suprimen las interferencias en las entradas digitales.
Las señales con una duración de impulso inferior al retardo a la entrada parametrizado se
suprimen.
Puede escoger entre los siguientes retardos a la entrada:
● Ninguno
● 0,05 ms

118

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
● 0,1 ms (predeterminado)
● 0,4 ms
● 0,8 ms
● 1,6 ms
● 3,2 ms
● 12,8 ms
● 20 ms
Nota
Si selecciona la opción "Ninguno" o "0,05 ms", debe utilizar cables apantallados para la
conexión de las entradas digitales.
Nota
El retardo a la entrada se parametriza en "Comportamiento DI0" para todas las entradas
digitales en conjunto. El retardo a la entrada también se muestra en "Comportamiento DI1".

Selección de flanco
Este parámetro determina para la función "Capture" con qué flanco de una entrada digital se
disparará la función parametrizada.
Puede escoger entre las siguientes opciones:
● Con flanco ascendente (predeterminado)
● Con flanco descendente
● Con flanco ascendente y descendente

Frecuencia de la función Capture
Con estos parámetros se define la frecuencia de los siguientes eventos de Capture
(Página 32):
Puede escoger entre las siguientes opciones:
Opción

Significado

Única

El primer flanco parametrizado en la entrada digital correspondiente
guarda el valor de contaje actual como valor de Capture.

Periódica
(ajuste predeterminado)

Cada flanco parametrizado en la entrada digital correspondiente guar‐
da el valor de contaje actual como valor de Capture.

Nota
Este parámetro está disponible para SSI_Absolute_Encoder a partir de V3.0.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

119

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Comportamiento de una DQ (SSI_Absolute_Encoder)
Modo de operación
Con el modo de operación se establece con qué valor de referencia trabajan las funciones de
comparación.
Modo de operación

Significado

Utilizar el valor de posición (valor ab‐ Las funciones de comparación y las alarmas de proceso para
soluto SSI) como referencia
eventos de comparación trabajan con el valor de posición.
(predeterminado)
Utilizar el valor medido como refe‐
rencia

Las funciones de comparación y las alarmas de proceso para
eventos de comparación trabajan con el valor medido.

Nota
El modo de operación se parametriza en "Comportamiento DQ0" para las dos salidas digitales
en conjunto. El modo de operación también se muestra en "Comportamiento DQ1".

Activar salida
Al parametrizar una salida digital se define la condición que provocará la conmutación de la
salida digital.
Dependiendo del modo de operación, puede escoger entre las siguientes opciones:
Función de una salida digital (Pá‐
gina 46) en el modo de operación
"Utilizar el valor de posición (valor
absoluto SSI) como referencia"

Otros parámetros específicos de
la opción

Significado

Entre valor de comparación y lími‐ La respectiva salida digital está activa cuando:
te de contaje superior
valor de comparación <= valor de posición <= valor
de posición máximo
(predeterminado)

● Valor de comparación 0
● Valor de comparación 1
● Histéresis (en incrementos)

Entre valor de comparación y lími‐ La salida digital correspondiente está activa cuando: ● Valor de comparación 0
te de contaje inferior
valor de posición mínimo <= valor de posición <=
● Valor de comparación 1
valor de comparación
● Histéresis (en incrementos)
Entre valor de comparación 0 y 1

La salida digital DQ1 está activa cuando:
● Valor de comparación 0
valor de comparación 0 <= valor de posición <= valor ● Valor de comparación 1
de comparación 1
● Histéresis (en incrementos)

Con valor de comparación para
una duración del impulso

La respectiva salida digital solo está activa durante
el tiempo y en el sentido del cambio de valor de po‐
sición parametrizados cuando el valor de posición
coincide con el valor de comparación o cuando lo ha
rebasado por exceso o por defecto.

● Valor de comparación 0
● Valor de comparación 1
● Sentido de contaje
● Duración del impulso
● Histéresis (en incrementos)

120

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Función de una salida digital (Pá‐
gina 46) en el modo de operación
"Utilizar el valor de posición (valor
absoluto SSI) como referencia"

Significado

Otros parámetros específicos de
la opción

Tras comando Set de CPU hasta
valor referencia

Cuando se produce un comando Set de la CPU, la
salida digital correspondiente está activa para el
sentido parametrizado del cambio de valor de posi‐
ción hasta que el valor de posición coincida con el de
referencia o hasta que lo haya rebasado por exceso
o por defecto.

● Valor de comparación 0
● Valor de comparación 1
● Sentido de contaje
● Histéresis (en incrementos)

Utilizada por el programa de usua‐ La respectiva salida digital puede ser conmutada por —
rio
la CPU a través de la interfaz de control (Página 41).

Nota
La función "Entre valor de comparación 0 y 1" solamente puede seleccionarse para la salida
digital DQ1, y si se ha seleccionado para la salida digital DQ0 la función "Utilizada por el
programa de usuario".

Función de una salida digital (Pá‐ Significado
gina 49) en el modo de operación
"Utilizar valor medido como refe‐
rencia"

Otros parámetros específicos
de la opción

Valor medido >= valor de compa‐ La respectiva salida digital está activa cuando el valor ● Valor de comparación 0
ración
medido es mayor o igual que el valor de comparación. ● Valor de comparación 1
(predeterminado)
Valor medido <= valor de compa‐ La respectiva salida digital está activa cuando el valor ● Valor de comparación 0
ración
medido es menor o igual que el valor de comparación. ● Valor de comparación 1
Entre valor de comparación 0 y 1 La salida digital DQ1 está activa cuando:
valor de comparación 0 <= valor medido <= valor de
comparación 1
No comprendido entre valor de
comparación 0 y 1

La salida digital DQ1 está activa cuando:
valor de comparación 1 <= valor medido <= valor de
comparación 0

Utilizada por el programa de usua‐ La respectiva salida digital puede ser conmutada por
rio
la CPU a través de la interfaz de control (Página 41).

● Valor de comparación 0
● Valor de comparación 1
● Valor de comparación 0
● Valor de comparación 1
—

Nota
Las funciones "Entre valor de comparación 0 y 1" y "No comprendido entre valor de
comparación 0 y 1" solamente pueden seleccionarse para la salida digital DQ1, y si se ha
seleccionado para la salida digital DQ0 la función "Utilizada por el programa de usuario".

Valor de comparación 0
Modo de operación "Utilizar el valor de posición (valor absoluto SSI) como referencia"
Al parametrizar el valor de comparación (Página 46) se determina con qué valor de posición se
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

121

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si se utiliza un encóder absoluto SSI con una longitud del valor de posición de hasta 31 bits,
debe introducirse un entero positivo (DINT) con un valor entre 0 y 2(MSB-LSB+1)-1. Si se utiliza un
encóder absoluto SSI con una longitud del valor de posición de 32 bits, debe introducirse un
entero (DINT) con signo con un valor entre –2147483648 y 2147483647.
Si se utiliza la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe
ser menor que el valor de comparación 1. El ajuste predeterminado es "0".
Modo de operación "Utilizar valor medido como referencia"
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor mínimo es ‒7,922816 x 1028. El ajuste predeterminado es "0.0". La
unidad del valor de comparación depende de la magnitud.

Valor de comparación 1
Modo de operación "Utilizar el valor de posición (valor absoluto SSI) como referencia"
Al parametrizar el valor de comparación (Página 46) se determina con qué valor de posición se
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.
Si se utiliza un encóder absoluto SSI con una longitud del valor de posición de hasta 31 bits,
debe introducirse un entero positivo (DINT) con un valor entre 0 y 2(MSB-LSB+1)-1. Si se utiliza un
encóder absoluto SSI con una longitud del valor de posición de 32 bits, debe introducirse un
entero (DINT) con signo con un valor entre –2147483648 y 2147483647.
Si se utiliza la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe
ser menor que el valor de comparación 1. El ajuste predeterminado es "10".
Modo de operación "Utilizar valor medido como referencia"
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor máximo es 7,922816 x 1028. El ajuste predeterminado es "10.0". La
unidad del valor de comparación depende de la magnitud.

Sentido de contaje
Con este parámetro se define para qué sentido del cambio del valor de posición es válida la
función seleccionada.

122

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede escoger entre las siguientes opciones:
Sentido del cambio del valor de
posición

Significado

En ambos sentidos
(predeterminado)

La comparación y la conmutación de la salida digital correspon‐
diente tienen lugar independientemente de que el valor de posición
aumente o disminuya.

Ascendente

La respectiva salida digital solo se compara y se conmuta cuando
el valor de posición aumenta.

Descendente

La respectiva salida digital solo se compara y se conmuta cuando
el valor de posición disminuye.

El parámetro puede parametrizarse con las siguientes funciones:
● Con valor de comparación para una duración del impulso
● Tras comando Set de CPU hasta valor referencia

Duración del impulso
Al parametrizar la duración de impulso para la función "Con valor de comparación para una
duración del impulso", se determina durante cuántos milisegundos estará activa la respectiva
salida digital.
Se admiten valores entre 0,1 y 6553,5 ms.
El ajuste predeterminado es "500,0" y corresponde a una duración de impulso de 0,5 s.

Histéresis (en incrementos)
Al parametrizar la histéresis (Página 60) se define un rango en torno a los valores de
comparación. En el caso de las funciones "Entre valor de referencia y límite superior" y "Entre
valor de referencia y límite inferior" la histéresis también se aplica en los límites de contaje. En
el rango de histéresis las salidas digitales no pueden conmutar de nuevo hasta que el valor de
posición haya salido una vez de este rango.
Seleccione una histéresis lo bastante pequeña. Si el rango de histéresis, partiendo del valor de
referencia parametrizado, cubre todo el rango de valores de posición, no es posible garantizar
el correcto funcionamiento de los valores de referencia.
Si un valor de referencia se encuentra tan próximo a un límite de contaje que el rango de
histéresis sobrepasaría dicho límite de contaje, el rango de histéresis finaliza en este.
Si se introduce "0" se desactiva la histéresis. Se admiten valores entre 0 y 255. El ajuste
predeterminado es "0".
Nota
La histéresis se parametriza en "Comportamiento DQ0" para las dos salidas digitales en
conjunto. La histéresis también se muestra en "Comportamiento DQ1".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

123

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Nota
La histéresis solo está disponible en el modo de operación "Utilizar el valor de posición (valor
absoluto SSI) como referencia".

Especificar valor medido (SSI_Absolute_Encoder)
Magnitud
Con este parámetro se especifica si el módulo tecnológico debe suministrar una magnitud
(Página 56) determinada o el telegrama SSI completo.
Puede escoger entre las siguientes opciones:
Opción

Significado

Otros parámetros específicos
de la opción

Frecuencia
(predeterminado)

La magnitud muestra el número de incrementos por segundo, de
manera que cada incremento corresponde a una variación del
valor de posición. El valor es un número de coma flotante (REAL).
La unidad es Hz.

● Tiempo de actualización

El objeto tecnológico muestra el valor medido en el parámetro de
salida MeasuredValue.
Duración del período La magnitud es la duración media del período entre dos incre‐
● Tiempo de actualización
mentos del valor de posición. El valor es un número entero (DINT).
La unidad es s.
El objeto tecnológico muestra el valor medido en el parámetro de
salida MeasuredValue.
Velocidad

La magnitud es una velocidad.

● Tiempo de actualización

Encontrará ejemplos de medición de velocidad en la explicación
del parámetro "Incrementos por unidad".

● Base de tiempo para
medición de velocidad

El objeto tecnológico muestra el valor medido en el parámetro de
salida MeasuredValue.
Telegrama SSI com‐
pleto

● Incrementos por unidad

En lugar de una magnitud, se devuelven los primeros 32 bits del —
telegrama SSI (bits 0 a 31). También se suministran bits especia‐
les que no pertenecen a la información de posición. No se tiene en
cuenta una inversión del sentido parametrizada.
El objeto tecnológico muestra el valor en el parámetro de salida
CompleteSSIFrame.
Encontrará ejemplos en Ejemplos de estructuras de telegrama
(Página 126). Esta opción solo está disponible en el modo de
operación "Utilizar el valor de posición (valor absoluto SSI) como
referencia".

124

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
Si para calcular el valor medido se necesita el incremento por vuelta, este se calcula
automáticamente como segunda potencia a partir de la longitud de telegrama parametrizada,
p. ej., 8192 incrementos por vuelta para una longitud de telegrama de 13 bits. Si se utiliza un
encóder absoluto SSI cuyo incremento por vuelta no equivale a la segunda potencia, puede ser
que el valor medido calculado resulte erróneo durante un breve lapso de tiempo.

Tiempo de actualización
Con la parametrización del tiempo de actualización (Página 56) en milisegundos se define el
intervalo de tiempo que transcurre entre dos actualizaciones del valor medido. Con tiempos de
actualización mayores se pueden suavizar magnitudes inestables.
Si se introduce "0", el valor medido se actualiza una vez por cada ciclo interno del módulo.
Puede introducir un máximo de tres decimales. Se admiten valores entre 0.0 y 25000.0. El
ajuste predeterminado es "10.0".

Base de tiempo para medición de velocidad
Con este parámetro se define la base de tiempo con la que debe ponerse a disposición la
velocidad.
Puede escoger entre las siguientes opciones:
● 1 ms
● 10 ms
● 100 ms
● 1s
● 60 s
El ajuste predeterminado es "60 s".

Incrementos por unidad
Con este parámetro se define, para la medición de velocidad, el número de incrementos que
proporciona el encóder absoluto SSI por cada unidad relevante.
Se admiten valores entre 1 y 65535.
Ejemplo 1:
Su encóder funciona con una resolución de 12 bits por vuelta y emite 4096 incrementos por
vuelta. La velocidad debe medirse en vueltas por minuto.
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 4096
● Base de tiempo para medición de velocidad: 60 s
Ejemplo 2:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

125

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
El encóder proporciona 10000 incrementos con un desplazamiento de un metro. La velocidad
debe medirse en metros por segundo.
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 10000
● Base de tiempo para medición de velocidad: 1 s

Ejemplos de estructuras de telegrama
Ejemplo 1
En este ejemplo, el encóder absoluto SSI tiene la siguiente especificación:
● El encóder tiene una resolución de 13 bits por vuelta y un rango de valores de 4096 vueltas
(12 bits). El telegrama SSI tiene una longitud de 25 bits.
● El MSB del valor de posición es el bit 24.
● El LSB del valor de posición es el bit 0.
● El valor de posición tiene codificación Gray.
● No existe un bit de paridad.
El telegrama presenta la siguiente estructura:
&LFOR
%LW

                        
                        
0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6*

06%

/6%

9DORUGHSRVLFLµQ
MG

Bit Multiturn con codificación Gray

SG

Bit Singleturn con codificación Gray

Telegrama SSI completo
Si se parametriza "Telegrama SSI completo", el módulo tecnológico devuelve el telegrama SSI
sin procesar justificado a la derecha en la interfaz de realimentación:
&LFOR
%LW

                               
                              

       0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6*

MG

Bit Multiturn con codificación Gray

SG

Bit Singleturn con codificación Gray

Valor de realimentación del valor de posición
El módulo tecnológico convierte el valor de posición suministrado en codificación Gray a
código binario y lo devuelve justificado a la derecha en la interfaz de realimentación:

126

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
&LFOR
%LW

                               
                              

       0' 0' 0' 0' 0' 0' 0' 0' 0' 0' 0' 0' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6'

MD

Bit Multiturn como código binario

SD

Bit Singleturn como código binario

Ejemplo 2
En este ejemplo, el encóder absoluto SSI tiene la siguiente especificación:
● El encóder tiene una resolución de 17 bits por vuelta y un rango de valores de 2048 vueltas
(11 bits). El telegrama SSI tiene una longitud de 34 bits.
● El MSB del valor de posición es el bit 33.
● El LSB del valor de posición es el bit 6.
● El valor de posición tiene codificación Gray.
● El telegrama SSI tiene seis bits especiales.
● Existe un bit de paridad. El bit de paridad no cuenta en la longitud de telegrama.
El telegrama presenta la siguiente estructura:
&LFOR
%LW

                                  
                             
   
0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 0* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6 6 3 6 6 6 6

06%

/6%

9DORUGHSRVLFLµQ
MG

Bit Multiturn con codificación Gray

SG

Bit Singleturn con codificación Gray

Sn

Bit especial n

P

Bit de paridad

Telegrama SSI completo
Si se parametriza "Telegrama SSI completo", el módulo tecnológico devuelve los 32 bits
menos significativos del telegrama SSI como secuencia de bits no procesada. El módulo
tecnológico devuelve el bit que sigue al LSB como bit de paridad. Por ello, en este ejemplo el
módulo tecnológico solamente proporciona los 31 bits menos significativos del telegrama SSI.
Con el telegrama SSI completo es posible evaluar en la aplicación los bits especiales
adicionales.
La secuencia de bits devuelta presenta la siguiente estructura:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

127

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
&LFOR
%LW

                               

                              
0* 0* 0* 0* 0* 0* 0* 0* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 6* 3 6 6 6 6 6 6

MG

Bit Multiturn con codificación Gray

SG

Bit Singleturn con codificación Gray

Sn

Bit especial n

P

Bit de paridad

Valor de posición
El módulo tecnológico convierte el valor de posición suministrado en codificación Gray a
código binario natural y lo devuelve justificado a la derecha en la interfaz de realimentación.
Los bits especiales se ignoran. El bit de paridad se evalúa pero no se devuelve con el valor de
posición:
&LFOR
%LW

                               

                              
    0' 0' 0' 0' 0' 0' 0' 0' 0' 0' 0' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6' 6'

MD

Bit Multiturn como código binario

SD

Bit Singleturn como código binario

1.1.3.5

Programar SSI_Absolute_Encoder

Instrucción SSI_Absolute_Encoder
SSI_Absolute_Encoder
La instrucción SSI_Absolute_Encoder pertenece al objeto tecnológico SSI_Absolute_Encoder
y se encarga de la alimentación de la interfaz de control y respuesta del módulo tecnológico
TM PosInput.
La instrucción SSI_Absolute_Encoder constituye así la interfaz de software entre el programa
de usuario y el módulo tecnológico. Debe llamarse cíclicamente desde el programa de usuario
para comparar los datos de entrada y salida.
La instrucción SSI_Absolute_Encoder puede utilizarse de igual modo para los TM PosInput de
los sistemas S7-1500 y ET 200SP. Los módulos TM PosInput pueden utilizarse de forma
centralizada o descentralizada. La instrucción se aplica al canal del módulo tecnológico al que
se haya asignado el correspondiente objeto tecnológico.

Más información
AUTOHOTSPOT
AUTOHOTSPOT
AUTOHOTSPOT
AUTOHOTSPOT

128

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
AUTOHOTSPOT

Llamar la instrucción en el programa de usuario
La instrucción SSI_Absolute_Encoder puede llamarse una vez por canal en el ciclo o en un
programa controlado por tiempo. No se permite realizar la llamada en un programa de
interrupción controlado por eventos.

Procedimiento
Para llamar a la instrucción en el programa de usuario, proceda del siguiente modo:
1. Abra la carpeta de la CPU en el árbol del proyecto.
2. Abra la carpeta "Bloques de programa".
3. Haga clic en el OB para la ejecución cíclica del programa.
El bloque se abre en el área de trabajo.
4. En la ventana "Instrucciones" abra el grupo "Tecnología" y la carpeta "Contaje y medición".
La carpeta contiene la instrucción.
5. Seleccione la instrucción, arrástrela al OB y suéltela.
Se abre el cuadro de diálogo "Opciones de llamada".
6. En la lista "Nombre" seleccione un objeto tecnológico o introduzca el nombre del nuevo
objeto tecnológico.
7. Confirme con "OK" (Aceptar).

Resultado
Si el objeto tecnológico no existe todavía, se agregará. La instrucción se agregará en el OB. El
objeto tecnológico está asignado a esta llamada de la instrucción.
Nota
Al hacer clic sobre uno de los botones "Configuración", "Puesta en marcha" o "Diagnóstico" en
la interfaz de la instrucción, se abre el editor correspondiente.

1.1.3.6

Poner en marcha SSI_Absolute_Encoder

Puesta en servicio del objeto tecnológico
El editor de puesta en marcha, con una representación gráfica del bloque, lo ayudará a poner
en marcha cómodamente el objeto tecnológico y a probar su funcionalidad. En el modo online
de la CPU/del IM se pueden modificar determinados parámetros de la instrucción
SSI_Absolute_Encoder y observar el efecto de los cambios.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

129

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Requisitos
● Hay una conexión online entre STEP 7 (TIA Portal) y la CPU.
● La CPU se encuentra en el estado operativo RUN.
● La instrucción High_Speed_Counter correspondiente se ejecuta de modo cíclico desde el
programa de usuario.
● Los parámetros del objeto tecnológico no se sobrescriben del programa de usuario.

Procedimiento
Para abrir el editor de puesta en marcha de un objeto tecnológico y simular una modificación
del valor de los parámetros, haga lo siguiente:
1. Abra la carpeta "Objetos tecnológicos" en el árbol del proyecto.
2. Abra el objeto tecnológico SSI_Absolute_Encoder en el árbol del proyecto.
3. Haga doble clic en el objeto "Puesta en marcha".
Se muestran las funciones de puesta en marcha del objeto tecnológico
SSI_Absolute_Encoder.
4. En la parte superior izquierda del diálogo de puesta en marcha, haga clic en el botón
"Observar todo".
Se cargan y se muestran los parámetros (valores online) del objeto tecnológico
SSI_Absolute_Encoder.
5. Si el parámetro que desea modificar tiene un campo de entrada, introduzca en él el nuevo
valor.
6. Active la casilla de verificación del parámetro.
El nuevo valor del parámetro surte efecto y se simulan las repercusiones de la modificación.

Modo online
En el modo online se pueden modificar los siguientes parámetros y, de este modo, probar el
funcionamiento del objeto tecnológico:
● Nuevo valor de referencia 0 (NewReferenceValue0 o bien NewReferenceValue0_M)
● Nuevo valor de referencia 1 (NewReferenceValue1 o bien NewReferenceValue1_M)
● Habilitar Capture (CaptureEnable)
● Confirmación de los estados de error notificados (ErrorAck)
● Restablecimiento de flags de estado (EventAck)

1.1.3.7

Diagnóstico SSI_Absolute_Encoder

Observación de valores de contaje, valores medidos, DI y DQ
Con las funciones de diagnóstico se vigilan las funciones de lectura de posición y medida.

130

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Requisitos
● Hay una conexión online entre STEP 7 (TIA Portal) y la CPU.
● La CPU se encuentra en el estado operativo RUN.

Procedimiento
Para abrir el editor de visualización de las funciones de diagnóstico, haga lo siguiente:
1. Abra la carpeta "Objetos tecnológicos" en el árbol del proyecto.
2. Abra el objeto tecnológico SSI_Absolute_Encoder en el árbol del proyecto.
3. Haga doble clic en el objeto "Diagnóstico".
4. Haga clic en el botón "Observar todos".

Indicador
El objeto tecnológico lee de la interfaz de respuesta y muestra los siguientes valores:
● Indicación de eventos/información de diagnóstico
● Estados lógicos de las entradas digitales y las salidas digitales
● Valor de posición
● Valor Capture
● Valor medido
Encontrará más información acerca de la indicación de estados en la ayuda contextual de cada
evento en STEP 7 (TIA Portal). Si la CPU está en STOP, no se actualiza la indicación de
estado.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

131

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

1.1.4

Utilizar el módulo

1.1.4.1

Utilización del módulo tecnológico

Convención
Módulo tecnológico: en este capítulo, la designación "módulo tecnológico" se utiliza tanto para
los módulos tecnológicos TM Count y TM PosInput como para el componente tecnológico de
las CPU compactas.

132

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Configuración del módulo
Agregar un módulo tecnológico a la configuración hardware (TM Count y TM PosInput)
Requisitos
● Se ha creado el proyecto.
● Se ha creado la CPU S7‑1500.
● En operación descentralizada se ha creado una periferia descentralizada ET 200.

Procedimiento
Para agregar un objeto tecnológico a la configuración hardware, proceda del siguiente modo:
1. Abra la configuración de dispositivo de la CPU o el IM.
2. Seleccione un rack.
3. Seleccione el módulo tecnológico en el catálogo de módulos:
"Módulos tecnológicos > Contaje o Lectura de recorrido > Módulo tecnológico > Referencia"
4. Coloque el módulo tecnológico arrastrándolo al slot deseado del rack y soltándolo.

Agregar un módulo tecnológico a la configuración hardware (CPU compacta)
Requisitos
Se ha creado el proyecto.

Procedimiento
Para agregar una CPU compacta al árbol del proyecto, proceda del siguiente modo:
1. Haga doble clic en "Agregar dispositivo".
Se abre el cuadro de diálogo "Agregar objeto".
2. Elija "Controladores".
3. Seleccione la CPU compacta:
"SIMATIC S7‑1500 > CPU > CPU compacta > Referencia"
4. Confirme con "Aceptar".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

133

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Resultado
La nueva CPU compacta aparece en el árbol del proyecto con los siguientes objetos: Haga
doble clic para pasar al editor deseado.

①

Objeto

Descripción

Configuración de dis‐
positivos (Página 136)

En la ventana de inspección (por canal):
● Activación del contador (Página 147)
● Asignación de señales a entradas y salidas (Página 147)
● Ajuste de la reacción a STOP de la CPU (Página 136)
● Habilitación de alarmas de diagnóstico (Página 138)
● Ajuste del modo de operación (Página 138)
● Habilitación de alarmas de proceso (Página 144)

②

● Ajuste de las direcciones del módulo
Online y diagnóstico
(Página 174)

● Diagnóstico de hardware
● Obtener información sobre la CPU compacta
● Actualización del firmware

Acceso a la configuración hardware
Procedimiento
1. Abra la configuración de dispositivo de la CPU o el IM.
2. Seleccione la vista de dispositivos.
3. Haga clic en el módulo.

134

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Posibilidades de la parametrización
Contaje, medición y lectura de posición con encóder absoluto SSI
En el caso de las funciones de contaje y medición y de lectura de posición con un encóder
absoluto SSI, tiene las siguientes alternativas para parametrizar y controlar el módulo
tecnológico:
● Configuración de un objeto tecnológico y control por medio de la instrucción
correspondiente:
Si se utiliza un encóder incremental o de impulsos, se recomienda la configuración cómoda
y asistida por gráficos con el objeto tecnológico High_Speed_Counter. Encontrará una
descripción detallada de esta configuración a partir del apartado Objeto tecnológico
High_Speed_Counter.
Si se utiliza un encóder absoluto SSI, se recomienda la configuración cómoda y asistida por
gráficos con el objeto tecnológico SSI_Absolute_Encoder. Encontrará una descripción
detallada de esta configuración a partir del apartado Objeto tecnológico
SSI_Absolute_Encoder.
Para configurar un objeto tecnológico, seleccione el modo de operación (Página 138)
"Funcionamiento con objeto tecnológico 'Contaje y medición'".
● Ajuste de parámetros mediante configuración hardware y control mediante la interfaz de
control y respuesta del módulo tecnológico:
Para ello seleccione el modo de operación (Página 138) "Funcionamiento manual (sin
objeto tecnológico)".
Encontrará una descripción de la interfaz de control y respuesta para TM Count y
TM PosInput en los siguientes apartados:
Asignación de la interfaz de control (Página 175)
Asignación de la interfaz de realimentación (Página 177)
● Ajuste de parámetros mediante archivo GSD y control mediante la interfaz de control y
respuesta del módulo tecnológico:
Encontrará una descripción de la interfaz de control y respuesta para TM Count y
TM PosInput en los siguientes apartados:
Asignación de la interfaz de control (Página 175)
Asignación de la interfaz de realimentación (Página 177)

Lectura de posición para Motion Control
Como alternativa, se puede utilizar el módulo tecnológico para la lectura de posición para
Motion Control.
Para ello seleccione el modo de operación (Página 138) "Lectura de posición para el objeto
tecnológico 'Motion Control'" y realice la parametrización del encóder con los parámetros del
módulo (Página 140) en la configuración de dispositivos del módulo tecnológico. El resto de la
configuración de esta aplicación se lleva a cabo a través de un objeto tecnológico de eje de
S7-1500 Motion Control .

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

135

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Parámetros básicos
Reacción a STOP de la CPU
Reacción a STOP de la CPU
La reacción del módulo tecnológico en caso de STOP de la CPU se ajusta para cada canal en
los parámetros básicos de la configuración del equipo.
Opción

Significado

Continuar

El módulo tecnológico sigue operando con plena funcionalidad. Se
procesan los impulsos de contaje entrantes o se lee la posición real.
Las salidas digitales continúan conmutándose con arreglo a la pa‐
rametrización.

Aplicar valor sustitutivo

Hasta la siguiente transición de STOP a RUN de la CPU, el módulo
tecnológico emite en las salidas digitales los valores de sustitución
parametrizados.
Después de una transición de STOP a RUN, el módulo tecnológico
pasa a su estado de arranque: el valor de contaje se ajusta al valor
de arranque (con encóders incrementales o generadores de impul‐
sos) y las salidas digitales se conmutan según la parametrización.

Mantener último valor

Hasta la siguiente transición de STOP a RUN de la CPU, el módulo
tecnológico emite en las salidas digitales los valores que eran váli‐
dos en el momento de la transición a STOP.
Si una salida digital con la función "Con valor de referencia por du‐
ración de impulso" está activada en STOP de la CPU, dicha salida
digital se desactivará al transcurrir la duración del impulso.
Después de una transición de STOP a RUN, el módulo tecnológico
pasa a su estado de arranque: el valor de contaje se ajusta al valor
de arranque (con encóders incrementales o generadores de impul‐
sos) y las salidas digitales se conmutan según la parametrización.

Valor sustitutivo de DQ0 (TM Count y TM PosInput)
Con este parámetro se define el valor que debe emitir el módulo tecnológico en caso de STOP
de la CPU en la salida digital DQ0 para el comportamiento "Aplicar valor sustitutivo".
Nota
En el modo de operación "Funcionamiento con objeto tecnológico 'Contaje y medición'", este
parámetro se define con el objeto tecnológico.

Valor sustitutivo de DQ0 (CPU compacta)

136

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Con este parámetro se define para el comportamiento "Aplicar valor sustitutivo" el valor que se
emitirá en la interfaz de respuesta para DQ0 en caso de STOP de la CPU compacta.
Nota
En el modo de operación "Funcionamiento con objeto tecnológico 'Contaje y medición'", este
parámetro se define con el objeto tecnológico.

Valor sustitutivo de DQ1
Con este parámetro se define el valor que debe emitir el módulo tecnológico en caso de STOP
de la CPU en la salida digital DQ1 para el comportamiento "Aplicar valor sustitutivo".
Nota
En el modo de operación "Funcionamiento con objeto tecnológico 'Contaje y medición'", este
parámetro se define con el objeto tecnológico.

Alarmas de diagnóstico (TM Count y TM PosInput)
El módulo tecnológico puede disparar alarmas de diagnóstico adicionales si se activa la
habilitación de las alarmas de diagnóstico en los parámetros básicos. Las alarmas de
diagnóstico se procesan en un OB de alarma.
Encontrará información detallada sobre el evento de error en el bloque de organización de
error con la instrucción "RALRM" (leer información adicional de alarma) y en el Manual de
funciones Diagnóstico (https://support.industry.siemens.com/cs/ww/es/view/59192926), en el
capítulo "Diagnóstico de sistema mediante el programa de usuario".
Habilitar alarma de diagnóstico para rotura de hilo
Este parámetro permite especificar para los siguientes sensores y encóders si se disparará
una alarma de diagnóstico en caso de rotura de hilo en las señales utilizadas:
● Sensores tipo push/pull de 24 V (Página 63)
● Sensores RS422 (Página 65) (también con vigilancia de cortocircuitos y de errores en la
tensión de alimentación)
● Encóders absolutos SSI (Página 66) (también con vigilancia de cortocircuitos o de errores
en la tensión de alimentación)
Nota
Si utiliza un encóder con otro tipo de sensor o estándar de interfaz, no puede detectarse una
rotura de hilo.

Habilitar otras alarmas de diagnóstico

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

137

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Este parámetro define si se disparan alarmas de diagnóstico con otros errores.
Infórmese con el manual de producto del módulo tecnológico sobre los errores que pueden
disparar una alarma de diagnóstico durante el funcionamiento.

Alarmas de diagnóstico (CPU compacta)
Habilitar alarmas de diagnóstico
Una CPU compacta puede disparar alarmas de diagnóstico con determinados errores si se
activa la habilitación de las alarmas de diagnóstico. Las alarmas de diagnóstico se procesan
en un OB de alarma.
Con este parámetro se determina si la CPU compacta dispara alarmas de diagnóstico al
producirse el error en cuestión.
Consulte en el manual de producto de la CPU compacta los errores o fallos que pueden
disparar una alarma de diagnóstico durante el funcionamiento. Las alarmas de diagnóstico no
están habilitadas de forma predeterminada.

Modo de funcionamiento
Selección del modo para el canal
Con este ajuste se define cómo debe llevarse a cabo la parametrización y el control de las
funciones de contaje y medida del canal.
Modo de funcionamiento

Descripción

Funcionamiento con objeto
tecnológico "Contaje y medi‐
ción"

La parametrización del canal tiene lugar a través de un objeto tecno‐
lógico.
El acceso a la interfaz de control y respuesta del módulo tecnológico
se realiza con la instrucción correspondiente para el objeto tecnológi‐
co en el programa de usuario.
El emparejamiento de módulo tecnológico/canal y objeto tecnológico
se define en los parámetros básicos del objeto tecnológico.

Lectura de posición para el ob‐ El módulo tecnológico es utilizado para la lectura de posición por un
jeto tecnológico "Motion Con‐ controlador Motion Control de nivel superior. En TM Count y TM Po‐
trol"
sInput este modo de operación es efectivo en todos los canales del
módulo tecnológico. En una CPU compacta, el ajuste del modo de
operación es efectivo en el canal en cuestión.
La parametrización se efectúa a través de la configuración de equipo
del módulo tecnológico. La parametrización de las señales del encó‐
der se realiza por medio de los parámetros del módulo (Página 140).

138

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Modo de funcionamiento

Descripción

Funcionamiento manual (sin
objeto tecnológico)

La parametrización del canal se lleva a cabo mediante la configura‐
ción hardware del módulo tecnológico:
● Funcionamiento manual (encóder incremental o generador de
impulsos) (Página 148)
● Funcionamiento manual (encóder absoluto SSI): (Página 164)
Desde el programa de usuario se accede directamente a la interfaz de
control y respuesta del canal.

Fast Mode

El módulo tecnológico sirve para una lectura muy rápida del valor de
contaje o de posición. No se dispone de interfaz de control. La para‐
metrización del canal se lleva a cabo mediante el ajuste de paráme‐
tros (configuración hardware) del módulo. Desde el programa de
usuario se accede directamente a la interfaz de respuesta del canal.
No todos los módulos tecnológicos soportan este modo de operación.

Nota
Archivo GSD
Si se utiliza un archivo GSD, el modo de operación se determina seleccionando el nombre del
módulo en el catálogo de hardware. Se puede seleccionar el modo manual o el modo Fast
Mode.

Selección del modo de operación para el canal
Con el parámetro "Funcionamiento manual" se define para qué tarea principal se utiliza el
canal del módulo tecnológico. Las posibilidades de ajuste de "Parámetros" (configuración
hardware) se adaptan en función de dicha elección.
Modo de operación

Descripción

Contaje (Página 21) / Lectura
de posición (Página 23)

La tarea principal del canal es el contaje o la lectura de posición. Las
funciones de comparación y alarmas de proceso trabajan con el valor
de contaje o de posición. El valor medido está disponible simultánea‐
mente.

Medición (Página 52)

La tarea principal del canal es el contaje. Las funciones de compara‐
ción (Página 49) y las alarmas de proceso para eventos de compara‐
ción trabajan con el valor medido. El valor de contaje está disponible
simultáneamente.

Nota
Archivo GSD
Si se utiliza un archivo GSD, el modo de operación se determina seleccionando el nombre del
módulo en el catálogo de hardware.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

139

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Parámetros del módulo (lectura de posición para Motion Control)
En el modo de operación "Lectura de posición para el objeto tecnológico 'Motion Control'", los
parámetros para las señales de encóder del canal se ajustan en "Parámetros del módulo". Los
parámetros dependen del encóder utilizado.
Nota
No es posible utilizar este modo de operación con un archivo GSD.

Parámetros del módulo para encóders incrementales y generadores de impulsos
Cuando se utiliza un encóder incremental o uno de impulsos, se ajustan los siguientes
parámetros para las señales de encóder del canal.
● Tipo de señal
● Invertir sentido
● Evaluación de señal
● Frecuencia de filtrado
● Tipo de sensor (en TM Count)
● Estándar de interfaz (en TM PosInput)
● Selección de señal para marca de referencia 0
● Entrada de medición
● Tipo de sensor
● Incrementos por vuelta
● Pasos por vuelta
● Velocidad de referencia
● Distancia entre incrementos
● Distancia entre incrementos con resolución fina
● Velocidad de referencia
Encontrará explicaciones sobre los primeros seis parámetros en el apartado Entradas de
contaje (Página 148).
Parámetros del módulo para encóders absolutos SSI
Si utiliza un TM PosInput con un encóder absoluto SSI, ajuste los siguientes parámetros para
las señales de encóder del canal.
● Tipo de señal
● Invertir sentido
● Longitud de telegrama
● Tipo de código

140

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
● Velocidad de transferencia
● Tiempo monoestable
● Paridad
● Número de bit LSB del valor de posición
● Número de bit MSB del valor de posición
● Entrada de medición
● Tipo de sensor
● Pasos por vuelta
● Número de vueltas
● Velocidad de referencia
● Distancia entre incrementos
● Distancia entre incrementos con resolución fina
● Velocidad de referencia
Encontrará explicaciones sobre los primeros nueve parámetros en el apartado Entradas de
contaje (Página 164).
Selección de señal para marca de referencia 0
Con este parámetro se define con qué señal de referencia externa se guarda una nueva marca
de referencia para la posición del encóder.
Puede escoger entre las siguientes opciones:
Opción

Significado

Sin

No se utiliza ninguna señal de referencia externa.

1

DI0
(predeterminado para TM Count y TM PosInput)

Si se produce un flanco ascendente en la entrada
digital DI0, el valor de contaje actual se guarda
como nueva marca de referencia para la posición
del encóder.

Señal N del encóder incremental
(predeterminado para CPU compacta2)

Si se produce un flanco ascendente en la señal N
del encóder incremental, el valor de contaje actual
se guarda como nueva marca de referencia para
la posición del encóder.

1

Solo disponible con CPU compacta

2

Excepciones: "DI0" predeterminado con HSC 3 y HSC 6 en la 1511C y en la 1512C en modo de
compatibilidad

Entrada de medida (TM Count y TM PosInput)
El parámetro indica que la entrada digital de hardware DI1 se utiliza como entrada de detector.
El valor de posición o de contaje actual se guarda como posición de encóder actual con flanco
ascendente, descendente o con ambos flancos de DI1. El valor del parámetro no se puede
modificar.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

141

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Entrada de medición (CPU compacta)
Con este parámetro se determina la entrada de hardware que se utilizará como entrada de
medición externa para guardar la posición del encóder.
Puede escoger entre las siguientes opciones:
Opción

Significado

Ninguna
(ajuste predetermina‐
do)

No se utiliza ninguna entrada de medición externa.

DI1

La entrada digital de hardware DI1 sirve como entrada de detector. El valor de
contaje actual se guarda como posición de encóder actual con flanco ascen‐
dente, descendente o con ambos flancos de DI1.

Incrementos por vuelta
Con este parámetro se indica el número de impulsos del encóder incremental o generador de
impulsos. Puede consultar el número de impulsos en la hoja de datos del encóder.
Pasos por vuelta (encóder incremental o generador de impulsos)
El parámetro indica el número de impulsos de contaje por vuelta del encóder.
El número de impulsos de contaje depende del incremento por vuelta y de la evaluación de
señal parametrizada.
Ejemplo:
Su encóder incremental o de impulsos proporciona 2048 incrementos por vuelta. Dependiendo
de la evaluación de señal se indica el siguiente valor:
Evaluación de señal

Pasos por vuelta

Simple

2048

Doble

4096

Cuádruple

8192

Pasos por vuelta (encóder absoluto SSI)
Con este parámetro se define el número de incrementos que proporciona el encóder absoluto
SSI por vuelta.
Número de vueltas
El parámetro indica cuántas vueltas comprende el rango del encóder absoluto SSI.
El valor se calcula a partir de los valores parametrizados para los números de bit LSB y MSB
del valor de posición, así como de los pasos por vuelta.
Velocidad de referencia

142

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
El encóder transfiere el valor real de la velocidad de giro como valor porcentual según la
velocidad de referencia. Con este parámetro se define la velocidad en rpm que debe
corresponder al valor 100 % . La velocidad de referencia debe ser idéntica a la del ajuste del
control.
Se admiten valores entre 6,00 y 210000,00. El ajuste predeterminado es "3000,00 r/min".
Tipo de sensor
Con este parámetro se determina si el sensor debe medir movimientos lineales o giratorios. El
tipo de sensor debe ser idéntico al ajustado en el control.
El ajuste predeterminado es "Giratorio".
Distancia entre incrementos
Este parámetro describe la longitud del recorrido entre dos incrementos del encóder en nm.
El valor debe ser idéntico al ajustado en el controlador.
Distancia entre incrementos con resolución fina (encóder incremental o de impulsos)
El parámetro indica el recorrido entre dos impulsos de contaje en nm.
El valor depende de la distancia entre 2 incrementos y la evaluación de señal parametrizada.
Ejemplo:
Su encóder incremental o de impulsos tiene una distancia entre incrementos de 16000 nm.
Dependiendo de la evaluación de señal se indica el siguiente valor:
Evaluación de señal

Distancia entre incrementos con resolución fina

Simple

16000,00 nm

Doble

8000,00 nm

Cuádruple

4000,00 nm

Distancia entre incrementos con resolución fina(encóder absoluto SSI)
El parámetro indica el recorrido entre dos incrementos en nm.
Velocidad de referencia
El encóder transfiere el valor real de la velocidad lineal como valor porcentual referido a la
velocidad de referencia. Con este parámetro se define la velocidad en m/min que debe
corresponder al valor 100 %.
Se admiten valores entre 0,60 y 600,00. El ajuste predeterminado es "16,00 m/min".
Resto de la configuración
El resto de la configuración se lleva a cabo a través de los objetos tecnológicos Eje y Detector
del S7-1500 Motion Control . Consulte los manuales de funciones S7-1500 Motion Control

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

143

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
(https://support.industry.siemens.com/cs/ww/es/view/59381279) y S7-1500T Motion Control
(https://support.industry.siemens.com/cs/ww/es/view/109481326) para más información
sobre el resto de las opciones de configuración y puesta en marcha para la lectura de posición
y el objeto tecnológico Detector.
Consulte también
Lectura de posición para Motion Control (Página 62)

Alarmas de proceso
En los parámetros básicos del módulo tecnológico se puede definir para cada canal qué
eventos generarán una alarma de proceso durante el funcionamiento.
En un sistema S7‑1500, se adjudica un nombre de evento adecuado para cada alarma de
proceso habilitada y se asigna un OB de alarma de proceso correspondiente a cada alarma de
proceso. Cuando se dispara una alarma de proceso se inicia el OB correspondiente para
evaluar los datos de las alarmas de proceso.
Nota
En los siguientes casos se puede habilitar solamente una alarma de proceso por módulo:
● Operación descentralizada con una CPU S7-300/400
● Uso de un archivo GSD
Una alarma de proceso se dispara cuando se cumple la condición para modificar el
correspondiente bit de estado o de evento en la interfaz de respuesta.
Alarma de proceso perdida
Si las alarmas de proceso se disparan más rápido de lo que el sistema puede acusarlas, se
pierden alarmas de proceso y se notifica la alarma de diagnóstico "Alarma de proceso perdida".

144

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Alarmas de proceso activables
Alarma de pro‐ Disponible en el modo
ceso
de operación Contaje si
se utiliza

Disponible en el modo
de operación Medición
si se utiliza

Disponible en
Descripción
el modo de
operación Lec‐
tura de posi‐
ción para el ob‐
jeto tecnológi‐
co "Mo‐
tion Control"

Núme‐
ro de
Event
Type

Encóder
incremen‐
tal o gene‐
rador de
impulsos

Encóder
absoluto
SSI

Encóder
incremen‐
tal o gene‐
rador de
impulsos

Encóder
absoluto
SSI

Sí

Sí

No

No

No

Alarma de proceso al guar‐ 1000B
dar el valor de contaje o de
posición actual como valor
Capture.

Sincroniza‐
Sí
ción del conta‐
dor por señal
externa

No

Sí

No

No

Alarma de proceso al sin‐
cronizar el contador con la
señal N o el flanco DI

1001B

Apertura de
puerta

Sí

No

Sí

No

No

Alarma de proceso al abrir
la puerta interna

0001B

Cierre de
puerta

Sí

No

Sí

No

No

Alarma de proceso al ce‐
rrar la puerta interna

0010B

Rebase por
Referido al No
exceso (límite valor de
superior exce‐ contaje
dido)

Referido al No
valor de
contaje

No

Alarma de proceso cuando 0011B
el valor de contaje rebasa
el límite superior de contaje

Rebase por
defecto (límite
inferior exce‐
dido)

Referido al No
valor de
contaje

Referido al No
valor de
contaje

No

Alarma de proceso cuando
el valor de contaje rebasa
el límite inferior de contaje

Inversión de
sentido1

Referido al Referido al Referido al Referido al No
valor de
valor de
valor de
valor de
contaje
posición
contaje
posición

Alarma de proceso al inver‐ 1010B
tir el sentido del valor de
contaje o de posición

Paso por cero

Referido al Referido al Referido al Referido al No
valor de
valor de
valor de
valor de
contaje
posición
contaje
posición

Alarma de proceso en el
paso por cero del valor de
contaje o de posición

Nuevo valor
de Capture
existente

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

0100B

0111B

145

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Alarma de pro‐ Disponible en el modo
ceso
de operación Contaje si
se utiliza
Encóder
incremen‐
tal o gene‐
rador de
impulsos
Aparecido
evento de
comparación
para DQ0

Encóder
absoluto
SSI

Disponible en el modo
de operación Medición
si se utiliza
Encóder
incremen‐
tal o gene‐
rador de
impulsos

Encóder
absoluto
SSI

Disponible en
Descripción
el modo de
operación Lec‐
tura de posi‐
ción para el ob‐
jeto tecnológi‐
co "Mo‐
tion Control"

Referido al Referido al Referido al Referido al No
valor de
valor de
valor medi‐ valor medi‐
contaje
posición
do
do

Núme‐
ro de
Event
Type

Alarma de proceso cuando 0101B
se produce un evento de
comparación para DQ0 de‐
bido a la condición de com‐
paración seleccionada.
Sin alarma de proceso si en
un encóder incremental o
generador de impulsos la
modificación del valor de
contaje no ha sido provoca‐
da por un impulso de con‐
taje.

Aparecido
evento de
comparación
para DQ1

Referido al Referido al Referido al Referido al No
valor de
valor de
valor medi‐ valor medi‐
contaje
posición
do
do

Alarma de proceso cuando 0110B
se produce un evento de
comparación para DQ1 de‐
bido a la condición de com‐
paración seleccionada.
Sin alarma de proceso si en
un encóder incremental o
generador de impulsos la
modificación del valor de
contaje no ha sido provoca‐
da por un impulso de con‐
taje.

1

El bit de respuesta STS_DIR tiene preasignado el valor "0". Si el valor de contaje o de posición se modifica por primera vez
directamente después de activar el módulo tecnológico en sentido descendente, no se dispara ninguna alarma de proceso.

Ajuste predeterminado
En el ajuste predeterminado no están habilitadas las alarmas de proceso.

Parámetros adicionales para la CPU compacta
Introducción
Si se utiliza una CPU compacta se dispone además de los siguientes parámetros para las
señales de los contadores rápidos.

Compatibilidad 1511C (contadores rápidos de la CPU compacta 1512C-1 PN)
Asignación de conectores frontales como en la CPU 1511C

146

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Con este parámetro se determina si para los contadores rápidos de la CPU 1512C-1 PN se
utiliza la asignación de los conectores frontales de la CPU 1511C‑1 PN:
Opción

Significado

Desactivada (predeter‐
minado)

La CPU 1512C‑1 PN utiliza la asignación de conexiones de los conectores
frontales integrados. 1512C‑1 PN soporta el uso de las conexiones de ambos
conectores frontales de la periferia digital integrada para los contadores rá‐
pidos. La asignación de las entradas y salidas de hardware para los canales
HSC se describe en el manual de producto de la CPU 1512C-1 PN.

Activada

La CPU 1512C‑1 PN utiliza la asignación de conexiones de los conectores
frontales de la CPU 1511C-1 PN. 1511C‑1 PN soporta el uso de conexiones
del primer conector frontal de la periferia digital integrada para los contadores
rápidos. La asignación de las entradas y salidas de hardware para los cana‐
les HSC se describe en el manual de producto de la CPU 1511C-1 PN.

General
Activar este contador rápido
Con este parámetro se determina si se utilizará el contador rápido correspondiente:
Opción

Significado

Desactivado (predeter‐
minado)

El contador rápido no se utiliza. El contador no ocupa ninguna conexión de
los conectores frontales integrados y no puede disparar alarmas. Las ope‐
raciones de escritura en su interfaz de control se ignoran y su interfaz de
respuesta devuelve únicamente ceros.

Activado

El contador rápido se utiliza. La asignación de las direcciones HSC a las
conexiones de los conectores frontales integrados se describe en el manual
de producto de la CPU compacta.

Entradas y salidas de hardware
Entrada generador reloj (A) / Entrada de impulsos (A) / Generador reloj ascendente (A)
Este parámetro indica la entrada que se usa para la señal de encóder A para el contador en
cuestión. El valor no se puede modificar.
Entrada generador reloj (B) / Entrada de impulsos (B) / Generador reloj ascendente (B)
Si para el contador en cuestión se utiliza un encóder con varias señales, el parámetro indica
qué entrada se usa para la señal de encóder B. El valor no se puede modificar.
Entrada de desactivación (N)
Si para el contador en cuestión se utiliza un encóder incremental, el parámetro indica qué
entrada se usa como entrada de desactivación (señal de encóder N). El valor no se puede
modificar.
HSC DI0 / HSC DI1

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

147

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Con este parámetro se determina qué entrada digital de la CPU compacta debe utilizarse como
DIm del contador.
Nota
El retardo a la entrada para una entrada digital se parametriza en la ventana de inspección de
la configuración de dispositivos, en "Propiedades > DI 16/DQ 16 > Entradas > Canal n".

HSC DQ0
El estado de DQ0 se lee mediante la interfaz de respuesta. DQ0 no se puede asignar a una
salida digital física de la CPU compacta.
HSC DQ1
Con este parámetro se determina qué salida digital de la CPU compacta debe utilizarse como
DQ1. Se puede seleccionar una salida con un retardo de salida de 5 µs o 500 µs.
En el manual de producto de la CPU compacta encontrará una sinopsis del retardo de salida
de todas las salidas digitales.

Funcionamiento manual (encóder incremental o generador de impulsos)
Entradas de contaje
Tipo de señal
Puede escoger entre los siguientes tipos de señal (Página 63):
Tipo de señal

Significado

Otros parámetros específicos de la op‐
ción

Encóder incremental
(A, B desfasadas)

Hay conectado un encóder incremen‐ ● Invertir sentido
tal con las señales desfasadas A y B.
● Evaluación de señal
● Frecuencia de filtrado
● Tipo de sensor o Estándar de
interfaz

Encóder incremental
(A, B, N)

Hay conectado un encóder incremen‐ ● Invertir sentido
tal con las señales A y B desfasadas ● Evaluación de señal
entre sí, así como con la señal nula N.
● Frecuencia de filtrado
● Tipo de sensor o Estándar de
interfaz
● Comportamiento con señal N
● Frecuencia de la sincronización
● Frecuencia de la función Capture

148

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Tipo de señal

Significado

Otros parámetros específicos de la op‐
ción

Impulso (A) y sentido Hay conectado un encóder de impul‐ ● Frecuencia de filtrado
(B)
sos (señal A) con señal de sentido
● Tipo de sensor o Estándar de
(señal B).
interfaz
Impulso (A)

Hay conectado un encóder de impul‐ ● Frecuencia de filtrado
sos (señal A) sin señal de sentido. El ● Tipo de sensor o Estándar de
sentido de contaje puede especificar‐
interfaz
se a través de la interfaz de control
(Página 175).

Contaje ascendente
(A), contaje descen‐
dente (B)

Hay conectadas señales para el con‐ ● Frecuencia de filtrado
taje en sentido ascendente (señal A) ● Tipo de sensor o Estándar de
y sentido descendente (señal B).
interfaz

Invertir sentido
Es posible invertir el sentido de contaje para adaptarlo al proceso.
La inversión del sentido puede parametrizarse y es efectiva con los siguientes tipos de señal:
● Encóder incremental (A, B desfasadas)
● Encóder incremental (A, B, N)
Evaluación de señal
Con el parámetro Evaluación de señal (Página 67) se establece qué flancos de las señales se
contarán.
Puede escoger entre las siguientes opciones:
Evaluación de señal

Significado

Simple
(predeterminado)

Se evalúan los flancos de la señal A durante un nivel bajo de la señal B.

Doble

Se evalúan todos los flancos de la señal A.

Cuádruple

Se evalúan todos los flancos de las señales A y B.

El parámetro puede parametrizarse con los siguientes tipos de señal:
● Encóder incremental (A, B desfasadas)
● Encóder incremental (A, B, N)

Frecuencia de filtrado
Al parametrizar la frecuencia de filtrado se suprimen las interferencias en las entradas de
contaje A, B y N.
La frecuencia de filtrado seleccionada se refiere a una relación de impulso/pausa comprendida
entre aprox. 40:60 y aprox. 60:40. De ello resulta una determinada duración mínima de impulso

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

149

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
y pausa. Los cambios de señal con una duración menor que la duración mínima de impulso/
pausa se suprimen.
Puede escoger entre las siguientes frecuencias de filtrado:
Frecuencia de filtrado

Duración mínima de impulso y pausa

100 Hz

4,0 ms

200 Hz

2,0 ms

500 Hz

800 µs

1 kHz

400 µs

2 kHz

200 µs

5 kHz

80 µs

10 kHz

40 µs

20 kHz

20 µs

50 kHz

8,0 µs

100 kHz (predeterminado en CPU compacta)

4,0 µs

200 kHz** (predeterminado en TM Count)

2,0 µs

500 kHz*

0,8 µs

1 MHz* (predeterminado en TM PosInput)

0,4 µs

* Solo disponible en TM PosInput
* Solo disponible en TM Count y TM PosInput

Tipo de sensor (TM Count)
Al parametrizar el tipo de sensor se define para TM Count el modo de conmutación de las
entradas de contaje.
Puede escoger entre las siguientes opciones:
Tipo de sensor

Significado

Sensor tipo PNP
(predeterminado)

El encóder o sensor conmuta las entradas A, B y N a 24VDC.

Sensor tipo NPN

El encóder o sensor conmuta las entradas A, B y N a M.

Push-pull (tipo NPN y PNP)

El encóder o sensor conmuta las entradas A, B y N alternati‐
vamente a M y 24VDC.

Al utilizar encóders incrementales, la selección típica es "Push-pull". Cuando se utilizan
sensores de 2 hilos, p. ej. barreras fotoeléctricas o detectores de proximidad, se debe
seleccionar el cableado "Sensor tipo PNP" o "Sensor tipo NPN" según corresponda.
Para saber si el encóder incremental es de tipo push/pull, consulte la hoja de datos del encóder.
Nota
Si utiliza un sensor tipo push/pull y se ha parametrizado el tipo de sensor "Push-pull (tipo NPN
y PNP)", se puede vigilar si las señales del sensor indican rotura de hilo.

Tipo de sensor (CPU compacta)

150

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Para una CPU compacta se ha ajustado el tipo de sensor "Sensor tipo PNP" y no puede
cambiarse. El encóder o sensor conmuta las entradas A, B y N a 24V DC.
En la CPU compacta es posible utilizar tanto sensores de tipo PNP como tipo push/pull (en
contrafase). Encontrará más información sobre el tipo de sensor en la hoja de datos del sensor.
Estándar de interfaz (TM PosInput)
Con este parámetro puede definir para el TM PosInput si el encóder emite señales simétricas
(RS422) o asimétricas (TTL).
Puede escoger entre las siguientes opciones:
Estándar de interfaz

Significado

RS422, simétrica
(predeterminada)

El encóder emite señales simétricas conforme al estándar RS422
(Página 65).

TTL (5 V), asimétrico

El encóder emite señales asimétricas de 5 V conforme al estándar
TTL (Página 63).

Nota
El estándar RS422 brinda una mayor inmunidad a perturbaciones que el estándar TTL. Si el
encóder incremental o el generador de impulsos dominan los estándares RS422 y TTL, se
recomienda el estándar RS422.

Comportamiento con señal N
Este parámetro define cuál será la reacción en caso de señal N.
Puede escoger entre las siguientes opciones:
Opción

Significado

Sin reacción en caso de señal N La señal N no afecta al contador.
(predeterminado)
Sincronización en caso de se‐
ñal N (Página 38)

En caso de señal N, el contador se ajusta al valor de inicio.

Capturar con señal N (Pági‐
na 29)

El valor de contaje se guarda en el valor de captura (Capture) en caso
de señal N. El uso de una entrada digital y el uso de la señal N no se
excluyen mutuamente para la función Capture.

Si se selecciona para una entrada digital la función "Habilitar sincro‐
nización con señal N", la sincronización dependerá del nivel detec‐
tado en la entrada digital.

El objeto tecnológico muestra el valor Capture en el parámetro de
salida CapturedValue.

Nota
El comportamiento con señal N solo puede seleccionarse si se ha elegido el tipo de señal
"Encóder incremental (A, B, N)".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

151

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Nota
Si se selecciona " Sincronización en caso de señal N", puede elegirse para una entrada digital
(Página 154) la función "Habilitar sincronización con señal N".
Nota
Para High_Speed_Counter a partir de V3.0 se aplica:
"Capturar con señal N" solo puede seleccionarse en el modo de operación "Utilizar valor de
contaje como referencia".

Frecuencia de la sincronización
Con estos parámetros se define la frecuencia de los siguientes eventos:
● Sincronización en caso de señal N
● Sincronización como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única
(predeterminado)

El contador solo se ajusta con la primera señal N o el primer flanco
parametrizado de la entrada digital.

Periódica

El contador se ajusta con cada señal N o cada flanco parametrizado de
la entrada digital.

Frecuencia de la función Capture
Con estos parámetros se define la frecuencia de los eventos de Capture para las siguientes
funciones:
● Capture con señal N
● Capture como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única

El primer flanco parametrizado en la entrada digital correspondiente o
el primer flanco ascendente de la señal N guarda el valor de contaje
actual en forma de valor de Capture.

Periódica
(ajuste predeterminado)

Cada flanco parametrizado en la entrada digital correspondiente o en
cada flanco ascendente de la señal N guarda el valor de contaje actual
en forma de valor de Capture.

Límites de contaje y valor de arranque
Límite superior de contaje

152

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Con la parametrización del límite superior de contaje se limita el rango de contaje. Puede
especificarse un valor hasta 2147483647 (231-1). Debe introducirse un valor que esté por
encima del límite inferior de contaje.
El ajuste predeterminado es "2147483647".
Límite inferior de contaje
Con la parametrización del límite inferior de contaje se limita el rango de contaje. Puede
especificarse un valor hasta -2147483648 (-231). Debe introducirse un valor que esté por
debajo del límite superior de contaje.
El ajuste predeterminado es "-2147483648".
Valor inicial
Con la parametrización del valor inicial se establece con qué valor de contaje se empieza y se
continúa ante determinados eventos. Debe introducir un valor igual a los límites de contaje o
comprendido entre ellos.
El ajuste predeterminado es "0".
Más información
Encontrará más información en Comportamiento en los límites de contaje (Página 24) y
Comportamiento del contador ante la apertura de puerta (Página 28).

Comportamiento del contador en los límites y ante la apertura de puerta
Comportamiento al rebasar un límite de contaje
Puede parametrizarse el comportamiento siguiente al rebasar un límite de contaje (Página 24):
Comportamiento

Significado

Parar contaje

Después de rebasar por exceso un límite de con‐
taje, el contaje se cancela y la puerta interna se
cierra. Para reiniciar el contaje debe cerrar y abrir
de nuevo la puerta SW o la puerta HW, en su caso.

Continuar contaje
(predeterminado)

En función del resto de la parametrización, se pro‐
sigue el contaje con el valor inicial o con el límite
de contaje opuesto en cada caso.

Inicializar al rebasar un límite de contaje
Puede ajustarse el contador a los siguientes valores al rebasar un límite de contaje:
Restablecimiento del valor

Significado

A valor inicial

El valor de contaje se fija al valor inicial.

A otro límite de contaje
(predeterminado)

El valor de contaje se fija al límite de contaje
opuesto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

153

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Comportamiento ante apertura de puerta
Puede parametrizarse el siguiente comportamiento ante apertura de puerta (Página 28):
Comportamiento

Significado

Poner a valor inicial

Al abrirse la puerta, el valor de contaje se ajusta al
valor inicial.

Continuar con valor actual
(predeterminado)

Al abrirse la puerta se sigue contando desde el
último valor de contaje.

Comportamiento de una DI
Ajustar función de la DI
Al parametrizar una entrada digital se define la función que dicha entrada digital disparará al
conmutar.
Puede escoger entre las siguientes opciones:
Función de una entrada digital

Significado

Otros parámetros específicos de la
opción

Apertura/cierre de puerta (con‐
trolados por nivel)

El nivel en la correspondiente entrada digital abre y
cierra la puerta HW (Página 27).

● Retardo a la entrada

Apertura de puerta (controlada
por flanco)

El flanco parametrizado en la correspondiente en‐
trada digital abre la puerta HW (Página 27).

● Retardo a la entrada

Cierre de puerta (controlado por
flanco)

El flanco parametrizado en la correspondiente en‐
trada digital cierra la puerta HW (Página 27).

● Retardo a la entrada

Sincronización (Página 34)

El flanco parametrizado en la correspondiente en‐
trada digital pone el contador al valor de inicio.

● Retardo a la entrada

El bit de respuesta EVENT_SYNC muestra si se ha
llevado a cabo una sincronización.

● Selección de nivel
● Selección de flanco
● Selección de flanco
● Selección de flanco
● Frecuencia de la sincronización

Habilitar sincronización con se‐
ñal N

El nivel activo en la respectiva entrada digital habi‐ ● Retardo a la entrada
lita la sincronización del contador en caso de se‐
● Selección de nivel
ñal N (Página 38).

Capture

El flanco parametrizado en la respectiva entrada
digital guarda el valor de contaje actual (Página 29)
como valor Capture. El uso de una entrada digital y
el uso de la señal N no se excluyen mutuamente
para la función Capture.

● Frecuencia de la función
Capture

El valor CAPTURED_VALUE en la interfaz de res‐
puesta muestra el valor de Capture.

● Comportamiento del valor de
contaje tras Capture

Entrada digital sin función

● Retardo a la entrada
● Selección de flanco

La respectiva entrada digital no tiene asignada nin‐ ● Retardo a la entrada
guna función tecnológica.
El estado de señal de la entrada digital puede leer‐
se a través del bit de respuesta correspondiente:
● STS_DI0
● STS_DI1
● STS_DI2

154

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
Toda función, excepto "Entrada digital sin función", solo puede utilizarse una vez por contador
y ya no puede volver a seleccionarse en el resto de las entradas digitales.

Retardo a la entrada (TM Count y TM PosInput)
Con este parámetro se suprimen las interferencias de señal en las entradas digitales. Los
cambios de señal solo se capturan si permanecen estables durante más tiempo que el retardo
a la entrada parametrizado.
Puede escoger entre los siguientes retardos a la entrada:
● Ninguno
● 0,05 ms
● 0,1 ms (predeterminado)
● 0,4 ms
● 0,8 ms
● 1,6 ms
● 3,2 ms
● 12,8 ms
● 20 ms
Nota
Si selecciona la opción "Ninguno" o "0,05 ms", deberá utilizar cables apantallados para la
conexión de las entradas digitales.
Nota
El retardo a la entrada se parametriza en "Comportamiento DI0" para todas las entradas
digitales en conjunto. El retardo a la entrada se muestra adicionalmente en "Comportamiento
DI1" y con TM Count también en "Comportamiento DI2".

Retardo a la entrada (CPU compacta)
Con este parámetro se suprimen las interferencias en las entradas digitales de las señales. Los
cambios de señal solo se capturan si permanecen estables durante más tiempo que el retardo
a la entrada parametrizado.
El retardo a la entrada para una entrada digital de una CPU compacta se parametriza en la
ventana de inspección de la configuración de dispositivos, en "Propiedades > DI 16/DQ 16 >
Entradas > Canal n".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

155

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede escoger entre los siguientes retardos a la entrada:
● Ninguno
● 0,05 ms
● 0,1 ms
● 0,4 ms
● 1,6 ms
● 3,2 ms (predeterminado)
● 12,8 ms
● 20 ms
Nota
Si selecciona la opción "Ninguno" o "0,05 ms", deberá utilizar cables apantallados para la
conexión de las entradas digitales.

Selección de nivel
Con este parámetro se determina el nivel con el que se activa la entrada digital.
Puede escoger entre las siguientes opciones:
Nivel

Significado

Activa con nivel alto
(predeterminado)

La respectiva entrada digital está activa cuando está activado.

Activa con nivel bajo

La respectiva entrada digital está activa cuando está desactiva‐
do.

El parámetro puede parametrizarse con las siguientes funciones de una entrada digital:
● Apertura/cierre de puerta (controlados por nivel)
● Habilitar sincronización con señal N
Selección de flanco
Este parámetro determina con qué flanco de una entrada digital se dispara la función
parametrizada.
Dependiendo de la función seleccionada, puede elegir entre las siguientes opciones:
● Con flanco ascendente (predeterminado)
● Con flanco descendente
● Con flanco ascendente y descendente
El parámetro puede parametrizarse con las siguientes funciones de una entrada digital:
● Apertura de puerta (controlada por flanco)
● Cierre de puerta (controlado por flanco)

156

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
● Sincronización
● Capture
Nota
"Con flanco ascendente y descendente" solo puede parametrizarse para la función "Capture".

Frecuencia de la sincronización
Con estos parámetros se define la frecuencia de los siguientes eventos:
● Sincronización en caso de señal N
● Sincronización como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única
(predeterminado)

El contador solo se ajusta con la primera señal N o el primer flanco
parametrizado de la entrada digital.

Periódica

El contador se ajusta con cada señal N o cada flanco parametrizado de
la entrada digital.

Frecuencia de la función Capture
Con estos parámetros se define la frecuencia de los eventos de Capture para las siguientes
funciones:
● Capture con señal N
● Capture como función de una entrada digital
Puede escoger entre las siguientes opciones:
Opción

Significado

Única

El primer flanco parametrizado en la entrada digital correspondiente o
el primer flanco ascendente de la señal N guarda el valor de contaje
actual en forma de valor de Capture.

Periódica
(ajuste predeterminado)

Cada flanco parametrizado en la entrada digital correspondiente o en
cada flanco ascendente de la señal N guarda el valor de contaje actual
en forma de valor de Capture.

Comportamiento del valor de contaje tras Capture

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

157

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede parametrizarse el siguiente comportamiento del contador tras un evento Capture
(Página 29):
Comportamiento

Significado

Continuar contaje
(predeterminado)

El proceso de contaje continúa sin cambios después de guar‐
darse el valor de contaje actual como valor de Capture.

Poner al valor inicial y seguir contan‐ El proceso de contaje continúa con el valor inicial tras guardarse
do
el valor de contaje actual como valor de captura (Capture).

Comportamiento de una DQ
Activar salida
Al parametrizar una salida digital se define la condición que provocará la conmutación de la
salida digital.
Puede escoger entre las siguientes opciones:
Función de una salida digital (Pági‐
Significado
na 42) en el modo de operación "Con‐
taje"

Otros parámetros específicos de
la opción

Entre valor de comparación y límite
de contaje superior
(predeterminado)

La respectiva salida digital está activa cuando:
● Valor de comparación 0
valor de comparación <= valor de contaje <= límite ● Valor de comparación 1
de contaje superior
● Histéresis (en incrementos)

Entre valor de comparación y límite
de contaje inferior

La respectiva salida digital está activa cuando:
límite de contaje inferior <= valor de contaje <=
valor de comparación

● Valor de comparación 0

La salida digital DQ1 está activa cuando:
valor de comparación 0 <= valor de contaje <=
valor de comparación 1

● Valor de comparación 0

Entre valor de comparación 0 y 1

● Valor de comparación 1
● Histéresis (en incrementos)
● Valor de comparación 1
● Sentido de contaje
● Histéresis (en incrementos)

Con valor de comparación para una
duración del impulso

La respectiva salida digital solo está activa duran‐ ● Valor de comparación 0
te el tiempo y en el sentido parametrizados cuan‐ ● Valor de comparación 1
do el valor de contaje coincide con el valor de
● Sentido de contaje
comparación.
● Duración del impulso
● Histéresis (en incrementos)

Tras comando Set de CPU hasta va‐ Cuando se produce un comando Set de la CPU, la
lor referencia
respectiva salida digital está activa hasta que el
valor de contaje coincida con el de referencia.

● Valor de comparación 0
● Valor de comparación 1
● Sentido de contaje
● Histéresis (en incrementos)

Utilizada por el programa de usuario

158

La respectiva salida digital puede ser conmutada
por la CPU a través de la interfaz de control (Pá‐
gina 41).

—

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
DQ0 de un contador de una CPU compacta
En una CPU compacta, la salida digital DQ0 correspondiente está disponible a través de la
interfaz de respuesta, pero no como salida física.
Nota
La función "Entre valor de comparación 0 y 1" solamente puede seleccionarse para la salida
digital DQ1, y si se ha seleccionado para la salida digital DQ0 la función "Utilizada por el
programa de usuario".
Nota
Las funciones "Con valor de comparación para una duración del impulso" y "Tras comando Set
de CPU hasta valor de referencia" conmutan la salida digital correspondiente solo cuando el
valor de comparación es alcanzado por un impulso de contaje. Cuando el valor de contaje se
ajusta, p. ej., por medio de la sincronización, la salida digital no se conmuta.

Función de una salida digital (Pági‐ Significado
na 49) en el modo de operación "Me‐
dición"

Otros parámetros específicos
de la opción

Valor medido >= valor de compara‐
ción
(predeterminado)

La respectiva salida digital está activa cuando el
● Valor de comparación 0
valor medido es mayor o igual que el valor de com‐ ● Valor de comparación 1
paración.

Valor medido <= valor de compara‐
ción

La respectiva salida digital está activa cuando el
● Valor de comparación 0
valor medido es menor o igual que el valor de com‐ ● Valor de comparación 1
paración.

Entre valor de comparación 0 y 1

La salida digital DQ1 está activa cuando:
valor de comparación 0 <= valor medido <= valor
de comparación 1

No comprendido entre valor de com‐ La salida digital DQ1 está activa cuando:
paración 0 y 1
valor de comparación 1 <= valor medido <= valor
de comparación 0

● Valor de comparación 0
● Valor de comparación 1
● Valor de comparación 0
● Valor de comparación 1

Utilizada por el programa de usuario La respectiva salida digital puede ser conmutada —
por la CPU a través de la interfaz de control (Pági‐
na 41).

Nota
Las funciones "Entre valor de comparación 0 y 1" y "No comprendido entre valor de
comparación 0 y 1" solamente pueden seleccionarse para la salida digital DQ1, y si se ha
seleccionado para la salida digital DQ0 la función "Utilizada por el programa de usuario".

Valor de comparación 0 (TM Count y TM PosInput)
Modo de operación "Contaje":

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

159

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Al parametrizar el valor de comparación (Página 42) se determina con qué valor de contaje
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un entero (DINT) mayor o igual que el límite de contaje inferior. Si se utiliza
la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe ser menor
que el valor de comparación 1. El ajuste predeterminado es "0".
Modo de operación "Medición":
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor mínimo es ‒7,922816 x 1028. El ajuste predeterminado es "0.0". La
unidad del valor de comparación depende de la magnitud.
Valor de comparación 0 (CPU compacta)
Modo de operación "Contaje":
Al parametrizar el valor de comparación (Página 42) se determina con qué valor de contaje se
activará el bit STS_DQ0 en la interfaz de respuesta de acuerdo con el evento de comparación
seleccionado. En una CPU compacta, la salida digital DQ0 no está disponible como salida
física.
Debe introducirse un entero (DINT) mayor o igual que el límite de contaje inferior. Si se utiliza
la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe ser menor
que el valor de comparación 1. El ajuste predeterminado es "0".
Modo de operación "Medición":
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
activará el bit STS_DQ0 en la interfaz de respuesta de acuerdo con el evento de comparación
seleccionado. En una CPU compacta, la salida digital DQ0 no está disponible como salida
física.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor mínimo es ‒7,922816 x 1028. El ajuste predeterminado es "0.0". La
unidad del valor de comparación depende de la magnitud.
Valor de comparación 1
Modo de operación "Contaje":
Al parametrizar el valor de comparación (Página 42) se determina con qué valor de contaje
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un entero (DINT) menor o igual que el límite superior de contaje. Si se utiliza
la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe ser menor
que el valor de comparación 1. El ajuste predeterminado es "10".
Modo de operación "Medición":
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.

160

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor máximo es 7,922816 x 1028. El ajuste predeterminado es "10.0". La
unidad del valor de comparación depende de la magnitud.
Sentido de contaje
Con este parámetro se define para qué sentido de contaje es válida la función seleccionada.
Puede escoger entre las siguientes opciones:
Sentido de contaje

Significado

En ambos sentidos
(predeterminado)

La salida digital correspondiente se compara y se conmuta indepen‐
dientemente del sentido de contaje.

Ascendente

La respectiva salida digital solo se compara y se conmuta cuando el
contador cuenta hacia delante.

Descendente

La respectiva salida digital solo se compara y se conmuta si el con‐
tador cuenta hacia atrás.

El parámetro puede parametrizarse con las siguientes funciones:
● Entre valor de comparación 0 y 1 (modo de operación "Contaje")
● Con valor de comparación para una duración del impulso
● Tras comando Set de CPU hasta valor referencia
Duración del impulso
Al parametrizar la duración de impulso para la función "Con valor de comparación para una
duración del impulso", se determina durante cuántos milisegundos estará activa la respectiva
salida digital.
Si introduce "0" y el valor de contaje coincide con el respectivo valor de comparación, la salida
digital estará activa hasta el siguiente impulso de contaje.
Se admiten valores entre 0,0 y 6553,5.
El ajuste predeterminado es "500,0" y corresponde a una duración de impulso de 0,5 s.
Histéresis (en incrementos)
Al parametrizar la histéresis (Página 58) se define un rango en torno a los valores de
comparación. En el caso de las funciones "Entre valor de referencia y límite superior" y "Entre
valor de referencia y límite inferior" la histéresis también se aplica en los límites de contaje. En
el rango de histéresis las salidas digitales no pueden conmutar de nuevo hasta que el valor de
contaje haya salido de este rango.
Seleccione una histéresis lo bastante pequeña. Si el rango de histéresis, partiendo del valor de
referencia parametrizado, cubre todo el rango de contaje, no es posible garantizar el correcto
funcionamiento de los valores de referencia.
Si un valor de comparación se encuentra tan próximo a un límite de contaje que el rango de
histéresis sobrepasaría dicho límite de contaje, el rango de histéresis finaliza en este.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

161

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si se introduce "0" se desactiva la histéresis. Se admiten valores entre 0 y 255. El ajuste
predeterminado es "0".
Nota
La histéresis solo está disponible en el modo de operación "Contaje".

Especificar valor de medida
Magnitud
Con este parámetro se define qué magnitud (Página 53) debe suministrar el módulo
tecnológico. El valor MEASURED_VALUE en la interfaz de respuesta muestra el valor medido.
Puede escoger entre las siguientes opciones:
Magnitud

Significado

Otros parámetros específicos de la op‐
ción

Frecuencia
(predeterminado)

La magnitud muestra el número de incrementos por se‐
gundo. El valor es un número de coma flotante (REAL). La
unidad es Hz.

● Tiempo de actualización

Duración del período La magnitud es la duración media del período entre dos
● Tiempo de actualización
incrementos. El valor es un número entero (DINT). La uni‐
dad es s.
Velocidad

La magnitud es una velocidad.

● Tiempo de actualización

Encontrará ejemplos de medición de velocidad en la expli‐ ● Base de tiempo para medición de
cación del parámetro "Incrementos por unidad".
velocidad
● Incrementos por unidad

Tiempo de actualización
Con la parametrización del tiempo de actualización (Página 53) en milisegundos se define el
intervalo de tiempo que transcurre entre dos actualizaciones del valor medido.
El tiempo de actualización y el tipo de señal (Página 148) influyen en la precisión de la
medición. Con tiempos de actualización de al menos 100 ms la influencia del Tipo de señal es
insignificante.
Con tiempos de actualización inferiores a 100 ms se alcanza la máxima precisión de medición
con los siguientes tipos de señales:
● Encóder incremental (A, B desfasado) con Evaluación de señal "Simple"
● Encóder incremental (A, B, N) con Evaluación de señal "Simple"
● Impulso (A) y sentido (B)
● Impulso (A)
En otros tipos de señales la precisión de medición depende del encóder utilizado y de la línea.

162

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si se introduce "0", el valor medido se actualiza una vez por cada ciclo interno del módulo.
Puede introducir un máximo de tres decimales. Se admiten valores entre 0.0 y 25000.0. El
ajuste predeterminado es "10.0".
Base de tiempo para medición de velocidad
Con este parámetro se define la base de tiempo con la que debe ponerse a disposición la
velocidad.
Puede escoger entre las siguientes opciones:
● 1 ms
● 10 ms
● 100 ms
● 1s
● 60 s
El ajuste predeterminado es "60 s".
Incrementos por unidad
Con este parámetro se define, para la medición de velocidad, el número de impulsos de
contaje que proporciona el encóder incremental o de impulsos por cada unidad relevante.
El número de impulsos de contaje depende de la Evaluación de señal parametrizada. Se
admiten valores entre 1 y 65535.
Ejemplo 1:
El encóder proporciona 4000 impulsos de contaje con un desplazamiento de un metro. La
velocidad debe medirse en metros por segundo. Como Evaluación de señal se ha
parametrizado "doble".
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 8000
● Base de tiempo para medición de velocidad: 1 s
Ejemplo 2:
El encóder entrega 4096 impulsos de contaje por vuelta. La velocidad debe medirse en vueltas
por minuto. Como Evaluación de señal se ha parametrizado "Simple".
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 4096
● Base de tiempo para medición de velocidad: 60 s

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

163

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Funcionamiento manual (encóder absoluto SSI):
Entradas de contaje
Tipo de señal
Si hay conectado un encóder absoluto SSI con señal de datos (señal D) y señal de reloj (señal
C), seleccione el tipo de señal (Página 66) "Encóder absoluto (SSI)".
Invertir sentido
Con este parámetro se invierten los valores entregados por el encóder absoluto SSI. De ese
modo el sentido registrado del encóder puede adaptarse al sentido de giro del motor.
Nota
Dentro del telegrama, este parámetro solamente tiene efecto en el rango comprendido entre
el LSB y el MSB del valor de posición.

Longitud de telegrama
Parametrizando la longitud de trama se define el número de bits de una trama SSI del encóder
absoluto SSI (Página 23) utilizado. Para conocer la longitud de trama del encóder absoluto
SSI, consulte la hoja de datos del encóder. Los bits especiales también cuentan para la
longitud de telegrama. Un bit de paridad presente no cuenta en la longitud de telegrama.
Se permite una longitud de telegrama de entre 10 y 40 bits. El ajuste predeterminado es
"13 Bit".
Encontrará dos ejemplos de la estructura de la trama SSI en Ejemplos de estructuras de
telegrama (Página 126).
Tipo de código
Con la parametrización del tipo de código se define si el encóder proporciona códigos binarios
naturales o códigos Gray.
Puede escoger entre las siguientes opciones:
Tipo de código

Significado

Gray
(predeterminado)

El valor de posición emitido en código Gray por el encóder absoluto SSI se con‐
vierte a código binario natural.

Binario

El valor emitido por el encóder absoluto SSI no se convierte.

Velocidad de transferencia
Al parametrizar la velocidad de transferencia se define la velocidad de la transferencia de datos
entre el módulo tecnológico y el encóder absoluto SSI.

164

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede escoger entre las siguientes opciones:
● 125 kHz (predeterminado)
● 250 kHz
● 500 kHz
● 1 MHz
● 1,5 MHz
● 2 MHz
La velocidad de transferencia máxima depende de la longitud de línea y de los datos técnicos
del encóder absoluto SSI. Encontrará más información en el manual de producto del
TM PosInput y en la descripción del encóder.
Tiempo monoestable
Al parametrizar el tiempo monoestable se define el tiempo de pausa entre dos telegramas SSI.
El tiempo del flip-flop monoestable parametrizado debe ser como mínimo igual que el tiempo
monoestable del encóder absoluto SSI utilizado. Este valor figura en los datos técnicos del
encóder absoluto SSI.
Puede escoger entre las siguientes opciones:
● Automático (predeterminado)
● 16 µs
● 32 µs
● 48 µs
● 64 µs
Nota
Si se elige la opción "Automático", el tiempo del flip-flop monoestable se ajusta
automáticamente al encóder utilizado.
En modo isócrono, la opción "Automático" corresponde a un tiempo monoestable de 64 µs. Si
el tiempo monoestable del encóder absoluto SSI utilizado es inferior a 64 µs, puede
seleccionarse el valor del encóder para alcanzar tiempos isócronos más rápidos.

Paridad
Al parametrizar la paridad se define si el encóder absoluto SSI transferirá un bit de paridad.
Si, p. ej., un encóder de 25 bits está parametrizado con paridad, el módulo tecnológico lee
26 bits. Los errores de paridad se notifican en la interfaz de respuesta a través del bit
ENC_ERROR.
Número de bit LSB del valor de posición

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

165

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Con este parámetro se define el número del bit menos significativo (LSB = Least significant bit)
del valor de posición en el telegrama del encóder absoluto SSI. De este modo se limita el rango
que indica el valor de posición dentro del telegrama.
El valor debe ser inferior al número de bit del MSB del valor de posición. La diferencia entre los
números de bit del MSB y del LSB del valor de posición debe ser inferior a 32.
El ajuste predeterminado es "0".
Nota
Cuando se ha seleccionado "Gray" como tipo de código, solo se convierte a código binario
natural el rango comprendido entre el LSB y el MSB del valor de posición.

Número de bit MSB del valor de posición
Con este parámetro se define el número del bit más significativo (MSB = Most significant bit)
del valor de posición en el telegrama del encóder absoluto SSI. De este modo se limita el rango
que indica el valor de posición dentro del telegrama.
El valor debe ser inferior a la longitud del telegrama y superior al número de bit del LSB del valor
de posición. La diferencia entre los números de bit del MSB y del LSB del valor de posición
debe ser inferior a 32.
El ajuste predeterminado es "12".
Nota
Cuando se ha seleccionado "Gray" como tipo de código, solo se convierte a código binario
natural el rango comprendido entre el LSB y el MSB del valor de posición.

Comportamiento de una DI
Ajustar función de la DI
Al parametrizar una entrada digital se define la función que dicha entrada digital disparará al
conmutar.

166

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede escoger entre las siguientes opciones:
Función de una entra‐ Significado
da digital

Otros parámetros específicos de
la opción

Capture

● Retardo a la entrada

El flanco parametrizado en la entrada digital correspondiente
guarda el valor de posición actual como valor de Capture.

● Selección de flanco
El bit de respuesta CAPTURED_VALUE indica el valor de Cap‐
● Frecuencia de la función
ture.
Capture
La función solo puede utilizarse para una de las dos entradas
digitales.
Entrada digital sin fun‐ La respectiva entrada digital no tiene asignada ninguna función
ción
tecnológica.

● Retardo a la entrada

El estado de señal de la entrada digital puede leerse a través
del bit de respuesta correspondiente:
● STS_DI0
● STS_DI1

Nota
La función "Capture" solo puede seleccionarse en el modo de operación "Utilizar el valor de
posición (valor absoluto SSI) como referencia".

Retardo a la entrada
Al parametrizar el retardo a la entrada se suprimen las interferencias en las entradas digitales.
Las señales con una duración de impulso inferior al retardo a la entrada parametrizado se
suprimen.
Puede escoger entre los siguientes retardos a la entrada:
● Ninguno
● 0,05 ms
● 0,1 ms (predeterminado)
● 0,4 ms
● 0,8 ms
● 1,6 ms
● 3,2 ms
● 12,8 ms
● 20 ms
Nota
Si selecciona la opción "Ninguno" o "0,05 ms", debe utilizar cables apantallados para la
conexión de las entradas digitales.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

167

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Nota
El retardo a la entrada se parametriza en "Comportamiento DI0" para todas las entradas
digitales en conjunto. El retardo a la entrada también se muestra en "Comportamiento DI1".

Selección de flanco
Este parámetro determina para la función "Capture" con qué flanco de una entrada digital se
disparará la función parametrizada.
Puede escoger entre las siguientes opciones:
● Con flanco ascendente (predeterminado)
● Con flanco descendente
● Con flanco ascendente y descendente
Frecuencia de la función Capture
Con estos parámetros se define la frecuencia de los siguientes eventos de Capture:
Puede escoger entre las siguientes opciones:
Opción

Significado

Única

El primer flanco parametrizado en la entrada digital correspondiente
guarda el valor de contaje actual como valor de Capture.

Periódica
(ajuste predeterminado)

Cada flanco parametrizado en la entrada digital correspondiente guar‐
da el valor de contaje actual como valor de Capture.

Comportamiento de una DQ
Activar salida
Al parametrizar una salida digital se define la condición que provocará la conmutación de la
salida digital.
Dependiendo del modo de operación, puede escoger entre las siguientes opciones:
Función de una salida digital (Pá‐
gina 46) en el modo de operación
"Lectura de posición"

Significado

Otros parámetros específicos de
la opción

Entre valor de comparación y lími‐ La respectiva salida digital está activa cuando:
te de contaje superior
valor de comparación <= valor de posición <= valor
de posición máximo
(predeterminado)

● Valor de comparación 0
● Valor de comparación 1
● Histéresis (en incrementos)

Entre valor de comparación y lími‐ La salida digital correspondiente está activa cuando: ● Valor de comparación 0
te de contaje inferior
valor de posición mínimo <= valor de posición <=
● Valor de comparación 1
valor de comparación
● Histéresis (en incrementos)

168

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Función de una salida digital (Pá‐
gina 46) en el modo de operación
"Lectura de posición"

Significado

Otros parámetros específicos de
la opción

Entre valor de comparación 0 y 1

La salida digital DQ1 está activa cuando:
● Valor de comparación 0
valor de comparación 0 <= valor de posición <= valor ● Valor de comparación 1
de comparación 1
● Sentido de contaje
● Histéresis (en incrementos)

Con valor de comparación para
una duración del impulso

La respectiva salida digital solo está activa durante
el tiempo y en el sentido del cambio de valor de po‐
sición parametrizados cuando el valor de posición
coincide con el valor de comparación o cuando lo ha
rebasado por exceso o por defecto.

● Valor de comparación 0
● Valor de comparación 1
● Sentido de contaje
● Duración del impulso
● Histéresis (en incrementos)

Tras comando Set de CPU hasta
valor referencia

Cuando se produce un comando Set de la CPU, la
salida digital correspondiente está activa para el
sentido parametrizado del cambio de valor de posi‐
ción hasta que el valor de posición coincida con el de
referencia o hasta que lo haya rebasado por exceso
o por defecto.

● Valor de comparación 0
● Valor de comparación 1
● Sentido de contaje
● Histéresis (en incrementos)

Utilizada por el programa de usua‐ La respectiva salida digital puede ser conmutada por —
rio
la CPU a través de la interfaz de control (Página 41).

Nota
La función "Entre valor de comparación 0 y 1" solamente puede seleccionarse para la salida
digital DQ1, y si se ha seleccionado para la salida digital DQ0 la función "Utilizada por el
programa de usuario".

Función de una salida digital (Pá‐ Significado
gina 49) en el modo de operación
"Medición"

Otros parámetros específicos
de la opción

Valor medido >= valor de compa‐ La respectiva salida digital está activa cuando el valor ● Valor de comparación 0
ración
medido es mayor o igual que el valor de comparación. ● Valor de comparación 1
(predeterminado)
Valor medido <= valor de compa‐ La respectiva salida digital está activa cuando el valor ● Valor de comparación 0
ración
medido es menor o igual que el valor de comparación. ● Valor de comparación 1
Entre valor de comparación 0 y 1 La salida digital DQ1 está activa cuando:
valor de comparación 0 <= valor medido <= valor de
comparación 1
No comprendido entre valor de
comparación 0 y 1

La salida digital DQ1 está activa cuando:
valor de comparación 1 <= valor medido <= valor de
comparación 0

Utilizada por el programa de usua‐ La respectiva salida digital puede ser conmutada por
rio
la CPU a través de la interfaz de control (Página 41).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

● Valor de comparación 0
● Valor de comparación 1
● Valor de comparación 0
● Valor de comparación 1
—

169

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
Las funciones "Entre valor de comparación 0 y 1" y "No comprendido entre valor de
comparación 0 y 1" solamente pueden seleccionarse para la salida digital DQ1, y si se ha
seleccionado para la salida digital DQ0 la función "Utilizada por el programa de usuario".

Valor de comparación 0
Modo de operación "Lectura de posición":
Al parametrizar el valor de comparación (Página 46) se determina con qué valor de posición se
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Si se utiliza un encóder absoluto SSI con una longitud del valor de posición de hasta 31 bits,
debe introducirse un entero positivo (DINT) con un valor entre 0 y 2(MSB-LSB+1)-1. Si se utiliza un
encóder absoluto SSI con una longitud del valor de posición de 32 bits, debe introducirse un
entero (DINT) con signo con un valor entre –2147483648 y 2147483647.
Si se utiliza la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe
ser menor que el valor de comparación 1. El ajuste predeterminado es "0".
Modo de operación "Medición":
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ0 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor mínimo es ‒7,922816 x 1028. El ajuste predeterminado es "0.0". La
unidad del valor de comparación depende de la magnitud.
Valor de comparación 1
Modo de operación "Lectura de posición"
Al parametrizar el valor de comparación (Página 46) se determina con qué valor de posición se
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.
Si se utiliza un encóder absoluto SSI con una longitud del valor de posición de hasta 31 bits,
debe introducirse un entero positivo (DINT) con un valor entre 0 y 2(MSB-LSB+1)-1. Si se utiliza un
encóder absoluto SSI con una longitud del valor de posición de 32 bits, debe introducirse un
entero (DINT) con signo con un valor entre –2147483648 y 2147483647.
Si se utiliza la función DQ "Entre valor de comparación 0 y 1", el valor de comparación 0 debe
ser menor que el valor de comparación 1. El ajuste predeterminado es "10".
Modo de operación "Medición"
Al parametrizar el valor de comparación (Página 49) se determina con qué valor medido se
conmutará la salida digital DQ1 de acuerdo con el evento de comparación seleccionado.
Debe introducirse un número de coma flotante (REAL). Si se utiliza la función DQ "Entre valor
de comparación 0 y 1", el valor de comparación 0 debe ser menor que el valor de
comparación 1. El valor máximo es 7,922816 x 1028. El ajuste predeterminado es "10.0". La
unidad del valor de comparación depende de la magnitud.

170

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Sentido de contaje
Con este parámetro se define para qué sentido del cambio del valor de posición es válida la
función seleccionada.
Puede escoger entre las siguientes opciones:
Sentido del cambio del valor de
posición

Significado

En ambos sentidos
(predeterminado)

La comparación y la conmutación de la salida digital correspon‐
diente tienen lugar independientemente de que el valor de posición
aumente o disminuya.

Ascendente

La respectiva salida digital solo se compara y se conmuta cuando
el valor de posición aumenta.

Descendente

La respectiva salida digital solo se compara y se conmuta cuando
el valor de posición disminuye.

El parámetro puede parametrizarse con las siguientes funciones:
● Entre valor de comparación 0 y 1 (modo de operación "Lectura de posición")
● Con valor de comparación para una duración del impulso
● Tras comando Set de CPU hasta valor referencia
Duración del impulso
Al parametrizar la duración de impulso para la función "Con valor de comparación para una
duración del impulso", se determina durante cuántos milisegundos estará activa la respectiva
salida digital.
Se admiten valores entre 0,1 y 6553,5 ms.
El ajuste predeterminado es "500,0" y corresponde a una duración de impulso de 0,5 s.
Histéresis (en incrementos)
Al parametrizar la histéresis (Página 60) se define un rango en torno a los valores de
comparación. En el caso de las funciones "Entre valor de referencia y límite superior" y "Entre
valor de referencia y límite inferior" la histéresis también se aplica en los límites de contaje. En
el rango de histéresis las salidas digitales no pueden conmutar de nuevo hasta que el valor de
posición haya salido una vez de este rango.
Seleccione una histéresis lo bastante pequeña. Si el rango de histéresis, partiendo del valor de
referencia parametrizado, cubre todo el rango de valores de posición, no es posible garantizar
el correcto funcionamiento de los valores de referencia.
Si un valor de referencia se encuentra tan próximo a un límite de contaje que el rango de
histéresis sobrepasaría dicho límite de contaje, el rango de histéresis finaliza en este.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

171

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Si se introduce "0" se desactiva la histéresis. Se admiten valores entre 0 y 255. El ajuste
predeterminado es "0".
Nota
La histéresis solo está disponible en el modo de operación "Lectura de posición".

Especificación del valor medido
Magnitud
Con este parámetro se especifica si el módulo tecnológico debe suministrar una magnitud
(Página 53) determinada o el telegrama SSI completo.
Puede escoger entre las siguientes opciones:
Opción

Significado

Otros parámetros específicos de
la opción

Frecuencia
(predeterminado)

La magnitud muestra el número de incrementos por segundo, de
manera que cada incremento corresponde a una variación del
valor de posición. El valor es un número de coma flotante (REAL).
La unidad es Hz.

● Tiempo de actualización

El valor MEASURED_VALUE en la interfaz de respuesta muestra
el valor medido.
Duración del período La magnitud es la duración media del período entre dos incre‐
mentos del valor de posición. El valor es un número entero
(DINT). La unidad es s.

● Tiempo de actualización

El valor MEASURED_VALUE en la interfaz de respuesta muestra
el valor medido.
Velocidad

La magnitud es una velocidad.

● Tiempo de actualización

Encontrará ejemplos de medición de velocidad en la explicación
del parámetro "Incrementos por unidad".

● Base de tiempo para
medición de velocidad

El valor MEASURED_VALUE en la interfaz de respuesta muestra
el valor medido.
Telegrama SSI com‐
pleto

● Incrementos por unidad

En lugar de una magnitud, se devuelven los primeros 32 bits del —
telegrama SSI (bits 0 a 31). También se suministran bits especia‐
les que no pertenecen a la información de posición. No se tiene en
cuenta una inversión del sentido parametrizada.
El valor MEASURED_VALUE en la interfaz de respuesta muestra
los 32 bits.
Encontrará ejemplos en Ejemplos de estructuras de telegrama
(Página 126). Esta opción solo está disponible en el modo de
operación "Utilizar el valor de posición (valor absoluto SSI) como
referencia".

172

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Nota
Si para calcular el valor medido se necesita el incremento por vuelta, este se calcula
automáticamente como segunda potencia a partir de la longitud de telegrama parametrizada,
p. ej., 8192 incrementos por vuelta para una longitud de telegrama de 13 bits. Si se utiliza un
encóder absoluto SSI cuyo incremento por vuelta no equivale a la segunda potencia, puede ser
que el valor medido calculado resulte erróneo durante un breve lapso de tiempo.

Tiempo de actualización
Con la parametrización del tiempo de actualización (Página 53) en milisegundos se define el
intervalo de tiempo que transcurre entre dos actualizaciones del valor medido. Con tiempos de
actualización mayores se pueden suavizar magnitudes inestables.
Si se introduce "0", el valor medido se actualiza una vez por cada ciclo interno del módulo.
Puede introducir un máximo de tres decimales. Se admiten valores entre 0.0 y 25000.0. El
ajuste predeterminado es "10.0".
Base de tiempo para medición de velocidad
Con este parámetro se define la base de tiempo con la que debe ponerse a disposición la
velocidad.
Puede escoger entre las siguientes opciones:
● 1 ms
● 10 ms
● 100 ms
● 1s
● 60 s
El ajuste predeterminado es "60 s".
Incrementos por unidad
Con este parámetro se define, para la medición de velocidad, el número de incrementos que
proporciona el encóder absoluto SSI por cada unidad relevante.
Se admiten valores entre 1 y 65535.
Ejemplo 1:
Su encóder funciona con una resolución de 12 bits por vuelta y emite 4096 incrementos por
vuelta. La velocidad debe medirse en vueltas por minuto.
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 4096
● Base de tiempo para medición de velocidad: 60 s
Ejemplo 2:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

173

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
El encóder proporciona 10000 incrementos con un desplazamiento de un metro. La velocidad
debe medirse en metros por segundo.
En este caso, parametrice lo siguiente:
● Incrementos por unidad: 10000
● Base de tiempo para medición de velocidad: 1 s

Módulo Online y diagnóstico
Indicación y evaluación del diagnóstico
Por medio de la vista online y de diagnóstico puede realizar un diagnóstico del hardware.
Además, puede:
● Recibir información a través del módulo tecnológico (p. ej. la versión de Firmware y el
número de serie).
● Si es necesario, realice una actualización del firmware.

Procedimiento (TM Count y TM PosInput)
Para abrir el editor de visualización de las funciones de diagnóstico, haga lo siguiente:
1. Abra la configuración de dispositivo de la CPU o el IM.
2. Seleccione la vista de dispositivos.
3. Haga clic con el botón derecho del ratón en el módulo y seleccione "Online y diagnóstico".
1. Haga clic en la visualización deseada en el árbol de diagnóstico.

Procedimiento (CPU compacta)
Para abrir el editor de visualización de las funciones de diagnóstico, haga lo siguiente:
1. Abra la carpeta de la CPU compacta en el árbol del proyecto.
2. Haga doble clic en el objeto "Online y diagnóstico".
3. Haga clic en la visualización deseada en el árbol de diagnóstico.

Más información
Para más información sobre los avisos de diagnóstico y sobre posibles remedios, consulte el
manual de producto del módulo tecnológico.
Nota
Lectura de posición para Motion Control
En el modo de operación "Lectura de posición para el objeto tecnológico 'Motion Control'", el
diagnóstico de canal no se encuentra disponible para el módulo tecnológico.

174

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Interfaz de control y realimentación (TM Count, TM PosInput)
Encontrará información sobre el uso de la interfaces de control y respuesta en el resumen de
las posibles aplicaciones (Página 16).
Nota
La siguiente descripción no es válida para los modos de operación "Fast Mode" y "Lectura de
posición para el objeto tecnológico "Motion Control"". Encontrará una descripción de la interfaz
de respuesta para los módulos tecnológicos que admiten el modo de operación "Fast Mode"
en el manual de producto correspondiente.

Asignación de la interfaz de control
El programa de usuario gobierna el comportamiento del módulo tecnológico a través de la
interfaz de control.

Interfaz de control por canal
La siguiente tabla muestra la asignación de la interfaz de control:
Offset de
byte res‐
pecto de
la direc‐
ción ini‐
cial
Canal
0/1
↓ ↓

Bit 7

Bit 6

Bit 5

Bit 4

Bit 3

Bit 2

Bit 1

0
…
3

12
…
15

DINT o REAL: Valor de carga (el significado del valor se especifica en LD_SLOT_0)

4
…
7

16
…
19

DINT o REAL: Valor de carga (el significado del valor se especifica en LD_SLOT_1)

8

20

9

21

EN_
CAPTURE

10

22

SET_DIR

11

23

Bit 0

SLOT_0:
Rango de valores: –2147483648 a 2147483647D u 80000000 a 7FFFFFFFH
SLOT_1:
Rango de valores: –2147483648 a 2147483647D u 80000000 a 7FFFFFFFH
LD_SLOT_1
EN_
SYNC_DN

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

EN_
SYNC_UP

LD_SLOT_0
SET_DQ1

SET_DQ0

Reservado

TM_
CTRL_DQ1

TM_
CTRL_DQ0

SW_GATE

RES_
EVENT

RES_
ERROR

Reservado

175

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Explicaciones
Bit de control/valor

Explicaciones

SLOT_m

Con este valor se define el valor de carga. El significado del valor se especifica en LD_SLOT_m.
Si desea cargar un valor de referencia en el modo de operación "Medición", especifique el valor
de carga como número en coma flotante (REAL). En todos los demás casos, indique el valor de
carga como número entero (DINT).
Rango de valores: –2147483648 a 2147483647D u 80000000 a 7FFFFFFFH

LD_SLOT_m

Con esta solicitud de carga se especifica el significado del valor en SLOT_m:
● 0000 significa: Ninguna acción, estado de reposo
● 0001 significa: Cargar valor de contaje (con encóder incremental o generador de impulsos)
● No se admite 0010
● 0011 significa: Cargar valor inicial (con encóder incremental o generador de impulsos)
● 0100 significa: Cargar valor de comparación 0
● 0101 significa: Cargar valor de comparación 1
● 0110 significa: Cargar límite de contaje inferior (con encóder incremental o generador de
impulsos)
● 0111 significa: Cargar límite superior de contaje (con encóder incremental o generador de
impulsos)
● No se admite 1000 a 1111
El módulo tecnológico ejecuta la acción correspondiente en cuanto cambia LD_SLOT_m.
Si se cargan valores simultáneamente a través de LD_SLOT_0 y LD_SLOT_1, se aplica primero
internamente el valor de SLOT_0 y a continuación el valor de SLOT_1. De ese modo, pueden
producirse estados intermedios inesperados.
Cambiar el valor COUNT_VALUE mediante LD_SLOT_m no influye en el valor MEASURED_VA‐
LUE.

EN_CAPTURE

Este bit habilita la función Capture. La desactivación del bit desactiva un EVENT_CAP activado
en la interfaz de respuesta.

EN_SYNC_DN

Con este bit se habilita la sincronización del contador al contar en sentido descendente si se
utiliza un encóder incremental o un generador de impulsos. La desactivación del bit desactiva un
EVENT_SYNC activado en la interfaz de respuesta.

EN_SYNC_UP

Con este bit se habilita la sincronización del contador al contar en sentido ascendente si se utiliza
un encóder incremental o un generador de impulsos. La desactivación del bit desactiva un
EVENT_SYNC activado en la interfaz de respuesta.

SET_DQ0

Con este bit se activa la salida digital DQ0 cuando TM_CTRL_DQ0 está establecido en 0.
Con la función "Tras comando Set de CPU hasta valor referencia", SET_DQ0 actúa indepen‐
dientemente de TM_CTRL_DQ0, siempre y cuando el valor de contaje no coincida con el valor de
comparación.

SET_DQ1

Con este bit se activa la salida digital DQ1 cuando TM_CTRL_DQ1 está establecido en 0.
Con la función "Tras comando Set de CPU hasta valor referencia", SET_DQ1 actúa indepen‐
dientemente de TM_CTRL_DQ1, siempre y cuando el valor de contaje no coincida con el valor de
comparación.

TM_CTRL_DQ0

Con este bit se habilita la función tecnológica de la salida digital DQ0.
● 0 significa: SET_DQ0 determina el estado de DQ0
● 1 significa: la función parametrizada determina el estado de DQ0

176

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Bit de control/valor

Explicaciones

TM_CTRL_DQ1

Con este bit se habilita la función tecnológica de la salida digital DQ1.
● 0 significa: SET_DQ1 determina el estado de DQ1
● 1 significa: la función parametrizada determina el estado de DQ1

SW_GATE

Con este bit se abre y cierra la puerta de software si se utiliza un encóder incremental o un
generador de impulsos. La puerta software, junto con la puerta hardware, forma la puerta interna.
El módulo tecnológico solo efectúa el contaje si la puerta interna está abierta.
● 0 significa: puerta de software cerrada
● 1 significa: puerta de software abierta
La puerta HW se controla externamente a través de las entradas digitales del módulo tecnoló‐
gico. La puerta HW se puede activar por parametrización. La puerta SW no se puede desactivar.

SET_DIR

Con este bit se especifica el sentido de contaje con el tipo de señal "Impulso (A)".
● 0 significa: ascendente
● 1 significa: descendente

RES_EVENT

Con este bit se inicia la desactivación de los eventos guardados en los bits de respuesta
EVENT_ZERO, EVENT_OFLW, EVENT_UFLW, EVENT_CMP0, EVENT_CMP1.

RES_ERROR

Con este bit se inicia la desactivación de los estados de error guardados LD_ERROR y
ENC_ERROR.

Reservado

Los bits de reserva deben estar ajustados a 0.

Asignación de la interfaz de realimentación
A través de la interfaz de respuesta, el programa de usuario recibe valores actuales e
información de estado del módulo tecnológico.

Interfaz de respuesta por canal
La siguiente tabla muestra la asignación de la interfaz de respuesta:
Offset de
byte res‐
pecto de
la direc‐
ción ini‐
cial
Canal
0/1
↓ ↓
0
…
3

16
…
19

4
…
7

20
…
23

8
...
11

24
...
27

12

28

Bit 7

Bit 6

Bit 5

Bit 4

Bit 3

Bit 2

Bit 1

Bit 0

ENC_
ERROR

POWER_
ERROR

COUNT_VALUE:
DINT: Valor de contaje o valor de posición actuales
CAPTURED_VALUE:
DINT: Último valor de Capture captado
MEASURED_VALUE:
REAL: Valor medido actual o DWORD: telegrama SSI completo

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Reservado

LD_ERROR

177

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Offset de
byte res‐
pecto de
la direc‐
ción ini‐
cial
Canal
0/1
↓ ↓

1

Bit 7

Bit 6

Reservado

Bit 5

Bit 4

Bit 3

Bit 2

Bit 1

Bit 0

STS_SW_
GATE

STS_
READY

LD_STS_
SLOT_1

LD_STS_
SLOT_0

RES_EVEN
T_ACK

Reservado

13

29

14

30

STS_DI21

STS_DI1

STS_DI0

STS_DQ1

STS_DQ0

STS_GATE

STS_CNT

STS_DIR

15

31

STS_M_
INTERVAL

EVENT_
CAP

EVENT_
SYNC

EVENT_
CMP1

EVENT_
CMP0

EVENT_
OFLW

EVENT_
UFLW

EVENT_
ZERO

Con TM PosInput se aplica: Reservado

Nota
Validez del valor de posición
El valor de posición de un encóder absoluto SSI es válido si STS_READY está ajustado a 1 y
ENC_ERROR a 0. En el arranque del módulo, STS_READY está ajustado a 0.

Explicaciones
Bit de respuesta/
Valor

Explicaciones

COUNT_VALUE

Este valor DINT indica el valor de contaje o de posición actual.
Si se utiliza un encóder absoluto SSI con una longitud del valor de posición de hasta 31 bits, el valor
de posición sin signo se trata como un valor positivo y puede adoptar valores entre 0 y 2(MSB-LSB+1)-1.
Si se utiliza un encóder absoluto SSI con una longitud del valor de posición de 32 bits, el MSB del valor
de posición corresponde al signo y el valor de posición puede adoptar valores entre –2147483648 y
2147483647. Si se utiliza un valor de posición de 32 bits para la función de comparación, el valor de
posición se interpreta como DINT.
Cambiar el valor COUNT_VALUE mediante LD_SLOT_m no influye en el valor MEASURED_VALUE.

CAPTURED_VALUE Este valor DINT muestra el último valor de Capture registrado.
Las siguientes señales externas pueden desencadenar la función de Capture.
● Flanco ascendente o descendente de una entrada digital
● Ambos flancos de una entrada digital
El parámetro "Frecuencia de la función Capture" determina si la función se ejecuta en cada flanco
parametrizado o solo una vez después de cada habilitación.

178

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Bit de respuesta/
Valor

Explicaciones

MEASURED_
VALUE

Este valor indica el valor medido actual con el tipo de datos REAL o el telegrama SSI completo con
el tipo de datos DWORD:
● Frecuencia: A partir del cronograma de los impulsos de contaje o cambios de los valores de
posición se calcula la frecuencia media en un intervalo de medición, y dicha frecuencia se
devuelve como número en coma flotante en hercios.
● Duración de periodo: A partir del cronograma de los impulsos de contaje o los cambios de los
valores de posición se calcula el periodo medio en un intervalo de medición, y dicho periodo medio
se devuelve como número en coma flotante en segundos.
● Velocidad: A partir del cronograma de los impulsos de contaje o los cambios de los valores de
posición y otros parámetros se calcula la velocidad media en un intervalo de medición, y dicha
velocidad media se devuelve en la unidad parametrizada.
● Telegrama SSI completo: En lugar de una magnitud se devuelven los 32 bits menos significativos
del actual telegrama SSI no procesado. De esta manera, además del valor de posición, obtiene
bits específicos de encóder adicionales, p. ej., bits de error. Si el telegrama SSI es más corto que
32 bits, se devuelven el telegrama SSI completo, justificado a la derecha, y los bits superiores no
usados con "0" en la interfaz de respuesta.
Los valores medidos se devuelven como valores con signo. El signo indica si el valor de contaje o de
posición ha aumentado o disminuido durante el intervalo de interés.
El tiempo de actualización es asíncrono a la apertura de la puerta interna, es decir, el tiempo de
actualización no se inicia al abrir la puerta. Después del cierre de la puerta interna se devuelve el
último valor medido.

LD_ERROR

Este bit indica que se ha producido un error al cargar a través de la interfaz de control (con memoria).
No se han adoptado los valores de carga. Si se utiliza un encóder incremental o un generador de
impulsos, no se cumple una de las siguientes condiciones:
● Límite inferior de contaje <= valor de contaje <= límite superior de contaje
● límite inferior de contaje <= valor inicial <= límite superior de contaje
● Límite inferior de contaje <= valor de comparación 0/1 <= límite superior de contaje
Si se utiliza un encóder absoluto SSI, no se cumple una de las siguientes condiciones:
● 0 <= valor de posición <= valor de posición máximo
● 0 <= valor de comparación 0/1 <= valor de posición máximo
El bit se desactiva después de que se haya acusado el error con RES_ERROR .

ENC_ERROR

Este bit indica que, con el módulo tecnológico respectivo, se ha producido uno de los siguientes
errores en las señales del encóder (con memoria):
TM Count:
● Rotura de hilo de entrada digital A, B o N (con encóder tipo push-pull)
● Transición ilegal de las señales A/B (en encóders incrementales)
TM PosInput:
● Transición ilegal de las señales A/B (en encóders incrementales)
● Error RS422/TTL
● Error en el encóder SSI o en el telegrama SSI (con encóders absolutos SSI)
Si se han habilitado las alarmas de diagnóstico, en caso de error en las señales del encóder, se
dispara la alarma de diagnóstico correspondiente. Infórmese con el manual de producto del módulo
tecnológico respectivo sobre el significado de las alarmas de diagnóstico.
El bit se desactiva después de que se haya acusado el error con RES_ERROR.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

179

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Bit de respuesta/
Valor

Explicaciones

POWER_ERROR

Este bit muestra para un módulo tecnológico S7‑1500 que la tensión de alimentación L+ no existe,
que es demasiado baja o que el conector frontal no está conectado. Este bit muestra para un módulo
tecnológico ET 200SP que la tensión de alimentación L+ es demasiado baja.
Si se han habilitado las alarmas de diagnóstico, en caso de error en la tensión de alimentación se
dispara la alarma de diagnóstico correspondiente. En el manual de producto del módulo tecnológico
correspondiente encontrará información sobre las alarmas de diagnóstico y sus soluciones.
Si la tensión de alimentación L+ vuelve a estar disponible en la magnitud necesaria, PO‐
WER_ERROR se ajusta automáticamente a 0.

STS_SW_GATE

Este bit indica el estado de la puerta SW.
0 significa: puerta cerrada
1 significa: puerta abierta

STS_READY

Este bit indica que el módulo tecnológico emite datos de usuario válidos. El módulo tecnológico está
arrancado y parametrizado.

LD_STS_SLOT_0

Este bit indica con un cambio de estado (conmutación) que la solicitud de carga para Slot 0
(LD_SLOT_0) ha sido detectada y ejecutada.

LD_STS_SLOT_1

Este bit indica con un cambio de estado (conmutación) que la solicitud de carga para Slot 1
(LD_SLOT_1) ha sido detectada y ejecutada.

RES_EVENT_ACK

Este bit indica que la desactivación de los bits de evento EVENT_SYNC, EVENT_CMP0,
EVENT_CMP1, EVENT_OFLW, EVENT_UFLW, EVENT_ZERO está activa.

STS_DI0

Este bit indica el estado de la entrada digital DI0.

STS_DI1

Este bit indica el estado de la entrada digital DI1.

STS_DI2

Este bit indica el estado de la entrada digital DI2 de TM Count .

STS_DQ0

Este bit indica el estado de la salida digital DQ0.

STS_DQ1

Este bit indica el estado de la salida digital DQ1.

STS_GATE

Este bit muestra el estado de la puerta interna si se utiliza un encóder incremental o un generador de
impulsos.
0 significa: puerta cerrada
1 significa: puerta abierta
Nota para TM PosInput:
Para que la lógica de contaje, incluido el control de puerta, funcione correctamente, el arranque del
módulo tecnológico debe finalizar correctamente por lo menos una vez con el encóder incremental o
el generador de impulsos conectado (STS_READY = 1). Si un encóder conectado no está listo du‐
rante el arranque, se retarda la función del bit de respuesta STS_GATE hasta que el encóder está
disponible para el módulo tecnológico. Si el módulo tecnológico arranca sin un encóder conectado,
el arranque no finaliza correctamente y tanto STS_READY como STS_GATE quedan a 0. En el
momento en que se conecta un encóder, el arranque finaliza y STS_GATE funciona correctamente.
Una vez finalizado el arranque, un error de encóder no afecta a STS_GATE.

STS_CNT

Este bit indica que dentro de los últimos 0,5 s aprox. se ha producido al menos un impulso de contador
o un cambio del valor de posición.

STS_DIR

Este bit muestra el sentido de contaje del último impulso de contaje o el sentido del último cambio del
valor de posición.
0 significa: descendente
1 significa: ascendente

STS_M_INTERVAL

Este bit indica que en el intervalo de medida precedente se ha capturado al menos un impulso de
contaje o un cambio del valor de posición.

EVENT_CAP

Este bit muestra que se ha producido un evento Capture y que se había guardado un valor de
contador en CAPTURED_VALUE. Este estado se desactiva restableciendo EN_CAPTURE.

180

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Bit de respuesta/
Valor

Explicaciones

EVENT_SYNC

Este bit indica el estado almacenado de que el contador se ha cargado con el valor inicial por una
señal de referencia externa (sincronización) cuando se utiliza un encóder incremental o un generador
de impulsos. Este estado se desactiva restableciendo EN_SYNC_UP o EN_SYNC_DN.

EVENT_CMP0

Este bit indica el estado almacenado de que se ha producido un evento de comparación (cambio de
estado) para la salida digital DQ0 debido a la condición de comparación seleccionada. Este estado
se desactiva acusando con RES_EVENT.
Si, en el modo de operación "Contador", el valor del contador se ajusta al valor inicial, EVENT_CMP0
no se activa.

EVENT_CMP1

Este bit indica el estado almacenado de que se ha producido un evento de comparación (cambio de
estado) para la salida digital DQ1 debido a la condición de comparación seleccionada. Este estado
se desactiva acusando con RES_EVENT.
Si, en el modo de operación "Contador", el valor del contador se ajusta al valor inicial, EVENT_CMP1
no se activa.

EVENT_OFLW

Este bit indica el estado almacenado de que el valor de contaje tenía un rebase por exceso. Este
estado se desactiva acusando con RES_EVENT.

EVENT_UFLW

Este bit indica el estado almacenado de que el valor de contaje tenía un rebase por defecto. Este
estado se desactiva acusando con RES_EVENT.

EVENT_ZERO

Este bit indica el estado almacenado de que el valor de contaje o el valor de posición tenían un paso
por cero. Este estado se desactiva acusando con RES_EVENT.

Reservado

Los bits de reserva están ajustados a 0.

Método de acuse completo
Los bits guardados se acusan conforme al método de acuse completo.
La siguiente figura muestra un ejemplo del proceso del método de acuse completo en caso de
rebase por exceso:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

181

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

5(6B(9(17

(9(17B2)/:

5(6B(9(17B$&.



①
②
③
④
⑤

182









El bit de respuesta EVENT_OFLW se activa como evento con memoria en caso de rebase por
exceso.
Establezca el bit de control RES_EVENT para impulsar el restablecimiento de EVENT_OFLW .
El bit de respuesta RES_EVENT_ACK se activa si se ha detectado la desactivación de
EVENT_OFLW.
Se restablece el bit de control RES_EVENT .
El bit de respuesta RES_EVENT_ACK se restablece.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Aplicación de valores por solicitud de carga
La figura siguiente muestra un ejemplo del procedimiento de aplicación de valores con la
solicitud de carga y la detección de errores:

6/27B

/'B6/27B

/'B676B6/27B

/'B(5525

5(6B(5525

D E

D E

F G H D E

1a

En LD_SLOT_0 se escribe el valor 1 válido (Cargar valor de contaje) y en SLOT_0, el valor de
carga deseado.

1b

Se conmuta el bit de respuesta LD_STS_SLOT_0, ya que la solicitud de carga LD_SLOT_0 ha
sido detectada y ejecutada por el módulo.

2a

En LD_SLOT_0 se escribe el valor 2 no válido.

2b

Se activa el bit de respuesta LD_ERROR, ya que el valor de LD_STS_SLOT_0 no es válido. El
valor de SLOT_0 no se aplica.

2c

Se activa el bit de control RES_ERROR para acusar el error.

2d

El bit de respuesta LD_ERROR se restablece.

2e

Se desactiva el bit de control RES_ERROR.

3a

En LD_SLOT_0 se escribe el valor 3 válido (Cargar valor inicial) y en SLOT_0, el valor de carga
deseado.

3b

Se conmuta el bit de respuesta LD_STS_SLOT_0, ya que la solicitud de carga LD_SLOT_0 ha
sido detectada y ejecutada por el módulo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

183

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

1.1.4.2

Utilización del módulo digital

Configurar y parametrizar el módulo
Agregar un módulo a la configuración hardware
Requisitos
● Se ha creado el proyecto.
● Se ha creado la CPU.
● Se ha creado la periferia descentralizada ET 200.

Procedimiento
1. Abra la configuración de dispositivo de la CPU o el IM.
2. Seleccione un rack.
3. Seleccione el módulo digital en el catálogo de módulos:
"DI > Módulo de entradas digitales > Referencia" o bien
"DIQ > Módulo de entradas/salidas digitales > Referencia"
4. Arrastre el módulo hasta el slot deseado del rack utilizando la función Drag & Drop.

Acceso a la configuración hardware
Procedimiento
1. Abra la configuración de dispositivo de la CPU o el IM.
2. Seleccione la vista de dispositivos.
3. Haga clic en el módulo.

Modo de operación Contaje
El modo de operación Contaje o la configuración de contador permiten ajustar los parámetros
siguientes para el canal correspondiente.
Nota
Algunos de los parámetros y opciones no están disponibles en todos los módulos digitales.
Consulte el manual de producto del módulo para obtener información sobre los parámetros y
opciones correspondientes.

184

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Canal activado
Con este parámetro se determina si el canal correspondiente está activado o desactivado.
En la configuración predeterminada el canal correspondiente está activado.

Retardo a la entrada
Al parametrizar el retardo a la entrada se suprimen las interferencias de señal en las entradas
digitales. Los cambios en la señal solo se consideran si permanecen estables durante más
tiempo que el retardo a la entrada ajustado.
Solo es posible una configuración isócrona si en al menos un canal se ha parametrizado un
retardo a la entrada de 0,05 ms. En el modo isócrono la interfaz de respuesta se actualiza en
el tiempo Ti (tiempo de lectura de los datos de entrada).
Puede escoger entre las siguientes opciones:
● 0,05 ms
● 0,1 ms
● 0,4 ms
● 0,8 ms
● 1,6 ms
● 3,2 ms (predeterminado)
● 12,8 ms
● 20 ms
Nota
Si para el retardo a la entrada se selecciona la opción "0,05 ms", deben utilizarse cables
apantallados para la conexión de las entradas digitales.

Comportamiento al rebasar un límite de contaje
Es posible parametrizar el comportamiento siguiente en caso de rebase por exceso del límite
superior de contaje en sentido ascendente o rebase por defecto del límite inferior de contaje en
sentido descendente (Página 76):
Comportamiento

Significado

Parar contaje
(predeterminado en ET200SP
y ET200AL)

Tras rebasar por exceso un límite de contaje se cierra la puerta interna
(cierre de puerta automático). De este modo se detiene el contaje y las
señales de contaje siguientes son ignoradas por el módulo. El valor de
contaje se fija al límite de contaje opuesto. Para reiniciar el contaje
debe cerrar y abrir de nuevo la puerta SW o la puerta HW.

Continuar contaje
(predeterminado en S7-1500)

Tras rebasar por exceso un límite de contaje el valor de contaje se
activa en el límite de contaje opuesto y el contaje continúa.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

185

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Selección de flanco
Con este parámetro se determina qué flancos cuenta el contador correspondiente:
Selección de flanco

Significado

Con flanco ascendente
(predeterminado)

El contador correspondiente cuenta todos los flan‐
cos ascendentes en la entrada digital.

Con flanco descendente

El contador correspondiente cuenta todos los flan‐
cos descendentes en la entrada digital.

Con flanco ascendente y descendente

El contador correspondiente cuenta todos los flan‐
cos en la entrada digital.

Sentido de contaje
Con este parámetro se define el sentido de contaje del contador correspondiente.
Puede escoger entre las siguientes opciones:
● Ascendente
● Descendente

Activar salida
Con este parámetro se determina la función (Página 79) con la que se controla el bit de
respuesta STS_DQ. El bit de respuesta STS_DQ puede emplearse para controlar una salida
digital de un módulo de salidas digitales.
Puede escoger entre las siguientes opciones:
Opción

Significado

Off (DQ = 0)

STS_DQ es independiente del valor de contaje y
está siempre desactivado.

Off (DQ = 1)

STS_DQ es independiente del valor de contaje y
está siempre activado.

Entre valor de comparación 0 y 1

STS_DQ se activa si el valor de contaje está entre
el valor de comparación 0 y el valor de compara‐
ción 1.

No comprendido entre valor de comparación 0 y 1 STS_DQ se activa si el valor de contaje está fuera
del rango comprendido entre el valor de compara‐
ción 0 y el valor de comparación 1.
Entre valor de comparación y límite de contaje su‐ STS_DQ se activa si el valor de contaje está entre
perior
el valor de comparación y el límite superior de
contaje.
Entre valor de comparación y límite de contaje in‐ STS_DQ se activa si el valor de contaje está entre
ferior
el valor de comparación y el límite inferior de con‐
taje.

Ajustar función de la DI
Con este parámetro se define qué función dispara la entrada digital DIn+4 correspondiente
durante la conmutación.

186

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
Puede escoger entre las siguientes opciones:
Opción

Significado

Entrada digital sin función

La entrada digital DIn+4 correspondiente no tiene
asignada función alguna. La CPU puede leer el
estado lógico de DIn+4 a través de la interfaz de
respuesta.

Apertura/cierre de puerta

Al activar la correspondiente entrada digital DIn+4
se abre la puerta HW (Página 78) para DIn. Al de‐
sactivar la correspondiente entrada digital DIn+4 se
cierra la puerta HW para DIn.

Sentido de contaje

La entrada digital correspondiente DIn+4 determina
el sentido de contaje de DIn para adaptarlo al pro‐
ceso. Si DIn+4 no está activada DIn cuenta hacia
delante. Si DIn+4 está activada DIn cuenta hacia
atrás.

Nota
Si se ha seleccionado "Sentido de contaje" y cambia el sentido de contaje en el proceso, el
flanco de contaje se adapta automáticamente (flancos contrarios).

Límite superior de contaje
Con la parametrización del límite superior de contaje se limita el rango de contaje. El valor
máximo para el límite superior de contaje depende del módulo:
Límite superior de contaje

DI 8x24VDC HS,

DI 32x24VDC HF,

DIQ 16x24VDC/0.5A 8xM12

DI 16x24VDC HF

Valor máximo

2147483647 (231–1)

4294967295 (232–1)

Ajuste predeterminado

2147483647

4294967295

Debe introducirse un valor que esté por encima del límite inferior de contaje.

Límite inferior de contaje
Con la parametrización del límite inferior de contaje se limita el rango de contaje. El valor
mínimo para el límite inferior de contaje depende del módulo:
Límite inferior de contaje

DI 8x24VDC HS,

DI 32x24VDC HF,

DIQ 16x24VDC/0.5A 8xM12

DI 16x24VDC HF

Valor mínimo

–2147483648 (–2 )

0 (no parametrizable)

Ajuste predeterminado

0

0

31

Debe introducirse un valor que esté por debajo del límite superior de contaje.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

187

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Valor inicial
Con la parametrización del valor inicial se establece con qué valor se inicia el contaje. Debe
introducir un valor igual a los límites de contaje o comprendido entre ellos.
El ajuste predeterminado es "0".

Valor de comparación
Con la parametrización de un valor de comparación (Página 79) se define con qué valor de
contaje se controla el bit de respuesta STS_DQ sobre la base de la función de comparación
seleccionada en "Activar salida".
Debe introducirse un valor mayor o igual que el límite inferior de contaje y menor o igual que
el límite superior de contaje.
El ajuste predeterminado depende del módulo:
Valor de referencia
Ajuste predeterminado

DI 8x24VDC HS,

DI 32x24VDC HF,

DIQ 16x24VDC/0.5A 8xM12

DI 16x24VDC HF

10

1

Valor de comparación 0
Con la parametrización de un Valor de comparación (Página 79) se define con qué valor de
contaje se controla el bit de respuesta STS_DQ sobre la base de la función de comparación
seleccionada en "Activar salida".
Debe introducirse un valor mayor o igual que el límite inferior de contaje y menor que el valor
de comparación 1.
El ajuste predeterminado es "0".

Valor de comparación 1
Con la parametrización del segundo Valor de comparación (Página 79) se define con qué valor
de contaje siguiente se controla el bit de respuesta STS_DQ sobre la base de la función de
comparación seleccionada en "Activar salida".
Debe introducirse un valor mayor que el valor de comparación 0 y menor o igual al límite
superior de contaje.
El ajuste predeterminado es "10".

Alarma de proceso: Aparecido evento de comparación para DQ
En S7-1500 y ET200AL, con este parámetro se define si en un evento de comparación se
genera una alarma de proceso debido a la función de comparación seleccionada en "Activar
salida".
La alarma de proceso no está habilitada de forma predeterminada.

188

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Módulo Online y diagnóstico
Indicación y evaluación del diagnóstico
Por medio de la vista online y de diagnóstico puede realizar un diagnóstico del hardware.
Además, puede:
● Recibir información a través del módulo (p. ej. la versión de Firmware y el número de serie).
● Si es necesario, realice una actualización del firmware.

Procedimiento
Para abrir el editor de visualización para las funciones de diagnóstico, haga lo siguiente:
1. Abra la configuración del equipo de la CPU o el IM.
2. Seleccione la vista de dispositivos.
3. Haga clic con el botón derecho del ratón en el módulo y seleccione "Online y diagnóstico".
4. Haga clic en la visualización deseada en el árbol de diagnóstico.

Más información
Para más información sobre los avisos de diagnóstico y sobre posibles remedios, consulte el
manual de producto del módulo.

1.1.4.3

Utilizar SIMATIC Drive Controller

Configuración y parametrización de SIMATIC Drive Controller
Agregar SIMATIC Drive Controller a la configuración hardware
Requisitos
Se ha creado el proyecto.

Procedimiento
1. Haga doble clic en "Agregar dispositivo".
Se abre el cuadro de diálogo "Agregar objeto".
2. Seleccione "Controladores".
3. Seleccione el SIMATIC Drive Controller:
"SIMATIC Drive Controller > Variante de CPU > Referencia"

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

189

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)
4. Con la casilla de verificación "Abrir la vista de dispositivos" se define si debe abrirse la vista
de la configuración hardware al concluir la creación de dispositivos. Deje activada la casilla
de verificación si desea parametrizar la CPU a continuación.
5. Confirme con "OK".

Acceso a la configuración hardware
Procedimiento
1. En el árbol del proyecto, debajo de la CPU, seleccione la entrada "Configuración de
dispositivo".
Se abrirá la vista de dispositivos.
2. En la vista de dispositivos, haga clic en la interfaz DI/DQ 8x24VDC [X142].
En la ventana de inspección, en "Propiedades", se pueden ajustar las propiedades
parametrizables. En "Parámetros de canal" encontrará una sinopsis de todos los canales y
los ajustes elegidos. Para parametrizar los canales deseados, haga clic en el símbolo de
flecha situado detrás del número de canal en la sinopsis. También puede seleccionar el
canal directamente en el árbol.
3. Seleccione el modo de operación "Medición de duración del periodo/evento" para el canal
deseado.

Modo de operación Medición de duración del periodo/evento
El modo de operación Medición de duración del periodo/evento (Página 83) permite contar
flancos ascendentes, así como determinar la duración del periodo entre dos flancos
ascendentes.
En el modo de operación Medición de duración del periodo/evento se pueden ajustar los
parámetros siguientes:

Inversión
Para adaptar la señal de 24 V a su proceso, puede invertir la señal.
La señal no está invertida de forma predeterminada.

Retardo a la entrada
Al parametrizar el retardo a la entrada se suprimen las interferencias de señal en las entradas
digitales. Los cambios en la señal solo se consideran si permanecen estables durante más
tiempo que el retardo a la entrada ajustado.
Para poder capturar señales presentes muy breves en caso de frecuencias de contaje
elevadas, deberá ajustar un retardo a la entrada de 1 μs.
Puede escoger entre las siguientes opciones:
● 125 μs (predeterminado)
● 1 μs

190

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.1 Contaje, medición y lectura de posición (S7-1500)

Modo isócrono
La medición de duración del periodo/evento requiere el modo isócrono.
Para más información al respecto, consulte el manual de sistema del SIMATIC Drive Controller
(https://support.industry.siemens.com/cs/ww/es/view/109766665).

Módulo Online y diagnóstico
Indicación y evaluación del diagnóstico
Por medio de la vista online y de diagnóstico puede realizar un diagnóstico del hardware.
Además, puede:
● Recibir información sobre la CPU o SINAMICS Integrated (p. ej., la versión de Firmware y
el número de serie).
● Si es necesario, realice una actualización del firmware.

Procedimiento
Para abrir el editor de visualización de las funciones de diagnóstico de la CPU, haga lo
siguiente:
1. Abra la carpeta de la CPU en el árbol del proyecto.
2. Haga doble clic en el objeto "Online y diagnóstico".
3. Haga clic en la visualización deseada en el árbol de diagnóstico.

Más información
Para más información al respecto, consulte el manual de sistema del SIMATIC Drive Controller
(https://support.industry.siemens.com/cs/ww/es/view/109766665).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

191

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

1.2

Contaje y medición (S7-300, S7-400)

1.2.1

Contaje y medición

1.2.1.1

Principios básicos de contaje y medición

¿En qué consisten las tareas de contaje y medición?
Contaje y medición
Contar significa registrar y sumar eventos. Los módulos de contaje registran las señales de
encóder (impulsos) y las evalúan según corresponda.
En el modo de medición, los impulsos se detectan de forma precisa en el tiempo y, a partir de
ellos, se calculan los valores medidos correspondientes (por ejemplo, la frecuencia).

Conceptos básicos sobre la operación de contaje
Rangos y límites de contaje
En los dos rangos de contaje "0 a +32 bits" y "-31 a +31 bits", el módulo cuenta dentro de límites
de contaje diferentes. En los respectivos límites de contaje se detecta un rebase por exceso o
por defecto.
En el rango de contaje "-31 a +31 bits", el estado del contador se representa como
complemento a 2.
Rango de contaje
0 a +32 bits

1)

0 a 4.294.967.295
0 a FFFF FFFFH

-31 a +31 bits

–2 147 483 648 a
2 147 483 647
8000 0000H a
7FFF FFFFH

Rebase por exceso

Rebase por defecto

Al cambiar el estado del contador de
4 294 967 295 a 0

Al cambiar el estado del contador de
0 a 4 294 967 295

Al cambiar el estado del contador de
+2 147 483 647 a
–2 147 483 648

Al cambiar el estado del contador de
–2 147 483 648 a 2 147 483 647

Este rango de contaje sólo está disponible con FM x50‑1. Los valores sólo se pueden predeterminar y evaluar en formato
hexadecimal.

1)

Valor de carga
El valor de carga es el valor del contador a partir del cual el módulo comienza el contaje.
Durante el funcionamiento es posible predeterminar para el módulo un valor de carga
LOAD_VAL que sobrescribe el valor inicial.
El valor de carga se puede predeterminar directamente. En este caso, el módulo lo adoptará
directamente como nuevo valor de contaje y lo cargará de manera preparatoria.

192

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
El valor de carga se puede cargar de forma sólo preparatoria. Un valor de carga cargado de
forma preparatoria será adoptado por el módulo como nuevo valor de contaje en los eventos
siguientes:
● En todos los modos de contaje
– Al iniciar el contaje por interrupción de la puerta SW o HW (en la función de puerta de
interrupción al iniciar la puerta SW o HW se sigue contando desde el estado actual del
contador y no se adopta el valor de carga).
– Sincronización (a través del DI correspondiente)
– Congelar/redisparar (a través del DI correspondiente)
● Además, en los modos de contaje "Contaje único" y "Contaje periódico"
– Cuando se alcance el límite de contaje superior parametrizado con el sentido de contaje
principal adelante.
– Cuando se alcance 0 en el sentido de contaje principal atrás.

Control de puerta
La puerta de hardware (puerta HW) y la puerta de software (puerta SW) sirven para controlar,
es decir, iniciar y detener, los procesos de contaje del módulo.

Sentido principal de contaje
Si se parametriza un sentido principal de contaje (adelante o atrás) es posible limitar el rango
de contaje máximo a un rango más pequeño, ajustando para ello un límite de contaje superior.
El rango de contaje parametrizado está comprendido entonces entre 0 y el límite superior de
contaje ajustado. Ello permite p. ej. crear aplicaciones de contaje incrementales o
decrementales. El límite de contaje principal parametrizado no tiene efecto en la evaluación del
sentido cuando se detectan los impulsos de contaje.

Valores iniciales tras realizar la parametrización
Valor

Sentido principal de contaje

Valor inicial

Valor de carga

Ninguno

0

Adelante

0

Atrás

Límite de contaje superior parametrizado

Ninguno

0

Adelante

0

Atrás

Límite de contaje superior parametrizado

Valor de contaje

Valores de comparación 1 y 2 Ninguno

0

Adelante

0

Valor latch

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Atrás

Límite de contaje superior parametrizado

Ninguno

0

Adelante

0

Atrás

Límite de contaje superior parametrizado

193

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Comandos en los modos de contaje
Es posible aplicar comandos al contaje del módulo durante el funcionamiento:
Comando

Descripción

Abrir y cerrar puerta

El contaje comienza cuando se abre una puerta y se detiene al cerrarse la misma.

Activar contador 1)

El contador se pone en el valor de carga mediante diferentes señales (DI, señal de paso
por cero).

Congelar/redisparar 2)

Guardar el estado del contador y cargar el contador con el valor de carga al ocurrir un
flanco ascendente en DI-Start.

Congelar 2)

Guardar el estado del contador al ocurrir un flanco ascendente en DI-Start.

Medir tiempos entre dos flancos

3)

Medir tiempos entre dos flancos inmediatamente consecutivos en la entrada digital DIStart.

1)

sólo con FM 350‑1 y FM 450‑1

2)

sólo con FM 350‑1, ET 200S 1Count24V y ET 200S 1Count5V

3)

sólo con FM 350‑1

Modo isócrono
En modo isócrono, el módulo adopta bits de control y elementos de control de la interfaz de
control en cada ciclo PROFIBUS/PROFINET y devuelve su respuesta a ello en ese mismo
ciclo.
El módulo transfiere en cada ciclo PROFIBUS/PROFINET la lectura del contador o el valor de
congelación tal y como eran en el instante Ti, y los bits de estado tal y como eran en el instante
Ti.
Un estado del contador influido por señales de entrada de hardware sólo se transfiere durante
el propio ciclo cuando la señal de entrada ha aparecido antes del instante Ti.

Modos de contaje
Descripción general de los modos de contaje
Al preseleccionar un modo de operación se elige la funcionalidad con la que se utilizará el
módulo. La tabla siguiente ofrece una visión de conjunto de los modos de contaje.

194

Modo de operación

Descripción

Contaje sin fin (Página 195)
(con o sin puerta SW o puerta HW)

El módulo cuenta en modo sin fin a partir del estado actual
del contador.

Contaje único (Página 196)
(con puerta SW o con puerta HW)

El módulo comienza a contar a partir del valor de carga al
abrirse la puerta y se detiene en el límite de contaje.

Contaje periódico (Página 197)
(con puerta SW o con puerta HW)

El módulo cuenta al abrirse la puerta entre el valor de car‐
ga y el límite de contaje.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Contaje sin fin
Descripción
En este modo de operación, el módulo cuenta continuamente a partir del estado del contador:
● Cuando el contador alcanza el límite superior contando hacia adelante y recibe un impulso
de contaje adicional, salta al límite inferior de contaje y sigue contando desde allí sin perder
impulsos.
● Cuando el contador alcanza el límite inferior contando hacia atrás y recibe un impulso de
contaje adicional, salta al límite de contaje superior y sigue contando desde allí sin perder
impulsos.
Rango de contaje de ±31 bits:
● El límite de contaje superior está ajustado a +2 147 483 647 (231 - 1).
● El límite de contaje inferior está ajustado a -2 147 483 648 (-231).
Rango de contaje de 32 bits:
● El límite de contaje superior está ajustado a +4.294.967.295 (232 - 1).
● El límite de contaje inferior está ajustado a 0 (cero).

Comportamiento en los límites de contaje
Cuando el contador alcanza el límite superior o inferior y recibe un impulso de contaje
adicional, el contador se ajusta al límite de contaje opuesto. En la interfaz de realimentación y,
en dado caso, en el DB se activa el bit de estado correspondiente.
Límite de contaje alcanzado

Bit de estado

Límite superior de contaje

STS_OFLW se activa

Límite inferior

STS_UFLW se activa

Seleccionar el control de puerta
En este modo de operación se puede seleccionar el control de puerta. Existen las siguientes
posibilidades:
● Sin puerta (estándar)
● Puerta SW (Página 214)
● Puerta HW (Página 215), con control de nivel o de flanco
La figura siguiente muestra un ejemplo de contaje sin fin con control de puerta.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

195

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
(VWDGRGHOFRQWDGRU
/¯PLWHVXSHULRUGHFRQWDMH

(VWDGRGHOFRQWDGRU
/¯PLWHLQIHULRUGHFRQWDMH
,QLFLRGHSXHUWD

6WRSGHSXHUWD

+RUD

Contaje único
Descripción
En este modo de operación, el módulo cuenta una vez hasta un límite de contaje en el sentido
de contaje principal parametrizado y detiene luego el contaje automáticamente.

Comportamiento en los límites de contaje
Cuando el contador alcanza el límite superior o inferior y recibe un impulso de contaje
adicional, el contador se ajusta
● en el caso del contaje sin sentido principal de contaje (Página 198) al límite de contaje
opuesto.,
● al valor de carga si se está contando con sentido de contaje principal (Página 198).
A continuación, la puerta se cierra y el contaje finaliza, aunque el parámetro/el bit de control
SW_GATE siga activado o la puerta HW continúe abierta. En la interfaz de notificación/en el
DB se activa el bit de estado correspondiente:
Límite de contaje alcanzado

Bit de estado

Límite superior de contaje

STS_OFLW se activa

Límite inferior de contaje

STS_UFLW se activa

Para volver a iniciar el contador es preciso volver a activar el parámetro/el bit de control
SW_GATE o volver a abrir la puerta HW. El contaje continuará entonces a partir del valor de
carga.

Seleccionar el control de puerta
En este modo de operación se puede seleccionar el control de puerta. Para ello se dispone de
varias posibilidades, a saber:
● Puerta SW (Página 214)
● Puerta HW (Página 215), con control de nivel o de flanco
La figura siguiente muestra un ejemplo de contaje único con valor de carga y control de puerta.

196

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
(VWDGRGHOFRQWDGRU
/¯PLWHVXSHULRUGH
FRQWDMH

676B2)/:

9DORUGH
FDUJD
/¯PLWHLQIHULRUGH
FRQWDMH

,QLFLR
GHSXHUWD

6WRS
GHSXHUWD

,QLFLR
GHSXHUWD

+RUD

Contaje periódico
Descripción
En este modo de operación, el módulo cuenta periódicamente con la puerta abierta, sin
detener el contaje en los límites.

Comportamiento en los límites de contaje
Si el contador
● ha alcanzado uno de los límites al contar sin sentido de contaje principal (Página 198),
● ha alcanzado el límite superior al contar con sentido de contaje principal adelante
(Página 198),
● ha alcanzado el límite inferior al contar con sentido de contaje principal atrás (Página 198),
y recibe un impulso de contaje adicional, el contador se ajustará al valor de carga a partir del
cual se sigue contando. En la interfaz de notificación/en el DB se activa el bit de estado
correspondiente.
Límite de contaje alcanzado

Bit de estado

Límite superior de contaje

STS_OFLW se activa

Límite inferior de contaje

STS_UFLW se activa

Seleccionar el control de puerta
En este modo de operación se puede seleccionar el control de puerta. Para ello se dispone de
varias posibilidades, a saber:
● Puerta SW (Página 214)
● Puerta HW (Página 215), con control de nivel o de flanco
La figura siguiente muestra un ejemplo de contaje periódico con valor de carga y control de
puerta.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

197

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
(VWDGRGHOFRQWDGRU
/¯PLWHVXSHULRUGHFRQWDMH

9DORUGHFDUJD
/¯PLWHLQIHULRUGHFRQWDMH
,QLFLRGHSXHUWD

6WRSGHSXHUWD

+RUD

Sentido principal de contaje
El sentido principal de contaje sólo puede seleccionarse en los modos de operación "Contaje
único", "Contaje periódico" y "Dosificación".
Es posible parametrizar el comportamiento siguiente:
● Ninguno (sin sentido principal de contaje)
● Adelante
● Atrás

Contaje único sin sentido principal de contaje
En el modo de operación “Contaje único" sin sentido principal de contaje, el módulo cuenta
desde el valor de carga – tras abrirse la puerta – adelante o atrás, hasta excederse uno de los
límites de contaje.
Al excederse uno de los límites de contaje se
● cierra la puerta,
● activa el bit STS_OFLW o STS_UFLW en la interfaz de notificación,
● activa el contador hasta el límite de contaje opuesto.
Los límites de contaje están ajustados fijamente al rango de contaje máximo.
El bit STS_ZERO o STS_ND se activa si el estado del contador es cero (pero no en el caso de
FM 350‑2).
Para reiniciar el contaje es preciso abrir la puerta de nuevo.

Contaje periódico sin sentido de contaje principal
En el modo de operación “Contaje periódico" sin sentido principal de contaje, el módulo cuenta
desde el valor de carga – tras abrirse la puerta – adelante o atrás, hasta excederse uno de los
límites de contaje.
Al excederse uno de los límites de contaje se
● activa el bit STS_OFLW o STS_UFLW en la interfaz de notificación,
● ajusta el contador al valor de carga a partir del cual se sigue contando.
Los límites de contaje están ajustados fijamente al rango de contaje máximo.

198

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
El bit STS_ZERO o STS_ND se activa si el estado del contador es cero (pero no en el caso de
FM 350‑2).
El contaje continúa hasta que se cierre la puerta.

Contaje único con sentido principal de contaje adelante
En los modos des operación "Contaje único" y "Dosificación" con sentido principal de contaje
adelante, el módulo cuenta desde el valor de carga – tras abrirse la puerta – adelante o atrás,
hasta excederse el límite de contaje superior.
Al excederse el límite de contaje superior se
● cierra la puerta,
● activa el bit STS_OFLW en la interfaz de notificación,
● carga en el contador el valor de carga.
El límite de contaje superior se puede parametrizar, el valor de carga tiene su valor inicial y se
puede modificar.
Para reiniciar el contaje es preciso abrir la puerta de nuevo.

Contaje periódico con sentido de contaje principal adelante
En el modo de operación "Contaje periódico" con sentido de contaje principal adelante, el
módulo cuenta desde el valor de carga – tras abrirse la puerta – adelante o atrás, hasta
excederse el límite de contaje superior.
Al excederse el límite de contaje superior se
● activa el bit STS_OFLW en la interfaz de notificación,
● ajusta el contador al valor de carga a partir del cual se sigue contando.
El límite de contaje superior se puede parametrizar, el valor de carga tiene su valor inicial y se
puede modificar.
El contaje continúa hasta que se cierre la puerta.

Contaje único con sentido principal de contaje atrás
En los modos des operación "Contaje único" y "Dosificación" con sentido principal de contaje
atrás, el módulo cuenta desde el valor de carga – tras abrirse la puerta – adelante o atrás, hasta
excederse el límite de contaje inferior.
Al excederse el límite de contaje inferior se
● cierra la puerta,
● activa el bit STS_UFLW en la interfaz de notificación,
● carga en el contador el valor de carga.
El límite de contaje inferior se establece de forma fija a 0, el valor de carga tiene su valor inicial
y se puede modificar.
Para reiniciar el contaje es preciso abrir la puerta de nuevo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

199

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Contaje periódico con sentido de contaje principal atrás
En el modo de operación "Contaje periódico" con sentido principal de contaje atrás, el módulo
cuenta desde el valor de carga – tras abrirse la puerta – adelante o atrás, hasta excederse el
límite de contaje inferior.
Al excederse el límite de contaje inferior se
● activa el bit STS_UFLW en la interfaz de notificación,
● ajusta el contador al valor de carga a partir del cual se sigue contando.
El límite de contaje inferior se establece de forma fija a 0, el valor de carga tiene su valor inicial
y se puede modificar.
El contaje continúa hasta que se cierre la puerta.

Conceptos básicos sobre la operación de medición
Rangos de medida
En los modos de medición existen los siguientes rangos de medida para los grupos:
Modo de operación

Rango de medida

Medición de frecuencia

0,1 Hz 1) a 650.000 Hz (según el módulo)

Medición de velocidad

hasta 25.000 /min

Medición del período

hasta 120 s

1)

El límite inferior de 0,1 Hz está condicionado por el tiempo de actualización máxima de 10 s. La resolución del valor es
0,001 Hz.

Tiempo de actualización/integración
El módulo actualiza los valores medidos cíclicamente. Para calcular el tiempo de actualización/
integración predetermine el parámetro "Tiempo de medición" como factor n.
Cálculo del tiempo de actualización/integración:
Condiciones marco

Tiempo de actua‐
lización/integra‐
ción

nmín

n × 10 ms

1

Modo no isócrono

TDP cualquiera

Funcionamiento
isócrono 2)

TDP < 10 ms

n × TDP

TDP ≥ 10 ms

n × TDP

1)

Rango de valores de n
nmáx
1000 3)

( 10 ms/TDP [ms] ) + 1
1

1)

1000 3)
10000 3) ms/TDP [ms] 1)

Las posiciones decimales que surgen con la división entre TDP se suprimen.

Estos límites no se pueden infringir. En caso de exceder estos límites, el módulo generará un error de parametrización y no
cambiará al modo isócrono.
2)

no con FM 350‑2

3)

en la medición del período: 120000

Una vez transcurrido cada tiempo de actualización/integración, el valor medido de la interfaz
de realimentación se actualiza y el bit STS_CMP1 o STS_COMP1 se activa.

200

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Principio de medición
El módulo cuenta cada flanco ascendente de un impulso y le asigna un valor de tiempo en μs.
El tiempo de medición dinámico está definido como la diferencia entre dos valores de tiempo.
En una secuencia de impulsos con uno o varios impulsos por intervalo de tiempo de
actualización vale lo siguiente:
Tiempo de medición diná‐ valor de tiempo del último impulso en el intervalo actual del tiempo
mico =
de actualización
menos
Valor de tiempo del último impulso en el intervalo de tiempo de
actualización precedente.
Si tras calcular el tiempo de medición dinámico aparecen intervalos de actualización sin
impulsos, entonces el tiempo de medición se prolonga en estos intervalos. En este caso se
acepta un impulso al final del tiempo de actualización y el intervalo de medida se calcula desde
ahí hasta el último impulso producido. Así, el número de impulsos es 1. Si el valor "1 impulso
por tiempo de medición dinámico" es inferior al último valor medido, entonces este valor se
emite como nuevo valor. La figura muestra el principio de medición.
7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
PHGLFLµQ
GLQ£PLFR

7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
PHGLFLµQ
GLQ£PLFR

7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
PHGLFLµQ
GLQ£PLFR

7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
PHGLFLµQ
GLQ£PLFR

7LHPSRGH
DFWXDOL]DFLµQ

7LHPSRGH
PHGLFLµQ
GLQ£PLFR
7LHPSRGH
PHGLFLµQ
GLQ£PLFR

Procedimiento de medición
El módulo mide de forma continua. En la parametrización se preselecciona un tiempo de
actualización.
En el tiempo que transcurre hasta finalizar el primer tiempo de actualización se retorna el valor
"-1". El primer tiempo de actualización comienza al abrirse la puerta.
La medición continua comienza tras abrirse la puerta con el primer impulso de la secuencia de
impulsos a medir. El primer valor medido no se calcula hasta después del segundo impulso.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

201

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Cada vez que finaliza el tiempo de actualización se retorna un valor medido en la interfaz de
realimentación (frecuencia, duración del periodo o velocidad). El final de una medición se
notifica mediante los bits de estado STS_CMP1 o STS_COMP1 (en FM 350‑2). Este bit se
resetea mediante el principio de realimentación completo con los bits RES_ZERO y
STS_RES_ZERO o RES_STS y RES_STS_A.
Si el sentido de rotación se invierte durante un tiempo de actualización, el valor medido para
este período es incierto. Evaluando los bits de realimentación para el sentido es posible
reaccionar a posibles irregularidades del proceso.
La figura siguiente explica el principio de la medición continua con el ejemplo de una medición
de frecuencia.
3XHUWD

7UHQGH
,PSXOVRV
9DORUGH
PHGLGD















202

7LHPSRGHDFWXDOL]DFLµQ

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Vigilancia de límites
Los valores límite cumplen todas y cada una de las condiciones siguientes:
● Límite inferior ≥ límite inferior del rango de medición no alcanzado
● Límite superior ≤ límite superior del rango de medición no alcanzado
● Límite superior ≥ (límite inferior +1)
Cada vez que finaliza un tiempo de actualización se compara el valor medido (frecuencia,
velocidad o duración del período) con los valores límite parametrizados superior e inferior. La
comparación da el siguiente resultado:
Si el valor medido es...

...se activa el siguiente bit en el estado:

mayor que el límite superior,

STS_OFLW

menor que el límite inferior,

STS_UFLW

Además se puede generar una alarma de proceso.
La figura siguiente muestra el estado del bit de estado para la vigilancia de límites en los modos
de medición.
676B2)/:


676B8)/:




/¯PLWHLQIHULRU

/¯PLWHVXSHULRU

9DORUGHPHGLGD

Los bits STS_OFLW y STS_UFLW se tienen que desactivar con los bits RES_ZERO y
STS_RES_ZERO o RES_STS mediante el principio de acuse completo. Si después del acuse
el valor medido se sigue encontrando o se encuentra nuevamente fuera de los límites, se
vuelve a activar el bit de estado.
Con la parametrización adecuada también se puede conmutar la salida correspondiente DOn
con la vigilancia de límites.

Control de puerta
La puerta de hardware (puerta HW) y la puerta de software (puerta SW) sirven para controlar,
es decir, iniciar y detener, los procesos de medición.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

203

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Comandos en los modos de medición
Es posible influir durante el funcionamiento en el proceso de medición del módulo con
comandos:
Denominación

Descripción

Abrir y cerrar puerta

El proceso de medición se inicia al abrir una puerta y se finaliza al
cerrarla.

Modo isócrono
En el modo isócrono, el módulo toma en cada ciclo PROFIBUS/PROFINET las señales de
control de la interfaz de control en el instante To. De este modo todos los controles se ejecutan
de forma síncrona y se hacen efectivos en el instante To. La respuesta al controlador se
devuelve ya en el mismo ciclo PROFIBUS/PROFINET.
El módulo devuelve un valor medido y los bits de estado en cada ciclo PROFIBUS/PROFINET
en el instante Ti.
La medición empieza y termina siempre en el instante Ti.
Nota
Como el tiempo de actualización en el modo no isócrono se indica en múltiplos enteros de 10
ms, pero en el modo isócrono en múltiplos enteros del tiempo de ciclo de bus, al cambiar entre
uno y otro modo de operación hay que adaptar siempre el parámetro Tiempo de actualización
si se desea mantener el tiempo de actualización real.

Modos de medición
Descripción general de los modos de medición
Al preseleccionar un modo de operación se elige la funcionalidad con la que se utilizará el
módulo. La tabla siguiente ofrece una visión de conjunto de los modos de medición.
Modo de operación

Descripción

Medición de frecuencia (Pági‐
na 205)

El módulo cuenta los impulsos que llegan en un tiempo de medición
dinámico 1) y calcula a partir de ahí la frecuencia.

Medición de velocidad de rota‐
ción (Página 206)

El módulo cuenta los impulsos que llegan de un encóder de veloci‐
dad en un tiempo de medición dinámico 1) y calcula a partir de ello la
velocidad con los impulsos por vuelta del encóder.

Medición del periodo (Pági‐
na 208)

El módulo indica el tiempo de medición dinámico 1) como duración
del período. Si el período es inferior al tiempo de actualización, se
crea un valor medio para el período.

1)

204

El tiempo de medición dinámico significa: Si no se detectan 2 flancos en la señal de medición antes
de transcurrir el tiempo de medición parametrizado, se calcula un valor medido aproximado con el
tiempo de medición dinámico. En este caso se supone que, al final del tiempo de actualización,
aparece un impulso. Con ello se obtiene un valor medido continuo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Nota
El FM 450‑1 no soporta ningún modo de medición.

Medición de frecuencia
Descripción
En este modo de operación, el módulo cuenta los impulsos que aparecen en un tiempo de
medición dinámico o en un tiempo de integración especificado. La frecuencia se calcula a partir
de aquí en combinación con las marcas de tiempo de los flancos.

Seleccionar el control de puerta
En este modo de operación se puede seleccionar el control de puerta. Para ello se dispone de
varias posibilidades, a saber:
● Puerta SW (Página 214)
● Puerta HW (Página 215), con control de nivel o de flanco
La figura siguiente muestra un ejemplo de medición de frecuencia con control de puerta.
7LHPSRGHDFWXDOL]DFLµQ 7LHPSRGHDFWXDOL]DFLµQ

,PSXOVRVGHFRQWDMH

3XHUWDLQWHUQD
)LQGHOD
0HGLFLµQGHIUHFXHQFLD

,QLFLRGHOD
0HGLFLµQGHIUHFXHQFLD

Rangos de medición posibles con información de errores
La tabla siguiente muestra los rangos de medida y el error absoluto para las mediciones de
frecuencia continuas.
Frecuencia f

Error absoluto
FM 350‑1
ET 200S 1Count5V

ET 200S 1Count24V

0,1 Hz

± 0,001 Hz

1 Hz

± 0,001 Hz

10 Hz

± 0,003 Hz

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

205

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Frecuencia f

Error absoluto
FM 350‑1
ET 200S 1Count5V

ET 200S 1Count24V

100 Hz

± 0,02 Hz

1 000 Hz

± 0,18 Hz

10 000 Hz

± 1,8 Hz

100.000 Hz

± 18 Hz

500 000 Hz

± 90 Hz

–

La tabla siguiente muestra los rangos de medida y el error absoluto para las mediciones de
frecuencia con tiempo de integración.
Tiempo de inte‐
gración

fmin ± error absoluto

fmáx ± error absoluto
ET 200S 1Count24V

ET 200S 1Count5V

10 s

0,1 Hz ± 0,001 Hz

100.000 Hz ± 18 Hz

500.000 Hz ± 90 Hz

1s

1 Hz ± 0,001 Hz

100.000 Hz ± 11 Hz

500.000 Hz ± 55 Hz

0,1 s

10 Hz ± 0,002 Hz

100.000 Hz ± 10 Hz

500.000 Hz ± 52 Hz

0,01 s

100 Hz ± 0,013 Hz

100.000 Hz ± 13 Hz

500.000 Hz ± 63 Hz

Valores modificables durante el funcionamiento
Durante el funcionamiento es posible modificar los siguientes valores:
● Valor límite inferior
● Valor límite superior
● Tiempo de actualización (tiempo de medición) 1)
● Función de la salida digital 1)
1)

no con FM 350‑2

Resultado
El final de una medición de frecuencia se notifica con el bit de estado STS_CMP1 o
STS_COMP1 (con FM 350‑2). El valor de la frecuencia medida se pone a disposición con la
unidad 10-3 Hz. El valor de frecuencia medido puede leerse en la interfaz de notificación.

Medición de velocidad
Descripción
En este modo de operación, el módulo cuenta los impulsos que llegan de un encóder de
velocidad en un tiempo de medición dinámico o en un tiempo de integración especificado y
mide el intervalo entre los flancos. A partir ahí calcula la velocidad con los impulsos por vuelta
del encóder.
Para el modo "Medición de velocidad" es preciso parametrizar adicionalmente los impulsos por
vuelta del encóder.

206

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar el control de puerta
En este modo de operación se puede seleccionar el control de puerta. Para ello se dispone de
varias posibilidades, a saber:
● Puerta SW (Página 214)
● Puerta HW (Página 215), con control de nivel o de flanco
La figura siguiente muestra un ejemplo de medición de velocidad con control de puerta.
7LHPSRGHDFWXDOL]DFLµQ 7LHPSRGHDFWXDOL]DFLµQ

,PSXOVRVGHFRQWDMH

3XHUWDLQWHUQD
)LQGHODPHGLFLµQGH
YHORFLGDG

,QLFLRGHODPHGLFLµQGH
YHORFLGDG

Rangos de medición posibles con información de errores
La tabla siguiente muestra los rangos de medida y el error absoluto para las mediciones de
velocidad continuas cuando el número de impulsos por vuelta del encóder = 60.
Velocidad n

Error absoluto

1/min

± 0,04 /min

10 /min

± 0,04 /min

100 /min

± 0,05 /min

1.000 /min

± 0,21 /min

10.000 /min

± 1,82 /min

25.000 /min

± 4,50 /min

La tabla siguiente muestra los rangos de medida y el error absoluto para las mediciones de
velocidad con tiempo de integración cuando el número de impulsos por vuelta del encóder = 60.
Tiempo de integración

nmín ± error absoluto

nmáx ± error absoluto

10 s

1 /min ± 0,03 /min

25.000 /min ± 4,5 /min

1s

1 /min ± 0,03 /min

25.000 /min ± 2,8 /min

0,1 s

10 /min ± 0,03 /min

25.000 /min ± 2,6 /min

0,01 s

100 /min ± 0,04 /min

25.000 /min ± 3,2 /min

Valores modificables durante el funcionamiento
Durante el funcionamiento es posible modificar los siguientes valores:
● Valor límite inferior
● Valor límite superior

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

207

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● Tiempo de actualización (tiempo de medición) 1)
● Función de la salida digital 1)
1)

no con FM 350‑2

Resultado
El final de una medición de velocidad se notifica con el bit de estado STS_CMP1 o
STS_COMP1 (con FM 350‑2). El valor de la velocidad medida se pone a disposición con la
unidad 10-3 /min. La velocidad medida puede leerse en la interfaz de notificación.

Medición del período
Descripción
En este modo de operación, el grupo indica el tiempo de medición dinámico como período. Si
el período es inferior al tiempo de actualización, se crea un valor medio para el período.
En el modo de operación "Medición del período con tiempo de integración", el 1Count24V mide
el tiempo entre dos flancos ascendentes de la señal de contaje contando los impulsos de una
frecuencia interna de referencia (16 MHz) de precisión de cuarzo dentro de un tiempo de
integración especificado.

Seleccionar el control de puerta
En este modo de operación se puede seleccionar el control de puerta. Para ello se dispone de
varias posibilidades, a saber:
● Puerta SW (Página 214)
● Puerta HW (Página 215), con control de nivel o de flanco
La figura siguiente muestra un ejemplo de medición del período con control de puerta.
7LHPSRGHDFWXDOL]DFLµQ

7LHPSRGHDFWXDOL]DFLµQ

3HU¯RGR

,PSXOVRVGHFRQWDMH

3XHUWDLQWHUQD

208

,QLFLRGHODPHGLFLµQGHO
SHU¯RGR

)LQGHODPHGLFLµQGHO
SHU¯RGR

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Rangos de medición posibles con información de errores
Medición continua del período:
● En mediciones continuas del período con una resolución de 1 µs, el error absoluto es de
0,1% del valor medido.
● La tabla siguiente muestra los rangos de medida y el error absoluto para las mediciones del
período continuas con una resolución de 1/16 µs.
Período Tmín ± error absoluto
1/16 μs × (160 ± 1)
1/16 μs × (1.600 ± 1)
1/16 μs × (16.000 ± 3)
1/16 μs × (160.000 ± 20)
1/16 µs × (1.600.000 ± 160)
1/16 µs × (16.000.000 ± 1.600)
1/16 µs × (160.000.000 ± 16.000)
1/16 µs × (1.600.000.000 ± 160.000)

Mediciones de período con tiempo de integración:
● La tabla siguiente muestra los rangos de medida y el error absoluto para las mediciones de
período con tiempo de integración con una resolución de 1 µs.
Tiempo de integra‐
ción

Tmin ± error absoluto

T ± error absoluto

100 s

1 µs × (10 ± 0)

1 µs × (100.000.000 ± 10.000)

10 s

1 µs × (10 ± 0)

1 µs × (10.000.000 ± 1.000)

1s

1 µs × (10 ± 0)

1 µs × (1.000.000 ± 100)

0,1 s

1 µs × (10 ± 0)

1 µs × (100.000 ± 10)

0,01 s

1 µs × (10 ± 0)

1 µs × (10.000 ± 1)

● La tabla siguiente muestra los rangos de medida y el error absoluto para las mediciones de
período con tiempo de integración con una resolución de 1/16 µs.
Tiempo de integra‐
ción

Tmin ± error absoluto

T ± error absoluto

100 s

1/16 µs × (160 ± 0)

1/16 µs × (1.600.000.000 ± 160.000)

10 s

1/16 µs × (160 ± 0)

1/16 µs × (160.000.000 ± 16.000)

1s

1/16 µs × (160 ± 0)

1/16 µs × (16.000.000 ± 1.600)

0,1 s

1/16 µs × (160 ± 0)

1/16 µs × (1.600.000 ± 160)

0,01 s

1/16 µs × (160 ± 0)

1/16 µs × (160.000 ± 16)

Valores modificables durante el funcionamiento
Durante el funcionamiento es posible modificar los siguientes valores:
● Valor límite inferior
● Valor límite superior

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

209

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● Tiempo de actualización (tiempo de medición) 1)
● Función de la salida digital 1)
1)

no con FM 350‑2

Resultado
El final de una medición del período se notifica con el bit de estado STS_CMP1 o STS_COMP1
(con FM 350‑2). El valor del período medido se indica en 1 μs o 1/16 μs. El período medido
puede leerse en la interfaz de notificación.

Dosificación (sólo con FM 350-2)
Descripción
En este modo de operación se agrupan cuatro canales de contaje del FM 350‑2 en un solo
canal de dosificación. Cuando la puerta está abierta, el FM 350‑2 cuenta una única vez en el
sentido principal de contaje:
● Entre 0 y el límite de contaje superior parametrizado en el sentido principal de contaje
adelante.
Si se parametriza como sentido principal de contaje el hacia adelante, el valor inicial es 0
y hay que definir el valor final.
● Entre el límite de contaje superior parametrizado y 0 en el sentido principal de contaje atrás.
Si se parametriza como sentido principal de contaje el hacia atrás, hay que definir el valor
inicial y el final es 0.

Seleccionar el control de puerta
En este modo de operación se puede seleccionar el control de puerta. Para ello se dispone de
varias posibilidades, a saber:
● Puerta SW (Página 214)
● Puerta SW (Página 214) y puerta HW (Página 215)
Se puede añadir una puerta hardware a la puerta software. Las dos puertas actúan
conjuntamente como una operación lógica AND, lo que significa que el FM 350‑2 sólo
cuenta cuando ambas están abiertas.

Comportamiento en los límites de contaje, puerta software
Sentido principal de contaje adelante: Cuando el contador ha alcanzado el valor "Límite
superior de contaje – 1" y recibe otro impulso de contaje, el contador se pone a 0, la puerta
interna se cierra y el contaje se termina, aun cuando el bit SW_GATE0, 4 todavía esté activo.
El bit de estado correspondiente STS_OFLW0, 4 se activa. Así, el límite de contaje superior en
sí no se alcanza jamás.
Sentido principal de contaje atrás: Cuando el contador ha alcanzado el valor "1" y recibe otro
impulso de contaje, el contador se pone en el límite de contaje superior, la puerta interna se
cierra y se termina el contaje, aunque el bit SW_GATE0, 4 esté todavía activo. El bit de estado
correspondiente STS_UFLW0, 4 se activa. De este modo jamás se llega al valor "0".

210

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Para volver a iniciar el contador, es necesario desactivar el bit SW_GATE0, 4 y activarlo de
nuevo.

Comportamiento en los límites de contaje, puerta hardware
Sentido principal de contaje adelante: Cuando el contador ha alcanzado el valor "Límite
superior de contaje – 1" y recibe otro impulso de contaje, el contador se pone a 0, la puerta
interna se cierra y el contaje se termina, aun cuando el bit SW_GATE0, 4 y la entrada I0, I4
todavía estén activos. Así, el límite de contaje superior en sí no se alcanza jamás. El bit de
estado correspondiente STS_OFLW0, 4 se activa.
Sentido principal de contaje atrás: Cuando el contador ha alcanzado el valor "1" y recibe otro
impulso de contaje, el contador se establece el límite de contaje superior, la puerta interna se
cierra y el contaje se termina, aun cuando el bit SW_GATE0, 4 y la entrada I0, I4 todavía estén
activos. De este modo jamás se llega al valor "0". El bit de estado correspondiente
STS_UFLW0, 4 se activa.
Para volver a iniciar el contador, es necesario desactivar la entrada I0, I4 y activarla de nuevo.
Sólo es posible un nuevo contaje con la puerta hardware.

Valores de comparación
Para cada canal de dosificación del FM 350‑2 es posible parametrizar cuatro valores de
comparación dentro del rango de contaje parametrizado. También es posible definir por
parametrización si y bajo qué condiciones se activará una salida digital y/o se disparará una
alarma de proceso en relación con un valor de comparación. Para ello se pueden establecer
las condiciones siguientes:
● Cuando la lectura actual del contador coincide con un valor de comparación, se dispara una
alarma de proceso.
● Cuando la lectura actual del contador es mayor o igual a un valor de comparación, se activa
una salida digital.
● Cuando la lectura actual del contador es menor o igual a un valor de comparación, se activa
una salida digital.
La salida digital sólo se activa si ha habilitado la salida correspondiente con el bit CTRL_DQ0…
7.
Nota
Las salidas sólo se pueden activar si la CPU está en RUN y la puerta está abierta.

La figura siguiente muestra un ejemplo de dosificación en sentido principal de contaje atrás con
valores de comparación.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

211

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
(VWDGRGHOFRQWDGRU
9DORULQLFLDO


,QLFLRGH 9*/ 9*/
SXHUWD

6WRSGH ,QLFLRGH 9*/ 9*/ 6WRSGH
SXHUWD
SXHUWD
SXHUWD

+RUD

Valor de carga con anticipación
Dentro del área de contaje parametrizada, es posible definir de forma anticipada un valor de
carga con la CPU en modo RUN. El contador emplea este valor como nuevo valor inicial
cuando se dan los eventos siguientes:
● Cuando se alcanza el límite de contaje superior en el sentido de contaje principal adelante.
● Al alcanzar el valor 0 cuando el sentido del contaje es hacia atrás.
● Interrupción del contaje mediante una puerta software o hardware (cuando el contaje se
interrumpe no se utiliza el valor de carga).
En estos casos, el valor de carga es el nuevo valor inicial a partir del cual comienzan la
siguiente dosificación y todas las demás. El comportamiento parametrizado de las salidas y las
alarmas se mantiene igual.

Valor de carga directo
La lectura actual del contador se puede modificar con la CPU en modo RUN. El contador
tomará la nueva lectura del contador directamente como valor de dosificación actual.

Rango de valores para valores de carga
El rango de valores para los valores de carga depende del sentido principal de contaje
parametrizado. Consiste en:
● Desde 0 hasta el límite superior de contaje – 2 en el sentido principal de contaje adelante
● Desde el valor inicial hasta 2 en el sentido de contaje principal atrás

212

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Control de puerta
Funciones de puerta
Contaje con funciones de puerta
Muchas aplicaciones requieren que el contaje comience o se detenga en un instante
determinado, dependiendo de otros eventos. En los módulos de contaje, este tipo de inicio o
detención del contaje se consigue mediante una función de puerta. Cuando se abre la puerta,
los impulsos pasan al contador y comienza el contaje. Cuando la puerta se cierra, los impulsos
de contaje ya no pueden llegar al contador y el contaje se detiene.

Puerta software y puerta hardware
Los módulos de contaje poseen dos puertas:
● Una puerta de software (Página 214) (puerta SW) que se controla mediante el parámetro
de entrada/bit de control SW_GATE.
● Una puerta de hardware (Página 215) (puerta HW), que se controla a través de las señales
correspondientes en las entradas digitales del módulo.
Tenga en cuenta también las informaciones sobre el funcionamiento de la puerta en el modo
isócrono (Página 216).

Puerta interna
La puerta interna es la combinación lógica AND de una puerta hardware y una puerta software.
El estado de la puerta interna se indica mediante el bit STS_GATE.
Si no se ha parametrizado ninguna puerta hardware, sólo es relevante el ajuste de la puerta
software. El contaje se activa, interrumpe, continúa y cancela mediante la puerta interna. La
puerta interna también puede cerrarse con eventos que dependan de la lectura del contador
en los modos de operación "Contaje único" y "Dosificación".
Puerta hardware

Puerta software

Puerta interna

Proceso de contaje

Abierta

Abierta

Abierta

Activo

Abierta

Cerrada

Cerrada

Inactivo

Cerrada

Abierta

Cerrada

Inactivo

Cerrada

Cerrada

Cerrada

Inactivo

Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cuando se cancela (Página 216), el contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Cuando se interrumpe (Página 216), el contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

213

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Ejemplo
Al activar la señal de puerta, la puerta se abre y los impulsos se cuentan. Cuando la señal de
puerta se retira, ésta se cierra y el contador deja de registrar los impulsos de contaje. La lectura
del contador se mantiene constante.
La siguiente figura muestra la apertura y el cierre de una puerta y el contaje de los impulsos.






/HFWXUDGHOFRQWDGRU





,PSXOVRVGH
FRQWDMH
3XHUWDLQWHUQD

$EULU
ODSXHUWD

&HUUDUOD
SXHUWD

Finalizar el contaje con la función de parada por puerta
Además, en los módulos FM x50‑1 el contaje se puede finalizar independientemente de las
señales aplicadas o del estado de la puerta SW con la función de parada por puerta. A este
efecto, active el parámetro de entrada GATE_STP.
Si desactiva este parámetro, entonces solo podrá abrir la puerta con un flanco ascendente en
la entrada digital "DI-Start" (puerta HW) o volviendo a activar el parámetro de entrada
SW_GATE (puerta SW).

Puerta SW
La puerta SW se abre y se cierra con el parámetro de entrada/bit de control SW_GATE.

Apertura y cierre de la puerta SW
La figura siguiente muestra la apertura y el cierre de la puerta SW. No es posible parametrizar
ninguna puerta HW.
(VWDGRGHOFRQWDGRU
,PSXOVRVGHFRQWDMH
















6:B*$7(
%LWDFWLYDGR

%LWUHVWDEOHFLGR

La puerta SW:
● se abre activando el parámetro de entrada/bit de control SW_GATE.
● se cierra activando el parámetro de entrada/bit de control SW_GATE.
Una puerta cerrada puede volver a abrirse volviendo a activar el parámetro de entrada
SW_GATE.

214

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Puerta HW
La puerta HW se abre y se cierra aplicando o suprimiendo las señales pertinentes en las
entradas digitales correspondientes.
Al mismo tiempo, la puerta SW también tiene que estar abierta.

Abrir y cerrar la puerta HW de forma controlada por nivel

,PSXOVRVGHFRQWDMH







(VWDGRGHOFRQWDGRU





',6WDUW
$EHUWXUDGHOD
SXHUWD

&LHUUH
GHODSXHUWD

Mientras esté activada la entrada digital, los impulsos de contaje pueden alcanzar el contador
y se cuentan. Si se desactiva la entrada digital, se cerrará la puerta. Los impulsos de contaje
ya no se cuentan, el contador se para.
Si la puerta se cierra por un rebase por exceso o por defecto, primero hay que desactivar la
entrada digital y después reactivarla para volver a abrir la puerta.
La puerta HW controlada por nivel actúa con el primer flanco ascendente en la entrada digital
después de la parametrización.
ET 200S 1Count24V y 1Count5V:
El 1Count24V/1Count5V posee una puerta de hardware (puerta HW) que está controlada por
la entrada digital del módulo. La puerta HW se parametriza como función de la entrada digital
(función DI "Puerta HW"). Se abre cuando hay un flanco ascendente en la entrada digital y se
cierra cuando hay un flanco descendente.

Abrir y cerrar la puerta HW de forma controlada por flanco
Abrir y cerrar la puerta HW de forma controlada por flanco sólo es posible en el FM x50‑1.






(VWDGRGHOFRQWDGRU





,PSXOVRVGHFRQWDMH
',6WDUW

$EHUWXUDGHOD
SXHUWD

',6WRS
&LHUUH
GHODSXHUWD

Con la puerta controlada por flanco, la puerta HW se abre con un flanco ascendente en la
entrada digital "DI-Start". La puerta se cierra con un flanco ascendente en la entrada digital "DIStop".
Si hubiera simultáneamente un flanco ascendente en ambas entradas entonces se cerrará la
puerta si estaba abierta o bien permanecerá cerrada. si estaba cerrada. Si la entrada digital

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

215

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
"DI-Stop" está activada, entonces un flanco ascendente en la entrada digital "DI-Start" no
puede abrir la puerta.

Función de puerta de cancelación e interrupción
Al parametrizar la función de puerta se puede especificar si la puerta debe cancelar o
interrumpir el contaje.

Función de puerta de cancelación
En la función de puerta de cancelación el contaje comienza tras cerrar y reiniciar la puerta con
el valor de carga (instante ① en la figura siguiente).
La figura siguiente muestra un ejemplo de contaje sin fin hacia atrás con control de puerta de
cancelación.
(VWDGRGHOFRQWDGRU

཰

/¯PLWHVXSHULRUGH
FRQWDMH
9DORUGH
FDUJD
/¯PLWHLQIHULRUGH
FRQWDMH

,QLFLRGH
SXHUWD

6WRSGH
SXHUWD

,QLFLRGH
SXHUWD

+RUD

Función de puerta de interrupción
En la función de puerta de interrupción el contaje continúa tras cerrar y reiniciar la puerta con
el último valor de contaje actual (instante ① en la figura siguiente).
La figura siguiente muestra un ejemplo de contaje sin fin hacia adelante con control de puerta
de interrupción.
(VWDGRGHOFRQWDGRU

཰

/¯PLWHVXSHULRUGHFRQWDMH
9DORUGHFDUJD
/¯PLWHLQIHULRUGHFRQWDMH
,QLFLRGHSXHUWD

6WRSGHSXHUWD ,QLFLRGHSXHUWD +RUD

Control de puerta en modo isócrono
En el modo isócrono el control de puerta funciona de la siguiente manera:

216

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Control de puerta con puerta SW
El control de la puerta SW se realiza activando y desactivando el bit de control SW_GATE. El
contaje empieza y finaliza entonces en el instante To del siguiente ciclo PROFIBUS DP tras
cambiar el bit de control:
&LFOR'3

&LFOR'3

&LFOR'3

7'3

7'3
7L

7R

7R

&LFOR'3

7'3
7L

7R

&LFOR'3

7'3
7L

7R

7'3
7L

7R

7L

6:B*$7(

676B*$7(

&RQWDMH











 3UHSDFLµQGHOYDORUGHFRQWDMHDFWXDO
 3UHSDUDFLµQGHOYDORUGHFRQWDMHTXHHVWDEDDFWLYRDOILQDOL]DUHOFRQWDMH

Control de puerta con puerta HW
En el control de la puerta HW el contaje empieza y termina inmediatamente al abrirse y
cerrarse la puerta HW:
&LFOR'3
7'3
7R

7L

&LFOR'3
7'3
7R

7L

&LFOR'3
7'3

&LFOR'3
7'3

&LFOR'3
7'3

7R

7R

7R

7L

7L

7L

3XHUWD+:

676B*$7(

&RQWDMH











 3UHSDFLµQGHOYDORUGHFRQWDMHDFWXDO
 3UHSDUDFLµQGHOYDORUGHFRQWDMHTXHHVWDEDDFWLYRDOILQDOL]DUHOFRQWDMH

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

217

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Señales del encóder
Encoders compatibles
El módulo de contador puede procesar señales de contaje rectangulares generadas por
encóders incrementales o incrementales de posición.
● Los encóders incrementales hacen un barrido de retícula y de este modo generan impulsos
eléctricos rectangulares. Las diferencias residen en la amplitud del impulso y en la cantidad
de las señales. Los encóders incrementales proporcionan dos pistas desfasadas en 90°.
● Los encóders incrementales de posición, como las fotocélulas o los detectores de
proximidad (BERO), sólo proporcionan una señal rectangular con un nivel de tensión
específico.

Señales diferenciales de 5 V
Señales de contaje de los encóders incrementales de 5 V
El encóder incremental de 5 V proporciona al módulo las siguientes señales diferenciales
según RS 422:
● A y /A
● B y /B
● N y /N
Las señales /A, /B y /N son las señales invertidas de A, B y N. Las señales A y B están
desfasadas a 90° respectivamente.
En un encóder incremental de 5 V se utilizan las pistas A y B para contar. La pista N se utiliza
para poner el contador en el valor de carga siempre y cuando haya sido parametrizado así.
Los encóders que suministran para cada señal la señal inversa se denominan encóders
simétricos.
La siguiente figura muestra el cronograma de las señales de encóder de un encóder
incremental de 5 V.
6H³DO$
6H³DO$
6H³DO%
6H³DO%
6H³DO1
6H³DO1
6HQWLGRGHFRQWDMH

$GHODQWH

$WU£V

El módulo detecta el sentido de contaje por la relación entre las señales A y B.

218

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Cambiar el sentido de contaje
Con el parámetro "Sentido de contaje normal" o "Sentido de contaje invertido" puede cambiar
el sentido de contaje sin necesidad de cambiar el cableado.

Vigilancia de las señales del encóder
El módulo vigila si los cables están conectados y si hay una rotura de hilo o un cortocircuito.
Mediante la correspondiente parametrización puede definir cuáles de los tres pares de señales
deben vigilarse. Por ello no deben conectarse señales que no se utilicen si en la
parametrización se ha desactivado el diagnóstico del correspondiente par de señales
(vigilancia).
Si se notifican fallos para las tres señales, puede que el encóder esté defectuoso, que la
alimentación de encóder presente un cortocircuito o que no haya ningún encóder conectado.
Si el módulo detecta un fallo después de la parametrización, éste se registra en los registros
de diagnóstico DS0 y DS1. Con la correspondiente parametrización, ese hecho puede
provocar una alarma de diagnóstico.

Señales de 24 V
Señales de contaje de los encóders incrementales de 24 V
El encóder incremental de 24 V suministra al módulo las señales de 24 V A, B y N. Las señales
A* y B* están desfasadas 90° respectivamente.
Las señales con una tensión de 24 V se identifican con un *.
En un encóder incremental de 24 V se utilizan las pistas A y B para contar. La pista N* se utiliza
para poner el contador en el valor de carga siempre y cuando haya sido parametrizado así.
Los encóders que no suministran señales inversas se denominan encóders asimétricos.
La siguiente figura muestra el cronograma de las señales de encóder de un encóder
incremental de 24 V.
6H³DO$

6H³DO%

6H³DO1
$GHODQWH

$WU£V

El módulo detecta el sentido de contaje por la relación entre las señales A* y B*.
En las entradas de las señales de encóder de 24 V es posible parametrizar si se desean
conectar al contador salidas tipo PNP o contracontactos o bien salidas tipo NPN. Encontrará
más información al respecto en la descripción del encóder.
Modificar el sentido de contaje

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

219

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Con el parámetro "Sentido de contaje normal" o "Sentido de contaje inversa" puede cambiar
el sentido de contaje sin necesidad de cambiar el cableado.

Señales de contaje de encóders de impulsos de 24 V sin/con nivel de sentido
El encóder, por ejemplo un detector de proximidad (BERO) o una barrera luminosa, sólo
proporciona una señal de contaje, que debe conectarse a la conexión A* del conector frontal.
Adicionalmente puede conectar a la conexión B* del contador en cuestión una señal para
detectar el sentido. Si el encóder no proporciona la señal correspondiente, también puede
generar y conectar la correspondiente identificación dentro del programa de usuario o puede
utilizar una señal de proceso equivalente.
La siguiente figura muestra el cronograma de las señales de encóder de un encóder
incremental de posición de 24 V con nivel de sentido y los impulsos de contaje resultantes:
6H³DO$

6H³DO% 
FRPRQLYHO
GHVHQWLGR
,PSXOVRVGH
FRQWDMH
$GHODQWH
,PSXOVRVGH
FRQWDMH
$WU£V

$GHODQWH

$WU£V

Vigilancia de las señales de encóder
Para las señales de contaje de 24 V no se vigila rotura de hilo ni cortocircuito.

Interpretación de la señal
Vista general
El contador del módulo de contador cuenta los flancos de las señales. Normalmente, se evalúa
el flanco en A (A*) (evaluación individual). Para alcanzar mayor resolución, puede escoger una
de las siguientes opciones:
● Evaluación simple (Página 221)
● Doble evaluación (Página 221)
● Evaluación cuádruple (Página 221)
Sólo es posible una evaluación múltiple
● para encóders incrementales de 5 V con señales A y B desfasadas 90°
● para encóders incrementales de 24 V con señales A* y B* desfasadas 90°

Ajuste predeterminado
El ajuste predeterminado es "Evaluación simple".

220

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Evaluación simple
Evaluación simple significa que sólo se evalúa un flanco de A.
● Los impulsos de contaje adelante se registran con un flanco ascendente en A y nivel bajo
en B.
● Los impulsos de contaje atrás se registran con un flanco descendente de A y nivel bajo en
B.
La figura siguiente muestra la evaluación simple de las señales.
6H³DO$ $
6H³DO% %
,PSXOVRVGH
FRQWDMH
$GHODQWH
,PSXOVRVGH
FRQWDMH
$WU£V

$GHODQWH

$WU£V

Evaluación doble
Evaluación doble significa que se evalúan los flancos creciente y decreciente de la señal A. En
función del nivel de la señal B, se generan impulsos de contaje adelante o atrás.
La figura siguiente muestra la evaluación doble de las señales.
6H³DO$ $
6H³DO% %
,PSXOVRVGHFRQWDMH
$GHODQWH
,PSXOVRVGHFRQWDMH
$WU£V

$GHODQWH

$WU£V

Evaluación cuádruple
Evaluación cuádruple significa que se evalúan los flancos creciente y decreciente de A y B. En
función de los niveles de las señales A y B, se generan impulsos de contaje adelante o atrás.
La figura siguiente muestra la evaluación cuádruple de las señales.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

221

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

6H³DO$ $
6H³DO% %
,PSXOVRVGH
FRQWDMH
$GHODQWH
,PSXOVRVGH
FRQWDMH
$WU£V

1.2.1.2

$GHODQWH

$WU£V

Utilizar el FM 350-1

Asignación de pines del conector frontal del FM 350-1
Conector frontal
En el conector frontal de 20 pines se conectan:
● Señales de contaje
● Entradas digitales
● Salidas digitales
● Alimentación del encóder
● Tensión auxiliar y de carga
La figura siguiente muestra el lado frontal del módulo, el conector frontal y el lado interior de la
tapa frontal con la asignación de terminales.

222

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
/DGRIURQWDOGHOPµGXOR

&RQHFWRUIURQWDO

/DGRLQWHULRUGHODWDSDIURQWDO

)0
&2817(502'8/(

6)
&5
',5
























,

,

,


4

4






























































1

















/


0

/
0

0
'&9
6833/<
'&9
$$ 
$
%% 
%
11 

$+$(

Asignación de terminales del conector frontal
La tabla siguiente muestra la asignación de terminales del conector frontal del FM 350-1.
Terminal

Nombre

Entrada/
salida

Función

Tensión auxiliar
1

1L+

Entrada

2

1M

Entrada

Tensión auxiliar de 24 V
Tierra de la tensión auxiliar

Alimentación del encóder y señales
de contaje

Encóder de 5 V
RS 422, simétrico

Encóder de 24 V
asimétrico

Generador de impul‐ Detector de proxi‐
midad de 24 V
sos de 24 V con nivel
de sentido

3

1M

Salida

Tierra de la alimentación del encóder

4

5,2 V DC

Salida

Alimentación de 5,2 V del encóder

5

24 V DC

Salida

6

A A*

Entrada

Señal del encóder A

Alimentación de 24 V del encóder

7

/A

Entrada

Señal del encóder /A

8

B B*

Entrada

Señal del encóder B Señal del encóder
B*

9

/B

Entrada

Señal del encóder /B

10

N N*

Entrada

Señal del encóder N Señal del encóder
N*

11

/N

Entrada

Señal del encóder /N

12

—

—

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Señal del encóder A*
—
Señal de sentido

—

—
—
—
—

223

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Terminal

Nombre

Entrada/
salida

Función

Entradas y salidas digitales
13

I0

Entrada

Entrada digital DI-Start

14

I1

Entrada

Entrada digital DI-Stop

15

I2

Entrada

Entrada digital DI-Set

16

—

—

17

Q0

Salida

Salida digital DO0

18

Q1

Salida

Salida digital DO1

—

Tensión de carga
19

2L+

Entrada

Tensión de carga de 24 V

20

2M

Entrada

Tierra de la tensión de carga para las entradas y salidas digitales

Nota
Las conexiones para las entradas de contaje (alimentación del encóder, señales del encóder)
están unidas galvánicamente con masa de la CPU. Por eso debe conectar el borne 2 (1M) con
la masa de la CPU con una baja impedancia. Si falta esta conexión, podría ocurrir un fallo o una
avería en el FM 350-1.
Si los encóders se alimentan externamente, también se deberá conectar la masa de dicha
tensión externa con masa de la CPU.
Encontrará más información sobre la estructura y el cableado en el manual de producto (http://
support.automation.siemens.com/WW/view/es/1086726) del módulo de contaje FM 350-1.

Tensión auxiliar 1L+/1M
Para la alimentación de tensión de los encóders de 5 V y 24 V debe conectar una tensión
continua de 24 V en las conexiones 1L+ y 1M.
Un diodo integrado protege el módulo contra inversión de polaridad de la tensión auxiliar.
El módulo vigila si está conectada la tensión auxiliar.

Alimentación de encóder de 5,2 V DC
El módulo genera una tensión de 5,2 V a partir de la tensión auxiliar 1L+/1M con una intensidad
máxima de 300 mA, disponible en el terminal DC5.2V para la alimentación de un encóder de
5 V a prueba de cortocircuitos. Se comprueba si hay cortocircuitos en la alimentación del
encóder.

Alimentación de encóder de 24 V DC.
Para la alimentación de tensión de 24 V de un encóder, se pone a disposición la tensión 1L+/
1M en la salida DC24V a prueba de cortocircuitos. Se comprueba si hay cortocircuitos en la
alimentación del encóder.

224

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Señales de encóder de 5 V A y /A, B y /B, N y /N
Al conector frontal se pueden conectar encóders incrementales con señales diferenciales de
5 V conforme a RS 422, es decir, encóders incrementales con las señales diferenciales A y /A,
B y /B, N y /N.
Las señales A y /A, B y /B, N y /N se conectan a través de los terminales correspondientes.
Las señales N y /N sólo se conectan si se desea poner el contador a la marca cero del encóder.
Las entradas no disponen de aislamiento galvánico con el bus de la S7-300.

Señales de encóder de 24 V A*, B* y N*
Las señales de 24 V se identifican con las letras A*, B* y N*.
Se pueden conectar tres tipos de encóders diferentes, a saber:
● Encóders incrementales con señales de 24 V:
Las señales A*, B* y N* se conectan a través de los terminales correspondientes.
● Generador de impulsos sin nivel de sentido:
La señal se conecta al terminal A*.
● Generadores de impulsos con nivel de sentido:
La señal de contaje se conecta al terminal A*. El nivel de sentido se conecta al terminal B*.
Las entradas no disponen de aislamiento galvánico con el bus de la S7-300.

Filtro de entrada para señales de encóder de 24 V
Para eliminar fallos, puede parametrizar filtros de entrada (componentes RC) con un tiempo de
filtrado unitario para las entradas de 24 V A*, B* y N*. Se dispone de los dos filtros de entrada
siguientes:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Frecuencia de contaje máxima

200 kHz

20 kHz

Ancho de impulso mínimo de las señales de contaje

2,5 μs

25 μs

Entradas digitales DI-Start, DI-Stop y DI-Set
Las entradas digitales DI-Start y DI-Stop se pueden utilizar para el control de puerta del
contador. El control de puerta puede realizarse con control de nivel o de flanco.
La entrada digital DI-Set sirve para ajustar el contador al valor de carga.
Las entradas digitales funcionan con una tensión nominal de 24 V.
Las entradas digitales están separadas galvánicamente del bus posterior del S7-300 y de las
entradas del contador.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

225

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Filtro de entrada para entradas digitales
Con objeto de suprimir interferencias, se puede parametrizar un filtro de entrada (elementos
RC) con un tiempo de filtrado uniforme para las entradas digitales DI-Start, DI-Stop y DI-Set.
Se dispone de los dos filtros de entrada siguientes:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Ancho de impulso mínimo de las señales de en‐
trada

2,5 μs

25 μs

Salidas digitales DO0 y DO1
El FM 350-1 dispone de las salidas digitales DO0 y DO1 para disparar directamente procesos
de control.
Las salidas digitales se alimentan con la tensión de carga 2L+.
Las salidas digitales están separadas galvánicamente del bus posterior del S7-300 y de las
entradas del contador.
Las salidas digitales son salidas tipo PNP y pueden recibir una corriente de carga de 0,5 A.
Están protegidas contra sobrecarga y cortocircuito.
Nota
Se pueden conectar directamente relés y contactores sin circuitería externa.
El comportamiento temporal de las salidas digitales varía en función de la parametrización.

Tensión de carga 2L+/2M
Para alimentar las salidas digitales DQ0 y DQ1, el módulo se debe abastecer con una tensión
de carga de 24 V a través de los bornes 2L+ y 2M.
Un diodo integrado protege el módulo contra inversión de polaridad de la tensión de carga.
El FM 350-1 no vigila la tensión de carga 2L+/2M.

226

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Configuración del FM 350-1
Parametrización del FM 350-1
Modos de operación
Seleccionar el modo de operación
Descripción
Al preseleccionar un modo de operación se elige la funcionalidad con la que se utilizará el
módulo de contaje.
Modo de operación

Descripción

Contaje sin fin (Página 195) El FM 350‑1 cuenta en modo sin fin a partir del estado actual del contador.
(con o sin puerta)
Contaje único (Página 196) El FM 350‑1 comienza a contar a partir del valor de carga al abrirse la
(con puerta HW o SW)
puerta y se detiene en el límite de contaje.
Contaje periódico (Pági‐
na 197)
(con puerta HW o SW)

El FM 350‑1 comienza a contar al abrirse la puerta a partir del valor de
carga entre los límites de contaje.

Medición de la frecuencia
(Página 205)
(con puerta HW o SW)

El FM 350‑1 cuenta los impulsos que llegan en un tiempo de medición
dinámico.

Medición de la velocidad
(Página 206)
(con puerta HW o SW)

El FM 350‑1 cuenta los impulsos que llegan de un encóder de velocidad
en un tiempo de medición dinámico y calcula a partir de ello la velocidad
con los impulsos por vuelta del encóder.

Medición del período (Pági‐ El FM 350‑1 indica el tiempo de medición dinámico como duración del
na 208)
período. Si el período es inferior al tiempo de actualización, se crea un
(con puerta HW o SW)
valor medio para el período.

El ajuste predeterminado es el modo de operación "Contaje sin fin".

Determinar el límite superior de contaje
Descripción
Si se parametriza un límite superior de contaje en combinación con un sentido principal de
contaje (Página 233) (adelante o atrás) es posible limitar el rango de contaje máximo a un
rango más pequeño. El rango de contaje parametrizado está comprendido entonces entre 0 y
el límite superior de contaje ajustado.
El límite superior de contaje puede adoptar un valor > 1 hasta el límite superior del rango de
contaje.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

227

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Definir el tiempo de medición
Descripción
Si se ha seleccionado un modo de medición, el módulo actualiza los valores medidos de forma
cíclica. El tiempo de actualización es el producto del tiempo de medición x 10 ms. El tiempo de
medición se predefine como factor n.
Si desea obtener una descripción detallada sobre el rango de valores para el tiempo de
medición, consulte el apartado "Conceptos básicos sobre la operación de medición
(Página 200)".

Seleccionar el control de puerta
Descripción
Al preseleccionar un control de puerta se elige cómo se realizará el contaje en el modo de
operación seleccionado.
● Sin puerta
Todas las puertas están abiertas.
● Puerta SW (Página 214)
La puerta SW se abre y se cierra con el parámetro de entrada/bit de control SW_GATE.
● Puerta HW (Página 215), con control de nivel o de flanco
La puerta HW se abre y se cierra con las señales correspondientes en las entradas digitales
● Congelar (Página 228)
Con flancos en la entrada digital "DI-Start" se pueden almacenar (congelar) estados del
contador.
● Congelar/redisparar (Página 230)
Con flancos en la entrada digital "DI-Start" se pueden almacenar (congelar) estados del
contador. Después de la operación de guardado, el contador se establece al valor de carga.
El ajuste predeterminado es "Sin puerta".

Congelar
Descripción
Seleccionando el control de puerta "Congelar", es posible guardar (congelar) estados del
contador con flancos en la entrada digital "DI-Start". Así, el estado del contador no cambia.

Requisitos
Para "congelar" es preciso utilizar la puerta SW (Página 214) y seleccionar el flanco para
congelar (Página 233).
El intervalo mínimo de los flancos de congelación es de 1 ms. Si el intervalo entre dos flancos
es menor, se pueden perder valores.

228

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Funcionamiento
El estado del contador y el valor de congelación están ajustados a sus valores iniciales. El valor
inicial es 0 con un modo de operación sin sentido principal de contaje y con sentido principal
de contaje "Adelante". Con el sentido principal de contaje "Atrás", el valor inicial es el límite de
contaje superior parametrizado.
La función de contaje se inicia cuando se abre la puerta SW. El contador comienza con el valor
de carga.
El valor de congelación siempre equivale al estado del contador en el instante en que aparece
el flanco.
El estado de "DI-Start" se indica en el DB con el bit de estado STS_STA.
El valor de congelación se indica en el DB con LATCH_LOAD.
La figura siguiente muestra un ejemplo de "Congelar" con el valor de carga = 0 y un flanco
ascendente en "DI-Start".

,PSXOVRVGH
FRQWDMH

*$7(B673


6:B*$7(

',6WDUW


(VWDGRGHO
FRQWDGRU

9DORUGH
FRQJHODFLµQ

Interrupción y finalización
Si cierra la puerta SW reseteando SW_GATE, el efecto es cancelante.
Con flancos en "DI-Start" se puede guardar nuevamente el estado no modificado del contador
incluso con la puerta SW cerrada.
Si la puerta SW se cierra con GATE_STP de la instrucción CNT_CTL1, se cancelará el contaje.
En tal caso ya no se podrán almacenar estados del contador con "DI-Start".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

229

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Alarma de proceso al "congelar"
El almacenamiento de valores de contaje mediante "Congelar" también puede provocar una
alarma de proceso. Esto puede hacer necesario un intervalo mayor entre los flancos. Si las
alarmas llegan más rápido de lo que pueden ser acusadas por el sistema, se pierden alarmas
de proceso. Esto se notifica mediante una alarma de diagnóstico.

Congelar/redisparar
Descripción
Seleccionando el control de puerta "Congelar/redisparar", es posible guardar (congelar)
estados del contador con flancos en la entrada digital "DI-Start". Cada vez que se almacenan
estados, el contador se inicializa con el valor de carga y sigue contando desde el valor de carga
(redisparar).

Requisitos
Para "Congelar/redisparar" es preciso utilizar la puerta SW (Página 214) y seleccionar el flanco
para congelar (Página 233).
El intervalo mínimo de los flancos de congelación es de 1 ms. Si el intervalo entre dos flancos
es menor, se pueden perder valores.

Funcionamiento
Al abrirse la puerta SW se habilita la función de contaje.
El estado del contador y el valor de congelación están ajustados a sus valores iniciales.
Permanecen invariables al abrirse la puerta SW. El valor inicial es 0 con un modo de operación
sin sentido normal de contaje y con sentido normal de contaje "Adelante". En sentido principal
de contaje "Atrás", el valor inicial es el límite de contaje superior parametrizado.
El contaje desde el valor de carga no comienza hasta que se produce el primer flanco en "DIStart".
Con cada nuevo flanco en "DI-Start" se vuelve a cargar el valor de carga.
El valor de congelación siempre equivale al estado del contador en el instante en que aparece
el flanco.
El estado de "DI-Start" se indica en el DB con el bit de estado STS_STA.
El valor de congelación se indica en el DB con LATCH_LOAD.
La siguiente figura muestra un ejemplo de "Congelar/redisparar" con valor de carga = 0 y flanco
ascendente en "DI-Start".

230

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

,PSXOVRVGH
FRQWDMH

*$7(B673

6:B*$7(

',6WDUW

(VWDGRGHO
FRQWDGRU

9DORUGH
FRQJHODFLµQ

Una aplicación especial del control de puerta "Congelar/redisparar" es la medición de tiempos
entre dos flancos (Página 243) con ayuda de la base de tiempo interna 1 MHz (Página 236).

Interrupción y finalización
Si cierra la puerta SW reseteando SW_GATE, el efecto es de interrupción.
Con flancos en "DI-Start" se puede guardar nuevamente el estado no modificado del contador
incluso con la puerta SW cerrada.
Si la puerta SW se cierra con GATE_STP de la instrucción CNT_CTL1, se cancelará el contaje.
En tal caso ya no se podrán almacenar estados del contador con "DI-Start".

Alarma de proceso con "Congelar/redisparar"
El almacenamiento de valores de contaje mediante "Congelar/redisparar" también puede
provocar una alarma de proceso. Esto puede hacer necesario un intervalo mayor entre los
flancos. Si las alarmas llegan más rápido de lo que pueden ser acusadas por el sistema, se
pierden alarmas de proceso. Esto se notifica mediante una alarma de diagnóstico.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

231

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar el rango de contaje
Descripción
El módulo incorpora un registro de contaje de 32 bits. El ajuste “Rango de contaje” permite
seleccionar si el módulo debe contar sólo en el rango positivo, o bien, si el bit 32 debe
interpretarse como bit de signo, permitiendo de este modo la representación de números
negativos. El rango de contaje sólo se puede seleccionar si no se ha parametrizado un sentido
de contaje principal.
Seleccione el rango de contaje deseado.
Encontrará más información en "Rangos de contaje y límites de contaje (Página 192)".

Rebase del límite superior, rebase por defecto del límite inferior y paso por cero
En los límites de contaje, si se produce un rebase por exceso o por defecto se activa un bit en
el DB de la instrucción CNT_CTL1.
Al producirse un paso por cero en el rango de contaje de -31 a +31 bits, también se activa un
bit en el DB.
Al producirse un paso por cero en el rango de contaje de 0 a +32 bits se indica además un
rebase por exceso, o bien un rebase por defecto (dependiendo del sentido de contaje).
Evento

Bit de estado en el DB

Rebase del límite superior

STS_OFLW se activa.

Rebase del límite inferior

STS_UFLW se activa.

Paso por cero

STS_ZERO se activa.

Disparo de alarmas de proceso
También puede notificar los eventos rebase por exceso, rebase por defecto y paso por cero
con alarmas de proceso.

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

232

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Selección del sentido principal de contaje
Descripción
Si se parametriza un sentido principal de contaje (Página 198) (adelante o atrás) es posible
limitar el rango de contaje máximo a un rango más pequeño, ajustando para ello un límite
superior de contaje (Página 227). El rango de contaje parametrizado está comprendido
entonces entre 0 y el límite superior de contaje ajustado.
El sentido principal de contaje sólo puede seleccionarse en los modos de operación "Contaje
único" y "Contaje periódico".
Se puede seleccionar el siguiente comportamiento:
● Ninguno (sin sentido principal de contaje)
● Adelante
● Atrás

Seleccionar flanco para congelar
Elección de los flancos
Es posible seleccionar el flanco con el que los estados del contador se deben almacenar
(congelar) en la entrada digital "DI-Start". Es posible parametrizar el siguiente comportamiento:
● Congelar con flanco ascendente en "DI-Start"
● Congelar con flanco descendente en "DI-Start"
● Congelar con los dos flancos "DI-Start"

Seleccionar la resolución del período
Descripción
El valor del período medido se indica en 1 μs o 1/16 μs.
Seleccione la unidad deseada para la resolución.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

233

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Rangos de medición posibles con información de error
● Con una resolución de 1 µs el error absoluto es de 0,1 ‰ del valor medido.
● La siguiente tabla muestra los rangos de medida y errores para una resolución de 1/16 µs:
Período Tmín ± error absoluto
1/16 μs × (160 ± 1)
1/16 μs × (1 600 ± 1)
1/16 μs × (16 000 ± 3)
1/16 μs × (160 000 ± 20)
A partir de un período de 100 ms el error absoluto es de 0,1 ‰ del valor medido.

Encóder
Seleccionar el tipo de señal del encóder
Seleccionar tipo de señal
1. Seleccione el tipo de señal del encóder utilizado.
Dependiendo de su selección y del modo de operación se bloquearán aquellas opciones no
permitidas para ese determinado encóder. Las opciones bloqueadas se identifican con
letra gris en la correspondiente ventana de selección.
2. Seleccione las opciones que desee utilizar con el encóder seleccionado.
Es posible selecciona un tipo de señal de uno de los encóders siguientes:
● Encóder: incremental de 5 V (Página 234) (señal diferencial de 5 V)
● Encóder: incremental de 24 V (Página 235) (pista A+B de 24 V desfasada)
● Encóder: impulso y sentido de 24 V (Página 235)
● Encóder: detector de proximidad de 24 V (Página 236)
● Base de tiempo interna 1 MHz (Página 236)

Encóder: incremental de 5 V
Encóder incremental de 5 V
Seleccione el tipo de señal "5 V Señal diferencial" si utiliza un encóder incremental de 5 V con
señales diferenciales A, /A, B, /B y N, /N.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal (Página 220)

Simple

Sólo se evalúa un flanco de señal A.

234

Doble

Se evalúan ambos flancos de la señal A.

Cuádruple

Se evalúan ambos flancos de las señales A y B.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Parámetro

Opción

Significado

Sentido de contaje
(Página 218)

Normal

Para adaptar el sentido de contaje al proceso

Invertido

Para adaptar el sentido de contaje al proceso

Frecuencia máx. de
contaje

–

La frecuencia de contaje máxima para este encóder es 500 kHz.

Entradas del encóder

–

Sin relevancia

Vigilancia (Pági‐
na 218)

A+B+N

Se vigila cortocircuito y rotura de hilo en todos los pares de señal.

A+B

Se vigilan los pares de señal A y B.

A

Sólo se vigila el par de señal A.

Ninguna

No se vigila ningún par de señal.

Encóder: incremental de 24 V
Encóder incremental de 24 V
Seleccione el tipo de señal "24 V pista A+B desfasado" si desea utilizar un encóder incremental
de 24 V con las señales A*, B* y N*.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal (Página 220)

Simple

Sólo se evalúa un flanco de señal A.

Doble

Se evalúan ambos flancos de la señal A.

Cuádruple

Se evalúan ambos flancos de las señales A y B.

Sentido de contaje
(Página 219)

Normal

Para adaptar el sentido de contaje al proceso

Invertido

Para adaptar el sentido de contaje al proceso

Frecuencia máx. de
contaje (Página 237)

200 kHz

En las entradas se aplica un filtro con un retardo de 1 μs.

20 kHz

En las entradas se aplica un filtro con un retardo de 15 μs.

Entradas del encóder
(Página 236)

Salida tipo NPN

El encóder conmuta a 0 V (masa).

Vigilancia

–

Salida tipo PNP/ El encóder conmuta a 24 V.
simétrica
Sin relevancia

Encóder: impulso y sentido de 24 V
Encóder incremental de posición de 24 V
Seleccione el tipo de señal "24 V Impulso y sentido" si desea utilizar un encóder incremental
de posición de 24 V con la señal de contaje A* y la señal de sentido B*.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal

–

Sin relevancia

Sentido de contaje

–

Sin relevancia

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

235

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Parámetro

Opción

Significado

Frecuencia máx. de
contaje (Página 237)

200 kHz

En las entradas se aplica un filtro con un retardo de 1 μs.

20 kHz

En las entradas se aplica un filtro con un retardo de 15 μs.

Entradas del encóder
(Página 236)

Salida tipo NPN

El encóder conmuta a 0 V (masa).

Vigilancia

–

Salida tipo PNP/ El encóder conmuta a 24 V.
simétrica
Sin relevancia

Encóder: detector de proximidad de 24 V
Detector de proximidad de 24 V
Seleccione el tipo de señal "24 V Detector de proximidad" si desea utilizar un encóder
incremental de posición de 24 V con la señal de contaje A*.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal

–

Sin relevancia

Sentido de contaje

–

Sin relevancia

Frecuencia máx. de
contaje (Página 237)

200 kHz

En las entradas se aplica un filtro con un retardo de 1 μs.

20 kHz

En las entradas se aplica un filtro con un retardo de 15 μs.

Entradas del encóder
(Página 236)

Salida tipo NPN

El encóder conmuta a 0 V (masa).

Vigilancia

–

Salida tipo PNP/ El encóder conmuta a 24 V.
simétrica
Sin relevancia

Base de tiempo interna 1 MHz
Base de tiempo interna 1 MHz
Seleccione el tipo de señal "Base de tiempo interna 1 MHz" si, en lugar de un encóder externo,
desea utilizar la base de tiempo interna de 1 MHz.
Esta selección permite medir p. ej. tiempos entre dos flancos inmediatamente consecutivos en
la entrada digital "DI-Start".

Consulte también
Medir los tiempos entre dos flancos (Página 243)

Parametrización de las entradas del encóder
En la parametrización ha seleccionado "24 V Impulso y sentido" en Tipo de señal (Página 234).

236

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Parametrización de las entradas del encóder
En la parametrización de las entradas del encóder el sentido de contaje se define tal como se
indica a continuación. La tabla muestra el cambio del sentido de contaje en función de la
parametrización.
Parametrización

Borne de conexión B*

Sentido de contaje

Salida tipo NPN

Sin conexión

Atrás

Cortocircuitado a masa

Adelante

Sin conexión

Adelante

24 V conectado

Atrás

Salida tipo PNP/simétrica

Con esta señales de contaje no es posible invertir el sentido mediante la inversión de la señal
B*.
Nota
Si las señales de contaje son oscilantes, en este tipo de evaluación el valor de contaje puede
"desaparecer" en el flanco, ya que todas las señales se suman.

Filtro de entrada para entradas de contaje de 24 V
Filtro de entrada para entradas de contaje de 24 V
Para eliminar fallos, puede parametrizar filtros de entrada con un tiempo de filtrado unitario
para las entradas de contaje de 24 V A*, B* y N*. Existen los siguientes filtros de entrada:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Frecuencia de contaje máxima

200 kHz

20 kHz

Ancho de impulso mínimo de las señales de con‐ 2,5 μs
taje

25 μs

Introducir impulsos por vuelta del encóder
Impulsos por vuelta del encóder
Para el modo Medición de velocidad (Página 206) es preciso parametrizar adicionalmente los
impulsos por vuelta del encóder.
El valor para el número de impulsos por vuelta del encóder se encuentra en la placa de
características o en los datos técnicos del encóder.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

237

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Entradas
Seleccionar señales de puerta
Control de la puerta HW
Para el control de la puerta HW se pueden seleccionar las siguientes opciones:
● Puerta de hardware controlada por nivel (con nivel en "DI-Start")
● Puerta de hardware controlada por flanco (con flanco en "DI-Start", "DI-Stop")
Encontrará más información en el apartado "Puerta de hardware (Página 215)".

Seleccionar el ancho de impulso mínimo
Ancho de impulso mínimo
Para eliminar fallos, es posible parametrizar filtros de entrada (componentes RC) con un
tiempo de filtrado unitario para las entradas digitales.
Se encuentran disponibles dos filtros de entrada con los siguientes datos:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Ancho de impulso mínimo de las señales de entrada

2,5 μs

25 μs

Inicializar contador (DI-Set)
Inicializar contador
Resumen
Si se desea iniciar el contaje a partir de un determinado valor (el valor de carga), se deberá
parametrizar la señal con la que se vaya a poner el contador al valor de carga. Es posible
inicializar el contador de la manera siguiente:
● con el parámetro de entrada L_DIRECT o L_PREPAR de la instrucción CNT_CTL1
● con una señal externa, bien sea a través de la entrada "DI-Set", o bien a través de "DI-Set"
en combinación con la señal de paso por cero del encóder

Valor de carga
Como valor de carga se puede predeterminar un número cualquiera comprendido en el rango
de contaje.

238

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
El valor de carga se interpreta conforme al rango de contaje seleccionado. Si, por ejemplo, se
predetermina FFFF FFFF H como valor de carga, este valor se interpretará como
4.294.967.295 en el rango de contaje "0 a +32 bits", o bien como -1 en el rango de contaje
"-31 a +31 bits".
El valor de carga se introduce en el DB de la instrucción CNT_CTL1 y se transfiere al módulo
con la CNT_CTL1.
Los rangos de valores siguientes están permitidos para el valor de carga:
Rango de valores para
valores de carga

Sentido principal de contaje
Ninguno

Adelante

Atrás

Límite inferior

Límite de contaje infe‐
rior máx.

-2 + 1

2

Límite superior

Límite de contaje supe‐
rior máx.

Límite de contaje supe‐
rior parametrizado - 2

231 - 1

31

Ajustar el contador mediante una señal externa
Es posible seleccionar dos señales externas distintas para ajustar el contador al valor de
carga:
● Sólo "DI-Set" (Página 239)
● "DI-Set" y señal de paso por cero (Página 241) del encóder
La señal de paso por cero del encóder se utiliza para sincronizar el contador a un estado
específico del mismo en un determinado punto del proceso. Gracias a ello se logra una mayor
precisión en el contaje.
El contador se ajusta independientemente del modo de contaje.
Tras haber ajustado el contador mediante una señal externa, se activa el bit STS_SYNC en el
DB.
Nota
La sincronización de un contador con la señal de paso por cero sólo tiene sentido si está
abierta la puerta.
Si se ha habilitado sólo un sentido de contaje al ajustar el contador mediante una señal
externa, tenga en cuenta que – cuando se cierre la puerta – se guardará (congelará) el sentido
de contaje actual. Ello permite sincronizar el contador en el sentido de contaje contrario al
sentido habilitado.

Inicializar el contador con "DI-Set"
Ajustar el contador con "DI-Set"
El valor de carga se puede cargar en el contador con un flanco ascendente en la entrada "DISet".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

239

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Las variables ENSET_UP y ENSET_DN en el DB de la instrucción CNT_CTL1 y la
parametrización permiten definir el comportamiento del FM 350‑1 ante un flanco ascendente
en la entrada "DI-Set".
Parámetro

Comportamiento del FM 350‑1

ENSET_UP activado

El contador se activa sólo al contar hacia delante.

ENSET_DN activado

El contador se activa sólo al contar atrás.

ENSET_UP y EN‐
SET_DN activados

El contador se activa al contar hacia delante y hacia atrás.

Parametrización
El contador sólo se ajusta al ocurrir el primer flanco ascendente en la entrada
"Ajuste único del con‐ "DI-Set".
tador"
Si desea volver a activar el contador, primero es preciso activar de nuevo
ENSET_UP o ENSET_DN. Entonces, el contador se activará de nuevo con el
siguiente flanco ascendente en la entrada "DI-Set".
Parametrización
"Ajuste múltiple del
contador"

El contador se activa con cada flanco ascendente de "DI-Set" mientras que
estén activadas ENSET_UP y/o ENSET_DN.

Nota
En todo caso, deberá activar una de las variables ENSET_UP y/o ENSET_DN para que el
contador se pueda activar mediante la entrada digital "DI-Set".

Activación única del contador con "DI-Set"
La figura siguiente muestra una activación individual del contador con la entrada digital "DISet". En el caso ilustrado sólo está activada la variable ENSET_UP. Por tanto, el contador se
activa al contar hacia delante.
El contador se activa con el primer flanco ascendente que ocurra en la entrada digital "DI-Set",
siempre y cuando esté activada ENSET_UP. Si se desea volver a activar el contador, en primer
lugar es preciso desactivar la variable ENSET_UP y activarla luego de nuevo. El siguiente
flanco ascendente en la entrada digital "DI-Set" implicará una nueva activación del contador.
,PSXOVRVGH
FRQWDMH
',6HW

(16(7B83

(OFRQWDGRU
VHDFWLYD

240

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
VHDFWLYD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activación múltiple del contador con "DI-Set"
La figura siguiente muestra una activación múltiple del contador con la entrada digital "DI-Set".
En el caso ilustrado sólo está activada la variable ENSET_UP. Por tanto, el contador se activa
al contar hacia delante.
El contador se activa en cada flanco ascendente que ocurra en "DI-Set", siempre y cuando esté
activada ENSET_UP. Si desactiva ENSET_UP, el contador no se activará con "DI-Set". Sólo
cuando se haya vuelto a activar ENSET_UP, el contador se activará en el siguiente flanco
ascendente que ocurra en la entrada "DI-Set".
,PSXOVRVGH
FRQWDMH

',6HW

(16(7B83

 (OFRQWDGRU
 VHDFWLYD

(OFRQWDGRU
VHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
VHDFWLYD

Inicializar el contador con "DI-Set" y la señal de paso por cero
Inicializar el contador con "DI-Set" y la señal de paso por cero
Si la inicialización del contador se parametriza con la señal de paso por cero del encóder
("Evaluar señal de paso por cero para el ajuste"), el contador se pone al valor de carga con el
flanco ascendente de la señal de paso por cero.
La inicialización se realiza sólo si, en el instante del flanco ascendente de la señal de paso por
cero, está activa además la entrada "DI-Set".
Las variables ENSET_UP y ENSET_DN en el DB de la instrucción CNT_CTL1 y la
parametrización permiten definir el comportamiento del FM 350‑1 ante un flanco ascendente
de la señal de paso por cero:
Parámetros de entrada

Comportamiento del FM 350‑1

ENSET_UP activado

El contador se pone al valor de inicialización sólo al contar hacia delante.

ENSET_DN activado

El contador se pone al valor de inicialización sólo al contar atrás.

ENSET_UP y EN‐
SET_DN inicializados

El contador se inicializa al contar hacia delante y hacia atrás.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

241

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Parámetros de entrada

Comportamiento del FM 350‑1

Parametrización "Ajuste
único del contador"

El contador sólo se inicializa al ocurrir el primer flanco ascendente en la
señal de paso por cero.
Si desea volver a inicializar el contador, deberá inicializar primero de nuevo
ENSET_UP o ENSET_DN (evaluación de flancos). Entonces, el contador
se inicializará de nuevo con el siguiente flanco ascendente en la señal de
paso por cero.

Parametrización "Inicia‐
liazción repetida del con‐
tador"

El contador se inicializa en cada flanco ascendente de la señal de paso por
cero mientras que estén activadas ENSET_UP y/o ENSET_DN.

Nota
En todo caso, es preciso activar una de las variables ENSET_UP y/o ENSET_DN y la entrada
"DI-Set" para que el contador se pueda inicializar con la señal de paso por cero.

Ajuste único del contador mediante "DI-Set" y la señal de paso por cero
La figura siguiente muestra una inicialización único del contador con la señal de paso por cero.
En el caso ilustrado sólo está activada la variable ENSET_UP. Por tanto, el contador se
inicializa al contar hacia delante.
El contador se activa con el primer flanco ascendente de la señal de paso por cero, siempre y
cuando estén activadas ENSET_UP y "DI-Set".
Si desea volver a activar el contador, es preciso desactivar primero la variable ENSET_UP y
activarla luego de nuevo. Si "DI-Set" no está activada, la inicialización se efectúa con la primera
señal de paso por cero tras activar "DI-Set". Si "DI-Set" está activada, la activación se efectúa
con la siguiente señal de paso por cero.
,PSXOVRVGH
FRQWDMH
6H³DOFHUR

',6HW

(16(7B83
(OFRQWDGRU
VHDFWLYD

242

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU (OFRQWDGRU
QRVHDFWLYD VHDFWLYD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Inicialización repetida del contador con "DI-Set" y la señal de paso por cero
La figura siguiente muestra una inicialización repetida del contador con la señal de paso por
cero. En el caso ilustrado sólo está activada la variable ENSET_UP. Por tanto, el contador se
inicializa al contar hacia delante.
El contador se activa en cada flanco ascendente de la señal de paso por cero, siempre y
cuando estén activadas ENSET_UP y "DI-Set".
,PSXOVRVGHFRQWDMH

6H³DOFHUR

',6HW

(16(7B83

(OFRQWDGRU
VHDFWLYD

(OFRQWDGRU
VHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU (OFRQWDGRU
QRVHDFWLYD
VHDFWLYD

(OFRQWDGRU
VHDFWLYD

Medir los tiempos entre dos flancos
Introducción
Es posible medir tiempos entre dos flancos inmediatamente consecutivos en la entrada digital
"DI Start".

Requisito
Para la medición deben cumplirse los siguientes requisitos:
● No conecte ningún encóder al FM 350‑1.
● Parametrice un modo de contaje (Página 227) cualquiera como modo de operación.
● Parametrice el control de puerta "Congelar/redisparar" (Página 228) como modo de
operación.
● Para el encóder, parametrice el tipo de señal "Base de tiempo interna 1MHz" (Página 234).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

243

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Elección de los flancos
Para medir el tiempo entre dos flancos inmediata‐ ... parametrice
mente consecutivos ...
Flancos ascendentes en "DI-Start"

Latch con flanco ascendente

Flancos descendentes en "DI-Start"

Latch con flanco descendente

Cualquier flanco en "DI-Start"

Latch con ambos flancos

Véase también: Seleccionar flanco para congelar (Página 233)

Funcionamiento
El FM 350‑1 utiliza una base de tiempo interna de 1 MHz para medir el tiempo. La medición del
tiempo comienza al ocurrir el primer flanco en "DI-Start". Con cada flanco adicional en "DIStart", en la interfaz de notificación se guarda siempre el tiempo transcurrido (en μs) desde el
último flanco como valor de congelación LATCH_LOAD.

Salidas
Definir el comportamiento de las salidas para los modos de contaje
Valores de comparación y salidas
Descripción
En el FM 350‑1 se pueden guardar dos valores de comparación (valor de comparación 1 y 2)
para cada contador. Estos valores están asignados a las dos salidas digitales (valor de
comparación 1: DO0, valor de comparación 2: DO1). Los valores de comparación se comparan
con el estado de contaje actual. Cuando el estado de contaje alcanza un valor de comparación,
puede activarse la salida correspondiente.
En "Conmutar en valores de comparación (Página 250)" los dos valores de comparación se
asignan al DO1.

Valores de comparación 1 y 2
Los dos valores de comparación se introducen en el DB de la instrucción CNT_CTL1
(CMP_V1, CMP_V2) y se transfieren al FM 350‑1 activando los bits T_CMP_V1 o T_CMP_V2
respectivamente. El contaje no se ve afectado por este hecho.
Los valores de comparación deben estar dentro de los límites del rango de contaje en cuestión.
El valor de comparación se interpreta conforme al rango de contaje seleccionado. Si, por
ejemplo, se predetermina FFFF FFFF H como valor de comparación, este valor se interpretará
como 4 294 967 295 en el rango de contaje de "0 a +32 bits", o bien como -1 en el rango de
contaje de "-31 a +31 bits".

244

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Para los valores de comparación se permiten los rangos de valores siguientes:
Rango de los valores
de comparación

Sentido principal de contaje
Ninguno

Adelante

Atrás

Límite inferior

Límite de contaje inferior
máx.

-2

1

Límite superior

Límite de contaje supe‐
rior máx.

Límite de contaje supe‐
rior parametrizado -1

231 - 1

31

Habilitación de las salidas
Antes de poder controlar las salidas es preciso haberlas habilitado activando los bits
correspondientes en el DB. Si desactiva uno de esos bits, la correspondiente salida se
desactiva inmediatamente, aunque haya parametrizado para ella una duración de impulsos.
Para la habilitación de las salidas pueden activarse los siguientes bits:
Salida

...es habilitada por el bit

DO0

CTRL_DO0

DO1

CTRL_DO1

Activar y desactivar las salidas
Si se parametriza la opción "No se compara" para el comportamiento de una salida, las salidas
habilitadas se pueden activar y desactivar con los bits correspondientes en el DB.
La activación y desactivación de las salidas se produce con los bits siguientes:
Salida

...se activa con

...se desactiva con

DO0

SET_DO0 = 1

SET_DO0 = 0

DO1

SET_DO1 = 1

SET_DO1 = 0

Comportamiento de las salidas en los modos de contaje
Definir el comportamiento de las salidas
Comportamiento de las salidas DO0 y DO1
Seleccione el comportamiento deseado de la salida correspondiente. Active para ello la casilla
de verificación correspondiente:
● Valor sustitutivo "1" en caso de STOP de la CPU (Página 246)
● No se compara (Página 247)
● Activar si la lectura del contador >= valor de comparación (Página 247)
● Activar si la lectura del contador <= valor de comparación (Página 248)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

245

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● Activar al alcanzarse el valor de comparación por la duración del impulso hacia delante
(Página 248)
● Activar al alcanzarse el valor de comparación por la duración del impulso hacia atrás
(Página 249)
● Activar cuando se alcance el valor de comparación para la duración del impulso hacia
delante/atrás (Página 248)
● Conmutar en los valores de comparación (Página 250) (sólo posible para la salida DO1)
Nota
Para activar las opciones, es preciso introducir los valores de comparación 1 y 2 en el DB con
los datos de contaje, así como transferirlos al módulo con la instrucción CNT_CTL1; además,
es preciso activar los bits CTRL_DO0 y CTRL_DO1 en el DB para habilitar las salidas. Véase
también "Valores de comparación y salidas (Página 244)".

Ajuste predeterminado de las salidas
En el ajuste predeterminado las salidas están desactivadas.

Comportamiento de las salidas digitales en modo isócrono
En modo isócrono, las salidas DO0 y DO1 conmutan inmediatamente después de cumplirse
las condiciones de comparación. Por tanto, son independientes del ciclo PROFIBUS DP.
Excepción:
Si se ha parametrizado "No se compara" para el comportamiento de las salidas digitales y las
salidas se accionan después de la habilitación con CTRL_DO0 o CTRL_DO1 con las señales
de control SET_DO0 o SET_DO1, éstas se activan y desactivan en el instante To.

Valor sustitutivo "1" en caso de STOP de la CPU
Valor sustitutivo "1" en caso de STOP de la CPU
Si en los parámetros básicos del módulo ha seleccionado la opción "Valor sustitutivo" en
"Reacción a STOP de la CPU" y la CPU se para, el módulo transmite a las salidas digitales los
valores sustitutivos parametrizados. Active la casilla de verificación correspondiente a DO0; a
continuación se activa la salida DO0 en el caso de parada de la CPU.
Los valores sustitutivos permanecen válidos tras pasar la CPU de STOP a RUN, hasta el
siguiente manejo de las salidas digitales.

246

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Si cambia el parámetro básico "Reacción a STOP de la CPU", las salidas se desactivan.
PRECAUCIÓN
Se pueden producir daños materiales.
Los valores sustitutivos parametrizados se aplican siempre que la CPU pasa a STOP, aunque
la puerta esté cerrada e incluso a salidas no habilitadas.
Hay que parametrizar exclusivamente valores sustitutivos cuya aplicación no pueda
ocasionar estados peligrosos.

No se compara
No se compara
La salida permanece desactivada y no se ve afectada por los eventos valor de comparación,
paso por cero, rebase por exceso o por defecto. La salida DOx se puede utilizar puramente
como salida digital. Si está habilitada, se puede activar y desactivar mediante el bit SET_DOx.

Activar si la lectura del contador >= valor de comparación
Activar si la lectura del contador >= valor de comparación
La salida se pone a "1" si el contador se encuentra en el rango comprendido entre el valor de
comparación y el rebase por exceso.
La salida se pone a "1" si el contador se ajusta a un valor comprendido entre el valor de
comparación y el rebase por exceso.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área.

'HVERUGDPLHQWR
SRUGHIHFWR

9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 251).

Consulte también
Efecto de la histéresis (Página 252)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

247

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activar si la lectura del contador <= valor de comparación
Activar si la lectura del contador <= valor de comparación
La salida se pone a "1" si el contador se encuentra en el rango comprendido entre el valor de
comparación y el rebase por defecto.
La salida se pone a "1" si el contador se ajusta a un valor comprendido entre el valor de
comparación y el rebase por defecto.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área.

'HVERUGDPLHQWR
SRUGHIHFWR

9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 251).

Consulte también
Efecto de la histéresis (Página 252)

Activar al alcanzar el valor de comparación por la duración del impulso hacia delante/atrás
Activar al alcanzar el valor de comparación por la duración del impulso hacia delante/atrás
Mientras dura el impulso e independientemente del sentido de contaje, la salida se pone a "1"
cuando se alcanza el valor de comparación.
Requisito:
● Sentido principal de contaje: "Ninguno"
La superficie sombreada del gráfico siguiente que la salida está activada en esta área (t =
duración del impulso).
$GHODQWH

W

W

$WU£V

'HVERUGDPLHQWR 9DORUGH
'HVERUGDPLHQWRSRU 'HVERUGDPLHQWR 9DORUGH
'HVERUGDPLHQWR
SRUGHIHFWR
FRPSDUDFLµQ H[FHVR
SRUGHIHFWR
FRPSDUDFLµQ SRUH[FHVR

Activar al alcanzarse el valor de comparación por la duración del impulso hacia delante
Activar al alcanzarse el valor de comparación por la duración del impulso hacia adelante
Mientras dura el impulso, la salida se pone a "1" cuando el contador alcanza el valor de
comparación al contar hacia delante.

248

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Requisito alternativo:
● Sentido principal de contaje: "Ninguno"
● Sentido principal de contaje: "Adelante"
La superficie sombreada del gráfico siguiente que la salida está activada en esta área (t =
duración del impulso).
W
9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUGHIHFWR

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 251).

Consulte también
Efecto de la histéresis (Página 252)

Activar al alcanzarse el valor de comparación por la duración del impulso hacia atrás
Activar al alcanzarse el valor de comparación por la duración del impulso hacia atrás
Mientras dura el impulso, la salida se pone a "1" cuando el contador alcanza el valor de
comparación al contar hacia atrás.
Requisito alternativo:
● Sentido principal de contaje: "Ninguno"
● Sentido principal de contaje: "Hacia atrás"
La superficie sombreada del gráfico siguiente significa que la salida está activada en esta área
(t = duración del impulso).
W
'HVERUGDPLHQWR
SRUGHIHFWR

9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 251).

Consulte también
Efecto de la histéresis (Página 252)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

249

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Conmutar en los valores de comparación
Conmutar en los valores de comparación
La salida DO1 conmuta en dos valores de comparación si se cumplen las condiciones
siguientes:
● Para la salida DO0 se ha parametrizado el comportamiento "No se compara".
● Para la salida DO1 se ha parametrizado el comportamiento "Conmutar en valores de
comparación".
● Los valores de comparación CMP_V1 y CMP_V2 se han cargado.
● Se ha habilitado la salida DO1 con CRTL_DO1.
La tabla siguiente muestra cuándo está activada o desactivada la salida DO1:
Valores de comparación
CMP_V1 y CMP_V2

DO1 está conectada cuando

DO1 está desconectada cuando

CMP_V1 < CMP_V2

CMP_V1 ≤ Estado del contador ≤
CMP_V2

Estado del contador < CMP_V1
o
Estado del contador > CMP_V2

CMP_V1 = CMP_V2

CMP_V1 = estado del contador =
CMP_V2

CMP_V1 ≠ Estado del contador ≠
CMP_V2

CMP_V1 > CMP_V2

Estado del contador < CMP_V2
o
Estado del contador > CMP_V1

CMP_V2 ≤ Estado del contador ≤
CMP_V1

El bit de estado STS_COMP2 indica el resultado de la comparación.
El bit de estado STS_COMP2 sólo se puede acusar y, por tanto, desactivar, cuando ya no se
cumpla la condición de comparación.
El estado de la salida DO1 se indica mediante el bit de estado STS_CMP2.
En este comportamiento de salida no hay histéresis.
En este comportamiento de salida, el bit de control SET_DO1 no puede controlar la salida DO1.

250

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Las siguientes figuras muestran el estado de la salida DO1 dependiendo del estado del
contador y de los valores de comparación:
● Al iniciarse el contaje es CMP_V2 > CMP_V1
(VWDGRGHO
FRQWDGRU
&03B9
&03B9


W

'2
W

● Al iniciarse el contaje es CMP_V2 < CMP_V1
(VWDGRGHO
FRQWDGRU
&03B9
&03B9



W

'2

W

Condiciones marco para el comportamiento de las salidas
Condiciones marco para el comportamiento de las salidas digitales
Al parametrizar el comportamiento de las salidas digitales debe observar las siguientes
condiciones marco.
Si...

Entonces...

... desea parametrizar una salida "Activar si el estado
de contador >= valor de comparación o <= valor de
comparación",

... deberá asegurarse de que el intervalo de tiempo entre estos dos
eventos sea mayor que el tiempo de conmutación mínimo de las
salidas (tiempo de conmutación: 300 μs); de lo contrario, se perde‐
rán los impulsos de control de las salidas.
Si el estado del contador alcanza nuevamente el valor de compara‐
ción mientras la salida sigue activa, no se disparará un nuevo im‐
pulso. No se podrá emitir un nuevo impulso hasta que la salida deje
de estar activada.

... desea parametrizar una salida "Activar si el estado
de contador >= valor de comparación",

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

... no habilite ninguna alarma de proceso al "Alcanzar el valor de
comparación correspondiente hacia delante o hacia atrás".

251

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Si...

Entonces...

... desea parametrizar una salida "Activar si el estado
de contador <= valor de comparación",

... no habilite ninguna alarma de proceso al "Alcanzar el valor de
comparación correspondiente hacia delante o hacia atrás".

... desea parametrizar una salida "Activar al alcanzar‐ ... no habilite una alarma de proceso al "Alcanzar el valor de com‐
se el valor de comparación por la duración del impulso paración correspondiente hacia atrás".
hacia delante"
... desea parametrizar una salida "Activar al alcanzar‐ ... no podrá habilitar una alarma de proceso al "Alcanzar el valor de
se el valor de comparación por la duración del impulso comparación correspondiente en sentido ascendente".
en sentido descendente"

Efecto de la histéresis
Funcionamiento de la histéresis con la parametrización "Activar si el valor del contador >= valor de
comparación o <= valor de comparación"
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (= desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo el valor de comparación = 5.
La parametrización en este ejemplo es:
● Sentido principal de contaje: "Adelante"
● Comportamiento de la salida: "Activar si el estado del contador >= valor de comparación"
Al alcanzarse la condición de comparación (estado del contador = 5) se activa la histéresis.
Con la histéresis activada el resultado de la comparación permanece invariable.
Cuando el valor de contaje abandona el rango de histéresis, en el ejemplo con el valor de
contaje 2 u 8, la histéresis se desactiva. El comparador vuelve a conmutar según sus
condiciones de comparación, en el ejemplo con el valor de contaje 5.
9DORUGHFRQWDMH

9DORUGHFRPSDUDFLµQ 

5DQJRGHKLVW«UHVLVFRQIRQGRJULV















6DOLGDHQHOFDVRGH
KLVW«UHVLV 
6DOLGDHQHOFDVRGH
KLVW«UHVLV 

252

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Nota
Si el estado del contador es igual al valor de comparación y la histéresis está activa, el
FM 350‑1 desactiva la salida cuando se invierte el sentido de contaje en el valor de
comparación (véase la figura siguiente).

9DORUGHFRQWDMH

9DORUGHFRPSDUDFLµQ  5DQJRGHKLVW«UHVLVFRQIRQGRJULV
&DPELRGHOVHQWLGRGHFRQWDMHDOYDORUGHFRPSDUDFLµQ











6DOLGDHQHOFDVRGH
KLVW«UHVLV 

Funcionamiento de la histéresis con la parametrización "Activar al alcanzarse el valor de comparación
en sentido ascendente/descendente por la duración del impulso"
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (= desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo el valor de comparación = 5.
La parametrización en este ejemplo es:
● Sentido principal de contaje: "Ninguno"
● Comportamiento de la salida: "Activar al alcanzarse el valor de comparación por la duración
del impulso hacia delante"
● Duración del impulso > 0
Al alcanzarse la condición de comparación (estado del contador = 5) se activa la histéresis y
se emite un impulso por la salida con la duración parametrizada.
Si el valor de contaje abandona el rango de histéresis, la histéresis se desactiva.
Cuando se activa la histéresis, el FM 350‑1 almacena el sentido de contaje. Si se abandona el
rango de histéresis en sentido contrario al almacenado, se emite un impulso.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

253

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
9DORUGHFRQWDMH

9DORUGHFRPSDUDFLµQ 

5DQJRGHKLVW«UHVLVFRQIRQGRJULV












6DOLGDHQHOFDVRGH

KLVW«UHVLV


6DOLGDHQHOFDVRGH
KLVW«UHVLV 
'XUDFLµQGHLPSXOVRSDUDPHWUL]DGR

Definir el comportamiento de las salidas para los modos de medición
Valores límite y salidas
Valores límite inferior y superior
Es posible determinar un valor límite superior y un valor límite inferior para medir la frecuencia,
la velocidad o el período. Si se infringen dichos límites, se activará la salida digital DO0. Estos
valores límite se pueden parametrizar y modificar a través de la interfaz de control.
Los siguientes rangos de valores están permitidos para los valores límite inferior y superior:
Modo de medición

Valor límite inferior (LI):

Valor límite superior

Medición de frecuencia
(encóder de 5 V)

0 a 499 999 999 × 10 Hz

LI+1 a 500 000 000 × 10-3 Hz

Medición de frecuencia
(encóder de 24 V)

0 a 199 999 999 × 10-3 Hz

LI+1 a 200 000 000 × 10-3 Hz

Medición de velocidad

0 a 24 999 999 × 10-3 /min

LI+1 a 25 000 000 × 10-3/min

Medición del período (resolución 1 µs)

0 a 119 999 999 μs

LI+1 a 120 000 000 μs

Medición del período (resolución 1/16
µs)

0 a 1 919 999 999 μs

LI+1 a 1 920 000 000 μs

254

-3

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Habilitación de las salidas
Antes de poder controlar las salidas es preciso haberlas habilitado activando los bits
correspondientes en el DB. Si se desactiva uno de estos bits, la salida correspondiente se
desconectará de inmediato.
Salida

...es habilitada por el bit

DO0

CTRL_DO0

DO1

CTRL_DO1

Comportamiento de las salidas en los modos de medición
Comportamiento de las salidas digitales
Salida digital DO0
Para la salida digital DO0 se puede programar una de 4 respuestas posibles cuando se
alcancen los valores límite. En la tabla siguiente puede ver las diferentes posibilidades.
Parametrización de Determinar el comportamiento de la salida digital DO0
la salida digital DO0
No se compara

No afectado por la vigilancia de valor límite.

Instante de conmutación
Modo isócrono

Modo no isócrono

En el instante To

Inmediatamente des‐
pués de activar o de‐
sactivar la salida

Al final del tiempo de
actualización en el
instante Ti

Al final del tiempo de
actualización

Si la salida DO0 ya se ha activado, se puede desacti‐
var modificando el parámetro a "No se compara".
La salida DO0 se puede utilizar libremente como sali‐
da digital. Además, es posible activarla y desactivarla
con la señal de control SET_DO0 si se ha habilitado
con la señal de control CTRL_DO0.
Fuera de los valores
límite

DO0 se activa en los dos casos siguientes:
● Valor medido < valor límite inferior
● Valor medido > valor límite superior

Rebase por defecto
del valor límite infe‐
rior

DO0 se activa si
● Valor medido < valor límite inferior

Rebase por exceso DO0 se activa si
del valor límite supe‐ ● Valor medido > valor límite superior
rior

Seleccione el comportamiento deseado de la salida DO0. Active para ello la casilla de
verificación correspondiente.
Salida digital DO1
Una vez habilitada, la salida DO1 se puede utilizar libremente como salida digital, siendo
posible activarla y desactivarla con la señal de control SET_DO1.
DO1 no se ve afectada por la vigilancia de valor límite.
En modo isócrono, DO1 conmuta al final del tiempo de actualización en el instante To.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

255

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Definir la duración del impulso
Duración del impulso
Es posible definir una duración del impulso para adaptarse a los actuadores utilizados en el
proceso (contactores, elementos finales de regulación, etc.). La duración del impulso indica
cuánto tiempo están activas las salidas DO0 y DO1 al alcanzarse un valor de comparación.
Si se ha parametrizado el "sentido principal de contaje adelante" o "atrás", la duración del
impulso sólo tendrá efecto en el sentido principal de contaje.
Si no se ha parametrizado un sentido principal de contaje, la duración del impulso puede tener
efecto en ambos sentidos.
La duración del impulso comienza cuando se activa la salida. La imprecisión de la duración del
impulso es inferior a 1 ms.
Para la duración del impulso se puede predefinir un valor comprendido entre 0 y 500 ms. Este
valor es válido para ambas salidas.
Si la duración del impulso = 0 ms, la salida se activará al alcanzarse el valor de comparación
y se desactivará con el siguiente impulso de contaje.
El valor predeterminado para la duración de impulsos es 0.
Nota
Si se predetermina una duración del impulso = 0 ms, la salida permanecerá activada hasta que
el estado del contador sea igual al valor de comparación (véase la mitad superior de la figura
siguiente).
Debido a los tiempos de conmutación de las salidas digitales (máx. 300 μs) se podrían perder
impulsos de control en las salidas si el intervalo de tiempo entre los impulsos de contaje es
menor que los tiempos de conmutación de las salidas digitales (véase la mitad inferior de la
figura siguiente).
Por tanto, asegúrese de que el intervalo de tiempo entre los impulsos de contaje sea mayor
que los tiempos de conmutación de las salidas digitales.

256

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
7LHPSRGH
FRQPXWDFLµQ
wV
P£[

,PSXOVRVGHFRQWDMH

7LHPSRGH
FRQPXWDFLµQ
wV
P£[

'2VHFRQPXWDFRQXQUHWUDVRP£[GHwV

,PSXOVRVGHFRQWDMH

'2QRVH
FRQPXWD
9DORUGHFRQWDMH YDORUGHFRPSDUDFLµQ

Definir histéresis
Funcionamiento básico de la histéresis
Un encóder puede pararse en una posición determinada y "oscilar" alrededor de dicha
posición. Esto hace que el estado del contador fluctúe alrededor de un valor determinado. Si
hay un valor de comparación en este rango de fluctuación, por ejemplo, la salida
correspondiente se activa y desactiva de acuerdo con el ritmo de las fluctuaciones. Para evitar
estas conmutaciones cuando se producen pequeñas oscilaciones, el FM 350‑1 cuenta con
una histéresis parametrizable.
Para la histéresis se pueden parametrizar valores comprendidos entre 0 y 255.
Dependiendo del valor parametrizado, la histéresis actúa tal como se indica a continuación:
Histéresis
Valor de histéresis n = 0, 1

Efecto
La histéresis no tiene efecto (desactivada).
La salida reaccionará al más mínimo cambio del estado del contador.

2 ≤ valor de histéresis n ≤ 255 La histéresis tiene efecto.
La salida reacciona sólo cuando el estado del contador se ha distan‐
ciado n unidades del valor de comparación.

La histéresis también actúa en caso de rebase por exceso y por defecto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

257

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Habilitar alarmas de proceso
Habilitar la activación de una alarma de proceso
Introducción
En el FM 350‑1 se puede definir qué eventos deben generar una alarma de proceso durante
el funcionamiento.

¿Qué es una alarma de proceso?
Si se debe reaccionar a un evento determinado, independientemente del ciclo de la CPU, el
FM 350‑1 puede disparar una alarma de proceso. En ese caso la CPU interrumpe el programa
cíclico y procesa el OB de alarma de proceso.

Habilitar la alarma de proceso
La habilitación de las alarmas de proceso tiene lugar en dos pasos:
1. En la configuración del hardware las alarmas del módulo se habilitan en los parámetros
básicos y se especifica si el módulo debe activar una alarma de diagnóstico y/o una alarma
de proceso.
2. En "Habilitar alarma de proceso" es preciso seleccionar los eventos correspondientes:
– Eventos para la activación de una alarma de proceso en los modos de contaje
(Página 259)
– Eventos para la activación de una alarma de proceso en los modos de medición
(Página 259)

OB de alarma de proceso, OB 40
Si ocurre una alarma de proceso, el programa de usuario se interrumpe, los datos se
transfieren del módulo a la información de arranque del OB 40 (Página 259) y se llama al OB
40. La alarma de proceso se acusa saliendo del OB 40.
La CPU pasa a modo STOP si no se ha programado el OB 40. Si a continuación se pasa a
RUN, se borran las condiciones para la alarma de proceso.

Alarma de proceso perdida
Si ocurre un evento que deba disparar una alarma de proceso, y el mismo evento anterior no
se ha acusado todavía, no se dispararán más alarmas de proceso; la alarma de proceso se
perderá. Esta situación puede conducir a la alarma de diagnóstico "Alarma de proceso
perdida".

Ajuste predeterminado
En el ajuste predeterminado no se han habilitado alarmas de proceso.

258

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Eventos para la activación de una alarma de proceso en los modos de contaje
¿Qué eventos pueden disparar una alarma de proceso en los modos de contaje?
En los modos de contaje, los eventos siguientes pueden disparar una alarma de proceso
mientras el FM 350‑1 está en funcionamiento:
● Apertura de la puerta (en los modos de operación con puerta HW o SW)
● Cierre de la puerta (en los modos de operación con puerta HW o SW)
● Rebase del límite superior
● Rebase del límite inferior
● Paso por cero
● Alcance del valor de comparación 1 ó 2 en sentido de contaje adelante
● Alcance del valor de comparación 1 ó 2 en sentido de contaje atrás
● Activar contador (DI-Set)
● Congelar
Active la casilla de verificación para los eventos correspondientes.
Es posible seleccionar un número cualquiera de eventos para disparar alarmas de proceso.
Para las alarmas de proceso que se disparan al alcanzar un valor de comparación hay que
tener en cuenta las condiciones marco para el comportamiento de las salidas (Página 251).

Eventos para la activación de una alarma de proceso en los modos de medición
¿Qué eventos pueden disparar una alarma de proceso en los modos de medición?
En los modos de medición, los eventos siguientes pueden disparar una alarma de proceso
mientras el FM 350‑1 está en funcionamiento:
● Apertura de la puerta (en los modos de operación con puerta HW o SW)
● Cierre de la puerta (en los modos de operación con puerta HW o SW)
● Rebase por defecto del valor límite inferior
● Rebase por exceso del valor límite superior
● Fin de la medición
Active la casilla de verificación para los eventos correspondientes.
Es posible seleccionar un número cualquiera de eventos para disparar alarmas de proceso.

Información de arranque del OB 40
Información de arranque del OB 40
La variable temporal OB40_POINT_ADDR se escribe en la información de arranque del OB 40.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

259

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
La variable OB40_POINT_ADDR (byte 8 a 11) abarca 4 bytes. En los bytes 8 y 9 se introducen
las informaciones acerca del evento que ha disparado la alarma de proceso.
La tabla muestra qué bits se activan según el tipo de alarma. Todos los bits que no se incluyen
en la tabla son irrelevantes y tienen el valor cero.
Byte

Bit

Significado: Alarma en caso de ...

8

0

Apertura de la puerta

1

Cierre de la puerta

2

Rebase del límite superior (en el modo de contaje)
Valor medido fuera de los valores límite (en modo de medición)

3

Rebase por defecto del límite inferior (en el modo de contaje)

4

Alcance del valor de comparación 1 en sentido de contaje adelante

5

Alcance del valor de comparación 1 en sentido de contaje atrás

6

Alcance del valor de comparación 2 en sentido de contaje adelante

7

Alcance del valor de comparación 2 en sentido de contaje atrás

0

Paso por cero

5

Activar contador (DI-Set) (sincronización)

7

Congelar

Fin de medición (en modo de medición)

9

Interfaz de control y realimentación del FM 350-1
Resumen
Si se desea utilizar el FM 350‑1 sin instrucciones, el FM 350‑1 se controla y se observa
directamente a través de la interfaz de control y realimentación (interfaz de datos de usuario).
La interfaz de datos de usuario comienza en la dirección inicial del módulo y tiene una longitud
de 16 bytes.
Con los comandos de carga se puede leer la interfaz de realimentación.
Los comandos de transferencia permiten escribir en la interfaz de aviso de control.
No se permite un modo mixto con comandos de carga/transferencia y programación con
instrucciones.

Interfaz de control de los modos de contaje
Interfaz de control de los modos de contaje
El parámetro LOAD_VAL (byte 0 a 3) tiene dos significados:
● Si se activa el bit L_DIRECT o L_PREPAR, LOAD_VAL se interpreta como valor de carga.
● Si se activa el bit C_DOPARA, en el byte 0 se puede definir el comportamiento de las salidas
DO0 y DO1; los bytes 1 y 2 se interpretan como histéresis y duración del impulso.

260

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
La siguiente tabla muestra la asignación de la interfaz de control (las salidas) del FM 350‑1
para los modos de contaje.
Offset de la direc‐
ción inicial

Parámetro

Significado

Byte 0 a 3

LOAD_VAL

Valor de carga; carga directa y anticipativa con el bit L_DIRECT
Valor de carga; carga anticipativa con el bit L_PREPAR

Byte 0

Comportamiento de las salidas DO0 y DO1, de la histéresis y de la duración de
impulso; definir con el bit C_DOPARA
Bit 3

Bit 2

Bit 1

Bit 0

Comportamiento de la salida DO0

x

0

0

0

No se compara

x

0

0

1

Activar si la lectura del contador >= valor de
comparación

x

0

1

0

Activar si la lectura del contador <= valor de
comparación

x

0

1

1

Activar cuando se alcance el valor de compara‐
ción para la duración del impulso hacia delante/
atrás

x

1

0

0

Activar al alcanzarse el valor de comparación
por la duración del impulso hacia delante

x

1

0

1

Activar al alcanzarse el valor de comparación
por la duración del impulso hacia atrás

Bit 7

Bit 6

Bit 5

Bit 4

Comportamiento de la salida DO1

x

0

0

0

No se compara

x

0

0

1

Activar si la lectura del contador >= valor de
comparación

x

0

1

0

Activar si la lectura del contador <= valor de
comparación

x

0

1

1

Activar cuando se alcance el valor de compara‐
ción para la duración del impulso hacia delante/
atrás

x

1

0

0

Activar al alcanzarse el valor de comparación
por la duración del impulso hacia delante

x

1

0

1

Activar al alcanzarse el valor de comparación
por la duración del impulso hacia atrás

x

1

1

0

Conmutar en valores de comparación

x = irrelevante
Byte 1

Histéresis (rango de valores 0 a 255)

Byte 2

Duración del impulso (rango de valores 0 a 250)

Byte 3

Reserva = 0

Bytes 4 a 7

CMP_V1

Valor de comparación 1; cargar con el bit T_CMP_V1

Byte 8 a 11

CMP_V2

Valor de comparación 2; cargar con el bit T_CMP_V2

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

261

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Offset de la direc‐
ción inicial

Parámetro

Significado

Byte 12

–

Bit 7: Reserva = 0

NEUSTQ

Bit 6: Acuse de rearranque completo

–

Bit 5: reserva = 0

–

Bit 4: reserva = 0

OT_ERR_A

Bit 3: Acuse de error de operador

–

Bit 2: reserva = 0

–

Bit 1: reserva = 0

–

Bit 0: reserva = 0

–

Bit 7: reserva = 0

–

Bit 6: reserva = 0

–

Bit 5: reserva = 0

–

Bit 4: reserva = 0

SW_GATE

Bit 3: Bit de control puerta SW

GATE_STP

Bit 2: Parada general de puerta

ENSET_DN

Bit 1: Habilitación sincronización descendente

ENSET_UP

Bit 0: Habilitación sincronización ascendente

–

Bit 7: reserva = 0

–

Bit 6: reserva = 0

–

Bit 5: reserva = 0

–

Bit 4: reserva = 0

SET_DO1

Bit 3: Bit de control DO1

SET_DO0

Bit 2: Bit de control DO0

CTRL_DO1

Bit 1: Habilitación DO1

Byte 13

Byte 14

Byte 15

CTRL_DO0

Bit 0: Habilitación DO0

–

Bit 7: reserva = 0

C_DOPARA1)

Bit 6: Función DO0/DO1, modificar histéresis o duración del impulso

RES_ZERO

Bit 5: Desactivar bits de estado de paso por cero, rebase por exceso, rebase por
defecto y comparador

RES_SYNC

Bit 4: Desactivar bit de estado para sincronización

T_CMP_V2

2)

T_CMP_V12)
L_PREPAR

2)

L_DIRECT2)

Bit 3: Cargar valor de comparación 2
Bit 2: Cargar valor de comparación 1
Bit 1: Carga anticipativa del contador
Bit 0: Carga directa y anticipativa del contador

1)

Este bit no se puede activar al mismo tiempo que el bit 0, 1, 2 ó 3 del byte 15.

2)

Este bit no se puede activar al mismo tiempo que el bit 6 del byte 15.

262

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Aclaraciones sobre los bits de control de los modos de contaje
Bit de control

Aclaraciones

C_DOPARA

Con este bit se modifica la función y el comportamiento de DO0 y DO1, la histéresis y la duración
del impulso.
Los valores del byte 0 a 2 se aceptan como nueva función, histéresis y duración del impulso de
DO0, DO1.
Si no se desean modificar los valores, hay que transferir los valores antiguos.

CTRL_DO0

Habilitación DO0
Con este bit se habilita la salida DO0.

CTRL_DO1

Habilitación DO1
Con este bit se habilita la salida DO1.

ENSET_DN

Con este bit se habilita la carga del contador al contar en sentido ascendente.

ENSET_UP

Con este bit se habilita la carga del contador al contar en sentido descendente.

GATE_STP

Con este bit se cierra la puerta interna.

L_DIRECT

Con este bit se carga el contador de forma directa y anticipativa.

L_PREPAR

Con este bit se carga el contador de forma anticipativa.

NEUSTQ

Con este bit se acusa un arranque del FM 350‑1.
Después del arranque, el FM 350‑1 no detecta si se produce un control o una entrada de datos
hasta que se ha activado este bit. El bit NEUSTQ se activa con la instrucción CNT_CNTL1 en
cuanto se ha activado la señal de realimentación FM_NEUST y la señal de realimentación es
FM_NEUSTQ = 0 . Se desactiva con la instrucción CNT_CNTL1 cuando el bit FM_NEUST ha sido
desactivado por el FM 350‑1 y el bit FM_NEUSTQ ha sido activado por el FM 350‑1.
Si no se utiliza la instrucción CNT_CNTL1, es preciso realizar la coordinación del rearranque a
través del programa de usuario.

OT_ERR_A

Con este bit se acusa un error de operador.
Si necesita información más detallada sobre el error de operador, deberá leerla en la interfaz de
realimentación antes de acusar el error. El aviso de error ya no es válido después del acuse.

RES_SYNC

Con este bit se desactiva el bit de realimentación STS_SYNC y, con ello, se acusa la carga del
contador con la entrada de sincronización DI-Set.

RES_ZERO

Con este bit se desactivan los bits de realimentación STS_ZERO, STS_OFLW, STS_UFLW,
STS_COMP1 y STS_COMP2.

SET_DO0

Este activa y desactiva la salida digital DO0 si para la salida se ha parametrizado el comporta‐
miento "No se compara" y si se ha activado el bit de habilitación CRTL_DO0.

SET_DO1

Este activa y desactiva la salida digital DO1 si para la salida se ha parametrizado el comporta‐
miento "No se compara" y si se ha activado el bit de habilitación CRTL_DO1.

SW_GATE

Con este bit se abre y cierra la puerta SW.

T_CMP_V1

Con este bit se carga el valor del byte 4 a 7 en el valor de comparación 1.

T_CMP_V2

Con este bit se carga el valor del byte 8 a 11 en el valor de comparación 2.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

263

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de realimentación de los modos de contaje
Interfaz de realimentación de los modos de contaje
La siguiente tabla muestra la asignación de la interfaz de realimentación (las entradas) del
FM 350‑1 para los modos de contaje.
Offset de la direc‐
ción inicial

Parámetro

Significado

Byte 0 a 3

LATCH_LOAD

Valor de carga legible o valor de contaje almacenado con la función de conge‐
lación en la entrada digital

Bytes 4 a 7

ACT_CNTV

Estado del contador

Bytes 8 a 9

DA_ERR_W

Error de datos

Byte 10

OT_ERR_B

Error de operador

Byte 11

PARA

Bit 7: Parametrización realizada

FM_NEUST

Bit 6: Solicitud de rearranque completo

FM_NEUSTQ

Bit 5: Acuse de rearranque completo realizado

DATA_ERR

Bit 4: Error de datos

OT_ERR

Bit 3: Error de operador

DIAG

Bit 2: Evento de diagnóstico

–

Bit 1: reserva = 0

–

Bit 0: reserva = 0

Byte 12

–

reserva = 0

Byte 13

STS_SW_GATE

Bit 7: Estado de la puerta SW

STS_GATE

Bit 6: Estado de la puerta

STS_SYNC

Bit 5: Sincronización

STS_UFLW

Bit 4: Rebase del límite inferior

STS_OFLW

Bit 3: Rebase del límite superior

STS_ZERO

Bit 2: Paso por cero

STS_DIR

Bit 1: Bit de sentido

STS_RUN

Bit 0: Contador en funcionamiento

264

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Offset de la direc‐
ción inicial

Parámetro

Significado

Byte 14

STS_COMP2

Bit 7: Estado remanente del comparador 2

STS_COMP1

Bit 6: Estado remanente del comparador 1

STS_CMP2

Bit 5: Estado de la salida DO1

STS_CMP1

Bit 4: Estado de la salida DO0

STS_STP

Bit 3: Estado de la entrada digital DI-Stop

STS_STA

Bit 2: Estado de la entrada digital DI-Start

STS_LATCH

Bit 1: Nuevo valor de congelación en modo isócrono

STS_SET

Bit 0: Estado de la entrada digital DI-Set

–

Bit 7: reserva = 0

STS_C_DOPARA

Bit 6: Función DO0/DO1, modificar histéresis o duración del impulso

STS_RES_ZERO

Bit 5: Desactivar bit de estado para paso por cero, rebase por exceso, rebase por
defecto o comparador

STS_RES_SYNC

Bit 4: Desactivar bit de estado Sincronización

Byte 15

STS_T_CMP_V2
STS_T_CMP_V1
STS_L_PREPAR
STS_L_DIRECT

Bit 3: Cargar valor de comparación 2
Bit 2: Cargar valor de comparación 1
Bit 1: Carga anticipativa del contador
Bit 0: Carga directa y anticipativa del contador

Aclaraciones sobre los bits de realimentación de los modos de contaje
Bit de realimentación

Significado

DATA_ERR

Este bit indica que se ha registrado un error de datos (error de parametrización) en la interfaz de
realimentación.

DIAG

El bit se activa cuando se ha actualizado el registro de diagnóstico DS1 para notificar un evento
de diagnóstico. Una vez leído el registro DS1 se vuelve a desactivar el bit. Si no hay ninguna
alarma de diagnóstico habilitada, este bit se puede utilizar como bit de inicio para la instrucción
DIAG_INF integrada en el OB 1.

FM_NEUST

El FM 350‑1 activa este bit cada vez que ejecuta un rearranque completo o cada vez que detecta
un arranque del sistema, independientemente de si el sistema arranca de forma manual o auto‐
mática. Con el siguiente flanco ascendente en el bit NEUSTQ se desactiva el bit FM_NEUST. A
continuación, el FM 350‑1 puede controlarse, lo que permite la lectura y la transferencia de datos
desde el mismo.

FM_NEUSTQ

El FM 350‑1 borra este bit cada vez que ejecuta un rearranque completo o cada vez que detecta
un arranque del sistema, independientemente de si el sistema arranca de forma manual o auto‐
mática. Se activa cuando se desactiva el bit FM_NEUST.

OT_ERR

Este bit se activa cuando se registra un error de operaror en la interfaz de realimentación. Se
desactiva cuando se activa el bit OT_ERR_A. Mientras el bit OT_ERR permanece activo, no
puede notificarse otro error de operador.

PARA

Este bit se activa si el módulo ha sido parametrizado sin errores. El registro de parámetros no
contiene errores en el módulo. No obstante, este bit sólo se activa si se ha activado el bit
FM_NEUSTQ. A partir de este momento los valores de la interfaz de realimentación son válidos
y actuales.

STS_C_DOPARA

Bit de acuse para la modificación simultánea del comportamiento de DO0 y DO1, de la histéresis
y de la duración del impulso. Si no desea que los valores se modifiquen, debe transferir los
valores antiguos.

STS_CMP1

Estado de la salida DO0

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

265

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit de realimentación

Significado

STS_CMP2

Estado de la salida DO1

STS_T_CMP_V1

Bit de acuse de la carga del valor de comparación 1

STS_T_CMP_V2

Bit de acuse de la carga del valor de comparación 2

STS_COMP1

Este bit indica el estado almacenado de que la salida DO0 estaba activada. Esto también ocurre
en el caso de que la salida DO0 no se haya habilitado con CTRL_DO0. El estado almacenado se
desactiva realizando un acuse con RES_ZERO.

STS_COMP2

Este bit indica el estado almacenado de que la salida DO1 estaba activada. Esto también ocurre
en el caso de que la salida DO1 no se haya habilitado con CTRL_DO1. El estado almacenado se
desactiva realizando un acuse con RES_ZERO.

STS_DIR

Este bit indica el sentido de contaje del contador:
0 = ascendente (LED DIR apagado)
1 = descendente (LED DIR encendido)

STS_GATE

Este bit indica el estado de la puerta.
0 = Puerta cerrada
1 = Puerta abierta

STS_LATCH

Este bit muestra en modo isócrono si se ha almacenado por lo menos un nuevo valor de con‐
gelación entre el penúltimo Ti y el último Ti. Si el bit está activado, LATCH_LOAD contiene el
último valor de congelación. Si no se ha almacenado ningún otro valor de congelación, el bit no
está activado. En el modo no isócrono el bit no está activado.

STS_L_DIRECT

Bit de acuse de la carga directa y anticipativa del contador y del valor de carga.

STS_L_PREPAR

Bit de acuse de la carga anticipativa del valor de carga.

STS_OFLW

Este bit indica que se ha producido un rebase por exceso. El estado almacenado se desactiva
realizando un acuse con RES_ZERO.

STS_RES_SYNC

Desactivación del bit de realimentación STS_SYNC.

STS_RES_ZERO

Bit de acuse para la desactivación de los estados almacenados en los bits de realimentación
STS_ZERO, STS_OFLW, STS_UFLW, STS_COMP1 y STS_COMP2

STS_RUN

Este bit equivale al bit 20 del contador.
0 = LED CR apagado
1 = LED CR encendido

STS_SET

Estado de la entrada digital DI-Set

STS_STA

Estado de la entrada digital DI-Start

STS_STP

Estado de la entrada digital DI-Stop

STS_UFLW

Este bit indica que se ha producido un rebase por defecto. El estado almacenado se desactiva
realizando un acuse con RES_ZERO.

STS_SYNC

Este bit indica el estado almacenado de que el contador ha sido cargado por un evento en el DISet (sincronización). El estado almacenado se desactiva realizando un acuse con RES_SYNC.

STS_ZERO

Este bit indica el estado almacenado de que la lectura del contador tenía un paso por cero. El
estado almacenado se desactiva realizando un acuse con RES_ZERO.

266

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de control de los modos de medición
Interfaz de control de los modos de medición
El parámetro LOAD_VAL (byte 0 a 3) tiene dos significados:
● Si se activa el bit L_PREPAR, LOAD_VAL se interpreta como límite inferior.
● Si se define el bit C_DOPARA, en el byte 0 puede definirse el comportamiento de la salida
DO0.
La siguiente tabla muestra la asignación de la interfaz de control (las salidas) del FM 350‑1
para los modos de medición.
Offset respecto a
la dirección inicial

Parámetros

Asignación

Byte 0 a 3

LOAD_VAL

Cargar límite inferior con el bit L_PREPAR

Byte 0

Definir el comportamiento de la salida DO0 con el bit C_DOPARA
Bits 2 a 7:

Bit 1

Bit 0

Comportamiento de la salida DO0

irrelevante

0

0

No se compara

irrelevante

0

1

Fuera de los valores límite

irrelevante

1

0

Rebase por defecto del límite inferior

irrelevante

1

1

Rebase por exceso del límite superior

Byte 1

Reserva = 0

Byte 2

Reserva = 0

Byte 3

Reserva = 0

Bytes 4 a 7

CMP_V1

Cargar límite superior con el bit T_CMP_V1

Bytes 8 a 9

CMP_V2

Tiempo de actualización; cargar con el bit T_CMP_V2

Byte 10 a 11

–

–

Byte 12

–

Bit 7: reserva = 0

NEUSTQ

Bit 6: Acuse de rearranque completo

–

Bit 5: reserva = 0

–

Bit 4: reserva = 0

OT_ERR_A

Bit 3: Acuse de error de operador

–

Bit 2: reserva = 0

–

Bit 1: reserva = 0

–

Bit 0: reserva = 0

–

Bit 7: reserva = 0

–

Bit 6: reserva = 0

–

Bit 5: reserva = 0

–

Bit 4: reserva = 0

SW_GATE

Bit 3: Bit de control puerta SW

GATE_STP

Bit 2: Parada general de puerta

–

Bit 1: reserva = 0

–

Bit 0: reserva = 0

Byte 13

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

267

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Offset respecto a
la dirección inicial

Parámetros

Asignación

Byte 14

–

Bit 7: reserva = 0

–

Bit 6: reserva = 0

–

Bit 5: reserva = 0

–

Bit 4: reserva = 0

SET_DO1

Bit 3: Bit de control DO1

SET_DO0

Bit 2: Bit de control DO0

CTRL_DO1

Bit 1: Habilitación DO1

Byte 15

CTRL_DO0

Bit 0: Habilitación DO0

–

Bit 7: reserva = 0

C_DOPARA1)

Bit 6: Modificar función DO0

RES_ZERO

Bit 5: Desactivar bits de estado para rebase por exceso, rebase por defecto, fin
de medición

–
T_CMP_V22)
T_CMP_V1

2)

L_PREPAR2)
–

Bit 4: reserva = 0
Bit 3: Modificar tiempo de actualización
Bit 2: Cargar límite superior
Bit 1: Cargar límite inferior
Bit 0: –

1)

Este bit no se puede activar al mismo tiempo que el bit 1, 2 ó 3 del byte 15.

2)

Este bit no se puede activar al mismo tiempo que el bit 6 del byte 15.

Aclaraciones sobre los bits de control de los modos de medición
Bit de control

Significado

C_DOPARA

Con este bit se modifica la función y el comportamiento de DO0.
Los valores del byte 0 se aceptan como nueva función de DO0.
Si no desea que los valores se modifiquen, debe transferir los valores antiguos.

CTRL_DO0

Habilitación DO0
Con este bit se habilita la salida DO0.

CTRL_DO1

Habilitación DO1
Con este bit se habilita la salida DO1

GATE_STP

Con este bit se cierra la puerta interna.

L_PREPAR

Con este bit se carga el límite inferior.

NEUSTQ

Con este bit se acusa un arranque del FM 350‑1.
Después del arranque, el FM 350‑1 no detecta si se produce un control o una entrada de datos
hasta que se ha activado este bit. El bit NEUSTQ se activa con la instrucción CNT_CNTL1 en
cuanto se ha activado la señal de realimentación FM_NEUST y la señal de realimentación es
FM_NEUSTQ = 0 . Se desactiva con la instrucción CNT_CNTL1 cuando el bit FM_NEUST ha sido
desactivado por el FM 350‑1 y el bit FM_NEUSTQ ha sido activado por el FM 350‑1.
Si no se utiliza la instrucción CNT_CNTL1, es preciso realizar la coordinación del rearranque a
través del programa de usuario.

OT_ERR_A

Con este bit se acusa un error de operador.
Si necesita información más detallada sobre el error de operador, deberá leerla en la interfaz de
realimentación antes de acusar el error. El aviso de error ya no es válido después del acuse.

RES_ZERO

268

Con este bit se desactivan los bits de realimentación STS_OFLW, STS_UFLW y STS_COMP1.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit de control

Significado

SET_DO0

Este activa y desactiva la salida digital DO0 si para la salida se ha parametrizado el comporta‐
miento "No se compara" y si se ha activado el bit de habilitación CRTL_DO0.

SET_DO1

Este activa y desactiva la salida digital DO1 si para la salida se ha parametrizado el comporta‐
miento "No se compara" y si se ha activado el bit de habilitación CRTL_DO1.

SW_GATE

Con este bit se abre y cierra la puerta SW.

T_CMP_V1

Con este bit se carga el límite superior.

T_CMP_V2

Con este bit se carga el tiempo de actualización.

Interfaz de realimentación de los modos de medición
Interfaz de realimentación de los modos de medición
La siguiente tabla muestra la asignación de la interfaz de realimentación (las entradas) del
FM 350‑1 para los modos de medición.
Offset respecto a
la dirección inicial

Parámetros

Asignación

Byte 0 a 3

LATCH_LOAD

Valor de medida

Bytes 4 a 7

ACT_CNTV

Estado del contador

Bytes 8 a 9

DA_ERR_W

Error de datos

Byte 10

OT_ERR_B

Error de operador

Byte 11

PARA

Bit 7: Parametrización realizada

FM_NEUST

Bit 6: Solicitud de rearranque completo

FM_NEUSTQ

Bit 5: Acuse de rearranque completo realizado

DATA_ERR

Bit 4: Error de datos

OT_ERR

Bit 3: Error de operador

DIAG

Bit 2: Evento de diagnóstico

–

Bit 1: reserva = 0

–

Bit 0: reserva = 0

Byte 12
Byte 13

reserva = 0
–

Bit 7: reserva = 0

STS_GATE

Bit 6: Estado de la puerta

–

Bit 5: reserva = 0

STS_UFLW

Bit 4: Rebase por defecto

STS_OFLW

Bit 3: Rebase por exceso

STS_COMP1

Bit 2: Final de medición

STS_DIR

Bit 1: Bit de sentido

STS_RUN

Bit 0: Contador en funcionamiento

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

269

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Offset respecto a
la dirección inicial

Parámetros

Asignación

Byte 14

–

Bit 7: reserva = 0

–

Bit 6: reserva = 0

STS_CMP2

Bit 5: Estado de la salida DO1

STS_CMP1

Bit 4: Estado de la salida DO0

STS_STP

Bit 3: Estado de la entrada digital DI-Stop

STS_STA

Bit 2: Estado de la entrada digital DI-Start

–

Bit 1: reserva = 0

STS_SET

Bit 0: Estado de la entrada digital DI-Set

–

Bit 7: reserva = 0

STS_C_DOPARA

Bit 6: Modificar función DO0

STS_RES_ZERO

Bit 5: Desactivar bit de estado Fin de medición

–

Bit 4: reserva = 0

STS_T_CMP_V2

Bit 3: Modificar tiempo de actualización

STS_T_CMP_V1

Bit 2: Cargar límite superior

STS_L_PREPAR

Bit 1: Cargar límite inferior

–

Bit 0: reserva = 0

Byte 15

Aclaraciones sobre los bits de realimentación de los modos de medición
Bit de realimentación

Significado

DATA_ERR

Este bit indica que se ha registrado un error de datos en la interfaz de realimentación.

DIAG

El bit se activa cuando se ha actualizado el registro de diagnóstico DS1 para notificar un evento
de diagnóstico. Una vez leído el registro DS1 se vuelve a desactivar el bit. Si no hay ninguna
alarma de diagnóstico habilitada, este bit se puede utilizar como bit de inicio para la instrucción
DIAG_INF integrada en el OB 1.

FM_NEUST

El FM 350‑1 activa este bit cada vez que ejecuta un rearranque completo o cada vez que detecta
un arranque del sistema, independientemente de si el sistema arranca de forma manual o auto‐
mática. Con el siguiente flanco ascendente en el bit NEUSTQ se desactiva el bit FM_NEUST. A
continuación, el FM 350‑1 puede controlarse, lo que permite la lectura y la transferencia de datos
desde el mismo.

FM_NEUSTQ

El FM 350‑1 borra este bit cada vez que ejecuta un rearranque completo o cada vez que detecta
un arranque del sistema, independientemente de si el sistema arranca de forma manual o auto‐
mática. Se activa cuando se desactiva el bit FM_NEUST.

OT_ERR

Este bit se activa cuando se registra un error de operador en la interfaz de realimentación. Se
desactiva cuando se activa el bit OT_ERR_A. Mientras el bit OT_ERR permanece activo, no
puede notificarse otro error de operador.

PARA

Este bit se activa si el módulo ha sido parametrizado sin errores. El registro de parámetros no
contiene errores en el módulo. No obstante, este bit sólo se activa si se ha activado el bit
FM_NEUSTQ. A partir de este momento los valores de la interfaz de realimentación son válidos
y actuales.

STS_C_DOPARA

Bit de acuse para la modificación simultánea del comportamiento de DO0 y DO1, de la histéresis
y de la duración del impulso. Si no desea que los valores se modifiquen, debe transferir los
valores antiguos.

STS_CMP1

Estado de la salida DO0

STS_CMP2

Estado de la salida DO1

STS_CMP_T_VAL1

Bit de acuse de la carga del límite superior

270

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit de realimentación

Significado

STS_CMP_T_VAL2

Bit de acuse para la carga del tiempo de actualización

STS_DIR

Este bit indica el sentido de contaje del contador:
0 = ascendente (LED DIR apagado)
1 = descendente (LED DIR encendido)

STS_GATE

Este bit indica el estado de la puerta.
0 = Puerta cerrada
1 = Puerta abierta

STS_L_PREPAR

Bit de acuse de la carga del límite inferior

STS_OFLW

Este bit indica el estado almacenado en el que un valor medido es mayor que el límite superior.
El estado almacenado se desactiva realizando un acuse con RES_ZERO.

STS_RES_ZERO

Bit de acuse para la desactivación de los estados almacenados en los bits de realimentación
STS_OFLW, STS_UFLW y STS_COMP1

STS_RUN

Este bit equivale al bit 20 del contador.
0 = LED CR apagado
1 = LED CR encendido

STS_SET

Estado de la entrada digital DI-Set

STS_STA

Estado de la entrada digital DI-Start

STS_STP

Estado de la entrada digital DI-Stop

STS_UFLW

Este bit indica el estado almacenado en el que un valor medido es menor que el límite inferior. El
estado almacenado se desactiva realizando un acuse con RES_ZERO.

Uso del FM 350-1 desde el programa de usuario
Inclusión del FM 350-1 en un programa de usuario
Para integrar el FM 350-1 en un programa de usuario pueden utilizarse instrucciones que le
facilitarán en lo posible el manejo de las funciones deseadas:
Las instrucciones CNT_CTRL, CNT_CTL1 y CNT_CTL2 se activan en el programa de usuario
de la CPU. Éstas permiten la comunicación entre la CPU y el FM 350-1.
Todos los datos pertenecientes a un canal del módulo se encuentran en el DB de la instrucción
CNT_CTRL, CNT_CTL1 o CNT_CTL2 (DB de contaje). Inserte en el proyecto un bloque de
datos del tipo CNT_CHANTYPE1 mediante "Bloques de programa > Agregar bloque".
Además, para el FM 350-1 se puede utilizar también la instrucción DIAG_INF, que permite
transferir información de diagnóstico al DB de contaje.
La instrucción CNT_CTL2 sólo se utiliza en el modo isócrono.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

271

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

FM 350-1: Online y diagnóstico
Información actual sobre el módulo
Diagnóstico estándar
Indicación de fallos mediante el LED de error de grupo del FM 350-1
¿Dónde se indica el fallo?
Si el LED rojo de error de grupo se enciende, significa que se ha producido un fallo en el módulo
(fallo interno) o en las conexiones (fallo externo).

¿Qué fallos se indican?
La tabla siguiente muestra los tipos de fallos indicados por el LED de error de grupo.
Tipo de fallo

Causa del fallo

Solución

Fallos internos

Fallo en el test de la EPROM

Sustituir el módulo

Fallo en test de RAM

Sustituir el módulo

Disparo del temporizador de vigilancia
(watchdog)

Sustituir el módulo

Alarma de proceso perdida

Aumentar el intervalo de tiempo entre
las causas de las alarmas

Falta la parametrización del módulo

Definir y transferir la parametrización

Conector codificador en posición inco‐
rrecta

Corregir la posición del conector codifi‐
cador

Tensión auxiliar 1L+/1M no conectada o
cortocircuito en la alimentación del en‐
códer DC24V

Corregir la conexión

Fallos externos

Cortocircuito o sobrecarga en la alimen‐ Corregir la conexión
tación del encóder DC5.2V
Fallos en las señales del encóder de 5 V
(rotura de hilo, cortocircuito, falta de lí‐
nea)

Corregir la conexión

La parametrización del módulo no con‐
cuerda con la posición del conector co‐
dificador

Corregir y transferir la parametrización,
o bien modificar la posición del conector
codificador

Disparo de una alarma de diagnóstico
Todos los fallos, exceptuando el del test de la EPROM, pueden disparar una alarma de
diagnóstico si ésta se ha habilitado en los parámetros básicos de la parametrización. En
los registros de diagnóstico DS0 y DS1 (Página 274) se puede consultar qué fallo ha
ocasionado que se encienda el LED.

272

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Diagnóstico específico de canal
Disparo de alarmas de diagnóstico
¿Qué es una alarma de diagnóstico?
Si se quiere que un programa de usuario responda a un error interno o externo, se puede
parametrizar una alarma de diagnóstico que interrumpa el programa cíclico de la CPU y llame
al OB de alarma de diagnóstico.

¿Qué eventos pueden provocar una alarma de diagnóstico?
Los siguientes eventos pueden provocar una alarma de diagnóstico:
● Tensión auxiliar externa 1L+/1M defectuosa
● Alimentación de 5,2 V DC del encóder cortocircuitada o sobrecargada
● Falta parametrización del módulo
● Error en la parametrización del módulo
● La vigilancia de tiempo (watchdog) ha saltado
● Defecto en RAM
● Alarma de proceso perdida
● Señal A defectuosa (rotura de hilo, cortocircuito, falta un cable)
● Señal B defectuosa (rotura de hilo, cortocircuito, falta un cable)
● Señal N defectuosa (rotura de hilo, cortocircuito, falta un cable)
● Conector codificador en posición incorrecta

Habilitar la alarma de diagnóstico
En la configuración del hardware las alarmas del módulo se habilitan en los parámetros
básicos y se especifica si el módulo debe activar una alarma de diagnóstico y/o una alarma de
proceso.

Respuestas a una alarma de diagnóstico
Cuando se produce un evento que puede disparar una alarma de diagnóstico ocurre lo
siguiente:
● La información de diagnóstico se registra en los registros de diagnóstico DS0 y DS1
(Página 274) del módulo.
● El LED de error de grupo se enciende.
Una vez eliminado el error, se apaga el LED de error de grupo.
● Se llama al OB de alarma de diagnóstico (por ejemplo, OB 82).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

273

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● El registro de diagnóstico DS0 se graba en la información de arranque del OB de alarma de
diagnóstico.
● El contaje prosigue sin cambios si se ha programado un OB de alarma de diagnóstico. La
CPU pasa a modo STOP si no hay OB de alarma de diagnóstico.

Ajuste predeterminado
En el ajuste predeterminado no se han habilitado alarmas de diagnóstico.

Registro de diagnóstico DS0 y DS1
Registro de diagnóstico DS0 y DS1
La información que indica qué evento ha provocado una alarma de diagnóstico se guarda en
los registros de diagnóstico DS0 y DS1. El registro de diagnóstico DS0 consta de cuatro bytes;
DS1 consta de 16 bytes, siendo los cuatro primeros idénticos a DS0.

Leer registro del módulo
El registro de diagnóstico DS0 (Página 275) se transfiere automáticamente a la información de
arranque en la llamada del OB de diagnóstico. Allí, los cuatro bytes se guardan en los datos
locales (bytes 8 a 11) del OB de alarma de diagnóstico.
El registro de diagnóstico DS1 (Página 276) (y, por lo tanto, también el contenido del DS0)
puede leerse con la instrucción DIAG_INF del módulo. Esa lectura sólo tiene sentido si en el
DS0 se notifica un fallo en un canal.

274

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación del registro de diagnóstico DS0
Asignación del registro de diagnóstico DS0 y de la información de arranque
La tabla siguiente muestra la asignación del registro de diagnóstico DS0 en la información de
arranque. Todos los bits que no se incluyen en la tabla son irrelevantes y tienen el valor cero.
Byte

Bit

Significado

Nota

Nº de evento

0

0

Fallo en módulo

Se activa en todos los eventos de diagnóstico

8:x:00

1

Error interno

Se activa para todos los fallos internos:

8:x:01

● Fallo en test de RAM
● La vigilancia de tiempo (watchdog) ha saltado
● Alarma de proceso perdida
2

Error externo

Se activa para todos los errores externos:

8:x:02

● Tensión auxiliar 1L+/1M no conectada o
alimentación del encóder de 5,2 V DC
cortocircuitada
● Alimentación de 5,2 V DC del encóder
cortocircuitada o sobrecargada
● Señales de 5 V defectuosas
● Error de parametrización
Para obtener más detalles, consulte DS1, byte 4 (Pá‐ 8:x:03
gina 276)

3

Fallo en un canal

4

Defecto de la tensión auxiliar exter‐ Comprobar tensión
na

8:x.04

6

Falta parametrización

Realizar la parametrización

8:x:06

7

Error de parametrización

Para más información, consulte el capítulo Errores de
datos (Página 276)

8:x:07

1

0...3

Clase de tipo

Siempre tiene asignado un 8

4

Información de canal

Siempre tiene asignado un 1

2

3

La vigilancia de tiempo (watchdog)
ha saltado

Módulo defectuoso o fuertes interferencias

3

3

Defecto en RAM

Módulo defectuoso o fuertes interferencias

8:x:43

6

Alarma de proceso perdida

Comprobar la configuración. Se ha detectado un
evento y no se ha podido notificar porque el mismo
evento aún no se ha sido acusado por la CPU.

8:x:46

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

8:x:33

275

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación del registro de diagnóstico DS1
Asignación del registro de diagnóstico DS1
El registro de diagnóstico DS1 se compone de 16 bytes. Los primeros 4 bytes son idénticos a
los del registro de diagnóstico DS0. La siguiente tabla muestra la asignación de los bytes
restantes. Todos los bits que no se incluyen en la tabla son irrelevantes y tienen el valor cero.
Este registro es introducido por la instrucción DIAG_INF en el DB de la CNT_CTL1 a partir de
la DW54.
Byte
4

Bit

Significado

Nota

Nº de evento

0...6

Tipo de canal

Siempre con un 76H asignado

7

Otros tipos de canal

Siempre tiene asignado un 0

5

0...7

Longitud de la información de diagnós‐ Siempre con un 10H asignado
tico

6

0...7

Número de canales

Siempre tiene asignado un 1

7

0

Vector de error de canal

En caso de un error de canal siempre con
un 1 asignado

8

0

Señal A errónea

8:x:B0

1

Señal B errónea

8:x:B1

2

Señal N errónea

8:x:B2

4

Fallo en alimentación de 5,2 V del en‐
códer

8:x:B4

5...7

Reservado

9 ... 15

Reservado

Error de datos
¿Cuándo se producen errores de datos?
Cuando se transfieren nuevos parámetros al módulo, el FM 350‑1 comprueba dichos
parámetros. Si se producen errores durante esta comprobación, el módulo notifica estos
errores.

¿Dónde se indican los errores de datos?
La instrucción CNT_CTL1 registra los errores de datos con sus números de error en el DB de
CNT_CTL1. La variable DA_ERR_W permite acceder a esta palabra de datos en el programa
de usuario.

276

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

¿Qué errores de datos existen?
En la tabla siguiente se muestran los errores de datos, junto con el número de error y el
significado.
Nº

Significado

0

No hay error

200

Posición incorrecta del adaptador del margen o falta dicho adaptador

201

La posición del adaptador no es compatible con el encóder parametrizado

202

Valor erróneo para el diagnostico de la pareja de señales

203

Valor erróneo para evaluación de las señales

204

Valor erróneo para filtro de entrada de las señales de contaje de 24 V

205

Valor erróneo para el filtro de entrada de las entradas digitales

206

Inversión del sentido no admisible

207

Comportamiento de DO0 parametrizado incorrectamente

208

Comportamiento de DO1 parametrizado incorrectamente

209

Rango excedido en la duración del impulso

211

Se ha seleccionado un modo de operación incorrecto

212

No se ha indicado ninguna puerta o se han indicado ambas

213

Sentido principal de contaje parametrizado incorrectamente

214

Rango excedido en el límite superior de contaje

215

Al parametrizar la alarma de proceso "Alcanzar el valor de comparación adelante o atrás" se
ha definido un sentido de contaje distinto del especificado en la parametrización del compor‐
tamiento de las salidas "Activar al alcanzarse el valor de comparación por la duración del
impulso adelante o atrás". Estos sentidos de contaje deben coincidir.

216

Las alarmas por control de puerta sólo son posibles en los modos de operación con control de
puerta.

217

En el comportamiento "Activar si estado del contador >= valor de comparación" o "Activar si
estado del contador <= valor de comparación", no se soporta una alarma al "alcanzarse los
valores de comparación".

218

Alarma en caso de paso por cero no permitida

219

Codificación del ajuste "Congelar" incorrecta

220

Control de puerta parametrizado incorrectamente

221

Rango excedido en valor límite inferior o valor de carga

222

Rango excedido en valor límite superior o valor de comparación 1

223

Rango excedido en tiempo de actualización o valor de comparación 2

224

Rango excedido en impulsos por vuelta del encóder

¿Cómo se acusan los errores de datos?
Corrija los valores de los parámetros de acuerdo con los valores predeterminados.
Retransfiera el juego de parámetros corregido al FM 350‑1. Éste vuelve a comprobar los
parámetros y borra los errores de datos del DB.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

277

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Errores de operador
¿Cuándo aparecen los errores de operador?
Los errores de operador aparecen cuando se controla el módulo incorrectamente por
especificar las señales de control incorrectamente.

¿Dónde se indican los errores de operador?
La instrucción CNT_CTL1 registra los números de errores de operador en el DB. Activando el
parámetro de salida OT_ERR la instrucción CNT_CTL1 muestra que se ha producido un error
de operador. La variable OT_ERR_B permite acceder a este byte de datos en el programa.

¿Qué errores de operador existen?
En la tabla siguiente se muestran los errores de operador, junto con el número de error y el
significado.
Nº

Significado

0

No hay error

1

El modo de operación no se puede iniciar con puerta SW

2

El modo de operación no se puede cancelar

4

Solo se soporta con la CPU en STOP

5

Solo se puede activar el bit de control para la parametrización

6

Tarea no permitida

10

Rango excedido en valor límite inferior o valor de carga

11

Rango excedido en valor límite superior o valor de comparación 1

12

Rango excedido en tiempo de actualización o valor de comparación 2

20

Comportamiento de DO0 parametrizado incorrectamente

21

Comportamiento de DO1 parametrizado incorrectamente

22

Rango excedido en la duración del impulso

90

Véase CNT_CTL2

91

Véase CNT_CTL2

¿Cómo se acusan los errores de operador?
Acuse el error con el parámetro de entrada OT_ERR_A de la instrucción CNT_CTL1 o
CNT_CTL2.

278

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

1.2.1.3

Uso del FM 350-2

Asignación de conectores del conector frontal del FM 350-2
Conector frontal
En el conector frontal de 40 polos se conectan:
● Señales de contaje
● Entradas digitales
● Salidas digitales
● Alimentación del encóder y tensión del módulo
La figura siguiente muestra el lado frontal del módulo, el conector frontal y el lado interior de la
tapa frontal con la asignación de terminales.

1

2

3

FM 350-2
COUNTER ?
MODULE

SF

21

I0

I4

I1

I5

I2

I6

I3

I7

Q0

Q4

Q1

Q5

Q2

Q6

Q3

Q7

X 2
3 4

1

21

2

22

3

23

4

24

5

25

6

26

7

27

8

28

9

29

10

30

11

31

12

32

13

33

14

34

15

35

16

36

17

37

18

38

19

39

20

40

22
3
4
5
6
7
8
9
10

11
12
13

A0
A1
A2
A3
B0
B1
B2
B3

M 23
A4
24
A5
25
A6
26
A7
27
B4
28
B5
29
B6
30
B7

31
32
33

14

34

15

35

16

36

17
18
19
20

37
38
DC 8,2V 39
SUPPLY 40
DC 8,2V

350 2AH00 oAE0

①
②
③

Frontal del módulo
Conector frontal
Interior de la puerta frontal

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

279

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación del conector frontal
La tabla siguiente muestra la asignación de terminales del conector frontal del FM 350-2.

280

Terminal

Nombre

Entrada/salida

Función

1

-

-

No conectado

2

-

-

No conectado

3

A0

Entrada

Entrada de contaje NAMUR / BERO, canal 0

4

A1

Entrada

Entrada de contaje NAMUR / BERO, canal 1

5

A2

Entrada

Entrada de contaje NAMUR / BERO, canal 2

6

A3

Entrada

Entrada de contaje NAMUR / BERO, canal 3

7

B0

Entrada

Entrada de dirección BERO, canal 0

8

B1

Entrada

Entrada de dirección BERO, canal 1

9

B2

Entrada

Entrada de dirección BERO, canal 2

10

B3

Entrada

Entrada de dirección BERO, canal 3

11

I0

Entrada

Entrada de puerta hardware BERO, canal 0

12

I1

Entrada

Entrada de puerta hardware BERO, canal 1

13

I2

Entrada

Entrada de puerta hardware BERO, canal 2

14

I3

Entrada

Entrada de puerta hardware BERO, canal 3

15

Q0

Salida

Salida digital 0,5 A, canal 0

16

Q1

Salida

Salida digital 0,5 A, canal 1

17

Q2

Salida

Salida digital 0,5 A, canal 2

18

Q3

Salida

Salida digital 0,5 A, canal 3

19

P8V2

Salida

Alimentación para detector NAMUR 8,2 V

20

P8V2

Salida

Alimentación para detector NAMUR 8,2 V

21

L+

Entrada

Alimentación del módulo de 24 V

22

M

Entrada

Masa del módulo

23

A4

Entrada

Entrada de contaje NAMUR / BERO, canal 4

24

A5

Entrada

Entrada de contaje NAMUR / BERO, canal 5

25

A6

Entrada

Entrada de contaje NAMUR / BERO, canal 6

26

A7

Entrada

Entrada de contaje NAMUR / BERO, canal 7

27

B4

Entrada

Entrada de dirección BERO, canal 4

28

B5

Entrada

Entrada de dirección BERO, canal 5

29

B6

Entrada

Entrada de dirección BERO, canal 6

30

B7

Entrada

Entrada de dirección BERO, canal 7

31

I4

Entrada

Entrada de puerta hardware BERO, canal 4

32

I5

Entrada

Entrada de puerta hardware BERO, canal 5

33

I6

Entrada

Entrada de puerta hardware BERO, canal 6

34

I7

Entrada

Entrada de puerta hardware BERO, canal 7

35

Q4

Salida

Salida digital 0,5 A, canal 4

36

Q5

Salida

Salida digital 0,5 A, canal 5

37

Q6

Salida

Salida digital 0,5 A, canal 6

38

Q7

Salida

Salida digital 0,5 A, canal 7

39

P8V2

Salida

Alimentación para detector NAMUR 8,2 V

40

P8V2

Salida

Alimentación para detector NAMUR 8,2 V

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Nota
Los circuitos para las entradas de contaje (alimentación del encóder, señales del encóder)
están aislados de la tierra de la CPU.
Todas las entradas están unidas galvánicamente y aisladas del S7-300.
Encontrará más información sobre la estructura y el cableado en el manual de puesta en
servicio y montaje (http://support.automation.siemens.com/WW/view/es/1105178) del módulo
de contaje FM 350‑2.

Alimentación de tensión de 24 V
Conecte un tensión continua de 24 V en los terminales L+ y M para alimentar el FM 350-2.

Alimentación del encóder 8,2 V DC
A partir de los 24 V de alimentación, el módulo genera una tensión de 8,2 V (máx. 200 mA).
Esta tensión está disponible en los terminales P8V2 (pines 19, 20, 39 y 40) para la alimentación
de los detectores NAMUR y es resistente a cortocircuitos.
Se controla que la alimentación del encóder se mantenga a 8,2 V.

Señales de encóder A0 a A7 y B0 a B7
Se pueden conectar cuatro tipos diferentes de encóders:
● Sensores NAMUR conforme a la DIN 19234 (con diagnóstico):
Las señales se conectan a los terminales A0 a A7.
● Encóder incremental de 24 V:
Las señales comprendidas entre A0/B0 y A7/B7 se conectan a los terminales con la
identificación correspondiente.
● Encóder incremental de posición de 24 V con nivel de sentido:
Las señales de contaje se conectan a los terminales A0 a A7. Los niveles de sentido se
conectan a los terminales A0 a A7.
● Detectores de proximidad de 24 V:
Las señales se conectan a los terminales A0 a A7.
Nota
Para alimentar los detectores de 24 V es preciso utilizar una fuente de alimentación externa
de 24 V DC.

Entradas digitales de I0 a I7 (puertas hardware)
Para el control de puerta del contador se pueden usar las entradas digitales comprendidas
entre I0 y I7.
A cada canal de contaje le corresponde una entrada digital para iniciar y detener el contador
correspondiente.
Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

281

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Las entradas digitales funcionan con una tensión nominal de 24 V.

Salidas digitales de Q0 a Q7
El FM 350-2 dispone de salidas digitales de Q0 a Q7 para lanzar directamente procesos de
control.
Hay disponible una salida digital para cada contador.
Las salidas digitales se alimentan con la tensión de alimentación de 24 V del FM 350-2.
Las salidas digitales son salidas tipo PNP y pueden trabajar con una corriente de carga de 0,5
A. Están protegidas contra sobrecarga y cortocircuito.
Nota
Se pueden conectar directamente relés y contactores sin circuitería externa.

Configurar FM 350-2
Parametrizar FM 350-2
Especificar canales
Seleccionar ajustes de canal
Ajuste del canal
En este caso es posible ajustar la función que tienen los canales del módulo:
● Contador individual: En el grupo seleccionado cada canal funciona por separado como
contador.
● Contador de dosificación: 4 canales de contaje se agrupan respectivamente en un canal de
dosificación. Desde este canal pueden controlarse hasta 4 unidades de dosificación.
Se dispone de las siguientes posibilidades de selección:
● Canal 0..7 como contador individual
● Canal 0 como contador de dosificación, canal 4..7 como contador individual
● Canal 0..3 como contador individual, canal 4 como contador de dosificación
● Canal 0 como contador de dosificación y canal 4 como contador de dosificación

282

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Habilitar entrada de contador para sensores NAMUR
Sensores NAMUR
En este campo es posible habilitar las entradas de contador en las que hay conectado un
sensor NAMUR.
Dispone de las siguientes posibilidades de selección:
● Entrada de contador canal 0..3 NAMUR
y/o
● Entrada de contador canal 4..7 NAMUR
Véase también: "Señales NAMUR (Página 283)" y "Habilitar vigilancia de hardware para
sensores NAMUR (Página 290)"

Señales NAMUR
Sensores NAMUR
El detector proporciona una señal de contaje conforme con la norma DIN 19234 que se ha de
conectar a los terminales A0 a A7 del conector frontal.
Se puede conectar una señal para la detección del sentido (24 V) a los terminales B0 a B7 del
contador pertinente. Si el detector no proporciona una señal pertinente en el S7 se puede
generar y conectar también una identificación, o bien se puede usar una señal de proceso
equivalente.
La figura siguiente muestra la evolución temporal de las señales del detector NAMUR con nivel
de sentido.

Señal A0 .... A7
Señal B0 ... B7 como señal de
sentido

$GHODQWH

$WU£V

Impulsos de contaje adelante
Impulsos de contaje atrás
Es posible habilitar las entradas A0 … A3, A4 … A7 o bien todas ellas para conectar los
sensores NAMUR.

¿Cómo se vigilan las señales?
Si se ha parametrizado el FM 350‑2 convenientemente, el módulo vigila cualquier rotura de hilo
o cortocircuito que ocurra en A0 … A7. Con ello, indirectamente se vigilará también la
alimentación del detector de 8,2 V. Esta vigilancia sólo es posible en los sensores NAMUR.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

283

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
En caso de rotura de hilo o cortocircuito, se encenderá el LED de error de grupo;
adicionalmente se puede definir también una alarma de diagnóstico.
PRECAUCIÓN
Se pueden producir daños materiales.
La conexión de un encóder o un detector en un canal del FM 350‑2 que había sido
parametrizado para un sensor NAMUR puede dañar el módulo.
Conecte un sensor NAMUR sólo en aquellos canales del FM 350‑2 que hayan sido
parametrizados para conectar sensores NAMUR.

Seleccionar asignación de la interfaz de notificación
Asignación de la interfaz de notificación bytes 8 a 15
Este campo permite seleccionar la forma en la que se asignan los bytes 8 a 15 de la interfaz
de notificación.
Para las variables USER_STAT_WORD_0 a USER_STAT_WORD_3 existen las siguientes
posibilidades de selección:
● Tipo de datos
– WORD
– DWORD
● Canal
– Canal 0 a 7
● Valor
– Valor de contaje
– Valor medido
● Word
– Se puede depositar tanto la palabra baja como la palabra alta de un valor o bien ambas.
Es posible acceder a estos valores de forma directa.

Representación de los valores de contaje y medidos de todos los canales en los datos de usuario
avanzados
Representación de todos los valores de contaje y medidos en la imagen de datos de usuario
Bajo determinados requisitos es posible representar todos los valores de contaje y medidos
(uso de los datos de usuarioavanzados).

284

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Para utilizar los datos de usuario avanzados rigen las siguientes condiciones marco:
● Proyecte el módulo "6ES7350-2AH01-0AE0 E" desde el catálogo de módulos.
● La casilla de verificación "Utilizar interfaz de datos de usuario avanzada" está activada.
● Los datos de usuario avanzados solo pueden utilizarse de forma descentralizada después
de un IM 153‑2 V5.0 (referencia 6ES7153‑2BA01‑0XB0 V5.0) o superior.
● Para ello hay disponibles 40 bytes de datos de entrada.
● El ciclo de actualización de los datos de usuario avanzados es diferente al de los 16 bytes
de datos de entrada. Dependiendo del tiempo de ciclo PROFIBUS DP, el ciclo de
actualización de los datos de usuario avanzados es de entre 100 y 200 ms.
La estructura de los primeros 16 bytes en los datos de usuario es como hasta ahora y debe
consultarse en el modo de operación correspondiente. Los 24 bytes restantes se definen por
el modo de operación.
Dependiendo del modo de operación, en los datos de usuario avanzados se depositan los
valores (valor de contaje o medido) de los canales 2 a 7. La asignación por defecto de estos
valores es "0". Mientras no se haya registrado ningún valor válido, los datos de entrada tienen
asignado el valor 0.
Estructura de los datos de usuario avanzados en función del modo de operación:
Byte

Modos de contaje

Modos de medición

Modos de dosificación
(dos contadores de dosifica‐
ción)

0..15

Como hasta ahora: estruc‐ Como hasta ahora: estruc‐ Como hasta ahora: estructura
tura modificable mediante tura modificable mediante modificable mediante parame‐
parametrización
parametrización
trización

16..19

Valor de contaje, canal 2

Valor medido, canal 2

0

20..23

Valor de contaje, canal 3

Valor medido, canal 3

0

24..27

Valor de contaje, canal 4

Valor medido, canal 4

Contador de dosificación, canal
4

28..31

Valor de contaje, canal 5

Valor medido, canal 5

0

32..35

Valor de contaje, canal 6

Valor medido, canal 6

0

36..39

Valor de contaje, canal 7

Valor medido, canal 7

0

Copiar canales
Copiar canales
Este parámetro permite copiar un canal en uno o más canales.
1. Seleccione el canal cuyos parámetros desee copiar (origen del canal).
2. Active los canales en los que desee copiar los parámetros (objetivo del canal).
3. Pulse el botón "Copiar".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

285

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Modos de operación del canal n
Seleccionar el modo de operación
Descripción
Al preseleccionar un modo de operación se elige la funcionalidad con la que se utilizará el
módulo de contaje.
Modo de operación

Descripción

Contaje sin fin (Página 195)
(con o sin puerta)

El módulo de contaje cuenta en modo sin fin a partir del estado actual
del contador.

Contaje único (Página 196)
(con puerta HW o SW)

El módulo de contaje cuenta al abrir la puerta desde cero hasta el
límite de contaje superior parametrizado o bien desde el límite de
contaje superior parametrizado hasta cero.

Contaje periódico (Página 197) El módulo de contaje cuenta al abrir la puerta entre cero y el límite de
(con puerta SW o HW)
contaje superior parametrizado.
Medición de la frecuencia (Pá‐ El módulo de contaje registra los impulsos que llegan en una ventana
de tiempo parametrizada de n x 10 ms y determina con ello la fre‐
gina 205)
cuencia actual.
(con puerta SW o HW)
Medición de la velocidad (Pá‐
gina 206)
(con puerta HW o SW)

El módulo de contaje registra los impulsos que llegan en una ventana
de tiempo parametrizada de n x 10 ms y determina la velocidad a partir
del número de impulsos parametrizado por vuelta del encóder.

Medición del período (Pági‐
na 208)
(con puerta HW o SW)

El módulo de contaje registra los impulsos que llegan en una ventana
de tiempo parametrizada de n × 10 ms y determina con ello la duración
del período.

Dosificación (Página 210)
(con puerta HW o SW)

En este modo de operación se agrupan cuatro canales de contaje en
un solo canal de dosificación. Desde el punto de vista funcional, este
modo de operación es idéntico al modo de operación "Contaje único".

El ajuste predeterminado es el modo de operación "Contaje sin fin".

Determinar el límite superior de contaje
Descripción
Si se parametriza un límite superior de contaje en combinación con un sentido principal de
contaje (adelante o atrás) es posible limitar el rango de contaje máximo a un rango más
pequeño. El rango de contaje parametrizado está comprendido entonces entre 0 y el límite
superior de contaje ajustado.
El límite superior de contaje puede adoptar un valor > 1 hasta el límite superior del rango de
contaje.

286

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Definir el tiempo de medición
Descripción
Si se ha seleccionado un modo de medición, el módulo actualiza los valores medidos de forma
cíclica. El tiempo de integración es el producto del tiempo de medición × 10 ms. El tiempo de
medición se predefine como factor n.
Si desea obtener una descripción detallada sobre el rango de valores para el tiempo de
medición, consulte el apartado "Conceptos básicos sobre la operación de medición
(Página 200)".

Uso de la puerta HW
Uso de la puerta HW
Se puede seleccionar si el canal debe contar con o sin puerta HW.
Active la casilla de verificación "Utilizar puerta HW" para contar con la puerta HW.

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Selección del sentido principal de contaje
Descripción
Si se parametriza un sentido principal de contaje (Página 198) (adelante o atrás) es posible
limitar el rango de contaje máximo a un rango más pequeño, ajustando para ello un límite de
contaje superior. El rango de contaje parametrizado está comprendido entonces entre 0 y el
límite superior de contaje ajustado.
El sentido principal de contaje sólo puede seleccionarse en los modos de operación "Contaje
único", "Contaje periódico" y "Dosificación".
Se puede seleccionar el siguiente comportamiento:
● Adelante
● Atrás

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

287

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Encóders del canal n
Seleccionar el tipo de señal del encóder
Seleccionar tipo de señal
1. Seleccione el tipo de señal del encóder utilizado.
Dependiendo de su selección y del modo de operación se bloquearán aquellas opciones no
permitidas para ese determinado encóder. Las opciones bloqueadas se identifican con
letra gris en la correspondiente ventana de selección.
2. Seleccione las opciones que desee utilizar con el encóder seleccionado.
Es posible selecciona un tipo de señal de uno de los encóders siguientes:
● Encóder: incremental de 24 V (Página 288) (24 V pista A+B desfasado)
● Encóder: impulso y sentido de 24 V (Página 288)

Encóder: incremental de 24 V
Encóder incremental de 24 V
Seleccione el tipo de señal "24 V pista A+B desfasado" si desea utilizar un encóder incremental
de 24 V con las señales A* y B*.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal (Página 220)

Simple

Sólo se evalúa un flanco de señal A.

Doble

Se evalúan ambos flancos de la señal A.

Cuádruple

Se evalúan ambos flancos de las señales A y B.

Normal

Para adaptar el sentido de contaje al proceso

Invertido

Para adaptar el sentido de contaje al proceso

Sentido de contaje
(Página 289)

Encóder: impulso y sentido de 24 V
Encóder incremental de posición de 24 V
Seleccione el tipo de señal "24 V Impulso y sentido" si desea utilizar un encóder incremental
de posición de 24 V con la señal de contaje A* y la señal de sentido B*.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal

–

Sin relevancia

Sentido de contaje
(Página 289)

Invertido

Para adaptar el sentido de contaje al proceso

Normal

Para adaptar el sentido de contaje al proceso

288

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar el sentido de contaje
Modificar el sentido de contaje
Con el parámetro "Sentido de contaje normal" o "Sentido de contaje inverso" puede cambiar
el sentido de contaje sin necesidad de cambiar el cableado.
Si se emplea la parametrización "Sentido de contaje principal atrás (Página 198)", el sentido
de contaje no se invierte automáticamente.

Introducir impulsos por vuelta del encóder
Impulsos por vuelta del encóder
Para el modo Medición de velocidad (Página 206) es preciso parametrizar adicionalmente los
impulsos por vuelta del encóder.
El valor para el número de impulsos por vuelta del encóder se encuentra en la placa de
características o en los datos técnicos del encóder.

Definir histéresis
Funcionamiento básico de la histéresis
Un encóder puede pararse en una posición determinada y "oscilar" alrededor de dicha
posición. Esto hace que el estado del contador fluctúe alrededor de un valor determinado. Si
hay un valor de comparación en este rango de fluctuación, por ejemplo, la salida
correspondiente se activa y desactiva de acuerdo con el ritmo de las fluctuaciones. Para evitar
estas conmutaciones cuando se producen pequeñas oscilaciones, el FM 350‑2 cuenta con
una histéresis parametrizable.
Para la histéresis se pueden parametrizar valores comprendidos entre 0 y 255.
Dependiendo del valor parametrizado, la histéresis actúa tal como se indica a continuación:
Histéresis
Valor de histéresis n = 0, 1

Efecto
La histéresis no tiene efecto (desactivada).
La salida reaccionará al más mínimo cambio del estado del contador.

2 ≤ valor de histéresis n ≤ 255 La histéresis tiene efecto.
La salida reacciona sólo cuando el estado del contador se ha distan‐
ciado n unidades del valor de comparación.

La histéresis también actúa en caso de rebase por exceso y por defecto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

289

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Habilitar vigilancia de hardware para sensores NAMUR
¿Cómo se vigilan los sensores NAMUR?
El FM 350‑2 puede vigilar si en A0 … A7 hay una rotura de hilo o un cortocircuito. Con ello,
indirectamente se vigilará también la alimentación del detector de 8,2 V.
Active la casilla de verificación "Vigilancia hardware para sensores NAMUR", si desea que el
FM 350‑2 supervise las señales del sensor.

Salidas del canal n
Valores de comparación y salidas
Descripción
Es posible depositar ocho valores de comparación en el FM 350‑2 y asignarlos a las ocho
salidas digitales (valor de comparación 0: Q0, Valor de comparación 1: Q1, etc.). La salida
correspondiente se puede activar en función del estado del contador y del valor de
comparación.
En el modo de operación "Dosificación (Página 210)" para cada canal de dosificación del
FM 350‑2 es posible parametrizar cuatro valores de comparación.

Valores de comparación
Los valores de comparación se introducen durante la parametrización.
En el modo RUN de la CPU, los valores de comparación pueden introducirse en el DB de la
instrucción CNT2_WR/CNT2WRPN (CMP_VAL0…7) y transferirse al FM 350‑2 utilizando las
peticiones 30...37 ó 60...62. El contaje no se ve afectado por este hecho.
Los valores de comparación han de estar dentro de los rangos de contaje de los distintos
modos operativos; no se soportan los límites del rango de contaje.
No obstante, si en un modo de operación con sentido principal de contaje se fija el valor de
comparación en el valor inicial o final, las salidas digitales mostrarán el comportamiento
siguiente:
Comportamiento parametrizado de las salidas di‐
gitales

Reacción de la salida digital asignada

Activar si la lectura del contador >= valor de com‐ La salida está siempre activada, independiente‐
paración
mente de la lectura del contador.
Activar si la lectura del contador <= valor de com‐ La salida está siempre desactivada, independien‐
paración
temente de la lectura del contador.

290

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Habilitación de las salidas
Antes de poder controlar las salidas es preciso haberlas habilitado activando los bits
correspondientes en el DB de contador. Si se desactiva uno de estos bits, la salida
correspondiente se desconectará de inmediato. Los bits se transfieren entre el bloque de datos
y el módulo con la instrucción CNT2_CTR.
Salida

...habilitada por

Q0…7

CTRL_DQ0…7

Desactivar las salidas
Las salidas se desactivan independientemente de la parametrización cuando se dan los
eventos siguientes:
● Activación de la vigilancia de tiempo (watchdog) del módulo (error interno)
● Supresión de los bits de habilitación (CTRL_DQ0...7 para Q0...7 en el DB)

Control de las salidas
Tras su habilitación con CTRL_DQ0…7 las salidas se pueden activar y desactivar con las
señales de control SET_DQ0…7, independientemente de conmutarlas a través de los
comparadores.
En la relación entre el control y la activación hay que tener en cuenta que el control tiene
prioridad sobre la activación por los comparadores. Esto significa:
● si no se prevé para la salida una activación por el comparador, la salida puede emplearse
como una salida digital.
● Si se va a utilizar una función de comparación para las salidas, éstas se pueden seguir
controlando con SET_DQ0…7. De este modo es posible simular el efecto de las funciones
de comparación mediante el programa de control:
– Con el flanco ascendente de SET_DQ0…7 se activa la salida.
– Un flanco descendente de SET_DQ0…7 desactiva la salida de nuevo.
Obsérvese que los comparadores continúan activos y que pueden activar o desactivar la
salida si hay un cambio en el resultado de la comparación.
Nota
Una salida activada con SET_DQ0…7 no se desactiva con el comparador.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

291

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Comportamiento de las salidas en los modos de contaje
Definir el comportamiento de las salidas
Comportamiento de las salidas DQ0 a DQ7
Seleccione el comportamiento deseado de la salida correspondiente. Active para ello la casilla
de verificación correspondiente.
● No se compara (Página 292)
● Activar si la lectura del contador >= valor de comparación (Página 292)
● Activar si la lectura del contador <= valor de comparación (Página 293)
Nota
Para activar las opciones, es preciso introducir los valores de los valores de comparación en
el DB con los datos de contaje, así como transferirlos al módulo con la instrucción CNT2_WR;
además, es preciso activar los bits CNT2WRPN y CTRL_DQ0…7 en el DB para habilitar las
salidas. Véase también "Valores de comparación y salidas (Página 290)".
Nota
En los modos de operación "Medición de frecuencia", "Medición de velocidad" y "Medición del
período" no es posible parametrizar las salidas.

Ajuste predeterminado de las salidas
En el ajuste predeterminado las salidas están desactivadas.

No se compara
No se compara
La salida permanece desactivada y no se ve afectada por los eventos valor de comparación,
paso por cero, salto del valor final al inicial (rebase por exceso), o viceversa (rebase por
defecto).

Activar si la lectura del contador >= valor de comparación
Activar si la lectura del contador >= valor de comparación
La salida se pone a "1" si el contador se encuentra en el rango comprendido entre el valor de
comparación y el valor final.
La salida se pone a "1" si el contador se ajusta a un valor comprendido entre el valor de
comparación y el valor final.

292

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
La superficie sombreada del gráfico siguiente que la salida está activada en esta área.

9DORULQLFLDO

9DORUGHFRPSDUDFLµQ

9DORUILQDO

Condición:
Si desea parametrizar una salida "Activar si el estado de contador >= valor de comparación",
se aplica la siguiente condición marco: El tiempo que transcurre entre que se alcanza el valor
de comparación y el valor de inicio o fin tiene que ser mayor que el tiempo de conmutación
mínimo de las salidas (tiempo de conmutación: 300 µs). De lo contrario, se perderán los
impulsos de control de las salidas.

Consulte también
Efecto de la histéresis (Página 294)

Activar si la lectura del contador <= valor de comparación
Activar si la lectura del contador <= valor de comparación
La salida se pone a "1" si el contador se encuentra en el rango comprendido entre el valor de
comparación y el valor inicial.
La salida se pone a "1" si el contador se ajusta a un valor comprendido entre el valor de
comparación y el valor inicial.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área.

9DORULQLFLDO

9DORUGHFRPSDUDFLµQ

9DORUILQDO

Condición:
Si desea parametrizar una salida "Activar si el estado de contador <= valor de comparación",
se aplica la siguiente condición marco: El tiempo que transcurre entre que se alcanza el valor
de comparación y el valor de inicio o fin tiene que ser mayor que el tiempo de conmutación
mínimo de las salidas (tiempo de conmutación: 300 µs). De lo contrario, se perderán los
impulsos de control en las salidas.

Consulte también
Efecto de la histéresis (Página 294)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

293

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Efecto de la histéresis
Funcionamiento de la histéresis con la parametrización "Activar si el valor del contador >= valor de
comparación o <= valor de comparación"
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (= desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo el valor de comparación = 5.
La parametrización en este ejemplo es:
● Sentido principal de contaje: "Adelante"
● Comportamiento de la salida: "Activar si el estado del contador >= valor de comparación"
Al alcanzarse la condición de comparación (estado del contador = 5) se activa la histéresis.
Con la histéresis activada el resultado de la comparación permanece invariable.
Cuando el valor de contaje abandona el rango de histéresis, en el ejemplo con el valor de
contaje 2 u 8, la histéresis se desactiva. El comparador vuelve a conmutar según sus
condiciones de comparación, en el ejemplo con el valor de contaje 5.
9DORUGHFRQWDMH

9DORUGHFRPSDUDFLµQ 

5DQJRGHKLVW«UHVLVFRQIRQGRJULV













6DOLGDHQHOFDVRGH
KLVW«UHVLV 
6DOLGDHQHOFDVRGH
KLVW«UHVLV 

Nota
Si el estado del contador es igual al valor de comparación y la histéresis está activa, el
FM 350‑2 desactiva la salida cuando se invierte el sentido de contaje en el valor de
comparación (véase la figura siguiente).

294

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
9DORUGHFRQWDMH

9DORUGHFRPSDUDFLµQ  5DQJRGHKLVW«UHVLVFRQIRQGRJULV
&DPELRGHOVHQWLGRGHFRQWDMHDOYDORUGHFRPSDUDFLµQ











6DOLGDHQHOFDVRGH
KLVW«UHVLV 

Habilitar valor sustitutivo "1" en caso de STOP de la CPU
Valor sustitutivo "1" en caso de STOP de la CPU
Si en los parámetros básicos del módulo ha seleccionado la opción "Valor sustitutivo" en
"Reacción a STOP de la CPU" y la CPU se para, el módulo transmite a las salidas digitales los
valores sustitutivos parametrizados. Active la casilla de verificación correspondiente a DQ0; a
continuación se activa la salida Q0 en el caso de parada de la CPU.
En el modo de operación "Dosificación" es posible ajustar hasta cuatro valores sustitutivos,
mientras que en los otros modos de contaje puede ajustarse un valor sustitutivo.
Los valores sustitutivos permanecen válidos tras pasar la CPU de STOP a RUN, hasta el
siguiente manejo de las salidas digitales.
Si cambia el parámetro básico "Reacción a STOP de la CPU", las salidas se desactivan.
PRECAUCIÓN
Se pueden producir daños materiales.
Los valores sustitutivos parametrizados se aplican siempre que la CPU pasa a STOP, aunque
la puerta esté cerrada e incluso a salidas no habilitadas.
Hay que parametrizar exclusivamente valores sustitutivos cuya aplicación no pueda
ocasionar estados peligrosos.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

295

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Habilitación de alarmas de proceso del canal n
Habilitar la activación de una alarma de proceso
Introducción
En el FM 350‑2 se puede definir qué eventos deben generar una alarma de proceso durante
el funcionamiento.

¿Qué es una alarma de proceso?
Si se debe reaccionar a un evento determinado, independientemente del ciclo de la CPU, el
FM 350‑2 puede disparar una alarma de proceso. En ese caso la CPU interrumpe el programa
cíclico y procesa el OB de alarma de proceso.

Habilitar la alarma de proceso
La habilitación de las alarmas de proceso tiene lugar en dos pasos:
1. En la configuración del hardware las alarmas del módulo se habilitan en los parámetros
básicos y se especifica si el módulo debe activar una alarma de diagnóstico y/o una alarma
de proceso.
2. En "Habilitar alarma de proceso" es preciso seleccionar los eventos correspondientes:
– Eventos para la activación de una alarma de proceso en los modos de contaje
(Página 297)
– Eventos para la activación de una alarma de proceso en los modos de medición
(Página 297)

OB de alarma de proceso, por ejemplo, OB 40
Si ocurre una alarma de proceso, el programa de usuario se interrumpe, los datos se
transfieren del módulo a la información de arranque del OB 40 (Página 298) y se llama al OB
40. La alarma de proceso se acusa saliendo del OB 40.
Si no se ha programado ningún OB de alarma de proceso, la CPU pasará a STOP. Si a
continuación se pasa a RUN, se borran las condiciones para la alarma de proceso.

Alarma de proceso perdida
Si se produce un evento que debe provocar una alarma de proceso pero todavía no se ha
acusado un evento igual ocurrido anteriormente, no se activa una nueva alarma de proceso y
ésta se pierde. Esta situación puede conducir a la alarma de diagnóstico "Alarma de proceso
perdida".
Si entre dos eventos que deben disparar una alarma de proceso transcurre un tiempo < 2 ms
la segunda alarma de proceso se perderá sin que se haya podido disparar una alarma de
diagnóstico.

296

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Ajuste predeterminado
En el ajuste predeterminado no se han habilitado alarmas de proceso.

Eventos para la activación de una alarma de proceso en los modos de contaje
¿Qué eventos pueden disparar una alarma de proceso en los modos de contaje?
En los modos de contaje, los eventos siguientes pueden disparar una alarma de proceso
mientras el FM 350‑2 está en funcionamiento:
● Abrir la puerta HW
● Cerrar la puerta HW
● Rebase por exceso/Rebase por defecto
● Alcanzar el valor de comparación
Registre el valor de comparación correspondiente en el campo de entrada. Los valores de
comparación han de estar dentro de los rangos de contaje de los distintos modos
operativos; no se soportan los límites del rango de contaje.
Active la casilla de verificación para los eventos correspondientes.
Independientemente del modo de operación parametrizado se pueden seleccionar varios
eventos para el disparo de una alarma de proceso. Para las alarmas de proceso disparadas
cuando se alcanza un valor de comparación es preciso tener en cuenta las condiciones marco
(para "Activar si estado del contador >= valor de comparación (Página 292)" o "Activar si
estado del contador <= valor de comparación (Página 293)").

Eventos para la activación de una alarma de proceso en los modos de medición
¿Qué eventos pueden disparar una alarma de proceso en los modos de medición?
En los modos de medición, los eventos siguientes pueden disparar una alarma de proceso
mientras el FM 350‑2 está en funcionamiento:
● Abrir la puerta HW
● Cerrar la puerta HW
● Fin de la medición
● Rebase por defecto del valor límite inferior
Registre el límite inferior correspondiente en el campo de entrada. Si desea obtener
información sobre el rango de valores para los límites inferiores, consulte el apartado
"Conceptos básicos sobre la operación de medición (Página 200)".
● Rebase por exceso del valor límite superior
Registre el límite superior correspondiente en el campo de entrada. Si desea obtener
información sobre el rango de valores para los límites superiores, consulte el apartado
"Conceptos básicos sobre la operación de medición (Página 200)".
Active la casilla de verificación para los eventos correspondientes.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

297

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Independientemente del modo de operación parametrizado se pueden seleccionar varios
eventos para el disparo de una alarma de proceso.

Información de arranque del OB 40
Información de arranque del OB 40
La variable temporal OB40_POINT_ADDR se escribe en la información de arranque del OB 40.
La variable OB40_POINT_ADDR (byte 8 a 11) abarca 4 bytes. En estos cuatro bytes se guarda
información sobre el evento que ha provocado la alarma de proceso.
La siguiente tabla muestra qué bits se activan según el tipo de alarma. Todos los bits que no
se incluyen en la tabla son irrelevantes y tienen el valor cero.
Modo de operación: contaje sin fin, contaje único, contaje periódico
Canal

Byte

0

8

1

2a7

Bit 7

Valor de
compara‐
ción alcan‐
zado
9 a 11

Bit 6

Bit 5

Rebase por
exceso/
Rebase por
defecto

Cierre de
la puerta
HW

Bit 4

Bit 3

Bit 2

Bit 1

Bit 0

Valor de
compara‐
ción alcan‐
zado

Rebase por
exceso/
Rebase por
defecto

Cierre de
la puerta
HW

Puerta
HW abier‐
ta

Puerta
HW
abierta

Véase byte 8

Modo de operación: medición de frecuencia, medición de velocidad, medición del período
Canal

Byte

0

8

1

2a7

298

Bit 7

Bit 6

Bit 4

Bit 3

Bit 2

Límite superior
Fin de
rebasado por ex‐ la me‐
ceso/límite infe‐ dición
rior rebasado
por defecto
Límite superior Fin de
rebasado por
la me‐
exceso/límite in‐ dición
ferior rebasado
por defecto

9 a 11

Bit 5

Cierre de
la puerta
HW

Bit 1

Bit 0

Cierre de
la puerta
HW

Puerta
HW
abierta

Puerta
HW
abierta

Véase byte 8

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Modo de operación: dosificación
Canal

Byte

Bit 7

Bit 6

Bit 5

Bit 4

Bit 3

Bit 2

Bit 1

Bit 0

0

8

–

Rebase por
exceso/
Rebase por
defecto

Valor de
compara‐
ción 4 al‐
canzado

Valor de
compara‐
ción 3 al‐
canzado

Valor de
compara‐
ción 2 al‐
canzado

Valor de
compara‐
ción 1 al‐
canzado

Cierre de
la puerta
HW

Puerta
HW
abierta

4

10

Véase byte 8

Poner en marcha FM 350-2
Uso del FM 350-2 desde el programa de usuario
Integración del FM 350-2 en un programa de usuario
Para integrar el FM 350-2 en un programa de usuario pueden utilizarse instrucciones que le
facilitarán en lo posible el manejo de las funciones deseadas:
Las instrucciones CNT2WRPN, CNT2RDPN y CNT2_CTR se activan en el programa de
usuario de la CPU. Éstas llevan a cabo la comunicación entre la CPU y el FM 350-2.
Todos los datos pertenecientes a un canal del módulo se encuentran en el DB de la instrucción
CNT2_CTR, CNT2WRPN o CNT2RDPN (DB de contaje). Inserte en su proyecto un bloque de
datos del tipo CNT2_CHANTYPE mediante "Bloques de programa > Agregar bloque".
Además, para el FM 350-2 se puede utilizar también la instrucción DIAG_RD, que permite
transferir información de diagnóstico al DB de contaje.

FM 350-2: Online y diagnóstico
Información actual sobre el módulo
Diagnóstico estándar
Indicación de fallos mediante el LED de error de grupo del FM 350-2
¿Dónde se indica el fallo?
Si el LED de error de grupo rojo se ilumina significa que ha ocurrido un error en el módulo (error
interno), en los terminales de los cables (error externo), o bien que la parametrización es
defectuosa.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

299

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

¿Qué errores se indican?
La tabla siguiente muestra los tipos de fallos indicados por el LED de error de grupo.
Tipo de fallo

Causa del fallo

Solución

Errores internos

Activación de la vigilancia de tiempo
(Watchdog)

Sustituir el módulo

Alarma de proceso perdida

Acuse mediante el procesamiento
de la alarma de proceso

Falta la parametrización del módulo

Definir y transferir la parametriza‐
ción

Errores externos

La parametrización contiene fallos
Fallos en el canal externo Cortocircuito o sobrecarga en la ali‐
mentación del encóder
Fallos en las señales de un detector
NAMUR (rotura de hilo, cortocircuito,
falta de línea)

Corregir la conexión
Corregir la conexión

Diagnóstico específico de canal
Disparo de alarmas de diagnóstico
¿Qué es una alarma de diagnóstico?
Si se quiere que un programa de usuario responda a un fallo interno o externo, se puede
parametrizar una alarma de diagnóstico que interrumpa el programa cíclico de la CPU y llame
al OB de alarma de diagnóstico (OB 82).

¿Qué eventos pueden provocar una alarma de diagnóstico?
Los siguientes eventos pueden provocar una alarma de diagnóstico:
● Error en un canal parametrizado
● Falta parametrización del módulo
● Error en la parametrización del módulo
● La vigilancia de tiempo (watchdog) ha saltado
● Alarma de proceso perdida
● La vigilancia de la línea de señales del sensor NAMUR indica errores
● Fallo en la alimentación de 8,2 V de un sensor NAMUR

Habilitar la alarma de diagnóstico
En la configuración del hardware las alarmas del módulo se habilitan en los parámetros
básicos y se especifica si el módulo debe activar una alarma de diagnóstico y/o una alarma de
proceso.

300

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Respuestas a una alarma de diagnóstico
Cuando se produce un evento que puede disparar una alarma de diagnóstico ocurre lo
siguiente:
● La información de diagnóstico se registra en los registros de diagnóstico DS0 y DS1
(Página 301) del módulo.
● El LED de error de grupo se enciende.
Una vez eliminado el error, se apaga el LED de error de grupo.
● Se llama al OB de alarma de diagnóstico (OB 82).
● El registro de diagnóstico DS0 se graba en la información de arranque del OB de alarma de
diagnóstico.
● El contaje prosigue sin cambios si se ha programado una alarma del OB 82. La CPU pasa
a modo STOP si no hay un OB 82.

Ajuste predeterminado
En el ajuste predeterminado no se han habilitado alarmas de diagnóstico.

Registro de diagnóstico DS0 y DS1
Registro de diagnóstico DS0 y DS1
La información que indica qué evento ha provocado una alarma de diagnóstico se guarda en
los registros de diagnóstico DS0 y DS1. El registro de diagnóstico DS0 consta de cuatro bytes;
DS1 consta de 16 bytes, siendo los cuatro primeros idénticos a DS0.

Leer registro del módulo
El registro de diagnóstico DS0 (Página 302) se transfiere automáticamente a la información de
arranque en la llamada del OB de diagnóstico. Allí, los cuatro bytes se guardan en los datos
locales (bytes 8 a 11) del OB 82.
El registro de diagnóstico DS1 (Página 302) (y, por lo tanto, también el contenido del DS0)
puede leerse con la instrucción DIAG_RD del módulo. Esa lectura sólo tiene sentido si en el
DS0 se notifica un fallo en un canal.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

301

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación del registro de diagnóstico DS0
Asignación del registro de diagnóstico DS0 y de la información de arranque
La tabla siguiente muestra la asignación del registro de diagnóstico DS0 en la información de
arranque. Todos los bits que no se incluyen en la tabla son irrelevantes y tienen el valor cero.
Byte

Bit

Significado

Nota

Nº de evento

0

0

Fallo en módulo

Se activa en todos los eventos de diagnóstico

8:x:00

1

Error interno

Se activa para todos los errores internos

8:x:01

2

Error externo

Se activa para todos los errores externos

8:x:02

3

Fallo en un canal

Si desea obtener más información, consulte DS 1,
byte 4 (Página 302)

8:x:03

6

Falta parametrización

Realizar la parametrización

8:x:06

7

Error de parametrización

Para más información, consulte el capítulo Errores de
datos (Página 303)

8:x:07

0 ... 3

Clase de tipo

Siempre tiene asignado un 8

4

Información de canal

Siempre tiene asignado un 1

2

3

La vigilancia de tiempo
(watchdog) ha saltado

Módulo defectuoso o fuertes interferencias

3

6

Alarma de proceso perdida

Comprobar la configuración. Se ha detectado un even‐ 8:x:46
to y no se ha podido notificar porque el mismo evento
aún no se ha sido acusado por la CPU

1

8:x:33

Asignación del registro de diagnóstico DS1
Asignación del registro de diagnóstico DS1
El registro de diagnóstico DS1 se compone de 16 bytes. Los 4 primeros bytes son idénticos a
los del registro de diagnóstico DS0. La siguiente tabla muestra la asignación de los bytes
restantes. Todos los bits que no se incluyen en la tabla son irrelevantes y tienen el valor cero.
Este registro es introducido por la instrucción DIAG_RD en el DB de la instrucción CNT2_CTR
a partir de la DW212.
Byte

Bit

Significado

Nota

4

0 ... 6

Tipo de canal

Siempre con un 76H asignado

Nº de evento

7

Otros tipos de canal

Siempre tiene asignado un 0

5

0 ... 7

Longitud de la información de diagnóstico

Siempre tiene asignado un 8

6

0 ... 7

Número de canales

Siempre tiene asignado un 8

7

0

Vector de error de canal

Bit de canal

8

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

(canal 0)

6

Línea de señales del sensor NAMUR

9

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

8:x:94

(canal 1)

6

Línea de señales del sensor NAMUR

8:x:96

Cortocircuito/rotura de hilo
Cortocircuito/rotura de hilo

8:x:94
8:x:96

10

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

8:x:94

(canal 2)

6

Línea de señales del sensor NAMUR

8:x:96

302

Cortocircuito/rotura de hilo

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Byte

Bit

Significado

11

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

Nota

8:x:94

(canal 3)

6

Línea de señales del sensor NAMUR

8:x:96

12

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

8:x:94

(canal 4)

6

Línea de señales del sensor NAMUR

8:x:96

Cortocircuito/rotura de hilo
Cortocircuito/rotura de hilo

Nº de evento

13

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

8:x:94

(canal 5)

6

Línea de señales del sensor NAMUR

8:x:96

14

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

8:x:94

(canal 6)

6

Línea de señales del sensor NAMUR

8:x:96

15

4

Fallo en alimentación de 8,2 V del encóder Sensores NAMUR

8:x:94

(canal 7)

6

Línea de señales del sensor NAMUR

8:x:96

Cortocircuito/rotura de hilo
Cortocircuito/rotura de hilo
Cortocircuito/rotura de hilo

Errores de datos
¿Dónde se producen errores de datos?
Cuando se transfieren peticiones al módulo desde la programadora con la instrucción
CNT2WRPN, las peticiones se comprueban. Si se producen errores durante esta
comprobación, el módulo notifica estos errores.
El módulo no soporta peticiones con errores.

¿Dónde se indican los errores de datos?
Los errores de datos se muestran en la interfaz de parametrización.
Si se detecta un error cuando se están comprobando las peticiones, en el DB de contador se
activará el bit CHECKBACK_SIGNALS, DATA_ERR = 1.

¿Cómo se acusan los errores de datos?
Corrija las peticiones según lo preestablecido. Retransfiera las peticiones corregidas al
FM 350‑2.

Búfer de diagnóstico del FM 350-2
Las entradas del búfer de diagnóstico del FM 350-2 se muestran en la interfaz de
parametrización.

Códigos de error en el búfer de diagnóstico
Códigos de error
A continuación, figuran los números de error con sus correspondientes descripciones del error.
En el búfer de diagnóstico se introduce un error con una ID de error de las siguientes
características:

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

303

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
16#Fx83 yyzz
Significado de los dígitos:
● yy = identificador para la clase de error, p, ej. 04 para un error de parametrización de canal.
● zz = número de error, p. ej. 18 para el error "sentido principal de contaje no válido"

304

Error de parametriza‐
ción de canal

Número
de error

Descripción

04

01

No está permitida la petición porque el canal está ocupado para
dosificación

04

18

Sentido principal de contaje no válido

04

19

Rango de contaje erróneo

04

1A

Valor de comparación fuera del rango de contaje disponible

04

1B

Comportamiento de salida no válido

04

1C

Imposible habilitar la alarma de proceso

04

1D

Parametrización de la vigilancia de hardware no válida

04

1E

Parametrización de la puerta HW no válida

04

1F

No es posible la selección de señal

04

20

Selección de señal errónea

04

21

Valor de histéresis demasiado grande

04

22

Valor sustitutivo no válido

04

23

Reacción no válida al cerrar una puerta

04

24

Parámetro reservado diferente de 0

04

25

Parámetro reservado diferente de 0

04

26

Parámetro reservado diferente de 0

04

27

Selección de encóder errónea

04

28

Diagnóstico de la entrada de contaje sólo posible para sensor
NAMUR

04

29

Valor de carga fuera del rango de contaje válido

04

2B

Imposible ampliar el rango de contaje

04

2C

Valor de comparación 1 fuera del rango de contaje

04

2D

Valor de comparación 2 fuera del rango de contaje

04

2E

Valor de comparación 3 fuera del rango de contaje

04

2F

Valor de comparación 4 fuera del rango de contaje

04

30

Valor límite inferior para la frecuencia o la velocidad no válido

04

31

Valor límite superior para la frecuencia o la velocidad no válido

04

32

Valor límite inferior >= valor límite superior

04

33

Tiempo de integración no válido

04

34

Impulsos por vuelta no válidos

04

35

Valor límite inferior para la duración del período no válido

04

36

Valor límite superior para la duración del período no válido

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Error de parametriza‐
ción de módulo

Número
de error

Descripción

05

0A

Generación de alarma no válida

05

0B

Selección de alarma no válida

05

0C

Reacción no válida con output disable activado

05

0D

Parámetro reservado diferente de 0

05

18

Indicación de fecha y hora no válida

05

19

Selección de señal de encóder no válida

05

1A

Modo de operación de canal no válido

05

1B

Distribución de CHECKBACK_SIGNALS.USER_STAT en bloque
de datos no válida

Error de datos

Número
de error

Descripción

06

18

Sentido principal de contaje no válido

06

19

Rango de contaje erróneo

06

1A

Valor de comparación fuera del rango de contaje disponible

06

1B

Comportamiento de salida no válido

06

1C

Imposible habilitar la alarma de proceso

06

1D

Parametrización de la vigilancia de hardware no válida

06

1E

Parametrización de la puerta HW no válida

06

1F

No es posible la selección de señal

06

20

Selección de señal errónea

06

21

Valor de histéresis demasiado grande

06

22

Valor sustitutivo no válido

06

23

Reacción no válida al cerrar una puerta

06

24

Parámetro reservado diferente de 0

06

25

Parámetro reservado diferente de 0

06

26

Parámetro reservado diferente de 0

06

27

Selección de encóder errónea

06

28

Diagnóstico de la entrada de contaje sólo posible para sensor
NAMUR

06

29

Valor de carga fuera del rango de contaje válido

06

2B

Imposible ampliar el rango de contaje

06

2C

Valor de comparación 1 fuera del rango de contaje

06

2D

Valor de comparación 2 fuera del rango de contaje

06

2E

Valor de comparación 3 fuera del rango de contaje

06

2F

Valor de comparación 4 fuera del rango de contaje

06

30

Valor límite inferior para la frecuencia o la velocidad no válido

06

31

Valor límite superior para la frecuencia o la velocidad no válido

06

32

Valor límite inferior >= valor límite superior

06

33

Tiempo de integración no válido

06

34

Impulsos por vuelta no válidos

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

305

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

306

Error de datos

Número
de error

Descripción

06

35

Valor límite inferior para la duración del período no válido

06

36

Valor límite superior para la duración del período no válido

Aviso

Número
de error

Descripción

0F

01

Fin del arranque del módulo

0F

02

Ningún parámetro en el módulo

0F

03

Módulo está parametrizado por defecto

0F

04

Módulo está parametrizado

0F

05

Modo PG ajustado

0F

06

Modo PG deseleccionado

0F

07

Modo PG ha fallado

0F

08

Modo PG está ajustado, no se permite ninguna petición de la CPU

0F

09

Secuencia de petición errónea

Error de diagnóstico

Número
de error

Descripción

80

04

Falta tensión auxiliar externa

80

05

Falta conector frontal

80

06

Módulo no parametrizado

80

07

Parámetro erróneo en el módulo

80

30

Falta módulo personalizable o es incorrecto

80

31

Fallo de comunicación

80

32

Estado operativo STOP

80

33

La vigilancia de tiempo ha reaccionado

80

34

Falla la alimentación interna del módulo

80

35

Pila 1 agotada

80

36

Falla todo respaldo

80

41

Falla el procesador

80

42

Error EPROM

80

43

Error de RAM

80

44

Error ADU/DAU

80

45

Fallo de fusible

80

46

Se ha perdido una alarma de proceso

80

90

Señal de encóder A en canal errónea

80

91

Señal de encóder B en canal errónea

80

92

Señal de encóder N en canal errónea

80

93

Valor erróneo entre los canales

80

94

Alimentación de encóders 5,2 V o NAMUR en canal errónea

80

95

Fallo en alimentación de 24 V del encóder

80

96

Sensor NAMUR cortocircuito/rotura de hilo en canal

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

1.2.1.4

Uso del FM 450-1

Asignación de conectores del conector frontal del FM 450-1
Conector frontal
En el conector frontal de 48 polos se conectan:
● Señales de contaje
● Entradas digitales
● Salidas digitales
● Alimentación del encóder
● Tensión auxiliar y de carga
La figura siguiente muestra la parte delantera del conector frontal, la tira con la indicación de
la asignación de terminales y las tiras rotulables.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

307

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
$VLJQDFLµQGHWHUPLQDOHV 7LUDVURWXODEOHV
,17)
(;7)
&+
&5
',5

&+
&5
',5

&+,1



&+287



&+,1



&+287



308


















































/
0
$
$
%
%
1
1
$
%
1
0
'&9
'&9
$
$
%
%
1
1
$
%
1
0
'&9
'&9

/
0

,17)
(;7)
&+
&5
',5

&+
&5
',5

&+,1



&+287



&+,1



&+287



,
,
,
4
4

,
,
,
4
4

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación de terminales del conector frontal
La tabla siguiente muestra la asignación de terminales del conector frontal del FM 450-1.
Terminal

Nombre

Entrada/
salida

Función
Encóder de 5 V
RS 422, simétrico

Encóder de 24 V
asimétrico

Detector de proxi‐
midad de 24 V

Generador de im‐
pulsos de 24 V con
nivel de sentido

1

-

2

-

3

1L+

Entrada

Tensión auxiliar de 24 V para alimentación del encóder

4

1M

Entrada

Masa tensión auxiliar para alimentación del encóder
Contador 1

5

1A

Entrada

Señal del encóder
A

-

6

1 /A

Entrada

Señal del
encóder /A

-

7

1B

Entrada

Señal del encóder
B

-

8

1 /B

Entrada

Señal del
encóder /B

-

9

1N

Entrada

Señal del encóder
N

-

10

1 /N

Entrada

Señal del
encóder /N

-

11

1 A*

Entrada

-

12

1 B*

Entrada

-

Señal del encóder
B*

13

1 N*

Entrada

-

Señal del encóder
N*

14

1M

Salida

15

5,2 V DC

Salida

Alimentación de
5,2 V del encóder

-

16

24 V DC

Salida

-

Alimentación del encóder 24 V

Señal del encóder A*
Señal de sentido

-

-

Masa alimentación del encóder

Contador 2
17

2A

Entrada

Señal del encóder
A

-

18

2 /A

Entrada

Señal del
encóder /A

-

19

2B

Entrada

Señal del encóder
B

-

20

2 /B

Entrada

Señal del
encóder /B

-

21

2N

Entrada

Señal del encóder
N

-

22

2 /N

Entrada

Señal del
encóder /N

-

23

2 A*

Entrada

-

Señal del encóder A*

24

2 B*

Entrada

-

Señal del encóder B*, señal de sentido

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

309

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Terminal

Nombre

Entrada/
salida

Función
Encóder de 5 V
RS 422, simétrico

Encóder de 24 V
asimétrico

-

Generador de im‐
pulsos de 24 V con
nivel de sentido

Detector de proxi‐
midad de 24 V

25

2 N*

Entrada

26

1M

Salida

Señal del encóder N*

27

5,2 V DC

Salida

Alimentación de
5,2 V del encóder

-

28

24 V DC

Salida

-

Alimentación del encóder 24 V

29

1I0

Entrada

30

1I1

Entrada

Entrada digital 1I1

31

1I2

Entrada

Entrada digital 1I2 (activar contador)

Masa alimentación del encóder

Contador 1
Entrada digital 1I0

32

-

33

1Q0

Salida

Salida digital 1Q0

34

1Q1

Salida

Salida digital 1Q1

35

-

36

-

37

-

38

-

39

-

40

Contador 2

41

2I0

Entrada

Entrada digital 2I0

42

2I1

Entrada

Entrada digital 2I1

43

2I2

Entrada

Entrada digital 2I2 (activar contador)

45

2Q0

Salida

46

2Q1

Salida

47

2L+

Entrada

Tensión de carga 24 V para las entradas y salidas digitales

48

2M

Entrada

Masa tensión de carga para las entradas y salidas digitales

44

Salida digital 2Q0
Salida digital 2Q1

Nota
Las conexiones para las entradas de contaje (alimentación del encóder, señales del encóder)
están unidas galvánicamente con masa de la CPU. Por eso debe conectar el borne 4 (1M) con
la masa de la CPU con una baja impedancia.
Si los encóders se alimentan externamente, también se deberá conectar la masa de dicha
tensión externa con masa de la CPU.
Encontrará más información sobre la estructura y el cableado en el manual de producto (http://
support.automation.siemens.com/WW/view/es/1118412) del módulo de contaje FM 450-1.

310

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Tensión auxiliar 1L+, 1M
Para la alimentación de tensión de los encóders de 5 V y 24 V debe conectar una tensión
continua de 24 V en las conexiones 1L+ y 1M.
Un diodo integrado protege el módulo contra inversión de polaridad de la tensión auxiliar.
El módulo vigila si está conectada la tensión auxiliar.

Alimentación de encóder de 5,2 V DC
El módulo genera una tensión de 5,2 V a partir de la tensión auxiliar 1L+/1M con una intensidad
máxima de 300 mA por canal de contaje, disponible en el conector "DC5.2V" para la
alimentación de un encóder de 5 V a prueba de cortocircuitos.

Alimentación de encóder de 24V DC
Para la alimentación de tensión de 24 V de un encóder, se pone a disposición la tensión 1L+/
1M en la salida DC24V a prueba de cortocircuitos. Se comprueba si hay cortocircuitos en la
alimentación del encóder.

Señales de encóder de 5 V A y /A, B y /B, N y /N
A cada contador se pueden conectar encóders incrementales con señales diferenciales de 5
V conforme a RS 422, es decir, encóders incrementales con las señales diferenciales A y /A,
B y /B, N y /N.
Las señales A y /A, B y /B, N y /N se conectan a través de los terminales correspondientes.
Las señales N y /N sólo se conectan si se desea poner el contador a la marca cero del encóder.
Las entradas no disponen de un aislamiento galvánico con el bus de la S7-400.

Señales de encóder de 24 V A*, B* y N*
Las señales de 24 V se identifican con las letras A*, B* y N*.
Puede conectar tres tipos de encóder diferentes a cada contador:
● Encóders incrementales con señales de 24 V:
Las señales A*, B* y N* se conectan a través de los terminales correspondientes.
● Generador de impulsos sin nivel de sentido:
La señal se conecta en la conexión A*.
● Generador de impulsos con nivel de sentido:
La señal de contaje se conecta al terminal A*. El nivel de sentido se conecta al terminal B*.
Las entradas no disponen de un aislamiento galvánico con el bus de la S7-400.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

311

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Filtro de entrada para señales de encóder de 24 V
Para eliminar fallos, puede parametrizar filtros de entrada (componentes RC) con un tiempo de
filtrado unitario para las entradas de 24 V A*, B* y N*. Tiene a su disposición los dos filtros de
entrada siguientes para cada contador:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Frecuencia de contaje máxima

200 kHz

20 kHz

Ancho de impulso mínimo de las señales de contaje

2,5 μs

25 μs

Entradas digitales
Las entradas digitales 1I0 y 1I1 se pueden utilizar para controlar las puertas del contador 1.
Las entradas digitales 2I0 y 2I1 se pueden utilizar para controlar las puertas del contador 2.
Las puertas se pueden utilizar tanto con control por nivel como con control por flanco.
La entrada digital 1I2 sirve para ajustar el contador 1 al valor de carga.
La entrada digital 2I2 sirve para ajustar el contador 2 al valor de carga.
Las entradas digitales funcionan con una tensión nominal de 24 V.
Las entradas digitales están separadas galvánicamente del bus posterior del S7-400 y de las
entradas del contador.

Filtro de entrada para entradas digitales
Para eliminar fallos, puede parametrizar filtros de entrada (componentes RC) con un tiempo de
filtrado unitario para las entradas digitales 1I0, 1I1 y 1I2 ó bien 2I0, 2I1 y 2I2 Se dispone de los
dos filtros de entrada siguientes:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Ancho de impulso mínimo de las señales de entrada

2,5 μs

25 μs

Salidas digitales
Para iniciar directamente procesos de control, el FM 450-1 dispone de las salidas digitales 1Q0
y 1Q1 (para el contador 1) o bien 2Q0 y 2Q1 (para el contador 2).
Las salidas digitales se alimentan con la tensión de carga 2L+.
Las salidas digitales están separadas galvánicamente del bus posterior del S7-400 y de las
entradas del contador.

312

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Las salidas digitales son salidas tipo PNP y pueden recibir una corriente de carga de 0,5 A.
Están protegidas contra sobrecarga y cortocircuito.
Nota
Se pueden conectar directamente relés y contactores sin necesidad de circuitería externa.
El comportamiento temporal de las salidas digitales varía en función de la parametrización.

Tensión de carga 2L+/2M
Para la alimentación de las salidas digitales 1Q0 y 1Q1 ó bien 2Q0 y 2Q1 es preciso conectar
una tensión de carga de 24 V en los bornes 2L+ y 2M del módulo.
Un diodo integrado protege el módulo contra inversión de polaridad de la tensión de carga.
El FM 450-1 no vigila la tensión de carga 2L+/2M.

Configurar FM 450-1
Parametrizar FM 450-1
Especificar canal
Copiar canal
Este parámetro permite copiar un canal en otro canal.
1. Seleccione el canal cuyos parámetros desee copiar (origen del canal).
2. Active el canal en el que desee copiar los parámetros (objetivo del canal).
3. Pulse el botón "Copiar".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

313

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Modos de operación del canal n
Seleccionar el modo de operación
Descripción
Al preseleccionar un modo de operación se elige la funcionalidad con la que se utilizará el
módulo de contaje.
Modo de operación

Descripción

Contaje sin fin (Página 195)
(con o sin puerta)

El FM 450‑1 cuenta en modo sin fin a partir del estado actual del
contador.

Contaje único (Página 196)
(con puerta HW o SW)

El FM 450‑1 comienza a contar a partir del valor de carga al abrirse
la puerta y se detiene en el límite de contaje.

Contaje periódico (Página 197)
(con puerta HW o SW)

El FM 450‑1 comienza a contar al abrirse la puerta a partir del valor
de carga entre los límites de contaje.

El ajuste predeterminado es el modo de operación "Contaje sin fin".

Seleccionar el control de puerta
Descripción
Al preseleccionar un control de puerta se elige cómo se realizará el contaje en el modo de
operación seleccionado.
● Sin puerta
Todas las puertas están abiertas.
● Puerta SW (Página 214)
La puerta SW se abre y se cierra con el parámetro de entrada/bit de control SW_GATE.
● Puerta HW (Página 215), con control de nivel o de flanco
La puerta HW se abre y se cierra con las señales correspondientes en las entradas digitales
El ajuste predeterminado es "Sin puerta".

Seleccionar el rango de contaje
Descripción
El módulo incorpora un registro de contaje de 32 bits. El ajuste “Rango de contaje” permite
seleccionar si el módulo debe contar sólo en el rango positivo, o bien, si el bit 32 debe
interpretarse como bit de signo, permitiendo de este modo la representación de números
negativos.
Seleccione el rango de contaje deseado.
Encontrará más información en "Rangos de contaje y límites de contaje (Página 192)".

314

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Rebase del límite superior, rebase por defecto del límite inferior y paso por cero
En los límites de contaje, si se produce un rebase por exceso o por defecto se activa un bit en
el DB de la instrucción CNT_CTRL.
Al producirse un paso por cero en el rango de contaje de -31 a +31 bits, también se activa un
bit en el DB.
Al producirse un paso por cero en el rango de contaje de 0 a +32 bits se indica además un
rebase por exceso, o bien un rebase por defecto (dependiendo del sentido de contaje).
Evento

Bit de estado en el DB

Rebase del límite superior

STS_OFLW se activa.

Rebase del límite inferior

STS_UFLW se activa.

Paso por cero

STS_ZERO se activa.

Disparo de alarmas de proceso
También puede notificar los eventos rebase por exceso, rebase por defecto y paso por cero
con alarmas de proceso.

Encóders del canal n
Seleccionar el tipo de señal del encóder
Seleccionar tipo de señal
1. Seleccione el tipo de señal del encóder utilizado.
Dependiendo de su selección y del modo de operación se bloquearán aquellas opciones no
permitidas para ese determinado encóder. Las opciones bloqueadas se identifican con
letra gris en la correspondiente ventana de selección.
2. Seleccione las opciones que desee utilizar con el encóder seleccionado.
Es posible selecciona un tipo de señal de uno de los encóders siguientes:
● Encóder: incremental de 5 V (Página 315) (5 V señal diferencial)
● Sensor: incremental de 24 V (Página 316) (24 V pista A+B desfasado)
● Encóder: 24 V Impulso y sentido (Página 316)
● Encóder: 24 V Detector de proximidad (Página 317)

Encóder: incremental de 5 V
Encóder incremental de 5 V
Seleccione el tipo de señal "5 V Señal diferencial" si utiliza un encóder incremental de 5 V con
señales diferenciales A, /A, B, /B y N, /N.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

315

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal (Página 220)

Simple

Sólo se evalúa un flanco de señal A.

Doble

Se evalúan ambos flancos de la señal A.

Cuádruple

Se evalúan ambos flancos de las señales A y B.

Sentido de contaje
(Página 218)

Normal

Para adaptar el sentido de contaje al proceso

Invertido

Para adaptar el sentido de contaje al proceso

Frecuencia máx. de
contaje

–

La frecuencia de contaje máxima para este encóder es 500 kHz.

Entradas del encóder

–

Sin relevancia

Vigilancia (Pági‐
na 218)

A+B+N

Se vigila cortocircuito y rotura de hilo en todos los pares de señal.

A+B

Se vigilan los pares de señal A y B.

A

Sólo se vigila el par de señal A.

Ninguna

No se vigila ningún par de señal.

Encóder: incremental de 24 V
Encóder incremental de 24 V
Seleccione el tipo de señal "24 V pista A+B desfasado" si desea utilizar un encóder incremental
de 24 V con las señales A*, B* y N*.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal (Página 220)

Simple

Sólo se evalúa un flanco de señal A.

Doble

Se evalúan ambos flancos de la señal A.

Cuádruple

Se evalúan ambos flancos de las señales A y B.

Sentido de contaje
(Página 219)

Normal

Para adaptar el sentido de contaje al proceso

Invertido

Para adaptar el sentido de contaje al proceso

Frecuencia máx. de
contaje (Página 318)

200 kHz

En las entradas se aplica un filtro con un retardo de 1 μs.

20 kHz

En las entradas se aplica un filtro con un retardo de 15 μs.

Entradas del encóder
(Página 317)

Salida tipo NPN

El encóder conmuta a 0 V (masa).

Vigilancia

–

Salida tipo PNP/ El encóder conmuta a 24 V.
simétrica
Sin relevancia

Encóder: impulso y sentido de 24 V
Encóder incremental de posición de 24 V
Seleccione el tipo de señal "Impulso y sentido de 24 V" si desea utilizar un encóder incremental
de posición de 24 V con la señal de contaje A* y la señal de sentido B*.

316

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal

–

Sin relevancia

Sentido de contaje

–

Sin relevancia

Frecuencia máx. de
contaje (Página 318)

200 kHz

En las entradas se aplica un filtro con un retardo de 1 μs.

20 kHz

En las entradas se aplica un filtro con un retardo de 15 μs.

Entradas del encóder
(Página 317)

Salida tipo NPN

El encóder conmuta a 0 V (masa).

Vigilancia

–

Salida tipo PNP/ El encóder conmuta a 24 V.
simétrica
Sin relevancia

Encóder: detector de proximidad de 24 V
Detector de proximidad de 24 V
Seleccione el tipo de señal "Detector de proximidad de 24 V" si desea utilizar un encóder
incremental de posición de 24V con la señal de contaje A*.
Para este encóder se pueden seleccionar las siguientes opciones:
Parámetro

Opción

Significado

Interpretación de la
señal

–

Sin relevancia

Sentido de contaje

–

Sin relevancia

Frecuencia máx. de
contaje (Página 318)

200 kHz

En las entradas se aplica un filtro con un retardo de 1 μs.

20 kHz

En las entradas se aplica un filtro con un retardo de 15 μs.

Entradas del encóder
(Página 317)

Salida tipo NPN

El encóder conmuta a 0 V (masa).

Vigilancia

–

Salida tipo PNP/ El encóder conmuta a 24 V.
simétrica
Sin relevancia

Parametrización de las entradas de encóder
Parametrización de las entradas de encóder
El sentido de contaje está predeterminado por la parametrización de las entradas del encóder.
La tabla muestra el cambio del sentido de contaje en función de la parametrización.
Parametrización

Borne de conexión B*

Sentido de contaje

Salida tipo NPN

Sin conexión

Atrás

Cortocircuitado a masa

Adelante

Sin conexión

Adelante

24 V conectado

Atrás

Salida tipo PNP/simétrica

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

317

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
En la parametrización seleccione como encóder "24 V Impulso y sentido".
Con estas señales de contaje no es posible invertir el sentido mediante inversión de la señal
B*.
Nota
Si las señales de contaje son oscilantes, en este tipo de evaluación el valor de contaje puede
"desaparecer" en el flanco, ya que todas las señales se suman.

Filtro de entrada para entradas de contaje de 24 V
Filtro de entrada para entradas de contaje de 24 V
Para suprimir interferencias puede parametrizar filtros de entrada con un tiempo de filtrado
uniforme para las entradas de contaje de 24 V A*, B* y N* y para las entradas digitales. Existen
los siguientes filtros de entrada:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Frecuencia de contaje máxima

200 kHz

20 kHz

Ancho de impulso mínimo de las señales de con‐ 2,5 μs
taje

25 μs

Entradas del canal n
Seleccionar señales de puerta
Control de la puerta HW
Para el control de la puerta HW se pueden seleccionar las siguientes opciones:
● Puerta de hardware controlada por nivel (con nivel en la entrada 1I0 o 2I0)
● Puerta de hardware controlada por flanco (para abrir con flanco en la entrada 1I0 o 2I0);
para cerrar con flanco en la entrada 1I1 o 2I1.
Encontrará más información en el apartado "Puerta de hardware (Página 215)".

Seleccionar el ancho de impulso mínimo
Ancho de impulso mínimo
Para eliminar fallos, es posible parametrizar filtros de entrada (componentes RC) con un
tiempo de filtrado unitario para las entradas de 24 V A*, B* y N* y para las entradas digitales.

318

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Se encuentran disponibles dos filtros de entrada con los siguientes datos:
Características

Filtro de entrada 1

Filtro de entrada 2

(predeterminado)
Retardo de entrada típico

1 μs

15 μs

Frecuencia de contaje máxima

200 kHz

20 kHz

Ancho de impulso mínimo de las señales de contaje

2,5 μs

25 μs

Inicializar contador
Inicializar contador
Resumen
Si desea iniciar el contaje a partir de un determinado valor (el valor de carga), deberá
parametrizar la señal con la que se debe ajustar el contador al valor de carga. El contador se
puede ajustar de las maneras siguientes:
● Con el parámetro de entrada L_DIRECT de la instrucción CNT_CTRL
● Con una señal externa, bien sea a través de la entrada 1I2 (2I2), o bien a través de la
entrada en combinación con la señal de paso por cero del encóder

Valor de carga
Como valor de carga se puede predeterminar un número cualquiera comprendido en el rango
de contaje.
El valor de carga se interpreta conforme al rango de contaje seleccionado. Si, por ejemplo, se
predetermina FFFF FFFF H como valor de carga, este valor se interpretará como
4.294.967.295 en el rango de contaje "0 a +32 bits", o bien como -1 en el rango de contaje
"-31 a +31 bits".
Introduzca el valor de varga en el DB de la instrucción CNT_CTRL.
Los rangos de valores siguientes están permitidos para el valor de carga:
Rango de los valores de carga
Límite inferior

Límite de contaje inferior máx.

Límite superior

Límite de contaje superior máx.

Ajustar el contador mediante una señal externa
Es posible seleccionar dos señales externas distintas para ajustar el contador al valor de
carga:
● Sólo entrada 1I2 (2I2) (Página 320)
● Entrada 1I2 (2I2) y señal de paso por cero (Página 322) del encóder

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

319

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
La marca cero del encóder se utiliza si desea sincronizar el contador a un estado específico del
mismo en un determinado punto del proceso. Gracias a ello se logra una mayor precisión en
el contaje.
El contador se ajusta independientemente del modo de contaje.
Tras haber ajustado el contador mediante una señal externa, se activa el bit STS_SYNC en el
DB.
Nota
La sincronización de un contador con la marca cero sólo tiene sentido si está abierta la puerta.
Si ha habilitado sólo un sentido de contaje al ajustar el contador mediante una señal externa,
tenga en cuenta que – cuando se cierre la puerta – se guardará (congelará) el sentido de
contaje actual. Ello permite sincronizar el contador en el sentido de contaje contrario al sentido
habilitado.

Activar contador con entrada 1I2 (2I2)
Activar contador con entrada 1I2 (2I2)
El valor de carga se puede cargar en el contador con un flanco ascendente en la entrada 1I2
(2I2) (DI‑Set).
Las variables ENSET_UP y ENSET_DN en el DB de la instrucción CNT_CTRL y la
parametrización permiten definir el comportamiento del FM 450‑1 ante un flanco ascendente
en la entrada 1I2 (2I2).
Parámetros

Comportamiento del FM 450‑1

ENSET_UP activado

El contador se activa sólo al contar hacia delante.

ENSET_DN activado

El contador se activa sólo al contar atrás.

ENSET_UP y EN‐
SET_DN activados

El contador se activa al contar hacia delante y hacia atrás.

Parametrización "Ajus‐
te único del contador"

El contador sólo se ajusta al ocurrir el primer flanco ascendente en la entrada
1I2 (2I2).
Si desea volver a activar el contador, primero es preciso activar de nuevo
ENSET_UP o ENSET_DN. Entonces, el contador se ajustará de nuevo con el
siguiente flanco ascendente en la entrada 1I2 (2I2).

Parametrización "Ajus‐ El contador se ajusta en cada flanco ascendente de la entrada 1I2 (2I2)
te múltiple del contador" mientras estén activadas ENSET_UP y/o ENSET_DN.

Nota
En todo caso, deberá activar una de las variables ENSET_UP y/o ENSET_DN para que el
contador se pueda ajustar con la entrada 1I2 (2I2).

320

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activación única con la entrada 1I2 (2I2)
La figura siguiente muestra un ajuste único del contador 1 con la entrada 1I2. Para el contador
2 se aplican condiciones similares con la entrada 2I2. En el caso ilustrado sólo está activada
la variable ENSET_UP. Por tanto, el contador se activa al contar hacia delante.
El contador 1 se ajusta en el primer flanco ascendente de la entrada 1I2 mientras esté activada
ENSET_UP. Si se desea volver a activar el contador, en primer lugar es preciso desactivar la
variable ENSET_UP y activarla luego de nuevo. El siguiente flanco ascendente en la entrada
1I2 implica un nuevo ajuste del contador.
,PSXOVRVGHFRQWDMH

',6HW

(16(7B83

(OFRQWDGRU
VHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
VHDFWLYD

Activación múltiple con la entrada 1I2 (2I2)
La figura siguiente muestra un ajuste múltiple del contador 1 con la entrada 1I2. Para el
contador 2 se aplican condiciones similares con la entrada 2I2. En el caso ilustrado sólo está
activada la variable ENSET_UP. Por tanto, el contador se activa al contar hacia delante.
El contador 1 se activa en cada primer flanco ascendente de la entrada 1I2 mientras esté
activada ENSET_UP. Si desactiva ENSET_UP, el contador no se activará con un flanco
ascendente en la entrada 1I2. Sólo cuando se haya vuelto a activar ENSET_UP, el contador
se activará en el siguiente flanco ascendente que ocurra en la entrada 1I2.
,PSXOVRVGHFRQWDMH

',6HW

(16(7B83

 (OFRQWDGRU
 VHDFWLYD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

(OFRQWDGRU
VHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
VHDFWLYD

321

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activar contador con entrada 1I2 (2I2) y señal de paso por cero
Activar contador con entrada 1I2 (2I2) y señal de paso por cero
Si la activción del contador se parametriza con la señal de paso por cero del encóder ("Evaluar
señal de paso por cero para el ajuste"), el contador se activa al valor de carga con el flanco
ascendente de la señal de paso por cero.
La activación se realiza sólo si, en el instante del flanco ascendente de la señal de paso por
cero, está activa además la entrada 1I2 (2I2).
Las variables ENSET_UP y ENSET_DN en el DB de la instrucción CNT_CTRL y la
parametrización permiten definir el comportamiento del FM 450‑1 ante un flanco ascendente
de la señal de paso por cero:
Parámetros de entrada

Comportamiento del FM 450‑1

ENSET_UP activado

El contador se activa sólo al contar hacia delante.

ENSET_DN activado

El contador se activa sólo al contar atrás.

ENSET_UP y EN‐
SET_DN activados

El contador se activa al contar hacia delante y hacia atrás.

Parametrización "Ajuste
único del contador"

El contador sólo se ajusta al ocurrir el primer flanco ascendente en la marca
cero.
Si desea volver a activar el contador, deberá activar primero de nuevo
ENSET_UP o ENSET_DN (evaluación de flancos). Entonces, el contador
se ajustará de nuevo con el siguiente flanco ascendente en la marca cero.

Parametrización "Ajuste
múltiple del contador"

El contador se activa en cada flanco ascendente de la señal de paso por
cero mientras que estén activadas ENSET_UP y/o ENSET_DN.

Nota
En todo caso, es preciso activar una de las variables ENSET_UP y/o ENSET_DN y la
entrada 1I2 (2I2) para que el contador se pueda activar con la señal de paso por cero.

Activación única con entrada 1I2 (2I2) y señal de paso por cero
La figura siguiente muestra un ajuste único del contador 1 con la señal de paso por cero. Para
el contador 2 se aplican condiciones similares con la entrada 2I2. En el caso ilustrado sólo está
activada la variable ENSET_UP. Por tanto, el contador se activa al contar hacia delante.
El contador 1 se activa con el primer flanco ascendente de la señal de paso por cero, siempre
y cuando estén activadas ENSET_UP y la entrada 1I2.
Si desea volver a activar el contador 1, en primer lugar es preciso desactivar la variable
ENSET_UP y luego activarla de nuevo. Si no se ha activado la entrada 1I2, la activación del
contador se realiza con la primera señal de paso por cero después de activar la entrada 1I2.
Si la entrada 1I2 está activada, la activación se efectuará con la siguiente señal de paso por
cero.

322

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVGHFRQWDMH

6H³DOFHUR

',6HW

(16(7B83
(OFRQWDGRU
VHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU (OFRQWDGRU
QRVHDFWLYD VHDFWLYD

Activación múltiple con entrada 1I2 (2I2) y señal de paso por cero
La figura siguiente muestra una activación múltiple del contador 1 con la señal de paso por
cero. Para el contador 2 se aplican condiciones similares con la entrada 2I2. En el caso
ilustrado sólo está activada la variable ENSET_UP. Por tanto, el contador se activa al contar
hacia delante.
El contador se activa en cada flanco ascendente de la señal de paso por cero, siempre y
cuando estén activadas ENSET_UP y la entrada 1I2.
,PSXOVRVGHFRQWDMH

6H³DOFHUR

',6HW

(16(7B83

(OFRQWDGRU
VHDFWLYD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

(OFRQWDGRU
VHDFWLYD

(OFRQWDGRU
QRVHDFWLYD

(OFRQWDGRU (OFRQWDGRU
QRVHDFWLYD
VHDFWLYD

(OFRQWDGRU
VHDFWLYD

323

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Salidas del canal n
Definir duración del impulso
Duración del impulso
Es posible definir una duración del impulso para adaptarse a los actuadores utilizados en el
proceso (contactores, elementos finales de regulación, etc.). La duración del impulso indica
cuánto tiempo están activas las salidas Q0 y Q1 al alcanzarse un valor de comparación.
Con la duración de impulsos se define el tiempo mínimo que debe estar activada la salida. Este
ajuste sólo es efectivo si preselecciona el correspondiente comportamiento de la salida. La
duración de impulsos no es efectiva si la salida debe permanecer activada entre el valor de
comparación y rebase por exceso o por defecto.
La duración del impulso comienza cuando se activa la salida. La imprecisión de la duración del
impulso es inferior a 1 ms.
Para la duración del impulso se puede predefinir un valor comprendido entre 0 y 500 ms. Este
valor es válido para ambas salidas.
Si la duración del impulso = 0 ms, la salida se activará al alcanzarse el valor de comparación
y se desactivará con el siguiente impulso de contaje.
El valor predeterminado para la duración de impulsos es 0.
Nota
Si se predetermina una duración del impulso = 0 ms, la salida permanecerá activada hasta que
el estado del contador sea igual al valor de comparación (véase la parte superior de la figura
siguiente).
Debido a los tiempos de conmutación de las salidas digitales (máx. 300 μs) se podrían perder
impulsos de control en las salidas si el intervalo de tiempo entre los impulsos de contaje es
menor que los tiempos de conmutación de las salidas digitales (véase la parte inferior de la
figura siguiente).
Por tanto, asegúrese de que el intervalo de tiempo entre los impulsos de contaje sea mayor
que los tiempos de conmutación de las salidas digitales.

324

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
7LHPSRGH
FRQPXWDFLµQ
wV
P£[

7LHPSRGH
FRQPXWDFLµQ
wV
P£[

,PSXOVRVGHFRQWDMH

'2VHFRQPXWDFRQXQUHWUDVRP£[GHwV

,PSXOVRVGHFRQWDMH

'2QRVH
FRQPXWD
9DORUGHFRQWDMH YDORUGHFRPSDUDFLµQ

Definir el comportamiento de las salidas
Valores de comparación y salidas
Descripción
En el FM 450‑1 es posible definir para cada contador dos valores de comparación (valor de
comparación 1 y 2) y asignarlos a las dos salidas digitales (valor de comparación 1: 1Q0 ó 2Q0,
valor de comparación 2: 1Q1 ó 2Q1). Los valores de comparación se comparan con el estado
de contaje actual. Cuando el estado de contaje alcanza un valor de comparación, puede
activarse la salida correspondiente.

Valores de comparación 1 y 2
Los dos valores de comparación se introducen en el DB de la instrucción CNT_CTRL
(CMP_V1, CMP_V2) y se transfieren al FM 450‑1 activando los bits T_CMP_V1 o T_CMP_V2
respectivamente. El contaje no se ve afectado por este hecho.
Los valores de comparación deben estar dentro de los límites del rango de contaje en cuestión.
El valor de comparación se interpreta conforme al rango de contaje seleccionado. Si, por
ejemplo, se predetermina FFFF FFFF H como valor de comparación, este valor se interpretará
como 4 294 967 295 en el rango de contaje de "0 a +32 bits", o bien como -1 en el rango de
contaje de "-31 a +31 bits".
Para los valores de comparación se permiten los rangos de valores siguientes:
Rango de los valores de comparación
Límite inferior

Límite de contaje inferior máx.

Límite superior

Límite de contaje superior máx.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

325

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Habilitar las salidas
Antes de poder controlar las salidas es preciso haberlas habilitado activando los bits
correspondientes en el DB. Si se desactiva uno de estos bits, la salida correspondiente se
desconectará inmediatamente, incluso si se ha parametrizado una duración de impulso para
la misma.
Para la habilitación de las salidas pueden activarse los siguientes bits:
Salida

...es habilitada por el bit

Q0

CTRL_DQ0

Q1

CTRL_DQ1

Comportamiento de las salidas en los modos de contaje
Definir el comportamiento de las salidas
Comportamiento de las salidas Q0 y Q1
Seleccione el comportamiento deseado de la salida correspondiente. Active para ello la casilla
de verificación correspondiente.
● Sin comparación (Página 327)
● Activar si la lectura del contador >= valor de comparación (Página 327)
● Activar si la lectura del contador <= valor de comparación (Página 327)
● Activar al alcanzarse el valor de comparación por la duración del impulso hacia delante
(Página 328)
● Activar al alcanzarse el valor de comparación por la duración del impulso hacia atrás
(Página 328)
● Activar cuando se alcance el valor de comparación para la duración del impulso hacia
delante/atrás (Página 328)
Nota
Para activar las opciones, es preciso introducir los valores de comparación 1 y 2 en el DB con
los datos de contaje, así como transferirlos al módulo con la instrucción CNT_CTRL; además,
es preciso activar los bits CTRL_DQ0 y CTRL_DQ1 en el DB para habilitar las salidas. Véase
también "Valores de comparación y salidas (Página 325)".

326

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Sin comparación
Sin comparación
La salida permanece desactivada y no se ve afectada por los eventos valor de comparación,
paso por cero, rebase por exceso o por defecto. La salida Qx se puede utilizar puramente como
salida digital.

Activar si la lectura del contador >= valor de comparación
Activar si la lectura del contador >= valor de comparación
La salida se pone a “1” si el contador se encuentra en el rango comprendido entre el valor de
comparación y el desbordamiento por exceso.
La salida se pone a “1” si el contador se ajusta a un valor comprendido entre el valor de
comparación y el desbordamiento por exceso.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área.

'HVERUGDPLHQWR
SRUGHIHFWR

9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 329).

Activar si la lectura del contador <= valor de comparación
Activar si la lectura del contador <= valor de comparación
La salida se pone a “1” si el contador se encuentra en el rango comprendido entre el valor de
comparación y el desbordamiento por defecto.
La salida se pone a “1” si el contador se ajusta a un valor comprendido entre el valor de
comparación y el desbordamiento por defecto.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área.

'HVERUGDPLHQWR
SRUGHIHFWR

9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 329).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

327

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activar cuando se alcance el valor de comparación para la duración del impulso hacia delante/atrás
Activar cuando se alcance el valor de comparación para la duración del impulso hacia delante/atrás
Mientras dura el impulso e independientemente del sentido de contaje, la salida se pone a "1"
cuando se alcanza el valor de comparación.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área (t =
duración del impulso).
$GHODQWH

W

W

'HVERUGDPLHQWR 9DORUGH
SRUGHIHFWR
FRPSDUDFLµQ

$WU£V

'HVERUGDPLHQWR 'HVERUGDPLHQWR 9DORUGH
SRUGHIHFWR
FRPSDUDFLµQ
SRUH[FHVR

'HVERUGDPLHQWR
SRUH[FHVR

Activar al alcanzarse el valor de comparación por la duración del impulso hacia delante
Activar al alcanzarse el valor de comparación por la duración del impulso hacia delante
Mientras dura el impulso, la salida se pone a "1" cuando el contador alcanza el valor de
comparación al contar hacia delante.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área (t =
duración del impulso).
W
'HVERUGDPLHQWR
SRUGHIHFWR

9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 329).

Activar al alcanzarse el valor de comparación por la duración del impulso hacia atrás
Activar al alcanzarse el valor de comparación por la duración del impulso hacia atrás
Mientras dura el impulso, la salida se pone a "1" cuando el contador alcanza el valor de
comparación al contar hacia atrás.
La superficie sombreada del gráfico siguiente que la salida está activada en esta área (t =
duración del impulso).
W
'HVERUGDPLHQWR
SRUGHIHFWR

9DORUGH
FRPSDUDFLµQ

'HVERUGDPLHQWR
SRUH[FHVR

Tenga en cuenta las condiciones marco para el comportamiento de las salidas (Página 329).

328

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Condiciones marco para el comportamiento de las salidas
Condiciones marginales para el comportamiento de las salidas digitales
Al parametrizar el comportamiento de las salidas digitales debe observar las siguientes
condiciones marco.
Si..

Entonces...

... desea parametrizar una salida "Activar si el estado
de contador >= valor de comparación o <= valor de
comparación",

... deberá asegurarse de que el intervalo de tiempo entre estos dos
eventos sea mayor que el tiempo de conmutación mínimo de las
salidas (tiempo de conmutación: 300 μs); de lo contrario, se perde‐
rán los impulsos de control de las salidas.
Si el estado del contador alcanza nuevamente el valor de compara‐
ción mientras la salida sigue activa, no se disparará un nuevo im‐
pulso. No se podrá emitir un nuevo impulso hasta que la salida deje
de estar activada.

... desea parametrizar una salida "Activar al alcanzar‐ ... no podrá habilitar una alarma de proceso al "Alcanzar el valor de
se el valor de comparación por la duración del impulso comparación correspondiente hacia atrás".
hacia delante"
... desea parametrizar una salida "Activar al alcanzar‐ ... no podrá habilitar una alarma de proceso al "Alcanzar el valor de
se el valor de comparación por la duración del impulso comparación correspondiente en sentido ascendente".
en sentido descendente"

Habilitación de alarmas de proceso del canal n
Habilitar la activación de una alarma de proceso
Introducción
En el contador de FM 450‑1 se puede definir qué eventos deben generar una alarma de
proceso durante el funcionamiento.

¿Qué es una alarma de proceso?
Si se debe reaccionar a un evento determinado, independientemente del ciclo de la CPU, cada
contador del FM 450‑1 puede disparar una alarma de proceso. En consecuencia de ello, la
CPU interrumpe el programa cíclico y procesa el OB de alarma de proceso.

Habilitar la alarma de proceso
La habilitación de las alarmas de proceso tiene lugar en dos pasos:
1. En la configuración del hardware las alarmas del módulo se habilitan en los parámetros
básicos y se especifica si el módulo debe activar una alarma de diagnóstico y/o una alarma
de proceso.
2. En "Habilitar alarma de proceso" es preciso seleccionar los eventos correspondientes
(Página 330):

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

329

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

OB de alarma de proceso, OB 4x
Si ocurre una alarma de proceso, el programa de usuario se interrumpe, los datos se
transfieren del módulo a la información de arranque del OB 4x (Página 330) y se llama al OB
4x. Cerrando el OB 4x se anula la alarma de proceso.
La CPU pasa a modo STOP si no se ha programado el OB 4x. Al conmutarse luego
nuevamente a modo RUN, se habrán borrado las peticiones de alarma de proceso.

Alarma de proceso perdida
Si ocurre un evento que deba disparar una alarma de proceso, y el mismo evento anterior no
se ha acusado todavía, no se dispararán más alarmas de proceso; la alarma de proceso se
perderá. Esta situación puede conducir a la alarma de diagnóstico "Alarma de proceso
perdida".

Ajuste predeterminado
En el ajuste predeterminado no se han habilitado alarmas de proceso.

Eventos para la activación de una alarma de proceso
¿Qué eventos pueden disparar una alarma de proceso?
Durante el funcionamiento del FM 450‑1 los siguientes eventos pueden activar una alarma de
proceso (con independencia para cada uno de los contadores):
● Apertura de la puerta (en los modos de operación con puerta HW o SW)
● Cierre de la puerta (en los modos de operación con puerta HW o SW)
● Rebase del límite superior
● Rebase del límite inferior
● Paso por cero
● Alcance del valor de comparación 1 ó 2 en sentido de contaje adelante
● Alcance del valor de comparación 1 ó 2 en sentido de contaje atrás
● Activar contador (DI-Set)
Active la casilla de verificación para los eventos correspondientes.
Es posible seleccionar un número cualquiera de eventos para disparar alarmas de proceso.
Para las alarmas de proceso que se disparan al alcanzar un valor de comparación hay que
tener en cuenta las condiciones marco para el comportamiento de las salidas (Página 329).

Información de arranque del OB 4x
Información de arranque del OB 4x
La variable temporal OB4x_POINT_ADDR se escribe en la información de arranque del OB 4x.

330

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
La variable OB4x_POINT_ADDR (byte 8 a 11) abarca 4 bytes. En estos cuatro bytes se guarda
información sobre el evento que ha provocado la alarma de proceso.
La tabla muestra qué bits se activan según el tipo de alarma. Los bits no mencionados son
irrelevantes y adoptan el valor cero.
Byte

Bit

Significado: Alarma en caso de ...

8

0

Apertura de la puerta

1

Cierre de la puerta

2

Rebase del límite superior

3

Rebase del límite inferior

4

Alcance del valor de comparación 1 en sentido de contaje adelante

5

Alcance del valor de comparación 1 en sentido de contaje atrás

6

Alcance del valor de comparación 2 en sentido de contaje adelante

7

Alcance del valor de comparación 2 en sentido de contaje atrás

0

Paso por cero

5

Activar contador (DI-Set) (sincronización)

Contador 1

9

Contador 2
10

11

0

Apertura de la puerta

1

Cierre de la puerta

2

Rebase del límite superior

3

Rebase del límite inferior

4

Alcance del valor de comparación 1 en sentido de contaje adelante

5

Alcance del valor de comparación 1 en sentido de contaje atrás

6

Alcance del valor de comparación 2 en sentido de contaje adelante

7

Alcance del valor de comparación 2 en sentido de contaje atrás

0

Paso por cero

5

Activar contador (DI-Set) (sincronización)

Uso del FM 450-1 desde el programa de usuario
Inclusión del FM 450-1 en un programa de usuario
Para integrar el FM 450-1 en un programa de usuario pueden utilizarse instrucciones que le
facilitarán en lo posible el manejo de las funciones deseadas:
La instrucción CNT_CTRL se activa en el programa de usuario de la CPU. Ésta permite la
comunicación entre la CPU y el FM 450-1.
Todos los datos pertenecientes a un canal del módulo se encuentran en el DB de la instrucción
CNT_CTRL (DB de contaje). Inserte en el proyecto un bloque de datos del tipo
CNT_CHANTYPE1 mediante "Bloques de programa > Agregar bloque".
Además, para el FM 450-1 se puede utilizar también la instrucción DIAG_INF, que permite
transferir información de diagnóstico al DB de contaje.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

331

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

FM 450-1: Online y diagnóstico
Información actual sobre el módulo
Diagnóstico estándar
Indicadores de fallos mediante los LEDs de diagnóstico del FM 450-1
¿Dónde se indica el fallo?
Los fallos se indican a través de los dos LEDs de diagnóstico rojos:
● El LED de diagnóstico INTF indica que hay un error interno en el módulo.
● El LED de diagnóstico EXTF indica que hay un error externo en los terminales de cable.

¿Qué fallos se indican?
La tabla siguiente muestra los tipos de errores indicados por los LEDs de diagnóstico.
Tipo de error/LED

Causa del fallo

Solución

Fallos internos

Fallo en el test de la EPROM

Sustituir módulos

LED de diagnóstico
INTF

Fallo en el TEST de la RAM

Sustituir el módulo

Disparo del temporizador de vigilancia
(watchdog)

Sustituir el módulo

Alarma de proceso perdida

Se acusa procesando la alar‐
ma de proceso.

Fallos externos
LED de diagnóstico
EXTF

Tensión auxiliar 1L+/1M no conectada o cor‐ Corregir la conexión
tocircuito en la alimentación del encóder
DC24V
Cortocircuito o sobrecarga en la alimenta‐
ción del encóder DC5.2V

Corregir la conexión

Fallos en las señales del encóder de 5 V
(rotura de hilo, cortocircuito, falta de línea)

Corregir la conexión

Activación de una alarma de diagnóstico
Todos los fallos, exceptuando el del test de la EPROM, pueden disparar una alarma de
diagnóstico si ésta se ha habilitado en los parámetros básicos de la parametrización. En
los registros de diagnóstico DS0 y DS1 (Página 334) puede ver qué error ha provocado que se
encienda el LED.

332

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Diagnóstico específico de canal
Disparo de alarmas de diagnóstico
¿Qué es una alarma de diagnóstico?
Si se quiere que un programa de usuario responda a un fallo interno o externo, se puede
parametrizar una alarma de diagnóstico que interrumpa el programa cíclico de la CPU y llame
al OB de alarma de diagnóstico (OB 82).

¿Qué eventos pueden disparar una alarma de diagnóstico?
Los siguientes eventos pueden provocar una alarma de diagnóstico:
● Tensión auxiliar externa 1L+/1M defectuosa
● Alimentación de 5,2 VDC del encóder cortocircuitada o sobrecargada
● Falta parametrización del módulo
● Error en la parametrización del módulo
● La vigilancia de tiempo (watchdog) se ha disparado
● RAM defectuosa
● Alarma de proceso perdida
● Fallo en señal A (rotura de hilo, cortocircuito, falta cable)
● Fallo en señal B (rotura de hilo, cortocircuito, falta cable)
● Fallo en señal N (rotura de hilo, cortocircuito, falta cable)

Habilitación de la alarma de diagnóstico
En la configuración del hardware las alarmas del módulo se habilitan en los parámetros
básicos y se especifica si el módulo debe activar una alarma de diagnóstico y/o una alarma de
proceso.

Reacciones a una alarma de diagnóstico
Cuando se produce un evento que puede disparar una alarma de diagnóstico ocurre lo
siguiente:
● La información de diagnóstico se registra en los registros de diagnóstico DS0 y DS1
(Página 334) del módulo.
● El LED de error de grupo se enciende.
Una vez eliminado el fallo o error, se apaga el LED de error de grupo.
● Se llama al OB de alarma de diagnóstico (OB 82).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

333

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● El registro de diagnóstico DS0 se graba en la información de arranque del OB de alarma de
diagnóstico.
● El contaje prosigue sin cambios si se ha programado una alarma del OB 82. La CPU pasa
a modo STOP si no hay un OB 82.

Ajuste predeterminado
En el ajuste predeterminado no se han habilitado alarmas de diagnóstico.

Registros de diagnóstico DS0 y DS1
Registro de diagnóstico DS0 y DS1
Para saber cuál ha sido el evento que ha disparado una alarma de diagnóstico se consultan los
registros de diagnóstico DS0 y DS1. El registro de diagnóstico DS0 consta de cuatro bytes;
DS1 consta de 16 bytes, siendo los cuatro primeros idénticos a DS0.

Leer el registro desde el módulo
El registro de diagnóstico DS0 (Página 335) se transfiere automáticamente a la información de
arranque en la llamada del OB de diagnóstico. Allí, los cuatro bytes se guardan en los datos
locales (bytes 8 a 11) del OB 82.
El registro de diagnóstico DS1 (Página 336) (y, por lo tanto, también el contenido del DS0)
puede leerse con la instrucción DIAG_INF del módulo. Esto sólo tiene sentido cuando se
notifica un fallo en un canal en el DS0.

334

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación del registro de diagnóstico DS0
Asignación del registro de diagnóstico DS0 y de la información de arranque
La tabla siguiente muestra la asignación del registro de diagnóstico DS0 en la información de
arranque. Todos los bits que no se incluyen en la tabla son irrelevantes y tienen el valor cero.
Byte

Bit

Significado

Observación

Nº de evento

0

0

Módulo averiado

Se activa en todos los eventos de diagnóstico

8:x:00

1

Fallo interno

Se activa en todos los fallos internos:

8:x:01

● Fallo en test de RAM
● La vigilancia de tiempo (watchdog) ha saltado
● Alarma de proceso perdida
2

Fallo externo

Se activa en todos los fallos externos:

8:x:02

● Tensión auxiliar 1L+/1M no conectada o
alimentación del encóder de 5,2 VDC
cortocircuitada
● Alimentación de 5,2 V DC del encoder
cortocircuitada o sobrecargada
● Señales de 5 V defectuosas
● Error de parametrización
3

Fallo en un canal

Siempre tiene el valor 1 cuando hay un error interno o
externo.

8:x:03

4

Fallo en la tensión auxiliar externa

Comprobar tensión

8:x.04

7

Error de parametrización

Para más información, consulte el capítulo Errores de
datos (Página 336)

8:x:07

1

0...3

Clase de tipo

Siempre asignado con un 8

4

Información de canal

Siempre tiene asignado un 1

2

3

La vigilancia de tiempo (watchdog)
ha saltado

Módulo defectuoso o fuertes interferencias

8:x:33

3

3

Defecto en RAM

Módulo defectuoso o fuertes interferencias

8:x:43

6

Alarma de proceso perdida

Comprobar la configuración. Se ha detectado un
evento y no se ha podido notificar porque el mismo
evento aún no se ha sido acusado por la CPU

8:x:46

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

335

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación del registro de diagnóstico DS1
Asignación del registro de diagnóstico DS1
El registro de diagnóstico DS1 se compone de 12 bytes. Los 4 primeros bytes son idénticos a
los del registro de diagnóstico DS0. La siguiente tabla muestra la asignación de los bytes
restantes. Todos los bits que no se incluyen en la tabla son irrelevantes y tienen el valor cero.
Este registro es introducido por la instrucción DIAG_INF en el DB de la instrucción CNT_CTRL
a partir de la DW54.
Byte
4

Bit

Significado

Nota

Nº de evento

0...6

Tipo de canal

Siempre con un 76H asignado

7

Más tipos de canal

Siempre asignado con un 0

5

0...7

Longitud de la información de diagnós‐ Siempre tiene asignado un CH
tico

6

0...7

Cantidad de canales

Siempre tiene asignado un 2

7

0…1

Vector de fallo de canal

Bit 0= 1: Fallo en canal 1
Bit 1= 1: Fallo en canal 2

8

0

Señal A errónea canal 1

8:x:B0

1

Señal B errónea canal 1

8:x:B1

2

Señal N errónea canal 1

8:x:B2

4

Alimentación del encóder 5,2 V erró‐
nea canal 1

8:x:B4

5...7

Reservado

9
10

Reservado
0

Señal A errónea canal 2

8:x:B0

1

Señal B errónea canal 2

8:x:B1

2

Señal N errónea canal 2

8:x:B2

4

Alimentación del encóder 5,2 V erró‐
nea canal 2

8:x:B4

5...7

Reservado

11

Reservado

Error de datos
¿Cuándo se producen errores de datos?
Cuando se transfieren nuevos parámetros al módulo, el FM 450‑1 comprueba dichos
parámetros. Si se producen errores durante esta comprobación, el módulo notifica estos
errores.

¿Dónde se indican los errores de datos?
La instrucción CNT_CTRL registra los errores de datos con sus números de error en el DB de
la instrucción CNT_CTRL. La variable DA_ERR_W permite acceder a esta palabra de datos en
el programa de usuario.

336

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

¿Qué errores de datos existen?
En la tabla siguiente se muestran los errores de datos, junto con el número de error y el
significado.
Nº

Significado

0

No hay error.

201

Valor para selección del receptor incorrecto

202

Valor erróneo para el diagnostico de la pareja de señales

203

Valor erróneo para evaluación de las señales

204

Valor erróneo para filtro de entrada de las señales de contaje de 24 V

205

Valor erróneo para el filtro de entrada de las entradas digitales

206

Inversión del sentido no admisible

207

Comportamiento de 1Q0 (2Q0) parametrizado incorrectamente

208

Comportamiento de 1Q1 (2Q1) parametrizado incorrectamente

209

Rango excedido en la duración del impulso

211

Se ha seleccionado un modo de operación incorrecto

212

No se ha indicado ninguna puerta o se han indicado ambas

215

Al parametrizar la alarma de proceso "Alcanzar el valor de comparación adelante o atrás" se
ha definido un sentido de contaje distinto del especificado en la parametrización del compor‐
tamiento de las salidas "Activar al alcanzarse el valor de comparación por la duración del
impulso adelante o atrás". Estos sentidos de contaje deben coincidir.

216

Las alarmas por control de puerta sólo son posibles en los modos de operación con control de
puerta.

217

En el comportamiento "Activar si estado del contador >= valor de comparación" o "Activar si
estado del contador <= valor de comparación", no se soporta una alarma al "alcanzarse los
valores de comparación".

¿Cómo se acusan los errores de datos?
Corrija los valores de los parámetros de acuerdo con los valores predeterminados.
Retransfiera el juego de parámetros corregido al FM 450‑1. Éste vuelve a comprobar los
parámetros y borra los errores de datos del DB.

Errores de control
¿Cuándo aparecen los errores de operador?
Los errores de operador aparecen cuando se controla el módulo incorrectamente a causa de
una preselección incorrecta de las señales de control.

¿Dónde se indican los errores de operador?
La instrucción CNT_CTRL registra los números de errores de operador en el DB. Activando el
parámetro de salida OT_ERR la instrucción CNT_CTRL muestra que se ha producido un error
de operador. La variable OT_ERR_B permite acceder a esta palabra de datos en el programa.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

337

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

¿Qué errores de operador existen?
En la tabla siguiente se muestran los errores de operador, junto con el número de error y el
significado.
Nº

Significado

0

No hay error

1

El modo de operación no se puede iniciar con puerta SW

2

El modo de operación no se puede cancelar

4

Solo se soporta con la CPU en STOP

¿Cómo se acusan los errores de operador?
Acuse el error con el parámetro de entrada OT_ERR_A de la instrucción CNT_CTRL.

1.2.1.5

Uso del ET 200S 1Count24V

Asignación de conectores 1Count24V
Reglas de cableado
Los cables (terminales 1 y 5 y terminales 2 y 8) deben estar apantallados. La pantalla tiene que
hacer contacto por ambos extremos. Para ello se debe usar el elemento de contacto (véase el
anexo de las instrucciones de servicio Sistema de periferia descentralizada ET 200S (http://
support.automation.siemens.com/WW/view/es/1144348)).

338

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación de terminales del 1Count24V
La tabla siguiente muestra la asignación de conectores para el 1Count24V.
Vista

Asignación de terminales

Observaciones
B: Entrada de sentido o pista B
A: entrada de impulsos o pista A

&RXQW
9

DC24V: alimentación del encóder
M: tierra

6)

DI: entrada digital
DO1: salida digital
70(6\
&RXQW9
83

'1





(6
'$$%

%





'&9





0





'2

$



'&9





0





',








Conexión del generador de impulsos
La tabla siguiente muestra las conexiones de un generador de impulsos en el módulo del
terminal y los posibles sentidos de contaje.
Tipo de encóder

Conexión

Sentido de contaje

Encóder incremental de posi‐
ción sin nivel de sentido

Impulsos de contaje 24 V a terminal 5 (A)

Adelante

Encóder incremental de posi‐
ción con nivel de sentido

Impulsos de contaje 24 V a terminal 5 (A) y
sentido 24 V a terminal 1 (B)

adelante, atrás

Encóder incremental de posi‐
ción con 2 pistas con desfase
de 90o

Pista A terminal 5 (A) y pista B terminal 1 (B) adelante, atrás

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

339

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Configurar y parametrizar 1Count24V
En servicio
Seleccionar modo de operación
Modo de operación
Al preseleccionar un modo de operación se elige la funcionalidad con la que se utilizará el
1Count24V.
Modo de operación

Descripción

Contaje (Pági‐
na 340)

Preselección para los modos de contaje

Medición (Pági‐
na 364)

Preselección para los modos de medición

Lectura del recorrido
(Página 382)

El 1Count24V cuenta sin fin en este modo de operación a partir del valor de
carga:
● Cuando el 1Count24V alcanza el límite superior de contaje en la cuenta
ascendente, y entonces aparece otro impulso de contaje, salta hasta el límite
inferior de contaje y continúa contando desde ese valor sin perder impulsos.
● Cuando el 1Count24V alcanza el límite inferior de contaje en la cuenta
descendente, y entonces aparece otro impulso, salta hasta el límite superior
de contaje y continúa contando desde ese valor sin perder impulsos.

Modo Fast (Pági‐
na 395)

El 1Count24V cuenta sin fin en este modo de operación a partir del valor de
inicio:

(a partir de la versión ● Cuando el 1Count24V alcanza el valor máximo representable con 25 bits
de firmware 2.0)
(todos los bits activados) al contar en sentido ascendente y cuando llega un
nuevo impulso de contaje, el valor de contaje salta a "0" y continúa contando
desde ahí sin que se pierda ningún impulso.
● Cuando el 1Count24V alcanza el valor "0" al contar en sentido descendente
y cuando llega un nuevo impulso de contaje, el valor de contaje salta al valor
máximo representable con 25 bits (todos los bits activados) y continúa
contando desde éste sin que se pierda ningún impulso.
Este modo de operación es adecuado para la lectura del recorrido en ciclos
isócronos especialmente breves.

Parámetros para contaje
Activar diagnóstico colectivo
Diagnóstico colectivo
Si activa el diagnóstico colectivo en su parametrización, se realiza un diagnóstico relativo al
canal.

340

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar la reacción en caso de STOP de la CPU/del maestro
Ajuste del comportamiento en caso de STOP de la CPU/del maestro
Es posible parametrizar la reacción del 1Count24V en caso de fallo del controlador de nivel
superior.
Parámetro

Estado del 1Count24V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

Desconectar DO 1

El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
tienen efecto inmediato.
se cierra y la salida digital se bloquea.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El valor límite superior e inferior, la función
y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.

Continuar modo de
operación1)

El modo de operación actual sigue activo. La puerta
y la salida digital conservan sus estados.

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

DO 1 Aplicar valor sus‐ El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
titutivo
se cierra y el valor sustitutivo parametrizado para la tienen efecto inmediato.
salida digital se aplica directamente.
El valor de comparación 1 und 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
Si para la salida se parametriza "Impulso al alcanzar
el valor de comparación", para la duración del im‐
pulso sólo está disponible el valor sustitutivo = 1.
DO 1 Mantener el últi‐ El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
mo valor
se cierra y el estado de la salida digital se conserva. tienen efecto inmediato.
Los valores de comparación 1 y 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
1)

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count24V.

Abandonar el estado parametrizado
¿En qué condiciones abandona el 1Count24V el estado parametrizado?
La CPU o el maestro debe estar en modo RUN y la interfaz de control (Página 360) debe
modificarse.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

341

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count24V
● POWER ON o inserción del módulo de potencia correspondiente

342

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interpretación de la señal
Seleccionar evaluación de contaje y sentido
Evaluación de señal A*, B*
La evaluación de la señal mediante A*, B* permite contar direccionalmente. Son posibles
diferentes modos de evaluación dependiendo de lo que se parametrice:
● Impulso y sentido (Página 344)
En los encóders incrementales de posición de 24 V con nivel de sentido debe garantizarse
que entre la señal de sentido B* y la señal de contaje A* se observe un intervalo de como
mínimo 5 µs/50 µs, según el filtro de entrada parametrizado.
La figura siguiente muestra el intervalo de tiempo entre la señal de sentido y la señal de
contaje.
6H³DO$

6H³DO%FRPR
QLYHOGHVHQWLGR
7LHPSR
wVwVHQIXQFLµQ
GHOWLHPSRGHILOWUDGR

● Encóder rotativo (Página 220)
Si conecta un encóder rotativo de 24 V con dos pistas desfasadas 90 grados en la entrada
de contaje y sentido, es posible parametrizar una evaluación simple (Página 221) en todos
los modos de contaje. Además se puede parametrizar una evaluación doble (Página 221)
o cuádruple (Página 221).
En todos los modos de evaluación se puede invertir el sentido de contaje (Página 345) en
la entrada de sentido B*.
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/
simétrica o salida tipo NPN).
Nota
Si con el 1Count24V ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas
del encóder", es preciso utilizar también encóders con salida tipo NPN.
Nota
La indicación 100 kHz en la frecuencia de contaje se refiere a la frecuencia máxima de las
señales A* o B*. Así, en la evaluación doble se obtienen como máximo 200 kHz en los
impulsos de contaje o máximo 400 kHz en la evaluación cuádruple.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

343

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Evaluación "Impulso y sentido"
Impulso y sentido
En este modo de valuación se utiliza como indicador de sentido el nivel en la entrada de sentido
B*.
Una entrada no cableada equivale al sentido de contaje "ascendente", si en el parámetro
Evaluación de señal ha elegido "Impulso y sentido".
La figura siguiente muestra las señales de un encóder incremental de posición de 24 V con
nivel de sentido.
6H³DO$
6H³DO%FRPR
QLYHOGHVHQWLGR

DVFHQGHQWH

GHVFHQGHQWH

,PSXOVRVGHFRQWDMH
DVFHQGHQWH
,PSXOVRVGHFRQWDMH
GHVFHQGHQWH

Seleccionar filtro para señales de entrada
Filtro de entrada
Para filtrar las señales en la entrada de contaje A*, la entrada de sentido B* y la entrada digital
DI, se puede activar un filtro en función de la duración mínima del impulso o bien de la
frecuencia máxima de señales.
Para cada entrada puede seleccionarse un ancho de impulso mínimo de 2,5 µs o 25 µs.

Seleccionar entradas del encóder
Entradas del encóder
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/simétrica
o salida tipo NPN).
Nota
Si se ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas del encóder", es
preciso utilizar también encóders con salida tipo NPN.

344

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

Comportamiento de las salidas en los modos de contaje
Valores de comparación y salidas
Introducción
En el 1Count24V se pueden almacenar dos valores de comparación que estén asignados a las
salidas digitales. Dependiendo del estado del contador y de los valores de comparación se
pueden activar las salidas.

Salidas digitales
El 1Count24V tiene una salida digital "verdadera" y una salida digital "virtual" que sólo existe
como bit de estado en la interfaz de notificación.
Ambas salidas pueden parametrizarse (parámetros "Función DO1", "Función DO2").
La función y el comportamiento de las salidas digitales se puede cambiar durante el
funcionamiento. La nueva función actúa inmediatamente.

Controlar las salidas simultáneamente con los comparadores
Si se va a utilizar una función de comparación para las salidas, estas se pueden seguir
controlando con SET_DO1 o SET_DO2. De esta manera, se puede simular el efecto de la
comparación mediante el programa de control:
● Con el flanco ascendente de SET_DO1 o SET_DO2 se activa la salida.
Si se ha seleccionado la función "Impulso al alcanzarse el valor de comparación", se emitirá
un único impulso de la duración especificada. Si la duración del impulso = 0, SET_DO1 y
SET_DO2 quedan sin efecto.
El bit de control SET_DO1 no está permitido en el caso de seleccionar el comportamiento
de salida "Conmutación en los valores de comparación".
● Un flanco descendente de SET_DO1 o SET_DO2 desactiva la salida de nuevo.
Obsérvese que los comparadores continúan activos y que pueden activar o desactivar la salida
si hay un cambio en el resultado de la comparación.
Nota
Una salida activada con SET_DO1 o SET_DO2 no se desactiva con el comparador.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

345

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Cargar los valores de comparación
Los valores de comparación se transfieren al 1Count24V. El contaje no se ve afectado por este
hecho.

Rango válido para los dos valores de comparación
Sentido principal de contaje:
ninguno
Límite inferior de contaje
hasta
Límite superior de contaje

Sentido principal de contaje:
adelante
–2147483648
hasta
Límite superior de contaje -1

Sentido principal de contaje:
atrás
1
hasta
2.147.483.647

Cambiar la función y el comportamiento de las salidas digitales
Las funciones y el comportamiento de las salidas se pueden cambiar durante el
funcionamiento mediante la interfaz de control (Página 360). Al hacerlo, el módulo 1Count24V
desactiva las salidas y aplica los valores de la siguiente manera:
● Función de las salidas digitales DO1 y DO2: Si se cambia la función de manera que se
cumpla la condición de comparación, la salida no cambiará hasta después del siguiente
impulso de contaje. No obstante, si la histéresis (Página 350) está activada, el módulo
1Count24V no cambia la salida.
● Histéresis: Una histéresis (Página 350) se mantiene activa incluso después de una
modificación. La próxima vez que se alcance el valor de comparación, se aplicará el nuevo
rango de la histéresis.
● Duración del impulso: La nueva duración del impulso (Página 353) tiene efecto con el
siguiente impulso.

Seleccionar el comportamiento de las salidas
Comportamiento de las salidas DO1 y DO2
En la lista desplegable, seleccione el comportamiento deseado de la salida correspondiente.
● Salida (Página 347)
● Conexión con estado del contador ≥ valor de comparación (Página 347)
● Conexión con estado del contador ≤ valor de comparación (Página 347)
● Impulso al alcanzar el valor de comparación (Página 348)
● Conmutar en los valores de comparación (Página 348)(sólo DO1)

Ajustar o modificar la función y el comportamiento de la salida digital DO1
Si quiere ajustar o cambiar el comportamiento de la DO1, asegúrese de que se consideran
todas las dependencias parametrizadas, pues de lo contrario puede producirse un error de
parametrización o un error de carga.

346

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Condiciones marginales:
Si se parametriza "Conmutar al alcanzar los valores de comparación" para la DO1 hay que
hacer lo siguiente:
● ajustar la histéresis = 0 y
● además parametrizar también la "Función DO2" como "Salida".

Salida
Salida
Los bits de control (Página 360)SET_DO1 y SET_DO2 permiten activar y desactivar las
salidas.
Para ello, es preciso que los bits de control (Página 360)CTRL_DO1 o CTRL_DO2 estén
activados.
Los bits de estado STS_DO1 y STS_DO2 de la interfaz de realimentación (Página 362)
permiten consultar el estado de las salidas.
Los bits de estado (Página 362)STS_CMP1 y STS_CMP2 indican que la salida
correspondiente está o estaba conectada. Estos bits de estado conservan su estado hasta ser
acusados. Si la salida permanece conectada, el correspondiente bit se vuelve a activar
inmediatamente. Estos bits de estado se activan también si los bits de control SET_DO1 o
SET_DO2 se accionan cuando las salidas DO1 o DO2 no están habilitadas.

Modo isócrono
En el modo isócrono la salida DO1 conmuta en el instante To. El estado de la salida virtual DO2
se notifica en el instante Ti.

Conexión si el estado del contador ≤ valor de comparación o estado del contador ≥ valor de comparación
Estado del contador ≤ valor de comparación y estado del contador ≥ valor de comparación
Cuando las condiciones de comparación se cumplen, el comparador correspondiente activa la
salida. El estado de la salida (Página 362) se indica con STS_DO1 y STS_DO2.
Para ello, es preciso que los bits de control (Página 360)CTRL_DO1 o CTRL_DO2 estén
activados.
El bit de estado (Página 362)STS_CMP1 o STS_CMP2 indica el resultado de la comparación.
Sólo podrá acusar y por tanto desactivar estos bits cuando dejen de cumplirse las condiciones
de comparación.

Modo isócrono
También en el modo isócrono la salida DO1 se activa inmediatamente al cumplirse la condición
de comparación y, por consiguiente, no depende del ciclo de bus. El estado de la salida virtual
DO2 se notifica en el instante Ti.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

347

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Impulso al alcanzar el valor de comparación
Impulso al alcanzar el valor de comparación
Cuando el estado del comparador alcanza el valor de comparación, el comparador activa la
correspondiente salida digital durante el tiempo parametrizado para el impulso.
Para ello, es preciso que los bits de control (Página 360)CTRL_DO1 o CTRL_DO2 estén
activados.
Los bits de estado (Página 362)STS_DO1 y STS_DO2 tienen siempre el estado de la
correspondiente salida digital.
El resultado de la comparación se indica mediante el bit de estado (Página 362)STS_CMP1 o
STS_CMP2 y sólo se podrá desactivar mediante acuse cuando haya expirado la duración del
impulso.
Si se ha parametrizado el sentido principal de contaje, el comparador conmutará sólo cuando
se alcance el valor de comparación en el sentido principal de contaje.
Si no se ha parametrizado el sentido principal de contaje, el comparador conmutará sólo
cuando se alcance el valor de comparación en cualquiera de los dos sentidos de contaje.
Si la salida digital ha sido activada mediante el bit de control (Página 360)SET_DO1 o
SET_DO2, se desactivará cuando haya transcurrido la duración del impulso.

Modo isócrono
También en el modo isócrono la salida DO1 se activa inmediatamente al cumplirse la condición
de comparación y, por consiguiente, no depende del ciclo de bus. El estado de la salida virtual
DO2 se notifica en el instante Ti.

Conmutar en los valores de comparación
Conmutar en los valores de comparación
El comparador activa la salida cuando se cumplen las siguientes condiciones:
● Los dos valores de comparación deben cargarse mediante la función de carga
(Página 360)CMP_VAL1 y CMP_VAL2 y
● una vez cargados los valores de comparación, hay que habilitar la salida DO1 (Página 360)
con CRTL_DO1.
La tabla siguiente muestra cuándo está activada o desactivada la salida DO1:

348

DO1 está conectada cuando

DO1 está desconectada cuando

V2 < V1
(v. figura inferior)

V2 ≤ estado del contador ≤ V1

V2 > estado del contador
o
estado del contador > V1

V2 = V1

V2 = estado del contador = V1

V2 ≠ estado del contador ≠ V1

V2 > V1
(v. figura inferior)

V1 > estado del contador
o
estado del contador > V2

V1 ≤ estado del contador ≤ V2

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Las siguientes figuras muestran el estado de la salida DO1 dependiendo del estado del
contador y de los valores de comparación:
● V2 < V1 al comenzar el contaje
(VWDGRGHO
FRQWDGRU
9
9



'2

W

W

● V2 > V1 al comenzar el contaje
(VWDGRGHO
FRQWDGRU
9
9



'2

W

W

El bit de estado (Página 362)STS_CMP1 indica el resultado de la comparación. Sólo podrá
acusar y por tanto desactivar este bit cuando deje de cumplirse la condición de comparación.
No hay ninguna histéresis cuando la salida tiene este comportamiento.
En este comportamiento de salida, el bit de control (Página 360)SET_DO1 no puede controlar
la salida DO1.

Modo isócrono
También en el modo isócrono la salida DO1 se activa inmediatamente al cumplirse la condición
de comparación y, por consiguiente, no depende del ciclo de bus.

Seleccionar valor sustitutivo DO1
Valor sustitutivo DO1
Si se ha seleccionado el parámetro de conmutar valor sustitutivo DO1 en "Comportamiento en
STOP de la CPU/del maestro (Página 341)", seleccione aquí el valor sustitutivo que debe
enviarse a la salida digital DO1.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

349

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activar diagnóstico DO1
Diagnóstico DO1
El "diagnóstico DO1" (rotura de hilo, cortocircuito) sólo es posible con anchos de impulso > 90
ms en la salida digital DO1.
Active la casilla de verificación para el diagnóstico de la salida DO1.

Definir histéresis
Histéresis
Un encóder puede permanecer en una posición particular y fluctuar entonces alrededor de
esta posición. Esto hace que el estado del contador fluctúe alrededor de un valor determinado.
Si hay un valor de comparación en este rango de fluctuación, por ejemplo, la salida
correspondiente se activa y desactiva de acuerdo con el ritmo de las fluctuaciones. Para evitar
estas conmutaciones cuando se producen pequeñas oscilaciones, el 1Count24V cuenta con
una histéresis parametrizable. Se puede parametrizar un rango entre 0 y 255 (0 significa:
histéresis desconectada).
La histéresis también actúa en caso de desbordamiento por exceso y por defecto.

Funcionamiento de la histéresis con el estado del contador ≤ valor de comparación y estado del
contador ≥ valor de comparación
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (= desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo, el valor de comparación = 5.
El contador está parametrizado con "Sentido principal de contaje adelante" y "la salida con
"Conexión si estado del contador ≥ valor de comparación".
Al alcanzarse la condición de comparación, se activa la histéresis. Cuando la histéresis está
activada, el resultado de la comparación permanece invariable.
Si el valor de contaje abandona el rango de histéresis, la histéresis se desactiva. El
comparador se conecta de nuevo conforme a sus condiciones de comparación.

350

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
9DORUGHFRQWDMH










+\V

+\V

Nota
Si se produce un cambio del sentido de contaje en el valor de comparación cuando la histéresis
está activada, la salida se desactiva.

Funcionamiento de la histéresis cuando se alcanza el valor de comparación y la duración del impulso
=0
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo, el valor de comparación = 5.
El contador está parametrizado con "Impulso al alcanzarse el valor de comparación", "Sin
sentido principal de contaje" y "Duración del impulso = 0".
Cuando se cumplen las condiciones de comparación se activa la histéresis. Cuando la
histéresis está activada, el resultado de la comparación permanece invariable.
Cuando el valor de contaje abandona el rango de histéresis, la histéresis se desactiva. El
comparador borra el resultado de la comparación.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

351

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
9DORUGHFRQWDMH










+\V

+\V

Funcionamiento de la histéresis cuando se alcanza el valor de comparación, salida de la duración del
impulso
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo, el valor de comparación = 5.
El contador está parametrizado con "Impulso al alcanzarse el valor de comparación", "Sin
sentido principal de contaje" y "Duración del impulso > 0".
Cuando las condiciones de comparación se cumplen, la histéresis se activa y se transfiere a
la salida un impulso de la duración parametrizada.
Cuando el valor de contaje abandona el rango de histéresis, la histéresis se desactiva.
Cuando se activa la histéresis, el 1Count24V almacena el sentido de contaje.
Si el rango de histéresis se abandona en un sentido diferente del almacenado, se transfiere un
impulso a la salida.
9DORUGHFRQWDMH










+\V

+\V

352

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Definir duración del impulso
Duración del impulso
La duración del impulso comienza al activarse la salida digital correspondiente. La imprecisión
de la duración del impulso es inferior a 2 ms.
La duración del impulso puede ser utilizada para conseguir una adaptación a los actuadores
utilizados. La duración del impulso indica durante cuánto tiempo ha de estar activada la salida.
La duración del impulso puede ser preseleccionada en intervalos de 2 ms entre 0 ms y 510 ms.
Si la duración del impulso es 0, la salida quedará activada hasta que la condición de
comparación deje de cumplirse. Observe que los tiempos de impulsos de contaje deben ser
mayores que los tiempos mínimos de conexión de la salida digital.

Modo isócrono
También en el modo isócrono la salida DO1 se activa inmediatamente al cumplirse la condición
de comparación y, por consiguiente, no depende del ciclo de bus. El estado de la salida virtual
DO2 se notifica en el instante Ti.

Seleccionar modo de contaje
Descripción
Al preseleccionar un modo de contaje se elige la funcionalidad con la que se utilizará el
1Count24V.
Modo de operación

Descripción

Contaje sin fin (Página 195) El 1Count24V cuenta en modo sin fin a partir del estado actual del con‐
(con o sin puerta)
tador.
Contaje único (Página 196)
(con puerta HW o SW)

El 1Count24V comienza a contar a partir del valor de carga al abrirse la
puerta y se detiene en el límite de contaje.

Contaje periódico (Pági‐
na 197)
(con puerta HW o SW)

El 1Count24V comienza a contar al abrirse la puerta a partir del valor de
carga entre los límites de contaje.

El ajuste predeterminado es el modo de operación "Contaje sin fin".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

353

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Selección del sentido principal de contaje
Descripción
Si se parametriza un sentido principal de contaje (Página 198) (adelante o atrás) es posible
limitar el rango de contaje máximo a un rango más pequeño, ajustando para ello un límite
superior de contaje (Página 359). El rango de contaje parametrizado está comprendido
entonces entre 0 y el límite superior de contaje ajustado.
El sentido principal de contaje sólo puede seleccionarse en los modos de operación "Contaje
único" y "Contaje periódico".
Se puede seleccionar el siguiente comportamiento:
● Ninguno (sin sentido principal de contaje)
● Adelante
● Atrás

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Función DI
Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital.
● Congelar/redisparar con flanco ascendente (Página 355)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador. Después de la operación de guardado, el contador se establece al valor de carga.

354

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● Sincronización con flanco ascendente (Página 356)
Los flancos ascendentes de la entrada digital permiten establecer el contador al valor de
carga.
● Congelar con flanco ascendente (Página 358)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador.
El ajuste predeterminado es "Entrada".

Congelar/redisparar con flanco ascendente
Congelar/redisparar
Con esta función se almacena el estado actual interno del contador del 1Count24V y se
redispara el contaje cuando hay un flanco ascendente en la entrada digital. Esto significa que
se almacena el estado actual interno del contador en el instante del flanco ascendente (valor
de congelación) y, entonces, se carga nuevamente el módulo 1Count24V con el valor de carga
y se sigue contando desde allí.
La siguiente figura muestra la función de congelar/redisparar con valor de carga = 0.

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU

9DORUGH
FRQJHODFLµQ

Para poder ejecutar la función, el modo de contaje tiene que estar habilitado con la puerta SW.
Se inicia con el primer flanco ascendente de la entrada digital.
En la interfaz de notificación (Página 362) se indica el estado almacenado del contador en vez
del estado actual del contador. El bit STS_DI indica el estado de la señal de congelación y
redisparo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

355

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
El valor de congelación se pone por defecto al estado de RESET.
● "0" en el sentido principal de contaje "Ninguno" o "Adelante"
● "Límite de contaje superior parametrizado" en el sentido principal de contaje atrás.
No cambia cuando se abre la puerta SW.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.
Si se cierra la puerta SW, sólo se interrumpe el contaje; es decir, cuando se vuelve a abrir la
puerta SW, continúa el contaje. La entrada digital DI permanece activa incluso cuando la
puerta SW está cerrada.
También en el modo isócrono se congela y redispara el contaje con cada flanco de la entrada
digital. En la interfaz de realimentación se muestra el estado del contador válido en el instante
del último flanco antes de Ti.

Interfaz de notificación avanzada
Si el módulo 1Count24V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces más amplias de datos de usuario, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de notificación (Página 362).

Sincronización con flanco ascendente
Sincronización
Si se ha parametrizado "Sincronización con flanco ascendente", el flanco ascendente de una
señal de referencia en la entrada sirve para poner el 1Count24V al valor de carga.
Se puede seleccionar entre la sincronización única y la periódica (parámetro "Sincronización").
La figura siguiente muestra los estados del contador con una sincronización única y periódica.

356

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVLQWHUQRVGHFRQWDMH
DVFHQGHQWHVRGHVFHQGHQWHV

(QWUDGHGLJLWDO
PDUFDFHUR

6LQFURQL]DFLµQ
¼QLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH

9DORUGHFDUJD

6LQFURQL]DFLµQ
SHULµGLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH
9DORUGHFDUJD

Se aplican las siguientes condiciones:
● El modo de contaje tiene que haber sido iniciado mediante la puerta SW.
● El bit de control (Página 360) "Habilitación de la sincronización" (CTRL_SYN) debe estar
activado.
● Sincronización única: si el bit de habilitación está activado, el primer flanco carga el
1Count24V con el valor de carga.
● Sincronización periódica: si el bit de habilitación está activado, el primer flanco y cada
flanco subsiguiente cargan el 1Count24V con el valor de carga.
● Una vez realizada la sincronización correctamente, el bit de realimentación
(Página 362)STS_SYN queda activado. Debe desactivarse con el bit de control
(Página 360)RES_STS.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

357

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● Como señal de referencia se puede utilizar la señal de un interruptor libre de rebotes o la
marca cero de un encóder rotativo.
● El bit de realimentación (Página 362)STS_DI indica el nivel de la señal de referencia.
En el modo isócrono, el bit de realimentación (Página 362) activado STS_SYN indica que el
flanco ascendente de la entrada digital se encontraba entre el instante Ti del ciclo actual y el
instante Ti del ciclo pasado.

Congelar con flanco ascendente
Congelar
El estado del contador y el valor de congelación reciben sus estados de RESET.
● "0" en el sentido principal de contaje "Ninguno" o "Adelante"
● "Límite de contaje superior parametrizado" en el sentido principal de contaje atrás.
La función de contaje se inicia cuando se abre la puerta SW. El 1Count24V comienza a contar
a partir del valor de carga.
● "0" en el sentido principal de contaje "Ninguno" o "Adelante"
● "Límite de contaje superior parametrizado" en el sentido principal de contaje atrás.
La siguiente figura muestra la función de congelar con valor de carga = 0.

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU
9DORUGH
FRQJHODFLµQ

El valor de congelación equivale siempre al valor de contaje en el instante del flanco
ascendente de la entrada digital DI.
En la interfaz de notificación (Página 362) se indica el estado almacenado del contador en vez
del estado actual del contador. El bit STS_DI indica el nivel de la señal de congelación.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.

358

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
En el modo isócrono, se muestra en la interfaz de realimentación el estado del contador que
se congeló en el instante del último flanco ascendente antes de Ti.
Si se cierra la puerta SW, actúa como parametrizada, de cancelación o de interrupción. La
entrada digital DI permanece activa incluso cuando la puerta SW está cerrada.

Interfaz de notificación ampliada
Si el módulo 1Count24V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces más amplias de datos de usuario, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de notificación (Página 362).

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 362)STS_DI indica el nivel de la entrada digital.

Seleccionar sincronización
Sincronización
Si se ha seleccionado "Sincronización con flanco ascendente" en "Función DI (Página 354)",
es posible elegir entre la sincronización única y la periódica.
● Una vez: si el bit de habilitación está activado, el primer flanco carga el 1Count24V con el
valor de carga.
● Periódica: si el bit de habilitación está activado, el primer flanco y cada flanco subsiguiente
cargan el 1Count24V con el valor de carga.

Determinar el límite superior de contaje
Descripción
Si se parametriza un límite superior de contaje en combinación con un sentido principal de
contaje (Página 198) (adelante o atrás) es posible limitar el rango de contaje máximo a un
rango más pequeño. El rango de contaje parametrizado está comprendido entonces entre 0 y
el límite superior de contaje ajustado.
El límite superior de contaje puede adoptar un valor > 1 hasta el límite superior del rango de
contaje.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

359

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de notificación y control para los modos de contaje
Interfaz de control de los modos de contaje
Nota
Para el 1Count24V, los datos siguientes de la interfaz de control son datos relacionados, es
decir, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de control
La siguiente tabla muestra la asignación de la interfaz de control (salidas) del 1Count24V para
los modos de contaje.
Dirección

Asignación

Bytes 0 a 3

Valor de carga directo, preliminar, valor de comparación 1 ó 2

Byte 0

Comportamiento de DO1, DO2 del 1Count24V
Bit 2

Bit 1

Bit 0

Función DO1

0

0

0

Salida

0

0

1

Conexión con estado del contador ≥ valor de comparación

0

1

0

Conexión con estado del contador ≤ valor de comparación

0

1

1

Impulso al alcanzarse el valor de comparación

1

0

0

Conmutar en los valores de comparación

1

0

1

bloqueado

1

1

0

bloqueado

1

1

1

bloqueado

Bit 5

Bit 4

Función DO2

0

0

Salida

0

1

Conexión con estado del contador ≥ valor de comparación

1

0

Conexión con estado del contador ≤ valor de comparación

1

1

Impulso al alcanzarse el valor de comparación

Bits 3, 6 y 7: reservado = 0
Bytes 1 a 3

Byte 1

Histéresis DO1, DO2 (rango de valores 0 ... 255)

Byte 2

Duración del impulso DO1, DO2 (rango 0 a 255)

Byte 3

reservado = 0
Denominación

360

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación

Byte 4

Bit 7

Acuse del error

EXTF_ACK

Bit 6

Habilitación de DO2

CTRL_DO2

Bit 5

Bit de control DO2

SET_DO2

Bit 4

Habilitación de DO1

CTRL_DO1

Bit 3

Bit de control DO1

SET_DO1

Bit 2

Inicio de la desactivación del bit de estado

RES_STS

Bit 1

Habilitación de la sincronización

CTRL_SYN

Bit 0

Bit de control puerta SW

SW_GATE

Bit 7

reservado = 0

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

Cambio de función y comportamiento de DO1, DO2

C_DOPARAM

Bit 3

Carga del valor de comparación 2

CMP_VAL2

Bit 2

Carga del valor de comparación 1

CMP_VAL1

Bit 1

Carga preliminar del contador

LOAD_PREPARE

Bit 0

Carga directa del contador

LOAD_VAL

Byte 5

Bytes 6 a 7
1)

reservado = 0

1)

Falta en la interfaz de datos de usuario avanzada

Significado de los bits de control
Bit

Significado

C_DOPARAM

Cambio de función y comportamiento de DO1, DO2
Los valores de los bytes 0 a 2 son aceptados como nueva función, histéresis, y duración de impulso de
DO1, DO2. Esto puede conllevar el siguiente error: Las condiciones de conexión/desconexión al al‐
canzarse los valores de comparación no se cumplen.

CMP_VAL1

Carga del valor de comparación 1
El valor de los bytes 0 a 3 se transfiere al valor de comparación 1 con el bit de control "Carga del valor
de comparación 1" (CMP_VAL1).

CMP_VAL2

Carga del valor de comparación 2
El valor de los bytes 0 a 3 se transfiere al valor de comparación 2 con el bit de control "Carga del valor
de comparación 2" (CMP_VAL2).

CTRL_DO1

Habilitación de DO1
Este bit habilita la salida DO1

CTRL_DO2

Habilitación de DO2
Este bit habilita la salida DO2.

CTRL_SYN

Este bit habilita la sincronización

EXTF_ACK

Acuse del error

LOAD_PREPARE

Carga preliminar del contador

LOAD_VAL

El valor de los bytes de 0 a 3 se carga directamente como nuevo valor de contaje

Los bits de error deben ser acusados mediante el bit de control EXTF_ACK una vez eliminada la causa.
El valor de los bytes 0 a 3 se acepta como valor de carga.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

361

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit

Significado

RES_STS

Inicio de la desactivación del bit de estado
Los bits de estado se desactivan mediante el proceso de realimentación entre el bit RES_STS y el bit
RES_STS_A.

SET_DO1

Bit de control DO1
Conectar y desconectar la salida digital DO1 cuando se ha activado CRTL_DO1.

SET_DO2

Bit de control DO2

SW_GATE

Bit de control puerta SW

Conectar y desconectar la salida digital DO2 cuando se ha activado CRTL_DO2.
La puerta SW se abre/cierra mediante la interfaz de control con el bit SW_GATE.

Interfaz de notificación de los modos de contaje
Nota
Para el 1Count24V, los datos siguientes de la interfaz de notificación son datos relacionados,
es decir, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de notificación
La siguiente tabla muestra la asignación de la interfaz de notificación (entradas) del
1Count24V para los modos de contaje.
Dirección

Asignación

Bytes 0 a 3

Valor de contaje o valor de contaje almacenado con función de congelación en la en‐
trada digital

Byte 4

Bit 7

Cortocircuito en la alimentación del encóder

ERR_24V

Bit 6

Cortocircuito / rotura de hilo / sobretemperatura

ERR_DO1

Bit 5

Error de parametrización

ERR_PARA

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

Desactivación de los bits de estado en curso

RES_STS_A

Bit 1

Error en función de carga

ERR_LOAD

Bit 0

Función de carga en curso

STS_LOAD

362

Denominación

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación

Denominación

Byte 5

Bit 7

Estado de sentido descendente

STS_C_DN

Bit 6

Estado de sentido ascendente

STS_C_UP

Bit 5

reservado = 0

Bit 4

Estado de DO2

STS_DO2

Bit 3

Estado de DO1

STS_DO1

Bit 2

reservado = 0

Bit 1

Estado de DI

Byte 6

Bit 0

Estado de la puerta interna

STS_GATE

Bit 7

Paso por cero en el rango de contaje sin sentido principal de contaje

STS_ND

Bit 6

Límite inferior

STS_UFLW

Bit 5

Límite superior

STS_OFLW

Bit 4

Estado del comparador 2

STS_CMP2

Bit 3

Estado del comparador 1

STS_CMP1

Bit 2

reservado = 0

Bit 1

reservado = 0

Bit 0

Estado de la sincronización

Byte 7

reservado = 0

Bytes 8 a 11

Valor de contaje 1)

1)

STS_DI

STS_SYN

Interfaz de datos de usuario avanzada

Nota sobre los bits de realimentación
Bit

Significado

ERR_24V

Cortocircuito en la alimentación del encóder
El bit de error tiene que ser acusado con el bit de control (Página 360)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_DO1

Cortocircuito / rotura de hilo / sobretemperatura por sobrecarga en la salida DO1
El bit de error tiene que ser acusado con el bit de control (Página 360)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_LOAD

Error en función de carga
Los bits de control (Página 360)LOAD_VAL, LOAD_PREPARE, CMP_VAL1, CMP_VAL2 y C_DOPA‐
RAM no pueden estar activados al mismo tiempo durante la transferencia. Esto tiene como conse‐
cuencia la activación del bit de estado ERR_LOAD, similar a cargar un valor incorrecto (que no se
acepta).

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

RES_STS_A

Desactivación de los bits de estado en curso

STS_C_DN

Estado de sentido descendente

STS_C_UP

Estado de sentido ascendente

STS_CMP1

Estado del comparador 1
El bit de estado STS_CMP1 indica que la salida está o estaba activada. Debe acusarse con el bit de
control (Página 360)RES_STS. Si el bit de estado se acusa cuando la salida todavía está activada, el
bit se vuelve a activar inmediatamente. Este bit también se activa cuando se activa el bit de control
SET_DO1 sin estar habilitada DO1.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

363

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit

Significado

STS_CMP2

Estado del comparador 2
El bit de estado STS_CMP2 indica que la salida está o estaba activada. Debe acusarse con el bit de
control (Página 360)RES_STS. Si el bit de estado se acusa cuando la salida todavía está activada, el
bit se vuelve a activar inmediatamente. Este bit también se activa cuando se acciona el bit de control
SET_DO2 sin que esté habilitada DO2.

STS_DI

Estado de DI
El estado de la DI se indica en todos los modos de operación con el bit STS_DI en la interfaz de
notificación.

STS_DO1

Estado de DO1
El bit de estado STS_DO1 muestra el estado de la salida digital DO1.

STS_DO2

Estado de DO2
El bit de estado STS_DO2 indica el estado de la salida digital virtual DO2.

STS_GATE

Estado de la puerta interna Contaje en curso.

STS_LOAD

Función de carga en curso

STS_ND

Paso por cero en el rango de contaje sin sentido principal de contaje. El bit debe desactivarse con el bit
de control (Página 360)RES_STS.

STS_OFLW

Límite superior de contaje excedido

STS_UFLW

Límite inferior de contaje excedido
Ambos bits deben ser desactivados.

STS_SYN

Estado de la sincronización
Al terminar la sincronización se activa el bit STS_SYN. Debe desactivarse con el bit de control (Pági‐
na 360)RES_STS.

Parámetros para medición
Activar diagnóstico colectivo
Diagnóstico colectivo
Si activa el diagnóstico colectivo en su parametrización, se realiza un diagnóstico relativo al
canal.

364

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar la reacción en caso de STOP de la CPU/del maestro
Ajuste del comportamiento en caso de STOP de la CPU/del maestro
Es posible parametrizar la reacción del 1Count24V en caso de fallo del controlador de nivel
superior.
Parámetro

Estado del 1Count24V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

Desconectar DO 1

El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
tienen efecto inmediato.
se cierra y la salida digital se bloquea.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El valor límite superior e inferior, la función
y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.

Continuar modo de
operación1)

El modo de operación actual sigue activo. La puerta
y la salida digital conservan sus estados.

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

DO 1 Aplicar valor sus‐ El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
titutivo
se cierra y el valor sustitutivo parametrizado para la tienen efecto inmediato.
salida digital se aplica directamente.
El valor de comparación 1 und 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
Si para la salida se parametriza "Impulso al alcanzar
el valor de comparación", para la duración del im‐
pulso sólo está disponible el valor sustitutivo = 1.
DO 1 Mantener el últi‐ El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
mo valor
se cierra y el estado de la salida digital se conserva. tienen efecto inmediato.
Los valores de comparación 1 y 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
1)

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count24V.

Abandonar el estado parametrizado
¿En qué condiciones abandona el 1Count24V el estado parametrizado?
La CPU o el maestro debe estar en modo RUN y la interfaz de control (Página 379) debe
modificarse.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

365

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count24V
● POWER ON o inserción del módulo de potencia correspondiente

366

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interpretación de la señal
Seleccionar evaluación de contaje y sentido
Evaluación de señal A*, B*
La evaluación de la señal mediante A*, B* permite contar direccionalmente. Son posibles
diferentes modos de evaluación dependiendo de lo que se parametrice:
● Impulso y sentido (Página 367)
En los encóders incrementales de posición de 24 V con nivel de sentido debe garantizarse
que entre la señal de sentido B* y la señal de contaje A* se observe un intervalo de como
mínimo 5 µs/50 µs, según el filtro de entrada parametrizado.
La figura siguiente muestra el intervalo de tiempo entre la señal de sentido y la señal de
contaje.
6H³DO$

6H³DO%FRPR
QLYHOGHVHQWLGR
7LHPSR
wVwVHQIXQFLµQ
GHOWLHPSRGHILOWUDGR

● Encóder rotativo
Si conecta un encóder rotativo de 24 V con dos pistas desfasadas 90 grados en la entrada
de contaje y sentido, es posible parametrizar una evaluación simple (Página 221) en todos
los modos de medición.
En la entrada de sentido B* es posible invertir elsentido de contaje (Página 373).
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/
simétrica o salida tipo NPN).
Nota
Si con el 1Count24V ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas
del encóder", es preciso utilizar también encóders con salida tipo NPN.
Nota
La indicación 100 kHz en la frecuencia de contaje se refiere a la frecuencia máxima de las
señales A* o B*.

Evaluación "Impulso y sentido"
Impulso y sentido
En este modo de valuación se utiliza como indicador de sentido el nivel en la entrada de sentido
B*.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

367

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Una entrada no cableada equivale al sentido de contaje "ascendente", si en el parámetro
Evaluación de señal ha elegido "Impulso y sentido".
La figura siguiente muestra las señales de un encóder incremental de posición de 24 V con
nivel de sentido.
6H³DO$
6H³DO%FRPR
QLYHOGHVHQWLGR

DVFHQGHQWH

GHVFHQGHQWH

,PSXOVRVGHFRQWDMH
DVFHQGHQWH
,PSXOVRVGHFRQWDMH
GHVFHQGHQWH

Método de medición
Resumen
Método de medición
En el parámetro "Método de medición" es posible elegir entre los siguientes métodos:
● con tiempo de integración (Página 368)
● continuo (Página 369)

Medición con tiempo de integración
Desarrollo de la medición con tiempo de integración
La medición se lleva a cabo durante el tiempo de integración parametrizado. Al transcurrir el
tiempo de integración se actualiza el valor medido.
El final de una medición se indica con el bit de estado (Página 381)STS_CMP1. Este bit se
desactiva con el bit de control (Página 379)RES_STS en la interfaz de control.
Si no se han producido al menos dos flancos ascendentes dentro del tiempo de integración
parametrizado, se devuelve 0 como valor medido.
Se devuelve el valor -1 s hasta finalizar el primer tiempo de integración.
El tiempo de integración para la siguiente medición se puede cambiar durante el
funcionamiento.

Inversión del sentido de giro
Si el sentido de rotación se invierte durante un tiempo de integración, el valor medido para este
período es incierto. Al evaluar los bits de realimentación (Página 381)STS_C_UP y STS_C_DN
(evaluación de sentido), se puede responder a una posible irregularidad del proceso.

368

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Consulte también
Tiempo de integración y tiempo de actualización en el modo isócrono (Página 372)

Medición continua
Principio de medición
El módulo 1Count24V cuenta todos los flancos ascendentes de un impulso y les asigna un
valor de tiempo en µs.
El tiempo de actualización indica en qué espacio de tiempo se actualiza el valor medido del
módulo en la interfaz de realimentación.
En una secuencia de impulsos con uno o varios impulsos por tiempo de actualización rige lo
siguiente:
Tiempo de medición diná‐ valor de tiempo del último impulso en el intervalo actual del tiempo
de actualización
mico =
menos
valor de tiempo del último impulso en el intervalo anterior del tiem‐
po de actualización
Una vez transcurrido el tiempo de actualización, se calcula y aplica un nuevo valor medido con
el tiempo de medición dinámico.
Si el tiempo de actualización actual no contiene ningún impulso, el tiempo de medición
dinámico resultante es el siguiente:
Tiempo de medición diná‐ valor de tiempo del tiempo de actualización actual transcurrido
mico =
menos
el valor de tiempo del último impulso
Una vez transcurrido un tiempo de actualización, se calcula un valor medido aproximado con
el tiempo de medición dinámico suponiendo que haya aparecido un impulso al final del tiempo
de actualización.
Si en la medición de frecuencia y de velocidad el valor medido aproximado "1 impulso por
tiempo de medición dinámico" es menor que el último valor medido, este valor medido
aproximado se emite como nuevo valor medido. En la medición del período, el tiempo de
medición dinámico se emite como duración aproximada del período cuando el tiempo de
medición dinámico es mayor que la última duración medida del período.
La figura muestra el principio de medición.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

369

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHPHGLFLµQ
GLQ£PLFR

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHPHGLFLµQ
GLQ£PLFR

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGH
PHGLFLµQ
GLQ£PLFR
7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHPHGLFLµQ
GLQ£PLFR
7LHPSRGHPHGLFLµQ
GLQ£PLFR
7LHPSRGHPHGLFLµQ
GLQ£PLFR

El 1Count24V mide de forma continua. Durante la parametrización se introduce un tiempo de
actualización.
El valor "–1" se devuelve antes de finalizar el primer tiempo de actualización transcurrido.
La medición continua empieza tras abrir la puerta con el primer impulso de la secuencia de
impulsos que debe medirse. El primer valor medido no puede calcularse hasta después del
segundo impulso.
Cada vez que transcurre el tiempo de actualización, en la interfaz de realimentación se emite
un valor medido (frecuencia, duración del período o velocidad). El final de una medición se
indica con el bit de estado (Página 381)STS_CMP1. Este bit se desactiva con los bits
RES_STS y RES_STS_A según el principio de realimentación completo.
Si el sentido de rotación se invierte durante un tiempo de actualización, el valor medido para
este período es incierto. Evaluando los bits de realimentación (Página 381)STS_C_DN y
STS_C_UP (evaluación del sentido) se puede reaccionar a posibles irregularidades del
proceso.
La figura siguiente explica el principio de la medición continua con el ejemplo de una medición
de frecuencia.

370

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
3XHUWD
6HFXHQFLDGH
LPSXOVRV
9DORU
PHGLGR










7LHPSRGHDFWXDOL]DFLµQ

Control de puerta
Para controlar el módulo 1Count24V se han de usar las funciones de puerta.

Modo isócrono
En el modo isócrono, el 1Count24V acepta en cada ciclo de bus bits de control y valores de
control de la interfaz de control y notifica la respuesta durante el mismo ciclo.
El 1Count24V transfiere en cada ciclo un valor medido y los bits de estado tal y como eran
válidos en el instante Ti.
La medición empieza y acaba en cada caso en el instante Ti.

Consulte también
Tiempo de integración y tiempo de actualización en el modo isócrono (Página 372)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

371

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Tiempo de integración y tiempo de actualización en el modo isócrono
Tiempo de integración y tiempo de actualización en el modo isócrono
Si el tiempo de integración/actualización dura varios ciclos TDP, es posible reconocer el nuevo
valor medido en el programa de usuario por el bit de estado (Página 381)STS_CMP1 (medición
finalizada) de la interfaz de realimentación. Esto permite una vigilancia del proceso de
medición o una sincronización con el proceso de medición. Sin embargo, el acuse de este
aviso dura 4 ciclos TDP. En este caso el tiempo de integración/actualización mínimo será de (4
x TDP).
Si la aplicación puede tolerar un jitter del tiempo de integración/actualización de un TDP y un
valor medido constante durante varios ciclos, no es necesario evaluar constantemente el bit de
estado STS_CMP1. Entonces serán posibles tiempos de integración/actualización de (1 x TDP)
a (3 x TDP).
Debido a una pérdida del sincronismo en el último ciclo TDP del tiempo de integración se
prolonga el tiempo de integración/actualización otro ciclo TDP. El valor medido no se ve
falsificado por ello.
Nota
No deben excederse los límites del rango del tiempo de integración/actualización (consulte las
tablas de cada uno de los modos de medición).
Una violación de los límites del rango de valores provoca un error de parametrización, con lo
cual el 1Count24V no cambia al modo isócrono.
Nota
Al cambiar la configuración del modo no isócrono al modo isócrono y viceversa, siempre
deberá adaptarse el parámetro Tiempo de integración/actualización si se desea mantener la
duración del tiempo de integración/actualización.

Seleccionar filtro para señales de entrada
Filtro de entrada
Para filtrar las señales en la entrada de contaje A*, la entrada de sentido B* y la entrada digital
DI, se puede activar un filtro en función de la duración mínima del impulso o bien de la
frecuencia máxima de señales.
Para cada entrada puede seleccionarse un ancho de impulso mínimo de 2,5 µs o 25 µs.

372

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar entradas del encóder
Entradas del encóder
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/simétrica
o salida tipo NPN).
Nota
Si se ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas del encóder", es
preciso utilizar también encóders con salida tipo NPN.

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

Comportamiento de la salida en los modos de medición
Seleccionar comportamiento de la salida DO1
Comportamiento de la salida en los modos de medición
La salida digital del 1Count24V es parametrizable.
Para la medición de frecuencia, velocidad o período se puede indicar un límite superior y un
límite inferior, respectivamente, que al ser excedido active la salida digital DO1. Estos valores
límite son parametrizables y pueden ser modificados con la función de carga.
La función y el comportamiento de la salida digital se puede modificar durante el
funcionamiento. La nueva función actúa de inmediato, en el modo isócrono siempre en el
instante Ti.
En la lista desplegable se pueden seleccionar las siguientes funciones:
● Salida (Página 374)
● Fuera de los valores límite (Página 374) (vigilancia de valor límite)
● Rebase por defecto del valor límite inferior (Página 374) (vigilancia de valor límite)
● Rebase por exceso del valor límite superior (Página 374) (vigilancia de valor límite)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

373

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Salida
Salida
Para conectar o desconectar la salida, es necesario habilitarla con el bit de control
(Página 379)CTRL_DO1.
Con el bit de control (Página 379)SET_DO1 se conecta y desconecta la salida.
Con el bit de estado (Página 381)STS_DO1 de la interfaz de realimentación se puede consultar
el estado de la salida.
En el modo isócrono la salida conmuta en el instante To.

Vigilancia de valores límite
Vigilancia de valor límite
La figura siguiente muestra el principio de la vigilancia de valor límite.

2)/:

8)/:

,QLFLRGH
SXHUWD

/¯PLWH
LQIHULRU

/¯PLWH
VXSHULRU

9DORUPHGLGR

Una vez transcurrido el tiempo de integración, el valor medido (frecuencia, velocidad o
período) se compara con los valores límite parametrizados.
Si el valor medido actual está por debajo del valor límite inferior parametrizado (valor medido
< valor límite inferior), el bit STS_UFLW = 1 se activa en la interfaz de notificación (Página 381).
Si el valor medido actual está por encima del valor límite superior parametrizado (valor medido
< valor límite superior), el bit STS_OFLW = 1 se activa en la interfaz de realimentación
(Página 381).
Estos bits tienen que ser acusados con el bit de control (Página 379)RES_STS.
Si el valor medido sigue fuera de los valores límite o vuelve a estarlo después del
realimentación, se vuelve a activar el correspondiente bit de estado.
Poniendo el límite inferior a 0, se desconecta la vigilancia dinámica de desbordamiento por
defecto del valor límite inferior.

374

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
La tabla siguiente muestra que, dependiendo de la parametrización, la salida digital DO1
habilitada se puede activar con la vigilancia de valor límite:
Parámetro "Función de DO1"

DO1 se activa cuando ...

Fuera de los valores límite

Valor medido < valor límite inferior
O
Valor medido > valor límite superior

Rebase por defecto del valor límite inferior

Valor medido < valor límite inferior

Rebase por exceso del valor límite superior

Valor medido > valor límite superior

En el modo isócrono la salida conmuta al terminar la medición en el instante Ti.

Seleccionar valor sustitutivo DO1
Valor sustitutivo DO1
Si se ha seleccionado el parámetro de conmutar valor sustitutivo DO1 en "Comportamiento en
STOP de la CPU/del maestro (Página 365)", seleccione aquí el valor sustitutivo que debe
enviarse a la salida digital DO1.

Activar diagnóstico DO1
Diagnóstico DO1
El "diagnóstico DO1" (rotura de hilo, cortocircuito) sólo es posible con anchos de impulso > 90
ms en la salida digital DO1.
Active la casilla de verificación para el diagnóstico de la salida DO1.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

375

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar modo de medición
Descripción
Al preseleccionar un modo de medición se elige la funcionalidad con la que se utilizará el
1Count24V.
Descripción
Modo de operación

Medición con tiempo de integración Medición continua

Medición de la frecuencia
(Página 205)
(con puerta HW o SW)

El 1Count24V cuenta los impulsos El 1Count24V cuenta los impulsos
que llegan en un tiempo de integra‐ que llegan en un tiempo de medi‐
ción predefinido.
ción dinámico.

Medición de la velocidad
(Página 206)
(con puerta HW o SW)

El 1Count24V cuenta los impulsos
que llegan de un encóder de velo‐
cidad en un tiempo de integración
predefinido y calcula a partir de ello
la velocidad con los impulsos por
vuelta del encóder.

El 1Count24V cuenta los impulsos
que llegan de un encóder de velo‐
cidad en un tiempo de medición di‐
námico y calcula a partir de ello la
velocidad con los impulsos por
vuelta del encóder.

Medición del período (Pági‐ El 1Count24V mide el tiempo entre
dos flancos ascendentes de la se‐
na 208)
ñal de contaje contando los impul‐
(con puerta HW o SW)
sos de una frecuencia interna de
referencia (16 MHz) de precisión
de cuarzo dentro del tiempo de in‐
tegración dado.

El 1Count24V indica el tiempo de
medición dinámico como duración
del período. Si el período es inferior
al tiempo de actualización, se crea
un valor medio para el período.

El ajuste predeterminado es el modo de operación "Medición de frecuencia".

Seleccionar la resolución del período
Descripción
El valor del período medido se indica en 1 μs o 1/16 μs.
Seleccione la unidad deseada para la resolución.

376

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Rangos de medición posibles con información de errores
● Medición del período con tiempo de integración
– Rangos de medición y errores a una resolución de 1 µs:
Tiempo de integra‐
ción

Tmín ± error absoluto

Tmín ± error absoluto

100 s

1 µs* (10 ± 0)

1 µs* (100.000.000 ± 10.000)

10 s

1 µs* (10 ± 0)

1 µs* (10.000.000 ± 1.000)

1s

1 µs* (10 ± 0)

1 µs* (1.000.000 ± 100)

0,1 s

1 µs* (10 ± 0)

1 µs* (100.000 ± 10)

0,01 s

1 µs* (10 ± 0)

1 µs* (10.000 ± 1)

– Rangos de medición y errores en una resolución de 1/16 µs:
Tiempo de integra‐
ción

Tmín ± error absoluto

Tmín ± error absoluto

100 s

1/16 µs* (160 ± 0)

1/16 µs* (1.600.000.000 ± 160.000)

10 s

1/16 µs* (160 ± 0)

1/16 µs* (160.000.000 ± 16.000)

1s

1/16 µs* (160 ± 0)

1/16 µs* (16.000.000 ± 1.600)

0,1 s

1/16 µs* (160 ± 0)

1/16 µs* (1.600.000 ± 160)

0,01 s

1/16 µs* (160 ± 0)

1/16 µs* (160.000 ± 16)

● Medición continua del período:
– Rangos de medición y errores a una resolución de 1 µs:
Período Tmín ± error absoluto

Período Tmín ± error absoluto

1 μs* (10 ± 0)

1 μs* (100 000 ± 10)

1 μs* (100 ± 0)

1 μs* (1 000 000 ± 100)

1 μs* (1 000 ± 0)

1 μs* (10 000 000 ± 1 002)

1 μs* (10 000 ± 1)

1 μs* (100 000 000 ± 10 020)

– Rangos de medición y errores en una resolución de 1/16 µs:
Período Tmín ± error absoluto

Período Tmín ± error absoluto

1/16 μs* (160 ± 1)

1/16 μs* (1 600 000 ± 160)

1/16 μs* (1 600 ± 1)

1/16 μs* (16 000 000 ± 1 600)

1/16 μs* (16 000 ± 3)

1/16 μs* (160 000 000 ± 16 000)

1/16 μs* (160 000 ± 20)

1/16 μs* (1 600 000 000 ± 160 000)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

377

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital.
El ajuste predeterminado es "Entrada".

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 381)STS_DI indica el nivel de la entrada digital.

Definir valor límite inferior y superior
Valores límite inferior y superior
Para la medición de frecuencia, velocidad o período se puede indicar un límite superior y un
límite inferior, respectivamente, que al ser excedido active la salida digital DO1 (Página 373).
Estos valores límite se pueden parametrizar y modificar a través de la función de carga.
Los siguientes rangos de valores están permitidos para los valores límite inferior y superior:
Modo de medición

Valor límite inferior (LI):

Valor límite superior

Medición de frecuencia

0 a 99.999.999 × 10 Hz

LI+1 a 100.000.000 × 10-3 Hz

Medición de velocidad

0 a 24.999.999 × 10-3 /min

LI+1 a 25.000.000 × 10-3/min

Medición del período (resolución 1 µs)

0 a 119.999.999 μs

LI+1 a 120.000.000 μs

Medición del período (resolución 1/16
µs)

0 a 1 919 999 999 × 1/16 μs

LI+1 a 1 920 000 000 × 1/16 μs

-3

Definir el tiempo de medición
Descripción
Si se ha seleccionado un modo de medición, el módulo actualiza los valores medidos de forma
cíclica. El tiempo de actualización/integración es el producto del tiempo de medición x 10 ms.
El tiempo de medición se predefine como factor n.

378

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Si desea obtener una descripción detallada sobre el rango de valores para el tiempo de
medición, consulte el apartado "Conceptos básicos sobre la operación de medición
(Página 200)".

Introducir impulsos por vuelta del encóder
Impulsos por vuelta del encóder
Para el modo Medición de velocidad (Página 206) es preciso parametrizar adicionalmente los
impulsos por vuelta del encóder.
El valor para el número de impulsos por vuelta del encóder se encuentra en la placa de
características o en los datos técnicos del encóder.

Interfaz de notificación y control para los modos de medición
Interfaz de control de los modos de medición
Nota
Para el 1Count24V, los datos siguientes de la interfaz de control son datos relacionados o, lo
que es lo mismo, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de control
La siguiente tabla muestra la asignación de la interfaz de control (salidas) del 1Count24V para
los modos de medición.
Dirección

Asignación

Bytes 0 a 3

Valor límite inferior o superior
Función de DO1
Byte 0

Bytes 1 a 3

Bit 1

Bit 0

Función DO1

0

0

Salida

0

1

Fuera de los valores límite

1

0

Rebase por defecto del valor límite inferior

1

1

Rebase por exceso del valor límite superior

reservado = 0

Tiempo de integración
Byte 0, 1

Tiempo de integración [n × 10 ms]
(Rango de valores 1 … 1.000 / 12.000)

Byte 2, 3

reservado = 0

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

379

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación
Denominación

Byte 4

Byte 5

Bytes 6 a 7
1)

Bit 7

Acuse del error

EXTF_ACK

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

Habilitación de DO1

CTRL_DO1

Bit 3

Bit de control DO1

SET_DO1

Bit 2

Inicio de la desactivación del bit de estado

RES_STS

Bit 1

reservado = 0

Bit 0

Bit de control puerta SW

SW_GATE

Bit 7

reservado = 0

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

Modificar la función de DO1

Bit 3

reservado = 0

Bit 2

Modificar el tiempo de integración

C_INTTIME

Bit 1

Cargar valor límite superior

LOAD_PREPARE

Bit 0

Cargar valor límite inferior

LOAD_VAL

C_DOPARAM

reservado = 0 1)

Falta en la interfaz de datos de usuario avanzada

Significado de los bits de control
Bit

Significado

C_DOPARAM

Modificar la función de DO1
El valor del byte 0 es aceptado como nueva función de DO1.

C_INTTIME

Modificar el tiempo de integración
El valor de los bytes 0 y 1 es aceptado como nuevo tiempo de integración para la siguiente medición.

CTRL_DO1

Habilitación de DO1
Este bit habilita la salida DO1

EXTF_ACK

Acuse del error

LOAD_PREPARE

Cargar valor límite superior

LOAD_VAL

Cargar valor límite inferior

Los bits de error deben ser acusados mediante el bit de control EXTF_ACK una vez eliminada la causa.
El valor de los bytes 0 a 3 es aceptado como nuevo límite superior.
El valor de los bytes 0 a 3 es aceptado como nuevo valor límite inferior.
RES_STS

Inicio de la desactivación del bit de estado
Los bits de estado se desactivan mediante el proceso de realimentación entre el bit RES_STS y el bit
RES_STS_A.

SET_DO1

Bit de control DO1

SW_GATE

Bit de control puerta SW

Conectar y desconectar la salida digital DO1 cuando se ha activado CRTL_DO1.
La puerta SW se abre/cierra mediante la interfaz de control con el bit SW_GATE.

380

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de realimentación de los modos de medición
Nota
Para el 1Count24V, los datos siguientes de la interfaz de realimentación son datos
relacionados, es decir, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de realimentación
La siguiente tabla muestra la asignación de la interfaz de realimentación (entradas) del
1Count24V para los modos de medición.
Dirección

Asignación

Bytes 0 a 3

Valor medido

Byte 4

Bit 7

Cortocircuito en la alimentación del encóder

ERR_24V

Bit 6

Cortocircuito / rotura de hilo / sobretemperatura

ERR_DO1

Bit 5

Error de parametrización

ERR_PARA

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

Desactivación de los bits de estado en curso

RES_STS_A

Bit 1

Error en función de carga

ERR_LOAD

Bit 0

Función de carga en curso

STS_LOAD

Byte 5

Byte 6

Bit 7

Estado de sentido descendente

STS_C_DN

Bit 6

Estado de sentido ascendente

STS_C_UP

Bit 5

reservado = 0

Bit 4

reservado = 0

Bit 3

Estado de DO1

Bit 2

reservado = 0

Bit 1

Estado de DI

STS_DI

Bit 0

Estado de la puerta interna

STS_GATE

Bit 7

reservado = 0

Bit 6

Valor límite inferior del rango de medida

STS_UFLW

Bit 5

Valor límite superior del rango de medida

STS_OFLW

Bit 4

reservado = 0

Bit 3

Fin de la medición

Bit 2

reservado = 0

Bit 1

reservado = 0

Bit 0

reservado = 0

Byte 7

reservado = 0

Bytes 8 a 11

Valor de contaje 1)

1)

Denominación

STS_DO1

STS_CMP1

Interfaz de datos de usuario avanzada

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

381

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Nota sobre los bits de realimentación
Bit

Significado

ERR_24V

Cortocircuito en la alimentación del encóder
El bit de error tiene que ser acusado con el bit de control (Página 379)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_DO1

Cortocircuito/rotura de hilo/sobretemperatura en la salida DO1
El bit de error tiene que ser acusado con el bit de control (Página 379)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_LOAD

Error en función de carga
Los bits de control (Página 379)LOAD_VAL, LOAD_PREPARE, C_DOPARAM y C_INTTIME no pue‐
den estar activados al mismo tiempo durante la transferencia. Esto tiene como consecuencia la acti‐
vación del bit de estado ERR_LOAD, similar a cargar un valor incorrecto (que no se acepta).

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

RES_STS_A

Desactivación de los bits de estado en curso

STS_C_DN

Estado de sentido descendente

STS_C_UP

Estado de sentido ascendente

STS_CMP1

Fin de la medición
El valor medido es actualizado cada vez que termina un intervalo (tiempo de actualización/integración).
Medición con tiempo de integración:
El fin de una medición (al terminar el intervalo) es indicado con el bit de estado STS_CMP1.
Medición continua:
Al finalizar el tiempo de actualización, el fin de la medición se indica con el bit de estado STS_CMP1,
siempre que se emita un valor medido. Si se emite un valor medido aproximado, el bit se mantiene en
"0".
Este bit se desactiva con el bit de control (Página 379)RES_STS en la interfaz de control.

STS_DI

Estado de DI
El estado de la DI se indica en todos los modos de operación con el bit STS_DI en la interfaz de
realimentación.

STS_DO1

Estado de DO1

STS_GATE

Estado de la puerta interna: Se mide.

STS_LOAD

Función de carga en curso

STS_OFLW

Valor límite superior rebasado

STS_UFLW

Valor límite inferior no alcanzado
Ambos bits deben ser desactivados.

Parámetros para la lectura del recorrido
Activar diagnóstico colectivo
Diagnóstico colectivo
Si activa el diagnóstico colectivo en su parametrización, se realiza un diagnóstico relativo al
canal.

382

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar la reacción en caso de STOP de la CPU/del maestro
Ajuste de la reacción en caso de STOP de la CPU/del maestro
Es posible parametrizar el comportamiento del 1Count24V en caso de fallo del controlador
principal.
Parámetro

Estado del 1Count24V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

Desconectar DO 1

El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
tienen efecto inmediato.
se cierra y la salida digital se bloquea.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El valor límite superior e inferior, la función
y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.

Continuar modo de
operación1)

El modo de operación actual continúa. La puerta y la
salida digital conservan sus estados.

1)

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count24V.

Abandonar el estado parametrizado
¿En qué condiciones abandona el 1Count24V el estado parametrizado?
La CPU o el maestro debe estar en modo RUN y la interfaz de control (Página 391) debe
modificarse.

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/del maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count24V
● POWER ON o inserción del módulo de potencia correspondiente

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

383

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interpretación de la señal
Seleccionar evaluación de contaje y sentido
Evaluación de señal A*, B*
La evaluación de la señal mediante A*, B* permite contar direccionalmente. Son posibles
diferentes modos de evaluación dependiendo de lo que se parametrice:
● Impulso y sentido (Página 385)
En los encóders incrementales de posición de 24 V con nivel de sentido debe garantizarse
que entre la señal de sentido B* y la señal de contaje A* se observe un intervalo de como
mínimo 5 µs/50 µs, según el filtro de entrada parametrizado.
La figura siguiente muestra el intervalo de tiempo entre la señal de sentido y la señal de
contaje.
6H³DO$

6H³DO%FRPR
QLYHOGHVHQWLGR
7LHPSR
wVwVHQIXQFLµQ
GHOWLHPSRGHILOWUDGR

● Encóder rotativo (Página 220)
Si conecta un encóder rotativo de 24 V con dos pistas desfasadas 90 grados en la entrada
de contaje y sentido, es posible parametrizar una evaluación simple (Página 221) en todos
los modos de contaje. Además se puede parametrizar una evaluación doble (Página 221)
o cuádruple (Página 221).
En todos los modos de evaluación se puede invertir el sentido de contaje (Página 386) en
la entrada de sentido B*.
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/
simétrica o salida tipo NPN).
Nota
Si con el 1Count24V ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas
del encóder", es preciso utilizar también encóders con salida tipo NPN.
Nota
La indicación 100 kHz en la frecuencia de contaje se refiere a la frecuencia máxima de las
señales A* o B*. Así, en la evaluación doble se obtienen como máximo 200 kHz en los
impulsos de contaje o máximo 400 kHz en la evaluación cuádruple.

384

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Evaluación "Impulso y sentido"
Impulso y sentido
En este modo de valuación se utiliza como indicador de sentido el nivel en la entrada de sentido
B*.
Una entrada no cableada equivale al sentido de contaje "ascendente", si en el parámetro
Evaluación de señal ha elegido "Impulso y sentido".
La figura siguiente muestra las señales de un encóder incremental de posición de 24 V con
nivel de sentido.
6H³DO$
6H³DO%FRPR
QLYHOGHVHQWLGR

DVFHQGHQWH

GHVFHQGHQWH

,PSXOVRVGHFRQWDMH
DVFHQGHQWH
,PSXOVRVGHFRQWDMH
GHVFHQGHQWH

Seleccionar filtro para señales de entrada
Filtro de entrada
Para filtrar las señales en la entrada de contaje A*, la entrada de sentido B* y la entrada digital
DI, se puede activar un filtro en función de la duración mínima del impulso o bien de la
frecuencia máxima de señales.
Para cada entrada puede seleccionarse un ancho de impulso mínimo de 2,5 µs o 25 µs.

Seleccionar entradas del encóder
Entradas del encóder
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/simétrica
o salida tipo NPN).
Nota
Si se ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas del encóder", es
preciso utilizar también encóders con salida tipo NPN.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

385

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Función DI
Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital.
● Congelar/redisparar con flanco ascendente (Página 387)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador. Después de la operación de guardado, el contador se establece al valor de carga.
● Sincronización con flanco ascendente (Página 388)
Los flancos ascendentes de la entrada digital permiten establecer el contador al valor de
carga.
● Congelar con flanco ascendente (Página 389)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador.
El ajuste predeterminado es "Entrada".

386

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Congelar/redisparar con flanco ascendente
Congelar/redisparar
Con esta función se almacena el estado actual interno del contador del 1Count24V y se
redispara el contaje cuando hay un flanco ascendente en la entrada digital. Esto significa que
se almacena el estado actual interno del contador en el momento del flanco ascendente (valor
de congelación) y, entonces, se carga nuevamente el módulo 1Count24V con el valor de carga
y se sigue contando desde allí.
La siguiente figura muestra la función de congelar/redisparar con el valor de carga = 0.

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU

9DORUGH
FRQJHODFLµQ

Para poder ejecutar la función, el modo de contaje tiene que estar habilitado con la puerta SW.
Se inicia con el primer flanco positivo de la entrada digital.
En la interfaz de realimentación (Página 392) se indica el estado almacenado del contador en
vez del estado actual del contador. El bit STS_DI indica el estado de la señal de congelación
y redisparo.
El valor de congelación se pone por defecto al estado de RESET ("0"). No cambia cuando se
abre la puerta SW.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.
Si se cierra la puerta SW, sólo se interrumpe el contaje; es decir, cuando se vuelve a abrir la
puerta SW, continúa el contaje. La entrada digital DI permanece activa incluso cuando la
puerta SW está cerrada.
También en el modo isócrono se congela y redispara el contaje con cada flanco de la entrada
digital. En la interfaz de realimentación se muestra el estado del contador válido en el instante
del último flanco antes de Ti.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

387

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de realimentación ampliada
Si el módulo 1Count24V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces de datos de usuario más anchas, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de realimentación (Página 392).

Sincronización con flanco ascendente
Sincronización
Si se ha parametrizado "Sincronización con flanco ascendente", el flanco ascendente de una
señal de referencia en la entrada sirve para poner el 1Count24V al valor de carga.
Se puede seleccionar entre la sincronización única y la periódica (parámetro "Sincronización").
La figura siguiente muestra los estados del contador con una sincronización única y periódica.
,PSXOVRVLQWHUQRVGHFRQWDMH
DVFHQGHQWHVRGHVFHQGHQWHV

(QWUDGHGLJLWDO
PDUFDFHUR

6LQFURQL]DFLµQ
¼QLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH

9DORUGHFDUJD

6LQFURQL]DFLµQ
SHULµGLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH
9DORUGHFDUJD

388

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Se aplican las siguientes condiciones:
● El modo de contaje tiene que haber sido iniciado mediante la puerta SW.
● El bit de control (Página 391) "Habilitación de la sincronización" (CTRL_SYN) debe estar
activado.
● Sincronización única: si el bit de habilitación está activado, el primer flanco carga el
1Count24V con el valor de carga.
● Sincronización periódica: si el bit de habilitación está activado, el primer flanco y cada
flanco subsiguiente cargan el 1Count24V con el valor de carga.
● Una vez realizada la sincronización correctamente, el bit de realimentación
(Página 392)STS_SYN queda activado. Debe desactivarse con el bit de control
(Página 391)RES_STS.
● Como señal de referencia se puede utilizar la señal de un interruptor libre de rebotes o la
marca cero de un encóder rotativo.
● El bit de realimentación (Página 392)STS_DI indica el nivel de la señal de referencia.
En el modo isócrono, el bit de realimentación (Página 392) activado STS_SYN indica que el
flanco ascendente de la entrada digital se encontraba entre el instante Ti del ciclo actual y el
instante Ti del ciclo pasado.

Congelar con flanco ascendente
Congelar
El estado del contador y el valor de congelación reciben sus estados de RESET ("0"):
La función de contaje se inicia cuando se abre la puerta SW. El 1Count24V comienza a contar
a partir del valor de carga ("0").
La siguiente figura muestra la función de congelar con valor de carga = 0.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

389

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU
9DORUGH
FRQJHODFLµQ

El valor de congelación equivale siempre al valor de contaje en el instante del flanco
ascendente de la entrada digital DI.
En la interfaz de realimentación (Página 392) se indica el estado almacenado del contador en
vez del estado actual del contador. El bit STS_DI indica el nivel de la señal de congelación.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.
En el modo isócrono, se muestra en la interfaz de realimentación el estado del contador que
se congeló en el instante del último flanco ascendente antes de Ti.
Si se cierra la puerta SW, actúa como parametrizada, de cancelación o de interrupción. La
entrada digital DI permanece activa incluso cuando la puerta SW está cerrada.

Interfaz de realimentación ampliada
Si el módulo 1Count24V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces más amplias de datos de usuario, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de realimentación (Página 392).

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 392)STS_DI indica el nivel de la entrada digital.

390

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar sincronización
Sincronización
Si se ha seleccionado "Sincronización con flanco ascendente" en "Función DI (Página 386)",
es posible elegir entre la sincronización única y la periódica.
● Una vez: si el bit de habilitación está activado, el primer flanco carga el 1Count24V con el
valor de carga.
● Periódica: si el bit de habilitación está activado, el primer flanco y cada flanco subsiguiente
cargan el 1Count24V con el valor de carga.

Interfaz de realimentación y control para la lectura del recorrido
Interfaz de control para la lectura del recorrido
Nota
Para el 1Count24V, los datos siguientes de la interfaz de control son datos relacionados o, lo
que es lo mismo, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de control
La siguiente tabla muestra la asignación de la interfaz de control (las salidas) del 1Count24V
para la lectura del recorrido.
Dirección

Asignación

Bytes 0 a 3

Valor de carga directo, preliminar

Byte 4

Bit 7

Acuse del error

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

Inicio de la desactivación del bit de estado

RES_STS

Bit 1

Habilitación de la sincronización

CTRL_SYN

Bit 0

Bit de control puerta SW

SW_GATE

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Denominación
EXTF_ACK

391

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación

Byte 5

Bit 7

reservado = 0

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

reservado = 0

Bit 1

Carga preliminar del contador

LOAD_PREPARE

Bit 0

Carga directa del contador

LOAD_VAL

Bytes 6 a 7
1)

Denominación

reservado = 0 1)

Falta en la interfaz de datos de usuario avanzada

Significado de los bits de control
Bit

Significado

CTRL_SYN

Este bit habilita la sincronización

EXTF_ACK

Acuse del error

LOAD_PREPARE

Carga preliminar del contador

LOAD_VAL

El valor de los bytes 0 a 3 se carga directamente como nuevo valor de contaje.

RES_STS

Inicio de la desactivación del bit de estado

Los bits de error deben ser acusados mediante el bit de control EXTF_ACK una vez eliminada la causa.
El valor de los bytes 0 a 3 se acepta como valor de carga

Los bits de estado se desactivan mediante el proceso de realimentación entre el bit RES_STS y el bit
RES_STS_A.
SW_GATE

La puerta SW se abre/cierra mediante la interfaz de control con el bit SW_GATE.

Interfaz de realimentación para la lectura del recorrido
Nota
Para el 1Count24V, los datos siguientes de la interfaz de realimentación son datos
relacionados, es decir, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

392

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación de la interfaz de realimentación
La siguiente tabla muestra la asignación de la interfaz de realimentación (entradas) del
1Count24V para la lectura del recorrido.
Dirección

Asignación

Bytes 0 a 3

Valor de contaje o valor de contaje almacenado con función de congelación en la
entrada digital

Byte 4

Bit 7

Cortocircuito en la alimentación del encóder

Bit 6

reservado = 0

Bit 5

Error de parametrización

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

Desactivación de los bits de estado en curso

RES_STS_A

Bit 1

Error en función de carga

ERR_LOAD

Bit 0

Función de carga en curso

STS_LOAD

Byte 5

Byte 6

ERR_24V
ERR_PARA

Bit 7

Estado de sentido descendente

STS_C_DN

Bit 6

Estado de sentido ascendente

STS_C_UP

Bit 5

reservado = 0

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

reservado = 0

Bit 1

Estado de DI

STS_DI

Bit 0

Estado de la puerta interna

STS_GATE

Bit 7

Paso por cero

STS_ND

Bit 6

Límite inferior de contaje

STS_UFLW

Bit 5

Límite superior de contaje

STS_OFLW

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

reservado = 0

Bit 1

reservado = 0

Bit 0

Estado de la sincronización

Byte 7

reservado = 0

Bytes 8 a 11

Valor de contaje 1)

1)

Denominación

STS_SYN

Interfaz de datos de usuario avanzada

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

393

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Nota sobre los bits de realimentación
Bit

Significado

ERR_24V

Cortocircuito en la alimentación del encóder
El bit de error tiene que ser acusado con el bit de control (Página 391)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_LOAD

Error en función de carga
Los bits de control (Página 391)LOAD_VAL y LOAD_PREPARE no pueden estar activados al mismo
tiempo durante la transferencia. Esto tiene como consecuencia la activación del bit de estado
ERR_LOAD, similar a cargar un valor incorrecto (que no se acepta).

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

RES_STS_A

Desactivación de los bits de estado en curso

STS_C_DN

Estado de sentido descendente

STS_C_UP

Estado de sentido ascendente

STS_DI

Estado de DI
El estado de la DI se indica en todos los modos de operación con el bit STS_DI en la interfaz de
realimentación.

STS_GATE

Estado de la puerta interna: Contaje en curso.

STS_LOAD

Función de carga en curso

STS_ND

Paso por cero en el rango de contaje sin sentido principal de contaje. El bit debe desactivarse con el bit
de control (Página 391)RES_STS.

STS_OFLW

Límite superior de contaje rebasado

STS_UFLW

Límite inferior de contaje rebasado
Ambos bits deben ser desactivados.

STS_SYN

Estado de la sincronización:
Al terminar la sincronización se activa el bit STS_SYN. Debe desactivarse con el bit de control (Pági‐
na 391)RES_STS.

394

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Parametrizar para el modo Fast
Seleccionar el comportamiento en caso de STOP de la CPU/del maestro
Ajuste del comportamiento en caso de STOP de la CPU/del maestro
Es posible parametrizar la reacción del 1Count24V en caso de fallo del controlador principal.
Parámetro

Estado del 1Count24V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

Desconectar DO 1

El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
se cierra y la salida digital se bloquea.
tienen efecto inmediato.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El valor límite superior e inferior, la función
y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.

Continuar modo de
operación1)

El modo de operación actual continúa. La puerta y la
salida digital conservan sus estados.

1)

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count24V.

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/del maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count24V
● POWER ON o inserción del módulo de potencia correspondiente

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

395

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Evaluación de la señal
Seleccionar evaluación de contaje y sentido
Evaluación de señal A*, B*
La evaluación de la señal mediante A*, B* permite contar direccionalmente. Son posibles
diferentes modos de evaluación dependiendo de lo que se parametrice:
● Impulso y sentido (Página 397)
En los encóders incrementales de posición de 24 V con nivel de sentido debe garantizarse
que entre la señal de sentido B* y la señal de contaje A* se observe un intervalo de como
mínimo 5 µs/50 µs, según el filtro de entrada parametrizado.
La figura siguiente muestra el intervalo de tiempo entre la señal de sentido y la señal de
contaje.
6H³DO$

6H³DO%FRPR
QLYHOGHVHQWLGR
7LHPSR
wVwVHQIXQFLµQ
GHOWLHPSRGHILOWUDGR

● Encóder rotativo (Página 220)
Si conecta un encóder rotativo de 24 V con dos pistas desfasadas 90 grados en la entrada
de contaje y sentido, es posible parametrizar una evaluación simple (Página 221) en todos
los modos de contaje. Además se puede parametrizar una evaluación doble (Página 221)
o cuádruple (Página 221).
En todos los modos de evaluación se puede invertir el sentido de contaje (Página 398) en
la entrada de sentido B*.
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/
simétrica o salida tipo NPN).
Nota
Si con el 1Count24V ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas
del encóder", es preciso utilizar también encóders con salida tipo NPN.
Nota
La indicación 100 kHz en la frecuencia de contaje se refiere a la frecuencia máxima de las
señales A* o B*. Así, en la evaluación doble se obtienen como máximo 200 kHz en los
impulsos de contaje o máximo 400 kHz en la evaluación cuádruple.

396

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Evaluación "Impulso y sentido"
Impulso y sentido
En este modo de valuación se utiliza como indicador de sentido el nivel en la entrada de sentido
B*.
Una entrada no cableada equivale al sentido de contaje "ascendente", si en el parámetro
Evaluación de señal ha elegido "Impulso y sentido".
La figura siguiente muestra las señales de un encóder incremental de posición de 24 V con
nivel de sentido.
6H³DO$
6H³DO%FRPR
QLYHOGHVHQWLGR

DVFHQGHQWH

GHVFHQGHQWH

,PSXOVRVGHFRQWDMH
DVFHQGHQWH
,PSXOVRVGHFRQWDMH
GHVFHQGHQWH

Seleccionar filtro para señales de entrada
Filtro de entrada
Para filtrar las señales en la entrada de contaje A*, la entrada de sentido B* y la entrada digital
DI, se puede activar un filtro en función de la duración mínima del impulso o bien de la
frecuencia máxima de señales.
Para cada entrada puede seleccionarse un ancho de impulso mínimo de 2,5 µs o 25 µs.

Seleccionar entradas del encóder
Entradas del encóder
En las entradas de encóder es posible conectar diferentes encóders (salida tipo PNP/simétrica
o salida tipo NPN).
Nota
Si se ha seleccionado el ajuste "Salida tipo NPN" en el parámetro "Entradas del encóder", es
preciso utilizar también encóders con salida tipo NPN.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

397

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Función DI
Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital
● Sincronización con flanco ascendente (Página 398)
Los flancos ascendentes de la entrada digital permiten establecer el contador al valor de
carga.
El ajuste predeterminado es "Entrada".

Sincronización con flanco ascendente
Sincronización
Si se ha parametrizado "Sincronización con flanco ascendente", el flanco ascendente de una
señal de referencia en la entrada sirve para poner el 1Count24V al valor de inicio (= valor de
carga).

398

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
La figura siguiente muestra los estados del contador con una sincronización con flanco
ascendente.
,PSXOVRVGHFRQWDMHLQWHUQRV
DVFRGHVF

(QWUDGDGLJLWDO
0DUFDFHUR

9DORUGHFRQWDMH
9DORULQLFLDO

Se aplican las siguientes condiciones:
● El modo de operación "Fast Mode" debe estar activo (puerta HW).
– Con la sincronización activada, el primer flanco y cualquier flanco posterior cargan el
1Count24V con el valor inicial (= valor de carga).
● Como señal de referencia puede utilizarse la señal de un interruptor sin rebotes o la marca
cero de un encóder rotativo.
● El bit de realimentación STS_DI indica el nivel de la señal de referencia.

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 400)STS_DI indica el nivel de la entrada digital.

Definir valor de carga
Valor de carga
Es posible asignar un valor de carga al 1Count24V.
Dicho valor de carga se aplica directamente como valor inicial.
Rango de valores admisible: -16.777.216 a +16.777.215

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

399

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de realimentación para el modo Fast
Nota
Para el 1Count24V, los datos siguientes de la interfaz de realimentación son datos
relacionados, es decir, coherentes:
● Bytes 0 … 3

Asignación de la interfaz de realimentación
La siguiente tabla muestra la asignación de la interfaz de realimentación (entradas) del
1Count24V para el modo Fast.
Dirección

Asignación

Bytes 0 a 3

Bit 31

Señal de vida

Denominación
LZ

Bit 30

Modo isócrono registrado

STS_TIC

Bit 29

Error de parametrización

ERR_PARA

Bit 28

Error de grupo

EXTF

Bit 27

Estado de DI

STS_DI

Bit 26

Estado de sentido ascendente / descendente

STS_DIR

Bit 25

Estado de la puerta interna

STS_GATE

Bits 0 a 24

Valor de contaje

Significado de los bits de realimentación
Bit

Significado

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

EXTF

Error de grupo
Causa posible:
● Cortocircuito, alimentación de encóders
EXTF se desactiva cuando se eliminan las causas del error.

LZ

La señal de vida se invierte en cada actualización de la interfaz de realimentación, es decir, que se invierte
el último valor enviado.

STS_DI

El bit muestra el estado de la entrada digital DI.

STS_DIR

Estado de sentido;
● cuando cambia el valor del encóder de posiciones elevadas a posiciones más bajas (incl. paso por
cero) → "1 "
● cuando cambia el valor del encóder de posiciones bajas a posiciones más elevadas (incl. paso por
cero) → "0 "

STS_GATE

Estado de la puerta interna: Contaje en curso.

STS_TIC

El modo isócrono (si está parametrizado) se ha registrado.

400

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación del 1Count24V
Diagnóstico con indicadores LED
Indicador LED del 1Count24V

6)

1

83



①
②
③

'1

2



3

Error de grupo (rojo)
Indicador de estado del sentido de contaje (verde)
Indicador de estado de entrada digital/salida digital (verde)

Indicadores de estado y error mediante los LEDs del 1Count24V
La tabla siguiente muestra los indicadores de estado y error del 1Count24V.
Evento (LED)
SF

UP

DN

4

Causa

Solución

8
Compruebe la parametrización.
No hay parametrización o el
módulo enchufado es incorrec‐ Evalúe el aviso de diagnóstico:
to. Hay un aviso de diagnósti‐
co.

ON

ON

Estado del bit menos significa‐
tivo del contador, si el contador
cuenta adelante.
ON

Estado del bit invertido menos
significativo del contador, si el
contador cuenta atrás.
ON

DO (control directo, salida del
comparador) activada.
ON

DI (puerta HW, sincronización,
latch) activada.

Tipos de error
En el manual de producto del módulo de interfaz utilizado en la estación ET 200S encontrará
información sobre la estructura del diagnóstico de canal.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

401

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Tipos de error del 1Count24V
La tabla siguiente muestra los tipos de error del 1Count24V.
Tipo de error

Significado

Solución

1D

00001:
cortocircuito

Cortocircuito de la alimentación del
encóder o actuador.

Compruebe el cableado del encó‐
der. Corregir el cableado del proce‐
so.

5D

00101:
Salida digital sobrecargada.
Sobretemperatura

Corregir el cableado del proceso.

6D

00110:
Rotura de hilo

Cable del actuador interrumpido.

Corregir el cableado del proceso.

9D

01001:
Error

Ha aparecido un error interno en el
módulo

Sustituir el módulo.

Tensión de carga insuficiente del
módulo de potencia.

Corregir el cableado del proceso.
Compruebe la tensión de carga.

Módulo no parametrizado.

Corregir la parametrización.

16D

1.2.1.6

10000:
Error de parame‐
trización

Utilizar ET 200S 1Count5V

Asignación de conectores del 1Count5V
Reglas de cableado
Los cables (terminales 1 a 8 y terminales 15 y 16) deben estar apantallados. La pantalla tiene
que hacer contacto por ambos extremos. Para ello se debe usar el elemento de contacto
(véase el anexo de las instrucciones de servicio Sistema de periferia descentralizada ET 200S
(http://support.automation.siemens.com/WW/view/es/1144348)).

402

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación de terminales del 1Count5V
La tabla siguiente muestra la asignación de conectores para el 1Count5V.
Vista

Asignación de terminales

Observaciones
A, /A: pista A
B, /B: pista B

&RXQW
9
6)

70(6\
&RXQW9

N, /N: pista N
24 V: tensión de carga
DC24V: alimentación del encó‐
der
M: tierra
DI: entrada digital
DO1: salida digital

(QFµGHULQFUHPHQWDO
GH9

83

'1


6<1

DO2: salida digital




(6'($%

 $ $ 




  '2 '2

 9 0 





  0 0

 % % 





  '&9 '&9

 1 1 





  ',

Configurar y parametrizar 1Count5V
En servicio
Seleccionar modo de operación
Modo de operación
Al preseleccionar un modo de operación se elige la funcionalidad con la que se utilizará el
1Count5V.
Modo de operación

Descripción

Contaje (Pági‐
na 404)

Preselección para los modos de contaje

Medición (Pági‐
na 428)

Preselección para los modos de medición

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

403

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Modo de operación

Descripción

Lectura del recorrido
(Página 444)

El 1Count5V cuenta sin fin en este modo de operación a partir del valor de carga:
● Cuando el 1Count5V alcanza el límite superior de contaje en la cuenta
ascendente, y entonces aparece otro impulso de contaje, salta hasta el límite
inferior de contaje y continúa contando desde ese valor sin perder impulsos.
● Cuando el 1Count5V alcanza el límite inferior de contaje en la cuenta
descendente, y entonces aparece otro impulso, salta hasta el límite superior
de contaje y continúa contando desde ese valor sin perder impulsos.

Modo Fast (Pági‐
na 457)
(a partir de la versión
de firmware 2.0)

El 1Count5V cuenta sin fin en este modo de operación a partir del valor de inicio:
● Cuando el 1Count5V alcanza el valor máximo representable con 25 bits
(todos los bits activados) al contar en sentido ascendente, al llegar un nuevo
impulso de contaje el valor de contaje salta a "0" y continúa contando desde
ahí sin que se pierda ningún impulso.
● Cuando el 1Count5V alcanza el valor "0" al contar en sentido descendente,
al llegar un nuevo impulso de contaje el valor de contaje salta al valor
máximo representable con 25 bits (todos los bits activados) y continúa
contando desde éste sin que se pierda ningún impulso.
Este modo de operación es adecuado para la lectura del recorrido en ciclos
isócronos especialmente breves.

Parámetros para contaje
Activar diagnóstico colectivo
Diagnóstico colectivo
Si activa el diagnóstico colectivo en su parametrización, se realiza un diagnóstico relativo al
canal.

Seleccionar el comportamiento en caso de STOP de la CPU/del maestro
Ajuste del comportamiento en caso de STOP de la CPU/del maestro
Es posible parametrizar la reacción del 1Count5V en caso de fallo del controlador principal.
Parámetro

Estado del 1Count5V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

Desconectar DO

El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
tienen efecto inmediato.
se cierra y la salida digital se bloquea.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El valor límite superior e inferior, la función
y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.

Continuar modo de
operación1)

El modo de operación actual continúa. La puerta y la
salida digital conservan sus estados.

404

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Parámetro

Estado del 1Count5V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

DO Aplicar valor susti‐ El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
tutivo
se cierra y el valor sustitutivo parametrizado para la tienen efecto inmediato.
salida digital se aplica directamente.
Los valores de comparación 1 y 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
Si para la salida se parametriza "Impulso al alcanzar
el valor de comparación", sólo estará disponible el
valor sustitutivo = 1 para la duración del impulso.
DO Mantener el último El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
valor
se cierra y el estado de la salida digital se conserva. tienen efecto inmediato.
Los valores de comparación 1 y 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
1)

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count5V.

Abandonar el estado parametrizado
¿En qué condiciones abandona el 1Count5V el estado parametrizado?
La CPU o el maestro debe estar en modo RUN y la interfaz de control (Página 424) debe
modificarse.

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/del maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count5V
● POWER ON o inserción del módulo de potencia correspondiente

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

405

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar evaluación de señal
Evaluación de señal A, B
La evaluación de la señal mediante A, B permite contar direccionalmente. Son posibles
diferentes modos de evaluación dependiendo de lo que se parametrice:
● Encóder rotativo (Página 220)
El 1Count5V puede contar los flancos de las señales. Normalmente, sólo se evalúan los
flancos en A (evaluación simple). Para obtener una resolución más alta, en la
parametrización (parámetro "Evaluación de señal") se puede seleccionar si las señales
deben evaluarse de forma simple (Página 221), doble (Página 221) o cuádruple
(Página 221).
La evaluación múltiple sólo es posible con encóders incrementales asimétricos con señales
A y B desfasadas 90 grados.
Nota
La indicación 500 kHz en la frecuencia de contaje se refiere a la frecuencia máxima de las
señales A o B. Así, en la evaluación doble se obtienen como máximo 1 MHz en los impulsos
de contaje o máximo 2 MHz en la evaluación cuádruple.

Activar diagnóstico de los pares de señales
Vigilancia de los pares de señales
Los pares de señales A y /A, B y /B, N y /N pueden vigilarse.
Active para ello la casilla de verificación correspondiente.
Nota
El "Diagnóstico N, /N" no se puede activar hasta que se ha activado el "diagnóstico A, /A y B, /
B".

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

406

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Comportamiento de las salidas en los modos de contaje
Valores de comparación y salidas
Introducción
En el 1Count5V se pueden almacenar dos valores de comparación que estén asignados a las
salidas digitales. Dependiendo del estado del contador y de los valores de comparación se
pueden activar las salidas.

Salidas digitales
El 1Count5V dispone de dos salidas digitales.
Ambas salidas pueden parametrizarse (parámetros "Función DO1" y "Función DO2").
La función y el comportamiento de las salidas digitales se puede cambiar durante el
funcionamiento.

Controlar las salidas simultáneamente con los comparadores
Si se va a utilizar una función de comparación para las salidas, estas se pueden seguir
controlando con SET_DO1 o SET_DO2. De esta manera, se puede simular el efecto de la
comparación mediante el programa de control:
● Con el flanco ascendente de SET_DO1 o SET_DO2 se activa la salida.
Si se ha seleccionado la función "Impulso al alcanzarse el valor de comparación", se emitirá
un único impulso de la duración especificada. Si la duración del impulso = 0, la salida puede
activarse con SET_DO1 o SET_DO2, mientras el valor de contaje se encuentre en el valor
de comparación o la histéresis esté activa.
El bit de control SET_DO1 no está permitido en el caso de seleccionar el comportamiento
de salida "Conmutación en los valores de comparación".
● Un flanco descendente de SET_DO1 o SET_DO2 desactiva la salida de nuevo.
Obsérvese que los comparadores continúan activos y que pueden activar o desactivar la salida
si hay un cambio en el resultado de la comparación.
Nota
Una salida activada con SET_DO1 o SET_DO2 no se desactiva en el valor de comparación
(con el comparador).

Cargar los valores de comparación
Los valores de comparación se transfieren al 1Count5V. El contaje no se ve afectado por este
hecho.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

407

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Rango válido para los dos valores de comparación
Sentido principal de contaje:

Sentido principal de contaje:

Sentido principal de contaje:

Ninguno

Adelante

Atrás

Límite inferior de contaje
hasta
Límite superior de contaje

-2147483648
hasta
Límite superior de contaje -1

1
hasta
2147483647

Cambiar la función y el comportamiento de las salidas digitales
Las funciones y el comportamiento de las salidas se pueden cambiar durante el
funcionamiento mediante la interfaz de control (Página 424). Al hacerlo, el módulo 1Count5V
desactiva las salidas y aplica los valores de la siguiente manera:
● Función de las salidas digitales DO1 y DO2: Si se cambia la función de manera que se
cumpla la condición de comparación, la salida no cambiará hasta después del siguiente
impulso de contaje. No obstante, si la histéresis (Página 412) está activada, el módulo
1Count5V no cambia la salida.
● Histéresis: Una histéresis (Página 412) se mantiene activa incluso después de una
modificación. La próxima vez que se alcance el valor de comparación, se aplicará el nuevo
rango de la histéresis.
● Duración del impulso: La nueva duración del impulso (Página 415) tiene efecto con el
siguiente impulso.

Seleccionar el comportamiento de las salidas
Comportamiento de las salidas DO1 y DO2
En la lista desplegable, seleccione el comportamiento deseado de la salida correspondiente.
● Salida (Página 409)
● Conexión con estado del contador ≥ valor de comparación (Página 409)
● Conexión con estado del contador ≤ valor de comparación (Página 409)
● Impulso al alcanzar el valor de comparación (Página 410)
● Conmutar en los valores de comparación (Página 410)(sólo DO1)

Ajustar o modificar la función y el comportamiento de la salida digital DO1
Si quiere ajustar o cambiar el comportamiento de la DO1, asegúrese de que se consideran
todas las dependencias parametrizadas, pues de lo contrario puede producirse un error de
parametrización o un error de carga.

408

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Condiciones marginales:
Si se parametriza "Conmutar al alcanzar los valores de comparación" para la DO1 hay que
hacer lo siguiente:
● ajustar la histéresis = 0 y
● además parametrizar también la "Función DO2" como "Salida".

Salida
Salida
Los bits de control (Página 424)SET_DO1 y SET_DO2 permiten activar y desactivar las
salidas.
Para ello, es preciso que los bits de control (Página 424)CTRL_DO1 o CTRL_DO2 estén
activados.
Los bits de estado STS_DO1 y STS_DO2 de la interfaz de realimentación (Página 426)
permiten consultar el estado de las salidas.
Los bits de estado (Página 426)STS_CMP1 y STS_CMP2 indican que la salida
correspondiente está o estaba conectada. Estos bits de estado conservan su estado hasta ser
acusados. Si la salida permanece conectada, el correspondiente bit se vuelve a activar
inmediatamente. Estos bits de estado se activan también si los bits de control SET_DO1 o
SET_DO2 se accionan cuando las salidas DO1 o DO2 no están habilitadas.

Modo isócrono
En el modo isócrono las salidas DO1 y DO2 conmutan en el instante To.

Conexión si el estado del contador ≤ valor de comparación o estado del contador ≥ valor de comparación
Estado del contador ≤ valor de comparación y estado del contador ≥ valor de comparación
Cuando las condiciones de comparación se cumplen, el comparador correspondiente activa la
salida. El estado de la salida (Página 426) se indica con STS_DO1 y STS_DO2.
Para ello, es preciso que los bits de control (Página 424)CTRL_DO1 o CTRL_DO2 estén
activados.
El bit de estado (Página 426)STS_CMP1 o STS_CMP2 indica el resultado de la comparación.
Sólo podrá acusar y por tanto desactivar estos bits cuando dejen de cumplirse las condiciones
de comparación.

Modo isócrono
También en el modo isócrono las salidas DO1 y DO2 conmutan inmediatamente al cumplirse
la condición de comparación y, por consiguiente, no dependen del ciclo de bus.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

409

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Impulso al alcanzar el valor de comparación
Impulso al alcanzar el valor de comparación
Cuando el estado del comparador alcanza el valor de comparación, el comparador activa la
correspondiente salida digital durante el tiempo parametrizado para el impulso.
Para ello, es preciso que los bits de control (Página 424)CTRL_DO1 o CTRL_DO2 estén
activados.
Los bits de estado (Página 426)STS_DO1 y STS_DO2 tienen siempre el estado de la
correspondiente salida digital.
El resultado de la comparación se indica mediante el bit de estado (Página 426)STS_CMP1 o
STS_CMP2 y sólo se podrá desactivar mediante acuse cuando haya expirado la duración del
impulso.
Si se ha parametrizado el sentido principal de contaje, el comparador conmutará sólo cuando
se alcance el valor de comparación en el sentido principal de contaje.
Si no se ha parametrizado el sentido principal de contaje, el comparador conmutará sólo
cuando se alcance el valor de comparación en cualquiera de los dos sentidos de contaje.
Si la salida digital ha sido activada mediante el bit de control (Página 424)SET_DO1 o
SET_DO2, se desactivará cuando haya transcurrido la duración del impulso.

Modo isócrono
También en el modo isócrono las salidas DO1 y DO2 conmutan inmediatamente al cumplirse
la condición de comparación y, por consiguiente, no dependen del ciclo de bus.

Conmutar en los valores de comparación
Conmutar en los valores de comparación
El comparador activa la salida cuando se cumplen las siguientes condiciones:
● Los dos valores de comparación deben cargarse mediante la función de carga
(Página 424)CMP_VAL1 y CMP_VAL2 y
● una vez cargados los valores de comparación, hay que habilitar la salida DO1 (Página 424)
con CRTL_DO1.
La tabla siguiente muestra cuándo está activada o desactivada la salida DO1:

410

DO1 está conectada cuando

DO1 está desconectada cuando

V2 < V1
(v. figura inferior)

V2 ≤ estado del contador ≤ V1

V2 > estado del contador
o
estado del contador > V1

V2 = V1

V2 = estado del contador = V1

V2 ≠ estado del contador ≠ V1

V2 > V1
(v. figura inferior)

V1 > estado del contador
o
estado del contador > V2

V1 ≤ estado del contador ≤ V2

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Las siguientes figuras muestran el estado de la salida DO1 dependiendo del estado del
contador y de los valores de comparación:
● V2 < V1 al comenzar el contaje
(VWDGRGHO
FRQWDGRU
9
9



'2

W

W

● V2 > V1 al comenzar el contaje
(VWDGRGHO
FRQWDGRU
9
9



'2

W

W

El bit de estado (Página 426)STS_CMP1 indica el resultado de la comparación. Sólo podrá
acusar y por tanto desactivar este bit cuando deje de cumplirse la condición de comparación.
No hay ninguna histéresis cuando la salida tiene este comportamiento.
En este comportamiento de salida, el bit de control (Página 424)SET_DO1 no puede controlar
la salida DO1.

Modo isócrono
También en el modo isócrono la salida DO1 se activa inmediatamente al cumplirse la condición
de comparación y, por consiguiente, no depende del ciclo de bus.

Seleccionar valor sustitutivo de DOx
Valor sustitutivo DO1 y valor sustitutivo DO2
Si se ha seleccionado el parámetro de conmutar valor sustitutivo DO en "Comportamiento en
caso de STOP de la CPU/del maestro (Página 404)", seleccione el valor sustitutivo que debe
enviarse a la salida digital DO1 o DO2.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

411

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activar diagnóstico DOx
Diagnóstico DO1 y diagnóstico DO2
El "diagnóstico DO1" o "diagnóstico DO2" (rotura de hilo, cortocircuito) sólo es posible con
anchos de impulso > 90 ms en la salida digital DO1 o DO2.
Active la respectiva casilla de verificación para el diagnóstico de la salida DO1 o DO2.

Definir histéresis
Histéresis
Un encóder puede permanecer en una posición particular y fluctuar entonces alrededor de
esta posición. Esto hace que el estado del contador fluctúe alrededor de un valor determinado.
Si hay un valor de comparación en este rango de fluctuación, por ejemplo, la salida
correspondiente se activa y desactiva de acuerdo con el ritmo de las fluctuaciones. Para evitar
estas conmutaciones cuando se producen pequeñas oscilaciones, el 1Count5V cuenta con
una histéresis parametrizable. Se puede parametrizar un rango entre 0 y 255 (0 significa:
histéresis desconectada).
La histéresis también actúa en caso de desbordamiento por exceso y por defecto.

Funcionamiento de la histéresis con el estado del contador ≤ valor de comparación y estado del
contador ≥ valor de comparación
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (= desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo, el valor de comparación = 5.
El contador está parametrizado con "Sentido principal de contaje adelante" y "la salida con
"Conexión si estado del contador ≥ valor de comparación".
Al alcanzarse la condición de comparación, se activa la histéresis. Cuando la histéresis está
activada, el resultado de la comparación permanece invariable.
Si el valor de contaje abandona el rango de histéresis, la histéresis se desactiva. El
comparador se conecta de nuevo conforme a sus condiciones de comparación.

412

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
9DORUGHFRQWDMH










+\V

+\V

Nota
Si se produce un cambio del sentido de contaje en el valor de comparación cuando la histéresis
está activa, la salida se desactiva.

Funcionamiento de la histéresis cuando se alcanza el valor de comparación y la duración del impulso
=0
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo, el valor de comparación = 5.
El contador está parametrizado con "Impulso al alcanzarse el valor de comparación", "Sin
sentido principal de contaje" y "Duración del impulso = 0".
Cuando se cumplen las condiciones de comparación se activa la histéresis. Cuando la
histéresis está activada, el resultado de la comparación permanece invariable.
Si el valor de contaje abandona el rango de histéresis, la histéresis se desactiva. El
comparador borra el resultado de la comparación.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

413

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
9DORUGHFRQWDMH










+\V

+\V

Funcionamiento de la histéresis cuando se alcanza el valor de comparación, salida de la duración del
impulso
La figura siguiente muestra un ejemplo del efecto de la histéresis. Muestra las diferencias de
comportamiento de una salida cuando se parametriza la histéresis a 0 (desconectada) en
contraposición a cuando se parametriza a 3. En el ejemplo, el valor de comparación = 5.
El contador está parametrizado con "Impulso al alcanzarse el valor de comparación", "Sin
sentido principal de contaje" y "Duración del impulso > 0".
Cuando las condiciones de comparación se cumplen, la histéresis se activa y se transfiere a
la salida un impulso de la duración parametrizada.
Cuando el valor de contaje abandona el rango de histéresis, la histéresis se desactiva.
Cuando se activa la histéresis, el 1Count5V almacena el sentido de contaje.
Si se abandona el rango de histéresis en sentido contrario al almacenado, se emite un impulso.
9DORUGHFRQWDMH










+\V

+\V

414

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Definir duración del impulso
Duración del impulso
La duración del impulso comienza al activarse la salida digital correspondiente. La imprecisión
de la duración del impulso es inferior a 2 ms.
La duración del impulso puede ser utilizada para conseguir una adaptación a los actuadores
utilizados. La duración del impulso indica durante cuánto tiempo ha de estar activada la salida.
La duración del impulso puede ser preseleccionada en intervalos de 2 ms entre 0 ms y 510 ms.
Si la duración del impulso es 0, la salida quedará activada hasta que la condición de
comparación deje de cumplirse. Observe que los tiempos de impulsos de contaje deben ser
mayores que los tiempos mínimos de conexión de la salida digital.

Modo isócrono
También en el modo isócrono las salidas DO1 y DO2 conmutan inmediatamente al cumplirse
la condición de comparación y, por consiguiente, no dependen del ciclo de bus.

Seleccionar modo de contaje
Descripción
Al preseleccionar un modo de contaje se elige la funcionalidad con la que se utilizará el
1Count5V.
Modo de operación

Descripción

Contaje sin fin (Página 195) El 1Count5V cuenta en modo sin fin a partir del estado actual del conta‐
(con o sin puerta)
dor.
Contaje único (Página 196)
(con puerta HW o SW)

El 1Count5V comienza a contar a partir del valor de carga al abrirse la
puerta y se detiene en el límite de contaje.

Contaje periódico (Pági‐
na 197)
(con puerta HW o SW)

El 1Count5V comienza a contar al abrirse la puerta a partir del valor de
carga entre los límites de contaje.

El ajuste predeterminado es el modo de operación "Contaje sin fin".

Selección del sentido principal de contaje
Descripción
Si se parametriza un sentido principal de contaje (Página 198) (adelante o atrás) es posible
limitar el rango de contaje máximo a un rango más pequeño, ajustando para ello un límite
superior de contaje (Página 423). El rango de contaje parametrizado está comprendido
entonces entre 0 y el límite superior de contaje ajustado.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

415

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
El sentido principal de contaje sólo puede seleccionarse en los modos de operación "Contaje
único" y "Contaje periódico".
Se puede seleccionar el siguiente comportamiento:
● Ninguno (sin sentido principal de contaje)
● Adelante
● Atrás

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Función DI
Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital
● Congelar/redisparar con flanco ascendente (Página 417)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador. Después de la operación de guardado, el contador se establece al valor de carga.
● Sincronización con flanco ascendente (Página 418)
Los flancos ascendentes de la entrada digital permiten establecer el contador al valor de
carga.
● Congelar con flanco ascendente (Página 420)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador.
● Habilitar HW para sincronización (Página 421)
La entrada digital sirve como habilitación HW. Cuando está activada la habilitación HW, el
contador se activa en el valor de carga con la señal de paso por cero del encóder.
El ajuste predeterminado es "Entrada".

416

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Congelar/redisparar con flanco ascendente
Congelar/redisparar
Con esta función se almacena el estado actual interno del contador del 1Count5V y se
redispara el contaje cuando hay un flanco ascendente en la entrada digital. Esto significa que
se almacena el estado actual interno del contador en el momento del flanco ascendente (valor
de congelación) y, entonces, se carga nuevamente el módulo 1Count5V con el valor de carga
y se sigue contando desde allí.
La siguiente figura muestra la función de congelar/redisparar con valor de carga = 0.

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU

9DORUGH
FRQJHODFLµQ

Para poder ejecutar la función, el modo de contaje tiene que estar habilitado con la puerta SW.
Se inicia con el primer flanco positivo de la entrada digital.
En la interfaz de realimentación (Página 426) se indica el estado almacenado del contador en
vez del estado actual del contador. El bit STS_DI indica el estado de la señal de congelación
y redisparo.
El valor de congelación se pone por defecto al estado de RESET.
● "0" en el sentido principal de contaje "Ninguno" o "Adelante"
● "Límite de contaje superior parametrizado" en el sentido principal de contaje atrás.
No cambia cuando se abre la puerta SW.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.
Si se cierra la puerta SW, sólo se interrumpe el contaje; es decir, cuando se vuelve a abrir la
puerta SW, continúa el contaje. La entrada digital DI permanece activa incluso cuando la
puerta SW está cerrada.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

417

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
También en el modo isócrono se congela y redispara el contaje con cada flanco de la entrada
digital. En la interfaz de realimentación se muestra el estado del contador válido en el instante
del último flanco antes de Ti.

Interfaz de realimentación ampliada
Si el módulo 1Count5V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces más amplias de datos de usuario, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de realimentación (Página 426).

Sincronización con flanco ascendente
Sincronización
Si se ha parametrizado "Sincronización con flanco ascendente", el flanco ascendente de una
señal de referencia en la entrada sirve para poner el 1Count5V al valor de carga.
Se puede seleccionar entre la sincronización única y la periódica (parámetro "Sincronización").
La figura siguiente muestra los estados del contador con una sincronización única y periódica.

418

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVLQWHUQRVGHFRQWDMH
DVFHQGHQWHVRGHVFHQGHQWHV

(QWUDGHGLJLWDO
PDUFDFHUR

6LQFURQL]DFLµQ
¼QLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH

9DORUGHFDUJD

6LQFURQL]DFLµQ
SHULµGLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH
9DORUGHFDUJD

Se aplican las siguientes condiciones:
● El modo de contaje tiene que haber sido iniciado mediante la puerta SW.
● El bit de control (Página 424) "Habilitación de la sincronización" (CTRL_SYN) debe estar
activado.
● Sincronización única: si el bit de habilitación está activado, el primer flanco carga el
1Count5V con el valor de carga.
● Sincronización periódica: si el bit de habilitación está activado, el primer flanco y cada
flanco subsiguiente cargan el 1Count5V con el valor de carga.
● Tras una sincronización correcta, el bit de realimentación (Página 426)STS_SYN se activa
y el LED SYN se enciende. El bit de control (Página 424)RES_STS desactiva el bit de
realimentación y apaga el LED.
● La señal de un interruptor libre de rebotes puede servir de señal de referencia.
● El bit de realimentación (Página 426)STS_DI indica el nivel de la señal de referencia.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

419

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
En el modo isócrono, el bit de realimentación (Página 426) activado STS_SYN indica que el
flanco ascendente de la entrada digital se encontraba entre el instante Ti del ciclo actual y el
instante Ti del ciclo pasado.

Congelar con flanco ascendente
Congelar
El estado del contador y el valor de congelación reciben sus estados de RESET.
● "0" en el sentido principal de contaje "Ninguno" o "Adelante"
● "Límite de contaje superior parametrizado" en el sentido principal de contaje atrás.
La función de contaje se inicia cuando se abre la puerta SW. El 1Count5V comienza a contar
a partir del valor de carga.
● "0" en el sentido principal de contaje "Ninguno" o "Adelante"
● "Límite de contaje superior parametrizado" en el sentido principal de contaje atrás.
La siguiente figura muestra la función de congelar con el valor de carga = 0.

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU
9DORUGH
FRQJHODFLµQ

El valor de congelación equivale siempre al valor de contaje en el instante del flanco
ascendente de la entrada digital DI.
En la interfaz de realimentación (Página 426) se indica el estado almacenado del contador en
vez del estado actual del contador. El bit STS_DI indica el nivel de la señal de congelación.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.
En el modo isócrono, se muestra en la interfaz de realimentación el estado del contador que
se congeló en el instante del último flanco ascendente antes de Ti.

420

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Si se cierra la puerta SW, actúa como parametrizada, de cancelación o de interrupción. La
entrada digital DI permanece activa incluso cuando la puerta SW está cerrada.

Interfaz de realimentación ampliada
Si el módulo 1Count5V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces más amplias de datos de usuario, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de realimentación (Página 426).

Habilitar HW para sincronización
Sincronización con DI y señal de paso por cero
Si se ha parametrizado la habilitación HW para sincronización, el DI sirve como habilitación
HW. Cuando está activada la habilitación HW, se carga el valor de carga en el 1Count5V con
la señal cero del encóder.
Se puede elegir entre la sincronización única y la periódica (parámetro "Sincronización
(Página 423)").
La figura siguiente muestra los estados del contador con una sincronización única y periódica.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

421

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVGHFRQWDMHLQWHUQRV
DVFHQRGHVFHQ
(QWUDGDGLJLWDO',
0DUFDFHUR

6LQFURQL]DFLµQ
¼QLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH

9DORUGHFDUJD

6LQFURQL]DFLµQ
SHULµGLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH
9DORUGHFDUJD

Se aplican las siguientes condiciones:
● El modo de contaje tiene que haber sido iniciado mediante la puerta SW.
● El bit de control (Página 424) "Habilitación de la sincronización" (CTRL_SYN) debe estar
activado.
● Sincronización única: si el bit de habilitación está activado y la habilitación HW está
presente, la primera señal cero carga el 1Count5V con el valor de carga.
● Sincronización periódica: Si el bit de habilitación está activado y la habilitación HW está
presente, la primera señal de paso por cero y cada señal de paso por cero subsiguiente
cargan el 1Count5V con el valor de carga.
● Tras una sincronización correcta, el bit de realimentación (Página 426)STS_SYN se activa
y el LED SYN se enciende. El bit de control (Página 424)RES_STS desactiva el bit de
realimentación y apaga el LED.

422

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● La señal de un interruptor libre de rebotes puede servir de señal de referencia para la
habilitación HW.
● El bit de realimentación (Página 426)STS_DI indica el nivel de la señal de referencia.
En el modo isócrono, el bit de realimentación (Página 426) activado STS_SYN indica que el
flanco ascendente de la entrada digital se encontraba entre el instante Ti del ciclo actual y el
instante Ti del ciclo pasado.

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 426)STS_DI indica el nivel de la entrada digital.

Seleccionar sincronización
Sincronización
Si se ha seleccionado "Sincronización con flanco ascendente" en "Función DI (Página 416)",
es posible elegir entre la sincronización única y la periódica.
● Una vez: si el bit de habilitación está activado, el primer flanco carga el 1Count5V con el
valor de carga.
● Periódica: si el bit de habilitación está activado, el primer flanco y cada flanco subsiguiente
cargan el 1Count5V con el valor de carga.

Determinar el límite superior de contaje
Descripción
Si se parametriza un límite superior de contaje en combinación con un sentido principal de
contaje (Página 198) (adelante o atrás) es posible limitar el rango de contaje máximo a un
rango más pequeño. El rango de contaje parametrizado está comprendido entonces entre 0 y
el límite superior de contaje ajustado.
El límite superior de contaje puede adoptar un valor > 1 hasta el límite superior del rango de
contaje.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

423

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de control y realimentación para los modos de contaje
Interfaz de control de los modos de contaje
Nota
Para el 1Count5V, los datos siguientes de la interfaz de control son datos relacionados o, lo
que es lo mismo, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de control
La siguiente tabla muestra la asignación de la interfaz de control (salidas) del 1Count5V para
los modos de contaje.
Dirección

Asignación

Bytes 0 a 3

Valor de carga directo, preliminar, valor de comparación 1 ó 2

Byte 0

Comportamiento de DO1, DO2 del 1Count5V
Bit 2

Bit 1

Bit 0

Función DO1

0

0

0

Salida

0

0

1

Conexión con estado del contador ≥ valor de comparación

0

1

0

Conexión con estado del contador ≤ valor de comparación

0

1

1

Impulso al alcanzarse el valor de comparación

1

0

0

Conmutación en los valores de comparación

1

0

1

bloqueado

1

1

0

bloqueado

1

1

1

bloqueado

Bit 5

Bit 4

Función DO2

0

0

Salida

0

1

Conexión con estado del contador ≥ valor de comparación

1

0

Conexión con estado del contador ≤ valor de comparación

1

1

Impulso al alcanzarse el valor de comparación

Bits 3, 6 y 7: Reservado = 0
Bytes 1 a 3

Byte 1

Histéresis DO1, DO2 (rango 0 … 255)

Byte 2

Duración del impulso DO1, DO2 (rango 0 a 255)

Byte 3

reservado = 0
Denominación

424

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación

Byte 4

Bit 7

Acuse del error

EXTF_ACK

Bit 6

Habilitación de DO2

CTRL_DO2

Bit 5

Bit de control DO2

SET_DO2

Bit 4

Habilitación de DO1

CTRL_DO1

Bit 3

Bit de control DO1

SET_DO1

Bit 2

Inicio de la desactivación del bit de estado

RES_STS

Bit 1

Habilitación de la sincronización

CTRL_SYN

Bit 0

Bit de control puerta SW

SW_GATE

Bit 7

reservado = 0

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

Cambio de función y comportamiento de DO1, DO2

C_DOPARAM

Bit 3

Carga del valor de comparación 2

CMP_VAL2

Bit 2

Carga del valor de comparación 1

CMP_VAL1

Bit 1

Carga preliminar del contador

LOAD_PREPARE

Bit 0

Carga directa del contador

LOAD_VAL

Byte 5

Bytes 6 a 7
1)

reservado = 0

1)

Falta en la interfaz de datos de usuario avanzada

Significado de los bits de control
Bit

Significado

C_DOPARAM

Cambio de función y comportamiento de DO1, DO2
Los valores de los bytes 0 a 2 son aceptados como nueva función, histéresis, y duración de impulso de
DO1, DO2. Esto puede conllevar el siguiente error: Las condiciones de conexión al alcanzarse los
valores de comparación no se cumplen.

CMP_VAL1

Carga del valor de comparación 1
El valor de los bytes 0 a 3 se transfiere al valor de comparación 1 con el bit de control "Carga del valor
de comparación 1" (CMP_VAL1).

CMP_VAL2

Carga del valor de comparación 2
El valor de los bytes 0 a 3 se transfiere al valor de comparación 2 con el bit de control "Carga del valor
de comparación 2" (CMP_VAL2).

CTRL_DO1

Habilitación de DO1
Este bit habilita la salida DO1

CTRL_DO2

Habilitación de DO2
Este bit habilita la salida DO2

CTRL_SYN

Este bit habilita la sincronización

EXTF_ACK

Acuse del error

LOAD_PREPARE

Carga preliminar del contador

LOAD_VAL

El valor de los bytes de 0 a 3 se carga directamente como nuevo valor de contaje

Los bits de error deben ser acusados mediante el bit de control EXTF_ACK una vez eliminada la causa.
El valor de los bytes 0 a 3 se acepta como valor de carga

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

425

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit

Significado

RES_STS

Inicio de la desactivación del bit de estado
Los bits de estado se desactivan mediante el proceso de realimentación entre el bit RES_STS y el bit
RES_STS_A.

SET_DO1

Bit de control DO1
Conectar y desconectar la salida digital DO1 cuando se ha activado CRTL_DO1.

SET_DO2

Bit de control DO2

SW_GATE

Bit de control puerta SW

Conectar y desconectar la salida digital DO2 cuando se ha activado CRTL_DO2.
La puerta SW se abre/cierra mediante la interfaz de control con el bit SW_GATE.

Interfaz de notificación de los modos de contaje
Nota
Para el 1Count5V, los datos siguientes de la interfaz de notificación son datos relacionados, es
decir, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de notificación
La siguiente tabla muestra la asignación de la interfaz de notificación (entradas) del 1Count5V
para los modos de contaje.
Dirección

Asignación

Bytes 0 a 3

Valor de contaje o valor de contaje almacenado con función de congelación en la entrada
digital

Byte 4

Bit 7

Cortocircuito en la alimentación del encóder

ERR_24V

Bit 6

cortocircuito / rotura de hilo / sobretemperatura

ERR_DO1

Bit 5

Error de parametrización

ERR_PARA

Bit 4

Cortocircuito/rotura de hilo/sobretemperatura

ERR_DO2

Bit 3

cortocircuito / rotura de hilo / señal del encóder

ERR_ENCODER

Bit 2

Desactivación de los bits de estado en curso

RES_STS_A

Bit 1

Error en función de carga

ERR_LOAD

Bit 0

Función de carga en curso

STS_LOAD

426

Denominación

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación

Denominación

Byte 5

Bit 7

Estado de sentido descendente

STS_C_DN

Bit 6

Estado de sentido ascendente

STS_C_UP

Bit 5

reservado = 0

Bit 4

Estado de DO2

STS_DO2

Bit 3

Estado de DO1

STS_DO1

Bit 2

reservado = 0

Bit 1

Estado de DI

STS_DI

Byte 6

Bit 0

Estado de la puerta interna

STS_GATE

Bit 7

Paso por cero en el rango de contaje sin sentido principal de contaje

STS_ND

Bit 6

Límite inferior

STS_UFLW

Bit 5

Límite superior

STS_OFLW

Bit 4

Estado del comparador 2

STS_CMP2

Bit 3

Estado del comparador 1

STS_CMP1

Bit 2

reservado = 0

Bit 1

reservado = 0

Bit 0

Estado de la sincronización

Byte 7

reservado = 0

Bytes 8 a 11

Valor de contaje 1

1)

STS_SYN

Interfaz de datos de usuario avanzada

Nota sobre los bits de realimentación
Bit

Significado

ERR_24V

Cortocircuito en la alimentación del encóder
El bit de error tiene que ser acusado mediante el bit de control (Página 424)EXTF_ACK.
Aviso de diagnóstico, si está parametrizado.

ERR_DO1

Cortocircuito / rotura de hilo / sobretemperatura por sobrecarga en la salida DO1
El bit de error tiene que ser acusado mediante el bit de control (Página 424)EXTF_ACK.
Aviso de diagnóstico, si está parametrizado.

ERR_DO2

Cortocircuito/rotura de hilo/sobretemperatura en la salida DO2
El bit de error tiene que ser acusado mediante el bit de control (Página 424)EXTF_ACK.
Aviso de diagnóstico, si está parametrizado.

ERR_ENCODER

Cortocircuito/rotura de hilo señal del encóder 5 V
El bit de error tiene que ser acusado mediante el bit de control (Página 424)EXTF_ACK.
Aviso de diagnóstico, si está parametrizado.

ERR_LOAD

Error en función de carga
Los bits de control (Página 424)LOAD_VAL, LOAD_PREPARE, CMP_VAL1, CMP_VAL2 y C_DOPA‐
RAM no pueden estar activados al mismo tiempo durante la transferencia. Esto tiene como conse‐
cuencia la activación del bit de estado ERR_LOAD, similar a cargar un valor incorrecto (que no se
acepta).

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

RES_STS_A

Desactivación de los bits de estado en curso

STS_C_DN

Estado de sentido descendente

STS_C_UP

Estado de sentido ascendente

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

427

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit

Significado

STS_CMP1

Estado del comparador 1
El bit de estado STS_CMP1 indica que la salida está o estaba activada. Debe acusarse con el bit de
control (Página 424)RES_STS. Si el bit de estado se acusa cuando la salida todavía está activada, el
bit se vuelve a activar inmediatamente. Este bit también se activa cuando se activa el bit de control
SET_DO1 sin estar habilitada DO1.

STS_CMP2

Estado del comparador 2
El bit de estado STS_CMP2 indica que la salida está o estaba activada. Debe acusarse con el bit de
control (Página 424)RES_STS. Si el bit de estado se acusa cuando la salida todavía está activada, el
bit se vuelve a activar inmediatamente. Este bit también se activa cuando se acciona el bit de control
SET_DO2 sin que esté habilitada DO2.

STS_DI

Estado de DI
El estado de la DI se indica en todos los modos de operación con el bit STS_DI en la interfaz de
notificación.

STS_DO1

Estado de DO1
El bit de estado STS_DO1 muestra el estado de la salida digital DO1.

STS_DO2

Estado de DO2

STS_GATE

Estado de la puerta interna: Contaje en curso.

STS_LOAD

Función de carga en curso

STS_ND

Paso por cero en el rango de contaje sin sentido principal de contaje. El bit debe desactivarse con el bit
de control (Página 424)RES_STS.

STS_OFLW

Límite superior de contaje excedido

STS_UFLW

Límite inferior de contaje excedido

El bit de estado STS_DO2 muestra el estado de la salida digital DO2.

Ambos bits deben ser desactivados.
STS_SYN

Estado de la sincronización
Al terminar la sincronización se activa el bit STS_SYN. Debe desactivarse con el bit de control (Pági‐
na 424)RES_STS.

Parámetros para medición
Activar diagnóstico colectivo
Diagnóstico colectivo
Si activa el diagnóstico colectivo en su parametrización, se realiza un diagnóstico relativo al
canal.

428

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar el comportamiento en caso de STOP de la CPU/del maestro
Ajuste del comportamiento en caso de STOP de la CPU/del maestro
Es posible parametrizar la reacción del 1Count5V en caso de fallo del controlador principal.
Parámetro

Estado del 1Count5V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

Desconectar DO

El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
tienen efecto inmediato.
se cierra y la salida digital se bloquea.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El valor límite superior e inferior, la función
y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.

Continuar modo de
operación1)

El modo de operación actual continúa. La puerta y la
salida digital conservan sus estados.

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

DO Aplicar valor susti‐ El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
tutivo
se cierra y el valor sustitutivo parametrizado para la tienen efecto inmediato.
salida digital se aplica directamente.
Los valores de comparación 1 y 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
Si para la salida se parametriza "Impulso al alcanzar
el valor de comparación", sólo estará disponible el
valor sustitutivo = 1 para la duración del impulso.
DO Mantener el último El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
valor
se cierra y el estado de la salida digital se conserva. tienen efecto inmediato.
Los valores de comparación 1 y 2 y el valor de carga
se resetean. El valor límite superior e inferior, la fun‐
ción y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.
1)

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count5V.

Abandonar el estado parametrizado
¿En qué condiciones abandona el 1Count5V el estado parametrizado?
La CPU o el maestro debe estar en modo RUN y la interfaz de control (Página 440) debe
modificarse.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

429

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/del maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count5V
● POWER ON o inserción del módulo de potencia correspondiente

Método de medición
Resumen
Método de medición
En el parámetro "Método de medición" es posible elegir entre los siguientes métodos:
● con tiempo de integración (Página 430)
● continuo (Página 431)

Medición con tiempo de integración
Desarrollo de la medición con tiempo de integración
La medición se lleva a cabo durante el tiempo de integración parametrizado. Al transcurrir el
tiempo de integración se actualiza el valor medido.
El final de una medición se indica con el bit de estado (Página 442)STS_CMP1. Este bit se
desactiva con el bit de control (Página 440)RES_STS en la interfaz de control.
Si no se han producido al menos dos flancos ascendentes dentro del tiempo de integración
parametrizado, se devuelve 0 como valor medido.
Se devuelve el valor -1 s hasta finalizar el primer tiempo de integración.
El tiempo de integración para la siguiente medición se puede cambiar durante el
funcionamiento.

Inversión del sentido de giro
Si el sentido de rotación se invierte durante un tiempo de integración, el valor medido para este
período es incierto. Al evaluar los bits de realimentación (Página 442)STS_C_UP y STS_C_DN
(evaluación de sentido), se puede responder a una posible irregularidad del proceso.

430

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Consulte también
Tiempo de integración y tiempo de actualización en el modo isócrono (Página 434)

Medición continua
Principio de medición
El módulo 1Count5V cuenta todos los flancos ascendentes de un impulso y les asigna un valor
de tiempo en µs.
El tiempo de actualización indica en qué espacio de tiempo se actualiza el valor medido del
módulo en la interfaz de notificación.
En una secuencia de impulsos con uno o varios impulsos por tiempo de actualización rige lo
siguiente:
Tiempo de medición diná‐ valor de tiempo del último impulso en el intervalo actual del tiempo
mico =
de actualización
menos
valor de tiempo del último impulso en el intervalo anterior del tiem‐
po de actualización
Una vez transcurrido el tiempo de actualización, se calcula y aplica un nuevo valor medido con
el tiempo de medición dinámico.
Si el tiempo de actualización actual no contiene ningún impulso, el tiempo de medición
dinámico resultante es el siguiente:
Tiempo de medición diná‐ valor de tiempo del tiempo de actualización actual transcurrido
mico =
menos
el valor de tiempo del último impulso
Una vez transcurrido un tiempo de actualización, se calcula un valor medido aproximado con
el tiempo de medición dinámico suponiendo que haya aparecido un impulso al final del tiempo
de actualización.
Si en la medición de frecuencia y de velocidad el valor medido aproximado "1 impulso por
tiempo de medición dinámico" es menor que el último valor medido, este valor medido
aproximado se emite como nuevo valor medido. En la medición del período, el tiempo de
medición dinámico se emite como duración aproximada del período cuando el tiempo de
medición dinámico es mayor que la última duración medida del período.
La figura muestra el principio de medición.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

431

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHPHGLFLµQ
GLQ£PLFR

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHPHGLFLµQ
GLQ£PLFR

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGH
PHGLFLµQ
GLQ£PLFR
7LHPSRGHDFWXDOL]D
FLµQ

7LHPSRGHPHGLFLµQ
GLQ£PLFR
7LHPSRGHPHGLFLµQ
GLQ£PLFR
7LHPSRGHPHGLFLµQ
GLQ£PLFR

El 1Count5V mide de forma continua. Durante la parametrización se introduce un tiempo de
actualización.
El valor "–1" se devuelve antes de finalizar el primer tiempo de actualización transcurrido.
La medición continua empieza tras abrir la puerta con el primer impulso de la secuencia de
impulsos que debe medirse. El primer valor medido no puede calcularse hasta después del
segundo impulso.
Cada vez que transcurre el tiempo de actualización, en la interfaz de notificación se emite un
valor medido (frecuencia, duración del período o velocidad). El final de una medición se indica
con el bit de estado (Página 442)STS_CMP1. Este bit se desactiva con los bits RES_STS y
RES_STS_A según el principio de realimentación completo.
Si el sentido de rotación se invierte durante un tiempo de actualización, el valor medido para
este período es incierto. Evaluando los bits de realimentación (Página 442)STS_C_DN y
STS_C_UP (evaluación del sentido) se puede reaccionar a posibles irregularidades del
proceso.
La figura siguiente explica el principio de la medición continua con el ejemplo de una medición
de frecuencia.

432

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
3XHUWD
6HFXHQFLDGH
LPSXOVRV
9DORU
PHGLGR










7LHPSRGHDFWXDOL]DFLµQ

Control de puerta
Para controlar el módulo 1Count5V se deben usar las funciones de puerta.

Modo isócrono
En el modo isócrono, el 1Count5V acepta en cada ciclo de bus bits de control y valores de
control de la interfaz de control y notifica la respuesta durante el mismo ciclo.
El 1Count5V transfiere en cada ciclo un valor medido y los bits de estado tal y como eran
válidos en el instante Ti.
La medición empieza y acaba en cada caso en el instante Ti.

Consulte también
Tiempo de integración y tiempo de actualización en el modo isócrono (Página 434)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

433

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Tiempo de integración y tiempo de actualización en el modo isócrono
Tiempo de integración y tiempo de actualización en el modo isócrono
Si el tiempo de integración/actualización dura varios ciclos TDP, es posible reconocer el nuevo
valor medido en el programa de usuario por el bit de estado (Página 442)STS_CMP1 (medición
finalizada) de la interfaz de notificación. Esto permite una vigilancia del proceso de medición
o una sincronización con el proceso de medición. Sin embargo, el acuse de este aviso dura 4
ciclos TDP. En este caso el tiempo de integración/actualización mínimo será de (4 x TDP).
Si la aplicación puede tolerar un jitter del tiempo de integración/actualización de un TDP y un
valor medido constante durante varios ciclos, no es necesario evaluar constantemente el bit de
estado STS_CMP1. Entonces serán posibles tiempos de integración/actualización de (1 x TDP)
a (3 x TDP).
Debido a una pérdida del sincronismo en el último ciclo TDP del tiempo de integración se
prolonga el tiempo de integración/actualización otro ciclo TDP. El valor medido no se ve
falsificado por ello.
Nota
No deben excederse los límites del rango del tiempo de integración/actualización (consulte las
tablas de cada uno de los modos de medición).
Una violación de los límites del rango de valores provoca un error de parametrización, con lo
cual el 1Count5V no cambia al modo isócrono.
Nota
Al cambiar la configuración del modo no isócrono al modo isócrono y viceversa, siempre
deberá adaptarse el parámetro Tiempo de integración/actualización si se desea mantener la
duración del tiempo de integración/actualización.

Activar diagnóstico de los pares de señales
Vigilancia de los pares de señales
Los pares de señales A y /A, y B y /B pueden vigilarse.
Active para ello la casilla de verificación correspondiente.

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

434

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Comportamiento de las salidas en los modos de medición
Seleccionar comportamiento de la salida DO1
Comportamiento de la salida en los modos de medición
La salida digital del 1Count5V es parametrizable.
Para la medición de frecuencia, velocidad o período se puede indicar un límite superior y un
límite inferior, respectivamente, que al ser excedido active la salida digital DO1. Estos valores
límite son parametrizables y pueden ser modificados con la función de carga.
La función y el comportamiento de la salida digital se puede modificar durante el
funcionamiento. La nueva función actúa de inmediato, en el modo isócrono siempre en el
instante Ti.
En la lista desplegable se pueden seleccionar las siguientes funciones.
● Salida (Página 435)
● Fuera de los valores límite (Página 436) (vigilancia de valor límite)
● Rebase por defecto del valor límite inferior (Página 436) (vigilancia de valor límite)
● Rebase por exceso del valor límite superior (Página 436) (vigilancia de valor límite)

Salida
Salida
Para conectar o desconectar las salidas, es necesario habilitarlas con los bits de control
(Página 440)CTRL_DO1 o CTRL_DO2.
Los bits de control (Página 440)SET_DO1 o SET_DO2 permiten activar y desactivar las
salidas.
Con el bit de estado (Página 442)STS_DO1 o STS_DO2 de la interfaz de notificación se puede
consultar el estado de la salida.
En el modo isócrono las salidas conmutan en el instante To.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

435

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Vigilancia de valores límite
Vigilancia de valor límite
La figura siguiente muestra el principio de la vigilancia de valor límite.

2)/:

8)/:

,QLFLRGH
SXHUWD

/¯PLWH
LQIHULRU

/¯PLWH
VXSHULRU

9DORUPHGLGR

Una vez transcurrido el tiempo de integración, el valor medido (frecuencia, velocidad o
período) se compara con los valores límite parametrizados.
Si el valor medido actual está por debajo del valor límite inferior parametrizado (valor medido
< valor límite inferior), el bit STS_UFLW = 1 se activa en la interfaz de notificación (Página 442).
Si el valor medido actual está por encima del valor límite superior parametrizado (valor medido
< valor límite superior), el bit STS_OFLW = 1 se activa en la interfaz de realimentación
(Página 442).
Estos bits tienen que ser acusados con el bit de control (Página 440)RES_STS.
Si el valor medido sigue fuera de los valores límite o vuelve a estarlo después del
realimentación, se vuelve a activar el correspondiente bit de estado.
Poniendo el límite inferior a 0, se desconecta la vigilancia dinámica de desbordamiento por
defecto del valor límite inferior.
La tabla siguiente muestra que, dependiendo de la parametrización, la salida digital DO1
habilitada se puede activar con la vigilancia de valor límite:
Parámetro "Función de DO1"

DO1 se activa cuando ...

Fuera de los valores límite

Valor medido < valor límite inferior
O
Valor medido > valor límite superior

Rebase por defecto del valor límite inferior

Valor medido < valor límite inferior

Rebase por exceso del valor límite superior

Valor medido > valor límite superior

En el modo isócrono la salida conmuta al terminar la medición en el instante Ti.

Seleccionar valor sustitutivo de DOx
Valor sustitutivo DO1 y valor sustitutivo DO2
Si se ha seleccionado el parámetro de conmutar valor sustitutivo DO en "Comportamiento en
caso de STOP de la CPU/del maestro (Página 429)", seleccione el valor sustitutivo que debe
enviarse a la salida digital DO1 o DO2.

436

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Activar diagnóstico DOx
Diagnóstico DO1 y diagnóstico DO2
El "diagnóstico DO1" o "diagnóstico DO2" (rotura de hilo, cortocircuito) sólo es posible con
anchos de impulso > 90 ms en la salida digital DO1 o DO2.
Active la respectiva casilla de verificación para el diagnóstico de la salida DO1 o DO2.

Seleccionar modo de medición
Descripción
Al preseleccionar un modo de medición se elige la funcionalidad con la que se utilizará el
1Count5V.
Descripción
Modo de operación

Medición con tiempo de integración Medición continua

Medición de la frecuencia
(Página 205)
(con puerta HW o SW)

El 1Count5V cuenta los impulsos
El 1Count5V cuenta los impulsos
que llegan en un tiempo de integra‐ que llegan en un tiempo de medi‐
ción predefinido.
ción dinámico.

Medición de la velocidad
(Página 206)
(con puerta HW o SW)

El 1Count5V cuenta los impulsos
que llegan de un encóder de velo‐
cidad en un tiempo de integración
predefinido y calcula a partir de ello
la velocidad con los impulsos por
vuelta del encóder.

El 1Count5V cuenta los impulsos
que llegan de un encóder de velo‐
cidad en un tiempo de medición di‐
námico y calcula a partir de ello la
velocidad con los impulsos por
vuelta del encóder.

Medición del período (Pági‐ El 1Count5V mide el tiempo entre
na 208)
dos flancos ascendentes de la se‐
(con puerta HW o SW)
ñal de contaje contando los impul‐
sos de una frecuencia interna de
referencia (16 MHz) de precisión
de cuarzo dentro del tiempo de in‐
tegración dado.

El 1Count5V indica el tiempo de
medición dinámico como duración
del período. Si el período es inferior
al tiempo de actualización, se crea
un valor medio para el período.

El ajuste predeterminado es el modo de operación "Medición de la frecuencia".

Seleccionar la resolución del período
Descripción
El valor del período medido se indica en 1 μs o 1/16 μs.
Seleccione la unidad deseada para la resolución.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

437

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Rangos de medición posibles con información de errores
● Medición del período con tiempo de integración
– Rangos de medición y errores a una resolución de 1 µs:
Tiempo de integra‐
ción

Tmín ± error absoluto

Tmín ± error absoluto

100 s

1 µs* (10 ± 0)

1 µs* (100.000.000 ± 10.000)

10 s

1 µs* (10 ± 0)

1 µs* (10.000.000 ± 1.000)

1s

1 µs* (10 ± 0)

1 µs* (1.000.000 ± 100)

0,1 s

1 µs* (10 ± 0)

1 µs* (100.000 ± 10)

0,01 s

1 µs* (10 ± 0)

1 µs* (10.000 ± 1)

– Rangos de medición y errores en una resolución de 1/16 µs:
Tiempo de integra‐
ción

Tmín ± error absoluto

Tmín ± error absoluto

100 s

1/16 µs* (160 ± 0)

1/16 µs* (1.600.000.000 ± 160.000)

10 s

1/16 µs* (160 ± 0)

1/16 µs* (160.000.000 ± 16.000)

1s

1/16 µs* (160 ± 0)

1/16 µs* (16.000.000 ± 1.600)

0,1 s

1/16 µs* (160 ± 0)

1/16 µs* (1.600.000 ± 160)

0,01 s

1/16 µs* (160 ± 0)

1/16 µs* (160.000 ± 16)

● Medición continua del período:
– Rangos de medición y errores a una resolución de 1 µs:
Período Tmín ± error absoluto

Período Tmín ± error absoluto

1 μs* (10 ± 0)

1 μs* (100 000 ± 10)

1 μs* (100 ± 0)

1 μs* (1 000 000 ± 100)

1 μs* (1 000 ± 0)

1 μs* (10 000 000 ± 1 002)

1 μs* (10 000 ± 1)

1 μs* (100 000 000 ± 10 020)

– Rangos de medición y errores en una resolución de 1/16 µs:

438

Período Tmín ± error absoluto

Período Tmín ± error absoluto

1/16 μs* (160 ± 1)

1/16 μs* (1 600 000 ± 160)

1/16 μs* (1 600 ± 1)

1/16 μs* (16 000 000 ± 1 600)

1/16 μs* (16 000 ± 3)

1/16 μs* (160 000 000 ± 16 000)

1/16 μs* (160 000 ± 20)

1/16 μs* (1 600 000 000 ± 160 000)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital.
El ajuste predeterminado es "Entrada".

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 442)STS_DI indica el nivel de la entrada digital.

Definir valor límite inferior y superior
Valores límite inferior y superior
Para la medición de frecuencia, velocidad o período se puede indicar un límite superior y un
límite inferior, respectivamente, que al ser excedido active la salida digital DO1 (Página 435).
Estos valores límite se pueden parametrizar y modificar a través de la función de carga.
Los siguientes rangos de valores están permitidos para los valores límite inferior y superior:
Modo de medición

Valor límite inferior (LI):

Valor límite superior

Medición de frecuencia

0 a 99.999.999 × 10 Hz

LI+1 a 100.000.000 × 10-3 Hz

Medición de velocidad

0 a 24.999.999 × 10-3 /min

LI+1 a 25.000.000 × 10-3/min

Medición del período (resolución 1 µs)

0 a 119.999.999 μs

LI+1 a 120.000.000 μs

Medición del período (resolución 1/16
µs)

0 a 1 919 999 999 × 1/16 μs

LI+1 a 1 920 000 000 × 1/16 μs

-3

Definir el tiempo de medición
Descripción
Si se ha seleccionado un modo de medición, el módulo actualiza los valores medidos de forma
cíclica. El tiempo de actualización/integración es el producto del tiempo de medición x 10 ms.
El tiempo de medición se predefine como factor n.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

439

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Si desea obtener una descripción detallada sobre el rango de valores para el tiempo de
medición, consulte el apartado "Conceptos básicos sobre la operación de medición
(Página 200)".

Introducir impulsos por vuelta del encóder
Impulsos por vuelta del encóder
Para el modo Medición de velocidad (Página 206) es preciso parametrizar adicionalmente los
impulsos por vuelta del encóder.
El valor para el número de impulsos por vuelta del encóder se encuentra en la placa de
características o en los datos técnicos del encóder.

Interfaz de notificación y control para los modos de medición
Interfaz de control de los modos de medición
Nota
Para el 1Count5V, los datos siguientes de la interfaz de control son datos relacionados o, lo
que es lo mismo, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de control
La siguiente tabla muestra la asignación de la interfaz de control (salidas) del 1Count5V para
los modos de medición.
Dirección

Asignación

Bytes 0 a 3

Valor límite inferior o superior
Función de DO1
Byte 0

Bytes 1 a 3

Bit 1

Bit 0

Función DO1

0

0

Salida

0

1

Fuera de los límites

1

0

Rebase por defecto del valor límite inferior

1

1

Rebase por exceso del valor límite superior

reservado = 0

Tiempo de integración/actualización
Byte 0, 1

Tiempo de integración [n × 10 ms]
(Rango de valores 1 … 1.000 / 12.000)

Byte 2, 3

440

reservado = 0

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación
Denominación

Byte 4

Byte 5

Bytes 6 a 7
1)

Bit 7

Acuse del error

EXTF_ACK

Bit 6

Habilitación de DO2

CTRL_DO2

Bit 5

Bit de control DO2

SET_DO2

Bit 4

Habilitación de DO1

CTRL_DO1

Bit 3

Bit de control DO1

SET_DO1

Bit 2

Inicio de la desactivación del bit de estado

RES_STS

Bit 1

reservado = 0

Bit 0

Bit de control puerta SW

Bit 7

reservado = 0

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

Modificar la función de DO1

Bit 3

reservado = 0

SW_GATE

C_DOPARAM

Bit 2

Modificar el tiempo de integración

C_INTTIME

Bit 1

Cargar valor límite superior

LOAD_PREPARE

Bit 0

Cargar valor límite inferior

LOAD_VAL

reservado = 0 1)

Falta en la interfaz de datos de usuario avanzada

Significado de los bits de control
Bit

Significado

C_DOPARAM

Modificar la función de DO1
El valor del byte 0 es aceptado como nueva función de DO1.

C_INTTIME

Modificar el tiempo de integración
El valor de los bytes 0 y 1 es aceptado como nuevo tiempo de integración para la siguiente medición.

CTRL_DO1

Habilitación de DO1
Este bit habilita la salida DO1

CTRL_DO2

Habilitación de DO2

EXTF_ACK

Acuse del error

LOAD_PREPARE

Cargar valor límite superior

LOAD_VAL

Cargar valor límite inferior

Este bit habilita la salida DO2
Los bits de error deben ser acusados mediante el bit de control EXTF_ACK una vez eliminada la causa.
El valor de los bytes 0 a 3 es aceptado como nuevo límite superior.
El valor de los bytes 0 a 3 es aceptado como nuevo valor límite inferior.
RES_STS

Inicio de la desactivación del bit de estado
Los bits de estado se desactivan mediante el proceso de realimentación entre el bit RES_STS y el bit
RES_STS_A.

SET_DO1

Bit de control DO1
Conectar y desconectar la salida digital DO1 cuando se ha activado CRTL_DO1.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

441

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit

Significado

SET_DO2

Bit de control DO2
Conectar y desconectar la salida digital DO2 cuando se ha activado CRTL_DO2.

SW_GATE

Bit de control puerta SW
La puerta SW se abre/cierra mediante la interfaz de control con el bit SW_GATE.

Interfaz de notificación de los modos de medición
Nota
Para el 1Count5V, los datos siguientes de la interfaz de notificación son datos relacionados, es
decir, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de notificación
La siguiente tabla muestra la asignación de la interfaz de notificación (entradas) del 1Count5V
para los modos de medición.
Dirección

Asignación

Bytes 0 a 3

Valor medido

Byte 4

Bit 7

Cortocircuito en la alimentación del encóder

ERR_24V

Bit 6

Cortocircuito/rotura de hilo/sobretemperatura

ERR_DO1

Bit 5

Error de parametrización

ERR_PARA

Bit 4

Cortocircuito/rotura de hilo/sobretemperatura

ERR_DO2

Bit 3

Cortocircuito/rotura de hilo/señal del encóder

ERR_ENCODER

Bit 2

Desactivación de los bits de estado en curso

RES_STS_A

Bit 1

Error en función de carga

ERR_LOAD

Bit 0

Función de carga en curso

STS_LOAD

Byte 5

442

Denominación

Bit 7

Estado de sentido descendente

STS_C_DN

Bit 6

Estado de sentido ascendente

STS_C_UP

Bit 5

reservado = 0

Bit 4

Estado de DO2

STS_DO2

Bit 3

Estado de DO1

STS_DO1

Bit 2

reservado = 0

Bit 1

Estado de DI

STS_DI

Bit 0

Estado de la puerta interna

STS_GATE

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación

Byte 6

Bit 70

reservado = 0

Bit 6

Valor límite inferior del rango de medida

STS_UFLW

Bit 5

Valor límite superior del rango de medida

STS_OFLW

Bit 4

reservado = 0

Bit 3

Fin de la medición

Bit 2

reservado = 0

Bit 1

reservado = 0

Bit 0

reservado = 0

Byte 7

reservado = 0

Bytes 8 a 11

Valor de contaje 1)

1)

Denominación

STS_CMP1

Interfaz de datos de usuario avanzada

Nota sobre los bits de realimentación
Bit

Significado

ERR_24V

Cortocircuito en la alimentación del encóder
El bit de error tiene que ser acusado con el bit de control (Página 440)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_DO1

Cortocircuito/rotura de hilo/sobretemperatura en la salida DO1
El bit de error tiene que ser acusado con el bit de control (Página 440)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_DO2

Cortocircuito/rotura de hilo/sobretemperatura en la salida DO2
El bit de error tiene que ser acusado con el bit de control (Página 440)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_ENCODER

Cortocircuito / rotura de hilo señal del encóder
El bit de error tiene que ser acusado con el bit de control (Página 440)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_LOAD

Error en función de carga
Los bits de control (Página 440)LOAD_VAL, LOAD_PREPARE, C_DOPARAM y C_INTTIME no pue‐
den estar activados al mismo tiempo durante la transferencia. Esto tiene como consecuencia la acti‐
vación del bit de estado ERR_LOAD, similar a cargar un valor incorrecto (que no se acepta).

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

RES_STS_A

Desactivación de los bits de estado en curso

STS_C_DN

Estado de sentido descendente

STS_C_UP

Estado de sentido ascendente

STS_CMP1

Fin de la medición
El valor medido es actualizado cada vez que termina un intervalo (tiempo de actualización/integración).
Medición con tiempo de integración:
El fin de una medición (al terminar el intervalo) es indicado con el bit de estado STS_CMP1.
Medición continua:
Al finalizar el tiempo de actualización, el fin de la medición se indica con el bit de estado STS_CMP1,
siempre que se emita un valor medido. Si se emite un valor medido aproximado, el bit se mantiene en
"0".
Este bit se desactiva con el bit de control (Página 440)RES_STS en la interfaz de control.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

443

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit

Significado

STS_DI

Estado de DI
El estado de la DI se indica en todos los modos de operación con el bit STS_DI en la interfaz de
notificación.

STS_DO1

Estado de DO1

STS_DO2

Estado de DO2

STS_GATE

Estado de la puerta interna: Se mide.

STS_LOAD

Función de carga en curso

STS_OFLW

Valor límite superior rebasado

STS_UFLW

Valor límite inferior no alcanzado
Ambos bits deben ser desactivados.

Parámetros para la lectura del recorrido
Activar diagnóstico colectivo
Diagnóstico colectivo
Si activa el diagnóstico colectivo en su parametrización, se realiza un diagnóstico relativo al
canal.

Seleccionar la reacción en caso de STOP de la CPU/del maestro
Ajuste de la reacción en caso de STOP de la CPU/del maestro
Es posible parametrizar la reacción del 1Count5V en caso de fallo del controlador principal.
Parámetros

Estado del 1Count5V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una reparametri‐
del maestro
zación?

Desconectar DO

El modo de operación actual se cancela. La puerta Los parámetros modificados son aceptados y
se cierra y la salida digital se bloquea.
tienen efecto inmediato.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El valor límite superior e inferior, la función
y el comportamiento de las salidas digitales y el
tiempo de integración se toman de los parámetros.

Continuar modo de
operación1)

El modo de operación actual continúa. La puerta y la
salida digital conservan sus estados.

1)

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count5V.

444

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Abandonar el estado parametrizado
¿En qué condiciones abandona el 1Count5V el estado parametrizado?
La CPU o el maestro debe estar en modo RUN y la interfaz de control (Página 453) debe
modificarse.

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count5V
● POWER ON o inserción del módulo de potencia correspondiente

Seleccionar evaluación de señal
Evaluación de señal A, B
La evaluación de la señal mediante A, B permite contar direccionalmente. Son posibles
diferentes modos de evaluación dependiendo de lo que se parametrice:
● Encóder rotativo (Página 220)
El 1Count5V puede contar los flancos de las señales. Normalmente, sólo se evalúan los
flancos en A (evaluación simple). Para obtener una resolución más alta, en la
parametrización (parámetro "Evaluación de señal") se puede seleccionar si las señales
deben evaluarse de forma simple (Página 221), doble (Página 221) o cuádruple
(Página 221).
La evaluación múltiple sólo es posible con encóders incrementales asimétricos con señales
A y B desfasadas 90 grados.
Nota
La indicación 500 kHz en la frecuencia de contaje se refiere a la frecuencia máxima de las
señales A o B. Así, en la evaluación doble se obtienen como máximo 1 MHz en los impulsos
de contaje o máximo 2 MHz en la evaluación cuádruple.

Activar diagnóstico de los pares de señales
Vigilancia de los pares de señales
Los pares de señales A y /A, B y /B, N y /N pueden vigilarse.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

445

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Active para ello la casilla de verificación correspondiente.
Nota
El "Diagnóstico N, /N" no se puede activar hasta que se ha activado el "diagnóstico A, /A y B, /
B".

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Función DI
Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital
● Congelar/redisparar con flanco ascendente (Página 447)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador. Después de la operación de guardado, el contador se establece al valor de carga.

446

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● Sincronización con flanco ascendente (Página 448)
Los flancos ascendentes de la entrada digital permiten establecer el contador al valor de
carga.
● Congelar con flanco ascendente (Página 450)
Los flancos ascendentes de la entrada digital permiten almacenar (congelar) estados del
contador.
● Habilitar HW para sincronización (Página 451)
La entrada digital sirve como habilitación HW. Cuando está activada la habilitación HW, el
contador se activa en el valor de carga con la señal de paso por cero del encóder.
El ajuste predeterminado es "Entrada".

Congelar/redisparar con flanco ascendente
Congelar/redisparar
Con esta función se almacena el estado actual interno del contador del 1Count5V y se
redispara el contaje cuando hay un flanco ascendente en la entrada digital. Esto significa que
se almacena el estado actual interno del contador en el momento del flanco ascendente (valor
de congelación) y, entonces, se carga nuevamente el módulo 1Count5V con el valor de carga
y se sigue contando desde allí.
La siguiente figura muestra la función de congelar/redisparar con valor de carga = 0.

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU

9DORUGH
FRQJHODFLµQ

Para poder ejecutar la función, el modo de contaje tiene que estar habilitado con la puerta SW.
Se inicia con el primer flanco ascendente de la entrada digital.
En la interfaz de notificación (Página 455) se indica el estado almacenado del contador en vez
del estado actual del contador. El bit STS_DI indica el estado de la señal de congelación y
redisparo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

447

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
El valor de congelación se pone por defecto al estado de RESET ("0"). No cambia cuando se
abre la puerta SW.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.
Si se cierra la puerta SW, sólo se interrumpe el contaje; es decir, cuando se vuelve a abrir la
puerta SW, continúa el contaje. La entrada digital DI permanece activa incluso cuando la
puerta SW está cerrada.
También en el modo isócrono se congela y redispara el contaje con cada flanco de la entrada
digital. En la interfaz de realimentación se muestra el estado del contador válido en el instante
del último flanco antes de Ti.

Interfaz de notificación ampliada
Si el módulo 1Count5V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces más amplias de datos de usuario, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de notificación (Página 455).

Sincronización con flanco ascendente
Sincronización
Si se ha parametrizado "Sincronización con flanco ascendente", el flanco ascendente de una
señal de referencia en la entrada sirve para poner el 1Count5V al valor de carga.
Se puede seleccionar entre la sincronización única y la periódica (parámetro "Sincronización").
La figura siguiente muestra los estados del contador con una sincronización única y periódica.

448

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVLQWHUQRVGHFRQWDMH
DVFHQGHQWHVRGHVFHQGHQWHV

(QWUDGHGLJLWDO
PDUFDFHUR

6LQFURQL]DFLµQ
¼QLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH

9DORUGHFDUJD

6LQFURQL]DFLµQ
SHULµGLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH
9DORUGHFDUJD

Se aplican las siguientes condiciones:
● El modo de contaje tiene que haber sido iniciado mediante la puerta SW.
● El bit de control (Página 453) "Habilitación de la sincronización" (CTRL_SYN) debe estar
activado.
● Sincronización única: si el bit de habilitación está activado, el primer flanco carga el
1Count5V con el valor de carga.
● Sincronización periódica: si el bit de habilitación está activado, el primer flanco y cada
flanco subsiguiente cargan el 1Count5V con el valor de carga.
● Tras una sincronización correcta, el bit de realimentación (Página 455)STS_SYN se activa
y el LED SYN se enciende. El bit de control (Página 453)RES_STS desactiva el bit de
realimentación y apaga el LED.
● La señal de un interruptor libre de rebotes puede servir de señal de referencia.
● El bit de realimentación (Página 455)STS_DI indica el nivel de la señal de referencia.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

449

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
En el modo isócrono, el bit de realimentación (Página 455) activado STS_SYN indica que el
flanco ascendente de la entrada digital se encontraba entre el instante Ti del ciclo actual y el
instante Ti del ciclo pasado.

Congelar con flanco ascendente
Congelar
El estado del contador y el valor de congelación reciben sus estados de RESET ("0").
La función de contaje se inicia cuando se abre la puerta SW. El 1Count5V comienza a contar
a partir del valor de carga ("0").
La siguiente figura muestra la función de congelar con valor de carga = 0.

,PSXOVRVGH
FRQWDMH

6:B*$7(

(QWUDGDGLJLWDO',

(VWDGRGHO
FRQWDGRU
9DORUGH
FRQJHODFLµQ

El valor de congelación equivale siempre al valor de contaje en el instante del flanco
ascendente de la entrada digital DI.
En la interfaz de notificación (Página 455) se indica el estado almacenado del contador en vez
del estado actual del contador. El bit STS_DI indica el nivel de la señal de congelación.
La carga directa del contador no provoca que cambie el estado almacenado que indica el
contador.
En el modo isócrono, se muestra en la interfaz de notificación el estado del contador que se
congeló en el instante del último flanco ascendente antes de Ti.
Si se cierra la puerta SW, actúa como parametrizada, de cancelación o de interrupción. La
entrada digital DI permanece activa incluso cuando la puerta SW está cerrada.

450

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de notificación ampliada
Si el módulo 1Count5V está enchufado detrás de un IM 151 que soporta la lectura y escritura
de interfaces más amplias de datos de usuario, el valor actual de contaje puede leerse desde
los bytes 8 a 11 de la interfaz de notificación (Página 455).

Habilitar HW para sincronización
Sincronización con DI y señal de paso por cero
Si se ha parametrizado la habilitación HW para sincronización, el DI sirve como habilitación
HW. Cuando está activada la habilitación HW, se carga el valor de carga en el 1Count5V con
la señal cero del encóder.
Se puede elegir entre la sincronización única y la periódica (parámetro "Sincronización
(Página 453)").
La figura siguiente muestra los estados del contador con una sincronización única y periódica.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

451

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVGHFRQWDMHLQWHUQRV
DVFHQRGHVFHQ
(QWUDGDGLJLWDO',
0DUFDFHUR

6LQFURQL]DFLµQ
¼QLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH

9DORUGHFDUJD

6LQFURQL]DFLµQ
SHULµGLFD
+DELOLWDFLµQ
&57/B6<1

9DORUGHFRQWDMH
9DORUGHFDUJD

Se aplican las siguientes condiciones:
● El modo de contaje tiene que haber sido iniciado mediante la puerta SW.
● El bit de control (Página 453) "Habilitación de la sincronización" (CTRL_SYN) debe estar
activado.
● Sincronización única: si el bit de habilitación está activado y la habilitación HW está
presente, la primera señal cero carga el 1Count5V con el valor de carga.
● Sincronización periódica: Si el bit de habilitación está activado y la habilitación HW está
presente, la primera señal de paso por cero y cada señal de paso por cero subsiguiente
cargan el 1Count5V con el valor de carga.
● Tras una sincronización correcta, el bit de realimentación (Página 455)STS_SYN se activa
y el LED SYN se enciende. El bit de control (Página 453)RES_STS desactiva el bit de
realimentación y apaga el LED.

452

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
● La señal de un interruptor libre de rebotes puede servir de señal de referencia para la
habilitación HW.
● El bit de realimentación (Página 455)STS_DI indica el nivel de la señal de referencia.
En el modo isócrono, el bit de realimentación (Página 455) activado STS_SYN indica que el
flanco ascendente de la entrada digital se encontraba entre el instante Ti del ciclo actual y el
instante Ti del ciclo pasado.

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 455)STS_DI indica el nivel de la entrada digital.

Seleccionar sincronización
Sincronización
Si se ha seleccionado "Sincronización con flanco ascendente" en "Función DI (Página 446)",
es posible elegir entre la sincronización única y la periódica.
● Una vez: si el bit de habilitación está activado, el primer flanco carga el 1Count5V con el
valor de carga.
● Periódica: si el bit de habilitación está activado, el primer flanco y cada flanco subsiguiente
cargan el 1Count5V con el valor de carga.

Interfaz de notificación y control para la lectura del recorrido
Interfaz de control para la lectura del recorrido
Nota
Para el 1Count5V, los datos siguientes de la interfaz de control son datos relacionados o, lo
que es lo mismo, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

453

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Asignación de la interfaz de control
La siguiente tabla muestra la asignación de la interfaz de control (las salidas) del 1Count5V
para la lectura del recorrido.
Dirección

Asignación

Bytes 0 a 3

Valor de carga directo, preliminar

Byte 4

Bit 7

Acuse del error

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

Inicio de la desactivación del bit de estado

RES_STS

Bit 1

Habilitación de la sincronización

CTRL_SYN

Bit 0

Bit de control puerta SW

SW_GATE

Bit 7

reservado = 0

Bit 6

reservado = 0

Bit 5

reservado = 0

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

reservado = 0

Bit 1

Carga preliminar del contador

LOAD_PREPARE

Bit 0

Carga directa del contador

LOAD_VAL

Byte 5

Bytes 6 a 7
1)

Denominación

reservado = 0

EXTF_ACK

1)

Falta en la interfaz de datos de usuario avanzada

Significado de los bits de control
Bit

Significado

CTRL_SYN

Este bit habilita la sincronización

EXTF_ACK

Acuse del error
Los bits de error deben ser acusados mediante el bit de control EXTF_ACK una vez eliminada la causa.

LOAD_PREPARE

Carga preliminar del contador
El valor de los bytes 0 a 3 se acepta como valor de carga

LOAD_VAL

El valor de los bytes 0 a 3 se carga directamente como nuevo valor de contaje.

RES_STS

Inicio de la desactivación del bit de estado
Los bits de estado se desactivan mediante el proceso de realimentación entre el bit RES_STS y el bit
RES_STS_A.

SW_GATE

Bit de control puerta SW
La puerta SW se abre/cierra mediante la interfaz de control con el bit SW_GATE.

454

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Interfaz de notificación para la lectura del recorrido
Nota
Para el 1Count5V, los datos siguientes de la interfaz de notificación son datos relacionados, es
decir, coherentes:
● Bytes 0 … 3
● Bytes 4 … 7
● Bytes 8 ... 11 (interfaz de datos de usuario avanzada)

Asignación de la interfaz de notificación
La siguiente tabla muestra la asignación de la interfaz de notificación (entradas) del 1Count5V
para la lectura del recorrido.
Dirección

Asignación

Bytes 0 a 3

Valor de contaje o valor de contaje almacenado con función de congelación en la
entrada digital

Byte 4

Byte 5

Byte 6

Denominación

Bit 7

Cortocircuito en la alimentación del encóder

Bit 6

reservado = 0

Bit 5

Error de parametrización

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

Desactivación de los bits de estado en curso

RES_STS_A

Bit 1

Error en función de carga

ERR_LOAD

Bit 0

Función de carga en curso

STS_LOAD

Bit 7

Estado de sentido descendente

STS_C_DN

Bit 6

Estado de sentido ascendente

STS_C_UP

Bit 5

reservado = 0

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

reservado = 0

Bit 1

Estado de DI

STS_DI

Bit 0

Estado de la puerta interna

STS_GATE

Bit 7

Paso por cero

STS_ND

Bit 6

Límite inferior de contaje

STS_UFLW

Bit 5

Límite superior de contaje

STS_OFLW

Bit 4

reservado = 0

Bit 3

reservado = 0

Bit 2

reservado = 0

Bit 1

reservado = 0

Bit 0

Estado de la sincronización

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

ERR_24V
ERR_PARA

STS_SYN

455

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Dirección

Asignación

Byte 7

reservado = 0

Bytes 8 a 11

Valor de contaje 1)

1)

Denominación

Interfaz de datos de usuario avanzada

Nota sobre los bits de realimentación
Bit

Significado

ERR_24V

Cortocircuito en la alimentación del encóder
El bit de error tiene que ser acusado con el bit de control (Página 453)EXTF_ACK.
Aviso de diagnóstico, si se ha parametrizado.

ERR_LOAD

Error en función de carga
Los bits de control (Página 453)LOAD_VAL y LOAD_PREPARE no pueden estar activados al mismo
tiempo durante la transferencia. Esto tiene como consecuencia la activación del bit de estado
ERR_LOAD, similar a cargar un valor incorrecto (que no se acepta).

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

RES_STS_A

Desactivación de los bits de estado en curso

STS_C_DN

Estado de sentido descendente

STS_C_UP

Estado de sentido ascendente

STS_DI

Estado de DI
El estado de la DI se indica en todos los modos de operación con el bit STS_DI en la interfaz de
notificación.

STS_GATE

Estado de la puerta interna: Contaje en curso.

STS_LOAD

Función de carga en curso

STS_ND

Paso por cero en el rango de contaje sin sentido principal de contaje. El bit debe desactivarse con el bit
de control (Página 453)RES_STS.

STS_OFLW

Límite superior de contaje rebasado

STS_UFLW

Límite inferior de contaje rebasado
Ambos bits deben ser desactivados.

STS_SYN

Estado de la sincronización
Al terminar la sincronización se activa el bit STS_SYN. Debe desactivarse con el bit de control (Pági‐
na 453)RES_STS.

456

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Parametrizar para el modo Fast
Seleccionar el comportamiento en caso de STOP de la CPU/del maestro
Ajuste del comportamiento en caso de STOP de la CPU/del maestro
Es posible parametrizar la reacción del 1Count5V en caso de fallo del controlador principal.
Parámetro

Estado del 1Count5V en caso de STOP de la CPU/ ¿Qué ocurre en el caso de una nueva para‐
del maestro
metrización?

Desactivar DO

El modo de operación actual se cancela. La puerta
se cierra y la salida digital se bloquea.
El valor de comparación 1 y 2 y el valor de carga se
resetean. El límite superior e inferior, la función y el
comportamiento de las salidas digitales y el tiempo
de integración se toman de los parámetros.

Los parámetros modificados son aceptados y
tienen efecto inmediato.

Continuar modo de
operación1)

El modo de operación actual continúa. La puerta y la
salida digital conservan sus estados.

La puerta se cierra. El modo de operación ac‐
tual se cancela. La salida digital se bloquea.
Los parámetros modificados son aceptados y
tienen efecto inmediato.

1)

Si el modo de operación seleccionado debe continuar al cambiar la CPU/el maestro de STOP a RUN (arranque), la CPU/
el maestro no puede borrar las salidas.
Posible solución: En la parte del programa de usuario que se procesa durante el arranque active el bit de control SW_GATE
y transfiera los valores al 1Count5V.

Reparametrización automática
Una reparametrización de la estación ET 200S mediante la CPU/del maestro DP tiene lugar en
los siguientes casos:
● POWER ON de la CPU/del maestro DP
● POWER ON de la IM 151‑1 / IM 151‑1 FO
● Después de un fallo en la transmisión DP
● Tras cargar una parametrización o una configuración modificada de la estación ET 200S en
la CPU/ maestro DP
● Al insertar el 1Count5V
● POWER ON o inserción del módulo de potencia correspondiente

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

457

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Seleccionar evaluación de señal
Evaluación de señal A, B
La evaluación de la señal mediante A, B permite contar direccionalmente. Son posibles
diferentes modos de evaluación dependiendo de lo que se parametrice:
● Encóder rotativo (Página 220)
El 1Count5V puede contar los flancos de las señales. Normalmente, sólo se evalúan los
flancos en A (evaluación simple). Para obtener una resolución más alta, en la
parametrización (parámetro "Evaluación de señal") se puede seleccionar si las señales
deben evaluarse de forma simple (Página 221), doble (Página 221) o cuádruple
(Página 221).
La evaluación múltiple sólo es posible con encóders incrementales asimétricos con señales
A y B desfasadas 90 grados.
Nota
La indicación 500 kHz en la frecuencia de contaje se refiere a la frecuencia máxima de las
señales A o B. Así, en la evaluación doble se obtienen como máximo 1 MHz en los impulsos
de contaje o máximo 2 MHz en la evaluación cuádruple.

Activar diagnóstico de los pares de señales
Vigilancia de los pares de señales
Los pares de señales A y /A, B y /B, N y /N pueden vigilarse.
Active para ello la casilla de verificación correspondiente.
Nota
El "Diagnóstico N, /N" no se puede activar hasta que se ha activado el "diagnóstico A, /A y B, /
B".

Seleccionar el sentido de contaje
Sentido de contaje
Para adaptar el sentido de contaje al proceso es posible seleccionar lo siguiente.
● Sentido de contaje normal
● Sentido de contaje invertido

458

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Selección de la función de puerta
Descripción
Al parametrizar las puertas HW y SW se puede definir si la puerta interna debe interrumpir o
cancelar el contaje.
● Cancelar contaje (Página 216): El contaje comienza de nuevo desde el principio después
de una reactivación de la señal de la puerta.
● Interrumpir contaje (Página 216): El contaje se reanuda desde el último valor actual de
contaje después de una reactivación de la señal de la puerta.

Función DI
Seleccionar función DI
Descripción
La "función DI" permite seleccionar la función para la entrada digital:
● Entrada
La entrada digital funciona como entrada "normal".
● Puerta HW (Página 215), controlada por nivel
La puerta HW se abre y se cierra con la señal correspondiente de la entrada digital
● Sincronización con flanco ascendente (Página 459)
Los flancos ascendentes de la entrada digital permiten establecer el contador al valor de
carga.
● Habilitar HW para sincronización (Página 460)
La entrada digital sirve como habilitación HW. Cuando está activada la habilitación HW, el
contador se activa en el valor de carga con la señal de paso por cero del encóder.
El ajuste predeterminado es "Entrada".

Sincronización con flanco ascendente
Sincronización
Si se ha parametrizado "Sincronización con flanco ascendente", el flanco ascendente de una
señal de referencia en la entrada sirve para poner el 1Count5V al valor de inicio (= valor de
carga).
La figura siguiente muestra los estados del contador con una sincronización con flanco
ascendente.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

459

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVGHFRQWDMHLQWHUQRV
DVFRGHVF

(QWUDGDGLJLWDO
0DUFDFHUR

9DORUGHFRQWDMH
9DORULQLFLDO

Se aplican las siguientes condiciones:
● El modo de operación "Fast Mode" debe estar activo (puerta HW).
– Con la sincronización activada, el primer flanco y cualquier flanco posterior cargan el
1Count5V con el valor inicial (= valor de carga).
● Como señal de referencia puede utilizarse la señal de un interruptor sin rebotes o la señal
de paso por cero de un encóder rotativo.
● El bit de realimentación STS_DI indica el nivel de la señal de referencia.

Habilitar HW para sincronización
Sincronización con DI y señal de paso por cero
Si se ha parametrizado la habilitación HW para sincronización, el DI sirve como habilitación
HW. Cuando está activada la habilitación HW, el valor inicial (= valor de carga) se carga en el
1Count5V con la señal de paso por cero del encóder.
La figura siguiente muestra los estados del contador con habilitación HW en el DI y
sincronización con flanco ascendente.

460

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
,PSXOVRVGHFRQWDMHLQWHUQRV
DVFRGHVF
(QWUDGDGLJLWDO',
0DUFDFHUR

9DORUGHFRQWDMH
9DORULQLFLDO

Se aplican las siguientes condiciones:
● El modo de contaje tiene que haber sido iniciado mediante la puerta SW.
● El bit de control "Habilitación de la sincronización" (CTRL_SYN) está activado.
● Tras una sincronización correcta, el bit de realimentación (Página 462)STS_SYN se activa
y el LED SYN se enciende. El bit de control RES_STS desactiva el bit de realimentación y
apaga el LED.
● La señal de un interruptor libre de rebotes puede servir de señal de referencia para la
habilitación HW.
● El bit de realimentación (Página 462)STS_DI indica el nivel de la señal de referencia.
En el modo isócrono, el bit de realimentación activado STS_SYN indica que el flanco
ascendente de la entrada digital se encontraba entre el instante Ti del ciclo actual y el instante
Ti del ciclo pasado.

Seleccionar señal de entrada de la puerta HW
Señal de entrada puerta HW
Al parametrizar "Función DI = puerta HW", el nivel de la entrada digital se puede invertir con el
parámetro "Señal de entrada puerta HW".
El bit de realimentación (Página 462)STS_DI indica el nivel de la entrada digital.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

461

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Definir el valor de carga
Valor de carga
Es posible especificar un valor de carga para el 1Count5V.
Dicho valor de carga se toma directamente como valor inicial.
Rango de valores admisible: -16.777.216 a +16.777.215

Interfaz de realimentación para el Fast Mode
Nota
Para el 1Count5V, los datos siguientes de la interfaz de realimentación son datos
relacionados, es decir, coherentes:
● Bytes 0 … 3

Asignación de la interfaz de realimentación
La siguiente tabla muestra la asignación de la interfaz de realimentación (entradas) del
1Count5V para el modo Fast.
Dirección

Asignación

Bytes 0 a 3

Bit 31

Señal de vida

Denominación
LZ

Bit 30

Modo isócrono registrado

STS_TIC

Bit 29

Error de parametrización

ERR_PARA

Bit 28

Error de grupo

EXTF

● Cortocircuito, alimentación de encóders
● Cortocircuito / rotura de hilo señal del encóder
Bit 27

Estado de DI

STS_DI

Bit 26

Estado de sentido ascendente / descendente

STS_DIR

Bit 25

Estado de la puerta interna

STS_GATE

Bits 0 a 24

Valor de contaje

Significado de los bits de realimentación
Bit

Significado

ERR_PARA

En la parametrización del módulo hay parámetros incorrectos.

EXTF

Error de grupo
Causas posibles:
● Cortocircuito, alimentación de encóders
● Cortocircuito o rotura de hilo señal del encóder
EXTF se desactiva cuando se eliminan las causas del error.

462

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)
Bit

Significado

LZ

La señal de vida se invierte en cada actualización de la interfaz de realimentación, es decir, que se invierte
el último valor enviado.

STS_DI

El bit muestra el estado de la entrada digital DI.

STS_DIR

Estado de sentido;
● cuando cambia el valor del encóder de posiciones elevadas a posiciones más bajas (incl. paso por
cero) → "1 "
● cuando cambia el valor del encóder de posiciones bajas a posiciones más elevadas (incl. paso por
cero) → "0 "

STS_GATE

Estado de la puerta interna: Contaje en curso.

STS_TIC

El modo isócrono (si está parametrizado) se ha registrado.

Diagnóstico del 1Count5V
Diagnóstico con indicadores LED
Indicador LED del 1Count5V
6)

5

83

4

6<1

①
②
③
④
⑤

'1

1





2



3

Error de grupo (rojo)
Indicador de estado de la salida digital (verde)
Indicador de estado de la entrada digital (verde)
Indicador de estado de la sincronización (verde)
Indicador de estado del sentido de contaje (verde)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

463

Contaje, medición y lectura de posición
1.2 Contaje y medición (S7-300, S7-400)

Indicadores de estado y error mediante los LEDs del 1Count5V
La siguiente tabla muestra los indicadores de estado y error del 1Count5V.
Evento (LED)
SF

UP

DN

SYN

Causa

9

13

Solución

16

ON

No hay parametrización Hay un aviso de
diagnóstico.
ON

Compruebe la parametriza‐
ción. Evalúe el aviso de diag‐
nóstico.

Estado del bit menos significativo del con‐
tador, si el contador cuenta adelante.
ON

Estado del bit invertido menos significativo
del contador, si el contador cuenta atrás.
ON

Sincronización ejecutada (sólo en los mo‐
dos de contaje; imagen del bit de realimen‐
tación STS_SYN).
ON

DO 1 activada
ON

DO 2 activada
ON

DI activada

Tipos de error
En el manual de producto del módulo de interfaz utilizado en la estación ET 200S encontrará
información sobre la estructura del diagnóstico de canal.

Tipos de error del 1Count5V
La tabla siguiente muestra los tipos de error del 1Count5V.

464

Tipo de error

Significado

Solución

1D

00001:
cortocircuito

Cortocircuito de la alimentación del
encóder o actuador.

Compruebe el cableado del encó‐
der. Corregir el cableado del proce‐
so.

5D

00101:
Sobretemperatura

Salida digital sobrecargada.

Corregir el cableado del proceso.

6D

00110:
Rotura de hilo

Cable del actuador interrumpido.

Corregir el cableado del proceso.

9D

01001:
Error

Ha aparecido un error interno en el
módulo.

Sustituir el módulo.

16D

Módulo no parametrizado.
10000:
Error de parametri‐
zación

Corregir la parametrización.

26D

11010:
error externo

Corregir la parametrización

Rotura de hilo/cortocircuito de las
señales de 5 V del encóder:
A, /A, B, /B, N, /N,

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

2

Leva electrónica (S7-300, S7-400)
2.1

Control por levas

2.1.1

Conceptos básicos del control por levas

2.1.1.1

¿Qué es el control por levas?

Control por levas
Los secuenciadores de levas (levas electrónicas) se aplican para controlar funciones
dependientes de la posición o del tiempo. Son superiores a los secuenciadores de levas
mecánicos sobre todo por su gran flexibilidad, p. ej. se pueden realizar modificaciones por
software durante el funcionamiento.
Una leva de salida genera señales de conmutación en función de la posición del eje o de un
encóder externo. Se diferencia entre leva de recorrido y leva de tiempo.
Una leva de salida se define mediante:
● Posición inicial y posición final (leva de recorrido (Página 465))
● Posición inicial y duración de conexión (leva de tiempo (Página 465))

2.1.1.2

Características de los tipos de levas

Tipos de levas
Cualquier leva se puede parametrizar como leva de recorrido o como leva de tiempo.
La tabla siguiente compara las características de los dos tipos de levas.
Leva de recorrido

Leva de tiempo

Representación
/RQJLWXGGHOHYD
,QLFLRGHOHYD

Parametrización

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

6
)LQDOGHOHYD

7LHPSRGHDFWLYDFLµQ
,QLFLRGHOHYD

6
)LQGHOHYD

Se parametriza:

Se parametriza:

● Inicio de leva

● Inicio de leva

● Fin de leva

● Tiempo de activación

● Sentido de actuación

● Sentido de actuación

● Tiempo de anticipación

● Tiempo de anticipación

465

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Leva de recorrido
Sentido de actua‐
ción

Activación

● positivo: la leva se activa al inicio,
cuando el eje se desplaza en
dirección ascendente respecto al
valor real.

● positivo: la leva se activa al inicio,
cuando el eje se desplaza en
sentido ascendente respecto al
valor real.

● negativo: La leva se activa al final,
cuando el eje se desplaza en
dirección descendente respecto al
valor real.

● Negativo: La leva se activa a su
inicio, cuando el eje se desplaza en
dirección descendente respecto al
valor real.

Es posible también activar simultánea‐
mente los dos sentidos de actuación.

Es posible también activar simultánea‐
mente los dos sentidos de actuación.

La leva se activa:

La leva se activa:

● al inicio de la leva cuando el sentido
del movimiento del eje es positivo y
se ha ajustado el sentido de
actuación positivo.

● al principio de la leva cuando el
sentido del movimiento del eje es
positivo y se ha ajustado el sentido
de actuación positivo, o cuando el
sentido de movimiento del eje es
negativo y se ha ajustado el sentido
de actuación negativo

● al final de la leva cuando el sentido
del movimiento del eje es negativo y
se ha ajustado el sentido de
actuación en negativo.
● cuando el valor real se encuentra
dentro del rango de la leva.

Desactivación

Leva de tiempo

Existen dos sentidos de actuación posi‐ Existen dos sentidos de actuación posi‐
bles:
bles:

La leva se desactiva si
● se ha rebasado el recorrido
parametrizado,

Tras la conexión, se agota todo el tiem‐
po de conexión de la leva. Incluso si tras
la activación de la leva se modifica el
sentido del movimiento del eje. Si du‐
rante el tiempo de conexión de una leva
cuyo inicio se ha vuelto a rebasar, la le‐
va no se vuelve a disparar.
La leva se desconecta cuando el tiempo
parametrizado ha transcurrido.

● el sentido de actuación se detecta
como contrario al sentido del
movimiento y no se ha
parametrizado histéresis,
● el valor real no se encuentra en el
rango de la leva.
Longitud del reco‐
rrido

La longitud del recorrido de la leva se
define por el inicio y el final de la leva.
El principio y el fin de la leva pertenecen
a la parte activa de la leva.

Duración de cone‐
xión

466

La longitud del recorrido de la leva de‐
pende de la velocidad a la que el eje se
desplaza durante el tiempo de conexión
de la leva.

La duración de conexión de la leva de‐ La duración de conexión de la leva se
parametriza con el tiempo de conexión.
pende de la velocidad a la que el eje
rebase la longitud del recorrido de la le‐
va.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Detección del sentido
El sentido del movimiento del eje se determina del modo siguiente:
● Con cada impulso del encóder incremental.
● Con cada telegrama sin errores del encóder SSI.

Leva invertida
En "Modificar flancos de leva" puede ocurrir que durante un breve tiempo surja una leva
invertida si el nuevo principio de leva es mayor que el antiguo inicio de leva. La tabla siguientes
muestra el efecto de una leva inversa con un eje lineal y uno rotativo.
Leva invertida en un eje lineal

Leva invertida en un eje rotativo


)/

,/

El principio de leva es mayor que el fin de leva

)/

,/

El principio de leva es más positivo que el fin de
leva

Con ambos tipos de eje debe observarse una distancia mínima de 4 pulsos entre el principio de leva y
el fin de leva.

2.1.1.3

Pistas normales y resultados de la pista

Pistas de levas
Con las 32 pistas es posible controlar un máximo de 32 procesos de conexión distintos. Las
pistas se pueden evaluar con ayuda de las señales de realimentación.
Cada una de las primeras 13 pistas (de la 0 a la 12) tiene asignada una salida digital (Q0 a Q12)
del FM 352, capaz, por ejemplo, de controlar directamente un contactor conectado.
En el FM 452 cada una de las primeras 16 pistas (de la 0 a la 15) tiene asignada una salida
digital (Q0 a Q15).

Resultado de pista
Hay disponible un máximo de 128 levas a las que se puede asignar cualquier pista.
Cada pista puede estar asignada a varias levas. El resultado de la pista es el resultado de la
operación lógica OR de todos los valores de leva de esta pista.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

467

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Ejemplo de un resultado de pista
Al parametrizar se definen las levas siguientes para la pista 3:
Leva

Inicio de leva

Fin de leva

1

101 µm

106 µm

2

100 µm

104 µm

La figura siguiente muestra el resultado de la pista.
wP

wP

/HYD

wP
V

/HYD
/HYD
5HVXOWDGRGHSLVWD

Habilitación de pista
Para que los resultados de las pistas comprendidas 0 a 12 se puedan aplicar como señal de
pista en las salidas digitales de Q0 a Q12 del FM 352 es preciso habilitar las pistas utilizadas.
En el FM 452 se dispone de las pistas 0 a 15.

Habilitación externa de una pista
La habilitación externa de la pista 3 se puede parametrizar en los datos máquina. La señal de
pista 3 se combina lógicamente con la entrada digital I3 mediante la operación lógica AND
antes de que pueda conectar la salida digital Q3 del FM 352.
Así pues, la salida digital Q3 se activa cuando se cumplen las condiciones siguientes:
● La pista correspondiente está habilitada.
● Queda por lo menos una leva activa en esta pista (resultado de pista = 1).
● La entrada digital I3 correspondiente se ha activado mediante un evento externo.
En el FM 452 se dispone de las pistas 3 a 10 para una habilitación externa.

Activación de las señales de pista
Las señales de pista entre 0 y 12 (correspondientes a las salidas digitales entre Q0 y Q12) se
pueden activar con el control de levas o la CPU. En el FM 452 es posible activar las señales
de pista 0 a 15.

468

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

2.1.1.4

Pistas especiales

Definición
Es posible parametrizar como pistas especiales las pistas entre 0...2:
● Pista 0 o 1: Pista de leva de contaje
● Pista 2: Pista de leva de freno
Para que la pista se pueda activar, se evalúa la entrada I0.

Requisito
Para trabajar con pistas especiales se tienen que cumplir los requisitos siguientes:
● Las levas están parametrizadas en la pista.
● El procesamiento de levas está activado.
● La pista correspondiente está habilitada.
● La pista está parametrizada como pista especial.

Pista de leva de contaje
Una pista de leva de contaje cuenta el cambio de estado de los resultados de pista en esa pista.
Es preciso indicar un valor de contaje superior para la pista de la leva de contaje e iniciar la
función de contaje.
Todo flanco ascendente del resultado de pista disminuye en 1 el valor de contaje de la pista
correspondiente.
Mientras el valor de contaje de la pista de leva de contaje no sea 0, el bit indicador de la pista
se mantiene en 0.
Si el valor de contaje alcanza el valor 0, el bit indicador de la pista se activa y, con la
parametrización correspondiente, la señal de la pista (Página 472) se activa.
Con el siguiente flanco descendente del resultado de pista (todas las levas de esta pista están
desactivadas) el bit identificador de la pista se desactiva de nuevo y el contador regresa de
nuevo al valor de contaje predeterminado.
La siguiente figura muestra la conmutación de una pista de levas de contaje.
3LVWD
(VWDGRGHO
FRQWDGRU



/HYDV












%LWLGHQWLILFDGRUGHSLVWD
9DORUGHFRQWDMHVXSHULRUSDUDPHWUL]DGRHQORVGDWRVP£TXLQD 

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

469

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Pista de leva de freno
Para emplear la pista 2 como pista de leva de freno la entrada digital I0 tiene que estar
interconectada.
Con el flanco ascendente de la señal en I0 el bit identificador de la pista se activa de inmediato.
El bit identificador de la pista se desactiva de nuevo si
● en I0 no hay más señales "1" y posteriormente
● el flanco descendente del resultado de pista de la pista 2 se detecta.
La siguiente figura muestra la conmutación de una pista de levas de freno.
+DELOLWDFLµQGHOIUHQR

3XQWRGHIUHQDGR

,

/HYDV
3LVWD
%LWLGHQWLILFDGRU
GHSLVWD









DLGHQWLILFDQOHYDVTXHVHDSOLFDQDODSLVWDGHOHYDGHIUHQR

En el ejemplo el bit identificador de la pista se desactiva mediante los flancos descendentes de
las levas 3 o 4.

2.1.1.5

Histéresis

Definición
Una vibración mecánica en el eje puede provocar cambios en el valor real de la posición. Si el
valor real de la posición fluctúa en un flanco de una leva o dentro de una leva activa con un solo
sentido de actuación, esta leva se activará y desactivará de forma permanente. La histéresis
impide esta activación.
Una histéresis configurada depende del valor real y rige para todas las levas. Se activa en
cuanto se detecta un cambio de sentido. Una histéresis también es efectiva cuando no hay
ninguna leva en la posición actual del eje.

Reglas para el rango de histéresis
En el rango de histéresis se aplican las reglas siguientes:
● La histéresis siempre pasa a activa con un cambio de sentido.
● Dentro de la histéresis la indicación del valor real se mantiene constante.
● Dentro de la histéresis el sentido no se define de nuevo.
● Dentro de la histéresis una leva de recorrido ni se activa ni se desactiva.

470

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
● Dentro de la histéresis una leva de tiempo no se activa y una leva de recorrido activada se
desactiva en cuanto transcurre el tiempo de conexión parametrizado (no al final de la
histéresis).
● Tras abandonar el rango de histéresis el FM x52 determina:
– el valor real de la posición,
– el sentido de movimiento actual del eje,
– los estados actuales de todas las levas.
● El rango de histéresis rige para todas las levas.

Inversión de sentido en una leva con histéresis
En la tabla siguiente se muestra la respuesta de una leva cuando se produce un cambio de
sentido. Para ello es preciso diferenciar entre la respuesta de una leva de recorrido y una leva
de recorrido. El sentido de actuación de la leva es positivo.
Leva de recorrido
,/
      

Leva de tiempo
)/
 

,/
      

/HYDGHUHFRUULGR

+LVW«UHVLV

&DPELRGH
VHQWLGR
/HYDGHUHFRUULGR

La histéresis se activa tras la detección del cambio
de sentido. La leva se desactiva en cuanto se sale
de la histéresis.

 
/HYDGHWLHPSR

+LVW«UHVLV

&DPELRGH
VHQWLGR
/HYDGHWLHPSR

La leva se mantiene siempre activada durante el
tiempo de conexión parametrizado.

Leva
Histéresis

2.1.1.6

Ajuste dinámico

Tarea
El ajuste dinámico sirve para compensar los retardos de los elementos de conexión
conectados.

Tiempo de anticipación
El período de retardo se puede parametrizar como tiempo de anticipación que se puede
asignar a cada leva. Es posible especificar un tiempo de anticipación por leva. El tiempo de
anticipación se aplica al inicio y al fin de la leva.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

471

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Recorrido de anticipación
El recorrido de anticipación de una leva se calcula continuamente en función de la velocidad
actual y del tiempo de anticipación. Toda la leva se desplaza ese recorrido en la dirección del
valor real. El rango parametrizado se denomina "rango estático" y el rango calculado
atendiendo al tiempo de anticipación se llama "rango dinámico".
Recorrido de anticipación = tiempo de anticipación × velocidad actual del eje
El cálculo de los recorridos de anticipación de todas las levas se realiza dentro de 1/4 del
tiempo de anticipación más largo parametrizado en el FM x52.
Si se parametriza un tiempo de anticipación muy prolongado para una leva, se reduce la
dinámica del procesamiento de levas.

2.1.1.7

Interfaces de la leva

Vista general
Tomando como ejemplo el FM 352, la figura siguiente muestra las principales interfaces de la
leva electrónica para hacer más clara la relación entre datos, entradas y salidas. Las
diferencias respecto al FM 452 se muestran en la tabla que se incluye a continuación.
,

6H³DOHVGHOVHQVRU

'DWRVP£TXLQD

'%GHFDQDO

,

3LVWD

4D4

3
3LVWD


4

5

4

3LVWD

3LVWD

6

3LVWD

1

4D4

'DWRVGHOHYD

2

3LVWD

9DORUUHDOYHORFLGDGGLUHFFLµQ
%LWVLGHQWLILFDGRUHVGHOHYDGHODVOHYDV


)0

7
5HVXOWDGRGHSLVWD

472

%LWVLGHQWLILFDGRUHVGHSLVWD\GHOHYD\GDWRV

8
6H³DOHVGHSLVWD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Nº

①
②
③

④

⑤
⑥

⑦
⑧

Descripción
En el procesamiento de levas del FM x52 los bits identificadores de leva se calculan a partir de
las condiciones de conexión y el valor real actual. Por otra parte, los resultados de pista resultan
a partir de la asignación de las levas a las pistas.
Si se ha parametrizado la pista 0 ó 1 como pista de leva de contaje, el resultado de pista de la leva
(punto 1) se combina lógicamente con el resultado de contaje del bit identificador de la pista. Por
lo demás, el bit identificador de pista es igual al resultado de pista.
Si se ha parametrizado la pista 2 como pista de leva de freno, el resultado de pista de la leva
(Punto 1) se combina lógicamente con la entrada I0 del bit identificador de la pista. Por lo demás,
el bit identificador de pista es igual al resultado de pista.
Con los datos máquina es posible controlar si los bits identificadores de pista calculados hasta el
instante se transfieren a las pistas de 0 a 12 (en el FM 352) ó 0 a 15 (en el FM 452) de la leva
electrónica o, con independencia de ello, si se activan directamente con la habilitación de pista
(TRACK_EN).
Las señales de las pistas 0 a 12 (ó 0 a 15) se habilitan a través de TRACK_EN y la función de
contaje, a través de CNTC0_EN / CNTC1_EN.
FM 352:
La señal de pista de la pista 3 se puede combinar lógicamente con la entrada digital I3 mediante
la operación lógica AND, si se ha parametrizado esta posibilidad en los datos máquina
(EN_IN_I3).
FM 452:
Las señales de pista de las pistas 3 hasta 10 se pueden combinar lógicamente con las entradas
digitales I3 hasta I10 mediante la operación lógica AND, si se ha parametrizado esta posibilidad
en los datos máquina (EN_IN_I3 a EN_IN_I10).
Aquí (esto es, antes de combinarse con los datos máquina y los de canal) todos los bits identi‐
ficadores de pista y de leva se pueden leer con la petición ACTPOS_EN o CAMOUT_EN.
Para las pistas de 3 a 31 el bit identificador es igual al resultado de pista (punto 1).
FM 352:
Tras la conexión con los datos máquina (por ejemplo, tipo de eje, final de carrera por software,
recorrido por vuelta de encóder, ...) y los datos de canal, las señales de pista de las pistas de 0
a 12 están disponibles en las señales de realimentación. Las señales de las pistas 13 a 31 son
idénticas a los bits identificadores de pista del punto 7. Las señales de las pistas 0 a 12 también
están disponibles en las entradas digitales Q0 a Q12.
FM 452:
Tras la combinación lógica con los datos máquina y los datos de canal las señales de pista de las
pistas 0 a 15 están disponibles en las señales de realimentación. Las señales de las pistas 16 a
31 son idénticas a los bits identificadores de pista del punto 7. Las señales de las pistas 0 a 15
también están disponibles en las entradas digitales Q0 a Q15.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

473

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

2.1.1.8

Señales del encóder

Encóders compatibles
Encóders incrementales conectables
Se soportan encóders incrementales (Página 475) de dos impulsos con un desfase de 90º con
o sin señal de paso por cero:
● Encóder con señales de salida asimétricas con nivel de 24 V
– Frecuencia límite = 50 kHz
– Longitud del cable: máx. 100 m, apantallado
● Encóder con señales de salida simétricas con un puerto diferencial de 5 V según RS 422.
– Frecuencia límite = 1 MHz
– Con una alimentación de tensión de 5 V: Longitud del cable: máx. 32 m, apantallada
– Con una alimentación de tensión de 24 V: Longitud del cable: máx. 100 m, apantallado
Nota
Si el encóder de 5 V no emite ninguna señal de paso por cero y se ha activado la comprobación
de rotura de hilo, es preciso interconectar externamente las entradas de señal de paso por cero
N y /N para que estas entradas presenten un nivel distinto (p. ej. N a 5 V, /N a la masa).

Detectores de proximidad conectables
Los siguientes detectores de proximidad (Página 477) pueden conectarse al FM x52:
● Detectores de proximidad con nivel de 24 V (interruptores de proximidad)
● Frecuencia límite = 50 kHz
● Longitud del cable máx. 100 m

Encóders absolutos conectables
Se soportan encóders absolutos (Página 477) con interfaz serie. La transferencia de la
información de recorrido se realiza de forma síncrona según el protocolo SSI
(interfaz serialsíncrona). El FM x52 sólo soporta el código GRAY. Según la disposición de los
bits de datos en el telegrama resultan los formatos de datos "abeto", "medio abeto" y
"alineación derecha".
Entre los encóders absolutos se distingue entre
● Encóders monovuelta
Los encóders monovuelta reflejan el rango completo de medida en una vuelta del encóder.
● Encóders multivuelta
Los encóders multivuelta reflejan el rango completo de medida en varias vueltas del
encóder.

474

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Tipo de encóder

Longitud/tipo de telegrama

Encóder monovuelta

13 bits medio abeto

Encóder monovuelta

13 bits alineación derecha

Encóder monovuelta

25 bits alineación derecha

Encóder multivuelta

25 bits abeto

Encóder multivuelta

25 bits alineación derecha

Escuchar

Abeto

Escuchar

alineación derecha

Ajuste especial:
Encóder multivuelta como encóder monovuel‐ 25 bits medio abeto
ta

La velocidad de la transferencia de datos depende de la longitud del cable:
● Máx. 125 kHz con 320 m longitud de cable apantallado
● Máx. 250 kHz con 160 m longitud de cable apantallado
● Máx. 500 kHz con 60 m longitud de cable apantallado
● Máx. 1 MHz con 20 m longitud de cable apantallado

Encóder incremental
Formas de señal
La figura siguiente muestra las formas de señal de los encóders con señales de salida
asimétricas y simétricas.
$VLP«WULFD
$

6LP«WULFD
$
$

%

%
%

1

1
1

Evaluación de señales
Incrementos

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

475

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Un incremento identifica un período de señal de las dos señales A y B de un encóder. Este
valor se indica en las especificaciones técnicas de un encóder y/o en su placa de
características.
La figura siguiente muestra la relación de incrementos e impulsos.
3HULRGRGHVH³DO LQFUHPHQWR

$

%









3XOVRV

(YDOXDFLµQFX£GUXSOH

Impulsos
El FM x52 evalúa los 4 flancos de las señales A y B de cada incremento (evaluación
cuádruple).
1 incremento (dado por el encóder) = 4 impulsos (evaluación FM)

Tiempos de respuesta
El FM x52 tiene los tiempos de respuesta siguientes para encóders incrementales conectados:
● Tiempo mínimo de respuesta = tiempo de ciclo de leva + tiempo de conexión de los
elementos conectados
● Tiempo máximo de respuesta = 2 × tiempo de ciclo de leva + tiempo de conexión de los
elementos conectados

Ejemplo de tiempos de respuesta
Ejemplo del tiempo de respuesta mínimo y máximo con un alcance de 16 levas:
● Tiempo de ciclo de la leva: aprox. 20 µs
● Tiempo de conexión del hardware: aprox. 150 µs
Tiempo de respuesta mínimo = 20 µs + 150 µs = 170 µs
Tiempo de respuesta máximo = 2 × 20 µs + 150 µs = 190 µs
Nota
El tiempo de respuesta se puede compensar mediante una parametrización adecuada de las
levas o bien mediante el ajuste dinámico.

476

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Imprecisión
La imprecisión es la diferencia entre el tiempo de respuesta máximo y mínimo. En los encóders
incrementales:
Imprecisión = tiempo de ciclo de la leva
Nota
Si es posible discriminar el tiempo de conexión de hardware en el FM x52 y el tiempo de
conexión de los elementos conectados, se puede asegurar una activación segura de la leva
cuando es más larga que el recorrido que realiza dentro del tiempo de ciclo de la leva.

Detectores de proximidad
Definición
Los detectores de proximidad son interruptores simples sin información de sentido, los cuales
emiten impulsos. El sentido se indica con los datos máquina de "sentido del detector de
proximidad".
PRECAUCIÓN
Se pueden producir daños materiales.
Una indicación de sentido incorrecta puede causar fallos muy graves en la instalación (p. ej.
causados por un control erróneo de grupos eléctricos).
Compruebe la indicación de sentido en la puesta en servicio y cada vez que cambie un
detector de proximidad.

Interpretación de la señal
En un detector de proximidad, se cuenta el flanco ascendente de la señal A*.

Encóders absolutos (SSI)
Evaluación de impulsos del encóder absoluto
1 incremento (dado por el encóder) = 1 impulso (evaluación FM)

Escuchar
"Escuchar" significa: Un encóder absoluto se utiliza paralelamente en dos módulos (p.ej.
FM x51 y FM x52). El módulo de posicionamiento FM x51 es el módulo maestro y envía
impulsos al encóder absoluto; la leva electrónica FM x52 es esclavo y escucha las señales del
telegrama SSI.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

477

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Ajuste "Incrementos/Vuelta del encóder" y "Número de vueltas" en la configuración del
maestro. La "velocidad de transferencia" no es relevante. En "Longitud del telegrama"
seleccione, según el tipo de encóder, "Escuchar" o "Escuchar en alineación derecha".

Tiempos de respuesta
El FM x52 tiene los siguientes tiempos de respuesta para encóders absolutos:
● Tiempo mínimo de respuesta = tiempo de ejecución de telegramas + tiempo de ciclo de
levas + tiempo de conexión de los elementos conectados
● Tiempo máximo de respuesta = 2 × tiempo de ejecución de telegramas + tiempo
monoestable + 2 × tiempo de ciclo de leva + tiempo de conexión de los elementos
conectados
● En el caso de encóders absolutos programables:
Tiempo máximo de respuesta = tiempo de ejecución de telegramas + tiempo monoestable
+ 2 × tiempo de ciclo de leva + tiempo de conexión de los elementos conectados + 1/
frecuencia de pasos máx.

Tiempo monoestable
Para el tiempo monoestable rigen los valores límite siguientes:
● Tiempo monoestable mínimo: > 15 µs
● Tiempo monoestable máximo: < 64 µs
Los encóders con valores fuera de los límites que aquí se indican no son admisibles.

Tiempos de ejecución de telegramas
Los tiempos de ejecución de telegramas dependen de la velocidad de transferencia:
Velocidad de transfe‐ Tiempo de ejecución de telegramas a
rencia
13 bits

Tiempo de ejecución de telegramas a
25 bits

0,125 MHz

112 µs

208 µs

0,250 MHz

56 µs

104 µs

0,500 MHz

28 µs

52 µs

1,000 MHz

14 µs

26 µs

Ejemplo de tiempos de respuesta
Este ejemplo muestra cómo calcular el tiempo de respuesta máximo y mínimo. En el ejemplo
no se emplea ningún encóder programable.
● Tiempo de ciclo de la leva: aprox. 20 µs con máx. 16 levas
● Tiempo de conexión del hardware: aprox. 150 µs
● Tiempo de ejecución de telegramas: 26 µs a una velocidad de transferencia de 1 MHz
(telegramas de 25 bits)
● Tiempo monoestable: 20 µs (según el encóder: normalmente 20 - 40 µs)

478

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Tiempo de respuesta mínimo = 26 µs + 20 µs + 150 µs = 196 µs
Tiempo de respuesta máximo = 2 × 26 µs + 20 µs + 2 × 20 µs + 150 µs = 262 µs
Nota
El tiempo de respuesta se puede compensar mediante una parametrización adecuada de las
levas o bien mediante el ajuste dinámico.

Imprecisión
La imprecisión es la diferencia entre el tiempo de respuesta máximo y mínimo.
En el caso de un encóder absoluto es:
● Imprecisión = tiempo de ciclo de leva + tiempo de ejecución de telegrama + tiempo
monoestable
En el caso de los encóders absolutos programables es:
● Imprecisión = tiempo de ciclo de leva + tiempo de ejecución de telegrama + tiempo
monoestable
+ 1/frecuencia de pasos máx.
Nota
Si es posible discriminar el tiempo de conexión de hardware en el FM x52 y el tiempo de
conexión de los elementos conectados, se puede asegurar una activación segura de la leva
cuando es más larga que el recorrido que realiza dentro del tiempo de ciclo de la leva.

2.1.2

Funciones de FM x52

2.1.2.1

Escribir y activar los datos máquina

Escribir y activar los datos máquina
Con los datos máquina se adapta el FM x52 al eje y al encóder.
El programa de usuario permite modificar los parámetros durante el funcionamiento.
Todos los parámetros se depositan en el DB de parámetros:
● Los datos máquina se encuentran en el DB de parámetros, en las direcciones que van del
3.1 al 104.0.
El número del DB de parámetros se tiene que registrar en el DB de canal correspondiente en
cada caso.
Los parámetros pueden introducirse con el editor DB, o bien introducirse cómodamente en los
cuadros de diálogo "Sistema de medición", "Eje", "Encóder" y "Pistas" y se escriben con la
función "Exportar" en el DB de parámetros.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

479

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Los parámetros de un DB de parámetros existente pueden importarse a los cuadros de diálogo
con la función "Importar".

Primera parametrización
Si el módulo todavía no contiene ningún dato máquina (señal de realimentación PARA = 0),
proceda del siguiente modo para una primera parametrización sin el cuadro de diálogo de
parametrización:
1. Introduzca los nuevos valores en el DB de parámetros.
2. Cargue el DB de parámetros en la CPU.
3. Active el bit de inicio siguiente en el DB de canal:
– Escribir datos máquina (MDWR_EN = 1)
4. Llame las instrucciones CAM_CTRL o CAM_CTRL_452 en el programa de usuario cíclico.

Modificar datos máquina
Para modificar datos máquina existentes (señal de realimentación PARA = 1) mediante el
programa de usuario proceda del siguiente modo:
1. Introduzca los nuevos valores en el DB de parámetros.
2. Active los bits de inicio en el DB de canal:
– Escribir datos máquina (MDWR_EN = 1)
– Activar datos máquina (MD_EN = 1)
3. Llame las instrucciones CAM_CTRL o CAM_CTRL_452 en el programa de usuario cíclico.
4. Compruebe si los datos de leva hasta el instante son compatibles con los datos máquina
modificados.
5. En cualquier caso, escriba de nuevo los datos de las levas parametrizadas, modificados o
no (CAM1WR_EN … CAM8WR_EN).
Si se definen los bits de inicio al mismo tiempo, la instrucción CAM_CTRL o CAM_CTRL_452
se encarga de que las peticiones se procesen en la secuencia correcta.
De lo contrario, se deberán cambiar siempre los datos máquina en la siguiente secuencia:
1. Escribir datos máquina
2. Activar datos máquina

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

Valor inicial

Comentario

35.0

MDWR_EN

BOOL

FALSE

1 = Escribir datos máquina

35.1

MD_EN

BOOL

FALSE

1 = Activar datos máquina

480

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Nota
Si se han modificado parámetros relevantes para la sincronización, al activar los datos
máquina se borra la sincronización. Además, las funciones se restauran y todos los datos
máquina y los datos de leva del módulo se borran.
Son parámetros relevantes para la sincronización:
● Tipo de eje
● Final del eje rotativo
● Tipo de señal
● Recorrido por vuelta
● Incrementos por vuelta
● Cantidad vueltas
● Coordenada del punto de referencia
● Reajuste del encóder absoluto
● Forma de redisparar el punto de referencia
● Adaptación del sentido
● Alcance
● Inicio y fin del final de carrera por software

2.1.2.2

Leer datos máquina

Leer datos máquina
Para leer los datos máquina actuales del módulo proceda del modo siguiente:
1. Active el bit de inicio siguiente en el DB de canal:
– Leer datos máquina (MDRD_EN = 1)
2. Llame las instrucciones CAM_CTRL o CAM_CTRL_452 en el programa de usuario cíclico.
De este modo se depositan en la CPU los datos máquina del DB de parámetros.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

37.1

MDRD_EN

BOOL

FALSE

1 = Leer datos máquina

2.1.2.3

Escribir datos de leva

Escribir datos de leva
Con los datos de leva se define el modo y el funcionamiento de las levas así como su
asignación a las pistas.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

481

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Los datos de leva se encuentran en el DB de parámetros a partir de la dirección 108.0. Se
encuentran agrupados en paquetes de 16 levas cada uno.
Los datos de la leva están activos inmediatamente después de su escritura.
Para escribir los datos de leva sin cuadro de diálogo de parametrización proceda del siguiente
modo:
1. Introduzca los nuevos valores en el DB de parámetros.
2. Cargue el DB de parámetros en la CPU.
3. Active los bits de inicio en el DB de canal (CAM1WR_EN … CAM8WR_EN)
4. Llame las instrucciones CAM_CTRL o CAM_CTRL_452 en el programa de usuario cíclico.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

Valor inicial

Comentarios

35.3

CAM1WR_EN

BOOL

FALSE

1 = Escribir datos de leva 1 (levas de 0 a 15)

35.4

CAM2WR_EN

BOOL

FALSE

1 = Escribir datos de leva 2 (levas de 16 a 31)

35.5

CAM3WR_EN

BOOL

FALSE

1 = Escribir datos de leva 3 (levas de 32 a 47)

35.6

CAM4WR_EN

BOOL

FALSE

1 = Escribir datos de leva 4 (levas de 48 a 63)

35.7

CAM5WR_EN

BOOL

FALSE

1 = Escribir datos de leva 5 (levas de 64 a 79)

36.0

CAM6WR_EN

BOOL

FALSE

1 = Escribir datos de leva 6 (levas de 80 a 95)

36.1

CAM7WR_EN

BOOL

FALSE

1 = Escribir datos de leva 7 (levas de 96 a 111)

36.2

CAM8WR_EN

BOOL

FALSE

1 = Escribir datos de leva 8 (levas de 112 a 127)

2.1.2.4

Leer los datos de leva

Leer datos de leva
Para leer los datos de leva actuales del módulo proceda del modo siguiente:
1. Active el bit de inicio siguiente en el DB de canal:
– Leer los datos de leva (CAM1RD_EN … CAM8RD_EN)
2. Llame las instrucciones CAM_CTRL o CAM_CTRL_452 en el programa de usuario cíclico.
De este modo se depositan en la CPU los datos de leva del DB de parámetros.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

37.2

CAM1RD_EN

BOOL

FALSE

1 = Leer datos de leva 1 (levas de 0 a 15)

37.3

CAM2RD_EN

BOOL

FALSE

1 = Leer datos de leva 2 (levas de 16 a 31)

37.4

CAM3RD_EN

BOOL

FALSE

1 = Leer datos de leva 3 (levas de 32 a 47)

37.5

CAM4RD_EN

BOOL

FALSE

1 = Leer datos de leva 4 (levas de 48 a 63)

37.6

CAM5RD_EN

BOOL

FALSE

1 = Leer datos de leva 5 (levas de 64 a 79)

482

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Dirección

Nombre

Tipo

valor inicial

Comentarios

37.7

CAM6RD_EN

BOOL

FALSE

1 = Leer datos de leva 6 (levas de 80 a 95)

38.0

CAM7RD_EN

BOOL

FALSE

1 = Leer datos de leva 7 (levas de 96 a 111)

38.1

CAM8RD_EN

BOOL

FALSE

1 = Leer datos de leva 8 (levas de 112 a 127)

2.1.3

Uso del FM 352

2.1.3.1

Asignación de terminales de los conectores frontales del FM 352

Descripción de la interfaz del encoder
Posición del conector hembra sub-D
En la figura siguiente se muestra la posición de montaje y el nombre del conector hembra del
módulo. En el conector hembra sub-D se puede conectar un detector de proximidad, un
encóder incremental o un encóder absoluto (SSI).




(1&2'(5;
)0




Asignación de la interfaz del encóder (X2)
Pin

Nombre

1

A*

2

CLS

---

---

Pulso de desplazamiento
SSI

3

/CLS

---

---

Pulso de desplazamiento
SSI inverso

4

B*

---

Señal de encoder B (24 V) ---

5

DC 24 V

6

DC 5.2 V

7

M

8

N*

---

Señal de marca cero (24 V) ---

9

RE

---

Salida tipo PNP/NPN 2)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Detector de proxi‐
midad

Encoder incremental

Señal de encoder A (24 V)

Encóder absoluto
---

Alimentación del sensor 24 V
---

Alimentación del sensor 5,2 V
Masa
---

483

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Pin

Nombre

Detector de proxi‐
midad

Encoder incremental

10

N

---

Señal de marca cero (5 V) ---

11

/N

---

Señal de marca cero inver‐ --tida (5 V)

12

/B / /CLI 1)

---

Señal del sensor B (5 V)
invertida

Pulso de desplazamiento
SSI inverso

13

B / CLI 1)

---

Señal del sensor B (5 V)

Pulso de desplazamiento
SSI

14

/A / /DAT

---

Señal de encoder A (5 V)
invertida

Datos SSI invertidos

15

A / DAT

---

Señal del sensor A (5 V)

Datos SSI

1)

Encóder absoluto

En modo de escucha

Nota: si se conecta un encóder incremental de otro fabricante en contrafase (salida tipo PNP/NPN),
debe tenerse en cuenta lo siguiente:

2)

● Salida tipo PNP: conecte RE (9) con la masa (7).
● Salida tipo NPN: conecte RE (9) con +24 V (5).

Asignación del conector frontal
Conector frontal
En el conector frontal de 20 polos se conectan:
● las salidas digitales y los elementos de conexión (entradas);
● la tensión de alimentación de los encóders y de las salidas digitales.

Asignación de terminales del conector frontal (X1)
La tabla siguiente contiene la asignación de terminales del conector frontal del FM 352.

484

Terminal

Nombre

Función

1

L+

Alimentación del encoder DC 24 V y salidas digitales

2

M

Masa de la alimentación del encoder y salidas digitales

3

I0

Habilitación del freno

4

I1

Medición de longitud/Detección de bordes/Ajustar valor real al vuelo

5

I2

Sensor del punto de referencia

6

I3

Habilitación de la señal de pista 3

7

Q0

Salida digital 0

8

Q1

Salida digital 1

9

Q2

Salida digital 2

10

Q3

Salida digital 3

11

Q4

Salida digital 4

12

Q5

Salida digital 5

13

Q6

Salida digital 6

14

Q7

Salida digital 7

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Terminal

Nombre

Función

15

Q8

Salida digital 8

16

Q9

Salida digital 9

17

Q 10

Salida digital 10

18

Q 11

Salida digital 11

19

Q 12

Salida digital 12

20

–

–

Encontrará más información sobre el diseño y el cableado en las instrucciones de servicio
(http://support.automation.siemens.com/WW/view/es/2103044) de la leva electrónica FM 352.

Tensión auxiliar para el encoder y las salidas digitales (L+, M)
La tensión auxiliar DC 24 V del encoder y las salidas digitales se supervisa:
● por si hay una rotura de hilo en la línea de 24 V
● por si se corta la alimentación.
En la interfaz del encóder (conector hembra sub-D X2) se proporcionan DC 24 V y DC 5,2 V
para los diferentes tipos de encóder.

Alimentaciones de carga
La alimentación de la carga DC debe satisfacer los siguientes requisitos:
Como alimentación de la carga sólo debe utilizarse una pequeña tensión DC ≤ 60 V separada
con seguridad de la red. La separación segura puede estar efectuada según los requisitos que
figuran, entre otros, en:
● VDE 0100 Parte 410/HD 384-4-41/IEC 364-4-41
(como pequeña tensión funcional con separación segura),
● VDE 0805/EN 60950/IEC 950
(como pequeña tensión de seguridad SELV) o bien
● VDE 0106 Parte 101.

4 entradas digitales (de I 0 a I 3)
En las 4 entradas digitales es posible conectar conectores libres de rebotes (de 24 V tipo P) o
sensores sin contacto (detectores de proximidad de 2 ó 3 hilos).
Las entradas digitales no se supervisan si presentan cortocircuito o rotura de hilos y carecen
de aislamiento galvánico respecto de la masa del módulo.

13 salidas digitales (de Q 0 a Q 12)
Por medio de 13 salidas digitales se indica el estado correspondiente (on/off) de las pistas
entre 0 y 12. Las salidas digitales carecen de aislamiento galvánico respecto a la masa del
módulo.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

485

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Son posibles las cargas siguientes:
● Tensión de trabajo 24 V
● Carga de corriente 0,5 A/resistente al cortocircuito
El estado de cada salida se indica en el LED correspondiente.

2.1.3.2

Funciones de control de levas

Influencia de las funciones en el comportamiento de conmutación de las levas de tiempo
Cambios en el valor real
Es posible obviar una leva de tiempo con funciones que modifiquen el valor real:
● Ajustar valor real
● Ajustar valor real al vuelo
● Decalaje de señal cero
● Redisparar el punto de referencia

Activación de una leva de tiempo
Si se obvia el principio de una leva de tiempo mediante una de las funciones arriba
mencionadas, esta leva se activará siempre y cuando el sentido real del movimiento del eje se
corresponda con el sentido de actuación parametrizado para la leva. El tiempo de conexión
parametrizado se cuenta.
Nota
En posición de parada, el sentido del movimiento depende de las fluctuaciones del valor real.
Si desea tener en cuenta un sentido de movimiento definido también en posición de reposo,
deberá parametrizar una histéresis mayor que las fluctuaciones del valor real en reposo.
Si el eje no está en movimiento, se conserva el último sentido de movimiento calculado.
ADVERTENCIA
Se pueden producir daños personales y materiales.
Las funciones con modificación del valor real en un eje rotativo pueden conducir a una
activación no deseada de las levas de tiempo.
En cualquier caso, con un eje rotativo ajuste las levas de tiempo como "no válidas" a fin de
influir en el valor real mediante las funciones arriba indicadas.

486

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Ajustar valor real / Ajustar valor real al vuelo / Cancelar preselección del valor real
Definición
Las funciones "Ajustar valor real", "Ajustar valor real al vuelo" permiten asignar una nueva
coordenada al estado actual del encóder. Así, el sistema de coordenadas se desplaza en el
valor: REALnuevo - REALactual
Donde:
● REALnuevo es el valor especificado
● REALactual es el valor real en el instante de la ejecución

Calcular coordenadas nuevas
Todas las posiciones especificadas en el sistema de coordenadas desplazado se calculan con
la fórmula siguiente:
Coordenadanueva = Coordenadaantigua + (REALnuevo - REALactual)

Requisitos
● El eje tiene que estar sincronizado.
● En "Ajustar valor real al vuelo": La entrada digital I1 tiene que estar interconectada.

Desarrollo de la función
1. Introduzca las coordenadas para el valor real o para el valor real al vuelo en el DB de canal.
– Eje lineal:
El valor real indicado se debe seleccionar de tal modo que los finales de carrera por
software se encuentren todavía dentro de la zona de desplazamiento admitido tras
llamar la función.
El valor de decalaje que resulta de (REALnuevo - REALactual) tiene que ser menor o igual
al valor de la zona de desplazamiento admisible (máximo 100 m o 1000 m,
respectivamente).
– Eje rotativo:
Para el valor real indicado rige:
0 ≤ Valor real < Final del eje rotativo
2. Active los correspondientes bits de inicio en el DB de canal.
3. Llame la instrucción CAM_CTRL.
Se ejecuta de inmediato "Ajustar valor real".
"Ajustar valor real al vuelo" se ejecuta con el flanco ascendente siguiente en la entrada
digital I1. El bit FVAL_DONE se activa.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

487

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

36.4

AVAL_EN

BOOL

FALSE

1 = Ajustar valor real

36.5

FVAL_EN

BOOL

FALSE

1 = Ajustar valor real al vuelo

90.0

AVAL

DINT

L#0

Coordenada para valor real

94.0

FVAL

DINT

L#0

Coordenada para valor real al vuelo

25.5

FVAL_DONE

BOOL

FALSE

1 = Ejecutado Ajustar valor real al vuelo

Efectos de la función
En el ejemplo "Ajustar valor real" a 400 mm (en la posición 200 mm) se muestra cómo esta
función provoca un decalaje del sistema de coordenadas. De ello resultan los siguientes
efectos:
● La posición de la zona de trabajo no se desplaza físicamente.
● A cada uno de los puntos (como, p.ej. a los finales de carrera por software) se les asignan
nuevos valores de coordenadas.
● Las levas conservan sus valores de coordenadas y, por lo tanto, se encuentran en otra
posición física.
● En el caso del eje sincronizado y procesamiento de levas habilitado, el valor real de la
posición puede obviar flancos de levas o levas completas mediante esta función.
● El cambio de estado de la leva que normalmente dispararía una alarma se podría perder.
Nota
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 486).

La tabla siguiente muestra el decalaje del sistema de coordenadas con "Ajustar valor real" /
"Ajustar valor real al vuelo".
Ajustar valor real

)&6, 5()


5($ )&6)










REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-400

-200

200

400

-200

0

400

600

6LVWHPDGHFRRUGHQDGDVDQWHULRU



>PP@

'HVSOD]DPLHQWR
GHOVLVWHPDGH
FRRUGHQDGDV
HQPP
$MXVWDUYDORUUHDO
DPP

UHDGHWUDEDMR

(MH

FCSI

>PP@
1XHYRVLVWHPDGHFRRUGHQDGDV

488

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Deshacer la función
Con la función "Cancelar preselección del valor real" se deshace el decalaje de coordenadas
establecido respectivamente con "Ajustar valor real" o "Ajustar valor real al vuelo".
Un "Ajustar valor real al vuelo" iniciado no se puede borrar antes de su ejecución mediante un
flanco ascendente en la entrada I1. Pero sí puede sobrescribirse con un nuevo "Ajustar valor
real al vuelo".
Con un arranque del módulo se inicializan estas funciones.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

Valor inicial

Comentario

35.2

AVALREM_EN

BOOL

FALSE

1: Deshacer Ajustar valor real

Posibles fuentes de error
"Ajustar valor real al vuelo" y "Redisparar punto de referencia" no deben ejecutarse de forma
simultánea.
Con la función "Ajustar valor real al vuelo" puede notificarse un error de operador si esta
función implica que un final de carrera por software excede la zona de desplazamiento
admisible con un flanco ascendente en I1. Este error de operador se notifica con una alarma
de diagnóstico y queda registrado en el búfer de diagnóstico.

Ejecutar un decalaje de señal cero
Definición
Con la función "Decalaje de señal cero" se desplaza en el valor introducido la señal cero del
sistema de coordenadas. El signo define la dirección del decalaje.

Calcular nueva coordenada
Todos los valores del sistema de coordenadas desplazado se calculan con la fórmula
siguiente:
Coordenadanueva = coordenadaantigua + (DSCnueva - DSCantigua)
DSCantigua indica un decalaje anterior de señal cero. Si antes de la llamada no ha habido activo
ningún decalaje de señal cero, introduzca para DSCantiguo el valor 0.
Con esta fórmula es posible calcular qué valores de coordenadas adoptan, por ejemplo, los
finales de carrera por software.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

489

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Desarrollo de la función
1. Introduzca el valor del decalaje de señal cero en el DB de canal.
– Eje lineal:
El decalaje de señal cero se tiene que escoger de tal modo que los finales de carrera por
software se encuentren todavía dentro de la zona de desplazamiento admisible tras la
llamada de la función.
– Eje rotativo:
Para el decalaje de señal cero rige:
Valor del decalaje de señal cero ≤ Fin del eje rotativo.
2. Active el bit de inicio correspondiente.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

36.6

ZOFF_EN

BOOL

FALSE

1 = Activar decalaje de señal cero

86.0

ZOFF

DINT

L#0

Decalaje de señal cero

Efectos en un eje lineal
En el ejemplo de un decalaje de señal cero de -200 mm se ve cómo esta función desplaza el
sistema de coordenadas en sentido positivo. De ello resultan los siguientes efectos:
● La zona de trabajo no se desplaza físicamente.
● A cada uno de los puntos (como, p.ej. a los finales de carrera por software) se les asignan
nuevos valores de coordenadas.
● Las levas conservan sus valores de coordenadas y, de este modo, se encuentran en otra
posición física.
● En el caso del eje sincronizado y procesamiento de levas habilitado, el valor real de la
posición puede obviar flancos de levas o levas completas mediante esta función.
● El cambio de estado de la leva que normalmente dispararía una alarma, se puede perder.
Nota
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 486).

490

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra el desplazamiento del sistema de coordenadas mediante el
decalaje de señal cero.
Decalaje de señal cero

FCSI

REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-400

-200

200

400

-200

0

400

600

6LVWHPDGHFRRUGHQDGDVDQWHULRU
)&6,

5($/ )&6)








>PP@

'HFDODMHGH
FRRUGHQDGDVHQ
PPSRU
GHFDODMHGH
VH³DOFHURGH
PP

=RQDGHWUDEDMR

(MH



>PP@





1XHYRVLVWHPDGHFRRUGHQDGDV

Efectos en un eje rotativo
En el ejemplo de un decalaje de señal cero en -45° se ve cómo esta función gira el sistema de
coordenadas:
La tabla siguiente muestra el giro del sistema de coordenadas mediante el decalaje de señal
cero.
Herramienta con REAL = 340°

Herramienta con REAL = 25°
'6& r

9$/ r
B

9$/ r

B

r

r

La señal cero gira -45 grados. Todos los puntos del eje adquieren nuevos valores de coordenada.

Considerando un DSCantiguo = 0 resulta un nuevo valor de 385°
Como al final del eje rotativo en un sentido de giro positivo el valor real empieza de nuevo en
0 el valor real de 25º se calcula a partir de:
Coordenadanueva = coordenadaantigua - (DSCnueva - DSCantigua) -final de eje rotativo

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

491

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
El valor Final del eje rotativo sólo tiene que restarse si
Coordenadaantigua - (DSCnueva - DSCantigua) es mayor que Final del eje rotativo.

Pérdida de la sincronización
Si se pierde la sincronización a causa de un error o se reactiva mediante "Redisparar punto de
referencia" se mantiene activo un decalaje de señal cero.

Deshacer función
Al definir un decalaje de señal cero de 0 se recupera el decalaje de señal cero existente.

Definir punto de referencia
Definición
Con la función "Definir punto de referencia" se sincroniza el eje. Esta función desplaza la zona
de trabajo. Todos los decalajes generados por decalaje de señal cero o con "Ajustar valor real"
se conservan.
La función proyecta la zona de trabajo sobre el eje. Así, con distintas entradas de valores la
zona de trabajo puede encontrarse en posiciones diferentes dentro del rango físico del eje.

Requisitos
Es preciso que el procesamiento de levas esté desactivado.

Desarrollo de la función
1. Introduzca el valor de las coordenadas del punto de referencia en el DB de canal.
– Eje lineal:
La coordenada del punto de referencia no puede encontrarse fuera de los finales de
carrera por software. Esto rige también para la coordenada del punto de referencia de
un sistema de coordenadas desplazado.
– Eje rotativo:
Para la coordenada del punto de referencia rige:
0 ≤ Coordenada del punto de referencia < Final del eje rotativo
2. Active el bit de inicio correspondiente.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

36.3

REFPT_EN

BOOL

FALSE

1 = Definir coordenada del punto de referencia

98.0

REFPT

DINT

L#0

Coordenada del punto de referencia

25.0

SYNC

BOOL

FALSE

1 = Eje sincronizado

492

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Efectos de la función
En el ejemplo "Definir punto de referencia" a 300 mm se ve cómo esta función desplaza la zona
de trabajo en el eje.
De ello resultan los efectos siguientes:
● La posición real se fija en el valor de la coordenada del punto de referencia.
● La zona de trabajo se desplaza físicamente en el eje.
● Cada uno de los puntos conserva sus coordenadas originales pero se encuentran en
posiciones físicas nuevas.
● El bit SYNC en las señales de realimentación está activado.
La tabla siguiente muestra el desplazamiento de la zona de trabajo en el eje a través de la
función "Definir punto de referencia".
Definir punto de referencia

)&6,

5($/



HWU
DG
=RQ







REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-400

-200

100

400

-400

-200

300

400

6LVWHPDGHFRRUGHQDGDVDQWHULRU
)&6)


>PP@

'HFDODMH
GHOD]RQD
GHWUDEDMRSRU
ಯSUHVHOHFFGHO
SWRGHUHIDPP

DED

(MH

MR

 

FCSI

>PP@

1XHYRVLVWHPDGHFRRUGHQDGDV

Particularidades del encóder absoluto
Esta función es necesaria para un reajuste del encóder absoluto (Página 516).

Modificar flancos de leva
Definición
Con la función "Modificar flancos de leva" es posible modificar durante el funcionamiento el
principio de leva y, en el caso de las levas de recorrido, también el final de leva de una leva
individual.

Requisitos
La leva que se quiera modificar tiene que ser válida.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

493

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Desarrollo de la función
1. Escriba el número de leva en el DB de canal.
2. En una leva de recorrido:
Escriba el inicio de leva y el fin de leva en el DB de canal.
En una leva de recorrido:
Introduzca el valor del inicio de leva en el DB de canal.
3. Active el bit de inicio correspondiente.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

36.7

CH01CAM_EN

BOOL

FALSE

1 = Escribir función para flanco de leva (1 leva)

102.0

CAM_NO

INT

0

Número de leva

104.0

CAM_START

DINT

L#0

Inicio de leva

108.0

CAM_END

DINT

L#0

Fin de leva

Efectos de la función
El FM x52 desplaza primero el flanco de activación y luego el de desactivación de la leva. Este
proceso es independiente de la dirección en la que se desplace la leva.
Caso especial:
Con el proceso que se ha descrito anteriormente puede ocurrir que durante un breve tiempo
surja una leva invertida (Página 465) si el nuevo principio de leva es mayor que el antiguo fin
de leva.
La figura siguiente muestra la modificación de los flancos de levas en pasos individuales.

,/
PP

PP

494

$QWHVGHOD
OODPDGD

)/
PP
)/
$QWLJXR
PP

'XUDQWH
ODOODPDGD

,/ 1XHYR

,/

)/ PP

'HVSX«VGHOD
OODPDGD

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Nota
Si para esta leva se ha habilitado una alarma de proceso, al detectar la leva invertida el FM x52
puede disparar una o dos alarmas de proceso, según se haya parametrizado.
Con la modificación del flanco de activación y/o de desactivación se pueden producir saltos de
flancos de leva o de toda una leva.
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 486).
Los cambios de estado de la leva que normalmente dispararían una alarma de proceso, se
pueden perder.

Leer los valores modificados
Los valores modificados se pueden leer con una de las peticiones CAM1RD_EN a
CAM8RD_EN.

Deshacer la función
Los valores modificados se pierden al reiniciar el módulo.

Ejecutar "Cambio rápido de levas"
Definición
Con la función "Cambio rápido de levas" es posible modificar simultáneamente los datos de
hasta 16 levas durante el funcionamiento.

Requisito
Las levas que se quieran modificar tienen que ser válidas.

Desarrollo de la función
1. Introduzca el número de levas que hay que modificar en el DB de canal.
2. Introduzca el número de levas que hay que modificar en el DB de canal.
3. Active los bits de inicio para los cambios deseados.
4. Introduzca los nuevos valores en el DB de canal.
5. Repita los pasos de 2 a 4 para cada leva que tenga que modificarse.
6. Active el bit de inicio correspondiente en el DB de canal

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

495

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

Absoluta
37.0

CH16CAM_EN

BOOL

FALSE

1 = Función para un cambio rápido de levas (16 levas)

176.0

C_QTY

BYTE

B#16#0

Número de levas a modificar

177.0

DIS_CHECK

BOOL

FALSE

1 = Desactivar la comprobación de datos

Dirección

Nombre

Tipo

valor inicial

Comentarios

+0.0

CAM_NO

BYTE

B#16#0

Número de la leva a modificar

+1.0

C_EFFDIR

BOOL

FALSE

1 = Cambio del sentido de actuación de la leva

+1.1

C_CBEGIN

BOOL

FALSE

1 = Cambio del inicio de la leva al valor CBEGIN

+1.2

C_CEND

BOOL

FALSE

1 = Cambio del final de leva/tiempo de conexión al valor
CEND

+1.3

C_LTIME

BOOL

FALSE

1 = Cambio del tiempo de anticipación al valor LTIME

+1.4

CAM_OFF

BOOL

FALSE

1 = Desactivación de la leva durante el cambio de leva

+1.5

EFFDIR_P

BOOL

FALSE

1 = Sentido de actuación positivo (+)

+1.6

EFFDIR_M

BOOL

FALSE

1 = Sentido de actuación negativo (-)

+2.0

CBEGIN

DINT

L#0

Nuevo inicio de leva

+6.0

CEND

DINT

L#0

Nuevo fin de leva / Nuevo tiempo de conexión

+10.0

LTIME

INT

L#0

Nuevo tiempo de anticipación

relativa

Desactivar leva al modificar
Una modificación coherente del inicio y del final de la leva sólo es posible si en el instante de
la modificación se ha desactivado la leva (CAM_OFF).

Comprobación de datos por parte del módulo
Con el parámetro DIS_CHECK (DB de canal) se define si se tiene que desactivar la
comprobación de los datos transferidos a través del FM x52. Si se desactiva la comprobación
de datos es preciso asegurarse de que sólo se transfieren valores admisibles. Si introduce
valores no admisibles sin comprobación se puede producir un comportamiento impredecible
del módulo.
● FALSE: El módulo comprueba todos los datos que se transfieren
● TRUE: La comprobación de los datos en referencia a los parámetros de la leva está
desactivada. De este modo los datos que hay que modificar se incorporan más
rápidamente en el FM x52.
Independientemente de esta función siempre se comprueba si
– el eje está parametrizado,
– la cantidad de levas para modificar (C_QTY) es admisible,
– la leva (número de leva) que tiene que modificarse es válida.

496

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Sólo cuando todos los datos han sido comprobados y no se han detectado problemas, se
activan en el módulo.
En caso de error todos los datos se rechazan.

Efectos de la función
Nota
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 486).

Leer los valores modificados
Los valores modificados se pueden leer con una de las peticiones de CAM1RD_EN a
CAM8RD_EN.

Deshacer la función
Los valores modificados se pierden con el reinicio del módulo.

Ejecutar "Medición de longitud" y "Captura de bordes"
Definición
Con las funciones "Medición de longitud" y "Captura de bordes" es posible calcular la longitud
de una pieza de trabajo.
La medición de la longitud y la captura de bordes están y se mantienen activos hasta que se
desactivan de nuevo o se seleccionan otros métodos de medición. Si se seleccionan ambos
métodos de medición a la vez, la instrucción CAM_CTRL activa la medición de longitud.

Requisitos
En la entrada I1 tiene que estar conectado un conector libre de rebotes.

Desarrollo de las funciones
Según el tipo de medición, el FM 352 actualiza los datos del módulo en instantes distintos. El
FM 352 notifica cada actualización en un parámetro en la interfaz de realimentación.
Medición de longitud

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

497

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
065B21
O
$FWXDOL]DFLµQGHGDWRV
065B'21(

1. Active el selector de función de "Medición de longitud"
2. El flanco ascendente de la entrada I1 inicia la medición de longitud.
3. El flanco descendente de la entrada I1 pone fin a una medición en curso. El FM 352
actualiza los datos Valor inicial, Valor final y Longitud.
4. Con el parámetro activado MSR_DONE el FM 352 comunica la actualización de los datos.
El parámetro indica que la medición ha finalizado. Los resultados de la medición se pueden
leer.
5. El inicio de otra medición con el flanco ascendente de I1 desactiva el parámetro
MSR_DONE.
Si durante una medición de longitud se desactiva la función, el FM 352 no actualiza los datos.
El parámetro MSR_DONE se mantiene desactivado.
Captura de bordes
('*(B21
O
$FWXDOL]DFLµQGHGDWRV
065B'21(

1. Dado el caso, introduzca un valor para la separación mínima de bordes en el DB de
parámetros. Escriba y active los datos máquina.
2. Active el selector de función de "Captura de bordes". Se activa el parámetro MSR_DONE.
3. El flanco ascendente de la entrada I1 inicia la captura de bordes. Los resultados de la
medición se actualizan y se pueden leer, el valor inicial de la medición se registra; el valor
final y la longitud pasan a ser -1.
4. Tras la actualización, el FM 352 notifica el cambio desactivando el parámetro MSR_DONE.
5. El flanco descendente de la entrada I1 pone fin a una medición en curso. El FM 352
actualiza los datos del valor final de la medición y la longitud.
6. Tras la actualización, el FM 352 notifica el cambio activando el parámetro MSR_DONE. Los
resultados de la medición se pueden leer.
7. El inicio de otra medición con el flanco ascendente de I1 desactiva el parámetro
MSR_DONE.
Si durante una captura de bordes se desactiva la función, el FM 352 no actualiza los datos. El
parámetro MSR_DONE se mantiene desactivado.

498

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

25.1

MSR_DONE

BOOL

FALSE

1 = Medición de longitud cancelada

34.0

EDGE_ON

BOOL

FALSE

1 = Captura de bordes activada

34.2

MSR_ON

BOOL

FALSE

1 = Medición de longitud activada

38.2

MSRRD_EN

BOOL

FALSE

1 = Leer valores medidos

112.0

BEG_VAL

DINT

L#0

Valor inicial

116.0

END_VAL

DINT

L#0

Valor final

120.0

LEN_VAL

DINT

L#0

Longitud

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

4.0

EDGEDIST

DINT

L#0

Distancia mínima entre bordes en la captura de bordes
Rango de valores admisible:
● 0 ... 1 000 000 000 µm

En la captura de bordes, con la distancia mínima entre bordes se define un rango tras la
detección del inicio de la medición. Si el final del proceso de medición se encuentra dentro de
este rango, la medición se desestima.
El inicio de la medición se notifica en cuanto se ha recorrido la distancia mínima entre bordes.

Condiciones específicas para una medición de longitud
● La distancia entre el flanco de activación y el flanco de desactivación en la entrada I1 tiene
que ser tal que su programa en la CPU pueda evaluar correctamente el resultado de la
medición antes de iniciar otra.
● La distancia mínima entre el flanco ascendente y descendente en la entrada I1, al igual que
entre el flanco descendente y el siguiente ascendente en la entrada I1, tiene que ser mayor
que 2 ms.

Medición con errores
En caso de una medición de longitud/captura de bordes con errores, el FM 352 devuelve el
valor -1 para la longitud.
Una "Medición de longitud" o "Captura de bordes" debería ejecutar un máximo de 126 cambios
a cero en un sentido. Un cambio a cero es el cambio del eje rotativo del valor final del eje
rotativo a 0 y a la inversa. En cuanto el FM 352 detecta más de 126 pasos por cero en un
sentido, notifica una "Medición de longitud" o una "Captura de bordes" errónea, aunque luego
haya detectado nuevamente pasos por cero en el otro sentido.
Una medición también es errónea si
● en un eje rotativo la longitud medida es superior a 231 ,
● el FM 352 simultáneamente el flanco de activación y el de desactivación (p. ej. por rebotes
del conector).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

499

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Este evento se puede comunicar como alarma de proceso.

Desplazamiento del sistema de coordenadas durante una medición de longitud
Los desplazamientos de coordenadas afectan a la longitud medida bajo las condiciones
siguientes:
● Se utiliza un encóder incremental o un detector de proximidad, o bien el FM 352 en el modo
de simulación.
● Se ejecuta "Definir punto de referencia" o "Redisparar punto de referencia" durante una
medición de longitud.

Ejemplo
Es posible emplear la influencia arriba indicada de la longitud medida del modo que sigue:
Se dispone de un sistema en el que durante una medición de longitud siempre se produce un
deslizamiento.
Con el "redisparo del punto de referencia" es posible corregir este deslizamiento de forma que
se emitan los valores medidos de longitud correctos.

Redisparar punto de referencia
Definición
Con la función "Redisparar punto de referencia" es posible sincronizar el eje en función de un
evento externo repetitivo.
La función se mantiene activa hasta que se desactiva de nuevo.

Requisitos
● Se emplea un encóder incremental o un detector de proximidad.
● El evento externo puede ser una señal de paso por cero de un encóder incremental o un
sensor del punto de referencia en la entrada I2.

500

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Desarrollo de la función
1. Introduzca el valor de la coordenada del punto de referencia en el DB de parámetros.
2. Introduzca el tipo de "Redisparar el punto de referencia" en el DB de parámetros.
Para ello, existen las posibilidades siguientes:
– Sólo se evalúa la señal de paso por cero del encóder (RETR_TYPE = 7).
– Sólo se evalúa el sensor del punto de referencia (RETR_TYPE = 6).
– Se evalúa la señal de paso por cero
en sentido positivo: Se evalúa el primer flanco ascendente de la señal de paso por cero
tras abandonar el sensor del punto de referencia en sentido positivo (RETR_TYPE = 0).
en sentido negativo: Se evalúa el primer flanco descendente de la señal de paso por
cero tras abandonar el sensor del punto de referencia en sentido negativo (RETR_TYPE
= 1).
3. Escriba y active los datos máquina.
4. Active el selector de función del DB de canal.

Datos utilizados en el DB de canal
Dirección

Nombre

34.3

REFTR_ON

25.0

SYNC

Tipo

valor inicial

Comentarios

BOOL

FALSE

1 = Redisparar el punto de referencia

BOOL

FALSE

1 = Eje sincronizado

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

44.0

REFPT

DINT

L#0

Coordenada del punto de referencia

52.0

RETR_TYPE

DINT

L#0

Forma de "Redisparar el punto de referencia"

Efectos de la función
● El FM x52 evalúa la señal de paso por cero y el sensor del punto de referencia en función
del sentido del movimiento del eje.
– En caso de un sentido positivo se evalúan los flancos ascendentes.
– En caso de un sentido de movimiento negativo se evalúan los flancos descendentes.
● La posición real se fija en el valor de la coordenada del punto de referencia.
● La zona de trabajo se desplaza físicamente en el eje.
● Cada uno de los puntos conserva su valor original, pero se encuentran en posiciones físicas
nuevas.
● Los cambios de estado de la leva que normalmente dispararían una alarma, se pueden
perder.
● El bit SYNC de las señales de realimentación se activa.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

501

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Nota
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 486).

Ejemplo
Para este ejemplo rige:
● Del sensor del punto de referencia y la señal de paso por cero se evalúan los flancos
ascendentes (sentido positivo del eje).
● La coordenada del punto de referencia tiene el valor 300 mm.
● En el instante de la ejecución no hay activo ningún decalaje de señal cero.
La tabla siguiente muestra el desplazamiento de la zona de trabajo en el eje a través de la
función "Redisparar punto de referencia".
Redisparar punto de referencia
)&6,

5($/
 

WUDE
DGH

=RQ
 )&6,



REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-400

300

100

400

-400

300

300

400

)&6) 6LVWHPDGHFRRUGHQDGDVDQWHULRU

5()



>PP@

'HFDODMH
GHOD]RQDGH
WUDEDMRSRU
UHGLVSDUDUSWR
GHUHIHUHQFLDD
PP

DMR

(MH



FCSI

>PP@


)&6)
5($/ 5()

1XHYRVLVWHPDGHFRRUGHQDGDV

Consideración de un decalaje de señal cero
Cuando hay un decalaje de señal cero activo, se tiene en cuenta en la función "Redisparar
punto de referencia". Esto significa que la coordenada del punto de referencia que se activará,
se calculará conforme a la fórmula siguiente:
Ref = RefDM - Decalaje de señal cero
RefDM es el valor depositado en los datos máquina a modo de coordenada del punto de
referencia.

502

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra el desplazamiento de la zona de trabajo en el eje a través de la
función "Redisparar punto de referencia" con decalaje de señal cero.
Redisparar punto de referencia

FCSI

REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-500

300

0

300

-400

400

100

400

-400

400

400

400

6LVWHPDGHFRRUGHQDGDVDQWHULRU
)&6,

)&6)

5($/



5()



>PP@

(MH



'6& 

DMR



=R

QD
G

HW

UDE

'HFDODMH
GHOD]RQDGH
WUDEDMRSRU
UHGLVSDUDUSWR
GHUHIHUHQFLD



 )&6,

>PP@



)&6) 5() 5()'6&
'0
1XHYRVLVWHPDGHFRRUGHQDGDV

Desconectar el final de carrera por software
Definición
La función "Desconectar final de carrera por software" desactiva la vigilancia del final de
carrera por software de un eje lineal.
La función se mantiene activa hasta que se desactiva de nuevo. Entonces se vuelven a activar
los finales de carrera parametrizados originalmente.

Desarrollo de la función
Active el selector de función en el DB de canal.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

Valor inicial

Comentarios

34.4

SSW_OFF

BOOL

FALSE

1 = Final de carrera por software desconectado

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

503

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

Valor inicial

Comentarios

64.0

SSW_STRT

DINT

L# -1000000000

Final de carrera por software Inicio

68.0

SSW_END

DINT

L#1000000000

Final de carrera por software Fin

Efectos de la función
● Simulación
– Si en el modo de simulación se rebasa un final de carrera por software se detiene el
modo de simulación.
– Si desactiva entonces la vigilancia del final de carrera por software, el modo de
simulación prosigue. El eje se desplaza en la dirección indicada.
● Decalaje de señal cero con vigilancia desactivada
Si se define un decalaje de señal cero en el que los finales de carrera por software se
encuentran todavía dentro de los límites de la zona de desplazamiento, el valor real puede
encontrarse fuera del rango de contaje admisible.
● Las levas que se encuentran fuera del final de carrera por software parametrizado, se
pueden activar.
PRECAUCIÓN
Se pueden producir daños materiales.
Si limita la zona de desplazamiento con finales de carrera por software y protege con ello
su instalación, al desconectar los finales de carrera por software se pueden producir daños
materiales.
Por ello, al planificar la instalación cuide que el accionamiento pueda desplazarse por toda
la zona de desplazamiento física.

Ejecutar la "Simulación"
Definición
La función "Simulación" brinda la posibilidad de activar la leva electrónica sin un encóder
conectado.

Desarrollo de la función
1. Introduzca la velocidad de simulación en el DB de parámetros.
2. Escriba y active los datos máquina.
3. En el DB de canal seleccione como sentido de la simulación el sentido positivo o negativo.
4. Active el selector de función del DB de canal.

504

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

15.2

DIR_M

BOOL

FALSE

1 = Simulación en el sentido negativo

15.3

DIR_P

BOOL

FALSE

1 = Simulación en el sentido positivo

34.1

SIM_ON

BOOL

FALSE

1 = Simulación activa

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

84.0

SIM_SPD

DINT

L#0

Velocidad de simulación

Efectos al activar la simulación
● Las señales de encóder dejan de evaluarse.
● Todas las supervisiones referidas a la entrada del encóder se desconectan.
● Los errores que se hayan notificado con respecto al encóder, se desactivan.
● El FM x52 simula el movimiento de un eje a una velocidad de simulación constante.
● El procesamiento de levas se desactiva con la activación de la simulación. Sin embargo, es
posible activarlo de nuevo. La sincronización se mantiene.
● El valor real de la posición cambia a partir del valor real actual, dependiendo de la velocidad
y del sentido de la simulación.

Efectos al desactivar la simulación
● El procesamiento de levas se desactiva.
● En caso de un encóder incremental o un detector de proximidad, la sincronización se borra.
Entonces como valor real se define el valor de la coordenada del punto de referencia.
● En el caso de un encóder absoluto se notifica el valor real de la posición, que se
corresponde con la posición actual del encóder. Las señales del encóder se evalúan de
nuevo tal como se han parametrizado en los datos máquina.

Valores límite
Los límites máximo y mínimo de la velocidad de simulación dependen de la resolución
(Página 521).

Velocidad
Entre la velocidad definida y la velocidad real (Página 521) a la que funciona el módulo, puede
haber diferencias.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

505

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Leer "Valores de contaje de las pistas de leva de contaje"
Definición
La función "Valores de contaje de las pistas de leva de contaje" permite leer los valores de
contaje actuales.

Desarrollo de la función
1. Defina las pistas de la leva de contaje y los valores de contaje superiores en los datos
máquina.
2. Escriba y active los datos máquina.
3. Habilite la función de contaje.
4. El valor de contaje se fijará en el valor de contaje superior.
5. Con cada flanco ascendente del resultado de la pista el valor de contaje se reducirá en 1.
6. Active el bit de inicio en el DB de canal para la lectura de los valores de contaje.
7. Los valores de contaje de las dos pistas se escriben en el DB de canal. Para una pista no
parametrizada como pista de leva de contaje se emite 0.
8. Si el valor de contaje alcanza el valor 0, el bit identificador de la pista de leva de contaje se
pone a 1.
9. Con el siguiente flanco descendente del resultado de pista, el bit identificador vuelve a 0 y
el contador se pone al valor de contaje superior.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

15.5

CNTC0_EN

BOOL

FALSE

1 = Habilitar la función de contaje de la pista de leva de
contaje 0

15.6

CNTC1_EN

BOOL

FALSE

1 = Habilitar la función de contaje de la pista de leva de
contaje 1

38.3

CNTTRC_EN

BOOL

FALSE

1 = Leer valores de contaje de la pista de leva de contaje

124.0

CNT_TRC0

INT

0

Valor de contaje actual para la pista de leva de contaje 0

126.0

CNT_TRC1

INT

0

Valor de contaje actual para la pista de leva de contaje 1

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

99.0

SPEC_TRC0

BOOL

FALSE

1 = Pista 0 es pista de leva de contaje

99.1

SPEC_TRC1

BOOL

FALSE

1 = Pista 1 es pista de leva de contaje

100.0

CNT_LIM0

DINT

L#2

Valor de contaje superior para la pista de leva de contaje
0

104.0

CNT_LIM1

DINT

L#2

Valor de contaje superior para la pista de leva de contaje
1

506

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Leer "Datos de posición y pista"
Definición
Con la función "Datos de posición y pista" se lee la posición, la velocidad y el bit identificador
de pista en ese instante. Los bits identificadores de pista se capturan antes de combinarlos con
los datos máquina y de canal.
El algoritmo de cálculo implantado en el FM x52 calcula cambios de velocidad mayores que 1
impulso por 4 ms. La velocidad que se muestra, por lo tanto, incluye imprecisión y no es
conveniente para fines de cálculo. La velocidad interna que se emplea para dinamizar las levas
es más precisa.

Desarrollo de la función
1. Active el bit de inicio en el DB de canal.
2. Los datos se depositan en el DB de canal.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

38.4

ACTPOS_EN

BOOL

FALSE

1 = Leer Datos de posición y pista

128.0

ACTPOS

DINT

L#0

Posición actual

132.0

ACTSPD

DINT

L#0

Velocidad actual

136.0

TRACK_ID

DWORD

DW#16#0

Bits identificadores de pista de las pistas 0 a 31

Leer "Datos de encóder"
Definición
Con la función "Datos de encóder" se leen los datos actuales del encóder así como el valor del
reajuste del encóder absoluto.

Requisitos
Es posible leer el valor para el reajuste del encóder absoluto (Página 516) después de
ejecutar la función "Definir punto de referencia (Página 492)".

Desarrollo de la función
1. Active el bit de inicio en el DB de canal.
2. Los datos se depositan en el DB de canal.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

507

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

38.5

ENCVAL_EN

BOOL

FALSE

1 = Leer valores del encóder

140.0

ENCVAL

DINT

L#0

Valor de encóder / Lectura del contador (representación
interna)

144.0

ZEROVAL

DINT

L#0

Lectura del contador en la última señal de paso por cero
(representación interna)

148.0

ENC_ADJ

DINT

L#0

Reajuste del encóder absoluto

Leer los "Datos de leva y pista"
Definición
Con la función "Datos de leva y pista" se leen los bits identificadores de leva y de pista actuales
así como la posición en ese instante. Los bits identificadores de pista se capturan antes de
combinarlos con los datos máquina y de canal.

Desarrollo de la función
1. Introduzca como identificador de tipo un 1 en el parámetro FM_TYPE del DB de canal. Con
ello es posible leer los datos de leva y de pista de 24 bytes.
Si introduce 0 como identificador de tipo sólo se leerán los bits identificadores de la leva (16
byte).
2. Los datos se depositan en el DB de canal.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

12.0

FM_TYPE

BOOL

FALSE

0 = FM 352 a V4.0

38.6

CAMOUT_EN

BOOL

FALSE

1 = Leer datos de leva y pista

152.0

CAM_00_31

DWORD

DW#16#0

Bits identificadores de la leva para las levas de 0 a 31

156.0

CAM_32_63

DWORD

DW#16#0

Bits identificadores de leva para las levas de 32 a 63

160.0

CAM_64_95

DWORD

DW#16#0

Bits identificadores de la leva para las levas de 64 a 95

164.0

CAM_96_127

DWORD

DW#16#0

Bits identificadores de la leva para las levas de 96 a 127

168.0

TRACK_ID1

DWORD

DW#16#0

Bits identificadores de pista de las pistas 0 a 31

172.0

ACTPOS1

DINT

L#0

Posición actual

1 = FM 352 a partir de V5.0 y FM 452

Activar "Señales de control de la leva electrónica"
Definición
Con la función "Señales de control de la leva electrónica" se habilita el procesamiento de levas
así como las pistas.

508

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Desarrollo de la función
1. Active los bits que desee en el DB de canal.
2. Con cada llamada de la instrucción CAM_CTRL los datos se transfieren al módulo.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

15.4

CAM_EN

BOOL

FALSE

1 = Habilitar el procesamiento de levas

16.0

TRACK_EN

WORD

W#16#0

Habilitar pistas de leva de 0 a 12
Bit 0 = Pista 0

Efectos
El procesamiento de levas se inicia o se detiene según la habilitación.
Los bits identificadores de pista de las pistas habilitadas se transfieren a las señales de pista
y a las salidas digitales.

Consultar las "Señales de realimentación de la leva electrónica"
Definición
Con la función "Señales de respuesta de la leva electrónica" se informa del estado actual de
la leva y de las señales de pista. La coherencia entre la posición indicada y las señales de pista
no está asegurada.

Desarrollo de la función
Con cada llamada de la instrucción CAM_CTRL los datos se depositan en el DB de canal.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

23.4

CAM_ACT

BOOL

FALSE

1 = Procesamiento de levas activo

26.0

ACT_POS

DINT

L#0

Posición actual del eje

30.0

TRACK_OUT

DWORD

DW#16#0

Señales de pista actuales de las pistas 0 a 31
Bit 0 = Pista 0

Consultar "Señales de realimentación del diagnóstico"
Definición
Con la función "Señales de realimentación del diagnóstico" se recibe información sobre los
eventos de diagnóstico que se han producido.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

509

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Desarrollo de la función
1. Cuando el módulo realiza una nueva entrada en el búfer de diagnóstico, activa el bit DIAG
en la interfaz de realimentación. Cada aparición de un error (Página 552) provoca una
entrada en el búfer de diagnóstico.
2. Cuando el módulo detecta una petición de escritura con datos erróneos, activa el bit
DATA_ERR en la interfaz de realimentación. La causa del error se registra en el búfer de
diagnóstico.
3. La instrucción CAM_CTRL coloca la interfaz de realimentación en el DB de canal.
4. Una vez que la instrucción CAM_DIAG haya leído el búfer de diagnóstico, el módulo
restablece el bit DIAG a 0.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

22.2

DIAG

BOOL

FALSE

1 = Búfer de diagnóstico modificado

22.4

DATA_ERR

BOOL

FALSE

1 = Error de datos

2.1.3.3

Configurar FM 352

2.1.3.4

Parametrizar el FM 352

Sistema de medición
Seleccionar sistema de medidas
Seleccionar sistema de medidas
Para la entrada y salida de datos es posible elegir entre los siguientes sistemas de medida:
● Milímetros (ajuste predeterminado)
● Inch
● Grados
● Impulsos

510

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Nota
Si se modifica el sistema de medida en el cuadro de diálogo "Sistema de medida", los valores
se convierten al nuevo sistema. Aquí se pueden producir errores de redondeo.
Si se modifica el sistema de medida mediante el dato máquina, los valores no se convierten
automáticamente.
Si el sistema de medida cambia de o a "impulsos", el procesamiento de levas se desactivará
y el eje dejará de estar sincronizado.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentario

8.0

UNITS

DINT

L#1

Sistema de medida
Valores permitidos:
● 1 = 10-3 mm
● 2 = 10-4 pulgadas
● 3 = 10-4 grados
● 4 = 10-2 grados
● 5 = Impulsos
● 6 = 10-3 grados

Sistema de medida estándar en la ayuda en pantalla
Para la indicación de valores límite se utiliza el sistema de medida mm. Por ello, para
determinar los valores límite en los otros sistemas de medida, realice la conversión siguiente:
Para convertir de

calcule

mm → pulgadas
mm → grados

Valor límite (inch) = valor límite (mm) × 0,1 1)

10 (4 decimales)

Valor límite (grados) = valor límite (mm) × 0,1

10-3 (3 decimales)

Valor límite (grados) = valor límite (mm) × 1

10 (2 decimales)

Valor límite (grados) = valor límite (mm) × 10

-4

-2

mm → impulsos
1)

Valor límite (impulsos) = valor límite (mm) x 1000

En el valor máximo el número de decimales repercute en el número de dígitos que preceden a la
coma. En el sistema de medida Inch se utilizan 4 decimales, por lo tanto se pueden introducir como
máximo 100 000,0000 inch. El sistema de medida Milímetros utiliza 3 decimales y por lo tanto se
pueden introducir como máximo 1 000 000,000 mm.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

511

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Eje
Definir tipo de eje
Seleccionar tipo de eje
Tipos de eje
La leva electrónica soporta los siguientes tipos de ejes:
● Eje lineal
El eje lineal es un eje con una zona de desplazamiento física limitada.

,QLFLRI¯VLFR

)LQDOI¯VLFR

● Eje rotativo
El eje rotativo es un eje cuya zona de desplazamiento no está limitada por topes mecánicos.
,QLFLRGHOHMHURWDWLYR 
)LQDOGHOHMHURWDWLYR

(OYDORUPD\RULQGLFDGR

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

12.0

AXIS_TYPE

DINT

L#0

Tipo de eje
Valores permitidos:
● 0 = Eje lineal
● 1 = Eje rotativo

Definir final de carrera por software
Final de carrera por software
Los finales de carrera por software existen sólo para el eje lineal.
El área limitada por el final de carrera por software es la zona de trabajo. Los límites de la zona
de trabajo pueden ser vigilados por el FM x52.
El inicio del final de carrera por software (FCSI) debe ser siempre menor que el fin del final de
carrera por software (FCSF).

512

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Los finales de carrera por software están activos cuando el FM x52 está sincronizado.
● Si se utiliza un encóder incremental o un detector de proximidad:
Después de cada arranque del FM x52 el eje no está sincronizado. Sólo tras una
sincronización se vigilan los finales de carrera por software parametrizados.
● Si se utiliza un encóder absoluto (SSI):
El FM x52 está sincronizado después de haber recibido un telegrama completo y sin
errores. A partir de este instante los finales de carrera por software son vigilados. El
encóder absoluto utilizado tiene que abarcar por lo menos la zona de trabajo, incluido el
final de carrera por software.

Relación entre la zona de trabajo, del encóder y la zona de desplazamiento
● La zona de trabajo es el área que el usuario define para sus tareas mediante los finales de
carrera por software.
● El zona del encóder es el área que el encóder cubre claramente. En el caso de un eje lineal
del módulo, el área del encóder se define de forma simétrica por encima de la zona de
trabajo. Es decir, el módulo desplaza la zona del encóder de tal modo que las distancias
entre los finales de carrera por software y los finales de la zona del encóder son iguales en
cada caso (véase la figura en la parte de abajo).
● La zona de desplazamiento es el rango de valores que puede procesar el FM x52. La zona
de desplazamiento depende de la resolución.
Se debe considerar: Zona de desplazamiento ≥ Rango del encóder ≥ Zona de trabajo
La figura siguiente muestra la relación entre los finales de carrera por software, la zona de
trabajo, el rango del encóder y la zona de desplazamiento.
=RQDGHWUDEDMR

(MH

)&6,



=RQDGHDOFDQFHGHOHQFµGHU
0DUJHQGHGHVSOD]DPLHQWR

)&6)





Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

64.0

SSW_STRT

DINT

L# -100.000.000

Final de carrera por software Inicio

68.0

SSW_END

DINT

L# 100.000.000

Final de carrera por software Fin
Rango de valores admisible:
● -1 000 000 000 µm a 1 000 000 000 µm

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

513

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Definir final del eje rotativo
Final del eje rotativo
El valor "Final del eje rotativo" es el valor máximo teórico que el valor real puede alcanzar. Sin
embargo, el máximo valor teórico nunca se indica porque físicamente identifica la misma
posición que el inicio del eje rotativo (0).
El valor más grande que se muestra en el caso de un eje rotativo es:
Final del eje rotativo [µm] - Resolución [µm/impulso] × 1 [impulso]
Ejemplo: Final del eje rotativo 1000 mm
La visualización pasa:
● Con un sentido de giro positivo, de 999 mm a 0 mm.
● con un sentido de giro negativo, de 0 mm a 999 mm.

Eje rotativo con encóders absolutos
En el caso de un eje rotativo con un encóder absoluto, el área del eje rotativo (0 hasta el final
del eje rotativo) tiene que coincidir exactamente con el total de pasos del encóder absoluto.
wP
3DVRV HQFRGHU >SXO@
)LQGHHMHURWDWLYR>wP@ Q¼PHURGHYXHOWDV HQFRGHU   5(6>@
9XHOWD
3XOVR

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

16.0

ENDROTAX

DINT

L#100000

Final del eje rotativo
Rango de valores admisible:
● 1 µm a +1 000 000 000 µm

Definir sincronización
Seleccionar la "Forma de redisparar el punto de referencia"
Redisparar el punto de referencia
Con la forma de "Redisparar el punto de referencia (Página 500)" se definen las condiciones
de sincronización del eje para el funcionamiento con un encóder incremental o un detector de
proximidad.

514

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

52.0

RETR_TYPE

DINT

L#0

Forma de "Redisparar el punto de referencia"
Valores permitidos:
● 0 = sensor del punto de referencia y señal de paso por
cero en sentido +
● 1 = sensor del punto de referencia y señal de paso por
cero en sentido ● 6 = sólo sensor del punto de referencia
● 7 = sólo señal de paso por cero

Definir la coordenada del punto de referencia
Coordenada del punto de referencia
● Encóder incremental y detector de proximidad:
Con el selector de función "Redisparar punto de referencia" y un evento de sincronización,
definido por la forma de "Redisparar el punto de referencia" (Página 514), se asigna a este
evento la coordenada del punto de referencia.
● Encóder absoluto (SSI)
Un eje parametrizado con un encóder absoluto siempre está sincronizado después de la
transmisión del primer telegrama SSI sin errores.
Consulte al respecto también la descripción del reajuste del encóder absoluto
(Página 516), en la que se explica la interacción de dicho ajuste con el resto de datos.
El valor de la coordenada del punto de referencia se encuentra dentro de la zona de trabajo:
● Eje lineal
Incluido el final de carrera por software.
● Eje rotativo
Mayor o igual que 0 y menor que el valor "Final del eje rotativo" (0 ≤ coordenada del punto
de referencia < final del eje rotativo).

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

44.0

REFPT

DINT

L#0

Coordenada del punto de referencia
Rango de valores admisible:
● -1.000.000.000 µm a +1.000.000.000 µm

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

515

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Definir reajuste del encóder absoluto
Calcular reajuste del encóder absoluto
Definición
El reajuste del encóder absoluto sólo es necesario para un encóder absoluto (SSI).
Con el reajuste del encóder absoluto y las coordenadas del punto de referencia el rango de
valores del sensor se reproduce claramente en el sistema de coordenadas del eje. Se calcula
el valor del encóder que equivale a la coordenada del punto de referencia en el eje. El valor
tiene que ser menor que el total de pasos del encóder absoluto.
Encontrará más información al respecto en "Procedimiento de reajuste del encóder absoluto
(Página 516)", así como en un ejemplo (Página 517).

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

48.0

ENC_ADJ

DINT

L#0

Reajuste del encóder absoluto
Rango de valores admisible:
● 0 a (225 - 1)

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

98.0

REFPT

DINT

L#0

Coordenada del punto de referencia
Rango de valores admisible:
● -1.000.000.000 µm a +1.000.000.000 µm

Procedimiento para un reajuste del encóder absoluto
Determinar el reajuste correcto del encóder absoluto
Tras la primera parametrización hay que llevar a cabo otros pasos para que se establezca una
relación correcta entre el encóder y el sistema de coordenadas. El proceso se representa
utilizando el cuadro de diálogo de parametrización.
1. Desplace el eje a un punto definido y reproducible que físicamente sea único.
Puede ser, por ejemplo, el "Fin del final de carrera por software".
2. Llame el ajuste "Definir punto de referencia (Página 492)" con la coordenada del punto
definido en 1.
El FM x52 determina entonces un valor de encóder para la coordenada del punto de
referencia registrada en el eje en el DB de canal (REFPT): el reajuste del encóder absoluto.
Este valor se puede leer con el ajuste "Datos de encóder (Página 507)".
3. Registre el valor leído en el campo "Reajuste del encóder absoluto".

516

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
4. Guarde la parametrización en el DB de parámetros correspondiente con la función de
exportación.
5. Cargue los datos de HWCN en la CPU.
6. Para activar los datos, rearranque la CPU.
Nota
Esta sincronización se realiza una vez en la puesta en marcha. Tras una parametrización, el
FM x52 queda sincronizado durante el arranque en cuanto se recibe un telegrama sin errores
del encóder.

Alternativa: Reajuste mecánico de un encóder
También se puede obtener una relación correcta entre el sistema de coordenadas y el encóder
del modo siguiente:
1. Desplace el eje a un punto definido y reproducible que físicamente sea único.
Puede ser, por ejemplo, el "Inicio del final de carrera por software".
2. Introduzca este valor de coordenadas en los datos máquina a modo de "coordenada del
punto de referencia".
3. Lea el valor de encóder que se muestra en esta posición con el ajuste "Datos de encóder
(Página 507)".
4. Introduzca este valor como reajuste del encóder absoluto en los datos máquina.
Tras la parametrización se mostrará siempre un valor real correcto.
En lugar del paso 3 y 4 también es posible resetear a cero el codificador a través de la opción
"Reset", si está disponible. A continuación, introduzca el valor "0" como reajuste del encóder
absoluto en los datos máquina.

Ejemplo para un reajuste del encóder absoluto
Ejemplo para un reajuste del encóder absoluto
Para este ejemplo se parte de las premisas siguientes:
● Coordenada del punto de referencia = -125 mm
● Área de trabajo de SSW_STRT = -1.000 mm a SSW_END = 1.000 mm
● Reajuste del encóder absoluto = 0
● Área del encóder = 2.048 incrementos con una resolución de 1 mm/impulso
● El encóder absoluto utilizado no permite un ajuste mecánico exacto y tampoco ofrece la
posibilidad de definir el valor del encóder.
La figura siguiente muestra un ejemplo de reajuste del encóder absoluto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

517

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

GHVHDGR

(MH
9DORUGHOHQFµGHUDEVROXWR

(QFµGHU

9DORUUHDO  






9DORUGHOHQFµGHU



(MH

DFWXDOPHQWH




 



1)

Asignación del sistema de coordenadas a los valores del sensor con el reajuste de encóder
absoluto definido. El valor del encóder 0 equivale al valor real -125.

2)

Asignación deseada del sistema de coordenadas con respecto al encóder. En esta posición, la
coordenada tiene que ser -125.

Resultado tras "Definir el punto de referencia"
Tras "Definir el punto de referencia", la relación es la siguiente:
La coordenada del punto de referencia en el eje (-125) se asigna al valor del encóder calculado
(1798) a partir del reajuste del encóder absoluto. La figura siguiente muestra esta asignación.
$OFDQFHTXHSXHGHFXEULUVHFODUDPHQWHFRQHVWHHQFµGHU

(MH



 






)&6)

9DORUGHOHQFµGHUDEVROXWR

)&6,







9DORUFDOFXODGRGHO
UHDMXVWHGHOHQFµGHU
DEVROXWR




El encóder devuelve 2.048 valores unívocos. La zona de trabajo está definida por el final de
carrera por software. Sin embargo, debido a la resolución seleccionada de 1 mm por impulso,
el encóder puede abarcar una zona de trabajo mayor que la prevista por el final de carrera por
software.
Con la resolución definida, la zona de trabajo está ya cubierta con 2.001 valores. Por ello en
el ejemplo quedan 47 impulsos "sobrantes" dispuestos simétricamente alrededor de la zona de
trabajo.

518

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Definir histéresis
Histéresis
El rango de valores de la histéresis (Página 470) depende de la resolución (Página 525).
El valor máximo de entrada es como sigue:
● En el caso de ejes lineales: Valor de entrada máximo < ¼ de la zona de trabajo
● En el caso de los ejes rotativos: Valor de entrada máximo < ¼ del área del eje rotativo

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

80.0

HYS

DINT

L#0

Histéresis
Rango de valores admisible:
● 0 … 65.535 [Imp] × resolución [µm/Imp]

Leva de recorrido con histéresis
Una leva de recorrido se acciona cuando se cumplen las siguientes condiciones:
● el valor real detectado se encuentra dentro de la leva de recorrido
● la histéresis no está activada.
Según la posición en la que tiene lugar el cambio de sentido, puede variar la posición de un
punto de cambio.
La siguiente figura muestra el comportamiento de conmutación de una leva de recorrido en el
caso de una histéresis.



6HQWLGRGHDFWXDFLµQ
,/
)/
      






&DPELRGHVHQWLGR


&DPELRGHVHQWLGR





Leva
Histéresis
1)

La leva se activa porque el principio de leva se rebasa en sentido de actuación positivo.

2)

A pesar del cambio de sentido, la leva permanece activada debido a la histéresis.

3)

La leva se desactiva al final de la histéresis.

4)

La leva permanece desactivada tras el cambio de sentido.

5)

Tras el final de la histéresis la leva se activa nuevamente.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

519

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Nota
Las levas de recorrido que son más cortas que la histéresis no pueden ser acortadas por la
histéresis en caso de un cambio de sentido.

Levas de tiempo con histéresis
La leva de tiempo se acciona cuando se cumplen las siguientes condiciones:
● El principio de leva se rebasa en el sentido de actuación.
● la histéresis no está activada.
Nota
Si el área comprendida entre el punto de inversión y el principio de leva de tiempo es menor
que la histéresis la leva de tiempo quedará oculta por la histéresis.
La siguiente figura muestra el comportamiento de conmutación de una leva de tiepo en el caso
de una histéresis. Se representa una leva de tiempo que no se activa de nuevo.

 

6HQWLGRGHDFWXDFLµQ
,/
      




&DPELRGHVHQWLGR

&DPELRGHVHQWLGR


Leva
Histéresis

520

1)

La leva se activa porque el principio de leva se rebasa en sentido de actuación positivo.

2)

Tras el cambio de sentido y hasta que ha transcurrido el tiempo de conexión la leva se
mantiene activada, independientemente de la histéresis.

3)

El principio de leva queda oculto por la histéresis, la leva no se activa.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Definir velocidad de simulación
Velocidad de simulación
Este dato máquina define la velocidad de la "simulación". Tenga en cuenta a este respecto la
información incluida en "Influencia de los ajustes en el comportamiento de conmutación de las
levas de tiempo (Página 486)".
La velocidad de simulación real Vsim puede diferir de la velocidad de simulación introducida Vsim,
V y se calcula conforme a la fórmula siguiente:
9
6LP 

 H[S 5(6
(QWHUR

 H[S 5(6


9
6LP9

En esta fórmula:
● Vsim: es la velocidad de simulación definida por el FM 352. Unidad: µm/min
● Vsim, V: es la velocidad de simulación que el usuario define en los datos máquina.
Unidad: µm/min
● RES: Resolución calculada a partir de los datos del encóder. Unidad: µm/Impulso
● Entero ( ): a partir de esta expresión, sólo se tiene en cuenta el valor previo al decimal para
otros cálculos. Esta expresión tiene que encontrarse dentro del rango de 2 ... 65.536 en
todos los cálculos.
Las diferentes relaciones (véase la fórmula anterior) provocan cambios inesperados en la
velocidad de simulación real.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

84.0

SIM_SPD

DINT

L#0

Velocidad de simulación
Rango de valores admisible:
● 0 = Parada
● 5 × 108 = Ajuste máximo del módulo
Dentro de este rango la velocidad de simulación depende
de la resolución (Página 525):
1000 × resolución ≤ velocidad de simulación
≤ 3 × 107 × resolución

Definir distancia mínima entre bordes
Distancia mínima entre bordes
En una captura de bordes, con este dato máquina se define un área tras detectar el inicio de
la medición. Si el final del proceso de medición se encuentra dentro de este rango, la medición
se desestima.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

521

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
El inicio de la medición se notifica en cuanto se ha recorrido la distancia mínima entre bordes.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

4.0

EDGEDIST

DINT

L#0

Distancia mínima entre bordes
Rango de valores admisible:
● 0 ... 1.000.000.000 µm

Encóder
Seleccionar tipo de señal
Tipo de señal
El encóder da información de recorrido al módulo, el cual la evalúa y la convierte en un valor
real con la resolución.
Es posible seleccionar un tipo de señal de uno de los encóders (Página 474) siguientes:
● Señal diferencial de 5 V (Página 475)
Seleccione el tipo de señal "5 V Señal diferencial" si utiliza un encóder incremental de 5 V
con señales diferenciales A, /A, B, /B y N, /N.
● 24 V Pista A+B desfasado (Página 475)
Seleccione el tipo de señal "24 V Pista A+B desfasado" si desea utilizar un encóder
incremental de 24 V con las señales A*, B* y N*.
● SSI absoluto (Página 477)
Seleccione el tipo de señal "SSI absoluto" si desea utilizar un encóder absoluto con una
interfaz en serie.
● 24 V Detector de proximidad (Página 477)
Seleccione el tipo de señal "Detector de proximidad de 24 V" si desea utilizar un detector de
24V con la señal A*.

522

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

20.0

ENC_TYPE

DINT

L#1

Tipo de señal
Valores permitidos:
● 1 = 5 V incremental
● 2 = 24 V incremental
● 3 = SSI longitud del telegrama 13 bits
● 4 = SSI longitud del telegrama 25 bits
● 5 = Escuchar
● 6 = 24 V Detector de proximidad ascendente (positivo)
● 7 = 24 V Detector de proximidad descendente (negativo)
● 8 = SSI longitud del telegrama 13 bits (alineación
derecha)
● 9 = SSI longitud del telegrama 25 bits (alineación
derecha)
● 10 = Escuchar (alineación derecha)

Definir resolución
Definir el recorrido por vuelta del encóder
recorrido por vuelta del encóder
Con el dato máquina "Recorrido por vuelta del encóder" se indica al FM x52 qué recorrido
realiza el sistema de accionamiento en cada vuelta.
El valor "Recorrido por vuelta del encóder" depende de la estructura del eje y del modo en que
está colocado el encóder. Debe tener en cuenta todos los elementos de transmisión, como
acoplamientos o engranajes. La figura siguiente muestra dos disposiciones de encóder
distintas a modo de ejemplo.

0RWRU

(QFµGHU

0RWRU

5HGXFWRUHV

5HGXFWRUHV

(QFµGHU

La relación entre los datos máquina "Recorrido por vuelta del encóder" e "Incrementos por
vuelta del encóder" se describe en el apartado Resolución (Página 525).

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

523

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

24.0

DISP_REV

DINT

L#80000

Recorrido por vuelta del encóder
Rango de valores admisible:
● 1 µm a 1.000.000.000 µm

Definir los incrementos por vuelta del encóder
Incrementos por vuelta del encóder
El dato máquina "Incrementos por vuelta del encóder" indica la cantidad de incrementos que
proporciona un encóder en cada vuelta. A partir de este valor y del dato máquina "Recorrido
por vuelta del encóder", el FM x52 calcula la resolución.
Encóder incremental
Como entrada (Página 475) es posible indicar cualquier valor dentro del rango de valores. El
módulo evalúa los incrementos en múltiplos de 4.
Detector de proximidad
Es posible indicar cualquier valor dentro del rango de valores.
Encóder absoluto
Los límites varían según el tipo de encóder:
Tipo de encóder

Longitud/tipo de telegrama

Valores posibles

utilizable como
eje lineal

Encóder monovuel‐
ta

13 bits medio abeto

64 ... 8192 en potencias de 2

Encóder monovuel‐
ta

13 bits alineación derecha

64 ... 8192 todos los valores

X

Encóder monovuel‐
ta

25 bits alineación derecha

64 ... 225 todos los valores

X

Encóder multivuelta

25 bits abeto

64 ... 8192 en potencias de 2

Encóder multivuelta

25 bits alineación derecha

64 ... 224 todos los valores

Escuchar

Abeto

64 ... 8192 en potencias de 2

Escuchar

alineación derecha

64 ... 225 todos los valores

25 bits medio abeto

64 ... 8192 en potencias de 2

X

Ajuste especial:
Encóder multivuelta
como encóder mo‐
novuelta

Nota
La cantidad de impulsos de un encóder se calcula a partir de los dos datos "Incrementos por
vuelta del encóder" multiplicado por "Número de vueltas" (véase el apartado "Resolución
(Página 525)").

524

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

32.0

INC_REV

DINT

L#500

Incrementos por vuelta del encóder
Rango de valores admisible:
● 1 a 225
Atención:
En el sistema de medida "Impulsos" esta entrada carece de
importancia.

Resolución
Resolución
La resolución es una medida para la precisión del procesamiento de levas. Determina también
la zona de desplazamiento máxima posible.
Para calcular la resolución (RES) se procede tal como se indica en la tabla siguiente:

Valores de entra‐
da

Encóder incremental

Encóder absoluto/detector de proximi‐
dad

● Recorrido por vuelta

● Recorrido por vuelta del encóder

● Incrementos por vuelta del encóder: ● Incrementos por vuelta del encóder.
–

Evaluación de impulsos:
Cuádruple

–

1 Incremento = 4 Impulsos

Cálculo

–

1 Incremento = 1 Impulso

7UD\HFWR
5(6

9XHOWDGHOHQFµGHU
,PSXOVRV
9XHOWDGHOHQFµGHU

Nota
En el sistema de medida "Impulsos" la resolución siempre tiene el valor 1.
Todos los datos de posición se redondean al múltiplo entero de la resolución. De este modo es
posible diferenciar entre los valores introducidos y los utilizados.

Rango de valores de la resolución
Es preciso convertir el rango de valores admitidos de la resolución al sistema de medida
subyacente. Con la elección de los dos valores "Recorrido por vuelta" e "Incrementos por
vuelta" la resolución se define dentro de este rango de valores.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

525

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
El sistema de medida seleccionado determina el margen de valores de la resolución:
Sistema de
medición

Datos en ...

Rango de valores de la resolución

mm

10-3 mm

0,1 × 10-3 mm .... 1000 × 10-3 mm/impulso

pulgadas

10-4 pulgadas

0,1 × 10-4 pulgadas .... 1000 × 10-4 pulgadas/impulso

grados

10 grados

0,1 × 10-4 grados .... 1000 × 10-4 grados/impulso

10-3 grados

0,1 × 10-3 grados .... 1000 × 10-3 grados/impulso

10 grados

0,1 × 10-2 grados .... 1000 × 10-2 grados/impulso

1 impulso

1

-4

-2

Impulsos

Ejemplo
● Un encóder incremental tiene los datos siguientes:
– Incrementos por vuelta: 5000
– Recorrido por vuelta del encóder: 1000 mm
– 1 incremento = 4 impulsos
De ello resulta la resolución (evaluación cuádruple):
5HVROXFLµQ

PP
LQFUHPHQWRV




PP
,QFUHPHQWR



PP
LPSXOVRV

PP
,QFUHPHQWR



PP
,PSXOVR

PP
,PSXOVR

● Un encóder SSI tiene los datos siguientes:
– Incrementos por vuelta: 4096
– Recorrido por vuelta del encóder: 1000 mm
– 1 incremento = 1 impulso
De ello resulta la resolución:
5HVROXFLµQ

PP
LQFUHPHQWRV



Dependencia entre la zona de desplazamiento y la resolución
La zona de desplazamiento está limitada por la representación numérica en el FM x52. Esta
representación numérica varía en función de la resolución. Por ello, al definir valores hay que
procurar mantenerse siempre dentro de los límites admitidos.
La siguiente tabla muestra la zona de desplazamiento máxima:

526

Resolución (RES) dentro de la zona

Zona de desplazamiento máxima

0,1 µm/impulso ≦ RES < 1 µm/impulso

-108 µm a 108 µm (-100 m a +100 m)

1 µm/impulso ≦RES ≦ 1000 µm/impulso

-109 µm a 109 µm (-1000 m a +1000 m)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Dependencia de la velocidad de la resolución
La velocidad que se muestra puede oscilar dentro de los márgenes que se indican según sea
la resolución (los datos se expresan en el sistema de medida mm):
● de 1 µm/min a 90 m/min a una resolución < 1 µm/impulso
● de 1 µm/min a 900 m/min a una resolución ≥ 1 µm/impulso
La velocidad es calculada y suavizada por el módulo cada 4 ms.
Tiene por lo menos una imprecisión de un impulso/4 ms y no resulta adecuada para fines de
regulación.

Seleccionar sentido de contaje
Dirección de contaje
Con el dato máquina "Dirección de contaje" se adapta la dirección de la captura del recorrido
al sentido del movimiento del eje. Para ello, tenga en cuenta todos los sentidos de giro de los
elementos de transmisión (como p. ej., acoplamientos y engranajes).
● normal = los impulsos de contaje adelantes (encóder incremental) o valores del sensor
(encóder absoluto) equivalen a los valores de posición real ascendentes
● invertida = los impulsos de contaje adelantes (encóder incremental) o valores del sensor
(encóder absoluto) equivalen a los valores de posición real descendentes
Nota:
No se permite un tiempo de anticipación en combinación con un encóder absoluto (SSI) y con
sentido de contaje invertido.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

Valor inicial

Comentario

59.0

CNT_DIR

BOOL

FALSE

Sentido de contaje
Valores permitidos:
● 0 = normal
● 1 = invertida

Seleccionar vigilancia
Vigilancia
Rotura de hilo

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

527

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Con la activación de la vigilancia, el FM x52 vigila, en el caso de un encóder incremental, las
señales A, /A, B, /B, N y /N. La vigilancia detecta:
● Rotura de hilo
● Cortocircuito de los distintos cables
En los encóders incrementales sin marcas cero, como alternativa tiene que
– desconectar la vigilancia de rotura de hilo
– interconectar externamente las señales N y /N (Página 474)
● Distancia de flancos de los impulsos de contaje
● Corte de la alimentación del encóder
Error del telegrama
La monitorización de errores de telegrama en los encóders absolutos (SSI) no puede
desactivarse. Supervisa:
● el telegrama para ver si hay errores del bit de inicio y del bit de parada
● el tiempo monoestable del encóder conectado
Impulsos erróneos (encóder incremental)
Entre dos marcas cero consecutivas, un encóder incremental siempre tiene que proporcionar
el mismo número de incrementos.
El FM x52 comprueba si la marca cero de un encóder incremental aparece en el estado
adecuado del encóder.
En el caso de encóders sin marca cero es preciso desactivar la vigilancia de los impulsos de
error.
Igualmente es preciso desactivar la vigilancia de rotura de hilo o bien interconectar las
entradas de marca cero N y /N de forma externa.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

Valor inicial

Comentarios

63.0

MON_WIRE

BOOL

TRUE

1 = Rotura de hilo

63.1

MON_FRAME

BOOL

TRUE

1 = Error de telegrama (tiene que ser siempre 1)

63.2

MON_PULSE

BOOL

TRUE

1 = Impulsos de error

Vigilancias

528

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Seleccionar datos para el encóder absoluto (SSI)
Número de vueltas
Número de vueltas del encóder
El dato máquina "Número de vueltas del encóder" sólo existe en encóders absolutos. Con él
se indica el número de vueltas posibles con este encóder. Encontrará más información en el
apartado "Encóder absoluto (SSI) (Página 477)".
● Encóder monovuelta
Sólo es posible el valor 1.
● Encóder multivuelta
– Encóder Multivuelta / Escuchar (abeto): 2 ... 4096 en potencias de 2
– Encóder multivuelta / Escuchar (alineación derecha): 1 ... 4096 todos los valores
● Escala lineal
También es posible conectar una escala lineal. Introduzca para ello el valor 1.
El total de pasos del encóder no es un dato máquina. Se calcula del modo siguiente:
Total de pasos = Incremento por vuelta x Número de vueltas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentario

36.0

NO_REV

DINT

L#1024

Número de vueltas del encóder
Rango de valores admisible:
● 1 (encóder monovuelta)
● 1 a 4096 (encóder multivuelta)

Velocidad de transferencia
Velocidad de transferencia
Con el dato máquina "Velocidad de transferencia" se define la velocidad de la transferencia de
datos del encóder SSI al FM x52.
La velocidad de transferencia máxima depende de la velocidad de transferencia:
● 320 m → 125 kHz
● 160 m → 250 kHz
● 63 m → 500 kHz
● 20 m → 1000 kHz

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

529

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

40.0

BAUDRATE

DINT

L#0

Velocidad de transferencia
Valores permitidos:
● 0 = 125 kHz
● 1 = 250 kHz
● 2 = 500 kHz
● 3 = 1000 kHz

Longitud de telegrama
Longitud de telegrama
Con la "longitud de telegrama" se define el marco de impulsos que emite el FM x52.
Seleccionando "Escuchar", se desactiva el reloj del FM x52. Entonces el FM x52 puede
escuchar también otros telegramas SSI con un marco de telegramas de 13 ó 25 bits. La
velocidad de la transferencia se basa en la velocidad de reloj del módulo maestro.

Datos utilizados en el DB de parámetros
La longitud de telegrama seleccionada aquí se dispone en el DB de parámetro con el
dato ENC_TYPE (Página 522).

Sentido del detector de proximidad
Sentido del detector de proximidad
Con el sentido del detector es posible determinar el sentido de un detector de proximidad
conectado:
● Positivo: corresponde al sentido de avance (impulsos de contaje ascendentes)
● Negativo: corresponde al sentido de retroceso (impulsos de contaje descendentes)

530

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Pistas
Seleccionar el modo de control de las salidas de pista
Control de las salidas de pista
Con el dato máquina "Control de las salidas de pista" se define el modo de control de las
salidas de pista de las pistas 0 a 12. El control es es posible mediante:
● Leva electrónica: Las señales de pista son conectadas y desconectadas por el
procesamiento de levas del FM 352.
● CPU: Las señales de pista reproducen directamente los valores correspondientes de las
habilitaciones de pistas en el DB de canal.
De este modo las salidas de pista se pueden controlar directamente desde su programa.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

90.0

TRACK_OUT

WORD

W#16#0

Control de las salidas de pista
Valores permitidos:
● 0 = Leva electrónica
● 1 = CPU
Número de bit = Número de pista
Los bits entre 13 y 15 tienen que ser 0.

Seleccionar pistas especiales
Pistas especiales
Es posible parametrizar las pistas 0, 1 y 2 como pistas especiales.
● Pista 0 y pista 1 como pista de leva de contaje (Página 469)
● Pista 2 como pista de leva de freno (Página 469)

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

99.0

SPEC_TRC0

BOOL

FALSE

1 = Pista 0 es pista de leva de contaje

99.1

SPEC_TRC1

BOOL

FALSE

1 = Pista 1 es pista de leva de contaje

99.2

SPEC_TRC2

BOOL

FALSE

1 = Pista 2 es pista de leva de freno

Pistas especiales

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

531

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Definir valor de contaje superior para la pista de leva de contaje
Valor de contaje superior pista de leva de contaje
Con este dato máquina se define el valor de contaje superior para la pista de leva de contaje
parametrizada.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

100.0

CNT_LIM0

DINT

L#2

104.0

CNT_LIM1

DINT

L#2

Valor de contaje superior para pista de leva de conta‐
je(Pista 0)
Valor de contaje superior para pista de leva de conta‐
je(Pista 1)
Rango de valores admisible:
● 2 … 65535

Seleccionar entrada de habilitación
Entrada de habilitación
La señal de pista Q3 se activa cuando se cumplen todas las condiciones siguientes:
● La pista está habilitada.
● La entrada de habilitación externa correspondiente I3 está activada.
● El resultado de la pista es 1.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios
Entrada de habilitación

95.0

EN_IN_I3

BOOL

FALSE

1 = La señal de pista Pista 3 está combinada con la ope‐
ración lógica AND con la entrada de habilitación I3
Los bits entre 95.1 y 95.7 tienen que ser 0.

532

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Leva
Alcance
Alcance
El alcance determina el número máximo de levas parametrizables y, con ello, el tiempo de ciclo
de la leva.
Alcance

Tiempo de ciclo de la leva

16 levas

20,48 µs

32 levas

40,96 µs

64 levas

81,92 µs

128 levas

163,84 µs

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

76.0

C_QTY

DINT

UDT3: L#0

0 = máx. 16 levas

UDT4: L#1

1 = máx. 32 levas

UDT5: L#2

2 = máx. 64 levas

UDT6: L#3

3 = máx. 128 levas

Alcance

Datos de leva
Datos de leva
Datos de leva
Los datos de leva describen las propiedades de una leva, la asignación de cada una de ellas
a una pista y el comportamiento de conmutación de la leva.
Los datos de leva que se listan a continuación se ajustan por separado para cada leva.
● Validez (Página 534)
● Número de pista (Página 534)
● Tipo de leva (Página 535)
● Principio y final de la leva para levas de recorrido (Página 535)
● Inicio de leva y tiempo de conexión para levas de tiempo (Página 536)
● Tiempo de anticipación (Página 537)
● Sentido de actuación (Página 539)
● Alarma de proceso (Página 541)

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

533

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Por lo general, para el procesamiento de levas se aplica lo siguiente:
● Sólo las levas ajustadas como "válidas" son interpretadas y procesadas por el módulo.
● Las levas 0 ... 7 soportan alarmas de proceso
● La cantidad de levas parametrizables depende del alcance.

Validez de una leva
Leva "válida"
Es preciso activar como válidas todas las levas que deben ser procesadas por la leva
electrónica.
Nota
Configure siempre las levas no utilizadas como "no válidas" (CAMVALID = FALSE).

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

CAMVALID

BOOL

FALSE

1 = Leva "válida"

relativa
+0.0

Definir número de pista para una leva
Número de pista
Al escoger el número de pista se define para cada leva la pista en la que dicha leva tiene que
tener efecto.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

TRACK_NO

BYTE

B#16#0

Número de pista

relativo
+1.0

Rango de valores admisible:
● 0 a 31

534

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Seleccionar tipo de leva
Tipo de leva
Seleccione el tipo de leva deseado.
● Leva de recorrido
● Leva de tiempo

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

CAM_TYPE

BOOL

FALSE

Tipo de leva

relativo
+0.3

Valores permitidos:
● 0 = Leva de recorrido
● 1 = Leva de recorrido

Definir inicio y final de la leva para levas de recorrido
Inicio de leva (IL) / Fin de leva (FL) en levas de recorrido
El inicio y el final de leva definen la longitud de leva en una leva de recorrido.
Longitud mínima de una leva de recorrido
La siguiente figura muestra la leva más corta con sentido de movimiento positivo del eje.
3XOVRVGHWHUPLQDGRVDSDUWLUGH
ODVVH³DOHVGHOHQFRGHU

     
,/ )/

)/

V

,/

V

/HYDP£VFRUWD,/ \
)/ 
/HYDP£VFRUWDQRDFWLYDVL
,/HVPD\RUTXH)/,/ \
)/ 

Por regla general, rige lo siguiente:
● La parte no activa de una leva siempre tiene que mantener una distancia mínima de 4
impulsos entre el fin de leva (FL) y el inicio de leva (IL).
● En el caso de FL = IL la leva se activa por un impulso.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

535

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

relativo

para levas de recorrido

+2.0

CBEGIN

DINT

L#-100000000

Inicio de leva (IL)

+6.0

CEND

DINT

L#100000000

Fin de leva (FL)
Rango de valores admisible:
● -1.000.000.000 µm a 1 000 000
000 µm

Definir principio de leva y tiempo de conexión para levas de tiempo
Inicio de leva (IL) / Final de leva (FL) ≙ Tiempo de conexión en levas de tiempo
En el caso de una leva de tiempo es preciso definir un inicio de leva y, en lugar del fin de leva,
un tiempo de conexión. El tiempo de conexión se define en pasos de 100 µs. El tiempo empieza
a transcurrir a partir de la conexión de la leva.
Para la definición de estos tiempos rigen las condiciones siguientes:
● 0 µs: Una leva con el tiempo de conexión 0 µs no se activa nunca
● 0 µs < t ≤ 400 µs: El FM x52 ajusta un tiempo de leva mínimo de unos 330 µs.
● t > 400 µs: El FM x52 calcula el tiempo de conexión real treal a partir del tiempo de conexión
especificado tdef según la fórmula siguiente:
W
UHDO Q¼PHURHQWHUR

W GHI
7LHPSRGHFLFORGH
ODOHYD



7LHPSRGHFLFORGHODOHYD

El error máximo siempre es menor que el tiempo de ciclo de la leva.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

relativo

Comentarios
para levas de tiempo

+2.0

CBEGIN

DINT

L#-100000000

Inicio de leva (IL)

+6.0

CEND

DINT

L#100000000

Final de leva (FL) ≙ Tiempo de conexión
Rango admisible de valores para inicio de leva:
● -1.000.000.000 µm a 1 000 000 000 µm
Rango admisible de valores para tiempo de conexión:
● (0 a 13421) × 100 µs con un máximo de 16 levas
● (0 a 26843) × 100 µs con un máximo de 32 levas
● (0 a 53686) × 100 µs con un máximo de 64 levas
● (0 a 65535) × 100 µs con un máximo de 128 levas

536

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Definir tiempo de anticipación
Tiempo de anticipación
Los retardos de los elementos de maniobra conectados se pueden compensar definiendo un
tiempo de anticipación. El tiempo de anticipación se define en pasos de 100 µs. Es posible
conceder un tiempo de anticipación por leva. El tiempo de anticipación es válido para el inicio
y el final de la leva.
Recorrido de anticipación
El recorrido de anticipación de una leva se calcula continuamente en función de la velocidad
actual y del tiempo de anticipación. Toda la leva se desplaza ese recorrido en la dirección del
valor real. El área parametrizada se denomina "área estática" y el área calculada atendiendo
al tiempo de anticipación se denomina "área dinámica".
Recorrido de anticipación = tiempo de anticipación × velocidad actual
El cálculo de los recorridos de anticipación de todas las levas se realiza dentro de ¼ del tiempo
de anticipación más largo parametrizado en el FM x52. Si parametriza un tiempo de
anticipación muy prolongado para una leva, el ajuste dinámico se calcula con menos
frecuencia.
Tiempo de anticipación real
El tiempo de anticipación real se calcula del modo siguiente:
1. Calcule el tiempo de ciclo de la leva: Es el tiempo en el que el FM x52 ha procesado por
completo todas las levas. Depende del alcance parametrizado.
2. Calcule el tiempo de anticipación real con la fórmula siguiente:
7LHPSRGHGLVSRQLELOLGDGUHDO Q¼PHURHQWHUR

7LHPSRGHGLVSRQLELOLGDG

7LHPSRGHFLFORGHOD
'

7LHPSRGHFLFORGHODOHYD 

OHYD 

Significados:
– Tiempo de anticipaciónreales el tiempo de anticipación ajustado por el FM x52.
– Tiempo de anticipación D es el tiempo de anticipación preseleccionado.
– Número entero ( ) significa que para el cálculo de lo comprendido entre paréntesis sólo
se tiene en cuenta el valor anterior al decimal.
El error máximo del tiempo de anticipaciónreal siempre es menor que el tiempo de ciclo de la leva
× 4.
Ejemplo:
Se especifican los valores siguientes:
● Alcance: máximo 32 levas
● Tiempo de ciclo de la leva: 40,96 µs
● Tiempo de anticipaciónD = 1000 µs
Resultado: Se obtiene un tiempo de anticipación real de 983 µs.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

537

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Nota
El tiempo de anticipación real siempre es menor que el tiempo de anticipación parametrizado.
Puede ser 0 aunque el tiempo de anticipación parametrizado sea ≥100 µs.
El recorrido de anticipación en un eje rotativo tiene que ser menor que el área del eje rotativo
y la parte no activa de la leva. Esto tiene que estar garantizado para todas las velocidades.
Nota
No se soporta un tiempo de anticipación en relación con un encóder absoluto (SSI) ni con una
dirección de contaje parametrizada como invertida.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

LTIME

INT

0

Tiempo de anticipación

relativo
+ 10.0

Rango de valores admisible:
● (0 a 53686) × 100 µs con un máx. de 16 levas
● (0 a 65535) × 100 µs con un máx. 32, 64 o 128 levas

Ajuste dinámico de una leva
Para el rango de la leva se distinguen dos casos:
1. El rango estático y el rango dinámico de la leva están superpuestos.
2. El rango estático y el rango dinámico de la leva no están superpuestos.

538

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra para ambos casos el cálculo del ajuste dinámico.
Ajuste dinámico

Descripción
,/

6HQWLGRGHOPRYLPLHQWR

)/

9DORUUHDO
/HYDQ

5HFRUULGRGHGLVSRQLELOLGDG
$MXVWHGLQ£PLFR

Cuando el rango dinámico se superpone al rango estático de
la leva, rige lo siguiente:
● Cuando se alcanza el área dinámica de la leva, ésta se
activa. Simultáneamente se bloquea el cálculo de un
nuevo ajuste dinámico.
● Si el valor real alcanza el área estática de la leva, se
vuelve a habilitar el cálculo de un ajuste dinámico nuevo
y un cambio de velocidad actúa al final de la leva.
● Si la leva se desactiva al final del área dinámica, el ajuste
dinámico vuelve a estar bloqueado hasta el final del área
estática de la leva.

,/

6HQWLGRGHOPRYLPLHQWR
9DORUUHDO
/HYDQ

5HFRUULGRGHGLVSRQLELOLGDG

)/

Cuando el área dinámica no se superpone al área estática de
la leva, rige lo siguiente:
● Cuando se alcanza el rango dinámico de la leva, ésta se
activa. Simultáneamente se bloquea el cálculo de un
nuevo ajuste dinámico.
● Al final del área estática de la leva se vuelve a habilitar el
ajuste dinámico.

$MXVWH
GLQ£PLFR

Área dinámica
Área estática
Es posible un nuevo ajuste dinámico

Nota
Modificando la dirección de giro se vuelve a habilitar la determinación del ajuste dinámico.

Selección sentido de actuación
Sentido de actuación
Existen dos sentidos de actuación posibles:
● Positivo: la leva se activa al inicio, cuando el eje se desplaza en sentido ascendente
respecto al valor real.
● Negativo: la leva se activa al final, cuando el eje se desplaza en sentido descendente
respecto al valor real.
Es posible también ajustar simultáneamente ambos sentidos de actuación.
Si se selecciona "Ninguno" la leva queda sin efecto.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

539

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Comportamiento de conmutación de la leva dependiendo del sentido de actuación
La siguiente tabla muestra el comportamiento de actuación de las levas de recorrido y de
tiempo dependiendo del sentido de actuación. Excepto en el ejemplo 5 se parte siempre de un
sentido de actuación positivo.
Nº
1

2

3

Descripción

Leva de recorrido

Leva de tiempo

,/

,/

Una leva se rebasa en el sentido de actuación

Una leva se rebasa en el sentido contrario al de
actuación

Una leva se desplaza en el sentido de actuación;
mientras está activada, cambia el
sentido del movimiento del eje

)/

,/

)/

,/

)/

,/

7LHPSRGHDFWLYDFLµQ

7LHPSRGHDFWLYDFLµQ

7LHPSRGHDFWLYDFLµQ

,/

[
W
W
7LHPSRGHDFWLYDFLµQ[ WW

4

5

Una leva se desplaza en sentido opuesto al de ac‐
tuación; en la leva el sentido de movimiento del eje
cambia al sentido de actuación

Una leva se desplaza y se abandona en un sentido
cualquiera; el sentido de actuación está ajustado
para ambas direcciones

La leva no se activa
,/

)/

,/

)/

,/

7LHPSRGHDFWLYDFLµQ
[
W
W
W

7LHPSRGHDFWLYDFLµQ[ WWW

Leva parametrizada
Leva activada

540

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

+0.1

EFFDIR_P

BOOL

TRUE

1 = Sentido de actuación positivo (+)

+0.2

EFFDIR_M

BOOL

TRUE

1 = Sentido de actuación negativo (-)

relativo

Seleccionar alarma de proceso para levas
Alarma de proceso al activar/desactivar levas
Para las levas 0 a 7 se puede definir si, al conectar, desconectar o al conectar y desconectar
la leva, debe generarse una alarma de proceso.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

+0.4

PI_SW_ON

BOOL

FALSE

1 = Alarma de proceso al activar

+0.5

PI_SW_OFF

BOOL

FALSE

1 = Alarma de proceso al desactivar

relativo

Habilitar alarma de proceso
Habilitar las alarmas de proceso
Habilitar las alarmas de proceso
Este dato máquina permite habilitar alarmas de proceso.
Es posible ajustar cuándo deben generarse las alarmas de proceso:
● Leva activa / inactiva
En los datos de leva (Página 541) es posible establecer si se tienen que generar alarmas
de proceso al activar y/o desactivar las levas 0 a 7.

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

3.2

PI_CAM

BOOL

FALSE

1 = Habilitar la alarma de proceso: Leva activa / inactiva

Evaluación de una alarma de proceso
Cuando el FM 352 dispara una alarma de proceso, en las variables OB4x_POINT_ADDR del
OB de alarma de procesos se encuentra disponible la información sobre alarmas.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

541

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra el formato del tipo de datos OB4x_POINT_ADDR:
Byte

Bit 7

Bit 6

Bit 5

Bit 4

Bit 3

Bit 2

Bit 1

Bit 0

0

0

0

0

0

0

0

0

0

1

0

0

0

0

0

Leva

0

0

2

Leva 7
activa

Leva 7
inactiva

Leva 6
activa

Leva 6
inactiva

Leva 5
activa

Leva 5
inactiva

Leva 4
activa

Leva 4
inactiva

3

Leva 3
activa

Leva 3
inactiva

Leva 2
activa

Leva 2
inactiva

Leva 1
activa

Leva 1
inactiva

Leva 0
activa

Leva 0
inactiva

La causa de la alarma se puede consultar en el byte 1.
Leva: Evalúe los bytes 2 y 3 según la tabla.

Alarmas de proceso perdidas
Si una alarma de proceso todavía no se ha terminado de procesar en el OB de alarma de
proceso, el módulo memoriza todos los eventos siguientes de alarma de proceso. Si vuelve a
aparecer un evento antes de que la alarma de proceso se haya podido disparar, el módulo
disparará la alarma de diagnóstico "Alarma de proceso perdida".

Interfaz de control y realimentación del FM 352
Aplicación
En aplicaciones especiales o en el nivel de las alarmas es preciso un acceso especialmente
rápido a las señales de respuesta y de control. A estos datos se accede directamente a través
de las áreas de entrada y salida del módulo.
Para coordinar el arranque cada vez que arranca el módulo (p. ej. tras insertar el módulo o
después de una transición STOP-RUN de la CPU), la instrucción CAM_CTRL debe llamarse
hasta que se muestre el final del arranque a través de RETVAL = 0.
Nota
Para acceder directamente a los datos del FM 352 sólo se deben emplear los datos no internos
aquí descritos del modo indicado. De lo contrario, el acceso de su programa de usuario al
módulo puede sufrir anomalías.

Leer señales de respuesta mediante acceso directo
Las direcciones de byte se indican de forma relativa con respecto a la dirección de salida del
módulo. Los nombres de los parámetros corresponden a los nombres del DB de canal.
En AWL se accede a los datos con los comandos PEB (leer 1 byte) y PED (leer 4 bytes).
Dirección
Byte 0

542

Número de bit
7

6

5

4

3

2

1

0

PARA

interno

interno

DATA_ERR

interno

DIAG

interno

interno

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Dirección
Byte 1

Número de bit
0

0

0

CAM_ACT

0

Byte 2
Byte 3

0

0

0

GO_M

MSR_DONE

SYNC

interno
0

0

FVAL_DONE

HYS

GO_P

Byte 4

ACT_POS

Byte 5
Byte 6
Byte 7
Byte 8

TRACK_OUT

Byte 9
Byte 10
Byte 11

Escribir las señales de control mediante acceso directo
Las direcciones de byte se indican de forma relativa respecto a la dirección de entrada del
módulo. Los nombres de los parámetros corresponden a los nombres del DB de canal.
En AWL se accede a los datos con los comandos PAB (escribir 1 byte) y PAW (escribir 2 bytes).
Dirección

Número de bit
7

6

5

Byte 0
Byte 1

4

3

2

1

0

DIR_P

DIR_M

0

0

interno
0

CNTC1_EN

CNTC0_EN

Byte 2

CAM_EN
TRACK_EN

Byte 3

Ejemplo: Valor real de posición ACT_POS
La dirección inicial del módulo es 512.
AWL
L PED 516

//Leer valor real de posición actual (ACT_POS) con acceso directo:
//Dirección inicial del módulo + 4

Vías de transferencia de parámetros
Se entiende por parámetros los datos máquina y los datos de leva que siguen a continuación.
La figura siguiente muestra las vías de transferencia de parámetros al FM 352.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

543

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

3*3&
RIIOLQH

&38
RQOLQH

&DUJDU
,QWHUID]GH
SDUDPHWUL
]DFLµQ

E
D





'%

'%
D


&DUJDUHQOD
3*



)0



E




3URJUDPD
GHXVXDULR



&$0B&75/

+:&RQILJ

3DU£PHWUR
GDWRV
P£TXLQD
\GHOHYD




'DWRVGH
VLVWHPD
6'%

544

D
&DUJDU

'DWRVGH
VLVWHPD
6'%



1

Guardar los parámetros en la interfaz de parametrización.

2

Guardar, compilar y cargar la configuración de hardware en la CPU.

3

La CPU escribe los parámetros en el módulo en parametrizaciones de sistema.

4

Cargar los parámetros del módulo en la programadora con el comando "Cargar sistema de
destino en PG".

5

Cargar los parámetros en el módulo desde la interfaz de parametrización con el comando "Car‐
gar sistema de destino".

6

Escribir los parámetros en el módulo con peticiones del programa de usuario.

7

Leer los parámetros desde el módulo con peticiones del programa de usuario.

8

Almacenar parámetros del programa de usuario en el DB Online.

9

Leer parámetros del DB Online en el programa de usuario.

10

Exportar parámetros desde la interfaz de parametrización hasta el DB (DB Offline o DB Online);
posteriormente, también debe cargarse un DB Offline en la CPU.

11

Importar parámetros de un DB Online o DB Offline a la interfaz de parametrización.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Casos de aplicación de la transferencia de parámetros
Caso de aplicación

Pasos

Los parámetros se editan con la interfaz de parametrización. A con‐ Ejecute los pasos 1, 2 y 3.
tinuación, el módulo se tiene que parametrizar automáticamente en
el arranque.
Los parámetros se modifican durante la puesta en servicio en el mo‐ Ejecute los pasos 4 y 5
do Test en la interfaz de parametrización.
Los parámetros modificados durante la puesta en servicio se tienen
que cargar automáticamente durante el arranque.

Ejecute los pasos 1, 2 y 3.

Los parámetros se crean con la interfaz de parametrización. En el
arranque, el módulo sólo se debe parametrizar con el programa de
usuario mediante bloques de datos.

Ejecute los pasos 10 y 6.

Para crear cómodamente datos de reserva para recetas.

Ejecute el paso 10.

Los parámetros se crean con la interfaz de parametrización. Éstos
tienen que estar a disposición del programa de usuario para modifi‐
caciones provisionales.

Ejecute los pasos 1, 2 y 3 para
la parametrización automática.
Ejecute los pasos 10 y 7 para el
acceso por medio del programa
de usuario.

Los parámetros existentes se modifican (exclusivamente) con el pro‐ Ejecute los pasos 7, 9, 8 y 6.
grama de usuario.
Para ver los datos modificados por el programa de usuario con la
interfaz de parametrización.

Ejecute el paso 11.

Los parámetros modificados por el programa de usuario se tienen
que cargar automáticamente también en el arranque.

Ejecute los pasos 6, 11, 1, 2 y 3.

2.1.3.5

Puesta en servicio del FM 352

2.1.3.6

Uso del FM 352 desde el programa de usuario

Inclusión del FM 352 en un programa de usuario
Para integrar el FM 352 en un programa de usuario pueden utilizarse instrucciones que le
facilitarán en lo posible el manejo de las funciones deseadas:
Las instrucciones CAM_INIT y CAM_CTRL se activan en el programa de usuario de la CPU.
Éstas realizan la comunicación entre la CPU y el FM 352. El DB de canal se crea
automáticamente como DB de instancia en la instrucción CAM_CTRL, si se integra la
instrucción CAM_CTRL en el proyecto.
Todos los datos de parámetros pertenecientes a un canal del módulo (datos máquina, datos
de leva) se encuentran en el DB de parámetros del módulo. Inserte un bloque de datos del tipo
CAM_PxxxTYPE en el proyecto mediante "Bloques de programa > Agregar bloque".
Dependiendo del alcance se requieren los siguientes tipos de DB:
● Hasta 16 levas: CAM_P016TYPE
● Hasta 32 levas: CAM_P032TYPE

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

545

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
● Hasta 64 levas: CAM_P064TYPE
● Hasta 128 levas: CAM_P128TYPE
Además, para el FM 352 se puede utilizar también la instrucción CAM_DIAG, que permite
transferir informaciones de diagnóstico al DB de diagnóstico. El DB de diagnóstico se crea
automáticamente como DB de instancia en la instrucción CAM_DIAG, si se integra la
instrucción CAM_DIAG en el proyecto.

Puesta en servicio del módulo
Incluso sin programa de usuario es posible realizar un primer test del módulo con el cuadro de
diálogo "Puesta en servicio". Tenga en cuenta particularmente la advertencia siguiente.
ADVERTENCIA
Se pueden producir daños personales y materiales.
Para evitar daños personales y materiales observe los puntos siguientes:
● Instale un interruptor de PARADA DE EMERGENCIA en las inmediaciones del equipo.
Sólo así puede garantizarse que en caso de un fallo del software o del equipo sea posible
desconectar la instalación de modo seguro.
● Instale finales de carrera por hardware que actúen directamente en las etapas de potencia
de todos los accionamientos.
● Asegúrese de que ninguna persona tenga acceso al área de la instalación donde hay
piezas en movimiento.
● Si controla y vigila paralelamente el FM 352 desde el programa y desde el cuadro de
diálogo "Puesta en servicio" pueden producirse conflictos cuyos efectos no están
definidos. Por lo tanto, conmute siempre la CPU al estado STOP cuando trabaje con el
cuadro de diálogo "Puesta en servicio" o bien desactive el programa.

2.1.3.7

FM 352: Diagnóstico online

Información actual sobre el módulo
Diagnóstico estándar
Indicador de errores mediante el LED de error general del FM 352
¿Dónde se indica el error?
Si el LED rojo de error general se enciende, significa que se ha producido un error o bien en
el módulo (error interno), o bien en las conexiones de cable (error externo). El LED se ilumina
también en caso de errores de aparición breve, por lo menos, durante 3 s.

546

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

¿Qué errores se indican?
La tabla siguiente contiene los tipos de error que se indican mediante el LED de error general.
LED

Significado

Aclaraciones

SF

Error de grupo de fa‐
Este LED indica los siguientes estados de error del FM 352:
llos internos y externos ● Alarma de proceso perdida
● Vigilancia de tiempo transcurrida
● FM 352 no configurado
● FM 352 parametrizado con errores
● Falta tensión auxiliar externa de 24 V
● Falta conector frontal
● Rotura de hilo Encoder
● Fallo operativo
● Error de telegrama encóder absoluto
● Pulso erróneo encoder incremental o falta marca cero
Para eliminar el error, ver Clases de error (Página 552).

Diagnóstico específico de canal
Disparo de alarmas de diagnóstico
Procesamiento de las alarmas
El FM 352 puede disparar alarmas de proceso y de diagnóstico. Estas alarmas se procesan en
un OB de alarma. Cuando se dispara una alarma sin que se encuentre cargado el OB
correspondiente, la CPU pasa a STOP.
Para habilitar las alarmas de diagnóstico se procede del modo siguiente:
1. Seleccione el módulo en HWCN
2. Habilite la alarma de diagnóstico en Edición > Propiedades del objeto > Parámetros
básicos.
3. Guardar y compilar la configuración.
4. Cargue la configuración en la CPU

Visión de conjunto de las alarmas de diagnóstico
Los eventos y errores siguientes disparan una alarma de diagnóstico:
● Fallo operativo
● Datos máquina erróneos
● Datos de levas erróneos
● Error de diagnóstico
Estos errores se describen con detalle en el apartado "Clases de error (Página 552)".

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

547

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Reacción del módulo en caso de error con alarma de diagnóstico
● El procesamiento de levas se desactiva.
● Con las alarmas de diagnóstico siguientes se borra la sincronización:
– Falta conector frontal, falta tensión auxiliar externa
– se ha detectado un error de señal cero, error de línea (señales de encóder de 5 V)
– se ha rebasado la zona de desplazamiento (se notifica con un error de operador)
– Ajustar valor real no se puede ejecutar (se notifica con un error de operador)
● Las señales de control dejan de procesarse excepto en un caso.
Excepción:
En caso de desbordamiento del final de carrera por software todavía es posible un cambio
de sentido en el modo de simulación.
● Los selectores de función y las peticiones se continúan procesando.

El módulo detecta un fallo ("entrante")
Una alarma de diagnóstico es "entrante" cuando hay por lo menos un error en cola de espera.
Si no se han eliminado todos los errores, los errores restantes, se notificarán de nuevo como
"entrantes".
Secuencia:
1. El FM 352 detecta uno o varios fallos y dispara una alarma de diagnóstico. El LED de error
se enciende. El error se registra en el búfer de diagnóstico.
2. El sistema operativo de la CPU solicita el OB de alarma de diagnóstico, por ejemplo, OB 82.
3. Es posible evaluar la información de inicio del OB 82.
4. Con el parámetro OB82_MOD_ADDR se lee qué módulo ha disparado la alarma.
5. Encontrará más información si llama la instrucción CAM_DIAG.

El módulo detecta el paso al estado libre de fallos ("saliente")
Una alarma sólo es "saliente" cuando se ha eliminado el último error del módulo.
Secuencia:
1. El FM 352 detecta que todos los fallos han sido eliminados y dispara una alarma de
diagnóstico. El LED de error está apagado. El búfer de diagnóstico no se modifica.
2. El sistema operativo de la CPU solicita el OB de alarma de diagnóstico, por ejemplo, OB 82.
3. Con el parámetro OB82_MOD_ADDR se lee qué módulo ha disparado la alarma.
4. Evalúe el bit OB82_MDL_DEFECT.
Si este bit es "0", no hay errores en el módulo. Su evaluación puede finalizar aquí.

548

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Alarmas de diagnóstico según el estado de la CPU
● En estado STOP de la CPU las alarmas de diagnóstico están bloqueadas por el FM 352.
● Si con la CPU en estado STOP no se eliminan todos los fallos pendientes, el FM 352 vuelve
a notificar como "entrantes" los errores todavía no eliminados tras la transición al estado
RUN.
● Si se eliminan todos los errores pendientes con la CPU en estado STOP, el estado libre de
errores del FM 352no se notificará con una alarma de diagnóstico tras la transición al
estado RUN.

Evaluación de errores en el programa de usuario
Reacción de errores en el programa de usuario
En el programa de usuario es posible reaccionar de forma precisa a los errores que aparecen.
Para ello se dispone de los siguientes recursos:
● Los valores de retorno RETVAL de las instrucciones integradas como indicador de grupo
de los errores que han aparecido durante el transcurso de las instrucciones.
● Los bits de error _ERR de las peticiones como indicador de grupo de errores que se han
producido durante la ejecución de una petición.
● El bit de error DATA_ERR como indicador de grupo de un error que el FM 352 ha detectado
durante una petición de escritura.
● La identificación de errores en JOB_ERR de la causa de error en la comunicación entre la
instrucción y el FM 352.
● La instrucción CAM_DIAG para leer el búfer de diagnóstico del FM 352. Aquí es posible
averiguar las causas de error de las peticiones y los eventos asíncronos (fallos operativos
y errores de diagnóstico).
● Alarma de diagnóstico para una respuesta rápida a eventos.

Búfer de diagnóstico del módulo
Eventos de diagnóstico
El búfer de diagnóstico del módulo contiene como máximo 4 eventos de diagnóstico y está
organizado como búfer anular.
Un evento de diagnóstico se escribe en el búfer cuando se detecta un aviso (de error) entrante.
Esto puede ser un aviso, un error isócrono (error de datos) o incluso un error asíncrono (error
de servicio y error de diagnóstico). De una causa de un error pueden surgir también varias
entradas como errores consiguientes. Los avisos salientes no generan entradas en el búfer de
diagnóstico.
Para cada evento de diagnóstico se indican:
● Estado (siempre entrante)
● Error interno

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

549

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
● Error externo
● Clase de error
● Número de error.
● Número de canal
● Número de levas (si hay errores de datos de levas)
Cuando se escribe un evento de diagnóstico en el búfer de diagnóstico, la señal de
realimentación DIAG = 1 se activa.
El búfer de diagnóstico puede transferirse como un todo con la instrucción CAM_DIAG a un
bloque de datos (DB de diagnóstico) o a través de un cuadro de diálogo de evaluación de
errores del software de configuración. Si se lee el búfer de diagnóstico, el módulo activa la
señal de realimentación DIAG = 0.
Nota
Si el búfer de diagnóstico se lee al mismo tiempo con la instrucción CAM_DIAG y el cuadro de
diálogo de evaluación de errores, puede ocurrir que uno de los eventos de diagnóstico que se
ha producido no sea detectado por el programa.

Datos y estructura del DB de diagnóstico
Datos y estructura del DB de diagnóstico
Nota
Los datos que no se indican en esta tabla no deben ser modificados.

La tabla siguiente muestra la estructura del DB de diagnóstico.
Dirección

Nombre

Tipo

valor inicial

Comentarios

0.0

MOD_ADDR
(registrar)

INT

0

Dirección del módulo

256.0

JOB_ERR

INT

0

Error de comunicación

258.0

JOBBUSY

BOOL

FALSE

1 = Petición activa

258.1

DIAGRD_EN

BOOL

FALSE

1 = Leer el búfer de diagnóstico necesaria‐
mente

260.0

DIAG_CNT

INT

0

Número de entradas válidas de la lista

262.0

DIAG[1]

STRUCT

Entrada más reciente de datos de diagnós‐
tico

272.0

DIAG[2]

STRUCT

Segunda entrada de datos de diagnóstico

282.0

DIAG[3]

STRUCT

Tercera entrada de datos de diagnóstico

292.0

DIAG[4]

STRUCT

Última entrada de datos de diagnóstico

550

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra la estructura de una entrada de diagnóstico DIAG[n].
Dirección

Nombre

Tipo

valor inicial

Comentarios

+0.0

STATE

BOOL

FALSE

0 = Evento saliente
1 = Evento entrante

+0.1

INTF

BOOL

FALSE

1 = Error interno

+0.2

EXTF

BOOL

FALSE

1 = Error externo

+2.0

FCL

INT

0

Clase de error
1: Fallo operativo
4: Fallo de datos
5: Fallo de datos máquina
7: Fallo de datos de leva
15: Avisos
128: Error de diagnóstico

+4.0

FNO

INT

0

Número de error 0 a 255

+6.0

CH_NO

INT

0

Número de canal (siempre 1)

+8.0

CAMNO

INT

0

Número de leva de 0 a 127 con clase de error = error de datos de
leva

Lista de los avisos JOB_ERR
Avisos JOB_ERR
JOB_ERR
(Hex)

JOB_ERR
(Dec)

JOB_ERR
(Int)

Significado

80A0

32928

-32608

Acuse negativo al leer el módulo. Módulo extraído durante la lectura o mó‐
dulo defectuoso.

80A1

32929

-32607

Acuse negativo al escribir en el módulo. Módulo extraído durante la escritura
o módulo defectuoso.

80A2 1)

32930

-32606

Error de protocolo en la capa 2 (transferencia de datos dentro de PROFI‐
NET / PROFIBUS DP interrumpida, p. ej. por rotura de hilo, ausencia de
conector de cierre, error de parametrización, etc.)

80A3 1)

32931

-32605

Error de protocolo en User-Interface/User (transferencia de datos dentro de
PROFINET / PROFIBUS DP interrumpida, p. ej. por rotura de hilo, ausencia
de conector de cierre, error de parametrización, etc.)

80A4 1)

32932

-32604

Anomalía en la comunicación del bus K

80B1

32945

-32591

Indicación de longitud errónea. Parámetro FM_TYPE del DB de canal para el
módulo utilizado no activado correctamente.

80B2

32946

-32590

El slot configurado no está ocupado.

32947

-32589

El tipo de módulo real no es igual al tipo de módulo teórico.

80B3
1)

32960

-32576

El módulo aún no tiene preparados los datos que hay que leer.

80C1 1)

80C0

32961

-32575

Los datos de una tarea de escritura semejante todavía no se han procesado
en el módulo.

80C2 1)

32962

-32574

El módulo procesa de instante el número máximo posible de peticiones.

80C3

1)

32963

-32573

Los recursos necesarios (memoria, etc.) están ocupados de instante.

80C4

1)

32964

-32572

Error de comunicación

80C5 1)

32965

-32571

La periferia descentralizada no está disponible.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

551

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
JOB_ERR
(Hex)

JOB_ERR
(Dec)

JOB_ERR
(Int)

Significado

80C6 1)

32966

-32570

Cancelación de las clases de prioridad (rearranque normal o en segundo
plano)

8522

34082

-31454

DB del canal o DB de parámetros demasiado corto. No se pueden leer los
datos del DB. (Petición de escritura)

8532

34098

-31438

El número de DB del DB de parámetros es demasiado grande. (Petición de
escritura)

853A

34106

-31430

DB de parámetros no presente. (Petición de escritura)

8544

34116

-31420

Error en el enésimo (n > 1) acceso de lectura a un DB tras un error. (Petición
de escritura)

8723

34595

-30941

DB del canal o DB de parámetros demasiado corto. No se pueden escribir los
datos en el DB. (Petición de lectura)

8730

34608

-30928

DB de parámetros protegido contra escritura en la CPU No se pueden es‐
cribir los datos en el DB (petición de lectura)

8732

34610

-30926

El número de DB del DB de parámetros es demasiado grande. (Petición de
lectura)

873A

34618

-30918

DB de parámetros no presente. (Petición de lectura)

8745

34629

-30907

Error en el enésimo (n > 1) acceso de escritura a un DB tras un error. (Peti‐
ción de lectura)

1)

Los errores 80A2 a 80A4 así como 80Cx son temporales, es decir, se pueden eliminar tras un tiempo de espera sin la
intervención del usuario. Los avisos con la estructura 7xxx indican situaciones temporales de la comunicación.

Clases de error
Fallo operativo
Clase de error 1: Fallo operativo
Los fallos operativos se detectan de forma asíncrona respecto a un control.
La tabla siguiente muestra los fallos operativos posibles y sus causas.
Nº

Significado

1

Rebase del inicio del final de carrera por software

Sí

2

Rebase del fin del final de carrera por software

Sí

3

Rebase del inicio de la zona de desplazamiento

Sí

4

Rebase del fin de la zona de desplazamiento

Sí

Ajustar valor real al vuelo no ejecutable

Sí

13

Causa

Alarma de diag‐
nóstico

Los finales de carrera por software, tras ajustar valor real al vuelo, se en‐
cuentran fuera de la zona de desplazamiento
(-100 m...+100 m o -1.000 m...+1.000 m).
El decalaje resultante de Ajustar valor real / Ajustar valor real al vuelo es
mayor que ±100 m o ±1.000 m.

Efecto

552

Eje no sincronizado.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Error de datos
Clase de error 4: Error de datos
Los errores de datos se detectan de forma síncrona respecto a un control/mando.
La tabla siguiente muestra los errores de datos posibles y sus causas.
Nº

Significado

10

Decalaje de señal cero erróneo
Causa

Alarma de diag‐
nóstico
No

El decalaje de señal cero es mayor que ± 100 m o ± 1.000 m.
Los finales de carrera por software, tras ajustar el decalaje de señal cero, se
encuentran fuera de la zona de desplazamiento
(-100 m...+100 m o -1.000 m...+1.000 m).
Eje rotativo: El valor del decalaje de señal cero es mayor que el final del eje
rotativo.

11

Indicación del valor real errónea
Causa

no

Eje lineal: La coordenada se encuentra fuera del final de carrera por soft‐
ware actual (que puede estar desplazado).
Eje rotativo: La coordenada es < 0 o mayor que el final del eje rotativo.

12

Punto de referencia erróneo
Causa

no

Eje lineal: La coordenada se encuentra fuera del final de carrera por soft‐
ware actual (que puede estar desplazado).
Eje rotativo: La coordenada es < 0 o mayor que el final del eje rotativo.

20

Activar datos máquina no admisible
Causa

21

27

En el módulo no hay datos máquina nuevos (sin errores)

Ajustar valor real al vuelo no admisible
Causa

no

Se ha intentado ejecutar "Ajustar valor real al vuelo" teniendo "Redisparar
punto de referencia" activado.

Ajuste codificado en bits no permitido
Causa

no

no

Los bits no utilizados y no descritos aquí son distintos a 0.
Se ha intentado seleccionar simultáneamente" Medición de longitud" y
"Captura de bordes".

28

Redisparar el punto de referencia no admisible
Causa

no

Se ha intentado ejecutar "Redisparar el punto de referencia" estando "Ajus‐
tar valor real al vuelo" pendiente.
Se ha intentado ejecutar "Redisparar el punto de referenciao" con un encó‐
der SSI.

29

Comando codificado en bits no permitido
Causa

no

Los bits no utilizados y no descritos aquí son distintos a 0.

30

Tiempo de anticipación erróneo

no

31

Número de leva erróneo

no

Causa

La leva no es válida.
El número de leva no se encuentra en el rango 0..127.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

553

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Nº

Significado

32

Inicio de leva erróneo
Causa

Alarma de diag‐
nóstico
no

El inicio de leva se encuentra fuera de la zona de desplazamiento
(-100 m...+100 m ó -1000 m...+1000 m).
Eje rotativo: El principio de leva es < 0 o mayor que el final del eje rotativo.

33

Fin de leva erróneo / Tiempo de activación erróneo
Causa

no

El fin de leva se encuentra fuera de la zona de desplazamiento
(-100 m...+100 m ó -1000 m...+1000 m).
Eje rotativo: El final de leva es < 0 o mayor que el final del eje rotativo.
La leva no está activada por lo menos en la duración de un impulso.
En una leva invertida no hay una distancia mínima de 4 impulsos entre inicio
de leva y fin de leva.

34

No es posible cancelar la activación del valor real
Causa

35

no

Con un encóder SSI y un eje líneal, tras la ejecución del ajuste el valor real
de posición se encontraría fuera de la zona de trabajo.

Indicación del valor real errónea al Ajustar valor real / Ajustar valor real al vuelo
Causa

no

La indicación del valor real se encuentra fuera del margen numérico admi‐
sible de ± 100 m ó ± 1.000 m.
Tras la ejecución del ajuste, los finales de carrera por software se encon‐
trarían fuera de la zona de desplazamiento
(-100 m...+1000 m ó -1.000 m...+1.000 m).
El decalaje resultante de Ajustar valor real / Ajustar valor al vuelo sería
mayor que ±100 m ó ±1.000 m.

107

Eje no parametrizado
Causa

no

En el eje no hay ningún dato máquina disponible.
En el eje no hay ningún dato máquina activado.

108

Eje no sincronizado
Causa

no

Uno de los ajustes "Ajustar valor real" o "Ajustar valor real al vuelo" se ha
activado a pesar de que el eje no está sincronizado.

109

Procesamiento de levas en curso.

no

110

Número erróneo de levas a modificar

no

Error de datos máquina
Clase de error 5: Error de datos máquina
La alarma de diagnóstico sólo se disparará con un módulo de datos del sistema (SDB) con
errores.
La tabla siguiente muestra errores de datos máquina posibles y sus causas.
Nº

Significado

Alarma de
diagnóstico

5

Error en el ajuste de la alarma de proceso

Sí

Causa

554

Ha intentado seleccionar una alarma de proceso que el módulo no soporta.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Nº

Significado

6

Distancia mínima entre bordes errónea
Causa

8

Sí

El valor del final del eje rotativo se encuentra fuera del rango admitido de 1 a
109 µm o respectivamente de 1 a 108 µm (según sea la resolución).
Sí

El valor del tipo de encóder se encuentra fuera del rango admisible de 1 a 10

Recorrido erróneo por vuelta
Causa

Sí

Como tipo de eje no ha indicado ni 0 ni 1.

Tipo de encóder erróneo
Causa

11

Ha indicado como distancia mínima entre bordes un valor < 0 ó > 10 µm.

Final erróneo del eje rotativo
Causa

10

Sí
9

Tipo de eje erróneo
Causa

9

Alarma de
diagnóstico

Sí

El valor del recorrido/vuelta se encuentra fuera del margen admisible de 1 a
109 µm (independientemente de la resolución).

13

Número erróneo de incrementos/vuelta del encóder(véase el apartado "Incrementos por vuelta
del encóder (Página 524)")

Sí

14

Número erróneo de vueltas (véase el apartado ""Número de vueltas de encóder (Página 529)")

Sí

15

Velocidad de transferencia errónea

Sí

Causa
16

Para la velocidad de transferencia ha indicado un valor fuera del rango admi‐
sible de 0 a 3.

Coordinada del punto de referencia errónea
Causa

Sí

La coordenada se encuentra fuera del margen de -100 m a +100 m o, res‐
pectivamente, de -1000 m a +1000 m, según la resolución.
Eje lineal: La coordenada se encuentra fuera de la zona de trabajo.
Eje rotativo: La coordenada es < 0 o mayor que el final del eje rotativo.

17

Reajuste erróneo del encóder absoluto
Causa

18

21

Sí

Ha puesto en "FALSE" la vigilancia de errores de telegrama en el DB de pa‐
rámetros.

Inicio erróneo del final de carrera por software
Causa

Sí

Ha indicado un valor fuera de los valores admisibles 0 y 1.

Supervisión de hardware no posible
Causa

Sí

Ha indicado un valor fuera de los valores admisibles 0, 1, 6 y 7.

Ajuste erróneo del sentido
Causa

20

Encóder SSI de recorrido: El valor del reajuste del encóder absoluto no se
encuentra dentro del rango del encóder
(Incrementos por vuelta × Cantidad de vueltas - 1).

Forma errónea para redisparar el punto de referencia
Causa

19

Sí

Sí

Eje lineal: El inicio del final de carrera por software se encuentra fuera de la
zona de desplazamiento (-100 m...+100 m ó
-1000 m...+1000 m, dependiendo de la resolución).
Eje lineal: El inicio del final de carrera por software (dado el caso, incluido un
decalaje de señal cero presente) es menor que -100 m ó -1000 m (según la
resolución).

22

Fin erróneo del final de carrera por software

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Sí

555

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Nº

Significado
Causa

Alarma de
diagnóstico
Eje lineal: El fin del final de carrera por software se encuentra fuera de la zona
de desplazamiento (-100 m...+100 m ó
-1000 m...+1000 m, dependiendo de la resolución) o es menor que el inicio del
final de carrera por software.
El fin del final de carrera por software (dado el caso, incluido un decalaje de
señal cero presente) es mayor que +100 m ó +1000 m (según la resolución).

144

Alcance erróneo
Causa

145

Sí
Para el alcance ha indicado un valor distinto de 0 a 3.

Histéresis errónea
Causa

Sí
La histéresis se encuentra fuera del rango 0..65535 × resolución.
El decalaje de señal cero es mayor que ¼ × zona de trabajo o ¼ × área de eje
rotativo.

146

Velocidad de simulación errónea
Causa

Sí

La velocidad de simulación se encuentra fuera del rango 1000 × RES hasta 3
× 107 × RES o es mayor que 5 × 108 µm/min.
La velocidad de simulación no puede ajustarse internamente.

147

Pista errónea
Causa

148

Se ha seleccionado el control de una pista fuera de 0..15 (bit 0..15).

Selección errónea de entradas de habilitación
Causa

149

Sí

Ha querido habilitar una pista fuera de 3..10 (bit 0..7) mediante una señal
externa.

Selección errónea de una pista especial
Causa

Sí

Ha querido definir una pista fuera de 0, 1 y 2 (bit 0, 1 y 2) a modo de pista
especial

150

Valor de contaje superior erróneo pista 0

151

Valor de contaje superior erróneo pista 1

Causa

Sí

Ha indicado un valor de contaje < 2 ó > 65535 como valor de contaje superior.

Causa
200

Sí

Sí

Ha indicado un valor de contaje < 2 ó > 65535 como valor de contaje superior.

Resolución errónea
Causa

Sí

Ha indicado una resolución < 0,1 µm/impulso ó >1000 µm/impulso.
Ha indicado un recorrido/vuelta y una cantidad de impulsos/vuelta que dan
una resolución < 0,1 ó > 1000.

201

El encóder de recorrido no se adapta a la zona de trabajo / área del eje rotativo
Causa

Sí

Encóder SSI de recorrido y eje rotativo: El encóder de recorrido no cubre
exactamente el área del eje rotativo.
Eje lineal: El encóder de recorrido no cubre ni siquiera la zona de trabajo
(finales de carrera por software incluidos).

Error de datos de leva
Clase de error 7: Error de datos de leva
La alarma de diagnóstico sólo se disparará con un bloque de datos del sistema (SDB) con
errores.

556

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra los errores de datos de leva posibles y sus causas.
Nº

Significado

1

Alarma de proceso no admisible
Causa

2

Alarma de diag‐
nóstico
Ha querido indicar una alarma de proceso con una leva con un número > 7.

Número de pista erróneo
Causa

3

Sí
Sí

El número de pista se encuentra fuera del margen 0 a 31.

Inicio de leva erróneo
Causa

Sí

El inicio de leva se encuentra fuera de la zona de desplazamiento
(-100 m...+100 m ó -1000 m...+1000 m).
Eje rotativo: El principio de leva es < 0 o mayor que el final del eje rotativo.

4

Final de leva erróneo
Causa

Sí

El fin de leva se encuentra fuera de la zona de desplazamiento
(-100 m...+100 m ó -1000 m...+1000 m).
La leva no tiene una longitud de por lo menos 1 impulso.
Eje rotativo: El final de leva es < 0 o mayor que el final del eje rotativo.
En una leva invertida no hay una distancia mínima de 4 impulsos entre inicio
de leva y fin de leva.

5

Tiempo de activación erróneo

6

Tiempo de anticipación erróneo1)

Demasiados juegos de levas
Causa

51

Eje en funcionamiento

Sí

Ha querido indicar juegos de levas con la leva electrónica activada.

Eje no parametrizado
Causa

1)

Sí

Ha querido indicar más juegos de levas de los posibles con este alcance.

Causa
52

Sí

El tiempo de anticipación es < 0 µs. El valor máximo (Página 537) depende
del alcance.

Causa
50

Sí

El tiempo de conexión es < 0µs. El valor máximo (Página 536) depende del
alcance.

Causa

Sí

Ha querido indicar datos de levas a pesar de que todavía no hay datos má‐
quina activos.

El mensaje de error también puede aparecer si ha parametrizado el sentido de contaje "invertido" en combinación con un
encóder absoluto (SSI).

Avisos
Clase de error 15: Avisos
La tabla siguiente muestra los avisos posibles y sus causas.
Nº

Significado

1

Inicio de parametrización
Causa

Alarma de diag‐
nóstico
no

El módulo ha detectado una parametrización mediante un bloque de datos
del sistema.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

557

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Nº

Significado

2

Final de la parametrización
Causa

Alarma de diag‐
nóstico
no

El módulo ha procesado sin problemas la parametrización mediante un blo‐
que de datos del sistema.

Error de diagnóstico
Clase de error 128: Error de diagnóstico
La tabla siguiente muestra los errores de datos posibles y sus causas, así como los efectos y
las soluciones posibles.
N.º

Significado

Alarma de diag‐
nóstico

4

Falta tensión auxiliar externa

Sí

Causa

La tensión auxiliar externa de 24 V no se ha conectado o ha caído, falta el
conector frontal

Efecto

Consulte "Activación de alarmas de diagnóstico (Página 547)":
● El procesamiento de levas se desactiva
● Desconexión de las salidas de pista:
● Borrado de la sincronización, con encóders incrementales
● El FM 352 no está parametrizado (señal de realimentación PARA = 0).

Solución
51

Comprobar que la conexión de 24 V sea correcta (si la conexión de 24 V es
correcta, el módulo está averiado).

Vigilancia de tiempo transcurrida
Causa

Sí

● Interferencias fuertes en el FM 352
● Error en el FM 352

Efecto

● El módulo se resetea
● Siempre que tras el reseteado del módulo no se detecte ningún defecto en
el módulo, este vuelve a estar listo para funcionar.
● El módulo notifica el transcurso de la vigilancia del tiempo (watchdog) con
"entrante" y "saliente"

Solución

● Eliminación de interferencias
● Consulte al departamento comercial correspondiente cuando las
circunstancias exactas que han dado lugar al error son de mayor entidad.
● Cambio del FM 352

52

Caída de la alimentación interna del módulo
Causa

Error en el FM 352

Efecto

● El módulo se resetea

Sí

● Siempre que tras el reseteado del módulo no se detecte ningún defecto en
el módulo, este vuelve a estar listo para funcionar.
Solución

558

Cambio del FM 352

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
N.º

Significado

Alarma de diag‐
nóstico

70

Alarma de proceso perdida
Causa

El FM 352 ha detectado un evento de alarma de proceso, que no puede ser
notificado porque el mismo evento todavía no ha sido procesado por el pro‐
grama de usuario o la CPU.

Efecto

● El procesamiento de levas se desactivará

Sí

● Desconexión de las salidas de pista:
● Borrado de la sincronización, con encóders incrementales
Solución

● Incorporar el OB 40 en el programa de usuario
● Comprobar la conexión de bus del módulo
● Desactivar la alarma de proceso
● Adapte el hardware y software a las necesidades de su proceso (p. ej.
CPU más rápida, optimizar el programa de usuario)

144

Rotura de hilo Encóder
Causa

Sí

● El cable del encóder no está enchufado o está cortado
● Encóder sin señales de cuadratura
● Asignación de pines errónea
● Longitud de cable excesiva
● Cortocircuito de las señales del encóder

Efecto

● El procesamiento de levas se desactivará
● Desconexión de las salidas de pista:
● Borrado de la sincronización, con encóders incrementales

Solución

● Comprobar el cable del encóder
● Guardar los datos técnicos del encóder
● La vigilancia puede desactivarse de forma provisional con el cuadro de
diálogo de parametrización bajo la responsabilidad del operador.
● Guardar las especificaciones técnicas del módulo

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

559

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
N.º

Significado

145

Error de telegrama Encóder absoluto
Causa

Alarma de diag‐
nóstico
Sí

El tráfico de telegramas entre el FM 352 y el encóder absoluto (SSI) tiene
errores o está interrumpido:
● El cable del encóder no está enchufado o está cortado
● Tipo de encóder erróneo
● Encóder mal configurado (encóders programables)
● Longitud de telegrama mal indicada
● El encóder proporciona valores erróneos (encóder defectuoso)
● Interferencia en el cable del sistema de medición
● Velocidad de transferencia escogida demasiado alta

Efecto

● El procesamiento de levas se desactivará
● Desconexión de las salidas de pista:
● el último valor real correcto se mantiene sin cambios hasta el final de la
siguiente transferencia SSI correcta

Solución

● Comprobar el cable del encóder
● Comprobar el encóder
● Comprobar el tráfico de telegramas entre el encóder y el FM 352

146

Impulsos erróneos (encóder incremental)
Causa

Sí

● Vigilancia del encóder ha detectado impulsos erróneos
● La cantidad de incrementos por vuelta está mal introducida
● Encóder defectuoso: no proporciona la cantidad de impulsos indicada
● Marca cero errónea o no presente
● Interferencias en el cable del encóder

Efecto

● El procesamiento de levas se desactivará
● Desconexión de las salidas de pista:
● Borrado de la sincronización

Solución

● Indicar correctamente el número de incrementos/vuelta.
● Comprobar el encóder y su cable
● Cumplir las normas de apantallamiento y de conexión a tierra
● La vigilancia puede desactivarse de forma provisional con el cuadro de
diálogo de parametrización bajo la responsabilidad del operador.

560

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

2.1.4

Uso del FM 452

2.1.4.1

Asignación de terminales del conector frontal del FM 452

Conector frontal
En el conector frontal de 48 polos se conectan:
● el encóder;
● las salidas y las entradas digitales;
● las tensiones de alimentación de los encóders y de las salidas digitales.

Asignación de terminales del conector frontal (X1)
La tabla siguiente contiene la asignación de terminales del conector frontal del FM 452.
Terminal

Nombre

Detector de
proximidad

1

–

2

–

Encóder incremental

Encóder absoluto

3

1L+

Tensión auxiliar DC 24 V

4

A/DAT

–

Señal de encoder A (5 V)

5

/A / /DAT

–

Señal de encóder A (5 V) in‐ Datos SSI invertidos
vertida

6

B / CLI 1)

–

Señal de encoder B (5 V)

7

/B / /CLI 1)

–

Señal de encoder B (5 V) in‐ Pulso de desplazamiento SSI
vertida
entrada invertida 1)

8

N

–

Señal de marca cero (5 V)

9

/N

–

Señal de marca cero inverti‐ –
da (5 V)

10

CLS 2)

–

–

Pulso de desplazamiento SSI
salida

11

/CLS 2)

–

–

Pulso de desplazamiento SSI
salida inverso

12

A*

Señal de encóder A (24 V)

–

13

B*

–

Señal de encóder B (24 V)

–

14

N*

–

Señal de marca cero (24 V)

–

15

Q0

Salida digital 0

16

Q1

Salida digital 1

17

Q2

Salida digital 2

18

Q3

Salida digital 3

19

Q4

Salida digital 4

20

Q5

Salida digital 5

21

Q6

Salida digital 6

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Datos SSI

Pulso de desplazamiento SSI
entrada 1)

–

561

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Terminal

Nombre

Detector de
proximidad

Encóder incremental

Encóder absoluto

22

Q7

Salida digital 7

23

DC 5.2 V

–

24

DC 24 V

Alimentación del encoder (24 V)

25

M 3)

Masa encoder

26

2L+

Tensión auxiliar DC 24 V

27

RE

–

28

Q8

Salida digital 8

29

Q9

Salida digital 9

30

Q10

Salida digital 10

31

Q11

Salida digital 11

32

Q12

Salida digital 12

33

Q13

Salida digital 13

34

Q14

Salida digital 14

35

Q15

Salida digital 15

36

3L+

Tensión auxiliar DC 24 V

37

I0

Habilitación de pista de leva de freno

38

I1

Medición de longitud/Detección de bordes/Ajustar valor real al vuelo

39

I2

Sensor del punto de referencia

40

I3

Habilitación de la señal de pista 3

41

I4

Habilitación de la señal de pista 4

42

I5

Habilitación de la señal de pista 5

43

I6

Habilitación de la señal de pista 6

44

I7

Habilitación de la señal de pista 7

45

I8

Habilitación de la señal de pista 8

46

I9

Habilitación de la señal de pista 9

47

I10

Habilitación de la señal de pista 10

48

M 3)

Masa para tensiones auxiliares

Alimentación del encoder (5,2 V)

Salida tipo PNP/NPN 4)

1)

En modo de escucha

2)

En modo maestro

3)

Las conexiones de masa están cableadas en el módulo

–

Nota: si se conecta un encóder incremental de otro fabricante en contrafase (salida tipo PNP/NPN),
debe tenerse en cuenta lo siguiente:

4)

● Salida tipo PNP: conecte RE (27) con la masa (25).
● Salida tipo NPN: conecte RE (27) con +24 V (24).

Encontrará más información sobre el diseño y el cableado en las instrucciones de servicio
(http://support.automation.siemens.com/WW/view/es/1123332) de la leva electrónica FM 452.

Tensión auxiliar para encóders y salidas digitales (1L+, 2L+, 3L+)
La tensión auxiliar DC 24 V del encóder y las salidas digitales se vigila:
● por si hay una rotura de hilo en la línea de 24 V;
● por si se corta la alimentación.

562

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
En el conector frontal (X1) se proporcionan DC 24 V (borne 24) y DC 5,2 V (borne 23) para los
diferentes tipos de encóder.

Alimentaciones de carga
La alimentación de la carga DC debe satisfacer los siguientes requisitos:
Como alimentación de la carga sólo debe utilizarse una pequeña tensión DC ≤ 60 V separada
con seguridad de la red. La separación segura puede estar efectuada según los requisitos que
figuran, entre otros, en:
● VDE 0100 Parte 410/HD 384-4-41/IEC 364-4-41
(como pequeña tensión funcional con separación segura),
● VDE 0805/EN 60950/IEC 950
(como pequeña tensión de seguridad SELV) o bien
● VDE 0106 Parte 101.

11 entradas digitales (I 0 a I 10)
A través de las 11 entradas digitales es posible conectar interruptores libres de rebotes (de
24 V tipo fuente) o sensores sin contacto (detectores de proximidad de 2 ó 3 hilos).
No se supervisa el cortocircuito o rotura de hilo en las entradas digitales y carecen de
aislamiento galvánico respecto a la masa del módulo.
El estado de cada entrada se indica en el LED correspondiente.

16 salidas digitales (de Q 0 a Q 15)
Por medio de 16 salidas digitales se indica el estado correspondiente (on/off) de las pistas
entre 0 y 15. Las salidas digitales carecen de aislamiento galvánico respecto a la masa del
módulo.
Son posibles las cargas siguientes:
● Tensión de trabajo 24 V
● Carga de corriente 0,5 A/resistente al cortocircuito
El estado de cada salida se indica en el LED correspondiente.

2.1.4.2

Funciones para controlar las levas

Influencia de las funciones en el comportamiento de conmutación de las levas de tiempo
Cambios en el valor real
Es posible obviar una leva de tiempo con funciones que modifiquen el valor real:
● Ajustar valor real
● Ajustar valor real al vuelo

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

563

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
● Decalaje de señal cero
● Redisparar el punto de referencia

Activación de una leva de tiempo
Si se obvia el principio de una leva de tiempo mediante una de las funciones arriba
mencionadas, esta leva se activará siempre y cuando el sentido real del movimiento del eje se
corresponda con el sentido de actuación parametrizado para la leva. El tiempo de conexión
parametrizado se cuenta.
Nota
En posición de parada, el sentido del movimiento depende de las fluctuaciones del valor real.
Si desea tener en cuenta un sentido de movimiento definido también en posición de reposo,
deberá parametrizar una histéresis mayor que las fluctuaciones del valor real en reposo.
Si el eje no está en movimiento, se conserva el último sentido de movimiento calculado.
ADVERTENCIA
Se pueden producir daños personales y materiales.
Las funciones con modificación del valor real en un eje rotativo pueden conducir a una
activación no deseada de las levas de tiempo.
En cualquier caso, con un eje rotativo ajuste las levas de tiempo como "no válidas" a fin de
influir en el valor real mediante las funciones arriba indicadas.

Ajustar valor real / Ajustar valor real al vuelo / Cancelar preselección del valor real
Definición
Las funciones "Ajustar valor real" y "Ajustar valor real al vuelo" permiten asignar una nueva
coordenada al estado actual del sensor. Así, el sistema de coordenadas se desplaza en el
valor: REALnuevo - REALactual
Donde:
● REALnuevo es el valor predefinido
● REALactual es el valor real en el momento de la ejecución

Calcular coordenadas nuevas
Todas las posiciones preseleccionadas en el sistema de coordenadas desplazado se calculan
con la fórmula siguiente:
Coordenadanueva = Coordenadaantigua + (REALnueva - REALactual)

564

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Requisitos
● El eje tiene que estar sincronizado.
● En "Ajustar valor real al vuelo": La entrada digital I1 tiene que estar interconectada.

Desarrollo de la función
1. Introduzca las coordenadas para el valor real o para el valor real al vuelo en el DB de canal.
– Eje lineal:
El valor real indicado se debe seleccionar de tal modo que los finales de carrera por
software se encuentren todavía dentro de la zona de desplazamiento admisible tras
llamar la función.
El valor de desplazamiento que resulta de (REALnuevo - REALactual) tiene que ser menor
o igual al valor de la zona de desplazamiento admisible (máximo 100 m o 1000 m,
respectivamente).
– Eje rotativo:
Para el valor real indicado rige:
0 ≤ Valor real < Final del eje rotativo
2. Active los correspondientes bits de inicio en el DB de canal.
3. Llame la instrucción CAM_CTRL o CAM_CTRL_452.
Se ejecuta de inmediato "Ajustar valor real".
"Ajustar valor real al vuelo" se ejecuta con el flanco ascendente siguiente en la entrada
digital I1. El bit FVAL_DONE se activa.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

Valor inicial

Comentario

36.4

AVAL_EN

BOOL

FALSE

1 = Ajustar valor real

36.5

FVAL_EN

BOOL

FALSE

1 = Ajustar valor real al vuelo

90.0

AVAL

DINT

L#0

Coordenada para valor real

94.0

FVAL

DINT

L#0

Coordenada para valor real al vuelo

25.5

FVAL_DONE

BOOL

FALSE

1 = Ejecutado Ajustar valor real al vuelo

Efectos de la función
En el ejemplo "Ajustar valor real" a 400 mm (en la posición 200 mm) se muestra cómo esta
función provoca un decalaje del sistema de coordenadas. De ello resultan los siguientes
efectos:
● La posición de la zona de trabajo no se desplaza físicamente.
● A cada uno de los puntos (como, p.ej. a los finales de carrera por software) se les asignan
nuevos valores de coordenadas.
● Las levas conservan sus valores de coordenadas y, por lo tanto, se encuentran en otra
posición física.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

565

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
● En el caso del eje sincronizado y procesamiento de levas habilitado, el valor real de la
posición puede obviar flancos de levas o levas completas mediante esta función.
● El cambio de estado de la leva que normalmente dispararía una alarma se podría perder.
Nota
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 563).

La tabla siguiente muestra el desplazamiento del sistema de coordenadas con "Ajustar valor
real" / "Ajustar valor real al vuelo".
Ajustar valor real

)&6, 5()


5($ )&6)










REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-400

-200

200

400

-200

0

400

600

6LVWHPDGHFRRUGHQDGDVDQWHULRU



>PP@

'HVSOD]DPLHQWR
GHOVLVWHPDGH
FRRUGHQDGDV
HQPP
$MXVWDUYDORUUHDO
DPP

UHDGHWUDEDMR

(MH

FCSI

>PP@
1XHYRVLVWHPDGHFRRUGHQDGDV

Deshacer la función
Con la función "Cancelar preselección del valor real" se deshace el decalaje de coordenadas
establecido respectivamente con "Ajustar valor real" o "Ajustar valor real al vuelo".
Un "Ajustar valor real al vuelo" iniciado no se puede borrar antes de su ejecución mediante un
flanco ascendente en la entrada I1. Pero sí puede sobrescribirse con un nuevo "Ajustar valor
real al vuelo".
Con un arranque del módulo se inicializan estas funciones.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

Valor inicial

Comentario

35.2

AVALREM_EN

BOOL

FALSE

1: Deshacer Ajustar valor real

Posibles fuentes de error
"Ajustar valor real al vuelo" y "Redisparar punto de referencia" no deben ejecutarse de forma
simultánea.

566

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
Con la función "Ajustar valor real al vuelo" puede notificarse un error de operador si esta
función implica que un final de carrera por software excede el margen de desplazamiento
admisible con un flanco ascendente en I1. Este error de operador se notifica con una alarma
de diagnóstico y queda registrado en el búfer de diagnóstico.

Ejecutar un decalaje de señal cero
Definición
Con la función "Decalaje de señal cero" se desplaza en el valor introducido la señal cero del
sistema de coordenadas. El signo define la dirección del decalaje.

Calcular nueva coordenada
Todos los valores del sistema de coordenadas desplazado se calculan con la fórmula
siguiente:
Coordenadanueva = coordenadaantigua + (DSCnueva - DSCantigua)
DSCantigua indica un decalaje anterior de señal cero. Si antes de la llamada no ha habido activo
ningún decalaje de señal cero, introduzca para DSCantiguo el valor 0.
Con esta fórmula es posible calcular qué valores de coordenadas adoptan, por ejemplo, los
finales de carrera por software.

Desarrollo de la función
1. Introduzca el valor del decalaje de señal cero en el DB de canal.
– Eje lineal:
El decalaje de señal cero se tiene que escoger de tal modo que los finales de carrera por
software se encuentren todavía dentro de la zona de desplazamiento admisible tras la
llamada de la función.
– Eje rotativo:
Para el decalaje de señal cero rige:
Valor del decalaje de señal cero ≤ Fin del eje rotativo.
2. Active el bit de inicio correspondiente.

Datos utilizados en el DB de canal
Dirección

Nombre

36.6

ZOFF_EN

86.0

ZOFF

Tipo

valor inicial

Comentarios

BOOL

FALSE

1 = Activar decalaje de señal cero

DINT

L#0

Decalaje de señal cero

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

567

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Efectos en un eje lineal
En el ejemplo de un decalaje de señal cero de -200 mm se ve cómo esta función desplaza el
sistema de coordenadas en sentido positivo. De ello resultan los siguientes efectos:
● La zona de trabajo no se desplaza físicamente.
● A cada uno de los puntos (como, p.ej. a los finales de carrera por software) se les asignan
nuevos valores de coordenadas.
● Las levas conservan sus valores de coordenadas y, de este modo, se encuentran en otra
posición física.
● En el caso del eje sincronizado y procesamiento de levas habilitado, el valor real de la
posición puede obviar flancos de levas o levas completas mediante esta función.
● El cambio de estado de la leva que normalmente dispararía una alarma, se puede perder.
Nota
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 563).

La tabla siguiente muestra el desplazamiento del sistema de coordenadas mediante el
decalaje de señal cero.
Decalaje de señal cero

FCSI

REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-400

-200

200

400

-200

0

400

600

6LVWHPDGHFRRUGHQDGDVDQWHULRU
)&6,

5($/ )&6)








>PP@

'HFDODMHGH
FRRUGHQDGDVHQ
PPSRU
GHFDODMHGH
VH³DOFHURGH
PP

=RQDGHWUDEDMR

(MH







>PP@
1XHYRVLVWHPDGHFRRUGHQDGDV

Efectos en un eje rotativo
En el ejemplo de un decalaje de señal cero en -45° se ve cómo esta función gira el sistema de
coordenadas:

568

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra el giro del sistema de coordenadas mediante el decalaje de señal
cero.
Herramienta con REAL = 340°

Herramienta con REAL = 25°
'6& r

9$/ r
B

9$/ r

B

r

r

La señal cero gira -45 grados. Todos los puntos del eje adquieren nuevos valores de coordenada.

Considerando un DSCantiguo = 0 resulta un nuevo valor de 385°
Como al final del eje rotativo en un sentido de giro positivo el valor real empieza de nuevo en
0 el valor real de 25º se calcula a partir de:
Coordenadanueva = coordenadaantigua - (DSCnueva - DSCantigua) -final de eje rotativo
El valor Final del eje rotativo sólo tiene que restarse si
Coordenadaantigua - (DSCnueva - DSCantigua) es mayor que Final del eje rotativo.

Pérdida de la sincronización
Si se pierde la sincronización a causa de un error o se reactiva mediante "Redisparar punto de
referencia" se mantiene activo un decalaje de señal cero.

Deshacer función
Al definir un decalaje de señal cero de 0 se recupera el decalaje de señal cero existente.

Definir punto de referencia
Definición
Con la función "Definir punto de referencia" se sincroniza el eje. Esta función desplaza la zona
de trabajo. Todos los decalajes generados por decalaje de señal cero o con "Ajustar valor real"
se conservan.
La función proyecta la zona de trabajo sobre el eje. Así, con distintas entradas de valores la
zona de trabajo puede encontrarse en posiciones diferentes dentro del rango físico del eje.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

569

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Requisitos
Es preciso que el procesamiento de levas esté desactivado.

Desarrollo de la función
1. Introduzca el valor de las coordenadas del punto de referencia en el DB de canal.
– Eje lineal:
La coordenada del punto de referencia no puede encontrarse fuera de los finales de
carrera por software. Esto rige también para la coordenada del punto de referencia de
un sistema de coordenadas desplazado.
– Eje rotativo:
Para la coordenada del punto de referencia rige:
0 ≤ Coordenada del punto de referencia < Final del eje rotativo
2. Active el bit de inicio correspondiente.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

36.3

REFPT_EN

BOOL

FALSE

1 = Definir coordenada del punto de referencia

98.0

REFPT

DINT

L#0

Coordenada del punto de referencia

25.0

SYNC

BOOL

FALSE

1 = Eje sincronizado

Efectos de la función
En el ejemplo "Definir punto de referencia" a 300 mm se ve cómo esta función desplaza la zona
de trabajo en el eje.
De ello resultan los efectos siguientes:
● La posición real se fija en el valor de la coordenada del punto de referencia.
● La zona de trabajo se desplaza físicamente en el eje.
● Cada uno de los puntos conserva sus coordenadas originales pero se encuentran en
posiciones físicas nuevas.
● El bit SYNC en las señales de realimentación está activado.

570

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
La tabla siguiente muestra el desplazamiento de la zona de trabajo en el eje a través de la
función "Definir punto de referencia".
Definir punto de referencia

)&6,

5($/



DG
HWU
=RQ







REF

REAL

FCSF

[mm]

[mm]

[mm]

[mm]

-400

-200

100

400

-400

-200

300

400

6LVWHPDGHFRRUGHQDGDVDQWHULRU
)&6)


>PP@

'HFDODMH
GHOD]RQD
GHWUDEDMRSRU
ಯSUHVHOHFFGHO
SWRGHUHIDPP

DED

(MH

MR

 

FCSI

>PP@

1XHYRVLVWHPDGHFRRUGHQDGDV

Particularidades del encóder absoluto
Esta función es necesaria para un reajuste del encóder absoluto (Página 594).

Modificar flancos de leva
Definición
Con la función "Modificar flancos de leva" es posible modificar durante el funcionamiento el
principio de leva y, en el caso de las levas de recorrido, también el final de leva de una leva
individual.

Requisitos
La leva que se quiera modificar tiene que ser válida.

Desarrollo de la función
1. Escriba el número de leva en el DB de canal.
2. En una leva de recorrido:
Escriba el inicio de leva y el fin de leva en el DB de canal.
En una leva de recorrido:
Introduzca el valor del inicio de leva en el DB de canal.
3. Active el bit de inicio correspondiente.

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

571

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

36.7

CH01CAM_EN

BOOL

FALSE

1 = Escribir función para flanco de leva (1 leva)

102.0

CAM_NO

INT

0

Número de leva

104.0

CAM_START

DINT

L#0

Inicio de leva

108.0

CAM_END

DINT

L#0

Fin de leva

Efectos de la función
El FM x52 desplaza primero el flanco de activación y luego el de desactivación de la leva. Este
proceso es independiente de la dirección en la que se desplace la leva.
Caso especial:
Con el proceso que se ha descrito anteriormente puede ocurrir que durante un breve tiempo
surja una leva invertida (Página 465) si el nuevo principio de leva es mayor que el antiguo fin
de leva.
La figura siguiente muestra la modificación de los flancos de levas en pasos individuales.

,/
PP

PP

$QWHVGHOD
OODPDGD

)/
PP
)/
$QWLJXR
PP

'XUDQWH
ODOODPDGD

,/ 1XHYR

,/

)/ PP

'HVSX«VGHOD
OODPDGD

Nota
Si para esta leva se ha habilitado una alarma de proceso, al detectar la leva invertida el FM x52
puede disparar una o dos alarmas de proceso, según se haya parametrizado.
Con la modificación del flanco de activación y/o de desactivación se pueden producir saltos de
flancos de leva o de toda una leva.
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 563).
Los cambios de estado de la leva que normalmente dispararían una alarma de proceso, se
pueden perder.

Leer los valores modificados
Los valores modificados se pueden leer con una de las peticiones CAM1RD_EN a
CAM8RD_EN.

Deshacer la función
Los valores modificados se pierden al reiniciar el módulo.

572

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Ejecutar "Cambio rápido de levas"
Definición
Con la función "Cambio rápido de levas" es posible modificar simultáneamente los datos de
hasta 16 levas durante el funcionamiento.

Requisito
Las levas que se quieran modificar tienen que ser válidas.

Desarrollo de la función
1. Introduzca el número de levas que hay que modificar en el DB de canal.
2. Introduzca el número de levas que hay que modificar en el DB de canal.
3. Active los bits de inicio para los cambios deseados.
4. Introduzca los nuevos valores en el DB de canal.
5. Repita los pasos de 2 a 4 para cada leva que tenga que modificarse.
6. Active el bit de inicio correspondiente en el DB de canal

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

Absoluta
37.0

CH16CAM_EN

BOOL

FALSE

1 = Función para un cambio rápido de levas (16 levas)

176.0

C_QTY

BYTE

B#16#0

Número de levas a modificar

177.0

DIS_CHECK

BOOL

FALSE

1 = Desactivar la comprobación de datos

Dirección

Nombre

Tipo

valor inicial

Comentarios

+0.0

CAM_NO

BYTE

B#16#0

Número de la leva a modificar

+1.0

C_EFFDIR

BOOL

FALSE

1 = Cambio del sentido de actuación de la leva

+1.1

C_CBEGIN

BOOL

FALSE

1 = Cambio del inicio de la leva al valor CBEGIN

+1.2

C_CEND

BOOL

FALSE

1 = Cambio del final de leva/tiempo de conexión al valor
CEND

+1.3

C_LTIME

BOOL

FALSE

1 = Cambio del tiempo de anticipación al valor LTIME

+1.4

CAM_OFF

BOOL

FALSE

1 = Desactivación de la leva durante el cambio de leva

+1.5

EFFDIR_P

BOOL

FALSE

1 = Sentido de actuación positivo (+)

+1.6

EFFDIR_M

BOOL

FALSE

1 = Sentido de actuación negativo (-)

+2.0

CBEGIN

DINT

L#0

Nuevo inicio de leva

+6.0

CEND

DINT

L#0

Nuevo fin de leva / Nuevo tiempo de conexión

+10.0

LTIME

INT

L#0

Nuevo tiempo de anticipación

relativa

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

573

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Desactivar leva al modificar
Una modificación coherente del inicio y del final de la leva sólo es posible si en el instante de
la modificación se ha desactivado la leva (CAM_OFF).

Comprobación de datos por parte del módulo
Con el parámetro DIS_CHECK (DB de canal) se define si se tiene que desactivar la
comprobación de los datos transferidos a través del FM x52. Si se desactiva la comprobación
de datos es preciso asegurarse de que sólo se transfieren valores admisibles. Si introduce
valores no admisibles sin comprobación se puede producir un comportamiento impredecible
del módulo.
● FALSE: El módulo comprueba todos los datos que se transfieren
● TRUE: La comprobación de los datos en referencia a los parámetros de la leva está
desactivada. De este modo los datos que hay que modificar se incorporan más
rápidamente en el FM x52.
Independientemente de esta función siempre se comprueba si
– el eje está parametrizado,
– la cantidad de levas para modificar (C_QTY) es admisible,
– la leva (número de leva) que tiene que modificarse es válida.
Sólo cuando todos los datos han sido comprobados y no se han detectado problemas, se
activan en el módulo.
En caso de error todos los datos se rechazan.

Efectos de la función
Nota
Tenga en cuenta el comportamiento de conmutación con las levas de tiempo (Página 563).

Leer los valores modificados
Los valores modificados se pueden leer con una de las peticiones de CAM1RD_EN a
CAM8RD_EN.

Deshacer la función
Los valores modificados se pierden con el reinicio del módulo.

574

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas

Ejecutar "Medición de longitud" y "Captura de bordes"
Definición
Con las funciones "Medición de longitud" y "Captura de bordes" es posible calcular la longitud
de una pieza de trabajo.
La medición de la longitud y la captura de bordes están y se mantienen activos hasta que se
desactivan de nuevo o se seleccionan otros métodos de medición. Si se seleccionan ambos
métodos de medición a la vez, la instrucción CAM_CTRL o CAM_CTRL_452 activa la medición
de longitud.

Requisitos
En la entrada I1 tiene que estar conectado un conector libre de rebotes.

Proceso de las funciones
Según el tipo de medición, el FM 452 actualiza los datos del módulo en instantes distintos. El
FM 452 notifica cada actualización en un parámetro en la interfaz de realimentación.
Medición de longitud
065B21
O
$FWXDOL]DFLµQGHGDWRV
065B'21(

1. Active el selector de función de "Medición de longitud"
2. El flanco ascendente de la entrada I1 inicia la medición de longitud.
3. El flanco descendente de la entrada I1 pone fin a una medición en curso. El FM 452
actualiza los datos Valor inicial, Valor final y Longitud.
4. Con el parámetro activado MSR_DONE el FM 452 comunica la actualización de los datos.
El parámetro indica que la medición ha finalizado. Los resultados de la medición se pueden
leer.
5. El inicio de otra medición con el flanco ascendente de I1 desactiva el parámetro
MSR_DONE.
Si durante una medición de longitud se desactiva la función, el FM 452 no actualiza los datos.
El parámetro MSR_DONE se mantiene desactivado.
Captura de bordes

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

575

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
('*(B21
O
$FWXDOL]DFLµQGHGDWRV
065B'21(

1. Dado el caso, introduzca un valor para la separación mínima de bordes en el DB de
parámetros. Escriba y active los datos máquina.
2. Active el selector de función de "Captura de bordes". Se activa el parámetro MSR_DONE.
3. El flanco ascendente de la entrada I1 inicia la captura de bordes. Los resultados de la
medición se actualizan y se pueden leer, el valor inicial de la medición se registra; el valor
final y la longitud pasan a ser -1.
4. Tras la actualización, el FM 452 notifica el cambio desactivando el parámetro MSR_DONE.
5. El flanco descendente de la entrada I1 pone fin a una medición en curso. El FM 452
actualiza los datos del valor final de la medición y la longitud.
6. Tras la actualización, el FM 452 notifica el cambio activando el parámetro MSR_DONE. Los
resultados de la medición se pueden leer.
7. El inicio de otra medición con el flanco ascendente de I1 desactiva el parámetro
MSR_DONE.
Si durante una captura de bordes se desactiva la función, el FM 452 no actualiza los datos. El
parámetro MSR_DONE se mantiene desactivado.

Datos utilizados en el DB de canal
Dirección

Nombre

Tipo

valor inicial

Comentarios

25.1

MSR_DONE

BOOL

FALSE

1 = Medición de longitud cancelada

34.0

EDGE_ON

BOOL

FALSE

1 = Captura de bordes activada

34.2

MSR_ON

BOOL

FALSE

1 = Medición de longitud activada

38.2

MSRRD_EN

BOOL

FALSE

1 = Leer valores medidos

112.0

BEG_VAL

DINT

L#0

Valor inicial

116.0

END_VAL

DINT

L#0

Valor final

120.0

LEN_VAL

DINT

L#0

Longitud

Datos utilizados en el DB de parámetros
Dirección

Nombre

Tipo

valor inicial

Comentarios

4.0

EDGEDIST

DINT

L#0

Distancia mínima entre bordes en la captura de bordes
Rango de valores admisible:
● 0 ... 1 000 000 000 µm

En la captura de bordes, con la distancia mínima entre bordes se define un rango tras la
detección del inicio de la medición. Si el final del proceso de medición se encuentra dentro de
este rango, la medición se desestima.

576

Utilizar funciones tecnológicas
Manual de programación y manejo, 11/2019

Leva electrónica (S7-300, S7-400)
2.1 Control por levas
El inicio de la medición se notifica en cuanto se ha recorrido la distancia mínima entre bordes.

Condiciones específicas para una medición de longitud
● La distancia entre el flanco de activación y el flanco de desactivación en la entrada I1 tiene
que ser tal que su programa en la CPU pueda evaluar correctamente el resultado de la
medición antes de iniciar otra.
● La distancia mínima entre el flanco ascendente y descendente en la entrada I1, al igual que
entre el flanco descendente y el siguiente ascendente 