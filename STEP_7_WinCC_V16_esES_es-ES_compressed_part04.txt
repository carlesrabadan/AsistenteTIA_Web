l grupo VPN para fase 2
Fase 2: negociación IKE de Security Association (SA) para el intercambio de datos IPsec:
Aquí se ajustan los parámetros para negociar los parámetros de seguridad que se utilizarán
para el intercambio de datos IPsec con ESP (Encapsulating Security Payload) y AH
(Authentication Header). La comunicación es cifrada en la fase 2.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

447

Configuración de dispositivos y redes
1.3 Configurar redes
Las siguientes propiedades de grupo VPN son soportadas por los diferentes módulos:
Módulo

CP 1543-1 (V2.1
y superior)
CP 1543SP-1
(V2.0)
CP 1243-1 BX30
(V3.0 y superior)

Ver‐
sión
IKE

Fase 2
Duración SA

Encriptado

AES-128: Advanced Encryption
IKEv1 Time: 60 ...
16666666 minu‐ Standard (Modo CBC)
tos
3DES-168**: DES triple***
Limit: 2000 ...
DES
500000 MB

CP 1243-7 LTE
BX30 (V3.0 y su‐
perior)
CP 1243-8 IRC
BX30 (V3.0 y su‐
perior)
CP 1543-1 (hasta IKEv1 Time: 60 ...
AES-128: Advanced Encryption
2.0)
16666666 minu‐ Standard (Modo CBC)
tos
3DES-168**: DES triple***
CP 1543SP-1
(V1.0)
Limit: 2000 ...
DES
500000 MB
CP 1243-1 BX30
(hasta V2.1)

Autenticación
SHA-256: Secure
Hash Algorithm 256

ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
SHA-1***: Secure
bian nuevos valo‐
Hash Algorithm 1
res Diffie Hellman
MD5***: Message Di‐
Public Key.
gest Algorithm 5
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.
SHA-1***: Secure
Hash Algorithm 1

ACTIVO: para vol‐
ver a calcular las
MD5***: Message Di‐ claves se intercam‐
bian nuevos valo‐
gest Algorithm 5
res Diffie Hellman
Public Key.
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.

CP 1243-7 LTE
BX30 (V2.1)
CP 1243-8 IRC
BX30 (V2.1)
CP 343-1 GX31
Advanced
CP 443-1 GX30
Advanced
CP 443-1 OPC
UA

IKEv1 Time: 60 ...
AES-128*: Advanced Encryp‐
16666666 minu‐ tion Standard (Modo CBC)
tos
3DES-168**: DES triple***
Limit: 2000 ...
DES
500000 MB

SHA-1***: Secure
Hash Algorithm 1

ACTIVO: para vol‐
ver a calcular las
MD5***: Message Di‐ claves se intercam‐
bian nuevos valo‐
gest Algorithm 5
res Diffie Hellman
Public Key.
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.

CP 1628
SCALAN‐
CE S-600 V3 y
superior
SOFTNET Secu‐
rity Client V4, V5
(WinXP)

Perfect Forward Se‐
crecy

IKEv1 Time: 60 ...
2879 minutos

3DES-168**: DES triple***
DES

SHA-1***: Secure
Hash Algorithm 1

ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
bian nuevos valo‐
res Diffie Hellman
Public Key.
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.

448

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Módulo

Ver‐
sión
IKE

Fase 2
Duración SA

Dispositivo de se‐ IKEv1 Time: 60 ...
guridad configu‐
2879 minutos
rado como
SOFTNET Secu‐
rity Client V5
(Win7)

Encriptado

Autenticación

AES-128*: Advanced Encryp‐
tion Standard (Modo CBC)

SHA-1***: Secure
Hash Algorithm 1

3DES-168**: DES triple***
DES

Perfect Forward Se‐
crecy

ACTIVO: para vol‐
ver a calcular las
MD5***: Message Di‐ claves se intercam‐
bian nuevos valo‐
gest Algorithm 5
res Diffie Hellman
Public Key.
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.

MD741-1 V1.1,
M875 V2.0

IKEv1 Time: 60 ...
3DES-168**: DES triple***
16666666 minu‐
tos

SHA-1***: Secure
Hash Algorithm 1

ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
bian nuevos valo‐
res Diffie Hellman
Public Key.
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.

Dispositivo de se‐ IKEv1 Time: 10 ...
guridad configu‐
16666666 minu‐
rado como
tos
cliente VPN
Limit: 10 ...
Servidor VPN
4096 MB

AES-256, 192, 128*: Advanced SHA-512: Secure
Encryption Standard (modo
Hash Algorithm 512
CBC, CTR, CCM 16 o GCM 16) SHA-384: Secure
3DES-168**: DES triple***
Hash Algorithm 384
DES

SHA-256: Secure
Hash Algorithm 256

ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
bian nuevos valo‐
res Diffie Hellman
Public Key.

INACTIVO***: para
volver a calcular las
claves se utilizarán
MD5***: Message Di‐ los valores que ya
gest Algorithm 5
se intercambiaron
en la fase 1.
SHA-1***: Secure
Hash Algorithm 1

IKEv2 Time: 10 ...
AES-256, 192, 128*: Advanced SHA-512: Secure
16666666 minu‐ Encryption Standard (modo
Hash Algorithm 512
tos
CBC, CTR, CCM 16 o GCM 16) SHA-384: Secure
Limit: 10 ...
3DES-168**: DES triple***
Hash Algorithm 384
4096 MB
SHA-256: Secure
Hash Algorithm 256

ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
bian nuevos valo‐
res Diffie Hellman
Public Key.

INACTIVO***: para
volver a calcular las
claves se utilizarán
MD5***: Message Di‐ los valores que ya
gest Algorithm 5
se intercambiaron
en la fase 1.
SHA-1***: Secure
Hash Algorithm 1

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

449

Configuración de dispositivos y redes
1.3 Configurar redes
Módulo

Ver‐
sión
IKE

Fase 2
Duración SA

Encriptado

AES-128: Advanced Encryption
Dispositivo de se‐ IKEv1 Time: 10 ...
guridad configu‐
16666666 minu‐ Standard (Modo CBC)
tos
rado como
3DES-168**: DES triple***
Limit: 10 ...
cliente NCP VPN
DES
4096 MB

Autenticación

Perfect Forward Se‐
crecy

SHA-512: Secure
Hash Algorithm 512

ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
bian nuevos valo‐
res Diffie Hellman
Public Key.

SHA-384: Secure
Hash Algorithm 384
SHA-256: Secure
Hash Algorithm 256

INACTIVO***: para
MD5***: Message Di‐
volver a calcular las
gest Algorithm 5
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.
SCALANCE
SC-600
SCALANCE
S615

IKEv1 Time: 10 ...
AES-256, 192, 128*: Advanced SHA-512: Secure
16666666 minu‐ Encryption Standard (modo
Hash Algorithm 512
tos
CBC, CTR, CCM 16 o GCM 16) SHA-384: Secure
Limit: 10 ...
3DES-168**: DES triple***
Hash Algorithm 384
4096 MB
SHA-256: Secure
Hash Algorithm 256
SHA-1***: Secure
Hash Algorithm 1

IKEv2 Time: 10 ...
AES-256, 192, 128*: Advanced SHA-512: Secure
16666666 minu‐ Encryption Standard (modo
Hash Algorithm 512
tos
CBC, CTR, CCM 16 o GCM 16) SHA-384: Secure
Limit: 10 ...
3DES-168**: DES triple***
Hash Algorithm 384
4096 MB
SHA-256: Secure
Hash Algorithm 256
SHA-1***: Secure
Hash Algorithm 1

ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
bian nuevos valo‐
res Diffie Hellman
Public Key.
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.
ACTIVO: para vol‐
ver a calcular las
claves se intercam‐
bian nuevos valo‐
res Diffie Hellman
Public Key.
INACTIVO***: para
volver a calcular las
claves se utilizarán
los valores que ya
se intercambiaron
en la fase 1.

* Longitud de código 256 bits, 192 bits o 128 bits
** Longitud de código 168 bits
*** El ajuste está clasificado como menos seguro. Se recomienda utilizar un ajuste más seguro dentro de las posibilidades.

450

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configurar perfiles VPN fallback
Además de las propiedades de un grupo VPN, a un grupo VPN se le pueden asignar perfiles
VPN fallback. Los perfiles VPN incluyen propiedades predefinidas para el método de
autenticación, IKE fases 1 y 2. Los perfiles VPN fallback pueden utilizarse como
configuraciones alternativas para el establecimiento de conexiones VPN. Estos actúan cuando
las propiedades VPN del iniciador no concuerdan con las propiedades VPN del respondedor.
En tales casos los perfiles VPN fallback garantizan el establecimiento de la conexión VPN. Al
igual que las propiedades del grupo VPN, los perfiles VPN fallback configurados se transfieren
a todas las estaciones del grupo VPN. La prioridad para el uso de los perfiles VPN fallback se
determina a través de su orden en la configuración. Los perfiles VPN fallback y las propiedades
del grupo VPN no pueden diferenciarse en el método de autenticación.
Hay disponibles los siguientes perfiles VPN fallback:
Tabla 1-44

Perfil VPN 1

Parámetro

Ajuste

Método de autenticación

Certificado

Modo IKE

Main

Fase 1 del grupo DH

Grupo 14

Fase 1 de la encriptación

AES-256

Fase 1 de la duración SA

Duración SA propuesta por el iniciador: 480 minu‐
tos
Rango de duración SA permitido por el responde‐
dor: 480 … 2880 minutos

Fase 1 de la autenticación

SHA-1

Fase 2 del tipo de duración SA

Time

Fase 2 de la encriptación

AES-128

Fase 2 de la duración SA

Duración SA propuesta por el iniciador: 240 minu‐
tos
Rango de duración SA permitido por el responde‐
dor: 60 ... 2880 minutos

Fase 2 de la autenticación

SHA-1

Perfect Forward Secrecy

OFF

Tabla 1-45

Perfil VPN 2

Parámetro

Ajuste

Método de autenticación

Certificado

Modo IKE

Main

Fase 1 del grupo DH

Grupo 2

Fase 1 de la encriptación

AES-256

Fase 1 de la duración SA

Duración SA propuesta por el iniciador: 480 minu‐
tos
Rango de duración SA permitido por el responde‐
dor: 480 … 2880 minutos

Fase 1 de la autenticación

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

SHA-1

451

Configuración de dispositivos y redes
1.3 Configurar redes
Parámetro

Ajuste

Fase 2 del tipo de duración SA

Time

Fase 2 de la encriptación

3DES-168

Fase 2 de la duración SA

Duración SA propuesta por el iniciador: 2880 mi‐
nutos
Rango de duración SA permitido por el responde‐
dor: 60 ... 2880 minutos

Fase 2 de la autenticación

SHA-1

Perfect Forward Secrecy

OFF

Tabla 1-46

Perfil VPN 3

Parámetro

Ajuste

Método de autenticación

Certificado

Modo IKE

Main

Fase 1 del grupo DH

Grupo 2

Fase 1 de la encriptación

3DES-168

Fase 1 de la duración SA

Duración SA propuesta por el iniciador: 480 minu‐
tos
Rango de duración SA permitido por el responde‐
dor: 480 … 2880 minutos

Fase 1 de la autenticación

SHA-1

Fase 2 del tipo de duración SA

Time

Fase 2 de la encriptación

3DES-168

Fase 2 de la duración SA

Duración SA propuesta por el iniciador: 2880 mi‐
nutos
Rango de duración SA permitido por el responde‐
dor: 60 ... 2880 minutos

Fase 2 de la autenticación

SHA-1

Perfect Forward Secrecy

OFF

Tabla 1-47

Perfil VPN 4

Parámetro

Ajuste

Método de autenticación

Certificado

Modo IKE

Main

Fase 1 del grupo DH

Grupo 2

Fase 1 de la encriptación

DES

Fase 1 de la duración SA

Duración SA propuesta por el iniciador: 480 minu‐
tos
Rango de duración SA permitido por el responde‐
dor: 480 … 2880 minutos

452

Fase 1 de la autenticación

MD5

Fase 2 del tipo de duración SA

Time

Fase 2 de la encriptación

3DES-168

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Parámetro

Ajuste

Fase 2 de la duración SA

Duración SA propuesta por el iniciador: 2880 mi‐
nutos
Rango de duración SA permitido por el responde‐
dor: 60 ... 2880 minutos

Fase 2 de la autenticación

SHA-1

Perfect Forward Secrecy

OFF

Tabla 1-48

Perfil VPN 5

Parámetro

Ajuste

Método de autenticación

Preshared Key

Modo IKE

Main

Fase 1 del grupo DH

Grupo 2

Fase 1 de la encriptación

3DES-168

Fase 1 de la duración SA

Duración SA propuesta por el iniciador: 480 minu‐
tos
Rango de duración SA permitido por el responde‐
dor: 480 … 2880 minutos

Fase 1 de la autenticación

SHA-1

Fase 2 del tipo de duración SA

Time

Fase 2 de la encriptación

3DES-168

Fase 2 de la duración SA

Duración SA propuesta por el iniciador: 2880 mi‐
nutos
Rango de duración SA permitido por el responde‐
dor: 60 ... 2880 minutos

Fase 2 de la autenticación

SHA-1

Perfect Forward Secrecy

OFF

Después de abrir un proyecto STEP 7 que se guardó por última vez con una versión anterior
a V14 SP1, todos los grupos VPN existentes con el método de certificación "Certificado" tienen
asignados por defecto los perfiles VPN fallback predefinidos 2 a 5.

Particularidades para el SOFTNET Security Client y SCALANCE M
Los perfiles VPN fallback configurados no influyen en los archivos de configuración para los
módulos Roadwarrior SOFTNET Security Client y SCALANCE M. Para módulos SOFTNET
Security Client y SCALANCE M rige:
● El perfil VPN utilizado para conexiones VPN de módulos SOFTNET Security Client /
SCALANCE M con SCALANCE S / CP se selecciona en la configuración del respondedor,
véase el capítulo Configurar ajustes VPN específicos del módulo y la conexión
(Página 458).
● Para conexiones VPN de módulos SCALANCE M con módulos SCALANCE M se utilizan
los ajustes de grupos VPN configurados.
● Para conexiones VPN de módulos SOFTNET Security Client con módulos SCALANCE M
se utilizan siempre los ajustes del perfil VPN 3.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

453

Configuración de dispositivos y redes
1.3 Configurar redes

Modos de operación de grupos VPN
Modos de operación VPN
Según el modo de operación en el que se encuentren los módulos de seguridad que se han
agregado a un grupo VPN, se distingue entre diferentes modos de operación de grupos VPN.
El modo de operación de un grupo VPN informa sobre qué módulos de seguridad pueden
agregarse al grupo VPN y en qué modos de operación.

Reglas para la formación de grupos
Observe las reglas siguientes si desea formar grupos VPN:
● Para SCALANCE S612 / S613 / S623 / S627-2M / SCALANCE M / dispositivo VPN
El primer módulo asignado a un grupo VPN decide qué otros módulos se pueden agregar.
Si el primer módulo SCALANCE S agregado está en modo Routing o si el primer módulo es
un módulo SCALANCE M o un dispositivo VPN, solo se podrán agregar módulos
SCALANCE S con modo Routing activado o bien módulos SCALANCE M o dispositivos
VPN, pues los módulos SCALANCE M y los dispositivos VPN se utilizan siempre en modo
Routing. Si el primer módulo SCALANCE S agregado está en modo Bridge, solo se podrán
agregar módulos SCALANCE S en modo Bridge. Si se debe modificar el modo de un grupo
VPN, hay que quitar todos los módulos contenidos en el grupo y volver a agregarlos. Un CP
y un SSC puede agregarse a un grupo con un SCALANCE S en el modo Bridge o de
enrutamiento.
● Para CP / SSC
Si el primer módulo de un grupo VPN es un CP / SSC, es posible agregar módulos de
seguridad en los modos que se desee. El siguiente módulo que determina el modo de
operación especifica también el modo de operación del grupo VPN. Un CP / SSC puede
asignarse simultáneamente a varios grupos VPN con diferentes modos de operación. En
tal caso el CP /SSC funcionará en modo combinado.
● No es posible agregar un módulo SCALANCE M a un grupo VPN que contenga un módulo
en el modo Bridge.
Vea en la tabla siguiente qué módulos se pueden reunir en un grupo VPN:
Tabla 1-49

Módulos de seguridad y modos de operación VPN
Módulo

454

Se puede incluir en un grupo VPN en...
Modo Bridge

Modo de enrutamiento

SCALANCE S612 / S613 / S623 / S627-2M en
modo Bridge

x

-*

SCALANCE S612 / S613 / S623 / S627-2M en
modo de enrutamiento

-

x

CP 343-1 Adv. / CP 443-1 Adv.

x

x

CP S7-1200/S7-1500

x

x

CP 1628

x

x

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Módulo

Se puede incluir en un grupo VPN en...
Modo Bridge

Modo de enrutamiento

SOFTNET Security Client V4.0

x

x

SCALANCE M875 / dispositivo VPN

-

x

* Los módulos SCALANCE S623/S627-2M en modo Bridge pueden insertarse en un grupo VPN en modo
de enrutamiento cuando su interfaz DMZ está activada (no simultáneamente).

Incluir un módulo de seguridad en un grupo VPN configurado
Las propiedades de grupo VPN configuradas se adoptan para los módulos de seguridad
nuevos que se incluyen en un grupo VPN existente.

Procedimiento a seguir tras incluir un módulo de seguridad en un grupo VPN configurado
Dependiendo de si las propiedades de grupo VPN han cambiado o no desde el último proceso
de carga, se tiene que proceder de forma distinta:
● Caso a: Si no ha cambiado las propiedades del grupo VPN y el módulo que se agrega
establece activamente la conexión con módulos del tipo SCALANCE S, CP 343-1 Adv. / CP
443-1 Adv o CP 1628:
1. Agregue el módulo de seguridad nuevo al grupo VPN.
2. Cargue la configuración en el módulo nuevo.
● Caso b: Si ha cambiado las propiedades del grupo VPN o si el módulo que se agrega no
establece activamente la conexión con los módulos previamente configurados:
1. Agregue el módulo de seguridad nuevo al grupo VPN.
2. Cargue la configuración en todos los módulos pertenecientes al grupo VPN.
En el caso a no es necesario configurar de nuevo ni cargar los módulos de seguridad ya
existentes y que ya se han puesto en servicio. La comunicación en curso no se ve afectada ni
interrumpida.

Procedimiento a seguir tras quitar un dispositivo activo de un grupo VPN
Si retira una estación activa de un grupo VPN existente, la estación podrá establecer una
conexión con las estaciones del grupo aunque haya vuelto a cargar el proyecto en todas ellas.
Si no desea que la estación activa retirada establezca conexión, renueve el certificado de
grupo CA y vuelva a cargar el proyecto en las estaciones del grupo VPN. El certificado puede
renovarse en las propiedades del grupo VPN o en el administrador de certificados, en la ficha
"CA".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

455

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración de nodos de red accesibles a través de túnel
Sinopsis
Configuración de nodos de red accesibles a través de túnel
Para poder determinar la autenticidad de un telegrama, cada módulo de seguridad debe
conocer los nodos de red accesibles a través de túnel VPN.
El módulo de seguridad debe conocer tanto su propio nodo como los nodos de los módulos de
seguridad con los que comparte el grupo VPN. En un módulo de seguridad, esta información
se utiliza para determinar qué paquete de datos se debe transmitir por qué túnel.
Al agregar un módulo de seguridad a un grupo VPN se notifican automáticamente al módulo
de seguridad los nodos de red/las subredes locales e internos del módulo de seguridad. Para
permitir la comunicación por el túnel VPN con otras subredes u otros dispositivos de otra
subred (red interna enrutada; red DMZ cuando el túnel está en una interfaz externa y
viceversa), es necesario habilitar a través de la configuración dichas subredes o dichos
dispositivos para la comunicación por túnel VPN.
Los módulos SCALANCE S permiten aprender los nodos de la red automáticamente o
configurarlos estáticamente. Las posibilidades que están disponibles para el aprendizaje de
nodos de red internos dependen también del modo de operación del módulo de seguridad.

SCALANCE S en modo Bridge
En el modo Bridge es posible configurar tanto los nodos IP/MAC como las subredes o, como
alternativa, permitir el aprendizaje automático de nodos por parte del SCALANCE S.

SCALANCE S en modo de enrutamiento
En el modo de enrutamiento no hay ningún modo de aprendizaje automático disponible. En su
lugar, aquí se introducen subredes completas que deben habilitarse para la comunicación
tunelada.

CP 343-1 Advanced / CP 443-1 Advanced y CP 1628
● CP 343-1 Advanced / CP 443-1 Advanced
Seleccione si la comunicación tunelada con el CP (interfaz Gigabit) y/o con la subred
interna (subred PROFINET) está permitida para interlocutores VPN en modo de
enrutamiento (SCALANCE S / M).
● CP 1628
Introduzca los nodos NDIS que deben ser accesibles por el túnel de interlocutores VPN en
modo de enrutamiento (SCALANCE S / M).

CP 1543-1 a partir de V2.1 con routing IP activado entre módulos de comunicación
Introduzca las subredes o direcciones IP accesibles a través del bus de fondo de la estación
y que deben habilitarse para la comunicación por túnel.

456

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Aprendizaje automático de nodos de red internos
Función específica del módulo
Los módulos SCALANCE S en modo Bridge ofrecen un modo de aprendizaje que permite el
aprendizaje automático de nodos de red internos durante el funcionamiento. Encontrará más
información al respecto en el apartado:
Utilizar el modo de aprendizaje para aprender nodos internos (Página 517)

Configurar manualmente nodos de red IP para SCALANCE S
Función específica del módulo
Para configurar nodos de red IP para módulos SCALANCE S, consulte el apartado:
Configurar manualmente nodos de red IP (Página 519)

Configurar manualmente nodos de red MAC para SCALANCE S
Función específica del módulo
Para configurar nodos de red MAC para módulos SCALANCE S, consulte el apartado:
Configurar manualmente nodos de red MAC (Página 519)

Configurar manualmente subredes internas para SCALANCE S
Función específica del módulo
Para configurar subredes internas para módulos SCALANCE S, consulte el apartado:
Configurar manualmente subredes internas (Página 520)

Permitir el acceso a CPs S7-300/S7-400 para interlocutores VPN
Función específica del módulo
Para permitir el acceso a CPs S7-300/S7-400 para interlocutores VPN, consulte el apartado:
Permitir el acceso a CPs S7-300/S7-400 para interlocutores VPN (Página 545) en el capítulo
"Seguridad para CPs S7-300/S7-400/PC".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

457

Configuración de dispositivos y redes
1.3 Configurar redes

Configurar nodos NDIS accesibles por túnel para CPs PC
Función específica del módulo
Para configurar nodos NDIS accesibles por túnel en CPs PC, consulte el apartado:
Configurar manualmente nodos NDIS accesibles por túnel en CPs PC (Página 545) en el
capítulo "Seguridad para CPs S7-300/S7-400/PC".

Configuración de subredes para CP 1543-1 accesibles a través de bus de fondo
Función específica del módulo
Para saber cómo configurar subredes y nodos de red para CP 1543-1 a partir de V2.1
accesibles a través del bus de fondo de la estación consulte el apartado:
Configuración de subredes S7 para CP 154x-1 accesibles a través del bus de fondo
(Página 557).

Configurar ajustes VPN específicos del módulo y la conexión
Requisitos
El módulo forma parte de un grupo VPN.

Ajustes específicos del módulo y la conexión
Los ajustes específicos del módulo y la conexión permiten configurar ajustes VPN concretos.
Los ajustes específicos del módulo se configuran especialmente para un módulo de seguridad,
mientras que los ajustes específicos de la conexión se configuran especialmente para un
módulo de seguridad dentro de un grupo VPN concreto.
En la entrada "VPN" de los ajustes de seguridad locales pueden configurarse las siguientes
propiedades específicas del módulo:
● Dead-Peer-Detection
● Permiso para iniciar el establecimiento de la conexión
● Dirección pública (dirección IP / FQDN) para la comunicación a través de pasarelas de
Internet
● Ajustes del respondedor para conexiones de Road Warrior
● Nodos que deben habilitarse para la comunicación tunelada
Si en la lista de grupos VPN se selecciona un módulo de seguridad dentro del área "Datos de
red", es posible ver y configurar los siguientes ajustes VPN específicos de la conexión:
● Permiso para iniciar el establecimiento de la conexión
● Módulos interlocutores con los que existen conexiones tuneladas
● Tipo de paquetes transmitidos

458

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Selección de la interfaz local del módulo de seguridad seleccionado que debe actuar de
punto final del túnel
● Selección de la interfaz del interlocutor que debe actuar de punto final del túnel

Dead-Peer-Detection (DPD)
Como estándar está activado DPD.
Estando activado DPD, los módulos intercambian mensajes adicionales a intervalos de tiempo
ajustables, siempre que en el instante en cuestión no se produzca ninguna comunicación. Eso
permite detectar si la conexión IPsec todavía es válida o si es necesario volver a establecerla.
Si ya no hay conexión, se finalizan prematuramente las "Security Associations" (SA) de fase
2. Con DPD desactivado, la SA no finaliza hasta haber concluido su vida útil. Para ajustar la
vida útil de la SA consulte el apartado:
Configuración de propiedades de grupo VPN (Página 443).

Permiso para iniciar el establecimiento de la conexión
Se puede limitar el permiso para iniciar el establecimiento de la conexión de VPN a
determinados módulos de la VPN.
El factor decisivo para el ajuste del parámetro aquí descrito es la asignación de la dirección
para la pasarela del módulo que debe configurarse. En el caso de una dirección IP asignada
estáticamente, el módulo puede ser encontrado por el interlocutor. En el caso de una dirección

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

459

Configuración de dispositivos y redes
1.3 Configurar redes
IP asignada dinámicamente, y por lo tanto constantemente cambiante, el interlocutor no puede
establecer sin más una conexión.
Modo

Significado

Iniciar conexión con interlocutor (inicia‐
dor/respondedor) (predeterminado)

Con esta opción, el módulo está "activo", es decir, intenta
establecer una conexión con el interlocutor con una direc‐
ción IP fija. También es posible aceptar peticiones para
establecer una conexión VPN.
Esta opción se recomienda si el proveedor ha asignado una
dirección IP dinámica para la gateway del módulo de segu‐
ridad configurado.
El direccionamiento del interlocutor tiene lugar a través de
su dirección IP WAN configurada, de su dirección IP de
módulo externa configurada o del FQDN configurado.

Esperar a interlocutor (respondedor)

Con esta opción, el módulo está "pasivo", es decir, espera
a que el interlocutor inicie el establecimiento de la conexión.
Esta opción se recomienda si el proveedor ha asignado una
dirección IP estática para la gateway del módulo de segu‐
ridad configurado. Con esto se consigue que solo el inter‐
locutor intente establecer la conexión. Dicho interlocutor
puede tener una dirección IP WAN dinámica, por ejemplo.

Nota
No ponga todos los módulos de un grupo VPN a "Esperando al interlocutor", pues de hacerlo
no se establece ninguna conexión.

Dirección IP WAN / direcciones FQDN de los módulos y pasarelas en una VPN vía Internet
Para el funcionamiento de una VPN con túneles IPsec a través de Internet se necesitan, por
regla general, direcciones IP adicionales para las gateways de Internet, como por ejemplo
routers DSL. Los distintos módulos de seguridad o SCALANCE M tienen que conocer las
direcciones IP externas de los módulos interlocutores de la VPN.
Nota
Para el uso de una WAN como red externa pública indique como dirección IP externa la
dirección IP proporcionada por el proveedor, a través de la cual el módulo de seguridad estará
accesible en la WAN (Internet). Para que el módulo de seguridad pueda enviar paquetes a
través de la WAN hay que introducir el router DSL como "Router estándar".
Si utiliza un router DSL como pasarela de Internet, habilite en él al menos los puertos
siguientes de acuerdo con las indicaciones de la documentación correspondiente:
● Port 500 (ISAKMP)
● Port 4500 (NAT-T)
Para ello se puede asignar una dirección IP como "dirección IP WAN" en los ajustes VPN del
módulo. Al cargar la configuración del módulo, se comunica a los dispositivos del grupo las
direcciones IP WAN de los módulos interlocutores. Como alternativa a una dirección IP WAN

460

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
también puede introducir un FQDN. Según las direcciones que haya, se utilizan puntos finales
VPN de forma estándar en función de las prioridades siguientes:
1. dirección WAN
2. FQDN del servicio DNS din. primario
3. FQDN del servicio DNS din. secundario
4. dirección IP externa / dirección IP DMZ del módulo de seguridad
Observación: después de eliminar una dirección WAN existente siempre se utiliza la dirección
IP externa / dirección IP DMZ.
En la selección de interfaz de los ajustes VPN de la conexión existe la posibilidad de determinar
la dirección que debe notificarse al interlocutor. Aquí también puede ajustar la interfaz a través
de la que se comunicarán los dispositivos de un grupo VPN y cuál es el módulo de seguridad
que tiene permitido establecer la conexión.






6HFXULW\0RGXO

6HFXULW\0RGXO

:$1
WAN



,QWHUQHW*DWHZD\



,QWHUQHW*DWHZD\








/$1

/$1
*356,QWHUQHW*DWHZD\




6&$/$1&(0



/$1

①
②
③
④

Dirección IP interna - de un módulo
Dirección IP externa - de un módulo
Dirección IP de una pasarela de Internet (p. ej. pasarela GPRS)
Dirección IP (dirección IP WAN) de una pasarela de Internet (p. ej. router DSL)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

461

Configuración de dispositivos y redes
1.3 Configurar redes

Ajustes del respondedor para conexiones de Road Warrior
De modo predeterminado, el respondedor permite el establecimiento de conexiones VPN
mediante Unknown Peers (Road Warriors) con las propiedades VPN seguras del perfil VPN 1.
El establecimiento de la conexión VPN mediante Unknown Peers y las propiedades utilizadas
para ello se permiten o bloquean seleccionado un perfil de grupo VPN y perfiles VPN.
Elemento de control

Significado

Permitir el establecimiento de conexio‐
nes VPN mediante Road Warriors

Básicamente el respondedor permite el establecimiento de conexiones VPN me‐
diante Unknown Peers.

Perfiles VPN 1 - 5 en el cuadro de diálo‐ El respondedor permite el establecimiento de conexiones VPN mediante Unk‐
go de selección de perfiles VPN
nown Peers con las propiedades de los perfiles VPN 1 - 5 predefinidos. Las pro‐
piedades de estos perfiles VPN se corresponden con las propiedades de los per‐
files VPN fallback que se han podido seleccionar para los grupos VPN, consulte el
capítulo Configuración de propiedades de grupo VPN (Página 443).
Perfiles de grupo VPN en el cuadro de
diálogo de selección de perfiles VPN

El respondedor permite el establecimiento de conexiones VPN mediante Unk‐
nown Peers con las propiedades del grupo VPN seleccionado en el cuadro de
diálogo para la selección de perfiles VPN mediante el símbolo de verificación. Es
posible seleccionar los grupos VPN en los que está el respondedor. Como máximo
puede seleccionarse un grupo VPN y utilizarse como perfil de grupo VPN. El botón
"Agregar" permite crear grupos VPN nuevos, a los que se asigna el respondedor
automáticamente. Estos grupos VPN podrán seleccionarse después para la for‐
mación de un perfil de grupo VPN.
Si debe permitirse el establecimiento de conexiones VPN mediante Unknown
Peers con las propiedades del grupo VPN en el que se encuentran el respondedor
y el Unknown Peers, es necesario eliminar del cuadro de diálogo de selección ese
grupo VPN.

Después de abrir un proyecto STEP 7 que se guardó por última vez con una versión anterior
a V14 SP1, por defecto estará activada la casilla de verificación "Permitir establecimiento de
llamada VPN a través de Road Warriors". Además el respondedor tiene asignados los perfiles
VPN predeterminados 2 a 5.
Para conexiones VPN de módulos SOFTNET Security Client / SCALANCE M-800 con
SCALANCE S / CP se utiliza y se deriva siempre el perfil VPN seleccionado con la máxima
prioridad. El método de autenticación del perfil VPN seleccionado debe coincidir con el método
de autenticación del grupo VPN correspondiente. La prioridad de los perfiles VPN es la
siguiente:
1.º Perfil de grupo VPN seleccionado
2.º Perfil VPN 1
3.º Perfil VPN 2
4.º Perfil VPN 3
5.º Perfil VPN 4
6.º Perfil VPN 5
Para conexiones VPN de módulos SCALANCE M875 con SCALANCE S / CP es necesario
seleccionar el perfil VPN 3 si el método de autenticación del grupo VPN correspondiente es
"certificado". Si el método de autenticación del grupo VPN correspondiente es "Preshared
Key", es necesario seleccionar el perfil VPN 5.

Configurar nodos de red internos
La configuración de nodos de red internos se describe en el capítulo siguiente:
AUTOHOTSPOT

462

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Consulte también
Cómo crear túneles IPsec mediante grupos VPN (Página 437)

Establecer un túnel OpenVPN con el SINEMA Remote Connect Server
Función específica del módulo
Esta función solo está disponible para los siguientes módulos:
● CP 1243-1 a partir de V3.1
● CP 1243-8 IRC a partir de V3.1
● CP 1243-7 LTE a partir de V3.1
● CP 1542SP-1 IRC a partir de V2
● CP 1543SP-1 a partir de V2
Encontrará información detallada en el apartado Configuración OpenVPN automática y
establecimiento de túnel Open-VPN (Página 558) del capítulo "Seguridad para CP S7-1200-/
S7-1500".

Configuración de la redundancia de router y cortafuegos
Función específica del módulo
Esta función solo está disponible para SCALANCE S623/S627-2M V4 o superior, consulte el
apartado:
AUTOHOTSPOT

Funciones online - Diagnóstico y registro
Vista general del diagnóstico y registro
El módulo de seguridad se ha dotado de funciones de diagnóstico y registro con fines de
comprobación y supervisión.
● Funciones de diagnóstico
Con este término se conocen las funciones de sistema y de estado que pueden aplicarse
al módulo de seguridad en caso de existir una conexión de red.
● Funciones de registro
Se trata del registro de eventos del sistema y seguridad, así como de paquetes de datos.

Registrar eventos con funciones logging
Con los ajustes de registro del módulo de seguridad en cuestión se especifica qué eventos
deben registrarse.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

463

Configuración de dispositivos y redes
1.3 Configurar redes
Para el registro pueden configurarse las siguientes variantes:
● Registro local
Con esta variante se registran los eventos en el búfer local del módulo de seguridad. En el
cuadro de diálogo "Online & Diagnóstico" es posible acceder a dichos registros,
visualizarlos y archivarlos en la Service Station. Para la evaluación de las áreas de memoria
temporal del módulo de seguridad se requiere una conexión de red con el módulo de
seguridad seleccionado.
● Registro del sistema en red
Para el registro del sistema en red se utiliza un servidor Syslog existente en la red. Este
registra los eventos en función de la configuración de los ajustes de registro del módulo de
seguridad en cuestión.

Archivar datos de registro y leerlos de un archivo
Los eventos registrados pueden guardarse en un archivo de registro con fines de archivación
y abrirse después sin que haya una conexión de red con el módulo de seguridad. La función
para abrir los archivos Log se encuentra en las funciones de seguridad globales.

Diagnóstico en modo Ghost (solo para SCALANCE S602 V3.1 o superior)
Cuando el módulo de seguridad funciona en modo Ghost, la interfaz externa del módulo de
seguridad adopta la dirección IP del dispositivo interno en el tiempo de ejecución. Antes de
ejecutar el diagnóstico de un módulo de seguridad en modo Ghost, se debe establecer la
conexión con el módulo de seguridad a través de la dirección IP que el módulo de seguridad
haya tomado del dispositivo interno en el tiempo de ejecución.
Para averiguar qué dirección IP tiene actualmente el módulo de seguridad, en STEP 7 existe
la posibilidad de buscar dispositivos accesibles por medio del comando de menú "Online" >
"Dispositivos accesibles".

Proteger archivos de registro exportados de accesos no autorizados
Los archivos de registro exportados de STEP 7 pueden contener información relevante para
la seguridad. Por este motivo hay que asegurarse de que dichos archivos están protegidos de
accesos no autorizados. Esto es especialmente importante cuando se transfieren archivos.

Vista general de las funciones del cuadro de diálogo Online
Funciones del cuadro de diálogo "Online y diagnóstico"
El módulo de seguridad ofrece las siguientes funciones en el cuadro de diálogo "Online y
diagnóstico" de STEP 7:
Entrada en el cuadro de diálogo online

Función

Status

Visualización de la información de estado del módulo de seguridad seleccio‐
nado, como las direcciones IP actuales de las interfaces o la hora y fecha
actuales.

Ajustes de interfaz

Vista general de los ajustes de las diferentes interfaces.

464

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Entrada en el cuadro de diálogo online

Función

DNS dinámico

Vista general de los ajustes para DNS dinámico.

Registros del sistema

Visualización de eventos del sistema registrados, inicio y parada del registro
(solo si existe una conexión online con módulos SCALANCE S) así como inicio
y parada de la lectura de los datos de registro del búfer local del módulo de
seguridad.

Registros de auditoría

Visualización de eventos de seguridad registrados, inicio y parada de la lectura
de los datos de registro del búfer local del módulo de seguridad.

Registros de filtrado de paquetes

Visualización de paquetes de datos registrados, inicio y parada del registro
(solo si existe una conexión online con módulos SCALANCE S) así como inicio
y parada de la lectura de los datos de registro del búfer local del módulo de
seguridad.

Tabla ARP

Visualización de la tabla ARP del módulo de seguridad.

Usuario conectado

Visualización de los usuarios que han iniciado sesión en la página de Internet
para conjuntos de reglas IP personalizados.

Estado de la comunicación

Visualización de la información de estado de las conexiones VPN tuneladas así
como de los dispositivos de grupos VPN a los que pertenece el módulo de
seguridad seleccionado.

SINEMA RC - Configuración VPN automá‐
tica

Indicación del estado de la configuración OpenVPN y de conexiones OpenVPN
con el servidor SINEMA RC.

Nodos internos

Visualización de los nodos de red internos (aprendidos o configurados) del
módulo de seguridad.

Reglas de cortafuegos actualizadas diná‐
micamente

Visualización de las direcciones IP habilitadas dinámicamente vía HTTP o
HTTPS o cargadas posteriormente por un usuario.

Lista negra de cortafuegos

Visualización de las direcciones IP introducidas en la lista negra del cortafue‐
gos.

Modo Ghost

Cuadro de diálogo del modo Ghost del SCALANCE S602 con información so‐
bre los parámetros de dirección del dispositivo interno (idénticos a la dirección
IP externa del módulo de seguridad) y sobre cambios de dirección IP en el
dispositivo interno.

Fecha y hora

Ajuste de la fecha y la hora.

Actualización de firmware

Actualización del firmware.

Condiciones para el acceso
Para poder utilizar las funciones online de un módulo de seguridad, deben cumplirse los
siguientes requisitos:
● existe una conexión de red con el módulo seleccionado
● está abierto el proyecto con el que se ha configurado el módulo
● un usuario ha iniciado sesión en el proyecto con los derechos necesarios
● Para CPs debe estar habilitado el acceso al diagnóstico en el cortafuegos (CP 343-1 Adv. /
443-1 Adv. y CP 1628: TCP 443; CP S7-1200/S7-1500: TCP 8448)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

465

Configuración de dispositivos y redes
1.3 Configurar redes

Nota
Requisitos para el diagnóstico online en modo Ghost (solo para SCALANCE S602 V3.1 o
superior)
El diagnóstico online en modo Ghost no está disponible hasta que el módulo de seguridad ha
aprendido la dirección IP del dispositivo interno y lo ha aplicado a su interfaz externa.
Posteriormente, es posible acceder al módulo de seguridad mediante la dirección IP de la
interfaz externa.

Cómo se accede a esta función
1. Haga clic con el botón derecho del ratón en el módulo que desea editar.
2. En el menú contextual, elija el comando de menú "Online y diagnóstico".
3. Si todavía no se ha establecido ninguna conexión online con el módulo de seguridad, haga
clic en el botón "Establecer conexión online" de la entrada "Diagnóstico".

Ajustes online no se almacenan en la configuración
Los ajustes realizados en el modo online (p. ej. ajustes de la memoria de registro) no se
guardan en la configuración del módulo de seguridad. Por ello, al rearrancar un módulo
siempre se aplican los ajustes de la configuración.

Funciones del diagnóstico online
Información de estado del módulo de seguridad - entrada "Estado"
Significado
Visualización del estado del módulo de seguridad seleccionado en el proyecto.
Tabla 1-50

Online y diagnóstico: entrada "Estado"

Funciones de sistema y estado

Significado

Sinopsis
Tipo de hardware

El tipo del módulo de seguridad.

Dirección IP externa

La dirección IP externa del módulo de seguridad.
Para CP S7-1200/S7-1500, CP 1628: La direc‐
ción IP de la interfaz Industrial Ethernet.
Para CP 343-1 Adv. / 443-1 Adv.: la dirección IP
de la interfaz GBit.

466

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Funciones de sistema y estado

Significado

Dirección IP interna

La dirección IP interna del módulo de seguridad.
Para CP 1628: La dirección IP de la interfaz NDIS.
En caso de varias direcciones NDIS solo se mos‐
trará una.
Para CP 343-1 Adv. / 443-1 Adv.: la dirección IP
de la interfaz PROFINET.

Dirección IP DMZ (solo SCALANCE S623 /
S627-2M)

La dirección IP DMZ del módulo de seguridad.

Dirección IP de túnel (solo SCALANCE S612/S623/ La primera dirección IP de túnel alias del módulo
S627-2M V4 o superior)
de seguridad en el túnel VPN.
Número de serie

El número de serie del módulo de seguridad.

Referencia

La referencia del módulo de seguridad que se uti‐
liza al realizar un pedido.

Versión de firmware

La versión de firmware del módulo de seguridad.

Modo de operación

Modo de operación del módulo de seguridad (mo‐
do Bridge / modo de enrutamiento)

Dirección MAC externa

La dirección MAC externa del módulo de seguri‐
dad.
Para CP S7-1200/S7-1500, CP 1628: La direc‐
ción MAC de la interfaz Industrial Ethernet.
Para CP 343-1 Adv. / 443-1 Adv.: la dirección
MAC de la interfaz Gbit.

Dirección MAC interna

La dirección MAC interna del módulo de seguri‐
dad.
Para CP 1628: La dirección MAC de la interfaz
NDIS.
Para CP 343-1 Adv. / 443-1 Adv.: la dirección
MAC de la interfaz PROFINET.

Dirección MAC DMZ (solo SCALANCE S623 /
S627-2M)

La dirección MAC DMZ del módulo de seguridad.

Revisión de HW

El estado de producto de hardware del módulo de
seguridad.

C-PLUG

Indica si hay un C-PLUG enchufado o no.

Direcciones IP alias (solo para SCALANCE S V4 o superior)
Dirección IP

Dirección IP alias registrada por una regla NAT en
una interfaz del módulo de seguridad.

Interfaz correspondiente

Interfaz del módulo de seguridad en la que se re‐
gistró la dirección IP alias.

Hora local

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

467

Configuración de dispositivos y redes
1.3 Configurar redes
Funciones de sistema y estado
Hora actual

Significado
Fecha y hora indicadas en el módulo de seguridad.
Formato con idioma de interfaz "alemán":
dd.mm.yyyy (fecha) hh:mm:ss (hora)
Formato con idioma de interfaz "inglés":
mm/dd/yyyy (fecha) hh:mm:ss AM/PM (hora)
Formato con idioma de interfaz "francés", "italiano"
y "español":
dd/mm/yyyy (fecha) hh:mm:ss (hora)
Formato con idioma de interfaz "chino":
yyyy/mm/dd (fecha) hh:mm:ss
Nota (no para CPs)
Ajuste la hora local en el módulo SCALANCE S
mediante "Funciones" > "Fecha y hora".

Tiempo de funcionamiento

Tiempo que ha transcurrido desde el último rea‐
rranque completo del módulo de seguridad.
Formato con idioma de interfaz "alemán", "inglés",
"francés", "italiano", "español" y "chino":
dddd.hh:mm:ss

Hora fuente

La fuente que suministra la fecha y hora.

Configuración
Creado

Fecha y hora en las que fue creado el proyecto
por primera vez.
Formato con idioma de interfaz "alemán", "in‐
glés", "francés", "italiano", "español" y "chino":
dd.mm.yyyy (fecha) hh:mm:ss (hora)

Nombre

Nombre de archivo del proyecto cargado en últi‐
mo lugar.

Autor

Nombre del usuario que ha creado el proyecto. Se
adopta de las propiedades del proyecto.

Compilado

Fecha y hora en las que el proyecto fue compilado
por última vez.
Formato con idioma de interfaz "alemán", "in‐
glés", "francés", "italiano", "español" y "chino":
dd.mm.yyyy (fecha) hh:mm:ss (hora)

Ubicación

Indicación del lugar (p. ej. ciudad) que se ha in‐
troducido en las propiedades de un proyecto SCT.

Sistema de archivos (no para CPs)
RAM
Flash

Se indica la cantidad de memoria RAM y flash
ocupadas en el sistema de archivos.

Sinopsis de las diferentes interfaces - Entrada "Ajustes de interfaz"
Función específica del módulo
Esta función solo está disponible para SCALANCE S V3 o superior, consulte el apartado:
Sinopsis de las diferentes interfaces - Entrada "Ajustes de interfaz" (Página 525)

468

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Vista general de los ajustes de DNS dinámico: entrada "DNS dinámico"
Función específica del módulo
Esta función solo está disponible para SCALANCE S V3 o superior, consulte el apartado:
Vista general de los ajustes de DNS dinámico: entrada "DNS dinámico" (Página 526)

Visualización de la tabla ARP - Entrada "Tabla ARP"
Función específica del módulo
Esta función solo está disponible para SCALANCE S V3 o superior, consulte el apartado:
Visualización de la tabla ARP - Entrada "Tabla ARP" (Página 528)

Usuarios registrados en página web - Entrada "Usuarios dados de alta"
Función específica del módulo
Esta función solo está disponible para SCALANCE S V3 o superior, consulte el apartado:
Usuarios registrados en página web - Entrada "Usuarios dados de alta" (Página 528)

Conexiones VPN del módulo de seguridad - entrada "Estado de la comunicación"
Significado
Muestra el estado de comunicación de los componentes de red siguientes:
● Otros módulos de seguridad del grupo VPN al que pertenece el módulo de seguridad
seleccionado.
● Nodos de red internos de este módulo de seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

469

Configuración de dispositivos y redes
1.3 Configurar redes
Tabla 1-51

Online y diagnóstico: entrada "Estado de la comunicación"

Funciones de sistema y estado

Significado

Dispositivos o módulos de seguridad conocidos

Se muestran los dispositivos con los que comparte
grupo VPN el módulo de seguridad seleccionado.
También se muestra si el estado de túnel es activo
o no. Para obtener información adicional sobre un
dispositivo, selecciónelo en la lista.
Nota:
Los túneles configurados que no están activos se
muestran solo para CPs.

Puntos finales

Visualización de información sobre los nodos de
red internos del módulo de seguridad que se ha
seleccionado en la tabla "Dispositivos o módulos
de seguridad conocidos". Para cada nodo de red
interno se muestra si se ha aprendido o configu‐
rado. También se indica la subred en la que se
encuentra el nodo de red interno.
Con módulos SCALANCE S, la subred de los no‐
dos de red solo se muestra en el modo Bridge.

Propiedades del túnel

Visualización de las propiedades del túnel VPN
que se ha establecido con el módulo de seguridad
que se ha seleccionado en la tabla "Dispositivos o
módulos de seguridad conocidos".

Configuración OpenVPN automática a través de servidor SINEMA RC
Función específica del módulo
Esta función solo está disponible para los siguientes módulos:
● CP 1243-1 a partir de V3.1
● CP 1243-8 IRC a partir de V3.1
● CP 1243-7 LTE a partir de V3.1
● CP 1542SP-1 IRC a partir de V2
● CP 1543SP-1 a partir de V2
Encontrará información detallada en el apartado Diagnóstico de la configuración OpenVPN
automática y de las conexiones OpenVPN (Página 559).

Nodos de red internos encontrados - Entrada "Nodos internos"
Significado
Visualización de todos los nodos de red aprendidos y configurados. También se indica si el
modo de aprendizaje del módulo de seguridad está activado o desactivado.

470

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Reglas de cortafuegos actualizadas - Entrada "Reglas del cortafuegos actualizadas de forma dinámica"
Función específica del módulo
Esta función solo está disponible para el CP 343-1 Adv. / 443-1 Adv., consulte el apartado:
Reglas de cortafuegos actualizadas - Entrada "Reglas del cortafuegos actualizadas de forma
dinámica" (Página 546) en el capítulo "Seguridad para CP S7-300-/S7-400-/PC".

Visualización de la lista negra de cortafuegos - Entrada "Lista negra de cortafuegos"
Función específica del módulo
Esta función solo está disponible para SCALANCE S V4 o superior, consulte el apartado:
Visualización de la lista negra de cortafuegos - Entrada "Lista negra de cortafuegos"
(Página 529)

Ajustar la fecha y hora - Entrada "Fecha y hora"
Función específica del módulo
Esta función solo está disponible para SCALANCE S, consulte el apartado:
Ajustar la fecha y hora - Entrada "Fecha y hora" (Página 529).

Diagnóstico en modo Ghost: entrada "Modo Ghost"
Función específica del módulo
Esta función solo está disponible para SCALANCE S602 V3.1 o superior, consulte el apartado:
Diagnóstico en modo Ghost: entrada "Modo Ghost" (Página 529)

Funciones de registro
Registrar eventos del sistema - Entrada "Registros del sistema"
Significado
Visualización de eventos del sistema registrados así como inicio y parada de la lectura de los
eventos del sistema de la memoria local del módulo de seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

471

Configuración de dispositivos y redes
1.3 Configurar redes
El registro del sistema registra de forma automática y continua eventos del sistema como p. ej.
el inicio de un proceso. El registro se puede escalar basándose en clases de eventos.
Funciones de sistema y estado

Significado

Iniciando/Deteniendo registro (no para CPs)

Inicia o detiene el registro de eventos del sistema.
Tanto el método como las clases de eventos que
se registran se configuran en los ajustes de segu‐
ridad locales.

Iniciando/Deteniendo lectura

Inicia o detiene la lectura de eventos del sistema
desde la memoria local del módulo de seguridad.
Si se activa la casilla de verificación "Guardar ar‐
chivo de registro" se guardarán los datos de regis‐
tro registrados también como archivo. Seleccione
la ubicación e indique un nombre para el archivo.
Nota
Si se ha activado la casilla de verificación "Guar‐
dar archivo de registro" después de iniciar el pro‐
ceso de lectura, no se podrán guardar los datos
leídos hasta el momento en un archivo de registro.

Borrar visualización

Borra los datos de registro mostrados en la tabla.

Los archivos de registro con eventos de sistema guardados se pueden abrir en las funciones
de seguridad globales en "Archivos de registro (vista offline)".

Registrar eventos de seguridad - Entrada "Registros de auditoría"
Significado
Visualización de eventos de seguridad registrados así como inicio y parada de la lectura de los
eventos de seguridad de la memoria local del módulo de seguridad.
El registro de auditoría registra de forma automática y continua eventos relevantes para la
seguridad. Entre ellos, p. ej. acciones del usuario como conexión o desconexión del registro de
paquetes.
Funciones de sistema y estado

Significado

Iniciando/Deteniendo lectura

Inicia o detiene la lectura de eventos de seguridad
desde la memoria local del módulo de seguridad.
Si se activa la casilla de verificación "Guardar ar‐
chivo de registro" se guardarán los datos de regis‐
tro registrados también como archivo. Seleccione
la ubicación e indique un nombre para el archivo.
Nota
Si se ha activado la casilla de verificación "Guar‐
dar archivo de registro" después de iniciar el pro‐
ceso de lectura, no se podrán guardar los datos
leídos hasta el momento en un archivo de registro.

Borrar visualización

Borra los datos de registro mostrados en la tabla.

Los archivos de registro con eventos de auditoría guardados se pueden abrir en las funciones
de seguridad globales en "Archivos de registro (vista offline)".

472

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Registrar paquetes de datos - Entrada "Registros de filtrado de paquetes"
Significado
Visualización de los paquetes de datos registrados, así como inicio y parada de los eventos de
filtrado de paquetes.
El registro de filtros de paquetes registra determinados paquetes del tráfico de datos. Solo se
registran paquetes de datos para los que sea válida una regla de filtrado de paquetes
(cortafuegos) configurada o frente a los que reacciona la protección básica (paquetes
corruptos o no válidos). Condición para ello es que esté activado el registro para la regla de
filtrado de paquetes.
Encontrará información para activar el registro en el capítulo:
AUTOHOTSPOT.
Los datos registrados, además de ser leídos en el búfer y transferidos para su visualización,
también pueden ser almacenados en un archivo.
Funciones de sistema y estado

Significado

Iniciando/Deteniendo registro (no para CPs)

Inicia o detiene el registro de paquetes de datos.
El método con el que se registran los datos se
configura en los ajustes de seguridad locales.

Iniciando/Deteniendo lectura

Inicia o detiene la lectura de paquetes de datos
registrados desde la memoria local del módulo de
seguridad. Si se activa la casilla de verificación
"Guardar archivo de registro" se guardarán los da‐
tos de registro registrados también como archivo.
Seleccione la ubicación e indique un nombre para
el archivo.
Nota
Si se ha activado la casilla de verificación "Guar‐
dar archivo de registro" después de iniciar el pro‐
ceso de lectura, no se podrán guardar los datos
leídos hasta el momento en un archivo de registro.

Borrar visualización

Borra los datos de registro mostrados en la tabla.

Categoría de registro

Seleccione los paquetes de datos cuyo registro
desea visualizar. La selección depende de los
ajustes de seguridad locales configurados offline.
Se registran solo los paquetes de datos para los
que se haya activado el registro. Si se selecciona
una categoría para la que no se ha activado el
registro, tampoco se muestran datos para dicha
categoría.

Los archivos de registro con eventos de filtrado de paquetes guardados se pueden abrir en las
funciones de seguridad globales en "Archivos de registro (vista offline)".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

473

Configuración de dispositivos y redes
1.3 Configurar redes

Funciones de carga
Particularidades al cargar configuraciones de seguridad
Las configuraciones de seguridad pueden influir en la accesibilidad del módulo de seguridad
desde el PC de configuración. Esto sucede, por ejemplo, cuando en una configuración de un
módulo de seguridad se ha configurado una conexión tunelada con otro módulo de seguridad
y dicha configuración se carga en el módulo de seguridad desde el PC de configuración.
Después de la carga desde el PC de configuración ya no es posible acceder al módulo de
seguridad y el test de seguridad que se lleva a cabo de forma estándar desde STEP 7 después
de cargar una configuración, falla. El mensaje de error que emite a continuación STEP 7 hace
referencia únicamente al test de accesibilidad; la carga de la configuración propiamente dicha
está garantizada siempre que los datos del proyecto sean coherentes y la relación de
direcciones IP entre el módulo de seguridad y el PC de configuración sea correcta.
Las particularidades al cargar configuraciones y firmware en módulos SCALANCE S están
descritas en el apartado siguiente:
AUTOHOTSPOT

Cargar configuraciones en la estación de ingeniería
No es posible cargar una configuración en una estación de ingeniería desde un módulo
SCALANCE S o desde el CP 1628.
La carga de una configuración en una estación de ingeniería desde un CP S7 compatible con
seguridad también es posible cuando se han configurado funciones de seguridad en la
configuración. Sin embargo, las funciones de seguridad no se transfieren a la estación de
ingeniería. Asimismo, la casilla de verificación "Activar funciones de seguridad" está
desactivada en la configuración transferida a la estación de ingeniería.

SOFTNET Security Client
Uso del SOFTNET Security Client
Campo de aplicación - acceso a través de VPN
El software para PC SOFTNET Security Client (SSC) permite acceder remotamente desde la
PG o el PC a autómatas programables protegidos por un módulo de seguridad, más allá de los
límites de redes públicas. Para CPs S7-300/S7-400 y para el CP PC CP 1628 se necesita
SOFTNET Security Client V4.0 HF1. Con SOFTNET Security Client ≤ V4.0, estos CPs no
están habilitados. Para otros CPs no está habilitado el SOFTNET Security Client.
Mediante el SOFTNET Security Client se configura automáticamente una PG o un PC de
manera que pueda establecer con uno o varios módulos de seguridad una comunicación por
túnel IPsec protegida en la VPN (Virtual Private Network).
Por medio de esta comunicación por túnel IPsec es posible acceder de forma segura, mediante
aplicaciones de PG/PC como Diagnóstico NCM, a dispositivos o redes que se encuentren en
una red interna protegida por el módulo de seguridad.

474

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

¿Cómo funciona el SOFTNET Security Client?
El SOFTNET Security Client lee la configuración creada por STEP 7 y determina, en su caso,
los certificados que deben importarse.
El certificado CA y las claves privadas se importan y se almacenan en la PG/el PC local, si
fuera el caso.
A continuación, con los datos de la configuración, se adoptan los ajustes de Security para que
las aplicaciones puedan acceder a direcciones IP que se encuentren detrás de los módulos de
seguridad.
Si está activado el modo de aprendizaje para los dispositivos internos o los autómatas
programables, se establece primero una directiva de seguridad para el acceso seguro a los
módulos de seguridad. El SOFTNET Security Client interroga a continuación a los módulos de
seguridad para determinar las direcciones IP de los respectivos dispositivos internos.
El SOFTNET Security Client registra esas direcciones IP en listas de filtrado especiales de esa
directiva de seguridad. Después de esto las aplicaciones se pueden comunicar con los
autómatas programables a través de VPN.
Nota
Medidas de seguridad adicionales al utilizar el SOFTNET Security Client
El SOFTNET Security Client ofrece una solución para la comunicación segura con células de
automatización a través de VPN. Para la protección intrínseca del PC/la PG y de la célula de
automatización conectada al mismo o a la misma, se recomienda emplear medidas
adicionales como, p. ej., escáners de virus y el cortafuegos de Windows.
En Windows 7 debe estar activado el cortafuegos del sistema operativo para que se establezca
correctamente el túnel VPN.

Crear un archivo de configuración en STEP 7
Configuración del módulo SOFTNET Security Client en el proyecto
El SOFTNET Security Client se habilita en el proyecto como módulo. A diferencia de los demás
módulos de seguridad, no es necesario configurar otras propiedades.
Asigne el módulo SSC al grupo o a los grupos VPN en los que deben configurarse túneles
IPsec a la PG o el PC.
Nota
Tenga en cuenta las indicaciones sobre los parámetros en el capítulo:
Incluir un módulo de seguridad en un grupo VPN configurado (Página 455).
Nota
Si crea varios SOFTNET Security Clients dentro de un grupo, no se establece ningún túnel
entre ellos, sino solo entre el cliente correspondiente y los módulos de seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

475

Configuración de dispositivos y redes
1.3 Configurar redes

Archivos de configuración para SOFTNET Security Client
La interfaz entre la herramienta de configuración STEP 7 y el SOFTNET Security Client
funciona mediante archivos de configuración.
(TXLSRGH
HVWDFLµQGHWUDEDMR

([SRUWDUODFRQILJXUDFLµQSDUD
62)71(76HFXULW\&OLHQWPHGLDQWH
VRSRUWHGHGDWRV
62)71(7
6HFXULW\&OLHQW
La configuración se almacena en los tipos de archivo "*.dat", "*.p12" y "*.cer".

Procedimiento
Para generar los archivos de configuración, realice los siguientes pasos en STEP 7:
1. Seleccione la ficha "Vista topológica" o la ficha "Vista de redes" en la vista "Dispositivos y
redes".
2. Inserte en la ficha seleccionada un "dispositivo de seguridad" desde el catálogo de
hardware mediante la selección "Componentes de red > Industrial Security".
3. En los ajustes de seguridad locales elija el SOFTNET Security Client V5 en "Dispositivo
VPN > Modo de operación VPN".
4. Asigne el SOFTNET Security Client a los grupos VPN en los que la PG o el PC se deba
comunicar a través de túneles IPsec.
5. Asegúrese de que la casilla de verificación "Generar archivos SSC" está activada en la
entrada "Configuración del SOFTNET Security Client" de los ajustes de seguridad locales
del SOFTNET Security Client.
6. Seleccione la ruta de almacenamiento para los archivos de configuración.
7. Compile la configuración del SOFTNET Security Client para exportar el archivo de
configuración.
8. Si ha elegido "Certificate" como método de autenticación, indique una contraseña para el
certificado de la configuración de VPN. Si no asigna ninguna contraseña, se adopta el
nombre del proyecto (no la contraseña del proyecto) como contraseña.
Resultado: La exportación de los archivos de configuración ha concluido.
9. Transfiera los archivos del tipo *.dat, *.p12, *.cer a la PG o el PC en el que desee utilizar el
SOFTNET Security Client.

476

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Nota
Proteger archivos de configuración exportados de accesos no autorizados
Los archivos de configuración exportados de STEP 7 para SOFTNET Security Client pueden
contener información relevante para la seguridad. Por este motivo hay que asegurarse de que
dichos archivos están protegidos de accesos no autorizados. Esto es especialmente
importante cuando se transfieren archivos.

SCALANCE S-600 V3
Sustitución del módulo de seguridad
Requisitos
Para poder sustituir los módulos de seguridad, sus descripciones deben estar actualizadas.
Para actualizar la descripción de los módulos de seguridad, proceda del siguiente modo:
1. Seleccione el módulo de seguridad que desea editar.
2. En los ajustes de seguridad locales, haga clic en la entrada "General" > "Información de
catálogo".
3. Haga clic en el botón "Actualizar descripción del módulo".

Cómo se accede a esta función
1. Seleccione el módulo de seguridad que desea editar en la vista topológica o de redes.
2. Haga clic con el botón derecho del ratón en el módulo de seguridad y elija el comando
"Sustituir dispositivo..." del menú contextual.
Consulte en la tabla siguiente qué módulos de seguridad pueden sustituirse sin una posible
pérdida de datos.
Módulo
de salida

Reemplazo de módulos posible
S602 V3

S602
V3.1

S602 V4

S612 V3

S612 V4

S623 V3

S623 V4

S623
V4.0.1

S627-2
M V4

S627-2
M
V4.0.1

S602 V3

-

x

x

x

x

x

x

x

x

x

S602 V3.1

!

-

x

!

!

!

!

!

!

!

S602 V4

!

!

-

!

!

!

!

!

!

!

S612 V3

!

!

!

-

x

x

x

x

x

x

S612 V4

!

!

!

!

-

!

x

x

x

x

S623 V3

!

!

!

!

!

-

x

x

x

x

S623 V4

!

!

!

!

!

!

-

x

x

x

S623
V4.0.1

!

!

!

!

!

!

!

-

!

x

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

477

Configuración de dispositivos y redes
1.3 Configurar redes
Módulo
de salida

Reemplazo de módulos posible
S602 V3

S602
V3.1

S602 V4

S612 V3

S612 V4

S623 V3

S623 V4

S623
V4.0.1

S627-2
M V4

S627-2
M
V4.0.1

S627-2M
V4

!

!

!

!

!

!

!

!

-

x

S627-2M
V4.0.1

!

!

!

!

!

!

!

!

!

-

x Sin pérdidas
! Con posibles pérdidas
- El tipo de módulo y la versión de firmware no cambian.

Configurar interfaces para módulos SCALANCE S
Sinopsis
Configuración del modo de operación
El modo de operación permite definir el modo de enrutamiento de las interfaces (externa/
interna). La interfaz DMZ del módulo de seguridad (solo SCALANCE S623/627-2M) siempre
está conectada en el modo de enrutamiento. Encontrará más información en el apartado:
Configurar parámetros de dirección IP (Página 480)

Configuración de las interfaces
Si debe configurarse la interfaz externa, la interfaz DMZ (solo SCALANCE S623/S627-2M) o
la interfaz de túnel (solo SCALANCE S612/S623/S627-2M versión V4 o superior en grupo(s)
VPN) de un módulo de seguridad, estas deben estar activadas a través de la casilla de
verificación "Activar interfaz". Defina las direcciones IP de cada interfaz y los ajustes de los
diferentes puertos. Para asignar una dirección IP están disponibles los modos de asignación
siguientes para la interfaz externa y la interfaz DMZ (solo SCALANCE S623/S627-2M) en la
entrada "General":
● Dirección IP estática con máscara de subred. Encontrará más información en el apartado:
Configurar parámetros de dirección IP (Página 480)
● Asignación de dirección mediante PPPoE. Encontrará más información en el apartado:
Configurar una conexión a Internet (Página 483)
La interfaz interna y la interfaz de túnel solo pueden configurarse utilizando una dirección
IP estática.

478

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Si se han registrado direcciones IP alias en las interfases del módulo de seguridad mediante
la configuración de reglas NAT, se mostrarán en el campo "Direcciones IP alias".
Nota
Interfaz externa e interfaz DMZ como acceso a Internet
No es posible el funcionamiento simultáneo de PPPoE en la interfaz externa y en la interfaz
DMZ (Dual-ISP).

Point to Point Protocol over Ethernet (PPPoE)
Para permitir una conexión Internet/WAN directamente a través de un módem DSL, la
asignación de la dirección IP se realiza en la interfaz externa o en la interfaz DMZ mediante
PPPoE. PPPoE es un protocolo de llamada para la obtención de direcciones IP desde un
Internet Service Provider (ISP). SCALANCE S funciona en ese caso en modo de enrutamiento.
Para utilizar este método de asignación de dirección IP, introduzca los datos del ISP en la
entrada "PPPoE". La dirección IP, la máscara de subred, el router estándar y el servidor DNS
de la interfaz son entonces predefinidos por el ISP.
Nota
Si hay configurado un router predeterminado, este no se tiene en cuenta si se utiliza PPPoE.
Será preasignado dinámicamente al módulo por el ISP.
Nota
Ningún componente de red entre SCALANCE S y el módem DSL
Si la interfaz de un módulo SCALANCE S funciona mediante PPPoE, no debe haber ningún
otro componente de red entre dicha interfaz y el módem DSL conectado, ya que los datos de
marcación del Internet Service Provider se transfieren en su caso sin codificar en este tramo.
Si se utiliza el protocolo de autenticación "CHAP", los datos se transfieren cifrados.

Configuración de módulos de medios
Además de las funciones del SCALANCE S623, el S627-2M posee dos slots para módulos de
medios, en cada uno de los cuales se puede usar un módulo de medios eléctrico u óptico de
dos puertos. Las interfaces externa e interna se amplían de esta forma con dos puertos cada
una. En el modo de enrutamiento se pueden utilizar los puertos adicionales del módulo de
seguridad para la conexión de las interfaces externa e interna a topologías de anillo.
Para integrar módulos de medios en el SCALANCE S627-2M, seleccione el módulo de
seguridad y cambie a la vista de dispositivos. Seguidamente, seleccione los módulos de
medios deseados en el catálogo de hardware.
Para los puertos del tipo "cobre" es posible definir manualmente la velocidad de transferencia
y el modo dúplex/semidúplex por medio del modo de puerto. Para los puertos del tipo "óptico",
el modo de puerto está predeterminado por el módulo de medios o el SFP utilizado y no se
puede adaptar.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

479

Configuración de dispositivos y redes
1.3 Configurar redes
Encontrará información sobre la conexión de puertos para módulos de medios a anillos MRP
en el siguiente capítulo:
AUTOHOTSPOT

Ajustar el modo de operación
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Modo de operación".

Modo de operación - Posibilidades de selección
Si el módulo de seguridad no se encuentra en ningún grupo VPN, es posible modificar el modo
de operación en esta entrada. Si el módulo de seguridad se encuentra en un grupo VPN, no es
posible modificar el modo de operación.
La selección es válida para el enrutamiento de interfaces entre la interfaz externa y la interna.
La interfaz DMZ (solo SCALANCE S623 y S627-2M) siempre está conectada en el modo de
enrutamiento.
Modo Bridge

Para el uso en redes planas. Las interfaces externa e interna
están en la misma subred IP.
Para S623 / S627-2M: las interfaces externa e interna están
en la misma subred IP, la interfaz DMZ está en otra subred IP
o está desactivada.

Modo de enrutamiento

Todas las interfaces están en diferentes subredes IP. Si se ha
activado el modo de enrutamiento, hay que configurar una
dirección IP interna y una máscara de subred interna para la
interfaz interna del módulo de seguridad.
Nota
Si se ha activado el modo de enrutamiento para el módulo
SCALANCE S no podrán definirse reglas para cortafuegos
MAC.

Modo Ghost (solo para SCALANCE S602 V3.1 o superior)

Durante el funcionamiento, el módulo de seguridad adopta,
para la interfaz externa, la dirección IP del dispositivo que
está conectado a la interfaz interna del módulo de seguridad.
Los datos de dirección IP que deben indicarse para la interfaz
externa sirven únicamente para cargar la configuración antes
del funcionamiento en modo Ghost.

Configurar parámetros de dirección IP
Significado
Definir parámetros de red como dirección IP y máscara de subred para la o las interfaces del
módulo de seguridad.

480

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Interfaz externa [P1] roja" o "Interfaz
DMZ [P3] amarilla". Solo es posible configurar la interfaz de túnel virtual si el módulo de
seguridad (solo SCALANCE S612/S623/S627-2M versión V4 o superior) está dentro de un
grupo VPN como mínimo, consulte el apartado "Significado de la dirección IP de túnel".
Nota
Configuración de la interfaz interna en modo de enrutamiento
Si se ha seleccionado el modo de operación "Enrutamiento" para el módulo de seguridad,
hay que configurar adicionalmente una dirección IP interna y una máscara de subred para
la interfaz interna del módulo de seguridad. Se accede a esta función en los ajustes de
seguridad locales mediante "Interfaz interna [P2] verde" > "Direcciones Ethernet".
3. En caso necesario, active la interfaz mediante la casilla de verificación "Activar interfaz".
4. Elija la entrada "Direcciones Ethernet".
5. Realice los ajustes que se describen en la tabla siguiente.
Parámetro

Significado

Dirección IP

Dirección IP de la interfaz externa.
La dirección IP consta de 4 números decimales comprendi‐
dos en el rango de 0 a 255 y separados entre ellos por un
punto; p. ej. 141.80.0.16

Máscara de subred

La máscara de subred consta de 4 números decimales se‐
parados entre sí por un punto, p. ej. 255.255.0.0.

Utilizar router (no es posible para la interfaz de túnel)

Active esta casilla de verificación si desea utilizar un router
estándar e introduzca su dirección IP en el campo de entrada
"Dirección del router".

Nota
Conexión en red de las interfaces físicas
Conecte en red las interfaces físicas del módulo de seguridad con las subredes
correspondientes para evitar conflictos de direcciones IP.

Significado de la dirección IP de túnel
Si utiliza la función "NAT/NAPT en túnel VPN" para un módulo SCALANCE S612/S623/
S627-2M versión V4 o superior, debe asignar una dirección IP de túnel para el módulo de
seguridad. Con ello se garantiza la accesibilidad del módulo de seguridad a través del túnel
VPN, así como la posibilidad de configuración y diagnóstico. La dirección IP de túnel
configurada se puede completar con direcciones IP alias de túnel con ayuda de las
correspondientes reglas NAT/NAPT. La máscara de subred está predefinida de forma fija con
32 bits para la dirección IP de túnel y no se puede modificar en la configuración. Solo es posible
configurar la dirección IP de túnel si el módulo de seguridad está dentro de un grupo VPN como
mínimo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

481

Configuración de dispositivos y redes
1.3 Configurar redes
Encontrará más información sobre la conversión de direcciones con NAT/NAPT en túneles
VPN en el siguiente capítulo:
Conversión de direcciones con NAT/NAPT en túneles VPN (Página 510)

Particularidades del router estándar
● Si está configurada la asignación de IP por "PPPoE", se ignorará un router predeterminado
configurado, ya que la ruta predeterminada siempre conduce automáticamente a través de
la interfaz PPPoE.
● Si está configurada la asignación de IP por "Dirección estática" y si el módulo de seguridad
está conectado a Internet a través de un router DSL(NAPT), hay que especificar el router
DSL como router predeterminado.
● Para los módulos de seguridad del modo Ghost (solo SCALANCE S602 V3.1 o superior) no
pueden configurarse routers estándar, ya que se determinan en el tiempo de ejecución. El
modo Ghost no permite configurar rutas específicas para los módulos de seguridad.

Configurar el modo de puerto
Significado
El modo de puerto define la velocidad de transferencia y el modo dúplex/semidúplex. Para los
puertos que participan en la comunicación deben ajustarse los mismos parámetros en cada
caso.

Modos de puerto seleccionables
Para SCALANCE S V3 o superior, pueden configurarse los modos de puerto siguientes en los
puertos fijos:
Modo de puerto

Significado

Autonegotiation

La velocidad de transferencia y el modo dúplex/semidúplex
se seleccionan automáticamente.
Nota
Solo si Autonegotiation está seleccionada se soportan una
velocidad de transferencia de 1000 Mbits/s y la función Au‐
tocrossing.

10 Mbps, dúplex y semidúplex

Velocidad de transferencia de 10 Mbits/s

100 Mbps, dúplex y semidúplex

Velocidad de transferencia de 100 Mbits/s

Solo es posible desactivar un puerto en el caso de los puertos externos, así como del puerto
DMZ en SCALANCE S623/S627-2M. Los modos de puerto de los puertos de módulos de
medios se configuran en la vista de dispositivos y se rigen por la funcionalidad del módulo de
medios correspondiente.

482

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configurar una conexión a Internet
Requisitos
La entrada "PPPoE" solo se muestra en los ajustes de seguridad locales si se ha configurado
el método de asignación IP "PPPoE" para una de las interfaces.

Cómo se accede a esta función
1. Seleccione el módulo de seguridad que desea editar.
2. En los ajustes de seguridad locales elija la entrada "PPPoE".

Significado
Si se ha ajustado una conexión a través de PPPoE para una de las interfaces del módulo de
seguridad, realice los ajustes para el Internet Service Provider (ISP) en esta entrada.
Tabla 1-52

Ajustes de la cuenta ISP

Función

Descripción

Protocolo de autentificación

Seleccione uno de los siguientes protocolos de
autenticación o ninguno:
● PAP (Password Authentication Protocol)
● CHAP (Challenge Handshake Authentication
Protocol)
Nota
Ambos interlocutores deben utilizar el mismo mé‐
todo de autenticación; de lo contrario no es posible
establecer ninguna conexión.

Nombre de usuario

Introduzca el nombre para el inicio de sesión en la
cuenta ISP.

Contraseña

Introduzca la contraseña para el inicio de sesión
en la cuenta ISP.

Repetir contraseña

Vuelva a introducir la contraseña para el inicio de
sesión en la cuenta ISP.

Tabla 1-53

Reglas para nombres de usuario y contraseñas

Caracteres permitidos

Se admiten los siguientes caracteres del juego
ANSI X 3.4-1986:
0123456789
A...Z a...z
!#$%&()"*'+`,-./:;<=>?@ [\]_{|}~^

Longitud del nombre de usuario

1 ... 120 caracteres

Longitud de la contraseña

1 ... 31 caracteres

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

483

Configuración de dispositivos y redes
1.3 Configurar redes
Tabla 1-54

Ajustes de la conexión

Función

Descripción

Conexión permanente

Conexión continua a Internet. Si el proveedor deshace la cone‐
xión, esta se vuelve a establecer automáticamente, aunque no
haya que enviar ningún paquete en ese momento.

Conexión bajo demanda

La conexión a Internet se establece automáticamente si hay que
enviar paquetes a Internet.
Con este ajuste son posibles retardos al enviar los paquetes.

Tiempo máx. de inactividad (solo
con el ajuste "Conexión bajo de‐
manda")

Si no se envía ningún paquete dentro de un tiempo determinado,
la conexión a Internet se deshace automáticamente. En el campo
"Tiempo máx. de inactividad", indique el tiempo en segundos pa‐
sado el cual debe interrumpirse la conexión.
● Ajuste estándar: 300
● Valor mínimo: 10
● Valor máximo: 3600

Desconexión forzada (solo con el
ajuste "Conexión permanente")

Active esta casilla de verificación para adaptar la hora de la des‐
conexión forzada por parte del módulo de seguridad.

Hora de la desconexión forzada
(solo con el ajuste "Conexión per‐
manente")

El proveedor deshace la conexión a Internet automáticamente
tras un tiempo determinado. Si se introduce una hora en este
campo, el módulo de seguridad deshará por sí mismo la conexión
a Internet a esa hora. Esto permite, en determinadas circunstan‐
cias, aplazar una desconexión de Internet por parte del provee‐
dor. Una desconexión forzada por iniciativa propia solo es posible
si existe una conexión permanente.
● Ajuste estándar: 00.00
● Entradas permitidas: 00:00 ... 23:59

Configuración de DNS
Función específica del módulo
Los servidores DNS para la resolución de FQDNs especificados en la entrada "DNS dinámico"
pueden ser utilizados por los módulos SCALANCE S a partir de V3. Los servidores DNS para
todas las funciones restantes pueden ser utilizados por los módulos SCALANCE S a partir de
V4.

DNS
Para el direccionamiento de dispositivos de red mediante FQDN, el módulo de seguridad debe
conocer la dirección IP de un servidor DNS que convierta las peticiones DNS en las direcciones
IP correspondientes de los dispositivos de red.

Procedimiento para instalar el DNS:
1. Seleccione el módulo de seguridad que desea editar.
2. En los ajustes de seguridad locales elija la entrada "DNS".

484

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Opción

Significado

Obtener automáticamente la dirección del servidor La dirección del servidor DNS puede obtenerse
DNS
automáticamente mediante PPPoE, siempre que
el módulo de seguridad esté conectado a Internet
a través de un módem DSL. Solo puede ajustarse
para la interfaz externa y la interfaz DMZ. Si para
una de estas interfaces se ajusta PPPoE y no hay
configurado ningún servidor DNS, STEP 7 ajusta
automáticamente la opción "Obtener dirección de
servidor DNS automáticamente".
Utilizar la siguiente dirección de servidor DNS:

Introduzca manualmente la dirección del servidor
DNS preferido y del alternativo.

Configurar DNS dinámico
DNS dinámico
Con un DNS dinámico se puede acceder con un nombre determinado (FQDN) a una dirección
IP siempre cambiante. Esto es necesario p. ej. para acceder a un servidor disponible a través
de una dirección IP pública cambiante.
El módulo de seguridad notifica a un proveedor de DNS dinámico (p. ej. DynDNS.org, noip.com) la dirección IP WAN actual a través de la cual se puede acceder al módulo de
seguridad. El proveedor garantiza que las peticiones de DNS al FQDN del módulo de
seguridad se respondan con la dirección IP WAN actual del módulo de seguridad.
El DNS dinámico está permitido en las siguientes interfaces:
● Interfaz externa
● Interfaz DMZ

Requisitos
Se ha creado una cuenta para un proveedor de DNS dinámico y se ha registrado un FQDN.

Procedimiento para instalar el DNS dinámico:
1. Seleccione el módulo de seguridad que desea editar.
2. Elija la entrada "DNS dinámico" en los ajustes de seguridad locales.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

485

Configuración de dispositivos y redes
1.3 Configurar redes
3. Active la casilla de verificación "Activar servicio" en el área "Servicio DNS din. primario" y
realice los ajustes siguientes:
Ajuste

Significado

Proveedor

Elija el proveedor en el que ha configurado una
cuenta para DNS dinámico.
En el caso de los proveedores predefinidos
(DynDNS.org y No-IP.com), la URL de actuali‐
zación de proveedor y la URL de servicio de
comprobación de IP ya aparecen indicadas. Se‐
leccionando la opción "Definido por el usuario"
se pueden indicar ambas URL manualmente.

Tipo de servicio

Elija si para la URL de actualización de provee‐
dor de los proveedores predefinidos debe utili‐
zarse el protocolo HTTP o HTTPS.

FQDN

Introduzca el nombre de host (p. ej. mysecurity‐
module) y el nombre de dominio (p. ej.
dyndns.org) registrado en el proveedor separa‐
dos por un punto. El FQDN puede actuar como
punto final VPN y diferir del FQDN de la entrada
"VPN". En los ajustes VPN específicos de la co‐
nexión se configura el punto final VPN que se
notifica al interlocutor VPN. La sintaxis de un
FQDN debe ser conforme a DNS.
Número máximo de caracteres: 99

Ignorar errores al verificar el certificado del ser‐
vidor

Para proteger los datos de autenticación se ve‐
rifica el certificado del servidor de actualización.
Si la verificación del certificado falla, la conexión
HTTPS se termina por defecto y los datos de la
cuenta no se transmiten. Si activa la casilla de
verificación, la conexión HTTPS no se terminará
aunque la verificación falle (p. ej. si el certificado
ha caducado) y los datos de la cuenta se trans‐
miten. Se recomienda no ignorar la verificación y
no activar la casilla de verificación. La casilla de
verificación solo puede activarse si se ha selec‐
cionado el tipo de servicio "DDNS-HTTPS".

Usuarios

Introduzca el nombre de usuario que definió al
crear la cuenta. La sintaxis de un nombre de
usuario debe ser conforme a DNS.
Número máximo de caracteres: 24

Contraseña

Introduzca la contraseña que definió al crear la
cuenta. La sintaxis de la contraseña debe ser
conforme a DNS.
Número máximo de caracteres: 24

486

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Ajuste

Significado

Vigilar el cambio de dirección IP en el router DSL Si el módulo de seguridad está conectado a In‐
ternet a través de un router DSL, activando esta
función se activa el servicio de comprobación de
IP. El módulo de seguridad envía periódicamen‐
te peticiones para determinar la dirección IP ac‐
tual del router DSL y para detectar un cambio de
dirección IP en el router DSL. La dirección IP
determinada de este modo se envía al provee‐
dor cada vez que se detecta un cambio.
Periodo

Indique en qué ciclo debe llamarse el servicio de
comprobación de IP.
● Ajuste estándar: 20 minutos
● Valor mínimo: 10 minutos
● Valor máximo: 1440 minutos

URL de actualización de proveedor

Indique la URL con la que el módulo de seguri‐
dad notifica al proveedor la dirección IP pública
actual. Los textos comodín <FQDN> y <Current‐
WanIP> deben colocarse en el lugar adecuado
de la URL. La sintaxis de la URL debe ser con‐
forme a DNS.

URL de servicio de comprobación de IP

Indique la URL que el módulo de seguridad debe
utilizar para determinar su dirección IP pública.
La sintaxis de la URL debe ser conforme a DNS.

Número máximo de caracteres: 127

Número máximo de caracteres: 127

4. Especifique un proveedor adicional para el caso de que fallase el primario en el área
"Servicio DNS din. secundario" (ajuste opcional).

Configurar un LLDP
Función específica del módulo
Esta función solo está disponible para SCALANCE S V4 o superior.

Requisitos
El módulo de seguridad está en modo de enrutamiento.

Significado
LLDP (Link Layer Discovery Protocol) es un protocolo que se utiliza para detectar topologías
de red. Un dispositivo apto para LLDP está en condiciones de enviar regularmente información
sobre sí mismo a dispositivos vecinos y, al mismo tiempo, recibir información de ellos. La
información recibida se almacena en cada dispositivo apto para LLDP en un archivo LLDP
MIB. Los sistemas de gestión de redes pueden acceder a estos archivos LLDP MIB con ayuda
de SNMP y así emular la topología de red existente.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

487

Configuración de dispositivos y redes
1.3 Configurar redes

Parámetros configurables
El grado de actividad del módulo de seguridad en relación con LLDP se puede configurar en
la entrada "Modo LLDP" de la correspondiente interfaz.
Parámetro

Descripción

Nombre

Nombre del puerto para el que se configura el ajuste.

Modo LLDP

Modo LLDP configurado:
● RxTx: enviar y recibir telegramas LLDP
● Off: no enviar ni recibir telegramas LLDP

Redundancia de medios en topologías de anillo
Redundancia de medios con MRP
Función específica del módulo
Esta función solo está disponible para SCALANCE S627-2M.

Significado
Bajo el término "Redundancia de medios" se engloban distintos procedimientos para
incrementar la disponibilidad de redes Industrial Ethernet en las que se puede acceder a
dispositivos por diversas vías. Esto puede tener lugar por entrelazamiento de redes, conexión
en paralelo de vías de transmisión o cerrando una topología lineal dándole forma de topología
de anillo.

Método de redundancia de medios MRP
Para los productos SIMATIC NET existe redundancia de medios dentro de una topología de
anillo si se aplica el método MRP (Media Redundancy Protocol), entre otros.
En este método se configura uno de los dispositivos como administrador de redundancia. Los
demás dispositivos son clientes de redundancia. Los módulos SCALANCE S627-2M pueden
adoptar exclusivamente el rol de un cliente MRP. El administrador de redundancia comprueba
con telegramas de prueba la ausencia de interrupciones en el anillo. Los clientes de
redundancia reenvían los telegramas de prueba. Si los telegramas de prueba del
administrador de redundancia dejan de llegar al puerto en anillo del administrador de
redundancia debido a una interrupción del anillo, el administrador de redundancia conecta sus
dos puertos en anillo e informa inmediatamente del cambio a los clientes de redundancia.
El tiempo que necesitan los switches SCALANCE X para conectar sus puertos en anillo como
administrador de redundancia es de 200 ms.

488

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Nota sobre el uso de MRP
● MRP es compatible con topologías de anillo con un máximo de 100 dispositivos. Una
superación del número de dispositivos puede hacer que falle el tráfico de datos.
● Se recomienda ajustar los puertos en anillo en cuestión a dúplex y 100 Mbits/s. En otro caso
puede fallar el tráfico de datos.

Posibilidades de uso de MRP en puertos para módulos de medios
MRP se soporta exclusivamente en puertos para módulos de medios de SCALANCE
S627-2M. La siguiente tabla muestra las posibilidades de uso de MRP en los puertos para
módulos de medios de SCALANCE S627-2M:
Puertos en anillo
Cliente MRP

Módulo de medios 1

Módulo de medios 2

P4

P5

P6

P7

-

-

-

-

Anillo 1

Anillo 1

-

-

-

-

Anillo 2

Anillo 2

Anillo 1

Anillo 1

Anillo 2

Anillo 2

Si hay dos anillos subordinados por cada módulo SCALANCE S, es posible la comunicación
en el nivel 3 entre los anillos.

Configurar MRP para el módulo de seguridad
Requisitos
● El módulo de seguridad está en modo de enrutamiento.
● Para las interfaces conectadas a anillos MRP hay configurados módulos de medios.
● Las interfaces del módulo de seguridad que deben conectarse a anillos están conectadas
en red con los correspondientes administradores del anillo.

Cómo se accede a esta función
1. Seleccione el módulo de seguridad que desea editar.
2. En los ajustes de la interfaz deseada elija la entrada "Media Redundancy".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

489

Configuración de dispositivos y redes
1.3 Configurar redes

Parámetros configurables
Parámetro

Significado

Posibilidades de selección

Dominio MRP (solo si se selecciona el rol de
redundancia de medios "Cliente MRP")

Con ayuda de los dominios
Visualización del dominio MRP utilizado para
MRP se definen los dispositi‐ la interfaz.
vos de un anillo MRP. Para
las interfaces de todos los
módulos que deban estar co‐
nectadas a un mismo anillo
MRP, debe estar selecciona‐
do el mismo dominio MRP.

Rol de redundancia de medios

Selección del protocolo de re‐ ● No es estación del anillo
dundancia de medios o de‐
● Cliente MRP
sactivación de la redundan‐
cia de medios para la interfaz.

Puerto en anillo 1 (solo si se selecciona el rol
de redundancia de medios "Cliente MRP")

Nombre del primer puerto en
anillo de la interfaz seleccio‐
nada si se ha seleccionado
para ella el rol de redundan‐
cia de medios "Cliente MRP".

-

Puerto en anillo 2 (solo si se selecciona el rol
de redundancia de medios "Cliente MRP")

Nombre del segundo puerto
en anillo de la interfaz selec‐
cionada si se ha selecciona‐
do para ella el rol de redun‐
dancia de medios "Cliente
MRP".

-

Ajustes del dominio

A través de los ajustes del
dominio pueden agregarse
dominios MRP, editar los
nombres de dominios MRP
existentes o borrar estos do‐
minios.

-

Protocolo de redundancia de medios alterna‐ Active esta casilla de verifica‐ ● Habilitar interfaz para otros protocolos de
tivo
ción para habilitar la interfaz
redundancia de medios
del módulo de seguridad pa‐
● Desactivar interfaz para otros protocolos
ra otros protocolos de redun‐
de redundancia de medios (ajuste
dancia de medios.
predeterminado)
Passive Listening

Active esta casilla de verifica‐ ● Activar Passive Listening (ajuste
ción si desea que la interfaz
predeterminado)
seleccionada se acople a re‐
● Desactivar Passive Listening
des externas en las que se
utilice STP/RSTP (SpanningTree-Protocol/Rapid-Span‐
ning-Tree-Protocol).

Particularidades del modo Ghost
Función específica del módulo
Esta función solo está disponible para SCALANCE S602 V3.1 o superior.

490

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Significado
En modo Ghost, el módulo de seguridad no tiene dirección IP propia ni en la interfaz interna ni
en la externa. En su lugar, el módulo de seguridad obtiene en el tiempo de ejecución la
dirección IP para su interfaz externa de un dispositivo que está conectado a la interfaz interna
del módulo de seguridad y cuyos parámetros de dirección IP pueden ser desconocidos al
realizar la configuración. Es posible modificar la dirección IP del dispositivo interno y, por
consiguiente, la dirección IP de la interfaz externa. Puesto que el dispositivo interno se
identifica por su dirección MAC, los cambios de direcciones IP solo se realizan para la dirección
MAC aprendida. En la interfaz interna del módulo de seguridad no se configura ni obtiene
ninguna dirección IP.
En lo que se refiere a direcciones MAC, el módulo de seguridad cambia la dirección MAC del
dispositivo interno por la dirección MAC del módulo de seguridad en todos los paquetes de
datos que salen por la interfaz externa (respuestas del dispositivo interno).

Activación del modo Ghost
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Modo de operación".
3. Seleccione la opción "Modo Ghost".

Propiedades de los módulos configurables
En el modo Ghost, las propiedades de los módulos siguientes pueden configurarse en los
ajustes de seguridad locales:
● Interfaz externa [P1] roja
● Cortafuegos
● Sincronización horaria
● Ajustes de registro
● SNMP
Puesto que en modo Ghost no es posible configurar servidores DNS, tampoco pueden
resolverse FQDN.

Requisitos para detectar un dispositivo interno
El módulo de seguridad solo puede determinar la dirección IP del dispositivo interno si este
inicia por cuenta propia una comunicación de datos con un interlocutor de la red externa.
Además, el módulo de seguridad no ofrece servicios de servidor mientras se determina la
dirección IP. El módulo de seguridad no puede responder consultas de externa hasta que el
dispositivo interno le haya enviado paquetes de datos.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

491

Configuración de dispositivos y redes
1.3 Configurar redes

Asignación de puertos para conexiones de datos entrantes y salientes
Puesto que la interfaz externa del módulo de seguridad y el dispositivo interno tienen la misma
dirección IP, hay que llevar a cabo un direccionamiento selectivo de los componentes de red
a través de los puertos TCP/UDP. Por este motivo, los puertos están asignados bien al módulo
de seguridad, bien al dispositivo interno. En las tablas siguientes se representan las
asignaciones de los puertos a los diferentes dispositivos para conexiones de datos entrantes
y salientes:
Tabla 1-55

Asignación de puertos para conexiones entrantes (de externa a módulo de seguridad)

Servicio

Puerto

Protocolo

Comentario

Servicios web, acceso de
configuración y diagnóstico

443

TCP

El puerto HTTPS está activa‐
do siempre para el acceso de
configuración y diagnóstico
mediante STEP 7 y no puede
modificarse.

SNMP

161

TCP

Tras activar SNMP en STEP
7 se transfieren peticiones
SNMP entrantes a través del
puerto UDP 161. También es
posible una transferencia a
través del puerto TCP 161
para poder acceder, por
ejemplo, al dispositivo inter‐
no.

UDP

Nota
Tras activar SNMP, el puerto
SNMP está asignado de for‐
ma fija al módulo de seguri‐
dad. Si SNMP no está activa‐
do, utilizando una regla del
cortafuegos es posible acce‐
der al dispositivo interno vía
SNMP.

492

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Tabla 1-56

Asignación de puertos para conexiones salientes (de módulo de seguridad a externa)

Servicio

Puerto

Protocolo

Comentario

Syslog

514

UDP

Si el servicio Syslog de STEP
7 está activado, el módulo de
seguridad transfiere los avi‐
sos de Syslog a través del
puerto UDP 514. Esta asigna‐
ción de puerto no puede mo‐
dificarse.

NTP

123

UDP

Si el servidor NTP se utiliza
para la sincronización hora‐
ria, las peticiones NTP se
transfieren a través del puer‐
to UDP 123. Esta asignación
de puerto no puede modificar‐
se.

Direcciones IP y máscaras de subred reconocibles
El módulo de seguridad reconoce exclusivamente los dispositivos internos que disponen de
direcciones IP en el rango de las clases de red A, B o C. La máscara de subred es determinada
por el módulo de seguridad de acuerdo con la clase de red correspondiente (véase la tabla
"Clases de red y máscaras de subred correspondientes"). Para que la máscara de subred se
pueda determinar correctamente, debe haberse introducido un router estándar para el
dispositivo interno.
El módulo de seguridad rechaza los dispositivos con direcciones IP de las clases de red D y E.

Clase de red

Direcciones IP
Límite inferior

Máscara de subred
Límite superior

A

0.0.0.0

127.255.255.255

255.0.0.0

B

128.0.0.0

191.255.255.255

255.255.0.0

C

192.0.0.0

223.255.255.255

255.255.255.0

D

224.0.0.0

239.255.255.255

Rechazado por el módulo de
seguridad

E

240.0.0.0

255.255.255.255

Rechazado por el módulo de
seguridad

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

493

Configuración de dispositivos y redes
1.3 Configurar redes

Capacidad
Se detecta como máximo un dispositivo interno del módulo de seguridad. El módulo de
seguridad se comporta del siguiente modo en caso de haber varios dispositivos internos:
● El primer dispositivo detectado por el módulo de seguridad en la red interna obtiene acceso
al segmento de red externo siempre que el cortafuegos esté configurado en
correspondencia.
● El tráfico de datos de otros dispositivos que pueda haber en el área de red interna se
bloquea de acuerdo con la dirección del remitente a partir del nivel 2 (capa MAC).

Carga de configuraciones y diagnóstico después de la puesta en marcha
Tras obtener una dirección IP del dispositivo interno, el módulo de seguridad tiene en la interfaz
externa una dirección IP que puede diferir de la dirección IP con la que se configuró
inicialmente el módulo de seguridad. Para cargar una configuración o realizar un diagnóstico
es necesario indicar en STEP 7, para la conexión con la interfaz externa, la dirección IP que el
módulo de seguridad ha obtenido del dispositivo interno en el tiempo de ejecución. Esto se
realiza en los ajustes de seguridad locales o directamente en los cuadros de diálogo "Carga
avanzada" o "Establecer conexión online". Encontrará más información sobre el
establecimiento de conexiones online en el capítulo: Cargar una configuración (Página 531)

Información de enrutamiento para redes jerárquicas en la interfaz externa
Si en la interfaz externa del módulo de seguridad hay redes jerárquicas con transiciones de
subred, el módulo de seguridad debe obtener la información de enrutamiento correspondiente
del dispositivo interno. Para ello, el dispositivo interno tiene que responder conforme a
consultas ICMP dirigidas a él. No son necesarias las respuestas al Broadcast ICMP.

Autenticación mediante servidor RADIUS
Sinopsis
Función específica del módulo
Esta función solo está disponible para SCALANCE S V4 o superior.

Significado
RADIUS (Remote Authentication Dial-In User Service) es un protocolo de autenticación de
usuarios mediante servidores en los que se pueden almacenar los datos de usuario de forma
centralizada. El uso de servidores RADIUS permite aumentar la protección de nombres de
usuario, funciones asignadas y contraseñas.

494

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Entorno de uso de los servidores RADIUS
La autenticación mediante servidor RADIUS se puede realizar en el marco de la activación de
conjuntos de reglas IP personalizados.
3*SDUDDFFHGHUDODF«OXODGHDXWRPDWL]DFLµQ



6HUYLGRU5$',86

5HGH[WHUQD




0µGXORGHVHJXULGDG

,QWHUQDF«OXODGHDXWRPDWL]DFLµQ

1

Introducción de los datos de usuario en la página web del módulo de seguridad

2

Autenticación mediante servidor RADIUS y activación del conjunto de reglas IP personalizado

3

Acceso a célula de automatización

La estructura de red representada arriba constituye un ejemplo. El servidor RADIUS también
puede encontrarse en la red interna o en la red DMZ del módulo de seguridad.
Para las posibilidades de configuración descritas a continuación, siempre se presupone que se
ha configurado un servidor RADIUS en STEP 7 y que se ha asignado al correspondiente
módulo de seguridad. Además, debe haberse configurado un usuario o una función con el
método de autenticación "RADIUS". Encontrará información al respecto en los capítulos
siguientes:
● Definición de servidores RADIUS (Página 497)
● Asignación de servidor RADIUS a un módulo de seguridad (Página 498)
Encontrará información general sobre los conjuntos de reglas IP personalizados en el
siguiente capítulo:
● AUTOHOTSPOT

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

495

Configuración de dispositivos y redes
1.3 Configurar redes

Configuraciones posibles
Para la autenticación del usuario mediante un servidor RADIUS se dispone de dos
posibilidades de configuración:
● El módulo de seguridad conoce el usuario y su función, a través del servidor RADIUS
solamente se realiza la gestión de la contraseña para el usuario. En el servidor RADIUS
está configurado el usuario con la contraseña correspondiente.
– Se configura un usuario con el método de autenticación "RADIUS".
– El usuario se asigna al conjunto de reglas IP personalizado.
Resultado:
– Cuando un usuario inicia sesión en la página web del módulo de seguridad, la consulta
de autenticación se transmite al servidor RADIUS.
– El servidor RADIUS comprueba la contraseña y devuelve el resultado al módulo de
seguridad.
– Si se ha superado la comprobación de la contraseña, se activa el conjunto de reglas IP
personalizado.
● El módulo de seguridad conoce la función, y la gestión de usuarios se realiza a través del
servidor RADIUS. En el servidor RADIUS está configurado el usuario con la contraseña
correspondiente.
– Al conjunto de reglas IP personalizado se le asigna una función definida por el usuario
o bien una función definida por el sistema.
– En la entrada "RADIUS" > "Ajustes RADIUS" de los ajustes de seguridad locales del
módulo de seguridad se activan las casillas de verificación "Permitir la autenticación
RADIUS de usuarios no configurados" y "Se necesita ID de filtro para la autenticación".
Resultado:
– Cuando un usuario inicia sesión en la página web del módulo de seguridad, las
consultas de autenticación y de autorización se transmiten al servidor RADIUS.
– El servidor RADIUS comprueba la contraseña y devuelve el resultado al módulo de
seguridad.
– Caso a: si el nombre de la función está configurado adicionalmente en el servidor
RADIUS:
El servidor RADIUS devuelve al módulo de seguridad el nombre de la función asignada
al usuario.
– Caso b: si el nombre de la función no está configurado en el servidor RADIUS:
El módulo de seguridad asigna al usuario una función definida por el sistema, "radius".
– Si se ha superado la comprobación de la contraseña, se activa el conjunto de reglas IP
personalizado.

Convenios para servidores RADIUS
● Los servidores RADIUS se pueden encontrar en cualquier red conectada con el módulo de
seguridad.
● Se pueden configurar como máximo dos servidores RADIUS por módulo de seguridad.
Durante el funcionamiento está entonces activo uno solo de los servidores RADIUS.

496

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● En la definición de un servidor RADIUS se puede utilizar también un FQDN en lugar de una
dirección IP.
● Para el nombre de un servidor RADIUS pueden utilizarse como máximo 25 caracteres.

Definición de servidores RADIUS
Significado
Antes de que pueda tener lugar la autenticación mediante un servidor RADIUS, este deberá
guardarse en STEP 7. A continuación, el servidor RADIUS definido debe asignarse al módulo
de seguridad para el cual dicho servidor debe asumir la autenticación de usuario.

Procedimiento
1. En las funciones de seguridad globales elija la entrada "RADIUS"
Resultado: Debajo de la entrada seleccionada se muestran los servidores RADIUS creados
hasta ahora.
2. Haga doble clic en la entrada "Agregar nuevo servidor RADIUS".
Resultado: El servidor RADIUS creado se muestra con un número asignado de forma
automática por debajo de la entrada "RADIUS".
3. Haga doble clic en el servidor RADIUS creado.
Resultado: En el área de trabajo se muestra el cuadro de diálogo de asignación para
servidores RADIUS. En la lista desplegable "Servidor RADIUS" se ha marcado el servidor
RADIUS seleccionado. Existe la posibilidad de asignarle los módulos de seguridad
deseados, véase el capítulo Asignación de servidor RADIUS a un módulo de seguridad
(Página 498). En los ajustes de seguridad locales se muestran las propiedades
configurables del servidor RADIUS.
4. Introduzca en la entrada "General" de los ajustes de seguridad locales los datos siguientes:
Parámetro

Significado

Nombre

Nombre del servidor RADIUS.
El nombre puede tener como máximo 25 caracteres. Pueden
utilizarse los caracteres 0-9, a-z, A-Z, -._. Un nombre debe
empezar con una letra y terminar con una letra o un número.
Antes del carácter '.' solo se permiten letras y números, y
después del carácter '.' solo letras. Antes y después del ca‐
rácter '_' o '-' solo se permiten letras y números.

Dirección IP / FQDN

Dirección IP o FQDN del servidor RADIUS.

Puerto

Puerto UDP bajo el que es accesible el servidor RADIUS. De
forma predefinida se reciben datos de autenticación en el
puerto 1812.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

497

Configuración de dispositivos y redes
1.3 Configurar redes
Parámetro

Significado

Shared Secret

Introducción de la contraseña utilizada para la encriptación al
transferir los datos de inicio de sesión entre servidores RA‐
DIUS y módulos de seguridad.
Se admiten los siguientes caracteres del juego ANSI X
3.4-1986:
0123456789
A...Z a...z
!#$%&()"*'+`,-./:;<=>?@ [\]_{|}~^
Longitud del Shared Secret: 1 ... 32 caracteres

Repetir Shared Secret

Confirmación de la contraseña.

Método de autenticación

Indicación del método utilizado para comprobar los datos de
usuario. Se soporta exclusivamente el método "PAP" (Pass‐
word Authentication Protocol).

Intentos de repetición

Introduzca aquí el número máximo de repeticiones de un in‐
tento de solicitud. El intento de conexión inicial se repetirá el
número de veces indicado por este valor antes de consultar a
otro servidor RADIUS configurado o dar por fallido el inicio de
sesión. El ajuste predeterminado son 3 repeticiones, es decir,
4 intentos de conexión. El rango de valores es de 1 a 5.

Comentario

Introducción opcional de comentarios.

Resultado
Ha definido un servidor RADIUS y ahora lo puede asignar a los módulos de seguridad
deseados. Observe las descripciones del capítulo siguiente:
Asignación de servidor RADIUS a un módulo de seguridad (Página 498)

Asignación de servidor RADIUS a un módulo de seguridad
Requisitos
Ha definido un servidor RADIUS.

Procedimiento
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales, elija la entrada "RADIUS".
3. Active la casilla de verificación "Activar autenticación RADIUS".
Nota
Cambio del método de autenticación con servidor web en módulo de seguridad
Cuando se activa la autenticación RADIUS en el módulo de seguridad, cambia el método
de autenticación con el servidor web de "Digest Access Authentication" a "Basic Access
Authentication".

498

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
4. En el campo de entrada "Timeout RADIUS", indique el tiempo en segundos que el módulo
de seguridad debe esperar como máximo a una respuesta del servidor RADIUS.
5. En el campo de entrada "Repeticiones RADIUS", indique el número de intentos de conexión
con el servidor RADIUS.
6. Active la casilla de verificación "Permitir la autenticación RADIUS de usuarios no
configurados" cuando se haya asignado una función en lugar de un usuario al conjunto de
reglas IP personalizado que se desea activar.
7. Active la casilla de verificación "Se necesita ID de filtro para la autenticación" cuando la
función asignada sea una función definida por el usuario.
8. En la lista desplegable "Nombre", en la entrada "Servidor RADIUS", elija el servidor
RADIUS que desee asignar al módulo de seguridad.
Como alternativa, puede asignar los módulos de seguridad para los cuales está activada la
autenticación RADIUS a los servidores RADIUS en las funciones de seguridad globales.
Encontrará información general sobre la autenticación mediante servidor RADIUS en el
siguiente capítulo:
AUTOHOTSPOT

Crear cortafuegos
Reglas de cortafuegos locales para módulos SCALANCE S
Configurar un cortafuegos con reglas predefinidas
Configurar un cortafuegos con reglas IP predefinidas
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Cortafuegos".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

499

Configuración de dispositivos y redes
1.3 Configurar redes

Cortafuegos activado de forma predeterminada
La casilla de verificación "Activar cortafuegos" está activada de forma predeterminada. Así, el
cortafuegos está activado automáticamente y todos los accesos de externa al módulo de
seguridad están bloqueados. Habilite las reglas de cortafuegos para los distintos sentidos
activando las casillas de verificación correspondientes.
Nota
Ajustes de cortafuegos detallados en el modo de cortafuegos avanzado
En el modo de cortafuegos avanzado, las reglas de cortafuegos pueden limitarse a dispositivos
determinados. Para cambiar al modo de cortafuegos avanzado, active la casilla de verificación
"Activar cortafuegos en modo avanzado". Para más información sobre el modo de cortafuegos
avanzado consulte el capítulo:
Resumen de reglas de cortafuegos locales (Página 393).

Configuración de cortafuegos con VPN
Si el módulo de seguridad está en un grupo VPN, la casilla de verificación "Solo comunicación
tunelada" está activada de forma predeterminada. Lo que significa que a través de la interfaz
externa o la interfaz DMZ solo está permitida la transferencia de datos IPsec encriptada. Solo
se sigue permitiendo el accedo HTTPS sin túnel al módulo (TCP-Port 443).
Si se desactiva esta casilla de verificación, se permitirá la comunicación tunelada y,
adicionalmente, los tipos de comunicación seleccionados en las otras casillas de selección.
Tabla 1-57
Servicio

Reglas de cortafuegos y direcciones disponibles
De inter‐ De exter‐
na a exter‐ na a in‐
na
terna

De interna a
DMZ

De DMZ a in‐
terna

Puertos permiti‐ Significado
dos

Permitir co‐
municación
IP

x

x

x

x

-

Se permite la comunicación IP para
los sentidos de comunicación se‐
leccionados.

Permitir pro‐
tocolo S7

x

x

x

x

Puerto TCP
102

Se permite la comunicación de los
dispositivos de red a través del pro‐
tocolo S7.

Permitir
FTP/FTPS
(modo explí‐
cito)

x

x

x

x

Puerto TCP 20

Para la administración de archivos
y el acceso a ellos entre servidor y
cliente.

Permitir
HTTP

x

x

x

x

Puerto TCP 80

Para la comunicación con un servi‐
dor web.

Permitir
HTTPS

x

x

x

x

Puerto TCP
443

Para la comunicación segura con
un servidor web, p. ej. diagnóstico
web.

Permitir
DNS

x

x

x

x

Puerto TCP 53

Se permite la conexión con un ser‐
vidor DNS.

500

Puerto TCP 21

Puerto UDP 53

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Servicio

Permitir
SNMP

De inter‐ De exter‐
na a exter‐ na a in‐
na
terna
x

De interna a
DMZ

De DMZ a in‐
terna

x

x

x

Puertos permiti‐ Significado
dos
Puerto TCP
161/162

Para vigilar dispositivos de red con
capacidad SNMP.

Puerto UDP
161/162
Permitir
SMTP

x

x

x

x

Puerto TCP 25

Para enviar correos electrónicos a
través de un servidor SMTP.

Permitir
NTP

x

x

x

x

Puerto UDP
123

Para la sincronización de la hora.

Permitir
DHCP

x

x

x

x

Puerto UDP 67

Solo en el modo de operación Brid‐
ge:
Se permite la comunicación con un
servidor DHCP.

Tabla 1-58

Puerto UDP 68

Registro

Opción

Acción en caso de activación

Registro de paquetes tune‐ Solo está activado si el módulo de seguridad forma parte de un grupo VPN. Se registran todos
lados
los paquetes IP transferidos a través del túnel.
Registro de paquetes en‐
trantes bloqueados

Se registran todos los paquetes IP entrantes que se rechazan.

Registro de paquetes sa‐
lientes bloqueados

Se registran todos los paquetes IP salientes que se rechazan.

Los paquetes registrados se pueden consultar en la entrada "Registros de filtrado de
paquetes" del cuadro de diálogo "Online y diagnóstico". Encontrará más información al
respecto en el apartado Registrar paquetes de datos - Entrada "Registros de filtrado de
paquetes" (Página 473).

Configurar un cortafuegos con reglas MAC predefinidas
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Cortafuegos".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

501

Configuración de dispositivos y redes
1.3 Configurar redes

Cortafuegos activado de forma predeterminada
La casilla de verificación "Activar cortafuegos" está activada de forma predeterminada. Así, el
cortafuegos está activado automáticamente y todos los accesos de externa al módulo de
seguridad están bloqueados. Habilite las reglas de cortafuegos para los distintos sentidos
activando las casillas de verificación correspondientes.
Nota
Ajustes de cortafuegos detallados en el modo de cortafuegos avanzado
En el modo de cortafuegos avanzado, las reglas de cortafuegos pueden limitarse a dispositivos
determinados. Para cambiar al modo de cortafuegos avanzado, active la casilla de verificación
"Activar cortafuegos en modo avanzado". Para más información sobre el modo de cortafuegos
avanzado consulte el capítulo Resumen de reglas de cortafuegos locales (Página 393).

Configuración de cortafuegos con VPN
Si el módulo de seguridad está en un grupo VPN, la casilla de verificación "Solo comunicación
tunelada" está activada de forma predeterminada.
Si se desactiva esta casilla de verificación, se permitirá la comunicación tunelada y,
adicionalmente, los tipos de comunicación seleccionados en las otras casillas de selección.

Reglas MAC y sentidos disponibles
Servicio

De interna a externa

De externa a interna

Permitir comunicación
MAC

x

x

Se permite el tráfico MAC para los sentidos de
comunicación seleccionados.

Permitir protocolo ISO

x

x

Se permite el tráfico ISO para los sentidos de
comunicación seleccionados.

Permitir SiClock

x

x

Se permiten los telegramas horarios SiClock
para los sentidos de comunicación selecciona‐
dos.

Permitir DCP

x

x

Se permite el tráfico DCP para asignar direc‐
ciones IP para los sentidos de comunicación
seleccionados.

Tabla 1-59

502

Significado

Registro

Opción

Acción en caso de activación

Registro de paquetes tunelados

Solo está activado si el módulo de seguridad forma parte de un
grupo VPN. Se registran todos los paquetes MAC transferidos a
través del túnel.

Registro de paquetes entrantes
bloqueados

Se registran todos los paquetes MAC entrantes que se rechazan.

Registro de paquetes salientes
bloqueados

Se registran todos los paquetes MAC salientes que se rechazan.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Conjuntos de reglas IP específicos del usuario
Sinopsis
Significado
En primer lugar se asignan uno o varios usuarios a los conjuntos de reglas IP personalizados.
A continuación se asignan los conjuntos de reglas IP personalizados a uno o varios módulos
de seguridad. De ese modo es posible permitir accesos personalizados. Si, p. ej. están
bloqueados de forma predeterminada todos los accesos a las redes situadas después de un
módulo de seguridad, podrán habilitarse determinados dispositivos para un usuario mediante
sus direcciones IP. El usuario tiene así el acceso permitido, mientras que este permanece
bloqueado para otros usuarios.

Inicio de sesión del usuario a través de Internet
El usuario puede iniciar sesión a través de la página web del módulo de seguridad en la interfaz
externa o de la interfaz DMZ del módulo de seguridad. Si la autenticación es correcta se activa
el conjunto de reglas IP definido para el usuario en relación a la dirección IP del dispositivo
desde el que se ha realizado el inicio de sesión.
La conexión con la página web del módulo de seguridad se realiza vía HTTPS utilizando la
dirección IP del puerto enlazado y observando las reglas de enrutamiento aplicables:
Ejemplo:
Interfaz externa: 192.168.10.1
La página de inicio de sesión se abre mediante: https://192.168.10.1/
Pueden iniciar sesión usuarios con cualquier función, siempre que el usuario o la función estén
asignados a un conjunto de reglas IP personalizado.

Posibilidades de autenticación del usuario
En función del método de autenticación que se seleccionara al crear el usuario que inicia la
sesión en el módulo de seguridad, la autenticación se realiza mediante diferentes instancias:
● Método de autenticación "Contraseña": el módulo de seguridad realiza la autenticación.
● Método de autenticación "RADIUS": un servidor RADIUS realiza la autenticación (solo
SCALANCE S V4 o superior)

Asignación de funciones a conjuntos de reglas IP personalizados
En los módulos SCALANCE S V4 o superior también se pueden asignar conjuntos de reglas
IP personalizados a los que se han asignado funciones. Esto permite habilitar un grupo de
usuarios para el acceso a determinadas direcciones IP.
Si se utiliza un servidor RADIUS para la autenticación del usuario y se asigna una función al
conjunto de reglas IP personalizado, el servidor RADIUS también puede autenticar usuarios
no configurados en el módulo de seguridad. Estos usuarios deben estar guardados en el
servidor RADIUS o en otra base de datos, donde se les debe haber asignado la función que

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

503

Configuración de dispositivos y redes
1.3 Configurar redes
tenga asignada el conjunto de reglas IP personalizado en STEP 7. Este procedimiento ofrece
la ventaja de que todos los datos de usuario se guardan únicamente en el servidor RADIUS.
Encontrará más información sobre la autenticación mediante el servidor RADIUS en el
siguiente capítulo:
AUTOHOTSPOT

Los conjuntos de reglas IP personalizados se utilizan localmente - Convenios
Rigen los mismos convenios que los descritos en el capítulo siguiente:
Conjuntos de reglas de cortafuegos globales - Convenios (Página 365)

Crear y asignar conjuntos de reglas IP específicos del usuario
Crear conjuntos de reglas IP personalizados
1. En las funciones de seguridad globales elija la entrada "Cortafuegos" > "Conjuntos de
reglas IP personalizados" > "Conjuntos de reglas IP".
2. Haga doble clic en la entrada "Agregar nuevo conjunto de reglas IP" para crear un conjunto
de reglas IP personalizado.
Resultado: debajo de la entrada se muestra el conjunto de reglas IP personalizado que se
ha creado anteriormente.
3. Haga doble clic en el conjunto de reglas IP personalizado que se ha creado.
Resultado: En la ficha "Propiedades" > "General" de la ventana de inspección se muestran
las propiedades configurables del conjunto de reglas IP personalizado.
4. Haga clic en la entrada "General" de la ventana de inspección e introduzca los datos
siguientes:
– Nombre: designación unívoca del conjunto de reglas para todo el proyecto. El nombre
aparece en la lista de reglas local del módulo de seguridad tras la asignación del
conjunto de reglas.
– Descripción (opcional): introduzca una descripción del conjunto de reglas IP
personalizado.
5. Haga clic en la entrada "Reglas IP" e introduzca las reglas de cortafuegos en la lista por
orden.
El campo "Dirección IP de origen" no admite direcciones IP. Esta se introducirá
automáticamente cuando el dispositivo inicie sesión en el módulo de seguridad.
La casilla de verificación "Stateful" no puede desactivarse para reglas IP de conjuntos
personalizados.
Observe la descripción de parámetros de los capítulos siguientes:
Definir reglas de filtrado de paquetes IP (Página 395)
Tenga en cuenta las particularidades de las reglas de cortafuegos generadas
automáticamente por STEP 7 para reglas NAT/NAPT:
Relación entre router NAT/NAPT y cortafuegos personalizado (Página 512)

504

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Crear localmente usuarios RADIUS y funciones RADIUS
Además de los usuarios y las funciones definidos por el sistema, existe la posibilidad de crear
localmente usuarios RADIUS y funciones RADIUS:
1. Haga clic en la entrada "Usuarios y funciones" de la ventana de inspección.
2. En el área "Usuarios y funciones disponibles", seleccione la entrada "<Crear usuario/
función RADIUS>".
3. Introduzca un nombre.
4. Seleccione si el nombre debe asignarse como usuario o como función.
5. Haga clic en el botón "Crear".
El usuario creado o la función creada se muestran en la lista de usuarios y funciones
disponibles y pueden asignarse a un conjunto de reglas IP personalizado.

Borrar usuarios y funciones
La entrada solo puede borrarse si no está asignada a ningún otro conjunto de reglas IP
personalizado.
Para borrar usuarios y funciones, proceda del siguiente modo:
1. Seleccione la entrada que desea borrar.
2. En el menú contextual, elija el comando "Borrar" o pulse la tecla <Supr>.

Asignar conjuntos de reglas IP personalizados
1. Haga clic en la entrada "Usuarios y funciones" de la ventana de inspección.
2. En el área "Usuarios y funciones disponibles", seleccione los usuarios o las funciones que
desee asignar al conjunto de reglas IP personalizado.
3. Haga clic en el botón "<<" para asignar los usuarios o funciones seleccionados al conjunto
de reglas IP personalizado. La asignación de funciones a conjuntos de reglas IP
personalizados solo es posible en módulos SCALANCE S versión V4 o superior.
4. Asigne el conjunto de reglas IP personalizado que se ha creado a los módulos de seguridad
deseados mediante la entrada "Asignar juego de reglas IP personalizado" en las funciones
globales de seguridad. El modo de cortafuegos avanzado debe estar activado para los
módulos de seguridad.
Nota
Asignación de conjuntos de reglas IP personalizados
● Solo se puede asignar a un módulo de seguridad un conjunto de reglas IP personalizado
por usuario.
● Con la asignación se activa, de forma implícita para todos los usuarios o funciones
asignados al conjunto de reglas IP, el derecho para iniciar sesión en el módulo de
seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

505

Configuración de dispositivos y redes
1.3 Configurar redes

Rango de valores para una duración máxima de sesión
Duración máxima de la sesión de un usuario en un dispositivo. Pasado el tiempo se cerrará la
sesión del usuario en el dispositivo.
● Ajuste estándar: 30 minutos
● Valor mínimo: 5 minutos
● Valor máximo: 480 minutos

Resultado
● El conjunto de reglas IP personalizado es utilizado como conjunto de reglas local por los
módulos de seguridad y aparece automáticamente en la lista local de reglas de cortafuegos.
● El usuario puede iniciar sesión en el módulo de seguridad. La autenticación del usuario se
realiza mediante el módulo de seguridad o un servidor RADIUS, en función del método de
autenticación ajustado.

Sentidos de filtrado de paquetes IP SCALANCE S
Significado
Posibilidades de selección para los sentidos de comunicación "De" y "A" en las reglas IP del
modo de cortafuegos avanzado.

506

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Se dispone de los sentidos siguientes:
Posibilidades de selección / Rangos de valo‐
res
De

A

Interna

Externa

Túnel

Any

DMZ

Módulo de seguridad
S602

S61x

S623 / S627-2M

Externa

x

x

x

Túnel

-

x

x

Any

-

x

x

DMZ

-

-

x

Interna

x

x

x

Interna

x

x

x

Any

-

-

x

Túnel

-

-

x

DMZ

-

-

x

Interna

-

x

x

Externa

-

x

x

DMZ

-

-

x

Interna

-

x

x

Externa

-

-

x

DMZ

-

-

x

Interna

-

-

x

Externa

-

-

x

Any

-

-

x

Túnel

-

-

x

x = posibilidad de configurar el sentido de la comunicación
- = no es posible configurar el sentido de la comunicación

Sentidos de filtrado de paquetes MAC SCALANCE S
Significado
Posibilidades de selección para los sentidos de comunicación "De" y "A" en las reglas MAC del
modo de cortafuegos avanzado.

Se dispone de los sentidos siguientes:
Posibilidades de selección / Rangos de valo‐
res
De

A

Interna

Módulo de seguridad
S602

S61x

S623 / S627-2M

Externa

x

x

x

Túnel

-

x

x

Any

-

x

x

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

507

Configuración de dispositivos y redes
1.3 Configurar redes
Posibilidades de selección / Rangos de valo‐
res
Externa

Túnel
Any

Módulo de seguridad

Interna

x

x

x

Any

-

-

x

Túnel

-

-

x

Interna

-

x

x

Externa

-

x

x

Interna

-

x

x

Externa

-

-

x

x = posibilidad de configurar el sentido de la comunicación
- = no es posible configurar el sentido de la comunicación

Adaptar reglas estándar para servicios IP
Requisitos
Esta función solo está disponible en el modo de cortafuegos avanzado.

Cómo se accede a esta función
1. Seleccione el módulo de seguridad que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Cortafuegos" > "Reglas estándar para
servicios IP".

Significado de los ajustes avanzados
Parámetro

Significado en la activación

Utilizar opciones de estado ampliadas

Se limita el número de conexiones y estados del cortafuegos
admisibles por unidad de tiempo. Si un dispositivo de red
rebasa este límite, su dirección IP se incluye en la lista negra
de IP del módulo de seguridad. En este caso, el dispositivo ya
no puede volver a comunicarse a través del módulo de se‐
guridad. La lista negra de IP del módulo de seguridad puede
verse en el modo online.

Registrar todas las reglas activadas

Se registran los paquetes permitidos según las reglas están‐
dar para los servicios IP.

Habilitar test ICMP para interfaces

Las solicitudes ping que entran en una interfaz del módulo de
seguridad pueden transferirse a otras interfaces. De este mo‐
do, desde la red externa pueden realizarse por ejemplo soli‐
citudes ping a la interfaz interna del módulo de seguridad.

508

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Reglas de cortafuegos estándar para SCALANCE S
En la tabla siguiente se listan las reglas de cortafuegos estándar para los módulos SCALANCE
S. En parte, las reglas de cortafuegos solo están activas cuando se utiliza el servicio
correspondiente en el módulo de seguridad (p. ej. SNMP).
Servicio

Sentido

Re-enrutamiento por interfaz

saliente

Interfaz X1
(roja)

HTTPS

Interfaz X2
(verde)

Interfaz X3
(amarilla)
(solo para
S623,
S627-2M)

Interfaz de tú‐
nel* (no para
S602)

-

x

-

-

x

x*

x

x

entrante

-

x

-

x

saliente
ICMP Pathfinder (solo para
SCALANCE S602 V3.1 o supe‐
rior en modo Ghost)

-

x

-

-

SNMP

entrante

x

x

x

x

Syslog

saliente

x

x

x

x

NTP

saliente

x

x

x

x

DNS

saliente

x

x

x

x

HTTP

saliente

x

-

x

-

x

-

x

-

x

-

x

-

-

x

x

-

ICMP

VPN (IKE)
VPN (NAT Traversal)
Servidor BootP

entrante

Cliente BootP

saliente

-

x

x

-

RADIUS

saliente

x

x

x

x

CARP (solo para SCALANCE
S62x V4 o superior)

saliente

x*

x*

-

-

Pfsync (solo para SCALANCE
S62x V4 o superior)

saliente

-

-

x*

-

x activado de forma predeterminada
- desactivado de forma predeterminada
* no puede adaptarse

Módulo SCALANCE S como router
Definir rutas
Significado
Indicación de rutas para el direccionamiento de subredes a las que no puede accederse
directamente desde el módulo de seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

509

Configuración de dispositivos y redes
1.3 Configurar redes

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Enrutamiento".
3. Haga doble clic en la entrada "Agregar nuevo" de la tabla para agregar una ruta.
4. Introduzca los valores siguientes:
Parámetro

Función

Valor de ejemplo

ID de red

Las solicitudes a dispositivos de la subred con la ID de 192.168.11.0
red indicada aquí y la máscara de subred indicada se
envían a la subred por la dirección IP de router indicada.
A partir de la ID de red y de la máscara de subred, el
router reconoce si una dirección de destino está en la
subred o fuera de ella.
La ID de red indicada no puede estar en la misma subred
que la dirección IP del módulo de seguridad.

Máscara de subred

La máscara de subred estructura la red. A partir de la ID
de red y de la máscara de subred, el router reconoce si
una dirección de destino está en la subred o fuera de
ella.

255.255.255.0

Dirección IP del rou‐
ter

Dirección IP del router a través del que se accede a la
subred. Para módulos SCALANCE S versión V4 o su‐
perior también existe la posibilidad alternativa de intro‐
ducir un FQDN.

192.168.10.2

La dirección IP indicada para el router debe estar en la
misma subred que la dirección IP del módulo de seguri‐
dad.
Activar re-enruta‐
miento (solo para
SCALANCE S V3 o
superior)

Active esta casilla de verificación si los telegramas de la
ruta introducida deben entrar y salir por la misma inter‐
faz del módulo de seguridad (re-enrutamiento). El re-en‐
rutamiento solo es soportado por la interfaz interna del
módulo de seguridad.

Conversión de direcciones con NAT/NAPT en túneles VPN
Función específica del módulo
La conversión de direcciones con NAT/NAPT en túneles VPN solo está disponible para
módulos SCALANCE S612/S623/S627-2M versión V4 o superior.

Significado
La conversión de direcciones con NAT/NAPT también se puede realizar para relaciones de
comunicación establecidas a través de túneles VPN.

510

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Requisitos
Los módulos SCALANCE S que tengan que ejecutar una conversión de direcciones con NAT/
NAPT en un túnel VPN deben cumplir de forma general los siguientes requisitos:
● El módulo SCALANCE S forma parte de un grupo VPN.
● El módulo SCALANCE S se encuentra en el modo de enrutamiento y/o la interfaz DMZ del
módulo SCALANCE S está activada.
● La interfaz de túnel está activada.
● El modo de cortafuegos avanzado está activado.
● El cortafuegos del editor para reglas IP está activado.

Sentidos de conversión de direcciones soportados
Se soportan los sentidos de conversión de direcciones descritos en el siguiente capítulo:
Enrutamiento NAT/NAPT (Página 413)

Acciones de conversión de direcciones soportadas
Las relaciones de comunicación tuneladas admiten las siguientes acciones de conversión de
direcciones:
● Destination-NAT ("Redirect")
● Source-NAT ("Masquerading")
● Source y Destination-NAT ("NAT 1:1")
● NAPT ("Portforwarding")
Encontrará información básica sobre estas acciones de conversión de direcciones en el
capítulo siguiente:
Enrutamiento NAT/NAPT (Página 413)

Acoplamientos VPN soportados
En combinación con NAT/NAPT, se soportan los siguientes acoplamientos VPN:
Acoplamiento VPN

Conexión VPN iniciada por

Conversión de direcciones
realizada por

SCALANCE S (a)

SCALANCE S (b)

SCALANCE S (a) o SCALAN‐ SCALANCE S (a) y/o SCA‐
CE S (b)
LANCE S (b)

SCALANCE S

CP 343-1 Adv. / 443-1 Adv. /
PC-CP

SCALANCE S o CP 343-1
Adv. / 443-1 Adv. / PC-CP

SCALANCE S

SCALANCE S

SCALANCE M

SCALANCE M

SCALANCE S y/o SCALAN‐
CE M*

SOFTNET Security Client

SCALANCE S

SOFTNET Security Client

SCALANCE S

* Solo se soporta NAT 1:1.
Los módulos SCALANCE S de los tipos SCALANCE S623 V4 y SCALANCE S627-2M V4 que
tienen un punto final VPN en la interfaz externa y en la interfaz DMZ pueden realizar
conversiones de direcciones en ambas interfaces de forma simultánea.
Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

511

Configuración de dispositivos y redes
1.3 Configurar redes

Comportamiento de conversión de direcciones en caso de participación en varios grupos VPN
Si un módulo SCALANCE S participa en varios grupos VPN, las reglas de conversión de
direcciones configuradas para la interfaz de túnel del módulo SCALANCE S son válidas para
todas las conexiones VPN de este módulo SCALANCE S.
Tenga en cuenta lo siguiente: en cuanto haya configurado una conversión de direcciones NAT
en o desde el sentido túnel, ya solo podrá acceder a las direcciones IP implicadas de las reglas
de conversión de direcciones NAT mediante el túnel VPN.

Relación entre router NAT/NAPT y cortafuegos personalizado
Función específica del módulo
La configuración de reglas NAT/NAPT en el cortafuegos personalizado solo está disponible
para módulos SCALANCE S versión V3 o superior.

Significado
Tras crear reglas NAT/NAPT en el cortafuegos personalizado, STEP 7 genera
automáticamente un conjunto de reglas IP personalizado que habilita la comunicación en el
sentido de conversión de direcciones configurado. Puede asignar a este conjunto de reglas IP
personalizado uno o varios usuarios y/o una o varias funciones (solo para módulos
SCALANCE S V4 o superior).
Las reglas de cortafuegos generadas pueden desplazarse y ampliarse si es necesario
(direcciones IP adicionales, servicios, velocidad de transmisión). Los parámetros de
cortafuegos generados por STEP 7 no pueden adaptarse. Si el conjunto de reglas IP
personalizado se asigna a un módulo de seguridad con NAT/NAPT desactivado, las reglas
NAT/NAPT del cortafuegos personalizado tampoco se aplican a este módulo de seguridad.
Nota
Las acciones de conversión de direcciones "Source-NAT + Destination-NAT" y "Double-NAT"
no son compatibles con el cortafuegos personalizado.

Cómo se accede a esta función
Entrada "NAT" o "NAPT" del editor para conjuntos de reglas IP personalizados, véase el
capítulo siguiente:
Crear y asignar conjuntos de reglas IP específicos del usuario (Página 504)

Sentidos de conversión de direcciones soportados para la acción "Source-NAT"
La acción "Source-NAT" puede ejecutarse en los siguientes sentidos:
● De externa a DMZ
● De DMZ a externa

512

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
En el campo "Dirección IP de origen" no puede introducirse ninguna dirección IP. Se
introducirá automáticamente cuando el dispositivo inicie sesión en el módulo de seguridad.

Sentidos de conversión de direcciones soportados para la acción "Destination-NAT"
La acción "Destination-NAT" puede ejecutarse en los siguientes sentidos:
● De externa a interna
● De externa a DMZ
● De DMZ a interna
● De DMZ a externa
● De túnel a interna (solo para SCALANCE S612/S623/S627-2M V4 o superior)
● De túnel a externa (solo para SCALANCE S612/S623/S627-2M V4 o superior)
● De túnel a DMZ (solo para SCALANCE S612/S623/S627-2M V4 o superior)

Sentidos de conversión de direcciones soportados para NAPT
La conversión de direcciones con NAPT puede ejecutarse en los siguientes sentidos:
● De externa a interna
● De externa a DMZ
● De DMZ a interna
● De DMZ a externa
● De túnel a interna (solo para SCALANCE S612/S623/S627-2M V4 o superior)
● De túnel a externa (solo para SCALANCE S612/S623/S627-2M V4 o superior)
● De túnel a DMZ (solo para SCALANCE S612/S623/S627-2M V4 o superior)

Conversión de direcciones NAT/NAPT y conjuntos de reglas IP personalizados correspondientes
En las reglas de cortafuegos para conjuntos de reglas IP personalizados que se generan sobre
la base de reglas NAT/NAPT no es posible introducir ninguna dirección IP en el campo
"Dirección IP de origen". Se introducirá automáticamente cuando el dispositivo inicie sesión en
el módulo de seguridad. Las demás propiedades son idénticas a las reglas de cortafuegos que
se generan localmente para módulos de seguridad individuales. Consulte el capítulo:
Relación entre router NAT/NAPT y cortafuegos (Página 425)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

513

Configuración de dispositivos y redes
1.3 Configurar redes

Módulo de seguridad como servidor DHCP
Resumen de servidor DHCP
Sinopsis
El módulo SCALANCE S puede utilizarse en la red interna y en la red DMZ como servidor
DHCP (DHCP = Dynamic Host Configuration Protocol). Esto permite asignar automáticamente
direcciones IP a los equipos conectados a la red interna o a la red DMZ.
Ambas interfaces pueden funcionar en modo servidor DHCP simultáneamente (solo
SCALANCE S623/S627-2M).
Las direcciones IP se asignan en este caso dinámicamente desde una banda de direcciones
definida por el usuario, o bien se asigna una dirección IP a un equipo concreto conforme a sus
predeterminaciones. Si los dispositivos de la interfaz interna o DMZ deben obtener siempre la
misma dirección IP para la configuración del cortafuegos, la asignación de direcciones solo
puede ser estática a partir de la dirección MAC o de la ID de cliente.

Requisitos
Tiene que configurar los dispositivos en la red interna o DMZ de manera que obtengan la
dirección IP de un servidor DHCP.
Dependiendo del modo de operación, el módulo de seguridad transmite a los dispositivos de
la subred correspondiente una dirección IP del router predeterminado, o bien se tiene que
comunicar una dirección IP de router a los dispositivos de la subred.
● Se transmite la dirección IP del router
En los casos siguientes, el módulo de seguridad transmite a los dispositivos una dirección
IP de router a través del protocolo DHCP:
– El dispositivo está en la interfaz DMZ (solo SCALANCE S623/S627-2M)
El módulo de seguridad transmite en este caso la dirección IP propia como dirección IP
de router.
– El dispositivo está en la interfaz interna y el módulo de seguridad está configurado para
el modo de router
El módulo de seguridad transmite en este caso la dirección IP propia como dirección IP
de router.
– El dispositivo está en la interfaz interna y el módulo de seguridad no está configurado
para el modo de router, pero se ha indicado un router estándar en la configuración del
módulo de seguridad
El módulo de seguridad transmite en este caso la dirección IP del router estándar como
dirección IP de router.
● No se transmite la dirección IP del router
En estos casos tiene que introducir manualmente la dirección IP del router en los
dispositivos:
– El dispositivo está en la interfaz interna y el módulo de seguridad no está configurado
para el modo de router. Adicionalmente, en la configuración del módulo de seguridad no
se ha indicado ningún router estándar.

514

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Consulte también
Configurar un servidor DHCP (Página 515)

Configurar un servidor DHCP
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Servidor DHCP".
3. Seleccione para qué interfaz desea realizar los ajustes de DHCP.
4. Realice la asignación de direcciones. Para la configuración tiene las dos posibilidades
siguientes:
– Asignación de direcciones estática
A equipos con una dirección MAC o un Client-ID determinados se les asignan
direcciones predeterminadas para cada caso. Introduzca para ello estos dispositivos en
el campo de entrada "Asignación estática de direcciones" de la lista de direcciones.
– Asignación dinámica de direcciones
Los dispositivos cuya dirección MAC o ID de cliente no se haya indicado explícitamente
reciben una dirección IP cualquiera del rango de direcciones predeterminado. Para ello,
active la casilla de verificación "Dynamic IP address range". A continuación active el
área de direcciones en el área de entrada "Activar área dinámica de direcciones IP".
Nota
Asignación dinámica de direcciones - Comportamiento tras una interrupción de la alimentación
eléctrica
Tenga en cuenta que las direcciones IP asignadas dinámicamente no se almacenan si se
interrumpe la alimentación eléctrica. Tras restablecerse la alimentación eléctrica tiene que
cuidar por tanto de que todos los dispositivos soliciten de nuevo una dirección IP.
Por esta razón, solo debería prever la asignación dinámica de direcciones para los siguientes
dispositivos:
● dispositivos que se utilicen temporalmente en la subred (por ejemplo, equipos de
mantenimiento).
● dispositivos que en caso de una nueva solicitud transmitan al servidor DHCP como
"dirección preferida" una dirección IP anteriormente asignada (por ejemplo, estaciones de
PC).
Para los dispositivos permanentes se debe dar preferencia a la asignación estática de
direcciones indicando una ID de cliente o la dirección MAC.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

515

Configuración de dispositivos y redes
1.3 Configurar redes

Prueba de coherencia - reglas a considerar
Al realizar sus entradas debe tener en cuanta las reglas indicadas a continuación.
● Las direcciones IP asignadas en el campo de entrada "Asignación estática de direcciones"
de la lista de direcciones no deben estar en el área de las direcciones IP dinámicas.
● Las direcciones IP, direcciones MAC e IDs de cliente solo pueden aparecer una vez en la
tabla "Asignación estática de direcciones" (con referencia al módulo de seguridad).
● En el caso de las direcciones IP asignadas estáticamente, hay que indicar la dirección MAC
o la ID de cliente (nombre del equipo).
● El Client-ID es una secuencia de como máximo 63 caracteres. Solo se permiten los
caracteres siguientes: a-z, A-Z, 0-9 y - (guión).
Nota
En SIMATIC S7 es posible asignar a los dispositivos de la interfaz Ethernet una ID de cliente
para la referencia a una dirección IP a través de DHCP.
En PCs el procedimiento depende del sistema operativo utilizado; se recomienda utilizar la
dirección MAC para la asignación.
● En el caso de las direcciones IP asignadas estáticamente, hay que indicar la dirección IP.
● Las siguientes direcciones IP no deben estar en el rango correspondiente al área de
direcciones IP libres (direcciones IP dinámicas):
– Todas las direcciones IP de router de la entrada "Enrutamiento"
– Servidor Syslog
– Router estándar
– Dirección o direcciones del módulo de seguridad
● DHCP es soportado por el módulo de seguridad en la interfaz con la subred interna y en la
interfaz con la red DMZ. De este comportamiento del módulo de seguridad se derivan,
además, los siguientes requisitos para las direcciones IP en el área de la asignación
dinámica de direcciones:
– Modo Bridge
El área debe estar en la red definida por el módulo de seguridad.
– Modo de enrutamiento
El área debe estar en la subred interna definida por el módulo de seguridad.
Nota
La red DMZ representa siempre una subred separada. En caso de utilizar DHCP en la
interfaz DMZ, hay que tener en cuenta que el área de direcciones IP libre (direcciones
IP dinámicas) se encuentra dentro de la subred DMZ.
● El rango de direcciones IP libre se tiene que indicar por completo introduciendo la dirección
inicial y la dirección final. La dirección final debe ser más alta que la inicial.
● Las direcciones IP introducidas en el campo de entrada "Asignación estática de
direcciones" de la lista de direcciones tiene que estar en el área de direcciones de la subred
interna o de la subred DMZ del módulo de seguridad.

Consulte también
Realizar prueba de coherencia (Página 340)

516

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configurar Proxy ARP
Sinopsis
Proxy ARP permite a los routers responder a solicitudes ARP para hosts. Los hosts están en
redes separadas por routers, pero utilizan la misma área de direcciones IP.
Si PC1 envía una solicitud ARP a PC2, recibe del módulo de seguridad situado en medio, y no
del PC2, una respuesta ARP y la dirección de hardware de la interfaz (dirección MAC del
puerto del módulo de seguridad) en la que se recibió la solicitud. El PC1 solicitante envía
entonces sus datos al módulo de seguridad, que los transmite al PC2.

Cómo se accede a esta función
Esta función solo está disponible para la interfaz interna de un módulo de seguridad que forma
parte de un grupo VPN y está en modo Bridge.
1. Seleccione el módulo de seguridad que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Proxy ARP".
3. Si el módulo de seguridad debe responder a una solicitud ARP de la LAN propia en lugar
del interlocutor específico, introduzca la dirección IP correspondiente.

Túnel IPsec: crear y asignar grupos
Configurar nodos de red internos
Utilizar el modo de aprendizaje para aprender nodos internos
Buscar automáticamente dispositivos para la comunicación tunelada
Una gran ventaja para la configuración y el funcionamiento de la comunicación tunelada es que
los módulos SCALANCE S en modo Bridge pueden localizar por sí mismos los dispositivos en
la interfaz interna. Nuevos dispositivos son detectados por el módulo de seguridad durante el
funcionamiento. Los dispositivos detectados se notifican a los módulos de seguridad
pertenecientes al mismo grupo VPN. Con esto está garantizado en todo momento el
intercambio de datos en ambos sentidos dentro de los túneles de un grupo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

517

Configuración de dispositivos y redes
1.3 Configurar redes

Dispositivos detectables
Se detectan los siguientes nodos:
● Nodos de red aptos para IP
Se encuentran nodos de red aptos para IP si envían una respuesta ICMP al ICMP-SubnetBroadcast.
Nodos IP situados detrás de routers se pueden encontrar si los routers transmiten ICMPBroadcasts.
● Nodos de red ISO
Nodos de red que no sean aptos para IP, pero que a los que pueda accederse a través del
protocolo ISO, también se pueden programar por aprendizaje.
Condición para ello es que respondan a telegramas XID o TEST. TEST y XID (Exchange
Identification) son protocolos auxiliares para el intercambio de informaciones en el nivel
Layer 2. Enviando estos telegramas con una dirección Broadcast se pueden localizar estos
nodos de red.
● Nodos PROFINET
Con ayuda de DCP (Discovery and basic Configuration Protocol) se encuentran nodos
PROFINET.
Los nodos de red que no cumplan estos requisitos se tienen que configurar manualmente.
Las subredes que están detrás de routers internos también deben configurarse manualmente.

Cómo se accede a la función
1. Seleccione el módulo.
2. En los ajustes de seguridad locales elija la entrada "VPN" > "Nodos".

Activación y desactivación del modo de aprendizaje
La función de aprendizaje está activada por defecto en la configuración para cada módulo de
seguridad.
La programación por aprendizaje también se puede desactivar por completo para el
SCALANCE S. Entonces se tienen que configurar manualmente todos los nodos de red
internos que intervengan en la comunicación tunelada.

¿Cuándo es conveniente desactivar el modo de aprendizaje automático?
Los ajustes estándar para el módulo de seguridad parten de que las redes internas son
siempre seguras; esto significa también que normalmente no se conectan a la red interna
nodos de red que no sean dignos de confianza.
La desactivación del modo de aprendizaje puede ser conveniente si la red interna es estática,
es decir, si no cambian el número ni las direcciones de los nodos internos.
Con la desconexión del modo de aprendizaje se suprime en la red interna la carga que los
telegramas de programación por aprendizaje suponen para el medio y los nodos. También
aumentan en cierta medida las prestaciones del módulo de seguridad, ya que no tiene que
procesar los telegramas de programación por aprendizaje.

518

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Observación: En el modo de aprendizaje se registran todos los nodos de la red interna. Los
datos relativos a los recursos de la VPN se refieren solo a los nodos que se comuniquen en la
red interna a través de VPN.
Nota
Si en la red interna se utilizan más de 128 nodos internos, se sobrepasa con esto el alcance
admisible y se genera un estado operativo no permitido. Debido a la dinámica en el tráfico de
la red ocurre entonces que los nodos internos ya programados por aprendizaje son
reemplazados por nuevos nodos internos, hasta ahora desconocidos.

Consulte también
Configurar manualmente subredes internas (Página 520)

Configurar manualmente nodos de red IP
Significado
Como alternativa al modo de aprendizaje que se activa con la casilla de verificación "Permitir
aprendizaje de nodos internos" y con el que el módulo de seguridad aprende dinámicamente
los nodos de red internos, es posible introducir manualmente los nodos de red que deben
aprenderse en la entrada "Nodos IP internos" y, con ello, habilitar la comunicación por túnel
VPN. En este caso, la dirección MAC de un nodo de red es una entrada opcional.

Requisitos
● El módulo de seguridad está en modo Bridge.
● El módulo de seguridad forma parte de un grupo VPN.

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "VPN" > "Nodos" > "Nodos IP internos".

Configurar manualmente nodos de red MAC
Significado
Como alternativa al modo de aprendizaje que se activa con la casilla de verificación "Permitir
aprendizaje de nodos internos" y con el que el módulo de seguridad aprende dinámicamente
los nodos de red internos, es posible introducir manualmente los nodos de red que deben
aprenderse en la entrada "Nodos MAC internos" y, con ello, habilitar la comunicación por túnel
VPN.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

519

Configuración de dispositivos y redes
1.3 Configurar redes

Requisitos
● El módulo de seguridad está en modo Bridge.
● El módulo de seguridad forma parte de un grupo VPN.

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "VPN" > "Nodos" > "Nodos MAC
internos".

Configurar manualmente subredes internas
Requisitos
● El módulo de seguridad forma parte de un grupo VPN.

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "VPN" > "Nodos" > "Subredes internas".

Módulo de seguridad en modo Bridge - Entrada "Subredes internas"
Para habilitar manualmente subredes internas para la comunicación por túnel VPN hay que
introducir los siguientes parámetros de dirección:
Parámetros

Función

Valor de ejemplo

ID de red

ID de red de la subred para la que debe habilitarse la
comunicación por túnel VPN.

192.168.11.0

A partir de la ID de red y de la máscara de subred, el
router reconoce si una dirección de destino está en la
subred o fuera de ella.
No puede encontrarse en la misma subred que la direc‐
ción IP del módulo de seguridad.
Máscara de subred

La máscara de subred estructura la red. A partir de la ID
de red y de la máscara de subred, el router reconoce si
una dirección de destino está en la subred o fuera de
ella.

255.255.255.0

Dirección IP del rou‐
ter

Dirección IP del router a través del que se accede a la
subred que debe habilitarse.

192.168.10.2

Debe estar en la misma subred que la dirección IP del
módulo de seguridad.

520

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Módulo de seguridad en modo de enrutamiento - Entrada "Subredes accesibles por túnel"
En el modo de enrutamiento siempre se establecen túneles para subredes completas. Para
habilitar manualmente subredes internas accesibles por router, la subred externa o la subred
DMZ para la comunicación por túnel VPN hay que introducir los siguientes parámetros de
dirección:
Parámetro

Función

Valor de ejemplo

ID de red

ID de red de la subred para la que debe habilitarse la
comunicación por túnel VPN.

192.168.11.0

A partir de la ID de red y de la máscara de subred, el
router reconoce si una dirección de destino está en la
subred o fuera de ella.
Máscara de subred

La máscara de subred estructura la red. A partir de la ID
de red y de la máscara de subred, el router reconoce si
una dirección de destino está en la subred o fuera de
ella.

Comentario

Entrada de un comentario opcional adicional.

255.255.255.0

Redundancia de router y cortafuegos
Sinopsis
Significado
Gracias a la redundancia de router y cortafuegos es posible compensar automáticamente los
fallos de los módulos de seguridad SCALANCE S623 V4 o superior y SCALANCE S627-2M V4
o superior durante el funcionamiento. Para ello, reúna dos módulos de seguridad del tipo
SCALANCE S623 o SCALANCE S627-2M en una relación de redundancia activando la
redundancia de router y cortafuegos para ambos módulos de seguridad. Seguidamente,
determine cuál debe ser el módulo de seguridad pasivo en el funcionamiento normal de la
relación de redundancia (módulo secundario). Realice estos ajustes en el módulo de
seguridad activo en el funcionamiento normal de la relación de redundancia (módulo primario).
Si falla el módulo primario, el módulo secundario asumirá automáticamente su función como
cortafuegos y router (NAT/NAPT). Para garantizar una configuración idéntica de los dos
módulos de seguridad, estos se conectarán entre sí mediante sus interfaces DMZ, y su
configuración se sincronizará durante el funcionamiento. Las interfaces DMZ de los módulos
de seguridad correspondientes no pueden utilizarse para otros fines en este caso.

Redundancia de dirección
Además de sus respectivas direcciones IP de módulo, los dos módulos de seguridad
comparten en la interfaz externa e interna una dirección IP común en cada caso para que, en
caso de fallo de uno de los módulos de seguridad, no tengan que realizarse cambios en las
direcciones IP. Por ello, debe configurar una dirección IP para las interfaces externa e interna
de la relación de redundancia.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

521

Configuración de dispositivos y redes
1.3 Configurar redes

Efectos de las relaciones de redundancia en los módulos de seguridad
Al crear relaciones de redundancia entre los módulos de seguridad, algunas propiedades de
estos módulos se adaptan automáticamente para establecer la compatibilidad con la relación
de redundancia. Esta adaptación afecta a las propiedades siguientes:
Propiedades del módulo

Efecto en las propiedades del módulo

Modo de operación

En caso necesario, el modo de operación se ajusta a la op‐
ción "Modo de enrutamiento".

Miembros de los grupos VPN

En caso necesario, el módulo de seguridad se retira de los
grupos VPN correspondientes.

Configuración de interfaz

La interfaz externa y la interfaz DMZ del módulo de seguridad
se activan en caso necesario. El método se asignación IP
"Dirección estática" se configura, en su caso, para todas las
interfaces.

Configuración de los módulos de seguridad en las relaciones de redundancia
Después de activar la redundancia de router y cortafuegos para los módulos de seguridad y de
determinar el módulo primario de la relación de redundancia, una parte de las propiedades del
módulo se configura exclusivamente a través del módulo primario. Las propiedades
configuradas para el módulo primario se aplican a la relación de redundancia y no se pueden
configurar para el módulo secundario. Las siguientes propiedades se pueden configurar para
la relación de redundancia:
● Ajustes básicos de la relación de redundancia (módulo secundario, parámetros de red)
● Cortafuegos (las reglas estándar de los servicios IP se configuran por separado para cada
uno de los módulos de seguridad)
● Routing
● Enrutamiento NAT/NAPT (sin NAT 1:1)
El módulo primario adopta inicialmente los valores de las propiedades antes mencionadas
para la relación de redundancia.
Los ajustes que se indican a continuación también se configuran aparte para los módulos de
seguridad individuales tras su integración en una relación de redundancia. Por ello, la
configuración de estas propiedades para el módulo primario no tiene efectos sobre el módulo
secundario.
● Configuración de interfaz (no es posible desactivar las interfaces ni modificar el método de
asignación IP "Dirección estática").
● Reglas estándar para servicios IP (cortafuegos)
● DDNS
● Sincronización horaria
● Ajustes de registro
● SNMP
● RADIUS

522

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Nota
Cargar una configuración en módulos de seguridad de una relación de redundancia (solo
SCALANCE S623/S627-2M V4 o superior)
Las propiedades configuradas para el módulo primario en cuanto a una relación de
redundancia deben cargarse tanto en el módulo primario como en el secundario. Para cargar
la configuración debe utilizarse en cada caso la dirección IP física por la que la estación de
ingeniería puede acceder al módulo de seguridad. Las direcciones IP virtuales de la relación
de redundancia no pueden utilizarse para la carga.

Nota
Configuración del routing cuando se utiliza la redundancia de router y cortafuegos
En una relación de redundancia solo se sincronizan entre los módulos primario y secundario
aquellas informaciones de routing que se han configurado de forma estática en los ajustes de
seguridad locales del módulo primario, en la entrada "Routing". Las entradas de routing que se
generan dinámicamente debido al uso de routers estándar no se sincronizan. Por este motivo,
cuando se utiliza la redundancia de router y cortafuegos es recomendable configurar
estáticamente todas las rutas conocidas.

Establecimiento de relaciones de redundancia entre módulos de seguridad
Requisitos
Los módulos de seguridad SCALANCE S623/S627-2M V4 o superior no están asignados a
ninguna otra relación de redundancia.

Procedimiento
1. Seleccione el módulo de seguridad que debe estar activo (módulo primario) en el
funcionamiento normal.
2. En los ajustes de seguridad locales, elija la entrada "Redundancia de router y cortafuegos".
3. Active la casilla de verificación "Redundancia de router y cortafuegos".
4. En la lista desplegable "Módulo secundario", seleccione el módulo de seguridad que debe
estar pasivo en el funcionamiento normal.
Resultado: se ha establecido una relación de redundancia entre los módulos de seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

523

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración de relaciones de redundancia
Cómo se accede a esta función
1. Seleccione el módulo primario de la relación de redundancia.
2. En los ajustes de seguridad locales, elija la entrada "Redundancia de router y cortafuegos".

Configuración de los parámetros de red de la relación de redundancia
Parámetro configurable

Significado

Dirección IP

Dirección IP de la interfaz virtual externa o interna de la rela‐
ción de redundancia. La dirección IP debe estar en la subred
externa o interna del módulo primario.

Máscara de subred

Máscara de subred de la interfaz virtual externa o interna de
la relación de redundancia

Dirección MAC (solo adaptable para SCALANCE S623/
S627-2M V4.0.1 o superior)

Dirección MAC de la interfaz virtual externa o interna de la
relación de redundancia

Para obtener información general sobre la configuración de parámetros de red, consulte el
capítulo siguiente:
Configurar parámetros de dirección IP (Página 480)

Configuración del cortafuegos
La configuración de las reglas de filtrado de paquetes IP para las relaciones de redundancia se
realiza a través del módulo primario. Están disponibles los sentidos de comunicación "De
externa a interna" y "De interna a externa".
Para obtener información general sobre la configuración de las reglas de filtrado de paquetes
IP en el modo de cortafuegos avanzado, consulte el capítulo siguiente:
Definir reglas de filtrado de paquetes IP (Página 395)

Configuración de la conversión de direcciones con NAT/NAPT
La configuración de la conversión de direcciones con NAT/NAPT para la relación de
redundancia se realiza a través del módulo primario. Para relaciones de redundancia, solo se
pueden configurar Source-NAT y NAPT. En el caso de Source-NAT, las direcciones IP de
origen de la subred interna solo se pueden sustituir por la dirección IP externa virtual de la
relación de redundancia. No se pueden registrar direcciones IP alias en la interfaz externa de
la relación de redundancia. Con NAPT, solo se puede configurar el sentido de conversión de
direcciones "De externa a interna".
Para obtener información general sobre la configuración de conversiones de direcciones con
NAT/NAPT, consulte el capítulo siguiente:
Sinopsis de NAT/NAPT (Página 411)

524

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración del enrutamiento
La configuración de las rutas para la relación de redundancia se realiza a través del módulo
primario. Los routers estándar deben registrarse y ser idénticos por interfaz para ambos
módulos en la entrada "Interfaz externa [P1] roja" e "Interfaz interna [P2] verde".
Para obtener información general sobre la configuración del enrutamiento, consulte el capítulo
siguiente:
Definir rutas (Página 509)

Funciones online - Diagnóstico y registro
Sinopsis de las diferentes interfaces - Entrada "Ajustes de interfaz"
Significado
Tabla 1-60

Diagnóstico online: Entrada "Ajustes de interfaz"

Funciones de sistema y estado

Significado

Interfaces

Tabla arriba: sinopsis de las interfaces del módulo de se‐
guridad.
Tabla abajo: indicaciones sobre la interfaz que se opera
mediante PPPoE.
● Estado: indica si se ha establecido o no una conexión
con el Internet Service Provider (ISP).
● Dirección IP actual: dirección IP actual de la interfaz
● Pasarela: dirección IP de la pasarela
● Servicio DNS din. primario: Dirección IP del servicio
DNS din. primario
● Servicio DNS din. secundario: Dirección IP del
servicio DNS din. secundario
● Código de error (numérico) información sobre el error
en caso de que no se haya podido establecer una
conexión con el ISP.

CARP (solo para SCALANCE S623/
S627-2M V4 o superior)

● Interfaz CARP: indicación de la interfaz CARP virtual
● Interfaz física: Interfaz física en la que funciona la
interfaz CARP virtual (externa / interna).
● Estado: Indicación de cuál de los módulos de la
relación de redundancia está activo.
● Dirección MAC: dirección MAC de la interfaz CARP
virtual
● Preferente: Indicación de cuál de los módulos de la
relación de redundancia está configurado como
módulo primario.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

525

Configuración de dispositivos y redes
1.3 Configurar redes
Funciones de sistema y estado

Significado

Redundancia de medios (solo SCALANCE
S627-2M)

● Interfaz: Interfaz conectada al anillo MRP.
● Protocolo: protocolo utilizado (MRP)
● Puerto en anillo 1: Nombre del primer puerto de
módulo de medios de la interfaz que está conectado al
anillo MRP.
● Puerto en anillo 2: Nombre del segundo puerto de
módulo de medios de la interfaz que está conectado al
anillo MRP.
● Nombre de dominio: Nombre del dominio MRP.
● Discrepancia: Indica si el dominio del cliente es
distinto del del administrador de redundancia.
● UUID de dominio: UUID del dominio MRP.

Módulos de medios (solo SCALANCE
S627-2M)

● Puerto: ID del o los puertos de módulos de medios
● Nombre: nombre del módulo de medios
● MLFB: referencia del módulo de medios
● Revisión: versión del módulo de medios
● Discrepancia: Indica si hay diferencias entre los datos
de configuración en STEP 7 y los módulos de medios.

Vista general de los ajustes de DNS dinámico: entrada "DNS dinámico"
Significado
Tabla 1-61

Diagnóstico online: "DNS dinámico"

Funciones de sistema y estado

Significado

Estado de cliente

Indica si se ha establecido una conexión con el servidor DNS dinámico o no.

Dirección IP actual

Dirección IP WAN por la que se accede actualmente al módulo de seguridad.

Dirección IP definida

Dirección IP asignada actualmente al FQDN.

Hora actual

La hora actual.

Forzar la actualización

El módulo de seguridad determina la dirección IP actual de su acceso a Internet y
envía una petición de actualización al o los servidores de actualización configurados.
Así se publica la dirección IP actual en Internet. El estado se indica en los campos
Servicio DNS din. primario y secundario. De esta manera se comprueba p. ej. si son
correctos los datos configurados, como el nombre de usuario y la contraseña de la
cuenta DNS din..

Deshabilitar suspensión

Anula la suspensión (bloqueo en el módulo de seguridad para actualizaciones de
dirección IP en el proveedor de DNS din.), lo que significa que la contraseña de
proveedor de DNS din. se ha corregido o se ha eliminado el fallo ocurrido.

Servicio DNS din. primario y secundario
FQDN

Fully Qualified Domain Name registrado en el proveedor.

Dirección IP de servidor

Dirección IP del servidor de actualización utilizado.

Actualización satisfactoria

Actualización satisfactoria en el servicio de actualización DNS din.

Último intento de actualización

Último intento de actualización en el servicio de actualización DNS din.

526

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Funciones de sistema y estado

Significado

Última actualización fallida

Último error de actualización en el servicio de actualización DNS din.

Código de error

Estado de error del último intento de actualización fallido en la actualización DNS din.

Significado de los avisos
Los avisos del último intento de actualización DDNS tienen el significado siguiente:
Aviso

Significado

Satisfactoria
DDNS_OK

La solicitud de actualización ha sido satisfactoria.

Avisos de estado relativos a la conexión
DDNS_E_CON_UDP_SRV_RESOLV_ERR

DDNS_E_CON_UDP_SRV_UNREACHABLE
Avisos de estado relativos a la seguridad (error)
DDNS_E_CERT_SUBJECT_INVALID

DDNS_E_CERT_UNABLE_TO_GET_ISSUER_CERT

Nombre DNS del servidor de actualización desconoci‐
do, no se puede generar un FQDN a través del servidor
DNS conocido.
Servidor de actualización no accesible ("timeout").
El nombre común del sujeto en el certificado no coincide
con el nombre de dominio del servidor de actualización
o de su dirección IP.
Certificado del emisor no encontrado.
No se ha podido seguir la cadena de certificación hasta
la CA raíz porque no se ha encontrado un certificado de
emisor. La cadena de confianza está incompleta.

DDNS_E_CERT_SIGNATURE_INVALID

La firma de un certificado no ha podido leerse o no es
válida.

DDNS_E_CERT_NO_TRUST

Un certificado de la cadena de confianza no es válido,
es decir:
● Todavía no es válido o ha caducado ya
● Extensiones V3 no válidas
● Una extensión V3 crítica no es soportada

DDNS_E_CERT_DEPTH_ZERO_SELFSIGNED_CERT

El servidor de actualización ha suministrado un certifi‐
cado autofirmado y este certificado no está en la Certi‐
ficate Store para certificados de CA raíz dignos de con‐
fianza.

DDNS_E_CERT_SELF_SIGNED_CERT_IN_CHAIN

Se ha establecido la cadena de certificación utilizando
certificados no comprobados, pero no se ha encontrado
ningún certificado de CA raíz apropiado en la Certificate
Store para certificados dignos de confianza.

DDNS_E_CERT_CHAIN_TOO_LONG

La cadena de certificación excede la extensión de veri‐
ficación máxima soportada.

DDNS_E_CERT_INVALID_CA

Un certificado CA no es válido, es decir, ha caducado,
no es válido todavía o las extensiones V3 no son apro‐
piadas para el fin de utilización previsto (por ejemplo,
CA no en TRUE para certificados CA).

DDNS_E_CERT_KEYUSAGE_UNSUITED

El uso de clave de extensiones V3 o el uso de clave
extendida puestos en un certificado de la cadena de
confianza no es apto para la utilización del certificado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

527

Configuración de dispositivos y redes
1.3 Configurar redes
Aviso

Significado

DDNS_E_CERT_EXTENSION_UNSUPPORTED

Un certificado de la cadena de confianza utilizaba una
extensión marcada como crítica que no es soportada.

Avisos de estado relativos al agente (error)
DDNS_E_AGT_BAD_AGENT

● La solicitud de actualización no responde a la
estructura requerida por cRSP, por ejemplo, faltan
parámetros URL.
● La solicitud de actualización ha sido enviada a una
URL no permitida del servidor de actualización.
● El string de actualización configurado contiene
errores.

Visualización de la tabla ARP - Entrada "Tabla ARP"
Significado
Visualización de la tabla ARP del módulo de seguridad.
Tabla 1-62

Diagnóstico online: Ficha "Tabla ARP"

Funciones de sistema y estado

Significado

Tabla ARP

Indicación de las entradas estáticas (Proxy ARP) y
dinámicas de la tabla ARP en el módulo de segu‐
ridad. En la ficha "Tipo de publicación" se indica si
se trata de una entrada configurada estáticamente
o de una entrada aprendida.

Usuarios registrados en página web - Entrada "Usuarios dados de alta"
Significado
Visualización de los usuarios que han iniciado sesión en la página de Internet para conjuntos
de reglas IP personalizados.

528

Funciones de sistema y estado

Significado

Nombre de usuario

Nombre del usuario que ha iniciado sesión.

Dirección IP de origen

Dirección IP con la que el usuario ha iniciado sesión.

Tiempo de ejecución restante

Tiempo restante hasta que se cierre automáticamente la sesión
del usuario.

Duración máxima de la sesión

Tiempo total configurado para la sesión.

Cerrar sesión

Se cierra la sesión del usuario seleccionado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Visualización de la lista negra de cortafuegos - Entrada "Lista negra de cortafuegos"
Significado
Visualización de las direcciones IP de dispositivos que han superado el número permitido de
conexiones y estados de cortafuegos por tiempo. Estos dispositivos se registran en la lista
negra de IP del cortafuegos.
El número de conexiones y estados de cortafuegos por tiempo solo está limitado si en la
entrada "Reglas estándar para servicios IP" de los ajustes de seguridad locales está activada
la casilla de verificación "Utilizar opciones de estado ampliadas".
Si se hace clic en el botón "Borrar todo" se eliminan las direcciones IP visualizadas de la lista
negra de cortafuegos del módulo de seguridad. Además, dejarán de mostrarse las direcciones
IP.

Ajustar la fecha y hora - Entrada "Fecha y hora"
Cómo se accede a esta función
1. Seleccione el módulo de seguridad cuya hora y fecha deban comprobarse o ajustarse.
2. En el menú contextual, elija el comando de menú "Online y diagnóstico".
3. En el diagnóstico online elija la entrada "Funciones" > "Fecha y hora".

Hora local en el módulo de seguridad
En esta área se leen y ajustan la hora y la fecha del módulo de seguridad. Si se hace clic en
el botón "Aplicar" se asignan al módulo de seguridad la hora y fecha que están introducidas
actualmente en los campos de entrada "Fecha" y "Hora".

Hora local en el PC
En esta área se muestran la hora y fecha actuales del PC en el que está instalado STEP 7. Si
se hace clic en el botón "Aplicar al módulo" se asignan al módulo de seguridad la hora y fecha
actuales del PC.

Diagnóstico en modo Ghost: entrada "Modo Ghost"
Función específica del módulo
Esta función solo está disponible para SCALANCE S602 V3.1 o superior.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

529

Configuración de dispositivos y redes
1.3 Configurar redes

Significado
Visualización de datos de direcciones e información sobre los cambios de direcciones IP del
dispositivo interno.
Funciones de sistema y estado

Significado

Estado del SCALANCE S602

Indicación del estado en que se encuentra el módulo de se‐
guridad con relación al funcionamiento en modo Ghost.

Dirección IP

Dirección IP del dispositivo interno (idéntica a la dirección IP
externa del módulo de seguridad).

Máscara de subred

Máscara de subred del módulo de seguridad.

Dirección MAC

Dirección MAC del dispositivo interno.

Dispositivo encontrado el

Indicación de cuándo se ha detectado el dispositivo interno
del módulo de seguridad o de cuándo se ha realizado un
cambio de dirección IP en el dispositivo interno.

Número de cambios de dirección IP

Número de cambios de direcciones IP detectados por el mó‐
dulo de seguridad.

Dirección IP

Dirección IP en la red externa para la que el módulo de se‐
guridad requiere información de ruta.

Router estándar

Router estándar para la dirección IP de la red externa.

530

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Funciones de carga
Cargar una configuración
Cargar configuración / establecer conexión online
1. En la lista desplegable "Interfaz PG/PC" del cuadro de diálogo "Carga avanzada" o
"Conexión online", seleccione el adaptador de red a través del que desea acceder al
módulo.
2. Si el módulo se encuentra en el estado de suministro, proceda del siguiente modo:
– En la lista desplegable "Conexión con interfaz/subred", seleccione la interfaz del módulo
con la que está conectada su estación de ingeniería y para la que se ha configurado la
dirección IP a asignar en los ajustes de seguridad locales.
– Seleccione la opción "Mostrar todos los dispositivos compatibles" en la lista desplegable.
– Haga clic en el botón "Iniciar búsqueda".
– Resultado: El módulo se muestra en la tabla "Seleccionar dispositivo de destino" con la
dirección MAC detectada.
– Seleccione la entrada del módulo en la tabla y haga clic en el botón "Asignar dirección
IP".
– Resultado: se asigna al módulo la dirección IP que está configurada en los ajustes de
seguridad locales para la interfaz seleccionada.
3. Si el módulo no se encuentra en el estado de suministro, proceda del siguiente modo:
– En la lista desplegable "Conexión con interfaz/subred", seleccione la interfaz / dirección
FQDN / dirección WAN del módulo con la que la estación de ingeniería puede acceder
al módulo. A continuación, para acceder al módulo, STEP 7 utiliza la dirección que está
configurada en los ajustes de seguridad locales para el componente seleccionado.
– Si en la lista desplegable se selecciona la opción "Mostrar dispositivos con direcciones
idénticas", se mostrarán los dispositivos cuya dirección coincida con la del componente
seleccionado. Si se selecciona la entrada "Mostrar dispositivos compatibles", se
mostrarán los dispositivos cuyo tipo de módulo coincida con el del módulo seleccionado.
– Haga clic en el botón "Iniciar búsqueda".
– Resultado: en la columna "Dirección" de la tabla "Dispositivos compatibles en la subred
de destino" se muestra la dirección IP / FQDN detectada del módulo.
– Seleccione la entrada de la dirección en la tabla y haga clic en el botón "Cargar" o
"Conectar".
Configure preferentemente los módulos de un grupo a través de la red externa común de esos
módulos (interfaz X1). Si la estación de ingeniería se encuentra en una red interna, se tienen

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

531

Configuración de dispositivos y redes
1.3 Configurar redes
que habilitar explícitamente las direcciones IP de los demás módulos del grupo en el
cortafuegos de ese SCALANCE S y configurar luego el módulo en cuestión en primer lugar.
Nota
Carga de una configuración durante el funcionamiento en modo Ghost (solo SCALANCE S602
V3.1 o superior)
Cuando el módulo de seguridad funciona en modo Ghost, la interfaz externa del módulo de
seguridad adopta la dirección IP del dispositivo interno en el tiempo de ejecución. Antes de que
se pueda cargar una configuración nueva en el módulo de seguridad a través de la interfaz
externa, para la carga se debe indicar la dirección IP que el módulo de seguridad ha tomado
del dispositivo interno en el tiempo de ejecución.
Para averiguar cuál es la dirección IP actual del módulo de seguridad, se pueden buscar los
dispositivos accesibles en STEP 7 mediante el comando de menú "Online" > "Dispositivos
accesibles".
Nota
Cargar una configuración en módulos de seguridad de una relación de redundancia (solo
SCALANCE S623/S627-2M V4 o superior)
Las propiedades configuradas para el módulo primario en cuanto a una relación de
redundancia deben cargarse tanto en el módulo primario como en el secundario. Para cargar
la configuración debe utilizarse en cada caso la dirección IP física por la que la estación de
ingeniería puede acceder al módulo de seguridad. Las direcciones IP virtuales de la relación
de redundancia no pueden utilizarse para la carga.

Establecer una dirección diferente
En el cuadro de diálogo "Seleccionar dispositivo de destino" existe la posibilidad de indicar una
dirección IP / FQDN diferente a la dirección IP / FQDN de los ajustes de seguridad locales.
Para ello, introduzca en la celda editable de de la columna "Dirección" de la tabla la dirección
IP / FQDN del módulo. Después del proceso de carga el módulo de seguridad estará disponible
a través de la dirección IP / la dirección FQDN de los ajustes de seguridad locales.

Versión de firmware
La configuración de un módulo SCALANCE S puede cargarse también en un módulo
SCALANCE S cuya versión de firmware sea superior a la versión de firmware del módulo
SCALANCE S en STEP 7.

532

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Estado operativo
Se pueden cargar configuraciones durante el funcionamiento normal de los módulos
SCALANCE S. Para que sean eficaces los cambios realizados en una configuración debe
rearrancarse el módulo SCALANCE S.
Nota
Particularidades
● Mientras un módulo no haya ajustado todavía ningún parámetro IP (es decir, antes de la
primera configuración), no debe haber ningún router entre el módulo y el ordenador de
configuración.
● Si enchufa un PC de la interfaz interna a la externa del SCALANCE S, los accesos de este
PC al SCALANCE S se bloquearán durante un plazo de 20 minutos aproximadamente.

Estado de la configuración
Antes de realizar la carga, se comprueba la configuración existente en el módulo de seguridad
y se compara con la configuración del proyecto STEP 7 que debe cargarse. Si la configuración
del módulo proviene del proyecto STEP 7 que va a cargarse actualmente y existen diferencias
entre dichas configuraciones, existe la posibilidad de cargar en el módulo de seguridad
únicamente los archivos que presenten diferencias entre la configuración del módulo y la del
proyecto. En algunos casos, se puede acelerar así el proceso de carga.

Transferencia de firmware
Qué hay que tener en cuenta antes de transferir un firmware nuevo
Para la transferencia de un nuevo firmware a un módulo de seguridad se han de cumplir los
siguientes requisitos:
● Se poseen los derechos necesarios para transferir firmware, consulte el capítulo:
Particularidades de la administración de usuarios para funciones de seguridad
(Página 350).
● El módulo de seguridad está configurado con una dirección IP.

La transferencia es segura
La transferencia del firmware tiene lugar a través de una conexión segura, por lo que se puede
realizar también desde la red no protegida.
El propio firmware está firmado y codificado. Con esto se garantiza que solo se pueda cargar
firmware auténtico en el módulo SCALANCE S.

Rearranque completo necesario tras la transferencia
Un nuevo firmware cargado solo estará activo tras un rearranque completo del módulo
SCALANCE S. Si la trasferencia ha sufrido una perturbación y se ha cancelado, el módulo
vuelve a arrancar con la versión de firmware antigua.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

533

Configuración de dispositivos y redes
1.3 Configurar redes

Seguridad para CPs S7-300/S7-400/PC
Crear cortafuegos
Reglas de cortafuegos locales para CPs S7-300/S7-400/PC
Resumen de CPs S7-300/S7-400/PC
Activar reglas de filtrado de paquetes
Si en los ajustes de seguridad locales se activa la función de seguridad para los CPs,
inicialmente estarán permitidos todos los accesos a y a través del CP. Para activar reglas
concretas de filtrado de paquetes, haga clic en la casilla de verificación "Activar cortafuegos".
A continuación autorice los servicios deseados. Las reglas de cortafuegos creadas
automáticamente debido a una configuración de conexión tienen preferencia sobre las reglas
ajustadas manualmente.
Nota
Ajustes de cortafuegos detallados en el modo de cortafuegos avanzado
En el modo de cortafuegos avanzado, las reglas de cortafuegos pueden limitarse a dispositivos
determinados. Para cambiar al modo de cortafuegos avanzado, active la casilla de verificación
"Activar cortafuegos en modo avanzado".

Configuración de cortafuegos con VPN
Si el módulo de seguridad se agrega a un grupo VPN, el cortafuegos se activa por defecto.
Además, se activa la casilla de verificación "Solo comunicación tunelada". Lo que significa que
a través de la interfaz externa solo está permitida la transferencia de datos IPsec cifrada. El
tráfico de datos a externa se bloquea.
Si se desactiva esta casilla de verificación, se permitirá la comunicación tunelada y,
adicionalmente, los tipos de comunicación seleccionados en las otras casillas de selección.

Actualizar reglas de conexión
Al cambiar la configuración de conexión de CPs cambian también las reglas de cortafuegos
relativas a la conexión. Para visualizar las reglas de cortafuegos modificadas hay que volver
a pulsar el botón "Actualizar reglas de conexión". Las reglas de cortafuegos modificadas se
mostrarán en el modo de cortafuegos avanzado.

534

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración de un cortafuegos con reglas de cortafuegos predefinidas: CP 343-1 Adv. / 443-1 Adv.
Configuración de un cortafuegos con reglas IP predefinidas: CP 343-1 Adv. / 443-1 Adv.
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Cortafuegos" > "Predefined IP rules".
Tabla 1-63

Servicios y sentidos disponibles

Servicio

De estación/
interna a ex‐
terna

De externa
a interna

De externa a
estación

Puertos permi‐ Significado
tidos

Permitir
comunicación
IP

x

x

x

todos

Se permite el tráfico IP para los sentidos de
comunicación seleccionados.

Permitir proto‐
colo S7

x

x

x

Puerto TCP
102

Se permite la comunicación de los disposi‐
tivos de red a través del protocolo S7.

Permitir FTP/
FTPS (modo
explícito)

x

x

x

Puerto TCP 20 Para la administración de archivos y el ac‐
Puerto TCP 21 ceso a ellos entre servidor y cliente.

Permitir HTTP

x

x

x

Puerto TCP 80 Para la comunicación con un servidor web.

Permitir
HTTPS

x

x

x

Puerto TCP
443

Para la comunicación segura con un servi‐
dor web, p. ej. diagnóstico web.

Permitir DNS

x

x

-

Puerto TCP
53

Se permite la conexión con un servidor
DNS.

Puerto UDP 53
Permitir SNMP

x

x

x

Puerto TCP
161/162

Para vigilar dispositivos de red con capaci‐
dad SNMP.

Puerto UDP
161/162
Permitir SMTP

x

x

-

Puerto TCP 25 Para enviar correos electrónicos a través
de un servidor SMTP.

Permitir NTP

x

x

-

Puerto UDP
123

Tabla 1-64

Para la sincronización de la hora.

Registro

Opción

Acción en caso de activación

Ajustes de registro IP
Registro de paquetes tunelados

Registro de paquetes entrantes bloqueados

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Regla de cortafuegos pertinente
De

A

Solo está activado si el módulo de Accept
seguridad forma parte de un grupo Accept
VPN. Se registran todos los paque‐
tes IP transferidos a través del túnel.

Acción

Estación

Túnel

Túnel

Estación

Se registran todos los paquetes IP
entrantes que se rechazan.

Externa

Estación

Drop

535

Configuración de dispositivos y redes
1.3 Configurar redes

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

Configuración de un cortafuegos con reglas MAC predefinidas: CP 343-1 Adv. / 443-1 Adv.
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. Seleccione la entrada "Cortafuegos" > "Reglas MAC predefinidas".
Tabla 1-65

Servicios y sentidos disponibles

Servicio

De estación a
externa

De externa a esta‐
ción

Permitir comunicación
MAC

x

x

Se permite el tráfico MAC de estación a externa y vicever‐
sa.

Permitir protocolo ISO

x

x

Se permite el tráfico ISO de estación a externa y viceversa.

Tabla 1-66

Significado

Registro

Opción

Acción en caso de acti‐
vación

Configuración del registro MAC

Regla de cortafuegos pertinente
De

A

Registro de paquetes tu‐ Solo está activado si el Accept
nelados
módulo de seguridad
Accept
forma parte de un gru‐
po VPN. Se registran
todos los paquetes
MAC transferidos a tra‐
vés del túnel.

Estación

Túnel

Túnel

Estación

Registro de paquetes
entrantes bloqueados

Se registran todos los Drop
paquetes MAC entran‐
tes que se rechazan.

Externa

Estación

Registro de paquetes
salientes bloqueados

Se registran todos los
paquetes MAC salien‐
tes que se rechazan.

Estación

Externa

536

Acción

Drop

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

Configurar un cortafuegos con reglas predefinidas - CP1628
Configurar un cortafuegos con reglas IP predefinidas - CP1628
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. Seleccione la entrada "Seguridad" > "Cortafuegos" > "Predefined IP rules".
Tabla 1-67

Servicios y sentidos disponibles

Servicio

De externa a esta‐
ción

Puertos permitidos

Significado

Permitir comunicación IP

x

todos

Se permite el tráfico IP de externa a
estación.

Permitir protocolo S7

x

Puerto TCP 102

Se permite la comunicación de los dis‐
positivos de red a través del protocolo
S7.

Permitir FTP/FTPS (modo ex‐
plícito)

x

Puerto TCP 20

Para la administración de archivos y el
acceso a ellos entre servidor y cliente.

Permitir HTTP

x

Puerto TCP 80

Para la comunicación con un servidor
web.

Permitir HTTPS

x

Puerto TCP 443

Para la comunicación segura con un
servidor web, p. ej. diagnóstico web.

Permitir DNS

x

Puerto TCP 53

Se permite la conexión con un servidor
DNS.

Permitir SNMP

x

Puerto TCP 161/162

Permitir SMTP

x

Puerto TCP 25

Para enviar correos electrónicos a tra‐
vés de un servidor SMTP.

Permitir NTP

x

Puerto UDP 123

Para la sincronización de la hora.

Puerto TCP 21

Puerto UDP 53
Puerto UDP 161/162

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Para vigilar dispositivos de red con ca‐
pacidad SNMP.

537

Configuración de dispositivos y redes
1.3 Configurar redes
Tabla 1-68

Registro

Opción

Acción en caso de activación Regla de cortafuegos perti‐
nente

Ajustes de registro IP

Acción

Registro de paquetes tunelados

Registro de paquetes entrantes blo‐
queados

Solo está activado si el mó‐ Accept
dulo de seguridad forma par‐
te de un grupo VPN. Se re‐
Accept
gistran todos los paquetes IP
transferidos a través del tú‐
nel.
Se registran todos los paque‐ Drop
tes IP entrantes que se re‐
chazan.

De

A

Esta‐
ción

Túnel

Túnel

Esta‐
ción

Externa

Esta‐
ción

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

Configurar un cortafuegos con reglas MAC predefinidas - CP1628
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. Seleccione la entrada "Seguridad" > "Cortafuegos" > "Reglas MAC".
Tabla 1-69

Servicios y sentidos disponibles

Servicio

De estación a externa De externa a estación Significado

Permitir comunicación en nivel
MAC

x

x

Se permite el tráfico MAC de externa a la
estación y viceversa.

Permitir comunicación ISO

x

x

Se permite el tráfico ISO de externa a la
estación y viceversa.

Permitir SiClock

x

x

Se permiten telegramas de hora SiClock
de externa a la estación y viceversa.

538

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Tabla 1-70

Registro

Opción

Acción en caso de activación Regla de cortafuegos perti‐
nente

Configuración del registro MAC

Acción

De

A

Registro de paquetes tunelados

Solo está activado si el mó‐ Accept
dulo de seguridad forma par‐
te de un grupo VPN. Se re‐
Accept
gistran todos los paquetes
MAC transferidos a través
del túnel.

Esta‐
ción

Túnel

Túnel

Esta‐
ción

Registro de paquetes entrantes blo‐
queados

Se registran todos los paque‐ Drop
tes MAC entrantes que se re‐
chazan.

Externa

Esta‐
ción

Registro de paquetes salientes blo‐
queados

Se registran todos los paque‐ Drop
tes MAC salientes que se re‐
chazan.

Esta‐
ción

Externa

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

Sentidos de filtrado de paquetes IP CPs S7-300/S7-400/PC
Significado
Posibilidades de selección para los sentidos de comunicación "De" y "A" en las reglas IP del
modo de cortafuegos avanzado.

Se dispone de los sentidos siguientes:
Posibilidades de selec‐
ción / Rangos de valores
De

Interna

Externa

A

Módulo de seguridad

Significado

CP 343-1
Adv. / 443-1
Adv.

CP 1628

Estación

x

-

Acceso de la red interna a la estación.

Any

x

-

Acceso de la red interna a la externa, al interlocutor de túnel VPN
y a la estación.

Estación

x

x

Acceso de la red externa a la estación.

Any

x

-

Acceso de la red externa a la interna y a la estación.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

539

Configuración de dispositivos y redes
1.3 Configurar redes
Posibilidades de selec‐
ción / Rangos de valores
Estación

Módulo de seguridad

Significado

Interna

x

-

Acceso desde la estación a la red interna.

Externa

x

x

Acceso desde la estación a la red externa.

Túnel

x

x

Acceso desde la estación al interlocutor de túnel VPN.

Túnel

Estación

x

x

Acceso a la estación a través del interlocutor de túnel VPN.

Any

x

-

Acceso del interlocutor de túnel VPN a la red interna y a la estación.

Any

Externa

x

-

Acceso desde la red interna y la estación a la red externa.

Sentidos de filtrado de paquetes MAC CPs S7-300/S7-400/PC
Significado
Posibilidades de selección para los sentidos de comunicación "De" y "A" en las reglas MAC del
modo de cortafuegos avanzado.

Se dispone de los sentidos siguientes:
Posibilidades de selección /
Rangos de valores
De

A

Módulo de seguridad
CP 343-1 Adv. /
443-1 Adv.

Significado

CP 1628

Externa

Estación

x

x

Acceso de la red externa a la estación.

Estación

Externa

x

x

Acceso desde la estación a la red externa.

Túnel

x

x

Acceso desde la estación al interlocutor de tú‐
nel VPN.

Estación

x

x

Acceso a la estación a través del interlocutor
de túnel VPN.

Túnel

Configurar una lista de acceso
Función específica del módulo
Esta función no está disponible para CP 1628.

540

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Significado
Las listas de acceso IP permiten definir la protección de acceso para determinadas direcciones
IP. Las entradas de la lista ya creadas en los ajustes locales del CP se muestran con sus
derechos correspondientes en la entrada "Cortafuegos" > "Reglas IP" (modo de cortafuegos
avanzado).
Nota
Cambio de respuesta tras activar la seguridad
● Tras activar la seguridad para un CP, la protección de acceso solo afecta a la interfaz
externa. Para que la protección de acceso también afecte a la interfaz interna, configure las
reglas de cortafuegos correspondientes en el modo de cortafuegos avanzado.
● El CP también responde a solicitudes ARP de direcciones IP no habilitadas (capa 2).
● Si la lista de acceso IP de un CP no contiene entradas y está activada la seguridad para el
CP, se activa el cortafuegos y ya no es posible acceder al CP desde externa. Para que el
CP sea accesible, configure las reglas de cortafuegos correspondientes en el modo de
cortafuegos avanzado.

Efecto de las entradas de la lista de acceso IP al activar la seguridad
Si en los ajustes locales de un CP se activa la seguridad, en el modo de cortafuegos avanzado
se crean las reglas correspondientes. Si en la lista de acceso se ha indicado una dirección IP,
para la misma se crea una regla de cortafuegos "Accept" > "Externa" > "Estación". Como
dirección IP de origen se toma la dirección IP de la lista de acceso IP. Las direcciones IP de un
área de direcciones IP definida también se convierten a las reglas de cortafuegos
correspondientes.

Requisitos de edición
Antes de que las reglas de cortafuegos creadas puedan editarse debe cumplirse el requisito
siguiente:
● para la edición mediante STEP 7: derecho de configuración "Configurar seguridad".
● para la edición mediante un servidor web: derecho de módulos "Web: Ampliar lista de
control de acceso IP".
Los requisitos para editar las listas de acceso IP fuera de los ajustes de seguridad locales se
describen en los capítulos de los CPs correspondientes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

541

Configuración de dispositivos y redes
1.3 Configurar redes

Reglas de cortafuegos automáticas referidas a conexiones
Significado
Para conexiones configuradas mediante CPs, STEP 7 crea automáticamente reglas de
cortafuegos que autorizan la comunicación con el interlocutor correspondiente del CP en el
sentido prescrito (CP activo/pasivo). Se tienen en cuenta los sentidos de establecimiento de
las conexiones. Para visualizar dichas reglas de cortafuegos debe pulsarse el botón
"Actualizar reglas de conexión" estando activado el modo de cortafuegos avanzado. Las
reglas de cortafuegos se mostrarán seguidamente en el modo de cortafuegos avanzado.
Nota
Habilitar manualmente conexiones UDP Multicast
Para las conexiones UDP Multicast no se crean reglas de cortafuegos automáticas. Para
habilitar las conexiones, agregue las correspondientes reglas de cortafuegos manualmente en
el modo de cortafuegos avanzado.
Dependiendo de cómo esté configurado el establecimiento de conexión, se crean las
siguientes reglas de cortafuegos de nivel 3. Si el módulo de seguridad se encuentra en un
grupo VPN, el sentido "Externa" cambia a "Túnel". Esto solo es válido para CPs que soportan
VPN.
En la columna "Dirección IP de origen" y "Dirección IP de destino" de estas reglas del
cortafuegos se introduce en cada caso la dirección IP del interlocutor.
CP->externa
Activo

Acción

De

A

Accept

Estación

Externa

Drop

Externa

Estación

Drop

Estación

Externa

Accept

Externa

Estación

Accept

Externa

Estación

Accept

Estación

Externa

CP->interna

Acción

De

A

Activo

Accept

Estación

Interna

Drop

Interna

Estación

Drop

Estación

Interna

Accept

Interna

Estación

Accept

Interna

Estación

Accept

Estación

Interna

Pasivo
Activo y pasivo

Pasivo
Activo y pasivo

Para las conexiones de nivel 2 se crean reglas "Accept" para ambos sentidos. Si el módulo de
seguridad se encuentra en un grupo VPN, el sentido "Externa" cambia a "Túnel".

542

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
En la columna "Dirección MAC de origen" y "Dirección MAC de destino" de estas reglas del
cortafuegos se introduce en cada caso la dirección MAC del interlocutor.
CP->externa

Acción

De

A

activo, pasivo, activo y pasivo

Accept

Estación

Externa

Accept

Externa

Estación

Nota
Cambiar la configuración de la conexión
Al cambiar la configuración de conexión de CPs cambian también las reglas de cortafuegos
relativas a la conexión. Para visualizar las reglas de cortafuegos modificadas hay que volver
a pulsar el botón "Actualizar reglas de conexión".

Convenios para reglas de cortafuegos creadas automáticamente
● Prioridad
Las reglas tienen la máxima prioridad, por lo que en la lista de reglas local se incorporan en
la parte superior.
● Borrar reglas
Las reglas no se pueden borrar. El registro puede activarse y pueden asignarse servicios.
Además es posible insertar una velocidad de transmisión y un comentario.
● Cambiar una acción
Si se cambia la acción "Accept" a "Drop" o viceversa, estas se sobrescribirán en la siguiente
comparación del sistema. Si los cambios realizados deben conservarse, elija como acción
"Accept*" o "Drop*". En ese caso solo se compara la dirección IP y la acción y el sentido se
mantienen de la forma ajustada. Los ajustes de registro, servicio, velocidad de transmisión
y comentario se conservan cuando se produce una nueva comparación de sistema aunque
no se cambie la acción a "Accept*" o "Drop*". Si se borra la conexión configurada, las reglas
correspondientes se eliminan de la lista.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

543

Configuración de dispositivos y redes
1.3 Configurar redes

Módulo de seguridad en grupo VPN
La casilla de verificación "Solo comunicación tunelada" está activada de forma
predeterminada. Si se desactiva la casilla de verificación, además de la comunicación
tunelada entre interlocutores tunelados existe la posibilidad de establecer comunicación con
otros dispositivos de red con los que no existen túneles.
● La comunicación se produce sin túnel si la dirección del interlocutor pertenece a una
estación conocida en STEP 7 con la que no hay configurado ningún túnel VPN.
● La comunicación transcurre a través del túnel VPN si la dirección del interlocutor es un
punto final VPN.
● Si no es posible asignar unívocamente si una conexión debe transcurrir por dentro o por
fuera del túnel VPN, la conexión se asigna al túnel VPN y se muestra la indicación
correspondiente. La asignación puede adaptarse en el modo de cortafuegos avanzado, p.
ej. cambiando el sentido "De" de "Túnel" a "Externa". Para que esta adaptación no se
sobrescriba de nuevo al realizarse otra comparación del sistema, debe seleccionarse la
acción "Accept*" o "Drop*".
Nota
En caso de ser necesario garantizar que solo sea posible la comunicación a través del
túnel, cree las reglas de cortafuegos correspondientes en el modo de cortafuegos
avanzado, p. ej. para dispositivos internos o direcciones NDIS.
Para permitir exclusivamente la comunicación tunelada para un CP, inserte una regla con
los ajustes siguientes:
● "Acción": "Drop"
● "De": "Any"
● "A": "Externa"
Para CP 1628 debe insertarse una regla con los ajustes siguientes:
● "Acción": "Drop"
● "De": "Estación"
● "A": "Externa"
Además, deben eliminarse las reglas de cortafuegos existentes que permitan una
comunicación sin túnel.

Activar el servidor web en un módulo de seguridad
Función específica del módulo
Esta función solo está disponible para el CP 343-1 Adv. / 443-1 Adv. y CP 443-1 OPC UA.

544

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Significado
Tras activar el servidor web se obtiene acceso a las páginas web del módulo. En los ajustes de
seguridad locales es posible limitar el acceso a dichas páginas web al protocolo HTTPS para
el CP 343-1 Adv. / 443-1 Adv. El acceso se controla mediante la casilla de verificación "Permitir
el acceso solo vía HTTPS". Además, es necesario configurar el cortafuegos adecuadamente.
Para el CP 443-1 OPC UA solo se permite el acceso al servidor web mediante HTTPS.

Túnel IPsec: crear y asignar grupos
Configurar nodos de red internos - Entrada "Nodos"
Permitir el acceso a CPs S7-300/S7-400 para interlocutores VPN
Posibilidades de selección
Seleccione si los interlocutores VPN en modo de enrutamiento (SCALANCE S / M) deben tener
acceso al CP y/o a la subred interna del CP.

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Nodos".
3. Configure el acceso para los interlocutores VPN del CP en el modo de enrutamiento
(SCALANCE S / M).
– Permitir conexión al CP (interfaz Gigabit)
– Permitir conexión a subred interna (subred PROFINET)

Configurar manualmente nodos NDIS accesibles por túnel en CPs PC
Configurar nodos NDIS accesibles por túnel
Los nodos internos se aprenden y se asignan directamente a las rutas. Ello afecta a las
direcciones IP NDIS del PC Windows.

Proceda del siguiente modo
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Nodos" > "Nodos NDIS accesibles por
túnel".
3. Introduzca la dirección IP NDIS.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

545

Configuración de dispositivos y redes
1.3 Configurar redes

Funciones online - Test / Diagnóstico y registro
Reglas de cortafuegos actualizadas - Entrada "Reglas del cortafuegos actualizadas de forma dinámica"
Función específica del módulo
Esta función solo está disponible para el CP 343-1 Adv. / 443-1 Adv.

Significado
Visualización de las direcciones IP o áreas de direcciones IP habilitadas dinámicamente vía
HTTP o HTTPS o cargadas posteriormente por un usuario. Para las direcciones IP habilitadas
se muestran los derechos de acceso al CP S7 que tienen asignadas. En esta ficha las
direcciones IP se pueden actualizar mediante los eventos siguientes:
● Ampliación/Modificación de la lista IP Access Control
● Actualización de las reglas de cortafuegos
● Ampliaciones dinámicas registradas por el CP en el tiempo de ejecución, p.ej. dispositivos
PROFINET IO
Como aquí solo se muestran las reglas de cortafuegos actualizadas dinámicamente, para
considerar íntegramente el estado actual de cortafuegos del módulo hay que incluir también
las reglas de cortafuegos que se han configurado offline y se han cargado en la estación.

Seguridad para CP S7-1200/S7-1500
Crear cortafuegos
Reglas de cortafuegos locales para CP S7-1200/S7-1500
Vista general de las reglas de cortafuegos locales para CP S7-1200/S7-1500
Activar reglas de filtrado de paquetes
Si en los ajustes de seguridad locales se activa la función de seguridad para los CPs,
inicialmente estarán permitidos todos los accesos a y a través del CP.
Para activar reglas concretas de filtrado de paquetes, haga clic en la casilla de verificación
"Activar cortafuegos". A continuación autorice los servicios deseados. Las reglas de

546

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
cortafuegos creadas automáticamente debido a una configuración de conexión tienen
preferencia sobre las reglas ajustadas manualmente.
Nota
Paquetes IPv4 no registrados a partir de V2.2
El cortafuegos no registra paquetes IP que el CP reenvía directamente al PLC. Si utiliza la
interfaz virtual W1, p. ej. para OPC UA, tendrá que permitir los servicios que desee
manualmente en el cortafuegos del CP.
Nota
Ajustes de cortafuegos detallados en el modo de cortafuegos avanzado
En el modo de cortafuegos avanzado, las reglas de cortafuegos pueden limitarse a dispositivos
determinados. Para cambiar al modo de cortafuegos avanzado, active la casilla de verificación
"Activar cortafuegos en modo avanzado".

Actualizar reglas de conexión
Al cambiar la configuración de conexión de CPs cambian también las reglas de cortafuegos
relativas a la conexión. Para visualizar las reglas de cortafuegos modificadas hay que volver
a pulsar el botón "Actualizar reglas de conexión". Las reglas de cortafuegos modificadas se
mostrarán en el modo de cortafuegos avanzado.

Configuración de un cortafuegos con reglas de cortafuegos predefinidas - CP 1543-1 / CP 1543SP-1
Configuración de un cortafuegos con reglas IP predefinidas
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Cortafuegos" > "Predefined IP rules".
Tabla 1-71

Servicios y sentidos disponibles

Servicio

De externa a
estación

Puertos permitidos

Significado

Permitir comunica‐
ción IP

x

todos

Se permite el tráfico IP de externa a estación.

Permitir protocolo
S7

x

Puerto TCP 102

Se permite la comunicación de los dispositivos de red a través
del protocolo S7.

Permitir FTP/
FTPS* (modo ex‐
plícito)

x

Puerto TCP 20

Para la administración de archivos y el acceso a ellos entre ser‐
vidor y cliente.

Puerto TCP 21

Permitir HTTP

x

Puerto TCP 80

Para la comunicación con un servidor web.

Permitir HTTPS

x

Puerto TCP 443

Para la comunicación segura con un servidor web, p. ej. diag‐
nóstico web.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

547

Configuración de dispositivos y redes
1.3 Configurar redes
Servicio

De externa a
estación

Puertos permitidos

Significado
Para vigilar dispositivos de red con capacidad SNMP.

Permitir SNMP

x

Puerto TCP 161/162

Permitir diagnosti‐
co de seguridad

x

Puerto TCP 8448

Puerto UDP 161/162
Permitir diagnóstico de seguridad.

* No disponible para CP 1543SP-1

Tabla 1-72

Routing IP a través de bus de fondo (solo para CP 1543-1 a partir de V2.1)

Servicio

Puertos per‐
mitidos

Significado

Permitir comuni‐
cación IP a través
de bus de fondo

Todas

Se permite el tráfico IPv4 a través del bus de fondo.

Tabla 1-73

Si está activada la opción "Routing IP entre módulos de comunicación", esta casilla de
verificación estará activada y no podrá desactivarse. Si la opción está desactivada, esta
casilla de verificación estará desactivada y no podrá activarse.

Registro

Opción

Acción en caso de activación

Regla de cortafuegos pertinente

Ajustes de registro IP
Registro de paquetes tunelados

Registro de paquetes entrantes bloqueados

Acción

De

A

Solo está activado si el módulo de Accept
seguridad forma parte de un grupo Accept
VPN. Se registran todos los paque‐
tes IP transferidos a través del túnel.

Estación

Túnel

Túnel

Estación

Se registran todos los paquetes IP
entrantes que se rechazan.

Externa

Estación

Drop

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

Configuración de un cortafuegos con reglas IPv6 predefinidas
Significado
Las reglas IPv6 predefinidas ofrecen la posibilidad de configurar el cortafuegos en relación a
servicios en los que se utiliza IPv6. Al habilitar una regla IPv6 predefinida en los ajustes locales
de seguridad del CP se habilitan también en el cortafuegos los servicios ICMPv6 definidos por
el sistema que se muestran en la ficha "ICMP" de las funciones globales de seguridad, en
"Cortafuegos" > "Servicios" > "Definir servicios para reglas IP".

548

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. Seleccione en los ajustes de seguridad locales la entrada "Cortafuegos" > "Reglas IPv6
predefinidas".
Tabla 1-74

Servicios y sentidos disponibles

Servicio

De externa a
estación

Puertos permitidos

Significado

Permitir comunica‐
ción IP

x

todos

Se permite el tráfico IP de externa a estación.

Permitir protocolo
S7

x

Puerto TCP 102

Se permite la comunicación de los dispositivos de red a través
del protocolo S7.

Permitir FTP/
FTPS* (modo ex‐
plícito)

x

Puerto TCP 20
Puerto TCP 21

Para la administración de archivos y el acceso a ellos entre ser‐
vidor y cliente.

Permitir SNMP

x

Puerto TCP 161/162

Para vigilar dispositivos de red con capacidad SNMP.

Puerto UDP 161/162
* No disponible para CP 1543SP-1

Tabla 1-75

Registro

Opción

Acción en caso de activación

Ajustes de registro IP
Registro de paquetes entrantes bloqueados

Se registran todos los paquetes IP
entrantes que se rechazan.

Regla de cortafuegos pertinente
Acción

De

A

Drop

Externa

Estación

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IPv6 predefinidas" no afectan a las reglas del
cortafuegos creadas automáticamente mediante una configuración de conexión. Así, por
ejemplo, no es posible registrar telegramas tunelados de una conexión configurada. En el
modo de cortafuegos avanzado existe la posibilidad de ampliar el registro a las reglas de
cortafuegos creadas automáticamente para conexiones.

Configuración de un cortafuegos con reglas MAC predefinidas
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. Seleccione la entrada "Cortafuegos" > "Reglas MAC predefinidas".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

549

Configuración de dispositivos y redes
1.3 Configurar redes
Tabla 1-76

Servicios y sentidos disponibles

Servicio

De esta‐
ción a ex‐
terna

De ex‐ Puertos
terna a permiti‐
estación dos

Significado

Permitir comunica‐
ción MAC

x

x

-

Se permite el tráfico MAC de externa a la estación y viceversa.

Permitir protocolo
ISO*

x

x

-

Se permite el tráfico ISO de externa a la estación y viceversa.

Permitir DCP

x

x

-

Se permite el tráfico DCP de externa a la estación y viceversa.

Permitir LLDP*

x

x

-

Se permite el tráfico LLDP de externa a la estación y viceversa.

* No disponible para CP 1543SP-1

Tabla 1-77

Registro

Opción

Acción en caso de
activación

Regla de cortafuegos pertinente

Configuración del registro MAC

Acción

De

A

Registro de paquetes tune‐ Solo está activado
lados
si el módulo de se‐
guridad forma par‐
te de un grupo
VPN. Se registran
todos los paquetes
MAC transferidos a
través del túnel.

Accept

Estación

Túnel

Accept

Túnel

Estación

Registro de paquetes en‐
trantes bloqueados

Se registran todos
los paquetes MAC
entrantes que se
rechazan.

Drop

Externa

Estación

Registro de paquetes sa‐
lientes bloqueados

Se registran todos Drop
los paquetes MAC
salientes que se re‐
chazan.

Estación

Externa

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

550

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configurar un cortafuegos con reglas predefinidas - CP S7-1200
Configurar un cortafuegos con reglas IP predefinidas
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "Cortafuegos" > "Predefined IP rules".
Tabla 1-78

Servicios y sentidos disponibles

Servicio

De externa a
estación

Puertos permitidos

Significado

Permitir comunica‐
ción IP

x

todos

Se permite el tráfico IP de externa a estación.

Permitir protocolo
S7

x

Puerto TCP 102

Se permite la comunicación de los dispositivos de red a través
del protocolo S7.

Permitir HTTP

x

Puerto TCP 80

Para la comunicación con un servidor web.

Permitir HTTPS

x

Puerto TCP 443

Para la comunicación segura con un servidor web, p. ej. diag‐
nóstico web.

Permitir SNMP

x

Puerto TCP 161/162

Para vigilar dispositivos de red con capacidad SNMP.

Puerto UDP 161/162
Permitir diagnosti‐
co de seguridad

Tabla 1-79

x

Puerto TCP 8448

Permitir diagnóstico de seguridad.

Registro

Opción

Acción en caso de activación

Ajustes de registro IP
Registro de paquetes tunelados

Registro de paquetes entrantes bloqueados

Regla de cortafuegos pertinente
Acción

De

A

Solo está activado si el módulo de Accept
seguridad forma parte de un grupo Accept
VPN. Se registran todos los paque‐
tes IP transferidos a través del túnel.

Estación

Túnel

Túnel

Estación

Se registran todos los paquetes IP
entrantes que se rechazan.

Externa

Estación

Drop

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

551

Configuración de dispositivos y redes
1.3 Configurar redes

Configurar un cortafuegos con reglas IPv6 predefinidas
Significado
Las reglas IPv6 predefinidas ofrecen la posibilidad de configurar el cortafuegos en relación a
servicios en los que se utiliza IPv6. Al habilitar una regla IPv6 predefinida en los ajustes de
seguridad locales de un CP S7-1200 apto para IPv6 se habilitan también en el cortafuegos los
servicios ICMPv6 definidos por el sistema que se muestran en la ficha "ICMP" de las funciones
de seguridad globales, en "Cortafuegos" > "Servicios" > "Definir servicios para reglas IP".

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. Seleccione en los ajustes de seguridad locales la entrada "Cortafuegos" > "Reglas IPv6
predefinidas".
Tabla 1-80

Servicios y sentidos disponibles

Servicio

De externa a
estación

Puertos permitidos

Significado

Permitir comunica‐
ción IP

x

todos

Se permite el tráfico IP de externa a estación.

Permitir protocolo
S7

x

Puerto TCP 102

Se permite la comunicación de los dispositivos de red a través
del protocolo S7.

Permitir SNMP

x

Puerto TCP 161/162

Para vigilar dispositivos de red con capacidad SNMP.

Puerto UDP 161/162

Tabla 1-81

Registro

Opción

Acción en caso de activación

Regla de cortafuegos pertinente

Ajustes de registro IP
Registro de paquetes entrantes bloqueados

Se registran todos los paquetes IP
entrantes que se rechazan.

Acción

De

A

Drop

Externa

Estación

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IPv6 predefinidas" no afectan a las reglas del
cortafuegos creadas automáticamente mediante una configuración de conexión. Así, por
ejemplo, no es posible registrar telegramas tunelados de una conexión configurada. En el
modo de cortafuegos avanzado existe la posibilidad de ampliar el registro a las reglas de
cortafuegos creadas automáticamente para conexiones.

552

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configurar un cortafuegos con reglas MAC predefinidas
Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. Seleccione la entrada "Cortafuegos" > "Reglas MAC predefinidas".
Tabla 1-82

Servicios y sentidos disponibles

Servicio

De esta‐
ción a ex‐
terna

De ex‐ Puertos
terna a permiti‐
estación dos

Significado

Permitir comunica‐
ción MAC

x

x

-

Se permite el tráfico MAC de externa a la estación y viceversa.

Permitir DCP

x

x

-

Se permite el tráfico DCP de externa a la estación y viceversa.

Tabla 1-83

Registro

Opción

Acción en caso de
activación

Regla de cortafuegos pertinente

Configuración del registro MAC

Acción

De

A

Registro de paquetes tune‐ Solo está activado
lados
si el módulo de se‐
guridad forma par‐
te de un grupo
VPN. Se registran
todos los paquetes
MAC transferidos a
través del túnel.

Accept

Estación

Túnel

Accept

Túnel

Estación

Drop

Externa

Estación

Estación

Externa

Registro de paquetes en‐
trantes bloqueados

Se registran todos
los paquetes MAC
entrantes que se
rechazan.

Registro de paquetes sa‐
lientes bloqueados

Se registran todos Drop
los paquetes MAC
salientes que se re‐
chazan.

Nota
Relación entre los ajustes de registro en modo normal y las reglas del cortafuegos
Los ajustes de registro realizados en "Reglas IP predefinidas" o "Reglas MAC predefinidas" no
afectan a las reglas del cortafuegos creadas automáticamente mediante una configuración de
conexión. Así, por ejemplo, no es posible registrar telegramas tunelados de una conexión
configurada. En el modo de cortafuegos avanzado existe la posibilidad de ampliar el registro
a las reglas de cortafuegos creadas automáticamente para conexiones.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

553

Configuración de dispositivos y redes
1.3 Configurar redes

Sentidos de filtrado de paquetes IP para CP S7-1200/S7-1500
Significado
Posibilidades de selección para los sentidos de comunicación "De" y "A" en las reglas IP del
modo de cortafuegos avanzado.

Se dispone de los sentidos siguientes:
Posibilidades de selección / Rangos de valores

Significado

De

A

Externa

Estación

Acceso de la red externa a la estación.

Bus de fondo*

Acceso desde la red externa al bus de fondo de la estación.

Any**

Acceso desde la red externa a todos los sentidos soportados.

Externa

Acceso desde la estación a la red externa.

Túnel

Acceso desde la estación al interlocutor de túnel VPN.

Bus de fondo*

Acceso desde la estación a su bus de fondo.

Any**

Acceso desde la estación a todos los sentidos soportados.

Estación

Acceso de interlocutores de túnel VPN a la estación.

Bus de fondo*

Acceso de interlocutores de túnel VPN al bus de fondo de la
estación.

Any**

Acceso de interlocutores de túnel VPN a todos los sentidos
soportados.

Externa

Acceso desde el bus de fondo de la estación a la red externa.

Túnel

Acceso desde el bus de fondo de la estación a interlocutores
VPN.

Estación

Acceso desde el bus de fondo a la estación.

Any**

Acceso desde el bus de fondo a todos los sentidos soporta‐
dos.

Externa

Acceso de todos los sentidos soportados a la red externa.

Túnel

Acceso de todos los sentidos soportados a interlocutores de
túnel VPN.

Estación

Acceso de todos los sentidos soportados a la estación.

Bus de fondo*

Acceso de todos los sentidos soportados al bus de fondo de
la estación.

Estación

Túnel

Bus de fondo*

Any**

* Solo para CP 1543-1 a partir de V2.1 con comunicación IPv4. Con la opción "Routing IP entre módulos de comunicación"
activada, este sentido permite habilitar/bloquear el routing IP a través del bus de fondo.
** Solo para CP 1543-1 a partir de V2.1

Sentidos de filtrado de paquetes MAC para CP S7-1200/S7-1500
Significado
Posibilidades de selección para los sentidos de comunicación "De" y "A" en las reglas MAC del
modo de cortafuegos avanzado.

554

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Se dispone de los sentidos siguientes:
Posibilidades de selección / Rangos de valores

Significado

De

A

Externa

Estación

Acceso de la red externa a la estación.

Estación

Externa

Acceso desde la estación a la red externa.

Túnel

Acceso desde la estación al interlocutor de túnel VPN.

Estación

Acceso de interlocutores de túnel VPN a la estación.

Túnel

Reglas de cortafuegos automáticas referidas a conexiones
Significado
Para conexiones configuradas mediante CPs, STEP 7 crea automáticamente reglas de
cortafuegos que autorizan la comunicación con el interlocutor correspondiente del CP en el
sentido prescrito (CP activo/pasivo). Se tienen en cuenta los sentidos de establecimiento de
las conexiones. Para visualizar dichas reglas de cortafuegos debe pulsarse el botón
"Actualizar reglas de conexión" estando activado el modo de cortafuegos avanzado. Las
reglas de cortafuegos se mostrarán seguidamente en el modo de cortafuegos avanzado.
Nota
Habilitar manualmente conexiones UDP Multicast y UDP Broadcast
Para las conexiones UDP Multicast y UDP Broadcast no se crean reglas de cortafuegos
automáticas. Para habilitar las conexiones, agregue las correspondientes reglas de
cortafuegos manualmente en el modo de cortafuegos avanzado.
Dependiendo de cómo esté configurado el establecimiento de conexión, se crean las
siguientes reglas de cortafuegos de nivel 3. Si el CP se encuentra en un grupo VPN, el sentido
"Externa" cambia a "Túnel".
En la columna "Dirección IP de origen" y "Dirección IP de destino" de estas reglas del
cortafuegos se introduce en cada caso la dirección IP del interlocutor.
CP->externa

Acción

De

A

Activo

Drop

Externa

Estación

Accept

Estación

Externa

Pasivo
Activo y pasivo

Drop

Estación

Externa

Accept

Externa

Estación

Accept

Externa

Estación

Accept

Estación

Externa

Para las conexiones de nivel 2 se crean reglas "Accept" para ambos sentidos. Si el CP se
encuentra en un grupo VPN, el sentido "Externa" cambia a "Túnel".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

555

Configuración de dispositivos y redes
1.3 Configurar redes
En la columna "Dirección MAC de origen" y "Dirección MAC de destino" de estas reglas del
cortafuegos se introduce en cada caso la dirección MAC del interlocutor.
CP->externa

Acción

De

A

activo, pasivo, activo y pasivo

Accept

Estación

Externa

Accept

Externa

Estación

Nota
Cambiar la configuración de la conexión
Al cambiar la configuración de conexión de CPs cambian también las reglas de cortafuegos
relativas a la conexión. Para visualizar las reglas de cortafuegos modificadas hay que volver
a pulsar el botón "Actualizar reglas de conexión".

Convenios para reglas de cortafuegos creadas automáticamente
● Prioridad
Las reglas tienen la máxima prioridad, por lo que en la lista de reglas local se incorporan en
la parte superior.
● Borrar reglas
Las reglas no se pueden borrar. El registro puede activarse y pueden asignarse servicios.
Además es posible insertar una velocidad de transmisión y un comentario.
● Cambiar una acción
Si se cambia la acción "Accept" a "Drop" o viceversa, estas se sobrescribirán en la siguiente
comparación del sistema. Si los cambios realizados deben conservarse, elija como acción
"Accept*" o "Drop*". En ese caso solo se compara la dirección IP y la acción y el sentido se
mantienen de la forma ajustada. Los ajustes de registro, servicio, velocidad de transmisión
y comentario se conservan cuando se produce una nueva comparación de sistema aunque
no se cambie la acción a "Accept*" o "Drop*". Si se borra la conexión configurada, las reglas
correspondientes se eliminan de la lista.

556

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Módulo de seguridad en grupo VPN
La casilla de verificación "Solo comunicación tunelada" está activada de forma
predeterminada. Si se desactiva la casilla de verificación, además de la comunicación
tunelada entre interlocutores tunelados existe la posibilidad de establecer comunicación con
otros dispositivos con los que no existen túneles.
● La comunicación se produce sin túnel si la dirección del interlocutor pertenece a una
estación conocida en STEP 7 con la que no hay configurado ningún túnel VPN.
● La comunicación transcurre a través del túnel VPN si la dirección del interlocutor es un
punto final VPN.
Nota
En caso de ser necesario garantizar que solo sea posible la comunicación a través del
túnel, cree las reglas de cortafuegos correspondientes en el modo de cortafuegos
avanzado.
Para permitir exclusivamente la comunicación tunelada para un CP, inserte una regla con
los ajustes siguientes:
● "Acción": "Drop"
● "De": "Estación"
● "A": "Externa"
Además, deben eliminarse las reglas de cortafuegos existentes que permitan una
comunicación sin túnel.

Configuración de subredes S7 para CP 154x-1 accesibles a través del bus de fondo
Requisitos
● El módulo de seguridad CP 1543‑1 a partir de V2.1 / CP 1545‑1 forma parte de un grupo
VPN y la opción "Routing IP entre módulos de comunicación" está activada.
Nota
Routing S7 a través de la interfaz virtual
El routing S7 por el CP funciona a través de la pasarela S7 del CP. Si la dirección IP de la
interfaz virtual W1 se utiliza como próxima dirección de router S7, el reenvío al destino definido
funciona a través de la pasarela S7 de la CPU, pero el "canal de retorno" no está garantizado.

Cómo se accede a esta función
1. Seleccione el módulo que desea editar.
2. En los ajustes locales de seguridad elija la entrada "VPN" > "Nodos" > "Subredes
accesibles por túnel".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

557

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración de subredes accesibles a través de bus de fondo
La comunicación VPN con nodos de subred y subredes accesibles a través del bus de fondo
de una estación solo es posible si estos están habilitados para la comunicación VPN. Para ello,
en la entrada "Subredes accesibles por túnel" no pueden indicarse más de 16 direcciones IP
o subredes. Las direcciones IP deben indicarse con una máscara de subred de 32 bits,
subredes con una máscara de subred permitida dentro del rango 1 ... 31 bits. No pueden
indicarse direcciones Broadcast.

Configuración OpenVPN automática a través de SINEMA Remote Connect Server
Configuración OpenVPN automática y establecimiento de túnel Open-VPN
Módulos soportados
La función está disponible para algunos módulos de seguridad y de comunicación por
Telecontrol.

Función
El módulo puede establecer una conexión OpenVPN con la aplicación "SINEMA Remote
Connect Server". SINEMA Remote Connect Server determina los parámetros de conexión
OpenVPN que deben utilizarse para ello. El módulo puede llamar estos parámetros de
conexión cíclicamente y recibe así automáticamente la configuración OpenVPN que debe
utilizarse.

Procedimiento
1. Seleccione el módulo que desea editar.
2. En los ajustes de seguridad locales elija la entrada "VPN".
3. Active la casilla de verificación "Activar VPN" y seleccione el tipo de conexión VPN
"Configuración OpenVPN automática a través de SINEMA Remote Connect Server".
4. Configure los siguientes parámetros para la conexión OpenVPN:
Parámetro

Significado

Dirección SINEMA RC

Dirección IPv4 / IPv6, FQDN o nombre de dispositivo PROFINET de SINEMA Re‐
mote Connect Server del cual el módulo llama los parámetros de conexión para la
conexión OpenVPN.

Puerto SINEMA RC

Puerto para la conexión con el SINEMA Remote Connect Server, que se utiliza para
llamar los parámetros de conexión para la conexión OpenVPN.

Certificado CA

El módulo se autentifica en el SINEMA Remote Connect Server con un certificado
CA descargado del servidor y seleccionado para el módulo. Solo pueden seleccio‐
narse certificados que han sido asignados al módulo a través del administrador de
certificados local.
Para la autenticación del SINEMA Remote Connect Server el módulo comprueba el
certificado CA del servidor. También se comprueba si la hora actual del módulo se
encuentra dentro del periodo de validez del certificado.

558

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Parámetro

Significado

Huella dactilar

El módulo se autentifica en el SINEMA Remote Connect Server mediante la propie‐
dad "Huella dactilar" del certificado CA del SINEMA Remote Connect Server.

ID del dispositivo

La ID del dispositivo es asignada por el SINEMA Remote Connect Server para cada
módulo configurado en el SINEMA Remote Connect Server.
La ID del dispositivo permite identificar los módulos.

Contraseña de dispositivo

Contraseña configurada para la ID de dispositivo en el SINEMA Remote Connect
Server.

Intervalo de actualización

Intervalo en minutos, dentro del cual el módulo llama los parámetros de conexión
OpenVPN utilizados del SINEMA Remote Connect Server. El SINEMA Remote
Connect Server determina si y con qué parámetros de conexión se pueden estable‐
cer conexiones OpenVPN. Con el valor "0" se desactiva la actualización.
Valor mínimo para la actualización: 10 minutos
Valor máximo para la actualización: 10080 minutos

Tipo de conexión

El tipo de conexión determina el momento en el que el módulo establece una cone‐
xión OpenVPN con el SINEMA Remote Connect Server:
● Permanente: El módulo establece una conexión OpenVPN después de leer los
parámetros de conexión OpenVPN. La conexión OpenVPN se mantiene hasta
que SINEMA Remote Connect Server cambia los parámetros de conexión.
● Disparo de PLC: El módulo establece una conexión OpenVPN en cuanto la
variable PLC seleccionada tiene el valor "TRUE".

Variable PLC para establecimiento de
conexión

Selección de una variable de la estación del tipo "BOOL". Si la variable adopta el
valor "TRUE", el módulo establece una conexión OpenVPN con el SINEMA Remote
Connect Server. Si la variable adopta el valor "FALSE", se establece la conexión
OpenVPN.

Diagnóstico de la configuración OpenVPN automática y de las conexiones OpenVPN
Significado
Esta página de diagnóstico muestra el estado de la configuración OpenVPN automática y de
las conexiones OpenVPN.
El estado de la configuración OpenVPN automática muestra si el módulo ha podido abrir el
archivo de configuración con los parámetros de conexión OpenVPN del SINEMA Remote
Connect Server que deben utilizarse.
Para las conexiones OpenVPN con el SINEMA Remote Connect Server se muestran los
estados de conexión y sus causas correspondientes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

559

Configuración de dispositivos y redes
1.3 Configurar redes

1.3.4.2

Configuración de la seguridad para SCALANCE S-600

Dispositivos soportados
Dispositivos soportados
Las funciones de seguridad descritas en este apartado de ayuda son soportadas por los
siguientes productos:
● SCALANCE S615 6.2
● SCALANCE SC-600:
– SCALANCE SC632-2C V1
– SCALANCE SC636-2C V1
– SCALANCE SC642-2C V1
– SCALANCE SC646-2C V1

Denominación general "Dispositivo"
En el presente apartado del sistema de información se utiliza la denominación "dispositivo" en
representación de los nombres de producto arriba citados. Encontrará las diferencias de las
funciones en el capítulo Equipamiento de hardware y funciones de sistema (Página 560)
Dependiendo del dispositivo seleccionado aparecerán diferentes parámetros en las distintas
páginas de configuración.

Equipamiento de hardware y funciones de sistema
Disponibilidad del equipamiento de hardware
La tabla siguiente muestra el equipamiento de hardware de los dispositivos.
Salvo modificaciones técnicas.
SCALANCE S615

SCALANCE SC642-2C

SCALANCE
SC636-2C

2 puertos RJ45

6 puertos RJ45

Slots para transcepto‐ res enchufables (SFP)

2

2

Conexiones eléctricas 5

2

6

Combo Ports

-

2

2

Slot PLUG

1

1

1

Puertos utilizables en
total

560

5 puertos RJ45

SCALANCE SC632-2C

SCALANCE
SC646-2C

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Disponibilidad de las funciones de sistema
La tabla siguiente muestra la disponibilidad de las funciones de sistema en los dispositivos.
Salvo modificaciones técnicas.

Información

SCALANCE
S615

SCALANCE SC-600

Versiones

✓

✓

I&M

✓

-

Tabla ARP

✓

✓

Tablas de registro

✓

✓

Error

✓

✓

SNMP

✓

✓

LLDP

✓

✓

Tabla de Routing

✓

✓

IPsec VPN

✓

✓ (solo SCALANCE
SC64x-2C)

✓ (solo con KEYPLUG)

✓

Cliente OpenVPN

✓

-

Redundancia

✓

-

Estadísticas VRRPV3

✓

✓ (en "Redundan‐
cia")

Seguridad

✓

✓

SINEMA RC

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

561

Configuración de dispositivos y redes
1.3 Configurar redes

Sistema

SCALANCE
S615

SCALANCE SC-600

Configuración

✓

✓ (sin servidor Tel‐
net, sin cliente
SMTP)

General

✓

✓

DNS

✓

✓

TFTP

✓

✓

SFTP

✓

-

Eventos

✓

✓

Cliente SMTP

✓

-

PLUG

✓

-

Cliente DHCP

✓

✓ (solo IPv4)

Servidor DHCP

✓

✓

SNMP

✓

✓

Hora del sistema

✓

✓

Cierre de sesión automático
Pulsador
Cliente Syslog
Puertos
Control de errores

Layer 3

562

✓

✓

✓

✓ (en "Interfaces")

✓

✓ (solo Link Change)

✓

-

✓

cRSP / SRS

✓

✓

DCP Discovery

✓

-

Cloud Connector

✓

-

Copia de seguridad de la con‐
figuración

✓

-

✓

✓

✓ (solo con KEYPLUG)

✓

Cloud Connector

✓

-

SINEMA RC

Layer 2

✓

Diagnóstico de puerto (solo
disponible online)

Servidor proxy

Interfaces

✓
✓ (Sin máscara de
avisos)

Vigilancia de la conexión

✓

-

Ethernet

✓

-

PPP

✓

-

VLAN basada en puerto

✓

✓

Dynamic MAC Aging

✓

✓

LLDP

✓

✓

Spanning Tree

✓

-

Rutas estáticas

✓

✓

Subredes

✓

✓

NAT

✓

✓

VRRPv3

✓

-

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Seguridad

SCALANCE
S615

SCALANCE SC-600

✓ (solo en WBM)

✓

AAA (Authentication, Authori‐
zation, Accounting)

✓

-

Certificados

✓

✓

Cortafuegos

✓

✓

IPsec VPN

✓

✓ (solo SCALANCE
SC64x-2C)

OpenVPN

✓

-

Usuarios

Nota legal
Personal cualificado
El producto o sistema al que se refiere la presente documentación solo debe ser manejado por
personal cualificado para la tarea correspondiente observando la documentación relacionada
con la tarea en cuestión, especialmente las consignas de seguridad y advertencias incluidas
en la misma. Por su formación y experiencia, el personal cualificado está capacitado para
reconocer riesgos durante el manejo de estos productos o sistemas y evitar posibles peligros.

Información importante
Estructura de una dirección IPv4
Clases de dirección
Campo de direcciones IP

Cantidad máx. de redes

1.x.x.x a 126.x.x.x
128.0.x.x a 191.255.x.x
192.0.0.x a 223.255.255.x

Cantidad máx. de
hosts/red

Clase

CIDR

A

/8

126

16777214

16383

65534

B

/16

2097151

254

C

/24

224.0.0.0 - 239.255.255.255

Aplicaciones Multicast

D

240.0.0.0 - 255.255.255.255

reservada para aplicaciones futuras

E

Una dirección IP consta de 4 bytes. Cada byte se representa en forma decimal y está separado
del anterior por un punto. Resulta por tanto la siguiente estructura, teniéndose que reemplazar
XXX por un número entre 0 y 255:
XXX.XXX.XXX.XXX
La dirección IP consta de dos partes, la dirección de red y la dirección de la estación terminal.
Así es posible formar diversas subredes. En función de qué bytes de la dirección IP se usan
como dirección de red y cuáles como dirección del usuario final, una dirección de IP puede
asignarse a una clase de dirección determinada.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

563

Configuración de dispositivos y redes
1.3 Configurar redes

Máscara de subred
Los bits de la dirección de estación terminal se pueden utilizar para la formación de subredes.
Los bits iniciales representan la dirección de la subred y los demás bits se interpretan como
dirección del ordenador en la subred.
Una subred se define por la máscara de subred. La estructura de la máscara de subred se
corresponde con la de una dirección IP. Si en la máscara de subred está puesto un "1" en una
posición de bit, el bit de la posición correspondiente de la dirección IP pertenece a la dirección
de subred, y en otro caso a la dirección del ordenador.
Ejemplo de una red de clase B:
La dirección de subred estándar para redes de la clase B es 255.255.0.0, con lo que se dispone
de los dos últimos bytes para definir una subred. Si se deben definir 16 subredes, el tercer byte
de la dirección de subred se tiene que poner a 11110000 (representación binaria). En este
caso resulta la máscara de subred 255.255.240.0.
Para constatar si dos direcciones IP pertenecen a la misma subred, se aplica a las dos
direcciones IP y a la máscara de subred una operación lógica Y bit a bit. Si ambas
vinculaciones dan el mismo resultado, las dos direcciones IP pertenecen a la misma subred,
como p. ej. 141.120.246.210 y 141.120.252.108.
La división descrita de la dirección de estación terminal no tiene relevancia fuera de la red local,
siendo de interés sólo la dirección IP en su totalidad para la conmutación de paquetes.
Nota
En la representación en bits de la máscara de subred, los "unos" han de estar puestos con
justificación a la izquierda; es decir, que no debe haber "ceros" entre los "unos".

ICMP
La abreviatura ICMP significa Internet Control Message Protocol (RFC792) y sirve para
intercambiar avisos de error y de información.
● Aviso de error
Informa al remitente del telegrama IP de que al reenviar el telegrama se ha producido un
error o un problema de parametrización.
● Aviso de información
Puede contener información sobre la medición de tiempos, sobre la máscara de
direcciones, sobre la accesibilidad del destino o para localizar el router.

Estructura del paquete de datos ICMP
0

4

8

12

Tipo de paquete ICMP Código
Tipo de aviso

16

20

24

28

31

Suma de verificación

Otros detalles del avi‐
so

Datos (opcional)

564

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Tipo de paquete ICMP
Los principales tipos de paquete ICMP son:
– Redirect
El router comunica al host de una de sus subredes que existe una ruta mejor hasta el
destino. Este tipo de paquete ICMP va a tratarse con más detalle en la descripción
siguiente:
– Destination Unreachable
El telegrama IP no es notificable.
– Time Exceeded
Se ha rebasado el límite de tiempo.
– Echo-Request
Consulta de eco, más conocida como "ping".
● Código
El código describe con más precisión el tipo de paquete ICMP. La selección depende del
tipo de paquete ICMP seleccionado. "Destination Unreachable" significa, p. ej., que no es
posible acceder al host "Code 1".
Encontrará una lista completa de los tipos de paquete ICMP y de los códigos en la página web
de IANA (http://www.iana.org/assignments/icmp-parameters).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

565

Configuración de dispositivos y redes
1.3 Configurar redes

Tipo de paquete ICMP5 - Redirect
El host A quiere enviar un telegrama IP al host C. El host C no se encuentra en la misma subred
que el host A. Por tanto, el host A envía el telegrama IP a su pasarela predeterminada. La
pasarela predeterminada del host A es la interfaz 1 del router A. El router A no puede reenviar
el telegrama IP porque no conoce la red de destino. Sin embargo, mediante su tabla de routing
el router A sabe que a la subred C es posible acceder a través del router B. El router B conecta
la subred A con la subred C. El router A envía al host A un mensaje de Redirect. En él, el router
A da al host A la instrucción de que en el futuro envíe los telegramas IP al host C a través del
router B cuya dirección IP está en el mensaje de Redirect. El router A envía el telegrama IP
inicial directamente al router B, que lo reenvía al host C.



5RXWHU$
+RVW$
,3
*:

,QWHUID]
,3
YODQ

,QWHUID]
,3
YODQ

6XEUHG$ YODQ
6XEUHG% YODQ
5RXWHU%
,QWHUID]
,3
YODQ



,QWHUID]
,3
YODQ

+RVW&
,3
,QGXVWULDO(WKHUQHW

6XEUHG& YODQ

Condiciones para el envío de mensajes de Redirect
● El telegrama IP se recibe y envía por la misma interfaz del router A.
● La dirección IP de origen (host A) está desde la misma subred que la dirección next-hop
(host B) en la tabla de routing.
● El telegrama IP no se ve afectado por una regla source NAT (enmascaramiento, source
NAT o NETMAP).
● Para que el router A reenvíe el telegrama IP inicial al router B se necesita una regla de
cortafuegos vlanX → vlanX.

566

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

VLAN
Definición de red independiente de la ubicación de las estaciones
VLAN (Virtuelles Local Area Network) divide una red física en varias redes lógicas separadas
entre sí. Se forman grupos lógicos de dispositivos. Solo pueden direccionarse entre sí las
estaciones de la misma VLAN. Dado que también los telegramas Multicast y Broadcast solo
pueden enviarse dentro de la VLAN correspondiente, se habla de dominios Broadcast.
De aquí resulta, como ventaja especial de las VLAN, una menor carga de la red para las
estaciones o segmentos de red de otras VLAN.
Para identificar qué paquete está asignado a qué VLAN, el telegrama se amplía con 4 bytes,
consulte VLAN-Tagging (Página 567). Esta ampliación contiene también información de
prioridad, además de la ID de VLAN.

Posibilidades de asignación a VLAN
Hay diferentes posibilidades de asignación a VLAN:
● VLAN basada en puerto
A cada puerto de un dispositivo se le asigna una ID de VLAN. Una VLAN basada en puerto
se configura en "Layer 2 > VLAN > VLAN basada en puerto (Página 687)".
● VLAN basada en protocolo
A cada puerto de un dispositivo se le asigna un grupo de protocolos.
● VLAN basada en subred
A la dirección IP del dispositivo se le asigna una ID de VLAN.

Extensión de los telegramas Ethernet en cuatro byte
Para CoS (Class of Service, priorización de telegramas) y VLAN (red virtual) se ha fijado en la
norma IEEE 802.1Q la extensión de los telegramas Ethernet con el identificador VLAN.
Nota
El identificador VLAN provoca un aumento de la longitud total permitida del telegrama de 1518
a 1522 bytes.
Se tiene que comprobar si los terminales de la red pueden procesar esa longitud / ese tipo de
telegrama. De no ser así, a esas estaciones sólo se les deberán enviar telegramas de longitud
estándar.
Los 4 bytes adicionales se encuentran en el encabezado del telegrama Ethernet, entre la
dirección de origen y el campo de tipo / longitud Ethernet:
Los bytes adicionales contienen el Tag Protocol Identifier (TPID) y la Tag Control Information
(TCI).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

567

Configuración de dispositivos y redes
1.3 Configurar redes

3UH£PEXOR
E\WHV

'LUHFFLµQGH 'LUHFFLµQGH
GHVWLQR
RULJHQ
E\WHV
E\WHV

73,'
E\WHV

7&,
E\WHV

7LSR
E\WHV

'DWRV
aE\WHV

&5&
E\WHV

[
3ULRULW\
ELWV

9/$1,' ELWV
&), ELW

Tag Protocol Identifier (TPID)
Los primeros 2 bytes forman el Tag Protocol Identifier (TPID) y están ocupados de forma fija
con 0x8100. Este valor indica que el paquete de datos contiene información VLAN o
indicaciones de prioridad.

Tag Control Information (TCI)
Los 2 bytes de la Tag Control Information (TCI) contienen la siguiente información:
Priorización CoS
En el telegrama con tag hay 3 bits para la prioridad, que también se denominan Class of
Service (CoS), consulte también IEEE 802.1Q.
Bits CoS

Prioridad

Tipo del tráfico de datos

000

0 (mínima)

Background (segundo plano)

001

1

Best Effort

010

2

Excellent Effort

011

3

Critical Applications (Aplicaciones críticas)

100

4

Video, < 100 ms retardo (latencia y jitter)

101

5

Voice (idioma), < 10 ms retardo (latencia y jitter)

110

6

Internetwork Control

111

7 (máxima)

Network Control

La priorización de los paquetes de datos presupone una cola de espera en los componentes,
en la que puede guardar temporalmente los paquetes de datos de menor prioridad.
El dispositivo dispone de varias colas de espera paralelas, en las que se procesan los
telegramas de diferente prioridad. Con el ajuste predeterminado se procesan primero los
telegramas de prioridad máxima. Este procedimiento garantiza que los telegramas de mayor
prioridad se envíen en cualquier caso, incluso si la cantidad de datos es elevada.
Canonical Format Identifier (CFI)

568

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
El CFI se necesita para la compatibilidad entre Ethernet y Token Ring.
Los valores tienen el siguiente significado:
Valor

Significado

0

El formato de la dirección MAC es canónico. En la representación canónica de la dirección
MAC primero se transmite el bit de menor valor. Ajuste estándar para switches Ethernet.

1

El formato de la dirección MAC no es canónico.

ID de VLAN
En el campo de datos de 12 bits se pueden formar hasta 4096 IDs de VLAN. En ese caso rigen
las siguientes especificaciones:
ID de VLAN

Significado

0

El telegrama sólo contiene información sobre la prioridad (Priority Tagged Frames),
pero no contiene un identificador VLAN válido.

1 - 4094

Identificador VLAN válido, el telegrama está asignado a una VLAN, puede contener
también información sobre la prioridad.

4095

Reservado

SNMP
SNMP
Introducción
El Simple Network Management Protocol (SNMP) permite vigilar y controlar componentes de
red, p. ej. routers o switches, desde una estación central. El SNMP regula la comunicación
entre los dispositivos vigilados y la estación de vigilancia.
Tareas de SNMP:
● Vigilancia de componentes de red
● Control remoto y parametrización remota de componentes de red
● Detección y notificación de errores
Las versiones v1 y v2 de SNMP no disponen de mecanismos de seguridad. Todos los usuarios
de la red pueden acceder a los datos con el software adecuado e incluso modificar
parametrizaciones.
Para controlar derechos de acceso de forma sencilla sin aspectos de seguridad se utilizan
Community Strings.
El Community String se transmite junto con la petición. Si el Community String es correcto, el
agente SNMP responde y envía los datos solicitados. Si el Community String no es correcto,
el agente SNMP rechaza la petición. Para los derechos de lectura y escritura se definen
diferentes Community Strings. Los Community Strings se transmiten en texto claro.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

569

Configuración de dispositivos y redes
1.3 Configurar redes
Valores estándar de los Community Strings:
● public
dispone solo de derechos de lectura
● private
dispone de derechos de lectura y escritura
Nota
Puesto que los SNMP Community Strings son una protección de acceso, no deben
utilizarse los valores estándar "public" ni "private". Modifique estos valores después de la
primera puesta en marcha.
Otros mecanismos de protección sencillos a nivel de dispositivo:
● Allowed Host
El sistema vigilado conoce las direcciones IP de los sistemas que vigilan.
● Read Only
Si se asigna "Read Only" a un dispositivo vigilado, las estaciones de vigilancia podrán leer
los datos, pero no modificarlos.
Los paquetes de datos SNMP no están codificados y es muy fácil leerlos.
La estación central también se denomina estación de gestión. Los dispositivos que deben
vigilarse tienen instalado un agente SNMP, con el que la estación de gestión intercambia datos.
La estación de gestión envía paquetes de datos del tipo siguiente:
● GET
Solicitar un juego de datos del agente SNMP
● GETNEXT
Llama el próximo juego de datos.
● GETBULK (disponible a partir de SNMPv2c)
Solicita varios juegos de datos al mismo tiempo, p. ej. varias filas de una tabla.
● SET
Contiene datos de parametrización para el dispositivo correspondiente.
El agente SNMP envía paquetes de datos del tipo siguiente:
● RESPONSE
El agente SNMP devuelve los datos solicitados por el administrador.
● TRAP
Cuando se produce un evento determinado, el agente SNMP envía traps por su cuenta.
SNMPv1/v2c/v3 utilizan UDP (User Datagram Protocol) y los puertos UDP 161 y 162. Los
datos se describen en una Management Information Base (MIB).

SNMPv3
En comparación con las versiones anteriores SNMPv1 y SNMPv2c, SNMPv3 incorpora un
amplio concepto de seguridad.

570

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
SNMPv3 soporta:
● Autenticación de usuarios completamente codificada
● Codificación de todo el tráfico de datos
● Control de acceso de los objetos MIB a nivel de usuario/grupo
Con la introducción de SNMPv3 ya no es posible transferir sin más configuraciones de usuario
a otros dispositivos, p. ej. cargando un archivo de configuración o intercambiando el C-PLUG.
De acuerdo con la norma, el protocolo SNMPv3 utiliza una ID unívoca del equipo SNMP como
identificador interno de un agente SNMP. Esta ID debe ser inequívoca dentro de la red. Se
utiliza para autenticar y codificar los datos de acceso de usuarios SNMPv3.
En función de si la función "Migración de usuarios SNMPv3" está activada o desactivada, la ID
de equipo SNMP se genera de formas distintas.
Restricción en el uso de la función
La función "Migración de usuarios SNMPv3" solo debe utilizarse para transferir los usuarios
SNMPv3 configurados a un dispositivo de reemplazo en caso de repuesto.
No utilice esta función para transferir los usuarios SNMPv3 configurados a varios dispositivos.
Si se carga una configuración con usuarios SNMPv3 creados en varios dispositivos, estos
utilizarán la misma ID de equipo SNMP. En caso de que dichos dispositivos funcionen en la
misma red, su configuración contradecirá la norma SNMP.
Compatibilidad con productos antecesores
Los usuarios SNMPv3 solo pueden transferirse a otro dispositivo si se han creado como
usuarios migrables. Para crear un usuario migrable, la función "Migración de usuarios
SNMPv3" debe estar activada en el momento de crear el usuario.

Funciones de seguridad
Administración de usuarios (WBM, CLI)
Sinopsis de la administración de usuarios
El acceso al dispositivo se gestiona mediante ajustes de usuario configurables. Configure
usuarios con las contraseñas correspondientes para la autenticación. Asigne a los usuarios
una función con los derechos adecuados.
La autenticación de usuarios se realiza bien localmente desde el dispositivo bien desde un
servidor RADIUS externo. La forma en que debe llevarse a cabo la autenticación se configura
en la página "Security> AAA > General".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

571

Configuración de dispositivos y redes
1.3 Configurar redes

Inicio de sesión local
El inicio de sesión local de los usuarios desde el dispositivo funciona del siguiente modo:
1. El usuario inicia sesión en el dispositivo con su nombre de usuario y su contraseña.
2. El dispositivo comprueba si hay una entrada para el usuario:
→ Si existe la entrada en cuestión, se inicia la sesión del usuario con los derechos de la
función vinculada.
→ Si no existe ninguna entrada, se deniega el acceso al usuario.

Inicio de sesión mediante un servidor RADIUS externo
RADIUS (Remote Authentication Dial-In User Service) es un protocolo de autenticación y
autorización de usuarios mediante servidores en los que se pueden almacenar los datos de
usuario de forma centralizada.
En función del modo de autorización RADIUS que se haya ajustado en la página "Security >
AAA > Cliente RADIUS", el dispositivo evaluará una información u otra del servidor RADIUS.
Modo de autorización RADIUS "conventional"
Si se ha ajustado el modo de autorización RADIUS "conventional", la autenticación de usuarios
mediante un servidor RADIUS funciona del siguiente modo:
1. El usuario inicia sesión en el dispositivo con su nombre de usuario y su contraseña.
2. El dispositivo envía una petición de autenticación al servidor RADIUS con los datos de inicio
de sesión.
3. El servidor RADIUS comprueba los datos y devuelve el resultado al dispositivo:
– El servidor RADIUS notifica una autenticación correcta y devuelve el valor
"Administrative User" al dispositivo para el atributo "Service Type":
→ El usuario inicia sesión con derechos de administrador.
– El servidor RADIUS notifica una autenticación correcta y devuelve un valor distinto o
incluso ninguno al dispositivo para el atributo "Service Type":
→ El usuario inicia sesión con derechos de lectura.
– El servidor RADIUS notifica una autenticación errónea al dispositivo:
→ Al usuario se le niega el acceso.
Modo de autorización RADIUS "SiemensVSA"
Requisitos
Para el modo de autorización RADIUS "SiemensVSA" debe ajustarse lo siguiente en el
servidor RADIUS:
● Código del fabricante: 4196
● Número de atributo: 1
● Formato de atributo: secuencia de caracteres (nombre del grupo)
Procedimiento

572

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Si se ha ajustado el modo de autorización RADIUS "SiemensVSA", la autenticación de
usuarios mediante un servidor RADIUS funciona del siguiente modo:
1. El usuario inicia sesión en el dispositivo con su nombre de usuario y su contraseña.
2. El dispositivo envía una petición de autenticación al servidor RADIUS con los datos de inicio
de sesión.
3. El servidor RADIUS comprueba los datos y devuelve el resultado al dispositivo:
Caso A: El servidor RADIUS notifica una autenticación correcta y devuelve el grupo
asignado al usuario al dispositivo.
– El dispositivo conoce el grupo y el usuario no está registrado en la tabla "External User
Accounts".
→ El usuario inicia sesión con los derechos del grupo asignado.
– El dispositivo conoce el grupo y el usuario está registrado en la tabla "External User
Accounts".
→ El usuario se asigna a la función con los derechos más amplios e inicia sesión con
estos derechos.
– El dispositivo no conoce el grupo y el usuario está registrado en la tabla "External User
Accounts":
→ El usuario inicia sesión con los derechos de la función vinculada a su cuenta de
usuario.
– El dispositivo no conoce el grupo y el usuario no está registrado en la tabla "External
User Accounts":
→ El usuario inicia sesión con los derechos de la función "Default".
Caso B: El servidor RADIUS notifica una autenticación correcta pero no devuelve ningún
grupo al dispositivo:
– El usuario está registrado en la tabla "External User Accounts":
→ El usuario inicia sesión con los derechos de la función vinculada.
– El usuario no está registrado en la tabla "External User Accounts":
→ El usuario inicia sesión con los derechos de la función "Default".
Caso C: El servidor RADIUS notifica una autenticación errónea al dispositivo:
– Al usuario se le niega el acceso.

Cortafuegos
Cortafuegos
Las funciones de seguridad del dispositivo incluyen un Stateful Inspection Firewall. Se trata de
un método para filtrar o comprobar paquetes.
Los paquetes IP se comprueban de acuerdo con reglas de cortafuegos en las que se especifica
lo siguiente:
● los protocolos permitidos
● las direcciones IP y los puertos de los orígenes permitidos
● las direcciones IP y los puertos de los destinos permitidos

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

573

Configuración de dispositivos y redes
1.3 Configurar redes
Cuando un paquete IP concuerda con los parámetros especificados, pasa el cortafuegos.
También se determina lo que sucede con los paquetes IP que no pasan el cortafuegos.
Las técnicas sencillas de filtrado de paquetes requieren dos reglas de cortafuegos por
conexión.
● Una regla para el sentido de consulta desde el origen hasta el destino.
● Una segunda regla para el sentido de respuesta desde el destino hasta el origen.

Stateful Inspection Firewall
Solo es necesario definir una regla de cortafuegos para el sentido de consulta desde el origen
hasta el destino. La segunda regla se agrega de forma implícita. El filtro de paquetes memoriza
la comunicación de un equipo "A" a un equipo "B", por ejemplo, y solo permite respuestas a la
misma. Esto significa que no es posible una consulta del equipo "B" sin una solicitud previa por
parte del equipo "A".
El cortafuegos se configura en "Seguridad > Cortafuegos".
Nota
Paquetes IP a través de Layer 2 (dentro de la misma VLAN)
Si los paquetes IP se envían desde el dispositivo a través de un puerto switch (Layer 2), no se
comprueban mediante reglas de cortafuegos El cortafuegos no tiene ninguna repercusión
sobre los paquetes que se reenvían a nivel de Layer 2.

Sentidos de comunicación
de

a

Significado

vlan x

vlan x

Acceso desde la subred IP vlan x a la subred IP vlan x.
Ejemplo:
vlan1 (INT) → vlan2 (EXT)
Acceso desde la subred IP local a la subred IP externa.

ppp2

Acceso desde la subred IP a la interfaz WAN del dispositivo.

Dispositivo

Acceso desde subred IP al dispositivo.

SINEMA RC

Acceso a la conexión SINEMA RC desde la subred IP.

IPsec (all)

Acceso desde la subred IP a los interlocutores de túnel VPN a los que se
puede acceder a través de todas las conexiones VPN (all) o a través de
una conexión VPN determinada <Connection Name>.

IPsec <Connection
Name>
OpenVPN (all)
OpenVPN <Connec‐
tion Name>

574

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
de

a

Significado

Dispositivo

vlan x

Acceso desde el dispositivo a la subred IP.

ppp2

Acceso desde el dispositivo a la interfaz WAN del dispositivo.

SINEMA RC

Acceso a la conexión SINEMA RC desde el dispositivo.

IPsec (all)

Acceso desde el dispositivo a los interlocutores de túnel a los que se puede
acceder a través de todas las conexiones VPN (all) o a través de una
conexión VPN determinada <Connection Name>.

IPsec <Connection
Name>
OpenVPN (all)
OpenVPN <Connec‐
tion Name>
SINEMA RC

vlan x

Acceso desde conexiones SINEMA RC a la subred IP.

ppp2

Acceso desde la subred IP a la interfaz WAN del dispositivo.

Dispositivo

Acceso desde conexiones SINEMA RC al dispositivo.

IPsec (all)

Acceso desde el servidor SINEMA RC a los interlocutores de túnel VPN a
los que se puede acceder a través de todas las conexiones VPN (all) o a
través de una conexión VPN determinada <Connection Name>.

IPsec <Connection
Name>
OpenVPN (all)
OpenVPN <Connec‐
tion Name>
IPsec (all)

vlan x

Acceso a la subred IP a través de interlocutor de túnel VPN.

IPsec <Connection Na‐ ppp2
me>
Dispositivo
OpenVPN (all)
SINEMA RC

Acceso desde la subred IP a la interfaz WAN del dispositivo.

ppp0/usb

vlan x

Acceso desde la interfaz de telefonía móvil a la subred IP.

Device

Acceso desde la interfaz de telefonía móvil al dispositivo.

SINEMA RC

Acceso desde la interfaz de telefonía móvil a la conexión SINEMA RC.

IPsec (all)

Acceso desde la interfaz de telefonía móvil a los interlocutores de túnel
VPN a los que se puede acceder a través de todas las conexiones VPN
(all) o a través de una conexión VPN determinada <Connection Name>.

OpenVPN <Connec‐
tion Name>

IPsec <Connection
Name>

Acceso al dispositivo a través de interlocutor de túnel VPN.
Acceso a la conexión SINEMA RC a través interlocutores de túnel VPN.

OpenVPN (all)
OpenVPN <Connec‐
tion Name>

Reglas de cortafuegos
Las reglas de cortafuegos son reglas IP para el tráfico de datos que se han creado
automáticamente, están predefinidas o se han configurado manualmente.

Reglas de cortafuegos creadas automáticamente
Para las funciones siguientes está disponible el ajuste "Reglas del cortafuegos automáticas":
● Sistema > SINEMA RC (Página 672)
● Seguridad > IPsec VPN> Fase 2 (Página 738)
● Seguridad > Cliente OpenVPN > Conexiones (Página 740)
Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

575

Configuración de dispositivos y redes
1.3 Configurar redes
Las reglas de cortafuegos creadas automáticamente permiten paquetes en el sentido
siguiente:
de

a

SINEMA RC

IPsec VPN

OpenVPN

Interna

Externa

✓

✓

✓

Externa

Interna

✓

✓

✓

Dispositivo

Externa

--

--

✓

Externa

Dispositivo

Reglas IPv4 predefinidas
Cuando se crea la conexión se activan los siguientes ser‐
vicios IPv4:
HTTP

Ping

Ping

HTTPS
SSH
Ping

Reglas de cortafuegos predefinidas
El cortafuegos contiene reglas IPv4 predefinidas que habilitan determinados servicios IPv4 en
el dispositivo.
En "Seguridad > Cortafuegos > Reglas IPv4 predefinidas (Página 721)" se especifica la
interfaz a través de la cual se realiza el acceso.
Existen las siguientes posibilidades:
● VLANx: VLAN con subred configurada
● Interfaz WAN del dispositivo: pppx, usb0
● Conexión VPN: SINEMA RC, IPsec y OpenVPN
Ajuste de fábrica
El cortafuegos está activado por defecto. En estado de suministro (configuración de fábrica),
las reglas IPv4 predefinidas presentan la configuración siguiente:
Servicio

Acceso
Acceso local (vlan1) al dispositi‐ Acceso externo (vlan2) al dispo‐
vo
sitivo

576

Cloud Connector

✓

-

DHCP

✓

✓

DNS

✓

--

HTTP

✓

--

HTTPS

✓

--

IPsec VPN

--

✓

Ping

✓

--

SMS-Relay (solo con M87x)

✓

--

SNMP

✓

--

SSH

✓

--

Hora del sistema

--

--

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Servicio

Acceso
Acceso local (vlan1) al dispositi‐ Acceso externo (vlan2) al dispo‐
vo
sitivo

Telnet

✓

--

VRRP

--

--

NAT
NAT (Network Address Translation) es un método para transcribir direcciones IP en paquetes
de datos. Esto permite conectar entre sí redes diferentes (internas y externas).
Se diferencia entre source NAT, en el que se transcribe la dirección IP de origen, y destination
NAT, en el que se transcribe la dirección IP de destino.
Encontrará más información sobre escenarios NAT que pueden realizarse con el dispositivo
en la dirección (https://support.industry.siemens.com/cs/gb/en/view/109744660) siguiente:

Enmascaramiento IP
El enmascaramiento IP es un source NAT simplificado. En cada paquete de datos saliente que
se envía a través de esta interfaz se sustituye la dirección IP de origen por la dirección IP de
la interfaz. El paquete de datos adaptado se envía a la dirección IP de destino. Al host de
destino le parece que todas las solicitudes provienen del mismo remitente. A las estaciones
internas no es posible acceder directamente desde la red externa. NAPT permite acceder a los
servicios de las estaciones internas a través de la dirección IP externa del dispositivo.
El enmascaramiento IP se utiliza cuando las direcciones IP internas no pueden o no deben
reenviarse externamente, p. ej. porque la estructura de la red interna debe permanecer oculta.
El enmascaramiento se configura en "Layer 3" > "NAT" > "Enmascaramiento IP".

NAPT
NAPT (Network Address and Port Translation) es una forma de destination NAT que con
frecuencia se denomina también "reenvío por puerto" (Port Forwarding). Permite que sean
accesibles desde fuera servicios de las estaciones internas que están ocultos por
enmascaramiento IP o por source NAT.
Se convierten paquetes de datos entrantes procedentes de la red externa y destinados a una
dirección IP externa del dispositivo (dirección IP de destino). La dirección IP de destino es
sustituida por la dirección IP de la estación interna. Además de convertirse la dirección es
posible convertir el puerto.
Existen las posibilidades siguientes para convertir puertos:
de

a

Comportamiento

un solo puer‐ el mismo puerto
to

Si los puertos son iguales, los telegramas se reenvían sin conver‐
sión de puerto.

un solo puer‐ un solo puerto
to

Los telegramas se convierten al puerto.

un rango de
puertos

Los telegramas del rango de puertos se convierten al mismo puerto
(n:1).

un solo puerto

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

577

Configuración de dispositivos y redes
1.3 Configurar redes
de

a

Comportamiento

un rango de
puertos

el mismo rango
de puertos

Si los rangos de puertos son iguales, los telegramas se reenvían sin
conversión de puerto.

un rango de
puertos

otro rango de
puertos

Los telegramas se convierten a un puerto libre cualquiera de la zona
de destino.
En las conexiones individuales se suele convertir al primer puerto
de la zona de destino.
En las conexiones simultáneas se convierte a un puerto libre de la
zona de destino mediante un método round robin.

un solo puer‐ un rango de puer‐ Los telegramas se convierten a un puerto libre cualquiera de la zona
to
tos
de destino. En las conexiones individuales se suele convertir al pri‐
mer puerto de la zona de destino. En las conexiones simultáneas se
convierte a un puerto libre de la zona de destino mediante un mé‐
todo round robin.

Port Forwarding (reenvío por puerto) se utiliza para permitir a estaciones externas acceder a
determinados servicios de la red interna, p. ej., FTP, HTTP.
NAPT se configura en "Layer 3" > "NAT" > "NAPT".

Source NAT
Al igual que en el enmascaramiento, en source NAT se transcribe la dirección de origen.
Además es posible restringir los paquetes de datos salientes. Existen restricciones a
determinadas direcciones IP o áreas de direcciones IP y restricciones a determinadas
interfaces.
Se utiliza source NAT cuando las direcciones IP internas no pueden o no deben reenviarse
externamente, p. ej. porque se utiliza un área de direcciones IP privada como 192.168.x.x.
NAPT se configura en "Layer 3" > "NAT" > "Source NAT".

NETMAP
NETMAP permite convertir subredes completas en otra subred. En esta conversión se
modifica la parte de la subred que corresponde a la dirección IP y se mantiene la parte que
corresponde al host. En NETMAP la conversión solo necesita una regla. NETMAP puede
convertir tanto la dirección IP de origen como la dirección IP de destino. Para realizar la
conversión con destination NAT o source NAT se necesitarían muchas reglas. También es
posible utilizar NETMAP en conexiones VPN.
NETMAP se configura en "Layer 3" > "NAT" > "NETMAP".

NAT y cortafuegos
El cortafuegos y el router NAT apoyan el mecanismo "Stateful Inspection". Cuando está
habilitado el tráfico de datos IP desde el interior al exterior, las estaciones internas pueden
iniciar una conexión de comunicación con la red externa.
Los telegramas de respuesta procedentes de la red externa pueden pasar el router NAT y el
cortafuegos sin que sus direcciones se tengan que adoptar adicionalmente en la regla de
cortafuegos ni en la conversión de direcciones de NAT. Los telegramas que no son respuesta
a una solicitud procedente de la red interna se rechazan sin la pertinente regla de cortafuegos.

578

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Conversión NAT y reglas de cortafuegos
Encontrará un ejemplo de conversiones NAT en las páginas de Internet del Siemens Industry
Online Support:
Link: (https://support.industry.siemens.com/cs/ww/es/view/109744660)

Certificados
Tipos de certificado
El dispositivo utiliza diferentes certificados para autenticar a las distintas estaciones.
Certificado
Certificado CA

Se utiliza en ...
El certificado CA es un certificado emitido por una entidad emisora, llamada
"Certificate Authority", y de él se derivan los certificados de servidor, dispo‐
sitivo e interlocutor. Para permitir la derivación de certificados, el certificado
CA contiene una clave privada firmada por la entidad emisora.

IPsec VPN

El intercambio de claves entre el dispositivo y la pasarela VPN del interlocutor
se realiza de forma automática al establecer la conexión. No es necesario un
intercambio manual de archivos de claves.
Certificado de ser‐ Los certificados de servidor son necesarios para establecer una comunica‐
vidor
ción segura (p. ej. HTTPS, VPN ...) entre el dispositivo y otra estación de la
red. El certificado de servidor es un certificado SSL codificado. El certificado
de servidor se deriva del CA válido más antiguo, aunque esté "sin servicio".
El factor decisivo es la fecha de validez del CA.

SINEMA RC (Pági‐
na 672)

Certificado de dis‐ Certificados con la clave privada (key file) con la que se identifica el disposi‐ IPsec VPN
positivo
tivo.
Certificado de in‐
terlocutor

Certificados con los que la pasarela VPN del interlocutor se autentica en el
dispositivo.

IPsec VPN

Tipos de archivo
Tipo de archivo Descripción
*.crt

Archivo que contiene el certificado.

*.p12

En el archivo de certificado PKCS12 se guarda la clave privada con el certificado
correspondiente, protegidos por contraseña.
La CA crea un archivo de certificado (PKCS12) con la terminación ".p12" para cada
interlocutor de una conexión VPN. Este archivo de certificado contiene las claves
pública y privada de la propia estación, el certificado firmado de la CA y la clave
pública de la CA.

*.pem

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Certificado y clave en forma de texto ASCII con codificación Base64.

579

Configuración de dispositivos y redes
1.3 Configurar redes

VPN
Sinopsis
El dispositivo soporta los sistemas VPN siguientes:
● IPsec VPN (solo para SCALANCE S615 y SCALANCE SC64x-2C)
● OpenVPN (solo para SCALANCE S615)

IPsec VPN
Las conexiones IPsec se configuran en "Security" > "IPsec VPN".
En IPsec VPN los telegramas se transfieren en modo de túnel. Para que el dispositivo pueda
crear un túnel VPN, la red remota debe disponer de una pasarela VPN como estación
interlocutora.
Para las conexiones VPN, el dispositivo distingue entre dos modos:
● Modo Roadwarrior
En este modo se predetermina la dirección fija del interlocutor o se registra un rango IP
desde el que se aceptan conexiones. El dispositivo aprende del interlocutor qué subredes
remotas son accesibles.
● Modo estándar
En este modo son fijas la dirección del interlocutor o la subred remota. El dispositivo puede
establecer la conexión VPN activamente en calidad de cliente VPN o bien esperar
pasivamente el establecimiento de la conexión por parte del interlocutor.

El procedimiento IPsec
El dispositivo utiliza para el túnel VPN el procedimiento IPsec en modo de túnel. Los
telegramas que deben transferirse se encriptan por completo y se proveen de un nuevo
encabezado antes de enviarlos a la pasarela VPN del interlocutor. El interlocutor descifra los
telegramas recibidos y los reenvía al destinatario.
El procedimiento IPsec utiliza diferentes protocolos para la protección:
● El IP Authentication Header (AH) lleva a cabo la autenticación e identificación del origen.
● La Encapsulation Security Payload (ESP) encripta los datos.

580

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● La Security Association (SA) incluye disposiciones que han sido negociadas entre las
partes, p. ej., sobre la duración de la clave, el algoritmo de encriptado, el tiempo que resta
hasta una nueva autenticación, etc.
● Internet Key Exchange (IKE) es un procedimiento de intercambio de claves. El intercambio
de claves se realiza en dos fases:
– Fase 1
En esta fase no se dispone aún de servicios de seguridad como encriptación,
autenticación y comprobación de integridad, puesto que aún no se han creado las
claves necesarias ni la IPsec SA. La fase 1 sirve para establecer un túnel VPN seguro
para la fase 2. Para ello, los interlocutores de comunicación negocian una ISAKMP
Security Association (ISAKMP-SA) que define los servicios de seguridad necesarios
(algoritmos utilizados, métodos de autenticación). Así se protegen los sucesivos
mensajes y la fase 2.
– Fase 2
La fase 2 sirve para negociar la IPsec-SA necesaria. De manera similar a la fase 1,
mediante la oferta recíproca se adopta un acuerdo sobre los métodos de autenticación,
los algoritmos y los procedimientos de encriptación para proteger los paquetes IP con
IPsec AH e IPsec ESP.
Se protege el intercambio de mensajes a través de ISAKMP-SA acordado en la fase 1.
Mediante la ISAKMP SA negociada en la fase 1 se dispone de la identidad de las
estaciones y del método de comprobación de integridad.

Método de autenticación
● Certificado CA, certificados de dispositivo y de interlocutor (firmas digitales)
El empleo de certificados es un sistema de encriptación asimétrico en el que cada estación
(dispositivo) dispone de una pareja de claves. Cada dispositivo posee una clave privada
secreta y una clave pública del interlocutor. La clave privada permite autenticarse y generar
firmas digitales.
● Preshared Key
El empleo de una preshared key es un sistema de encriptación simétrico. Cada estación
posee una sola clave secreta para la codificación y descodificación de paquetes de datos.
La autenticación se realiza mediante una contraseña común.

ID local e ID remota
La ID local y la ID remota son utilizadas por IPsec para identificar de forma unívoca a los
interlocutores (punto final VPN) al establecer la conexión VPN.

Método de encriptado
Se soportan los siguientes métodos de encriptado. La selección depende de la fase y del
procedimiento de intercambio de claves (IKE):
Phase 1

Phase 2

IKEv1

IKEv2

IKEv1

IKEv2

3DES

x

x

x

x

AES128 CBC

x

x

x

x

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

581

Configuración de dispositivos y redes
1.3 Configurar redes
Phase 1

Phase 2

IKEv1

IKEv2

IKEv1

IKEv2

AES192 CBC

x

x

x

x

AES256 CBC

x

x

x

x

AES128 CTR

-

x

x

x

AES192 CTR

-

x

x

x

AES256 CTR

-

x

x

x

AES128 CCM 16

-

x

x

x

AES192 CCM 16

-

x

x

x

AES256 CCM 16

-

x

x

x

AES128 GCM 16

-

x

x

x

AES192 GCM 16

-

x

x

x

AES256 GCM 16

-

x

x

x

x: soportado
-: no soportado

Cifra predeterminada
Al establecer la conexión es posible transmitir al interlocutor de la conexión VPN una lista
prefijada. La lista incluye combinaciones de los tres algoritmos (Encryption, Authentication,
Key Derivation). Para establecer una conexión VPN el interlocutor de la conexión VPN debe
soportar al menos una de dichas combinaciones. Las combinaciones dependen de la fase y del
procedimiento de intercambio de claves (IKE):
Combinación
Encriptación

Phase 1

Autenticación Derivación de cla‐
ves

IKEv1

Phase 2
IKEv2

IKEv1

IKEv2

AES128

SHA1

DH Group 14

x

x

x

x

AES256

SHA512

DH Group 16

x

x

x

x

AES128 CCM 16

SHA256

DH Group 14

-

x

x

x

AES256 CCM 16

SHA512

DH Group 16

-

x

x

x

AES128

SHA1

none

-

-

x

x

AES256

SHA512

none

-

-

x

x

AES128 CCM 16

SHA256

none

-

-

x

x

AES256 CCM 16

SHA512

none

-

-

x

x

x: La combinación forma parte de la cifra predeterminada
-: La combinación no forma parte de la cifra predeterminada
none: para la fase 2 no se intercambia ninguna clave separada. Por tanto, Perfect Forward Secrecy (PFS) está desactivado.

582

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Requisitos exigidos al interlocutor VPN
El interlocutor VPN debe soportar IPsec con la configuración siguiente con el fin de establecer
correctamente una conexión IPsec:
● Autenticación mediante certificados de interlocutor, certificados CA o preshared key.
● IKEv1 o IKEv2
● Ser compatible al menos con uno de los grupos DH siguientes: grupos Diffie-Hellman 1, 2,
5 y 14 - 18
● encriptación 3DES o AES
● MD5, SHA1, SHA256, SHA384 o SHA512
● Modo Túnel
Si el interlocutor VPN está detrás de un router NAT, el interlocutor debe ser compatible con
NAT-T. Otra posibilidad es que el router NAT conozca el protocolo IPsec (IPsec/VPN
Passthrough).

NAT Traversal (NAT-T)
Es posible que entre el dispositivo y la pasarela VPN de la red remota haya un router NAT. No
todos los routers NAT dejan pasar telegramas IPsec. Por ello, para que puedan pasar el router
NAT puede ser necesario encapsular los telegramas IPsec en paquetes UPD.

Dead Peer Detection
Es imprescindible que el interlocutor VPN sea compatible con DPD. DPD comprueba si la
conexión continúa operando sin perturbaciones o se ha se producido una interrupción en la
línea. Sin DPD es necesario esperar hasta que caduque la vigencia de SA o hasta que se
reinicie manualmente la conexión, según sea la configuración. Para comprobar si la conexión
IPsec continúa operando sin perturbaciones, el propio dispositivo envía consultas PDP al
interlocutor VPN. Si el interlocutor VPN no responde, una vez transcurrido un tiempo
determinado se considera que la conexión con el interlocutor VPN no es válida. Los ajustes de
DPD se configuran en la fase 1.

OpenVPN
OpenVPN permite construir redes privadas virtuales (VPN). El dispositivo puede establecer
una conexión VPN con una red remota actuando como cliente OpenVPN.
El cliente OpenVPN se configuran en "Seguridad" > "Cliente OpenVPN".
La conexión VPN se establece mediante drivers de dispositivo virtuales, el dispositivo TAP y
el dispositivo TUN. Se crean interfaces de red virtuales que actúan como una interfaz física del
dispositivo y representan el punto final del túnel VPN.
El dispositivo soporta lo siguiente:
● dispositivo TUN: modo Routing
La interfaz LAN y la interfaz de red virtual están en subredes IP distintas. El servidor
OpenVPN asigna a la interfaz de túnel virtual una dirección IP virtual desde una subred
imaginaria. Los paquetes IP (Layer 3) se enrutan entre la interfaz de túnel virtual y la interfaz
LAN.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

583

Configuración de dispositivos y redes
1.3 Configurar redes

Método de autenticación
● Certificados: Certificado CA y certificado de dispositivo
El empleo de certificados es un sistema de encriptación asimétrico. Cada estación
(dispositivo) posee una clave privada secreta y una clave pública del interlocutor. La clave
privada permite autenticarse y generar firmas digitales.
● Nombre de usuario / Contraseña
El acceso se restringe mediante un nombre de usuario y una contraseña.

Método de encriptado
El dispositivo soporta los métodos siguientes:
● BF CBC
● AES128 CBC
● AES192 CBC
● AES256 CBC
● DES EDE3

Establecimiento de la conexión VPN
Para establecer una conexión VPN el dispositivo soporta las posibilidades siguientes.
● OpenVPN: Seguridad > OpenVPN > Conexiones (Página 733)
● IPsec VPN: Seguridad > IPsec VPN > Conexiones (Página 740)
● SINEMA RC: Sistema > SINEMA RC (Página 672)
Posibilidades

Aplicación

Descripción

Ope
nVP
N

IP‐
sec
VPN

SINE‐
MA
RC 1)

Iniciar

x

x

-

El dispositivo está "activo", es decir, intenta establecer una co‐
nexión con un interlocutor. El direccionamiento del interlocutor
se realiza a través de su dirección IP WAN configurada o del
FQDN configurado.

Esperar

-

x

-

El dispositivo es "pasivo", es decir, espera hasta que el interlo‐
cutor inicie el establecimiento de la conexión.

A petición

-

x

-

El dispositivo intenta establecer una conexión con un interlocu‐
tor cuando es necesario. También es posible aceptar peticiones
para establecer una conexión VPN.
Para subredes locales y remotas configuradas se crea una en‐
trada en la tabla de routing. Cuando una estación intenta enviar
paquetes de datos desde una de las redes correspondientes a
través del túnel VPN, se establece la conexión VPN. La cone‐
xión se deshace una vez transcurrido el tiempo de timeout con‐
figurable sin que haya más paquetes del túnel VPN.

584

Iniciar con DI

x

x

x

Esperar a DI

-

x

-

El establecimiento de la conexión se controla a través de de la
entrada digital (DI).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Posibilidades

Aplicación

Descripción

Ope
nVP
N

IP‐
sec
VPN

SINE‐
MA
RC 1)

Auto

-

-

x

El dispositivo aplica la configuración del servidor SINEMA RC.
Los ajustes del servidor SINEMA RC se configuran en "Cone‐
xiones remotas > Dispositivos". Encontrará más información al
respecto en las instrucciones de servicio "Servidor SINEMA
RC".

Permanente

-

-

x

El dispositivo establece una conexión VPN con el servidor SI‐
NEMA RC. El túnel VPN se mantiene permanentemente.

1)

Para SCALANCE S615: Es necesario KEY-PLUG SINEMA REMOTE CONNECT

Entrada digital (DI)
El establecimiento del túnel VPN también puede controlarse a través de de la entrada digital,
p- ej., mediante un pulsador. Cuando el pulsador se cierra hay tensión en la entrada digital y
el LED de la entrada digital está iluminado. El LED iluminado indica que está activada la señal
1 (TRUE / HIGH). La señal 1 dispara en el dispositivo un evento con el que se controla el
establecimiento del túnel VPN. Encontrará información sobre la conexión y la corriente
máxima admisible en el manual de servicio de los dispositivos.

9
',
9
',
Requisitos
● Al producirse el evento "Entrada digital (Página 625)", en "Sistema > Eventos >
Configuración" está activado "Túnel VPN".
Si no está activado este ajuste, el evento no se reenvía a la conexión VPN.
Posibilidades
El dispositivo soporta la siguientes posibilidades de controlar el túnel VPN a través de la
entrada digital:
● Iniciar con DI
Si se produce el evento "Entrada digital", el dispositivo se vuelve "activo". El dispositivo
intenta establecer una conexión VPN (OpenVPN, IPsec, SINEMA RC) con el interlocutor.
● Esperar a DI
Si se produce el evento "Entrada digital", el dispositivo se vuelve "pasivo". El dispositivo
espera hasta que el interlocutor inicie el establecimiento de la conexión.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

585

Configuración de dispositivos y redes
1.3 Configurar redes

Posibilidades de notificación
Si cambia el estado de la entrada digital o de un túnel VPN (IPsec, OpenVPN, SINEMA RC),
el dispositivo ofrece varias posibilidades de notificación en la página "Eventos (Página 625)".
Tipo de notifica‐ En Tú‐
Comportamiento en caso de cambio de estado
ción
tra nel
da VPN
di‐
gi‐
tal
Correo electró‐
nico

x

x

El dispositivo envía un correo electrónico. El correo electrónico contiene la identificación del
dispositivo remitente, una descripción de la causa de la alarma en texto explícito y un sello de
tiempo.
Requisitos:
● Se ha creado un servidor SMTP.
● La función está activada en "Sistema > Cliente SMTP", están configurados un destinatario
y la dirección IP del servidor SMTP.

Trap

x

x

El dispositivo activa un trap SNMP.
Requisitos:
● En "Sistema > Configuración" debe estar activado "SNMPv1 Traps".
● En "Sistema > Configuración > Traps" está configurado un destinatario al que el dispositivo
envía los traps SNMP.

Tabla de regis‐
tro

x

x

El dispositivo escribe una entrada en la tabla de registro de eventos. El contenido de la tabla
se muestra en "Information > Log Table" .

Syslog

x

x

El dispositivo escribe una entrada en el servidor Syslog.
Requisitos:
● Se ha creado un servidor Syslog.
● La función está activada en "Sistema > Cliente Syslog", y está configurada la dirección IP
del servidor Syslog.

LED de error

586

x

-

El LED de error del dispositivo está iluminado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Tipo de notifica‐ En Tú‐
Comportamiento en caso de cambio de estado
ción
tra nel
da VPN
di‐
gi‐
tal
Entrada digital

x

x

Activa la salida digital o señaliza el cambio de estado mediante el LED "DO".
En la salida digital puede estar conectado un consumidor. Encontrará información sobre la
conexión en el manual de servicio de los dispositivos. El consumidor señaliza un cambio de
estado.

9

'2
'2

9

Nota
CLI y SNMP permiten controlar directamente la salida digital. En el WBM y en CLI es posible
configurar la utilización de la salida digital en "Events" No controle directamente la salida digital
si se utiliza en el WBM o en CLI.
Leer el estado
desde la varia‐
ble MIB

x

-

Mediante la variable MIB privada snMspsDigitalInputLevel se puede leer el estado de la en‐
trada digital.
● OID de la variable MIB snMspsDigitalInputLevel privada:
iso(1).org(3).dod(6).internet(1).private(4).enterprises(1).siemen
s(4329).industrialComProducts(20).iComPlatforms(1).simaticNet(1).
snMsps(1).snMspsCommon(1).snMspsDigitalIO(39).snMspsDigitalIOObje
cts(1).snMspsDigitalInputTable(2).snMspsDigitalInputEntry(1).snMs
psDigitalInputLevel(6)
● Valores de la variable MIB
–

1: señal 0 en la entrada digital (DI)

–

2: señal 1 en la entrada digital (DI)

Particularidades de la administración de usuarios para funciones de seguridad
Acceso a funciones de seguridad
Solo se puede acceder a las funciones de seguridad después de activar la protección del
proyecto y después de haber iniciado sesión. El usuario que ha iniciado sesión debe poseer
además los derechos de ingeniería y de runtime necesarios.
Encontrará información fundamental sobre la administración de usuarios en STEP 7 en el
apartado "Utilizar la administración de usuarios" del sistema de información.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

587

Configuración de dispositivos y redes
1.3 Configurar redes

Derechos de ingeniería para dispositivos de seguridad
Estos derechos de ingeniería autorizan el diagnóstico y la configuración de dispositivos de
seguridad:
● Seguridad: Módulos de seguridad con derechos de lectura: Visualizar las funciones de
seguridad globales y los ajustes de seguridad locales de los dispositivos de seguridad.
● Seguridad: Módulos de seguridad con derechos de escritura: Configurar las funciones de
seguridad globales y los ajustes de seguridad locales de los dispositivos de seguridad y
realizar el diagnóstico de los dispositivos de seguridad.

Funciones con derechos de runtime para SCALANCE S-600
Algunas funciones definidas por el sistema con el prefijo "NET" tienen asignados por defecto
derechos de runtime para SCALANCE S-600. Los derechos de runtime proporcionan derecho
a realizar determinadas tareas en los dispositivos. Igual que los derechos de ingeniería, los
derechos de runtime no se pueden modificar para funciones definidas por el sistema. Para las
funciones definidas por el usuario, los derechos de runtime se pueden modificar libremente.
Los derechos de runtime de una función definida por el usuario se definen para cada
dispositivo.
Debe existir como mínimo un usuario con una función asignada con plenos derechos de
runtime para un módulo de seguridad, p. ej. la función definida por el usuario "NET
Administrator".
Las funciones definidas por el sistema con el prefijo "NET" tienen asignados los siguientes
derechos de runtime:
Derecho

NET Admi‐
nistrator

NET
Stan‐
dard

NET
NET Remote
Diagnose
Access

NET Adminis‐
trator Radius

NET Radius

Abrir el proyecto protegido contra escri‐
tura

x

x

x

-

-

-

Abrir el proyecto con derechos de escri‐
tura

x

x

-

-

-

-

Editar ajustes de seguridad: "Ajustes" y
"Usuarios y funciones"

x

-

-

-

-

-

Seguridad: Módulos de seguridad con
derechos de lectura

x

x

x

-

x

x

Seguridad: Módulos de seguridad con
derechos de escritura

x

x

-

-

x

-

Derechos de runtime para SCALANCE S-600
Es posible elegir entre los siguientes derechos de runtime:
Derecho

NET Ad‐
ministra‐
tor

NET
Stan‐
dard

NET
Diagno‐
se

NET Remote
Access

NET Adminis‐
trator Radius

NET Radius

Cargar los archivos de configuración

x

x

-

-

x

-

TIA Portal: Ejecutar el diagnóstico del mó‐
dulo de seguridad

x

x

x

-

x

x

588

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Certificados para funciones de seguridad
En la configuración solo pueden utilizarse certificados generados por el TIA Portal, por
ejemplo, certificados de grupos VPN. Los certificados no generados por el TIA Portal, por
ejemplo los certificados CA para SINEMA Remote Connect, no pueden utilizarse. Tales
certificados deben agregarse a posteriori a través de WBM y cargarse en el dispositivo.
Encontrará más información en el manual de configuración WBM correspondiente.

Editar propiedades y parámetros
Posibilidades de edición
Existen las posibilidades siguientes para editar las propiedades y los parámetros:
● Editor de hardware y redes
Una vez se ha insertado el componente de red, existe la posibilidad de editar las
propiedades y los parámetros, por ejemplo el nombre del dispositivo. Encontrará más
información al respecto en "Editor de hardware y redes".
● Web Based Management (WBM)
Es posible acceder a los parámetros y las propiedades utilizando páginas HTML (páginas
del WBM) suministradas. Cada página del WBM tiene una página de ayuda propia que
describe las propiedades y los parámetros. Encontrará más información en los manuales
de configuración de los dispositivos: Los encontrará en las páginas de Internet del Siemens
Industry Online Support.
● Command Line Interface
La CLI permite especificar todos los ajustes para la configuración del dispositivo. La CLI
ofrece las mismas posibilidades que el Web Based Management (WBM). Encontrará más
información en los manuales de configuración de los dispositivos: Los encontrará en las
páginas de Internet del Siemens Industry Online Support.

Modos de funcionamiento
Existen los siguientes modos de funcionamiento:
● Modo de configuración offline
En este modo solo están disponibles los ajustes que no requieren conectarse al dispositivo.
● Modo de diagnóstico online
Cuando hay una conexión online con el dispositivo, en "Online y diagnóstico" están
disponibles las siguientes páginas adicionales. En la documentación de dichas páginas se
incluye la indicación "Esta página solo está disponible cuando hay conexión online con el
dispositivo". Todos los ajustes incluyen el complemento "Solo disponible online".

Crear y borrar una entrada
A modo de ejemplo se creará y borrará una entrada en el cliente Syslog. El procedimiento es
el mismo en todas las páginas.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

589

Configuración de dispositivos y redes
1.3 Configurar redes
Crear una entrada
1. Seleccione el dispositivo en la vista de redes o dispositivos.
2. Abra las propiedades del dispositivo en la ventana de inspección.
3. En la ventana de inspección, vaya a Sistema > Cliente Syslog.
4. Introduzca la dirección IP del servidor Syslog en Dirección IP.
5. Haga clic en la tabla.
6. Elija la entrada "Nueva entrada" del menú contextual.
En la tabla se crea una nueva entrada.
Borrar una entrada
1. Seleccione la entrada deseada en la tabla.
2. Elija la entrada "Borrar" del menú contextual.

Botones utilizados con frecuencia
● Actualizar la visualización con "Actualizar"
Las páginas que muestran parámetros actuales incluyen el botón "Actualizar" en el borde
inferior. Haga clic en este botón si desea solicitar datos actuales del dispositivo para la
página visualizada.
● Guardar ajustes para todos los puertos con "Aplicar a tabla"
Las páginas en las que pueden configurarse varios puertos tienen 2 tablas. En la primera
tabla se realizan los ajustes de todos los puertos, que se aplican a la segunda tabla. En la
última columna de la primera tabla hay el botón "Aplicar a tabla". Haga clic en el botón para
guardar los ajustes introducidos para todos los puertos.

Mostrar información
Versiones
Esta página muestra las versiones de hardware y software del dispositivo.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

590

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los valores mostrados
La tabla se divide en las siguientes columnas:
● Hardware
– Basic Device
Indica el dispositivo base.
– PX.X
X.X = puerto en el que está insertado el módulo SFP.
– SlotX
"X" = número de slot: Módulo enchufado en este slot.
● Nombre
Indica el nombre del dispositivo o del módulo.
● Versión
Indica la versión de hardware del dispositivo.
● Referencia
Indica la referencia del dispositivo o del módulo descrito.
● Software
– Firmware
Indica la versión actual de firmware. Cuando se haya cargado un archivo de firmware
nuevo y el equipo todavía no se haya reiniciado, aquí se mostrará la versión de firmware
del archivo de firmware que se ha cargado. Tras el siguiente reinicio se activa y utiliza
el firmware que se ha cargado.
– Bootloader
Indica la versión del software de arranque que está guardado en el dispositivo.
– Firmware_Running
Muestra la versión de firmware utilizada en ese momento en el dispositivo.
● Descripción
Muestra una descripción breve del software.
● Versión
Indica el número de versión del software instalado.
● Fecha
Indica la fecha de creación del software instalado.

I&M
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
Esta página contiene datos del fabricante y de mantenimiento específicos del dispositivo,
como la referencia, el número de serie, los números de versión, etc. En esta página no es
posible realizar ajustes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

591

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los valores mostrados
La tabla se divide en las siguientes filas:
● ID de fabricante
Muestra la identificación del fabricante.
● Referencia
Muestra la referencia.
● Número de serie
Muestra el número de serie.
● Versión de hardware
Muestra la versión de hardware.
● Versión de software
Muestra la versión de software.
● Contador de versión
Muestra el contador de cambios de versión: contador de cambios de versión desde la
primera puesta en marcha.
● Fecha de actualización
Fecha y hora del último cambio de versión
● Identificador de función
Muestra el identificador de función (identificador de la instalación) del dispositivo. El
identificador de instalación (AKZ) se establece en la fase de configuración del equipo con
HW Config de STEP 7.
● Identificador de ubicación
Muestra el identificador de ubicación del dispositivo. El identificador de ubicación (OKZ) se
establece en la fase de configuración del equipo con HW Config de STEP 7.
● Fecha
Muestra la fecha que se ha establecido en la fase de configuración del equipo con HW
Config de STEP 7.
● Descripción
Muestra la descripción que se ha establecido en la fase de configuración del equipo con HW
Config de STEP 7.

Tabla ARP
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Asignación de dirección MAC y dirección IP
Por medio del Address Resolution Protocol (ARP) se asigna unívocamente la dirección MAC
a la dirección IPv4. Cada dispositivo de red guarda dicha asignación en su propia tabla ARP.
La página muestra la tabla ARP del dispositivo.

592

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los valores mostrados
La tabla se divide en las siguientes columnas:
● Interfaz
Muestra la interfaz a través de la cual se aprendió la fila.
● Dirección MAC
Muestra la dirección MAC del dispositivo de origen o destino.
● Dirección IP
Muestra la dirección IP del dispositivo de destino.
● Tipo de medio
Muestra el tipo de conexión.
– Dinámico
El dispositivo ha reconocido de forma automática los datos de dirección.
– Estático
Las direcciones fueron registradas como direcciones estáticas.

Tablas de registro
Registro de evento
Protocolización de eventos
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
Esta página muestra los eventos de sistema surgidos en forma de tabla. Algunos de los
eventos de sistema pueden configurarse en "Sistema > Eventos", p. ej. cuándo ha cambiado
el estado de conexión de un puerto.
El contenido de la tabla se conserva también tras desconectar el dispositivo. El archivo de
registro de eventos puede descargarse vía HTTP, TFTP o SFTP.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

593

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los valores mostrados
● Filtro de severidad
Las entradas de la tabla se pueden filtrar en WBM por grado de gravedad. Para visualizar
todas las entradas, active o desactive todos los parámetros.
– Info
Informativo
– Si este parámetro está activado se muestran todas las entradas de la categoría "Info".
– Warning
Con advertencia
Si este parámetro está activado se muestran todas las entradas de la categoría
"Warning".
– Critical
Crítico
Si este parámetro está activado se muestran todas las entradas de la categoría "Critical".
La tabla se divide en las siguientes columnas:
– Rearranque
Cuenta el número de rearranques completos desde la última vez que se restablecieron
los ajustes de fábrica e indica tras qué rearranque del dispositivo se ha producido cada
evento concreto.
– System Up Time
Indica el tiempo de funcionamiento del dispositivo desde el último rearranque, en el que
se produjo el evento descrito.
– Hora del sistema
Cuando está ajustada la hora del sistema, se muestran la fecha y la hora en las que se
ha producido el evento.
Si no hay ajustada ninguna hora del sistema, este campo contiene la indicación "Date/
time not set".
– Severidad
Clasificación de la entrada en las categorías anteriores.
– Aviso de registro
Muestra una descripción abreviada del evento que se ha producido.
Nota
El número de entradas de esta tabla está limitado a 1200. La tabla puede contener 400
entradas para cada Severity. Cuando se alcanza este número, se descartan las entradas más
antiguas de la severidad en cuestión. La tabla se guarda de forma permanente en la memoria.

Security-Log
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

594

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Esta página muestra en una tabla los eventos que se han producido durante la comunicación
por un túnel VPN seguro.

Descripción de los valores mostrados
● Filtros severity
Las entradas de la tabla se pueden filtrar en WBM por grado de gravedad. Para visualizar
todas las entradas, active o desactive todos los parámetros.
– Info
Informativo
Si este parámetro está activado se muestran todas las entradas de la categoría "Info".
– Warning
Con advertencia
Si este parámetro está activado se muestran todas las entradas de la categoría
"Warning".
– Critical
Crítico
Si este parámetro está activado se muestran todas las entradas de las categorías
"Critical".
La tabla se divide en las siguientes columnas:
● Rearranque
Cuenta el número de rearranques completos desde la última vez que se restablecieron los
ajustes de fábrica e indica tras qué rearranque del dispositivo se ha producido cada evento
concreto.
● Tiempo de funcionamiento del sistema
Indica el tiempo de funcionamiento del dispositivo desde el último rearranque, en el que se
produjo el evento descrito.
● Hora del sistema
Cuando está ajustada la hora del sistema, se muestran la fecha y la hora en las que se ha
producido el evento. Si no hay ajustada ninguna hora del sistema, este campo contiene la
indicación "Date/time not set".
● Severity
Clasificación de la entrada en las categorías anteriores.
● Mensaje de registro
Muestra una breve descripción del evento que se ha producido.

Botones
Botón "Vaciar"
Haga clic en este botón para eliminar el contenido del archivo de registro de eventos. Se borran
todas las entradas, independientemente de lo seleccionado en "Filtros severity".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

595

Configuración de dispositivos y redes
1.3 Configurar redes
Con esta acción también se vaciará la visualización. El contador de reinicios solo se reiniciará
cuando se rearranque de nuevo el dispositivo tras el restablecimiento de los ajustes de fábrica.
Nota
El número de entradas de esta tabla está limitado a 1200. La tabla puede contener 400
entradas para cada Severity. Cuando se alcanza este número, se rechazan las entradas más
antiguas de la Severity correspondiente. La tabla se guarda de forma permanente en la
memoria.

Registro de cortafuegos
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
El libro de registro del cortafuegos registra los eventos que se producen en el cortafuegos. Al
crear reglas de cortafuegos existe la posibilidad de especificar la gravedad con la que se
registrarán los eventos.

Descripción de los valores mostrados
● Filtros severity
Las entradas de la tabla se pueden filtrar en WBM por grado de gravedad. Para visualizar
todas las entradas, active o desactive todos los parámetros.
– Info
Informativo
Si este parámetro está activado se muestran todas las entradas de la categoría "Info".
– Warning
Con advertencia
Si este parámetro está activado se muestran todas las entradas de la categoría
"Warning".
– Critical
Crítico
Si este parámetro está activado se muestran todas las entradas de las categorías
"Critical".
La tabla se divide en las siguientes columnas:
● Rearranque
Cuenta el número de rearranques completos desde la última vez que se restablecieron los
ajustes de fábrica e indica tras qué rearranque del dispositivo se ha producido cada evento
concreto.
● Tiempo de funcionamiento del sistema
Indica el tiempo de funcionamiento del dispositivo desde el último rearranque, en el que se
produjo el evento descrito.

596

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Hora del sistema
Cuando está ajustada la hora del sistema, se muestran la fecha y la hora en las que se ha
producido el evento. Si no hay ajustada ninguna hora del sistema, este campo contiene la
indicación "Date/time not set".
● Severity
Clasificación de la entrada en las categorías anteriores.
● Mensaje de registro
Muestra una breve descripción del evento que se ha producido.

Descripción de los botones y campos de entrada
Botón "Vaciar"
Haga clic en este botón para eliminar el contenido del archivo de registro de eventos. Se borran
todas las entradas, independientemente de lo seleccionado en "Filtros severity".
Con esta acción también se vaciará la visualización. El contador de reinicios solo se reiniciará
cuando se rearranque de nuevo el dispositivo tras el restablecimiento de los ajustes de fábrica.
Nota
El número de entradas de esta tabla está limitado a 1200. La tabla puede contener 400
entradas para cada Severity. Cuando se alcanza este número, se rechazan las entradas más
antiguas de la Severity correspondiente. La tabla se guarda de forma permanente en la
memoria.

Error
Estado de error
Cuando se produce un error se muestra en esta página. En el dispositivo los errores se
señalizan mediante la iluminación del LED de error.
Se notifican tanto los errores internos del dispositivo como los errores configurados en las
páginas siguientes:
● "Sistema > Eventos"
● "Sistema > Control de errores"
Los errores del evento "Arranque en frío/en caliente" se pueden borrar con una confirmación.
El cálculo del instante del error empieza después del último inicio de sistema.
Si no hay errores se apaga el LED de error.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

597

Configuración de dispositivos y redes
1.3 Configurar redes

Valores visualizados
● Número de errores notificados
Número de errores visualizados desde el último arranque.
● Botón "Inicializar contador"
Haga clic en "Inicializar contador" para inicializar el contador. El contador se reinicia con un
rearranque completo.
La tabla contiene las siguientes columnas:
● Instante del error
Indica el tiempo de funcionamiento del dispositivo desde el último rearranque, en el que se
produjo el error descrito.
● Descripción del error
Muestra una descripción breve del error ocurrido.
● Borrar estado de error
Si el botón "Borrar estado de error" está activado, el error puede borrarse.

SNMP
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
Esta página muestra los grupos SNMPv3 creados. Los grupos SNMPv3 se configuran en
"System > SNMP".

Descripción de los valores mostrados
La tabla se divide en las siguientes columnas:
● Group Name
Indica el nombre del grupo.
● User Name
Muestra el usuario que está asignado al grupo.

LLDP
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Estado de la tabla de vecindad
Esta página muestra el contenido actual de la tabla de vecindad. En la tabla se guarda la
información que ha recibido el agente LLDP de los dispositivos conectados. En el capítulo
siguiente se especifican las interfaces a través de las que el agente LLDP recibe y envía
información: "Layer 2 > LLDP".

598

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los valores mostrados
La tabla contiene las siguientes columnas:
● Nombre del sistema
Nombre de sistema del dispositivo conectado.
● ID del dispositivo
Identificación del dispositivo conectado. La ID del dispositivo equivale al nombre de
dispositivo asignado desde PST (STEP 7). Si no se ha asignado ningún nombre de
dispositivo se utiliza la dirección MAC del dispositivo.
● Interfaz local
Puerto en el que el dispositivo ha recibido la información.
● Tiempo de almacenamiento
Una entrada se guarda en el dispositivo durante el tiempo que se indica aquí. Si el
dispositivo no recibe información nueva del dispositivo conectado durante dicho tiempo, la
entrada se borra.
● Propiedad
Muestra las propiedades del dispositivo conectado:
– Router
– Bridge
– Telephone
– DOCSIS Cable Device
– WLAN Access Point
– Repeater
– Estación
– Other
● ID de puerto
Puerto del dispositivo que está conectado al dispositivo.

Routing
Introducción
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
Esta página muestra las rutas que se utilizan actualmente.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

599

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los valores mostrados
La tabla se divide en las siguientes columnas:
● Red de destino
Indica la dirección de destino de esta ruta.
● Máscara de subred
Indica la máscara de subred de esa ruta.
● Gateway
Indica la gateway (pasarela) para esa ruta.
● Interfaz
Indica la interfaz para esa ruta.
● Métrica
Indica la métrica de la ruta. Cuanto mayor es el valor, más tardan los paquetes en llegar a
su destino.
● Protocolo de routing
Indica el protocolo de routing del que proviene la entrada de la tabla de routing. Son
posibles las siguientes entradas:
– Connected: Rutas conectadas
– Static: Rutas estáticas
– DHCP: ruta vía DHCP

IPsec VPN
La página indica el estado de las conexiones VPN activadas.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Descripción de los valores mostrados
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre de la conexión VPN.
● Host local
Indica la dirección IP del dispositivo.
● DN local
Indica el Distinguished Name (DN) del dispositivo que ha iniciado sesión en el interlocutor
durante el establecimiento de la conexión. La entrada se toma del campo "Local ID", del
certificado del dispositivo o de la dirección IP del mismo.
● Subred local
Indica la red local.
● Host remoto
Indica la dirección IP o el nombre de host del interlocutor.

600

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● DN remoto
Indica el Distinguished Name (DN) con el que ha iniciado sesión el interlocutor al
establecerse la conexión● Subred remota
Indica la red remota.
● Vida útil de la clave
Indica cuándo caduca la validez de la clave.
● Estado
Indica el estado de la conexión VPN.

SINEMA RC
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
Indica información sobre el servidor SINEMA RC.
Nota
Para SCALANCE S615 está función solo puede utilizare con KEY PLUG.

Descripción de los valores mostrados
● Estado
Indica el estado de la conexión con el servidor SINEMA RC.
● Nombre del dispositivo
Si está configurado se indica el nombre del dispositivo.
● Ubicación del dispositivo
Si está configurado se indica la ubicación del dispositivo.
● Número GSM
Si está configurado se indica el número de teléfono del dispositivo.
● Fabricante
Si está configurado se indica la entrada.
● Comentario
Si está configurado se indica el comentario.
● Tipo de conexión (servidor)
Indica el tipo de conexión que hay configurado con el servidor SINEMA RC.
● Tipo de conexión (dispositivo)
Indica el tipo de conexión que hay configurado en el dispositivo.
● Huella dactilar
Indica la huella dactilar del certificado del servidor. Solo se muestra si se utiliza para
verificar la huella dactilar.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

601

Configuración de dispositivos y redes
1.3 Configurar redes
● Dirección remota
Indica la dirección IP del servidor SINEMA RC.
● Subredes locales conectadas
Indica las direcciones IP de las subredes locales. Solo se muestra si en el servidor SINEMA
RC está activada la opción "Subredes locales conectadas". Encontrará más información al
respecto en las instrucciones de servicio del servidor SINEMA RC.
● Host locales conectados
Indica la dirección IP de destino de los host a los que se puede acceder.
● Dirección de la interfaz tunelada
Indica la dirección IP de la interfaz de túnel virtual.
● Subredes remotas conectadas
Indica las subredes del servidor SINEMA RC que son accesibles para el dispositivo. De las
condiciones de comunicación en el servidor SINEMA RC depende qué subredes son
accesibles para el dispositivo. Encontrará más información al respecto en las instrucciones
de servicio del servidor SINEMA RC.

OpenVPN
La página indica el estado de las conexiones OpenVPN activadas.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Descripción de los valores mostrados
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre de la conexión OpenVPN.
● Servidor remoto
Indica la dirección IP o el nombre de host del servidor OpenVPN.
● Interfaz tunelada IP
Indica la dirección IP de la interfaz de túnel virtual.
● Subredes exportadas
Indica la dirección IP de las subredes locales.
● Subredes enrutadas
Indica las subredes del servidor OpenVPN.
● Estado
Indica el estado de la conexión OpenVPN.

602

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Redundancia
Sinopsis
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Descripción de los valores mostrados
La página contiene los siguientes campos:
● Prioridad Bridge / Prioridad Root
A partir de la prioridad Bridge se determina qué dispositivo pasa a ser Root-Bridge. El
Bridge con la prioridad más alta (es decir, con el valor menor para este parámetro) se
convierte en el Root Bridge. Si en una red hay varios dispositivos con la misma prioridad,
pasa a ser Root Bridge el dispositivo cuya dirección MAC tenga el valor numérico más bajo.
Ambos parámetros, prioridad de Bridge y dirección MAC, forman juntos el identificador
Bridge. Dado que el Root Bridge administra todos los cambios de ruta, debería estar
dispuesto lo más central posible, debido al tiempo de ciclo de los telegramas.
● Dirección Bridge / Dirección Root
La dirección Bridge indica la dirección MAC del dispositivo y la dirección Root indica la
dirección MAC del Root-Bridge.
● Puerto Root
Indica el puerto a través del cual el switch se comunica con el Root-Bridge.
● Costes Root
Los costes de la ruta de este dispositivo hasta el Root-Bridge
● Modificaciones de la topología / Último cambio de topología
Para el dispositivo se indica el número de reconfiguraciones debidas al mecanismo
Spanning Tree desde el último arranque. Para el Root Bridge se indica el tiempo desde la
última reconfiguración del siguiente modo:
– Segundos: Se añade "s" tras la indicación numérica
– Minutos: Se añade "min" tras la indicación numérica
– Horas: Se añade "h" tras la indicación numérica
● Bridge Hello Time / Root Hello Time
Cada Bridge envía periódicamente telegramas de configuración (BPDU). El tiempo
transcurrido entre dos de estos telegramas es el Hello Time.
● Bridge Forward Delay / Root Forward Delay
Un Bridge no utiliza inmediatamente la información nueva de configuración, sino solo
después del tiempo determinado en el parámetro de retardo de reenvío. Así se garantiza
que el funcionamiento con la nueva topología no se inicie hasta que todos los Bridges
tengan las informaciones necesarias. El
● Bridge Max Age / Root Max Age
Una vez transcurrido el temporizador Max Age se rechaza la BPDU recibida. El valor
predeterminado es 20s.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

603

Configuración de dispositivos y redes
1.3 Configurar redes
● Bridge Max Hop Count
Este parámetro indica cuántas estaciones STP deja pasar una BPDU. Si se recibe una
MSTP BPDU cuyo número de saltos supera el valor aquí configurado, se la rechaza.
● Root Hop Count
El número de estaciones que deben recorrerse hasta el Root Bridge.

Spanning Tree
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Introducción
Esta página muestra la información actual sobre Spanning Tree y los ajustes del Root Bridge.

Descripción de los valores mostrados
Se muestran los siguientes campos:
● Modo Spanning Tree
Indica el modo ajustado. El modo se determina con "Layer 2 > Configuración" y con "Layer
2 > Spanning Tree > General".
Son posibles los siguientes valores:
– '-'
– RSTP
● Prioridad Bridge / Prioridad Root
A partir de la prioridad Bridge se determina qué dispositivo pasa a ser Root Bridge. El Bridge
(puente) con la prioridad más alta (es decir, con el valor menor para este parámetro) es el
Root Bridge. Si en una red hay varios equipos con la misma prioridad, pasa a ser Root
Bridge el equipo cuya dirección MAC tenga el valor numérico más bajo. Ambos parámetros,
prioridad de Bridge y dirección MAC, forman juntos el identificador Bridge. Dado que el Root
Bridge administra todos los cambios de ruta, debería estar dispuesto lo más central posible,
debido al tiempo de ciclo de los telegramas. El valor de la prioridad de Bridge es un múltiplo
entero de 4096, dentro de un rango de valores de 0 a 32768.
● Dirección Bridge / Dirección Root
La dirección Bridge indica la dirección MAC del dispositivo y la dirección Root indica la
dirección MAC del switch Root.
● Costes Root
Muestra los costes de encaminamiento del dispositivo al Root Bridge.
● Estado del Bridge
Indica el estado del Bridge, p. ej. si el dispositivo es el Root Bridge.

604

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla se divide en las siguientes columnas:
● Puerto
Indica las interfaces a través de las que se comunica el dispositivo.
● Función
Muestra el estado del puerto. Son posibles los siguientes valores:
– Disabled
El puerto se ha eliminado manualmente del Spanning Tree, que ya no lo tiene en cuenta.
– Designated
Los puertos que salen del Root Bridge.
– Alternate
El puerto con una ruta alternativa a un segmento de red
– Backup
Si un switch tiene varios puertos que van al mismo segmento de red, el "peor" puerto se
convierte en reserva.
– Root
El puerto que ofrece la mejor ruta hacia el Root Bridge.
– Master
Este puerto apunta a un Root Bridge que está fuera de la región MST.
● Estado
Muestra el estado actual en el que se encuentra la interfaz. Los valores solo se muestran.
Este parámetro depende del protocolo configurado.
– Discarding
El puerto recibe telegramas BPDU. Se rechazan otros telegramas entrantes o salientes.
– Listening
El puerto recibe y envía telegramas BPDU. El puerto está integrado en el algoritmo de
Spanning Tree. Se rechazan otros telegramas entrantes y salientes.
– Learning
El puerto aprende activamente la topología, es decir, las direcciones de los dispositivos.
Se rechazan otros telegramas entrantes y salientes.
– Forwarding
El puerto está activo en la red tras el tiempo de reconfiguración. El puerto recibe y envía
telegramas de datos.
● Oper. Versión
Indica el modo de compatibilidad de Spanning Tree utilizado por el puerto.
● Prioridad
Si la ruta determinada por el Spanning Tree puede conducir alternativamente por varios
puertos de un dispositivo, se selecciona el puerto con la prioridad más alta (es decir, con el
valor menor para ese parámetro). Para la prioridad puede indicarse un valor de 0 a 240 en
incrementos de 16. Si indica un valor no divisible por 16, el valor se ajustará
automáticamente. El valor estándar es 128.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

605

Configuración de dispositivos y redes
1.3 Configurar redes
● Costes de encaminamiento
Este parámetro sirve para calcular la ruta que se ha de elegir. Se selecciona como ruta el
trayecto con el valor más bajo. Si varios puertos de un dispositivo tienen el mismo valor, se
selecciona el puerto con el número más bajo.
Si el valor indicado en el campo "Cost Calc" es "0", se muestra el valor determinado
automáticamente. En caso contrario, se muestra el valor del campo "Cost Calc".
La determinación de los costes de encaminamiento se basa prioritariamente en la
velocidad de transmisión. Cuanto mayor es la velocidad de transmisión alcanzable, menor
es el valor de los costes de encaminamiento.
Valores típicos de costes de encaminamiento con Rapid Spanning Tree:
– 10.000 Mbits/s = 2.000
– 1000 Mbits/s = 20.000
– 100 Mbits/s = 200.000
– 10 Mbits/s = 2.000.000
● Edge Type
Indica el tipo de conexión. Son posibles los siguientes valores:
– Edge Port
En este puerto hay un dispositivo terminal.
– No Edge Port
En este puerto hay un dispositivo Spanning Tree o Rapid Spanning Tree.
● P.t.P. Type
Indica el tipo de conexión punto a punto. Son posibles los siguientes valores:
– P.t.P.
Con semidúplex se parte de una conexión punto a punto.
– Shared Media
Con una conexión dúplex no se parte de una conexión punto a punto.

Estadísticas VRRPv3
Introducción
Esta página muestra las estadísticas del protocolo VRRPv3 y todos los router virtuales
configurados.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

606

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los valores mostrados
Se muestran los siguientes campos:
● VRRID Errors
Indica cuántos paquetes VRRPv3 se han recibido que contenían una VRID no soportada.
● Version Errors
Indica el número de paquetes VRRPv3 recibidos que contenían un número de versión no
válido.
● Checksum Errors
Indica el número de paquetes VRRPv3 recibidos que contenían una suma de
comprobación no válida.
La tabla se divide en las siguientes columnas:
● Interfaces
Interfaz a la que se refieren los ajustes.
● VRID
Muestra la ID del router virtual. Los valores válidos son de 1 a 255.
● Tipo de dirección
Muestra la versión del protocolo IP.
● Become Master
Indica la frecuencia con la que este router virtual ha adoptado el estado "Master".
● Advertisements Received
Indica cuántos paquetes VRRPv3 se han recibido.
● Advertisements Interval Errors
Indica cuántos paquetes VRRPv3 erróneos se han recibido cuyo intervalo no coincide con
el valor fijado localmente.
● IP TTL Errors
Indica cuántos paquetes VRRPv3 erróneos se han recibido cuyo valor TTL (Time to live) no
coincide en el encabezado de IP.
● Prio 0 received
Indica cuántos paquetes VRRPv3 se han recibido con la prioridad 0. Los paquetes VRRPv3
con la prioridad 0 se envían cuando se apaga un router maestro. Estos paquetes permiten
pasar rápidamente al correspondiente router de reserva.
● Prio 0 sent
Indica cuántos paquetes VRRPv3 se han enviado con la prioridad 0. Los paquetes con la
prioridad 0 se envían cuando se apaga un router maestro. Estos paquetes permiten pasar
rápidamente al correspondiente router de reserva.
● Invalid Type
Indica cuántos paquetes VRRPv3 erróneos se han recibido cuyo valor en el campo "Type"
del encabezado de IP no es válido.
● Address List Errors
Indica cuántos paquetes VRRPv3 erróneos se han recibido cuya lista de direcciones no
coincide con la lista configurada localmente.
● Packet Length Errors
Indica cuántos paquetes VRRPv3 erróneos se han recibido cuya longitud no es correcta.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

607

Configuración de dispositivos y redes
1.3 Configurar redes

Seguridad
Sinopsis
La página muestra los ajustes de seguridad así como las cuentas de usuario locales y externas.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
Los valores mostrados dependen de los derechos del usuario que ha iniciado sesión.

Descripción de los valores mostrados
Services
La lista "Services" muestra los ajustes de seguridad.
● Telnet Server
Este ajuste se configura en "System > Configuration"
– Activado: acceso no codificado a CLI
– Desactivado: sin acceso no codificado a CLI
● SSH Server
Este ajuste se configura en "System > Configuration".
– Activado: acceso codificado a CLI
– Desactivado: sin acceso codificado a CLI
● Huella digital SSH x (solo para S615)
Se muestran las siguientes huellas digitales SSH:
– MD5
– SH256
● Servidor web
Este ajuste se configura en "System > Configuration"
– HTTP/HTTPS: es posible acceder al WBM mediante HTTP y HTTPS.
– HTTPS: solo es posible acceder al WBM mediante HTTPS.
● SNMP
Este ajuste se configura en "System > SNMP > General".
– "-" (SNMP desactivado)
No es posible acceder a los parámetros del dispositivo a través de SNMP.
– SNMPv1/v2c/v3
Se puede acceder a los parámetros del equipo con las versiones 1, 2c o 3 de SNMP.
– SNMPv3
Se puede acceder a los parámetros del equipo solo con la versión 3 de SNMP.

608

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Login Authentication
Este ajuste se configura en "Seguridad > AAA > General".
– Local
La autenticación debe realizarse localmente en el dispositivo.
– RADIUS
La autenticación debe efectuarse a través de un servidor RADIUS.
– Local and Radius
La autenticación puede realizarse tanto con los usuarios existentes en el dispositivo
(nombre de usuario y contraseña) como mediante un servidor RADIUS.
Primero se busca al usuario en la base de datos local. Si el usuario no existe se envía
una solicitud RADIUS.
– RADIUS with Fallback Local
La autenticación debe efectuarse a través de un servidor RADIUS.
Solo se lleva a cabo una autenticación local si el servidor RADIUS no está accesible en
la red.
● Directriz para contraseñas
Indica la norma que se utiliza actualmente para la contraseña.
Local and External User Accounts
Las cuentas de usuario locales y sus funciones se configuran en "Seguridad > Usuario".
Al crear una cuenta de usuario local se genera automáticamente una cuenta de usuario
externa. Las cuentas de usuario locales son usuarios que tienen una contraseña para iniciar
sesión en el dispositivo.
Un usuario se vincula a una función en la tabla "Cuentas de usuario externas", p. ej. el usuario
"Observer" a la función "user". En este caso, el usuario está definido en un servidor RADIUS.
La función está definida localmente en el dispositivo. Cuando un servidor RADIUS autentica a
un usuario pero el grupo correspondiente es desconocido o no existe, el dispositivo comprueba
si hay una entrada en la tabla "External User Accounts" para el usuario. Si existe la entrada en
cuestión, se inicia la sesión del usuario con los derechos de la función vinculada. Si el grupo
correspondiente es conocido en el dispositivo, se evalúan ambas tablas. Al usuario se le
asigna la función que tiene mayores derechos.
Nota
La tabla "Cuentas de usuario externas" solo se evalúa si en el modo de autorización RADIUS
se ha ajustado "Específico del fabricante".
Desde CLI se accede a las cuentas de usuario externas.
La tabla "Local User Accounts" se divide en las siguientes columnas:
● User Account
Muestra el nombre del usuario local.
● Role
Muestra la función del usuario. Encontrará más información sobre los derechos de la
función en "Information > Security > Roles".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

609

Configuración de dispositivos y redes
1.3 Configurar redes

Derechos de función soportados
La página muestra los derechos de función que están disponibles localmente en el dispositivo.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Descripción de los valores mostrados
● Function Right
Muestra el número del derecho de función. Los números tienen asignados diferentes
derechos en relación a los parámetros del dispositivo.
● Description
Muestra la descripción del derecho de función.

Funciones
La página muestra las funciones válidas localmente en el dispositivo.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Descripción de los valores mostrados
La tabla contiene las siguientes columnas:
● Role
Muestra la función.
● Function Right
Muestra los derechos de la función:
– 1
Los usuarios con esta función pueden leer parámetros del dispositivo pero no
cambiarlos.
– 15
Los usuarios con esta función pueden leer y modificar los parámetros del dispositivo.
– 0
Se trata de una función que asigna internamente el dispositivo cuando no ha sido
posible autenticar al usuario.
Al usuario se le niega el acceso al dispositivo.
● Description
Muestra una descripción de la función.

610

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Grupos
Esta página muestra los grupos que están vinculados a una función y a cuál. El grupo está
definido en un servidor RADIUS. La función está definida localmente en el dispositivo.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Descripción de los valores mostrados
La tabla se divide en las siguientes columnas:
● Group
Muestra el nombre del grupo. El nombre coincide con el grupo del servidor RADIUS.
● Role
Muestra la función. Los usuarios que se autentican con el grupo vinculado a través del
servidor RADIUS obtienen los derechos de la función en el dispositivo local.
● Description
Muestra la descripción para la vinculación.

Configuración de funciones de sistema
Configuración
Configuración (SC-600)
Configuración del sistema
Esta página contiene la vista general de configuración de las modalidades de acceso del
dispositivo.
Establezca los servicios a través de los cuales se accede al dispositivo. Para algunos servicios
hay más páginas de configuración, en las que se pueden realizar ajustes detallados.

Descripción
Esta página contiene el resumen de configuración sobre las posibilidades de acceso del
dispositivo.
● Servidor Telnet
Active o desactive el servicio de servidor Telnet para el acceso no codificado a CLI.
● Servidor SSH
Active o desactive el servicio de servidor SSH para el acceso codificado a CLI.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

611

Configuración de dispositivos y redes
1.3 Configurar redes
● Servicios HTTP
Defina cómo se accederá al WBM.
– HTTPS
El acceso al WBM solo es posible a través de HTTPS.
– HTTP/HTTPS
El acceso al WBM solo es posible a través de HTTP o de HTTPS.
– Derivar HTTP a HTTPS
Al acceder mediante HTTP se desvía automáticamente a HTTPS.
● Cliente SMTP
Active o desactive el cliente SMTP. Se configuran más ajustes en "Sistema > Cliente
SMTP".
● Cliente Syslog
Active o desactive el cliente Syslog. Se configuran más ajustes en "Sistema > Cliente
Syslog".
● Servidor DCP
Especifique si se debe poder acceder al dispositivo con DCP (Discovery and Configuration
Protocol):
– "-" (desactivado)
DCP está desactivado. No pueden leerse ni modificarse los parámetros del equipo.
– Leer/Escribir
Con DCP es posible leer y modificar los parámetros del dispositivo.
– Protegido contra escritura
Con DCP es posible leer los parámetros del dispositivo, pero no modificarlos.
● Ajuste de la hora
Seleccione el ajuste deseado. Son posibles los siguientes ajustes:
– Manual
La hora del sistema se ajusta de forma manual. Se configuran más ajustes en "Sistema
> Hora del sistema > Manual".
– SIMATIC Time
La hora del sistema se ajusta mediante un reloj SIMATIC. Se configuran más ajustes en
"Sistema > Hora del sistema > SIMATIC Time Client".
– Cliente SNTP
La hora del sistema se ajusta mediante un servidor SNTP. Se configuran más ajustes en
"Sistema > Hora del sistema > Cliente SNTP".
– Cliente NTP
La hora del sistema se ajusta mediante un servidor NTP. Se configuran más ajustes en
"Sistema > Hora del sistema > Cliente NTP".

612

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● SNMP
Seleccione el protocolo deseado. Son posibles los siguientes ajustes:
– "-" (SNMP desactivado)
No es posible acceder a los parámetros del dispositivo a través de SNMP.
– SNMPv1/v2c/v3
Se puede acceder a los parámetros del equipo con las versiones 1, 2c o 3 de SNMP. Se
configuran más ajustes en "Sistema > SNMP > General".
– SNMPv3
Solo es posible acceder a los parámetros del dispositivo con la versión 3 de SNMP. Se
configuran más ajustes en "Sistema > SNMP > General".
● SNMPv1/v2 protegido contra escritura
Active o desactive el acceso de escritura a variables SNMP con SNMPv1/v2c.
● Cliente DHCP
Active o desactive el cliente DHCP. Se configuran más ajustes en "Sistema > DHCP".
● Traps SNMPv1
Active o desactive el envío de traps SNMPv1 (telegramas de alarma). Se configuran más
ajustes en "Sistema > SNMP > Traps".
● Modo de configuración
Elija el modo de operación deseado. Son posibles los siguientes modos de operación:
– Guardar automáticamente
Modo de copia de seguridad automática. La configuración se guarda de forma
automática aprox. 1 minuto después de la última modificación de parámetros o al
reiniciar el dispositivo.
Además, en el área de visualización del WBM aparece el aviso "Los cambios se
guardarán automáticamente en x segundos. Para guardar inmediatamente los cambios,
haga clic en 'Escribir la configuración inicial'."
Nota
Interrupción de la operación de almacenamiento
La operación de almacenamiento no se inicia hasta que se ha agotado el temporizador
en el aviso. La duración de la operación de almacenamiento depende del dispositivo.
● No apague inmediatamente el dispositivo cuando se haya agotado el temporizador.
– Trial
Modo Trial. En el modo Trial se aceptan modificaciones, pero no se guardan en el
archivo de configuración (Startup Configuration).
Para guardar modificaciones en el archivo de configuración, utilice en el WBM el botón
"Escritura de la configuración de arranque". Además, en el área de visualización
aparece el aviso "El modo de configuración Trial está activado - Para guardar los
ajustes, pulse el botón 'Escribir la configuración inicial'" en cuanto haya algún cambio sin
guardar. Este mensaje es visible en todas las páginas WBM hasta que las
modificaciones realizadas se guardan o el equipo se reinicia.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

613

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración (S615)
Configuración del sistema
Esta página contiene el resumen de configuración sobre las posibilidades de acceso del
dispositivo.
Establezca los servicios a través de los cuales se accede al dispositivo. Para algunos servicios
hay más páginas de configuración, en las que se pueden realizar ajustes detallados.
Asimismo, en algunos servicios es posible modificar el puerto estándar.
Nota
Modificar el puerto estándar
Algunos programas solo pueden acceder al servicio a través del puerto estándar; así, por
ejemplo, TIA Portal acceder a HTTPS a través del puerto estándar 443. Antes de modificar el
puerto compruebe qué puerto utiliza el programa. Si se modifica el puerto estándar, habrá que
acceder al servicio a través del puerto modificado.
Cortafuegos
Después de cambiar el puerto se reinicializa el cortafuegos. Esto significa que los puertos
modificados se aplican a las reglas del cortafuegos. Mientras esto sucede, las conexiones
existentes, como las que transcurren por el cortafuegos personalizado, pueden utilizarse pero
solo con limitaciones.

Descripción
Esta página contiene el resumen de configuración sobre las posibilidades de acceso del
dispositivo.
● Servidor Telnet
Active o desactive el servicio "Servidor Telnet" para el acceso no codificado a CLI.
● Puerto Telnet
Defina el puerto para el acceso Telnet a CLI.
● Servidor SSH
Active o desactive el servicio "Servidor SSH" para el acceso codificado a CLI.
● Puerto SSH
Defina el puerto para el acceso SSH a CLI.
● Servidor HTTP
Active o desactive el acceso HTTP a WBM.
● Puerto HTTP
Defina el puerto para el acceso HTTP a WBM.
● Servidor HTTPS
Active o desactive el acceso HTTP a WBM.
● Puerto HTTPS
Defina el puerto para el acceso HTTPS a WBM.

614

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Servicios HTTP
Defina cómo se accederá al WBM.
– HTTPS
El acceso al WBM solo es posible a través de HTTPS.
– HTTP/HTTPS
El acceso al WBM solo es posible a través de HTTP o de HTTPS.
– Derivar HTTP a HTTPS
Al acceder mediante HTTP se desvía automáticamente a HTTPS.
● Versión de TLS mín.
Especifique qué versión mínima de TLS se utilizará.
● Página de inicio de sesión predeterminada
Especifique la página de inicio de sesión desde la que se iniciará WBM en el ajuste
predeterminado.
– Cortafuegos
Inicio de sesión en la página de WBM para el cortafuegos personalizado.
– Configuración
Inicio de sesión en WBM.
● Cliente SMTP
Active o desactive el cliente SMTP. Se configuran más ajustes en "Sistema > Cliente
SMTP".
● Cliente Syslog
Active o desactive el cliente Syslog. Se configuran más ajustes en "Sistema > Cliente
Syslog".
● Servidor DCP
Especifique si se debe poder acceder al dispositivo con DCP (Discovery and Configuration
Protocol):
– "-" (desactivado)
DCP está desactivado. No pueden leerse ni modificarse los parámetros del equipo.
– Leer/Escribir
Con DCP es posible leer y modificar los parámetros del dispositivo.
– Protegido contra escritura
Con DCP es posible leer los parámetros del dispositivo, pero no modificarlos.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

615

Configuración de dispositivos y redes
1.3 Configurar redes
● Ajuste de la hora
Seleccione el ajuste en la lista desplegable. Son posibles los siguientes ajustes:
– Manual
La hora del sistema se ajusta de forma manual. Se configuran más ajustes en "Sistema
> Hora del sistema > Manual".
– SIMATIC Time
La hora del sistema se ajusta mediante un reloj SIMATIC. Se configuran más ajustes en
"Sistema > Hora del sistema > SIMATIC Time Client".
– Cliente SNTP
La hora del sistema se ajusta mediante un servidor SNTP. Se configuran más ajustes en
"Sistema > Hora del sistema > Cliente SNTP".
– Cliente NTP
La hora del sistema se ajusta mediante un servidor NTP. Se configuran más ajustes en
"Sistema > Hora del sistema > Cliente NTP".
● SNMP
Seleccione el protocolo en la lista desplegable. Son posibles los siguientes ajustes:
– "-" (SNMP desactivado)
No es posible acceder a los parámetros del dispositivo a través de SNMP.
– SNMPv1/v2c/v3
Se puede acceder a los parámetros del equipo con las versiones 1, 2c o 3 de SNMP. Se
configuran más ajustes en "Sistema > SNMP > General".
– SNMPv3
Solo es posible acceder a los parámetros del dispositivo con la versión 3 de SNMP. Se
configuran más ajustes en "Sistema > SNMP > General".
● SNMPv1/v2 protegido contra escritura
Active o desactive el acceso de escritura a variables SNMP con SNMPv1/v2c.
● Traps SNMPv1
Active o desactive el envío de traps SNMPv1 (telegramas de alarma). Se configuran más
ajustes en "Sistema > SNMP > Traps".
● Interfaz de configuración SINEMA
Si la interfaz de configuración SINEMA está activada es posible cargar configuraciones en
el dispositivo desde STEP 7 Basic / Professional.
● Cliente DHCP
Active o desactive el cliente DHCP. Se configuran más ajustes en "Sistema > DHCP".
● Tipo de DUID
Especifique qué tipo de DUID se utilizará. Los tipos de DUID están definidos en RFC 3315.
– DUID-LLT
DUID está basado en la dirección del nivel de enlace de la interfaz y en un sello de
tiempo.
– DUID-EN
El DUID lo asigna el fabricante (EN = Enterprise number).
– DUID-LL
El DUID está basado en la dirección del nivel de enlace de la interfaz.

616

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Dirección del nivel de enlace más tiempo (LLT)
El valor está basado en la dirección del nivel de enlace de la interfaz y en un sello de tiempo.
El valor se genera de nuevo cada vez que se restablece la configuración de fábrica.
● Número de empresa del fabricante (EN)
El valor está basado en el número de empresa, que es específico del fabricante. El valor se
genera de nuevo cada vez que se restablece la configuración de fábrica.
● Dirección del nivel de enlace (LL)
La dirección del nivel de enlace está basada en la dirección MAC. El valor se genera de
nuevo cada vez que se restablece la configuración de fábrica.
● Modo de configuración
Seleccione el modo de operación en la lista desplegable. Son posibles los siguientes
modos de operación:
– Guardar automáticamente
Modo de copia de seguridad automática. La configuración se guarda de forma
automática aprox. 1 minuto después de la última modificación de parámetros o al
reiniciar el dispositivo.
Además, en el área de visualización aparece el aviso "Los cambios se guardarán
automáticamente en x segundos. Para guardar inmediatamente los cambios, haga clic
en 'Escribir la configuración inicial'."
Nota
Interrupción de la operación de almacenamiento
La operación de almacenamiento no se inicia hasta que se ha agotado el temporizador
en el aviso. La duración del proceso de almacenamiento depende del dispositivo.
Durante el proceso de almacenamiento se muestra el aviso "Se están guardando los
datos de configuración. No apague el dispositivo".
● No apague inmediatamente el dispositivo cuando se haya agotado el temporizador.
– Trial
Modo Trial. En el modo Trial se aceptan modificaciones, pero no se guardan en el
archivo de configuración (Startup Configuration).
Para guardar modificaciones en el archivo de configuración, utilice el botón "Escribir la
configuración inicial". Además, en el área de visualización aparece el aviso "El modo de
configuración Trial está activado - Para guardar los ajustes, pulse el botón 'Escribir la
configuración inicial'" en cuanto haya algún cambio sin guardar. Este mensaje es visible
en todas las páginas WBM hasta que las modificaciones realizadas se guardan o el
equipo se reinicia.

General
Dispositivo
Esta página contiene información general sobre el dispositivo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

617

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Hora actual del sistema (solo disponible online)
Indica la hora actual del sistema. La hora del sistema la ajusta el usuario o se sincroniza
mediante un telegrama de hora, que puede ser un telegrama de hora SINEC H1, NTP o
SNTP. (Solo lectura)
● Tiempo de funcionamiento del sistema (solo disponible online)
Indica el tiempo de funcionamiento del dispositivo desde el último rearranque completo.
(Solo lectura)
● Tipo de dispositivo (solo disponible online)
Indica la denominación de tipo del dispositivo. (Solo lectura)
● Nombre del sistema
Puede introducir el nombre del dispositivo. El nombre introducido se muestra en el área de
selección. Pueden utilizarse un máximo de 255 caracteres. El nombre del sistema se indica
también en el símbolo del sistema CLI (Prompt). El número de caracteres está limitado en
el símbolo del sistema CLI. El nombre del sistema se trunca después de 16 caracteres.
● Persona de contacto
Puede introducir el nombre de una persona de contacto responsable de la administración
del dispositivo. Pueden utilizarse un máximo de 255 caracteres.
● Ubicación del dispositivo
Puede introducir el lugar de montaje del dispositivo. El lugar de montaje introducido se
muestra en el área de selección. Pueden utilizarse un máximo de 255 caracteres.
Nota
Caracteres permitidos
Los siguientes caracteres ASCII representables (0x20 bis 0x7e) están permitidos en los
campos de entrada "Nombre del sistema", "Persona de contacto" y "Ubicación del
dispositivo":
● 0123456789
● A...Z a...z
● !"#$%&'()*+,-./:;<=>?@ [\]_{|}~^`

Coordenadas
En esta página se puede registrar información sobre las coordenadas geográficas (latitud,
longitud y altura sobre el elipsoide según WGS84).
Determinación de las coordenadas
Para determinar las coordenadas geográficas, utilice los mapas que se suministran con el
dispositivo.
Las coordenadas geográficas también se pueden determinar mediante un receptor GPS. Por
lo general, estos dispositivos muestran las coordenadas geográficas directamente, por lo que
basta con introducirlas en los campos de entrada de esta página.

618

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos de entrada con una longitud máxima de 32
caracteres:
● Campo de entrada "Latitud"
Introduzca la latitud norte o sur de la ubicación del dispositivo.
P. Ej., +49° 1' 31,67" significa que el dispositivo se encuentra a 49 grados, 1 minuto y
31,67 segundos de latitud norte.
La latitud sur va precedida de un signo negativo.
También se pueden añadir las letras N (latitud norte) o S (latitud sur) a las indicaciones
numéricas (49° 1' 31,67" N).
● Campo de entrada "Longitud"
Introduzca la longitud este u oeste de la ubicación del dispositivo.
P. ej., +8° 20' 58,73" significa que el dispositivo se encuentra a 8 grados, 20 minutos y
58,73 segundos de longitud este.
La longitud oeste va precedida de un signo negativo.
También se pueden añadir las letras O o E (longitud este) o W (longitud oeste) a las
indicaciones numéricas (8° 20' 58,73" E).
● Campo de entrada "Altitud"
Introduzca el valor de la altitud en metros por encima o por debajo del nivel del mar.
P. ej., 158 m significa que el dispositivo está a una altura de 158 m por encima del nivel del
mar.
Las altitudes por debajo del nivel del mar (p. ej. en el Mar Muerto) van precedidas de un
signo negativo.

Cargar y guardar
Cargar y guardar vía TFTP
Cargar y guardar datos a través de un servidor TFTP
En esta página puede configurar el servidor TFTP y los nombres de los archivos. Además,
dispone de la posibilidad de almacenar datos del dispositivo en un archivo externo en un
servidor TFTP o cargar dichos datos en los dispositivos desde un archivo externo de dicho
servidor. De este modo puede cargar un firmware nuevo desde un archivo de un servidor
TFTP, por ejemplo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

619

Configuración de dispositivos y redes
1.3 Configurar redes
Firmware
El firmware está firmado y codificado. Con esto se garantiza que solo se pueda cargar firmware
creado por Siemens en el dispositivo.
Nota
Incompatibilidad con versiones anteriores de firmware sin/con el PLUG insertado
Si se instala una versión anterior es posible que se pierdan los datos de configuración. En ese
caso, tras la instalación del firmware el dispositivo se enciende con los ajustes de fábrica.
Si, además, hay un PLUG insertado en el dispositivo, después del rearranque tendrá el estado
"Not Accepted", puesto que en el PLUG siguen estando los datos de configuración del
firmware anterior, más actual. Esto permite regresar al firmware más actual que estaba
instalado anteriormente sin perder datos de configuración. Si la configuración original del
PLUG ya no se necesita, puede borrarse o volver a escribirse manualmente mediante la
página WBM "Sistema > PLUG".
Archivos de configuración
Nota
Archivos de configuración y modo Trial/Guardar automáticamente
En el modo "Guardar automáticamente" se realiza una copia de seguridad automática antes
de que se transmitan los archivos de configuración (ConfigPack y Config).
En modo "Trial" los cambios se aplican, pero no se guardan en los archivos de configuración
(ConfigPack y Config). Utilice el botón "Escritura de la configuración de arranque" de la página
del WBM "Sistema > Configuración" para guardar cambios en los archivos de configuración.
Archivo script CLI
Existe la posibilidad de descargar configuraciones CLI existentes (RunningCLI) y cargar
scripts CLI propios (Script).
Nota
El script CLI descargable no está previsto para volver a cargarlo sin cambios.
Los comandos CLI para guardar y cargar archivos no pueden ejecutarse mediante el archivo
script CLI (Script).
Intercambio de datos de configuración con STEP7 Basic/Professional a través de un archivo
Los tipos de archivo "RunningSINEMAConfig" y "SINEMAConfig" permiten intercambiar los
datos de configuración entre un dispositivo (WBM) y STEP7 Basic/Professional a través de un
archivo.
Requisitos:
● Misma referencia
● Misma versión de firmware
● Contraseña
La contraseña se asigna en WBM, en "System > Load&Save > Passwords".

620

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Los tipos de archivo se pueden utilizar del siguiente modo:
● Para el diagnóstico online
Las configuraciones incorrectas de un dispositivo se pueden guardar como
"RunningSINEMAConfig" mediante WBM e importarse a STEP7 Basic/Professional. El
diagnóstico en STEP7 Basic/Professional se desarrolla sin que exista una conexión con un
dispositivo real. Las configuraciones corregidas se pueden exportar y volver a cargarse en
WBM como "SINEMAConfig".
● Para la configuración
En STEP7 Basic/Professional es posible configurar un dispositivo sin que exista una
conexión con un dispositivo real. La configuración se puede exportar y cargar en el
dispositivo real a través de WBM como "SINEMAConfig".

Descripción
● Dirección del servidor TFTP
Introduzca la dirección IP o el FQDN del servidor TFTP con el que se intercambian datos.
● Puerto del servidor TFTP
Introduzca aquí el puerto del servidor TFTP a través del cual desee efectuar el intercambio
de datos. En caso necesario, puede modificar el valor estándar 69 conforme a sus
requisitos específicos.
La tabla se divide en las siguientes columnas:
● Tipo de archivo
Muestra el tipo de archivo.
● Descripción
Muestra la descripción abreviada del tipo de archivo.
● Nombre de archivo
Cada tipo de archivo tiene especificado aquí un nombre de archivo.
Nota
Cambio del nombre de archivo
Existe la posibilidad de cambiar el nombre de archivo asignado en esta columna. Tras
cargar en el dispositivo, el nombre de archivo modificado puede utilizarse también con la
Command Line Interface.
● Acción (solo disponible online)
Seleccione la acción deseada. La selección dependerá del tipo de archivo seleccionado,
p. ej. el archivo de registro (log) solo puede guardarse.
Son posibles las siguientes acciones:
– Guardar archivo
Con esta selección se guarda un archivo en el servidor TFTP.
– Cargar archivo
Con esta selección se carga un archivo desde el servidor TFTP, p. ej. certificados
necesarios para establecer una conexión segura.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

621

Configuración de dispositivos y redes
1.3 Configurar redes

Cargar y guardar vía SFTP
Cargar y guardar datos a través de un servidor SFTP
SFTP (SSH File Transfer Protocol) transfiere los archivos codificados. En esta página se
configuran los datos de acceso para el servidor SFTP.
Además, ofrece la posibilidad de almacenar datos del dispositivo en un archivo externo en su
PC cliente o cargar dichos datos en los dispositivos desde un archivo externo del PC. De este
modo puede cargar un firmware nuevo desde un archivo de su PC de administrador, por
ejemplo.
Además, en esta página existe la posibilidad de cargar los certificados necesarios para
establecer una conexión VPN segura.
Firmware
El firmware está firmado y codificado. Con esto se garantiza que solo se pueda cargar en el
dispositivo firmware creado por Siemens.
Archivos de configuración
Nota
Archivos de configuración y modo Trial/Guardar automáticamente
En el modo "Guardar automáticamente" se realiza una copia de seguridad automática antes
de que se transmitan los archivos de configuración (ConfigPack y Config).
En modo "Trial" los cambios se aplican, pero no se guardan en los archivos de configuración
(ConfigPack y Config). Utilice el botón "Escribir configuración de inicio" de la página del WBM
"Sistema > Configuración" para guardar cambios en los archivos de configuración.
Archivo script CLI
Existe la posibilidad de descargar configuraciones CLI existentes (RunningCLI) y cargar
scripts CLI propios (Script).
Nota
El script CLI descargable no está previsto para volver a cargarlo sin cambios.
Los comandos CLI para guardar y cargar archivos no pueden ejecutarse mediante el archivo
script CLI (Script).
Intercambio de datos de configuración con STEP7 Basic/Professional a través de un archivo
Los tipos de archivo "RunningSINEMAConfig" y "SINEMAConfig" permiten intercambiar los
datos de configuración entre un dispositivo (WBM) y STEP7 Basic/Professional a través de un
archivo.
Requisitos:
● Misma referencia
● Misma versión de firmware
● Contraseña
La contraseña se asigna en WBM, en "Sistema > Cargar y guardar > Contraseñas".

622

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Los tipos de archivo se pueden utilizar del siguiente modo:
● Para el diagnóstico offline
Las configuraciones incorrectas de un dispositivo se pueden guardar como
"RunningSINEMAConfig" mediante WBM e importarse a STEP7 Basic/Professional. El
diagnóstico en STEP7 Basic/Professional se desarrolla sin que exista una conexión con un
dispositivo real. Las configuraciones corregidas se pueden exportar y volver a cargarse en
WBM como "SINEMAConfig".
● Para la configuración
En STEP7 Basic/Professional es posible configurar un dispositivo sin que exista una
conexión con un dispositivo real. La configuración puede exportarse y cargarse en el
dispositivo real a través de WBM como "SINEMAConfig".

Descripción
La página contiene los siguientes campos:
● Dirección del servidor SFTP
Introduzca la dirección IP o el FQDN del servidor SFTP con el que se intercambian datos.
● Puerto del servidor SFTP
Introduzca el puerto del servidor SFTP a través del cual desee efectuar el intercambio de
datos. En caso necesario, puede modificar el valor estándar 22 conforme a sus requisitos
específicos.
● Usuario SFTP
Introduzca el usuario para acceder al servidor SFTP. Es imprescindible que en el servidor
SFTP se haya creado un usuario con los derechos correspondientes.
● Contraseña SFTP
Introduzca la contraseña para el usuario.
● Confirmar contraseña SFTP
Confirme la contraseña.
La tabla se divide en las siguientes columnas:
● Tipo de archivo
Muestra el tipo de archivo.
● Descripción
Muestra una descripción breve del tipo de archivo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

623

Configuración de dispositivos y redes
1.3 Configurar redes
● Nombre de archivo
Cada tipo de archivo tiene especificado aquí un nombre de archivo.
Nota
Cambio del nombre de archivo
Existe la posibilidad de cambiar el nombre de archivo asignado en esta columna. Tras
cargar en el dispositivo, el nombre de archivo modificado puede utilizarse también con la
Command Line Interface.
● Acciones
Seleccione la acción deseada. La selección dependerá del tipo de archivo seleccionado,
p. ej. el archivo de registro (log) solo puede guardarse.
Son posibles las siguientes acciones:
– Guardar archivo
Con esta selección se guarda un archivo en el servidor SFTP.
– Cargar archivo
Con esta selección se carga un archivo desde el servidor SFTP, p. ej. certificados
necesarios para establecer una conexión segura.

Contraseñas
Contraseña para archivos
Para acceder a determinados archivos se requiere una contraseña. Para cargar el archivo
correctamente en el dispositivo, introduzca en esta página la contraseña definida para el
archivo.

Descripción
● Tipo
Indica el tipo de archivo.
● Descripción
Muestra la descripción breve del tipo de archivo.
● Activado
Si está activado, se utiliza el archivo. Solo puede activarse cuando la contraseña está
configurada.
● Contraseña
Introduzca la contraseña del archivo.

624

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Confirmar contraseña
Confirme la contraseña.
● Estado (solo disponible online)
Indica si la contraseña es apropiada para el archivo en el dispositivo.
– Válido
La casilla de verificación "Activado" está activada y la contraseña es apropiada para el
archivo.
– No válido
La casilla de verificación "Activado" está activada pero la contraseña no es apropiada
para el archivo, o bien no se ha cargado ningún archivo.
– '-'
No es posible evaluar la contraseña o bien no se utiliza. La casilla de verificación
"Activado" no está activada.

Eventos
Configuración
Selección de eventos del sistema
En esta página se define qué eventos del sistema se registrarán y cómo.
Los avisos siguientes se registran siempre en la tabla de registro de eventos y no pueden
desmarcarse:
● Cambio de la contraseña de administrador
● Arranque del dispositivo
● Estado de funcionamiento del dispositivo, p. ej. si hay un PLUG o no.
● Estado de errores no solucionados
Para SCALANCE S615 estos avisos se pueden enviar adicionalmente a un servidor Syslog,
active para ello la casilla de verificación "Syslog" en el evento "Registros generales del
sistema".

Descripción
La tabla 1 se divide en las siguientes columnas:
● Todos los eventos
Indica que los ajustes son válidos para todos los eventos de la tabla 2.
● Correo electrónico / Trap / Tabla de registro / Syslog / Error / Salida digital / Túnel VPN /
Cloud Connector / Cortafuegos
Active o desactive el tipo deseado de notificación para todos los eventos. Si está
seleccionado "Sin cambios", las entradas de la correspondiente columna de la tabla 2 no
cambian.
● Aplicar a tabla
Al hacer clic en este botón se aplica el ajuste para todos los eventos de la tabla 2.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

625

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla 2 se divide en las siguientes columnas:
● Evento
La columna "Evento" contiene lo siguiente:
– Arranque en frío/en caliente
Se ha conectado el dispositivo o el usuario ha realizado rearranque completo. En la
memoria de errores del dispositivo se genera una entrada nueva con el tipo de
rearranque realizado.
– Link Change
Este evento solo se produce cuando el estado del puerto se somete a vigilancia y ha
cambiado correspondientemente, véase "Sistema > Control de errores > Link Change".
– Error de autenticación
Este evento se produce en caso de intento de acceso con una contraseña incorrecta.
– Cambio de alimentación
Este evento solo se produce cuando se vigilan las líneas de alimentación 1 y 2. Indica
que se ha producido un cambio en el cable 1 o en el cable 2. Consulte "Sistema > Control
de errores > Alimentación de tensión".
– Cambio del estado de error
Para que los errores en la salida digital se señalicen también mediante el LED de error
"F", hay que activar "Cambio del estado de error" para la "salida digital". En este caso,
el LED de error "F" se enciende cuando se produce un error interno y la entrada digital
se cierra.Registros de seguridad
En el libro de registro de seguridad se introduce si se ha aplicado el procedimiento IPsec
para VPN o si hay una conexión de SINEMA RC activa.
– Firewall-Logs
En el libro de registro del cortafuegos se introduce cuándo se han aplicado reglas de
cortafuegos determinadas. Para ello debe activarse la función LOG de las diferentes
funciones del cortafuegos.
– DDNS Client-Logs
Este evento se produce cuando el cliente DDNS sincroniza la dirección IP asignada con
el nombre de host registrado en el proveedor de DDNS.
– Entrada digital
El evento se produce si ha cambiado el estado de la entrada digital.
– Estado de conexión del sistema
El estado de la conexión ha cambiado.
– Registros generales del sistema
Establecimiento de la conexión, cambio de la configuración
– Entrada digital
El evento se produce si ha cambiado el estado de la entrada digital.
– Túnel VPN
El evento se produce si ha cambiado el estado de VPN (IPsec, OpenVPN, SINEMA RC).
– NTP Secure
El evento se produce si ha cambiado el estado del servidor Secure NTP.
– Cloud Connector (solo para S615)
El evento se produce si ha cambiado el estado operativo del Cloud Connector integrado.

626

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
– Cambio en la configuración (solo para S615)
Este evento se produce cuando ha cambiado la configuración del dispositivo.
– Información de servicio (solo para S615)
Para determinados eventos se crean entradas en la tabla de registro incluso sin
configuración. Para dichos eventos es posible configurar aquí otras acciones
consecuenciales (correo electrónico, trap, Syslog).
– Vigilancia de la conexión (solo para S615)
El evento se produce cuando se vigilan conexiones, consulte "Sistema > Vigilancia de
la conexión".
● E-mail
El equipo envía un correo electrónico. Para ello es necesario que el servidor SMTP esté
configurado y la función "Cliente SMTP" esté activada.
● Trap
El dispositivo activa un trap SNMP. Para ello es necesario que en "Sistema >
Configuración" esté activado "SNMPv1 Traps".
● Tabla de registro
El dispositivo escribe una entrada en la tabla de informes de eventos, véase "Información
> Tabla de registro".
● Syslog
El dispositivo escribe una entrada en el servidor de informes del sistema. Para ello es
necesario que el servidor de informes del sistema esté configurado y la función "Cliente
Syslog" esté activada.
● Error
El dispositivo emite un error. El LED de error se enciende.
● Salida digital
Activa la salida digital o señaliza el cambio de estado mediante el LED "DO". En el ajuste
predeterminado, la salida digital está cerrada. La salida digital se abre cuando se activa
como mínimo un evento para la salida digital. Además, no está conectada automáticamente
al LED de error. La salida digital se conecta al LED de error en "Cambio del estado de error".
● Túnel VPN
Controla el reenvío de un evento a la conexión VPN (IPsec, OpenVPN, SINEMA RC).
Mientras persista el evento, la conexión VPN estará activada.
● Cloud Connector (solo para S615)
Controla el reenvío de un evento a la comunicación de TIA Portal Cloud Connector. La
conexión de comunicación estará activa mientras el evento esté pendiente.
● Firewall (solo para S615)
Controla la aplicación del conjunto de reglas personalizado. Para ello es imprescindible que
en "Security > Firewall > Definido por el usuario" se haya asignado un conjunto de reglas a
la entrada digital.

Filtros severity
En esta página se configura la gravedad de los errores para enviar notificaciones de eventos
del sistema.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

627

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La tabla se divide en las siguientes columnas:
●

Tipo de cliente
Elija el tipo de cliente para el que se realizan los ajustes:
– E-Mail
Envío de avisos de eventos de sistema por correo electrónico
– Tabla de registro
Entrada de eventos del sistema en la tabla de registro.
– Syslog
Entrada de eventos del sistema en el archivo Syslog.

● Severity
Seleccione el nivel deseado. Son posibles los siguientes ajustes:
– Info
Los avisos de todos los niveles se envían y/o registran.
– Warning
Los avisos de este nivel y del nivel "critical" se envían y/o registran.
– Critical
Solo se envían y/o registran los avisos de este nivel.

Cliente SMTP (SC-600)
El dispositivo ofrece la posibilidad de que, al producirse un evento de alarma, se envíe
automáticamente un e-mail (p. ej. al administrador de la red). El e-mail contiene la
identificación del dispositivo remitente, una descripción de la causa de la alarma en texto claro
y un sello horario. De este modo se puede crear para redes con pocos dispositivos un equipo
sencillo y centralizado de vigilancia de la red sobre la base de un sistema de correo electrónico.
Si llegan e-mails con avisos de fallo, se puede iniciar el WBM vía navegador a través de la
identificación del remitente, lo que permite leer más información para el diagnóstico.
En esta página se pueden configurar hasta tres servidores SMTP y las correspondientes
direcciones de correo electrónico.

Descripción
La página contiene los siguientes campos:
● Cliente SMTP
Active o desactive el cliente SMTP.
● Dirección de e-mail del destinatario
Introduzca el nombre de remitente que debe indicarse en el correo electrónico, p. ej., el
nombre del dispositivo.
Este ajuste es válido para todos los servidores SMTP configurados.
● Enviar e-mail de prueba
Envíe un correo electrónico de prueba para comprobar la configuración.

628

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Puerto SMTP
Introduzca el puerto a través del que se puede acceder al servidor SMTP.
Configuración de fábrica: 25
Este ajuste es válido para todos los servidores SMTP configurados.
● Dirección del servidor SMTP
Introduzca aquí la dirección IP, el FQDN (Fully Qualified Domain Name) o el nombre de host
del servidor SMTP.
La tabla contiene las siguientes columnas:
● Seleccionar
Active la casilla de verificación correspondiente en una fila que desee borrar.
● Dirección del servidor SMTP
Muestra la dirección IP, el FQDN (Fully Qualified Domain Name) o el nombre de host del
servidor SMTP.
● Dirección de e-mail del destinatario
Indique la dirección de correo electrónico a la que el dispositivo debe enviar un correo
electrónico en caso de fallo.

Cliente SMTP (S615)
General
Vigilancia de la red mediante e-mails
Al producirse eventos, el dispositivo puede enviar automáticamente un correo electrónico,
p. ej. al técnico de servicio. El correo electrónico contiene la identificación del dispositivo
remitente, una descripción de la causa en texto explícito y un sello de tiempo. De este modo
se puede crear para redes con pocas estaciones un equipo sencillo y centralizado de vigilancia
de la red sobre la base de un sistema de correo electrónico.
Para que se envíen correos electrónicos, los eventos deben tener activado el ajuste "Correo
electrónico". Los avisos que se envían dependen de la severidad ajustada. Las direcciones de
correo electrónico a las que el dispositivo envía un correo electrónico como prueba o en caso
de fallo se configuran en la ficha "Destinatario".

Requisitos para el envío de correos electrónicos
● En "Sistema > Eventos > Configuración" está activado "Correo electrónico" en el evento
correspondiente.
● En "Sistema > Eventos > Filtro de Severity" está configurada la severidad deseada.
● En "Sistema > Cliente SMTP > Destinatario" hay como mínimo una entrada y el ajuste
"Enviar" está activado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

629

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Cliente SMTP
Active o desactive el cliente SMTP.
● Dirección de servidor SMTP
Introduzca la dirección IP o el FQDN (Fully Qualified Domain Name) del servidor SMTP.
La tabla contiene las siguientes columnas:
● Status
Especifique si debe utilizarse este servidor SMTP.
● Dirección de servidor SMTP
Indica la dirección IP o el FQDN (Fully Qualified Domain Name) del servidor SMTP.
● Dirección de correo electrónico del remitente
Introduzca la dirección de correo electrónico del remitente que se indica en el correo
electrónico.
● Nombre de usuario
Si fuera necesario, introduzca el nombre de usuario que se utilizará para la autenticación
en el servidor SMTP.
● Contraseña
Si fuera necesario, introduzca la contraseña que se utilizará para la autenticación en el
servidor SMTP.
● Confirmar contraseña
Repita la contraseña.
● Puerto
Introduzca el puerto a través del que se puede acceder al servidor SMTP.
Ajuste de fábrica:
– 25 (None)
– 465 (SSL/TLS y StartTLS)
● Security
Especifique si la transferencia del correo electrónico entre el dispositivo y el servidor SMTP
debe cifrarse. Esto significa que es imprescindible que el servidor SMTP soporte el ajuste
seleccionado.
Nota
Autenticación de 2 factores (2FA)
La autenticación de 2 factores no se soporta.
– SSL/TLS
– StartTLS
– None: El mensaje de correo electrónico se envía sin cifrar.

630

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Test (solo disponible online)
Envía un correo electrónico de prueba al destinatario configurado.
● Resultado del test (solo disponible online)
Indica si el mensaje de correo electrónico se ha enviado correctamente o no. Si no se ha
enviado correctamente, el aviso contendrá las posibles causas.

Destinatario
En esta página se especifica quién recibe un correo electrónico cuando se produce un evento.

Descripción
La página contiene los siguientes campos:
● Servidor SMTP
Especifique el servidor SMTP por el que se enviará el correo electrónico.
● Dirección de correo electrónico del destinatario SMTP
Introduzca la dirección de correo electrónico a la que el dispositivo debe enviar un correo
electrónico.
La tabla contiene las siguientes columnas:
● Servidor SMTP
Indica la dirección IP o el FQDN (Fully Qualified Domain Name) del servidor SMTP al que
se refiere la entrada.
● Enviar
Cuando está activado, el dispositivo envía un correo electrónico a este destinatario.
● Dirección de correo electrónico del destinatario SMTP
Indica la dirección de correo electrónico a la que el dispositivo debe enviar un correo
electrónico en caso de fallo.

SNMP
General
En esta página se describen los ajustes básicos de SNMP. Active las opciones según la
función que desee utilizar.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

631

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● SNMP
Elija el protocolo SNMP. Son posibles los siguientes ajustes:
– "-" (desactivado)
SNMP desactivado.
– SNMPv1/v2c/v3
Se soporta SNMPv1/v2c/v3.
Nota
Tenga en cuenta que SNMP no dispone de mecanismos de seguridad en las versiones
1 y 2c.
– SNMPv3
Solo se soporta SNMPv3.
● SNMPv1/v2 solo lectura
Si activa esta opción, SNMPv1/v2c solo puede acceder a las variables SNMP en modo de
lectura.
Nota
Community String
Por razones de seguridad, no deben utilizarse los valores estándar "public" ni "private".
Modifique los Community Strings después de la primera instalación.
La longitud mínima recomendada para Community Strings es de 6 caracteres
● SNMPv1/v2c Read Community String - Lectura
Introduzca el Community String para el acceso del protocolo SNMP.
● SNMPv1/v2c Read/Write Community String - Lectura/escritura
Introduzca el Community String para el acceso de lectura y escritura del protocolo SNMP.
● SNMPv1 Traps
Active o desactive el envío de traps SNMPv1 (telegramas de alarma). En la entrada "Trap"
se determinan las direcciones IP de los dispositivos a los que se envían traps SNMPv1.
● SNMPv1/v2c Trap Community String - Trap
Introduzca el Community String para el envío de avisos SNMPv1/v2c.
● Migración de usuarios SNMPv3
– Activada
Si la función está activada se genera una ID de máquina SNMP que puede migrarse. Los
usuarios SNMPv3 configurados pueden transferirse a otro dispositivo.
Si se activa esta función y se carga la configuración del dispositivo a otro equipo, se
conservan los usuarios SNMPv3 configurados.
– Desactivado
Si la función está desactivada se genera una ID de máquina SNMP específica del
dispositivo. Para generar la ID se utiliza la dirección MAC de agente del dispositivo. Esta
configuración de usuario SNMP no puede transferirse a otros dispositivos.
Si se carga la configuración del dispositivo a otro equipo, se borran todos los usuarios
SNMPv3 configurados.

632

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● ID de máquina SNMP (solo disponible online)
Muestra la ID de máquina SNMP.
● Puerto Listen de SNMP Agent
Especifique el puerto en el que el SNMP Agent debe esperar las solicitudes SNMP.

Traps
Cuando se produce un evento de alarma, un dispositivo puede enviar traps SNMP (telegramas
de alarma) a un máximo de 10 estaciones de gestión distintas. Solo se envían traps cuando se
producen los eventos definidos al efecto en "Eventos".
Nota
Solo se envían traps SNMP si en "SNMP > General" o en "Sistema > Configuración" está
activado el ajuste "SNMPv1 Traps".

Descripción
● Dirección del receptor de Traps
Introduzca la dirección IP o el FQDN (Fully Qualified Domain Name) de la estación a la que
el dispositivo envía traps SNMP. Es posible indicar un máximo de diez destinatarios
distintos.
La tabla se divide en las siguientes columnas:
● Dirección del receptor de Traps
En caso necesario, modifique la dirección IP o el FQDN (Fully Qualified Domain Name) de
las estaciones.
● Trap
Active o desactive el envío de traps SNMP. Las estaciones especificadas pero no
seleccionadas no recibirán traps SNMP.

Grupos v3
Ajustes de seguridad y asignación de derechos
SNMP Versión 3 ofrece asignación de derechos, autentificación y codificación a nivel de
protocolo. El nivel de seguridad y los derechos de lectura/escritura se definen específicamente
por grupos. Para cada miembro de un grupo se aplican automáticamente los ajustes
correspondientes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

633

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● Nombre del grupo
Introduzca el nombre del grupo. La longitud máxima es de 32 caracteres.
● Nivel de seguridad
Seleccione el nivel de seguridad (autentificación, codificación) válido para el grupo
seleccionado. Existen las siguientes posibilidades:
– Sin aut./sin priv.
Autentificación no activada / codificación no activada.
– Aut./Sin priv.
Autentificación activada / codificación no activada.
– Aut./priv.
Autentificación activada / codificación activada.
La tabla se divide en las siguientes columnas:
● Nombre del grupo
Muestra los nombres de grupo definidos.
Nota
El nombre del grupo y el nivel de seguridad no pueden modificarse una vez creados y
asignados. Si desea cambiar el nombre del grupo o el nivel de seguridad, debe borrar el
grupo, crearlo con un nuevo nombre y configurarlo de nuevo.
● Nivel de seguridad
Muestra el nivel de seguridad configurado.
● Lectura
Active o desactive el acceso de lectura para el grupo deseado.
● Escritura
Active o desactive el acceso de escritura para el grupo deseado.
Nota
Para que el acceso de escritura funcione también es necesario activar el acceso de lectura.
● Persistencia
Indica si el grupo está asignado a un usuario SNMPv3. Si el grupo no está asignado a
ningún usuario SNMPv3 no se inicia el guardado automático y el grupo configurado se
borrará tras realizar un rearranque completo del dispositivo.
– Sí
El grupo está asignado a un usuario SNMPv3.
– No
El grupo no está asignado a ningún usuario SNMPv3.

634

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Usuarios v3
Ajustes de seguridad personalizados
En la página es posible crear usuarios SNMPv3, modificarlos o borrarlos. El modelo de
seguridad basado en el usuario se centra en el nombre del usuario, es decir, se asigna a cada
telegrama el identificador de usuario correspondiente. Este nombre de usuario y los ajustes de
seguridad en cuestión son comprobados tanto por el remitente como por el destinatario.

Descripción
● Nombre de usuario
Introduzca un nombre de usuario cualquiera. Una vez aplicados los datos, no podrá
cambiar el nombre.
La tabla se divide en las siguientes columnas:
● Nombre de usuario
Muestra los usuarios creados.
● Nombre del grupo
Seleccione el grupo que debe asignarse al usuario.
● Protocolo de autentificación
Defina el protocolo de autenticación para el que debe establecerse una contraseña.
Existen los siguientes ajustes:
– Ninguno
– MD5
– SHA
● Protocolo de encriptado
Especifique si debe establecerse una contraseña para el encriptado con el algoritmo DES.
Solo activable si también se ha seleccionado un protocolo de autenticación.
● Contraseña de autenticación
Introduzca la contraseña de autenticación. La contraseña ha de tener como mínimo 1
carácter y como máximo 32.
Nota
Longitud de la contraseña
Como medida importante para aumentar la seguridad, recomendamos que la contraseña
tenga como mínimo 6 caracteres y contengan caracteres especiales, mayúsculas y
minúsculas, números, etc.
● Confirmar contraseña de autenticación
Confirme la contraseña volviéndola a introducir.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

635

Configuración de dispositivos y redes
1.3 Configurar redes
● Contraseña de encriptado
Introduzca su contraseña de codificación. La contraseña ha de tener como mínimo 1
carácter y como máximo 32.
Nota
Longitud de la contraseña
Como medida importante para aumentar la seguridad, recomendamos que la contraseña
tenga como mínimo 6 caracteres y contengan caracteres especiales, mayúsculas y
minúsculas, números, etc.
● Confirmar contraseña de encriptado
Confirme la contraseña de codificación volviéndola a introducir.
● Persistencia
Indica si el usuario está asignado a un grupo SNMPv3. Si el usuario no está asignado a
ningún grupo SNMPv3 no se inicia el guardado automático y el usuario configurado se
borrará tras realizar un rearranque completo del dispositivo.
– Sí
El usuario está asignado a un grupo SNMPv3.
– No
El usuario no está asignado a ningún grupo SNMPv3.

Hora del sistema
Sinopsis
Para ajustar la hora del sistema existen métodos diferentes. Solo puede estar activo un
método.
Si se activa un método, se desactiva el método activo hasta entonces automáticamente.

Ajuste manual
Ajuste manual de la hora del sistema
En esta página se ajusta la fecha y la hora del sistema. Para utilizar este ajuste, es necesario
activar "Ajuste manual de la hora".
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

636

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● Ajuste manual de la hora
Active o desactive el ajuste manual de la hora. Si activa esta opción, el campo de entrada
"Hora del sistema" pasa a ser editable.
● Hora del sistema
Introduzca la fecha y la hora en el formato "MM/DD/YYYY HH:MM:SS".
● Utilizar la hora del PC
Haga clic en el botón para aplicar el ajuste de la hora del PC.
● Momento de la última sincronización
Indica cuándo ha tenido lugar la última sincronización.
Si no ha sido posible sincronizar la hora, el campo contendrá la entrada "Fecha/hora no
ajustadas".
● Último mecanismo de sincronización
Este campo muestra cómo se ha efectuado la última sincronización horaria.
– No ajustado
La hora no se ha ajustado.
– Manual
Ajuste manual de la hora
– SNTP
Sincronización horaria automática mediante SNTP
– NTP
Sincronización horaria automática mediante NTP
– SIMATIC
Sincronización horaria automática mediante telegrama horario SIMATIC.
– PTP
Sincronización horaria automática mediante PTP
● Horario de verano (DST)
Indica si el cambio de horario de verano está activo.
– active (offset + 1 h)
la hora del sistema ha pasado a horario de verano, es decir, se incrementa una hora. La
hora actual del sistema se ve en la parte superior derecha del área de selección del
WBM. En el campo "Hora del sistema" se sigue mostrando la hora ajustada.
– inactive (offset + 0 h)
la hora actual del sistema no cambia.

Sinopsis de DST (S615)
Cambio del horario de verano
Esta página permite crear entradas para cambiar el horario de verano. La tabla proporciona
una sinopsis de las entradas existentes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

637

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● N.º DST
Muestra el número de la entrada.
Al crear una entrada se crea una fila con un número unívoco.
● Nombre
Muestra el nombre de la entrada.
● Año
Indica el año para el que se creó la entrada.
● Fecha de inicio
Indica el mes, el día y la hora del inicio del horario de verano.
● Fecha de fin
Indica el mes, el día y la hora del final del horario de verano.
● Instantes regulares del cambio de hora
Con una entrada del tipo "Regla" se muestra el intervalo de tiempo, que consta de semana,
día, mes y hora en los que está activo el horario de verano. Con una entrada del tipo "Fecha"
se muestra "-".
● Estado
Muestra el estado de la entrada:
– Activado
La entrada se ha creado correctamente.
– No válido
La entrada ha vuelto a crearse y la fecha de inicio y de fin son idénticas.
● Tipo
Indica cómo se realiza el cambio del horario de verano:
– Fecha
Se ha introducido una fecha fija para el cambio de horario de verano.
– Regla
Hay definida una regla para el cambio de horario de verano.

Configuración de DST (S615)
Configurar el cambio del horario de verano
Esta página permite configurar las entradas para cambiar el horario de verano. Gracias al
cambio del horario de verano o invierno, la hora del sistema está bien ajustada a la zona
horaria local. Se puede definir una regla para el cambio del horario de verano o introducir una
fecha determinada.

638

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
Nota
El contenido de esta página depende de la selección realizada en el campo "Tipo".
Los campos "N.º DST", "Tipo" y "Nombre" se muestran siempre.
● N.º DST
Seleccione el número de la entrada.
● Tipo
Seleccione cómo debe ser el cambio del horario de verano:
– Fecha
Es posible indicar una fecha fija para el cambio de horario de verano. Este ajuste es
adecuado para regiones en las que el cambio del horario de verano no está sujeto a
reglas.
– Periódicamente
Se puede definir una regla para el cambio de horario de verano. Este ajuste es adecuado
para regiones en las que el horario de verano empieza y termina siempre en un día
concreto de la semana.
● Nombre
Indique un nombre para la entrada. El nombre puede tener como máximo 16 caracteres.
Ajustes con la selección "Fecha"
Se puede indicar una fecha fija para el inicio y el final del horario de verano.
● Año
Indique el año para el cambio de horario de verano.
● Fecha de inicio
Indique los siguientes valores para el inicio del horario de verano:
– Día
Indique el día.
– Hora
Indique la hora.
– Mes
Indique el mes.
● Fecha de fin
Indique los siguientes valores para el final del horario de verano:
– Día
Indique el día.
– Hora
Indique la hora.
– Mes
Indique el mes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

639

Configuración de dispositivos y redes
1.3 Configurar redes
Ajustes con la selección "Regla"
Se puede crear una regla para el cambio de horario de verano.
● Fecha de inicio
Indique los siguientes valores para el inicio del horario de verano:
– Hora
Indique la hora.
– Mes
Indique el mes.
– Semana
Indique la semana.
Se pueden seleccionar desde la primera hasta la cuarta o la última semana del mes.
– Día de la semana
Indique el día de la semana.
● Fecha de fin
Indique los siguientes valores para el final del horario de verano:
– Hora
Indique la hora.
– Mes
Indique el mes.
– Semana
Indique la semana.
Se pueden seleccionar las semanas 1.ª a 4.ª o la última semana del mes.
– Día de la semana
Indique el día de la semana.

Cliente SNTP
Para ajustar la hora del sistema existen métodos diferentes. Solo puede estar activo un
método. Si se activa un método, se desactiva el método activo hasta entonces
automáticamente.
El SNTP (Simple Network Time Protocol) sirve para la sincronización horaria en la red. Los
telegramas correspondientes son enviados por un servidor SNTP integrado en la red.
Nota
Para evitar saltos de hora, asegúrese de que en la red solo haya un servidor de tiempo.

Descripción
● Cliente SNTP
Active o desactive la sincronización horaria automática vía SNTP.
● Hora actual del sistema (solo disponible online)
Muestra la fecha y la hora normal actuales recibidas por el dispositivo. Si se indica una zona
horaria, la hora se adaptará en correspondencia.

640

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Momento de la última sincronización (solo disponible online)
Indica cuándo ha tenido lugar la última sincronización horaria.
● Último mecanismo de sincronización (solo disponible online)
Muestra cómo se ha efectuado la última sincronización horaria. Existen las siguientes
posibilidades:
– No ajustado
La hora no se ha ajustado.
– Manual
Ajuste manual de la hora
– SNTP
Sincronización horaria automática mediante SNTP
– NTP
Sincronización horaria automática mediante NTP
– SIMATIC
Sincronización horaria automática mediante telegrama horario SIMATIC
● Zona horaria
Introduzca la zona horaria utilizada en formato "+/- HH:MM". La zona horaria se basa en el
tiempo universal coordinado (UTC).
La hora indicada en el campo "Hora actual del sistema" se adapta en correspondencia.
● Horario de verano (DST) (solo disponible online para S615)
Indica si el cambio de horario de verano está activo.
– active (offset +1 h)
La hora del sistema ha pasado a horario de verano, es decir, se incrementa una hora.
La hora actual del sistema se ve en la parte superior derecha del área de selección del
WBM.
En el campo "Hora del sistema" se sigue mostrando la hora ajustada.
– inactive (offset +0 h)
La hora actual del sistema no cambia.
● Modo SNTP
Seleccione el tipo de sincronización. Son posibles los siguientes tipos de sincronización:
– Poll
Si selecciona este tipo de protocolo, los campos de entrada "Dirección de servidor
SNTP", "Puerto del servidor SNTP" e "Intervalo de sondeo[s]" se muestran para
continuar la configuración. Con este tipo de sincronización, el dispositivo actúa de forma
activa y envía solicitudes de hora al servidor SNTP.
– Listen
Con este tipo de sincronización, el equipo actúa de forma pasiva y recibe telegramas
SNTP que proporcionan la hora.
Cree manualmente las siguientes reglas de cortafuegos para este modo:
Acción: Accept
De: vlanX
A: Dispositivo
Source Port: *
Puerto de destino: 123 (UDP)
Solo para S615: active la entrada "Hora del sistema" en "Seguridad > Cortafuegos >
Reglas IPv4 predefinidas".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

641

Configuración de dispositivos y redes
1.3 Configurar redes
● Intervalo de sondeo [s]
Introduzca el intervalo de tiempo entre dos solicitudes de hora. El intervalo entre solicitudes
se indica en segundos en este campo. Los posibles valores se sitúan entre 16 y 16284
segundos.
● Dirección de servidor SNTP
Introduzca aquí la dirección IP o el FQDN (Fully Qualified Domain Name) del servidor SNTP.
● Puerto del servidor SNTP
Introduzca el puerto del servidor SNTP.
Son posibles los siguientes puertos:
– 123 (puerto estándar)
– 1025 a 36564
Solo para S615: La tabla se divide en las siguientes columnas:
● Dirección de servidor SNTP
Muestra la dirección IP, el FQDN (Fully Qualified Domain Name) o el nombre de host del
servidor SNTP.
● Puerto del servidor SNTP
Introduzca el puerto del servidor SNTP.
Son posibles los siguientes puertos:
– 123 (puerto estándar)
– 1025 a 36564
● Primaria
Se coloca la marca de verificación para el servidor SNTP que había creado primero. Si se
han creado varios servidores SNTP, primero se consulta al servidor primario.

Cliente NTP
Si la sincronización horaria debe efectuarse mediante NTP, aquí puede realizar los
correspondientes ajustes.
Nota
Para evitar saltos de hora, asegúrese de que en la red solo haya un servidor de tiempo.

Descripción
● Cliente NTP
Si está activado, el dispositivo obtiene la hora del sistema de un servidor NTP.
● Solo cliente NTP (secure)
Si está activado, el dispositivo recibe la hora del sistema desde un servidor NTP seguro.
Este ajuste es válido para todas las entradas del servidor.
Para activar el cliente NTP seguro es necesario configurar los parámetros para la
autenticación (ID de clave, algoritmo hash, clave). En el servidor Secure NTP deben estar
todas las entradas.

642

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Hora actual del sistema (solo disponible online)
Muestra la fecha y la hora normal actuales recibidas por el dispositivo. Si se indica una zona
horaria, la hora se adaptará en correspondencia.
● Momento de la última sincronización (solo disponible online)
Indica cuándo ha tenido lugar la última sincronización horaria.
● Último mecanismo de sincronización (solo disponible online)
Muestra cómo se ha efectuado la última sincronización horaria. Existen las siguientes
posibilidades:
– No ajustado
La hora no se ha ajustado.
– Manual
Ajuste manual de la hora
– SNTP
Sincronización horaria automática mediante SNTP
– NTP
Sincronización horaria automática mediante NTP
– SIMATIC
Sincronización horaria automática mediante telegrama horario SIMATIC
● Zona horaria
Introduzca la zona horaria utilizada en formato "+/- HH:MM". La zona horaria se basa en el
tiempo universal coordinado (UTC).
La hora indicada en el campo "Hora actual del sistema" se adapta en correspondencia.
● Horario de verano (DST) (solo disponible online para S615)
Indica si el cambio de horario de verano está activo.
– active (offset +1 h)
La hora del sistema ha pasado a horario de verano, es decir, se incrementa una hora.
La hora actual del sistema se ve en la parte superior derecha del área de selección del
WBM.
En el campo "Hora del sistema" se sigue mostrando la hora ajustada.
– inactive (offset +0 h)
La hora actual del sistema no cambia.
● Índice de servidor NTP
Seleccione el índice del servidor NTP. Se consulta primero al servidor con el índice más
bajo.
● Dirección de servidor SMTP
Introduzca aquí la dirección IP o el FQDN (Fully Qualified Domain Name) del servidor
SMTP.
● Puerto del servidor NTP
Indique el puerto del servidor NTP.
Son posibles los siguientes puertos:
– 123 (puerto estándar)
– 1025 a 36564

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

643

Configuración de dispositivos y redes
1.3 Configurar redes
● Intervalo de sondeo
Indique el intervalo de tiempo entre dos solicitudes de hora. Cuanto mayor sea el intervalo
de tiempo, más imprecisa será la hora del dispositivo. Son valores posibles 64 a 2 592 000
segundos (30 días).
● ID de la clave
Introduzca la ID de la clave de autenticación.
● Algoritmo hash
Defina el formato de la clave de autenticación.
● Clave
Introduzca la clave de autenticación. La longitud depende del algoritmo hash.
– DES: 8 caracteres ASCII
– MD5: 16 - 128 caracteres ASCII
– SHA1: 20 - 128 caracteres ASCII

SIMATIC Time Client
Ajuste de la hora mediante SIMATIC Time Client
En esta página se configura la sincronización horaria utilizando el SIMATIC Time Client.
Nota
Para evitar saltos de hora, asegúrese de que en la red solo haya un servidor de tiempo.

Descripción
● SIMATIC Time Client
Marque esta casilla de verificación para activar el dispositivo como SIMATIC Time Client.
● Hora actual del sistema (solo disponible online)
Indica la hora actual del sistema.
● Momento de la última sincronización (solo disponible online)
Indica cuándo ha tenido lugar la última sincronización horaria.

644

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Último mecanismo de sincronización (solo disponible online)
Muestra cómo se ha efectuado la última sincronización horaria. Existen las siguientes
posibilidades:
– No ajustado
La hora no se ha ajustado.
– Manual
Ajuste manual de la hora
– SNTP
Sincronización horaria automática mediante SNTP
– NTP
Sincronización horaria automática mediante NTP
– SIMATIC
Sincronización horaria automática mediante telegrama horario SIMATIC
– PTP
Sincronización horaria automática mediante PTP
● Horario de verano (DST) (solo disponible online para S615)
Indica si el cambio de horario de verano está activo.
– active (offset +1 h)
La hora del sistema ha pasado a horario de verano, es decir, se incrementa una hora.
La hora actual del sistema se ve en la parte superior derecha del área de selección del
WBM.
En el campo "Hora del sistema" se sigue mostrando la hora ajustada.
– inactive (offset +0 h)
La hora actual del sistema no cambia.

Servidor NTP
En esta página se configura el dispositivo como servidor NTP. Los demás dispositivos pueden
consultar la hora actual a través de este servidor NTP. De este modo los dispositivos
alimentados no necesitan tener conexión con un servidor horario externo.

Requisitos
Para que se reciban telegramas NTP es necesario crear las siguiente reglas de cortafuegos:
Acción: Accept
De: vlanX
A: Dispositivo
Source Port: *
Puerto de destino: 123 (UDP)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

645

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Servidor NTP
Active o desactive el servicio Servidor NTP.
La tabla 1 se divide en las siguientes columnas:
● En todas las interfaces
Indica que los ajustes son válidos para todas las interfaces de la tabla 2.
● Escuchar
Seleccione en la lista desplegable el ajuste para todas las interfaces. Si está seleccionado
"Sin cambios", las entradas de la correspondiente columna de la tabla 2 no cambian.
● Aplicar a tabla
Si se hace clic en este botón los ajustes se aplican a todas las interfaces de la tabla 2.
La tabla 2 se divide en las siguientes columnas:
● Interfaz
A través de esta interfaz se transfiere la hora vía NTP.
● Escuchar
Si está activado, los demás dispositivos pueden consultar la hora a través de esta interfaz.

Cierre de sesión automático
En esta página se ajustan los tiempos tras los que se efectúa un cierre de sesión automático
en WBM o CLI por inactividad del usuario.
Si su sesión se ha cerrado automáticamente, debe volver a iniciar sesión.
Nota
No hay cierre de sesión automático en la CLI
Si la conexión no finaliza una vez transcurrido el tiempo configurado, verifique el ajuste de
"Keep Alive" en el cliente Telnet.
Si el intervalo de "Keep Alive" es inferior al tiempo configurado, la conexión se mantendrá
aunque no se transfieran datos de usuario. P. ej., en el cierre de sesión automático se ha
ajustado 300 segundos y en la función "Keep alive" se ha ajustado 120 segundos. En este caso
se envía un paquete cada 120 segundos, que hace que se mantenga establecida la conexión.
● Desactive el mecanismo Keep Alive (intervalo=0).
o bien
● Ajuste un intervalo tan alto que la conexión subordinada finalice en caso de inactividad.

646

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● Web Based Management
Introduzca el tiempo en segundos para el cierre de sesión automático del WBM. Si
introduce el valor 0, se desactiva el cierre de sesión automático.
● CLI (TELNET, SSH)
Introduzca el tiempo en segundos para el cierre de sesión automático del CLI. Si introduce
el valor 0, se desactiva el cierre de sesión automático.

Pulsador
Funktionalität SCALANCE S615
El pulsador SET sirve para:
● Rearranque completo
● Cargar un firmware nuevo
● Restablecer la configuración de fábrica.
Encontrará una descripción detallada de las funciones en las instrucciones de servicio del
dispositivo.
En esta página puede limitarse la funcionalidad del pulsador.

Descripción SCALANCE S615
Son posibles las funcionalidades siguientes:
● Rearranque / Restablecer configuración de fábrica
Si está desactivado el pulsador SET no puede utilizarse para el rearranque completo ni
para restablecer la configuración de fábrica.
PRECAUCIÓN
Durante el arranque está activada la función "Rearranque completo / Restablecer la
configuración de fábrica" del pulsador
Si desactivó esta función para su configuración, el efecto solo será aplicable con el equipo
en funcionamiento. Durante el arranque (p. ej. después de un fallo eléctrico) la función
está activa hasta que se termina de cargar la configuración, por lo que se corre el riesgo
de restablecer los ajustes de fábrica, aunque sea de forma involuntaria. Esto puede causar
perturbaciones indeseadas en el funcionamiento de la red, ya que, en dicho caso, será
necesario volver a configurar el dispositivo. En caso de haber un PLUG insertado en el
equipo, perderá su contenido y volverá a su estado original.

Funcionalidad SCALANCE SC63x-2C/SC64x-2C
El pulsador SET sirve para:
● Restablecer la configuración de fábrica,
● Definir la máscara de señalización y los indicadores LED.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

647

Configuración de dispositivos y redes
1.3 Configurar redes
Encontrará una descripción detallada de las funciones en las instrucciones de servicio del
dispositivo.
En esta página puede limitarse la funcionalidad del pulsador.

Descripción SCALANCE SC63x-2C/SC64x-2C
Es posible la funcionalidad siguiente:
● Restablecer configuración de fábrica
Si está desactivado el pulsador SET no puede utilizarse para restablecer la configuración
de fábrica.
PRECAUCIÓN
Función "Restablecer configuración de fábrica" activa en el pulsador al arrancar
Si desactivó esta función para su configuración, el efecto solo será aplicable con el equipo
en funcionamiento. Durante el arranque (p. ej. después de un fallo eléctrico) la función
está activa hasta que se termina de cargar la configuración, por lo que se corre el riesgo
de restablecer los ajustes de fábrica, aunque sea de forma involuntaria. Esto puede causar
perturbaciones indeseadas en el funcionamiento de la red, ya que, en dicho caso, será
necesario volver a configurar el dispositivo. En caso de haber un PLUG insertado en el
equipo, perderá su contenido y volverá a su estado original.
● Activar la máscara de avisos
Active o desactive la función "Definir la máscara de avisos mediante el indicador LED" con
el pulsador Select/Set.

Cliente Syslog
Agente de eventos del sistema
Syslog según RFC 3164 se usa en la red IP para la transmisión de mensajes de texto cortos
y no codificados a través de UDP. Para ello se requiere un servidor Syslog.

Requisitos para el envío de entradas de registro
● La función Syslog está activada en el equipo.
● La función Syslog para el evento correspondiente está activada.
● En su red se encuentra un servidor Syslog que recibe los registros log. Como se trata de
una conexión UDP, no hay respuesta al emisor.
● La dirección IP o el FQDN (Fully Qualified Domain Name) del servidor Syslog está
introducido en el dispositivo.

648

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Cliente Syslog
Active o desactive la función Syslog.
● Dirección del servidor Syslog
Introduzca aquí la dirección IP o el FQDN (Fully Qualified Domain Name) del servidor
Syslog.
La tabla contiene las siguientes columnas:
● Dirección del servidor Syslog
Indica la dirección IP o el FQDN (Fully Qualified Domain Name) del servidor Syslog.
● Puerto de servidor
Indique el puerto que utiliza el servidor Syslog.

Puertos
Sinopsis (SC-600)
La página muestra la configuración para la transferencia de datos para todos los puertos del
dispositivo. En esta página no es posible realizar ajustes.

Descripción
La tabla se divide en las siguientes columnas:
● Puerto
Muestra los puertos configurables. El puerto se compone del número de módulo y del
número de puerto, p. ej. el puerto 0.1 es el módulo 0, puerto 1.
● Nombre del puerto
Muestra el nombre del puerto.
● Tipo de puerto (solo con routing)
Indica el tipo de puerto. Son posibles los siguientes tipos:
– Puerto Switch VLAN Hybrid
– Puerto switch VLAN Trunk
● Tipo de medio Combo Port (solo disponible online)
Esta columna solo contiene un valor en Combo Ports.
Muestra el modo del Combo Port:
– auto
– rj45
– sfp
● Estado
Indica si el puerto está activado o desactivado. El tráfico de datos solo es posible a través
de un puerto activado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

649

Configuración de dispositivos y redes
1.3 Configurar redes
● Estado operativo (solo disponible online)
Indica el estado operativo actual. El estado operativo depende del "Estado" y del "Link"
configurados. Existen las siguientes posibilidades:
– Up
Se ha configurado el estado "enabled" para el puerto y el puerto tiene una conexión
válida con la red.
– Down
Se ha configurado el estado "disabled" o "Link down" para el puerto o el puerto no tiene
conexión.
● Modo de transmisión act (solo disponible online)
Muestra los parámetros de transferencia del puerto.
● MTU (Maximum Transmission Unit)
Indica el tamaño de paquete.
● Negociación
Indica si la configuración automática está activada o desactivada.
● Tipo de control de flujo
Indica si el control de flujo está activado o desactivado para el puerto.
● Control de flujo
Indica si el control de flujo trabaja en ese puerto.
● Dirección MAC (solo disponible online)
Muestra la dirección MAC del puerto.
● Bloqueado por (solo disponible online)
Indica por qué el puerto está en estado "blocked":
– El puerto no está bloqueado.
– Admin down
El puerto tiene configurado el estado "disabled"; consulte "System > Ports >
Configuration".
– Link down
El puerto tiene configurado el estado "enabled" pero no hay ninguna conexión; consulte
"System > Ports > Configuration".
– Power down
El puerto tiene configurado el estado "Link down"; consulte "Sistema > Puertos >
Configuración".

Visualización divergente de los parámetros de transferencia en Combo Ports
En el estado de conexión "down", los parámetros de transferencia visualizados no se
corresponden con los valores propiamente dichos del Combo Port. En el estado de conexión
"up" se muestran los valores correctos.
Situación inicial

650

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Hay insertado un transceptor enchufable en el Combo Port con los ajustes siguientes:
● Tipo de medio del Combo Port: auto
● Estado: enabled
● Link: down
Visualización de los parámetros de transferencia
Para transceptores enchufables de 100 Mbits/s
● Comportamiento real: Modo: 100M HD
● Comportamiento teórico: Modo: 100M FD
Para transceptores enchufables de 1 Gbit/s
● Comportamiento real: Modo: 1G HD
● Comportamiento teórico: Modo: 1G FD

Configuración (SC-600)
Configuración de puertos
Esta página permite configurar todos los puertos del equipo.

Descripción
● Puerto
Seleccione el puerto que debe configurarse en la lista desplegable.
● Estado
Defina si el puerto está activado o desactivado.
– enabled
El puerto está activado. El tráfico de datos solo es posible a través de un puerto activado.
– disabled
El puerto está desactivado pero la conexión sigue activa.
Nota
No desconecte puertos no utilizados.
– Link down
El puerto está desactivado y la conexión con el dispositivo partner se ha cancelado.
● Nombre del puerto
Introduzca aquí un nombre para el puerto.
● Dirección MAC (solo disponible online)
Muestra la dirección MAC del puerto.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

651

Configuración de dispositivos y redes
1.3 Configurar redes
● Modo de transmisión
Seleccione la velocidad y el método de transmisión del puerto en la lista desplegable. Si se
ajusta el modo de operación "Autonegotiation", los parámetros se negociarán
automáticamente con el terminal o el componente de red conectados. Estos también deben
estar en el modo de operación "Autonegotiation".
Nota
Para que el puerto y el puerto interlocutor puedan comunicarse, es necesario que los
ajustes coincidan en ambas partes.
Nota
"Modo de transferencia" en Combo Ports
Para poder ajustar el "Modo de transferencia" de un Combo Port debe cambiarse el "Tipo
de medio Combo Port" por "rj45". Si el "Tipo de medio Combo Port" está en "automático" y
se utiliza el puerto RJ45, no es posible ajustar el "Modo de transferencia".
● Modo de transmisión act. (solo disponible online)
Indica la velocidad y el método de transferencia del puerto. Son posibles los siguientes
ajustes:
– 10 Mbits/s dúplex (FD) o semiduplex (HD)
– 100 Mbits/s dúplex (FD) o semiduplex (HD)
– 1000 Mbits/s dúplex (FD)
● Negociación
Indica si la configuración automática de la conexión con el puerto interlocutor está activada
o desactivada.
Nota
Activar y desactivar el control de flujo con Autonegotiation
Solo es posible activar o desactivar el control de flujo si la función "Autonegotiation" está
desactivada. Posteriormente puede volver a activarse la función.
● Tipo de control de flujo
Active o desactive el control de flujo para el puerto.
● MTU
Introduzca el tamaño de los paquetes.
● Control de flujo
Indica si el control de flujo trabaja en ese puerto.
● Tipo de puerto
Seleccione el tipo de puerto en la lista desplegable.
– Puerto Switch VLAN Hybrid
El puerto envía telegramas con y sin identificador. No forma parte automáticamente de
una VLAN.
– Puerto switch VLAN Trunk
El puerto envía solo telegramas con tag y forma parte automáticamente de todas las
VLANs.

652

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Tipo de medio Combo Port
Defina el modo del Combo Port:
– auto
Si selecciona este modo, tendrá prioridad el puerto del transceptor enchufable.
Tan pronto como se inserta un transceptor enchufable, se desconecta la conexión
existente en el puerto fijo RJ45. Si no hay ningún transceptor enchufable insertado, se
puede establecer una conexión por medio del puerto RJ45 fijo.
– rj45
Si selecciona este modo, se utilizará el puerto RJ45 fijo, independientemente del puerto
del transceptor enchufable.
Si hay un transceptor enchufable insertado, este se desactivará y desconectará de la
corriente.
– sfp
Si selecciona este modo, se utilizará el puerto del transceptor enchufable,
independientemente del puerto RJ45 fijo.
Si existe una conexión RJ45, esta se desconectará, ya que el puerto RJ45 se
desconectará de la corriente.
La configuración de fábrica de los Combo Ports es el modo auto.
Nota
Adaptación automática mediante la configuración de PROFINET
Al establecer una conexión PROFINET se adapta también automáticamente el ajuste del
tipo de medio del Combo Port.
● Si hay un transceptor enchufable configurado, el tipo de medio del Combo Port se pone
a "sfp".
● Si está configurado el puerto RJ45 fijo, el tipo de medio del Combo Port se pone a "rj45".
Para que se lleve a cabo la adaptación automática, el tipo de medio del Combo Port debe
estar ajustado en "auto".
Configure el tipo de medio del Combo Port en correspondencia desde WBM o CLI.
● Estado operativo (solo disponible online)
Indica el estado operativo actual. El estado operativo depende del "Estado" y del "Link"
configurados. Existen las siguientes posibilidades:
– Up
Se ha configurado el estado "enabled" para el puerto y el puerto tiene una conexión
válida con la red.
– Down
Se ha configurado el estado "disabled" o "Link down" para el puerto o el puerto no tiene
conexión.
– not present
En dispositivos modulares, este estado se muestra cuando no hay ningún módulo de
medios insertado, por ejemplo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

653

Configuración de dispositivos y redes
1.3 Configurar redes
● Bloqueado por (solo disponible online)
● Indica por qué el puerto está en estado "blocked":
– El puerto no está bloqueado.
– Admin down
El puerto tiene configurado el estado "disabled"; consulte "System > Ports >
Configuration".
– Link down
El puerto tiene configurado el estado "enabled" pero no hay ninguna conexión; consulte
"System > Ports > Configuration".
– Power down
El puerto tiene configurado el estado "Link down"; consulte "Sistema > Puertos >
Configuración".

Modificación de la configuración de puertos
Haga clic en el campo correspondiente para modificar la configuración.
Nota
Los puertos ópticos trabajan siempre con el método de transmisión dúplex completo y con la
velocidad de transmisión máxima. Por esta razón no puede efectuar los siguientes ajustes en
el caso de puertos ópticos:
● Configuración automática
● Velocidad de transmisión
● Procedimiento de transmisión
Nota
En caso de sobrecarga de un puerto, el equipo impide o reduce a través de ciertos mecanismos
automáticos la retroacción sobre otros puertos y otras clases de prioridad (Class of Service).
Estando activado el control de flujo, esto puede hacer que se rechacen telegramas.
Se producen sobrecargas de puertos cuando el dispositivo recibe más telegramas de los que
puede enviar, p. ej. debido a velocidades de transmisión diferentes.

Control de errores
Alimentación de tensión
Ajustes para la vigilancia de la alimentación
Configure si el sistema de señalización debe vigilar la alimentación. Con alimentación
redundante, configure la vigilancia para cada uno de los cables de alimentación.

654

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
El sistema de señalización indica un error si en una conexión vigilada (alimentación 1 o
alimentación 2) falta la tensión o es insuficiente.
Nota
Encontrará los límites de tensión de servicio admisibles en las instrucciones de servicio
resumidas del dispositivo.
Un error hace que reaccione el contacto de señalización y que se encienda el LED señalizador
de error en el dispositivo y, dependiendo de la configuración, puede generar un trap o una
entrada en la tabla de registro de eventos.
Para activar o desactivar la función de vigilancia, active la casilla de verificación situada
delante del nombre de la conexión correspondiente que desea vigilar.

Link Change
Configuración de la vigilancia de errores en modificaciones de estado de conexiones
En esta página se configura si debe emitirse un aviso de error al producirse una modificación
del estado de una conexión de red.
Con la vigilancia de la conexión activada, se señaliza un error
● si en un puerto debe estar disponible un link y este falta.
● o si en un puerto no debe estar disponible ningún link y se detecta uno.
Un error hace que se dispare el contacto de señalización y se encienda el LED de error en el
dispositivo. Dependiendo de la configuración, el error puede generar un trap, un e-mail o una
entrada en la tabla de registro de eventos.

Descripción de los campos mostrados
La tabla 1 se divide en las siguientes columnas:
● 1.ª columna
Indica que los ajustes son válidos para todos los puertos.
● Ajuste
Elija el ajuste deseado. Existen las siguientes posibilidades:
– "-" (desactivado)
– Up
– Down
– No hay modificaciones: El ajuste de la tabla 2 no cambia.
● Aplicar a tabla
Al hacer clic en este botón se aplica el ajuste a todos los puertos de la tabla 2.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

655

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla 2 se divide en las siguientes columnas:
● Puerto
Muestra los puertos disponibles. El puerto se compone del número de módulo y del número
de puerto, p. ej. el puerto 0.1 es el módulo 0, puerto 1.
● Ajuste
Seleccione el ajuste. Existen las siguientes posibilidades:
– Up
El tratamiento de errores se inicia al pasarse al estado activo del puerto.
(De "Link down" a "Link up")
– Down
El tratamiento de errores se inicia al pasarse al estado pasivo del puerto.
(De "Link up" a "Link down")
– "-" (desactivado)
El tratamiento de errores no se inicia.

PLUG
Configuración
Nota
Si no existe ninguna conexión online con el dispositivo, solo estará disponible la casilla de
verificación "Firmware en PLUG" (vea abajo).
ATENCIÓN
No extraer ni insertar el C-PLUG / KEY-PLUG durante el funcionamiento
Un PLUG solo se debe extraer o insertar con el dispositivo apagado.
.
Cada segundo, el dispositivo comprueba si hay un PLUG insertado. Si detecta que se ha
retirado el PLUG, se produce un rearranque completo del sistema. Si había un PLUG válido
insertado en el dispositivo, este pasa a un estado de error definido después del rearranque.
Si un dispositivo se ha configurado una vez con un PLUG, ya no podrá utilizarse sin él. Para
poder volver a utilizar el dispositivo, restaure la configuración de fábrica.

656

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Información sobre la configuración del C-PLUG
Esta página proporciona información detallada sobre la configuración que está depositada en
el C-PLUG. Además existe la posibilidad de restablecer la configuración de fábrica del PLUG
o de dotarlo de un nuevo contenido.
Nota
Incompatibilidad con versiones anteriores con el PLUG insertado
Si se instala una versión anterior es posible que se pierdan los datos de configuración. En ese
caso, tras la instalación del firmware el dispositivo se enciende con los ajustes de fábrica. Si,
además, hay un PLUG insertado en el dispositivo, después del rearranque tendrá el estado
"NOT ACCEPTED", puesto que en el PLUG siguen estando los datos de configuración del
firmware anterior, más actual. Esto permite regresar al firmware más actual que estaba
instalado anteriormente sin perder datos de configuración.
Si la configuración original del PLUG ya no se necesita, puede borrarse o sobrescribirse
manualmente mediante "System > PLUG".

Descripción
La tabla se divide en las siguientes filas:
● Estado
Muestra el estado del PLUG. Existen las siguientes posibilidades:
– ACCEPTED
Existe un PLUG con una configuración válida y apropiada en el dispositivo.
– NOT ACCEPTED
La configuración del PLUG enchufado no es válida o es incompatible.
– NOT PRESENT
No hay ningún C-PLUG o KEY-PLUG enchufado en el dispositivo.
– FACTORY
El PLUG está enchufado y no contiene ninguna configuración. Este estado también se
indica cuando se ha formateado el PLUG durante el funcionamiento.
– MISSING
No hay ningún PLUG insertado. En el dispositivo se han configurado funciones que
requieren una licencia.
● Grupo de dispositivos
Indica qué línea de productos SIMATIC NET ha utilizado el C-PLUG o KEY-PLUG
anteriormente.
● Tipo de dispositivo
Dentro de de la línea de productos, indica el tipo de dispositivo que ha utilizado el C-PLUG
o KEY-PLUG anteriormente.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

657

Configuración de dispositivos y redes
1.3 Configurar redes
● Versión de la configuración
La versión de la estructura de configuración. Esta información se refiere a las posibilidades
de configuración a que da soporte el dispositivo y no tiene nada que ver con la configuración
de hardware concreta. Por lo tanto, el dato de la revisión no cambia si se agregan o se
quitan componentes adicionales (p. ej. módulos o Extender), pero puede cambiar si se
realiza una actualización del firmware.
● Sistema de archivos
Indica el tipo del sistema de archivos existente en el PLUG.
● Memoria disponible [bytes]
Indica la capacidad de memoria máxima del sistema de archivos existente en el PLUG.
● Memoria ocupada [bytes]
Indica la capacidad de memoria ocupada en el sistema de archivos del PLUG.
● Firmware en PLUG
Si está activado, el firmware se guarda en el PLUG. Esto permite realizar automáticamente
con el PLUG actualizaciones de firmware a versiones anteriores o posteriores.
● Información
Muestra información adicional sobre el dispositivo que había utilizado el PLUG
anteriormente, por ejemplo la referencia, la denominación de tipo y las versiones de
hardware y software. La versión de software mostrada equivale a la versión en la que fue
modificada la configuración por última vez. Con el estado "NOT ACCEPTED" se muestra
información adicional sobre la causa del problema.
Si se ha configurado un PLUG como PRESET-PLUG, se indicará como información
adicional en la primera fila
● Modificar PLUG
Elija el ajuste deseado. Existen las posibilidades siguientes para modificar la configuración
en el C-PLUG o KEY-PLUG:
– Escribir la configuración actual en el PLUG
Esta opción solo está disponible si el estado del PLUG es "NOT ACCEPTED" o
"FACTORY".
La configuración disponible en la memoria flash interna del dispositivo se copia en el
PLUG.
– Restablecer la configuración de fábrica del PLUG
Borra todos los datos del PLUG y realiza un formateo Low Level.

Licencia
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

658

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
ATENCIÓN
No extraer ni insertar el C-PLUG / KEY-PLUG durante el funcionamiento
Un PLUG solo se puede extraer o insertar con el dispositivo desconectado.
El dispositivo comprueba cada varios segundos si hay un PLUG insertado. Si detecta que se
ha retirado el PLUG, se produce un rearranque completo del sistema. Si había un PLUG
válido insertado en el dispositivo, este pasa a un estado de error definido después del
rearranque.
Si un dispositivo se ha configurado una vez con un PLUG, ya no podrá utilizarse sin él. Para
poder volver a utilizar el dispositivo, restaure la configuración de fábrica.
Nota
Incompatibilidad con versiones anteriores con el PLUG insertado
Si se instala una versión anterior, pueden perderse los datos de configuración. En ese caso,
tras la instalación del firmware el dispositivo se enciende con los ajustes de fábrica. Si,
además, hay un PLUG insertado en el dispositivo, después del rearranque tendrá el estado
"NOT ACCEPTED", puesto que en el PLUG siguen estando los datos de configuración de la
versión más actual que estaba instalada antes. Esto permite regresar al firmware más actual
que estaba instalado anteriormente sin perder datos de configuración.
Si la configuración original del PLUG ya no se necesita, puede borrarse o sobrescribirse
manualmente mediante "Sistema > PLUG".

Información sobre la licencia del KEY-PLUG
Un C-PLUG solo puede guardar la configuración de un dispositivo. Un KEY-PLUG contiene,
además de la configuración, una licencia que habilita determinadas funciones del dispositivo
SIMATIC NET.
Esta página proporciona información detallada acerca de la licencia del KEY-PLUG.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

659

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● Estado
Muestra el estado del KEY-PLUG. Existen las siguientes posibilidades:
– ACCEPTED
El KEY-PLUG que hay en el dispositivo contiene una licencia adecuada y válida.
– NOT ACCEPTED
La licencia del KEY-PLUG insertado no es válida.
– NOT PRESENT
No hay ningún KEY-PLUG insertado en el dispositivo.
– MISSING
No hay ningún KEY-PLUG insertado o bien hay un C-PLUG insertado con el estado
"FACTORY". En el dispositivo se han configurado funciones que requieren una licencia.
– WRONG
El KEY-PLUG insertado no concuerda con el dispositivo.
– UNKNOWN
Contenido desconocido del KEY-PLUG.
– DEFECTIVE
Contenido erróneo del KEY-PLUG.
● Referencia
Muestra la referencia del KEY-PLUG. El KEY-PLUG está disponible para diferentes
ampliaciones de función y sistemas de destino.
● Número de serie
Muestra el número de serie del KEY-PLUG.
● Información
Muestra información adicional sobre el dispositivo que había utilizado el KEY-PLUG
anteriormente, por ejemplo la referencia, la denominación de tipo y las versiones de
hardware y software. La versión de software mostrada equivale a la versión en la que fue
modificada la configuración por última vez. Con el estado "NOT ACCEPTED" se muestra
información adicional sobre la causa del problema.
Nota
Al guardar la configuración, se guarda también la información de si en ese momento hay un
KEY-PLUG insertado en el dispositivo. Solo es posible ejecutar esta configuración si hay
insertado un KEY-PLUG con la misma referencia o la misma licencia.

660

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Diagnóstico del puerto
Diagnóstico SFP
En esta página puede ejecutar un diagnóstico de errores independiente para cada puerto SFP.
Esta prueba se realiza sin necesidad de desenchufar ningún cable, conectar un comprobador
de cables o instalar un módulo Loopback en el otro extremo.
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Descripción
La página contiene los siguientes campos:
● Port
Seleccione el puerto deseado en la lista desplegable.
Los valores se muestran en los siguientes campos:
● Name
Muestra el nombre de la interfaz.
● Model
Muestra el tipo de interfaz.
● Revision
Indica la versión de hardware de SFP.
● Serial
Muestra el número de serie del SFP.
● Nominal Bit Rate [MBit/s]
Muestra la tasa de transferencia nominal de la interfaz.
● Max. Link (50.0/125um) [m]
Muestra la distancia máxima en metros, posible con este medio.
● Max. Link (62.5/125um) [m]
Muestra la distancia máxima en metros, posible con este medio.
En los campos siguientes se muestran los valores del transceptor enchufable SFP utilizado en
este puerto:
● Temperature [°C]
Muestra la temperatura de la interfaz.
● Voltage [V]
Muestra la tensión [V] aplicada a la interfaz.
● Current [mA]
Muestra el consumo de corriente [mA] de la interfaz.
● Rx Power [μW]/Rx Power [dBm]
Muestra la potencia de recepción de la interfaz [μW]/[dBm].

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

661

Configuración de dispositivos y redes
1.3 Configurar redes
● Tx Power [μW]/Tx Power [dBm]
Muestra la potencia de transmisión de la interfaz [μW]/[dBm].
● Área Actual
Muestra el valor actual.
● Área Baja
Muestra el valor más bajo.
● Área Alta
Muestra el valor más alto.

DNS
Cliente DNS
El servidor DNS (Domain Name System) asigna un nombre de dominio a una dirección IP de
modo que sea posible identificar unívocamente a un dispositivo.
Cuando este ajuste está activado, el dispositivo puede comunicarse con un servidor DNS
como cliente DNS.

Descripción
● Cliente DNS
Active o desactive la función de cliente DNS del dispositivo.
● Servidor DNS utilizado
– learned only
El dispositivo utiliza únicamente los servidores DNS asignados mediante DHCP.
– manual only
El dispositivo utiliza únicamente los servidores DNS configurados manualmente. Los
servidores DNS deben estar conectados a Internet.
– all
El dispositivo utiliza todos los servidores DNS disponibles.
● Dirección del servidor DNS
Introduzca la dirección IP del servidor DNS.
La tabla se divide en las siguientes columnas:
● Dirección del servidor DNS
Muestra la dirección IP del servidor DNS.
● Creación
Aquí se indica si el servidor DNS se ha configurado manualmente o ha sido asignado
mediante DHCP.

Proxy DNS
El dispositivo pone un servidor DNS a disposición de la red local. Si se introduce la dirección
IP del dispositivo como servidor DNS en la aplicación local, el dispositivo responde a consultas
DNS de su caché.

662

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
En caso de que el dispositivo no conozca la dirección IP de una dirección de dominio, reenvía
la consulta a un servidor DNS externo. El tiempo que el dispositivo conserva una dirección de
dominio en el caché depende del host direccionado. La consulta DNS a un servidor DNS
externo proporciona, además de la dirección IP, la vigencia de dicha información.

Descripción
La página contiene los siguientes campos:
● Activar proxy DNS
Active o desactive el proxy del servidor DNS.
● Cache Name Errors (NXDOMAIN)
Active o desactive el almacenamiento provisional de respuestas NXDOMAIN. Si se activa
esta opción, permanecen también en el caché los nombres de dominio que el servidor DNS
no conocía.

Cliente DDNS
El DDNS (Dynamic Domain Name System) es un servicio de Internet que permite crear un
nombre de host fijo como pseudónimo de una dirección IP que cambia dinámicamente.
El cliente DDNS sincroniza la dirección IP asignada con el nombre de host registrado en el
proveedor DDNS. De este modo, el dispositivo siempre será accesible por el mismo nombre
de host.
Requisitos:
● Nombre de usuario y contraseña que le autoricen a utilizar el servicio DDNS.
● Nombre de host registrado, p. ej. example.no-ip.com.
● El puerto UDP 53 para DNS está habilitado y no se utiliza en NAT.

Descripción
La tabla se divide en las siguientes columnas:
● Servicio
Indica qué proveedores se soportan.
● Activado
Si está activado, el dispositivo inicia sesión en el servidor DDNS.
● Host
Introduzca el nombre de host que se ha acordado para el dispositivo con el proveedor de
DDNS, p. ej., example.no-ip-com.
● Nombre de usuario
Introduzca el nombre de usuario con el que el dispositivo iniciará sesión en el servidor
DDNS.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

663

Configuración de dispositivos y redes
1.3 Configurar redes
● Contraseña
Introduzca la contraseña correspondiente al usuario.
● Confirmar contraseña
Confirme la contraseña.

DHCP
Cliente DHCP
Si el dispositivo está configurado como cliente DHCP, inicia una petición DHCP. Como
respuesta, el dispositivo recibe del servidor DHCP la asignación de una dirección IPv4. El
servidor administra un rango de direcciones desde el cual asigna direcciones IPv4. También
es posible configurar el servidor de modo que, cuando el cliente solicite una dirección IPv4,
siempre se le asigne la misma.

664

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Keep Alive
Si está activado, la dirección IP se conserva en caso de interrupción de la conexión y no se
pone a 0.0.0.0. Keep Alive está activado en el ajuste predeterminado. Si Keep Alive está
desactivado, la dirección IP se pone a 0.0.0.0 en caso de interrupción de la conexión.
● Solicitud de configuración de cliente DHCP (Opc. 66, 67)
Si está activado, el cliente DHCP utiliza las opciones para descargar el archivo de
configuración (opción 67) del servidor TFTP (opción 66). Tras el rearranque completo el
dispositivo utiliza los datos del archivo de configuración.
Nota
Archivo de configuración y versión del firmware
El archivo de configuración sirve para guardar y leer datos de configuración dentro de una
versión de firmware, p. ej., 4.3. Los datos de configuración creados con una versión del
firmware <4.2 no pueden leerse en un dispositivo con versión del firmware 4.3.
Nota
Si se descarga un archivo de configuración, puede dispararse un rearranque completo del
sistema. Si la configuración actual en curso y la configuración del archivo de configuración
que se descarga son distintas, el sistema realiza un rearranque completo.
Compruebe que en este archivo de configuración ya no esté activada la opción "Solicitud
de configuración de cliente DHCP (Opc. 66, 67)".
● Modo DHCP
Determine el tipo de identificación con el que el cliente DHCP iniciará sesión en el servidor
DHCP:
– via dirección MAC
La identificación se realiza utilizando la dirección MAC.
– via ID de cliente DHCP
La identificación se realiza utilizando un ID de cliente DHCP definido libremente.
– Vía nombre del sistema
La identificación se realiza utilizando el nombre del sistema. Si el nombre del sistema
tiene una longitud de 255 caracteres, el último no se utiliza para la identificación.
– vía IAID y DUID
De este modo el cliente DHCP puede iniciar sesión en los servidores DHCP que
soportan el funcionamiento paralelo de IPv4-y IPv6.
La identificación se realiza mediante IAID y DUID, y designa exactamente una interfaz
IP del dispositivo.
IAID (Interface Association Identifier): se genera al menos un IAID para cada interfaz IP.
El IAID no cambia al efectuar un rearranque completo del cliente DHCP.
DUID (DHCP Unique Identifier): identifica unívocamente servidores y clientes y es válido
para todas las interfaces IP del dispositivo. El DUID no cambia al efectuar un rearranque
completo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

665

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla se divide en las siguientes columnas:
● Interfaz
Interfaz a la que se refiere el ajuste.
● DHCP
Active o desactive el cliente DHCP para la interfaz correspondiente.
● Valor IAID
Valor con el que se identifica la interfaz (cliente DHCP) en el servidor DHCP.

Servidor DHCP
Existe la posibilidad de utilizar el dispositivo como servidor DHCP. Esto permite asignar
automáticamente direcciones IP a los dispositivos conectados. Las direcciones IP se asignan
dinámicamente a partir de una banda de direcciones definida por el usuario (Pool), o bien se
asigna una dirección IP determinada a un dispositivo concreto.
En esta página se define la banda de direcciones a partir de la cual el dispositivo obtiene una
dirección IP cualquiera. La asignación estática de las direcciones IP se configura en
"Asignaciones estáticas".
Nota
Borrar asignaciones de servidor DHCP
Si desactiva o borra una banda de direcciones IPv4 o bien desconecta y vuelve a conectar el
servidor DHCP, se borrarán las asignaciones de servidor DHCP, consulte "Información >
Servidor DHCP".
La estructura de esta página varía en función del número de interfaces IP VLAN de las que
disponga el dispositivo.

Requisitos
Los dispositivos conectados están configurados de forma que obtengan la dirección IP de un
servidor DHCP.

Dispositivos con una interfaz IP VLAN
En esta página se especifican las direcciones IPv4 asignadas a través de determinados
puertos.

666

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● DHCP Server
Active o desactive el servidor DHCP en el dispositivo.
Nota
Para que no se produzcan conflictos con direcciones IPv4, en la red solo puede estar
configurado un dispositivo como servidor DHCP.
● Probe address with ICMP Echo before offer
Cuando está activado, el servidor DHCP comprueba si la dirección IP ya está asignada.
Para ello, el servidor DHCP envía avisos de eco ICMP (Ping) a la dirección IPv4. Si no
recibe respuesta alguna, se asigna esa dirección IPv4.
Nota
Esta comprobación no se lleva a cabo con asignaciones estáticas.
Nota
Si en la red hay dispositivos que tienen desactivado por defecto el servicio de eco, es
posible que se produzcan conflictos con las direcciones IPv4. Para que esto no suceda,
asigne a dichos dispositivos una dirección IPv4 que esté fuera de la banda de direcciones
IPv4.
La tabla se divide en las siguientes columnas:
● Pool ID
Muestra el número de la banda de direcciones IPv4. Al hacer clic en el botón "Create" se
crea una nueva fila con un número unívoco (Pool ID).
● Interface
Seleccione una interfaz IP VLAN. A través de esta interfaz se asignan dinámicamente las
direcciones IPv4. El requisito para la asignación es que la dirección IPv4 de la interfaz esté
en la subred de la banda de direcciones IPv4. Si esto no fuera así, la interfaz no asignará
direcciones IPv4.
● Enable
Especifique si debe utilizarse esta banda de direcciones IPv4.
Nota
Si se activa la banda de direcciones IPv4, sus ajustes en esta y las otras fichas DHCP
quedarán atenuadas y ya no podrán editarse.
● Subnet
Introduzca el rango de direcciones de red que se asignará a los dispositivos. Utilice la
notación CIDR.
● Lower IP Address
Introduzca la dirección IPv4 que define el principio de la banda de direcciones IPv4
dinámicas. La dirección IPv4 debe estar dentro del rango de direcciones de red configurado
en "Subnet".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

667

Configuración de dispositivos y redes
1.3 Configurar redes
● Upper IP Address
Introduzca la dirección IPv4 que define el final de la banda de direcciones IPv4 dinámicas.
La dirección IPv4 debe estar dentro del rango de direcciones de red configurado en
"Subnet".
● Lease Time [sec]
Especifique en segundos la vigencia de la dirección IPv4 asignada. Cuando se ha
sobrepasado la mitad de la vigencia, el cliente DHCP puede prorrogar la dirección IPv4
asignada. Una vez ha finalizado toda la vigencia, el cliente DHCP debe solicitar una
dirección IPv4 nueva.

Dispositivos con varias interfaces IP VLAN
En esta página se define la banda de direcciones a partir de la cual el dispositivo conectado
obtiene una dirección IP cualquiera. La asignación estática de las direcciones IP se configura
en "Asignación estática".

Opciones DHCP
En esta página se definen las opciones DHCP que soporta el servidor DHCP. Las diferentes
opciones DHCP están definidas en el RFC 2132.

Descripción
La página contiene los siguientes campos:
● Pool ID
Seleccione la banda de direcciones deseada.
● Valor de la opción
Introduzca el número de la opción DHCP deseada.
Nota
Opciones DHCP soportadas
SCALANCE S615: 1, 2, 3. 4. 5, 6, 42, 66, 67
SCALANCE SC-600: 1, 3, 6, 12, 66, 67
Las opciones DHCP 1, 3, 6, 66 y 67 se generan automáticamente al crear la banda de
direcciones IPv4. Excepto la opción 1, todas las demás pueden borrarse.
La tabla se divide en las siguientes columnas:
● Seleccionar
Active la casilla de verificación correspondiente a la fila que desea borrar.
● Pool ID
Muestra el número de la banda de direcciones.
● Valor de la opción
Muestra el número de la opción DHCP.
● Descripción
Texto descriptivo del valor opcional.

668

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Utilizar IP de interfaz
Especifique si se utilizará o no la dirección IP interna del dispositivo.
● Valor
Introduzca el parámetro DHCP que se transferirá al cliente DHCP. El contenido depende de
la opción DHCP.
Valor

Nombre de la
opción

1

Máscara de
subred

La máscara de subred se regis‐
tra automáticamente.

Opción no borrable.

2

Tiempo de
decalaje

Tiempo de decalaje respecto a la
hora mundial coordinada UTC

Introduzca el tiempo de decalaje en
segundos en formato hexadecimal.

3

Router

La dirección IPv4 para el router
en la subred del cliente DHCP. Si
el propio dispositivo es el router,
se utiliza la dirección IPv4 de la
interfaz.

Es posible indicar varias direcciones
IPv4 separadas por comas.

4

Servidor ho‐
rario

La dirección IPv4 del servidor ho‐
rario que está a disposición del
cliente DHCP.

5

Servidor de
nombres

La dirección IPv4 del servidor de
nombres que está a disposición
del cliente DHCP.

6

Servidor DNS La dirección IPv4 del servidor
DNS que está a disposición del
cliente DHCP.
Si el propio dispositivo es el ser‐
vidor DNS, se utiliza la dirección
IPv4 de la interfaz.

12

Nombre de
host

Indique el nombre del host en for‐
mato String.

42

Servidor NTP

La dirección IPv4 del servidor
NTP que está a disposición del
cliente DHCP.

66

Servidor
TFTP

La dirección IPv4 o el nombre de
host del servidor NTP que está a
disposición del cliente DHCP.

Introduzca la dirección del servidor
TFTP.

67

Nombre del
archivo de
arranque

El nombre del archivo de arran‐
que que el cliente se descarga
del servidor TFTP.

Indique el nombre del archivo de arran‐
que en formato String.

Asignación estática
En esta página se establece que a determinados dispositivos se les asigne una dirección IP
determinada. La asignación de direcciones se realiza mediante la dirección MAC, el ID de
cliente o el DUID.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

669

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Pool ID
Seleccione la banda de direcciones deseada.
● Método de identificación del cliente
Seleccione el método por el que se identificará a un cliente.
– Ethernet MAC
La identificación se realiza a través de la dirección MAC. Introduzca la dirección MAC en
"Valor". La dirección MAC consta de seis bytes que se representan de forma
hexadecimal y separados por guiones, p. ej. 00-ab-1d-df-b4-1d.
– ID de cliente
La identificación se realiza utilizando un ID de cliente DHCP definido libremente.
Introduzca la denominación deseada en "Valor".
– DUID
La identificación se realiza utilizando el DUID o el IAID. Introduzca en "Valor" la
denominación deseada, p. ej., 00-00-01-C2-00-01-00-01-00-00-00-72-00-1B-1BB6-32-9D.
● Valor
Introduzca el valor deseado. La entrada depende del método de identificación del cliente
que se haya seleccionado.
La tabla se divide en las siguientes columnas:
● Seleccionar
Active la casilla de verificación correspondiente a la fila que desea borrar.
● Pool ID
Muestra el número de la banda de direcciones.
● Método de identificación
Indica con qué método se identifica el cliente en el servidor DHCP.
● Valor
Muestra la dirección MAC, el ID de cliente o el DUID del cliente.
● Dirección IP
Defina la dirección IPv4 que se asignará al cliente. La dirección IPv4 debe estar dentro de
la banda de direcciones.
● Comentario
Introduzca una descripción para la asignación de dirección.

670

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

cRSP/SRS
Nota
Common Remote Service Platform (cRSP) / Siemens Remote Service (SRS) es una
plataforma de mantenimiento remoto a través de la que se accede al mantenimiento remoto.
Para utilizar la plataforma se requieren contratos de servicio adicionales y deben observarse
las condiciones marco. Si está interesado en cRSP / SRS diríjase a su interlocutor local de
Siemens y visite la siguiente Página web (http://www.industry.siemens.com/topics/global/es/
service/remote-service/seiten/home.aspx).
En esta página se configuran los datos de acceso para SRS / cRSP de acuerdo con la sintaxis
del URI. El Uniform Resource Identifier (URI) está definido en RFC 3986.

Descripción
La página contiene los siguientes campos:
● Activar DDNS para cRSP / SRS
Active o desactive el uso de cRSP / SRS.
● Intervalo de actualización
Introduzca el intervalo de tiempo.
● Comprobar certificado de servidor
Si está activado, el dispositivo comprueba la validez del certificado de servidor que ha
recibido.
La tabla se divide en las siguientes columnas:
● Índice
El número de la entrada.
● Esquema
Identifica el método de acceso y el tipo de recurso.
https: acceso seguro a una página web.
● Authority
Contiene la dirección del servidor de destino.
● Ruta
Contiene la ruta de destino al recurso. La ruta de destino puede ser un nombre de directorio
o un nombre de archivo.
● Consulta
Una consulta puede incluir valores de parámetros para una aplicación.
● Frag.
Direcciona partes locales del recurso, p. ej., el atributo de anclaje de una página web.
● Estado (solo disponible online)
Muestra el estado del último acceso cRSP / SRS de la entrada.
● Activado
Si está activado se utilizará esta entrada.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

671

Configuración de dispositivos y redes
1.3 Configurar redes

Servidor proxy
En esta página se configura el servidor proxy que será utilizado por diversos componentes,
p. ej., SINEMA RC.

Descripción
● Nombre del proxy
Introduzca un nombre para el servidor proxy.
La tabla se divide en las siguientes columnas:
● Nombre
Indica el nombre del servidor proxy.
● Dirección
Introduzca la dirección IPv4 del servidor proxy.
● Tipo
Defina el tipo de servidor proxy.
– HTTP: servidor proxy solo para accesos vía HTTP
– SOCKS: servidor proxy universal
● Puerto
Introduzca el puerto en el que se realizará el servicio proxy.
● Método de autenticación
Especifique el método de autenticación.
– None
Sin autenticación
– Basic
Autenticación estándar. El nombre de usuario y la contraseña se envían sin codificar.
– NTML (NT LAN Manager)
Autenticación según NTML Standard (inicio de sesión de usuario en Windows)
● Nombre de usuario
Introduzca el nombre de usuario para el acceso al servidor proxy.
● Contraseña
Introduzca la contraseña para el acceso al servidor proxy.
● Confirmar contraseña
Vuelva a introducir la contraseña para confirmarla.

SINEMA RC
En esta página se configura el acceso al servidor SINEMA RC.
Nota
Para SCALANCE S615 está función solo puede utilizare con KEY PLUG.

672

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene lo siguiente:
● Activar SINEMA RC
– Activado:
Se establece una conexión con el servidor SINEMA RC configurado. Los campos no se
pueden editar.
– Desactivado:
Los campos se pueden editar. Se deshará cualquier conexión que pudiera existir.
Área "Configuración de servidor"
● Dirección SINEMA RC
Introduzca aquí la dirección IPv4 o el FQDN (Fully Qualified Domain Name) del servidor
SINEMA RC.
● Puerto SINEMA RC
Introduzca el puerto a través del que se puede acceder al servidor SINEMA RC.
Área "Comprobación del servidor"
● Tipo de comprobación
– Huella dactilar: la identidad del servidor se verifica mediante la huella dactilar.
– Certificado CA: la identidad del servidor se verifica mediante el certificado CA.
● Huella dactilar
Solo es necesaria con el ajuste "Huella dactilar". Introduzca la huella dactilar del dispositivo.
La huella dactilar se asigna en la puesta en marcha del servidor SINEMA RC. Mediante la
huella dactilar el dispositivo comprueba si se trata del servidor SINEMA RC correcto.
Encontrará más información al respecto en las instrucciones de servicio del servidor
SINEMA RC.
● Certificado CA
Solo es necesario con el ajuste "Certificado CA". Seleccione el certificado CA del servidor
que se utilizará para firmar el certificado de servidor. Solo pueden seleccionarse los
certificados CA que estén cargados.
Área "Datos de inicio de sesión del dispositivo"
● ID de dispositivo
Introduzca el ID de dispositivo. El ID de dispositivo se asigna al configurar el dispositivo en
el servidor SINEMA RC. Encontrará más información al respecto en las instrucciones de
servicio del servidor SINEMA RC.
● Contraseña de dispositivo
Introduzca la contraseña con la que el dispositivo iniciará sesión en el servidor SINEMA RC.
La contraseña se asigna al configurar el dispositivo en el servidor SINEMA RC. Encontrará
más información al respecto en las instrucciones de servicio del servidor SINEMA RC.
● Confirmación de contraseña de dispositivo
Repita la contraseña para confirmarla.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

673

Configuración de dispositivos y redes
1.3 Configurar redes
Área "Ajustes opcionales"
● Reglas automáticas del cortafuegos/NAT
– Activada
Para la conexión VPN se crean automáticamente los cortafuegos y las reglas NAT. Se
permiten las conexiones entre las subredes exportadas configuradas y las subredes a
las que se puede acceder a través del servidor SINEMA RC. Los ajustes NAT se aplican
como se ha configurado en el servidor SINEMA RC.
– Desactivada
El usuario debe crear el cortafuegos y las reglas NAT.
● Tipo de conexión
Especifique el tipo de conexión VPN. Encontrará más información al respecto en el capítulo
"Establecimiento de la conexión VPN".
– Auto
El dispositivo aplica la configuración del servidor SINEMA RC. Los ajustes del servidor
SINEMA RC se configuran en "Conexiones remotas > Dispositivos". Encontrará más
información al respecto en las instrucciones de servicio "Servidor SINEMA RC".
– Permanente
Se ignoran los ajustes del servidor SINEMA RC. El dispositivo establece una conexión
VPN con el servidor SINEMA RC. El túnel VPN se mantiene permanentemente.
– Entrada digital
Se ignoran los ajustes del servidor SINEMA RC. Al producirse un evento "Entrada
digital", el dispositivo intenta establecer una conexión VPN con el servidor SINEMA RC.
Es imprescindible que el evento "Entrada digital" se haya reenviado a la conexión VPN.
Para ello, al producirse el evento "Entrada digital" active "Túnel VPN" en "Sistema >
Eventos > Configuración".
● Utilizar proxy
Especifique si la conexión con el servidor SINEMA RC definido se establecerá a través de
un servidor proxy. Solo es posible seleccionar los servidores proxy que se han configurado
en "Sistema > Servidor proxy".
● Intervalo de autoconfiguración [min]
Introduzca en minutos el intervalo de tiempo tras el que se enviarán las consultas al servidor
SINEMA RC. Con esta consulta el dispositivo comprueba si en el servidor SINEMA RC
existe un archivo de firmware nuevo o si los datos de configuración han cambiado.
Si se introduce el valor 0, esta función está desactivada.
● Timeout [min] (solo para S615)
Indique el intervalo de tiempo en minutos. Si no se intercambian datos, una vez transcurrido
este intervalo se deshará automáticamente el túnel VPN.

DCP Discovery (S615)
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

674

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Buscar dispositivos que sean accesibles a través de la interfaz seleccionada
En esta página existe la posibilidad de seleccionar una interfaz y buscar los dispositivos
accesibles a través de la interfaz. Los dispositivos accesibles se muestran en una tabla. En la
tabla es posible comprobar y adaptar los parámetros de red de los dispositivos. Para identificar
y configurar los dispositivos se utiliza el Discovery Configuration Protocol (DCP).
Nota
DCP Discovery
La función solo está disponible en la VLAN asociada a la interfaz TIA. La interfaz TIA se
configura en "Layer 3 > Subredes > Configuración".
Requisitos:
Para adaptar los parámetros de red, DCP requiere derechos de escritura en el dispositivo. Si
el acceso está protegido contra escritura no será posible configurar los parámetros de red.
En los dispositivos SCALANCE, el acceso se configura en "Sistema > Configuración".

Descripción de los valores mostrados
● Interfaz
Seleccione la interfaz deseada.
● Examinar
Inicia la búsqueda de dispositivos que sean accesibles a través de la interfaz seleccionada.
Una vez finalizada la búsqueda, los dispositivos accesibles se muestran en la tabla. La
tabla está limitada a 100 entradas.
La tabla se divide en las siguientes columnas:
● Puerto
Indica el puerto a través del cual se accede al dispositivo.
● Dirección MAC
Muestra la dirección MAC del dispositivo.
● Tipo de dispositivo
Indica la línea de productos o el grupo de productos al que pertenece el dispositivo.
● Nombre de dispositivo
Si el dispositivo soporta esta función es posible asignarle un nombre de dispositivo
PROFINET.
● Dirección IP
En caso necesario, adapte la dirección IPv4 del dispositivo.
La dirección IPv4 debería ser unívoca dentro de la red y concordar con la red. La dirección
IPv4 0.0.0.0 significa que todavía no se ha ajustado ninguna dirección IPv4.
● Máscara de subred
En caso necesario, adapte la máscara de subred del dispositivo.
● Dirección de gateway
En caso necesario, indique la dirección IPv4 de la pasarela.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

675

Configuración de dispositivos y redes
1.3 Configurar redes
● Estado nombre de dispositivo
– Discovered: se utiliza el nombre de dispositivo ajustado.
– Configured: se ha asignado un nombre de dispositivo nuevo al dispositivo.
● Estado dirección IP
– Discovered/IP: el dispositivo utiliza una dirección IPv4 estática.
– Discovered/DHCP: el dispositivo ha obtenido la dirección IPv4 de un servidor DHCP.
– Configured: se ha asignado al dispositivo una dirección IPv4 nueva.
● Timeout
Defina la duración del parpadeo. Una vez transcurrido el tiempo finalizará el parpadeo.
● Parpadeo
Hace parpadear los LED de puerto del dispositivo seleccionado.

Copia de seguridad de la configuración (S615)
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Backup
En esta página se pueden guardar copias de seguridad de la configuración.
Las copias de seguridad generadas se guardan en el tipo de archivo "ConfigPackBackup". En
la página "System > Load&Safe > HTTP/TFTP" se pueden copiar las copias de seguridad de
la configuración en el PC cliente o bien se pueden cargar desde él.

Descripción
Esta página contiene los siguientes campos:
● Name
Introduzca un nombre para la copia de seguridad.
La tabla contiene las siguientes columnas:
● Select
Seleccione la fila que desea borrar.
● Name
Muestra el nombre de la copia de seguridad.

676

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Tamaño [kbytes]
La primera fila "Available memory" indica cuánto espacio de memoria hay disponible en el
dispositivo para copias de seguridad. Cada vez que crea una copia de seguridad el espacio
disponible en la memoria se reduce en correspondencia. En cada una de las filas siguientes
se muestra el tamaño de la copia de seguridad.
● Restore
Haga clic en el botón "Restore" para volver a cargar en el dispositivo la copia de seguridad
en cuestión.

Cloud Connector (S615)
En esta página se configuran los parámetros para la comunicación con TIA Portal Cloud
Connector.
Nota
● Utilice el "TIA Portal Cloud Connector" integrado en el producto por medio de una solución
VPN (p. ej. SINEMA RC).
● Para impedir el acceso no autorizado de dispositivos de red a "TIA Portal Cloud Connector",
active la entrada "Cloud Connector" en "Seguridad > Cortafuegos > Reglas IPv4
predefinidas".

Requisitos
● Para que los paquetes entrantes se reenvíen al dispositivo debe activarse la regla IPv4
predefinida "Cloud Connector".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

677

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene lo siguiente:
● Operación
– Activado
Activa el TIA Portal Cloud Connector integrado.
– Desactivado
Desactiva el TIA Portal Cloud Connector integrado.
– Iniciar con DI
La activación se controla a través de de la entrada digital (DI). Para ello, es
imprescindible que en "Sistema > Eventos > Configuración" esté activado "Cloud
Connector" en el evento "Entrada digital". Si este ajuste no está activado, el evento no
se reenvía a TIA Portal Cloud Connector.
● Puerto
A través de este puerto se establece la comunicación con TIA Portal Cloud Connector.
● Protocolo
Mediante este protocolo se accede a la red de la planta.
– PROFINET vía VLAN
La interfaz VLAN se define en la tabla siguiente.
Solo con M804PB
– PROFIBUS vía MPI/DP
– PROFINET-PROFIBUS
La tabla siguiente solo es necesaria con PROFINET:
● Interfaz
Solo están disponibles VLAN con subred configurada.
● Activo
Cuando está activado se utiliza esta VLAN para PROFINET.
● Resetear parámetros (solo disponible online)
Restablece los valores predeterminados para las propiedades de la interfaz.

Vigilancia de la conexión (S615)
En esta página se activa una prueba de ping que vigila las conexiones. En la prueba de ping
el dispositivo envía en intervalos regulares (Intervalo) paquetes ICMP de solicitud (ICMP Echo
Request) (ping) a la dirección de destino configurada. Si la dirección de destino no responde,
el dispositivo intenta volver a acceder a ella. Si todos los intentos de ping (retries) fallan, se
considera que la prueba de ping ha fallado y que el grupo no es accesible. Si no es posible
acceder al grupo, el dispositivo ejecuta la acción configurada en la interfaz seleccionada. Una
vez que se han ejecutado las 5 acciones o después de un rearranque completo el dispositivo
comienza de nuevo con la primera acción.

Descripción
● Activar vigilancia de la conexión
Active o desactive la prueba de ping para la vigilancia de la conexión.

678

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla "Grupo" contiene las siguientes columnas:
● ID de grupo
Índice del grupo.
● Nombre
Introduzca un nombre para el grupo. La entrada se muestra como nombre de columna en
la tabla "Acción".
● Interfaz de origen
Defina con qué interfaz se vigila la accesibilidad de las direcciones de destino.
● Intervalo
Defina cada cuánto tiempo se producen las pruebas de ping.
● TTL (Time to live)
Introduzca el valor TTL.
● Repetición
Defina cuántas veces debe repetirse el intento de ping.
La tiempo transcurrido entre los intentos de ping es de 100 ms. Con un número elevado de
intentos de ping, eso puede provocar un retardo.
Si ninguna de las direcciones configuradas responde, la prueba ping se considera fallida
(error). En la tabla "Acción" se define si debe ejecutarse una acción concreta.
● Destino de ping x
La x sustituye a los números ordinales del 1 al 3.
Indique la dirección de destino utilizada como referencia para la accesibilidad.
La tabla "Grupo" contiene las siguientes columnas:
● Grupo 1 - 5
Si hay un nombre configurado, se utiliza como nombre de columna. Asigne los grupos a la
interfaz que desee. La interfaz se considera accesible si todos los grupos asignados son
accesibles. Si un solo grupo no es accesible, se ejecuta la acción configurada en la interfaz
seleccionada.
● Acción en
Indica la interfaz en la que se ejecuta la acción.
● Acción al error x
La x sustituye a los números ordinales del 1 al 5.
Son posibles las siguientes acciones:
– Ninguna (ajuste predeterminado)
– Rearranque completo del dispositivo
Rearranque completo del dispositivo Tras el rearranque completo, el dispositivo espera
10 minutos y después envía un ping a la primera dirección de destino.
– Soft-Reset (solo con M87x)
Rearranque del sistema de telefonía móvil a través del software.
– Hard-Reset (solo con M87x)
Rearranque del sistema de telefonía móvil.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

679

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración de interfaces
Ethernet
Sinopsis (S615)
La página muestra la configuración para la transferencia de datos para todos los puertos del
dispositivo.

Descripción
● Port
Muestra los puertos configurables.
● Nombre del puerto
Muestra el nombre del puerto.
● Tipo de puerto (solo con routing)
Muestra el tipo del puerto. Son posibles los siguientes tipos:
– Router-Port
– Puerto Switch VLAN Hybrid
– Puerto switch VLAN Trunk
● Estado
Indica si el puerto está activado o desactivado. El tráfico de datos solo es posible a través
de un puerto activado.
● Estado operativo (solo disponible online)
Indica el estado operativo actual. El estado operativo depende del "Estado" y del "Link"
configurados.
Existen las siguientes posibilidades:
– up
Se ha configurado el estado "enabled" para el puerto y el puerto tiene una conexión
válida con la red.
– down
Se ha configurado el estado "disabled" o "Link down" para el puerto o el puerto no tiene
conexión.
● Link (solo disponible online)
Indica el estado de conexión con la red. Para el estado de conexión existen las siguientes
posibilidades:
– up
El puerto tiene una conexión válida con la red; se recibe una señal de "Link Integrity".
– down
La conexión está interrumpida, por ejemplo por estar desactivado el dispositivo
conectado.
● Modo de transmisión act. (solo disponible online)
Muestra los parámetros de transferencia del puerto.

680

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Negotiation
Indica si la configuración automática está activada o desactivada.
● Dirección MAC (solo disponible online)
Muestra la dirección MAC del puerto.

Configuración (S615)
En esta página se configuran los puertos Ethernet del dispositivo.

Descripción
● Puerto
Seleccione los puertos que deben configurarse.
● Estado
Defina si el puerto está activado o desactivado.
– enabled
El puerto está activado. El tráfico de datos solo es posible a través de un puerto activado.
– disabled
El puerto está desactivado pero la conexión sigue activa.
– Link down
El puerto está desactivado y la conexión con el dispositivo interlocutor se ha cancelado.
● Nombre del puerto
Introduzca aquí un nombre para el puerto.
● Dirección MAC (solo disponible online)
Muestra la dirección MAC del puerto.
● Modo de transmisión
Indica la velocidad y el método de transferencia del puerto. Si se ajusta el modo de
operación "Autonegotiation", los parámetros se negociarán automáticamente con el
terminal o el componente de red conectados. Estos también deben estar en el modo de
operación "Autonegotiation".
Nota
Para que el puerto y el puerto interlocutor puedan comunicarse, es necesario que los
ajustes coincidan en ambas partes.
● Modo de transmisión act. (solo disponible online)
Indica la velocidad y el método de transferencia del puerto. La visualización depende del
"tipo de modo" ajustado.
● Negotiation
Indica si la configuración automática de la conexión con el puerto interlocutor está activada
o desactivada.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

681

Configuración de dispositivos y redes
1.3 Configurar redes
● Tipo de puerto (solo con routing)
Seleccione el tipo de puerto:
– Puerto del router
El puerto es una interfaz IP. No soporta funciones de Layer 2.
– Puerto switch VLAN Hybrid
El puerto envía telegramas con y sin identificador. No forma parte automáticamente de
una VLAN.
– Puerto switch VLAN Trunk
El puerto envía solo telegramas con tag y forma parte automáticamente de todas las
VLAN.
● Estado operativo (solo disponible online)
Indica el estado operativo actual. El estado operativo depende del "Estado" y del "Link"
configurados.
Existen las siguientes posibilidades:
– up
Se ha configurado el estado "enabled" para el puerto y el puerto tiene una conexión
válida con la red.
– down
Se ha configurado el estado "disabled" o "Link down" para el puerto o el puerto no tiene
conexión.
● Link (solo disponible online)
Indica el estado de conexión con la red. Para el estado de conexión existen las siguientes
posibilidades:
– Up
El puerto tiene una conexión válida con la red; se recibe una señal de "Link Integrity".
– Down
La conexión está interrumpida, por ejemplo por estar desactivado el dispositivo
conectado.

PPP
Sinopsis
La página muestra el estado actual de la conexión PPP.

Descripción
La tabla contiene las siguientes columnas:
● Interfaz
Muestra la interfaz PPP. La entrada es un enlace. Al hacer clic sobre el enlace, se abre la
página de configuración correspondiente.
● Nombre
Indica el nombre de la interfaz PPP.

682

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Tipo
Indica el protocolo de la conexión PPP.
● Modo de operación
Indica si la conexión PPP está activada o desactivada.
● Estado
Indica el estado de la conexión PPP.
– Preparada
La conexión PPP puede configurarse y activarse.
– Establece la conexión
La conexión PPP está configurada y activada y el establecimiento de la conexión está
en curso.
– Conectada
La conexión PPP está establecida.
– Error
Estado de error en el que es necesaria la intervención del usuario, p. ej., contraseña
errónea.
– Detenido
Mensaje de error del servidor, p. ej. datos erróneos de inicio de sesión. Se espera antes
de realizar un nuevo intento.

Configuración
En esta página se configura la conexión PPP. El protocolo punto a punto (PPP) permite
conectar un módem ADSL externo a una interfaz Ethernet, y a través de esta conectarlo a
Internet. La interfaz también se denomina interfaz PPP.
El dispositivo actúa de router e inicia sesión con nombre de usuario y contraseña. Todos los
dispositivos conectados pueden utilizar la conexión PPP.

Descripción
La página contiene lo siguiente:
● Interfaz
Seleccione la interfaz PPP que va a configurar.
● Nombre
Indica el nombre de la interfaz PPP. El nombre se cambia en "Layer 3 > Subnets".
● Tipo
Defina el protocolo para la conexión PPP.
– PPPoE (Point-to-Point over Ethernet)
Los datos PPP se encapsulan en un frame Ethernet.
● Modo de operación
Especifique si la conexión PPP está activada o desactivada.
● Interfaz L2
Defina la interfaz a través de la cual debe establecerse la conexión PPP. Solo es posible
seleccionar las VLAN que tengan subred configurada.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

683

Configuración de dispositivos y redes
1.3 Configurar redes
● Nombre de usuario
Introduzca el nombre de usuario. Obtendrá el nombre de usuario de su operador de DSL.
● Contraseña
Introduzca la contraseña. Obtendrá la contraseña de su operador de DSL.
● Confirmar contraseña
Repita la contraseña.
● Desconexión forzosa
El operador de DSL deshace la conexión tras un tiempo determinado. Active esta opción si
desea desplazar la desconexión forzosa por parte del operador a una hora concreta, p. ej.
por la noche, fuera del horario de oficina.
● Hora de la desconexión forzosa
Defina la hora a la que desea desplazar la desconexión forzosa del operador de DSL. Es
imprescindible que el dispositivo tenga ajustada la hora del sistema correcta.
Formato de entrada: HH:MM

Configurar funciones de Layer 2
Configuración
Configuración de Layer 2
En esta página se configura Passive Listening.

Descripción
● Passive Listening
Si está activado, la función garantiza que las BPDUs de la red RSTP se reenvíen y regresen
de forma transparente. Si no fuera así, se generaría un bucle en el punto de establecimiento
entre RSTP y Ring.

VLAN
General
En esta página se define si el dispositivo reenvía telegramas con identificadores VLAN de
forma transparente (modo IEEE 802.1D/VLAN-unaware) o si tiene en cuenta la información de
VLAN (modo IEEE 802.1Q/VLAN-aware). Si el dispositivo está en modo "802.1Q VLAN
Bridge", es posible definir VLAN y especificar el uso de los puertos.
Nota
Modificación de la ID de VLAN agente
Cuando el PC de configuración está conectado al dispositivo directamente a través de
Ethernet y se modifica la ID de VLAN agente, el dispositivo deja de estar accesible vía Ethernet
después de la modificación.

684

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Base Bridge-Modo
Seleccione el modo deseado. Son posibles los siguientes modos:
Nota
Cambiar el modo Base Bridge
Tenga en cuenta el apartado "Cambiar el modo Base Bridge". En él se describen los efectos
de un cambio en la configuración existente.
– 802.1 D Transparent Bridge
Ajusta el modo "VLAN-unaware" en el dispositivo. En este modo los identificadores
VLAN no se cambian, sino que se reenvían de forma transparente. La prioridad VLAN
se evalúa para CoS. En este modo no pueden crearse VLAN. Solo hay una VLAN de
administración disponible: VLAN 1.
– 802.1 Q VLAN Bridge
Ajusta el modo "VLAN-aware" en el dispositivo. En este modo se tiene en cuenta la
información VLAN.
● ID de VLAN
Introduzca la VLAN ID (un número entre 1 y 4094).
La tabla se divide en las siguientes columnas:
● ID de VLAN
Indica la ID de VLAN. La VLAN ID (un número entre 1 y 4094) solo puede asignarse una vez
al crear un nuevo juego de datos y no puede modificarse a posteriori. Para modificarla es
necesario borrar y volver a crear todo el registro.
● Nombre
Introduzca un nombre para la VLAN. El nombre solo tiene carácter informativo y no influye
en la configuración.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

685

Configuración de dispositivos y redes
1.3 Configurar redes
● Estado
Muestra el tipo de estado de la entrada en la tabla interna de filtros de puertos. Si aparece
"Static", significa que la VLAN ha sido introducida estáticamente por el usuario. La
indicación "GVRP" significa que la configuración se ha registrado a través de un telegrama
GVRP. Sin embargo, para ello es necesario haber activado GVRP para el dispositivo.
● Lista de puertos
Defina el uso del puerto. Existen las siguientes posibilidades:
– "-"
– El puerto no es miembro de la VLAN indicada.
En el momento de la nueva definición, todos los puertos están identificados con "‑".
– M
El puerto es miembro de la VLAN. Los telegramas enviados en esta VLAN llevan el
identificador (tag) de VLAN correspondiente.
– R
El puerto es miembro de la VLAN. El registro se produce mediante un telegrama GVRP.
– U (mayúscula)
El puerto es miembro sin identificador de la VLAN. Los telegramas enviados en esta
VLAN no llevan identificador (tag) de VLAN. Desde ese puerto se envían telegramas sin
identificador de VLAN.
– u (minúscula)
El puerto es miembro sin identificador de la VLAN, pero la VLAN no está configurada
como VLAN del puerto. Los telegramas enviados en esta VLAN no llevan identificador
(tag) de VLAN.
– F
El puerto no es miembro de la VLAN indicada y no es posible que la VLAN se registre
dinámicamente en ese puerto mediante GVRP. Se pueden configurar otros ajustes en
"Layer 2 > VLAN > VLAN basada en puerto".
– T
Esta opción solo se visualiza y no se puede seleccionar.
Este puerto es un puerto trunk y por eso es miembro de todas las VLAN.

Cambiar el modo Base Bridge
VLAN-unaware (802.1D Transparent Bridge) → VLAN-aware (802.1Q VLAN Bridge)
Si cambia el modo Base Bridge de VLAN-unaware a VLAN-aware, ocurrirá lo siguiente:
● Se borrarán todas las entradas Unicast estáticas y dinámicas.
VLAN-aware (802.1Q VLAN Bridge) → VLAN-unaware (802.1D Transparent Bridge)
Si cambia el modo Base Bridge de VLAN-aware a VLAN-unaware, ocurrirá lo siguiente:
● Se borrarán todas las configuraciones VLAN.
● Se creará una VLAN de administración: VLAN 1.
● Se borrarán todas las entradas Unicast estáticas y dinámicas.

686

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

802.1Q VLAN Bridge: reglas importantes para VLAN
Tenga en cuenta las siguientes reglas para la configuración y la operación de sus VLAN:
● Los telegramas con la ID de VLAN "0" se tratan como telegramas sin identificador, pero
conservan su valor de prioridad.
● Todos los puertos del dispositivo envían por defecto telegramas sin identificador (tag) de
VLAN, para asegurarse de que la estación terminal puede recibir dichos telegramas.
● En los dispositivos SCALANCE W, para todos los puertos está preconfigurada la ID de
VLAN "1".
● Si en un puerto hay integrado un terminal, los telegramas salientes se deben enviar sin
identificador (puerto de acceso estático). Si en ese puerto hay otro switch, el telegrama se
debe dotar de identificador (Trunk Port).

VLAN basada en puerto
Procesamiento de telegramas recibidos
En esta página se define la configuración de las propiedades de puerto para la recepción de
telegramas.

Descripción de los campos mostrados
La tabla 1 se divide en las siguientes columnas:
● Todos los puertos
Indica que los ajustes son válidos para todos los puertos de la tabla 2.
● Prioridad / VID de puerto / Tipos de telegrama aceptados / Filtrado Ingress
Seleccione en la lista desplegable el ajuste para todos los puertos. Si está seleccionado "No
hay modificaciones", las entradas de la correspondiente columna de la tabla 2 permanecen
inalteradas.
● Aplicar a tabla
Al hacer clic en este botón se aplica el ajuste a todos los puertos de la tabla 2.
La tabla 2 se divide en las siguientes columnas:
● Puerto
Muestra los puertos y Link Aggregations disponibles. El puerto se compone del número de
módulo y del número de puerto, p. ej. el puerto 0.1 es el módulo 0, puerto 1.
● Prioridad
Seleccione la prioridad que se da a telegramas sin identificador.
La prioridad CoS (Class of Service) utilizada en el tag de VLAN. Si se recibe un telegrama
sin tag, se le asigna esta prioridad. Esta prioridad define cómo se procesa este telegrama
en comparación con otros telegramas. Existen en total ocho prioridades con los valores 0
a 7, siendo 7 la prioridad más alta (IEEE 802.1p Port Priority).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

687

Configuración de dispositivos y redes
1.3 Configurar redes
● VID de puerto
Seleccione la ID de VLAN. Solo pueden seleccionarse las IDs de VLAN que se han definido
en la página "VLAN > General".
Si un telegrama recibido no tiene ningún identificador de VLAN, se complementa con un
identificador que lleva la ID de VLAN aquí indicada, y se envía a través del puerto según las
reglas correspondientes.
● Tipos de telegrama permitidos
Especifique los tipos de telegrama que se aceptan. Existen las siguientes alternativas:
– Solo frames con identificador
El dispositivo rechaza todos los telegramas sin identificador. Los telegramas que tienen
el identificador "0" se procesan como telegramas sin identificador. El dispositivo reenvía
todos los telegramas con identificador. De lo contrario rigen las reglas de envío según
la configuración.
– Todos
El dispositivo reenvía todos los telegramas.
● Ingress Filtering
Especifique si la VID de los telegramas recibidos se evalúa. Existen las siguientes
posibilidades:
– Activado
La VLAN ID de telegramas recibidos determina el reenvío: Para el envío de un
telegrama con tag de VLAN, el puerto receptor debe ser miembro de la misma VLAN. En
el puerto receptor se rechazan telegramas de VLAN desconocidas.
– Desactivado
Todos los telegramas se reenvían.

Dynamic MAC Aging
El dispositivo aprende automáticamente las direcciones de origen de los dispositivos
conectados.
Esta información se utiliza en el dispositivo para transmitir directamente telegramas de datos
a los dispositivos afectados. Se reduce la carga de red para los demás dispositivos.
Si, dentro un determinado período de tiempo, un dispositivo no recibe ningún telegrama cuya
dirección de origen coincida con una dirección aprendida, se borra la dirección en cuestión. A
este mecanismo se le da el nombre de "Aging". Mediante Aging se evita que se envíen
telegramas a direcciones incorrectas, si por ejemplo un terminal (p. ej. una programadora) se
conecta a otro puerto. Si la opción no está activada, el dispositivo no borra automáticamente
las direcciones aprendidas.

688

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● Dynamic MAC Aging
Active o desactive la función para el Aging automático de direcciones MAC aprendidas:
● Aging Time[s]
Introduzca el intervalo en segundos en incrementos de 15. Tras ese intervalo se borra una
dirección aprendida si el dispositivo no recibe más telegramas de esa dirección.
Nota
Redondeo de los valores, desviación respecto de la consigna
Al indicar el Aging Time, asegúrese de que el redondeo sea correcto. Si indica un valor no
divisible por 15, el valor se redondeará automáticamente.

Spanning Tree
General
Esta es la página principal de Spanning Tree. Como ajuste predeterminado está activado
Rapid Spanning Tree.

Descripción
La página contiene los siguientes campos:
● Spanning Tree
Active o desactive Spanning Tree.
● Compatibilidad de protocolo
Existen los siguientes ajustes:
– RSTP

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

689

Configuración de dispositivos y redes
1.3 Configurar redes

SR General
Descripción
La página contiene los siguientes campos:
● Prioridad Bridge / Prioridad Root (solo disponible online)
Mediante la prioridad Bridge se define qué dispositivo se convierte en Root Bridge. El
Bridge con la prioridad más alta (es decir, con el valor menor para este parámetro) se
convierte en el Root Bridge. Si en una red hay varios dispositivos con la misma prioridad,
pasa a ser Root Bridge el dispositivo cuya dirección MAC tenga el valor numérico más bajo.
Ambos parámetros, prioridad de Bridge y dirección MAC, forman juntos el identificador
Bridge. Dado que el Root Bridge administra todos los cambios de ruta, debería estar
dispuesto lo más central posible, debido al tiempo de ciclo de los telegramas. El valor para
la prioridad Bridge es un múltiplo entero de 4096 con un rango de valores de 0 a 32768
● Dirección Bridge (solo disponible online)/ Dirección Root (solo disponible online)
La dirección Bridge indica la dirección MAC del dispositivo, y la dirección Root indica la
dirección MAC del Root-Bridge.
● Puerto Root (solo disponible online)
Indica el puerto a través del que el switch comunica con el Root-Bridge.
● Costes Root (solo disponible online)
Los costes de encaminamiento desde este dispositivo hasta el Root-Bridge.
● Cambios de topología (solo disponible online) / Último cambio de topología (solo disponible
online)
El dato para el dispositivo indica el número de reconfiguraciones debidas al mecanismo
Spanning Tree desde el último arranque. Para el Root Bridge se indica el tiempo desde la
última reconfiguración del siguiente modo:
– Segundos: Se añade "s" tras la indicación numérica
– Minutos: Se añade "min" tras la indicación numérica
– Horas: Se añade "h" tras la indicación numérica
● Bridge Hello Time[s] / Root Hello Time[s] (solo disponible online)
Cada Bridge envía regularmente telegramas de configuración (BPDU). El tiempo
transcurrido entre dos telegramas de configuración es el Hello Time.
● Bridge Forward Delay[s] / Root Forward Delay[s] (solo disponible online)
Un Bridge no utiliza inmediatamente la información nueva de configuración, sino solo
después del tiempo determinado en el parámetro "Forward Delay". Así se garantiza que el
funcionamiento con la nueva topología no se inicie hasta que todos los Bridges tengan las
informaciones necesarias.
● Bridge Max Age[s] / Root Max Age[s] (solo disponible online)
Si el BPDU es anterior al "Max Age" indicado, se rechaza.
● Reiniciar contador (solo disponible online)
Haga clic en este botón si desea reiniciar el contador de esta página.

690

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Puerto ST
Al acceder a esta página, se muestra en la tabla el estado actual de la configuración de los
parámetros de puerto.
Para llevar a cabo la configuración, haga clic en los campos correspondientes de la tabla de
puertos.

Descripción
La tabla 1 se divide en las siguientes columnas:
● Todos los puertos
Indica que los ajustes son válidos para todos los puertos de la tabla 2.
● Estado de Spanning Tree
Seleccione en la lista desplegable el ajuste para todos los puertos. Si está seleccionado
"Sin cambios", las entradas de la correspondiente columna de la tabla 2 no cambian.
● Aplicar a tabla
Al hacer clic en este botón se aplica el ajuste a todos los puertos de la tabla 2.
La tabla 2 se divide en las siguientes columnas:
● Port
Muestra todos los puertos disponibles.
● Spanning Tree Status
Defina si el puerto está integrado en el Spanning Tree o no.
Nota
Si desactiva la opción "Spanning Tree Status" para un puerto, pueden formarse bucles.
Debe observarse la topología.
● Priority
Introduzca la prioridad del puerto. La prioridad solo se evalúa si los costes de
encaminamiento son iguales.
El valor debe ser divisible entre 16. Si el valor no es divisible entre 16, se adapta
automáticamente.
Rango de valores: 0 - 240.
El valor estándar es 128.
● Cost Calc.
Introduzca el cálculo de los costes de encaminamiento. Si introduce el valor "0", en el
campo "Path Cost" se muestra el valor determinado automáticamente.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

691

Configuración de dispositivos y redes
1.3 Configurar redes
● Costes de encaminamiento (solo disponible online)
Este parámetro sirve para calcular la ruta que elegir. Se selecciona como ruta el trayecto
con el valor más bajo. Si varios puertos de un dispositivo tienen el mismo valor con los
mismos costes de ruta, se selecciona el puerto con el número más bajo.
Si el valor indicado en el campo "Cost Calc." es el valor "0", se muestra el valor determinado
automáticamente. Si un valor es distinto de "0", se indica el valor del campo "Cost Calc.".
La determinación de los costes de encaminamiento se basa prioritariamente en la
velocidad de transmisión. Cuanto mayor es la velocidad de transmisión alcanzable, menor
es el valor de los costes de encaminamiento.
Valores típicos de costes de encaminamiento con Rapid Spanning Tree:
– 10.000 Mbits/s = 2.000
– 1000 Mbits/s = 20.000
– 100 Mbits/s = 200.000
– 10 Mbits/s = 2.000.000
Sin embargo, los valores también pueden parametrizarse individualmente.
● Estado (solo disponible online)
Indica el estado instantáneo en que sea encuentra el puerto. Los valores solo se indican y
no pueden parametrizarse. El parámetro "Status" depende del protocolo configurado. Son
posibles los siguientes valores:
– Disabled
El puerto solo recibe y no participa en STP, MSTP ni RSTP.
– Discarding
En el modo "Discarding" se reciben telegramas BPDU. Se rechazan otros telegramas
entrantes o salientes.
– Listening
En este estado se reciben y también se envían telegramas BPDU. El puerto está
integrado en el algoritmo de Spanning Tree.
– Learning
Etapa previa al estado "Forwarding"; el puerto aprende de forma activa la topología (es
decir, las direcciones de las estaciones).
– Forwarding
El puerto está activo en la red tras el tiempo de reconfiguración; recibe y envía
telegramas de datos.
● Fwd. Trans (solo disponible online)
Indica el número de cambios del estado "Discarding" al estado "Forwarding".

692

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Edge Type
Defina el tipo de "puerto Edge". Existen las siguientes posibilidades:
– "-"
El Edge Port está desactivado. El puerto se considera "sin puerto Edge".
– Admin
Seleccione esta opción si en este puerto se encuentra siempre un terminal. De lo
contrario se activa una reconfiguración de la red con cada cambio de conexión.
– Auto
Seleccione esta opción si debe detectarse automáticamente si hay conectado un
terminal en este puerto. La primera vez que se establezca una conexión, el puerto se
considerará un "no EdgePort".
– Admin/Auto
Seleccione estas opciones para utilizar una combinación de ambas en este puerto. La
primera vez que se establezca una conexión, el puerto se considerará un "puerto Edge".
● Edge (solo disponible online)
Indica el qué estado está el puerto.
– Activado
A este puerto está conectado un dispositivo terminal.
– Desactivado
En este puerto hay un dispositivo Tree o Rapid Spanning Tree.
En un terminal, un switch puede conmutar el puerto con mayor rapidez, sin considerar los
telegramas Spanning Tree. Si en contra de este ajuste se recibe un telegrama Spanning
Tree, el puerto cambia automáticamente al ajuste "Desactivado".
● P.t.P.-Typ
Seleccione en la lista desplegable la opción deseada. La selección depende del puerto
ajustado.
– "-"
La conexión punto a punto se determina automáticamente. Si el puerto está en
semidúplex, no se parte de una conexión punto a punto.
– P.t.P.
Se parte de una conexión punto a punto también con semidúplex.
– Shared Media
No se parte de una conexión punto a punto incluso si se trata de una conexión dúplex.
Nota
La conexión punto a punto significa una conexión directa entre dos equipos. Una
conexión Shared Media sería, p. ej., una conexión a un hub.
● P.t.P. (solo disponible online)
– Activado
Indica que hay una conexión punto a punto.
– Desactivada
Indica que no hay conexión punto a punto.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

693

Configuración de dispositivos y redes
1.3 Configurar redes

LLDP
Determinación de la topología de red
LLDP (Link Layer Discovery Protocol) está definido en el estándar IEEE 802.AB.
LLDP es un método para determinar la topología de red. Los componentes de red intercambian
información con sus vecinos a través de LLDP.
Los componentes de red que soportan LLDP disponen de un agente LLDP. El agente LLDP
envía información sobre sí mismo en intervalos periódicos y recibe información de dispositivos
conectados. La información recibida se guarda en la MIB.

Aplicaciones
PROFINET utiliza el protocolo LLDP para el diagnóstico de topología. Con el ajuste de fábrica,
LLDP está activado para todos los puertos, es decir, se envían y reciben telegramas LLDP en
todos los puertos.
La información enviada se almacena en cada dispositivo apto para LLDP en un archivo LLDP
MIB. Los sistemas de gestión de redes pueden acceder a estos archivos LLDP MIB con ayuda
de SNMP y así emular la topología de red existente. Un administrador puede determinar de ese
modo p. ej. qué componentes de red están conectados entre sí y localizar las averías que se
produzcan.
En esta página se tiene la posibilidad de activar o desactivar el envío y/o la recepción por cada
puerto.

Descripción de los campos mostrados
La tabla 1 se divide en las siguientes columnas:
● 1.ª columna
Indica que el ajuste es válido para todos los puertos de la tabla 2.
● Ajuste
Seleccione el ajuste deseado. Si está seleccionado "No hay modificaciones", la entrada de
la tabla 2 permanece invariable.
● Aplicar a tabla
Al hacer clic en este botón se aplica el ajuste a todos los puertos de la tabla 2.

694

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla 2 se divide en las siguientes columnas:
● Puerto
Muestra los puertos disponibles. El puerto se compone del número de módulo y del número
de puerto, p. ej. el puerto 0.1 es el módulo 0, puerto 1.
● Ajuste
Especifique si el puerto debe enviar o recibir telegramas LLDP. Existen las siguientes
posibilidades:
– Rx
Este puerto solo puede recibir telegramas LLDP.
– Tx
Este puerto solo puede enviar telegramas LLDP.
– Rx & Tx
Este puerto puede recibir y enviar telegramas LLDP.
– "-" (desactivado)
Este puerto no puede recibir ni enviar telegramas LLDP.

Configurar funciones de Layer 3 para IPv4
Rutas estáticas
Ruta estática
En esta página se define a través de qué rutas puede producirse un intercambio de datos entre
las diferentes subredes. Los protocolos de routing dinámicos no se soportan, p. ej. RIP, OSPF.

Descripción de los campos mostrados
La página contiene los siguientes campos:
● Red de destino
Introduzca la dirección de red del destino al que se accede a través de esta ruta.
● Máscara de subred
Introduzca la máscara de subred correspondiente.
● Pasarela
Introduzca la dirección IPv4 de la pasarela que da acceso a esta dirección de red.
● Interfaz
Seleccione la interfaz de la ruta.
● Distancia administrativa
Introduzca la distancia administrativa para la ruta. La distancia administrativa corresponde
a la calidad de una conexión, p. ej. velocidad y costes. Si hay varias rutas iguales, se
utilizará la que tenga el valor más pequeño.
Si no se realiza ninguna entrada, se ajusta automáticamente "not used" (no utilizado). La
distancia administrativa puede modificarse a posteriori.
Rango de valores: 1 - 254 o -1 para "not used". 1 es el valor correspondiente a la mejor ruta
posible.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

695

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla se divide en las siguientes columnas:
● Red de destino
Indica la dirección de la red de destino.
● Máscara de subred
Muestra la máscara de subred correspondiente.
● Gateway
Indica la dirección IPv4 de la siguiente pasarela.
● Interfaz
Muestra la interfaz de la ruta.
● Distancia administrativa
Introduzca la distancia administrativa para la ruta.
● Estado (solo disponible online)
Indica si la ruta está activa o no.

Subredes
Sinopsis
Esta página muestra las subredes para la interfaz seleccionada. Una subred se refiere siempre
a una interfaz y se crea en la entrada "Configuración".

Descripción
La página contiene el siguiente campo:
● Interfaz
Seleccione la interfaz en la que debe configurarse otra subred.
La tabla se divide en las siguientes columnas:
● Interfaz
Indica la interfaz.
● Interfaz TIA
Muestra la interfaz TIA seleccionada.
● Nombre de la interfaz
Indica el nombre de la interfaz.
● Dirección MAC (solo disponible online)
Muestra la dirección MAC.
● Dirección IP
Indica la dirección IPv4 de la subred.
● Máscara de subred
Indica la máscara de subred.

696

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Tipo de dirección
Indica el tipo de dirección. Son posibles los siguientes valores:
– Primaria
La primera dirección IPv4 configurada en una interfaz IPv4.
– Secundaria
Todas las demás direcciones IPv4 configuradas en una interfaz IPv4.
● Método de asignación de direcciones IP
Indica cómo se asigna la dirección IPv4. Son posibles los siguientes valores:
– Estática
La dirección IPv4 es estática. Introduzca los ajustes en "Dirección IP" y "Máscara de
subred".
– Dinámica (DHCP)
El dispositivo obtiene una dirección IPv4 dinámica de un servidor DHCPv4.
● Estado de la detección de colisiones de direcciones (solo disponible online)
Si se activan direcciones IPv4 nuevas en la red, la función "Detección de colisiones de
direcciones" comprueba si pueden producirse colisiones de direcciones. De este modo se
detectan direcciones IPv4 que deben asignarse por duplicado.
Nota
La función no realiza ninguna comprobación cíclica.
Esta columna indica en qué estado se encuentra la función. Son posibles los siguientes
valores:
– Idle
La interfaz no está activa y no tiene dirección IPv4.
– Starting
Este estado designa la fase de arranque. En esta fase, el dispositivo envía primero una
consulta acerca de si la dirección IPv4 prevista ya existe. Si la dirección todavía no está
asignada, el dispositivo envía una notificación indicando que a partir de ahora utilizará
esta dirección IP.
– Conflict
La interfaz no está activa. La interfaz intenta utilizar una dirección IPv4 que ya está
asignada.
– Defending
La interfaz utiliza una dirección IPv4 unívoca. Otra interfaz intenta utilizar la misma
dirección IPv4.
– Active
La interfaz utiliza una dirección IPv4 unívoca. No hay colisiones.
– Not supported
La función para detectar colisiones de direcciones no se soporta.
– Disabled
La función para detectar colisiones de direcciones está desactivada.
● MTU
Indica el tamaño del paquete.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

697

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración
En esta página se configura la subred para la interfaz.

Descripción
La página contiene lo siguiente:
● Interfaz (Nombre)
Seleccione la interfaz en la lista desplegable.
● Nombre de interfaz
Introduzca el nombre de la interfaz.
● Dirección MAC (solo disponible online)
Muestra la dirección MAC de la interfaz seleccionada.
● DHCP / Dinámica
Especifique si la interfaz obtiene la dirección IP dinámicamente.
– DHCP: la interfaz VLAN obtiene la dirección IPv4 de un servidor DHCP.
– Dinámica: la interfaz PPP obtiene la dirección IP del proveedor.
Nota
Si desea utilizar el dispositivo como router con varias interfaces, desactive DHCP en todas
las interfaces.
● Dirección IP
Introduzca la dirección IPv4 de la interfaz. No se permite el uso múltiple de direcciones IPv4.
● Máscara de subred
Introduzca la máscara de subred de la subred que se va a crear. Las subredes de distintas
interfaces no deben solaparse.
● Dirección IP broadcast
Si una determinada dirección IP debe utilizarse como dirección IP broadcast de la subred,
indíquelo aquí. En caso contrario se utilizará la última dirección IP de la subred.
● Tipo de dirección
Muestra el tipo de dirección. Son posibles los siguientes valores:
– Primaria
La primera subred de la interfaz.
– Secundaria
Todas las subredes restantes de la interfaz.

698

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Interfaz TIA
Elija si esta interfaz debe ser la interfaz TIA.
Para la interfaz TIA rigen las condiciones siguientes:
– Solo es posible activar como interfaz TIA las interfaces con el tipo de dirección
"Primaria".
– Siempre debe haber una interfaz TIA.
– Solo puede haber una interfaz TIA.
– Una interfaz TIA es siempre una interfaz VLAN.
● La MTU
MTU (Maximum Transmission Unit) determina el tamaño máximo del paquete. Si los
paquetes superan el tamaño especificado por la MTU, se fragmentan.

NAT
Enmascaramiento
En esta página se activan las reglas para Enmascaramiento IP.

Descripción
La tabla se divide en las siguientes columnas:
● Interfaz
Interfaz a la que se refiere el ajuste. Solo están disponibles interfaces con subred
configurada.
● Activar enmascaramiento
Si está activado, en cada paquete de datos saliente que se envía a través de esta interfaz
la dirección IP de origen es sustituida por la dirección IP de la interfaz.

NAPT
En esta página del WBM existe la posibilidad de configurar no solo una conversión de
direcciones sino también una conversión de puertos.
Son posibles las siguientes conversiones de puertos:
● De un solo puerto al mismo puerto
Si los puertos son iguales, los telegramas se reenvían sin conversión de puerto.
● De un solo puerto a un solo puerto
Los telegramas se convierten al puerto.
● De un rango de puertos a un solo puerto
Los telegramas del rango de puertos se convierten al mismo puerto (n:1).
● De un rango de puertos al mismo rango de puertos
Si los rangos de puertos son iguales, los telegramas se reenvían sin conversión de puerto.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

699

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Interfaz de origen
Seleccione la interfaz a la que deben llegar las consultas.
● Tipo de traffic
Defina para qué protocolo es válida la asignación de direcciones.
● Utilizar la IP de interfaz de la interfaz de origen
Si está activado, en "Dirección IP de destino" se utiliza la dirección IP de la interfaz
seleccionada.
● Dirección IP de destino
Introduzca la dirección IP de destino. En esta dirección IP se reciben los telegramas. Solo
puede editarse si está desactivado "Utilizar la IP de interfaz de la interfaz de origen".
● Puerto de destino
Introduzca el puerto de destino. Se reenvían los telegramas entrantes que tienen este
puerto como destino. Si el ajuste debe ser válido para un rango de puertos, indique el rango
introduciendo el puerto de origen seguido de "-" y después el puerto de destino, p. ej. 30 40.
● Conversión de IP de destino
Introduzca la dirección IP de la estación a la que se reenvía este telegrama.
● Conversión de puerto de destino
Introduzca el número de puerto. Es el nuevo puerto de destino al que se reenvía el
telegrama entrante. Si el ajuste debe ser válido para un rango de puertos, indique el rango
introduciendo el puerto de origen seguido de "-" y después el puerto de destino, p. ej. 30 40.
La tabla se divide en las siguientes columnas:
● Interfaz de origen
Indica la interfaz de la que deben proceder los paquetes. Solo estos paquetes entran en
consideración para un reenvío por puerto.
● Tipo de traffic
Indica para qué protocolo es válida la asignación de direcciones.
● IP de interfaz
Indica si se utiliza la dirección IP de la interfaz.
● IP de destino
Indica la dirección IP de destino. En esta dirección IP se reciben los telegramas.
● Puerto de destino
Indica el puerto de destino. Se reenvían los telegramas entrantes que tienen este puerto
como destino.
● Conversión de IP de destino
Indica la dirección IP de la estación a la que se reenvían los paquetes.
● Conversión de puerto de destino
Indica a qué puerto se produce la conversión.

700

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Source NAT
En esta página se configuran las reglas para source NAT
Nota
Reglas de cortafuegos con source NAT
La conversión de direcciones con Source-NAT no se lleva a cabo hasta detrás del cortafuegos,
por lo que se utilizan las direcciones sin convertir.
Seguridad > Cortafuegos > Reglas IP
● Origen (rango): entrada de "Direcciones IP de origen"
● Destino (rango): entrada de "Direcciones IP de destino"

Descripción
● Interfaz de origen / Interfaz de destino
Defina el sentido en el que se establecerá la conexión. Solo se consideran conexiones que
se establecen en el sentido definido aquí.
Para la selección también están disponibles las interfaces virtuales de las conexiones VPN:
– VLANx: VLAN con subred configurada
– ppp2: Interfaz WAN
– SINEMA RC: Conexión con el servidor SINEMA RC
– IPsec: O todas las conexiones VPN IPsec (all) o una conexión VPN IPsec específica
– OpenVPN: O todas las conexiones OpenVPN (all) o una conexión OpenVPN específica
Nota
Si se configurara una conversión de direcciones NAT en sentido de entrada o de salida del
túnel VPN, a través del túnel VPN solo es posible acceder a las direcciones IP intervinientes
de las reglas de conversión de direcciones NAT.
● Direcciones IP de origen
Especifique para qué direcciones IP de origen es válida esta regla source NAT. Solo se
consideran los paquetes que corresponden a las direcciones introducidas.
Son posibles las siguientes entradas:
– Dirección IP: es válida únicamente para la dirección IP indicada.
– Área de direcciones IP: es válida para un rango de direcciones IP determinado:
dirección IP inicial "-" dirección IP final, p. ej., 192.168.100.10 - 192.168.100.20
– Subred IP: es válida para varias direcciones IPv4 que se agrupan en un rango de
direcciones IP: dirección IP/número de bits de la sección de red (notación CIDR)
● Utilizar la IP de interfaz de la interfaz de destino
Si está activado, en "Conversión de IP de origen" se utiliza la dirección IP de la interfaz de
destino seleccionada.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

701

Configuración de dispositivos y redes
1.3 Configurar redes
● Conversión de IP de origen
Introduzca la dirección IP por la que se sustituye la dirección IP del remitente. Solo puede
editarse si está desactivado "Utilizar IP de interfaces de la interfaz de destino".
● Direcciones IP de destino
Especifique para qué direcciones IP de destino es válida esta regla source NAT. Solo se
consideran los paquetes cuya dirección IP de destino está dentro del área de direcciones
introducidas.
– Dirección IP: es válida únicamente para la dirección IP indicada.
– Área de direcciones IP: es válida para un rango de direcciones IP determinado:
dirección IP inicial "-" dirección IP final, p. ej., 192.168.100.10 - 192.168.100.20
– Subred IP: Es válida para varias direcciones IPv4 que se agrupan en un rango de
direcciones IP: dirección IP/número de bits de la sección de red (notación CIDR)
La tabla se divide en las siguientes columnas:
● Interfaz de origen
Indica la interfaz de origen.
● Interfaz de destino
Indica la interfaz de destino.
● Direcciones IP de origen
Indica las direcciones IP del remitente para las que se desea una conversión de direcciones.
● Conversión IP de origen
Indica la dirección IP por la que se sustituye la dirección IP del remitente.
● Direcciones IP de destino
Indica las direcciones IP del destinatario para las que se desea una conversión de
direcciones.

702

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

NETMAP
En esta página se definen las reglas para NETMAP NETMAP es un mapeado estático 1:1 de
direcciones de red en el que se mantiene la parte correspondiente al host. Encontrará más
información al respecto en el capítulo "NAT y cortafuegos".
Nota
Regla del cortafuegos con Source-NAT
La conversión de direcciones con Source-NAT no se lleva a cabo hasta detrás del cortafuegos,
por lo que se utilizan las direcciones sin convertir.
Seguridad > Cortafuegos > Reglas IP
● Origen (rango): Entrada de "Subred IP de origen"
● Destino (rango): Entrada de "Subred IP de destino"
Regla del cortafuegos con Destination-NAT
La conversión de direcciones con NAT se ha llevado a cabo delante del cortafuegos, por lo que
en el cortafuegos se utilizan las direcciones convertidas.
Seguridad > Cortafuegos > Reglas IP
● Origen (rango): Entrada de "Subred IP de origen"
● Destino (rango): Entrada de "Conversión de subred IP de destino"

Descripción
● Tipo
Defina el tipo de conversión de direcciones.
– Origen: sustitución de la dirección IP de origen
– Destino: Sustitución de la dirección IP de destino
● Interfaz de origen
Defina la interfaz de origen.
– VLANx: VLAN con subred configurada
– SINEMA RC: Conexión con el servidor SINEMA RC
– IPsec: O todas las conexiones VPN IPsec (all) o una conexión VPN IPsec específica
– ppp2: Interfaz WAN
– OpenVPN: O todas las conexiones OpenVPN (all) o una conexión OpenVPN específica
● Interfaz de destino
Defina la interfaz de destino.
– VLANx: VLAN con subred configurada
– SINEMA RC: Conexión con el servidor SINEMA RC
– IPsec: O todas las conexiones VPN IPsec (all) o una conexión VPN IPsec específica
– ppp2: Interfaz WAN
– OpenVPN: O todas las conexiones OpenVPN (all) o una conexión OpenVPN específica

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

703

Configuración de dispositivos y redes
1.3 Configurar redes
● Subred IP de origen
Introduzca la subred del remitente.
La subred solo puede ser un PC individual u otro subconjunto de la subred. Utilice la
notación CIDR.
● Conversión de subred IP de origen
Introduzca la subred por la que se sustituye la subred del remitente. Solo puede editarse en
los ajustes "SourceNAT".
La subred solo puede ser un PC individual u otro subconjunto de la subred. Utilice la
notación CIDR.
● Subred IP de destino
Introduzca la subred del destinatario.
La subred solo puede ser un PC individual u otro subconjunto de la subred. Utilice la
notación CIDR.
● Conversión de subred IP de destino
Introduzca la subred por la que se sustituye la subred del destinatario. Solo puede editarse
en los ajustes "DestinationNAT".
La subred solo puede ser un PC individual u otro subconjunto de la subred. Utilice la
notación CIDR.
La tabla se divide en las siguientes columnas:
● Tipo
Indica el sentido de la conversión de direcciones.
● Interfaz de origen
Indica la interfaz de origen.
● Interfaz de destino
Indica la interfaz de destino.
● Subred IP de origen
Indica la subred del remitente.
● Conversión de subred IP de origen
Introduzca la subred del remitente por la que se sustituye la subred del remitente.
● Subred IP de destino
Indica la subred del destinatario.
● Conversión de subred IP de destino
Indica la subred del destinatario por la que se sustituye la subred del destinatario.

704

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

VRRPv3
Router
Introducción
En esta página se crean routers virtuales nuevos. Se pueden configurar otros parámetros en
"Layer 3 (IPv4) > VRRPv3 > Configuración".
Nota
● VRRPv3 puede utilizarse en interfaces VLAN. No se admiten puertos router.

Requisitos
Para que los paquetes entrantes se reenvíen al dispositivo debe activarse la regla IPv4
predefinida "VRRP".

Descripción
● VRRPv3
Active o desactive el routing vía VRRPv3.
● Responder a solicitudes Ping en interfaces virtuales
Si está activado, también responden al Ping las direcciones IPv4 virtuales.
● Tracking VRID
Active o desactive el Tracking VRID. Cuando está activado se vigilan todas las instancias
VRRP.
Si el estado de una instancia VRRP cambia a "Initialize", la prioridad de todas las instancias
VRRP se reduce al valor "1".
Si el estado de la instancia VRRP cambia, se restablece la prioridad original de todas las
instancias VRRP.
● Interface
Seleccione la interfaz VLAN deseada que ejerce de router virtual.
● VRID
Introduzca la ID del router virtual. Esta ID define el grupo de routers que forman un router
virtual (VR). En el grupo la ID es igual. No puede utilizarse para otros grupos.
La tabla se divide en las siguientes columnas:
● Interface
Indica la interfaz IPv4 que ejerce de router virtual.
● VRID
Muestra la ID del router virtual.
● Dirección MAC virtual (solo disponible online)
Muestra la dirección MAC virtual del router virtual.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

705

Configuración de dispositivos y redes
1.3 Configurar redes
● Primary IP Address
Indica la dirección IPv4 que tiene el número más bajo en esa VLAN. La entrada 0.0.0.0
significa que en esta VLAN se utiliza la dirección "primaria". En caso contrario son valores
válidos todas las direcciones IPv4 que se han configurado en esta VLAN en el menú "Layer
3 > Subredes".
● Estado del router (solo disponible online)
Indica el estado actual del router virtual. Los valores posibles son:
– Master
El router es el router maestro y adopta la funcionalidad de routing para todas las
direcciones IPv4 asignadas.
– Backup
El router es el de reserva. Si el router maestro falla, el router de reserva adopta las
funciones del maestro.
– Initialize
El Router virtual acaba de ser conectado. En breve, pasará al estado "Master" o
"Backup".
● Dirección IP maestra (solo disponible online)
Muestra la dirección IPv4 del router maestro.
● Prioridad (solo disponible online)
Muestra la prioridad del router virtual.
Cuando se asigna al router VRRP una dirección IPv4 que realmente está configurada
también en la interfaz IPv4 local, se introduce automáticamente el valor 255. Todas las
prioridades restantes pueden distribuirse libremente entre los routers VRRP. Cuanto mayor
sea la prioridad, antes pasará el router VRRP a "Master".
● Intervalo Advert.
Muestra el intervalo con el que el router maestro envía paquetes VRRPv3.
● Preempt
Muestra la preferencia de un router al cambiar de función entre reserva y maestro.
– sí
Este router tiene preferencia al cambiar de función.
– no
Este router no tiene preferencia al cambiar de función.

VRRP y servidor DHCP
Si desea utilizar un servidor DHCP en los dispositivos de un grupo VRRP, el servidor DHCP
debe estar configurado en el router maestro. Los routers de reserva no reaccionan a peticiones
DHCP. Asegúrese de que el router maestro está configurado de forma estática y de que siga
siendo el maestro del grupo VRRP después de un fallo.

Configuración
Introducción
En esta página se configura el router virtual.

706

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene lo siguiente:
● Interface / VRID
Seleccione la ID del router virtual que debe configurarse.
● Primary Address
Seleccione la dirección IPv4 prioritaria. Si el router va a ser el maestro, utilizará esta
dirección IPv4.
Nota
Si en esta VLAN solo configura una subred, no es necesaria ninguna entrada. La entrada
será en este caso 0.0.0.0.
Si configura varias subredes en la VLAN y desea utilizar una dirección IPv4 determinada
como dirección de origen para paquetes VRRP, seleccione una dirección IPv4 adecuada.
En cualquier otro caso se utiliza la dirección IPv4 con el número más bajo.
● Master
Si está activado, se introducirá la dirección IPv4 con el número más bajo en "Associated IP
Address". De este modo, la dirección IPv4 con el número más bajo del router VRRPv3 se
utiliza como dirección IP virtual del router maestro virtual. Los routers de reserva de este
grupo tienen que desactivar esta opción y utilizar la dirección IPv4 del router en "Associated
IP Address".
● Priority
Introduzca la prioridad de este router virtual. Los valores válidos son 1-254.
Cuando se asigna al router VRRPv3 una dirección IPv4 que realmente está configurada
también en la interfaz IPv4 local, se introduce automáticamente el valor 255. Todas las
prioridades restantes pueden distribuirse libremente entre los routers VRRPv3. Cuanto
mayor sea la prioridad, antes pasará el router VRRPv3 a "Master".
● Advertisement Interval
Introduzca el intervalo en segundos tras el cual un router maestro vuelve a enviar un
paquete VRRPv3.
● Preempt lower priority Master
Permita la preferencia para cambiar de función entre reserva y maestro basándose en el
proceso de selección.
● VRRP Compatible Mode
Cuando está activado, el router VRRPv3 recibe no solo telegramas VRRPv2, sino también
telegramas VRRPv2 para direcciones IPv4 configuradas. Solo es necesario cuando no
todos los routers VRRP soportan VRRPv3
● ID de seguimiento
Seleccione un ID de seguimiento.
● Reducir la prioridad
Indique con qué valor se reduce la prioridad de la interfaz VRRP.
● Prioridad actual
Muestra la prioridad de la interfaz VRRP conforme a la cual la interfaz vigilada ha cambiado
al estado "down".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

707

Configuración de dispositivos y redes
1.3 Configurar redes

Sinopsis de direcciones
Sinopsis
Esta página muestra qué direcciones IPv4 vigila el router virtual. Cada router virtual puede
vigilar como máximo 10 direcciones IPv4.

Ajustes
La tabla se divide en las siguientes columnas:
● Interface
Indica la interfaz que ejerce de router virtual.
● VRID
Muestra la ID de este router virtual.
● Number of Addresses
Muestra el número de direcciones IPv4.
● Associated IP Address (1) ...Associated IP Address (10)
Muestra las direcciones IPv4 de router vigiladas por este router virtual. Si un router adopta
la función de maestro, la función Routing de todas estas direcciones IPv4 es asumida
también por ese router.

Configuración de direcciones
Crear o modificar las direcciones IP vigiladas
En esta página se pueden crear, cambiar o borrar las direcciones IPv4 sometidas a vigilancia.

Ajustes
La página contiene lo siguiente:
● Interface / VRID
Seleccione la ID del router virtual.
● Associated IP Address
Introduzca la dirección IPv4 que debe vigilar el router virtual.
La tabla se divide en las siguientes columnas:
● Associated IP Address
Muestra las direcciones IPv4 vigiladas por el router virtual.

Vigilancia de interfaces
Introducción
En esta página se configura la vigilancia de interfaces.

708

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Si el enlace de una interfaz vigilada cambia de "up" a "down", la prioridad de la interfaz VRRP
asignada se reduce. El valor con el que se reducirá la prioridad se configura en la página "Layer
3 > VRRP/VRRPv3 > Configuration".
Si el enlace de la interfaz vuelve a cambiar de "down" a "up", se restablece la prioridad original
de la interfaz VRRP.

Descripción
La página contiene los siguientes campos:
● Interface
Seleccione la interfaz que desee vigilar.
● Track Id
Introduzca una Track Id.
● Track Id
Seleccione una Track Id.
● Track Interface Count
Indique cuántas de las interfaces vigiladas deben cambiar al estado "down" antes de
cambiar la prioridad.
La tabla se divide en las siguientes columnas:
● Track Id
Indica la ID de seguimiento.
● Interface
Muestra la interfaz vigilada.

Vigilancia de direcciones
Introducción
En esta página se configura la vigilancia de direcciones IPv4. Dentro del periodo de tiempo
especificado, el router envía una solicitud de ping a cada una de las direcciones IPv4
configuradas. Si dentro de un periodo de tiempo especificado no recibe ninguna respuesta, la
prioridad VRRP de la interfaz correspondiente se reduce.

Descripción
La página contiene los siguientes campos:
● ID de seguimiento
Introduzca la ID de seguimiento.
● Dirección IP
Introduzca la dirección IPv4 que debe vigilarse. Es posible introducir como máximo cinco
direcciones IPv4.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

709

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla se divide en las siguientes columnas:
● ID de seguimiento
Indica la ID de seguimiento.
● Dirección IP
Muestra la dirección IPv4 que se vigilará.
● Período de ping
Muestra la duración del ciclo en segundos entre dos solicitudes de ping.
● Timeout del ping
Muestra el tiempo en segundos durante el cual el router espera una respuesta de ping. La
duración mínima es tres veces el periodo del ping.

Configurar funciones de seguridad
Contraseñas
Configuración de las contraseñas de equipo
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.
Nota
Si ha iniciado sesión a través de un servidor RADIUS no es posible modificar contraseñas
locales de dispositivos.
En esta página se pueden modificar contraseñas. Si ha iniciado sesión con la función "admin",
podrá modificar las contraseñas de todas las cuentas de usuario. Si ha iniciado sesión con la
función "user", solo podrá cambiar su propia contraseña.
Nota
Si inicia sesión por primera vez o tras un "Restablecer los ajustes de fábrica y reiniciar" con el
usuario predeterminado "admin", se le pedirá que cambie la contraseña.
Las contraseñas de fábrica al entregarse el equipo son las siguientes:
● admin: admin
Nota
Cambiar la contraseña en modo Trial
Si se cambia la contraseña en modo de configuración "Trial", dicho cambio también se
guardará inmediatamente.

710

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los campos mostrados
● Usuario actual
Muestra el usuario que tiene sesión iniciada.
● Contraseña de usuario actual
Introduzca la contraseña del usuario que tiene la sesión iniciada.
● Cuenta de usuario
Seleccione el usuario cuya contraseña desea cambiar.
● Directriz para contraseñas
Indica la norma que se utilizará al otorgar contraseñas nuevas.
– Alta
Longitud de contraseña: mínimo 8 caracteres, máximo 128 caracteres
Mínimo 1 mayúscula
Mínimo 1 carácter especial
mínimo 1 cifra
– Baja
Longitud de contraseña: mínimo 6 caracteres, máximo 128 caracteres
● Nombre nuevo para la cuenta de usuario Admin
Puede cambiar una vez el nombre del usuario predeterminado "admin". Después ya no
será posible volver a cambiar el nombre de "admin".
● Contraseña nueva
Introduzca la nueva contraseña para el usuario seleccionado. No puede contener los
caracteres siguientes:
–§?";:–
Tampoco puede contener espacios ni el carácter para "Eliminar".
● Confirmar contaseña
Vuelva a introducir la contraseña para confirmarla.

Usuarios
Usuarios locales
Nota
En algunos dispositivos esta página solo está disponible cuando hay conexión online con el
dispositivo.

Usuarios locales
En esta página se crean cuentas de usuario locales para WBM y CLI con los derechos
correspondientes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

711

Configuración de dispositivos y redes
1.3 Configurar redes
Al crear o borrar un usuario local, el cambio se realiza también automáticamente en la tabla
"Cuentas de usuario externas". Si desea realizar un cambio explícitamente para la tabla de
usuarios interna o externa, utilice los comandos CLI.
Nota
Los valores mostrados dependen de los derechos del usuario que ha iniciado sesión.

Descripción
La página contiene lo siguiente:
● Cuenta de usuario
Introduzca el nombre de usuario. El nombre debe cumplir las condiciones siguientes:
– Debe ser unívoco.
– Debe tener entre 1 y 250 caracteres.
– No puede contener los caracteres siguientes: § ? " ; :
– No se admiten los siguientes nombres de usuario: admin, service, debug
Nota
Nombre de usuario no modificable
Una vez creado un usuario, el nombre de usuario ya no se podrá modificar.
Para modificar un nombre de usuario es necesario borrar el usuario y volver a crearlo.
Nota
Nombres de usuario: admin, service, debug
En el estado de suministro están predefinidos de fábrica los siguientes nombres de usuario:
admin, service, debug.
● admin: Este nombre de usuario permite configurar el dispositivo. Cuando inicie la sesión
por primera vez o tras un "Restablecer los ajustes de fábrica y reiniciar", se le solicitará
que cambie la contraseña predeterminada "admin".
● service, debug: Estos nombres de usuario están reservados para fines de servicio.
● Password Policy
Indica la norma que se utilizará para la contraseña:
– Alta
Longitud de contraseña: mínimo 8 caracteres, máximo 128 caracteres
Mínimo 1 mayúscula
Mínimo 1 carácter especial
Mínimo 1 número
– Baja
Longitud de contraseña: mínimo 6 caracteres, máximo 128 caracteres
● Password
Indique la contraseña. La severidad de la contraseña depende de la norma ajustada:

712

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Password Confirmation
Vuelva a introducir la contraseña para confirmarla.
● Role
Seleccione una función.
Puede elegir entre las funciones predefinidas y las personalizadas, consulte la página
"Seguridad > Usuarios > Funciones".
La tabla contiene las siguientes columnas:
Nota
Los usuarios predeterminados así como los usuarios que tienen sesión iniciada no pueden
borrarse ni modificarse.
● Cuenta de usuario
Muestra el nombre de usuario.
● Role
Muestra la función del usuario.
● Description
Muestra una descripción de la cuenta de usuario. El texto descriptivo puede contener 100
caracteres como máximo.

Funciones
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Funciones
En esta página se crean funciones válidas localmente en el dispositivo.
Nota
Los valores mostrados dependen de los derechos del usuario que ha iniciado sesión.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

713

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción de los campos mostrados
La página contiene lo siguiente:
● Role Name
Introduzca el nombre para la función. El nombre debe cumplir las condiciones siguientes:
– Debe ser unívoco.
– Debe tener entre 1 y 64 caracteres.
Nota
Nombre de función no modificable
Una vez creada una función, su nombre ya no se podrá modificar.
Para modificar un nombre de función es necesario borrar la función y volver a crearla.
La tabla contiene las siguientes columnas:
Nota
Borrar funciones
Las funciones predeterminadas así como las funciones asignadas no pueden borrarse ni
modificarse.
● Role
Muestra el nombre de la función.
● Function Right
Seleccione los derechos de la función:
– 1
Los usuarios con esta función pueden leer parámetros del dispositivo pero no
cambiarlos. Los usuarios con esta función pueden cambiar su propia contraseña.
– 15
Los usuarios con esta función pueden leer y modificar los parámetros del dispositivo.
Nota
Derecho de función no modificable
Una vez se ha asignado una función ya no es posible modificar el derecho de función.
Si desea el derecho de una función, proceda del siguiente modo:
1. Borre todos los usuarios asignados.
2. Cambie el derecho de la función.
3. Vuelva a asignar la función.
● Description
Introduzca una descripción para la función. En las funciones predefinidas se muestra una
descripción. El texto descriptivo puede contener 100 caracteres como máximo.

714

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Grupos
Nota
Esta página solo está disponible cuando hay conexión online con el dispositivo.

Grupos de usuarios
En esta página se vincula un grupo a una función.
En el presente ejemplo se vincula el grupo "Administrators" a la función "admin". El grupo está
definido en un servidor RADIUS. La función está definida localmente en el dispositivo. Cuando
un servidor RADIUS autentica a un usuario y lo asigna al grupo "Administrators", dicho usuario
recibe los derechos de la función "admin" en el dispositivo.
Nota
Los valores mostrados dependen de los derechos del usuario que ha iniciado sesión.

Descripción de los campos mostrados
La página contiene lo siguiente:
● Group Name
Introduzca el nombre del grupo. El nombre debe coincidir con el grupo del servidor
RADIUS. El nombre debe cumplir las condiciones siguientes:
– Debe ser unívoco.
– Debe tener entre 1 y 64 caracteres.
– No se permiten: § ? " ; :
La tabla contiene las siguientes columnas:
● Group
Muestra el nombre del grupo.
● Role
Seleccione una función. Los usuarios que se autentican con el grupo vinculado a través del
servidor RADIUS obtienen los derechos de la función en el dispositivo local. Puede elegir
entre las funciones predefinidas y las personalizadas; consulte la página "Seguridad >
Usuarios > Funciones".
● Description
Indique una descripción para la vinculación del grupo con una función. El texto descriptivo
puede contener 100 caracteres como máximo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

715

Configuración de dispositivos y redes
1.3 Configurar redes

AAA
General
Inicio de sesión de dispositivos de red
La denominación "AAA" utilizada en el menú es la abreviatura de "Authentication,
Authorization, Accounting". Esta función sirve para identificar y autorizar dispositivos de red y
prepararles los servicios correspondientes.
En esta página se configura el inicio de sesión.

Descripción
La página contiene los siguientes campos:
Nota
Para poder utilizar la autenticación de inicio de sesión "RADIUS", "Local y RADIUS" o
"RADIUS y Fallback local" debe haberse instalado un servidor RADIUS, que debe estar
configurado para la autenticación de usuarios.
● Autentificación de inicio de sesión
Especifique cómo debe ser el inicio de sesión:
– Local
La autenticación debe realizarse localmente en el dispositivo.
– RADIUS
La autenticación debe efectuarse a través de un servidor RADIUS.
– Local and RADIUS
La autenticación puede realizarse tanto con los usuarios existentes en el dispositivo
(nombre de usuario y contraseña) como mediante un servidor RADIUS. El usuario se
busca primero en la base de datos local. Si el usuario no existe se envía una solicitud
RADIUS.
– RADIUS y Fallback local
La autenticación debe efectuarse a través de un servidor RADIUS. Solo se lleva a cabo
una autenticación local si el servidor RADIUS no está accesible en la red.

Cliente RADIUS
Autentificación mediante un servidor externo.
El concepto de RADIUS se basa en un servidor de autenticación externo.
Cada fila de la tabla contiene los datos de acceso para un servidor. Primero se consulta al
servidor primario en el orden de búsqueda. Si no puede accederse al servidor primario, se
consultan servidores secundarios en el orden introducido. Si ninguno de los servidores
responde, no se efectúa la autentificación.

716

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene los siguientes campos:
● Modo de autorización RADIUS
El Modo de autorización RADIUS determina en la autenticación de inicio de sesión cómo se
asignan los derechos de usuario en caso de que la autenticación sea correcta.
– Estándar
En este modo, el usuario inicia sesión con derechos de administrador cuando el servidor
devuelve el valor "Administrative User" al dispositivo para el atributo "Service Type". En
todos los demás casos el usuario inicia sesión con derechos de lectura.
– Específico del fabricante
En este modo, la asignación de derechos depende de si el servidor devuelve un grupo
para el usuario y cuál y de si hay una entrada en la tabla "Cuentas de usuario externas"
para el usuario.
La tabla se divide en las siguientes columnas:
● Tipo de servidor de auten.
Seleccione el método de autenticación para el que debe utilizarse el servidor.
– Inicio de sesión
El servidor se utiliza únicamente para la autenticación de inicio de sesión.
– 802.1X
El servidor se utiliza únicamente para la autenticación 802.1X.
– Inicio de sesión y 802.1X
El servidor se utiliza para ambos métodos de autenticación.
● Dirección del servidor RADIUS
Introduzca aquí la dirección IPv4 o el FQDN (Fully Qualified Domain Name) del servidor
RADIUS.
● Puerto de servidor
Introduzca el puerto de entrada del servidor RADIUS. Por defecto está ajustado el puerto
de entrada 1812. El rango de valores es de 1 a 65535.
● Shared Secret
Introduzca su identificación de acceso. El rango de valores es de 1 a 128 caracteres.
● Confirmar Shared Secret
Confirme la identificación de acceso.
● Max. Retrans
Introduzca aquí el número máximo de repeticiones de un intento de solicitud. El intento de
conexión inicial se repetirá el número de veces indicado por este valor antes de consultar
a otro servidor RADIUS configurado o dar por fallido el inicio de sesión. El ajuste
predeterminado son 3 repeticiones, es decir, 4 intentos de conexión. El rango de valores es
de 1 a 5.
● Servidor primario
Especifique si este servidor es el servidor primario. Puede elegir entre las opciones "sí" y
"no".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

717

Configuración de dispositivos y redes
1.3 Configurar redes
● Test (solo disponible online)
Con este botón se comprueba si el servidor RADIUS indicado está disponible o no. La
comprobación se realiza una sola vez y no se repite cíclicamente.
● Resultado del test (solo disponible online)
Indica si el servidor RADIUS está disponible o no:
– Fallido, no se han enviado paquetes de prueba
No se puede acceder a la dirección IP.
Se puede acceder a la dirección IP, pero el servidor RADIUS no funciona.
– Accesible, no se ha aceptado el Shared Secret
Se puede acceder a la dirección IP, pero el servidor RADIUS no acepta el Shared Secret
indicado.
– Accesible, se ha aceptado el Shared Secret
Se puede acceder a la dirección IP y el servidor RADIUS acepta el Shared Secret
indicado.
El resultado del test no se actualiza automáticamente. Para borrar el resultado del test haga
clic en el botón "Actualizar".

Certificados
Sinopsis
En esta página se muestran los archivos cargados (certificados y claves). Existen las
posibilidades siguientes para cargar los archivos en el dispositivo:
● Sistema > Cargar y guardar > HTTP
● Sistema > Cargar y guardar > TFTP
● Sistema > Cargar y guardar > SFTP

Descripción
● Tipo
Indica el tipo de archivo cargado.
– Cert. CA
El certificado CA está firmado por una entidad de certificación (CA = Certification
Authority).
– Certificado de dispositivo
– Archivo de claves
– Cert. Remoto
Certificado del interlocutor
● Nombre de archivo
Indica el nombre de archivo
● Estado
Indica si el certificado es válido o si ya ha caducado.

718

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● DN Solicitante
Indica el nombre del solicitante.
● DN Emisor
Indica el nombre de quien expide el certificado.
● Fecha de expedición
Indica el inicio del periodo de validez del certificado.
● Fecha de caducidad
Indica el final del periodo de validez del certificado.
● Utilizado
Indica el modo de funcionamiento que utiliza el certificado.

Certificados
El formato del certificado está basado en X.509, un estándar de ITU-T para crear certificados
digitales. En este estándar se describe esquemáticamente la estructura de los certificados
X.509. Encontrará más información al respecto en "http://www.itu.int".
En esta página puede visualizarse el contenido de los siguientes elementos de estructura. Si
en el certificado seleccionado el elemento de estructura no existe o está vacío, en el campo no
se muestra nada. Determinadas entradas solo pueden editarse en caso de que estén
soportadas.

Descripción
● Nombre de archivo
Seleccione el certificado que desee.
● Tipo
Indica el tipo de archivo cargado.
– Cert. CA
El certificado CA está firmado por una entidad de certificación (CA = Certification
Authority).
– Certificado de dispositivo
– Archivo de claves
– Cert. Remoto
Certificado del interlocutor
● DN Solicitante
Indica el nombre del solicitante.
● DN Emisor
Indica el nombre de quien expide el certificado.
● Nombre alternativo del solicitante
Si existe, se indica un nombre alternativo del solicitante.
● Fecha de expedición
Indica el inicio del periodo de validez del certificado.
● Fecha de caducidad
Indica el final del periodo de validez del certificado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

719

Configuración de dispositivos y redes
1.3 Configurar redes
● Número de serie
Indica el número de serie del certificado.
● Utilizado
Indica el modo de funcionamiento que utiliza el certificado.
● Algoritmo de encriptación
Indica el método criptográfico utilizado.
● Utilización de claves
Indica la finalidad para la que se utiliza la clave correspondiente al certificado, p. ej., para
verificar firmas digitales.
● Utilización avanzada de claves
Indica si la finalidad de uso tiene limitaciones adicionales, p. ej., solo para verificar firmas
del certificado CA.
● Archivo de claves
Indica el archivo de claves.
● Lista de revocación de certificados primera URL
Introduzca la URL a través de la cual se consulta la lista de revocación. Solo se puede editar
si es compatible con el certificado.
● Lista de revocación de certificados segunda URL
Introduzca una URL alternativa. Si no es posible consultar la lista de revocación en la
primera URL se utilizará la URL alternativa. Solo se puede editar si es compatible con el
certificado.
● Certificado
Indica el nombre del certificado.
● Passphrase
Introduzca la contraseña para el certificado. Solo puede editarse si el archivo codificado
está protegido por contraseña.
● Confirmar passphrase
Introduzca de nuevo la contraseña. Solo puede editarse si el archivo codificado está
protegido por contraseña.

Cortafuegos
General
En esta página se activa el cortafuegos.
Nota
Tenga en cuenta que si desactiva el cortafuegos la red interna queda desprotegida.

720

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene lo siguiente:
● Activar cortafuegos
Cuando está activada, el cortafuegos está activo.
● TCP Idle Timeout [s]
Introduzca el intervalo de tiempo deseado en segundos. Si no tiene lugar intercambio de
datos, una vez transcurrido dicho intervalo de tiempo se deshace automáticamente la
conexión TCP.
El rango de valores es de 1 a 21474836.
Ajuste predeterminado: 86 400 segundos
● UDP Idle Timeout [s]
Introduzca el intervalo de tiempo deseado en segundos. Si no tiene lugar intercambio de
datos, una vez transcurrido dicho intervalo de tiempo se deshace automáticamente la
conexión UDP.
El rango de valores es de 1 a 21474836.
Ajuste predeterminado: 300 segundos
● ICMP Idle Timeout [s]
Introduzca el intervalo de tiempo deseado en segundos. Si no tiene lugar intercambio de
datos, una vez transcurrido dicho intervalo de tiempo se deshace automáticamente la
conexión ICMP.
El rango de valores es de 1 a 21474836.
Ajuste predeterminado: 300 segundos

Reglas IPv4 predefinidas
La página contiene reglas predefinidas de filtrado de paquetes IP. Si se crean reglas de filtrado
de paquete IP propias, tendrán mayor prioridad que las reglas predefinidas de filtrado de
paquetes IP.
Aquí es posible ajustar qué servicios del dispositivo deben ser accesibles desde cada interfaz/
subred.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

721

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
● Interfaz
La lista es dinámica.
Interfaz a la que se refiere el ajuste.
– VLANx
Permite el acceso desde la subred IP al dispositivo. Están disponibles VLAN con subred
IP configurada.
– ppp2 (solo para S615)
Permite el acceso desde la interfaz WAN al dispositivo.
– SINEMA RC (solo para S615)
Permite el acceso desde el servidor SINEMA RC al dispositivo. Solo disponible con KEYPLUG SINEMA RC.
– Conexión OpenVPN, conexión IPsec VPN (solo para S615)
Permite a los interlocutores del túnel VPN que son accesibles a través de la conexión
VPN acceder al dispositivo. Si se ha creado una conexión VPN, en la lista se muestra
el nombre de la conexión.
● Se permite el acceso a los siguientes servicios IPv4:
– Todos
Todos los servicios IPv4 predefinidos
– HTTP
Para el acceso al Web Based Management.
– HTTPS
Para el acceso seguro al Web Based Management.
Nota
HTTP y HTTPS desactivados
Si se desactivan HTTP y HTTPS ya no es posible acceder al WBM del dispositivo.
HTTPS desactivado
Si se desactiva HTTPS solo es posible acceder al WBM mediante HTTP. Es
imprescindible que en "Sistema > Configuración > Servicios HTTP" esté configurado
"HTTP y HTTPS". Si, p. ej., está configurado "Derivar HTTP a HTTPS", el acceso vía
HTTP no puede derivarse a HTTPS. Por tanto ya no es posible acceder al WBM del
dispositivo.
– DNS
Consultas DNS al dispositivo. Solo es necesario cuando la función "Relé DNS" está
activada en el dispositivo.
– SNMP
Conexiones SNMP entrantes. Solo es necesario para acceder a la información SNMP
del dispositivo con un navegador MIB, por ejemplo.
– Telnet
Para el acceso no codificado a CLI.

722

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
– IPsec VPN
Permite el tráfico de datos IKE (Internet Key Exchange) desde la red externa al
dispositivo. Es necesario cuando un interlocutor VPN IPsec debe establecer una
conexión con dicho dispositivo.
– SSH
Para acceso codificado al CLI.
– DHCP
Acceso al servidor o cliente DHCP.
– Ping
Acceso a la función Ping
– Hora del sistema (solo para S615)
Acceso a NTP y SNTP
– Cloud Connector (solo para S615)
Acceso al TIA Portal Cloud Connector integrado y a los dispositivos accesibles a través
de la interfaz.
– VRRP
Acceso a VRRPv3

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

723

Configuración de dispositivos y redes
1.3 Configurar redes
● Interfaz
Interfaz a la que se refiere el ajuste.
– VLANx: permite el acceso desde la subred IP al dispositivo.
–
● Se permite el acceso a los siguientes servicios IPv4:
– Todos
Todos los servicios IPv4
– HTTP
Para el acceso al Web Based Management.
– HTTPS
Para el acceso seguro al Web Based Management.
Nota
HTTP y HTTPS desactivados
Si se desactivan HTTP y HTTPS ya no es posible acceder al WBM del dispositivo.
HTTPS desactivado
Si se desactiva HTTPS solo es posible acceder al WBM mediante HTTP. Es
imprescindible que en "Sistema > Configuración > Servicios HTTP" esté configurado
"HTTP y HTTPS". Si, p. ej., está configurado "Derivar HTTP a HTTPS", el acceso vía
HTTP no puede derivarse a HTTPS. Por tanto ya no es posible acceder al WBM del
dispositivo.
– DNS
Consultas DNS al dispositivo. Solo es necesario cuando la función "Relé DNS" está
activada en el dispositivo.
– SNMP
Conexiones SNMP entrantes. Solo es necesario para acceder a la información SNMP
del dispositivo con un navegador MIB, por ejemplo.
– Telnet
Para el acceso no codificado a CLI.
– IPsec VPN
Permite el tráfico de datos IKE (Internet Key Exchange) desde la red externa al
dispositivo. Es necesario cuando un interlocutor VPN IPsec debe establecer una
conexión con dicho dispositivo.
– SSH
Para el acceso codificado a CLI.
– DHCP
Acceso al servidor o cliente DHCP.
– Ping
Acceso a la función Ping.
– Hora del sistema
Acceso a NTP y SNTP

724

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Personalizado (S615)
En esta página se definen los conjuntos de reglas personalizados. Un conjunto de reglas
permite agrupar las reglas de cortafuegos que se requieren para el acceso remoto, por
ejemplo.
Un conjunto de reglas puede asignarse a uno o varios usuarios. Si el usuario inicia sesión
correctamente, se activa el conjunto de reglas del cortafuegos previsto para dicho usuario.
Tras el inicio de sesión se inicia un temporizador. Una vez transcurrido el tiempo, el dispositivo
cierra automáticamente la sesión del usuario.

Descripción
Área "Conjunto de reglas"
● Name
Especifique un nombre unívoco para el conjunto de reglas. Al hacer clic en el botón "Crear"
se crea una nueva fila con un número unívoco.
La tabla contiene las siguientes columnas:
● N.º
Muestra el número unívoco de la entrada.
● Nombre
Nombre del conjunto de reglas. En caso necesario es posible cambiar el nombre.
● Comentario
Comentario que describe con detalle el conjunto de reglas.
● Timeout
El acceso está limitado temporalmente. Defina la duración del acceso. En caso necesario,
el usuario puede prolongar el tiempo de acceso mediante el botón "Inicializar timeout" en la
página "Información del cortafuegos personalizado".
Área "Asignación del conjunto de reglas"
● Tipo
Especifique a quién se asignará cada conjunto de reglas. La indicación de la tabla siguiente
depende de la selección realizada en "Tipo".
– User Account
El conjunto de reglas se activa desde una cuenta de usuario.
– Digital Input
Mediante la activación de la entrada digital se ejecuta el conjunto de reglas. Para ello es
imprescindible que en "Sistema > Evento > Configuración" esté activada la entrada
"Entrada digital" en el evento "Cortafuegos".
La tabla "Cuenta de usuario" contiene las siguientes columnas:
● Cuenta de usuario
Solo se muestran los usuarios con el acceso remoto "Solo" o "Adicionalmente".
● Función
Muestra la función del usuario.
● Conjunto de reglas
Especifique el conjunto de reglas aplicable a este usuario.
Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

725

Configuración de dispositivos y redes
1.3 Configurar redes
● Combinado con
Combina el inicio de sesión del usuario con un evento, p. ej. el evento "Entrada digital". Para
iniciar sesión en la página del WBM para el cortafuegos personalizado, la entrada digital
debe tener tensión y el inicio de sesión del usuario en la misma debe haber sido correcto.
● Tiempo restante (solo disponible online)
Cuando este usuario ha iniciado sesión se muestra el tiempo restante del acceso.
● Forzar desactivación (solo disponible online)
Un usuario con derechos de administrador puede cerrar la sesión del usuario activo
pulsando este botón.
La tabla "Entrada digital" contiene las siguientes columnas:
● Entrada digital
Las entradas digitales disponibles.
● Conjunto de reglas
Especifique el conjunto de reglas que se controla desde la entrada digital.
● Origen dinámico (rango)
Introduzca la dirección IP o un rango IP que tenga permitido enviar paquetes IP.
● Estado (solo disponible online)
Muestra el tiempo restante del acceso.

Servicios IP
En esta página se definen los servicios IP. Con ayuda de las definiciones de servicios IP se
pueden definir reglas de cortafuegos, que se aplican a servicios determinados. Para esto se
adjudica un nombre, al que se asignan los parámetros de servicio. Para la configuración de las
reglas IP se utiliza simplemente ese nombre.

Descripción
La página contiene lo siguiente:
● Nombre del servicio
Introduzca el nombre del servicio IP. El nombre debe ser unívoco.
La tabla contiene las siguientes columnas:
● Nombre del servicio
Indica el nombre del servicio IP.
● Transporte
Defina el tipo de protocolo.
– UDP
La regla solo es válida para telegramas UDP.
– TCP
La regla solo es válida para telegramas TCP.

726

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Puerto de origen (rango)
Defina el puerto de origen. La regla es válida exactamente para el puerto indicado.
– Si la regla debe ser válida para un rango de puertos, indique el rango introduciendo el
puerto de origen seguido de "-" y después el puerto de destino, p. ej. 30 - 40.
– Si la regla debe regir para todos los puertos, introduzca "*".
● Puerto de destino (rango)
Defina el puerto de destino. La regla es válida exactamente para el puerto indicado.
– Si la regla debe ser válida para un rango de puertos, indique el rango introduciendo el
puerto de origen seguido de "-" y después el puerto de destino, p. ej. 30 - 40.
– Si la regla debe regir para todos los puertos, introduzca "*".

Servicios ICMP
En esta página se definen los servicios ICMP. Con ayuda de las definiciones de servicios ICMP
se pueden definir reglas de cortafuegos, que se aplican a servicios determinados. Para esto se
adjudica un nombre, al que se asignan los parámetros de servicio. Para la configuración de las
reglas IP se utiliza simplemente ese nombre.

Descripción
La página contiene lo siguiente:
● Nombre del servicio
Introduzca un nombre para el servicio ICMP. El nombre debe ser unívoco.
La tabla contiene las siguientes columnas:
● Nombre del servicio
Indica el nombre del servicio ICMP.
● Protocolo
Indica la versión del protocolo ICMP.
● Tipo
Defina el tipo de paquete ICMP. Algunos ejemplos son:
– Destination Unreachable
No es posible entregar el telegrama IP.
– Time Exceeded
Se ha rebasado el límite de tiempo.
– Echo-Request
Consulta de eco, conocida como ping.
● Code
El código describe con más precisión el tipo de paquetes ICMP. La selección depende del
tipo de paquete ICMP seleccionado.
"Destination Unreachable" significa que no es posible acceder al host "Code 1", por
ejemplo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

727

Configuración de dispositivos y redes
1.3 Configurar redes

Protocolos IP
En esta página se configuran protocolos personalizados, p. ej., IGMP para grupos multicast.
Para esto se adjudica un nombre de protocolo, al que se asignan los parámetros de servicio.
Para la configuración de las reglas IP se utiliza simplemente ese nombre de protocolo.

Descripción
La página contiene lo siguiente:
● Nombre de protocolo
Introduzca un nombre para el protocolo.
La página contiene las siguientes casillas de verificación:
● Nombre de protocolo
Indica el nombre del protocolo.
● Número de protocolo
Introduzca el número de protocolo, p. ej., 2. Encontrará una lista de los números de
protocolo en las páginas de Internet de iana.org.

Reglas IP
En esta página se definen Reglas propias de filtro de paquetes IP para los cortafuegos.
Las reglas de filtro de paquetes IP creadas aquí tienen prioridad:
● frente a las reglas predefinidas de filtro de paquetes IP (predefined IPv4) y
● frente a las reglas de filtro de paquetes IP creadas automáticamente basándose en una
configuración de conexiones (SINEMA RC).

Descripción de los campos mostrados
● Versión IP
La versión del protocolo IP.
● Conjunto de reglas (solo para S615)
Seleccione el conjunto de reglas deseado. Seguidamente, en la tabla solo se mostrarán las
reglas IP que están asignadas a este conjunto de reglas. Esto siempre que "Mostrar todas"
esté desactivado.
● Mostrar todas (solo para S615)
Cuando está activado se muestran todas las reglas IP disponibles. Con el ajuste "Asignar"
se asigna una regla IP al conjunto de reglas seleccionado.
La tabla contiene las siguientes columnas:
● Seleccionar
Active la casilla de verificación en la fila que desee borrar.
● Protocolo
Indica la versión del protocolo IP.

728

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Acción
Seleccione cómo debe procederse con los paquetes IP entrantes.
– "Accept" – Los paquetes de datos pueden pasar,
– "Reject" – Los paquetes de datos son rechazados, el remitente recibe el aviso
correspondiente,
– "Drop" – Los paquetes de datos son rechazados sin respuesta al remitente.
● De / A
Defina el sentido de comunicación de la regla IP.
– VLANx: VLAN con subred configurada
– Dispositivo
– SINEMA RC: Conexión con el servidor SINEMA RC
– IPsec: O todas las conexiones VPN IPsec (all) o una conexión VPN IPsec específica
– ppp2: Interfaz WAN
– OpenVPN: O todas las conexiones OpenVPN (all) o una conexión OpenVPN específica
● Origen (rango)
Introduzca la dirección IP o un rango IP que tenga permitido enviar paquetes IP.
– Si la regla debe ser válida para un rango IP, indique el rango introduciendo la dirección
de origen seguida de "-" y después la dirección de destino, p. ej. 192.168.100.10 192.168.100.20.
– Si la regla debe regir para todas las direcciones IP, introduzca "0.0.0.0/0".
● Destino (rango)
Introduzca la dirección IP o un rango IP que tenga permitido recibir paquetes IP.
– Si la regla debe ser válida para un rango IP, indique el rango introduciendo la dirección
de origen seguida de "-" y después la dirección de destino, p. ej. 192.168.100.10 192.168.100.20.
– Si la regla debe regir para todas las direcciones IP, introduzca "0.0.0.0/0".
● Servicio
Seleccione el servicio o el nombre de protocolo para el que será válida esta regla.
● Registro
Especifique si se registrará la aplicación de la regla y la gravedad de evento que tiene la
entrada.
Hay los ajustes siguientes:
– none
La concordancia no se registra.
– info / warning / critical
La concordancia se registra con la gravedad de evento seleccionada. El archivo de
registro se muestra en "Información" > "Tablas de registro" > "Registro de cortafuegos".
● Orden
Defina el orden de las reglas.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

729

Configuración de dispositivos y redes
1.3 Configurar redes

Nota
Abrir WBM a través de un tínel VPN
Para abrir WBM a través de un túnel VPN cree las siguientes reglas IP:
Acción: Accept
De: IPsec
A: Dispositivo
Servicio: HTTPS
● Asignar (solo para S615)
Para asignar las reglas IP al conjunto de reglas seleccionado, active el ajuste en las reglas
IP deseadas y haga clic en el botón "Aplicar ajustes".
● Asignado (solo para S615)
Indica qué conjunto de reglas está asignado a esta regla IP. También es posible asignar las
reglas IP a varios conjuntos de reglas. Si la regla IP está asignada a todos los conjuntos de
reglas, se muestra "all".
● Denominación (solo para S615)
Indica quién ha creado la regla IP.
– NETMAP - Regla de cortafuegos creada automáticamente

IPsec VPN
Sinopsis
En "Seguridad > IPsec VPN" se pueden configurar los parámetros para establecer conexiones
IPsec manualmente.

Configuración alternativa a través de grupos VPN
También es posible configurar las conexiones IPsec a través de grupos VPN, consulte el
capítulo AUTOHOTSPOT. En la configuración a través de grupos VPN STEP 7 determina las
direcciones remotas y las subredes remotas a partir del nombre de interfaz:
● Nombre de interfaz "INT": STEP 7 trata la interfaz como interfaz interna.
● Nombre de interfaz "EXT": STEP 7 trata la interfaz como interfaz externa.
Al agregar dispositivos en grupos VPN STEP 7 solo crea conexiones VPN entre las interfaces
externas. De ese modo solo las subredes locales de las interfaces internas se conectan entre
sí a través de VPN. Las conexiones VPN adicionales deben configurarse manualmente.

730

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Particularidades de la configuración a través de grupos VPN
En comparación con dispositivos SCALANCE S-600 V3 rigen las siguientes particularidades:
● El permiso para iniciar el establecimiento de la conexión se define en la asignación a grupos
VPN.
● En los ajustes VPN específicos de conexión el dispositivo no se muestra editable como
interlocutor. Al seleccionar el dispositivo puede adaptarse la interfaz de otros dispositivos
interlocutores.
● Respecto al modo de funcionamiento VPN, el dispositivo se comporta siempre como
dispositivo routing.
● Las propiedades de un grupo VPN se aplican en las propiedades locales de dispositivos de
grupos VPN. Las propiedades de un grupo VPN pueden sobrescribirse localmente en
referencia a los siguientes parámetros:
– Fase 1: Intentos de keying, DPD, periodo DPD, timeout DPD
– Fase 2: Bytes de vida, protocolo, puerto (rango), reglas de cortafuegos automáticas

General
En esta página se configuran los ajustes básicos para VPN.

Descripción
La página contiene lo siguiente:
● Activar VPN IPsec
Active o desactive el procedimiento IPsec para VPN.
● Aplicar estrictamente directiva CRL
Si está activado, la validez del certificado se comprueba mediante la lista de revocación de
certificados (CRL - Certificate Revocation List). La lista de revocación de certificados
contiene los certificados emitidos por la autoridad de certificación que han perdido su
validez antes de la fecha de caducidad establecida. En la página "Certificados
(Página 719)" se configura la lista de revocación de certificados que se utilizará.
● NAT Intervalo de tiempo Keep Alive
Especifique con qué intervalos de tiempo deben enviarse los telegramas de señal de vida
(keep alive). Si hay un dispositivo NAT entre dos puntos finales VPN, en caso de inactividad
se borrará la conexión de su tabla NAT dinámica. Para impedirlo se envían telegramas de
señal de vida.

Punto final remoto
En esta página se configura el interlocutor (punto final VPN)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

731

Configuración de dispositivos y redes
1.3 Configurar redes

Descripción
La página contiene lo siguiente:
● Nombre de punto final remoto
Introduzca un nombre para el interlocutor y haga clic en "Nueva entrada" para crear un
nuevo interlocutor.
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre del interlocutor.
● Modo remoto
Especifique qué función asumirán los interlocutores.
– Roadwarrior
Se registran los interlocutores (dirección remota) accesibles. El interlocutor aprende a
qué subredes remotas es posible acceder.
– Standard
El interlocutor accesible (dirección remota) y las subredes remotas accesibles se
registran con carácter fijo.
● Tipo remoto
Defina el tipo de dirección del interlocutor.
– Manual
La dirección del interlocutor es conocida. El dispositivo puede establecer la conexión
VPN activamente en calidad de cliente VPN o bien esperar pasivamente el
establecimiento de la conexión por parte del interlocutor.
– Cualquiera
Acepta la conexión con interlocutores con cualquier dirección IP. El dispositivo
únicamente espera conexiones VPN y no puede crear un túnel VPN como interlocutor
activo.
● Dirección remota
Solo puede editarse con el tipo remoto "Manual"
– En el modo estándar introduzca la dirección IP WAN o el nombre de host DDNS del
interlocutor. La máscara de red es siempre /32.
– En el modo Roadwarrior es posible predefinir la dirección del interlocutor o introducir un
rango IP del que se aceptarán conexiones.
● Subred remota
– En el modo estándar introduzca la subred accesible del interlocutor. Utilice la notación
CIDR.
Solo es posible utilizar varias subredes con IKv2. En este caso, introduzca las subredes
separadas por coma.
– En el modo Roadwarrior el interlocutor comunica al dispositivo sus subredes accesibles,
y el dispositivo las aprende.

732

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Modo IP virtual
Especifique si al interlocutor se le ofrecerá una dirección IP virtual.
Existen las siguientes posibilidades:
– IPv4 pesonalizada
La dirección IP virtual pertenece a la banda definida en "IP virtual".
– Ninguna
Ninguna dirección IP virtual. El túnel VPN se establece dinámicamente con la dirección
IP interna del interlocutor.
● IP virtual
Defina la subred (CIDR) desde la que se ofrece al interlocutor una dirección IP virtual.
Solo puede editarse si en "Modo IP virtual" se ha seleccionado "IPv4 personalizada".

Conexiones
En esta página se configuran los ajustes básicos para la conexión VPN. Estos ajustes permiten
al dispositivo (punto final local) crear un túnel VPN seguro con el interlocutor. Los ajustes de
seguridad se definen en la página "Autenticación" del WBM.
Nota
Si se utiliza "NETMAP",
● solo se soportarán reglas de cortafuegos automáticas.
● Con "Modo de operación" no puede seleccionarse el ajuste "Sobre demanda".
Nota
Varias conexiones IPsec VPN a través del mismo punto final VPN
Si ha creado conexiones IPsec VPN con diferentes subredes remotas a través del mismo
punto final VPN, la primera conexión VPN configurada (índice más bajo) será la conexión
principal (Parent).
A través de la conexión principal se crean y establecen todas las conexiones IPsec VPN
restantes (Child). Una vez que se han establecido todos los túneles VPN y la conexión principal
ha concluido se interrumpen todas las conexiones Child. Cuando transcurre el timeout DPD se
vuelven a establecer todas las conexiones IPsec VPN de nuevo a través de la conexión
principal.
Si solo concluye una conexión Child, la conexión principal y todas las conexiones Child
restantes se conservan.

Descripción
La página contiene los siguientes campos:
● Nombre de la conexión
Introduzca un nombre para la conexión VPN y haga clic en "Crear" para crear la nueva
conexión.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

733

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla contiene las siguientes columnas:
● Seleccionar
Active la casilla de verificación correspondiente a la fila que desea borrar.
● Nombre
Muestra el nombre de la conexión VPN.
● Modo de operación
Defina el interlocutor desde el que se establece la conexión VPN.
– Desactivada
La conexión VPN está desactivada.
– Iniciar
El dispositivo intenta establecer una conexión VPN con el interlocutor.
– Esperar
El dispositivo espera hasta que el interlocutor inicie el establecimiento de la conexión.
– Sobre demanda
La conexión VPN se establece discrecionalmente.
– Iniciar con DI
Al producirse el evento "Entrada digital", el dispositivo intenta establecer una conexión
VPN con el interlocutor.
Es imprescindible que el evento "Entrada digital" se reenvíe a la conexión VPN. Para
ello, al producirse el evento "Entrada digital" active "Túnel VPN" en "Sistema > Eventos
> Configuración".
– Esperar a DI
Al producirse el evento "Entrada digital", el dispositivo espera hasta que el interlocutor
inicie el establecimiento de la conexión.
Es imprescindible que el evento "Entrada digital" se reenvíe a la conexión VPN. Para
ello, al producirse el evento "Entrada digital" active "Túnel VPN" en "Sistema > Eventos
> Configuración".
● Keying Protocol
Especifique si debe utilizarse IKEv2 o IKEv1.
● Punto final remoto
Seleccione el interlocutor deseado. Solo pueden elegirse aquellos interlocutores que se
han configurado en la página "Punto final remoto" del WBM.
● Subred local
Introduzca la subred local. Utilice la notación CIDR. La red local también puede ser un solo
PC u otra subcantidad de la red local.
● Solicitar IP virtual
Si está activado, al establecer la conexión se solicitará una dirección IP virtual al
interlocutor.
● Timeout [s]
Solo es necesario con el ajuste "A petición". Introduzca el intervalo de tiempo tras el cual se
desconectará VPN. Si no se envía ningún paquete dentro de este tiempo, la conexión VPN
se deshace automáticamente.

734

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Autenticación
En esta página se define cómo se autentican recíprocamente los interlocutores de conexión
VPN.

Descripción
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre de la conexión VPN a la que se refieren los ajustes.
● Autenticación
Seleccione el método de autenticación. Para la conexión VPN es imprescindible que el
interlocutor utilice el mismo procedimiento de autenticación.
– Desactivado
No hay seleccionado ningún método de autenticación. No es posible establecer la
conexión.
– Cert. remoto
Para la autenticación se utiliza el certificado del interlocutor. El certificado se define en
"Certificado remoto".
– Cert. CA
Para la autenticación se utiliza el certificado de la entidad de certificación. El certificado
se define en "Certificado CA". Para establecer una conexión IPsec con SINEMA RC es
necesario agregar el certificado a posteriori a través de WBM y cargarlo en el dispositivo.
– PSK
Para la autenticación se utiliza una clave. La clave se configura en "PSK".
● Certificado CA
Seleccione el certificado. Solo pueden seleccionarse certificados cargados.
● Certificado local
Seleccione el certificado de dispositivo. Solo pueden seleccionarse los certificados de
dispositivo generados por el TIA Portal.
● ID local
Introduzca el ID local procedente del certificado del interlocutor. El campo solo puede
dejarse vacío si se utiliza el certificado del interlocutor. El campo se llena automáticamente
con el valor del certificado del interlocutor.
● Certificado remoto
Seleccione el certificado del interlocutor. Solo pueden seleccionarse los certificados de
interlocutor por el TIA Portal.
● ID remoto
Introduzca el "Distinguished Name" o el "Alternate Name" incluido en el certificado del
interlocutor. El campo solo puede dejarse vacío si se utiliza el certificado del interlocutor. El
campo se llena automáticamente con el valor del certificado del interlocutor.
● PSK
Introduzca la clave.
● Confirmar clave
Repita la clave.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

735

Configuración de dispositivos y redes
1.3 Configurar redes

Fase 1
Fase 1: acuerdo de encriptado y autenticación (IKE = Internet Key Exchange)
En esta página se ajustan los parámetros para el protocolo de la gestión de claves IPsec. El
cambio de código se produce conforme al método estandarizado IKE, para el que se pueden
ajustar los siguientes parámetros de protocolo.

Descripción
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre de la conexión VPN a la que se refieren los ajustes.
● Cifra predeterminada
Si está activado, al establecerse la conexión se transmite al interlocutor de la conexión VPN
una lista predeterminada. La lista incluye combinaciones de los tres algoritmos (Encryption,
Authentication, Key Derivation). Para establecer una conexión VPN el interlocutor de la
conexión VPN debe soportar al menos una de dichas combinaciones. La selección
depende del método de intercambio de claves. Obtendrá más información al respecto en el
capítulo "VPN IPsec".
● Encriptación
Seleccione el algoritmo de encriptación deseado para la fase 1. Solo puede seleccionarse
si "Cifra predeterminada" está desactivado.
La selección depende del método de intercambio de claves. Obtendrá más información al
respecto en el capítulo "VPN IPsec".
Nota
Los modos AES CCM y GCM incluyen mecanismos separados para la autenticación de
datos. Si en "Encriptación" se utiliza un modo AES x CCM, también se utilizará para la
autenticación. Entonces, del parámetro "Autenticación" solo se derivará el modo de
funcionamiento pseudoaleatorio. Para establecer una conexión VPN es necesario que
todos los dispositivos utilicen los mismos ajustes.
● Autenticación
Defina el método para calcular la suma de verificación. Solo puede seleccionarse si "Cifra
predeterminada" está desactivado.
Se soportan los siguientes métodos:
– MD5
– SHA1
– SHA512
– SHA256
– SHA384

736

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Derivación de claves
Seleccione el grupo Diffie-Hellmann (DH) desde el que desea que se genere una clave.
Solo puede seleccionarse si "Cifra predeterminada" está desactivado.
Se soportan los siguientes grupos DH:
– DH Group 1
– DH Group 2
– DH Group 5
– DH Group 14
– DH Group 15
– DH Group 16
– DH Group 17
– DH Group 18
● Intentos de keying
Introduzca el número de repetición de intentos al fallar el establecimiento de una conexión.
Si se introduce el valor 0 se intentará establecer la conexión infinitamente.
● Duración [min]
Introduzca un periodo de tiempo en minutos que defina la vida útil de la autenticación. Una
vez transcurrido este tiempo, los puntos finales VPN participantes deben autenticarse
recíprocamente de nuevo y generar una clave nueva.
● DPD
Si está activado se utilizará DPD (Dead Peer Detection). DPD permite constatar si continúa
existiendo la conexión VPN o si se ha interrumpido.
Nota
El envío de consultas DPD provoca un aumento del número de datos enviados y recibidos.
Esto puede aumentar los costes.
● Período DPD [s]
Introduzca un intervalo de tiempo tras el cual se enviarán consultas DPD. Dichas consultas
comprueban si el interlocutor sigue disponible.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

737

Configuración de dispositivos y redes
1.3 Configurar redes
● Timeout DPD [s]
Introduzca un intervalo de tiempo. Si no se recibe respuesta alguna a las consultas DPD,
una vez pasado este tiempo se considera que la conexión con el interlocutor no es válida.
Nota
Para evitar cancelaciones de conexiones no deseadas, ajuste un timeout DPD
considerablemente más alto que el período DPD. Recomendamos un mínimo de 2 minutos
más que el período DPD.
● Aggressive Mode
– Desactivado:
se utiliza Main Mode.
– Activado
se utiliza Aggressive Mode.
La diferencia entre la modalidad Main y Aggressive es la "Identity-Protection" que se utiliza
en el Main Mode. La identidad se transfiere codificada en el Main Mode, en el Aggressive
Mode no.

Fase 2
Fase 2: intercambio de datos (ESP = Encapsulating Security Payload)
En esta página se definen los parámetros para el protocolo del intercambio de datos IPsec.
Toda la comunicación que se produce en esta fase está encriptada a través del protocolo de
seguridad estandarizado ESP, para el que pueden ajustarse los siguientes parámetros:

Descripción
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre de la conexión VPN a la que se refieren los ajustes.
● Cifra predeterminada
Si está activado, al establecerse la conexión se transmite al interlocutor de la conexión VPN
una lista predeterminada. La lista incluye combinaciones de los tres algoritmos (Encryption,
Authentication, Key Derivation). Para establecer una conexión VPN el interlocutor de la
conexión VPN debe soportar al menos una de dichas combinaciones. Obtendrá más
información al respecto en el capítulo "VPN IPsec".

738

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Encriptación
Seleccione el algoritmo de encriptación deseado para la fase 2. Solo puede seleccionarse
si "Cifra predeterminada" está desactivado.
Obtendrá más información al respecto en el capítulo "VPN IPsec".
Nota
Los modos AES CCM y GCM incluyen mecanismos separados para la autenticación de
datos. Si en "Encriptación" se utiliza un modo AES x CCM o AES x GCM, también se
utilizará para la autenticación. Entonces, del parámetro "Autenticación" solo se derivará el
modo de funcionamiento pseudoaleatorio.
● Autenticación
Defina el método para calcular la suma de verificación. Solo puede seleccionarse si "Cifra
predeterminada" está desactivado.
Se soportan los siguientes métodos:
– MD5
– SHA1
– SHA512
– SHA256
– SHA384
● Derivación de claves
Seleccione el grupo Diffie-Hellmann (DH) desde el que desea que se genere una clave.
Solo puede seleccionarse si "Cifra predeterminada" está desactivado.
Se soportan los siguientes grupos DH:
– None: para la fase 2 no se intercambia ninguna clave separada. Por tanto está
desactivado Perfect Forward Secrecy (PFS).
– DH Group 1
– DH Group 2
– DH Group 5
– DH Group 14
– DH Group 15
– DH Group 16
– DH Group 17
– DH Group 18
Nota
Para establecer una conexión VPN es necesario que todos los dispositivos utilicen los
mismos ajustes o que ofrezcan métodos de encriptación compatibles.
● Duración [min]
Introduzca un periodo de tiempo en minutos que defina la vida útil de la clave pactada. Una
vez transcurrido ese tiempo se negocia de nuevo la clave.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

739

Configuración de dispositivos y redes
1.3 Configurar redes
● Lifebytes
Introduzca el límite de datos en bytes que define la vida útil de la clave pactada. Una vez
transcurrido ese límite de datos se negocia de nuevo la clave.
● Protocolo
Defina para qué protocolo es válida la conexión VPN, p. ej. UDP, TCP, ICMP. Si el ajuste
debe regir para todos los protocolos, introduzca "*".
● Puerto (rango)
Defina el puerto a través del que se puede comunicar el túnel VPN. El ajuste es válido
exactamente para el puerto indicado.
– Si el ajuste debe ser válido para un rango de puertos, indique el rango introduciendo el
puerto de origen seguido de "-" y después el puerto de destino, p. ej. 30 - 40.
– Si el ajuste debe regir para todos los puertos, introduzca "*".
Este ajuste solo afecta a protocolos basados en puertos.
● Reglas de cortafuegos automáticas
– activado
Las reglas de cortafuegos se crean automáticamente para la conexión VPN tanto para
el acceso de "externa" a "interna" como al revés. En "Seguridad > Cortafuegos > Reglas
IPv4 predefinidas" existe la posibilidad de permitir el acceso a determinados servicios
del dispositivo. En el ajuste predeterminado, el ping está habilitado.
– desactivado
El usuario debe crear las reglas de cortafuegos.

OpenVPN
General
En esta página se activa el cliente OpenVPN.

Descripción
La página contiene lo siguiente:
● Activar OpenVPN
Active o desactive el cliente OpenVPN.

Conexiones
En esta página se configuran los ajustes básicos para la conexión OpenVPN. Los ajustes de
seguridad se definen en la página "Autenticación" del WBM.

Descripción
● Nombre de la conexión
Introduzca un nombre unívoco para la conexión OpenVPN y haga clic en "Crear" para crear
una conexión nueva.

740

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
La tabla contiene las siguientes columnas:
● Seleccionar
Active la casilla de verificación correspondiente a la fila que desea borrar.
● Nombre
Indica el nombre de la conexión OpenVPN.
● Modo de operación
Especifique cómo debe establecerse la conexión. Encontrará más información al respecto
en "Establecimiento de conexión VPN".
– Iniciar
El dispositivo intenta establecer una conexión VPN con el interlocutor.
– Iniciar con DI
Al producirse el evento "Entrada digital", el dispositivo intenta establecer una conexión
VPN con el interlocutor.
Es imprescindible que el evento "Entrada digital" se reenvíe a la conexión VPN. Para
ello, al producirse el evento "Entrada digital" active "Túnel VPN" en "Sistema > Eventos
> Configuración".
– Desactivada
La conexión VPN está desactivada.
● Encriptación
Seleccione el algoritmo de encriptación deseado.
– AES-128-CBC (predeterminado)
– AES-192-CBC
– AES-256-CBC
– DES-EDE3
– BF-CBC
● Autenticación
Defina el método para calcular la suma de verificación.
– SHA256 (predeterminado)
– SHA384
– SHA512
– SHA224
– SHA1
– MD5

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

741

Configuración de dispositivos y redes
1.3 Configurar redes
● Comp. LZO
– Desactivado (-)
La compresión está desactivada. El servidor no puede volver a activar la compresión.
– No
La compresión está desactivada por defecto. El servidor puede activar la compresión
– Sí
La compresión está activada por defecto. El servidor puede desactivar la compresión
– adaptive
La compresión se activa adaptativamente por defecto. Solo se comprime si los datos
pueden comprimirse bien, de lo contrario la compresión se desactiva durante un tiempo
determinado.
● Reglas de cortafuegos automáticas
– Activado
Se crean automáticamente las reglas de cortafuegos para la conexión VPN.
– Desactivado
El usuario debe crear las reglas de cortafuegos adecuadas.
● Activar NAT
Con este ajuste se activa el enmascaramiento automático de IP para la interfaz. No es
posible acceder a los dispositivos locales directamente desde el exterior, solo puede
accederse a través de la dirección IP de la interfaz. Sin embargo, los dispositivos locales
pueden conectarse con los dispositivos pospuestos al servidor OpenVPN Encontrará más
información sobre NAT en "NAT".

Remoto
En esta página se configura el interlocutor (punto final OpenVPN) Por cada conexión es
posible definir varios interlocutores OpenVPN. El dispositivo prueba por orden todos los
interlocutores OpenVPN configurados hasta que una conexión se establece correctamente.

Descripción
La página contiene lo siguiente:
● Nombre remoto
Introduzca un nombre para el interlocutor OpenVPN.
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre del interlocutor OpenVPN.
● Conexión
Seleccione la conexión correspondiente. Solo pueden configurarse las conexiones que se
han configurado en la página "Conexiones".
● Dirección remota
Introduzca la dirección IP WAN o el nombre de host DNS del interlocutor OpenVPN.

742

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
● Puerto
Defina el puerto a través del que se puede comunicar el túnel OpenVPN. El ajuste es válido
exactamente para el puerto indicado.
● Protocolo
Defina para qué protocolo va a utilizarse la conexión OpenVPN.

Autenticación
En esta página se define cómo se autentican recíprocamente los interlocutores de conexión
VPN.

Descripción
La tabla contiene las siguientes columnas:
● Nombre
Indica el nombre de la conexión VPN a la que se refieren los ajustes.
● Método
Seleccione el método de autenticación. Para la conexión VPN es imprescindible que el
interlocutor utilice el mismo procedimiento de autenticación.
– Desactivada
No hay seleccionado ningún método de autenticación. No es posible establecer la
conexión.
– Certificados
Para la autenticación se utilizan certificados. Tales certificados deben agregarse a
posteriori a través de WBM y cargarse en el dispositivo.
– Nombre de usuario/Contraseña
Para la autenticación se utilizan nombre de usuario y contraseña. El certificado debe
agregarse a posteriori a través de WBM y cargarse en el dispositivo.
● Certificado CA
Seleccione el certificado CA a través de WBM y cárguelo en el dispositivo.
● Certificado de dispositivo
Seleccione el certificado de dispositivo a través de WBM y cárguelo en el dispositivo.
● Nombre de usuario
Indique el nombre de usuario.
● Contraseña
Indique la contraseña.
● Confirmar contraseña
Confirme la contraseña.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

743

Configuración de dispositivos y redes
1.3 Configurar redes

1.3.5

Secure communication

1.3.5.1

Principios básicos de secure communication

Principios básicos de secure communication
Para STEP 7 (TIA Portal) a partir de V14 y para las CPU S7-1500 a partir de la versión de
firmware V2.0 se han ampliado considerablemente las posibilidades de una comunicación
segura, denominada en adelante "secure communication".
"CPU S7-1500" incluye también las variantes de CPU S7-1500F, S7-1500T, S7-1500C y las
CPU S7-1500pro y las CPU ET200SP.

Introducción
El atributo "secure" se utiliza para marcar mecanismos de comunicación basados en una
Public Key Infrastructure (PKI), p. ej. RFC 5280 para Internet X.509 Public Key Infrastructure
Certificate and Certificate Revocation List Profile. Public Key Infrastructure (PKI) es un sistema
que permite emitir, asignar y comprobar certificados digitales. Los certificados digitales
emitidos se utilizan dentro de PKI para garantizar la comunicación asistida por ordenador. Si
una PKI utiliza un procedimiento de claves asimétrico, en una red los mensajes se pueden
firmar y cifrar digitalmente.
Los componentes que se han configurado para la secure communication en STEP 7
(TIA Portal) utilizan un procedimiento de claves asimétrico con clave pública (Public Key) y
clave privada (Private Key). Se utiliza el protocolo de cifrado TLS (Transport Layer Security).
TLS es el sucesor del protocolo SSL (Secure Sockets Layer).

Objetivos de la secure communication
La secure communication se aplica para lograr los siguientes objetivos:
● Confidencialidad
es decir, los datos son secretos o ilegibles para fisgones no autorizados.
● Integridad
es decir, un mensaje que llega al destinatario es el mismo, sin cambios, que ha enviado el
emisor. El mensaje no ha sido modificado durante su trayecto.
● Autenticación del punto final
es decir, el interlocutor como punto final es exactamente quien dice ser y a quien debe llegar
el mensaje. La identidad del interlocutor está comprobada.
Si en el pasado estos objetivos tenían importancia fundamentalmente para el mundo de las TI
y para las computadoras conectadas en red, en la actualidad en entornos industriales las
máquinas y controladores que contienen datos que precisan protección están expuestos a
riesgos debido a su interconexión y plantean requisitos exigentes de intercambio seguro de
datos.
Hasta ahora lo más habitual es, y sigue siendo, proteger la célula de automatización mediante
el concepto de protección de células a través de firewall o a través de conexión VPN, p. ej., con
el Security Module.

744

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Sin embargo, las necesidades de comunicación incluyen también cada vez más la transmisión
de datos a equipos externos en forma cifrada a través de Intranet o redes públicas.

Principios básicos comunes de la secure communication
Independientemente del contexto, Secure Communication se basa en el concepto de Public
Key Infrastructure (PKI) y contiene los siguientes componentes:
● Un procedimiento de cifrado asimétrico. Este procedimiento permite lo siguiente:
– Cifrado o descifrado de mensajes utilizando claves públicas o privadas.
– Comprobación de firmas en mensajes y certificados.
Los mensajes/certificados son firmados por el emisor/titular del certificado mediante su
clave privada. El receptor/validador comprueba la firma con la clave pública del emisor/
titular del certificado.
● Transporte y almacenamiento de las claves públicas mediante certificados X.509:
– Los certificados X.509 son datos con firma digital que permiten comprobar la
autenticidad de claves públicas en lo que respecta a la identidad asociada.
– Los certificados X.509 pueden contener información que caracteriza con más precisión
o limita el uso de claves públicas. Por ejemplo, desde cuándo una clave pública es válida
en un certificado y desde cuándo no es válida.
– Los certificados X.509 contienen, protegida, la información relativa al emisor del
certificado.
Las explicaciones que siguen muestran una visión general de los conceptos básicos que son
necesarios, p. ej., para manejar certificados en STEP 7 (TIA Portal) o para programar las
instrucciones de comunicación para secure Open User Communication (sOUC).

Secure communication en STEP 7
STEP 7 a partir de V14 proporciona la PKI necesaria en cada momento para la configuración
y el manejo de una secure communication.
Ejemplos:
● El Hypertext Transfer Protokoll (HTTP) se convierte mediante el protocolo TLS (Transport
Layer Security) en un Hypertext Transfer Protokoll Secure (HTTPS). Dado que HTTPS es
una combinación de HTTP y TLS, se denomina "HTTP over TLS" en el correspondiente
RFC. En el navegador, el uso de HTTPS se reconoce porque en la barra de direcciones se
utiliza el esquema URL "https://" en vez de "http://". La mayoría de los navegadores destaca
también visualmente la conexión segura proporcionada.
● Open User Communication se convierte en secure Open User Communication. El protocolo
base sigue siendo TLS.
● Los proveedores de correo electrónico también ofrecen acceso a través del protocolo
"Secure SMTP over TLS", con el fin de aumentar la seguridad de la comunicación por
correo electrónico.
La figura siguiente muestra el protocolo TLS en el contexto de las capas de comunicación.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

745

Configuración de dispositivos y redes
1.3 Configurar redes
3/&SURJUDP
2SHQXVHUFRPPXQLFDWLRQ
7B6(1'

7B5&9



6HVVLRQ/D\HU 
7UDQVSRUW/D\HU 
1HWZRUN/D\HU 
'DWD/LQN/D\HU 
3K\VLFDO/D\HU 

28&

+7736

6HFXUH28&

:HEVHUYHU

+773

$SSOLFDWLRQ/D\HU 

7B&21

7/6
7&38'3
,3Y
(WKHUQHW

Secure communication en OPC UA
En las CPU S7-1500, a partir de la versión de firmware V2.0 hay implementado un servidor
OPC UA. OPC UA Security también comprende autenticación, cifrado e integridad de datos
mediante certificados digitales X.509 y también utiliza una Public Key Infrastructure (PKI). En
función de los requisitos de la aplicación, es posible elegir distintos niveles de seguridad para
la seguridad de puntos finales. A la descripción de la funcionalidad del servidor OPC UA se
dedica un capítulo específico.

Consulte también
Posibilidades de ajuste para funciones de seguridad (Página 1077)

Confidencialidad por cifrado
Una contribución importante a la seguridad de los datos es el cifrado de los mensajes. Si un
tercero intercepta mensajes cifrados en su trayecto, el fisgón potencial no podrá utilizar los
mensajes interceptados.
Existe un gran número de procedimientos matemáticos (algoritmos) para cifrar mensajes.
Todos los algoritmos tienen en común que procesan un parámetro "clave" para cifrar o
descifrar mensajes.
● Algoritmo + clave + mensaje => mensaje cifrado
● Mensaje cifrado + clave + algoritmo => mensaje (descifrado)

746

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Cifrado simétrico
Lo esencial del procedimiento de cifrado simétrico es que los dos interlocutores utilizan la
misma clave para cifrar y para descifrar mensajes, como se representa en la figura siguiente:
Bob utiliza la misma clave para cifrar que la que utiliza Alice para descifrar. En general puede
decirse que ambas partes comparten como secreto la clave secreta con la que pueden cifrar
o descifrar un mensaje.





%RE

①
②

$OLFH

Bob cifra su mensaje con la clave simétrica
Alice descifra el mensaje cifrado utilizando la clave simétrica

Intuitivamente el procedimiento es comparable a un maletín del que tanto el emisor como el
receptor tienen una llave igual que les permite cerrarlo o abrirlo.
● Ventaja: Los algoritmos de cifrado simétricos (p. ej. AES, Advanced Encryption Algorithm)
son rápidos.
● Desventajas: ¿Cómo puede llegar a un receptor una clave sin que caiga en manos
equivocadas? Esto supone un problema de distribución de claves. Además, la intercepción
de un número suficientemente grande de mensajes permite adivinar la clave, por lo que la
misma debe acordarse de nuevo con una frecuencia razonable.
Además, con un gran número de interlocutores debe distribuirse también un gran número de
claves.

Cifrado asimétrico
El procedimiento de cifrado asimétrico trabaja con una pareja de claves, compuesta por una
clave pública y una clave privada. En relación con una PKI también se denomina
procedimiento Public-Key o simplemente procedimiento PKI: un interlocutor (en la figura de
más abajo, Alice) posee una clave privada y una clave pública. La clave pública está a
disposición de todo el mundo, es decir, de cualquier potencial interlocutor. Cualquiera que
tenga la clave pública puede cifrar mensajes para Alice. En la figura de más abajo esa persona
es Bob.
Alice utiliza su clave privada, que debe mantener en secreto, para descifrar un mensaje cifrado
dirigido a ella.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

747

Configuración de dispositivos y redes
1.3 Configurar redes


&ODYHS¼EOLFD
&ODYHSULYDGD





%RE

①
②
③

$OLFH

Alice proporciona su clave pública a Bob. Para ello no se necesitan medidas de precaución:
cualquiera puede utilizar la clave pública para enviar mensajes a Alice si está seguro de que es
realmente la clave pública de Alice.
Bob cifra su mensaje con la clave pública de Alice.
Alice descifra con su clave privada el mensaje cifrado por Bob. Dado que Alice es la única que
posee la clave privada y nunca la entrega a nadie, es la única que puede descifrar el mensaje.
Con la clave privada puede descifrar cualquier mensaje que se haya cifrado con su propia clave
pública, no solo el cifrado por Bob.

Plásticamente, el procedimiento es comparable a un buzón en el que cualquiera puede
introducir un mensaje, pero del que únicamente puede extraerlo quien posea su llave.
● Ventajas: un mensaje cifrado con clave pública solo puede ser descifrado por el propietario
de la clave privada. Dado que para el descifrado debe utilizarse otra clave (privada), es
considerablemente más difícil adivinar la clave de descifrado a partir del conjunto de
mensajes descifrados. Por ello no es necesario custodiar en estricto secreto las claves
públicas, algo que sí es necesario en el cifrado simétrico.
Otra ventaja estriba en la mayor sencillez de distribución de las claves públicas. En el
procedimiento asimétrico no se necesita ningún canal especialmente seguro para
transmitir la clave pública del receptor al emisor que cifra los mensajes. Por tanto, la
administración de las claves exige menos esfuerzo que en el procedimiento de cifrado
simétrico.
● Desventajas: algoritmo que precisa muchos cálculos (p. ej. RSA, acrónimo de los tres
matemáticos Rivest, Shamir y Adleman) y, por tanto, menor rendimiento en comparación
con el cifrado simétrico.

Procedimiento de cifrado en la práctica
En la práctica, como ocurre, p. ej., con el servidor web de la CPU o con Secure Open User
Communication, se utiliza el protocolo TLS por debajo de la correspondiente capa de
aplicación. Ejemplos de capas de aplicación son HTTP o SMTP, como se muestra en el
apartado anterior.
TLS (Transport Layer Security) utiliza una combinación de cifrado asimétrico y cifrado
simétrico (procedimiento de cifrado híbrido) para la transferencia de datos segura, p. ej. en
Internet, y utiliza los protocolos siguientes:
● TLS Handshake Protocol, responsable de la autenticación de los interlocutores y de
negociar los algoritmos y las claves que se utilizarán posteriormente para la transferencia
de datos, basándose en procedimientos de cifrado asimétrico.
● TLS Record Protocol, responsable del cifrado de los datos de usuario mediante
procedimientos de cifrado simétrico e intercambio de datos.

748

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Tanto el cifrado asimétrico como el simétrico se consideran procedimientos de cifrado seguros
(básicamente no existe diferencia entre ambos procedimientos en cuanto a seguridad). El
grado de seguridad depende de los parámetros, p. ej., de la longitud de la clave seleccionada.

Abuso del cifrado
Una clave pública es una secuencia de bits que no revela la identidad que tiene asignada. Un
impostor podría pretender proporcionar su clave pública y hacerse pasar por otra persona. Si
un tercero utilizara esa clave creyendo dirigirse al interlocutor deseado, la información
confidencial podría acabar en manos del impostor. Entonces el impostor descifraría con su
clave privada el mensaje que no estaba destinado a él, y la información confidencial acabaría
cayendo en manos equivocadas.
Para evitar estos abusos es necesario crear en los interlocutores la confianza de que están
tratando con el interlocutor deseado. Para establecer dicha confianza, en una PKI se utilizan
certificados digitales.

Autenticidad e integridad mediante firmas
Los ataques de programas que interceptan la comunicación entre servidor y cliente y que
actúan como si ellos mismos fueran el cliente o el servidor, se conocen con el nombre de
ataques "man in the middle". Si no se detecta la falsa identidad de estos programas, los
mismos pueden, p. ej., obtener información importante sobre el programa S7 o activar valores
en la CPU, atacando así a una máquina o a las instalaciones. Para prevenir este tipo de
ataques se utilizan certificados digitales.
Secure communication utiliza certificados digitales acordes con el estándar X.509 de la
International Telecommunication Union (ITU). De este modo es posible comprobar (autenticar)
la identidad de un programa, un equipo o una organización.

Cómo crean confianza los certificados
La misión fundamental de los certificados X.509 es vincular una identidad que incluye los datos
del propietario de un certificado (p. ej. dirección de correo electrónico, nombre del equipo) con
la clave pública de la identidad. Las identidades pueden ser personas, equipos o máquinas.
Los certificados son emitidos por la entidad emisora (Certificate Authority, CA) o por el propio
titular del certificado. Los sistemas PKI definen cómo tienen que depositar los usuarios su
confianza en las entidades emisoras y en los certificados expedidos por las mismas.
El camino hasta el certificado:
1. Quien desea obtener un certificado, presenta una petición a través de una oficina de
registro adherida a la entidad emisora.
2. La entidad emisora evalúa la petición y al solicitante, aplicando criterios definidos.
3. Si la identidad del solicitante puede determinarse inequívocamente, la entidad emisora
certifica dicha identidad expidiendo un certificado firmado. El solicitante se convierte
entonces en titular del certificado.
En la figura siguiente se representa de manera simplificada el procedimiento. No se muestra
la posibilidad que tiene Alice de comprobar la firma digital.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

749

Configuración de dispositivos y redes
1.3 Configurar redes
7ZHQW &$ FHUWLILFDFRQVXILUPD
TXHGLFKDFODYHS¼EOLFDSHUWHQHFH
D%RE/RKDFRPSUREDGR

7ZHQW &$

&$

%RE

$OLFHFRQI¯DHQ7ZHQW
ODHQWLGDGHPLVRUD &$

$OLFHUHFRJHGH%REODFODYHS¼EOLFDILUPDGD
SRU7ZHQW6LFRQI¯DHQ7ZHQWSXHGHFRQILDU
HQTXHGLFKDFODYHS¼EOLFDSHUWHQHFH
UHDOPHQWHD%RE

$OLFH

Certificados autofirmados
Los certificados autofirmados son certificados cuya firma procede del titular del certificado, no
de una entidad emisora independiente.
Ejemplos:
● Se puede crear y autofirmar un certificado, por ejemplo para cifrar mensajes para un
interlocutor. En el ejemplo de arriba, el propio Bob (en vez de Twent) podría firmar su
certificado con su clave privada. Utilizando la clave pública de Bob, Alice puede comprobar
que la firma y la clave pública de Bob coinciden. Esto es suficiente para una comunicación
sencilla que debe desarrollarse cifrada dentro de una instalación.
● Un certificado raíz es, p. ej., un certificado autofirmado por la entidad de certificación
(emisora), que incluye la clave pública de la entidad de certificación.

Particularidades de los certificados autofirmados
Los atributos "CN" (Common Name of Subject) para el titular del certificado e "Issuer" (emisor)
de certificados autofirmados son idénticos: el titular ha autofirmado su certificado. En el campo
"CA" (Certificate Autority) para la entidad emisora debe poner "False", dado que el certificado
autofirmado no va a utilizarse para firmar otros certificados.
Los certificados autofirmados no están incluidos en una jerarquía PKI.

Contenido de los certificados
Un certificado según el estándar X.509 V3, el que utilizan STEP 7 y las CPU S7-1500, consta
esencialmente de los componentes siguientes:
● Clave pública
● Datos sobre el titular del certificado (es decir, el usuario de la clave); puede ser, p. ej., el
Common Name (CN) of Subject
● Atributos como el número de serie y la vigencia
● Firma digital (certificación) de la entidad emisora (CA), que certifica que los datos coinciden.

750

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Además existen ampliaciones, p. ej.
● Indicación de la finalidad para la que se permite usar la clave pública (Key Usage), p. ej.
para firmar o para cifrar claves.
Si se crea un certificado nuevo con STEP 7, p. ej. en el contexto de Secure Open User
Communication, seleccione en la lista de finalidades posibles la entrada correspondiente,
p. ej. "TLS".
● Indicación de un "Nombre alternativo del titular del certificado" ("SAN", Subject Alternative
Name) que, p. ej. en la comunicación segura con servidores web (HTTP over TLS), se
utiliza para garantizar que el certificado también pertenece al servidor web que se ha
indicado en la URL de la barra de direcciones del navegador web.

Cómo se generan y se verifican las firmas
Los requisitos técnicos que permiten comprobar los certificados los proporciona el uso de
claves asimétricas: Tomando como ejemplo el certificado "MyCert" se mostrarán los procesos
de "firma" y de "comprobación de firma".
Crear firma:
1. A partir de los datos del certificado, el emisor del certificado "MyCert" genera un valor hash
utilizando una función resumen o hash determinada (p. ej. SHA-1, Secure Hash Algorithm).
El valor hash es una secuencia de bits de longitud constante. La longitud constante del valor
hash ofrece la ventaja de que la firma del valor hash requiere siempre el mismo tiempo.
2. A partir del valor hash generado, el emisor del certificado genera una firma digital utilizando
la clave privada. Para ello suele utilizarse el procedimiento de firma RSA.
3. La firma digital se guarda en el certificado. Así, el certificado está firmado.
Verificar firma:
1. El verificador del certificado "MyCert" obtiene el certificado del emisor, y por tanto la clave
pública.
2. Con el mismo algoritmo hash utilizado para la firma (p. ej. SHA-1), se forma de nuevo un
valor hash a partir de los datos del certificado.
3. A continuación, este valor hash se compara con el valor hash determinado mediante la
clave pública del emisor del certificado y el algoritmo de firma para comprobar la firma.
4. Si la comprobación de la firma arroja un resultado positivo, quedan comprobadas tanto la
identidad del titular del certificado como la integridad, es decir, la autenticidad y legitimidad
del contenido del certificado. Cualquiera que tenga la clave pública, es decir, el certificado
de la entidad emisora, puede verificar la firma y de esta forma detectar que el certificado ha
sido firmado efectivamente por la entidad emisora.
En la imagen siguiente se muestra cómo verifica Alice la firma de la clave pública de Bob
utilizando la clave pública del certificado de Twent (encarna la entidad emisora CA). Por tanto,
la disponibilidad del certificado de la entidad emisora es indispensable en el instante de la
verificación. La validación en sí se ejecuta automáticamente en la sesión TLS.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

751

Configuración de dispositivos y redes
1.3 Configurar redes

&$
$OLFHYHULILFDODILUPD
GH%REFRQODFODYH
S¼EOLFDGH7ZHQW &$

7ZHQW

&$

%RE

Firma de mensajes
El método de firma y verificación descrito anteriormente también utiliza la sesión TLS para
firmar y verificar mensajes:
Si se genera un valor hash de un mensaje y dicho valor hash se firma con la clave privada del
emisor y se agrega al mensaje original, el receptor del mensaje estará en condiciones de
detectar la integridad del mensaje. El receptor descifra el valor hash utilizando la clave pública
del emisor y, a partir del mensaje recibido, genera su propio valor hash y compara ambos
valores. Si los valores son distintos, significa que el mensaje ha sido falseado durante el
recorrido.

Cadena de certificados hasta el certificado raíz
Los certificados de una PKI suelen estar organizados jerárquicamente: La cúspide jerárquica
la ocupan los certificados raíz, también denominados "Root certificates", que no están
certificados por una entidad emisora jerárquicamente superior. En los certificados raíz el titular
y el emisor del certificado son idénticos. Los certificados raíz gozan de plena confianza, y como
"ancla" de confianza que son, deben ser conocidos por el receptor como certificados de
confianza. Se guardan en un área reservada para certificados de confianza.
Dependiendo de la PKI en cuestión, la función de los certificados raíz puede consistir, p. ej., en
firmar certificados de entidades emisoras jerárquicamente inferiores, los denominados
certificados intermedios. De este modo la confianza se traspasa del certificado raíz al
certificado intermedio. El certificado intermedio puede firmar un certificado igual que lo hace un
certificado raíz, por lo que ambos se denominan "certificados CA".
Esta jerarquía puede recorrer varios certificados intermedios hasta llegar al certificado de
entidad final (end-entity). El certificado de entidad final es el certificado del usuario que debe
identificarse.
Para la validación se recorre la misma jerarquía en sentido contrario: Como se ha descrito
anteriormente, se determina el emisor del certificado, se verifica la firma con su clave pública,
después se determina el certificado del emisor de certificados jerárquicamente superior hasta
que se recorre la cadena de traspaso de confianza completa hasta el certificado raíz.
Resumen: La cadena de certificados intermedios hasta el certificado raíz (la ruta de
certificados) debe existir en todo dispositivo que vaya a validar un certificado de entidad final
del interlocutor, con independencia del tipo de secure communication que se configure.

752

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Administrar certificados con STEP 7
STEP 7 V14 o superior en combinación con las CPU S7-1500 con firmware 2.0 o superior
soportan la PKI vía Internet (RFC 5280) en el sentido de que una CPU S7-1500 es capaz de
comunicarse con dispositivos que también soportan la PKI vía Internet.
De esto resulta el uso de certificados X.509, p. ej., para verificar certificados, tal y como se
describe en los apartados anteriores.
STEP 7 V14 o superior utiliza una PKI similar a la PKI vía Internet. No se soportan, p. ej., las
denominadas Certificate Revocation Lists (CRL).

Crear o asignar certificados
Para dispositivos con propiedades de seguridad como, p. ej., una CPU S7-1500 con firmware
V2.0 o superior, cree certificados en STEP 7 para distintas aplicaciones.
Las siguientes áreas de la ventana de inspección de la CPU permiten crear certificados nuevos
o seleccionar los ya existentes:
● "Protección y seguridad > Administrador de certificados" - para crear o asignar todo tipo de
certificados; es el ajuste predeterminado en la creación de certificados TLS para Secure
Open User Communication.
● "Servidor web > Security" - para crear o asignar certificados de servidor web.
● "OPC UA > Servidor > Security" - para la creación o asignación de certificados OPC UA.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

753

Configuración de dispositivos y redes
1.3 Configurar redes

Particularidades del área "Protección y seguridad > Administrador de certificados"
Solo en esta área de la ventana de inspección se puede alternar entre el administrador global
de certificados, es decir, para todo el proyecto, y el local, es decir, específico del dispositivo
(opción "Utilizar ajustes globales de seguridad para el administrador de certificados"). La
opción determina si se tiene acceso o no a todos los certificados del proyecto.
● Si no utiliza el administrador de certificados en los ajustes globales de seguridad, solo
podrá acceder al almacén local de certificados de la CPU. No tendrá acceso, p. ej., a
certificados importados o certificados raíz. Sin estos certificados solo está disponible una
funcionalidad limitada; solo podrá, p. ej., crear certificados autofirmados.
● Si no utiliza el administrador de certificados en los ajustes globales de seguridad y ha
iniciado sesión como administrador, p. ej., podrá acceder al almacén global de certificados
a escala de todo el proyecto. Podrá, p. ej., asignar a la CPU certificados importados o crear
certificados emitidos y firmados por la CA del proyecto (entidad emisora del proyecto).
En la figura siguiente puede apreciarse que, tras activar la opción "Utilizar ajustes globales de
seguridad para el administrador de certificados", en el árbol del proyecto de la ventana de
inspección de la CPU aparecen los "Ajustes globales de seguridad".

Si hace doble clic en "Inicio de sesión de usuario" debajo de los "Ajustes globales de
seguridad" en el árbol del proyecto y a continuación inicia sesión, allí aparece también, entre
otros, la fila "Administrador de certificados".
Haciendo doble clic en la fila "Administrador de certificados" obtendrá acceso a todos los
certificados del proyecto, distribuidos en las fichas "CA" (entidades emisoras), "Certificados de
dispositivos" y "Certificados de confianza y entidades emisoras de certificados raíz".

754

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Claves privadas
STEP 7 crea claves privadas al generar certificados de dispositivos o certificados de servidor
(certificados de entidad final). La ubicación en la que se guarda cifrada la clave privada
depende de si se utilizan o no los ajustes globales de seguridad para el administrador de
certificados:
● Si se utilizan los ajustes globales de seguridad, la clave privada se guarda cifrada en el
almacén global de certificados (a escala de todo el proyecto).
● Si no se utilizan los ajustes globales de seguridad, la clave privada se guarda cifrada en el
almacén local de certificados (específico de CPU).
La existencia de la clave privada que se necesita, p. ej., para descifrar datos, se indica en la
columna "Clave privada", en la ficha "Certificados de dispositivos" del administrador de
certificados, dentro de los ajustes globales de seguridad.
Al cargar la configuración hardware se cargan en la CPU el certificado del dispositivo, la clave
pública y la clave privada.
ATENCIÓN
La opción "Utilizar ajustes globales de seguridad para el administrador de certificados" afecta
las claves privadas utilizadas hasta el momento: Si ya ha creado certificados sin utilizar el
administrador de certificados en los ajustes globales de seguridad y a continuación modifica
la opción que permite utilizar el administrador de certificados, entonces las claves privadas se
perderán y la ID del certificado puede cambiar. Una advertencia pone al usuario al tanto de
esta situación. Por tanto, al iniciar la configuración defina qué opción es necesaria para
administrar los certificados.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

755

Configuración de dispositivos y redes
1.3 Configurar redes

Ejemplos de administración de certificados
Como se explica en los apartados anteriores, los certificados son necesarios para cualquier
tipo de secure communication. A continuación se muestra mediante un ejemplo el modo de
manejar los certificados con STEP 7 para que se cumplan las condiciones necesarias para la
Secure Open User Communication.
En este contexto, para todos los interlocutores implicados se especifica de qué tipo de
dispositivo se trata. Los pasos para proveer a los interlocutores con los certificados necesarios
se describen individualmente. Se parte de la base de que se dispone de una CPU S7-1500 y
de un controlador por software S7-1500 con versión de firmware 2.0 o superior.
Por lo general se aplica lo siguiente:
Al establecer una conexión segura ("Handshake"), los interlocutores solo suelen transmitir sus
certificados de entidad final (certificados de dispositivo).
Por tanto, los certificados CA necesarios para verificar el certificado de dispositivo transmitido
deben estar guardados en la memoria de certificados del respectivo interlocutor.
Nota
En la CPU debe estar ajustada la fecha actual o la hora actual.
Cuando se utiliza Secure Communication (p. ej. HTTPS, Secure OUC, OPC UA), hay que
asegurarse de que los módulos afectados tengan la hora y fecha actuales. De lo contrario, los
módulos considerarán los certificados utilizados no válidos y la comunicación segura no
funcionará.

Secure Open User Communication entre dos CPU S7-1500
Dos CPU S7-1500, PLC_1 y PLC_2, deben intercambiar datos a través de Secure Open User
Communication.
Los certificados de dispositivo necesarios se generan con STEP 7 y se asignan a las CPU
como se describe a continuación.
Para firmar los certificados de dispositivo se utilizan entidades emisoras para proyectos STEP
7 (CA del proyecto).
Los certificados deben referenciarse mediante su identificación de certificado en el programa
de usuario (instrucción de comunicación TCON junto con el correspondiente tipo de datos de
sistema, p. ej., TCON_IPV4_SEC). STEP 7 asigna automáticamente la ID de certificado al
generar o crear certificados.

756

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Procedimiento
STEP 7 carga automáticamente los certificados CA necesarios junto con la configuración
hardware en las CPU implicadas, de modo que en ambas CPU se cumplen los requisitos para
la verificación de certificados. Por tanto, el usuario solo debe generar los certificados de
dispositivo para las CPU implicadas, del resto se ocupa STEP 7.
1. Seleccione PLC_1 y active en el área "Protección y seguridad" la opción "Utilizar ajustes
globales de seguridad para el administrador de certificados".
2. Inicie sesión como usuario en el área "Ajustes globales de seguridad" del árbol del
proyecto. En un proyecto nuevo, el primer inicio de sesión asigna al usuario la función de
"Administrador".
3. Vuelva a PLC_1 en el área "Protección y seguridad". Haga clic en la tabla "Certificados de
dispositivo" en una fila vacía de la columna "Titular del certificado" para agregar un
certificado nuevo.
4. Haga clic en el botón "Agregar" en la lista desplegable de selección de certificados.
Se abre el cuadro de diálogo "Generar nuevo certificado".
5. No modifique las opciones predeterminadas de este cuadro de diálogo, que están
pensadas especialmente para Secure Open User Communication (uso: TLS).
Sugerencia: complete el nombre predeterminado del titular del certificado, en este caso
agregue el nombre de la CPU. No modifique el nombre predeterminado de la CPU para
poder identificarla mejor en caso de que deban administrarse muchos certificados de
dispositivo.
Ejemplo: PLC_1/TLS se convierte en PLC_1-SecOUC-Chassis17FactoryState.
6. Compile la configuración.
El certificado del dispositivo y el certificado CA son parte integral de la configuración.
7. Repita los pasos descritos para PLC_2.
En el paso siguiente debe crear los programas de usuario para el intercambio de datos y cargar
las configuraciones junto con el programa.

Utilizar certificados autofirmados en lugar de certificados CA
Al crear certificados de dispositivo puede elegir la opción "Autofirmado". Los certificados
autofirmados se pueden crear sin haber iniciado sesión en los ajustes globales de seguridad.
Este procedimiento no se recomienda porque los certificados así creados no están guardados
en la memoria global de certificados y, por tanto, no se pueden asignar directamente a una
CPU del interlocutor.
Como se ha descrito anteriormente, debe elegir cuidadosamente el nombre del titular del
certificado para poder asignar sin duda alguna el certificado correcto a un dispositivo.
Los certificados autofirmados no se pueden verificar mediante los certificados CA del proyecto
STEP 7. Para poder verificar certificados autofirmados, debe registrarse el certificado
autofirmado del interlocutor en la lista de dispositivos interlocutores de confianza para cada
CPU. Para ello, debe haber activado la opción "Utilizar ajustes globales de seguridad para el
administrador de certificados" e iniciado sesión como usuario en los ajustes globales de
seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

757

Configuración de dispositivos y redes
1.3 Configurar redes
Para agregar el certificado autofirmado del interlocutor de la CPU, proceda del siguiente modo:
1. Seleccione PLC_1 y navegue hasta la tabla "Certificados de dispositivos del interlocutor" en
el área "Protección y seguridad".
2. Haga clic en una fila vacía de la columna "Titular del certificado" para abrir la lista
desplegable que permite agregar o seleccionar certificados.
3. Seleccione en la lista desplegable el certificado autofirmado del interlocutor y confirme la
elección.
En el paso siguiente debe crear los programas de usuario para el intercambio de datos y cargar
las configuraciones junto con el programa.

Secure Open User Communication entre una CPU S7-1500 como cliente TLS y un dispositivo de
terceros como servidor TLS
Dos dispositivos deben intercambiar datos a través de una conexión TLS o una sesión TLS, p.
ej., para intercambiar recetas, datos de producción o datos de calidad:
● Una CPU S7-1500 (PLC_1) como cliente TLS; la CPU utiliza Secure Open User
Communication
● Un dispositivo de terceros, p. ej. un Manufacturing Execution System (MES), como servidor
TLS
La CPU S7-1500 establece como cliente TLS la conexión/sesión TLS con el sistema MES.



①
②



Cliente TLS
Servidor TLS

Para la autenticación del servidor TLS, la CPU S7-1500 necesita los certificados CA del
sistema MES: El certificado raíz y, dado el caso, los certificados intermedios para verificar la
ruta del certificado.
Estos certificados deben importarse a la memoria global de certificados de la CPU S7-1500.
Para importar certificados del interlocutor, proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a importar (certificados de
confianza de entidades emisoras de certificados raíz).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en la tabla. Haga clic
en "Importar" e importe el certificado requerido o los certificados CA requeridos.
El certificado contiene tras la importación una ID de certificado y en el siguiente paso puede
asignarse a un módulo.

758

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
4. Seleccione PLC_1 y navegue hasta la tabla "Certificados de dispositivos del interlocutor" en
el área "Protección y seguridad".
5. Haga clic en una fila vacía de la columna "Titular del certificado" para agregar los
certificados importados.
6. Seleccione en la lista desplegable los certificados CA requeridos del interlocutor y confirme
la elección.
Para la autenticación de la CPU (es decir, del cliente TLS), el sistema MES también puede
exigir opcionalmente un certificado de dispositivo de la CPU. En tal caso, deben ponerse a
disposición del sistema MES los certificados CA de la CPU. Para poder importar los
certificados al sistema MES es necesario haber exportado antes los certificados CA desde el
proyecto de STEP 7 de la CPU. Proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a exportar (certificados CA).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en el certificado
seleccionado.
4. Haga clic en "Exportar".
5. Seleccione el formato de exportación del certificado.
En el paso siguiente debe crear los programas de usuario para el intercambio de datos y cargar
las configuraciones junto con el programa.

Secure Open User Communication entre una CPU S7-1500 como servidor TLS y un dispositivo de
terceros como cliente TLS
Si la CPU S7-1500 actúa como servidor y el dispositivo de terceros, p. ej. un sistema ERP
(Enterprise Resource Planning System), establece la conexión/sesión TLS, se necesitan los
certificados siguientes:
● Para la CPU S7-1500 cree un certificado de dispositivo (certificado de servidor) con clave
privada y cárguela con la configuración hardware. Para crear el certificado de servidor
utilice la opción "Firmado por entidad emisora".
La clave privada es necesaria para el intercambio de claves, como se describe en el
ejemplo "HTTP over TLS".
● Para el sistema ERP hay que exportar el certificado CA del proyecto STEP 7 e importarlo/
cargarlo en el sistema ERP. Mediante el certificado CA, el sistema ERP verifica el
certificado de servidor de la CPU S7-1500, transmitido de la CPU al sistema ERP al
establecerse la conexión/sesión TLS.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

759

Configuración de dispositivos y redes
1.3 Configurar redes



①
②



Servidor TLS
Cliente TLS

La descripción de los pasos que deben llevarse a cabo figura en los apartados anteriores.

Secure Open User Communication a través del CP S7-1543-1 como cliente de correo electrónico
(SMTP over TLS)
Una CPU S7-1500 puede establecer una conexión segura con un servidor de correo
electrónico a través del CP 1543-1 y la instrucción de comunicación TMAIL-C.
Los tipos de datos de sistema TMail_V4_SEC, TMail_V6_SEC y TMail_QDN_SEC le permiten
definir el puerto interlocutor del servidor de correo electrónico y así acceder al servidor de
correo electrónico a través de "SMTP over TLS".

El requisito para una conexión de correo electrónico segura es la importación del certificado
raíz y de los certificados intermedios del servidor de correo electrónico (proveedor) en la
memoria global de certificados del proyecto STEP 7. Una vez estos certificados se han
asignado al CP, el CP puede verificar con ellos el certificado del servidor de correo electrónico,
enviado por el servidor de correo electrónico durante el establecimiento de la conexión/sesión
TLS.
Proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a importar (certificados de
confianza de entidades emisoras de certificados raíz).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en la tabla. Haga clic
en "Importar" e importe el certificado requerido o los certificados CA requeridos.
El certificado contiene tras la importación una ID de certificado y en el siguiente paso puede
asignarse al CP.
4. Seleccione el CP 1543-1 y navegue hasta la tabla "Certificados de dispositivos del
interlocutor" en el área "Protección y seguridad".

760

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
5. Haga clic en una fila vacía de la columna "Titular del certificado" para agregar los
certificados importados.
6. Seleccione en la lista desplegable los certificados CA requeridos del servidor de correo
electrónico y confirme la elección.
En el paso siguiente debe crear los programas de usuario para la función de cliente de correo
electrónico de la CPU y cargar las configuraciones junto con el programa.

Consulte también
Secure OUC entre dos CPU S7-1500 (Página 773)
Secure OUC de una CPU S7-1500 como cliente TLS a un PLC de terceros (servidor TLS)
(Página 776)
Secure OUC de una CPU S7-1500 como servidor TLS a un PLC de terceros (cliente TLS)
(Página 779)
Secure OUC a través de correo electrónico (Página 785)
Secure OUC a través de interfaz CP (Página 781)

Ejemplo: HTTP over TLS
A continuación se muestra cómo se utilizan los mecanismos descritos para establecer una
secure communication entre un navegador web y el servidor web de una CPU S7-1500.
Primero se describen las modificaciones de la opción "Acceso solo vía HTTPS" en STEP 7. A
partir de STEP 7 V14 tiene la posibilidad de influir en el certificado del servidor web de una CPU
S7-1500 con firmware V2.0 o superior: A partir de estas versiones, el certificado de servidor se
crea con STEP 7.
Además se indican los procesos que se ejecutan al solicitar acceso a una página web del
servidor web de la CPU con un navegador web de un PC a través de una conexión HTTPS
cifrada.

Manejo de certificados de servidor web para las CPU S7-1500 a partir del firmware V2.0
Para las CPU S7-1500 con versión de firmware anterior a V2.0, al ajustar las propiedades del
servidor web sin requisitos ha podido elegir la opción "Permitir acceso solo vía HTTPS".
En el caso de estas CPU no se ha ocupado del manejo de certificados; la propia CPU genera
automáticamente los certificados necesarios para el servidor web.
En las CPU S7-1500 a partir del firmware V2.0, STEP 7 genera el certificado de servidor
(certificado de entidad final) para la CPU. En las propiedades de la CPU (Servidor web >
Seguridad del servidor) asigne un certificado de servidor al servidor web.
Dado que un nombre de certificado de servidor siempre está ajustado de forma
predeterminada, en la configuración simple del servidor web no cambia nada: el usuario activa
el servidor web y la opción "Acceso solo vía HTTPS" - STEP 7 genera durante la compilación
un certificado de servidor con el nombre predeterminado.
Independientemente de si se utiliza o no el administrador de certificados en los ajustes
globales de seguridad: STEP 7 dispone de toda la información necesaria para poder generar
el certificado de servidor.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

761

Configuración de dispositivos y redes
1.3 Configurar redes
Además tiene la posibilidad de definir las propiedades del certificado de servidor, p. ej., el
nombre o la vigencia.
Nota
En la CPU debe estar ajustada la fecha actual o la hora actual.
Cuando se utiliza Secure Communication (p. ej. HTTPS, Secure OUC, OPC UA), hay que
asegurarse de que los módulos afectados tengan la hora y fecha actuales. De lo contrario, los
módulos considerarán los certificados utilizados no válidos y la comunicación segura no
funcionará.

Cargar el certificado del servidor web
El certificado de servidor generado por STEP 7 se carga automáticamente al cargar la
configuración hardware en la CPU.
● Si se utiliza el administrador de certificados en los ajustes globales de seguridad, la entidad
emisora del proyecto (certificado) firma el certificado del servidor web. Durante la carga se
carga automáticamente el certificado CA del proyecto.
● Si no se utiliza el administrador de certificados en los ajustes globales de seguridad, STEP
7 genera el certificado de servidor como certificado autofirmado.
Si se direcciona el servidor web de la CPU a través de la dirección IP de la CPU, cada vez que
se cambie la dirección IP de una interfaz Ethernet de la CPU será necesario generar y cargar
un nuevo certificado de servidor (certificado de entidad final). La razón es que al cambiar la
dirección IP cambia también la identidad de la CPU y, conforme a las reglas de PKI, esta debe
certificarse (firmarse).
Es posible evitar este problema direccionando la CPU mediante un nombre de dominio en
lugar de hacerlo con su propia dirección IP, p. ej. "myconveyer-cpu.room13.myfactory.com".
Para ello es necesario administrar los nombres de dominio de las CPU a través de un servidor
DNS.
Enviar un certificado CA del servidor web al navegador web
El usuario que accede vía HTTPS a las páginas web de la CPU debe instalar el certificado CA
de la CPU en el navegador web. Si el certificado no está instalado, se mostrará una advertencia
con la recomendación de no usar la página. Para ver la página, el usuario tiene que "Agregar
una excepción" de forma explícita.
El usuario puede descargar un certificado raíz (Certification Authority) válido de la página web
"Introducción" del servidor web en "Descargar certificado".
STEP 7 ofrece otra posibilidad para ello: exporte el certificado CA del proyecto con el
administrador de certificados en los ajustes globales de seguridad de STEP 7. A continuación
importe el certificado CA al navegador.

Ejecución de la secure communication
La figura siguiente muestra de manera simplificada el esquema de cómo se establece la
comunicación ("Handshake"), haciendo hincapié en la negociación de claves que se utilizan
para el intercambio de datos (en este caso mediante HTTP over TLS).

762

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Sin embargo, esta ejecución es básicamente transferible a todas las posibilidades de
comunicación basadas en la utilización de TLS, por tanto, también a la Secure Open User
Communication (consulte los principios básicos de la secure communication).

$OLFHVROLFLWDDFFHVRDODS£JLQDZHEFRQ
KWWSV
$OLFH

$OLFHHOLJHXQD
FODYHVLP«WULFD
DOHDWRULD

(OVHUYLGRUZHEDFHSWDODFRQH[LµQ\
HQY¯DVXFHUWLILFDGRTXHLQFOX\HOD
FODYHS¼EOLFD
&$

$OLFHHQY¯DOD
FODYHVLP«WULFDFLIUDGDFRQODFODYH
S¼EOLFDGHOVHUYLGRU

&$

&ODYHS¼EOLFDILUPDGD\
FODYHSULYDGDGHOVHUYLGRU
ZHE
(OVHUYLGRUZHEGHVFLIUDOD
FODYHVLP«WULFDFRQVX
FODYHSULYDGD

'HVGHHVHPRPHQWR$OLFH\HO
VHUYLGRUZHEFLIUDQ\GHVFLIUDQ
VLP«WULFDPHQWH

En la figura no se representan las acciones ejecutadas por parte de Alice (navegador) para
verificar el certificado enviado por el servidor web. El hecho de que Alice pueda confiar en el
certificado de servidor web transmitido y, por tanto, en la identidad del servidor web, y
comenzar el intercambio de datos depende de que la verificación haya resultado positiva.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

763

Configuración de dispositivos y redes
1.3 Configurar redes
Detalle de los pasos para verificar la autenticidad del servidor web:
1. Alice debe conocer las claves públicas de todas las entidades emisoras involucradas, es
decir, Alice necesita comprobar la cadena de certificados completa del certificado del
servidor web (es decir, del certificado de entidad final del servidor web):
Habitualmente Alice tiene en su memoria de certificados el certificado raíz que necesita. Al
instalar un navegador web se instala también, p. ej., una serie de certificados raíz de
confianza. Si no tiene el certificado raíz, debe descargarlo de la entidad emisora e instalarlo
en la memoria de certificados del navegador. La entidad emisora puede ser el dispositivo
en el que se encuentra el servidor web.
Para obtener los certificados intermedios existen las posibilidades siguientes:
– El propio servidor envía a Alice, junto con su certificado de entidad final, los certificados
intermedios necesarios, concretamente en forma de mensaje firmado, para que Alice
pueda verificar la integridad de la cadena de certificados.
– Los certificados suelen incluir las URL del correspondiente emisor. Mediante esas URL
Alice puede cargar los certificados intermedios necesarios.
Cuando se manejan certificados en STEP 7, siempre se parte de la base de que ya se han
importado los certificados intermedios necesarios y el certificado raíz en el proyecto y que
ya se han asignado al módulo.
2. Con las claves públicas de los certificados, Alice valida las firmas de la cadena de
certificados.
3. La clave simétrica debe generarse y transmitirse al servidor web.
4. Si el servidor web está direccionado con su nombre de dominio, Alice verifica la identidad
del servidor web conforme a las reglas de PKI establecidas en RFC 2818: Puede hacerlo
porque la URL del servidor web, en este caso el "Fully Qualified Domain Name" (FQDN),
está depositada en el certificado de entidad final del servidor web. Si el certificado
introducido en el campo "Subject Alternative Name" coincide con la entrada en la barra de
direcciones del navegador, todo está correcto.
Después tiene lugar el intercambio de datos con la clave simétrica, como se muestra en la
figura superior.

Consulte también
Certificados para el servidor web (Página 1084)

1.3.5.2

Ajustes globales de seguridad

Administrador de certificados de seguridad global
Introducción
En el administrador de certificados de seguridad global se obtiene una vista general de todos
los certificados utilizados en el proyecto, p. ej. certificados CA con la información
correspondiente al titular, emisor, validez, uso y presencia de una clave privada. Disponiendo
de la respectiva autorización, aquí también puede administrar certificados para el proyecto.

764

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Activación de los ajustes globales de seguridad
Los ajustes globales de seguridad solo son visibles si han sido activados en el proyecto al
menos para un dispositivo. A tal fin, en el administrador local de certificados (específico de la
CPU) está disponible la casilla de verificación "Utilizar ajustes globales de seguridad para el
administrador de certificados":

Encontrará la casilla de verificación en las propiedades generales de un dispositivo con
funciones de seguridad, concretamente en la sección "Protección y seguridad > Administrador
de certificados" de la ventana de inspección.

Principio
El certificado CA es un certificado emitido por un entidad emisora, llamada "Certificate
Authority", y de él se derivan los certificados de dispositivo.
Las posibles entidades emisoras pueden ser:
● STEP 7: Si el titular y el emisor del certificado son iguales, se trata de un certificado
autofirmado, es decir, emitido por STEP 7.
● Entidad emisora superior: Los certificados externos al proyecto de otros emisores se
importan y se guardan en la memoria de certificados de STEP 7.
Los certificados creados por una de las dos entidades emisoras siempre cuentan con una
clave privada, que permite derivar los certificados de dispositivo.

Funciones del administrador de certificados de seguridad global
En el administrador de certificados de seguridad global están disponibles las siguientes
funciones:
● Importar certificados y entidades emisoras nuevas.
● Importar certificados SSL (solo CP x43-1 Adv.), p. ej. para la comunicación FTP.
● Exportar los certificados y entidades emisoras utilizados en el proyecto.
● Renovar certificados y entidades emisoras caducados.
● Sustituir entidades emisoras ya existentes.
● Agregar certificados y entidades emisoras de confianza.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

765

Configuración de dispositivos y redes
1.3 Configurar redes
Borrar certificados importados manualmente.
Nota
Carga de la configuración
Tras sustituir o renovar certificados es necesario cargar la configuración en los dispositivos
correspondientes. Tras sustituir o renovar certificados CA es necesario cargar la configuración
en todos los dispositivos.
Nota
Fecha y hora actuales en los módulos de seguridad
Cuando se utiliza la comunicación segura (p. ej. HTTPS), hay que asegurarse de que los
dispositivos afectados tienen la hora y fecha actuales. De lo contrario, los certificados
utilizados se considerarán no válidos y la comunicación segura no funcionará.

Consulte también
Administrador local de certificados específico de la CPU (Página 1078)

Administrar usuarios y funciones
Introducción
Una vez se han activado los ajustes globales de seguridad para el administrador de
certificados, es necesario iniciar sesión en los ajustes globales de seguridad o disponer de
derechos de administrador, de lo contrario no tendrá derechos de usuario suficientes para
procesar los certificados globales. Si no inicia sesión o no dispone de los derechos necesarios,
no podrá acceder al administrador de certificados global.

Funciones y derechos
Puede configurar los ajustes de seguridad si le han sido asignadas las funciones predefinidas
"Administrador" o "Estándar", o bien otra función definida que incluya la autorización
correspondiente. Puede ver las funciones en el el árbol del proyecto, en "Ajustes globales de
seguridad > Administración de usuarios > Funciones", y también editarlas si posee la
autorización correspondiente.
Función asignada

Diagnosticar

Configurar

Administrar usuarios y funcio‐
nes

Administrador

Sí

Sí

Sí

Estándar

Sí

Sí

No

Diagnóstico

Sí

No

No

Como administrador, en la administración de usuarios puede crear nuevas funciones y
usuarios y asignar funciones a los diferentes usuarios.

766

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Requisitos
Tiene que haber iniciado sesión como administrador en los ajustes globales de seguridad a
través del inicio de sesión de usuario.

Procedimiento
Para editar los usuarios y las funciones, proceda del siguiente modo:
1. Navegue hasta la administración de usuarios en los ajustes globales de seguridad del árbol
del proyecto.
2. Seleccione la función que desea modificar o cree una función nueva.
3. Edite en la lista de derechos los derechos de la función seleccionada.

Importar y exportar certificados
Introducción
Puede importar y exportar certificados y las claves privadas correspondientes. Los certificados
solo se pueden importar a través del administrador de certificados global. La exportación de
certificados también se pueden llevar a cabo a través del administrador local de certificados
(específico de la CPU).
Se pueden importar o exportar certificados a los siguientes tipos de datos:
● Certificados sin clave privada a CER, DER, CRT o PEM
● Certificados con su clave privada a P12 (PKCS12).

Requisitos
Al importar certificados con clave privada puede que necesite una contraseña para el acceso.

Importar certificados
Para importar un certificado, proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a importar (certificados CA,
certificados de dispositivo, certificados de confianza de entidades emisoras de certificados
raíz).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en la tabla.
4. Haga clic en "Importar".
5. Seleccione el formato de importación del certificado:
– CER, DER, CRT o PEM para certificados sin clave privada.
– P12 (fichero PKCS12) para certificados con clave privada.
6. Haga clic en "Abrir" para importar el certificado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

767

Configuración de dispositivos y redes
1.3 Configurar redes
El certificado importado debe asignarse manualmente al dispositivo o módulo deseado.

Exportar certificados
Para exportar un certificado, proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a exportar (certificados CA,
certificados de dispositivo, certificados de confianza de entidades emisoras de certificados
raíz).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en el certificado
seleccionado.
4. Haga clic en "Exportar".
5. Seleccione el formato de exportación del certificado:
– CER, DER, CRT o PEM para certificados sin clave privada.
– CRL para la lista de revocación de certificados cifrados según DER.
– P12 (fichero PKCS12) para certificados con clave privada.
6. Haga clic en "Guardar" para exportar el certificado.
También puede exportar certificados directamente desde el administrador de certificados
específico de la CPU local.

Formatos de archivo seleccionables
Los certificados X.509 según el estándar de certificados X.509 V3 del RFC 5280 pueden
importarse y exportarse en diversos formatos y con distintas extensiones de nombre de
archivo:
Extensión de
nombre de ar‐
chivo

PEM

Tipo de archivo Privacy Enhanced Mail Security Certificate
Uso

Certificado con cifrado Base64

Tipo MIME

application/x-pem-file

Significado

Certificado con formato PEM/X509 (PEM = Privacy-Enhanced Mail) y cifrado ASCII (Base64). Formato
frecuentemente utilizado por las entidades emisoras para transmitir certificados vía correo electrónico al
solicitante del certificado. En vez de la extensión de nombre de archivo PEM, un certificado con cifrado
Base64 también puede tener, entre otras, las extensiones CER o CRT.

Uso

En el TIA Portal se soporta la importación y exportación con cifrado PEM. Una exportación con cifrado PEM
puede llevarse a cabo con el formato de archivo PEM o CRT.

768

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Extensión de
nombre de ar‐
chivo

DER

Tipo de archivo DER Encoded X509 Certificate
Uso

Certificado con cifrado binario

Tipo MIME

application/x-x509-ca-cert, application/pkix-cert

Significado

Certificado con formato DER/X.509 (DER = Distinguished Encoding Rules) y cifrado binario. El formato
binario DER constituye la base del formato PEM con cifrado ASCII. El formato DER se utiliza sobre todo en
el entorno de Microsoft Windows y en plataformas Java. En vez de la extensión de nombre de archivo DER,
un certificado con cifrado binario también puede tener, entre otras, las extensiones CER o CRT.

Uso

En el TIA Portal se soporta la importación y exportación con cifrado DER. Una exportación con cifrado DER
puede llevarse a cabo con el formato de archivo DER o CER.

Extensión de
nombre de ar‐
chivo

CER

Tipo de archivo Internet Security Certificate File
Uso

Certificado cifrado según PEM o DER

Tipo MIME

application/x-x509-ca-cert, application/pkix-cert, application/keychain_access

Significado

Extensión de nombre de archivo alternativa CER (Canonical Encoding Rules) para un certificado con
cifrado binario y formato DER o un certificado con cifrado Base64/ASCII y formato PEM.

Uso

En el TIA Portal se soporta la importación y exportación con el formato de archivo CER. Al importar un
certificado con el formato de archivo CER, puede tratarse de un cifrado según PEM o DER. Para la expor‐
tación con el formato de archivo CER se utiliza el cifrado DER.

Extensión de
nombre de ar‐
chivo

CRT

Tipo de archivo Internet Security Certificate File
Uso

Certificado cifrado según PEM o DER

Tipo MIME

application/x-x509-ca-cert, application/pkix-cert, application/keychain_access

Significado

Extensión de nombre de archivo alternativa CRT para un certificado con cifrado binario y formato DER o un
certificado con cifrado Base64/ASCII y formato PEM.

Uso

En el TIA Portal se soporta la importación y exportación con el formato de archivo CRT. Al importar un
certificado con el formato de archivo CRT, puede tratarse de un cifrado según PEM o DER. Para la expor‐
tación con el formato de archivo CRT se utiliza el cifrado PEM.

Extensión de
nombre de ar‐
chivo

CRL

Tipo de archivo Certificate Revocation List
Uso

Lista de revocación de certificados cifrados según DER

Tipo MIME

application/pkix-crl, application/x-pkcs7-crl

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

769

Configuración de dispositivos y redes
1.3 Configurar redes
Extensión de
nombre de ar‐
chivo

CRL

Significado

CRL (Certificate Revocation List) es una extensión X.509 V3 y contiene la lista de certificados bloqueados
o revocados correspondientes a un certificado raíz determinado. Las entidades emisoras utilizan esta
opción para revocar la autorización de certificados ya emitidos. Esto sucede cuando hay certificados com‐
prometidos o cuyo contenido resulta ser erróneo. Los certificados bloqueados pueden desbloquearse nue‐
vamente con la CRL, por ejemplo si se establece que realmente el certificado no estaba comprometido o
su contenido no era erróneo. Los certificados revocados pierden permanentemente su validez y no pueden
autorizarse nuevamente. La entidad emisora actualiza sus CRL tan pronto como caduca su validez o
cambia su contenido. La fuente de suministro de una CRL está especificada en el respectivo certificado.

Uso

El TIA Portal no soporta la revocación de certificados a través de CRL. Dado que algunos clientes externos
necesitan obligatoriamente listas de revocación de certificados para poder validar los certificados, se so‐
porta la exportación de CRL. Sin embargo, la lista está vacía y solo tiene como fin hacer posible la validación
de un certificado emitido por determinados clientes externos.

Extensión de
nombre de ar‐
chivo

P12

Tipo de archivo Personal Information Exchange File
Uso

Como certificados cifrados en formato de fichero PKCS12, opcionalmente con clave privada

Tipo MIME

application/keychain_access, application/x-pkcs12

Significado

Los tipos de archivo con formato P12, además del certificado de servidor y los certificados intermedios,
también pueden contener la clave privada. Al guardar puede asignarse una contraseña.

Uso

En el TIA Portal se soporta la importación y exportación con el formato de archivo P12. La opción para
exportar a un archivo PKCS12 solo está disponible si el certificado dispone de una clave privada. Al exportar
se puede asignar una contraseña para el fichero PKCS12. De forma análoga a la asignación de contraseña
al exportar, al importar puede ser necesario introducir una contraseña para poder acceder al certificado.

Renovar certificados
Introducción
Es posible renovar certificados, p. ej., para actualizar un certificado comprometido mediante un
certificado importado o un certificado nuevo.

Procedimiento
Para renovar un certificado, proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a renovar (certificados CA,
certificados de dispositivo).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en el certificado
seleccionado.
4. Haga clic en "Renovar".

770

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
5. En el cuadro de diálogo para certificados nuevos puede editar los datos del certificado
seleccionado.
6. Si hace clic en "Aceptar", el certificado se renueva con los valores modificados.
Si renueva un certificado, el certificado antiguo es reemplazado por el que tiene los nuevos
valores. Con la renovación de certificados no se genera ninguna solicitud de firma por parte de
una entidad emisora.

Reemplazar certificados
Introducción
Es posible reemplazar un certificado existente por otro certificado.

Procedimiento
Para reemplazar un certificado, proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a reemplazar (certificados CA,
certificados de dispositivo, certificados de confianza de entidades emisoras de certificados
raíz).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en el certificado
seleccionado.
4. Haga clic en "Reemplazar".
5. En el cuadro de diálogo para modificar la entidad emisora, reemplace el certificado CA
existente en el proyecto o el certificado de grupo CA por uno nuevo.
Todos los certificados que aparecen en la tabla "Certificados afectados" se vuelven a derivar.

Mostrar certificados
Introducción
Es posible mostrar una vista general de todos los datos de los certificados a través del cuadro
de diálogo de certificados de Windows.

Procedimiento
Para mostrar los datos de los certificados, proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a mostrar (certificados CA,
certificados de dispositivo, certificados de confianza de entidades emisoras de certificados
raíz).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

771

Configuración de dispositivos y redes
1.3 Configurar redes
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en el certificado
seleccionado.
4. Haga clic en "Mostrar".

Resultado
En una ventana se muestra información de distinta índole sobre el certificado seleccionado:
● Información general sobre el certificado
● Información detallada sobre el certificado
● Información sobre la ruta del certificado

Borrar certificados
Introducción
Es posible borrar certificados que ya no necesite o certificados comprometidos.

Procedimiento
Para borrar un certificado, proceda del siguiente modo:
1. Abra el "Administrador de certificados" en los ajustes globales de seguridad del árbol del
proyecto.
2. Seleccione la tabla adecuada para el certificado que se va a borrar (certificados de
dispositivo, certificados de confianza de entidades emisoras de certificados raíz).
3. Abra el menú contextual haciendo clic con el botón derecho del ratón en el certificado
seleccionado.
4. Haga clic en "Borrar".
Nota
Los certificados CA exclusivos del proyecto y los certificados asignados automáticamente a un
CP no pueden borrarse.
También puede borrar certificados directamente en el administrador de certificados específico
de la CPU local. El certificado sigue existiendo en el proyecto dentro del administrador de
certificados de seguridad global, aunque no se utiliza más para el dispositivo.

772

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

1.3.5.3

Secure Open User Communication

Secure OUC entre dos CPU S7-1500
A continuación se describe cómo se establece vía TCP una Secure Open User Communication
entre dos CPU S7-1500. En este caso una CPU S7-1500 actúa como cliente TLS
(establecimiento activo de la conexión) y la otra CPU S7-1500 como servidor TLS
(establecimiento pasivo de la conexión).

Establecer una conexión TCP segura entre dos CPU S7-1500
Para que la comunicación TCP entre dos CPU S7-1500 sea segura es necesario crear y
parametrizar en cada CPU un bloque de datos del tipo de datos de sistema
TCON_IP_V4_SEC, y llamarlo directamente en la instrucción. La instrucción TCON soporta los
tipos de datos de sistema TCON_QDN_SEC y TCON_IP_V4_SEC. A partir de la versión de
firmware V2.5, las instrucciones TSEND_C y TRCV_C también soportan los tipos de datos de
sistema TCON_QDN_SEC y TCON_IP_V4_SEC.
Requisitos:
● La fecha y hora actuales están ajustadas en la CPU.
● Ambas CPU S7‑1500 tienen como mínimo la versión de firmware V2.0
● El cliente TLS y el servidor TLS poseen todos los certificados necesarios.
&OLHQWH7/6 &3B
&HUWLILFDGRGH
GLVSRVLWLYR
&HUWLILFDGR&$GHO
6HUYLGRU7/6
9DOLGDFLµQ
&HUWLILFDGRGHGLVSRVLWL
YRGHOVHUYLGRU7/6

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

+HOOR
+HOOR

6HUYLGRU7/6 &3B
&HUWLILFDGRGH
GLVSRVLWLYR
&HUWLILFDGR&$GHO
FOLHQWH7/6
9DOLGDFLµQ
&HUWLILFDGRGHGLVSRVLWLYR
GHOFOLHQWH7/6

773

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración en el cliente TLS
Para establecer una conexión TCP segura en el cliente TLS, proceda del siguiente modo:
1. Cree un bloque de datos global en el árbol del proyecto.
2. Defina en el bloque de datos global una variable del tipo de datos TCON_IP_V4_SEC. Para
ello, en la columna "Tipo de datos" introduzca la secuencia de caracteres
"TCON_IP_V4_SEC".
El ejemplo siguiente muestra el bloque de datos global "Data_block_1" en el que está
definida la variable "SEC connection 1 TLS-Client" del tipo de datos TCON_IP_V4_SEC.

3. Ajuste los parámetros de la conexión TCP en la columna "Valor de arranque". Introduzca,
p. ej., en "RemoteAdress" la dirección IPv4 del servidor TLS.
Nota
Parámetro de conexión InterfaceId
Tenga en cuenta que puede introducir el valor "0" para InterfaceId en el tipo de datos
TCON_IP_V4_SEC. En este caso, la propia CPU busca una interfaz local adecuada de la
CPU.
4. Ajuste los parámetros para secure communication en la columna "Valor de arranque".
– "ActivateSecureConn": activación de Secure Communication para esta conexión. Si
este parámetro tiene el valor FALSE, los parámetros de seguridad siguientes son
irrelevantes. En tal caso es posible crear una conexión TCP o UDP no segura.
– "TLSServerCertRef": Introduzca el valor 2 (referencia al certificado CA del proyecto en
TIA Portal (SHA256)) o el valor 1 (referencia al certificado CA del proyecto en TIA Portal
(SHA1)). Si utiliza otro certificado CA, introduzca la ID correspondiente del
administrador de certificados de los ajustes globales de seguridad.
– "TLSClientCertRef": ID del certificado X.509-V3 propio.

774

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
5. Cree una instrucción TCON en el editor de programas.
6. Interconecte el parámetro CONNECT de la instrucción TCON con la variable del tipo de
datos TCON_IP_V4_SEC.

Configuración en el servidor TLS
Para establecer una conexión TCP segura en el servidor TLS, proceda del siguiente modo:
1. Cree un bloque de datos global en el árbol del proyecto.
2. Defina en el bloque de datos global una variable del tipo de datos TCON_IP_V4_SEC.
El ejemplo siguiente muestra el bloque de datos global "Data_block_1" en el que está
definida la variable "SEC connection 1 TLS-Server" del tipo de datos TCON_IP_V4_SEC.

3. Ajuste los parámetros de la conexión TCP en la columna "Valor de arranque". Introduzca,
p. ej., en "RemoteAdress" la dirección IPv4 del cliente TLS.
4. Ajuste los parámetros para secure communication en la columna "Valor de arranque".
– "ActivateSecureConn": Activación de secure communication para esta conexión. Si este
parámetro tiene el valor FALSE, los parámetros de seguridad siguientes son
irrelevantes. En tal caso es posible crear una conexión TCP o UDP no segura.
– "TLSServerReqClientCert": Solicitud de un certificado X.509-V3 del cliente TLS.
Introduzca el valor "true".
– "TLSServerCertRef": ID del certificado X.509-V3 propio.
– "TLSClientCertRef": Introduzca el valor 2 (referencia al certificado CA del proyecto en
TIA Portal (SHA256)) o el valor 1 (referencia al certificado CA del proyecto en TIA Portal
(SHA1)). Si utiliza otro certificado CA, introduzca la ID correspondiente del
administrador de certificados de los ajustes globales de seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

775

Configuración de dispositivos y redes
1.3 Configurar redes
5. Cree una instrucción TCON en el editor de programas.
6. Interconecte el parámetro CONNECT de la instrucción TCON con la variable del tipo de
datos TCON_IP_V4_SEC.

Consulte también
Parámetros de conexión conforme a TCON_IP_V4_SEC (Página 129)
Parámetros de conexión conforme a TCON_QDN_SEC (Página 133)
Ejemplos de administración de certificados (Página 756)

Secure OUC de una CPU S7-1500 como cliente TLS a un PLC de terceros (servidor TLS)
A continuación se describe cómo se establece vía TCP una Secure Open User Communication
de una CPU S7-1500 como cliente TLS a un servidor TLS.

Establecer una conexión TCP segura de una CPU S7-1500 como cliente TLS a un servidor TLS
Las CPU S7-1500 a partir de la versión de firmware V2.0 soportan la secure communication
con direccionamiento a través de un Domain Name System (DNS).
Para establecer una conexión TCP segura a través del nombre de dominio, el propio usuario
tiene que crear y parametrizar un bloque de datos del tipo de datos de sistema
TCON_QDN_SEC y llamarlo directamente en la instrucción. La instrucción TCON soporta el
tipo de datos de sistema TCON_QDN_SEC.
Requisitos:
● En su red se encuentra al menos un servidor DNS.
● Para la CPU S7‑1500 se ha configurado al menos un servidor DNS.
● El cliente TLS y el servidor TLS poseen todos los certificados necesarios.

776

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
Para establecer una conexión TCP segura en el servidor TLS, proceda del siguiente modo:
1. Cree un bloque de datos global en el árbol del proyecto.
2. Defina en el bloque de datos global una variable del tipo de datos TCON_QDN_SEC.
El ejemplo siguiente muestra el bloque de datos global "Data_block_1" en el que está
definida la variable "DNS ConnectionSEC" del tipo de datos TCON_QDN_SEC.

3. Ajuste los parámetros de la conexión TCP en la columna "Valor de arranque". Introduzca,
p. ej., en "RemoteQDN" el nombre de dominio completamente cualificado (FQDN) del
servidor TLS.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

777

Configuración de dispositivos y redes
1.3 Configurar redes
4. Ajuste los parámetros para secure communication en la columna "Valor de arranque".
– "ActivateSecureConn": Activación de secure communication para esta conexión. Si este
parámetro tiene el valor FALSE, los parámetros de seguridad siguientes son
irrelevantes. En tal caso es posible crear una conexión TCP o UDP no segura.
– "ExtTLSCapabilities": Si introduce el valor 1, a continuación el cliente valida el
subjectAlternateName en el certificado X.509-V3 del servidor para comprobar la
identidad del servidor. Los certificados se comprueban al establecer la conexión.
– "TLSServerCertRef": ID del certificado X.509-V3 (habitualmente un certificado CA) que
el cliente TLS utiliza para validar la autenticación del servidor TLS. Si este parámetro es
0, para validar la autenticación del servidor el cliente TLS utiliza todos los certificados
(CA) que hay actualmente cargados en el Certificate Store del cliente.
&OLHQWH7/6
6
&HUWLILFDGR&$GHO
6HUYLGRU7/6
LPSRUWDGR\DVLJQDGR

+HOOR
+HOOR

6HUYLGRU7/6
3/&DMHQR
&HUWLILFDGRGH
GLVSRVLWLYR

9DOLGDFLµQ
&HUWLILFDGRGH
GLVSRVLWLYRGHO
6HUYLGRU7/6

– "TLSClientCertRef": ID del certificado X.509-V3 propio.
5. Cree una instrucción TCON en el editor de programas.
6. Interconecte el parámetro CONNECT de la instrucción TCON con la variable del tipo de
datos TCON_QDN_SEC.
En el siguiente ejemplo el parámetro CONNECT de la instrucción TCON está
interconectado con la variable "DNS connectionSEC" (tipo de datos TCON_QDN_SEC).

778

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Consulte también
Parámetros de conexión conforme a TCON_QDN_SEC (Página 133)
Ejemplos de administración de certificados (Página 756)

Secure OUC de una CPU S7-1500 como servidor TLS a un PLC de terceros (cliente TLS)
A continuación se describe cómo se establece vía TCP una Secure Open User Communication
de una CPU S7-1500 como servidor TLS a un cliente TLS.

Establecer una conexión TCP segura a través del nombre de dominio del interlocutor
Las CPU S7-1500 a partir de la versión de firmware V2.0 soportan la secure communication
con direccionamiento a través de un Domain Name System (DNS).
Para establecer una conexión TCP segura a través del nombre de dominio, el propio usuario
tiene que crear y parametrizar un bloque de datos del tipo de datos de sistema
TCON_QDN_SEC y llamarlo directamente en la instrucción. La instrucción TCON soporta el
tipo de datos de sistema TCON_QDN_SEC.
Requisitos:
● En su red se encuentra al menos un servidor DNS.
● Para la CPU S7‑1500 se ha configurado al menos un servidor DNS.
● El cliente TLS y el servidor TLS poseen todos los certificados necesarios.
Para establecer una conexión TCP segura en el cliente TLS, proceda del siguiente modo:
1. Cree un bloque de datos global en el árbol del proyecto.
2. Defina en el bloque de datos global una variable del tipo de datos TCON_QDN_SEC.
El ejemplo siguiente muestra el bloque de datos global "Data_block_1" en el que está
definida la variable "DNS ConnectionSEC" del tipo de datos TCON_QDN_SEC.

3. Ajuste los parámetros de la conexión TCP en la columna "Valor de arranque". Introduzca,
p. ej., en "ID" la ID local de la conexión TCP.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

779

Configuración de dispositivos y redes
1.3 Configurar redes
4. Ajuste los parámetros para secure communication en la columna "Valor de arranque".
– "ActivateSecureConn": Activación de secure communication para esta conexión. Si este
parámetro tiene el valor FALSE, los parámetros de seguridad siguientes son
irrelevantes. En tal caso es posible crear una conexión TCP o UDP no segura.
– "TLSServerReqClientCert": Solicitud de un certificado X.509-V3 del cliente TLS.
– "TLSServerCertRef": ID del certificado X.509-V3 propio.
7/66HUYHU
6
&HUWLILFDGRGH
GLVSRVLWLYR
FUHDGRHQ7,$3RUWDO

+HOOR
+HOOR

7/6&OLHQW
)UHPG3/&
&HUWLILFDGR&$GHO
6HUYLGRU7/6
H[SRUWDGRGH
7,$3RUWDO
9DOLGDFLµQ
&HUWLILFDGRGHGLVSRVLWL
YRGHO6HUYLGRU7/6

– "TLSClientCertRef": ID del certificado X.509-V3 (o de un grupo de certificados X.509V3) que el servidor TLS utiliza para validar la autenticación del cliente TLS. Si este
parámetro es 0, para validar la autenticación del cliente el servidor TLS utiliza todos los
certificados (CA) que hay actualmente cargados en el Certificate Store del servidor.
5. Cree una instrucción TCON en el editor de programas.
6. Interconecte el parámetro CONNECT de la instrucción TCON con la variable del tipo de
datos TCON_QDN_SEC.
En el siguiente ejemplo el parámetro CONNECT de la instrucción TCON está
interconectado con la variable "DNS connectionSEC" (tipo de datos TCON_QDN_SEC).

780

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Consulte también
Parámetros de conexión conforme a TCON_QDN_SEC (Página 133)
Ejemplos de administración de certificados (Página 756)

Secure OUC a través de interfaz CP
A continuación van a describirse las particularidades que deben tenerse en cuenta con Secure
Open User Communication a través de una interfaz CP. Al menos una estación es una estación
S7-1500 con los siguientes módulos:
● CPU S7-1500 con versión de firmware V2.0 o superior (excepto controlador por software
S7-1500)
● CP
– CP 1543-1 con versión de firmware V2.0 o superior
– CP 1545-1 con versión V1.0 o superior
– CP 1543SP-1 con versión de firmware V1.0 o superior
En una estación S7-1500 el CP actúa como cliente TLS (establecimiento activo de la conexión)
o como servidor TLS (establecimiento pasivo de la conexión).
El procedimiento fundamental y el concepto de utilización de Secure Communication a través
de una interfaz CP es similar a Secure Communication a través de las interfaces de las CPU
S7-1500. Esencialmente es necesario asignar los certificados al CP, en su función de servidor
TLS o de cliente TLS, y no a la CPU. De ahí que se apliquen otras reglas y procedimientos, que
van a describirse a continuación.

Gestión de certificados para CP
En general se aplica lo siguiente: en el administrador de certificados debe haber iniciado
sesión en los ajustes globales de seguridad. Tampoco es posible crear certificados
autofirmados sin haber iniciado sesión en los ajustes globales de seguridad. Es necesario
disponer de derechos suficientes como usuario (administrador o usuario con función
"Estándar" con derecho "Configurar seguridad").
Para crear o asignar certificados en el CP se parte del área "Seguridad> Propiedades de
seguridad". En esta área se inicia sesión en los ajustes globales de seguridad.
Procedimiento:
1. En la vista de redes de STEP 7 seleccione el CP, y en la ventana de inspección elija el área
"Seguridad > Propiedades de seguridad".
2. Haga clic en el botón "Inicio de sesión de usuario".
3. Inicie sesión con nombre de usuario y contraseña.
4. Active la opción "Activar funciones de seguridad".
Se inicializan las funciones de seguridad.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

781

Configuración de dispositivos y redes
1.3 Configurar redes
5. Haga clic en la primera fila de la tabla "Certificados de dispositivo" para crear un nuevo
certificado de dispositivo o para seleccionar un certificado de dispositivo ya existente.
6. Si el interlocutor de la comunicación es también una estación S7-1500, es necesario
asignar también al interlocutor un certificado de dispositivo con STEP 7, tal como se ha
descrito aquí o para la CPU S7-1500.

Ejemplo: establecer una conexión TCP segura entre dos CPU S7-1500 a través de interfaces CP
Para la comunicación TCP segura entre dos CP S7-1500 es necesario crear y parametrizar en
cada CPU un bloque de datos del tipo de datos de sistema TCON_IP_V4_SEC, y llamarlo
directamente en la instrucción.
Requisitos:
● Ambas CPU S7-1500 tienen una de las versiones de firmware indicadas anteriormente.
● Los CP tienen una de las versiones de firmware indicadas anteriormente.
● El cliente TLS y el servidor TLS poseen todos los certificados necesarios.
– Debe haberse creado para el CP un certificado de dispositivo (certificado de entidad
final) y hallarse en el almacén de certificados del CP. Si un interlocutor de comunicación
es un dispositivo de terceros (p. ej. un sistema MES o ERP), debe contar también con
un certificado de dispositivo.
– El certificado raíz (certificado CA) con el que está firmado el certificado de dispositivo del
interlocutor de comunicación debe hallarse en el almacén de certificados del CP o del
dispositivo de terceros. Si se utilizan certificados intermedios, es necesario asegurarse
de que en el dispositivo que va a validarse existe la ruta completa del certificado. Un
dispositivo utiliza estos certificados para validar el certificado de dispositivo del
interlocutor de comunicación.
● Además es necesario direccionar el interlocutor de comunicación fundamentalmente
mediante su dirección IPv4, no a través de su nombre de dominio.
La figura siguiente muestra los diferentes certificados de los dispositivos para el caso de que
ambos interlocutores se comuniquen a través de un CP. Además, la figura muestra la
transmisión de los certificados de dispositivo al establecer la conexión ("Hello").
&OLHQWH7/6 &3B
&HUWLILFDGRGH
GLVSRVLWLYR
&HUWLILFDGR&$GHO
6HUYLGRU7/6
9DOLGDFLµQ
&HUWLILFDGRGHGLVSRVLWL
YRGHOVHUYLGRU7/6

782

+HOOR
+HOOR

6HUYLGRU7/6 &3B
&HUWLILFDGRGH
GLVSRVLWLYR
&HUWLILFDGR&$GHO
FOLHQWH7/6
9DOLGDFLµQ
&HUWLILFDGRGHGLVSRVLWLYR
GHOFOLHQWH7/6

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración en el cliente TLS
Para establecer una conexión TCP segura en el cliente TLS, proceda del siguiente modo:
1. Cree un bloque de datos global en el árbol del proyecto.
2. Defina en el bloque de datos global una variable del tipo de datos TCON_IP_V4_SEC. Para
ello, en la columna "Tipo de datos" introduzca la secuencia de caracteres
"TCON_IP_V4_SEC".
El ejemplo siguiente muestra el bloque de datos global "Data_block_1" en el que está
definida la variable "SEC connection 1 TLS-Client" del tipo de datos TCON_IP_V4_SEC.
La ID de interfaz tiene el valor de la ID de hardware de la interfaz IE del CP local (cliente
TLS).

3. Ajuste los parámetros de la conexión TCP en la columna "Valor de arranque". P. ej.,
introduzca en "RemoteAdress" la dirección IPv4 del servidor TLS.
4. Ajuste los parámetros para secure communication en la columna "Valor de arranque".
– "ActivateSecureConn": activación de Secure Communication para esta conexión. Si
este parámetro tiene el valor FALSE, los parámetros de seguridad siguientes son
irrelevantes. En tal caso es posible crear una conexión TCP o UDP no segura.
– "TLSServerCertRef": introduzca el valor 2 (referencia al certificado CA del proyecto en
el TIA Portal (SHA256) o el valor 1 (referencia al certificado CA del proyecto en el TIA
Portal (SHA1)).
– "TLSClientCertRef": ID del certificado X.509-V3 propio.
5. Cree una instrucción TCON en el editor de programas.
6. Interconecte el parámetro CONNECT de la instrucción TCON con la variable del tipo de
datos TCON_IP_V4_SEC.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

783

Configuración de dispositivos y redes
1.3 Configurar redes

Configuración en el servidor TLS
Para establecer una conexión TCP segura en el servidor TLS, proceda del siguiente modo:
1. Cree un bloque de datos global en el árbol del proyecto.
2. Defina en el bloque de datos global una variable del tipo de datos TCON_IP_V4_SEC.
El ejemplo siguiente muestra el bloque de datos global "Data_block_1" en el que está
definida la variable "SEC connection 1 TLS-Server" del tipo de datos TCON_IP_V4_SEC.
La ID de interfaz tiene el valor de la ID de hardware de la interfaz IE del CP local (servidor
TLS).

3. Ajuste los parámetros de la conexión TCP en la columna "Valor de arranque". P. ej.,
introduzca en "RemoteAdress" la dirección IPv4 del cliente TLS.
4. Ajuste los parámetros para secure communication en la columna "Valor de arranque".
– "ActivateSecureConn": activación de Secure Communication para esta conexión. Si
este parámetro tiene el valor FALSE, los parámetros de seguridad siguientes son
irrelevantes. En tal caso es posible crear una conexión TCP o UDP no segura.
– "TLSServerReqClientCert": Solicitud de un certificado X.509-V3 del cliente TLS.
Introduzca el valor "true".
– "TLSServerCertRef": ID del certificado X.509-V3 propio.
– "TLSClientCertRef": Introduzca el valor 2 (referencia al certificado CA del proyecto
TIA Portal (SHA256) o el valor 1 (referencia al certificado CA del proyecto TIA Portal
(SHA1)).
5. Cree una instrucción TCON en el editor de programas.
6. Interconecte el parámetro CONNECT de la instrucción TCON con la variable del tipo de
datos TCON_IP_V4_SEC.

784

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes

Carga del dispositivo como estación nueva
Si se carga como estación nueva una configuración con certificados y Secure Open User
Communication configurada en el proyecto STEP 7, no se cargarán los certificados del CP, a
diferencia de lo que ocurre con los certificados de la CPU. Después de cargar el dispositivo
como estación nueva, en las tablas correspondientes de los CP ya no hay certificados de
dispositivo.
Después de la carga es necesario realizar de nuevo la configuración de los certificados. En
caso contrario, una nueva carga de la configuración provoca que se borren los certificados
originalmente existentes en el CP y que no funcione la Secure Communication.

Conexiones Secure OUC a través de interfaces de CPU y de CP - Características comunes
● Recursos de conexión:
No hay diferencias entre OUC y Secure OUC. Una conexión Secure OUC programada
consume un recurso de conexión, igual que una conexión OUC, independientemente de la
interfaz IE o PROFINET a través de la que se comunique la estación.
● Diagnóstico de conexiones:
No hay diferencias entre el diagnóstico de conexiones OUC y Secure OUC.
● Cargar en la CPU proyectos con conexiones Secure OUC:
Solo es posible con la CPU en STOP, suponiendo que se hayan cargado también
certificados.
Recomendación: Cargar en dispositivo > Hardware y software Motivo: garantizar la
coherencia entre el programa con Secure OUC, la configuración hardware y los certificados.
Los certificados se cargan con la configuración hardware, motivo por el que la carga
requiere que la CPU esté en STOP. Solo es posible recargar bloques que utilizan otras
conexiones Secure OUC si la CPU está en RUN, y si en el módulo ya se encuentran los
certificados necesarios.

Consulte también
Parámetros de conexión conforme a TCON_IP_V4_SEC (Página 129)
Crear certificados (Página 1080)
Ejemplos de administración de certificados (Página 756)

Secure OUC a través de correo electrónico
A continuación se describe cómo establecer con la instrucción de comunicación TMAIL_C una
conexión segura (SNMP over TLS) a un servidor de correo electrónico.

Establecer una conexión segura a un servidor de correo electrónico
Para establecer una conexión segura a un servidor de correo electrónico, el propio usuario
tiene que crear y parametrizar un bloque de datos del tipo de datos de sistema
TMAIL_V4_SEC, TMAIL_V6_SEC o TMAIL_QDN_SEC y llamarlo directamente en la
instrucción TMAIL_C.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

785

Configuración de dispositivos y redes
1.3 Configurar redes
Requisitos:
● CPU S7-1500 con versión de firmware V2.0 o superior, con módulo de comunicación
CP 1543-1 con versión de firmware V2.0 o superior
● CPU ET 200SP con versión de firmware V2.0 o superior, con módulo de comunicación
CP 1542SP-1 (IRC) con versión de firmware V1.0 o superior
● Se han asignado al CP (cliente TLS) todos los certificados CA del servidor de correo
(servidor TLS) y se ha cargado la configuración en la CPU.
Para crear una conexión segura de servidor de correo mediante la dirección IPv4 del servidor
de correo, proceda del siguiente modo:
1. Cree un bloque de datos global en el árbol del proyecto.
2. Defina en el bloque de datos global una variable del tipo de datos TMAIL_V4_SEC.
El ejemplo siguiente muestra el bloque de datos global "MailConnDB" en el que está
definida la variable "MailConnectionSEC" del tipo de datos TMAIL_V4_SEC.

3. Ajuste los parámetros de la conexión TCP en la columna "Valor de arranque". P. ej.,
introduzca la dirección IPv4 del servidor de correo en "MailServerAdress".

786

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.3 Configurar redes
4. Ajuste los parámetros para secure communication en la columna "Valor de arranque".
P. ej., introduzca la ID del certificado CA del interlocutor en "TLSServerCertRef".
– "ActivateSecureConn": Activación de secure communication para esta conexión. Si este
parámetro tiene el valor FALSE, los parámetros de seguridad siguientes son
irrelevantes. En tal caso es posible crear una conexión TCP o UDP no segura.
– "TLSServerCertRef": Referencia al certificado X.509 V3 (CA) del servidor de correo
electrónico, que será utilizado por el cliente TLS para validar la autenticación del
servidor de correo electrónico.
&OLHQWH7/6 &3
&HUWLILFDGR&$GH
6HUYLGRU7/6
LPSRUWDGR\DVLJQDGR

+HOOR
+HOOR

6HUYLGRU7/6 VHUYLGRUGH
FRUUHRHOHFWUµQLFR
&HUWLILFDGRGH
GLVSRVLWLYR

9DOLGDFLµQ
&HUWLILFDGRGH
GLVSRVLWLYRGH
6HUYLGRU7/6

5. Cree una instrucción TMAIL_C en el editor de programas.
6. Interconecte el parámetro MAIL_ADDR_PARAM de la instrucción TMAIL_C con la variable
del tipo de datos TMAIl_V4_SEC.
En el ejemplo siguiente, el parámetro MAIL_ADDR_PARAM de la instrucción TMAIL_C
está interconectado con la variable "MailConnectionSEC" (tipo de datos TMAIL_V4_SEC).

Consulte también
Parámetros de conexión conforme a TCON_QDN_SEC (Página 133)
Ejemplos de administración de certificados (Página 756)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

787

Configuración de dispositivos y redes
1.4 Crear configuraciones

1.4

Crear configuraciones

1.4.1

Configuración de sistemas de automatización

1.4.1.1

Funcionamiento de las CPUs S7-300/400

Estados operativos
Principios básicos de los estados operativos de CPUs S7
Los estados operativos describen el comportamiento de la CPU. Los estados operativos se
pueden consultar y evaluar en todo momento para la programación del arranque, la
comprobación del controlador y el diagnóstico de errores.
Las CPU S7 de las distintas familias, como, p. ej., S7-300, S7-400, ET 200S, ET 200Pro y
también WinLC (controlador basado en PC) o Embedded Controller, tienen los estados
operativos siguientes:
● STOP
● ARRANQUE
● RUN
● PARADA
En estos estados operativos, la CPU puede comunicarse a través de sus interfaces (p. ej., a
través de una interfaz MPI).

Estado operativo "STOP"
En el estado operativo "STOP", la CPU comprueba si están presentes todos los módulos
configurados o utilizados mediante direccionamiento estándar. En función de esto, la CPU
pone la periferia en un estado básico predeterminado. En el estado operativo "STOP", no se
procesa el programa de usuario.
Consulte también: Estado operativo "STOP" (Página 790)

Estado operativo "ARRANQUE"
En el estado operativo "ARRANQUE" se distingue entre los tipos de arranque "Rearranque
completo (en caliente)", "Rearranque normal" y "Arranque en frío".
Consulte también: Estado operativo "ARRANQUE" (Página 791)

Estado operativo "RUN"
En el estado operativo "RUN", la CPU procesa el programa de usuario, actualiza las entradas
y salidas y procesa alarmas y mensajes de error.

788

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Consulte también: Estado operativo "RUN" (Página 800)

Estado operativo "PARADA"
En el estado operativo "PARADA" se interrumpe el procesamiento del programa de usuario. El
estado operativo "PARADA" sólo se consigue al realizar pruebas con la programadora.
Consulte también: Estado operativo "PARADA" (Página 800)

Otros estados operativos
Si la CPU no está lista para funcionar, se encuentra en uno de estos dos estados operativos:
● Sin tensión, es decir, la tensión de red está desconectada.
● Avería, es decir, se ha producido un fallo que no se puede solventar.
Compruebe si la CPU realmente está averiada. Para ello, póngala en "STOP" y apague y
encienda el interruptor de alimentación. Para analizar el error, lea el búfer de diagnóstico
cuando arranque la CPU. Si la CPU no arranca, cámbiela.

Transiciones de estado operativo
Resumen
La figura siguiente muestra los estados operativos y las transiciones de CPUs S7-300:




6723




$55$148(

581


La tabla siguiente muestra las condiciones en las que cambian los estados operativos:
N.º

①

②

Transición de estado operativo Condiciones
STOP

Después de conectar la tensión de alimentación, la CPU está en estado operativo
"STOP", determina el tipo de arranque solicitado y adopta el siguiente estado ope‐
rativo.

STOP → ARRANQUE

La CPU pasa al estado operativo "ARRANQUE" en los siguientes casos:
● La CPU se pone en "RUN" desde el selector de modo o la programadora.
● Después de disparar automáticamente un tipo de arranque mediante "Conexión
(POWER ON)".
● Se ejecuta la función de comunicación "RESUME" o "START".

③

En los dos últimos casos, el selector de modo debe estar en "RUN".
ARRANQUE → STOP

La CPU pasa al estado "STOP" en los casos siguientes:
● Durante el arranque se detecta un error.
● La CPU se pone en "STOP" desde el selector de modo o la programadora.
● Se procesa un comando STOP en el OB de arranque.
● Se ejecuta la función de comunicación "STOP".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

789

Configuración de dispositivos y redes
1.4 Crear configuraciones
N.º

④
⑤

Transición de estado operativo Condiciones
ARRANQUE → RUN

Si el arranque es correcto, la CPU pasa a "RUN".

RUN → STOP

La CPU pasa al estado "STOP" en los casos siguientes:
● En el estado RUN se detecta un error y el correspondiente OB no está cargado.
● La CPU se pone en "STOP" desde el selector de modo o la programadora.
● Se procesa un comando STOP en el programa de usuario.
● Se ejecuta la función de comunicación "STOP".

Prioridad de los estados operativos
Función
Si se solicitan al mismo tiempo varios cambios de estado operativo, se cambiará al estado
operativo que tenga una mayor prioridad. Así, por ejemplo, si el selector de modo está en
"RUN" y desde la programadora se intenta cambiar la CPU a "STOP", la CPU pasa a "STOP",
ya que este estado operativo tiene la máxima prioridad.
Prioridad

Estado operativo

Máxima

STOP (Página 790)
PARADA (Página 800)
ARRANQUE (Página 791)

Mínima

RUN (Página 800)

Estado operativo "STOP"
Función
En estado operativo "STOP" no se procesa el programa de usuario. Todas las salidas se fijan
a los valores sustitutivos, dejando el proceso controlado en un estado operativo seguro. La
CPU comprueba los puntos siguientes:
● Hardware, p. ej. si todos los módulos están disponibles
● Si la CPU se rige por los valores predeterminados o si hay juegos de parámetros
● Si se cumplen las condiciones marco para el comportamiento de arranque programado
En el estado STOP se pueden recibir datos globales. Además, es posible la comunicación
pasiva unilateral mediante bloques de función del sistema de comunicación para las
conexiones configuradas y mediante funciones del sistema de comunicación para las
conexiones no configuradas.

Consulte también
Principios básicos de los estados operativos de CPUs S7 (Página 788)

790

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Estado operativo "ARRANQUE"
Principios básicos del estado operativo "ARRANQUE"
Función
Antes de que la CPU, tras conectarse, empiece a procesar el programa de usuario, se ejecuta
un programa de arranque. En dicho programa se pueden definir determinados valores
predeterminados para el programa cíclico programando de forma adecuada los OBs de
arranque.
Existen los siguientes tipos de arranque:
● Rearranque completo/arranque en caliente
● Rearranque normal
● Arranque en frío

Particularidades
Tenga en cuenta los puntos siguientes para el estado operativo "ARRANQUE":
● Se procesa el programa en el OB de arranque. El OB 100 es para "Rearranque completo
(en caliente)", el OB 101 para rearranque y el OB 102 para "Arranque en frío".
● No se procesan programas controlados por tiempo o alarmas.
● Los temporizadores se actualizan.
● El contador de horas de funcionamiento está en marcha.
● Las salidas de los módulos están bloqueadas.

Consulte también
Principios básicos de los estados operativos de CPUs S7 (Página 788)
Rearranque normal (Página 793)
Arranque en frío (Página 791)
OBs de arranque (OB 100, OB 101 y OB 102) (Página 954)
Vista general completa del arranque (Página 798)

Arranque en frío
Arranque en frío
En un rearranque en frío son repuestos todos los datos (imagen del proceso, marcas,
temporizadores, contadores y bloques de datos) a los valores iniciales depositados en el
programa (memoria de carga), independientemente de si fueron parametrizados como datos
remanentes o no remanentes.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

791

Configuración de dispositivos y redes
1.4 Crear configuraciones
El programa vuelve a ejecutarse desde el principio (OB de arranque u OB 1).

Rearranque completo (en caliente)
Rearranque completo (en caliente) permitido
En los siguientes casos se puede ejecutar un "Rearranque completo (en caliente)":
● Después del borrado total
● Después de cargar el programa de usuario con la CPU en estado STOP
No se puede realizar un rearranque completo (en caliente) si el sistema ha solicitado un
borrado total.

Rearranque completo (en caliente) manual
El rearranque completo (en caliente) manual se activa mediante:
● El selector de modo
● Un comando de menú de la PG o funciones de comunicación si el selector de modo está en
"RUN".

Rearranque completo (en caliente) automático
En los siguientes casos puede producirse un rearranque completo (en caliente) automático al
conectar la alimentación ("POWER ON"):
● Al desconectar la alimentación ("POWER OFF"), la CPU no estaba en "STOP".
● El selector de modo está en "RUN".
● El rearranque completo (en caliente) de la CPU se ha interrumpido debido a un corte en la
alimentación eléctrica. Esto es independiente de la parametrización del tipo de arranque.

Rearranque completo (en caliente) automático sin respaldo
Si se utiliza la CPU sin pila de respaldo, por ejemplo, porque sea necesario el funcionamiento
sin mantenimiento, tras conectar la alimentación o restablecer la tensión después de la
desconexión se efectúa automáticamente un borrado total de la CPU y luego un rearranque
completo (en caliente). Para poder volver a copiar el programa de usuario en la memoria de
trabajo, éste debe estar en la Flash-EPROM (Memory Card).

792

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Rearranque normal
Rearranque
Este tipo de arranque sólo es posible en el S7-400. El rearranque normal tiene las
características siguientes:
● En el rearranque normal conservan su último valor válido todos los datos, incluida la imagen
del proceso.
● La ejecución del programa prosigue exactamente con la instrucción que fue interrumpida.
● Las salidas no son modificadas hasta que acaba el ciclo actual.
● En caso de interrumpirse la alimentación, sólo se podrá efectuar un rearranque normal si
el funcionamiento está respaldado.
Cuando se produce un corte de alimentación en RUN y seguidamente retorna la tensión, las
CPUs S7-400 ejecutan una ruta de inicialización y a continuación efectúan automáticamente
un rearranque normal. En caso de rearranque normal, el programa de usuario prosigue en el
mismo punto en el que quedó interrumpido el procesamiento. La parte del programa de usuario
que no se había procesado antes del corte de la alimentación eléctrica se denomina resto del
ciclo. El resto del ciclo puede contar con partes del programa controladas por tiempo o alarmas.
Por principio, un rearranque normal sólo está permitido si el programa de usuario no se ha
modificado en el estado STOP (p. ej., por recargar un bloque modificado) y si otros motivos no
hacen necesario un rearranque completo (en caliente). Se distingue entre rearranques de tipo
manual y automático.

Rearranque manual
Un rearranque manual sólo resulta posible si la CPU cuenta con la parametrización
correspondiente y tras los siguientes motivos de STOP:
● El selector de modo ha pasado de RUN a STOP
● STOPs programados por el usuario, STOPs tras llamada a OBs no cargados
● El estado STOP ha sido establecido por la programadora o por las funciones de
comunicación
Un rearranque manual se puede disparar con un comando de menú desde la programadora o
mediante funciones de comunicación (si el selector de modo se encuentra en RUN o en RUNP). Para ello es imprescindible que el rearranque no se encuentre bloqueado por intervención
(parámetros de arranque).
● Si se ha parametrizado el juego de parámetros de la CPU de rearranque manual

Rearranque automático
El rearranque automático se dispara al producirse la conexión (POWER ON) si la CPU no
estaba en STOP o PARADA cuando tuvo lugar la desconexión (POWER OFF). Para ello es
imprescindible que el rearranque no se encuentre bloqueado por intervención (parámetros de
arranque).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

793

Configuración de dispositivos y redes
1.4 Crear configuraciones

Comportamiento de remanencia tras un corte de la alimentación
Áreas de datos remanentes tras un corte de la alimentación
Para evitar pérdida de datos en caso de corte de suministro, se puede determinar la
remanencia de marcas, temporizadores, contadores y áreas de bloques de datos. Si el tipo de
arranque es "Rearranque completo (en caliente)" —que es el valor predeterminado—, al
restablecerse el suministro eléctrico se producirá un "rearranque automático con memoria".
Las CPUs S7-300 y S7-400 reaccionan de manera distinta al producirse el retorno de la tensión
tras un fallo de red.
Las CPUs S7-300 sólo conocen el tipo de arranque "Rearranque completo". Para evitar la
pérdida de datos en caso de corte de suministro, STEP 7 permite determinar la remanencia de
marcas, temporizadores, contadores y áreas de bloques de datos. Al producirse el retorno de
la tensión se efectúa un "rearranque completo automático con memoria".
Las CPUs S7-400 reaccionan frente al retorno de la tensión con un rearranque completo (en
caliente) (tras la conexión (POWER ON) respaldada o no respaldada) o con un rearranque
(posible únicamente tras conexión (POWER ON) respaldada), según la parametrización.

Comportamiento de remanencia en las CPUs con respaldo
La tabla siguiente muestra el comportamiento de remanencia en la memoria de trabajo de las
CPUs S7-300 y S7-400 con respaldo en caso de "Rearranque completo (en caliente)" y
"Arranque en frío":
Datos

Rearranque completo (en
caliente)

Arranque en frío

Rearranque

Bloques en la memoria de carga

X

X

X

DB en la memoria de trabajo

X

0

X

Marcas, temporizadores, conta‐
dores
parametrizados como remanen‐
tes

X

0

X

Marcas, temporizadores, conta‐
dores
parametrizados como no rema‐
nentes

0

0

X

X : Los datos se conservan
0: Los datos vuelven a su valor original o se borran (contenido de los DBs)

Comportamiento de remanencia en las CPUs sin respaldo
En las CPUs S7-400 sin respaldo no se permite efectuar rearranques.

794

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
La siguiente tabla muestra el comportamiento de remanencia en la memoria de trabajo de las
CPUs S7-300 sin respaldo en caso de "Rearranque completo (en caliente)" y "Arranque en
frío":
Datos

Rearranque completo (en caliente)

Arranque en frío

S7-300

S7-400

S7-300

S7-400

Bloques en la memoria de carga

VC

VC

VC

VC

DB en la memoria de trabajo
parametrizado como remanente

VX

no es posible

V

no es posible

DB en la memoria de trabajo
parametrizado como no rema‐
nente

V

V

V

V

Marcas, temporizadores, conta‐
dores
parametrizados como remanen‐
tes

X

0

0

0

Marcas, temporizadores, conta‐
dores
parametrizados como no rema‐
nentes

0

0

0

0

X : Los datos se conservan
0: Los datos vuelven a su valor original o se borran (contenido de los DBs)
V: Los datos se restauran al valor predeterminado de la memoria EPROM
VC: El bloque lógico de la EPROM se conserva; si el bloque lógico está sobrecargado se pierde
VX: El bloque de datos sólo se conserva si los datos remanentes presentes en la EPROM se toman de la NV-RAM (los
bloques de datos cargados o generados en la RAM se pierden)

Actividades de arranque
Resumen
La tabla siguiente muestra qué actividades realiza la CPU durante el arranque:
Actividades en el orden de
procesamiento

en caso de arranque
en frío

en caso de rearranque

Borrar la pila de interrupcio‐ X
nes y bloques

X

0

Borrar marcas, temporiza‐
dores y contadores no re‐
manentes

X

0

0

Borrar todas las marcas,
temporizadores y contado‐
res

0

X

0

Borrar la memoria imagen
de proceso de las salidas

X

X

parametrizable

Restablecer las salidas de
los módulos de señales

X

X

parametrizable

Rechazar alarmas de proce‐ X
sos

X

0

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

en caso de rearranque
(en caliente)

795

Configuración de dispositivos y redes
1.4 Crear configuraciones
Actividades en el orden de
procesamiento

en caso de rearranque
(en caliente)

en caso de arranque
en frío

en caso de rearranque

Rechazar alarmas de retar‐ X
do

X

0

Rechazar alarmas de diag‐
nóstico

X

X

X

Actualizar lista de estado
del sistema (SZL)

X

X

X

Evaluar los parámetros del X
módulo y transferirlos al mó‐
dulo o enviar valores están‐
dar

X

X

Procesamiento del OBs de
arranque correspondiente

X

X

X

Procesar el resto del ciclo
(parte del programa de
usuario que no ha podido
terminar de procesarse de‐
bido a una desconexión
"POWER OFF")

0

0

X

Actualizar la memoria ima‐
gen de proceso de las en‐
tradas

X

X

X

Liberar salidas digitales
X
(cancelar OD (Output Disa‐
bled) de la señal) tras la
transición del estado opera‐
tivo a "RUN"

X

X

X : La actividad se lleva a cabo
0: La actividad no se lleva a cabo

Consulte también
Vista general completa del arranque (Página 798)

Cancelación de un arranque
Causas de la cancelación
Si durante el arranque se producen errores, se cancela el arranque y la CPU pasa o
permanece en "STOP". Esto tiene las siguientes consecuencias sobre el estado operativo
Rearranque completo (en caliente):
● Hay que repetir el rearranque completo (en caliente) interrumpido.
● Si el rearranque ya ha comenzado, resulta posible tanto un rearranque completo (en
caliente) como un rearranque.

796

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
● El rearranque completo (en caliente) o rearranque no se efectúa, o bien se interrumpe, si
se dan las condiciones siguientes:
– Si el selector de modo de la CPU está en "STOP".
– Si se solicita un borrado total.
– Si hay una Memory Card con ID de aplicación no permitida.
– Si en el modo de procesador único hay enchufada más de una CPU.
– Si el programa de usuario contiene un bloque de organización bloqueado o desconocido
para la CPU.
– Tras la conexión del suministro eléctrico, si la CPU constata que no están conectados
realmente todos los módulos enumerados en la configuración creada con STEP 7 (no se
permite parametrizar la diferencia teórico-real).
– Si en la parametrización de los módulos se producen errores.
● El rearranque no se realiza, o bien se cancela, si se dan las condiciones siguientes:
– Si previamente se había efectuado un borrado total de la CPU (tras un borrado total, sólo
resulta posible el rearranque completo (en caliente)).
– Si se ha superado el límite de interrupción (el tiempo de interrupción es el tiempo que
transcurre desde que se sale de RUN hasta que se ha procesado el OB de arranque,
tiempo de ciclo restante incluido).
– Si la configuración de módulo ha cambiado (p. ej., sustitución de módulo).
– Si la parametrización sólo permite un rearranque completo (en caliente).
– Si en el STOP se han cargado, borrado o modificado bloques.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

797

Configuración de dispositivos y redes
1.4 Crear configuraciones

Vista general completa del arranque
Proceso
La figura siguiente muestra las actividades de la CPU en los estados operativos "STOP",
"ARRANQUE" y "RUN".

798

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
6723

3HWLFLµQGHXQ
DUUDQTXHHQIU¯R

%RUUDUGDWRVGH
XVXDULR,3(,36
PDUFDV
WHPSRUL]DGRUHV
\FRQWDGRUHV
UHPDQHQWHV\QR
UHPDQHQWHV

$55$148(

581

$UUDQTXHHQIU¯R2%

,QLFLDOL]DUWRGRV
ORV'%VFRQ
YDORUHVGHFDUJD
7UDQVIHULU,36
DORVPµGXORV
GHSHULIHULD

6DOLGDVGH
SHULIHULD
&RQPXWDGDVDO
HVWDGRVHJXUR

6DOLGDVGH
SHULIHULDIXHUD
GHODPHPRULD
LPDJHQGH
SURFHVRGH
ODVVDOLGDV
&RQPXWDGDV
DOHVWDGR
VHJXUR

9«DVH

3HWLFLµQGHXQ
UHDUUDQTXH
FRPSOHWRDUUDQTXH
HQFDOLHQWH

%RUUDUGDWRVGH
XVXDULR,3(,36
\PDUFDV
WHPSRUL]DGRUHV\
FRQWDGRUHVQR
UHPDQHQWHV

5HDUUDQTXH
FRPSOHWRDUUDQTXHHQ
FDOLHQWH2%

9«DVH

6HPDQWLHQHQ
PDUFDVWHPSRUL
]DGRUHVFRQWDGR
UHV\'%V
UHPDQHQWHV
9«DVH
6DOLGDVGH
SHULIHULD

+DELOLW
DFLµQGH
ODVVDOLGDV

&RQPXWDGDVDO
HVWDGRVHJXUR

9«DVH

/HHUPHPRULDLPDJHQ
GHSURFHVRGHODV
HQWUDGDV ,3(

9«DVH

3HWLFLµQGH
UHDUUDQTXH

'DWRVGHOXVXDULR
6HFRQVHUYDQ
,3(,36PDUFDV
WHPSRUL]DGRUHV
FRQWDGRUHV\'%V
UHPDQHQWHV\QR
UHPDQHQWHV

(GLWDUSURJUDPDGH
XVXDULR

5HDUUDQTXH
2%

9«DVH

7LHPSRGHFLFOR
UHVWDQWH

(PLWLUPHPRULD
LPDJHQGHSURFHVRGH
ODVVDOLGDV ,36

9«DVH
6DOLGDVGH
SHULIHULD
&RQPXWDGDVDO
HVWDGRVHJXUR

,QLFLDOL]DUODPHPRULD
LPDJHQGHSURFHVRGH
ODVVDOLGDV\ODVVDOLGDV
GHODSHULIHULD
3DUDPHWUL]DEOH

9«DVH

6723

V¯

/¯PLWHGHWLHPSRGH
LQWHUUXSFLµQ
([FHGLGR"

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019
(OFRPSRUWDPLHQWRGHSHQGHGHODVIXQFLRQHVGHXVXDULR

QR

799

Configuración de dispositivos y redes
1.4 Crear configuraciones
Leyenda de la figura:
1. Todas las salidas de periferia están conectadas por hardware en el estado seguro a través
de los módulos de periferia (valor predeterminado = "0"). Esto es independiente de si se
utilizan en el programa de usuario dentro o fuera del área de memoria imagen de proceso.
En caso de utilizar módulos de señales sustituibles, el comportamiento de las salidas se
puede parametrizar, p. ej., mantener el último valor.
2. Es necesario para el procesamiento del resto del ciclo.
3. También los OBs de alarma disponen de una memoria imagen de proceso actual de las
entradas en la primera llamada.
4. El estado de las salidas de periferia centralizadas y descentralizadas en el primer ciclo del
programa de usuario se puede definir de la siguiente forma:
– Utilizar módulos de salida parametrizables para aplicar valores sustitutivos o mantener
el último valor.
– En caso de rearranque: Activar el parámetro de arranque de CPU "Inicializar salidas al
efectuar un rearranque" para emitir un "0" (ajuste predeterminado).
– Predefinir las salidas en el OB de arranque (OB 100, OB 101, OB 102).
5. En los sistemas S7-300 sólo se conservan las áreas de DB configuradas como remanentes.

Estado operativo "RUN"
Función
En estado operativo "RUN" se procesa el programa cíclico, controlado por tiempo y por
alarmas:
● Se lee la imagen de proceso de las entradas.
● Se procesa el programa de usuario.
● Se emite la memoria imagen de proceso de las salidas.
El intercambio activo de datos entre CPUs mediante la comunicación de datos globales (tabla
de datos globales) y mediante instrucciones de comunicación para conexiones configuradas
e instrucciones de comunicación para conexiones no configuradas sólo resulta posible en el
estado RUN.

Consulte también
Principios básicos de los estados operativos de CPUs S7 (Página 788)

Estado operativo "PARADA"
Función
El estado operativo "PARADA" ocupa una posición especial, ya que sólo se utiliza para
pruebas en "ARRANQUE" o "RUN".

800

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Estado operativo "PARADA":
● Todos los temporizadores se congelan. Los temporizadores y contadores de horas de
funcionamiento no se procesan, los tiempos de vigilancia y los tiempos base de los niveles
controlados por tiempo se detienen.
● El reloj de tiempo real sigue en marcha.
● Las salidas no están habilitadas, pero se pueden habilitar para realizar pruebas.
● Se pueden controlar las entradas y salidas.
● En caso de corte y restablecimiento de la alimentación, las CPUs respaldadas pasan de
"PARADA" a "STOP" y no efectúan ningún "Rearranque completo (en caliente)". Las CPUs
no respaldadas realizan un "Rearranque completo (en caliente)" automático no respaldado
al restablecerse el suministro.
● Se pueden recibir datos globales. Además, es posible la comunicación pasiva unilateral
mediante SFBs de comunicación para las conexiones configuradas y mediante SFCs de
comunicación para las conexiones no configuradas.

Consulte también
Principios básicos de los estados operativos de CPUs S7 (Página 788)

Principios básicos del borrado total
Función
En el estado STOP se puede efectuar un borrado total de la CPU. El borrado total se puede
realizar manualmente con el selector de modo (MRES) o desde la programadora, p. ej. antes
de cargar un programa de usuario.
Con el borrado total, la CPU vuelve a su "estado original". Esto significa que:
● El programa de usuario se borra íntegramente de la memoria de trabajo y de la memoria de
carga, y lo mismo ocurre con todas las áreas de operandos.
● Los parámetros de sistema y los parámetros de la CPU y del módulo vuelven a su
configuración estándar. Los parámetros MPI configurados antes del borrado total se
conservan.
● Si hay insertada una Memory Card (Flash-EPROM) o Micro Memory Card, la CPU copia el
programa de usuario de la Memory Card en la memoria de trabajo. Si los datos de
configuración también están guardados en la Memory Card, también se copian los
parámetros de la CPU y del módulo.
● El búfer de diagnóstico, los parámetros MPI, la hora y el contador de horas de
funcionamiento no se ponen a cero.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

801

Configuración de dispositivos y redes
1.4 Crear configuraciones

Áreas de memoria
Qué hay que saber sobre las Micro Memory Cards para S7-300
Función de la Micro Memory Card
La Micro Memory Card SIMATIC es un módulo de memoria especial para una CPU S7-300. En
principio, la Micro Memory Card se puede utilizar como memoria de carga o como soporte de
datos portátil.
STEP 7 V11 permite su uso como memoria de carga.
Para el funcionamiento, la Micro Memory Card SIMATIC debe estar insertada en la CPU.

ATENCIÓN
Formatear la Micro Memory Card
Si se formatea la Micro Memory Card con Windows, p. ej. con un lector de tarjetas habitual,
la Micro Memory Card quedará inutilizada como medio de almacenamiento para una CPU S7.

¿Qué se puede almacenar en una Micro Memory Card SIMATIC?
En una Micro Memory Card se puede almacenar el programa de usuario (bloques y datos de
sistema).
La Micro Memory Card también se puede utilizar para actualizar el firmware o para hacer una
copia de seguridad del firmware de la CPU.

802

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Transferir objetos del proyecto a la Micro Memory Card
Si la Micro Memory Card está insertada en la programadora o en un programador de EPROM
externo, se pueden copiar en ella los siguientes objetos desde el árbol del proyecto:
● Bloques individuales (posibilidad de selección múltiple)
En este caso, se ofrece una transferencia coherente, es decir, se tiene en cuenta la
interdependencia de los bloques entre sí debida a las llamadas.
● PLC
En este caso, todos los objetos relevantes para la ejecución, entre ellos, los bloques y la
configuración del hardware, se transfieren a la Micro Memory Card, al igual que sucede al
cargar.
La transferencia de los objetos se puede realizar mediante la función Drag&Drop o con el
comando "Escribir en tarjeta de memoria" del menú "Proyecto".

Transferir objetos de la Micro Memory Card al proyecto
Los bloques individuales (posibilidad de selección múltiple) se transfieren al proyecto mediante
la función Arrastrar y colocar. Las configuraciones hardware no pueden transferirse de la
Memory Card al proyecto.

Copia de seguridad del firmware en la Micro Memory Card
Recomendamos hacer una copia de seguridad del firmware para casos de emergencia.
Para ello hay que insertar una Micro Memory Card vacía en la CPU y seguir un procedimiento
determinado: La descripción se puede encontrar en la documentación de la CPU.
Documentación del S7-300 (http://support.automation.siemens.com/WW/view/de/
13008499/0/es)

Actualizar el firmware con una Micro Memory Card
La versión más reciente del firmware se puede descargar de Internet como archivo *.UPD en
las páginas de Service & Support:
http://support.automation.siemens.com (http://support.automation.siemens.com)
Guarde los archivos de firmware en el disco duro.
Para guardar el archivo en la Micro Memory Card, seleccione en el menú "Proyecto" el
comando "Crear actualización de Firmware en tarjeta de memoria".
A continuación siga las instrucciones del portal Service & Support para actualizar el firmware
de la CPU.

Consulte también
Áreas de memoria de las CPUs S7-300 (Página 806)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

803

Configuración de dispositivos y redes
1.4 Crear configuraciones

Qué hay que saber sobre las Memory Cards para el S7-400
Función de la Memory Card
En todas las CPUs S7-400 se puede introducir una Memory Card. Esta sirve como ampliación
de la memoria de carga. Dependiendo del tipo de Memory Card utilizada, el programa de
usuario se conserva en la Memory Card aunque se desconecte la tensión.

Tipos de Memory Card
● Tarjeta RAM: Exclusivamente como ampliación de la memoria de carga integrada.
● Tarjeta FLASH: Para almacenar el programa de usuario aunque se desconecte la tensión
sin tensión de respaldo o fuera de la CPU.

Transferir objetos del proyecto a la Memory Card
Si la Memory Card está insertada en la programadora o en un programador de EPROM
externo, se pueden copiar en ella los siguientes objetos desde el árbol del proyecto:
● Bloques individuales (posibilidad de selección múltiple)
En este caso, se ofrece una transferencia coherente, es decir, se tiene en cuenta la
interdependencia de los bloques por llamadas.
● PLC
En este caso, todos los objetos relevantes para la ejecución, como los bloques y la
configuración hardware, entre otros, se transfieren a la Memory Card, al igual que durante
el proceso de carga.
La transferencia de los objetos se puede realizar mediante la función Drag&Drop o con el
comando "Escribir en tarjeta de memoria" del menú "Proyecto" y siguiendo las instrucciones
que aparezcan en la pantalla.

Transferir objetos de la Memory Card al proyecto
Los bloques individuales (posibilidad de selección múltiple) se transfieren al proyecto mediante
la función Drag&Drop. Las configuraciones hardware no se pueden transferir de la Memory
Card al proyecto.

804

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Cargar un programa de usuario en la Memory Card
El comando "Cargar programa de usuario en Memory Card" del menú "Online" permite guardar
todo el programa de usuario en la tarjeta FLASH. La tarjeta FLASH se encuentra en la CPU.
Antes de cargar, se borra todo lo que haya en la tarjeta FLASH.
● La CPU está en estado operativo STOP.
● Sólo se pueden cargar tarjetas FLASH con este comando de menú

Actualizar firmware con una Memory Card
La versión más reciente del firmware se puede descargar de Internet como archivo *.UPD en
las páginas de Service & Support:
http://support.automation.siemens.com (http://support.automation.siemens.com)
Guarde los archivos de firmware en el disco duro.
Para guardar el archivo en la Memory Card, seleccione en el menú "Proyecto" el comando
"Crear Memory Card con actualización de firmware".
A continuación, siga las instrucciones del portal Service & Support para actualizar el firmware
con la CPU.

Consulte también
Áreas de memoria de las CPUs S7-400 (Página 808)

Distribución de las áreas de memoria
Distribución
La memoria de las CPUs S7 puede distribuirse en tres áreas:
● Memoria de carga (según el tipo de CPU o de Memory Card será memoria RAM, EPROM
o Flash)
● Memoria de trabajo (RAM integrada)
● Memoria de sistema (RAM integrada)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

805

Configuración de dispositivos y redes
1.4 Crear configuraciones

Áreas de memoria S7-300
Áreas de memoria de las CPUs S7-300

&38

0HPRULDGHFDUJD
VHHQFXHQWUDHQOD
0LFUR0HPRU\&DUG6,0$7,&

6,(0(16
6,0$7,&
0LFUR
0HPRU\
&DUG

Las tres áreas de memoria de la CPU

0HPRULDGHVLVWHPD
0HPRULDGHWUDEDMR

Memoria de carga
La memoria de carga se encuentra en la Micro Memory Card SIMATIC y equivale exactamente
al tamaño de la Micro Memory Card SIMATIC. Sirve para guardar bloques lógicos y bloques de
datos, así como información del sistema (configuración, enlaces, parámetros del módulo, etc.).
Los bloques que no se consideran relevantes para la ejecución se guardan exclusivamente en
la memoria de carga. Además es posible almacenar todos los datos de configuración de un
proyecto en la SIMATIC Micro Memory Card.
Nota
La transferencia de programas de usuario y, por consiguiente, el funcionamiento de la CPU
sólo es posible si hay una SIMATIC Micro Memory Card insertada en la CPU.

Memoria de sistema
La memoria del sistema está integrada en la CPU y no se puede ampliar.
Contiene
● Las áreas de operandos Marcas, Temporizadores y Contadores
● Las imágenes del proceso de entradas y salidas
● Los datos locales

Memoria de trabajo
La memoria de trabajo está integrada en la CPU y no se puede ampliar. Sirve para procesar
el código y los datos del programa de usuario. Este procesamiento tiene lugar exclusivamente
en el área de la memoria de trabajo y en la memoria del sistema.

806

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Consulte también
Qué hay que saber sobre las Micro Memory Cards para S7-300 (Página 802)

Remanencia de la memoria de carga, sistema y trabajo
Su CPU posee una memoria remanente libre de mantenimiento, es decir, no se requiere pila
de respaldo para el funcionamiento. Gracias a la remanencia se mantiene el contenido de la
memoria remanente también tras desconectar la alimentación y tras un rearranque completo
(en caliente).

Datos remanentes en la memoria de carga
Su programa en la memoria de carga siempre es remanente: Se almacena ya durante la carga
en la Micro Memory Card SIMATIC de forma protegida contra cortes de alimentación y un
borrado total.

Datos remanentes en la memoria del sistema
En el caso de marcas, temporizadores y contadores, es posible determinar mediante
configuración (Propiedades de la CPU) qué partes deben ser remanentes y cuáles deben
inicializarse a "0" en el rearranque completo (en caliente).
El búfer de diagnóstico, la dirección MPI y la velocidad de transferencia, así como el contador
de horas de funcionamiento suelen almacenarse en el área de memoria remanente de la CPU.
Gracias a la remanencia de la dirección MPI y la velocidad de transferencia se garantiza que
la CPU pueda seguir comunicándose después de una caída de tensión, de un borrado total o
de pérdida de los parámetros de comunicación (al retirar la Micro Memory Card SIMATIC o
borrar los parámetros de comunicación).

Datos remanentes en la memoria de trabajo
Así, el contenido de los DBs remanentes es fundamentalmente remanente en caso de
rearranque completo y de desconexión y conexión. Los bloques de datos remanentes se
pueden cargar en la memoria de trabajo hasta el límite de remanencia máximo de dicha
memoria.
Cuando se realiza un rearranque completo o una desconexión y conexión, los DBs no
remanentes se inicializan con sus valores iniciales de la memoria de carga. Los bloques de
datos no remanentes y los bloques de código se pueden cargar hasta el límite máximo de la
memoria de trabajo.
El tamaño de la memoria de trabajo remanente (para bloques de datos remanentes) de la CPU
se puede encontrar en los datos técnicos de la CPU en cuestión.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

807

Configuración de dispositivos y redes
1.4 Crear configuraciones

Áreas de memoria S7-400
Áreas de memoria de las CPUs S7-400
Distribución de las áreas de memoria
La memoria de las CPUs S7-400 puede distribuirse en las áreas siguientes:

0HPRULDGHFDUJDH[WHUQD
5$0UHVSDOGDGDSRUSLOD
R
PHPRULDIODVKUHPDQHQWH

0HPRULDGHFDUJD
SDUDORVGDWRVGHSUR\HFWR EORTXHV
FRQILJXUDFLµQ\GDWRVGHSDUDPHWUL]DFLµQ

0HPRULDGHFDUJDLQWHJUDGD
5$0UHVSDOGDGDSRUSLOD
0HPRULDGHWUDEDMRFµGLJR
SDUDHOSURJUDPD
5$0UHVSDOGDGDSRUSLOD
,PDJHQGHSURFHVRGHODVHQWUDGDV
\VDOLGDV
%¼IHUGHGLDJQµVWLFR

0HPRULDFHQWUDOGDWRV

5$0
SDUDORVEORTXHVLPSRUWDQWHVSDUDOD
HMHFXFLµQ

SDUDGDWRV
5$0UHVSDOGDGDSRUSLOD
3LODGHGDWRVORFDOHV

0HPRULDGHVLVWHPD
FRQWLHQHPDUFDVWHPSRUL]DGRUHV\
FRQWDGRUHV3LODGHEORTXHV\SLOD
GHLQWHUUXSFLRQHV
5$0UHVSDOGDGDSRUSLOD

Tipos de memoria en las CPUs S7-400
● Memoria de carga para los datos del proyecto, p. ej. bloques, configuración y datos de
parametrización.
● Memoria de trabajo para los bloques importantes para la ejecución (bloques lógicos y
bloques de datos).

808

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Memoria del sistema (RAM) con los elementos de almacenamiento que cada CPU pone a
disposición del programa de usuario, tales como marcas, temporizadores o contadores. La
memoria del sistema contiene además la pila de bloques y la pila de interrupciones.
● La memoria del sistema de la CPU proporciona asimismo memorias intermedias (pila de
datos locales, búfer de diagnóstico y recursos de comunicación), que se asignan al
programa al solicitarse un bloque para sus datos temporales. Estos datos son válidos
únicamente mientras está activado el bloque.
Modificando los valores predeterminados para la memoria imagen de proceso, los datos
locales, el búfer de diagnóstico y los recursos de comunicación (propiedades de la CPU
parametrizables) es posible modificar la memoria de trabajo disponible para bloques
relevantes para la ejecución.
Nota
Tenga en cuenta lo siguiente al ampliar la imagen del proceso de una CPU: Reconfigure los
módulos cuyas direcciones deban ser superiores a la dirección más alta de la imagen de
proceso de manera que las nuevas direcciones sigan siendo superiores a la dirección más
alta de la imagen de proceso ampliada.

Nota importante para las CPUs después de la parametrización modificada de la distribución de la
memoria de trabajo
Si modifica la división de la memoria de trabajo mediante parametrización, la memoria de
trabajo se reorganizará al cargar los datos de sistema en la CPU. Esto tiene como
consecuencia que los bloques de datos que hayan sido creados con una función del sistema
(SFC) serán borrados y a los demás bloques de datos se les asignarán valores iniciales de la
memoria de carga.
El tamaño disponible de la memoria de trabajo para bloques de código y de datos se modifica
durante la carga de datos del sistema si se alteran los siguientes parámetros:
● Tamaño de la imagen de proceso (byte por byte; en la ficha "Ciclo/Marca de ciclo")
● Recursos para comunicación (sólo S7-400; en la ficha "Memoria")
● Tamaño del búfer de diagnóstico (en la ficha "Diagnóstico/Reloj")
● Número de datos locales para todas las clases de prioridad (ficha "Memoria")

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

809

Configuración de dispositivos y redes
1.4 Crear configuraciones

Base de cálculo para estimar la memoria central necesaria
Con el fin de no sobrepasar el tamaño de la memoria central disponible en la CPU, al
parametrizar se deberán tener en cuenta los siguientes requerimientos de memoria:
Tabla 1-84

Memoria necesaria

Parámetros

Memoria de trabajo necesaria

En la memoria de progra‐
ma/datos

Tamaño de la imagen de pro‐
ceso (entradas)

12 bytes por byte en la memoria imagen de proceso de las
entradas
A partir de la V6.0: 20 bytes por byte en la imagen de proceso
de las entradas

Memoria de programa

Tamaño de la imagen de pro‐
ceso (salidas)

12 bytes por byte en la memoria imagen de proceso de las
salidas
A partir de la V6.0: 20 bytes por byte en la imagen de proceso
de las entradas

Memoria de programa

Recursos de comunicación
(peticiones de comunicación)

72 bytes por petición de comunicación

Memoria de programa

Tamaño del búfer de diagnós‐
tico

32 bytes por entrada del búfer de diagnóstico

Memoria de programa

Número de datos locales

1 byte por cada byte de datos locales

Memoria de datos

Capacidad de memoria flexible
● Memoria de trabajo:
La capacidad de la memoria de trabajo se determina eligiendo de la variada gama de
unidades CPU una CPU adecuada.
● Memoria de carga:
Para los programas de volumen pequeño y medio es suficiente la memoria de carga
integrada.
Para los programas más extensos se puede ampliar la memoria de carga enchufando
tarjetas de memoria RAM.
Además, hay disponibles tarjetas de memoria FLASH para conservar los programas
incluso sin pila tampón en caso de interrumpirse la tensión. Asimismo, estas tarjetas de
memoria FLASH (a partir de 8 MB) son adecuadas para enviar y ejecutar actualizaciones
del sistema operativo.

Respaldo
● La pila tampón respalda transitoriamente la parte integrada y externa de la memoria de
carga, la sección de datos de la memoria de trabajo y la sección de código.

Consulte también
Qué hay que saber sobre las Memory Cards para el S7-400 (Página 804)

810

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Contenido de las memorias de trabajo y del sistema
Áreas de operandos de las CPUs
Resumen
Los elementos de memoria que cada CPU pone a disposición del programa de usuario, p. ej.
la memoria imagen de proceso de las entradas y salidas, marcas, temporizadores y
contadores. La memoria de trabajo y del sistema de las CPUs S7 se distribuye en áreas de
operandos. Si se utilizan las operaciones adecuadas, los datos se direccionan en el programa
directamente al área de operandos correspondiente.
La tabla siguiente muestra las áreas de operandos:
Área de operandos

Acceso vía unidades del ta‐
maño siguiente:

Notación S7

Descripción

Memoria imagen de proceso
de las entradas

Entrada (bit)

I

Al principio de cada ciclo, la
CPU lee las entradas de los
módulos de entrada y guarda
los valores en la memoria
imagen de proceso de las en‐
tradas.

Byte de entrada

IB

Memoria imagen de proceso
de las salidas

Marcas

Palabra de entrada

IW

Palabra doble de entrada

ID

Salida (bit)

Q

Byte de salida

QB

Palabra de salida

QW

Palabra doble de salida

QD

Marca (bit)

M

Byte de marcas

MB

Palabra de marcas

MW

Durante el ciclo, el programa
calcula los valores para las
salidas y los guarda en la me‐
moria imagen de proceso de
las salidas. Al final del ciclo,
la CPU escribe los valores
calculados para las salidas
en los módulos de salida.

Esta área pone a disposición
espacio de memoria para re‐
sultados intermedios calcula‐
dos en el programa.

Palabra doble de marcas

MD

Temporizadores

Temporizador (T)

T

En esta área hay disponibles
temporizadores.

Contadores

Contador (C)

C

En esta área hay disponibles
contadores.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

811

Configuración de dispositivos y redes
1.4 Crear configuraciones
Área de operandos

Acceso vía unidades del ta‐
maño siguiente:

Notación S7

Descripción

Bloque de datos

Bloque de datos, abierto con
"OPN DB":

DB

Los bloques de datos guar‐
dan información del progra‐
ma. Existe la posibilidad de
definirlos de modo que todos
los bloques lógicos accedan
a ellos (DBs globales) o que
estén asignados a un FB o
SFB determinado (DB instan‐
cia).

Datos locales

Área de periferia:

Bit de datos

DBX

Byte de datos

DBB

Palabra de datos

DBW

Palabra doble de datos

DBD

Bloque de datos, abierto con
"OPN DI":

DI

Bit de datos

DIX

Byte de datos

DIB

Palabra de datos

DIW

Palabra doble de datos

DID

Bit de datos locales

L

Byte de datos locales

LB

Palabra de datos locales

LW

Palabra doble de datos loca‐
les

LD

Byte de entrada de periferia

PIB

Entradas

Esta área de memoria aloja
los datos temporales de un
bloque mientras dura el pro‐
cesamiento del mismo. La pi‐
la L-Stack también proporcio‐
na memoria para transferir
parámetros de bloque y para
guardar los resultados inter‐
medios de los segmentos
KOP.

Las áreas de periferia de las
entradas y salidas permiten
acceder directamente a los
módulos de entrada y salida
descentralizados.

Palabra de entrada de perife‐ PIW
ria
Palabra doble de entrada de
periferia

PID

Área de periferia:

Byte de salida de periferia

PQB

Salidas

Palabra de salida de periferia PQW
Palabra doble de salida de
periferia

812

PQD

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Memoria imagen de proceso de las entradas y salidas
Principios básicos de las memorias imagen de proceso
Función
Si en el programa de usuario se activan las áreas de operandos de entradas (I) y salidas (Q),
no se consultan o modifican los estados de señal en los módulos de señales digitales, sino un
área de la memoria de sistema de la CPU. Dicha área de memoria se denomina memoria
imagen de proceso.

Ventajas de la memoria imagen de proceso
El acceso a la memoria imagen de proceso tiene la ventaja, en comparación con el acceso
directo a los módulos de entrada y salida, que la CPU dispone de una imagen coherente de las
señales de proceso mientras dura el procesamiento cíclico del programa. Si durante el
procesamiento del programa cambia un estado lógico en un módulo de entrada, dicho estado
se conserva en la memoria imagen de proceso hasta que ésta se actualiza en el próximo ciclo.
Esto permite consultar varias veces una señal de entrada en el programa y obtener siempre
una información de entrada coherente.
Asimismo, el acceso a la memoria imagen de proceso requiere bastante menos tiempo que el
acceso directo a los módulos de señales, porque la memoria imagen de proceso se encuentra
en la memoria interna de la CPU.

Actualizar las memorias imagen de proceso
Ejecución
La actualización de las memorias imagen de proceso de las entradas y salidas (memoria
imagen de proceso OB 1) se efectúa en el orden siguiente:
1. Se ejecutan las tareas internas del sistema operativo.
2. La memoria imagen de proceso de las salidas (IPS) se escribe en las salidas de los
módulos.
3. El estado de las entradas se lee en la memoria imagen de proceso de las entradas (IPE).
4. Se procesa el programa de usuario con todos los bloques que se han llamado en él.
El sistema operativo controla independientemente la escritura de la memoria imagen de
proceso de las salidas en las salidas de los módulos y la lectura de la memoria imagen de
proceso de las entradas.

Error de acceso a la periferia al actualizar la memoria imagen de proceso
Las CPUs S7-300 reaccionan de la siguiente forma en caso de producirse un error durante la
actualización de la memoria imagen de proceso:
● No se efectúan entradas en el búfer de diagnóstico ni llamadas de OB. Los bytes de entrada
correspondientes se ponen a "0" y permanecen así hasta que se elimine el error.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

813

Configuración de dispositivos y redes
1.4 Crear configuraciones
Las CPUs S7-400 reaccionan de la siguiente forma en caso de producirse un error durante la
actualización de la memoria imagen de proceso:
● Entrada en el búfer de diagnóstico y arranque del OB 85 cada vez que se accede a la
periferia en cada actualización de la correspondiente memoria imagen de proceso. Los
bytes de entrada erróneos se ponen a "0" en cada acceso a la memoria imagen de proceso.
La parametrización de la reacción en caso de error de acceso a la periferia se puede modificar
de una de las dos maneras siguientes:
● La CPU genera una entrada en el búfer de diagnóstico e inicia el OB 85 en cada acceso.
● La CPU genera una entrada en el búfer de diagnóstico y sólo inicia el OB 85 en caso de que
entre o salga un error de acceso a la periferia. Antes de llamar el OB 85, los bytes de
entrada defectuosos se ponen a "0", tras lo cual el sistema operativo no vuelve a
sobrescribirlos hasta que salga el error de acceso a la periferia.
● La CPU muestra el comportamiento predefinido para el S7-300. No se efectúa llamada del
OB-85, los bytes de entrada correspondientes se ponen a "0" y el sistema operativo no los
sobrescribe hasta que se elimina el error.

Frecuencia de arranque del OB-85
Aparte de la reacción que se haya parametrizado para cuando se produzca un error de acceso
a la periferia, el área de direcciones de un módulo también influye en la frecuencia de arranque
del OB-85:
● En el caso de un módulo con un área de direcciones de hasta una palabra doble, el OB 85
se inicia una vez, por ejemplo, con un módulo digital con hasta 32 entradas o salidas o un
módulo analógico con 2 canales.
● En el caso de los módulos con un área de direcciones mayor, el OB 85 se inicia tantas veces
como se acceda a él con comandos de palabra doble, por ejemplo, en un módulo de
señales analógicas de 4 canales será dos veces.

Pila de datos locales
Función
Al crear los bloques de organización es posible declarar variables temporales (TEMP)
disponibles únicamente durante el procesamiento del bloque, después de lo cual vuelven a
sobrescribirse. Además, cada bloque de organización necesita para su información de
arranque 20 bytes de datos locales.
La CPU tiene una memoria limitada para las variables temporales de los datos locales de los
bloques que se están procesando en ese momento. El tamaño de esta área de memoria,
denominada pila de datos locales o pila L-Stack, depende de la CPU. De forma
predeterminada, la pila de datos locales se reparte a partes iguales entre las clases de
prioridades. Esto significa que cada clase de prioridad dispone de su propio espacio en la pila
de datos locales. De esta forma se garantiza que también las clases de prioridades con mayor
prioridad y sus OBs subordinados tengan espacio para sus datos locales.
Antes del primer acceso deben inicializarse los datos locales.

814

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
La pila de datos locales almacena los siguientes datos:
● Variables temporales de los datos locales de bloques
● Información de arranque de los bloques de organización
● Información para la transferencia de parámetros
● Resultados intermedios de la lógica en programas de esquemas de contactos
La figura siguiente muestra cómo se asignan los datos locales a las clases de prioridades:
&ODVHGHSULRULGDG
3LOD/6WDFN

6)&

2%
UHTXLHUHE\WHV
HQODSLOD/6WDFN

&ODVHGHSULRULGDG
2%
UHTXLHUHE\WHV
HQODSLOD/6WDFN

)%

&ODVHGHSULRULGDG
2%
UHTXLHUHE\WHV
HQODSLOD/6WDFN

)%

)&

En la pila de datos locales, el OB 1 es interrumpido primero por el OB 20, que a su vez será
interrumpido por el OB 81.
PRECAUCIÓN
Todas las variables temporales de un OB y de sus bloques subordinados se almacenan en la
pila de datos locales. Si se utilizan muchos niveles de anidamiento en el procesamiento de los
bloques, existe riesgo de desbordamiento de la pila de datos locales.
Si se supera el tamaño permitido para la pila de datos locales para un programa, las CPUs S7
pasan al estado operativo "STOP".
La función "Mostrar información del programa" ofrece un resumen de los datos locales
necesarios.
También hay que tener en cuenta los datos locales requeridos por los OBs de error síncrono.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

815

Configuración de dispositivos y redes
1.4 Crear configuraciones

Asignar datos locales a las clases de prioridades
Con S7-300: En el S7-300, el número máximo de datos locales por clase de prioridad y por
bloque está limitado (ver Datos técnicos de la CPU).
Con S7-400: El número máximo total de datos locales está limitado (ver Datos técnicos de la
CPU). Los datos locales disponibles se distribuyen libremente al parametrizar la CPU entre las
distintas clases de prioridades. No se debe superar el número máximo de datos locales.

Pila de interrupciones
Función
Si el procesamiento del programa se ve interrumpido por un bloque de organización de mayor
prioridad, el sistema operativo almacena los siguientes datos en la pila de interrupciones
(USTACK):
● El contenido actual de los acumuladores y el registro de direcciones
● El número y tamaño de los bloques de datos abiertos
Cuando se termina de procesar el nuevo bloque de organización, el sistema operativo carga
la información de la pila de interrupciones. A continuación se retoma el procesamiento del
bloque interrumpido desde el mismo lugar en el que se produjo la interrupción.

Pila de bloques
Función
Si se interrumpe el procesamiento de un bloque por la llamada de otro bloque o por una
prioridad mayor, por ejemplo, una alarma o tratamiento de errores, el sistema operativo
almacena los siguientes datos en la pila de bloques (B-Stack):
● Número, tipo (OB, FB, FC, SFB, SFC) y dirección de salto del bloque interrumpido.
● Número de los bloques de datos del registro de DB y DI abiertos en el momento de la
interrupción.
Con los datos almacenados, el programa de usuario puede continuar el procesamiento
después de la interrupción.
En el estado operativo "STOP", la función de test "Jerarquía de llamada" permite leer en la PG
la pila de bloques si el editor de programación está abierto. La pila de bloques indica todos los
bloques que no habían terminado de procesarse en el momento en el que la CPU pasó al
estado operativo "STOP".
La figura siguiente muestra la secuencia de llamada de los bloques:

816

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
6HFXHQFLDGHOODPDGD
GHORV
EORTXHV

)%

)&

3LODGHEORTXHV %6WDFN

)&

3LODGHGDWRVORFDOHV /6WDFN

'DWRVGHOD)&
1¼PHURGHEORTXH
'LUHFFLµQGHUHJUHVR

'DWRVORFDOHVGHOD)&
(OQ¼PHURGHEORTXHVTXHVH
SXHGHQDOPDFHQDUHQODSLOD
%6WDFN SRUFODVHGHSULRULGDG 
GHSHQGHGHOD&38

'DWRVGHOD)&
1¼PHURGHEORTXH
'LUHFFLµQGHUHJUHVR
'DWRVGHOD)&
1¼PHURGHEORTXH
'LUHFFLµQGHUHJUHVR

'DWRVORFDOHVGHOD)&

'DWRVORFDOHVGHOD)&

5HJLVWURGH'%\',
1|GHO'%DELHUWR
1|GHO'%GHLQVWDQFLDDELHUWR

Registro del bloque de datos
Existen dos registros de bloques de datos. Estos registros contienen los números de los
bloques de datos abiertos:
● El registro de DB incluye el número del bloque de datos globales abierto.
● El registro de DI incluye el número del bloque de datos de instancia abierto.

Búfer de diagnóstico
Función
En el búfer de diagnóstico se registran los eventos de diagnóstico del sistema y definidos por
el usuario en el orden en el que se producen. La primera entrada contiene el evento más
reciente. El número de entradas del búfer de diagnóstico depende del módulo en cuestión y de
su actual estado operativo.
Posibles eventos de diagnóstico:
● Fallo en un módulo
● Fallo en el cableado del proceso
● Fallo de sistema en la CPU
● Transiciones de estado operativo de la CPU
● Fallo en el programa de usuario
● Eventos de diagnóstico definidos por el usuario con la función de sistema SFC 52

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

817

Configuración de dispositivos y redes
1.4 Crear configuraciones
La información que se registra en el búfer de diagnóstico al producirse un evento de
diagnóstico del sistema es idéntica a la información de arranque que se envía al bloque de
organización correspondiente.
Las entradas del búfer de diagnóstico no se pueden borrar; el contenido del búfer de
diagnóstico se mantiene incluso tras un borrado completo.

Ventajas del búfer de diagnóstico
El búfer de diagnóstico ofrece las ventajas siguientes:
● En caso de parada de la instalación, se puede evaluar el último evento antes del "STOP" y
encontrar la causa del mismo.
● Esto permite detectar con más rapidez las causas de errores, con lo que se aumenta la
disponibilidad de la instalación.
● Es posible evaluar el comportamiento dinámico de la instalación y, seguidamente,
optimizarlo.

Organización del búfer de diagnóstico
El búfer de diagnóstico está diseñado como búfer en anillo. El número máximo de entradas
depende del módulo; para la CPU 314 S7-300, por ejemplo, son 100 entradas. Cuando se
alcanza este número máximo de entradas, cada nuevo evento de diagnóstico borra la entrada
más antigua. Esto hace que el resto de las entradas también se desplacen una posición. De
esta forma la entrada de diagnóstico más reciente siempre ocupa la primera posición.
El número de entradas del búfer de diagnóstico que se muestran depende del módulo y de su
actual estado operativo. En determinadas CPUs se puede parametrizar la longitud del búfer de
diagnóstico.

Evaluación del búfer de diagnóstico
Existen las posibilidades siguientes para acceder al contenido del búfer de diagnóstico:
● Online con la vista de diagnóstico
● En el programa de usuario con SFC 51 "RDSYSST".
La CPU está configurada de tal forma que la última entrada de diagnóstico antes de pasar del
estado "RUN" a "STOP" se envía automáticamente a un dispositivo de observación (PG, OP
o TD). Esto permite encontrar y solucionar más rápidamente el problema que ha causado el
cambio de estado operativo. Es posible modificar este ajuste predeterminado.
Nota
Para poder utilizar adecuadamente las indicaciones de tiempo de las entradas del búfer de
diagnóstico, hay que ajustar y comprobar de vez en cuando la fecha y la hora del módulo.

818

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Temporizadores y contadores
Definición
Los temporizadores y contadores son áreas de memoria de la memoria de sistema. Las
funciones del temporizador o contador, como el retardo al conectar o el valor inicial del
contador, se definen en el programa de usuario. El número de contadores y temporizadores
disponibles depende de la CPU.
Nota
Tenga en cuenta las indicaciones siguientes sobre los temporizadores:
● Si en un programa de usuario se utilizan más temporizadores o contadores de los que
permite la CPU, se notificará un error sincrónico y se iniciará el bloque de organización "OB
121".

Acceso al área de datos de la periferia
Área de datos de la periferia
Estructura del área de datos de la periferia
Área de datos de la periferia
El área de datos de la periferia se subdivide en:
● Datos útiles
● Datos de diagnóstico y de parámetros
Las dos áreas tienen un área de entrada con acceso de sólo lectura y un área de salida con
acceso de sólo escritura.

Datos útiles
Definición
Los datos de usuario pueden ser:
● Señales digitales y analógicas de entrada y salida de módulos de señales
● Información de control y estado de los módulos de función
● Información para conexiones punto a punto y acoplamientos de bus de módulos de
comunicación.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

819

Configuración de dispositivos y redes
1.4 Crear configuraciones

Acceso a los datos de usuario
En los módulos de señales digitales, los datos de usuario se direccionan con la dirección de
byte del área de entrada o salida.
En los módulos de señales analógicas, el direccionamiento se efectúa con la dirección de
palabra del área de entrada o salida.
Se puede acceder a los datos de usuario mediante comandos de carga y transferencia o
funciones de comunicación (manejo y visualización, M+V), o con la transferencia de la
memoria imagen de proceso.
Con comandos de carga y transferencia se puede alcanzar una coherencia de datos de 1, 2 y
4 bytes. Los datos de la memoria imagen de proceso siempre son coherentes.
Si se desea una coherencia de datos de 3 ó de más de 4 bytes, se debe utilizar la instrucción
"DPRD_DAT" (SFC 14) o "DPWR_DAT" (SFC 15).
Para transferir 4 bytes de forma coherente y sin modificación, se utiliza la instrucción
"Transferir palabra doble". Si se utiliza cuatro veces la instrucción "Transferir byte de entrada",
es posible que se pierda la coherencia de los bytes, lo que puede tener efectos no deseados.

Datos de diagnóstico y de parámetros
Registros de los datos de diagnóstico y de parámetros
Los datos de diagnóstico y de parámetros de un módulo no se pueden direccionar por
separado, sino sólo agrupados como registros completos. Los datos de diagnóstico y de
parámetros se transfieren de forma coherente.
Los datos de diagnóstico y de parámetros se direccionan con la dirección inicial del módulo en
cuestión y el número de registro. Los registros se dividen en registros de datos de entrada y de
salida. Los registros de entrada sólo se pueden leer; los registros de salida sólo se pueden
escribir. Se puede acceder a los registros con las funciones del sistema o de comunicación.
La tabla siguiente muestra la asignación de los registros a los datos de diagnóstico y de
parámetros:
Datos

Descripción

Datos de diagnóstico

En los módulos diagnosticables, al leer los registros 0 y 1 se obtienen los datos de diagnóstico
del módulo.

Datos de parámetros

En los módulos parametrizables, al escribir los registros se transfieren los parámetros del mó‐
dulo.

Acceder a los registros de un módulo
Instrucciones para el acceso a los registros
Para cambiar los parámetros de los módulos parametrizables y leer la información de
diagnóstico de los módulos diagnosticables, se puede utilizar la información de los registros de
un módulo.

820

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
La tabla siguiente muestra con qué instrucciones se puede acceder a los registros:
Instrucción

Aplicación

Parametrizar módulos
WR_PARM

Transferir los parámetros modificables (registro 1) al módulo de señales direccionado

WR_DPARM

Transferir registros individuales de parámetros desde los SDBs 100 a 129 al módulo de señales
direccionado

PARM_MOD

Transferir todos los parámetros desde los SDBs 100 a 129 al módulo de señales direccionado

WR_REC

Transferir un registro cualquiera al módulo de señales direccionado

Leer información de diagnóstico
RD_REC

Leer los datos de diagnóstico

Nota
Si se ha configurado un esclavo DPV1 con un archivo GSD (GSD a partir de rev. 3) y la interfaz
DP del maestro DP (CPU S7-400) está configurada como "Compatible S7", en el programa de
usuario no se podrán leer ni escribir registros de los módulos de E/S ni con la instrucción
"WR_REC/RD_REC" ni con la instrucción "WRREC/RDREC". En este caso, el maestro DP
direcciona el slot incorrecto, es decir, el slot configurado +3. Para evitar este problema, cambie
el ajuste de la interfaz del DP maestro a "DPV1".

Dirección inicial de un módulo
La dirección inicial de un módulo es la dirección de byte más baja de un módulo. Representa
la dirección inicial del área de datos útiles del módulo y, en muchos casos, se utiliza como
sustituto de todo el módulo.
Cuando, por ejemplo, se producen alarmas de proceso, de diagnóstico, de extracción/
inserción o fallos de alimentación, la dirección inicial del módulo se registra en la información
de arranque del correspondiente bloque de organización e identifica así el módulo que ha dado
lugar a la alarma.

Configurar las direcciones iniciales de los módulos
La asignación entre las direcciones utilizadas en el programa de usuario y los módulos se
realiza mediante configuración de los módulos.
Las direcciones iniciales asignadas automáticamente al colocar los módulos en el rack se
pueden modificar en las propiedades del módulo (grupo "Direcciones").

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

821

Configuración de dispositivos y redes
1.4 Crear configuraciones

Área de datos útiles
Acceso a las direcciones de periferia
Datos útiles en el área de operandos Periferia
Los datos útiles representan el área de operandos Periferia. Existen las siguientes áreas:
● Entradas de periferia PI
● Salidas de periferia PQ
Si los datos útiles están en la memoria imagen de proceso, la CPU acepta automáticamente
el intercambio de datos entre el módulo y el área de la memoria imagen de proceso al
actualizarse las memorias imagen de proceso.
Si los datos de usuario no están en la memoria imagen de proceso, se accede a ellos en el
programa de usuario mediante acceso directo a la periferia (p. ej. L %IB500:P).
Las direcciones de los módulos de entrada y salida analógica no suelen estar en el área de la
imagen de proceso. No obstante, las direcciones de los módulos analógicos se pueden colocar
en esta área.

Consulte también
Memorias imagen de proceso (área de memoria de las entradas y salidas) (Página 898)
Acceso directo a la periferia (áreas de memoria PE y PA) (Página 899)

Áreas de direcciones
Áreas de direcciones de la periferia
Las entradas y salidas disponen de su propia área de direcciones. Por eso, la dirección de un
área de periferia, además de la indicación de byte o palabra, debe identificar también si se trata
de entradas ("I") o salidas ("Q").
La siguiente tabla muestra las áreas de direcciones de periferia disponibles:
Área de operandos

Acceso vía unidades del tamaño si‐
guiente:

Notación S7

Área de periferia:

Byte de entrada de periferia

PIB

Entradas

Palabra de entrada de periferia

PIW

Palabra doble de entrada de periferia

PID

Área de periferia:

Byte de salida de periferia

PQB

Salidas

Palabra de salida de periferia

PQW

Palabra doble de salida de periferia

PQD

Consulte también
Acceso directo a la periferia (áreas de memoria PE y PA) (Página 899)

822

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Configurar el comportamiento operativo
Introducción a la configuración del comportamiento operativo
Modificar las propiedades de los sistemas de automatización
Las propiedades de los sistemas de automatización que no vienen predeterminadas se
pueden modificar de la siguiente forma:
● Configurando parámetros de sistema
● Utilizando funciones de sistema (SFC) en instrucciones avanzadas

Modificar parámetros del módulo
Configuración estándar
Todos los módulos parametrizables están ajustados de fábrica a los valores adecuados para
las aplicaciones estándar. Estos valores estándar permiten utilizar los módulos sin necesidad
de realizar más ajustes.
No obstante, es posible parametrizar el comportamiento y las propiedades de los módulos
para adaptarlos a las necesidades y particularidades de la instalación. Los módulos
parametrizables son CPUs, FMs, CPs y algunos módulos de entrada y salida analógica y
módulos de entrada y salida digital.

Parámetros del módulo
Para una mejor comprensión, los parámetros del módulo se agrupan, para las CPUs, en los
siguientes grupos:
● Arranque
● Ciclo
● Interfaz PROFINET u otras interfaces
● Diagnóstico
● Remanencia
● Marcas de ciclo
● Alarmas
● Protección
● Reloj
● Recursos de conexión

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

823

Configuración de dispositivos y redes
1.4 Crear configuraciones

Ajustar y cargar parámetros
Es posible establecer los ajustes de los parámetros de los módulos. Cuando se guarda una
configuración de dispositivos con sus parámetros, se generan datos de sistema que se cargan
en la CPU junto con el programa de usuario y, desde allí, se transfieren a los módulos
correspondientes al arrancar.

Parametrizar con instrucciones
Aparte de la parametrización, también es posible modificar los parámetros de los módulos
desde el programa con las instrucciones avanzadas.
La tabla siguiente muestra qué instrucciones pueden modificar qué parámetros de módulos:
Función de sistema

Aplicación

WR_PARM

Transferir los parámetros modificables (registro 1) al módulo de
señales direccionado.

WR_DPARM

Transferir juegos individuales de parámetros desde los SDB co‐
rrespondientes al módulo de señales direccionado.

PARM_MOD

Transferir todos los parámetros desde los SDBs correspondien‐
tes al módulo de señales direccionado.

WR_REC

Transferir un registro cualquiera al módulo de señales direccio‐
nado

Parámetros generales de la CPU
Propiedades generales de los módulos
El grupo de parámetros "General" informa acerca del tipo y la ubicación del módulo y, en los
módulos con interfaces, ofrece información relevante para la red, como p. ej. la dirección de
dispositivo.

Nombre abreviado, referencia/firmware, nombre, identificador de instalación, identificador de situación
El nombre abreviado, la información que aparece debajo y la referencia/firmware son idénticos
a los que aparecen en el catálogo de hardware.
En el campo "Nombre" aparece el nombre del módulo, que se puede modificar según las
especificaciones del usuario. Si se modifica el nombre, el nuevo aparece también en la vista
de dispositivos o en la de redes.
Las CPU ofrecen la posibilidad de establecer una identificación específica de la instalación.
Con la identificación de la instalación se identifican unívocamente las partes de la instalación
siguiendo criterios funcionales. Tiene una estructura jerárquica (según IEC 1346-1). También
resulta posible indicar una identificación de situación de hasta 32 caracteres de longitud.
Forma parte de la designación de referencia que identifica la localización precisa de, por
ejemplo, un punto de instrumentación y control o un grupo de ellos dentro de una instalación
de ingeniería de procesos (de forma similar a una calle en un mapa).
La identificación introducida en el campo "ID de instalación" o "ID de situación" se puede
evaluar en el programa de usuario de la CPU. Esta posibilidad se puede utilizar para ejecutar
el programa de usuario en función de la ID de la instalación o la ID de situación.

824

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Comentario
Todos los módulos cuentan con un campo de comentario. En este campo puede introducirse
p. ej. la finalidad de uso del módulo.

Arranque
Parámetros de arranque
El comportamiento de arranque de la CPU
A continuación se describen los parámetros de las CPUs S7 que determinan el
comportamiento de arranque.

Arranque si la configuración real difiere de la teórica
La configuración teórica se representa mediante la configuración cargada en la CPU (bloques
de datos de sistema). La configuración real es la que existe realmente en el sistema de
automatización.
Si la casilla de verificación "Arranque si la configuración real difiere de la teórica" está
desactivada, la CPU pasa al estado "STOP" en los siguientes casos:
● Si no hay, al menos, un módulo en el slot configurado.
● Si en el slot configurado hay un módulo de otro tipo, p. ej. durante la puesta en servicio.
● Si falta la periferia descentralizada.
Si aparte de los módulos definidos en la configuración hay también otros módulos
(centralizados o descentralizados), estos no se tienen en cuenta al comparar la configuración
real/teórica.
Si la casilla de verificación "Arranque si la configuración real difiere de la teórica" está activada,
la CPU arrancará también aunque se den las circunstancias arriba indicadas.
La CPU no comprueba la configuración de la periferia (módulos centralizados y
descentralizados, racks centralizados y esclavos DP). Una excepción a esto son las interfaces
PROFIBUS DP. Debido a su estrecha relación con la CPU, los módulos de este tipo que se
hayan configurado siempre deben estar insertados para que la CPU pueda arrancar.
De forma predeterminada, en la CPU está activada la casilla "Arranque si la configuración real
difiere de la teórica", de modo que arranca aunque haya diferencias entre la configuración real
y la teórica.

Tiempo de vigilancia para la señal "ready" de los módulos
Duración máxima del aviso de fin de todos los módulos configurados después de la conexión
(POWER ON). Si, una vez transcurrido este tiempo de vigilancia, los módulos no han enviado
una señal "ready" a la CPU, significa que la configuración real difiere de la teórica. La reacción
de la CPU estará entonces determinada por el parámetro "Arranque si la configuración real
difiere de la teórica".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

825

Configuración de dispositivos y redes
1.4 Crear configuraciones
En el caso, por ejemplo, de un montaje en varias líneas o de dispositivos conectados a la CPU
a través de la interfaz maestra DP, durante este tiempo de vigilancia se pueden conectar todas
las fuentes de alimentación sin necesidad de seguir el orden de conexión.

Tiempo de vigilancia para la transferencia de parámetros a los módulos
Duración máxima del "reparto" de los parámetros a los módulos parametrizables (empieza a
contar después de recibirse la señal "ready" de los módulos). En las CPUs con interfaz maestra
DP, este parámetro también define la vigilancia del tiempo de arranque de los esclavos DP.
Esto significa que los esclavos DP deben haber arrancado y haber sido parametrizados por la
CPU (como maestro DP) en el tiempo definido.
Si, una vez transcurrido este tiempo de vigilancia, no se han parametrizado todos los módulos/
esclavos DP, significa que la configuración real difiere de la teórica. La reacción de la CPU
estará entonces determinada por el parámetro "Arranque si la configuración real difiere de la
teórica".

Parámetros de arranque sólo para CPUs S7-400
Inicializar salidas al efectuar un rearranque
Inicializar salidas al efectuar un rearranque
En un rearranque, las CPUs del S7-400 pueden inicializar las salidas (y, con ello, la memoria
imagen de proceso de las salidas PAA).

Consulte también
Rearranque normal (Página 793)

Bloquear rearranque en caso de arranque por intervención
Bloquear el rearranque en caso de arranque por intervención (p. ej., de la programadora) o por petición
de comunicación (p. ej., de dispositivos MPI)
En el S7-400 existe la posibilidad de bloquear el tipo de arranque "Rearranque" en caso de que
se active por intervención de la programadora o por una petición de comunicación. Así, el
rearranque solo se puede efectuar "in situ".
● Active esta casilla de verificación si el tipo de arranque activado por intervención o por
petición de comunicación se debe limitar al rearranque completo (=rearranque completo
manual) o al arranque en frío.
● Si la casilla de verificación está desactivada, todos los tipos de arranque resultan posibles.

826

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Un rearranque por intervención o petición de comunicación (=rearranque normal manual) se activa
cuando se cumplen los requisitos siguientes:
● La casilla de verificación "Bloquear rearranque..." no ha sido activada y esta
parametrización se ha transferido a la CPU
● No hay ningún impedimento para un rearranque (batería en estado correcto, ningún cambio
en el programa de usuario en estado STOP, ...)
● En la programadora se ha seleccionado el estado operativo de rearranque, o bien otro
dispositivo provoca un rearranque mediante una petición de comunicación.

Consulte también
Rearranque normal (Página 793)

Comportamiento cíclico
Ajustes para el comportamiento cíclico
Actualizar cíclicamente la memoria imagen de proceso del OB1
Si esta opción está activada, la memoria imagen de proceso del OB1 se actualiza cíclicamente
(ajuste predeterminado). En las CPUs S7-400 la actualización del OB1 se puede desactivar
con este parámetro.

Tiempo de vigilancia del ciclo
El tiempo de vigilancia del ciclo se indica en milésimas de segundo.
Si el tiempo de ciclo excede el tiempo de vigilancia del ciclo, la CPU pasa al estado operativo
"STOP". Para evitar que pase a "STOP", se puede programar el bloque de organización OB 80.
Las posibles causas de que se rebase el tiempo son:
● Procesos de comunicación
● Acumulación de eventos de alarma
● Error en el programa de la CPU.

Control de los procesos de comunicación que cargan el ciclo
Con el parámetro "Carga del ciclo por comunicación" se puede controlar hasta cierto punto la
duración de los procesos de comunicación que también alargan el tiempo de ciclo. Los
procesos de comunicación pueden ser, p. ej.:
● Transferencia de datos a otra CPU
● Carga de bloques (iniciada desde la programadora)
Las funciones de test con la programadora apenas se ven afectadas por este parámetro, y
pueden alargar considerablemente el tiempo de ciclo. El tiempo disponible para las funciones
de test se puede limitar en el modo Proceso.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

827

Configuración de dispositivos y redes
1.4 Crear configuraciones
Funcionamiento del parámetro
El sistema operativo de la CPU siempre tiene a disposición de las funciones de comunicación
el porcentaje de potencia de procesamiento total de la CPU que se haya configurado (técnica
de segmentos de tiempo). Si para la comunicación no se necesita tanta potencia de
procesamiento, esta quedará disponible para otros procesos.
Repercusión en el tiempo de ciclo real
Si no hay otros eventos asíncronos, el tiempo de ciclo del OB 1 se alarga en un factor que se
calcula con la siguiente fórmula:

ಯ&DUJDGHFLFORSRUFRPXQLFDFLµQಯ

Ajustar el tamaño de la memoria imagen de proceso
En las CPUs con un tamaño variable de la memoria imagen de proceso se puede definir el
tamaño de la misma (en bytes). El área de la memoria imagen de proceso empieza siempre por
el byte de entrada o salida 0.
En las CPUs S7-300 que soportan esta función, al crear el programa hay que tener en cuenta
las particularidades para el acceso al área de la memoria imagen de proceso. Estas
particularidades pueden consultarse en la documentación de la CPU.
Ejemplo: Actualmente, la configuración variable de la memoria imagen de proceso sólo afecta
a la actualización de la memoria imagen de proceso en el punto de control del ciclo. La
memoria imagen de proceso de las entradas sólo se actualiza hasta el tamaño que se ha
configurado para ella, y a los módulos de salida sólo se les envía el área de la memoria imagen
de proceso de las salidas que se ha parametrizado. El acceso del programa de usuario al área
comprendida entre el tamaño configurado para la memoria imagen de proceso y el tamaño
máximo de la misma no provoca un error de acceso sincrónico.

Consulte también
Ejemplos de carga del ciclo por comunicación (Página 828)

Ejemplos de carga del ciclo por comunicación
A continuación hay dos ejemplos de cómo la comunicación puede afectar a la carga del ciclo.

Ejemplo de carga del ciclo por comunicación sin eventos asíncronos adicionales
Si se ha configurado la carga del ciclo por la comunicación al 50%, puede producirse una
duplicación del tiempo de ciclo del OB 1.
Además, el tiempo de ciclo del OB 1 también se ve afectado por eventos asíncronos (p. ej.,
alarmas de proceso o cíclicas). La prolongación del tiempo de ciclo con el ratio de
comunicación hace que, desde un punto de vista estadístico, también se produzcan más
eventos asíncronos dentro de un ciclo del OB 1. Esto prolonga aún más el ciclo del OB 1. Esta

828

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
prolongación depende de cuántos eventos aparezcan por cada ciclo del OB 1 y de cuánto dure
su procesamiento.

Ejemplo de carga del ciclo por comunicación con eventos asíncronos adicionales
Con un tiempo neto de ejecución del OB 1 de 500 ms, una carga de comunicación del 50%
puede hacer que el tiempo real del ciclo llegue a los 1000 ms (siempre que la CPU tenga
suficientes peticiones de comunicación que procesar). Si, paralelamente, se procesa una
alarma cíclica cada 100 ms con un tiempo de procesamiento de 20 ms, dicha alarma sin carga
de comunicación prolongaría el ciclo en un total de 5*20 ms = 100 ms, es decir, el tiempo de
ciclo real sería de 600 ms. Como una alarma cíclica también interrumpe la comunicación, con
una carga de comunicación del 50% la alarma repercute en el tiempo de ciclo con 10 * 20 ms,
es decir, que en este caso el tiempo de ciclo real no sería de 1000 ms, sino de 1200 ms.
Nota
Verifique las repercusiones de un cambio de valor del parámetro "Carga de ciclo por
comunicación" en el funcionamiento de la instalación.
La carga de comunicación debe tomarse en consideración al ajustar el tiempo de ciclo mínimo,
puesto que de lo contrario se producen errores de tiempo.

Llamada del OB 85 en caso de error de acceso a la periferia
Ajustes para la llamada del OB 85
Se puede modificar la reacción predeterminada de la CPU en caso de error de acceso a la
periferia durante la actualización de la memoria imagen de proceso por parte del sistema.
Recomendación: Para activar la llamada del OB 85 en caso de error de acceso a la periferia,
seleccione la opción "Sólo para errores entrantes y salientes" para que no aumente el tiempo
de ciclo de la CPU por llamadas repetidas del OB 85.
Las CPUs S7-300 están configuradas de forma estándar de tal forma que los errores de
acceso a la periferia no llamen ningún OB 85 ni generen entradas en el búfer de diagnóstico.

Comportamiento remanente
Ajustes de remanencia para marcas, temporizadores y contadores
En la parametrización de la remanencia se determina qué áreas de memoria de la CPU se
conservarán en caso de corte de la alimentación eléctrica o transición del estado operativo
"STOP" a "RUN".

Número de bytes de marcas a partir de MB 0
Introduzca el número de bytes de marcas remanentes a partir del byte de marca 0.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

829

Configuración de dispositivos y redes
1.4 Crear configuraciones

Ejemplo
Si indica "2", los bytes de marca MB 0 y MB 1 serán remanentes.

Número de temporizadores S7 desde T0
Introduzca el número de temporizadores S7 remanentes a partir del T 0.
Cada temporizador S7 ocupa 2 bytes.

Ejemplo
Si indica "2", los temporizadores S7 T 0 y T 1 serán remanentes.

Número de contadores S7 a partir de C0
Introduzca el número de contadores S7 remanentes (contadores (C)) a partir de C0.

Ejemplo
Si indica "2", los contadores S7 C0 y C1 serán remanentes.

Ajustes de remanencia para bloques de datos
Función
En las propiedades de remanencia se puede determinar qué áreas de memoria se
conservarán tras un corte de alimentación eléctrica y tras una transición de "STOP" a "RUN",
incluso aunque no haya respaldo por pila en la memoria de respaldo de la CPU. Si se pueden
o no configurar áreas remanentes, y cuántas, depende de la CPU.
Si hay una pila de respaldo insertada, los bloques de datos son siempre remanentes.

Áreas remanentes (sólo relevante para S7-300 sin respaldo por pila o sin Micro Memory Card)
Las áreas remanentes son áreas de datos de bloques de datos.
Para que las áreas de datos de la memoria de trabajo de la CPU sean remanentes, indique lo
siguiente:
● N.º DB
Números de los bloques de datos que deben ser remanentes.
● Dirección de byte (dirección inicial con la longitud del byte de datos)
Direcciones de byte de los bloques de datos que deben ser remanentes.
● N.º de bytes
Cantidad de bytes de datos remanentes a partir de la dirección de byte. Si, p. ej., indica "1",
el byte de datos "0" será remanente.

830

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Posibilidades de ajuste para alarmas
Ajustes para alarmas de proceso
Alarmas de proceso
Cuanta más alta sea la prioridad elegida, mayor será la prioridad de procesamiento de la
correspondiente alarma de proceso. Con la prioridad "0" se deselecciona el OB de alarma. En
las CPUs S7-300 no se puede modificar la prioridad predeterminada.
En las CPUs que soportan memorias imagen parcial de proceso se pueden asignar memorias
imagen parcial de proceso a una alarma de proceso. Al iniciar el OB de alarma de proceso se
actualiza la memoria imagen parcial de proceso asignada, de forma que el OB trabaja con
valores de proceso actualizados. En el ajuste "---" no se asigna ninguna memoria imagen de
proceso.

Consulte también
OBs de alarma de proceso (de OB 40 a OB 47) (Página 914)

Ajustes para alarmas de retardo
Alarmas de retardo
Con OBs de alarma de retardo se pueden procesar partes del programa de usuario con retardo
de tiempo.
Cuanto más alta es la prioridad elegida, tanto mayor es la prioridad con la que se procesa la
alarma de retardo correspondiente. Con la prioridad "0" se deselecciona el OB de alarma. En
las CPUs S7-300 no se puede modificar la prioridad predeterminada.
En las CPUs que soportan memorias imagen parcial de proceso se pueden asignar memorias
imagen parcial de proceso a una alarma de retardo. Al iniciar el OB de alarma de proceso se
actualiza la memoria imagen parcial de proceso asignada, de forma que el OB trabaja con
valores de proceso actualizados. En el ajuste "---" no se asigna ninguna memoria imagen de
proceso.
Las alarmas de retardo se manejan con las instrucciones siguientes:
● SRT_DINT Iniciar alarma de retardo
● CAN_DINT Anular alarma de retardo
● QRY_DINT Consultar el estado de una alarma de retardo

Consulte también
OBs de alarma de retardo (de OB 20 a OB 23) (Página 910)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

831

Configuración de dispositivos y redes
1.4 Crear configuraciones

Ajustes para alarmas de error asíncrono
Alarmas de error asíncrono
En las CPUs S7-300 no se puede modificar la prioridad predeterminada.
La prioridad de los OB de error asíncrono se puede modificar para que la CPU siga en el estado
operativo "RUN" también en las siguientes circunstancias:
● Frecuentemente se producen errores asíncronos que disparan el mismo OB de alarma (p.
ej. alarma de diagnóstico, llamada de OB 82).
● Además, se produce otro evento de error asíncrono que dispara otro OB de alarma (p. ej.
error de ejecución del programa, llamada de OB 85).
● Sólo debe depositarse un mensaje (en caso de fallo de estación, p. ej., cuál es la estación
que falla). No es necesaria una reacción del proceso. En este caso se puede asignar una
menor prioridad al OB 86 para no aumentar el tiempo de reacción a otras alarmas.

Ejemplo de necesidad de modificar la prioridad
Si se corta un cable de una línea de señales, todos los módulos de señales afectados por la
rotura del cable podrían emitir una alarma de diagnóstico (llamada al OB 82) ‑ en ese caso, el
búfer para la información de arranque del OB 82 se llenaría enseguida.
Para que la CPU no pase al estado operativo "STOP" si se produce un evento que llama otro
OB de error asíncrono (p. ej. error de ejecución de programa, OB 85), es posible asignar al OB
85 una prioridad mayor que al OB 82, por ejemplo.

Consulte también
OB de error de fuente de alimentación (OB 81) (Página 927)
OB de alarma de diagnóstico (OB 82) (Página 930)
OB de cambio de módulo (OB 83) (Página 933)
OB de error de hardware en CPU (OB 84) (Página 937)
OB de error de ejecución del programa (OB 85) (Página 939)
OB de fallo del rack (OB 86) (Página 943)
OB de error de comunicación (OB 87) (Página 950)

Ajustes para alarmas horarias
Prioridad
La prioridad de las alarmas horarias determina el comportamiento de interrupción de los OBs
de alarma. Actualmente no se puede modificar la prioridad en el S7-300.

832

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Activo
Active la casilla de verificación del OB de alarma horaria si desea que se inicie
automáticamente en caso de rearranque. O bien active la alarma horaria en el programa de
usuario con el parámetro OB_NR en la instrucción ACT_TINT.

Ejecución
Seleccione con qué frecuencia deben ejecutarse las alarmas.
Están disponibles intervalos desde cada minuto hasta anual.
Los intervalos se basan en los ajustes de la fecha de inicio y la hora.
Nota
Para la Periodicidad = Último del mes no es relevante la fecha de inicio (ya que será siempre
el último día del mes).

Hora de inicio
Indique en qué fecha y hora debe ejecutarse la alarma por primera vez.

Ejemplo
Fecha de inicio

Hora

30.03.2006

10:15

En función del parámetro "Periodicidad", la CPU genera otras alarmas horarias en intervalos
determinados. La hora de inicio se refiere siempre a la hora patrón de la CPU.
Nota
Para la periodicidad "Mensual" no se puede elegir como fecha de inicio el día 29, 30 ó 31 del
mes, ya que la alarma horaria no saltaría en el mes de febrero.
En lugar de ello, seleccione la Periodicidad "Último del mes". En este caso no es relevante la
fecha de inicio (ya que será siempre el último día del mes).

Memoria imagen parcial de proceso
En las CPUs que soportan memorias imagen parcial de proceso se pueden asignar memorias
imagen parcial de proceso a una alarma horaria. Al iniciar el OB de alarma se actualiza la
memoria imagen parcial de proceso asignada, de forma que el OB trabaja con valores de
proceso actualizados. En el ajuste "---" no se asigna ninguna memoria imagen parcial de
proceso.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

833

Configuración de dispositivos y redes
1.4 Crear configuraciones

Caso particular: Se ha configurado para una única vez y el momento de inicio queda en el pasado
La configuración es la siguiente:
● Periodicidad: Una sola vez
● Activada: Sí
● Fecha de inicio/Hora: Queda en el pasado (según el reloj de tiempo real de la CPU)
Comportamiento de la CPU: Tras un arranque en frío o rearranque completo (en caliente) el
sistema operativo llama una vez al correspondiente OB de alarma horaria.

Consulte también
OBs de alarma horaria (de OB 10 a OB 17) (Página 907)

Ajustes para alarmas cíclicas
Una alarma cíclica es una señal periódica que provoca la llamada automática de un OB de
alarma cíclica. A continuación se describen los posibles ajustes.

Prioridad
La prioridad determina el comportamiento de interrupción de los OBs de alarma. En las CPUs
S7-300 no se puede modificar.

Ejecución
Indique (p. ej. milésimas de segundo) los intervalos de tiempo en los que deben procesarse los
OB de alarma cíclica utilizando las unidades indicadas.
El momento inicial del ciclo es el cambio de estado operativo de "STOP" a "RUN".

Desfase
Si el desfase se puede configurar: Introduzca, en milésimas de segundo (ms), el tiempo que
debe retardarse el momento de ejecución real de la alarma cíclica.
Nota
Un desfase tiene sentido si hay activas varias alarmas cíclicas. Sin desfase, las alarmas
cíclicas se ejecutarían al mismo tiempo y se procesarían una tras otra en función de su
prioridad.
Con el desfase se puede repartir el tiempo de procesamiento de las alarmas cíclicas más allá
del ciclo.

834

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Unidad
Se refiere a los parámetros "Periodicidad" y "Desfase". Sólo se puede modificar en algunas
CPUs especiales que soportan un ajuste microsegundo a microsegundo de las alarmas
cíclicas.

Memoria imagen parcial de proceso
En las CPUs que soportan memorias imagen parcial de proceso se pueden asignar memorias
imagen parcial de proceso a una alarma cíclica. Al iniciar el OB de alarma cíclica se actualiza
la memoria imagen parcial de proceso asignada, de forma que el OB trabaja con valores de
proceso actualizados. En el ajuste "---" no se asigna ninguna memoria imagen de proceso.

Consulte también
OBs de alarma cíclica (de OB 30 a OB 38) (Página 912)

Ajustes para alarmas DPV1
Alarmas para DPV1
Las alarmas las puede poner un esclavo DPV1 y garantizan el tratamiento del evento
desencadenante de la alarma en la CPU maestra. También en el estado operativo "STOP" se
evalúan en la CPU los datos de la alarma (actualización del búfer de diagnóstico y del estado
del módulo). No obstante, en "STOP" no se procesa el OB.
Aparte de las alarmas conocidas de SIMATIC (p. ej. alarma de diagnóstico en ET 200M),
también se soportan otras alarmas, como la alarma de estado, la de actualización y la del
fabricante.

Consulte también
OB de alarma de estado (OB 55) (Página 916)
OB de alarma de actualización (OB 56) (Página 918)
OB de alarmas específicas del fabricante (OB 57) (Página 921)

Ajustes para alarmas de sincronismo
Propiedades de las alarmas de sincronismo
Los OBs de alarma de sincronismo se procesan sincrónicamente con el ciclo equidistante.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

835

Configuración de dispositivos y redes
1.4 Crear configuraciones

Número de sistema maestro DP
Seleccione el sistema maestro DP cuyos esclavos DP deban asignarse al OB de alarma. Las
entradas y salidas de dichos esclavos podrán sincronizarse con el ciclo equidistante y el
programa de usuario en el OB de alarma.

Memoria(s) imagen parcial del proceso
Introduzca aquí el número de memorias imagen parcial de proceso a las que debe acceder el
OB de alarma. A través de las memorias imagen parcial de proceso se actualiza la periferia
descentralizada asignada de forma sincrónica con el ciclo equidistante.
Las memorias imagen de proceso parciales asignadas deben actualizarse en el OB de alarma
de sincronismo con la instrucción "SYNC_PI" y "SYNC_PO". La instrucción "SYNC_PI"
actualiza la memoria imagen de proceso parcial de las entradas, mientras que "SYNC_PO"
actualiza la memoria imagen de proceso parcial de las salidas.
Si las direcciones de la periferia descentralizada están asignadas a distintas memorias imagen
parcial de proceso, los números de estas deben indicarse separados por comas (p. ej. 1,2,3).

Tiempo de retardo
El tiempo de retardo es el tiempo entre el telegrama Global Control y el inicio del OB 61 (o del
OB 62...OB 64). Durante este tiempo, el maestro DP ejecuta el intercambio de datos cíclico con
los esclavos DP.
Si el tiempo de retardo = 0, el OB 6x se inicia con el telegrama Global-Control. En este caso es
muy probable que un acceso a la periferia isócrona a través de "SYNC_PI" al principio del OB
no resulte, ya que los datos de la periferia aún no están disponibles.
Si el tiempo de retardo es mayor que el valor estándar, se "regalará" tiempo de ejecución del
OB, ya que el acceso a la periferia isócrona ya sería posible antes.

Consulte también
OBs de alarma de sincronismo (de OB 61 a OB 64) (Página 923)
Equidistancia y sincronismo (Página 3067)

Funciones de reloj
Principios básicos de las funciones de reloj
Todas las CPU S7-300/400 tienen un reloj, que puede ser de tiempo real o de software. En el
sistema de automatización, el reloj puede funcionar como reloj maestro o como esclavo con
sincronización externa. Permite la utilización de alarmas horarias y contadores de horas de
funcionamiento.

836

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Formato de hora
El reloj muestra siempre la hora con una resolución mínima de 1 segundo, y la fecha con el día
de la semana. En algunas CPUs también se pueden visualizar milésimas de segundo.

Ajustar y leer la hora
Ajustar la hora
La fecha y hora del reloj de la CPU se ajustan e inician con las instrucciones siguientes:
● "SET_CLK"
● "SET_CLKS", si está disponible en la CPU
Nota
Para evitar diferencias de visualización en el sistema HMI y en el reloj, ajuste el horario de
invierno en la CPU o utilice una sincronización horaria centralizada.

Leer la hora
Con la instrucción "READ_CLK" o un comando de menú de la programadora se leen la fecha
y hora actuales de la CPU.

Procedimiento de sincronización horaria SIMATIC
Referencia
Parametrización de las propiedades de las interfaces en los siguientes grupos de parámetros:
● Para la CPU: "Propiedades > General > Hora"
● Para la interfaz DP: "Propiedades > General > Interfaz DP > Sincronización horaria".

Procedimiento SIMATIC
Con el procedimiento SIMATIC, la hora se ajusta utilizando mensajes horarios MMS (MMS ‑
Manufacturing Message Specification). Los mensajes horarios MMS proceden de un emisor
de hora SIMATIC o de una CPU configurada como reloj maestro.
En un CP, los mensajes horarios pueden ser recibidos por la CPU local o bien vía LAN. Existe
la posibilidad de ajustar si el CP debe reenviar la hora recibida.
En comparación con un procedimiento NTP, el procedimiento SIMATIC es más preciso.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

837

Configuración de dispositivos y redes
1.4 Crear configuraciones

Parámetros del reloj
Mediante los parámetros del reloj se ajusta lo siguiente:
● Tipo de sincronización
Las propiedades de sincronización se pueden ajustar interna (PLC) y externamente (MPI)
para la CPU.
Si está configurado el tipo de sincronización "Como maestro", se puede elegir el intervalo
de tiempo para la sincronización automática.
Si en una red hay más de un módulo con reloj, hay que determinar qué CPU actuará como
maestra y cuál como esclava para la sincronización del reloj. Sólo puede haber un reloj
maestro.
● Intervalo de tiempo
El intervalo de tiempo define el espacio de tiempo entre las consultas de hora.
● Factor de corrección
Con el factor de corrección se compensa una desviación del reloj cada 24 horas para la
CPU.
Se pueden introducir valores positivos o negativos en ms.
Ejemplo: Si el reloj se atrasa 4 segundos cada 24 horas, habrá que indicar un factor de
corrección de "+4000 ms".

Instrucciones para la sincronización de la hora
Para garantizar que la hora coincida en todos los módulos de la red, el programa de sistema
sincroniza los relojes esclavos a intervalos regulares parametrizables. Con la instrucción
"SNC_RTCB" se puede enviar la fecha y hora del reloj maestro al reloj esclavo,
independientemente del intervalo de tiempo parametrizado.

Sincronización horaria en el procedimiento NTP
Referencia
Parametrización de las propiedades de la interfaz en el grupo de parámetros "Propiedades >
General > Interfaz PROFINET > Sincronización horaria". Está seleccionada la opción "Activar
sincronización horaria vía servidor NTP".

Procedimiento NTP (NTP: Network Time Protocol)
Con el procedimiento NTP, el dispositivo envía regularmente consultas de hora (en modo
cliente) al servidor NTP de la subred (LAN). Sobre la base de las respuestas de los servidores
se determina la hora más exacta y fiable y se sincroniza la hora de la estación.
La ventaja de este procedimiento es la posibilidad de sincronizar la hora más allá de los límites
de la subred.
Deben configurarse las direcciones IP de hasta cuatro servidores NTP. El intervalo de
actualización define el espacio de tiempo entre las consultas de hora (en segundos). El rango
de valores del intervalo está entre 10 segundos y un día.
En el procedimiento NTP se transfiere generalmente la hora UTC (Universal Time
Coordinated), que equivale a la hora GMT (Greenwich Mean Time).

838

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Parámetros de la sincronización horaria en el procedimiento NTP
Mediante los parámetros del reloj se ajusta lo siguiente:
● Activar sincronización horaria vía servidor NTP
Active esta casilla de verificación si hay que sincronizar el reloj interno con el procedimiento
de sincronización NTP.
● Servidor 1-4
Deben configurarse las direcciones IP de hasta cuatro servidores NTP.
● Intervalo de actualización
El intervalo de actualización define el espacio de tiempo entre las consultas de hora.

Utilizar un contador de horas de funcionamiento
Definición
Un contador de horas de funcionamiento cuenta el tiempo, en total de horas de
funcionamiento, durante el que está activo un recurso conectado o el tiempo que está en
funcionamiento la CPU. Una CPU puede tener hasta 8 contadores de horas de
funcionamiento. La numeración empieza en el 0.
En el estado operativo "STOP" se detiene el contador de horas de funcionamiento. Su valor se
conserva incluso tras un borrado completo. En caso de "rearranque completo (en caliente)", el
programa de usuario debe volver a poner en marcha el contador de horas de funcionamiento.

Programar el contador de horas de funcionamiento
El contador de horas de funcionamiento se puede programar con las instrucciones siguientes:
● Con la instrucción "SET_RTM" se puede ajustar el contador de horas de funcionamiento a
un valor inicial.
● Con la instrucción "CTRL_RTM" se puede iniciar o detener el contador de horas de
funcionamiento.
● Con la instrucción "READ_RTM" se puede leer la cantidad actual de horas de
funcionamiento y el estado del contador, que puede ser "parado" o "contando".

Uso de marcas de ciclo
Marcas de ciclo
Una marca de ciclo es una marca que modifica periódicamente su estado binario en una
relación 1:1 entre impulso y pausa.
En la parametrización de la marca de ciclo se determina el byte de marcas de la CPU que se
convertirá en el byte de marcas de ciclo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

839

Configuración de dispositivos y redes
1.4 Crear configuraciones

Uso
Las marcas de ciclo se utilizan en el programa de usuario, p. ej., para controlar indicadores
luminosos con una luz intermitente o lanzar procesos periódicos, como la adquisición de un
valor real.

Frecuencias posibles
Cada bit del byte de marcas de ciclo tiene asignada una frecuencia. La tabla siguiente muestra
la asignación:
Bit del byte de
marcas de ciclo

7

6

5

4

3

2

1

0

Duración del pe‐
ríodo (s)

2,0

1,6

1,0

0,8

0,5

0,4

0,2

0,1

Frecuencia (Hz)

0,5

0,625

1

1,25

2

2,5

5

10

Nota
Las marcas de ciclo transcurren de forma asíncrona al ciclo de la CPU, es decir, en ciclos
largos es posible que el estado de la marca de ciclo cambie varias veces.
El byte de marcas seleccionado no puede emplearse para almacenar datos en la memoria
intermedia.

Configuración web
En este grupo de parámetros se puede elegir:
● Inicio del servidor web de la CPU
● Idiomas en los que se deben cargar los textos (los textos del búfer de diagnóstico o
mensajes, p. ej., dependen del idioma)

Activar servidor web en este módulo
Si la casilla de verificación está activada, tras cargarse los datos de configuración se inicia el
servidor web de la CPU y se puede leer información de la CPU con un navegador web.
Los ajustes restantes afectan a la actualización de las páginas web visualizadas. En caso
necesario se puede ajustar el tiempo de actualización.

840

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Permitir el acceso sólo vía HTTPS
Active esta casilla de verificación para que las páginas web del servidor web se transmitan
encriptadas al navegador web.
Nota
El acceso vía HTTPS sólo funciona si se ha ajustado la hora en la CPU.

Selección de idiomas
Elija los idiomas para los textos que dependen del idioma que desea cargar en la CPU. El
número de idiomas que se pueden seleccionar depende de la CPU.

Visualización y selección de idiomas específicos de la CPU
Se muestran los idiomas que se pueden ajustar para el acceso web a la CPU. Dependiendo de
la CPU en cuestión, a estos "idiomas del servidor web" se les puede asignar un determinado
número de idiomas de proyecto. En la CPU se cargan los textos de las entradas del búfer de
diagnóstico o de los eventos en los idiomas seleccionados. Durante el funcionamiento, la
información también se muestra en el navegador web en el idioma seleccionado.
Si durante el funcionamiento se selecciona en el navegador web un idioma que no se ha
cargado previamente, las entradas del búfer de diagnóstico y los eventos aparecerán en
código hexadecimal.
Hay que tener en cuenta que cada idioma necesita espacio de memoria en la CPU.

Administración de usuarios
Para acceder a la CPU a través del navegador web se pueden definir usuarios, concederles
derechos y asignarles contraseñas.
También se pueden definir derechos para el usuario estándar que no indica su contraseña
para iniciar sesión en el navegador web ("everybody").

Tablas de observación
Existe la posibilidad de que los usuarios puedan acceder a través del navegador web a las
tablas de observación definidas. Seleccione las que desee entre las ya existentes en la lista
desplegable y determine en la lista desplegable de la segunda columna si se debe permitir el
acceso en lectura o escritura.

Discriminador de avisos
Los discriminadores de avisos seleccionados se muestran posteriormente en las páginas web
de la CPU.
Se puede reducir el espacio requerido en memoria por los SDBs web seleccionando
únicamente los discriminadores que se necesiten.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

841

Configuración de dispositivos y redes
1.4 Crear configuraciones
Los discriminadores se ajustan en las propiedades de la CPU "Atributos de aviso", en
"Diagnóstico de sistema" en la ventana de inspección.

Páginas web definidas por el usuario
El apartado "Páginas web definidas por el usuario" permite cargar en la CPU páginas web
propias y poner así a disposición las aplicaciones web propias a través del navegador web.

Consulte también
Información importante sobre el servidor web (Página 1457)
Crear y cargar páginas de usuario (Página 1471)

Reservar recursos de comunicación
Funcionamiento de la asignación de recursos de conexión
Toda conexión de comunicación necesita recursos de conexión en la CPU S7 mientras dure
esa comunicación. Dependiendo de los datos técnicos, todas las CPUs S7 tienen un
determinado número de recursos de conexión que pueden ser ocupados por distintos servicios
de comunicación (comunicación PG/OP, comunicación S7 o comunicación básica S7).

Asignación de los recursos de conexión en orden temporal
Cuando los servicios de comunicación inician sesión, se les asignan los recursos de conexión
en el orden en que hayan iniciado sesión.

Asignación manual de los recursos de conexión
Si no se desea que la asignación de los recursos de conexión dependa únicamente del orden
en el que ha iniciado sesión cada servicio de comunicación, es posible reservar recursos de
conexión para los siguientes servicios:
● Comunicación PG y OP
● Comunicación básica S7
De forma predeterminada, la comunicación PG/OP tiene reservado al menos un recurso de
conexión. No se admiten valores más pequeños.
Otros servicios de comunicación, como la comunicación S7 con las instrucciones avanzadas
"PUT" y "GET", no pueden utilizar estos recursos aunque hayan establecido la conexión antes.
En lugar de eso, ocuparán los recursos de conexión que aún queden disponibles y no estén
reservados expresamente para un servicio.

842

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Información sobre el número máximo y ya ocupado de recursos de conexión
En las propiedades de la CPU relativas a la reserva de recursos de conexión se muestra,
además, la siguiente información (de sólo lectura):
● Número de recursos ya asignados para la comunicación S7. Se trata de recursos para
conexiones S7 unilaterales desde otra CPU a esta, p. ej., o de conexiones S7 bilaterales.
Estas conexiones ya se han configurado en la vista de redes.
● Número máximo de recursos de conexión para esta CPU.

Test, puesta en servicio y routing
Test, puesta en servicio y routing
Active la casilla de verificación si desea realizar con frecuencia funciones de programadora
necesarias para la puesta en marcha y el test, por ejemplo, utilizando esta interfaz.
Si se activa la opción "Test, puesta en servicio y routing", la interfaz se convertirá en el
dispositivo activo en PROFIBUS (es decir, la interfaz participa en la rotación del token de
PROFIBUS). En este caso serán posibles las funciones siguientes:
● Programar (p. ej. cargar)
● Probar (estado/forzar)
● Routing S7 (esclavo I como transición de red)
El tiempo de ciclo puede prolongarse. En aplicaciones críticas y si no se necesitan el routing
S7 ni la funcionalidad de cliente para la comunicación, no debería activarse esta opción.
Si la casilla de verificación "Test, puesta en servicio y routing" no está activada, la interfaz solo
trabaja como servidor de servicios de comunicación.
La funcionalidad de servidor significa que solo el interlocutor (p. ej. PG, OP o sistema de
automatización) puede iniciar la comunicación. Las particularidades siguientes deben tenerse
en cuenta si la opción "Test, puesta en servicio y routing" no está activada:
● No es posible el routing S7
● La programación y el test son posibles pero lentamente (sin prolongación del tiempo de
ciclo)

Ajustes del diagnóstico del sistema
Con el sistema de diagnóstico se puede detectar, valorar y notificar un fallo del sistema de
automatización.

Ejemplos de errores
● Fallo en el programa de la CPU
● Fallo de módulos
● Rotura de cables de encoders y actuadores

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

843

Configuración de dispositivos y redes
1.4 Crear configuraciones

Notificar causa del STOP
Esta opción se activa para que, en caso de pasar a "STOP", la CPU notifique la causa a los
visualizadores que han iniciado sesión (p. ej. PG u OP).
El aviso también se registra en el búfer de diagnóstico.

Notificación controlada por acuse de la instrucción avanzada ALARM
Este parámetro es relevante para las CPUs utilizadas para Process Control Systems. Si esta
función está activada, las instrucciones avanzadas "ALARM", "ALARM_8" y "ALARM_8P"
(SFBs 33 a 35) no volverán a notificar un cambio de señal hasta que se acuse el anterior (es
decir, el anterior mensaje entrante). De esta forma se evita que los mensajes se acumulen y
no se puedan procesar.

Posibilidades de ajuste del nivel de protección
Nivel de protección
A continuación se explica cómo se utilizan los distintos niveles de protección de las CPUs S7
y cómo influye el tipo de CPU S7 sobre la parametrización y utilización de cada nivel de
protección.

Comportamiento predeterminado
En el comportamiento predeterminado del nivel de protección no se asignan contraseñas. Este
nivel de protección se denomina "Sin protección".
Aquí sólo se puede introducir una contraseña si se ha activado la opción "Eliminable con
contraseña". Mediante esta opción también se puede acceder en escritura a la CPU en RUN
si en el programa de usuario se ha usado la instrucción "PROTECT" para proteger la CPU
contra escritura.
Nota
Si en la CPU está activado el nivel de protección predefinido y la CPU dispone de la instrucción
"PROTECT", esta instrucción permite cambiar entre el nivel de protección predefinido "Sin
protección" y el nivel de protección "Protección contra escritura".

844

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Otros niveles de protección protegidos por contraseña
Para los siguientes niveles de protección es necesario asignar una contraseña:
● Protección contra escritura: Con este nivel de protección, si no se introduce la contraseña
correcta, únicamente será posible el acceso de lectura, independientemente de la posición
del interruptor de llave. Para seleccionar este nivel de protección, es necesario asignar una
contraseña.
● Protección de escritura/lectura: Con este nivel de protección, si no se introduce la
contraseña correcta, no se tendrá acceso ni de lectura ni de escritura, independientemente
de la posición del interruptor de llave. Para seleccionar este nivel de protección, es
necesario asignar una contraseña.
A los usuarios que conocen la contraseña se les permite el acceso en lectura y escritura,
independientemente del nivel de protección parametrizado.

Comportamiento de un módulo protegido por contraseña durante el funcionamiento
La protección de la CPU será efectiva una vez que los ajustes se hayan cargado en la CPU.
Antes de ejecutar una función online se comprueban los permisos y, si existe protección por
contraseña, se pide que se introduzca la contraseña.
Ejemplo: el módulo se ha parametrizado con una protección contra escritura y debe ejecutarse
la función "Forzar variable". Puesto que para ello se requiere un acceso de escritura, para
ejecutar la función hay que introducir la contraseña parametrizada.
Las funciones protegidas por contraseña sólo pueden ejecutarse desde una programadora o
un PC en un mismo momento. No se permite el acceso con contraseña de otra programadora
u otro PC.
El permiso de acceso a los datos protegidos tiene validez mientras dure la conexión online o
hasta que se vuelva a anular el permiso manualmente con "Online > Borrar derechos de
acceso".
Nota
No se pueden restringir las funciones para la conducción, visualización y comunicación del
proceso. Así, p. ej., la función "Ajustar fecha y hora" no se puede bloquear con una contraseña.

Modo Test y modo Proceso
Introducción
En algunos tipos de CPU se puede ajustar el modo de operación para el test del programa.
En el modo Proceso, las funciones de test, como Estado del programa u Observar/forzar
variable, están restringidas para no exceder la prolongación admisible del tiempo de ciclo. No
se puede efectuar el test con puntos de parada ni la ejecución del programa paso a paso.
En el modo Test desde la PG/el PC se pueden utilizar todas las funciones de test sin
restricciones, aunque prolonguen considerablemente el tiempo de ciclo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

845

Configuración de dispositivos y redes
1.4 Crear configuraciones

Posibilidades de ajuste del comportamiento operativo
Al realizar un test con el estado del programa en la ventana de inspección bajo "Propiedades
> Modo de operación", se pueden ajustar los siguientes modos de operación:
● Modo de prueba
Todas las funciones de prueba se pueden utilizar sin limitaciones. Es posible que aumente
el tiempo de ciclo de la CPU, ya que, por ejemplo, en cada bucle se determina el estado de
las instrucciones programadas en el mismo.
● Modo de proceso
La función de prueba "Estado del programa" se limita para garantizar una carga lo más
mínima posible del tiempo de ciclo:
– Por ejemplo, no se permite ninguna condición de llamada.
– La visualización del estado de un bucle programado se interrumpe en el punto de
retorno.
– No se puede ejecutar la función de prueba "PARADA" ni la ejecución del programa paso
a paso.
Nota
Si la CPU está en modo Test, hay que asegurarse de que la CPU o el proceso puedan soportar
una prolongación importante del tiempo de ciclo.
Con la opción "Modo Proceso" se evita que en el editor de programación se pueda configurar
el entorno de llamada.

Parámetros de las CPUs compactas
Función Contaje
Propiedades - Contaje
Descripción
Si se ha seleccionado la CPU con función de contaje y medición integrada en la vista de redes
o de dispositivos, es posible parametrizar la función de contaje para cada uno de los canales
mencionados en "Propiedades > General > Contaje" de la ventana de inspección.
Si se utiliza el canal 0 ó 1 como canal de contaje no se podrá utilizar la tecnología
"Posicionamiento".
Nota
El número de canales de contaje disponibles depende de la CPU utilizada.

846

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
En el campo de selección "Modo de operación" se puede definir el modo de contaje de la CPU
para cada canal. Existen varias opciones para ello. Como ajuste predeterminado está
seleccionada la opción "Sin parametrizar".

Consulte también
Documentación sobre funciones tecnológicas de la CPU (http://
support.automation.siemens.com/WW/view/de/12429336/0/es)

Selección de alarmas
Para la función "Contaje" es posible seleccionar diversas alarmas.

Requisitos
● La CPU está seleccionada.
● La selección de alarmas se encuentra en "Propiedades > General > Contaje > Selección de
alarmas".

Selección de alarmas (parámetros básicos)
Seleccione en la lista desplegable "Selección de alarmas" las alarmas que deberá disparar la
CPU. Dispone de las siguientes posibilidades de selección:
● Ninguna
● Diagnóstico
● Proceso
● Diagnóstico y proceso
El ajuste predeterminado es "Ninguna".
Los eventos que deben disparar una alarma de proceso se seleccionan dependiendo del modo
de operación ajustado.

Contaje
Eventos que pueden disparar una alarma de proceso:
● Abrir la puerta HW (si la puerta SW está abierta)
● Cerrar la puerta HW (si la puerta SW está abierta)
● Al alcanzar el valor de comparación (cuando reacciona el comparador)
● En caso de pulso de contaje
● Rebase por exceso (al rebasar el límite superior de contaje)
● Rebase por defecto (al rebasar el límite inferior de contaje)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

847

Configuración de dispositivos y redes
1.4 Crear configuraciones

Medición de frecuencia
Eventos que pueden disparar una alarma de proceso:
● Abrir la puerta HW (si la puerta SW está abierta)
● Cerrar la puerta HW (si la puerta SW está abierta)
● Fin de medición
● Rebase del límite superior
● Rebase del límite inferior

Modulación por ancho de pulso
Eventos que pueden disparar una alarma de proceso:
● Abrir la puerta HW (si la puerta SW está abierta)

Parámetros específicos de canal
General
En "Propiedades > General > Contaje > Canal 0 (... Canal n)" se ajustan los parámetros
específicos de canal. Para el modo de operación hay seis opciones disponibles: "Sin
configurar", "Contaje sin fin", "Contaje único", "Contaje periódico", "Medición de frecuencia" y
"Modulación del ancho de impulso".
El modo de operación predeterminado es "Sin configurar".

Contaje
Parámetros operativos 'Contaje'
Sentido normal de contaje
En los modos de operación "Contaje único" y "Contaje periódico" se puede seleccionar en la
lista desplegable "Sentido normal de contaje" si se desea incrementar o decrementar el
contador sin sentido normal de contaje o con sentido normal de contaje. El ajuste
predeterminado es "Ninguno".
En el modo de operación "Contaje sin fin", la lista desplegable "Sentido normal de contaje" no
está disponible.

Función de puerta
En la lista desplegable "Función de puerta" puede elegir si cancelar o interrumpir el contaje
cuando se cierre la puerta.
Si selecciona "Cancelar contaje", entonces el contaje comenzará a partir del valor de carga
cuando se cierre la puerta y se vuelva a abrir. Por otro lado, si selecciona "Interrumpir contaje",

848

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
el contaje continuará en el último valor de contaje actual cuando se cierre la puerta y se vuelva
a abrir.
Como ajuste predeterminado está seleccionado "Cancelar contaje".

Valor inicial/Valor final
Dependiendo del sentido normal de contaje seleccionado en la lista desplegable
correspondiente, en el campo de entrada "Valor inicial/valor final" podrá indicar un valor para
el límite de contaje correspondiente.
Entre el sentido normal de contaje y esta entrada existe la siguiente relación:
● En caso de que el sentido normal de contaje sea Adelante, aquí se introducirá un valor final.
● En caso de que el sentido normal de contaje sea hacia atrás, aquí se introduce un valor
inicial.
Si no hay seleccionado ningún sentido normal de contaje, este campo de entrada no esta
disponible.
El ajuste predeterminado (sólo visible si hay seleccionado un sentido normal de contaje) es
"2147483647".

Valor de comparación
En el campo de entrada "Valor de comparación" se puede introducir un valor que esté asignado
a la salida digital, al bit de estado del comparador STS_CMP y a una alarma de proceso. El
valor de contaje se compara con el valor de comparación. Dependiendo del resultado de dicha
comparación, se puede activar la salida y el bit de estado del comparador STS_CMP y se
puede generar la alarma de proceso "Alcanzar el valor de comparación".
En el grupo Salida se ajusta cómo se activará la salida en función del estado del contador.
El ajuste predeterminado del valor de comparación es "0".

Histéresis
Introduzca en el campo de entrada "Histéresis" un rango de histéresis entre 0 y 255 (0 y 1
significan: histéresis desactivada).
Un encoder puede detenerse en una posición determinada y, a continuación, "oscilar"
alrededor de dicha posición. Como consecuencia de este estado, el estado del contador
fluctuará en torno a un valor determinado. Si en esta banda de fluctuación se encontrase, por
ejemplo, un valor de comparación, la salida correspondiente se activaría y desactivaría al ritmo
de dichas fluctuaciones. Para evitar esta conmutación en caso de haya pequeñas
fluctuaciones, la CPU está equipada con una histéresis parametrizable.
La histéresis se puede modificar mediante el programa de usuario con la instalación en
marcha.
La histéresis afecta a la salida y a los bits de estado del comparador STS_CMP, del rebase por
exceso STS_OFLW, del rebase por defecto STS_UFLW y del paso por cero STS_ZP.
Como ajuste predeterminado se indica "0".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

849

Configuración de dispositivos y redes
1.4 Crear configuraciones

Base de tiempo
Es posible elegir si la duración del período debe medirse en unidades de 125 ns o 1 μs en caso
de una frecuencia de contaje máxima de 1 kHz. Si la frecuencia de contaje máxima es superior
a 1 kHz no se mide la duración del período. Es posible medir la duración del período de la señal
de contaje hasta una frecuencia de contaje máxima de 1 kHz.
Con una frecuencia de contaje máxima de 1 kHz se mide siempre el tiempo entre dos flancos
de contaje sucesivos.
Con una base de tiempo de 1 μs pueden medirse duraciones de período de 4294 s = 71 min.
34 s como máximo y, con una base de tiempo de 125 ns, de 178 s = 2 min. 58 s como máximo.
Si los flancos de contaje están más separados en el tiempo, la duración medida del período
será errónea, porque no se tiene en cuenta un rebase.

Entrada 0 (contaje)
Evaluación de señal
En la lista desplegable "Evaluación de señal" se selecciona qué señales transmite el encoder
conectado. Puede seleccionar las siguientes señales:
● Impulso y sentido
● Encoder 1x
● Encoder 2x
● Encoder 4x
El valor predeterminado es "Impulso y sentido".

Puerta HW
La casilla de verificación "Puerta HW" permite seleccionar si desea utilizar una puerta de
hardware o no.
Esta casilla de verificación no está activada de forma estándar.

Sentido de contaje invertido
La casilla de verificación "Sentido de contaje invertido" permite seleccionar si desea invertir el
sentido de contaje o no.
Esta casilla de verificación no está activada de forma estándar.

850

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Salida (contaje)
Comportamiento de la salida
Elija una de las siguientes opciones de la lista desplegable "Comportamiento de la salida":
● Sin comparación
La salida funciona como una salida normal.
Los parámetros de entrada SFB CTRL_DO y SET_DO no actúan.
Los bits de estado STS_DO y STS_CMP (estado del comparador en el IDB) permanecen
desactivados.
● Activar si estado del contador ≥ valor de comparación
La salida se activa en cuanto el estado del contador alcanza el valor de comparación y se
mantiene activada mientras el estado del contador sea mayor o igual al valor de
comparación.
● Activar si estado del contador ≤ valor de comparación
La salida se activa en cuanto el estado del contador alcanza el valor de comparación y se
mantiene activada mientras el estado del contador sea menor o igual al valor de
comparación.
● Impulso al alcanzar el valor de comparación
Es posible predefinir una duración de impulso para adaptarse a los actuadores utilizados.
La salida se activa por la duración de impulso ajustada en cuanto el estado del contador
alcanza el valor de comparación. Si se ha ajustado un sentido normal de contaje, la salida
se activa sólo cuando se alcanza el valor de comparación del sentido normal de contaje.
El ajuste predeterminado es "Sin comparación".

Duración de impulso
Si en la lista desplegable "Comportamiento de la salida" se ha seleccionado la alternativa
"Impulso al alcanzar el valor de comparación", hay que introducir la duración del impulso de la
señal de salida en ms en el campo de entrada "Duración de impulso". La duración máxima es
de 510 ms. Sólo es posible introducir valores pares.
La duración de impulso comienza al activarse la salida digital correspondiente. La imprecisión
de la duración de impulso es inferior a 2 ms.
Si se introduce 0 ms como duración de impulso, la salida queda activada hasta que la
condición de comparación deje de cumplirse.
El ajuste predeterminado es "0 ms".
Nota
Si la salida se activa cuando se alcanza el valor de comparación, también se activa el bit
STS_CMP, "Estado del comparador".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

851

Configuración de dispositivos y redes
1.4 Crear configuraciones

Frecuencia máx.
Señales de contaje/puerta HW
En esta lista desplegable se puede definir la frecuencia máxima de las señales vía A/impulso,
vía B/dirección y puerta de hardware de acuerdo con una escala fija. El valor máximo es
específico para cada CPU:
CPU

Rango de valores

Ajuste predeterminado

CPU 312C

10, 5, 2, 1 kHz

10 kHz

CPU 313C
CPU 313C-2 DP
CPU 313C-2 PtP

30, 10, 5, 2, 1 kHz

30 kHz

CPU 314C-2 DP
CPU 314C-2 PN/DP
CPU 314C-2 PtP

60, 30, 10, 5, 2, 1 kHz

60 kHz

Si la CPU no soporta esta función, la lista desplegable está atenuada.

Congelar
En esta lista desplegable es posible ajustar la frecuencia máxima de la señal de congelación
(latch) en una escala fija. El valor máximo es específico para cada CPU:
CPU

Rango de valores

Ajuste predeterminado

CPU 312C

10, 5, 2, 1 kHz

10 kHz

CPU 313C
CPU 313C-2 DP
CPU 313C-2 PtP

30, 10, 5, 2, 1 kHz

10 kHz

CPU 314C-2 DP
CPU 314C-2 PN/DP
CPU 314C-2 PtP

60, 30, 10, 5, 2, 1 kHz

10 kHz

Si la CPU no soporta esta función, la lista desplegable está atenuada.

Alarma de proceso en (contaje)
Descripción
Si hace clic en las casillas de verificación correspondientes, el evento en cuestión dispara una
alarma de proceso. Los siguientes eventos pueden disparar una alarma de proceso:
● Abrir la puerta HW (si la puerta SW está abierta)
● Cerrar la puerta HW (si la puerta SW está abierta)
● Al alcanzar el valor de comparación (cuando reacciona el comparador)
● En caso de pulso de contaje
● Rebase por exceso (al rebasar el límite superior de contaje)
● Rebase por defecto (al rebasar el límite inferior de contaje)

852

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Para que la CPU también genere una alarma de proceso, deberá habilitar esta opción en la
ficha "Parámetros básicos".
Como ajuste predeterminado no hay seleccionada ninguna casilla de verificación.
El disparo de una alarma de proceso en cada flanco de contaje provoca una fuerte carga de
trabajo de la CPU en caso de frecuencias de contaje elevadas. Si las alarmas de proceso
aparecen en el submódulo "Contaje" con más rapidez de la que pueden procesarse en el OB
de alarma de proceso (OB 40), se produce un diagnóstico de "Alarma de proceso perdida" si
la alarma de diagnóstico está habilitada.

Asignación de los datos de entrada
Asignación de los datos de entrada
Es posible elegir si con una frecuencia de contaje máxima de 1 kHz puede leerse el valor de
contaje o bien la duración del período en los datos de entrada (datos E) del submódulo
"Contaje". Si la frecuencia de contaje máxima es superior a 1 kHz sólo se admite "Valor de
contaje".
Es posible medir el período de la señal de contaje hasta una frecuencia de contaje máxima de
1 kHz.
Con una frecuencia de contaje máxima de 1 kHz se mide siempre el tiempo entre dos flancos
de contaje sucesivos. Si la frecuencia de contaje máxima es superior a 1 kHz no se mide la
duración del período, el valor es 0.

Medición de frecuencia
Medida de frecuencia
Descripción
En este modo de operación, la CPU cuenta los impulsos que aparecen en un intervalo de
tiempo predeterminado (tiempo de integración) y calcula la frecuencia a partir del número de
impulsos y de la duración del tiempo de integración.
El valor de la frecuencia determinada se indica en la unidad "mHz".

Parámetros operativos 'Medida de frecuencia'
Descripción
En este modo de operación, la CPU cuenta los impulsos que aparecen durante el tiempo de
integración parametrizado.
La medición se realiza durante el tiempo de integración. Una vez transcurrido el tiempo de
integración, se actualiza el valor medido.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

853

Configuración de dispositivos y redes
1.4 Crear configuraciones
Si durante el tiempo de integración no ha habido como mínimo un flanco ascendente, se dará
como respuesta el valor medido 0 o el valor medio, según sea la parametrización.

Tiempo de integración
En el campo de entrada "Tiempo de integración" se puede introducir un tiempo de integración
de entre 10 ms y 10000 ms.
El ajuste predeterminado es "100 ms".

Valor límite inferior y valor límite superior
En los campos de entrada "Valor límite inferior" y "Valor límite superior" se indican los valores
con los que se debe comparar la frecuencia determinada una vez transcurrido el tiempo de
integración. Para esta supervisión de límites se admiten los siguientes rangos de valores en
función de la CPU utilizada:
● Límite inferior
– CPU 312C: de 0 a 9 999 999 mHz
– CPU 313C: de 0 a 29 999 999 mHz
– CPU 314C: de 0 a 59 999 999 mHz
● Límite superior
– CPU 312C: de 1 mHz a 10 000 000 mHz
– CPU 313C: de 1 mHz a 30 000 000 mHz
– CPU 314C: de 1 mHz a 60 000 000 mHz
Nota
Al introducir estos valores se comprueba si el límite superior es mayor que el límite
inferior.
Como ajuste predeterminado, los límites inferiores están ajustados a 0 mHz. Como ajuste
predeterminado, los límites superiores tienen asignados los siguientes valores en función de
la CPU utilizada:
● CPU 312C: 10 000 000 mHz
● CPU 313C: 30 000 000 mHz
● CPU 314C: 60 000 000 mHz

854

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Máx. frecuencia de contaje/puerta HW
En esta lista desplegable se puede definir la frecuencia máxima de las señales vía A/impulso,
vía B/dirección y puerta de hardware de acuerdo con una escala fija. El valor máximo es
específico para cada CPU:
CPU

Rango de valores

Ajuste predeterminado

CPU 312C

10, 5, 2, 1 kHz

10 kHz

CPU 313C
CPU 313C-2 DP
CPU 313C-2 PtP

30, 10, 5, 2, 1 kHz

30 kHz

CPU 314C-2 DP
CPU 314C-2 PN/DP
CPU 314C-2 PtP

60, 30, 10, 5, 2, 1 kHz

60 kHz

Indicar valor medido
Puede elegir si desea que el valor medido se indique directamente o como valor medio. Para
ello, haga clic en la opción correspondiente "Directamente" o "Promediado" junto a "Salida
valor medido".
Al final del tiempo de integración, en el que se produce al menos un flanco ascendente, se
muestra la frecuencia medida.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

855

Configuración de dispositivos y redes
1.4 Crear configuraciones
Si durante el tiempo de integración parametrizado no ha habido como mínimo un flanco
positivo:
● En caso de frecuencia con valor directo, se indicará el valor "0" al final del tiempo de
integración.
● En caso de frecuencia con valor medio, se repartirá el último valor entre los siguientes
intervalos de medición sin flanco ascendente (f ≥ 1 mHz). Esto implica una prolongación del
tiempo de integración. Para ello se divide el último valor medido por el número de intervalos
de medición sin flanco ascendente.
Ejemplo: si el último valor medido es 12000 mHz y hay tres intervalos de medición, se
obtiene el valor 4000 mHz.

1
4

3

2

①
②
③
④

Intervalo t.
Frecuencia media
Frecuencia directa
Impulsos

El ajuste predeterminado es la opción "Directamente" de la lista desplegable.

Entrada 0 (medición de frecuencia)
Evaluación de señal
En la lista desplegable "Sentido de contaje invertido" se selecciona qué señales transmite el
encoder conectado. Se pueden seleccionar las siguientes señales:
● Impulso y sentido
● Encoder rotativo 1x
El ajuste predeterminado es "Impulso y sentido".

856

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Puerta HW
La casilla de verificación "Puerta HW" permite seleccionar si desea utilizar una puerta de
hardware o no.
Esta casilla de verificación no está activada de forma estándar.

Sentido de contaje invertido
La casilla de verificación "Sentido de contaje invertido" permite seleccionar si desea invertir el
sentido de contaje o no.
Esta casilla de verificación no está activada de forma estándar.

Salida (medición de frecuencia)
Comportamiento de la salida
Elija una de las siguientes opciones de la lista desplegable "Comportamiento de la salida":
● Sin comparación
La salida funciona como una salida normal.
Los parámetros de entrada SFB MAN_DO y SET_DO no actúan.
El bit de estado STS_DO queda desactivado.
● Activar cuando queda fuera de los límites
La salida se pone a 1 en cuanto la frecuencia medida es mayor que el límite superior o
menor que el límite inferior.
● Activar cuando queda por debajo del límite inferior
La salida se pone a 1 en cuanto la frecuencia medida es menor que el límite inferior.
● Activar cuando queda por encima del límite superior
La salida se activa en cuanto la frecuencia medida es mayor que el límite superior.
El ajuste predeterminado es la opción "Sin comparación".

Alarma de proceso en (medición de frecuencia)
Descripción
Si hace clic en las casillas de verificación correspondientes, el evento en cuestión dispara una
alarma de proceso. Los siguientes eventos pueden disparar una alarma de proceso:
● Abrir la puerta HW (si la puerta SW está abierta)
● Cerrar la puerta HW (si la puerta SW está abierta)
● Fin de medición
● Valor límite superior rebasado por exceso
● Valor límite inferior rebasado por defecto
Para que la CPU también genere una alarma de proceso, debe habilitar esta opción en la ficha
Parámetros básicos.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

857

Configuración de dispositivos y redes
1.4 Crear configuraciones
Como ajuste predeterminado no hay seleccionada ninguna casilla de verificación.

Modulación del ancho de impulso
Modulación del ancho de pulso
Descripción
La CPU transforma el valor de salida indicado por el usuario en una secuencia de impulsos con
la relación impulso/pausa correspondiente (modulación de ancho de pulso).
La secuencia de impulsos se emite una vez transcurrido el retardo a la conexión parametrizado
en la salida digital DO (secuencia de salida).

Parámetros operativos `Modulación del ancho de pulso´
Formato de salida
En la lista desplegable "Formato de salida" se selecciona el rango del valor de salida haciendo
clic en la opción "Por mil" o "Valor analógico S7".
Si el valor de salida está entre 0 y 1000, haga clic en la opción "Por mil".
Si el valor de salida es un valor analógico SIMATIC S7 (entre 0 y 27648), haga clic en la opción
"Valor analógico S7".
El ajuste predeterminado es el botón de opción "Por mil".

Base de tiempo
En la lista desplegable "Base de tiempo", seleccione la base de tiempo para la resolución y el
rango de valores de la duración de período, la duración mínima de impulso y el retardo a la
conexión.
Si se hace clic en la opción "1 ms", los tiempos se ajustan con una resolución de 1 ms.
Si se hace clic en la opción "0,1 ms", los tiempos se ajustan con una resolución de 0,1 ms.
El ajuste predeterminado es la opción "0,1 ms"

Retardo a la conexión
En el campo de entrada "Retardo a la conexión", introduzca un valor para el tiempo que
transcurre desde el comienzo de la secuencia de salida hasta la salida del impulso.
Introduzca el valor en la resolución ajustada anteriormente.
Si en la lista desplegable "Base de tiempo" ha hecho clic en la opción "1 ms", los tiempos se
ajustan de 0 ms a 65535 ms con una resolución de 1 ms.
Si en la lista desplegable "Base de tiempo" ha hecho clic en la opción "0,1 ms", los tiempos se
ajustan de 0 ms a 6553,5 ms con una resolución de 0,1 ms.

858

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
El ajuste predeterminado es "0".
La secuencia de impulsos se emite una vez transcurrido el retardo a la conexión en la salida
digital DO (secuencia de salida).

1

2

4

3

①
②
③
④

Retardo a la conexión
Duración de impulso
Duración del período
Salida DO

El ajuste predeterminado es "0".

Duración del período
La duración del período define la longitud de la secuencia de salida, que consiste en duración
de impulso y pausa entre impulsos.
Introduzca en el campo de entrada "Duración del período" un valor en la resolución ajustada
anteriormente.
Si en la lista desplegable "Base de tiempo" ha hecho clic en la opción "1 ms", los tiempos se
ajustan de 1 ms a 65535 ms con una resolución de 1 ms.
Si en la lista desplegable "Base de tiempo" ha hecho clic en la opción "0,1 ms", los tiempos se
ajustan de 0,4 ms a 6553,5 ms con una resolución de 0,1 ms.
El ajuste predeterminado es "20000".

Duración mínima de impulso
Con la duración mínima de impulso se suprimen impulsos de salida cortos y pausas de impulso
cortas. Se suprimen todos los impulsos y pausas que son más breves que la duración mínima
de impulso.
Introduzca en el campo de entrada "Duración mínima de impulso" un valor en la resolución
ajustada anteriormente.
Si en la lista desplegable "Base de tiempo" ha hecho clic en la opción "1 ms", los valores se
introducen de 0 hasta una duración de período/2.
Si en la lista desplegable "Base de tiempo" ha hecho clic en la opción "0,1 ms", los valores se
introducen de 2 hasta una duración de período/2.
Si se ha seleccionado la base de tiempo 1 ms y se introduce 0 como duración mínima de
impulso, ésta se ajusta internamente a 0,2 ms.
El ajuste predeterminado es "2".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

859

Configuración de dispositivos y redes
1.4 Crear configuraciones

Entrada 0 (modulación del ancho de impulso)
Puerta HW
La casilla de verificación "Puerta HW" permite seleccionar si desea utilizar una puerta de
hardware o no.
Esta casilla de verificación no está activada de forma estándar.
Sólo podrá iniciar la modulación del ancho de impulso con la puerta de hardware si primero
abre la puerta de software y, a continuación, genera un flanco ascendente en la entrada digital
"Puerta de hardware".
La modulación por ancho de impulso sólo se puede parar con un flanco descendente en la
puerta de software. El estado de la puerta de hardware es irrelevante.

Frecuencia de filtro
Puerta HW
Esta lista desplegable sólo está activa si se ha seleccionado la opción "Puerta HW" en
"Entrada". Aquí se ajusta la frecuencia máxima de la señal de la puerta de hardware en una
escala fija. El valor máximo es específico para cada CPU:
CPU

Rango de valores

Ajuste predeterminado

CPU 312C

10, 5, 2, 1 kHz

10 kHz

CPU 313C
CPU 313C-2 DP
CPU 313C-2 PtP

30, 10, 5, 2, 1 kHz

30 kHz

CPU 314C-2 DP
CPU 314C-2 PN/DP
CPU 314C-2 PtP

60, 30, 10, 5, 2, 1 kHz

60 kHz

Alarma de proceso en (modulación del ancho de impulso)
Descripción
Si se hace clic en la casilla de verificación correspondiente, el evento en cuestión dispara una
alarma de proceso. El siguiente evento puede disparar una alarma de proceso:
● Abrir la puerta HW (si la puerta SW está abierta)
Para que la CPU también genere una alarma de proceso, debe habilitar esta opción en la ficha
Parámetros básicos.
Como ajuste predeterminado no hay seleccionada ninguna casilla de verificación.

860

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Contaje sin fin
Descripción
El modo de operación "Contaje sin fin" se define del siguiente modo:
Cuando el contador alcanza el límite superior de contaje y aparece otro impulso de contaje, el
contador salta al límite inferior y sigue contando desde ahí.
Cuando el contador alcanza el límite inferior y aparece otro impulso de contaje, el contador
salta al límite superior y sigue contando desde ahí.
Los límites de contaje están ajustados de forma fija al rango máximo.
En este modo de operación, el contaje se inicia y se detiene mediante la función de puerta.

Contaje único
Descripción
Cuando el contador alcanza el valor final - 1 estando seleccionado como sentido normal de
contaje el ajuste Adelante y aparece otro impulso, el contador salta al valor inicial (valor de
carga) y se para aunque sigan apareciendo otros impulsos.
Cuando el contador alcanza el valor de contaje = 1 estando seleccionado como sentido normal
de contaje el ajuste Atrás y aparece otro impulso de contaje, el contador salta al valor inicial
(valor de carga) y permanece parado aunque aparezcan otros impulsos de contaje.
Si no ha ajustado el sentido normal de contaje, los límites de contaje corresponderán al rango
máximo.
En este modo de operación, el contaje se inicia y se detiene mediante la función de puerta.
Cuando la puerta se abre, los impulsos acceden al contador y éste empieza a contar. Cuando
se cierra, los impulsos ya no pueden acceder al contador y éste se para.

Contaje periódico
Descripción
Si el contador ha alcanzado el valor final - 1 al contar hacia delante en sentido normal de
contaje y llega otro pulso de contaje, el contador salta al valor de carga y sigue contando desde
allí.
Si el contador ha alcanzado el valor final = 1 al contar hacia atrás en sentido normal de contaje
y llega otro pulso de contaje, el contador salta al valor inicial (valor de carga) y sigue contando
desde allí.
Si no ha ajustado el sentido normal de contaje, los límites de contaje corresponderán al rango
máximo.
En este modo de operación, el contaje se inicia y se detiene mediante la función de puerta.
Cuando la puerta se abre, los impulsos acceden al contador y éste empieza a contar. Cuando
se cierra, los impulsos ya no pueden acceder al contador y éste se para.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

861

Configuración de dispositivos y redes
1.4 Crear configuraciones

Sentido normal de contaje
Descripción
Es posible parametrizar "adelante" o "atrás" como sentido normal de contaje. Así se define
para los modos de operación Contaje único y Contaje periódico qué límite de contaje rige como
valor inicial o final.
En el sentido normal de contaje hacia delante, el contador cuenta desde 0 o desde el valor de
carga hasta el valor final parametrizado.
En el sentido normal de contaje hacia atrás, el contador comienza por el valor inicial
parametrizado y cuenta hasta 0.
Aunque se haya parametrizado "atrás" como sentido normal de contaje, para contar hacia
atrás es necesario crear una señal de sentido correspondiente o ajustar "Sentido de contaje
invertido" en la parametrización.

Función de puerta
Puerta de software y puerta de hardware
La CPU tiene dos puerta combinadas lógicamente con Y:
Una puerta de software (puerta SW) que se controla mediante el programa de usuario.
La puerta de software puede abrirse únicamente con un cambio de flanco 0-1 del parámetro de
entrada SW_GATE en el SFB. Se cierra desactivando dicho parámetro.
Una puerta de hardware (puerta HW) que se controla mediante la entrada digital "Puerta de
hardware". En la ficha "Contaje" se ajusta si se quiere utilizar la puerta de hardware. Se abre
con un cambio de flanco 0-1 en la entrada digital y se cierra con un cambio de flanco 1-0.

Función Posicionamiento
Selección de alarmas
Para la función "Posicionamiento" existe la posibilidad de seleccionar alarmas.

Requisitos
● La CPU está seleccionada.
● La selección de alarmas se encuentra en "Propiedades > General > Posicionamiento >
Selección de alarmas".

862

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Selección de alarmas
Seleccione en la lista desplegable "Selección de alarmas" si la CPU debe o no disparar la
alarma de diagnóstico. Dispone de las siguientes posibilidades de selección:
● Ninguna
● Diagnóstico
El ajuste predeterminado es "Ninguna".
Para que los eventos correspondientes también disparen alarmas de diagnóstico, es
necesario realizar ajustes adicionales.
Active la vigilancia deseada en "Propiedades > General > Posicionamiento > Canal 0" estando
seleccionado el modo de operación "Posicionar con salida analógica":
● En "Accionamiento"
Se puede vigilar el valor real, la aproximación al destino y la zona de destino.
● En "Eje"
Para un eje lineal, aquí se puede establecer si se va a vigilar la zona de trabajo. El margen
de desplazamiento se vigila siempre.
● En "Encoder"
En caso de los encoders con señal cero (impulso de origen), se comprueba si el encoder
transmite siempre el mismo número de impulsos entre dos señales cero consecutivas.
En "Canal 0 - Diagnóstico" se seleccionan los eventos que deben disparar una alarma de
diagnóstico.
Para disparar una alarma de diagnóstico es necesario parametrizar los siguientes ajustes:
● Selección de alarmas en "Propiedades > General > Posicionamiento > Canal 0"
● La vigilancia correspondiente en el apartado "Accionamiento", "Eje" o "Encoder"
● La habilitación correspondiente en el apartado "Diagnóstico"

Modo de operación
Modo de operación
Con el parámetro "Modo de operación" se determina el modo en el que se va a realizar el
posicionamiento. Dispone de las siguientes opciones:
● Salidas analógicas: posicionamiento con salida analógica
● Salidas digitales: posicionamiento con salidas digitales
Como ajuste predeterminado está seleccionada la opción "Sin parametrizar".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

863

Configuración de dispositivos y redes
1.4 Crear configuraciones
La selección del modo de operación se encuentra en "Propiedades > General >
Posicionamiento > Canal 0".
Nota
La función tecnológica "Posicionamiento" no se puede parametrizar si en la función Contaje se
ha parametrizado Canal 0 o Canal 1.
Posicionar con salida analógica sólo se puede parametrizar si en el apartado AI5/AO2 está
desactivada la salida 0.
Los canales de entrada y salida ocupados por el posicionamiento ya no son accesibles desde
el programa de usuario.

Consulte también
Documentación sobre funciones tecnológicas de la CPU (http://
support.automation.siemens.com/WW/view/de/12429336/0/es)

Posicionamiento con salida analógica
Accionamiento
Activación del accionamiento y el tipo de control
Activación del accionamiento y el tipo de control
En el apartado "Canal 0 - accionamiento" de "Propiedades > Posicionamiento > Canal 0" se
determinan los parámetros para el accionamiento del eje en el posicionamiento con salida
analógica.

Descripción del accionamiento
El control del accionamiento se efectúa a través de dos salidas analógicas asignadas de forma
fija, ya sea con una tensión de ±10 V (pin 16) o con una intensidad de ±20 mA (pin 17).
Nota
El posicionamiento con salida analógica sólo se puede parametrizar si en el apartado AI5/AO2
de la navegación local está desactivada la salida 0.

Descripción del tipo de control
La lista desplegable permite elegir entre 2 tipos de control. El tipo de control describe cómo se
controla la etapa de potencia conectada.
● Tensión ±10 V o intensidad ±20 mA:

864

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
En los desplazamientos en sentido positivo (hacia delante) se aplica una tensión o intensidad
positiva. En los desplazamientos en sentido negativo (hacia atrás) se aplica una tensión o
intensidad negativa.
● Tensión 0 a 10 V e intensidad 0 a 20 mA y señal de sentido:
En los desplazamientos en sentido positivo (hacia delante) se aplica una tensión o intensidad
positiva y la salida digital CONV_DIR está desactivada.
En los desplazamientos en sentido negativo (hacia atrás) se aplica una tensión o intensidad
negativa y la salida digital CONV_DIR está activada.
El ajuste predeterminado es "±10".

Frecuencia max.
Lectura de recorrido
En esta lista desplegable se puede ajustar la frecuencia de contaje máxima de las señales de
lectura de recorrido (señales del encoder A, B, N) en una escala fija.
Si la CPU no soporta esta función, la lista desplegable está atenuada.
El ajuste predeterminado es "60 kHz".

Señales cualificadoras
En esta lista desplegable es posible ajustar la frecuencia máxima de las señales de medición
de longitud y sensor del punto de referencia en una escala fija.
Si la CPU no soporta esta función, la lista desplegable está atenuada.
El ajuste predeterminado es "10 kHz".

Aproximación a destino (analógica)
Zona de destino
En el campo de entrada "Zona de destino" se introduce un valor par entre 0 y 2 x 10 impulsos.
Los valores impares se redondean internamente. La zona de destino está situada de forma
simétrica en torno al destino. Si se introduce aquí el valor 0, el destino debe alcanzarse
exactamente con el impulso. En este caso se desactiva la vigilancia de la zona de destino y la
casilla de verificación correspondiente del área "Vigilancia" aparece atenuada.
El ajuste predeterminado es de "50 impulsos".

Tiempo de vigilancia
En el campo de entrada "Tiempo de vigilancia" se introduce un tiempo entre 0 y 100000 ms. La
CPU redondea dicho valor a un ciclo de ejecución de 4 ms.
Con el tiempo de vigilancia, la CPU vigila el valor real y la aproximación a destino.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

865

Configuración de dispositivos y redes
1.4 Crear configuraciones
Si se introduce el valor 0 aquí, se desactivan las vigilancia del valor real y de la aproximación
al destino y las casillas de verificación correspondientes en el área "Vigilancia" están
atenuadas.
El ajuste predeterminado es de "2000 ms".

Velocidad máxima
En el campo de entrada "Velocidad máxima" se introduce un valor entre 10 y 1 000 000
impulsos/s, que equivale al nivel de 10 V o 20 mA en la salida analógica.
El ajuste predeterminado es de "1000 impulsos/s".

Velocidad lenta/de búsqueda de referencia
En el campo de entrada "Velocidad lenta/de búsqueda de referencia" se introduce un valor
entre 10 impulsos/s y la velocidad máxima parametrizada.
Una vez alcanzado el punto de frenada se decelera a velocidad lenta.
En la búsqueda del punto de referencia, se decelera a la velocidad de búsqueda de referencia
una vez alcanzado el sensor del punto de referencia.
El ajuste predeterminado es de "100 impulsos/s".

Habilitar etapa de potencia
Retardo a la desconexión
En el campo de entrada "Retardo a la desconexión" introduzca un tiempo en milisegundos. La
CPU redondea dicho valor a un ciclo de ejecución de 4 ms. En caso de interrumpirse un
desplazamiento (retirada de la habilitación para la etapa de potencia), la salida CONV_EN se
desactiva con un retardo correspondiente a este tiempo.
Si controla un freno a través de la salida digital, mediante el retardo puede garantizar que el eje
sea tan lento en el momento de activar la salida que el freno pueda disipar la energía del
movimiento.
El ajuste predeterminado es "1000 ms".

Vigilancia (analógica)
Descripción
Aquí se activa y se desactiva la vigilancia del valor real, de la aproximación al destino y de la
zona de destino.

866

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Zona de destino
Haciendo clic en la casilla de verificación "Zona de destino" se vigila si, tras alcanzar la zona
de destino, el accionamiento se detiene en la posición de destino del movimiento iniciado o si
se aleja de ella.
Si en "Zona de destino" se ha ajustado un tiempo de vigilancia de 0 ms, no es posible activar
la vigilancia de la zona de destino y los campos correspondientes están atenuados.
En caso de que la vigilancia reaccione se genera un error externo. Dicho error externo debe ser
acusado mediante ERR_A. La vigilancia se desactiva. La vigilancia no se vuelve a activar
hasta que no se inicia otro desplazamiento.
Esta vigilancia está desactivada de forma estándar.

Aproximación a destino
Si se ha hecho clic en la casilla de verificación "Aproximación a destino", se vigila si el eje
alcanza la zona de destino dentro del tiempo de vigilancia después de alcanzar el punto de
desconexión.
Si en "Aproximación a destino" se ha ajustado un tiempo de vigilancia de 0 ms, no es posible
activar la vigilancia de la aproximación a destino y los campos correspondientes están
atenuados.
Esta vigilancia está desactivada de forma estándar.

Valor real
Si se hace clic en la casilla de verificación "Valor real", se vigila el movimiento del eje desde el
inicio del desplazamiento hasta alcanzar el punto de desconexión. Si el eje no se desplaza al
menos un impulso en el sentido predeterminado durante el tiempo de vigilancia, se interrumpe
el movimiento.
Si en "Aproximación a destino" se ha ajustado un tiempo de vigilancia de 0 ms, no es posible
activar la vigilancia del valor real y los campos correspondientes están atenuados.
La CPU no detecta el fallo de una entrada digital. Mediante la vigilancia del valor real se puede
detectar el fallo de una señal del encoder. Este fallo puede tener las siguientes causas:
● Fallo de la entrada digital
● Rotura de hilo
● Defecto del encoder
● Error en la etapa de potencia
Como ajuste predeterminado está activada esta vigilancia.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

867

Configuración de dispositivos y redes
1.4 Crear configuraciones

Eje
Tipo de eje (analógico)
Descripción
En "Propiedades > Posicionamiento > Canal 0" del apartado "Canal 0 - eje" se determinan los
parámetros para el eje.

Tipo de eje
En "Tipo de eje" seleccione si desea controlar un eje lineal o un eje rotativo.
El ajuste predeterminado es "Eje lineal".

Inicio y fin del final de carrera por software
El área de trabajo de un eje lineal está entre el inicio y el final del final de carrera por software.
Los finales de carrera por software forman parte del área de trabajo. Introduzca en los campos
de entrada correspondientes valores entre - 5 x 108 y 5 x 108 impulsos. El inicio del final de
carrera por software siempre debe ser menor que el final del final de carrera por software.
Los finales de carrera por software se vigilan cuando el eje está sincronizado y la vigilancia del
área de trabajo está activada.
El ajuste predeterminado es de "-100000000 impulsos" para el inicio y "100000000 impulsos"
para el final del final de carrera por software.

Fin de eje rotativo
En el campo de entrada "Fin eje rotativo" introduzca un valor entre 1 y 109 impulsos.
El valor "Fin de eje rotativo" es el valor teóricamente más grande que puede alcanzar el valor
real. Tiene la misma posición física que el inicio del eje rotativo (0).
El ajuste predeterminado es de "100000 impulsos".

Medición de longitud (analógica)
Descripción
La función "Medición de longitud" permite medir longitudes durante un desplazamiento. El
inicio y el fin de la medición de longitud tienen lugar mediante flancos en la entrada digital
"Medición de longitud". Seleccione el tipo de flanco en la lista desplegable "Detección".
Dispone de las siguientes opciones:
● OFF
● Principio/fin con flanco ascendente
Un flanco ascendente en la entrada digital inicia la medición de longitud, el siguiente flanco
ascendente la finaliza.

868

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Principio/fin con flanco descendente
Un flanco descendente en la entrada digital inicia la medición de longitud, el siguiente flanco
descendiente lo finaliza.
● Inicio con flanco ascendente, fin con flanco descendente
Un flanco ascendente en la entrada digital inicia la medición de longitud, el siguiente flanco
descendente la finaliza.
● Inicio con flanco descendente, fin con flanco ascendente
Un flanco descendente en la entrada digital inicia la medición de longitud, el siguiente flanco
ascendente la finaliza.
El ajuste predeterminado es "OFF".

Punto de referencia (analógico)
Coordenadas
Tras una transición STOP-RUN de la CPU y si el eje todavía no está sincronizado, el valor real
se pone al valor de la coordenada del punto de referencia.
Tras una búsqueda del punto de referencia, se asigna al punto de referencia el valor de la
coordenada del punto de referencia.
Tratándose de un eje lineal, el valor de la coordenada del punto de referencia debe estar
comprendido dentro del área de trabajo (incluidos el inicio y el final del final de carrera de
software).
Tratándose de un eje rotativo, el valor de la coordenada del punto de referencia debe
encontrarse en el rango de 0 a "Fin del eje rotativo - 1".
El ajuste predeterminado es de "0 impulsos".

Decalaje del punto de referencia con respecto al sensor
En la lista desplegable "Decalaje del punto de referencia con respecto al sensor", elija si el
punto de referencia se encuentra en sentido más (+) (los valores reales se incrementan) o en
sentido menos (-) (los valores reales se decrementan) con respecto al sensor del punto de
referencia.
El ajuste predeterminado es "en sentido +".

Vigilancia del eje (analógica)
Área de trabajo
Para un eje lineal, aquí se puede establecer si se va a vigilar el área de trabajo. Si se hace clic
en la casilla de verificación "Área de trabajo", se comprueba si el valor real de posición se
encuentra fuera de los finales de carrera por software. La vigilancia tiene efecto solamente en
caso de que el eje esté sincronizado.
Las coordenadas de los finales de carrera por software pertenecen al área de trabajo.
Si se dispara la vigilancia se interrumpe el desplazamiento.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

869

Configuración de dispositivos y redes
1.4 Crear configuraciones
Como ajuste predeterminado está activada esta vigilancia.

Rango de desplazamiento
Con la vigilancia del rango de desplazamiento se comprueba si se abandona el rango de
desplazamiento admisible de ‑ 5 x 108 a + 5 x 108. El rango de desplazamiento se vigila
siempre. La vigilancia no se puede desactivar (siempre está activada en el parámetro
"Vigilancia").
Si se dispara la vigilancia se interrumpe el desplazamiento.

Eje lineal
Descripción
El eje lineal es un eje que tiene un margen de desplazamiento físico limitado.
El área de trabajo de un eje lineal está limitada por los finales de carrera por software.

1

①
②

2

Inicio físico
Fin físico

Eje rotativo
Descripción
El eje rotativo es un eje cuyo rango de desplazamiento no está limitado por topes mecánicos.

1

①
②

2

Valor más alto visualizable = Final del eje rotativo - 1
Inicio del eje rotativo (coordenada 0) = Final del eje rotativo

Una vuelta del eje rotativo comienza por la coordenada "Cero" y termina por la coordenada
"Final del eje rotativo" Físicamente, la coordenada "Cero" es idéntica a la coordenada "Final
del eje rotativo" (= 0). En este punto salta la visualización del valor real de posición. La
visualización del valor real de posición siempre es positiva.

870

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Encoder
N.º de incrementos por vuelta
En el campo de entrada "N.º de incrementos por vuelta" se introduce el número de incrementos
del encoder en una vuelta completa. Dicho valor se toma de la descripción del encoder.
La CPU evalúa los incrementos por cuadruplicado, es decir, un incremento equivale a cuatro
impulsos.
El ajuste predeterminado es de "1000 incrementos".

Sentido de contaje
Con "Sentido de contaje" se adapta el sentido de la lectura del recorrido al sentido del
movimiento del eje.
Haga clic en la opción "Normal" de la lista desplegable "Sentido de contaje", si los impulsos de
contaje ascendentes corresponden a valores reales de posición ascendentes.
Haga clic en la opción "Invertido" de la lista desplegable "Sentido de contaje", si los impulsos
de contaje ascendentes corresponden a valores reales de posición descendentes.
Tenga en cuenta también todos los sentidos de giro de los elementos de transmisión (como
acoplamientos y transmisiones).
El ajuste predeterminado es la opción "Normal".

Vigilancia
En "Vigilancia" se determina si se deben vigilar los errores de señal del encoder. Esto sólo es
posible en encoders cuyo valor en "N.º de incrementos por vuelta" sea divisible por 10 ó 16.
Haciendo clic en la casilla de verificación "Error en señal" se comprueba si el encoder devuelve
siempre el mismo número de impulsos entre dos señales cero consecutivas.
Si se utiliza un encoder sin señal cero, habrá que desactivar la vigilancia de los errores en
señal.
Esta vigilancia está desactivada de forma estándar.

Diagnóstico
Descripción
Seleccione en el apartado "Canal 0 - diagnóstico" de "Propiedades > Posicionamiento > Canal
0" en qué eventos es necesario generar una alarma de diagnóstico. Como ajuste
predeterminado no hay seleccionada ninguna casilla de verificación.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

871

Configuración de dispositivos y redes
1.4 Crear configuraciones

Error en señal
Si se hace clic en la casilla de verificación "Error en señal", se genera una alarma de
diagnóstico tan pronto como el encoder deja de transmitir el mismo número de impulsos entre
dos señales cero consecutivas. Para ello se debe activar la vigilancia correspondiente en el
apartado "Canal 0 - encoder".

Rango de desplazamiento
Si se hace clic en la casilla de verificación "Rango de desplazamiento", se genera una alarma
de diagnóstico en cuanto el eje abandona el rango de desplazamiento. La vigilancia
correspondiente siempre está activada.

Zona de trabajo
Si se hace clic en la casilla de verificación "Área de trabajo", se genera una alarma de
diagnóstico si el valor real de posición se encuentra fuera de los finales de carrera por software.
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 - eje".
En caso de que el posicionamiento sea en un eje rotativo no se podrá utilizar esta alarma de
diagnóstico. La casilla de verificación correspondiente aparecerá sombreada.

Valor real
Si ha marcado la casilla de verificación "Valor real", se generará una alarma de diagnóstico si
durante un movimiento de desplazamiento el eje no se mueve como mínimo un impulso en el
sentido indicado dentro del tiempo de vigilancia. En tal caso se interrumpirá el desplazamiento.
El valor real se vigila desde el inicio del desplazamiento hasta alcanzar el punto de
desconexión.
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 accionamiento".
La CPU no detecta el fallo de una entrada digital. Activando la vigilancia del valor real se puede
detectar el fallo de una señal de sensor.
Esta casilla de verificación está seleccionada de forma estándar.

Aproximación a destino
Si se hace clic en la casilla de verificación "Aproximación a destino", se genera una alarma de
diagnóstico si, tras alcanzar el punto de desconexión, el eje no alcanza la zona de destino
durante el tiempo de vigilancia.
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 accionamiento".

Zona de destino
Si se ha hecho clic en la casilla de verificación "Zona de destino", se genera una alarma de
diagnóstico si el accionamiento no se detiene en una posición de destino del movimiento
iniciado o si se aleja de ella después de alcanzar la zona de destino.

872

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 accionamiento".

Posicionamiento con salidas digitales
Accionamiento
Activación del accionamiento
En el apartado "Canal 0 - accionamiento" de "Propiedades > Posicionamiento > Canal 0" se
determinan los parámetros para el accionamiento del eje en el posicionamiento con salidas
digitales.

Descripción
El accionamiento se activa a través de cuatro salidas digitales de 24 V con asignación fija.
La lista desplegable permite elegir entre 4 tipos de control. El tipo de control describe cómo las
4 salidas digitales (de DO + 1.0 a DO + 1.3) controlan la etapa de potencia.
A continuación se especifica la función de cada una de las salidas en los diversos tipos de
control.
Salida

Tipo de control 1

Tipo de control 2

Tipo de control 3

Tipo de control 4

DO + 1.0

Marcha rápida

Marcha rápida/lenta

Marcha rápida

Marcha rápida +

DO + 1.1

Marcha lenta

Posición alcanzada

Marcha lenta

Marcha lenta +

DO + 1.2

Desplazamiento +

Desplazamiento +

Desplazamiento +

Marcha rápida -

DO + 1.3

Desplazamiento -

Desplazamiento -

Desplazamiento -

Velocidad lenta -

Frecuencia max.
Lectura de recorrido
En esta lista desplegable se puede ajustar la frecuencia de contaje máxima de las señales de
lectura de recorrido (señales del encoder A, B, N) en una escala fija.
Si la CPU no soporta esta función, la lista desplegable está atenuada.
El ajuste predeterminado es "60 kHz".

Señales cualificadoras
En esta lista desplegable es posible ajustar la frecuencia máxima de las señales de medición
de longitud y sensor del punto de referencia en una escala fija.
Si la CPU no soporta esta función, la lista desplegable está atenuada.
El ajuste predeterminado es "10 kHz".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

873

Configuración de dispositivos y redes
1.4 Crear configuraciones

Aproximación a destino (digital)
Zona de destino
Introduzca en el campo de entrada "Zona de destino" un valor par entre 0 y 2 x 108 impulsos.
Los valores impares se redondean internamente. La zona de destino está situada de forma
simétrica en torno al destino. Si se introduce aquí el valor 0, el destino debe alcanzarse
exactamente con el impulso. En este caso se desactivará la vigilancia de la zona de destino y
la casilla de opción correspondiente de la ficha "Vigilancia" aparecerá sombreada
El ajuste predeterminado es de "50 impulsos".

Tiempo de vigilancia
En el campo de entrada "Tiempo de vigilancia" se introduce un tiempo entre 0 y 100000 ms. La
CPU redondea dicho valor a un ciclo de ejecución de 4 ms.
Con el tiempo de vigilancia, la CPU vigila el valor real y la aproximación a destino.
Si se introduce el valor 0 aquí, se desactivan las vigilancia del valor real y de la aproximación
al destino y las casillas de verificación correspondientes en el área "Vigilancia" están
atenuadas.
El ajuste predeterminado es "2000 ms".

Vigilancia (digital)
Descripción
Aquí se activa y se desactiva la vigilancia del valor real, de la aproximación al destino y de la
zona de destino.

Aproximación a destino
Si ha marcado la casilla de verificación "Aproximación a destino", se vigila si el eje alcanza la
zona de destino dentro del tiempo de vigilancia después de alcanzar el punto de desconexión.
Si se ha ajustado un tiempo de vigilancia de 0 ms en "Aproximación a destino", no se podrá
activar la vigilancia del valor real y de la aproximación a destino y los campos correspondientes
aparecerán sombreados.
Esta vigilancia está desactivada de forma estándar.

Zona de destino
Haciendo clic en la casilla de verificación "Zona de destino" se vigila si, tras alcanzar la zona
de destino, el accionamiento se detiene en la posición de destino del movimiento iniciado o si
se aleja de ella.
En caso de que la vigilancia reaccione se genera un error externo. Dicho error externo debe ser
acusado mediante ERR_A. La vigilancia se desactiva. La vigilancia no se vuelve a activar
hasta que no se inicia otro desplazamiento.

874

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Esta vigilancia está desactivada de forma estándar.

Valor real
Si se hace clic en la casilla de verificación "Valor real", se vigila el movimiento del eje desde el
inicio del desplazamiento hasta alcanzar el punto de desconexión. Si el eje no se desplaza al
menos un impulso en el sentido predeterminado durante el tiempo de vigilancia, se
interrumpirá el movimiento.
Si se ha ajustado un tiempo de vigilancia de 0 ms en "Aproximación a destino", no se podrá
activar la vigilancia del valor real y de la aproximación a destino y los campos correspondientes
aparecerán sombreados.
La CPU no detecta el fallo de una entrada digital. Mediante la vigilancia del valor real se puede
detectar el fallo de una señal de sensor. Este fallo puede tener las siguientes causas:
● fallo de la entrada digital
● rotura de hilo
● defecto del encoder
● error en la etapa de potencia
Como ajuste predeterminado está activada esta vigilancia.

Eje
Tipo de eje (digital)
Descripción
En "Tipo de eje" seleccione si desea controlar un eje lineal o un eje rotativo.
El ajuste predeterminado es "Eje lineal".

Inicio y fin del final de carrera por software
El área de trabajo de un eje lineal está entre el inicio y el final del final de carrera por software.
Los finales de carrera por software forman parte del área de trabajo. Introduzca en los campos
de entrada correspondientes valores entre - 5 x 108 y 5 x 108 impulsos. El inicio del final de
carrera por software siempre debe ser menor que el final del final de carrera por software.
Los finales de carrera por software se vigilan cuando el eje está sincronizado y la vigilancia del
área de trabajo está activada.
El ajuste predeterminado es de "-100000000 impulsos" para el inicio y "100000000 impulsos"
para el final del final de carrera por software.

Fin de eje rotativo
En el campo de entrada "Fin eje rotativo" introduzca un valor entre 1 y 109 impulsos.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

875

Configuración de dispositivos y redes
1.4 Crear configuraciones
El valor "Fin de eje rotativo" es el valor teóricamente más grande que puede alcanzar el valor
real. Tiene la misma posición física que el inicio del eje rotativo (0).
El ajuste predeterminado es de "100000 impulsos".

Medición de longitud (digital)
Descripción
La función "Medición de longitud" permite medir longitudes durante un desplazamiento. El
inicio y el fin de la medición de longitud tienen lugar mediante flancos en la entrada digital
"Medición de longitud". Seleccione el tipo de flanco en la lista desplegable "Detección".
Dispone de las siguientes opciones:
● OFF
● Principio/fin con flanco ascendente
Un flanco ascendente en la entrada digital inicia la medición de longitud, el siguiente flanco
ascendente la finaliza.
● Principio/fin con flanco descendente
Un flanco descendente en la entrada digital inicia la medición de longitud, el siguiente flanco
descendiente lo finaliza.
● Inicio con flanco ascendente, fin con flanco descendente
Un flanco ascendente en la entrada digital inicia la medición de longitud, el siguiente flanco
descendente la finaliza.
● Inicio con flanco descendente, fin con flanco ascendente
Un flanco descendente en la entrada digital inicia la medición de longitud, el siguiente flanco
ascendente la finaliza.
El ajuste predeterminado es "OFF".

Punto de referencia (digital)
Coordenadas
Tras una transición STOP-RUN de la CPU y si el eje todavía no está sincronizado, el valor real
se pone al valor de la coordenada del punto de referencia.
Tras una búsqueda del punto de referencia, se asigna al punto de referencia el valor de la
coordenada del punto de referencia.
Tratándose de un eje lineal, el valor de la coordenada del punto de referencia debe estar
comprendido dentro del área de trabajo (incluidos el inicio y el final del final de carrera de
software).
Tratándose de un eje rotativo, el valor de la coordenada del punto de referencia debe
encontrarse en el rango de 0 a "Fin del eje rotativo - 1".
El ajuste predeterminado es de "0 impulsos".

876

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Decalaje del punto de referencia con respecto al sensor
En la lista desplegable "Decalaje del punto de referencia con respecto al sensor", elija si el
punto de referencia se encuentra en sentido más (+) (los valores reales se incrementan) o en
sentido menos (-) (los valores reales se decrementan) con respecto al sensor del punto de
referencia.
El ajuste predeterminado es "en sentido +".

Vigilancia del eje (digital)
Área de trabajo
Para un eje lineal, aquí se puede establecer si se va a vigilar el área de trabajo. Si se hace clic
en la casilla de verificación "Área de trabajo", se comprueba si el valor real de posición se
encuentra fuera de los finales de carrera por software. La vigilancia tiene efecto solamente en
caso de que el eje esté sincronizado.
Las coordenadas de los finales de carrera por software pertenecen al área de trabajo.
Si se dispara la vigilancia se interrumpe el desplazamiento.
Como ajuste predeterminado está activada esta vigilancia.

Rango de desplazamiento
Con la vigilancia del rango de desplazamiento se comprueba si se abandona el rango de
desplazamiento admisible de ‑ 5 x 108 a + 5 x 108. El rango de desplazamiento se vigila
siempre. La vigilancia no se puede desactivar (siempre está activada en el parámetro
"Vigilancia").
Si se dispara la vigilancia se interrumpe el desplazamiento.

Eje lineal
Descripción
El eje lineal es un eje que tiene un margen de desplazamiento físico limitado.
El área de trabajo de un eje lineal está limitada por los finales de carrera por software.

1

①
②

2

Inicio físico
Fin físico

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

877

Configuración de dispositivos y redes
1.4 Crear configuraciones

Eje rotativo
Descripción
El eje rotativo es un eje cuyo rango de desplazamiento no está limitado por topes mecánicos.

1

①
②

2

Valor más alto visualizable = Final del eje rotativo - 1
Inicio del eje rotativo (coordenada 0) = Final del eje rotativo

Una vuelta del eje rotativo comienza por la coordenada "Cero" y termina por la coordenada
"Final del eje rotativo" Físicamente, la coordenada "Cero" es idéntica a la coordenada "Final
del eje rotativo" (= 0). En este punto salta la visualización del valor real de posición. La
visualización del valor real de posición siempre es positiva.

Encoder
N.º de incrementos por vuelta
En el campo de entrada "N.º de incrementos por vuelta" se introduce el número de incrementos
del encoder en una vuelta completa. Dicho valor se toma de la descripción del encoder.
La CPU evalúa los incrementos por cuadruplicado, es decir, un incremento equivale a cuatro
impulsos.
El ajuste predeterminado es de "1000 incrementos".

Sentido de contaje
Con "Sentido de contaje" se adapta el sentido de la lectura del recorrido al sentido del
movimiento del eje.
Haga clic en la opción "Normal" de la lista desplegable "Sentido de contaje", si los impulsos de
contaje ascendentes corresponden a valores reales de posición ascendentes.
Haga clic en la opción "Invertido" de la lista desplegable "Sentido de contaje", si los impulsos
de contaje ascendentes corresponden a valores reales de posición descendentes.
Tenga en cuenta también todos los sentidos de giro de los elementos de transmisión (como
acoplamientos y transmisiones).
El ajuste predeterminado es la opción "Normal".

Vigilancia
En "Vigilancia" se determina si se deben vigilar los errores de señal del encoder. Esto sólo es
posible en encoders cuyo valor en "N.º de incrementos por vuelta" sea divisible por 10 ó 16.

878

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Haciendo clic en la casilla de verificación "Error en señal" se comprueba si el encoder devuelve
siempre el mismo número de impulsos entre dos señales cero consecutivas.
Si se utiliza un encoder sin señal cero, habrá que desactivar la vigilancia de los errores en
señal.
Esta vigilancia está desactivada de forma estándar.

Diagnóstico
Descripción
Seleccione en el apartado "Canal 0 - diagnóstico" de "Propiedades > Posicionamiento > Canal
0" en qué eventos es necesario generar una alarma de diagnóstico. Como ajuste
predeterminado no hay seleccionada ninguna casilla de verificación.

Error en señal
Si se hace clic en la casilla de verificación "Error en señal", se genera una alarma de
diagnóstico tan pronto como el encoder deja de transmitir el mismo número de impulsos entre
dos señales cero consecutivas. Para ello se debe activar la vigilancia correspondiente en el
apartado "Canal 0 - encoder".

Rango de desplazamiento
Si se hace clic en la casilla de verificación "Rango de desplazamiento", se genera una alarma
de diagnóstico en cuanto el eje abandona el rango de desplazamiento. La vigilancia
correspondiente siempre está activada.

Zona de trabajo
Si se hace clic en la casilla de verificación "Área de trabajo", se genera una alarma de
diagnóstico si el valor real de posición se encuentra fuera de los finales de carrera por software.
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 - eje".
En caso de que el posicionamiento sea en un eje rotativo no se podrá utilizar esta alarma de
diagnóstico. La casilla de verificación correspondiente aparecerá sombreada.

Valor real
Si ha marcado la casilla de verificación "Valor real", se generará una alarma de diagnóstico si
durante un movimiento de desplazamiento el eje no se mueve como mínimo un impulso en el
sentido indicado dentro del tiempo de vigilancia. En tal caso se interrumpirá el desplazamiento.
El valor real se vigila desde el inicio del desplazamiento hasta alcanzar el punto de
desconexión.
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 accionamiento".
La CPU no detecta el fallo de una entrada digital. Activando la vigilancia del valor real se puede
detectar el fallo de una señal de sensor.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

879

Configuración de dispositivos y redes
1.4 Crear configuraciones
Esta casilla de verificación está seleccionada de forma estándar.

Aproximación a destino
Si se hace clic en la casilla de verificación "Aproximación a destino", se genera una alarma de
diagnóstico si, tras alcanzar el punto de desconexión, el eje no alcanza la zona de destino
durante el tiempo de vigilancia.
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 accionamiento".

Zona de destino
Si se ha hecho clic en la casilla de verificación "Zona de destino", se genera una alarma de
diagnóstico si el accionamiento no se detiene en una posición de destino del movimiento
iniciado o si se aleja de ella después de alcanzar la zona de destino.
Para ello se debe activar la vigilancia correspondiente en el apartado "Canal 0 accionamiento".

Función Acoplamiento punto a punto
Protocolo ASCII
Transferencia PtP (ASCII)
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "ASCII" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "ASCII" hay 4 grupos de parámetros: transferencia, delimitador de fin, recepción de
datos y ocupación de las señales.
Este apartado se ocupa de la transferencia PtP y está dividido en 3 secciones.

Velocidad de transferencia
En la lista desplegable "Velocidad de transferencia", seleccione la velocidad de transferencia
de datos en bits/s (baudios). Puede seleccionar un valor entre 300 y 38400 baudios. En modo
dúplex, la velocidad de transferencia máxima es de 19200 baudios.
El ajuste predeterminado es "9600 baudios".

880

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Trama
Los datos se transmiten en una trama a través de la interfaz serie. Para cada trama se dispone
de dos formatos de datos.
● Bits de datos
Seleccione en la lista desplegable "Bits de datos" la cantidad de bits que representarán un
carácter.
El ajuste predeterminado es "8 bit".
● Bits de parada
En la lista desplegable "Bits de parada", seleccione el número de bits que se pospondrán
a cada carácter a transmitir durante la transmisión. Los bits de parada marcan el final de un
carácter.
El ajuste predeterminado es "1 bit".
● Paridad
En la lista desplegable "Paridad" puede seleccionar si elevar el grado de protección de la
transmisión mediante un bit de paridad. El parámetro de paridad "Sin" significa que no se
transmitirá ningún bit de paridad. Si se ha ajustado 7 bits de datos, no es posible seleccionar
la opción "Sin".
Existe la posibilidad de ampliar una secuencia de bits de información añadiéndole otro bit,
el bit de paridad, que completa el valor de todos los bits con un valor añadido ("0" o "1"),
dotándoles así del mismo estado (par o impar).
El ajuste predeterminado es "Par".

Transferencia de control del flujo de datos
● Control del flujo de datos
Aquí solamente pueden ajustarse parámetros si está seleccionado el parámetro de control
del flujo de datos "XON/XOFF".
El ajuste predeterminado es "Sin".
● Carácter XON
Introduzca un código para el carácter XON en el campo de entrada "Carácter XON".
Introduzca el código en formato hexadecimal.
Como ajuste predeterminado se indica "11".
● Carácter XOFF
Introduzca un código para el carácter XOFF en el campo de entrada "Carácter XOFF".
Introduzca el código en formato hexadecimal.
Los valores de entrada posibles dependen de si se transfieren los datos con 7 u 8 bits de
datos:
– con 7 bits de datos: de 0 a 7FH
– con 8 bits de datos: de 0 a FFH
Como ajuste predeterminado se indica "13".
● Esperar a XON tras XOFF
Introduzca en el campo de entrada "Esperar a XON tras XOFF" el tiempo que debe esperar
el módulo durante la transmisión hasta recibir el carácter XON del interlocutor.
Se puede introducir un valor entre 20 y 65530 ms (dividido en intervalos de 10 ms).
Como ajuste predeterminado se indica "20000 ms".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

881

Configuración de dispositivos y redes
1.4 Crear configuraciones

Delimitador de fin PtP (ASCII)
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "ASCII" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "ASCII" hay 4 áreas PtP: transferencia, delimitador de fin, recepción de datos y
ocupación de las señales.
Este apartado se ocupa del delimitador de fin PtP y está dividido en 2 secciones.

Detección de un telegrama de recepción
Seleccione la opción deseada en la lista desplegable "Indicador de fin de un telegrama de
recepción". Existen tres opciones disponibles: "Transcurrido el tiempo de retardo de
caracteres", "Mediante delim. de fin" y "Tras recibir un número de caracteres fijo".
● Transcurrido el tiempo de retardo de caracteres
La elección "Transcurrido el tiempo de retardo de caracteres" en la lista desplegable
permite establecer el criterio de fin de un telegrama una vez transcurrido el tiempo de
retardo parametrizado. El tiempo de retardo de caracteres define entonces la distancia
máxima permitida entre 2 caracteres recibidos consecutivamente.
Esta opción está activada de forma estándar.
● Tiempo de retardo de caracteres
En el campo de entrada "Tiempo de retardo de caracteres" debe introducir el tiempo en
milisegundos y comprendido entre 1 y 65535.
El tiempo mínimo de retardo de caracteres que puede seleccionarse depende de la
velocidad de transferencia.
Velocidad de transferencia

Tiempo mínimo de retardo de caracteres

300 bits/s

130 ms

600 bits/s

65 ms

1200 bits/s

32 ms

2400 bits/s

16 ms

4800 bits/s

8 ms

9600 bits/s

4 ms

19200 bits/s

2 ms

38400 bits/s

1 ms

El ajuste predeterminado es "4 ms".

882

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Mediante delim. de fin
Con la elección "Mediante delim. de fin" en la lista desplegable se determina que el final de
un telegrama se detecte con el delimitador de fin.
● Tiempo de vigilancia si falta el indicador de fin
En el campo de entrada "Tiempo de vigilancia si falta el indicador de fin" hay un tiempo de
retardo de caracteres parametrizado que se utiliza en caso de que falte el indicador de fin.
Esto es válido en los ajustes siguientes del indicador de fin:
– Tras recibir un número fijo de caracteres
– Tras recibir el/los carácter(es) de fin
Aquí también podrá cambiar el tiempo de vigilancia. En este caso rigen las mismas
condiciones que en el tiempo de retardo de caracteres.
Deberá realizar manualmente los cálculos del emisor y la evaluación del carácter de
control de bloque del receptor.
Como ajuste predeterminado se indica "4 ms".
● Carácter de fin
Con el ajuste "Mediante delim. de fin" del parámetro "Indicador de fin de un telegrama de
recepción" se determina que el fin de un telegrama esté marcado con uno o dos
delimitadores de fin definidos. Se puede trabajar con uno o con dos caracteres de fin. Si lo
desea, también puede establecer la recepción adicional de uno o dos caracteres después
del carácter de fin. Puede utilizar estos caracteres, por ejemplo, para enviar también un
carácter de control de bloque (BCC).
Seleccione una de las siguientes opciones de la lista desplegable correspondiente:
– 1. Carácter
– 1. Carácter con 1 BCC
– 1. Carácter con 2 BCC
– 1. Y 2º carácter
– 1. Y 2º carácter con 1 BCC
– 1. Y 2º carácter con 2 BCC
Si se ha seleccionado esta opción, el ajuste predeterminado es "1er carácter".
● Carácter de fin receptor
Introduzca en el campo de entrada "1er carácter de fin receptor" y, si correspondiese, en el
campo de entrada "2º carácter de fin receptor" un código en cada campo para el indicador
de fin correspondiente.
Los valores de entrada posibles dependen de si se transfieren los datos con 7 u 8 bits de
datos:
– con 7 bits de datos: de 0 a 7FH
– con 8 bits de datos: de 0 a FFH
Los valores predeterminados son "3" para el primer carácter de fin y "0" para el segundo.
● Tras recibir un número fijo de caracteres
La selección "Tras recibir un número fijo de caracteres" de la lista desplegable permite
establecer el reconocimiento del final de un telegrama después de recibirse un número
determinado de caracteres. La longitud de los telegramas de recepción será, de este modo,
siempre la misma.
Esta opción está desactivada de forma estándar.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

883

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Pausa entre telegramas equivalente al tiempo de vigilancia
Si ha marcado la casilla de verificación "Pausa entre telegramas equivalente al tiempo de
vigilancia", entre el envío de dos telegramas se mantendrá una pausa de la duración del
tiempo de vigilancia (por si falta la señal de fin) para que el interlocutor detecte la recepción
del telegrama y pueda sincronizarse.
Esta casilla de verificación está desactivada de forma estándar.
● Longitud del telegrama
En el campo de entrada "Longitud del telegrama" puede ajustar el número de bytes del que
debe componerse el telegrama. Puede introducir un valor entre 1 y 1024 bytes.
El ajuste predeterminado es "200 bytes".

Enviar con señal de fin
Una vez definido el carácter de fin como señal de fin de un telegrama de recepción, podrá
enviar datos con señal de fin.
Como parámetro predeterminado se ha ajustado "Enviar hasta la señal de fin inclusive".
● Enviar hasta la señal de fin inclusive
En la lista desplegable "Criterio de fin > Enviar hasta delimitador de fin inclusive" se
establece la inclusión obligatoria del carácter de fin en los datos que se transmiten. Sólo se
enviarán los datos hasta el carácter de fin (éste inclusive), incluso en el caso de que en el
SFB conste una longitud mayor de datos.
● Enviar hasta la longitud parametrizada en el bloque
La lista desplegable "Criterio de fin > Enviar hasta la longitud parametrizada en el bloque"
permite establecer que se envíen los datos hasta la longitud parametrizada en el SFB. El
último carácter debe ser el carácter de fin.
● Enviar adjuntando automáticamente los caracteres de fin
La lista desplegable "Criterio de fin > Adjuntar automáticamente los caracteres de fin"
permite establecer que se envíen los datos hasta la longitud parametrizada en el SFB.
Además, se agregan automáticamente el o los delimitadores de fin, es decir, los
delimitadores de fin no pueden estar incluidos en los datos que se van a enviar. Según el
número de delimitadores de fin, se envían al interlocutor 1 ó 2 caracteres más de los
indicados por el SFB (máximo 1024 bytes).
● Carácter de fin emisor
Si utiliza un carácter de fin, ahora puede establecer un código HEX. (hexadecimal). Del
mismo modo podrá seleccionar si desea utilizar un segundo carácter de fin, pudiendo
establecer también el código HEX de este carácter. Introduzca en el campo de entrada "1er
carácter de fin emisor" y, si correspondiese, en el campo de entrada "2º carácter de fin
emisor" un código en cada campo para el indicador de fin correspondiente.
Los valores predeterminados son "3" para el primer carácter de fin y "0" para el segundo.

Recepción de datos PtP (ASCII)
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "ASCII" para el
protocolo.

884

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "ASCII" hay 4 áreas PtP: transferencia, delimitador de fin, recepción de datos y
ocupación de las señales.
Este apartado se ocupa de la recepción de datos PtP.

Respaldo de recepción en la CPU
● Borrar búfer de recepción de la CPU durante el arranque
Haga clic en la casilla de verificación "Borrar búfer de recepción de la CPU durante el
arranque". Así se borra el búfer de recepción de la función tecnológica al conectar la CPU
(POWER ON) o cuando ésta pase de STOP a RUN.
Esta casilla de verificación está desactivada de forma estándar.
● Impedir sobrescritura
Haga clic en la casilla de verificación "Impedir sobrescritura" para que no se sobrescriban
los datos del búfer de recepción cuando esté lleno.
Esta casilla de verificación está activada de forma estándar.
● Aprovechar todo el búfer
Haga clic en la casilla de verificación "Aprovechar todo el búfer" para aprovechar los 2048
bytes del búfer de recepción. Si se aprovecha todo el búfer, el número de telegramas de
recepción respaldados sólo depende de la longitud de los telegramas.
Esta casilla de verificación está activada de forma estándar.
● Número máx. de telegramas de recepción respaldados
En el campo de entrada "Número máx. de telegramas de recepción respaldados" puede
indicar la cantidad de telegramas de recepción respaldados por el búfer de recepción de la
función tecnológica. Para ello hay que desactivar la casilla de verificación "Aprovechar todo
el búfer". Puede indicar un valor entre 1 y 10.
El ajuste predeterminado es "10".
Nota
Si se parametriza aquí el valor "1", se desactiva el parámetro "Impedir sobrescritura" y se
leen los datos de recepción cíclicamente en el programa de usuario, se envía siempre un
telegrama actual a la CPU.

Ocupación de las señales PtP (ASCII)
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "ASCII" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "ASCII" hay 4 áreas PtP: transferencia, delimitador de fin, recepción de datos y
ocupación de las señales.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

885

Configuración de dispositivos y redes
1.4 Crear configuraciones
Este apartado se ocupa de la ocupación de las señales PtP y está dividido en 2 secciones.

Modo de operación
Seleccione uno de los tres modos de operación.
El ajuste predeterminado es "Dúplex (RS 422) modo a 4 hilos punto a punto".

Dúplex (RS 422) modo a 4 hilos punto a punto
Con el botón de opción "Dúplex (RS 422) modo a 4 hilos punto a punto" se selecciona el modo
de operación apropiado para acoplamientos punto a punto en modo a 4 hilos. Como ocupación
estándar de la línea de recepción dispone entonces de las siguientes variantes:
● Ninguno
● Señal R(A) 5 voltios, señal R(B) 0 voltios
● Señal R(A) 0 voltios, señal R(B) 5 voltios

Dúplex (RS 422) modo a 4 hilos maestro multipunto
Con el botón de opción "Dúplex (RS 422) modo a 4 hilos maestro multipunto" se selecciona el
modo de operación apropiado para acoplamiento multipunto (Multipoint) en modo a 4 hilos si
la CPU es un maestro. Como ocupación estándar de la línea de recepción existe la siguiente
variante:
● Señal R(A) 0 voltios, señal R(B) 5 voltios

Semidúplex (RS 485) modo a 2 hilos
Con el botón de opción "Semidúplex (RS 485) modo a 2 hilos" se selecciona el modo de
operación apropiado para acoplamiento punto a punto o multipunto (Multipoint) en modo a 2
hilos. La CPU puede ser maestro o esclavo. Como ocupación estándar de la línea de recepción
dispone entonces de las siguientes variantes:
● Ninguno
● Señal R(A) 0 voltios, señal R(B) 5 voltios

Ocupación estándar de la línea de recepción
● Ninguno
Si selecciona el botón de opción "Ninguno" habrá optado por una configuración exclusiva
para los driver especiales para comunicaciones en bus.
● Señal R(A) 5 voltios, señal R(B) 0 voltios
Con el botón de opción "Señal R(A) 5 voltios, señal R(B) 0 voltios" se selecciona un ajuste
que permite detectar una rotura de hilo. (No ajustable con dúplex (RS422) a 4 hilos maestro
multipunto ni con semidúplex (RS485) a 2 hilos)
● Señal R(A) 0 voltios, señal R(B) 5 voltios

886

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Con el botón de opción "Señal R(A) 0 voltios, señal R(B) 5 voltios" se selecciona un ajuste
que corresponde al estado de reposo (ningún emisor activo). Con esta opción no es posible
detectar una rotura de hilo.
● El ajuste predeterminado es Señal R(A) 5 voltios, señal R(B) 0 voltios.

Protocolo 3964(R)
Transferencia PtP (3964(R))
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "3964(R)" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "3964(R)" hay 3 áreas PtP: transferencia, recepción de datos y ocupación de las
señales.
Este apartado se ocupa de la transferencia PtP y está dividido en 3 secciones.

Velocidad de transferencia
En la lista desplegable "Velocidad de transferencia", seleccione la velocidad de transferencia
de datos en bits/s (baudios). Puede seleccionar un valor entre 300 y 38400 baudios.
El ajuste predeterminado es "9600 baudios".

Trama
Los datos se transmiten en una trama de caracteres a través de la interfaz serie. Para cada
trama se dispone de dos formatos de datos.
● Bits de datos
Seleccione en la lista desplegable "Bits de datos" la cantidad de bits que representarán un
carácter.
El ajuste predeterminado es "8 bit".
● Bits de parada
En la lista desplegable "Bits de parada", seleccione el número de bits que se pospondrán
a cada carácter a transmitir durante la transmisión. Los bits de parada marcan el final de un
carácter.
El ajuste predeterminado es "1 bit".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

887

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Paridad
En la lista desplegable "Paridad" puede seleccionar si elevar el grado de protección de la
transmisión mediante un bit de paridad. El parámetro de paridad "Sin" significa que no se
transmitirá ningún bit de paridad. Si se ha ajustado 7 bits de datos, no es posible seleccionar
la opción "Sin".
Una secuencia de bits de información puede ampliarse con un bit adicional, el bit de
paridad, que con su valor añadido ("0" ó "1") complemente el valor de todos los bits a un
estado predefinido (par o impar).
El ajuste predeterminado es "par".
● Prioridad
En la lista desplegable "Prioridad" se selecciona si la CPU debe tener una prioridad alta o
baja.
Un interlocutor tiene prioridad alta cuando su deseo de enviar tiene preferencia sobre el
deseo de enviar del otro interlocutor. Un interlocutor tiene prioridad baja cuando su deseo
de enviar tiene que esperar al deseo de enviar del otro interlocutor. En el procedimiento
3964(R) es necesario parametrizar ambos interlocutores con distinta prioridad, es decir,
uno de los interlocutores obtendrá mayor prioridad que el otro.
El ajuste predeterminado es "alta".

888

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Parámetros del telegrama
● Con control de bloque
Haga clic en la casilla de verificación "Con control de bloque" para determinar si los
telegramas deben enviarse con o sin comprobación de bloque.
– Sin control de bloque
Los parámetros de protocolo pueden parametrizarse libremente.
Si la CPU detecta la secuencia de caracteres DLE ETX, finaliza la recepción, enviando
a su interlocutor los caracteres DLE si ha recibido un bloque sin errores (o NAK en el
caso de recibirse un bloque erróneo).
– Con control de bloque
Los parámetros de protocolo tienen valores predeterminados.
Cuando la CPU detecta la secuencia de caracteres DLE ETX BCC, finaliza la recepción.
La CPU compara el carácter de control de bloque BCC recibido con la paridad de
longitud interna. Si el carácter de control de bloque es correcto y no se presenta ningún
otro error de recepción, la CPU envía el carácter DLE. (Si se detectase algún error, el
carácter enviado al interlocutor sería NAK).
La casilla de verificación "Con control de bloque" está activada de forma estándar.
● Utilizar valores predeterminados
Haga clic en la casilla de verificación "Utilizar valores predeterminados" si desea que los
parámetros de protocolo tengan valores predeterminados.
Si el módulo detecta la secuencia de caracteres DLE ETX, finaliza la recepción, enviando
a su interlocutor los caracteres DLE si ha recibido un bloque sin errores (o NAK en el caso
de recibirse un bloque erróneo).
Si no desea utilizar valores predeterminados, puede definir los siguientes parámetros de
forma individual.
La casilla de verificación "Utilizar valores predeterminados" está activada de forma
estándar.
● Tiempo de retardo de caracteres
El campo de entrada "Tiempo de retardo de caracteres" permite establecer el intervalo
máximo de tiempo entre dos caracteres recibidos en un mismo telegrama. Se puede
introducir un valor entre "20 ms" y "65530 ms" en incrementos de 10 ms.
El tiempo mínimo de retardo de caracteres que puede seleccionarse depende de la
velocidad de transferencia.
Velocidad de transferencia

Tiempo mínimo de retardo de caracteres

300 bits/s

60 ms

600 bits/s

40 ms

1200 bits/s

30 ms

2400 bits/s

20 ms

4800 bits/s

20 ms

9600 bits/s

20 ms

19200 bits/s

20 ms

38400 bits/s

20 ms

El ajuste predeterminado es "220 ms".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

889

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Tiempo de retardo de acuse
En el campo de entrada "Tiempo de retardo de acuse" se establece el tiempo máximo
permitido que puede transcurrir hasta el acuse del interlocutor al establecer una conexión
(tiempo transcurrido entre STX y el acuse DLE del interlocutor) o al desconectar (tiempo
entre DLE ETX y el acuse DLE del interlocutor). Se puede introducir un valor entre "20 ms"
y "65530 ms" en incrementos de 10 ms.
El tiempo mínimo de retardo de acuse que puede seleccionarse depende de la velocidad
de transferencia.
Velocidad de transferencia

Tiempo mínimo de retardo de acuse

300 bits/s

60 ms

600 bits/s

40 ms

1200 bits/s

30 ms

2400 bits/s

20 ms

4800 bits/s

20 ms

9600 bits/s

20 ms

19200 bits/s

20 ms

38400 bits/s

20 ms

El ajuste predeterminado es "2000 ms".

● Intentos de establecer conexión
En la lista "Intentos de establecer conexión" se establece el número máximo de intentos del
módulo de establecer una conexión. Puede seleccionar un valor entre "1" y "255".
El ajuste predeterminado es "6".
● Intentos de transmisión
En la lista "Intentos de transmisión" puede establecer el número máximo de intentos del
módulo de transmitir un telegrama (incluido el primer telegrama) en caso de producirse
algún error. Puede seleccionar un valor entre "1" y "255".
El ajuste predeterminado es "6".

Recepción de datos PtP (3964(R))
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "3964(R)" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "3964(R)" hay 3 áreas PtP: transferencia, recepción de datos y ocupación de las
señales.
Este apartado se ocupa de la recepción de datos PtP.

890

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Búfer de recepción en la CPU
● Borrar búfer de recepción de la CPU durante el arranque
Haga clic en la casilla de verificación "Borrar búfer de recepción de la CPU durante el
arranque". Así se borra el búfer de recepción de la CPU al conectarla (POWER ON) o
cuando ésta pase de STOP a RUN.
Esta casilla de verificación está desactivada de forma estándar.
● Impedir sobrescritura
Haga clic en la casilla de verificación "Impedir sobrescritura" para que no se sobrescriban
los datos del búfer de recepción cuando esté lleno.
Esta casilla de verificación está activada de forma estándar.
● Aprovechar todo el búfer
Haga clic en la casilla de verificación "Aprovechar todo el búfer" si desea aprovechar los
2048 bytes del búfer de recepción de la CPU. Si se aprovecha todo el búfer, el número de
telegramas de recepción respaldados sólo depende de la longitud de los telegramas.
Esta casilla de verificación está activada de forma estándar.
● Número máx. de telegramas de recepción respaldados
En el campo de entrada "Número máx. de telegramas de recepción respaldados" se indica
el número de telegramas de recepción respaldados por el búfer de recepción de la CPU.
Indique un valor entre 1 y 10.
El ajuste predeterminado es "10".
Nota
Si se parametriza aquí el valor "1", se desactiva el parámetro "Impedir sobrescritura" y se
leen los datos de recepción cíclicamente en el programa de usuario, se envía siempre un
telegrama actual a la CPU.

Ocupación de las señales PtP (3964(R))
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "3964(R)" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "3964(R)" hay 3 áreas PtP: transferencia, recepción de datos y ocupación de las
señales.
Este apartado se ocupa de la ocupación de las señales PtP.

Ocupación estándar de la línea de recepción
Para el protocolo 3964(R) se utiliza la interfaz X27 (RS 422/485) dúplex (RS 422) a 4 hilos. Éste
es el modo de operación más adecuado para el acoplamiento punto a punto en el
funcionamiento a 4 hilos.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

891

Configuración de dispositivos y redes
1.4 Crear configuraciones
Como ocupación estándar de la línea de recepción se dispone de las siguientes variantes:
● Ninguno
Si selecciona el botón de opción "Ninguno" habrá optado por una configuración exclusiva
para los driver especiales para comunicaciones en bus.
● Señal R(A) 5 V, señal R(B) 0 V (detección de rotura de hilo)
Con este botón de opción se selecciona un ajuste que permite la detección de rotura de hilo.
● Señal R(A) 0 V, señal R(B) 5 V
Con este botón de opción se selecciona un ajuste que corresponde al estado de reposo
(ningún emisor activo). Con este ajuste no es posible detectar una rotura de hilo.
El ajuste predeterminado es "Señal R(A) 5 V, señal R(B) 0 V (detección de rotura de hilo)".

Protocolo RK512
Transferencia PtP (RK512)
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "RK512" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "RK512" hay 2 áreas PtP: transferencia y ocupación de las señales.
Este apartado se ocupa de la transferencia PtP y está dividido en 3 secciones.

Velocidad de transferencia
En la lista desplegable "Velocidad de transferencia", seleccione la velocidad de transferencia
de datos en bits/s (baudios). Puede seleccionar un valor entre 300 y 38400 baudios.
El ajuste predeterminado es "9600 baudios".

Trama
Los datos se transmiten en una trama a través de la interfaz serie. Para cada trama se dispone
de dos formatos de datos.
● Bits de datos
La lista desplegable "Bits de datos" está sombreada, ya que en RK 512 siempre se mapean
los caracteres con 8 bits.
● Bits de parada
En la lista desplegable "Bits de parada", seleccione el número de bits que se pospondrán
a cada carácter a transmitir durante la transmisión. Los bits de parada marcan el final de un
carácter.
El ajuste predeterminado es "1 bit".

892

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Paridad
En la lista desplegable "Paridad" puede seleccionar si elevar el grado de protección de la
transmisión mediante un bit de paridad. El parámetro de paridad "Sin" significa que no se
transmitirá ningún bit de paridad. Existe la posibilidad de ampliar una secuencia de bits de
información añadiéndole otro bit, el bit de paridad, que completa el valor de todos los bits
con un valor añadido ("0" o "1"), dotándoles así del mismo estado (par o impar).
El ajuste predeterminado es "par".
● Prioridad
En la lista desplegable "Prioridad" se selecciona si la CPU debe tener una prioridad alta o
baja.
Un interlocutor tiene prioridad alta cuando su deseo de enviar tiene preferencia sobre el
deseo de enviar del otro interlocutor. Un interlocutor tiene prioridad baja cuando su deseo
de enviar tiene que esperar al deseo de enviar del otro interlocutor. En RK 512 es necesario
parametrizar ambos interlocutores con distinta prioridad, es decir, uno de los interlocutores
obtiene mayor prioridad que el otro.
El ajuste predeterminado es "alta".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

893

Configuración de dispositivos y redes
1.4 Crear configuraciones

Parámetros del telegrama
● Con control de bloque
Haga clic en la casilla de verificación "Con control de bloque" para determinar si los
telegramas deben enviarse con o sin comprobación de bloque.
– Sin control de bloque
Los parámetros de protocolo pueden parametrizarse libremente.
Si la CPU detecta la secuencia de caracteres DLE ETX, finaliza la recepción, enviando
a su interlocutor los caracteres DLE si ha recibido un bloque sin errores (o NAK en el
caso de recibirse un bloque erróneo).
– Con control de bloque
Los parámetros de protocolo tienen valores predeterminados.
Cuando la CPU detecta la secuencia de caracteres DLE ETX BCC, finaliza la recepción.
La CPU compara el carácter de control de bloque BCC recibido con la paridad de
longitud interna. Si el carácter de control de bloque es correcto y no se presenta ningún
otro error de recepción, la CPU envía el carácter DLE. (Si se detectase algún error, el
carácter enviado al interlocutor sería NAK).
La casilla de verificación "Con control de bloque" está activada de forma estándar.
● Utilizar valores predeterminados
Haga clic en la casilla de verificación "Utilizar valores predeterminados" si desea que los
parámetros de protocolo adopten valores predeterminados.
Si el módulo detecta la cadena de caracteres DLE ETX, finaliza la recepción, enviando a su
interlocutor los caracteres DLE si ha recibido un bloque sin errores (o NAK en el caso de
recibirse un bloque erróneo).
Si no desea utilizar valores predeterminados, puede definir los siguientes parámetros de
forma individual.
La casilla de verificación "Utilizar valores predeterminados" está activada de forma
estándar.
● Tiempo de retardo de caracteres
El campo de entrada "Tiempo de retardo de caracteres" permite establecer el intervalo
máximo de tiempo entre dos caracteres recibidos en un mismo telegrama. Se puede
introducir un valor entre "20 ms" y "65530 ms" en incrementos de 10 ms.
El tiempo mínimo de retardo de caracteres que puede seleccionarse depende de la
velocidad de transferencia.
Velocidad de transferencia

Tiempo mínimo de retardo de caracteres

300 bits/s

60 ms

600 bits/s

40 ms

1200 bits/s

30 ms

2400 bits/s

20 ms

4800 bits/s

20 ms

9600 bits/s

20 ms

19200 bits/s

20 ms

38400 bits/s

20 ms

El ajuste predeterminado es "220 ms".

894

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Tiempo de retardo de acuse
En el campo de entrada "Tiempo de retardo de acuse" se establece el tiempo máximo
permitido que puede transcurrir hasta el acuse del interlocutor al establecer una conexión
(tiempo transcurrido entre STX y el acuse DLE del interlocutor) o al desconectar (tiempo
entre DLE ETX y el acuse DLE del interlocutor). Se puede introducir un valor entre "20 ms"
y "65530 ms" en incrementos de 10 ms.
El tiempo mínimo de retardo de acuse que puede seleccionarse depende de la velocidad
de transferencia.
Velocidad de transferencia

Tiempo mínimo de retardo de acuse

300 bits/s

60 ms

600 bits/s

40 ms

1200 bits/s

30 ms

2400 bits/s

20 ms

4800 bits/s

20 ms

9600 bits/s

20 ms

19200 bits/s

20 ms

38400 bits/s

20 ms

Como ajuste predeterminado se indica "2000 ms".

● Intentos de establecer conexión
En la lista "Intentos de establecer conexión" se establece el número máximo de intentos del
módulo de establecer una conexión. Puede seleccionar un valor entre 1 y 255.
El ajuste predeterminado es "6".
● Intentos de transmisión
En la lista "Intentos de transmisión" puede establecer el número máximo de intentos del
módulo de transmitir un telegrama (incluido el primer telegrama). Puede seleccionar un
valor entre "1" y "255".
El ajuste predeterminado es "6".

Ocupación de las señales PtP (RK512)
Descripción
En "Propiedades > General > PtP > Selección de alarmas" se ajustan las alarmas, el
comportamiento en caso de STOP de la CPU y el protocolo. Seleccione "RK512" para el
protocolo.
Dependiendo del tipo de protocolo que se ha elegido cambia la subdivisión posterior en la
navegación local.
Si se elige "RK 512" hay 2 áreas PtP: transferencia y asignación de las señales.
Este apartado se ocupa de la transferencia PtP y está dividido en 3 secciones.

Ocupación estándar de la línea de recepción
La interfaz X27 (RS 422/485) se utiliza en modo dúplex (RS 422) a 4 hilos. Este es el modo de
operación más adecuado para el acoplamiento punto a punto en el funcionamiento a 4 hilos.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

895

Configuración de dispositivos y redes
1.4 Crear configuraciones
Como ocupación estándar de la línea de recepción se dispone de las siguientes variantes:
● Ninguna
Si selecciona el botón de opción "Ninguno" habrá optado por una configuración exclusiva
para los driver especiales para comunicaciones en bus.
● Señal R(A) 5 V, señal R(B) 0 V (detección de rotura de hilo)
Con este botón de opción se selecciona un ajuste que permite la detección de rotura de hilo.
● Señal R(A) 0 V, señal R(B) 5 V
Con este botón de opción se selecciona un ajuste que corresponde al estado de reposo
(ningún emisor activo). Con este ajuste no es posible detectar una rotura de hilo.
● El ajuste predeterminado es "Señal R(A) 5 V, señal R(B) 0 V (detección de rotura de hilo)".

896

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Información de la CPU
Registros de la CPU
Resumen


$FXPXODGRUHV

3DODEUDGHHVWDGRELWV VHXWLOL]DQELWV



$&8



















$&8

5%

$

$

29

26

25

67$

5/2

(5

$&8
$&8

HQ&38VFRQFXDWURDFXPXODGRUHV

5HJLVWURVGHGLUHFFLRQHV



3LODGHSDU«QWHVLVSDUD
SURFHVDU
H[SUHVLRQHVHQWUHSDU«QWHVLV

$5
$5

$GPLQLVWUDFLµQGHODSLOD

5%

25

5/2

).



5%

25

5/2

).



$GPLQLVWUDFLµQGHODSLOD

1LYHOGHODSLOD



3LOD0&5
5/2



5/2



5/2


1LYHOGHODSLOD









%LW0&5DFWLYR
0$

).

3XQWHURGH
SLODGHSDU«QWHVLV
./63

,GHQWLILFDFLµQGHODIXQFLµQ FµGLJRGH
RSHUDFLµQTXHYLVXDOL]DODRSHUDFLµQDFWXDO





3LOD0&5
063

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

897

Configuración de dispositivos y redes
1.4 Crear configuraciones

Acumuladores
Descripción
Los acumuladores de 32 bits son registros universales para procesar bytes, palabras y
palabras dobles. Para ello, los operandos se cargan en los acumuladores, donde se combinan.
El resultado de la operación permanece siempre en el ACU 1, desde donde se puede transferir
a una celda de memoria.
El mecanismo de pila para la gestión de los acumuladores funciona de la siguiente forma:
● Una operación de carga sólo actúa sobre el ACU 1 y guarda el contenido anterior en el ACU
2.
● Una operación de transferencia (operación de copiado) no modifica el contenido de los
acumuladores.
● La operación TAK intercambia el contenido del ACU 1 con el del ACU 2.
● El resultado de las combinaciones entre ACU 1 y ACU 2 (operaciones aritméticas, de
comparación, Y, O...) siempre se almacena en el ACU 1.

Definición de bytes y palabras en un registro de 32 bits (con el ejemplo del ACU 1)
$FXPXODGRU $&8

3DODEUDP£VVLJQLILFDWLYD %\WHP£VVLJQLILFDWLYD
3DODEUDPHQRVVLJQLILFDWLYD 3DODEUDPHQRVVLJQLILFDWLYD
%\WHP£VVLJQLILFDWLYR
%\WHPHQRVVLJQLILFDWLYR %\WHP£VVLJQLILFDWLYR
%\WHPHQRVVLJQLILFDWLYR


 
 
 
$&8++

$&8+/

$&8+
3DODEUDP£V
VLJQLILFDWLYD

$&8/+

$&8//

$&8/
3DODEUDPHQRV
VLJQLILFDWLYD

Direccionamiento
Memorias imagen de proceso (área de memoria de las entradas y salidas)
Área de memoria de las memorias imagen de proceso
La memoria imagen de proceso del OB 1 (MIP OB1) es actualizada cíclicamente por el sistema
operativo.
Esta imagen del proceso se almacena en el hardware de la periferia durante cada ciclo de la
lista de instrucciones. Por eso, los bits del área de memoria I de la memoria imagen del proceso
no varían durante los accesos a las instrucciones. Aunque los bits del área de memoria Q en
la memoria imagen del proceso pueden mostrar distintos estados durante el ciclo del
programa, al módulo de salida sólo se envía el último estado lógico.

898

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Consulte también: Datos útiles (Página 819) y Actualizar las memorias imagen de proceso
(Página 813)

Excepciones
En los siguientes casos no se accede a la periferia a través de la memoria imagen de proceso:
● Direccionamiento directo de las entradas y salidas en el área de memoria de la periferia (P)
● Utilización de funciones que procesan inmediatamente los datos de la periferia.

Ejemplo de un acceso normal a la periferia a través de la memoria imagen de proceso
029(
(
0:

(1 287
,1 (12

$:

$

Actualizar QW10 en el área de periferia de las salidas con el valor MW0.

Consulte también
Acceso a las direcciones de periferia (Página 822)

Acceso directo a la periferia (áreas de memoria PE y PA)
Acceso directo a la periferia
Si fuera necesario que el proyecto actualice los datos de la periferia más rápido de lo que la
memoria imagen de proceso se los ofrece, se puede acceder directamente a los módulos de
señales en el área de periferia de entradas y salidas (PI, PQ). El estado actual de los módulos
de entrada se puede consultar en el área de memoria PI. Los módulos de salida se pueden
ajustar escribiendo en el área de memoria PQ.
PRECAUCIÓN
En el área de periferia no se puede direccionar a bits (byte, bit) concretos. Para activar bits
concretos, hay que direccionar los bits, palabras o palabras dobles en operaciones lógicas.
Si se escribe un bit actualizado (dentro de un byte, palabra o palabra doble) en el área de
memoria PQ, se actualizarán todos los bits de la dirección de esa área de periferia.
En la entrada Memoria imagen de proceso se puede encontrar más información sobre la
relación entre el área de memoria de la periferia (área de memoria PI, PQ) y la memoria
imagen de proceso (áreas de memoria I y Q). Allí también se describe cómo la memoria
imagen de proceso memoriza (estabiliza) lo que se escribe y o envía desde los módulos de
señales.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

899

Configuración de dispositivos y redes
1.4 Crear configuraciones

Ejemplo de un acceso directo a la periferia a través del área de memoria de la periferia
029(
(
0:

(1 287
,1 (12

3$:

$

Actualizar PQW10 en el área de periferia de las salidas con el valor MW0.

Consulte también
Acceso a las direcciones de periferia (Página 822)
Áreas de direcciones (Página 822)

Sintaxis explícita para la entrada de constantes
Resumen
Forma abreviada

Forma ampliada

B#

BYTE#

W#

WORD#

DW#

DWORD#

D#

DATE#

T#

TIME#

TOD#

TIME_OF_DAY#

S5T#

S5TIME#

DT#

DATE_AND_TIME#

P#

POINTER#

Resumen de los identificadores de bit, byte, palabra y palabra doble
Resumen
Área de memoria de la CPU

900

Identificador de operando
Bit

Byte

Palabra

Palabra doble

Memoria imagen de proceso de
las entradas

I

IB

IW

ID

Memoria imagen de proceso de
las salidas

Q

QB

QW

QD

Marcas

M

MB

MW

MD

Datos locales

L

LB

LW

LD

Área directa de periferia de las
entradas

PIB

PIW

PID

Área directa de periferia de las
salidas

PQB

PQW

PQD

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Área de memoria de la CPU

Identificador de operando
Bit

Byte

Palabra

Palabra doble

Bloque de datos
[OPN] DB
[OPN] DI

DBX
DIX

DBB
DIB

DBW
DIW

DBD
DID

Temporizador (T)

T

T

Contador (C)

C

C

Nota
Los dos operandos IB0 e IB1 (área de memoria I, formato: byte, bytes de dirección 0, 1)
direccionan los dos mismos bytes que el operando IW0 (área de memoria I, formato: palabra,
2 bytes, incremento de byte 0 a bytes de dirección 0, 1).

Identificadores de elementos y bloques
Resumen
T

Temporizador

DB

Bloque de datos globales

DI

Bloque de datos de instancia

FC

Función

FB

Bloque de función

OB

Bloque de organización

Z/C

Contador (depende del nemónico).

SDB

Bloque de datos de sistema

SFC

Función de sistema

SFB

Bloque de función de sistema

Bloques de organización
Denominaciones inglesas de los tipos de OB
Denominación inglesa de los tipos de OB
Al crear un OB en el cuadro de diálogo "Agregar nuevo bloque", por motivos técnicos los tipos
de OB solo pueden indicarse en inglés, con independencia del idioma ajustado para la interfaz
de usuario. Para facilitar su manejo, en la tabla siguiente se muestran junto a los términos
ingleses las denominaciones en el idioma ajustado para la interfaz de usuario. La tabla se
aplica al conjunto de las CPU S7-300 y S7-400.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

901

Configuración de dispositivos y redes
1.4 Crear configuraciones

Denominación inglesa del tipo de OB en el cuadro de diálogo "Agregar nuevo bloque".

Denominación en el sistema
de información

Time interrupts

Alarmas de tiempo
Time of day

Alarmas horarias
TOD_INT0 [OB10] bis TOD_INT7
[OB17]

Time delay

OB de alarma horaria
Alarmas de retardo

DEL_INT0 [OB20] bis DEL_INT3 [OB23] OB de alarma de retardo
Cyclic

Alarmas cíclicas
CYC_INT0 [OB30] bis CYC_INT8
[OB38]

OB de alarma cíclica

HW_INT0 [OB40] bis HW_INT7 [OB47]

OB de alarma de proceso

Hardware Interrupts

Alarmas de proceso

Startup

Arranque
BACKGROUND [OB90]

OB de tarea no prioritaria

COMPLETE RESTART [OB100]

Rearranque (en caliente)

RESTART [OB101]

Rearranque normal

COLD RESTART [OB102]

Arranque en frío

DP: STATUS ALARM [OB55]

OB de alarma de estado

DP: UPDATE ALARM [OB56]

OB de alarma de actualiza‐
ción

DP: MANUFACTURE ALARM [OB57]

OB para alarmas específicas
del fabricante

MULTI_INT [OB 60]

OB de alarma de multiproce‐
samiento

Alarming

SYNC_1 [OB61] bis SYNC_4 [OB64]
Fault Interrupts

902

OB de alarma de sincronismo
Error

CYCL_FLT [OB 80]

OB de error de tiempo

PS_FLT [OB81]

OB de error de fuente de ali‐
mentación

I/O_FLT1 [OB82]

OB de alarma de diagnóstico

I/O_FLT2 [OB83]

OB de enchufe/desenchufe

CPU_FLT [OB84]

OB de fallo de hardware en
CPU

OBNL_FLT [OB85]

OB de error de ejecución del
programa

RACK_FLT [OB86]

OB de fallo del rack

COMM_FLT [OB87]

OB de errores de comunica‐
ción

BREAKUP ERROR [OB88]

OB de interrupción del proce‐
samiento

PROG_ERR [OB121]

OB de error de programación

MOD_ERR [OB122]

OB de error de acceso a la
periferia

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Sinopsis de los OB
Bloques de organización
Los bloques de organización constituyen la interfaz entre el sistema operativo de la CPU y el
programa de usuario. Los OB permiten ejecutar partes del programa de manera selectiva:
● Al arrancar la CPU
● En ejecución cíclica o con una cadencia determinada
● En caso de aparición de errores
● En caso de aparición de alarmas de proceso.
Los bloques de organización se procesan de acuerdo con la prioridad que tienen asignada.

OB disponibles
No todas las CPU pueden procesar todos los OB disponibles en S7. En la lista de operaciones
de la CPU se indica qué OB están disponibles.

Eventos de arranque y clase de prioridad predeterminada
La tabla siguiente contiene el evento de arranque y la clase de prioridad predeterminada para
cada OB.
OB

Evento de arranque

Clase de prioridad
predeterminada

Explicación

OB 1

Fin del arranque o fin del OB 1

1

Ciclo libre

OB 10

Alarma horaria 0

2

OB 11

Alarma horaria 1

2

OB 12

Alarma horaria 2

2

Sin indicación de
hora predetermina‐
da

OB 13

Alarma horaria 3

2

OB 14

Alarma horaria 4

2

OB 15

Alarma horaria 5

2

OB 16

Alarma horaria 6

2

OB 17

Alarma horaria 7

2

OB 20

Alarma de retardo 0

3

OB 21

Alarma de retardo 1

4

OB 22

Alarma de retardo 2

5

OB 23

Alarma de retardo 3

6

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Sin indicación de
hora predetermina‐
da

903

Configuración de dispositivos y redes
1.4 Crear configuraciones

904

OB

Evento de arranque

Clase de prioridad
predeterminada

OB 30

Alarma cíclica 0 (predeterminado: ciclo de 5 s) 7

OB 31

Alarma cíclica 1 (predeterminado: ciclo de 2 s) 8

OB 32

Alarma cíclica 2 (predeterminado: ciclo de 1 s) 9

OB 33

Alarma cíclica 3 (predeterminado: ciclo de 500
ms)

10

OB 34

Alarma cíclica 4 (predeterminado: ciclo de 200
ms)

11

OB 35

Alarma cíclica 5 (predeterminado: ciclo de 100
ms)

12

OB 36

Alarma cíclica 6 (predeterminado: ciclo de 50
ms)

13

OB 37

Alarma cíclica 7 (predeterminado: ciclo de 20
ms)

14

OB 38

Alarma cíclica 8 (predeterminado: ciclo de 10
ms)

15

OB 40

Alarma de proceso 0

16

OB 41

Alarma de proceso 1

17

OB 42

Alarma de proceso 2

18

OB 43

Alarma de proceso 3

19

OB 44

Alarma de proceso 4

20

OB 45

Alarma de proceso 5

21

OB 46

Alarma de proceso 6

22

OB 47

Alarma de proceso 7

23

OB 55

Alarma de estado

2

OB 56

Alarma de actualización

2

OB 57

Alarma de fabricante

2

OB 61

Alarma de sincronismo 1

25

OB 62

Alarma de sincronismo 2

25

OB 63

Alarma de sincronismo 3

25

OB 64

Alarma de sincronismo 4

25

Explicación
Alarmas cíclicas

Alarmas de proceso

Alarmas DPV1

Alarmas de sincro‐
nismo

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
OB

Evento de arranque

Clase de prioridad
predeterminada

Explicación

OB 80

Error de tiempo

26, 28 1

OB 81

Error de fuente de alimentación

26, 28 para
S7-300,

Alarmas de error
asíncronas

1

25, 28 1 para
S7-400
OB 82

Alarma de diagnóstico

26, 28 1 para
S7-300,
25, 28 1 para
S7-400

OB 83

Alarma de presencia de módulo

26, 28 1 para
S7-300,
25, 28 1 para
S7-400

OB 84

Error de hardware en CPU

26, 28 1 para
S7-300,
25, 28 1 para
S7-400

OB 85

Error de ejecución del programa

26, 28 1 para
S7-300,
25, 28 1 para
S7-400

OB 86

Fallo de un aparato de ampliación, de un siste‐ 26, 28 1 para
ma maestro DP o una estación en la periferia S7-300,
descentralizada
25, 28 1 para
S7-400

OB 87

Error de comunicación

26, 28 1 para
S7-300,
25, 28 1 para
S7-400

OB 88

Interrupción del procesamiento

OB 90

Rearranque completo (en caliente) o arranque 29 2)
en frío o borrado de un bloque en procesamien‐
to en el OB 90 o carga de un OB 90 en la CPU
o fin de OB 90

Ciclo en segundo
plano

OB 100

Rearranque completo (en caliente)

27 1

Arranque

OB 101

Rearranque

27

OB 102

Arranque en frío

27 1

OB 121

Error de programación

Prioridad del OB
que provoca erro‐
res

OB 122

Error de acceso a periferia

Prioridad del OB
que provoca erro‐
res

1

28

1

Alarmas de error
síncronas

Las clases de prioridad 27 y 28 son válidas en el modelo de clase de prioridad del arranque.

A la clase de prioridad 29 le corresponde la prioridad 0.29. En consecuencia, el ciclo en segundo plano
tiene una prioridad inferior a la del ciclo libre.
2

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

905

Configuración de dispositivos y redes
1.4 Crear configuraciones

Programa cíclico (OB 1)
Descripción
El sistema operativo de la CPU S7 procesa el OB 1 de modo cíclico: Una vez finalizado el
procesamiento del OB 1, el sistema operativo empieza nuevamente a procesar el OB 1. El
procesamiento cíclico del OB 1 se inicia una vez finalizado el arranque. En el OB 1 pueden
llamarse instrucciones.

Funcionamiento del OB 1
El OB 1 tiene la prioridad más baja de todos los OB con vigilancia en tiempo de ejecución. A
excepción del OB 90, todos los demás OB pueden interrumpir el procesamiento del OB 1. Los
siguientes eventos hacen que el sistema operativo llame el OB 1:
● Fin del procesamiento del arranque
● Fin del procesamiento del OB 1 (del ciclo anterior).
Una vez finalizado el procesamiento del OB 1, el sistema operativo envía datos globales. Antes
de rearrancar el OB 1, el sistema operativo escribe la memoria imagen de proceso de las
salidas en los módulos de salida, actualiza la memoria imagen de proceso de las entradas y
recibe datos globales para la CPU.
S7 ofrece una vigilancia del tiempo de ciclo máximo, lo que garantiza el tiempo de reacción
máximo. El tiempo de ciclo máximo predeterminado es de 150 ms; es posible reparametrizar
este valor, así como reiniciar la vigilancia de tiempo en cada punto del programa con la
instrucción "RE_TRIGR". Si el programa excede el tiempo de ciclo máximo para el OB 1, el
sistema operativo llama el OB 80 (OB de error de tiempo). Si el OB 80 no está programado, la
CPU pasa al estado operativo STOP.
Además de vigilar el tiempo de ciclo máximo, también se garantiza el mantenimiento de un
tiempo de ciclo mínimo. Para ello, el sistema operativo retarda el inicio de un ciclo nuevo
(escritura de la memoria imagen de proceso de las salidas en los módulos de salida) hasta que
se ha alcanzado el tiempo de ciclo mínimo.
La modificación de los parámetros de tiempo de ciclo máximo y mínimo se realiza mediante
configuración.

906

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Datos locales del OB 1
La tabla siguiente contiene las variables temporales (TEMP) del OB 1. Se han usado como
nombres de variable los nombres predeterminados del OB 1.
Variable

Tipo de datos

Descripción

OB1_EV_CLASS

BYTE

Clase de evento e identificadores:
B#16#11: El OB 1 está activo

OB1_SCAN_1

BYTE

● B#16#01: Finalización del rearranque completo (en
caliente)
● B#16#02: Finalización del rearranque
● B#16#03: Finalización del ciclo libre
● B#16#04: Finalización del arranque en frío
● B#16#05: Primer ciclo de OB 1 de la nueva CPU
maestra después de la conmutación de maestro a
reserva y STOP del maestro anterior

OB1_PRIORITY

BYTE

Clase de prioridad: 1

OB1_OB_NUMBR

BYTE

N.º de OB (01)

OB1_RESERVED_1

BYTE

Reservado

OB1_RESERVED_2

BYTE

Reservado

OB1_PREV_CYCLE

INT

Tiempo de ejecución del ciclo anterior (ms)

OB1_MIN_CYCLE

INT

Tiempo de ciclo mínimo (ms) desde el último arranque

OB1_MAX_CYCLE

INT

Tiempo de ciclo máximo (ms) desde el último arranque

OB1_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

OBs de alarma horaria (de OB 10 a OB 17)
Descripción
S7 ofrece hasta ocho OBs (del OB 10 al OB 17), que se ejecutan una sola vez o
periódicamente. Se puede parametrizar la CPU para que estos OBs se procesen en los
siguientes intervalos:
● Una sola vez
● Una vez por minuto
● Una vez por hora
● Una vez al día
● Una vez por semana
● Una vez al mes

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

907

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Una vez al año
● A final de mes
Nota
Si se procesa el OB de alarma horaria con periodicidad mensual, solo se admiten en la
fecha de arranque los días 1, 2, ... 28.

Funcionamiento de los OBs de alarma horaria
Para iniciar una alarma horaria, la alarma primero debe ajustarse y luego activarse. Existen
tres posibilidades de inicio:
● Inicio automático de la alarma horaria. Se lleva a cabo si tanto el ajuste como la activación
de la alarma horaria se han realizado mediante configuración. La tabla siguiente muestra
las posibilidades básicas para activar una alarma horaria mediante configuración.
● Ajustar la alarma horaria mediante configuración y activarla llamando a la instrucción
"ACT_TINT" desde el programa.
● Ajustar la alarma horaria llamando a la instrucción "SET_TINT" y activarla llamando a la
instrucción "ACT_TINT".
Intervalo

Descripción

No activado

El OB de alarma horaria no se procesa, ni siquiera cuando está cargado en la
CPU. Se puede activar la alarma horaria llamando la instrucción "ACT_TINT".

Activación única

El OB de alarma horaria se anula automáticamente después de ser procesa‐
do una vez del modo indicado.
Con la instrucción "SET_TINT", el programa puede ajustar de nuevo la alarma
horaria y volver a activarla con la instrucción "ACT_TINT".

Activación periódica

En el momento de la alarma horaria, la CPU determina, a partir de la hora
actual y del período fijado, el próximo momento de inicio de la alarma horaria.

Nota
Si se configura una alarma horaria para que el OB se procese una sola vez, la fecha y hora no
pueden encontrarse en el pasado (en relación con el reloj de tiempo real de la CPU).
Si se configura una alarma horaria para que el OB se procese periódicamente, y la fecha y hora
se encuentran en el pasado, el OB de alarma horaria se procesará en el próximo momento
adecuado según la hora actual. La figura siguiente muestra el primer procesamiento de un OB
de alarma horaria, en caso de que el momento de inicio se encuentre en el pasado y se haya
ajustado la activación periódica.
Se puede bloquear la llamada al OB de alarma horaria con la instrucción "DIS_IRT", volver a
habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT" y
"EN_AIRT".

908

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Hora de inicio
ajustada

Intervalo
ajustado

Hora
actual

Momento del primer procesamiento
del OB de alarma horaria

Condiciones desfavorables para los OBs de alarma horaria
Dado que las alarmas horarias solo se producen en determinados intervalos, algunas
circunstancias pueden entorpecer el funcionamiento de los correspondientes OBs durante la
ejecución del programa. La tabla siguiente muestra algunas de esas circunstancias y describe
sus efectos sobre el procesamiento del OB de alarma horaria.
Condición

Resultado

El programa llama la instrucción
El sistema operativo borra el evento de arranque (fecha y
"CAN_TINT" y anula una alarma horaria. hora) de la alarma horaria. Si desea que el OB vuelva a ser
llamado, reajuste y active de nuevo el evento de arranque.
El programa ha intentado activar un OB
de alarma horaria que en el momento
de la activación no estaba cargado en la
CPU.

El sistema operativo llama el OB 85. Si el OB 85 no está
programado (cargado en la CPU), la CPU pasa al estado
operativo STOP.

Al sincronizar o corregir el reloj del sis‐
tema de la CPU, se ha adelantado la
hora y se ha omitido el evento de arran‐
que, la fecha o la hora de un OB de alar‐
ma horaria.

El sistema operativo llama el OB 80 y codifica en el OB 80 el
número del OB de alarma horaria y la información de evento
de arranque.
Tras ello, el sistema operativo procesa el OB de alarma ho‐
raria una vez, independientemente del número de veces que
se hubiera fijado en principio para ese OB. La información de
evento de arranque del OB 80 muestra la fecha y la hora en
que se ha omitido por primera vez el OB de alarma horaria.

Al sincronizar o corregir el reloj del sis‐
tema de la CPU, se ha retrasado la hora
y se ha repetido el evento de arranque,
la fecha o la hora de un OB de alarma
horaria.

CPUs S7-400:
Si el OB de alarma horaria se activó antes de retrasar el reloj,
no se volverá a llamar en las horas que ya hayan pasado.

La CPU ejecuta un nuevo rearranque
completo (en caliente) o un arranque en
frío.

Cada OB de alarma horaria que se ha configurado mediante
una instrucción vuelve a adoptar la configuración establecida
inicialmente.

CPUs S7-300: Se ejecuta el OB de alarma horaria.

Si se ha configurado una alarma horaria para activación úni‐
ca del OB correspondiente y se ha ajustado y activado me‐
diante configuración, el sistema operativo llamará el OB una
sola vez después de un rearranque completo (en caliente) o
un arranque en frío, siempre que el momento de inicio con‐
figurado se encuentre en el pasado (en relación con el reloj
en tiempo real de la CPU).
Un OB de alarma horaria sigue proce‐
sándose aunque ya se ha producido el
evento de arranque correspondiente al
siguiente intervalo.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

El sistema operativo llama el OB 80. Si el OB 80 no está
programado, la CPU pasa al estado operativo STOP.
De lo contrario, después de procesarse el OB 80 y el OB de
alarma horaria, se reactiva el procesamiento de OB solicita‐
do.

909

Configuración de dispositivos y redes
1.4 Crear configuraciones

Datos locales de los OBs de alarma horaria
La tabla siguiente contiene las variables temporales (TEMP) de un OB de alarma horaria. Se
han escogido como nombres de variable los nombres predeterminados del OB 10.
Variable

Tipo de datos

Descripción

OB10_EV_CLASS

BYTE

Clase de evento e identificadores:
B#16#11: La alarma está activa

OB10_STRT_INFO

BYTE

B#16#11: Solicitud de inicio para el OB 10
(B#16#12: Solicitud de inicio para el OB 11)
:
:
(B#16#18: Solicitud de inicio para el OB 17)

OB10_PRIORITY

BYTE

Clase de prioridad parametrizada; valor predetermina‐
do: 2

OB10_OB_NUMBR

BYTE

N.º de OB (de 10 a 17)

OB10_RESERVED_1

BYTE

Reservado

OB10_RESERVED_2

BYTE

Reservado

OB10_PERIOD_EXE

WORD

El OB se procesa con el intervalo indicado:
W#16#0000: Una sola vez
W#16#0201: Una vez por minuto
W#16#0401: Una vez por hora
W#16#1001: Una vez al día
W#16#1201: Una vez por semana
W#16#1401: Una vez al mes
W#16#1801: Una vez al año
W#16#2001: A final de mes

OB10_RESERVED_3

INT

Reservado

OB10_RESERVED_4

INT

Reservado

OB10_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se
solicitó el OB

OBs de alarma de retardo (de OB 20 a OB 23)
Descripción
S7 ofrece hasta cuatro OB (del OB 20 al OB 23) que se ejecutan una vez transcurrido un
retardo parametrizable. Todos los OB de alarma de retardo se ejecutan mediante llamada de
la instrucción "SRT_DINT". El retardo es un parámetro de entrada de la instrucción.
Si el programa llama la instrucción "SRT_DINT", debe indicarse el número de OB, el retardo y
un identificador específico de usuario. El OB en cuestión se ejecuta una vez transcurrido el
retardo especificado. También es posible anular el procesamiento de una alarma de retardo
que todavía no se ha iniciado.

910

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Funcionamiento de los OB de alarma de retardo
Una vez transcurrido el tiempo que se ha transmitido en ms a la instrucción "SRT_DINT" junto
con un número de OB, el sistema operativo ejecuta el OB correspondiente.
Si se desean utilizar OB de alarma de retardo, deben realizarse las siguientes tareas:
● Llamar la instrucción "SRT_DINT".
● Cargar el OB de alarma de retardo en la CPU como parte del programa de usuario.
Los OB de alarma de retardo solo se procesan si la CPU está en el estado operativo RUN. El
rearranque completo (en caliente) y el arranque en frío borran todos los eventos de arranque
de los OB de alarma de retardo. Las alarmas de retardo todavía no activadas pueden anularse
con la instrucción "CAN_DINT".
El retardo se mide con una precisión de 1 ms. Un tiempo de retardo puede reiniciarse
inmediatamente una vez transcurrido. La instrucción "QRY_DINT" permite conocer el estado
de una alarma de retardo.
El sistema operativo llama un OB para errores asíncronos en caso de que se produzca uno de
los siguientes eventos:
● El sistema operativo intenta ejecutar un OB que no está cargado y cuyo número se ha
indicado al llamar la instrucción "SRT_DINT".
● Se produce el siguiente evento de arranque para una alarma de retardo antes de que haya
finalizado el procesamiento del correspondiente OB de alarma de retardo.
Se puede bloquear la llamada del OB de alarma de retardo con la instrucción "DIS_IRT", volver
a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT" y
"EN_AIRT".

Datos locales de los OB de alarma de retardo
La tabla siguiente contiene las variables temporales (TEMP) de un OB de alarma de retardo.
Se han escogido como nombres de variable los nombres predeterminados del OB 20.
Variable

Tipo de datos

Declaración Descripción

OB20_EV_CLASS

BYTE

TEMP

Clase de evento e identificadores:
B#16#11: La alarma está activa

OB20_STRT_INF

BYTE

TEMP

● B#16#21: Solicitud de inicio para el
OB 20
● (B#16#22: Solicitud de inicio para el
OB 21)
● (B#16#23: Solicitud de inicio para el
OB 22)
● (B#16#24: Solicitud de inicio para el
OB 23)

OB20_PRIORITY

BYTE

TEMP

Clase de prioridad parametrizada: De 3
(OB 20) a 6 (OB 23) (valores predeter‐
minados)
Valor predeterminado para CPU
S7-1500: 3

OB20_OB_NUMBR

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

BYTE

TEMP

N.º de OB (de 20 a 23)

911

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Declaración Descripción

OB20_RESERVED_1

BYTE

TEMP

Reservado

OB20_RESERVED_2

BYTE

TEMP

Reservado

OB20_SIGN

WORD

TEMP

Identificador de usuario: Parámetro de
entrada SIGN de la llamada de la ins‐
trucción "SRT_DINT"

OB20_DTIME

TIME

TEMP

Retardo parametrizado en ms

OB20_DATE_TIME

DATE_AND_TIME

TEMP

Fecha y hora en las que se solicitó el
OB

OBs de alarma cíclica (de OB 30 a OB 38)
Descripción
S7 ofrece hasta nueve OB de alarma cíclica (de OB 30 a OB 38). Éstos permiten ejecutar
programas a intervalos equidistantes. La tabla siguiente muestra los valores predefinidos para
el período y las clases de prioridad de los OB de alarma cíclica.
OB de alarma cíclica

Valor predeterminado del pe‐
ríodo

Valor predeterminado de la clase de prio‐
ridad

OB 30

5s

7

OB 31

2s

8

OB 32

1s

9

OB 33

500 ms

10

OB 34

200 ms

11

OB 35

100 ms

12

OB 36

50 ms

13

OB 37

20 ms

14

OB 38

10 ms

15

Funcionamiento de los OB de alarma cíclica
Los puntos de inicio equidistantes de los OB de alarma cíclica se obtienen en cada caso a partir
del ciclo de tiempo y el desfase correspondientes.
Nota
Debe procurarse que el tiempo de ejecución de todos los OB de alarma cíclica sea siempre
claramente inferior a su ciclo de tiempo. Si un OB de alarma cíclica todavía no ha finalizado,
pero, debido al tiempo transcurrido, el sistema operativo debe procesarlo nuevamente, se
ejecuta el OB de error de tiempo (OB 80). A continuación se reactiva la alarma cíclica que haya
causado el error.
Se puede bloquear la llamada del OB de alarma cíclica con la instrucción "DIS_IRT", volver a
habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT" y
"EN_AIRT".

912

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Los rangos de valores correspondientes a los parámetros de ciclo de tiempo, clase de prioridad
y desfase pueden consultarse en los datos técnicos de la CPU. Las modificaciones de
parámetros se realizan mediante configuración.

Datos locales de los OB de alarma cíclica
La tabla siguiente contiene las variables temporales (TEMP) de un OB de alarma cíclica.
Variable

Tipo de datos

OB3x_EV_CLASS

BYTE

Descripción
Clase de evento e identificadores:
B#16#11: La alarma está activa

OB3x_STRT_INF

BYTE

● B#16#30: Solicitud especial de arranque para un
OB de alarma cíclica en el sistema H (tratamiento
especial parametrizado el cambiar al estado del
sistema "Redundante")
● B#16#31: Solicitud de inicio para el OB 30
…
● B#16#36: Solicitud de inicio para el OB 35
…
● B#16#39: Solicitud de inicio para el OB 38
● B#16#3A: Solicitud de arranque para OB de
alarma cíclica (de OB 30 a OB 38) con ciclo de
alarma cíclica inferior a un milisegundo

OB3x_PRIORITY

BYTE

Clase de prioridad parametrizada; valores predeter‐
minados: De 7 (OB 30) a 15 (OB 38)
Valores predeterminados para CPU S7-1500: 8 a 14;
16 a 17

OB3x_OB_NUMBR

BYTE

N.º de OB (de 30 a 38)

OB3x_RESERVED_1

BYTE

Reservado

OB3x_RESERVED_2

BYTE

Reservado

OB3x_PHS_OFFSET

INT

para OB 30 a 34 y 36 a 38:
● si OB3x_STRT_INF=B#16#3A: Desfase en μs
● En todos los demás casos: Desfase en ms

OB35_PHASE_OFFSET

WORD

para OB 35:
● si OB35_STRT_INF=B#16#3A: Desfase en μs
● En todos los demás casos: Desfase en ms

OB3x_RESERVED_3

INT

Reservado

OB3x_EXC_FREQ

INT

● si OB3x_STRT_INF=B#16#3A: Ciclo de tiempo
en μs

OB3x_DATE_TIME

DA‐
TE_AND_TI‐
ME

Fecha y hora en las que se solicitó el OB.

● En todos los demás casos: Ciclo de tiempo en ms

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

913

Configuración de dispositivos y redes
1.4 Crear configuraciones

OBs de alarma de proceso (de OB 40 a OB 47)
Descripción
S7 ofrece hasta ocho alarmas de proceso independientes entre sí con un OB para cada una.
Por cada configuración se debe establecer, para cada módulo de señal que deba disparar
alarmas de proceso,
● qué canales deben disparar una alarma de proceso, así como las circunstancias en que
deben hacerlo.
● qué OB de alarma de proceso se asigna a cada uno de los grupos de canales (de modo
predeterminado, todas las alarmas de proceso son procesadas por el OB 40).
En los CP y FM debe utilizarse a estos efectos el software correspondiente para el módulo.
Las clases de prioridad para cada uno de los OB de alarma de proceso se definen mediante
configuración.

Funcionamiento de los OB de alarma de proceso
Una vez disparada una alarma de proceso por el módulo, el sistema operativo identifica el slot
y determina el OB de alarma de proceso correspondiente. Si el OB tiene una prioridad superior
a la clase de prioridad actual, se procesará. La confirmación específica de canal se realiza una
vez finalizado este OB de alarma de proceso.
Si en el intervalo entre la identificación y la confirmación de una alarma de proceso se produce
nuevamente en el mismo módulo un evento que deba disparar una alarma de proceso, se
aplica la siguiente regla:
● Si el evento se produce en el canal que ha disparado anteriormente la alarma de proceso,
la alarma en cuestión se pierde. La figura siguiente muestra la relación entre una señal de
proceso y el procesamiento del correspondiente OB de alarma de proceso, tomando como
ejemplo un canal de un módulo de entrada digital. Supongamos que el evento
desencadenante es el flanco ascendente. Se utiliza a modo de ejemplo el OB de alarma de
proceso OB 40.
Alarma de proceso no reconocida
Señal de
proceso

OB 40

Procesamiento del OB 40

● Si el evento se produce en otro canal del mismo módulo, no puede dispararse por el
momento ninguna alarma de proceso. Sin embargo, la alarma no se pierde, sino que se
dispara una vez confirmada la alarma de proceso que se encuentre activa.
Al dispararse una alarma de proceso cuyo OB está actualmente activo debido a una alarma de
proceso de otro módulo, la nueva solicitud se registra y el OB se ejecutará en su momento.
Se puede bloquear la llamada del OB de alarma de proceso con la instrucción "DIS_IRT",
volver a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT"
y "EN_AIRT".

914

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Las alarmas de proceso de un módulo pueden parametrizarse con las instrucciones
"WR_PARM", " WR_DPARM" y "PARM_MOD".

Datos locales de los OB de alarma de proceso
La tabla siguiente contiene las variables temporales (TEMP) de un OB de alarma de proceso.
Se han escogido como nombres de variable los nombres predeterminados del OB 40.
Variable

Tipo de datos

Descripción

OB40_EV_CLASS

BYTE

Clase de evento e identificadores:
B#16#11: alarma activa

OB40_STRT_INF

BYTE

● B#16#41: alarma a través de línea de interrupción 1
● B#16#42: alarma a través de línea de interrupción 2
(solo en S7-400)
● B#16#43: alarma a través de línea de interrupción 3
(solo en S7-400)
● B#16#44: alarma a través de línea de interrupción 4
(solo en S7-400)
● B#16#45: WinAC: Alarma disparada desde el PC
Nota: En modo multiprocesamiento, las líneas de inte‐
rrupción 1, ... 4 están asignadas a las CPU 1, ... 4.

OB40_PRIORITY

BYTE

Clase de prioridad parametrizada: valores predetermi‐
nados:
De 16 (OB 40) a 23 (OB 47)
Valor predeterminado para CPU S7-1500: 16

OB40_OB_NUMBR

BYTE

N.º de OB (de 40 a 47)

OB40_RESERVED_1

BYTE

Reservado

OB40_IO_FLAG

BYTE

● B#16#54: módulo de entrada
● B#16#55: módulo de salida
● B#16#00: no disponible

OB40_MDL_ADDR

WORD

Dirección base lógica del módulo que ha disparado la
alarma

OB40_POINT_ADDR

DWORD

● Con módulos digitales:
Mapa de bits con las entradas del módulo que han
disparado la alarma de proceso
La asignación de un determinado bit
OB40_POINT_ADDR a un determinado canal del
módulo se puede consultar en la descripción del
módulo correspondiente.
● Con módulos analógicos: mapa de bits que indica
qué canal ha rebasado un determinado límite (la
estructura exacta puede consultarse en la
descripción del módulo).
● En CP o IM:
Estado de alarma del módulo (no relevante para el
usuario)

OB40_DATE_TIME

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

915

Configuración de dispositivos y redes
1.4 Crear configuraciones

Nota
Si se utiliza una CPU compatible con DPV1, puede usarse la instrucción "RALRM" para
obtener información acerca de la alarma, más allá de la información de arranque del OB. Esto
también se aplica cuando el maestro DP se opera en el modo compatible con S7.

OB de alarma de estado (OB 55)
Descripción
El sistema operativo de la CPU llama al OB 55 cuando se dispara una alarma de estado desde
un slot de un esclavo DPV1 o un dispositivo IO. Esto puede suceder cuando un componente
(módulo) de un esclavo DPV1 o dispositivo IO cambia de estado operativo, p. ej. de RUN a
STOP. Los eventos concretos que originan una alarma de estado pueden consultarse en la
documentación del fabricante del esclavo DPV1 o dispositivo IO.
Nota
Si las CPU S7-400 o los CPs PROFIBUS S7-400 están ajustados en el modo DP como
"Compatible con S7", no se puede utilizar ningún OB de alarma de estado (OB 55).

Datos locales del OB de alarma de estado
La tabla siguiente contiene las variables temporales (TEMP) del OB de alarma de estado. Se
han escogido como nombres de variable los nombres predeterminados del OB 55.
Variable

Tipo de datos

Descripción

OB55_EV_CLASS

BYTE

Clase de evento e identificadores:

OB55_STRT_INF

BYTE

B#16#11 (evento entrante)
● B#16#55: alarma de estado con DP
● B#16#58: alarma de estado con PROFINET IO
OB55_PRIORITY

BYTE

Clase de prioridad parametrizada, valor predetermina‐
do: 2 o 4 (en CPU S7-1500)

OB55_OB_NUMBR

BYTE

N.º de OB (55)

OB55_RESERVED_1

BYTE

Reservado

OB55_IO_FLAG

BYTE

Módulo de entrada: B#16#54

OB55_MDL_ADDR

WORD

Dirección base lógica del componente (módulo) que ha
disparado la alarma

OB55_LEN

BYTE

Longitud del bloque lógico que emite la alarma

OB55_TYPE

BYTE

Identificador de tipo de alarma "Alarma de estado"

OB55_SLOT

BYTE

Número de slot del componente (módulo) que ha dispa‐
rado la alarma

Módulo de salida: B#16#55

916

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB55_SPEC

BYTE

Specifier:
● Bits 0 a 1: Alarm-Specifier
● Bit 2: Add_Ack
● Bits 3 a 7: n.º de sec.

OB55_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Nota
El significado, indicado en la tabla anterior, de OB55_LEN, OB55_TYPE, OB55_SLOT y
OB55_SPEC solo es válido para alarmas de estado en DP. Si existe una alarma de estado en
PROFINET IO, deben organizarse las variables locales como se indica en la tabla siguiente.

Nota
La información adicional completa de alarma procedente del telegrama puede consultarse
llamando a la instrucción "RALRM" dentro del OB 55.
Si se desea programar el OB 55 en función de los eventos de arranque, se recomienda
organizar las variables locales de la siguiente manera:
Variable

Tipo de datos

OB55_EV_CLASS

BYTE

OB55_STRT_INF

BYTE

OB55_PRIORITY

BYTE

OB55_OB_NUMBR

BYTE

OB55_RESERVED_1

BYTE

OB55_IO_FLAG

BYTE

OB55_MDL_ADR

WORD

OB55_Z2

WORD

OB55_Z3

WORD

OB55_DATE_TIME

DATE_AND_TIME

Dependiendo del evento de arranque, las variables OB55_Z2 y OB55_Z3 contienen distinta
información. Esto se aclara a continuación.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

917

Configuración de dispositivos y redes
1.4 Crear configuraciones

Significado de OB55_Z2
OB55_STRT_INF

Significado de OB55_Z2

B#16#55

● low byte: Identificador de tipo de alarma "Alarma de estado"
● high byte: Longitud del bloque lógico que emite la alarma

B#16#58

Identificador del tipo de alarma:
● W#16#0005: alarma de estado

Significado de OB55_Z3
OB55_STRT_INF

Significado de OB55_Z3

B#16#55

● low byte: Specifier
–

Bits 0 a 1: Alarm Specifier

–

Bit 2: Add_Ack

–

Bits 3 a 7: Número de secuencia

● high byte: Slot del componente (módulo) que ha disparado la alarma
B#16#58

Alarm Specifier
● Bits 0 a 10: número de secuencia (rango de valores de 0 a 2047)
● Bits 11 a 15: 0

OB de alarma de actualización (OB 56)
Descripción
El sistema operativo de la CPU llama el OB 56 cuando se ha disparado una alarma de
actualización desde un slot de un esclavo DPV1 o un dispositivo IO. Esto puede suceder
cuando se han modificado parámetros en un slot de un esclavo DPV1 o dispositivo IO
(mediante acceso local o remoto). Los eventos concretos que originan una alarma de
actualización pueden consultarse en la documentación del fabricante del esclavo DPV1 o
dispositivo IO.
Nota
Si las CPU S7-400 o los CPs PROFIBUS S7-400 están ajustados en el modo DP como
"Compatible con S7", no se puede utilizar ningún OB de alarma de actualización (OB 56).

918

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Datos locales del OB de alarma de actualización
La tabla siguiente contiene las variables temporales (TEMP) del OB de alarma de
actualización. Se han escogido como nombres de variable los nombres predeterminados del
OB 56.
Variable

Tipo de datos

Descripción

OB56_EV_CLASS

BYTE

Clase de evento e identificadores:
B#16#11 (evento entrante)

OB56_STRT_INF

BYTE

● B#16#56: alarma de actualización con DP
● B#16#59: alarma de actualización con PROFINET
IO

OB56_PRIORITY

BYTE

Clase de prioridad parametrizada, valor predetermina‐
do: 2 o 4 (en CPU S7-1500)

OB56_OB_NUMBR

BYTE

N.º de OB (56)

OB56_RESERVED_1

BYTE

Reservado

OB56_IO_FLAG

BYTE

Módulo de entrada: B#16#54
Módulo de salida: B#16#55

OB56_MDL_ADDR

WORD

Dirección base lógica del componente (módulo) que ha
disparado la alarma

OB56_LEN

BYTE

Longitud del bloque lógico que suministra la alarma

OB56_TYPE

BYTE

Identificador del tipo de alarma "Alarma de actualiza‐
ción"

OB56_SLOT

BYTE

Número de slot del componente (módulo) que ha dispa‐
rado la alarma

OB56_SPEC

BYTE

Specifier:
● Bits 0 a 1: Alarm-Specifier
● Bit 2: Add_Ack
● Bits 3 a 7: n.º de sec.

OB56_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Nota
El significado, indicado en la tabla anterior, de OB56_LEN, OB56_TYPE, OB56_SLOT y
OB56_SPEC solo es válido para alarmas de actualización en DP. Si existe una alarma de
actualización en PROFINET IO, deben organizarse las variables locales como se indica en la
tabla siguiente.

Nota
La información adicional completa de alarma procedente del telegrama puede consultarse
llamando la instrucción "RALRM" dentro del OB 56.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

919

Configuración de dispositivos y redes
1.4 Crear configuraciones
Si se desea programar el OB 56 en función de los eventos de arranque, se recomienda
organizar las variables locales de la siguiente manera:
Variable

Tipo de datos

OB56_EV_CLASS

BYTE

OB56_STRT_INF

BYTE

OB56_PRIORITY

BYTE

OB56_OB_NUMBR

BYTE

OB56_RESERVED_1

BYTE

OB56_IO_FLAG

BYTE

OB56_MDL_ADR

WORD

OB56_Z2

WORD

OB56_Z3

WORD

OB56_DATE_TIME

DATE_AND_TIME

Dependiendo del evento de arranque, las variables OB56_Z2 y OB56_Z3 contienen distinta
información. Esto se aclara a continuación.

Significado de OB56_Z2
OB56_STRT_INF

Significado de OB56_Z2

B#16#56

● low byte: identificador del tipo de alarma "Alarma de actualización"
● high byte: longitud del bloque lógico que suministra la alarma

B#16#59

Identificador del tipo de alarma
● W#16#0006: alarma de actualización
● W#16#001E: Upload-and-Retrieval-Alarm
Siemens Industry Online Support pone a su disposición un bloque de
función IPARSERV en forma de ejemplo de aplicación, que le permitirá
guardar en un DB datos de parámetrización adicionales si así lo solicita
un dispositivo PROFINET o uno de sus módulos y restaurar estos datos
en caso de mantenimiento o reparación. Un dispositivo PROFINET envía
una alarma Upload-and-Retrieval-Alarm al controlador IO y utiliza para
ello el OB de alarma de actualización.
https://support.industry.siemens.com/cs/ww/es/view/45841087 (https://
support.industry.siemens.com/cs/ww/es/view/45841087)

920

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Significado de OB56_Z3
OB56_STRT_INF

Significado de OB56_Z3

B#16#56

● low byte: Specifier
–

Bits 0 a 1: Alarm Specifier

–

Bit 2: Add_Ack

–

Bits 3 a 7: número de secuencia

● high byte: slot del componente (módulo) que ha disparado la alarma
B#16#59

Alarm Specifier:
● Bits 0 a 10: número de secuencia (rango de valores de 0 a 2047)
● Bits 11 a 15: 0

OB de alarmas específicas del fabricante (OB 57)
Descripción
El sistema operativo de la CPU llama al OB 57 cuando se dispara una alarma de fabricante
desde un slot de un esclavo DPV1 o un dispositivo IO.
Nota
Si las CPUs S7-400 o los CPs PROFIBUS S7-400 están ajustados en el modo DP como
"Compatible con S7", no se puede utilizar ningún OB de alarma específica del fabricante (OB
57).

Datos locales del OB de alarmas específicas del fabricante
La tabla siguiente contiene las variables temporales (TEMP) del OB de alarmas específicas del
fabricante. Se han escogido como nombres de variable los nombres predeterminados del OB
57.
Variable

Tipo de datos

Descripción

OB57_EV_CLASS

BYTE

Clase de evento e identificadores:

OB57_STRT_INF

BYTE

B#16#11 (evento entrante)
● B#16#57: alarma de fabricante con DP
● B#16#5A: alarma de fabricante con PROFINET IO
● B#16#5B: IO: Profile Specific Alarm
BYTE

Clase de prioridad parametrizada, valor predetermina‐
do: 2 o 4 (en CPU S7-1500)

OB57_OB_NUMBR

BYTE

N.º de OB (57)

OB57_RESERVED_1

BYTE

Reservado

OB57_IO_FLAG

BYTE

Módulo de entrada: B#16#54

OB57_MDL_ADDR

WORD

OB57_PRIORITY

Módulo de salida: B#16#55

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Dirección base lógica del componente (módulo) que ha
disparado la alarma

921

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB57_LEN

BYTE

Longitud del bloque lógico que emite la alarma

OB57_TYPE

BYTE

Identificador de tipo de alarma "Alarma específica del
fabricante"

OB57_SLOT

BYTE

Número de slot del componente (módulo) que ha dispa‐
rado la alarma

OB57_SPEC

BYTE

Specifier:
● Bits 0 a 1: Alarm-Specifier
● Bit 2: Add_Ack
● Bits 3 a 7: n.º de sec.

OB57_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Nota
El significado, indicado en la tabla anterior, de OB57_LEN, OB57_TYPE, OB57_SLOT y
OB57_SPEC solo es válido para alarmas específicas del fabricante en DP. Si existe una
alarma específica del fabricante en PROFINET IO, deben organizarse las variables locales
como se indica en la tabla siguiente.

Nota
La información adicional completa de alarma procedente del telegrama puede consultarse
llamando la instrucción "RALRM" dentro del OB 57.
Si se desea programar el OB 57 en función de los eventos de arranque, se recomienda
organizar las variables locales de la siguiente manera:
Variable

Tipo de datos

OB57_EV_CLASS

BYTE

OB57_STRT_INF

BYTE

OB57_PRIORITY

BYTE

OB57_OB_NUMBR

BYTE

OB57_RESERVED_1

BYTE

OB57_IO_FLAG

BYTE

OB57_MDL_ADR

WORD

OB57_Z2

WORD

OB57_Z3

WORD

OB57_DATE_TIME

DATE_AND_TIME

Dependiendo del evento de arranque, las variables OB57_Z2 y OB57_Z3 contienen distinta
información. Esto se aclara a continuación.

922

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Significado de OB57_Z2
OB57_STRT_INF

Significado de OB57_Z2

B#16#57

● low byte: Identificador del tipo de alarma "Alarma de fabricante"
● high byte: Longitud del bloque lógico que emite la alarma

B#16#5A

Identificador del tipo de alarma:
● W#16#0020 a 007F: Alarma de fabricante

Significado de OB57_Z3
OB57_STRT_INF

Significado de OB57_Z3

B#16#57

● low byte: Specifier
–

Bits 0 a 1: Alarm Specifier

–

Bit 2: Add_Ack

–

Bits 3 a 7: Número de secuencia

● high byte: Slot del componente (módulo) que ha disparado la alarma
B#16#5A

Alarm Specifier
● Bits 0 a 10: número de secuencia (rango de valores de 0 a 2047)
● Bits 11 a 15: 0

OBs de alarma de sincronismo (de OB 61 a OB 64)
Descripción
Las alarmas de sincronismo permiten ejecutar programas de modo isócrono con respecto al
ciclo DP o al tiempo de ciclo de emisión de PN. A la alarma de sincronismo TSAL y le
corresponde el OB 6y, 1 <= y <= 4, como OB de interfaz. La prioridad de los OBs 61 a 64 puede
ajustarse entre 0 (OB desactivado) y de 2 a 26.
PRECAUCIÓN
Accesos directos
Al acceder directamente con comandos L o T (p. ej. L PIB, T PQB), o si se utilizan las
instrucciones "DPRD_DAT" o "DPWR_DAT", no debe accederse a áreas de la periferia que
tengan asignadas memorias imagen parcial de proceso vinculadas a OB6x (alarmas de
sincronismo).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

923

Configuración de dispositivos y redes
1.4 Crear configuraciones

Datos locales del OB de alarma de sincronismo
La tabla siguiente contiene las variables temporales (TEMP) del OB de alarma de sincronismo.
Se han escogido como nombres de variable los nombres predeterminados del OB 61.
Variable

Tipo de datos

Descripción

OB61_EV_CLASS

BYTE

Clase de evento e identificadores:
B#16#11: La alarma está activa

OB61_STRT_INF

BYTE

B#16#64: Solicitud de arranque para el OB 61
:
B#16#67: Solicitud de arranque para el OB 64

OB61_PRIORITY

BYTE

Clase de prioridad parametrizada; valor predetermi‐
nado: 25 o 21 (en CPU S7-1500)

OB61_OB_NUMBR

BYTE

N.º de OB: 61 ... 64

OB61_RESERVED_1

BYTE

Reservado

OB61_RESERVED_2

BYTE

Reservado

OB61_GC_VIOL

BOOL

Violación de GC en PROFIBUS DP

OB61_FIRST

BOOL

Primera ejecución después de arranque o estado de
parada

OB61_MISSED_EXEC

BYTE

Número de arranques fallidos del OB 61 desde la úl‐
tima ejecución del OB 61

OB61_DP_ID

BYTE

ID de sistema maestro DP del sistema maestro DP
isócrono (de 1 a 32) o ID de sistema PROFINET IO
del sistema PNIO isócrono (de 100 a 115)

OB61_RESERVED_3

BYTE

Reservado

OB61_RESERVED_4

WORD

Reservado

OB61_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

OB de error de tiempo (OB 80)
Descripción
El sistema operativo de la CPU llama el OB 80 en caso de que durante el procesamiento se
produzca uno de los siguientes errores:
● Rebase por exceso del tiempo de ciclo
● Error de acuse al procesar un OB
● Adelanto de la hora (salto de hora) al arrancar un OB
Si por ejemplo se produce un evento de arranque para un OB de alarma cíclica antes de que
finalice el procesamiento anterior de ese mismo OB, el sistema operativo llama el OB 80.
Si el OB 80 no está programado, la CPU pasa al estado operativo STOP.

924

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Se puede bloquear la llamada del OB de error de tiempo con la instrucción "DIS_IRT", volver
a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT" y
"EN_AIRT".
Nota
Si se llama al OB 80 dos veces en el mismo ciclo debido al rebase por exceso del tiempo de
ciclo, la CPU pasa al estado STOP. Esto puede evitarse llamando la instrucción "RE_TRIGR"
en el punto adecuado.

Nota sobre el uso de "Report System Errors"
"Report System Errors" retarda el procesamiento de alarmas que aparecen en tiempo de
ejecución.
Si se cumple la condición Tiempo de ejecución de "Report System Errors" > 50 % del tiempo
de ciclo, se refuerza el efecto (se considera que el tiempo de ejecución de "Report System
Errors" es la suma de todos los tiempos de ejecución de "Report System Errors" dentro del
tiempo de ciclo.). Puede conllevar la llamada del OB de error de tiempo o el cambio de la CPU
a STOP (si no está cargado el OB de error de tiempo).
Para evitarlo existen las posibilidades siguientes:
● Si se utilizan los OBs de alarma de sincronismo (OB61 a OB64), hay que cerciorarse de que
son llamados con menos frecuencia que antes dentro de cada unidad de tiempo. Puede
lograrse incrementando en cada OB de alarma de sincronismo el parámetro "Factor de
ciclo de aplicación" correspondiente.
● Incremente la relación (tiempo de ciclo - tiempo de ejecución de "Report System Errors")/
(tiempo de ejecución de "Report System Errors"). Para ello, existen las dos posibilidades
siguientes:
– Si en los OBs de alarma cíclica (OB30 a OB38) se llama "Report System Errors", se
aumentan los tiempos de ciclo de los OBs correspondientes.
– Incremente en el OB1 el tiempo de ejecución de la sección de programa independiente
de "Report System Errors". Hágalo, p. ej. utilizando la instrucción "WAIT".

Datos locales del OB de error de tiempo
La tabla siguiente contiene las variables temporales (TEMP) del OB de error de tiempo. Se han
escogido como nombres de variable los nombres predeterminados del OB 80.
Variable

Tipo de datos

Descripción

OB80_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#35

OB80_FLT_ID

BYTE

Código de error (valores posibles: B#16#01,
B#16#02, B#16#05, B#16#06, B#16#07,
B#16#08, B#16#09, B#16#0A, B#16#0B)

OB80_PRIORITY

BYTE

Clase de prioridad: El OB 80 se ejecuta en RUN
en la clase de prioridad 26, y en caso de desbor‐
damiento del búfer de solicitud de OB, en la clase
de prioridad 28
En las CPU S7-1500: Prioridad 22

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

925

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB80_OB_NUMBR

BYTE

N.º de OB (80)

OB80_RESERVED_1

BYTE

Reservado

OB80_RESERVED_2

BYTE

Reservado

OB80_ERROR_INFO

WORD

Información de error: En función del código de
error

OB80_ERR_EV_CLASS

BYTE

Clase a la que pertenece el evento que ha pro‐
vocado el error

OB80_ERR_EV_NUM

BYTE

Número del evento que ha provocado el error

OB80_OB_PRIORITY

BYTE

Información de error: En función del código de
error

OB80_OB_NUM

BYTE

Información de error: En función del código de
error

OB80_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Significado de las variables dependientes del código de error:
Código de error

Variable

Bit

B#16#01

Significado
Rebase por exceso del tiempo de ciclo

OB80_ERROR_INFO

Tiempo de ejecución del último ciclo (ms)

OB80_ERR_EV_CLASS

Clase a la que pertenece el evento que ha provocado la
alarma

OB80_ERR_EV_NUM

Número del evento que ha provocado la alarma

OB80_OB_PRIORITY

Clase de prioridad del OB que se estaba procesando cuan‐
do se produjo el error

OB80_OB_NUM

Número del OB que se estaba procesando cuando se pro‐
dujo el error

B#16#02

El OB solicitado todavía está procesándose.
OB80_ERROR_INFO

La correspondiente variable temporal del OB solicitado. Este
se determina mediante OB80_ERR_EV_CLASS y
OB80_ERR_EV_NUM.

OB80_ERR_EV_CLASS

Clase a la que pertenece el evento que ha provocado la
alarma

OB80_ERR_EV_NUM

Número del evento que ha provocado la alarma

OB80_OB_PRIORITY

Clase de prioridad del OB que provoca errores (p. ej.: "7"
para el OB 30/clase de prioridad 7, que se debía ejecutar
pero no se ha podido ejecutar)

OB80_OB_NUM

Número del OB que provoca errores (p. ej.: "30" para el
OB 30, que se debía ejecutar pero no se ha podido ejecutar)

B#16#05

Alarma horaria expirada debido a salto de hora
OB80_ERROR_INFO

Bit 0 activado

El momento de inicio de la alarma 0 se encuentra en el pa‐
sado

...
Bit 7 activado
Bit 8 a 15
OB80_ERR_EV_CLASS

926

El momento de inicio de la alarma 7 se encuentra en el pa‐
sado
Sin utilizar
Sin utilizar

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Código de error

Variable

Bit

Significado

OB80_ERR_EV_NUM

Sin utilizar

OB80_OB_PRIORITY

Sin utilizar

OB80_OB_NUM

Sin utilizar

B#16#06

Como con el código de
error B#16#05

Alarma horaria expirada al reanudar en RUN después de
PARADA

B#16#07

Como con el código de
error B#16#02

Desbordamiento del búfer de solicitud de OB para la clase
de prioridad actual (cada solicitud de inicio de OB para una
clase de prioridad se registra en el correspondiente búfer de
solicitud de OB; una vez finalizado el OB, la entrada se bo‐
rra. Si para una determinada clase de prioridad existe un
número de solicitudes de OB superior al máximo posible de
entradas del correspondiente búfer de solicitud de OB, se
llama el OB 80 con el código de error B#16#07.)

B#16#08

Como con el código de
error B#16#02

Error de tiempo en alarma de sincronismo

B#16#09

Como con el código de
error B#16#02

Pérdida de alarma por sobrecarga de alarmas

B#16#0A

Reanudación en RUN después de CiR
OB80_ERROR_INFO

B#16#0B

Tiempo de sincronización CiR en ms
Error de tiempo en alarma de sincronismo tecnológica

OB80_ERR_EV_NUM

Número del evento que ha provocado la alarma:
W#16#116A

OB80_OB_PRIORITY

Clase de prioridad del OB que se estaba procesando cuan‐
do se produjo el error

OB80_OB_NUM

Número del OB que se estaba procesando cuando se pro‐
dujo el error: 65

B#16#0C

(solo en CPU S7-1500 R/H) Tiempo de ciclo rebasado por
segunda vez
OB80_ERROR_INFO

Tiempo de ejecución del último ciclo (ms)

OB80_ERR_EV_CLASS

Clase a la que pertenece el evento que ha provocado la
alarma

OB80_ERR_EV_NUM

Número del evento que ha provocado la alarma

OB80_OB_PRIORITY

Clase de prioridad del OB que se estaba procesando cuan‐
do se produjo el error

OB80_OB_NUM

Número del OB que se estaba procesando cuando se pro‐
dujo el error

OB de error de fuente de alimentación (OB 81)
Descripción
El sistema operativo de la CPU llama el OB 81 cuando se produce un evento provocado por un
error en la fuente de alimentación (solo para S7-400) en el respaldo (tanto con eventos
entrantes como salientes).
En S7-400, se llama el OB 81 en caso de error de batería solo cuando está activada la
comprobación de batería con la salida BATT.INDIC.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

927

Configuración de dispositivos y redes
1.4 Crear configuraciones
Si el OB 81 no está programado, la CPU no cambia al estado operativo STOP.
Se puede bloquear la llamada del OB de error de fuente de alimentación con la instrucción
"DIS_IRT", volver a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones
"DIS_AIRT" y "EN_AIRT".

Datos locales del OB de error de fuente de alimentación
La tabla siguiente contiene las variables temporales (TEMP) del OB de error de fuente de
alimentación. Se han escogido como nombres de variable los nombres predeterminados del
OB 81.
Variable

Tipo de datos

Descripción

OB81_EV_CLASS

BYTE

Clase de evento e identificadores:
● B#16#38: Evento saliente
● B#16#39: Evento entrante

OB81_FLT_ID

BYTE

Código de error (valores posibles: B#16#21, B#16#22,
B#16#23, B#16#25, B#16#26, B#16#27, B#16#31,
B#16#32, B#16#33)

OB81_PRIORITY

BYTE

Clase de prioridad: Ajustable mediante configuración
P. ej., para el estado operativo RUN pueden ajustarse
los valores del 2 al 26.

OB81_OB_NUMBR

BYTE

N.º de OB (81)

OB81_RESERVED_1

BYTE

Reservado

OB81_RESERVED_2

BYTE

Reservado

OB81_RACK_CPU

WORD

● Del bit 0 al bit 7: B#16#00
● Del bit 8 al bit 15:
–

Con una CPU estándar: B#16#00

–

Con una CPU H: Del bit 8 al bit 10: N.º de rack, bit
11: 0=CPU de reserva, 1=CPU maestra, bits del
12 al 15: 1111

OB81_RESERVED_3

BYTE

Relevante solo para los códigos de error B#16#31,
B#16#32 y B#16#33

OB81_RESERVED_4

BYTE

Relevante solo para los códigos de error B#16#31,
B#16#32 y B#16#33

OB81_RESERVED_5

BYTE

Relevante solo para los códigos de error B#16#31,
B#16#32 y B#16#33

OB81_RESERVED_6

BYTE

Relevante solo para los códigos de error B#16#31,
B#16#32 y B#16#33

OB81_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Las variables OB81_RESERVED_i, 3 ≤ i ≤ 6, contienen los aparatos de ampliación en los que
el respaldo de batería (con código de error B#16#31), la tensión de respaldo (con código de
error B#16#32) o la alimentación de 24 V (con código de error B#16#33) han fallado o se han

928

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
recuperado. La tabla siguiente muestra qué bit de las variables OB81_RESERVED_i, 3 ≤ i ≤ 6,
pertenece a cada aparato de ampliación.
OB81_RESER‐
VED_6

OB81_RESER‐
VED_5

OB81_RESER‐
VED_4

OB81_RESERVED_3

Bit 0

Reservado

8. Ap. de ampl.

16. Ap. de ampl.

Reservado

Bit 1

1. Ap. de ampl.

9. Ap. de ampl.

17. Ap. de ampl.

Reservado.

Bit 2

2. Ap. de ampl.

10. Ap. de ampl.

18. Ap. de ampl.

Reservado

Bit 3

3. Ap. de ampl.

11. Ap. de ampl.

19. Ap. de ampl.

Reservado

Bit 4

4. Ap. de ampl.

12. Ap. de ampl.

20. Ap. de ampl.

Reservado

Bit 5

5. Ap. de ampl.

13. Ap. de ampl.

21. Ap. de ampl.

Reservado

Bit 6

6. Ap. de ampl.

14. Ap. de ampl.

Reservado

Reservado

Bit 7

7. Ap. de ampl.

15. Ap. de ampl.

Reservado

Reservado

Significado de los bits de las variables OB81_RESERVED_i (para el aparato de ampliación
implicado):
En el evento entrante se marcan los aparatos de ampliación (están activados los bits
correspondientes) para los que ha fallado por lo menos una batería, la tensión de respaldo o
la alimentación de 24 V. No se muestran los aparatos de ampliación para los que ya ha fallado
antes por lo menos una batería, la tensión de respaldo o la alimentación de 24 V. En el evento
saliente se comunica la recuperación del respaldo en por lo menos un aparato de ampliación
(están activados los bits correspondientes).
La tabla siguiente muestra cuál es el evento que ha provocado el arranque del OB 81.
OB81_EV_CLASS

OB81_FLT_ID

Significado

B#16#39/B#16#38

B#16#21

Hay como mínimo una pila tampón vacía en el aparato
central/eliminado (BATTF).
Nota: El evento entrante se produce únicamente en caso
de fallo de una de las dos baterías (si se usan pilas tampón
redundantes). Si posteriormente falla también la otra ba‐
tería, el evento no vuelve a producirse.

B#16#39/B#16#38

B#16#22

Falta la tensión de respaldo en el aparato central/elimina‐
do (BAF).

B#16#39/B#16#38

B#16#23

Fallo de la alimentación de 24 V en el aparato central/
eliminado.

B#16#39/B#16#38

B#16#25

Hay como mínimo una pila tampón vacía en por lo menos
un aparato central redundante/eliminado (BATTF).

B#16#39/B#16#38

B#16#26

Falta la tensión de respaldo en por lo menos un aparato
central redundante/eliminado (BAF).

B#16#39/B#16#38

B#16#27

Fallo de la alimentación de 24 V en por lo menos un apa‐
rato central redundante/eliminado

B#16#39/B#16#38

B#16#31

Hay como mínimo una pila tampón vacía en por lo menos
un aparato de ampliación/eliminado (BATTF).

B#16#39/B#16#38

B#16#32

Falta la tensión de respaldo en por lo menos un aparato de
ampliación/eliminado (BAF).

B#16#39/B#16#38

B#16#33

Fallo de la alimentación de 24 V en al menos un aparato de
ampliación/ eliminado.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

929

Configuración de dispositivos y redes
1.4 Crear configuraciones

Programa de ejemplo para el OB 81
Usando un programa de ejemplo en AWL, se muestra la manera de leer el código de error en
el OB 81.
El programa tiene la siguiente estructura:
El código de error en el OB 81 (OB81_FLT_ID) se lee y se compara con la identificación de los
eventos "Hay como mínimo una pila tampón vacía en el aparato central" (B#16#21) y "Falta la
tensión de respaldo en el aparato central" (B#16#22).
Si el código de error concuerda con uno de los eventos mencionados, el programa salta a la
marca BF. De lo contrario se finaliza el bloque.
A partir de la etiqueta BF, el programa activa la variable Error de batería cuando existe un
evento entrante. Cuando existe un evento saliente, el programa desactiva la variable.

L

B#16#21

//Identificador del evento "Hay como mínimo una pila tampón vacía en el aparato central"

L

#OB81_FLT_ID

//Código de error OB 81

==I
SPB
L

//Si es igual,
BF

//saltar a BF

B#16#22

//Identificador del evento "Falta la tensión de
respaldo en el aparato central"

==I
SPB

//Si es igual que el código de error OB 81,
BF

//saltar a BF

BEA
BF:
L

//no hay mensaje sobre error de batería
L

B#16#39

#OB81_EV_CLASS

==I

//Identificador de evento entrante
//Clase de evento e identificadores al llamar el
OB 81
//Si es igual,

S

Error de batería

//entonces activar error de batería (variable de
la tabla de variables)

L

B#16#38

//Identificador de evento saliente

==I
R

//Si es igual que clase de evento e identificadores al llamar el OB 81,
Error de batería

//entonces desactivar error de batería (variable
de la tabla de variables)

OB de alarma de diagnóstico (OB 82)
Descripción
Cuando un módulo diagnosticable en el que se ha habilitado la alarma de diagnóstico detecta
una modificación de su estado de diagnóstico, envía a la CPU una solicitud de alarma de
diagnóstico:
● Hay un fallo, un componente requiere mantenimiento, o ambas cosas (evento entrante).
● Ya no hay ningún fallo, y ningún componente requiere mantenimiento (evento saliente).

930

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Tras ello, el sistema operativo llama el OB 82.
El OB 82 contiene en sus variables locales la dirección base lógica, así como una información
de diagnóstico de cuatro bytes de longitud acerca del módulo defectuoso (ver tabla siguiente).
Si no se ha programado el OB 82, la CPU pasa al estado operativo STOP.
Se puede bloquear la llamada del OB de alarma de diagnóstico con la instrucción "DIS_IRT",
volver a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT"
y "EN_AIRT".
Nota
Con controladores PROFINET IO, es posible especificar en la configuración si las alarmas de
comunicación deben provocar o no la llamada del OB de alarma de diagnóstico. Estas alarmas
son eventos de diagnóstico de la interfaz PROFINET.
La opción predeterminada es que estos eventos no provoquen la llamada del OB 82.

Datos locales del OB de alarma de diagnóstico
La tabla siguiente contiene las variables temporales (TEMP) del OB de alarma de diagnóstico.
Se han escogido como nombres de variable los nombres predeterminados del OB 82.
Variable

Tipo de datos

Descripción

OB82_EV_CLASS

BYTE

Clase de evento e identificadores:
● B#16#38: evento saliente: módulo sin errores (todos los
errores solucionados).
● B#16#39: evento entrante: el módulo tendrá errores o
permanece con errores (con cambio del número de errores
pendientes)

OB82_FLT_ID

BYTE

Código de error (B#16#42)

OB82_PRIORITY

BYTE

● Clase de prioridad; ajustable mediante configuración

OB82_OB_NUMBR

BYTE

N.º de OB (82)

OB82_RESERVED_1

BYTE

Reservado

OB82_IO_FLAG

BYTE

● En el S7-300/S7-400:

● En las CPU S7-1500: prioridad, valor predeterminado: 5

–

Módulo de entrada: B#16#54

–

Módulo de salida: B#16#55

● En el S7-1500: Cero
OB82_MDL_ADDR

WORD

● En el S7-300/S7-400: Dirección base lógica del módulo en el
que se ha producido el error
● En el S7-1500: identificador de hardware del objeto de
hardware que ha disparado la alarma de diagnóstico

OB82_MDL_DEFECT

BOOL

Fallo de módulo

OB82_INT_FAULT

BOOL

Error interno

OB82_EXT_FAULT

BOOL

Error externo

OB82_PNT_INFO

BOOL

Existe error de canal

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

931

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB82_EXT_VOLTAGE

BOOL

Falta tensión auxiliar externa

OB82_FLD_CONNCTR

BOOL

Falta conector frontal

OB82_NO_CONFIG

BOOL

Módulo no parametrizado

OB82_CONFIG_ERR

BOOL

Parámetro erróneo en módulo

OB82_MDL_TYPE

BYTE

● Bits 0 a 3: Clase de módulo
● Bit 4: Existe información de canal
● Bit 5: Existe información de usuario
● Bit 6: Alarma de diagnóstico de sustituto
● Bit 7: Mantenimiento necesario

OB82_SUB_MDL_ERR

BOOL

Módulo de usuario erróneo o no existe

OB82_COMM_FAULT

BOOL

Fallo de comunicación

OB82_MDL_STOP

BOOL

Estado operativo
(0: RUN, 1: STOP)

OB82_WTCH_DOG_FLT

BOOL

La vigilancia de tiempo ha reaccionado

OB82_INT_PS_FLT

BOOL

Fallo de la tensión de alimentación interna del módulo

OB82_PRIM_BATT_FLT

BOOL

Batería vacía

OB82_BCKUP_BATT_FLT

BOOL

Fallo de todo el respaldo

OB82_RESERVED_2

BOOL

Mantenimiento solicitado

OB82_RACK_FLT

BOOL

Fallo de aparato de ampliación

OB82_PROC_FLT

BOOL

Fallo de procesador

OB82_EPROM_FLT

BOOL

Error de EPROM

OB82_RAM_FLT

BOOL

Error de RAM

OB82_ADU_FLT

BOOL

Error de ADU/DAU

OB82_FUSE_FLT

BOOL

Fallo de fusible

OB82_HW_INTR_FLT

BOOL

Alarma de proceso perdida

OB82_RESERVED_3

BOOL

Reservado

OB82_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Nota
Si se utiliza una CPU compatible con DPV1, puede usarse la instrucción "RALRM" para
obtener información acerca de la alarma, más allá de la información de arranque del OB. Esto
también se aplica cuando el maestro DP se opera en el modo compatible con S7.

Programación del OB 82
El OB 82 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 82 y cárguelo en la CPU como parte del programa de usuario.

932

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
El OB 82 puede usarse por ejemplo de la siguiente manera:
● Se evalúa la información de arranque del OB 82.
● Se realiza un diagnóstico preciso del error producido.
Cuando se dispara una alarma de diagnóstico, el módulo erróneo registra automáticamente 4
bytes de datos de diagnóstico y su dirección inicial en la información de arranque del OB de
alarma de diagnóstico y en el búfer de diagnóstico. De este modo puede conocerse en qué
módulo y en qué momento se ha producido un error.
Con un programa al efecto pueden evaluarse en el OB 82 otros datos de diagnóstico del
módulo erróneo (en qué canal se ha producido el error o de qué error se trata). Con la
instrucción "RDSYSST" pueden leerse datos de diagnóstico de módulo y registrar esa
información en el búfer de diagnóstico con la instrucción "WR_USMSG". Además es posible
enviar un mensaje de diagnóstico personalizado a un dispositivo de observación
convenientemente registrado.

OB de cambio de módulo (OB 83)
Descripción
El sistema operativo de la CPU llama el OB 83 tras extraer o introducir un módulo configurado.
Si no se ha programado el OB 83, la CPU pasa al estado operativo STOP.
Se puede bloquear la llamada del OB de cambio de módulo con la instrucción "DIS_IRT",
volver a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT"
y "EN_AIRT".

Extracción e inserción de módulos
Toda extracción e inserción de un módulo configurado (no permitido: fuentes de alimentación,
CPUs, cápsulas de adaptación e IM) en los estados operativos RUN, STOP y ARRANQUE
provoca una alarma de cambio de módulo. A su vez, esta alarma genera en la correspondiente
CPU una entrada en el búfer de diagnóstico y en la lista de estado del sistema. Además de
esto, en el estado operativo RUN se inicia el OB de cambio de módulo. Si no se ha programado
este OB, la CPU pasa al estado operativo STOP.
El cambio de los módulos S7-400 se comprueba dentro del sistema una vez por segundo. Para
que la CPU detecte el cambio, debe haber un intervalo mínimo de dos segundos entre la
extracción y la inserción del módulo S7-400. Para otros módulos, este tiempo mínimo es
mayor.
Al extraer un módulo configurado en el estado operativo RUN, se arranca el OB 83. Antes de
ello puede detectarse un error de acceso en un acceso directo o en la actualización de la
memoria imagen de proceso.
Al insertarse un módulo en un slot configurado en el estado RUN, el sistema operativo
comprueba si el tipo del módulo enchufado concuerda con el definido en la configuración. A
continuación se arranca el OB 83, y si los tipos de módulo coinciden, se realiza la
parametrización.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

933

Configuración de dispositivos y redes
1.4 Crear configuraciones

Particularidades con S7-300, ET 200S y ET 200Pro
● En S7-300 no se permite la extracción e inserción de la periferia centralizada.
● En las CPUs S7-300, la alarma de cambio de módulo solo existe para las CPUs 31x PN/DP
y, concretamente, solo para los componentes PROFINET IO.
● En ET 200Pro con p. ej. CPU IM 154-4-8, la alarma de cambio de módulo solo existe para
la periferia centralizada.
● En ET 200S con p. ej. CPU IM151-8 PN/DP, la alarma de cambio de módulo solo existe para
la periferia centralizada.

Datos locales del OB de cambio de módulo
La tabla siguiente contiene las variables temporales (TEMP) del OB de cambio de módulo. Se
han escogido como nombres de variable los nombres predeterminados del OB 83.
Variable

Tipo de datos

Descripción

OB83_EV_CLASS

BYTE

Clase de evento e identificadores:
● B#16#32: Fin de reparametrización del módulo
● B#16#33: Inicio de reparametrización del módulo
● B#16#38: Módulo enchufado
● B#16#39: Módulo desenchufado, no accesible o fin
de reparametrización

OB83_FLT_ID

BYTE

Código de error (valores posibles: B#16#51, B#16#54,
B#16#55, B#16#56, B#16#57, B#16#58, B#16#61,
B#16#63, B#16#64, B#16#65, B#16#66, B#16#67,
B#16#68)

OB83_PRIORITY

BYTE

Clase de prioridad; ajustable mediante configuración

OB83_OB_NUMBR

BYTE

N.º de OB (83)

OB83_RESERVED_1

BYTE

Identificador de módulo o submódulo/módulo de interfaz

OB83_MDL_ID

BYTE

Rango:

En CPU S7-1500: prioridad, valor predeterminado: 6

● B#16#54: Área de periferia de las entradas (PI)
● B#16#55: Área de periferia de las salidas (PO)
OB83_MDL_ADDR

WORD

● PROFIBUS DP centralizado o descentralizado:
Dirección base lógica del módulo afectado; en caso
de módulo mixto, la dirección lógica menor utilizada
del módulo. Si las direcciones lógicas I y O del
módulo mixto son iguales, la dirección base lógica
recibirá el identificador I.
● PROFINET IO descentralizado: Dirección base
lógica del módulo/submódulo

934

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB83_RACK_NUM

INT

● Si OB83_RESERVED_1 =B#16#A0: N.º del
submódulo/módulo de interfaz (low byte)
● Si OB83_RESERVED_1 = B#16#C4:

OB83_MDL_TYPE

WORD

–

Centralizado: N.º del rack

–

PROFIBUS DP descentralizado: N.º de la
estación DP (low byte) e ID del sistema maestro
DP (high byte)

–

PROFINET IO descentralizado: Dirección física:
Bit de identificación (bit 15, 1 = PROFINET IO),
ID del sistema IO (bits 11 a 14) y número de
estación (bits 0 a 10)

En S7-300 / S7-400:
● PROFIBUS DP centralizado o descentralizado: tipo
del módulo afectado (X: no relevante para el
usuario). Los tipos de módulos que no aparecen
listados aquí, están documentados en el manual del
módulo correspondiente.
–

W#16#X5XX: Módulo analógico

–

W#16#X8XX: Módulo de función

–

W#16#XCXX: CP

–

W#16#XFXX: Módulo digital

–

W#16#8340: Identificador de tipo de sustitución
para módulo de entrada

–

W#16#9340: Identificador de tipo de sustitución
para módulo de salida

–

W#16#A340: Identificador de tipo de sustitución
para módulo mixto (I/O)

–

W#16#F340: Identificador de tipo de sustitución
para módulo vacío o no identificable de modo
inequívoco (p. ej. direcciones comprimidas)

–

Los tipos de módulos que no aparecen listados
aquí, están documentados en el manual del
módulo correspondiente.

● PROFINET IO descentralizado:
–

W#16#8101: El tipo del módulo enchufado
coincide con el tipo del módulo desenchufado

–

W#16#8102: el tipo del módulo enchufado no
coincide con el tipo del módulo desenchufado

En S7-1500:
● W#16#8101: en todos los eventos de extracción; en
todos los eventos de inserción con excepción de la
inserción de un módulo de un tipo erróneo
● W#16#8102: el tipo del módulo enchufado no
coincide con el tipo del módulo desenchufado
OB83_DATE_TIME

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

935

Configuración de dispositivos y redes
1.4 Crear configuraciones
La tabla siguiente muestra cuál es el evento que ha provocado el arranque del OB 83.
OB83_EV_CLASS

OB83_FLT_ID

Significado

B#16#39

B#16#51

● Módulo PROFINET IO desenchufado
● Con las CPUs 1510SP-1 PN y 1512SP-1 PN: módulo IO
desenchufado

B#16#39

B#16#54

● Submódulo PROFINET IO desenchufado
● Con las CPUs 1510SP-1 PN y 1512SP-1 PN: submódulo
IO desenchufado

B#16#38

B#16#54

● Submódulo PROFINET IO enchufado y coincide con el
submódulo parametrizado
● Con las CPUs 1510SP-1 PN y 1512SP-1 PN: submódulo
IO enchufado y coincide con el submódulo parametrizado

B#16#38

B#16#55

● Submódulo PROFINET IO enchufado, pero no coincide
con el submódulo parametrizado
● Con las CPUs 1510SP-1 PN y 1512SP-1 PN: submódulo
IO enchfuado, pero no coincidente con el submódulo
parametrizado

B#16#38

B#16#56

● Submódulo PROFINET IO enchufado, pero error en
parametrización del módulo
● Con las CPUs 1510SP-1 PN y 1512SP-1 PN: submódulo
IO enchufado, pero error en parametrización del módulo

B#16#38

B#16#57

● Submódulo o módulo PROFINET IO enchufado, pero con
fallo o mantenimiento
● Con las CPUs 1510SP-1 PN y 1512SP-1 PN: submódulo
o módulo IO enchufado, pero con fallo o mantenimiento

B#16#38

B#16#58

● Submódulo PROFINET IO, error de acceso eliminado
● Con las CPUs 1510SP-1 PN y 1512SP-1 PN: submódulo
IO, error de acceso eliminado

936

B#16#39

B#16#61

Módulo desenchufado o no accesible
OB83_MDL_TYPE: Tipo de módulo real

B#16#38

B#16#61

Módulo enchufado, tipo de módulo correcto
OB83_MDL_TYPE: Tipo de módulo real

B#16#38

B#16#63

Módulo enchufado, pero tipo de módulo incorrecto
OB83_MDL_TYPE: Tipo de módulo real

B#16#38

B#16#64

Módulo enchufado, pero defectuoso (identificador de módulo
ilegible)
OB83_MDL_TYPE: Tipo de módulo teórico

B#16#38

B#16#65

Módulo enchufado, pero error en parametrización del módulo
OB83_MDL_TYPE: Tipo de módulo real

B#16#39

B#16#66

Módulo no accesible, error de tensión de carga

B#16#38

B#16#66

Módulo de nuevo accesible, error de tensión de carga elimi‐
nado

B#16#33

B#16#67

Inicio reparametrización de un módulo

B#16#32

B#16#67

Fin reparametrización de un módulo

B#16#39

B#16#68

Reparametrización de un módulo finalizada con errores

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Nota
Si se utiliza una CPU compatible con DPV1 o PROFINET, puede usarse la instrucción
"RALRM" para obtener información acerca de la alarma, más allá de la información de
arranque del OB. Esto también se aplica cuando el maestro DP se opera en el modo
compatible con S7.

Programación del OB 83
El OB 83 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 83 y cárguelo en la CPU como parte del programa de usuario.
El OB 83 puede usarse por ejemplo de la siguiente manera:
● Se evalúa la información de arranque del OB 83.
● Para parametrizar el módulo que se acaba de insertar pueden usarse las instrucciones
"WR_PARM", "WR_DPARM", "PARM_MOD", "WR_REC" y "RD_REC".

OB de error de hardware en CPU (OB 84)
Descripción
El sistema operativo de la CPU llama el OB 84 en los siguientes casos:
● Después de detectarse y eliminarse errores de memoria
● Con WinAC RTX: Error en el sistema operativo del PC, p. ej. Blue Screen
Si no se ha programado el OB 84, la CPU no pasa al estado operativo STOP.
Se puede bloquear la llamada del OB de error de hardware en CPU con la instrucción
"DIS_IRT", volver a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones
"DIS_AIRT" y "EN_AIRT".

Datos locales del OB de error de hardware en CPU
La tabla siguiente contiene las variables temporales (TEMP) del OB de error de hardware en
CPU. Se han escogido como nombres de variable los nombres predeterminados del OB 84.
Variable

Tipo de datos

Descripción

OB84_EV_CLASS

BYTE

Clase de evento e identificadores:
● B#16#38: Evento saliente
● B#16#35, B#16#39: Evento entrante

OB84_FLT_ID

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

BYTE

Código de error (B#16#82, B#16#83, B#16#85,
B#16#86, B#16#87)

937

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB84_PRIORITY

BYTE

Clase de prioridad; ajustable mediante configuración
(configuración de hardware)

OB84_OB_NUMBR

BYTE

N.º de OB (84)

OB84_RESERVED_1

BYTE

Reservado

OB84_RESERVED_2

BYTE

Reservado

OB84_RESERVED_3

WORD

Reservado

OB84_RESERVED_4

DWORD

Reservado

OB84_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

La tabla siguiente muestra cuál es el evento que ha provocado el arranque del OB 84.
OB84_EV_CLASS

OB84_FLT_ID

Evento de arranque del OB 84

B#16#35

B#16#82

Error de memoria detectado por el sistema operativo y elimi‐
nado

B#16#35

B#16#83

Acumulación de errores de memoria detectados y corregidos

B#16#35

B#16#85

Error en el sistema operativo del PC

B#16#39

B#16#86

Rendimiento de un acoplamiento H-Sync, disminuido

B#16#35

B#16#87

Error de memoria multibit, detectado y corregido

Programación del OB 84
El OB 84 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 84 y cárguelo en la CPU como parte del programa de usuario.
El OB 84 puede usarse por ejemplo de la siguiente manera:
● Se evalúa la información de arranque del OB 84.
● Para enviar un mensaje al búfer de diagnóstico, utilice la instrucción "WR_USMSG".

938

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

OB de error de ejecución del programa (OB 85)
Descripción
El sistema operativo de la CPU llama el OB 85 en caso de que se produzca uno de los
siguientes eventos:
● Evento de arranque para un OB no cargado (excepto OB 80, OB 81, OB 82, OB 83 y OB 86)
● Error al acceder a un bloque a través del sistema operativo
● Error de acceso a la periferia durante la actualización de la memoria imagen de proceso
desde el sistema, en caso de que no se haya suprimido la llamada del OB 85 mediante
configuración.
Nota
Si el OB 85 no está programado, la CPU pasa al estado operativo STOP cuando se produce
uno de los eventos mencionados.
Se puede bloquear la llamada del OB de error de ejecución del programa con la instrucción
"DIS_IRT", volver a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones
"DIS_AIRT" y "EN_AIRT".

Datos locales del OB de error de ejecución del programa
La tabla siguiente contiene las variables temporales (TEMP) del OB de error de ejecución del
programa. Se han escogido como nombres de variable los nombres predeterminados del OB
85.
Variable

Tipo de datos

Descripción

OB85_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#35,
B#16#38 (solo con código de error B#16#B3 y
B#16#B4), B#16#39 (solo con código de error
B#16#B1, B#16#B2, B#16#B3 y B#16#B4)

OB85_FLT_ID

BYTE

Código de error (valores posibles: B#16#A1,
B#16#A2, B#16#A3, B#16#A4, B#16#B1, B#16#B2,
B#16#B3, B#16#B4)

OB85_PRIORITY

BYTE

Clase de prioridad; ajustable mediante configuración

OB85_OB_NUMBR

BYTE

N.º de OB (85)

OB85_RESERVED_1

BYTE

Reservado

OB85_RESERVED_2

BYTE

Reservado

OB85_RESERVED_3

INT

Reservado

OB85_ERR_EV_CLASS

BYTE

Clase a la que pertenece el evento que ha provocado
el error

OB85_ERR_EV_NUM

BYTE

Número del evento que ha provocado el error

OB85_OB_PRIOR

BYTE

Clase de prioridad del OB que se estaba procesando
cuando se produjo el error (solo con algunos códigos
de error, para más información ver abajo)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

939

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB85_OB_NUM

BYTE

Número del OB que se estaba procesando cuando se
produjo el error (solo con algunos códigos de error,
para más información ver abajo)

OB85_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Si se desea programar el OB 85 en función de los códigos de error posibles, se recomienda
organizar las variables locales de la siguiente manera:
Variable

Tipo de datos

OB85_EV_CLASS

BYTE

OB85_FLT_ID

BYTE

OB85_PRIORITY

BYTE

OB85_OB_NUMBR

BYTE

OB85_DKZ23

BYTE

OB85_RESERVED_2

BYTE

OB85_Z1

WORD

OB85_Z23

DWORD

OB85_DATE_TIME

DATE_AND_TIME

La tabla siguiente muestra cuál es el evento que ha provocado el arranque del OB 85 y qué
valores contienen las variables dependientes del código de error.
OB85_EV_CLASS

OB85_FLT_ID

Significado

B#16#35

B#16#A1

El programa o el sistema operativo (en función de la confi‐
guración) genera un evento de arranque para un OB que no
está cargado en la CPU.
● OB85_Z1: La correspondiente variable temporal del OB
solicitado. Este se determina mediante el OB85_Z23.
● OB85_Z23:

B#16#35

B#16#A2

–

high word: Clase y número del evento causante

–

low word, high byte: Nivel de programa activo en el
momento del error
low word, low byte: OB activo

El programa o el sistema operativo (en función de la confi‐
guración) genera un evento de arranque para un OB que no
está cargado en la CPU.
OB85_Z1 y OB85_Z23 como con OB85_FLT_ID=B#16#A1

940

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
OB85_EV_CLASS

OB85_FLT_ID

Significado

B#16#35

B#16#A3

Error al acceder a un bloque a través del sistema operativo
● OB85_Z1: Identificador de error del sistema operativo
–

high byte: 1=función integrada, 2=temporizador CEI

–

low byte: 0=sin resolución de error, 1=bloque no
cargado, 2=error de longitud de área, 3=error de
protección contra escritura

● OB85_Z23:
–

high word: Número de bloque

–

low word: Dirección relativa del comando MC7 que
provoca errores. El tipo de bloque puede consultarse
en el OB 85_DKZ23 (B#16#88: OB, B#16#8C: FC,
B#16#8E: FB, B#16#8A: DB).

B#16#35

B#16#A4

DB interfaz PROFINET, no accesible

B#16#34

B#16#A4

DB interfaz PROFINET, de nuevo accesible

B#16#39

B#16#B1

Error de acceso a periferia al actualizar la memoria imagen
de proceso de las entradas
● OB85_DKZ23: Identificador del tipo de transferencia de
la memoria imagen de proceso en el que se ha producido
el error de acceso a periferia
–

B#16#10: Acceso por byte

–

B#16#20: Acceso por palabra

–

B#16#30: Acceso por palabra doble

–

B#16#56 o B#16#57: Transferencia de un área de
coherencia configurada

● OB85_Z1: Reservado para uso interno de la CPU:
dirección base lógica del módulo
Si OB85_RESERVED_2 tiene el valor B#16#76,
OB85_Z1 contiene el valor de retorno de la instrucción
afectada ("DPRD_DAT", "DPWR_DAT", "UPDAT_PI" o
"UPDAT_PO").
● OB85_Z23:

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

–

Byte 0: si OB85_DKZ23=B#16#57: n.º de memoria
imagen parcial de proceso

–

Byte 1: irrelevante si OB85_DKZ23=B#16#10, 20 o
30; longitud del área de coherencia en bytes, si
OB85_DKZ23=B#16#57

–

Byte 0 y byte 1, si OB85_DKZ23=B#16#56: longitud
del área de coherencia en bytes

–

Bytes 2 y 3: la dirección de periferia causante del error
de acceso a la periferia, si OB85_DKZ23=B#16#10,
20 o 30;
dirección lógica inicial del área de coherencia, si
OB85_DKZ23=B#16#57

941

Configuración de dispositivos y redes
1.4 Crear configuraciones
OB85_EV_CLASS

OB85_FLT_ID

Significado

B#16#39

B#16#B2

Error de acceso a periferia al transferir la memoria imagen de
proceso de las salidas a los módulos de salida
OB85_DKZ23, OB85_Z1 y OB85_Z23 como con
OB85_FLT_ID=B#16#B1

Si se ha configurado para la actualización de la memoria imagen de proceso desde el sistema la
llamada repetida del OB 85 en caso de errores de acceso a periferia, se reciben los códigos de error
B#16#B1 y B#16#B2.
B#16#39/B#16#38

B#16#B3

Error de acceso a periferia al actualizar la memoria imagen
de proceso de las entradas, entrante/saliente
● OB85_DKZ23: Identificador del tipo de transferencia de
la memoria imagen de proceso en el que se ha producido
el error de acceso a periferia
–

B#16#10: Acceso por byte

–

B#16#20: Acceso por palabra

–

B#16#30: Acceso por palabra doble

–

B#16#56 o B#16#57: Transferencia de un área de
coherencia configurada

● OB85_Z1: Reservado para uso interno de la CPU:
dirección base lógica del módulo
Si OB85_RESERVED_2 tiene el valor B#16#76,
OB85_Z1 contiene el valor de retorno de la instrucción
afectada ("DPRD_DAT", "DPWR_DAT", "UPDAT_PI" o
"UPDAT_PO").
● OB85_Z23:

B#16#39/B#16#38

B#16#B4

–

Byte 0: si OB85_DKZ23=B#16#57: n.º de memoria
imagen parcial de proceso

–

Byte 1: irrelevante si OB85_DKZ23=B#16#10, 20 o
30; longitud del área de coherencia en bytes, si
OB85_DKZ23=B#16#57

–

Byte 0 y byte 1, si OB85_DKZ23=B#16#56: longitud
del área de coherencia en bytes

–

Bytes 2 y 3: la dirección de periferia causante del error
de acceso a la periferia, si OB85_DKZ23=B#16#10,
20 o 30;
dirección lógica inicial del área de coherencia, si
OB85_DKZ23=B#16#57

Error de acceso a periferia al actualizar la memoria imagen
de proceso de las salidas, entrante/saliente
OB85_DKZ23, OB85_Z1 y OB85_Z23 como con
OB85_FLT_ID=B#16#B3

Si se ha configurado para la actualización de la memoria imagen de proceso desde el sistema la
llamada del OB 85 solo en caso de errores de acceso a periferia entrantes y salientes, se reciben los
códigos de error B#16#B3 y B#16#B4. Después de un arranque en frío o un rearranque completo (en
caliente), en la siguiente actualización de la memoria imagen de proceso, todos los accesos a entradas
o salidas no existentes se comunicarán como errores de acceso a periferia entrantes.

942

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones

Programación del OB 85
El OB 85 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 85 y cárguelo en la CPU como parte del programa de usuario.
El OB 85 puede usarse por ejemplo de la siguiente manera:
● Al evaluar la información de arranque del OB 85, se comprueba qué módulo está
defectuoso o no existe (indicación de la dirección inicial del módulo).
● La instrucción "LGC_GADR" permite detectar el slot del módulo afectado.

OB de fallo del rack (OB 86)
Descripción
El sistema operativo de la CPU llama el OB 86 en los siguientes casos:
● Se detecta el fallo de un aparato de ampliación central (no para S7-300) (tanto con evento
entrante como con evento saliente).
● Se detecta el fallo de un sistema maestro DP (tanto con evento entrante como con evento
saliente).
● Se detecta el fallo de una estación en periferia descentralizada (PROFIBUS DP o
PROFINET IO) (tanto con evento entrante como con evento saliente).
● Se ha desactivado una estación en periferia descentralizada (PROFIBUS DP o PROFINET
IO) con la instrucción "D_ACT_DP" mediante MODE=4.
● Se ha desactivado una estación en periferia descentralizada (PROFIBUS DP o PROFINET
IO) con la instrucción "D_ACT_DP" mediante MODE=3.
● Se detecta el fallo de un sistema PROFINET IO o de una estación PROFINET IO o de una
parte de los submódulos de un I-Device PROFINET.
Si no se ha programado el OB 86 y se produce un error de ese tipo, la CPU pasa al estado
operativo STOP.
Se puede bloquear la llamada del OB de fallo del rack con la instrucción "DIS_IRT", volver a
habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT" y
"EN_AIRT".

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

943

Configuración de dispositivos y redes
1.4 Crear configuraciones

Datos locales del OB de fallo del rack
La tabla siguiente contiene las variables temporales (TEMP) del OB de fallo del rack. Se han
escogido como nombres de variable los nombres predeterminados del OB 86.
Variable

Tipo de datos

Descripción

OB86_EV_CLASS

BYTE

Clase de evento e identificadores:
● B#16#32: Activar una estación con la instrucción
"D_ACT_DP" mediante MODE=3
● B#16#33: Desactivar una estación con la instrucción
"D_ACT_DP" mediante MODE=4
● B#16#38: evento saliente
● B#16#39: evento entrante

OB86_FLT_ID

BYTE

Código de error (valores posibles: B#16#C1, B#16#C2,
B#16#C3, B#16#C4, B#16#C5, B#16#C6, B#16#C7,
B#16#C8, B#16#C9, B#16#CA, B#16#CB, B#16#CC,
B#16#CD, B#16#CE, B#16#CF, B#16#F8, B#16#F9)

OB86_PRIORITY

BYTE

Clase de prioridad; ajustable mediante configuración

OB86_OB_NUMBR

BYTE

N.º de OB (86)

OB86_RESERVED_1

BYTE

Reservado

OB86_RESERVED_2

BYTE

Reservado

OB86_MDL_ADDR

WORD

En función del código de error

ARRAY [0 ..31]

En función del código de error

En las CPU S7-1500: prioridad, valor predeterminado: 6

OB86_RACKS_FLTD

OF BOOL
OB86_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Si se desea programar el OB 86 en función de los códigos de error posibles, se recomienda
organizar las variables locales de la siguiente manera:

944

Variable

Tipo de datos

OB86_EV_CLASS

BYTE

OB86_FLT_ID

BYTE

OB86_PRIORITY

BYTE

OB86_OB_NUMBR

BYTE

OB86_RESERVED_1

BYTE

OB86_RESERVED_2

BYTE

OB86_MDL_ADDR

WORD

OB86_Z23

DWORD

OB86_DATE_TIME

DATE_AND_TIME

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
La tabla siguiente muestra cuál es el evento que ha provocado el arranque del OB 86.
OB86_EV_CLASS

OB86_FLT_ID

Significado

B#16#39

B#16#C1

Fallo de aparato de ampliación
● OB86_MDL_ADDR: Dirección base lógica del IM
● OB86_Z23: Contiene un bit por cada aparato de
ampliación posible: Cuando un aparato de ampliación
provoca la llamada del OB 86, se comunica que ha
fallado (están activados los bits correspondientes). Los
aparatos de ampliación que hayan fallado antes ya no se
muestran.

B#16#38

B#16#C1

–

Bit 0: siempre 0

–

Bit 1: 1. Aparato de ampliación

–

:

–

Bit 21: 21. Aparato de ampliación

–

Bits 22 a 29: siempre 0

–

Bit 30: Fallo de por lo menos un aparato de
ampliación en el rango SIMATIC S5

–

Bit 31: siempre 0

Retorno de un aparato de ampliación
OB86_MDL_ADDR como con OB86_FLT_ID=B#16#C1.
OB86_Z23 contiene los aparatos de ampliación recuperados
(están activados los bits correspondientes).

B#16#38

B#16#C2

Recuperación del aparato de ampliación (fallo del aparato de
ampliación saliente con diferencias entre configuración teó‐
rica y configuración real)
● OB86_MDL_ADDR: Dirección base lógica del IM
● OB86_Z23: Contiene un bit por cada aparato de
ampliación posible; ver OB86_FLT_ID B#16#C1.
Significado de un bit activado: En el aparato de
ampliación afectado:

B#16#39

B#16#C3

–

Existen módulos con identificador de módulo erróneo.

–

Faltan módulos configurados.

–

Hay por lo menos un módulo defectuoso.

Periferia descentralizada: Fallo de un sistema maestro DP
Solo los eventos entrantes provocan el arranque del OB 86
con código de error B#16#C3.
Los eventos salientes provocan el arranque del OB 86 con
código de error B#16#C4 y clase de evento B#16#38:
El retorno de las estaciones DP subordinadas provoca el
arranque del OB 86.
● OB86_MDL_ADDR: Dirección base lógica del maestro
DP
● OB86_Z23: ID del sistema maestro DP:

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

–

Bits 0 a 7: Reservado

–

Bits 8 a 15: ID del sistema maestro DP

–

Bits 16 a 31: Reservado

945

Configuración de dispositivos y redes
1.4 Crear configuraciones
OB86_EV_CLASS

OB86_FLT_ID

Significado

B#16#39/B#16#38

B#16#C4

Fallo de una estación DP
● OB86_MDL_ADDR: Dirección base lógica del maestro
DP
● OB86_Z23: Dirección del esclavo DP afectado:

B#16#39/B#16#38

B#16#C5

–

Bits 0 a 7: N.º de estación DP

–

Bits 8 a 15: ID del sistema maestro DP

–

Bits 16 a 30: Dirección base lógica con un esclavo S7
o dirección de diagnóstico con un esclavo DP
normalizado

–

Bit 31: Identificador I/O

Retorno de una estación DP, pero la estación es defectuosa
OB86_MDL_ADDR y OB86_Z23 como con
FLT_ID=B#16#C4

B#16#38

B#16#C6

Retorno del aparato de ampliación, pero error en parametri‐
zación del módulo
● OB86_MDL_ADDR: Dirección base lógica del IM
● OB86_Z23: Contiene un bit por cada aparato de
ampliación posible:
–

Bit 0: siempre 0

–

Bit 1: 1. Aparato de ampliación:

–

…

–

Bit 21: 21. Aparato de ampliación

–

Bits 22 a 30: Reservado

–

Bit 31: siempre 0

● Significado de un bit activado: En el aparato de
ampliación afectado

B#16#38

B#16#C7

–

Existen módulos con identificador de módulo erróneo.

–

Existen módulos con parámetros erróneos o
inexistentes.

Retorno de una estación DP, pero hay un fallo en la para‐
metrización del módulo
● OB86_MDL_ADDR: Dirección base lógica del maestro
DP
● Dirección del esclavo DP afectado:

946

–

Bits 0 a 7: N.º de estación DP

–

Bits 8 a 15: ID del sistema maestro DP

–

Bits 16 a 30: Dirección base lógica del esclavo DP

–

Bit 31: Identificador I/O

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
OB86_EV_CLASS

OB86_FLT_ID

Significado

B#16#38

B#16#C8

Retorno de una estación DP, pero con diferencias entre la
configuración teórica y la configuración real
● OB86_MDL_ADDR: Dirección base lógica del maestro
DP
● OB86_Z23: Dirección del esclavo DP afectado:

B#16#32/B#16#33

B#16#C9

–

Bits 0 a 7: N.º de estación DP

–

Bits 8 a 15: ID del sistema maestro DP

–

Bits 16 a 30: Dirección base lógica del esclavo DP

–

Bit 31: Identificador I/O

Activar/desactivar un esclavo DP con la instrucción
"D_ACT_DP" mediante MODE=3/MODE=4
● OB86_MDL_ADDR: Dirección base lógica del maestro
DP
● OB86_Z23: Dirección del esclavo DP afectado

B#16#39

B#16#CA

–

Bits 0 a 7: N.º de estación DP

–

Bits 8 a 15: ID del sistema maestro DP

–

Bits 16 a 30: Dirección base lógica con un esclavo S7
o dirección de diagnóstico con un esclavo DP
normalizado

–

Bit 31: Identificador I/O

Fallo de sistema de PROFINET IO
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:

B#16#39/38

B#16#CB

–

Bits 0 a 10: 0 (número de estación)

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 31: 0

Fallo de estación/Recuperación de estación PROFINET IO
● OB86_RESERVED_1: B#16#C4
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:
–

Bits 0 a 10: Número de estación

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 30: Dirección base lógica de la estación

–

Bit 31: Identificador I/O

Nota: Antes de comprobar en el programa si la causa de un
arranque del OB86 es un fallo de la estación PROFINET IO,
hay que comprobar si existe un fallo del sistema PROFINET
IO.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

947

Configuración de dispositivos y redes
1.4 Crear configuraciones
OB86_EV_CLASS

OB86_FLT_ID

Significado

B#16#/38

B#16#CC

Recuperación de estación PROFINET IO con fallo o mante‐
nimiento
● OB86_RESERVED_1: B#16#C4
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:

B#16#38

B#16#CD

–

Bits 0 a 10: Número de estación

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 30: Dirección base lógica de la estación

–

Bit 31: Identificador I/O

Retorno de estación PROFINET IO, pero la configuración
teórica difiere de la configuración real
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:

B#16#38

B#16#CE

–

Bits 0 a 10: Número de estación

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 30: Dirección base lógica de la estación

–

Bit 31: Identificador I/O

Retorno de estación PROFINET IO, pero error en la para‐
metrización del módulo
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:

B#16#32/B#16#33

B#16#CF

–

Bits 0 a 10: Número de estación

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 30: Dirección base lógica de la estación

–

Bit 31: Identificador I/O

Activar/desactivar un dispositivo PROFINET IO con la ins‐
trucción "D_ACT_DP" mediante MODE=3/MODE=4
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:

948

–

Bits 0 a 10: Número de estación

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 30: Dirección base lógica de la estación

–

Bit 31: Identificador I/O

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
OB86_EV_CLASS

OB86_FLT_ID

Significado

B#16#39/B#16#38

B#16#F8

Fallo/recuperación de una parte de los submódulos de un IDevice PROFINET
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:

B#16#38

B#16#F9

–

Bits 0 a 10: Número de estación

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 30: Dirección base lógica de la estación

–

Bit 31: Identificador I/O

Recuperación de una parte de los submódulos de un I-Devi‐
ce PROFINET con diferencias en la configuración de dispo‐
sitivos
● OB86_MDL_ADDR: Dirección base lógica del
controlador IO
● OB86_Z23:
–

Bits 0 a 10: Número de estación

–

Bits 11 a 14: ID del sistema IO

–

Bit 15: 1

–

Bits 16 a 30: Dirección base lógica de la estación

–

Bit 31: Identificador I/O

Nota
Si se utiliza una CPU compatible con DPV1 o PROFINET, puede usarse la instrucción
"RALRM" para obtener información acerca de la alarma, más allá de la información de
arranque del OB. Esto también se aplica cuando el maestro DP se opera en el modo
compatible con S7.

Programación del OB 86
El OB 86 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 86 y cárguelo en la CPU como parte del programa de usuario.
El OB 86 puede usarse por ejemplo de la siguiente manera:
● Al evaluar la información de arranque del OB 86, se comprueba qué rack es defectuoso o
no existe.
● Con la instrucción "WR_USMSG" se registra un mensaje en el búfer de diagnóstico, que se
envía a un dispositivo de observación.

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

949

Configuración de dispositivos y redes
1.4 Crear configuraciones

OB de error de comunicación (OB 87)
Descripción
El sistema operativo de la CPU activa el OB 87 cuando se produce un evento provocado por
un error de comunicación.
Si no se ha programado el OB 87 y se produce un evento de arranque para el OB 87, la CPU
se comporta de la manera siguiente:
● Una CPU S7-300 pasa al estado operativo STOP.
● Una CPU S7-400 no pasa al estado operativo STOP.
Se puede bloquear la llamada del OB de error de comunicación con la instrucción "DIS_IRT",
volver a habilitarla con la instrucción "EN_IRT" y retardarla con las instrucciones "DIS_AIRT"
y "EN_AIRT".

Datos locales del OB de error de comunicación
La tabla siguiente contiene las variables temporales (TEMP) del OB de error de comunicación.
Se han escogido como nombres de variable los nombres predeterminados del OB 87.
Variable

Tipo de datos

Descripción

OB87_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#39

OB87_FLT_ID

BYTE

Código de error
(valores posibles: B#16#D2, B#16#D3, B#16#D4,
B#16#D5, B#16#E1, B#16#E2, B#16#E3, B#16#E4,
B#16#E5, B#16#E6)

OB87_PRIORITY

BYTE

Clase de prioridad; ajustable mediante configuración

OB87_OB_NUMBR

BYTE

N.º de OB (87)

OB87_RESERVED_1

BYTE

Reservado

OB87_RESERVED_2

BYTE

Reservado

OB87_RESERVED_3

WORD

En función del código de error

OB87_RESERVED_4

DWORD

En función del código de error

OB87_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Significado de las variables dependientes del código de error:
Código de error

Variable

Significado

B#16#D2

No es posible enviar los registros de diagnóstico en este momento.

B#16#D3

No se pueden enviar los telegramas de sincronización (maestro).

B#16#D4

Salto de hora no admisible debido a sincronización horaria

B#16#D5

Error al adoptar el tiempo de sincronización (esclavo)
OB87_RESERVED_3

No contiene más información

OB87_RESERVED_4

No contiene más información

B#16#E1

Identificación de telegrama errónea en comunicación de datos globales

B#16#E2

No se puede registrar en un DB el estado de paquete GD

950

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Código de error

Variable

Significado

OB87_RESERVED_3

Número de DB

OB87_RESERVED_4

● High word: No contiene más información
● Low word: Número de círculo GD (high byte), número de paquete GD (low
byte)

B#16#E3

Error de longitud de telegrama en comunicación de datos globales

B#16#E4

Recibido número de paquete GD no admisible
OB87_RESERVED_3

Identificador de interfaz (0: Bus K, 1: MPI)

OB87_RESERVED_4

● High byte: Número de círculo GD
● Low byte: No contiene más información
Error al acceder al DB durante el intercambio de datos a través de bloques de
función de comunicación

B#16#E5
OB87_RESERVED_1

Tipo de bloque: B#16#88: OB, B#16#8A: DB, B#16#8C: FC, B#16#8E: FB

OB87_RESERVED_3

Reservado para uso interno de la CPU:

OB87_RESERVED_4

● High word: Número del bloque con el comando MC7 que provoca errores
● Low word: Dirección relativa del comando MC7 que provoca errores
No se puede registrar en el DB el estado global de GD

B#16#E6
OB87_RESERVED_3

Número de DB

OB87_RESERVED_4

No contiene más información

Programación del OB 87
El OB 87 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 87 y cárguelo en la CPU como parte del programa de usuario.
El OB 87 puede usarse por ejemplo de la siguiente manera:
● Se evalúa la información de arranque del OB 87.
● Si falta el bloque de datos para la información de estado de la comunicación de datos
globales, debe crearse un bloque de datos.

OB de interrupción del procesamiento (OB 88)
Descripción
El sistema operativo de la CPU H llama el OB 88 en caso de que se interrumpa el
procesamiento de un programa. Posibles causas de la interrupción:
● Excesiva profundidad de anidamiento con errores síncronos
● Excesiva profundidad de anidamiento de llamadas de bloque (pila U)
● Error al asignar datos locales
Si no se ha programado el OB 88 y se produce una interrupción del procesamiento, la CPU
pasa al estado operativo STOP (evento W#16#4570).

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

951

Configuración de dispositivos y redes
1.4 Crear configuraciones
Si la interrupción se produce en la clase de prioridad 28, la CPU pasa a STOP.
Se puede bloquear la llamada del OB de error de interrupción del procesamiento con la
instrucción "DIS_IRT", volver a habilitarla con la instrucción "EN_IRT" y retardarla con las
instrucciones "DIS_AIRT" y "EN_AIRT".

Datos locales del OB de interrupción del procesamiento
La tabla siguiente contiene las variables temporales (TEMP) del OB de interrupción del
procesamiento. Se han escogido como nombres de variable los nombres predeterminados del
OB 88.
Variable

Tipo de datos

Descripción

OB88_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#35

OB88_SW_FLT

BYTE

Código de error
Valores posibles:
● B#16#71: Excesiva profundidad de
anidamiento de niveles de paréntesis
● B#16#72: Excesiva profundidad de
anidamiento de Master Control Relais
● B#16#73: Excesiva profundidad de
anidamiento con errores síncronos
● B#16#74: Excesiva profundidad de
anidamiento de llamadas de bloque (pila U)
● B#16#75: Excesiva profundidad de
anidamiento de llamadas de bloque (pila B)
● B#16#76: Error al asignar datos locales
● B#16#78: Instrucción desconocida
● B#16#7A: Instrucción de salto con destino fuera
del módulo
En la lista de operaciones de la CPU puede con‐
sultar cuáles son los códigos de error válidos para
la CPU que se utiliza.

OB88_PRIORITY

BYTE

Clase de prioridad: 28

OB88_OB_NUMBR

BYTE

N.º de OB (88)

OB88_BLK_TYPE

BYTE

Tipo de bloque en el que se ha producido el error:
● B#16#88: OB
● B#16#8C: FC
● B#16#8E: FB
● B#16##00: No se puede determinar la
ubicación del error

952

OB88_RESERVED_1

BYTE

Reservado

OB88_FLT_PRIORITY

BYTE

Clase de prioridad del OB que provoca errores

OB88_FLT_OB_NUMBR

BYTE

Número del OB que provoca errores

OB88_BLK_NUM

WORD

Número del bloque con el comando MC7 que pro‐
voca errores

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB88_PRG_ADDR

WORD

Dirección relativa del comando MC7 que provoca
errores

OB88_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Programación del OB 88
El OB 88 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 88 y cárguelo en la CPU como parte del programa de usuario.
El OB 88 puede usarse por ejemplo de la siguiente manera:
● Se evalúa la información de arranque del OB 88.
● Debe registrarse la causa del error en un bloque de datos de notificación.

OB de segundo plano (OB 90)
Descripción
S7 ofrece la vigilancia de un tiempo de ciclo máximo y garantiza la observancia de un tiempo
de ciclo mínimo. Si el tiempo de procesamiento del OB 1, incluidos todos los procesamientos
de alarmas anidados y actividades del sistema, es menor que el tiempo de ciclo mínimo
configurado,
● el sistema operativo llama el OB de segundo plano (si está presente en la CPU).
● el sistema operativo retarda el siguiente arranque del OB 1 (si el OB 90 no está presente en
la CPU).

Funcionamiento del OB de segundo plano
El OB 90 tiene la prioridad más baja de todos los OBs. Cualquier actividad del sistema o
cualquier procesamiento de alarma (incluido el OB 1, una vez finalizado el tiempo de ciclo
mínimo) lo interrumpen. La excepción es el procesamiento de instrucciones iniciadas en el OB
90. Estas se procesan con la prioridad del OB 1 y por ello no se interrumpen por el
procesamiento del OB 1. No hay ninguna vigilancia de tiempo para el OB 90.
El programa de usuario en el OB 90 se procesa en los siguientes casos empezando por el
primer comando:
● Después de un rearranque completo (en caliente), un arranque en frío o un rearranque
● Después de cargar o borrar un bloque

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

953

Configuración de dispositivos y redes
1.4 Crear configuraciones
● Después de cargar el OB 90 en la CPU en el estado operativo RUN
● Después de finalizar el ciclo de segundo plano
Nota
En las configuraciones en las que el tiempo de ciclo mínimo y el tiempo de vigilancia de ciclo
están próximos, pueden producirse rebases de tiempo de ciclo inesperados al llamar
instrucciones del OB de segundo plano.

Datos locales del OB de segundo plano
La tabla siguiente contiene las variables temporales (TEMP) del OB 90. Se han usado como
nombres de variable los nombres predeterminados del OB 90.
Variable

Tipo de datos

Descripción

OB90_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#11: activo

OB90_STRT_INF

BYTE

● B#16#91: Rearranque completo (en caliente)/
arranque en frío/rearranque
● B#16#92: Borrado de un bloque
● B#16#93: Carga del OB 90 en la CPU en el estado
operativo RUN
● B#16#95: Finalización del ciclo de segundo plano

OB90_PRIORITY

BYTE

Clase de prioridad: 29 (corresponde a la prioridad 0.29)

OB90_OB_NUMBR

BYTE

N.º de OB (90)

OB90_RESERVED_1

BYTE

Reservado

OB90_RESERVED_2

BYTE

Reservado

OB90_RESERVED_3

INT

Reservado

OB90_RESERVED_4

INT

Reservado

OB90_RESERVED_5

INT

Reservado

OB90_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

OBs de arranque (OB 100, OB 101 y OB 102)
Tipos de arranque
Se distinguen los siguientes tipos de arranque:
● Rearranque (S7-400)
● Rearranque completo (en caliente)
● Arranque en frío

954

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
La tabla siguiente muestra cuál es el OB que el sistema operativo llama para el arranque en
cada caso.
Tipo de arranque

OB correspondiente

Rearranque normal

OB 101

Rearranque completo (en calien‐ OB 100
te)
Arranque en frío

OB 102

Eventos de arranque para el arranque
La CPU ejecuta un arranque
● Después de POWER ON
● Cuando lo solicita una función de comunicación (mediante comando de menú de la PG o
al llamarse las instrucciones "START" o "RESUME" en otra CPU)
En función del evento de arranque, de la CPU presente y de los parámetros ajustados de esta,
se llama el correspondiente OB de arranque (OB 100, OB 101 u OB 102). En él se pueden
realizar, mediante programación, determinados ajustes predeterminados para el programa
cíclico.

Datos locales de los OBs de arranque
La tabla siguiente contiene las variables temporales (TEMP) de un OB de arranque. Se han
usado como nombres de variable los nombres predeterminados.
Variable

Tipo de datos

Descripción

OB10x_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#13: activa

OB10x_STRTUP

BYTE

Solicitud de arranque:
● B#16#81: Solicitud de rearranque completo (en
caliente) manual
● B#16#82: Solicitud de rearranque completo (en
caliente) automático
● B#16#83: Solicitud de rearranque manual
● B#16#84: Solicitud de rearranque automático
● B#16#85: Solicitud de arranque en frío manual
● B#16#86: Solicitud de arranque en frío
automático
● B#16#87: Maestro: Solicitud de arranque en
frío manual
● B#16#88: Maestro: Solicitud de arranque en
frío automático
● B#16#8A: Maestro: Solicitud de rearranque
completo (en caliente) manual
● B#16#8B: Maestro: Solicitud de rearranque
completo (en caliente) automática

OB10x_PRIORITY

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

BYTE

Clase de prioridad: 27 o 1 (en CPU S7-1500)

955

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB10x_OB_NUMBR

BYTE

N.º de OB (100, 101 o 102)

OB10x_RESERVED_1

BYTE

Reservado

OB10x_RESERVED_2

BYTE

Reservado

OB10x_STOP

WORD

Número Número del evento que ha puesto la CPU
en el estado STOP; v. Clase de evento 4 - Eventos
de parada y otras transiciones de estado operativo
(Página 970)

OB10x_STRT_INFO

DWORD

Información complementaria sobre el arranque ac‐
tual

OB10x_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

La tabla siguiente muestra el contenido de la variable OB10x_STRT_INFO.

956

N.º de bit

Significado

Valores posi‐
bles binarios

Explicación

31-24

Información de
arranque

0000 xxxx

N.º de rack 0 (solo en CPUs H)

0100 xxxx

N.º de rack 1 (solo en CPUs H)

1000 xxxx

N.º de rack 2 (solo en CPUs H)

0001 xxxx

Multiprocesamiento (solo S7-400)

0010 xxxx

Funcionamiento de varios módulos centrales en el
rack segmentado (solo S7‑400)

xxxx xxx0

No hay diferencias entre la configuración teórica y
la configuración real
(solo S7-300)

xxxx xxx1

Hay diferencias entre la configuración teórica y la
configuración real
(solo S7-300)

xxxx xx0x

No hay ninguna diferencia entre la configuración
teórica y la configuración real

xxxx xx1x

Hay diferencia entre la configuración teórica y la
configuración real

xxxx x0xx

No hay una CPU H

xxxx x1xx

CPU H

xxxx 0xxx

Reloj para sello de tiempo en último POWER ON,
no respaldado

xxxx 1xxx

Reloj para sello de tiempo en último POWER ON,
respaldado

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
N.º de bit

Significado

Valores posi‐
bles binarios

Explicación

23-16

Tipo de arranque
efectuado en últi‐
mo lugar

0000 0001

Rearranque completo (en caliente) en multiproce‐
samiento sin intervención en la CPU de acuerdo
con la parametrización (solo S7‑400)

Nota: Estos bits
0000 0011
carecen de signifi‐
cado en las CPU 0000 0100
S7-1500.

Rearranque completo (en caliente) mediante selec‐
tor de modo

0000 0101

Arranque en frío en multiprocesamiento sin inter‐
vención en la CPU de acuerdo con la parametriza‐
ción (solo S7-400)

0000 0111

Arranque en frío mediante selector de modo

0000 1000

Arranque en frío mediante intervención por progra‐
madora

0000 1010

Rearranque en multiprocesamiento sin interven‐
ción en la CPU de acuerdo con la parametrización
(solo S7-400)

0000 1011

Rearranque mediante selector de modo
(solo S7-400)

0000 1100

Rearranque mediante intervención por programa‐
dora (solo S7‑400)

0001 0000

Rearranque completo (en caliente) automático des‐
pués de POWER ON respaldado

0001 0001

Arranque en frío después de POWER ON respal‐
dado, de acuerdo con la parametrización

0001 0011

Rearranque completo (en caliente) mediante selec‐
tor de modo; último POWER ON respaldado

0001 0100

Rearranque completo (en caliente) mediante inter‐
vención por programadora; último POWER ON res‐
paldado

0010 0000

Rearranque completo (en caliente) automático des‐
pués de POWER ON no respaldado (con borrado
total desde el sistema)

0010 0001

Arranque en frío después de POWER ON no res‐
paldado (con borrado total desde el sistema)

0010 0011

Rearranque completo (en caliente) mediante selec‐
tor de modo; último POWER ON no respaldado

0010 0100

Rearranque completo (en caliente) mediante inter‐
vención por programadora; último POWER ON no
respaldado

1010 0000

Rearranque automático después de POWER ON
respaldado, de acuerdo con la parametrización (so‐
lo S7-400)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Rearranque completo (en caliente) mediante inter‐
vención por programadora

957

Configuración de dispositivos y redes
1.4 Crear configuraciones
N.º de bit

Significado

15-12

Admisibilidad de
0000
los tipos de arran‐
que automáticos
0001
Nota: Estos bits
carecen de signifi‐ 0111
cado en las CPU
S7-1500.
1111

Arranque automático no admisible, solicitud de bo‐
rrado total

Admisibilidad de
0000
los tipos de arran‐ 0001
que manuales

Arranque no admisible, solicitud de borrado total

Nota: Estos bits
0111
carecen de signifi‐
cado en las CPU 1111
S7-1500.

Rearranque completo (en caliente) admisible

11-8

958

Valores posi‐
bles binarios

Explicación

Arranque automático no admisible, se requiere mo‐
dificación de parámetros, etc.
Rearranque completo (en caliente) automático, ad‐
misible
Rearranque completo (en caliente)/rearranque au‐
tomático, admisible
(solo S7-400)
Arranque no admisible, se requiere modificación de
parámetros, etc.
Rearranque completo (en caliente) y rearranque,
admisibles (solo S7-400)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
N.º de bit

Significado

Valores posi‐
bles binarios

7-0

Última interven‐
0000 0000
ción válida o ajus‐ 0000 0001
te del tipo de
arranque automá‐
tico con POWER
0000 0011
ON

Explicación
Ningún tipo de arranque
Rearranque completo (en caliente) en multiproce‐
samiento sin intervención en la CPU de acuerdo
con la parametrización (solo S7-400)
Rearranque completo (en caliente) mediante selec‐
tor de modo

0000 0100

Rearranque completo (en caliente) mediante inter‐
vención por programadora

0000 0101

Arranque en frío en multiprocesamiento sin inter‐
vención en la CPU de acuerdo con la parametriza‐
ción (solo S7-400)

0000 0111

Arranque en frío mediante selector de modo

0000 1000

Arranque en frío mediante intervención por progra‐
madora

0000 1010

Rearranque en multiprocesamiento sin interven‐
ción en la CPU de acuerdo con la parametrización
(solo S7-400)

0000 1011

Rearranque mediante selector de modo (solo
S7-400)

0000 1100

Rearranque mediante intervención por programa‐
dora (solo S7-400)

0001 0000

Rearranque completo (en caliente) automático des‐
pués de POWER ON respaldado

0001 0001

Arranque en frío después de POWER ON respal‐
dado, de acuerdo con la parametrización

0001 0011

Rearranque completo (en caliente) mediante selec‐
tor de modo; último POWER ON respaldado

0001 0100

Rearranque completo (en caliente) mediante inter‐
vención por programadora; último POWER ON res‐
paldado

0010 0000

Rearranque completo (en caliente) automático des‐
pués de POWER ON no respaldado (con borrado
total desde el sistema)

0010 0001

Arranque en frío después de POWER ON no res‐
paldado (con borrado total desde el sistema)

0010 0011

Rearranque completo (en caliente) mediante selec‐
tor de modo; último POWER ON no respaldado

0010 0100

Rearranque completo (en caliente) mediante inter‐
vención por programadora; último POWER ON no
respaldado

1010 0000

Rearranque automático después de POWER ON
respaldado, de acuerdo con la parametrización (so‐
lo S7-400)

Consulte también
Principios básicos del estado operativo "ARRANQUE" (Página 791)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

959

Configuración de dispositivos y redes
1.4 Crear configuraciones

OB de error de programación (OB 121)
Descripción
El sistema operativo de la CPU activa el OB 121 cuando se produce un evento provocado por
un error durante el procesamiento del programa. Si por ejemplo se llama en el programa un
bloque que no está cargado en la CPU, se llama el OB 121.

Funcionamiento del OB de error de programación
El OB 121 se ejecuta en la misma clase de prioridad que el bloque interrumpido.
Si el OB 121 no está programado, la CPU cambia su estado operativo de RUN a STOP.
S7 dispone de las siguientes instrucciones para enmascarar y desenmascarar eventos de
arranque del OB 121 durante la ejecución del programa:
● La instrucción "MSK_FLT" enmascara determinados códigos de error.
● La instrucción "DMSK_FLT" desenmascara los códigos de error que han sido
enmascarados por la instrucción "MSK_FLT".
● La instrucción "READ_ERR" lee el registro de estado de evento.

Datos locales del OB de error de programación
La tabla siguiente contiene las variables temporales (TEMP) del OB de error de programación.
Se han escogido como nombres de variable los nombres predeterminados del OB 121.
Variable

Tipo de datos

Descripción

OB121_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#25

OB121_SW_FLT

BYTE

Código de error (valores posibles: B#16#21,
B#16#22, B#16#23, B#16#24, B#16#25, B#16#26,
B#16#27, B#16#28, B#16#29, B#16#30, B#16#31,
B#16#32, B#16#33, B#16#34, B#16#35, B#16#3A,
B#16#3C, B#16#3D, B#16#3E, B#16#3F)

OB121_PRIORITY

BYTE

Clase de prioridad del OB en el que se ha producido
el error
En las CPU S7-1500: prioridad, valor predetermina‐
do: 7

960

OB121_OB_NUMBR

BYTE

N.º de OB (121)

OB121_BLK_TYPE

BYTE

Tipo de bloque en el que se ha producido el error (en
el caso de S7-300, no se registra aquí ningún valor
válido): B#16#88: OB, B#16#8A: DB, B#16#8C: FC,
B#16#8E: FB

OB121_RESERVED_1

BYTE

Reservado

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB121_FLT_REG

WORD

Origen del error (en función del código de error), p. ej.:
● Registro en el que se ha producido el error de
conversión
● Dirección errónea (error de lectura/escritura)
● Número erróneo de un temporizador, un contador
o un bloque
● Área de memoria errónea

OB121_BLK_NUM

WORD

Número del bloque que contiene el comando MC7
que provoca errores (en el caso de S7-300, no se
registra aquí ningún valor válido):

OB121_PRG_ADDR

WORD

Dirección relativa del comando MC7 que provoca
errores
(en S7-300 no se registra aquí ningún valor válido)

OB121_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Significado de las variables dependientes del código de error:
Código de error

Variable

B#16#21

Significado
Error de conversión BCD

OB121_FLT_REG
B#16#22

Identificador del registro afectado (W#16#0000: Acu 1)
Error de longitud de área durante lectura

OB121_RESERVED_1

● Del bit 7 al bit 4 Tipo de acceso:
–

0: Acceso por bit,

–

1: Acceso por byte,

–

2: Acceso por palabra,

–

3: Acceso por palabra doble

● Del bit 3 al bit 0 Área de memoria:

B#16#23

–

0: Área de periferia

–

1: Memoria imagen de proceso de las entradas

–

2: Memoria imagen de proceso de las salidas

–

3: Marcas

–

4: DB global

–

5: DB de instancia

–

6: Datos locales propios

–

7: Datos locales del invocante

Error de longitud de área durante escritura
OB121_RESERVED_1

B#16#28

Como con el código de error B#16#22
Acceso de lectura a un byte, palabra o palabra doble con un puntero cuya
dirección de bit es distinta de 0

OB121_RESERVED_1

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Como con el código de error B#16#22

961

Configuración de dispositivos y redes
1.4 Crear configuraciones
Código de error

Variable

B#16#29

Significado
Acceso de escritura a un byte, palabra o palabra doble con un puntero cuya
dirección de bit es distinta de 0
Dirección de byte errónea. El área de datos y el tipo de acceso se pueden
consultar en OB121_RESERVED_1

OB121_RESERVED_1
B#16#24

Como con el código de error B#16#22
Error de área durante lectura

OB121_FLT_REG
B#16#25

Contiene en el low byte el identificador del área errónea (B#16#86 área propia
de datos locales)
Error de área durante escritura

OB121_FLT_REG
B#16#26

Contiene en el low byte el identificador del área errónea (B#16#86 área propia
de datos locales)
Error en número de temporizador

OB121_FLT_REG
B#16#27

Número no admisible
Error en número de contador

OB121_FLT_REG
B#16#30

Número no admisible
Acceso de escritura a un DB global protegido contra escritura

OB121_FLT_REG
B#16#31

Número de DB no admisible
Acceso de escritura a un DB de instancia protegido contra escritura

OB121_FLT_REG
B#16#32

Número de DB no admisible
Número erróneo de DB al acceder a un DB global

OB121_FLT_REG
B#16#33

Número de DB no admisible
Número erróneo de DB al acceder a un DB de instancia

OB121_FLT_REG
B#16#34

Número de DB no admisible
Error de número al llamar la FC

OB121_FLT_REG
B#16#35

N.º de FC
Error de número FB al llamar el FB

OB121_FLT_REG

N.º de FB

OB121_FLT_REG

Número de DB

B#16#3A

Acceso a un DB no cargado; el número de DB está dentro del rango admisible

B#16#3C

Acceso a una FC no cargada; el número de FC está dentro del rango admi‐
sible
OB121_FLT_REG

B#16#3D

N.º de FC
Acceso a una instrucción no presente; el número de SFC está dentro del
rango admisible

OB121_FLT_REG
B#16#3E

N.º de SFC
Acceso a un FB no cargado; el número de FB está dentro del rango admisible

OB121_FLT_REG
B#16#3F

N.º de FB
Acceso a un SFB no presente; el número de SFB está dentro del rango ad‐
misible

OB121_FLT_REG

N.º de SFB

Programación del OB 121
El OB 121 debe agregarse a los bloques de la CPU. Escriba en el bloque creado el programa
que se deba procesar en el OB 121 y cárguelo en la CPU como parte del programa de usuario.

962

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

Configuración de dispositivos y redes
1.4 Crear configuraciones
El OB 121 puede usarse por ejemplo de la siguiente manera:
● Se evalúa la información de arranque del OB 121.
● Debe registrarse la causa del error en un bloque de datos de notificación.

OB de error de acceso a la periferia (OB 122)
Descripción
El sistema operativo de la CPU activa el OB 122 cuando se produce un error al acceder a los
datos de un módulo. Si por ejemplo la CPU detecta un error de lectura al acceder a los datos
de un módulo de señal, el sistema operativo llama el OB 122.

Funcionamiento del OB de error de acceso a la periferia
El OB 122 se ejecuta en la misma clase de prioridad que el bloque interrumpido. Si el OB 122
no está programado, la CPU cambia su estado operativo de RUN a STOP.
S7 dispone de las siguientes instrucciones para enmascarar y desenmascarar eventos de
arranque del OB 122 durante la ejecución del programa:
● La instrucción "MSK_FLT" enmascara determinados códigos de error.
● La instrucción "DMSK_FLT" desenmascara los códigos de error que han sido
enmascarados por la instrucción "MSK_FLT".
● La instrucción "READ_ERR" lee el registro de estado de evento.

Datos locales del OB de error de acceso a la periferia
La tabla siguiente contiene las variables temporales (TEMP) del OB de error de acceso a la
periferia. Se han escogido como nombres de variable los nombres predeterminados del OB
122.
Variable

Tipo de datos

Descripción

OB122_EV_CLASS

BYTE

Clase de evento e identificadores: B#16#29

OB122_SW_FLT

BYTE

Código de error:
● B#16#42: Error de acceso a la periferia, en lectura
● B#16#43: Error de acceso a la periferia, en
escritura

OB122_PRIORITY

BYTE

Clase de prioridad del OB en el que se ha producido
el error
En las CPU S7-1500: prioridad, valor predetermina‐
do: 7

OB122_OB_NUMBR

BYTE

N.º de OB (122)

OB122_BLK_TYPE

BYTE

Tipo de bloque en el que se ha producido el error
(B#16#88: OB, B#16#8C: FC, B#16#8E: FB) (en
S7-300 no se registra aquí ningún valor válido)

Edición de dispositivos y redes
Manual de programación y manejo, 11/2019

963

Configuración de dispositivos y redes
1.4 Crear configuraciones
Variable

Tipo de datos

Descripción

OB122_MEM_AREA

BYTE

Área de memoria y tipo de acceso:
● Del bit 7 al bit 4: Tipo de acceso
–

0: Acceso por bit

–

1: Acceso por byte

–

2: Acceso por palabra

–

3: Acceso por palabra doble

● Del bit 3 al bit 0:Área de memoria
–

0: Área de periferia

–

1: Memoria imagen de proceso de las entradas

–

2: Memoria imagen de proceso de las salidas

OB122_MEM_ADDR

WORD

Dirección de la memoria en la que se ha producido el
error

OB122_BLK_NUM

WORD

Número del bloque que contiene el comando MC7
que provoca errores (en el caso de S7-300, no se
registra aquí ningún valor válido):

OB122_PRG_ADDR

WORD

Dirección relativa del comando MC7 que provoca
errores (en el caso de S7-300, no se registra aquí
ningún valor válido):

OB122_DATE_TIME

DATE_AND_TIME

Fecha y hora en las que se solicitó el OB

Programa de ejemplo para el OB 122
En el siguiente programa de ejemplo se define un valor sustitutivo en la instrucción REPL_VAL.
Si falla un módulo de entrada, el procesamiento de la instrucción L PEB0 provoca un error
síncrono y arranca el OB 122. De modo predeterminado, el comando de carga lee el valor 0.
Sin embargo, con la instrucción "REPL_VAL" puede especificarse un valor sustitutivo
cualquiera, siempre que sea válido para el proceso. Esta instrucción sustituye el contenido del
ACU por el valor sustitutivo especificado.
AWL

Descripción

L

B#16#42

//Identificador del evento "Error de acceso a periferia en
lectura"

L

#OB122_SW_FLT

//Código de error de OB 122

==I

//Si es igual,

SPB

Qfeh

L

B#16#43

<>I

//entonces saltar a Qfeh
//Identificador del evento "Error de acceso a periferia en
escritura"
//Si es distinto al código de error de OB 122,

SPB

STOP

//entonces saltar a STOP

Qfeh:
CALL

"REPL_VAL"
VAL:= DW#16#2912

//Valor sustitutivo que se c